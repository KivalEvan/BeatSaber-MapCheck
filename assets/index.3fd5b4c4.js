import{J as ci}from"./vendor.6089e67f.js";const cl=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}};cl();const ul="UI Accordion: ",Xe="accordion__";var Kn;(function(t){t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy"})(Kn||(Kn={}));const ui=document.querySelectorAll(".accordion__button");ui.length||console.error(ul+"empty accordion list, intentional or typo error?");const ml=(t,e,n,o=!1)=>{const r=document.createElement("div");r.className="accordion";const i=document.createElement("input");i.className=Xe+"button",i.id=t,i.setAttribute("type","checkbox");const l=document.createElement("label");l.className=Xe+"label unselectable",l.htmlFor=t,l.textContent=e,n&&l.classList.add(Kn[n]);const a=document.createElement("div");return a.className=o?Xe+"collapsible-flex":Xe+"collapsible",a.id=t+"-content",r.appendChild(i),r.appendChild(l),r.appendChild(a),r},dl=(t,e)=>{ui.forEach(n=>{n.id.endsWith(t)&&(n.checked=e)})},j=t=>{if(!t)return"0:00";const e=Math.floor(t),n=e/60,o=n<0?`-${Math.ceil(n).toString()}`:Math.floor(n).toString(),r=Math.abs(e%60).toString().padStart(2,"0");return`${o}:${r}`},_l=t=>{if(!t)return"0:00:00";const e=Math.round(t*60%60).toString().padStart(2,"0");return`${j(t)}:${e}`},pl=t=>{var n;if(!t)return"0:00.000";const e=((n=(t%1).toString().split(".")[1])==null?void 0:n.padEnd(3,"0").slice(0,3))||"000";return`${j(t)}.${e}`},hl=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),p=(t,e=0)=>Math.round(t*Math.pow(10,e))/Math.pow(10,e),zn=t=>t*(180/Math.PI),ce=t=>t*(Math.PI/180),mi=(t,e)=>{e<0&&(e=-e);let n=t%e;return n<0?n+e:n},di=(t,e,n)=>Math.min(mi(t-e,n),mi(e-t,n)),Wn=t=>{if(t.length===0)return 0;t.sort((n,o)=>n-o);const e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2},_i=t=>{let e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")},pi=t=>{let e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")},hi=t=>/[a-fA-F0-9]*/g.test(t),Zn=t=>{for(let e=t.options.length-1;e>=0;e--)t.remove(e)},Qn=t=>(typeof t!="object"&&console.error("Received non-object type"),JSON.parse(JSON.stringify(t))),R="UI Header: ",Ye=document.querySelector(".intro"),Ke=document.querySelector(".metadata"),dt=document.querySelector(".cover__link"),ke=document.querySelector(".cover__image"),to=document.querySelector(".metadata__song-name"),eo=document.querySelector(".metadata__song-subname"),no=document.querySelector(".metadata__song-author"),oo=document.querySelector(".metadata__song-bpm"),ze=document.querySelector(".metadata__song-duration"),We=document.querySelector(".audio");(!Ye||!Ke)&&console.error(R+"header component is missing one of the two section");(!dt||!ke)&&console.error(R+"cover component is missing");(!to||!eo||!no||!oo||!ze)&&console.error(R+"metadata component is missing one of the part");const ro=t=>{if(!Ye||!Ke){console.error(R+"could not switch header, one of the section is missing");return}t?Ye.classList.add("hidden"):Ye.classList.remove("hidden"),t?Ke.classList.remove("hidden"):Ke.classList.add("hidden")},fi=t=>{if(!ke){console.error(R+"missing HTML element for cover image");return}ke.src=t||"./img/unknown.jpg"},fl=()=>ke?ke.src:(console.error(R+"missing HTML element for cover image"),null),io=(t,e)=>{if(!dt){console.error(R+"missing HTML element for cover link");return}if(t==null&&e==null){dt.textContent="",dt.href="",dt.classList.add("disabled");return}t!=null&&(dt.textContent=e!=null?e:"Download Link",dt.href=t,dt.classList.remove("disabled"))},gl=t=>{if(!to){console.error(R+"missing HTML element for song name");return}to.textContent=t},bl=t=>{if(!eo){console.error(R+"missing HTML element for song subname");return}eo.textContent=t},yl=t=>{if(!no){console.error(R+"missing HTML element for song author");return}no.textContent=t},El=(t,e,n)=>{if(!oo){console.error(R+"missing HTML element for song bpm");return}let o=p(t,2).toString()+"BPM";oo.textContent=o},Ze=t=>{if(!ze){console.error(R+"missing HTML element for song duration");return}t?ze.textContent=pl(t):ze.textContent="No audio"};let vl;const Tl=async t=>{if(!We){console.error(R+"missing HTML element for audio");return}const e=new Blob([t],{type:"audio/ogg"});We.src=window.URL.createObjectURL(e)},$l=()=>{if(!We){console.error(R+"missing HTML element for audio");return}We.src="",window.URL.revokeObjectURL(vl)},Ll=()=>{ro(!1),fi(null),io(),Ze(0),$l()};class gi{constructor(e,n=[],o=0){this._bpm=e,this._offset=o/1e3,this._bpmChange=this.getBPMChangeTime([...n])}get value(){return this._bpm}set value(e){this._bpm=e}get change(){return this._bpmChange}set change(e){this._bpmChange=this.getBPMChangeTime([...e])}get offset(){return this._offset*1e3}set offset(e){this._offset=e/1e3}getBPMChangeTime(e=[]){var r;let n;const o=[];for(let i=0;i<e.length;i++){const l={_BPM:(r=e[i]._BPM)!=null?r:e[i]._bpm,_time:e[i]._time,_beatsPerBar:e[i]._beatsPerBar,_metronomeOffset:e[i]._metronomeOffset,_newTime:0};n?l._newTime=Math.ceil((l._time-n._time)/this._bpm*n._BPM+n._newTime-.01):l._newTime=Math.ceil(l._time-this._offset*this._bpm/60-.01),o.push(l),n=l}return o}offsetBegone(e){return(this.toRealTime(e)-this._offset)*this._bpm/60}toRealTime(e){return e/this._bpm*60}toBeatTime(e){return e*this._bpm/60}adjustTime(e){for(let n=this._bpmChange.length-1;n>=0;n--)if(e>this._bpmChange[n]._time)return(e-this._bpmChange[n]._time)/this._bpm*this._bpmChange[n]._BPM+this._bpmChange[n]._newTime;return this.offsetBegone(e)}}const rt=(t,e,n)=>new gi(t,e,n),D={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}},ao={DefaultEnvironment:[0,1,2,3,4,5,8,9,12,13],OriginsEnvironment:[0,1,2,3,4,5,8,9,12,13],Origins:[0,1,2,3,4,5,8,9,12,13],TriangleEnvironment:[0,1,2,3,4,5,8,9,12,13],NiceEnvironment:[0,1,2,3,4,5,8,9,12,13],BigMirrorEnvironment:[0,1,2,3,4,5,8,9,12,13],DragonsEnvironment:[0,1,2,3,4,5,8,9,12,13],KDAEnvironment:[0,1,2,3,4,5,8,9,12,13],MonstercatEnvironment:[0,1,2,3,4,5,8,9,12,13],CrabRaveEnvironment:[0,1,2,3,4,5,8,9,12,13],PanicEnvironment:[0,1,2,3,4,5,8,9,12,13],RocketEnvironment:[0,1,2,3,4,5,8,9,12,13],GreenDayEnvironment:[0,1,2,3,4,5,8,9,12,13],GreenDayGrenadeEnvironment:[0,1,2,3,4,5,8,9,12,13],TimbalandEnvironment:[0,1,2,3,4,5,8,9,12,13],FitBeatEnvironment:[0,1,2,3,4,5,8,9,12,13],LinkinParkEnvironment:[0,1,2,3,4,5,8,9,12,13],BTSEnvironment:[0,1,2,3,4,5,8,9,12,13],KaleidoscopeEnvironment:[0,1,2,3,4,5,8,9,12,13],InterscopeEnvironment:[0,1,2,3,4,5,6,7,8,9,12,13,16,17],SkrillexEnvironment:[0,1,2,3,4,5,6,7,8,9,12,13],BillieEnvironment:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,17],HalloweenEnvironment:[0,1,2,3,4,5,8,9,12,13],GagaEnvironment:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,17],GlassDesertEnvironment:[0,1,2,3,4,5,8,9,12,13]};Array.from(Array(10),(t,e)=>e+1),Array.from(Array(60),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(12),(t,e)=>e+1),Array.from(Array(10),(t,e)=>e+1),Array.from(Array(60),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(12),(t,e)=>e+1),Array.from(Array(10),(t,e)=>e+1),Array.from(Array(60),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(12),(t,e)=>e+1),Array.from(Array(8),(t,e)=>e+1),Array.from(Array(60),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(12),(t,e)=>e+1),Array.from(Array(10),(t,e)=>e+1),Array.from(Array(60),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(12),(t,e)=>e+1),Array.from(Array(10),(t,e)=>e+1),Array.from(Array(60),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(16),(t,e)=>e+1),Array.from(Array(2),(t,e)=>e+1),Array.from(Array(62),(t,e)=>e+1),Array.from(Array(5),(t,e)=>e+1),Array.from(Array(5),(t,e)=>e+1),Array.from(Array(4),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(5),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(9),(t,e)=>e+1),Array.from(Array(80),(t,e)=>e+1),Array.from(Array(8),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(5),(t,e)=>e+1),Array.from(Array(5),(t,e)=>e+1),Array.from(Array(14),(t,e)=>e+1),Array.from(Array(8),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(5),(t,e)=>e+1),Array.from(Array(5),(t,e)=>e+1),Array.from(Array(14),(t,e)=>e+1),Array.from(Array(2),(t,e)=>e+1),Array.from(Array(62),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(11),(t,e)=>e+1),Array.from(Array(4),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(5),(t,e)=>e+1),Array.from(Array(16),(t,e)=>e+1),Array.from(Array(60),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(3),(t,e)=>e+1),Array.from(Array(16),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(3),(t,e)=>e+1),Array.from(Array(20),(t,e)=>e+1),Array.from(Array(20),(t,e)=>e+1),Array.from(Array(10),(t,e)=>e+1),Array.from(Array(14),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(30),(t,e)=>e+1),Array.from(Array(30),(t,e)=>e+1),Array.from(Array(8),(t,e)=>e+1),Array.from(Array(8),(t,e)=>e+1),Array.from(Array(2),(t,e)=>e+1),Array.from(Array(2),(t,e)=>e+1),Array.from(Array(16),(t,e)=>e+1),Array.from(Array(20),(t,e)=>e+1),Array.from(Array(20),(t,e)=>e+1),Array.from(Array(1),(t,e)=>e+1),Array.from(Array(1),(t,e)=>e+1),Array.from(Array(20),(t,e)=>e+1),Array.from(Array(25),(t,e)=>e+1),Array.from(Array(25),(t,e)=>e+1),Array.from(Array(3),(t,e)=>e+1),Array.from(Array(40),(t,e)=>e+1),Array.from(Array(40),(t,e)=>e+1),Array.from(Array(20),(t,e)=>e+1),Array.from(Array(20),(t,e)=>e+1),Array.from(Array(80),(t,e)=>e+1),Array.from(Array(3),(t,e)=>e+1),Array.from(Array(3),(t,e)=>e+1),Array.from(Array(3),(t,e)=>e+1),Array.from(Array(3),(t,e)=>e+1),Array.from(Array(3),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(7),(t,e)=>e+1),Array.from(Array(2),(t,e)=>e+1),Array.from(Array(66),(t,e)=>e+1),Array.from(Array(23),(t,e)=>e+1),Array.from(Array(23),(t,e)=>e+1),Array.from(Array(66),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(2),(t,e)=>e+1),Array.from(Array(66),(t,e)=>e+1),Array.from(Array(23),(t,e)=>e+1),Array.from(Array(23),(t,e)=>e+1),Array.from(Array(66),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(2),(t,e)=>e+1),Array.from(Array(66),(t,e)=>e+1),Array.from(Array(23),(t,e)=>e+1),Array.from(Array(23),(t,e)=>e+1),Array.from(Array(66),(t,e)=>e+1),Array.from(Array(2),(t,e)=>e+1),Array.from(Array(66),(t,e)=>e+1),Array.from(Array(23),(t,e)=>e+1),Array.from(Array(23),(t,e)=>e+1),Array.from(Array(66),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(24),(t,e)=>e+1),Array.from(Array(6),(t,e)=>e+1),Array.from(Array(8),(t,e)=>e+1),Array.from(Array(10),(t,e)=>e+1),Array.from(Array(10),(t,e)=>e+1);const Se=class{constructor(t,e=10,n=0){this._bpm=t,this._njs=e,this._sdm=n,this.update()}set value(t){this._njs=t,this.update()}get value(){return this._njs}set offset(t){this._sdm=t,this.update()}get offset(){return this._sdm}get hjd(){return this._hjd}get hjdMin(){return Se.HJD_MIN}get reactTime(){return this._reactionTime}get jd(){return this._jd}get jdMin(){return this._jdMin}update(){this._hjd=this.calcHalfJumpDuration(),this._jd=this.calcJumpDistance(),this._jdMin=this.calcJumpDistance(Se.HJD_MIN),this._reactionTime=this.calcReactionTimeFromHJD()}calcHalfJumpDurationRaw(){const t=17.999,e=this._njs*this._njs/this._njs,n=60/this._bpm.value;let o=Se.HJD_START;for(;e*n*o>t;)o/=2;return o<1&&(o=1),o}calcHalfJumpDuration(t=this.offset){return Math.max(this.calcHalfJumpDurationRaw()+t,Se.HJD_MIN)}calcHalfJumpDurationFromJD(t=this.calcJumpDistance()){return t/(60/this._bpm.value*this._njs*2)}calcHalfJumpDurationFromRT(t=this.calcReactionTimeFromHJD()){return t/(60/this._bpm.value)}calcJumpDistance(t=this.calcHalfJumpDuration()){return this._njs*(60/this._bpm.value)*t*2}calcJumpDistanceOptimalHigh(){return 18*(1/1.07)**this._njs+18}calcJumpDistanceOptimalLow(){return-(18/(this._njs+1))+18}calcReactionTimeFromJD(t=this.calcJumpDistance()){return t/(2*this._njs)}calcReactionTimeFromHJD(t=this.calcHalfJumpDuration()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let Qe=Se;Qe.HJD_START=4;Qe.HJD_MIN=.25;const lo=(t,e=10,n=0)=>typeof t=="number"?new Qe(new gi(t),e,n):new Qe(t,e,n);var so;(function(t){t[t.ExpertPlus=16]="ExpertPlus",t[t.Expert=12]="Expert",t[t.Hard=10]="Hard",t[t.Normal=10]="Normal",t[t.Easy=10]="Easy"})(so||(so={}));var tn;(function(t){t.Standard="Standard",t.NoArrows="No Arrows",t.OneSaber="One Saber",t["360Degree"]="360 Degree",t["90Degree"]="90 Degree",t.Lightshow="Lightshow",t.Lawless="Lawless"})(tn||(tn={}));var en;(function(t){t[t.Standard=0]="Standard",t[t.NoArrows=1]="NoArrows",t[t.OneSaber=2]="OneSaber",t[t["360Degree"]=3]="360Degree",t[t["90Degree"]=4]="90Degree",t[t.Lightshow=5]="Lightshow",t[t.Lawless=6]="Lawless"})(en||(en={}));var ue;(function(t){t.Easy="Easy",t.Normal="Normal",t.Hard="Hard",t.Expert="Expert",t.ExpertPlus="Expert+"})(ue||(ue={}));var co;(function(t){t[t.Easy=1]="Easy",t[t.Normal=3]="Normal",t[t.Hard=5]="Hard",t[t.Expert=7]="Expert",t[t.ExpertPlus=9]="ExpertPlus"})(co||(co={}));const wl={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_obstacleColor:"Obstacle Color"},Cl={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",Origins:"Origins (Triangle)",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",GlassDesertEnvironment:"Glass Desert"},B={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",Origins:"The First",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",GlassDesertEnvironment:"Glass Desert"};var uo;(function(t){t._id="Ct",t._lookupMethod="Lm",t._duplicate="D",t._active="A",t._scale="S",t._position="P",t._localPosition="Lp",t._rotation="R",t._localRotation="Lr",t._lightID="Li",t._track="T"})(uo||(uo={}));var bi;(function(t){t[t.BACK_LASERS=0]="BACK_LASERS",t[t.RING_LIGHTS=1]="RING_LIGHTS",t[t.LEFT_LASERS=2]="LEFT_LASERS",t[t.RIGHT_LASERS=3]="RIGHT_LASERS",t[t.CENTER_LIGHTS=4]="CENTER_LIGHTS",t[t.LIGHT_BOOST=5]="LIGHT_BOOST",t[t.EXTRA_LEFT_LIGHTS=6]="EXTRA_LEFT_LIGHTS",t[t.EXTRA_RIGHT_LIGHTS=7]="EXTRA_RIGHT_LIGHTS",t[t.RING_ROTATION=8]="RING_ROTATION",t[t.RING_ZOOM=9]="RING_ZOOM",t[t.EXTRA_LEFT_LASERS=10]="EXTRA_LEFT_LASERS",t[t.EXTRA_RIGHT_LASERS=11]="EXTRA_RIGHT_LASERS",t[t.LEFT_LASER_ROTATION=12]="LEFT_LASER_ROTATION",t[t.RIGHT_LASER_ROTATION=13]="RIGHT_LASER_ROTATION",t[t.EARLY_LANE_ROTATION=14]="EARLY_LANE_ROTATION",t[t.LATE_LANE_ROTATION=15]="LATE_LANE_ROTATION",t[t.UTILITY_EVENT_1=16]="UTILITY_EVENT_1",t[t.UTILITY_EVENT_2=17]="UTILITY_EVENT_2",t[t.UTILITY_EVENT_3=18]="UTILITY_EVENT_3",t[t.UTILITY_EVENT_4=19]="UTILITY_EVENT_4",t[t.BPM_CHANGE=100]="BPM_CHANGE"})(bi||(bi={}));var yi;(function(t){t[t.OFF=0]="OFF",t[t.BLUE_ON=1]="BLUE_ON",t[t.BLUE_FLASH=2]="BLUE_FLASH",t[t.BLUE_FADE=3]="BLUE_FADE",t[t.BLUE_TRANSITION=4]="BLUE_TRANSITION",t[t.RED_ON=5]="RED_ON",t[t.RED_FLASH=6]="RED_FLASH",t[t.RED_FADE=7]="RED_FADE",t[t.RED_TRANSITION=8]="RED_TRANSITION"})(yi||(yi={}));var mo;(function(t){t[t["Back Lasers"]=0]="Back Lasers",t[t["Ring Lights"]=1]="Ring Lights",t[t["Left Lasers"]=2]="Left Lasers",t[t["Right Lasers"]=3]="Right Lasers",t[t["Center Lights"]=4]="Center Lights",t[t["Light Boost"]=5]="Light Boost",t[t["Extra Left Lights"]=6]="Extra Left Lights",t[t["Extra Right Lights"]=7]="Extra Right Lights",t[t["Ring Rotation"]=8]="Ring Rotation",t[t["Ring Zoom"]=9]="Ring Zoom",t[t["Extra Left Lasers"]=10]="Extra Left Lasers",t[t["Extra Right Lasers"]=11]="Extra Right Lasers",t[t["Left Laser Rotation"]=12]="Left Laser Rotation",t[t["Right Laser Rotation"]=13]="Right Laser Rotation",t[t["Early Lane Rotation"]=14]="Early Lane Rotation",t[t["Late Lane Rotation"]=15]="Late Lane Rotation",t[t["Utility Event 1"]=16]="Utility Event 1",t[t["Utility Event 2"]=17]="Utility Event 2",t[t["Utility Event 3"]=18]="Utility Event 3",t[t["Utility Event 4"]=19]="Utility Event 4",t[t["BPM Change"]=100]="BPM Change"})(mo||(mo={}));var Ei;(function(t){t._childrenTracks="Ct",t._color="C",t._definitePosition="Dp",t._dissolve="D",t._dissolveArrow="Da",t._duration="Dur",t._easing="E",t._interactable="I",t._localRotation="Lr",t._parentTrack="Pt",t._position="P",t._rotation="R",t._scale="S",t._time="T",t._track="Tr",t._worldPositionStays="Wps"})(Ei||(Ei={}));const _o=t=>t._width>=2||t._lineIndex===1||t._lineIndex===2,xl=t=>t._type===1&&(t._width>2||t._width===2&&t._lineIndex===1),$=(t,e,n=0)=>t._time+t._duration>e._time+e._duration+n,Al=t=>{var e;return Array.isArray((e=t._customData)==null?void 0:e._color)},vi=t=>{var e,n,o,r,i,l,a,s,u,_;return Array.isArray((e=t._customData)==null?void 0:e._animation)||typeof((n=t._customData)==null?void 0:n._fake)=="boolean"||typeof((o=t._customData)==null?void 0:o._interactable)=="boolean"||Array.isArray((r=t._customData)==null?void 0:r._localRotation)||typeof((i=t._customData)==null?void 0:i._noteJumpMovementSpeed)=="number"||typeof((l=t._customData)==null?void 0:l._noteJumpStartBeatOffset)=="number"||Array.isArray((a=t._customData)==null?void 0:a._position)||Array.isArray((s=t._customData)==null?void 0:s._rotation)||Array.isArray((u=t._customData)==null?void 0:u._scale)||typeof((_=t._customData)==null?void 0:_._track)=="string"},po=t=>t._width>=1e3||t._type>=1e3||t._lineIndex>3||t._lineIndex<0,kl=t=>!po(t)&&t._width>0&&t._width<=4,Sl=t=>{const e={total:0,interactive:0,crouch:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let n=t.length-1;n>=0;n--)e.total++,_o(t[n])&&e.interactive++,xl(t[n])&&e.crouch++,Al(t[n])&&e.chroma++,vi(t[n])&&e.noodleExtensions++,po(t[n])&&e.mappingExtensions++;return e},Ti=t=>{const{_notes:e,_obstacles:n}=t;let o=Number.MAX_VALUE;e.length>0&&(o=e[0]._time);const r=Il(n);return Math.min(o,r)},nn=t=>{const{_notes:e,_obstacles:n}=t;let o=0;e.length>0&&(o=e[e.length-1]._time);const r=Rl(n);return Math.max(o,r)},Il=t=>{for(let e=0,n=t.length;e<n;e++)if(_o(t[e]))return t[e]._time;return Number.MAX_VALUE},Rl=t=>{let e=0;for(let n=t.length-1;n>=0;n--)_o(t[n])&&(e=Math.max(e,t[n]._time+t[n]._duration));return e},Ml=t=>t._value===0,Dl=t=>t._value===1||t._value===5,Bl=t=>t._value===2||t._value===6,Hl=t=>t._value===3||t._value===7,$i=t=>t._type>=0&&t._type<=17||t._type===100,on=t=>t._type===0||t._type===1||t._type===2||t._type===3||t._type===4||t._type===6||t._type===7||t._type===10||t._type===11,Nl=t=>t._type===8,Pl=t=>t._type===9,Li=t=>t._type===12||t._type===13,wi=t=>t._type===14||t._type===15,Ol=t=>{var e,n,o,r,i,l,a,s,u,_,c,g,m,f,d,v,y,E,T,F,nt,$e,Le,we,Ce,xe,Ae,mt,ot,I,si;return on(t)?Array.isArray((e=t._customData)==null?void 0:e._color)||typeof((n=t._customData)==null?void 0:n._lightID)=="number"||Array.isArray((o=t._customData)==null?void 0:o._lightID)||typeof((r=t._customData)==null?void 0:r._propID)=="number"||typeof((i=t._customData)==null?void 0:i._lightGradient)=="object":(t=t,Nl(t)?typeof((l=t._customData)==null?void 0:l._nameFilter)=="string"||typeof((a=t._customData)==null?void 0:a._reset)=="boolean"||typeof((s=t._customData)==null?void 0:s._rotation)=="number"||typeof((u=t._customData)==null?void 0:u._step)=="number"||typeof((_=t._customData)==null?void 0:_._prop)=="number"||typeof((c=t._customData)==null?void 0:c._speed)=="number"||typeof((g=t._customData)==null?void 0:g._direction)=="number"||typeof((m=t._customData)==null?void 0:m._counterSpin)=="boolean"||typeof((f=t._customData)==null?void 0:f._stepMult)=="number"||typeof((d=t._customData)==null?void 0:d._propMult)=="number"||typeof((v=t._customData)==null?void 0:v._speedMult)=="number":(t=t,Pl(t)?typeof((y=t._customData)==null?void 0:y._nameFilter)=="string"||typeof((E=t._customData)==null?void 0:E._reset)=="boolean"||typeof((T=t._customData)==null?void 0:T._rotation)=="number"||typeof((F=t._customData)==null?void 0:F._step)=="number"||typeof((nt=t._customData)==null?void 0:nt._prop)=="number"||typeof(($e=t._customData)==null?void 0:$e._speed)=="number"||typeof((Le=t._customData)==null?void 0:Le._direction)=="number"||typeof((we=t._customData)==null?void 0:we._counterSpin)=="boolean"||typeof((Ce=t._customData)==null?void 0:Ce._stepMult)=="number"||typeof((xe=t._customData)==null?void 0:xe._propMult)=="number"||typeof((Ae=t._customData)==null?void 0:Ae._speedMult)=="number":(t=t,Li(t)?typeof((mt=t._customData)==null?void 0:mt._lockPosition)=="boolean"||typeof((ot=t._customData)==null?void 0:ot._speed)=="number"||typeof((I=t._customData)==null?void 0:I._preciseSpeed)=="number"||typeof((si=t._customData)==null?void 0:si._direction)=="number":!1)))},Ci=t=>t._value>=2e9,Fl=t=>{var e;return!!(wi(t)&&typeof((e=t._customData)==null?void 0:e._rotation)=="number")},jl=t=>wi(t)&&t._value>=1e3&&t._value<=1720,ql=t=>$i(t)&&t._value>=0&&!(!Li(t)&&t._value>8&&!Ci(t)),Gl=(t,e="DefaultEnvironment")=>{var r;const n=(r=ao[e])!=null?r:[0,1,2,3,4,8,9,12,13],o={};for(let i=n.length-1;i>=0;i--)o[n[i]]={total:0,chroma:0,chromaOld:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>=0;i--)$i(t[i])&&(o[t[i]._type]||(o[t[i]._type]={total:0,chroma:0,chromaOld:0,noodleExtensions:0,mappingExtensions:0}),o[t[i]._type].total++,Ol(t[i])&&o[t[i]._type].chroma++,Ci(t[i])&&o[t[i]._type].chromaOld++,Fl(t[i])&&o[t[i]._type].noodleExtensions++,jl(t[i])&&o[t[i]._type].mappingExtensions++);return o},it=[180,0,270,90,225,135,315,45,0],Ul=[1,0,3,2,7,6,5,4,8],_t={0:[0,1],1:[0,-1],2:[-1,0],3:[1,0],4:[-1,1],5:[1,1],6:[-1,-1],7:[1,-1],8:[0,0]},S=t=>t._type===0||t._type===1,Jl=t=>t._type===3,W=t=>{var e;return((e=t._customData)==null?void 0:e._position)?[t._customData._position[0],t._customData._position[1]]:[(t._lineIndex<=-1e3||t._lineIndex>=1e3?t._lineIndex/1e3:t._lineIndex)-2,t._lineLayer<=-1e3||t._lineLayer>=1e3?t._lineLayer/1e3:t._lineLayer]},H=t=>{var e;return((e=t._customData)==null?void 0:e._cutDirection)?t._customData._cutDirection>0?t._customData._cutDirection%360:360+t._customData._cutDirection%360:t._cutDirection>=1e3?Math.abs(t._cutDirection%1e3%360-360):it[t._cutDirection]||0},pt=(t,e)=>{const[n,o]=W(t),[r,i]=W(e);return Math.sqrt(Math.pow(r-n,2)+Math.pow(i-o,2))},me=(t,e)=>{const[n]=W(t),[o]=W(e),r=n-o;return r>-.001&&r<.001},de=(t,e)=>{const[n,o]=W(t),[r,i]=W(e),l=o-i;return l>-.001&&l<.001},rn=(t,e)=>{const[n,o]=W(t),[r,i]=W(e),l=Math.abs(n-r),a=Math.abs(o-i);return l===a},an=(t,e,n=.5)=>pt(t,e)<=n,Vl=(t,e,n)=>{for(let o=n,r=e.length;o<r;o++){if(e[o]._time<t._time+.01&&e[o]._type!==t._type)return!0;if(e[o]._time>t._time+.01)return!1}return!1},xi=(t,e)=>pt(t,e)>1.8,ho=(t,e)=>xi(t,e)&&!rn(t,e)&&!de(t,e)&&!me(t,e),fo=(t,e,n,o=!1)=>{const[r,i]=W(t),[l,a]=W(e),s=H(t),u=H(e),_=o?540:360;let c=!1;if(t._cutDirection!==8){const m=(zn(Math.atan2(i-a,r-l))+450)%360;for(const[f,d,v]of n){const y=v!=null?v:0,E=(s+_-f+y)%360,T=(s+_+f+y)%360;if(c=d>=Math.sqrt(Math.pow(r-l,2)+Math.pow(i-a,2))&&(E<T&&E<=m&&m<=T||E>=T&&(m<=T||m>=E))||c,c)break}}let g=!1;if(e._cutDirection!==8){const m=(zn(Math.atan2(a-i,l-r))+450)%360;for(const[f,d,v]of n){const y=v!=null?v:0,E=(u+_-f+y)%360,T=(u+_+f+y)%360;if(g=d>=Math.sqrt(Math.pow(r-l,2)+Math.pow(i-a,2))&&(E<T&&E<=m&&m<=T||E>=T&&(m<=T||m>=E))||g,g)break}}return[c,g]},Ai=(t,e,n)=>t._cutDirection===8&&e._cutDirection===8&&n!==8&&(t._lineIndex>e._lineIndex&&(n===5||n===3||n===7)||t._lineIndex<e._lineIndex&&(n===6||n===2||n===4)||t._lineLayer>e._lineLayer&&(n===4||n===0||n===5)||t._lineLayer<e._lineLayer&&(n===6||n===1||n===7))||t._lineIndex>e._lineIndex&&(t._cutDirection===5||t._cutDirection===3||t._cutDirection===7||(e._cutDirection===5||e._cutDirection===3||e._cutDirection===7)&&t._cutDirection===8)||t._lineIndex<e._lineIndex&&(t._cutDirection===6||t._cutDirection===2||t._cutDirection===4||(e._cutDirection===6||e._cutDirection===2||e._cutDirection===4)&&t._cutDirection===8)||t._lineLayer>e._lineLayer&&(t._cutDirection===4||t._cutDirection===0||t._cutDirection===5||(e._cutDirection===4||e._cutDirection===0||e._cutDirection===5)&&t._cutDirection===8)||t._lineLayer<e._lineLayer&&(t._cutDirection===6||t._cutDirection===1||t._cutDirection===7||(e._cutDirection===6||e._cutDirection===1||e._cutDirection===7)&&t._cutDirection===8),ki=(t,e)=>{if(Ai(t,e,8))return t._cutDirection===8?e._cutDirection:t._cutDirection;if(t._cutDirection!==8)return t._cutDirection;if(t._time>e._time){if(t._lineIndex>e._lineIndex&&de(t,e))return 3;if(t._lineIndex<e._lineIndex&&de(t,e))return 2;if(t._lineLayer>e._lineLayer){if(me(t,e))return 0;if(t._lineIndex>e._lineIndex)return 5;if(t._lineIndex<e._lineIndex)return 4}if(t._lineLayer<e._lineLayer){if(me(t,e))return 1;if(t._lineIndex>e._lineIndex)return 7;if(t._lineIndex<e._lineIndex)return 6}}return 8},Xl=t=>{var e,n,o,r,i,l,a,s,u,_,c,g,m;return Array.isArray((e=t._customData)==null?void 0:e._animation)||typeof((n=t._customData)==null?void 0:n._cutDirection)=="number"||typeof((o=t._customData)==null?void 0:o._disableNoteGravity)=="boolean"||typeof((r=t._customData)==null?void 0:r._disableNoteLook)=="boolean"||typeof((i=t._customData)==null?void 0:i._fake)=="boolean"||Array.isArray((l=t._customData)==null?void 0:l._flip)||typeof((a=t._customData)==null?void 0:a._interactable)=="boolean"||Array.isArray((s=t._customData)==null?void 0:s._localRotation)||typeof((u=t._customData)==null?void 0:u._noteJumpMovementSpeed)=="number"||typeof((_=t._customData)==null?void 0:_._noteJumpStartBeatOffset)=="number"||Array.isArray((c=t._customData)==null?void 0:c._position)||Array.isArray((g=t._customData)==null?void 0:g._rotation)||typeof((m=t._customData)==null?void 0:m._track)=="string"},Si=t=>t._cutDirection>=1e3||t._lineIndex>3||t._lineIndex<0||t._lineLayer>2||t._lineLayer<0,Yl=t=>t._cutDirection>=0&&t._cutDirection<=8,Kl=t=>!Si(t)&&Yl(t),Ii=t=>{var n,o,r,i,l,a;const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},bomb:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let s=t.length-1;s>=0;s--)t[s]._type===0?(e.red.total++,(((n=t[s]._customData)==null?void 0:n._color)||((o=t[s]._customData)==null?void 0:o._disableSpawnEffect))&&e.red.chroma++):t[s]._type===1?(e.blue.total++,(((r=t[s]._customData)==null?void 0:r._color)||((i=t[s]._customData)==null?void 0:i._disableSpawnEffect))&&e.blue.chroma++):t[s]._type===3&&(e.bomb.total++,(((l=t[s]._customData)==null?void 0:l._color)||((a=t[s]._customData)==null?void 0:a._disableSpawnEffect))&&e.bomb.chroma++);return e},ln=(t,e)=>t.filter(n=>n._lineIndex===e).length,zl=(t,e)=>t.filter(n=>n._lineLayer===e).length,Wl=(t,e,n)=>t.filter(o=>o._lineIndex===e&&o._lineLayer===n).length,Zl=(t,e)=>t.filter(n=>n._cutDirection===e).length,Ri=(t,e)=>e?t.filter(n=>S(n)).length/e:0,go=(t,e,n)=>{const o=t.filter(S);let r=0,i=0;const l=typeof n=="number"?n:n.value;for(let a=0;a<o.length;a++){for(;o[a]._time-o[i]._time>e;)i++;r=Math.max(r,(a-i+1)/(e/l*60))}return r},Ie=(t,e,n,o)=>{let r,i;if(t===null||e===null)return!1;if(typeof t=="number")r=t;else{if(t._cutDirection===8)return!1;r=H(t)}if(typeof e=="number")i=e;else{if(e._cutDirection===8)return!1;i=H(e)}return o?di(r,i,360)<=n:di(r,i,360)>=n};var bo;(function(t){t.forehand="backhand",t.backhand="forehand"})(bo||(bo={}));const sn={0:{forehand:[1,3,6,7],backhand:[0,2,4,5]},1:{forehand:[1,2,6,7],backhand:[0,3,4,5]}},Mt={0:[0,0,90,90,45,-45,45,-45],1:[0,0,-90,-90,-45,45,-45,45]},Mi={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},Re=class{constructor(t,e,n,o,r,i){this._type=e,this._warningThreshold=n,this._errorThreshold=o,this._allowedRotation=r,i&&i!=="neutral"?(this._state=i,this._rotation=0):(this._state=this.predictStartState(t,e),this._rotation=this.predictStartRotation(t,e)),this._position=this.predictStartPosition(t,e)}get state(){return this._state}get rotation(){return this._rotation}check(t,e){if(this._state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const n=t[0]._time,o=this._type;let r=this._state,i=this._rotation;e.forEach(u=>{u._time-.001>n||(u._lineLayer===0&&u._lineIndex===(o?2:1)&&(r="backhand",i=0),u._lineLayer===2&&u._lineIndex===(o?2:1)&&(r="forehand",i=0))});let l,a=8;for(const u of t)u._cutDirection!==8&&(a=u._cutDirection),l&&a===8&&(a=ki(u,l)),l=u;if(a===8)return"none";const s=Mi[o][bo[r]][a];return(i>s?i-s:s-i)>180||s<Re.CONSTRAINT_ROTATION[o][0]+this._errorThreshold||s>Re.CONSTRAINT_ROTATION[o][1]-this._errorThreshold?"error":s<Re.CONSTRAINT_ROTATION[o][0]+this._warningThreshold||s>Re.CONSTRAINT_ROTATION[o][1]-this._warningThreshold||(i>s?i-s:s-i)>this._allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this._state){case"forehand":{this._state="backhand";break}case"backhand":{this._state="forehand";break}case"neutral":{for(let l=0;l<t.length;l++){const a=t[l];if(sn[a._type].forehand.includes(a._cutDirection)){this._state="backhand";break}if(sn[a._type].backhand.includes(a._cutDirection)){this._state="forehand";break}this._state==="neutral"&&a._cutDirection===8&&(a._lineLayer===0&&(this._state="backhand"),a._lineLayer>0&&(this._state="forehand"))}break}}if(this._state==="neutral")throw new Error("parity unexpected input");const n=t[0]._time,o=this._type;e.forEach(l=>{l._time-.001>n||(l._lineLayer===0&&l._lineIndex===(o?2:1)&&(this._state="forehand",this._rotation=0),l._lineLayer===2&&l._lineIndex===(o?2:1)&&(this._state="backhand",this._rotation=0))});let r,i=8;for(const l of t)l._cutDirection!==8&&(i=l._cutDirection),r&&i===8&&(i=ki(l,r)),r=l;i!==8&&(this._rotation=Mi[this._type][this._state][i])}predictStartState(t,e){let n="neutral";for(let o=0,r=t.length;o<r;o++){let i=t[o];if(i._type!==Math.abs(e-1)&&(i._type===3&&(i._lineLayer===0&&(i._lineIndex===e?1:2)&&(n="backhand"),i._lineLayer===2&&(i._lineIndex===e?1:2)&&(n="forehand")),i._type===e)){if(n!=="neutral")break;const l=i._time;for(let a=o;a<t.length&&!(t[a]._time>i._time+.001&&l<i._time+.001);a++){if(i=t[a],sn[i._type].forehand.includes(i._cutDirection))return"backhand";if(sn[i._type].backhand.includes(i._cutDirection))return"forehand";n==="neutral"&&i._cutDirection===8&&(i._lineLayer===0&&(n="backhand"),i._lineLayer>0&&(n="forehand"))}break}}return n}predictStartRotation(t,e){let n=0;for(let o=0,r=t.length;o<r;o++){let i=t[o];if(i._type===e&&i._type===e){const l=i._time;for(let a=o;a<t.length&&!(t[a]._time>i._time+.001&&l<i._time+.001);a++){if(i=t[a],i._cutDirection!==8)return Mt[i._type][i._cutDirection];i._cutDirection===8&&(i._lineLayer===0&&(i._lineIndex===0&&(n=Mt[i._type][6]),i._lineIndex===3&&(n=Mt[i._type][7])),i._lineLayer===1&&(i._lineIndex===0&&(n=Mt[i._type][2]),i._lineIndex===3&&(n=Mt[i._type][3])),i._lineLayer===2&&(i._lineIndex===0&&(n=Mt[i._type][4]),i._lineIndex===3&&(n=Mt[i._type][5])))}break}}return n}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let yo=Re;yo.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];const Ql=115,ts=t=>{let e=0,n=1;for(let o=0;o<t;o++)n<8&&o===-3+n*4&&(n*=2),e+=Ql*n;return e},M=(t,e,n,o)=>{if(o&&o.length>0&&n.toRealTime(e._time)+.005<n.toRealTime(t._time)&&t._cutDirection!==8){for(const r of o)if(r._cutDirection!==8&&Ie(t,r,90,!1))return!0}if(o&&o.length>0){for(const r of o)if(Math.max(Math.abs(r._lineIndex-t._lineIndex),Math.abs(r._lineLayer-t._lineLayer))<1)return!0}return xi(t,e)&&n.toRealTime(t._time-e._time)>.08||n.toRealTime(t._time-e._time)>.07},Di=(t,e,n)=>n/((t._time-e._time)*2),Bi=(t,e)=>{const n=[],o={},r={0:[],1:[]};for(let i=0,l=t.length;i<l;i++){if(!S(t[i]))continue;const a=Qn(t[i]);o[a._type]&&M(a,o[a._type],e,r[a._type])&&(a._ebpm=Di(a,o[a._type],e.value),n.push(a),r[a._type]=[]),o[a._type]=a,r[a._type].push(a)}return n},Eo=(t,e)=>{const n=[],o={},r={0:[],1:[]};for(let i=0,l=t.length;i<l;i++){if(!S(t[i]))continue;const a=Qn(t[i]);o[a._type]?M(a,o[a._type],e,r[a._type])&&(a._ebpm=Di(a,o[a._type],e.value),n.push(a),o[a._type]=a,r[a._type]=[]):o[a._type]=a,r[a._type].push(a)}return n},es=(t,e)=>Math.max(...Bi(t,e).map(n=>n._ebpm),0),ns=(t,e)=>Math.max(...Eo(t,e).map(n=>n._ebpm),0),Hi=(t,e)=>{let n=!1,o=!1,r=0;const i=e.toRealTime(Math.max(...t.map((l,a)=>a===0?0:((de(t[a],t[a-1])||me(t[a],t[a-1]))&&!n&&(n=!0,r=(t[a]._time-t[a-1]._time)/(pt(t[a],t[a-1])||1)),o=rn(t[a],t[a-1])||ho(t[a],t[a-1])||o,(t[a]._time-t[a-1]._time)/(pt(t[a],t[a-1])||1)))));return n&&o?e.toRealTime(r):i},Ni=(t,e)=>{let n=!1,o=!1,r=Number.MAX_SAFE_INTEGER;const i=e.toRealTime(Math.min(...t.map((l,a)=>a===0?Number.MAX_SAFE_INTEGER:((de(t[a],t[a-1])||me(t[a],t[a-1]))&&!n&&(n=!0,r=(t[a]._time-t[a-1]._time)/(pt(t[a],t[a-1])||1)),o=rn(t[a],t[a-1])||ho(t[a],t[a-1])||o,(t[a]._time-t[a-1]._time)/(pt(t[a],t[a-1])||1)))));return n&&o?e.toRealTime(r):i},cn=(t,e)=>{const n=[],o={},r={0:[],1:[]};for(let i=0,l=t.length;i<l;i++){if(!S(t[i]))continue;const a=Qn(t[i]);if(a._minSpeed=0,a._maxSpeed=Number.MAX_SAFE_INTEGER,o[a._type]){if(M(a,o[a._type],e,r[a._type])){const s=Hi(r[a._type],e),u=Ni(r[a._type],e);s>0&&u!==1/0&&(o[a._type]._minSpeed=s,o[a._type]._maxSpeed=u,n.push(o[a._type])),o[a._type]=a,r[a._type]=[]}}else o[a._type]=a;r[a._type].push(a)}for(let i=0;i<2;i++)if(o[i]){const l=Hi(r[i],e),a=Ni(r[i],e);l>0&&a!==1/0&&(o[i]._minSpeed=l,o[i]._maxSpeed=a,n.push(o[i]))}return n},os=(t,e)=>Math.max(...cn(t,e).map(n=>n._minSpeed),0),rs=(t,e)=>{const n=cn(t,e).map(o=>o._maxSpeed);return n.length?Math.min(...n):0},is=(t,e,n)=>{const o={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let r,i;for(let l=0,a=t.length;l<a;l++){const s=t[l],u=n.toRealTime(s._time);s._type===0&&(r?M(s,r,n)&&o.left[Math.floor(u)]++:o.left[Math.floor(u)]++,r=s),s._type===1&&(i?M(s,i,n)&&o.right[Math.floor(u)]++:o.right[Math.floor(u)]++,i=s)}return o},vo=(t,e)=>{if(!t.length)return 0;if(t.length<e)return t.reduce((r,i)=>r+i)/t.length;let n=t.slice(0,e).reduce((r,i)=>r+i),o=n;for(let r=0;r<t.length-e;r++)n=n-t[r]+t[r+e],o=Math.max(o,n);return o/e},Pi=(t,e)=>{const n=10,o={red:{overall:0,peak:0,median:0,total:0},blue:{overall:0,peak:0,median:0,total:0},total:{overall:0,peak:0,median:0,total:0}},r=Math.max(e.toRealTime(nn(t)-Ti(t)),0),i=Math.max(e.toRealTime(nn(t)),0),l=is(t._notes,i,e),a=l.left.map((c,g)=>c+l.right[g]);if(a.reduce((c,g)=>c+g)===0)return o;const s=[],u=[],_=[];for(let c=0,g=Math.ceil(a.length/n);c<g;c++){const m=c*n;let f=n;f+m>a.length&&(f=a.length-m);const d=l.left.slice(m,m+f),v=l.right.slice(m,m+f),y=a.slice(m,m+f);s.push(d.reduce((E,T)=>E+T)/f),u.push(v.reduce((E,T)=>E+T)/f),_.push(y.reduce((E,T)=>E+T)/f)}return o.red.total=l.left.reduce((c,g)=>c+g),o.red.overall=l.left.reduce((c,g)=>c+g)/r,o.red.peak=vo(l.left,n),o.red.median=Wn(s),o.blue.total=l.right.reduce((c,g)=>c+g),o.blue.overall=l.right.reduce((c,g)=>c+g)/r,o.blue.peak=vo(l.right,n),o.blue.median=Wn(u),o.total.total=o.red.total+o.blue.total,o.total.overall=a.reduce((c,g)=>c+g)/r,o.total.peak=vo(a,n),o.total.median=Wn(_),o},as=(t,e)=>{let n=0,o=0;for(const r of t){const i=r.sps.total.overall;if(o>0&&i>0&&(n=(1-o/i)*100),o=i>0?i:o,o>e&&n>40)return r}return null},ls=(t,e)=>{let n=Number.MAX_SAFE_INTEGER,o=0;for(const r of t){const i=r.sps.total.overall;if(o>0&&i>0&&(n=(1-o/i)*100),o=i>0?i:o,o>e&&n<10)return r}return null},ss=t=>{let e=0,n=Number.MAX_SAFE_INTEGER;return t.forEach(o=>{const r=o.sps.total.overall;r>0&&(e=Math.max(e,r),n=Math.min(n,r))}),e||e&&n?(1-n/e)*100:0},Oi=t=>{let e=Number.MAX_SAFE_INTEGER;return t.forEach(n=>{const o=n.sps.total.overall;o>0&&(e=Math.min(e,o))}),e},Fi={info:[2,0,0],difficulty:[2,5,0]},To=(t,e)=>{const n=cs(t);for(const o in n){if(n[o]<Fi[e][o])return"old";if(n[o]>Fi[e][o])return"new"}return"current"},cs=t=>t.replace("v","").split(".").map(e=>parseInt(e));var ji;(function(t){t[t.BACK_LASERS=0]="BACK_LASERS",t[t.RING_LIGHTS=1]="RING_LIGHTS",t[t.LEFT_LASERS=2]="LEFT_LASERS",t[t.RIGHT_LASERS=3]="RIGHT_LASERS",t[t.CENTER_LIGHTS=4]="CENTER_LIGHTS",t[t.LIGHT_BOOST=5]="LIGHT_BOOST",t[t.EXTRA_LEFT_LIGHTS=6]="EXTRA_LEFT_LIGHTS",t[t.EXTRA_RIGHT_LIGHTS=7]="EXTRA_RIGHT_LIGHTS",t[t.RING_ROTATION=8]="RING_ROTATION",t[t.RING_ZOOM=9]="RING_ZOOM",t[t.EXTRA_LEFT_LASERS=10]="EXTRA_LEFT_LASERS",t[t.EXTRA_RIGHT_LASERS=11]="EXTRA_RIGHT_LASERS",t[t.LEFT_LASER_ROTATION=12]="LEFT_LASER_ROTATION",t[t.RIGHT_LASER_ROTATION=13]="RIGHT_LASER_ROTATION",t[t.EARLY_LANE_ROTATION=14]="EARLY_LANE_ROTATION",t[t.LATE_LANE_ROTATION=15]="LATE_LANE_ROTATION",t[t.UTILITY_EVENT_0=16]="UTILITY_EVENT_0",t[t.UTILITY_EVENT_1=17]="UTILITY_EVENT_1",t[t.UTILITY_EVENT_2=18]="UTILITY_EVENT_2",t[t.UTILITY_EVENT_3=19]="UTILITY_EVENT_3",t[t.SPECIAL_EVENT_0=40]="SPECIAL_EVENT_0",t[t.SPECIAL_EVENT_1=41]="SPECIAL_EVENT_1",t[t.SPECIAL_EVENT_2=42]="SPECIAL_EVENT_2",t[t.SPECIAL_EVENT_3=43]="SPECIAL_EVENT_3",t[t.BPM_CHANGE=100]="BPM_CHANGE"})(ji||(ji={}));const us=t=>(console.log("Parsing info"),t._difficultyBeatmapSets.sort((e,n)=>en[e._beatmapCharacteristicName]-en[n._beatmapCharacteristicName]),t._difficultyBeatmapSets.forEach(e=>{let n=0;e._difficultyBeatmaps.forEach(o=>{o._difficultyRank-n<=0&&console.warn(o._difficulty+" is unordered"),co[o._difficulty]!==o._difficultyRank&&console.error(o._difficulty+" has invalid rank"),n=o._difficultyRank}),e._difficultyBeatmaps.sort((o,r)=>r._difficultyRank-o._difficultyRank)}),t),ms=t=>{var l;const{_notes:e,_obstacles:n,_events:o,_waypoints:r}=t;console.log("Parsing difficulty");let i=!1;return t._version||(console.warn("missing version, applying 2.6.0"),t._version="2.6.0",i=!0),t._sliders=(l=t._sliders)!=null?l:[],e.forEach(a=>{for(const s in a)if(a[s]===null)throw new Error("contain null value in _notes object");if(typeof a._time=="undefined")throw new Error("missing _time in _notes object");if(typeof a._time!="number")throw new Error("invalid type _time in _notes object");if(typeof a._type=="undefined")throw new Error(`missing _type at ${a._time} in _notes object`);if(typeof a._type!="number")throw new Error(`invalid type _type at ${a._time} in _notes object`);if(typeof a._cutDirection=="undefined")throw new Error(`missing _cutDirection at ${a._time} in _notes object`);if(typeof a._cutDirection!="number")throw new Error(`invalid type _cutDirection at ${a._time} in _notes object`);if(typeof a._lineIndex=="undefined")throw new Error(`missing _lineIndex at ${a._time} in _notes object`);if(typeof a._lineIndex!="number")throw new Error(`invalid type _lineIndex at ${a._time} in _notes object`);if(typeof a._lineLayer=="undefined")throw new Error(`missing _lineLayer at ${a._time} in _notes object`);if(typeof a._lineLayer!="number")throw new Error(`invalid type _lineLayer at ${a._time} in _notes object`)}),n.forEach(a=>{for(const s in a)if(a[s]===null)throw new Error("contain null value in _obstacles object");if(typeof a._time=="undefined")throw new Error("missing _time in _obstacles object");if(typeof a._time!="number")throw new Error("invalid type _time in _obstacles object");if(typeof a._type=="undefined")throw new Error(`missing _type at ${a._time} in _obstacles object`);if(typeof a._type!="number")throw new Error(`invalid type _type at ${a._time} in _obstacles object`);if(typeof a._duration=="undefined")throw new Error(`missing _duration at ${a._time} in _obstacles object`);if(typeof a._duration!="number")throw new Error(`invalid type _duration at ${a._time} in _obstacles object`);if(typeof a._lineIndex=="undefined")throw new Error(`missing _lineIndex at ${a._time} in _obstacles object`);if(typeof a._lineIndex!="number")throw new Error(`invalid type _lineIndex at ${a._time} in _obstacles object`);if(typeof a._width=="undefined")throw new Error(`missing _width at ${a._time} in _obstacles object`);if(typeof a._width!="number")throw new Error(`invalid type _width at ${a._time} in _obstacles object`)}),!(i||To(t._version,"difficulty")==="old")&&o.some(a=>typeof a._floatValue=="undefined")&&console.warn("Some events missing _floatValue property, adding with default value of 1"),o.forEach(a=>{for(const s in a)if(a[s]===null)throw new Error("contain null value in _events object");if(typeof a._time=="undefined")throw new Error("missing _time in _events object");if(typeof a._time!="number")throw new Error("invalid type _time in _events object");if(typeof a._type=="undefined")throw new Error(`missing _type at ${a._time} in _events object`);if(typeof a._type!="number")throw new Error(`invalid type _type at ${a._time} in _events object`);if(typeof a._value=="undefined")throw new Error(`missing _value at ${a._time} in _events object`);if(typeof a._value!="number")throw new Error(`invalid type _value at ${a._time} in _events object`);if(i||To(t._version,"difficulty")==="old")a._floatValue=1;else{if(a._floatValue=1,typeof a._floatValue=="undefined")throw new Error(`missing _floatValue at ${a._time} in _events object`);if(typeof a._floatValue!="number")throw new Error(`invalid type _floatValue at ${a._time} in _events object`)}}),r==null||r.forEach(a=>{for(const s in a)if(a[s]===null)throw new Error("contain null value in _waypoints object")}),e.sort((a,s)=>a._time-s._time),n.sort((a,s)=>a._time-s._time),o.sort((a,s)=>a._time-s._time),r==null||r.sort((a,s)=>a._time-s._time),t},un=t=>[t.r,t.g,t.b],mn=t=>{const e=t.toString(16);return e.length===1?"0"+e:e},ds=t=>t>1&&!(t<0)?255:p(t*255),A=t=>{if(!t)return null;const e={r:0,g:0,b:0};for(const n in t){const o=t[n];o!==void 0&&(e[n]=ds(o))}return`#${mn(e.r)}${mn(e.g)}${mn(e.b)}${e.a?mn(e.a):""}`},qi=t=>{let e=t[0],n=t[1],o=t[2],r,i,l;return e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,r=(e*.4124+n*.3576+o*.1805)/.95047,i=(e*.2126+n*.7152+o*.0722)/1,l=(e*.0193+n*.1192+o*.9505)/1.08883,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,[116*i-16,500*(r-i),200*(i-l)]},Gi=(t,e)=>{let n=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(n=0),t<0&&(n=180),t>0&&e<0&&(n=360),zn(Math.atan(e/t))+n)},$o=(t,e)=>{const[n,o,r]=qi(t),[i,l,a]=qi(e),s=1,u=1,_=1;let c,g,m,f,d,v,y,E,T,F,nt,$e,Le,we,Ce,xe,Ae,mt,ot,I;return c=Math.sqrt(o*o+r*r),g=Math.sqrt(l*l+a*a),m=(c+g)/2,d=.5*(1-Math.sqrt((m^7)/((m^7)+(25^7)))),T=(1+d)*o,c=Math.sqrt(T*T+r*r),v=Gi(T,r),T=(1+d)*l,g=Math.sqrt(T*T+a*a),y=Gi(T,a),mt=i-n,ot=g-c,c*g==0?I=0:(T=p(y-v,12),Math.abs(T)<=180?I=y-v:T>180?I=y-v-360:I=y-v+360),I=2*Math.sqrt(c*g)*Math.sin(ce(I/2)),F=(n+i)/2,f=(c+g)/2,c*g==0?E=v+y:(T=Math.abs(p(v-y,12)),T>180?y+v<360?E=v+y+360:E=v+y-360:E=v+y,E/=2),nt=1-.17*Math.cos(ce(E-30))+.24*Math.cos(ce(2*E))+.32*Math.cos(ce(3*E+6))-.2*Math.cos(ce(4*E-63)),Ce=30*Math.exp(-((E-275)/25)*((E-275)/25)),xe=2*Math.sqrt((f^7)/((f^7)+(25^7))),$e=1+.015*((F-50)*(F-50))/Math.sqrt(20+(F-50)*(F-50)),Le=1+.045*f,we=1+.015*f*nt,Ae=-Math.sin(ce(2*Ce))*xe,mt=mt/(s*$e),ot=ot/(u*Le),I=I/(_*we),Math.sqrt(mt*mt+ot*ot+I*I+Ae*ot*I)};var Lo;(function(t){t.tiny="panel--tiny",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t.max="panel--max"})(Lo||(Lo={}));var wo;(function(t){t.none="",t.normal="panel--offset",t.half="panel--offset-half"})(wo||(wo={}));const dn=(t,e,n,o)=>{const r=document.createElement("div");return r.className=`panel ${Lo[t]}`,e&&e!=="none"&&r.classList.add(wo[e]),n&&r.classList.add("panel--flex"+o?"-column":""),r},b={},Ui=()=>{for(const t in b)delete b[t]},x="UI Info: ",_n=document.querySelector(".info__level-author"),pn=document.querySelector(".info__environment"),Me=document.querySelector(".info__editors"),De=document.querySelector(".info__contributors"),Be=document.querySelector(".info__contributors-select"),Ji=document.querySelector(".info__contributors-image"),Co=document.querySelector(".info__contributors-name"),xo=document.querySelector(".info__contributors-role"),hn=document.querySelector(".info__version"),fn=document.querySelector(".info__time-spend"),gn=document.querySelector(".info__custom-color"),bn=document.querySelector(".info__requirements"),yn=document.querySelector(".info__suggestions"),En=document.querySelector(".info__information"),vn=document.querySelector(".info__warnings"),Tn=document.querySelector(".info__bookmarks"),$n=document.querySelector(".info__bpm-changes"),Ln=document.querySelector(".info__environment-enhancement"),wn=document.querySelector(".info__point-definitions"),Cn=document.querySelector(".info__custom-events");(!_n||!pn||!Me)&&console.error(x+"info component is missing part");(!De||!Co||!xo)&&console.error(x+"contributors component is missing part");Be?Be.addEventListener("change",gs):console.error(x+"contributors select is missing");(!hn||!fn||!gn||!bn||!yn||!En||!vn||!Tn||!$n||!Ln||!wn||!Cn)&&console.error(x+"table info component is missing part");const Vi=t=>{if(!_n){console.error(x+"missing HTML element for level author");return}if(!t){_n.textContent="";return}_n.textContent="Mapped by "+t},Xi=t=>{if(!pn){console.error(x+"missing HTML element for environment");return}if(!t){pn.textContent="";return}pn.textContent=(Cl[t]||"Unknown")+" Environment"},Yi=t=>{if(!Me){console.error(x+"missing HTML element for editor");return}if(!t||!t._lastEditedBy){Me.classList.add("hidden");return}Me.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let n="Last edited on "+e;if(t[e]){const o=t[e];n+=" v"+o.version}Me.textContent=n},_s=t=>{if(!Ji){console.error(x+"missing HTML element for contributor image");return}Ji.src=t||"./img/unknown.jpg"},ps=t=>{if(!Co){console.error(x+"missing HTML element for contributor name");return}Co.textContent=t},hs=t=>{if(!xo){console.error(x+"missing HTML element for contributor role");return}xo.textContent=t},Ki=t=>{_s(t._base64?"data:image;base64,"+t._base64:null),ps(t._name),hs(t._role)},zi=t=>{if(!De||!Be){console.error(x+"missing HTML element for contributor");return}if(De&&(!t||!t.length)){De.classList.add("hidden"),Zn(Be);return}if(t){De.classList.remove("hidden");let e=!0;t.forEach((n,o)=>{e&&(e=!1,Ki(n));const r=document.createElement("option");r.value=o.toString(),r.text=n._name+" -- "+n._role,Be.add(r)})}},q=t=>{const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")},G=(t,e)=>{const n=t.querySelector(".info__table-element");if(n){for(;n.firstChild;)n.removeChild(n.firstChild);typeof e=="string"?n.textContent=e:(e.forEach(o=>{if(typeof o=="string"){let r=document.createElement("span");r.textContent=o,n.appendChild(r),n.appendChild(document.createElement("br"))}else n.appendChild(o),n.appendChild(document.createElement("br"))}),n.lastChild&&n.removeChild(n.lastChild))}t.classList.remove("hidden")},Wi=t=>{if(!hn){console.error(x+"missing table row for time spend");return}if(t==null){q(hn);return}G(hn,t)},Zi=t=>{if(!fn){console.error(x+"missing table row for time spend");return}if(t==null){q(fn);return}G(fn,_l(t))},Qi=(t,e)=>{var s,u,_,c,g,m,f,d,v;if(!gn){console.error(x+"missing table row for custom colors");return}if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._obstacleColor){q(gn);return}e||(e="DefaultEnvironment");let n={_colorLeft:A((s=D[B[e]])==null?void 0:s._colorLeft)||null,_colorRight:A((u=D[B[e]])==null?void 0:u._colorRight)||null,_envColorLeft:A((_=D[B[e]])==null?void 0:_._envColorLeft)||null,_envColorRight:A((c=D[B[e]])==null?void 0:c._envColorRight)||null,_envColorLeftBoost:A((g=D[B[e]])==null?void 0:g._envColorLeftBoost)||null,_envColorRightBoost:A((m=D[B[e]])==null?void 0:m._envColorRightBoost)||null,_obstacleColor:A((f=D[B[e]])==null?void 0:f._obstacleColor)||null};t._colorLeft&&(n._colorLeft=A(t._colorLeft)),t._colorRight&&(n._colorRight=A(t._colorRight)),t._envColorLeft?n._envColorLeft=A(t._envColorLeft):t._colorLeft&&(n._envColorLeft=A(t._colorLeft)),t._envColorRight?n._envColorRight=A(t._envColorRight):t._colorRight&&(n._envColorRight=A(t._colorRight));let o,r,i=!1;t._envColorLeftBoost?(o=A(t._envColorLeftBoost),i=!0):o=A((d=D[B[e]])==null?void 0:d._envColorLeftBoost)||n._envColorLeft,t._envColorRightBoost?(r=A(t._envColorRightBoost),i=!0):r=A((v=D[B[e]])==null?void 0:v._envColorRightBoost)||n._envColorRight,i&&(n._envColorLeftBoost=o,n._envColorRightBoost=r),t._obstacleColor&&(n._obstacleColor=A(t._obstacleColor));const l=dn("max","none",!0);for(const y in n){if(!n[y])continue;const E=document.createElement("div"),T=document.createElement("div"),F=document.createElement("div"),nt=document.createElement("div");T.className="info__color-dot",T.style.backgroundColor=n[y]||"#000000",F.className="info__color-text info__color-text--monospace",F.textContent=`${n[y]}`,nt.className="info__color-text",nt.textContent=` -- ${wl[y]}`,E.appendChild(T),E.appendChild(F),E.appendChild(nt),l.appendChild(E)}G(gn,[l])},ta=t=>{if(!bn){console.error(x+"missing table row for requirements");return}if(t==null||!t.length){q(bn);return}G(bn,t.join(", "))},ea=t=>{if(!yn){console.error(x+"missing table row for suggestions");return}if(t==null||!t.length){q(yn);return}G(yn,t.join(", "))},na=t=>{if(!En){console.error(x+"missing table row for information");return}if(t==null||!t.length){q(En);return}G(En,t)},oa=t=>{if(!vn){console.error(x+"missing table row for warnings");return}if(t==null||!t.length){q(vn);return}G(vn,t)},ra=(t,e)=>{if(!Tn){console.error(x+"missing table row for bookmarks");return}if(t==null||!t.length){q(Tn);return}const n=t.map(o=>{let r=o._time,i;return e&&(r=e.adjustTime(r),i=e.toRealTime(r)),`${p(o._time,3)}${i?" | "+j(i):""} -- ${o._name!==""?o._name:"**EMPTY NAME**"}`});G(Tn,n)},ia=t=>{if(!$n){console.error(x+"missing table row for bookmarks");return}if(!t||!t.change.length){q($n);return}const e=t.change.map(n=>{let o=p(n._newTime,3),r=t.toRealTime(n._time);return`${o} | ${j(r)} -- ${n._BPM}`});G($n,e)},aa=t=>{if(!Ln){console.error(x+"missing table row for environment enhancement");return}if(t==null||!t.length){q(Ln);return}const e=t.map(n=>{let o=[];for(const r in n){if(r=="_lookupMethod"||r=="_id")continue;let i=uo[r];n[r]!=null&&o.push(i)}return`${n._lookupMethod} [${o.join("")}]${n._track?`(${n._track})`:""} -> ${n._id}`});G(Ln,e)},la=t=>{if(!wn){console.error(x+"missing table row for point definitions");return}if(t==null||!t.length){q(wn);return}const e=t.map(n=>`${n._name} -- ${n._points.length} point${n._points.length>1?"s":""}`);G(wn,e)},sa=(t,e)=>{if(!Cn){console.error(x+"missing table row for custom events");return}if(t==null||!t.length){q(Cn);return}const n=t.map(o=>{let r=o._time,i;e&&(r=e.adjustTime(r),i=e.toRealTime(r));let l=[];for(const a in o._data)a=="_duration"||a=="_easing"||a=="_track"||o._data[a]!=null&&l.push(a);return`${p(o._time,3)}${i?" | "+j(i):""} -- ${o._type} -> [${l.join("")}]${o._type!=="AssignTrackParent"?`(${o._data._track})`:""}`});G(Cn,n)},fs=t=>{var e;gl(t._songName),bl(t._songSubName),yl(t._songAuthorName),El(t._beatsPerMinute),Vi(t._levelAuthorName),Xi(t._environmentName),Yi((e=t._customData)==null?void 0:e._editors)},ca=t=>{var e,n,o;if(Wi(t._data._version),((e=t._info)==null?void 0:e._customData)&&(Qi(t._info._customData),ta(t._info._customData._requirements),ea(t._info._customData._suggestions),na(t._info._customData._information),oa(t._info._customData._warnings)),(n=t._data)==null?void 0:n._customData){const r=((o=b._mapInfo)==null?void 0:o._beatsPerMinute)?rt(b._mapInfo._beatsPerMinute,t._data._customData._bpmChanges||t._data._customData._BPMChanges):null;Zi(t._data._customData._time),ra(t._data._customData._bookmarks,r),ia(r),aa(t._data._customData._environment),la(t._data._customData._pointDefinitions),sa(t._data._customData._customEvents,r)}};function gs(t){if(!b._contributors){console.error(x+"no saved data for contributors");return}const e=t.target;Ki(b._contributors[parseInt(e.value)])}const bs=()=>{Vi(),Xi(),Yi(),zi(),Wi(),Zi(),Qi(),ta(),ea(),na(),oa(),ra(),ia(),aa(),la(),sa()},ys="UI Input: ",at=t=>{const e=document.querySelectorAll(".input-toggle");if(!e.length){console.error(ys+"empty list, intentional or typo error?");return}e.forEach(n=>{n.disabled=t})},ua="UI Loading: ",Dt=document.querySelector(".loading__bar"),ma="loading__bar--error",da="loading__bar--download",Ao=document.querySelector(".loading__text");(!Dt||!Ao)&&console.error(ua+"loading component is missing part");const L=(t,e,n=100)=>{if(!Dt||!Ao){console.error(ua+"could not process, missing HTML element");return}Ao.textContent=e,Dt.style.width=`${n}%`,t==="error"?Dt.classList.add(ma):Dt.classList.remove(ma),t==="download"?Dt.classList.add(da):Dt.classList.remove(da)},Es=()=>{L("info","No map loaded",0)};var xn={loading:!1,map:{load:{image:!1,audio:!1}}},_a;(function(t){t.audio="Audio",t.imageCover="Cover Image",t.imageContributor="Contributor Image"})(_a||(_a={}));var pa;(function(t){t.info="Information",t.tools="Tools",t.stats="Stats",t.settings="Settings"})(pa||(pa={}));const ha={_load:{audio:!0,imageCover:!0,imageContributor:!0},_sorting:!0,_beatNumbering:"beattime",_rounding:3,_theme:"Dark",_onLoad:{stats:!1},_show:{info:!1,tools:!1,stats:!1,settings:!1}};class vs{constructor(){this._property=JSON.parse(JSON.stringify(ha)),this.stringify=()=>JSON.stringify({_property:this._property}),this.init=()=>{var n;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const o=JSON.parse(e);this._property=(n=o._property)!=null?n:this._property,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this._property=JSON.parse(JSON.stringify(ha))},this.init()}get load(){return this._property._load}get sorting(){return this._property._sorting}set sorting(e){this._property._sorting=e}get beatNumbering(){return this._property._beatNumbering}set beatNumbering(e){this._property._beatNumbering=e}get rounding(){return this._property._rounding}set rounding(e){this._property._rounding=e}get theme(){return this._property._theme}set theme(e){this._property._theme=e}get onLoad(){return this._property._onLoad}get show(){return this._property._show}}var C=new vs;const ko={name:"Cover Image",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:Ts};function Ts(){const t=new Image,e=fl(),n=[];if(xn.map.load.image&&e!==null?(t.src=e,t.width!==t.height&&n.push("<b>Cover image is not square:</b> resize to fit square"),(t.width<256||t.height<256)&&n.push("<b>Cover image is too small:</b> require at least 256x256")):n.push("<b>No cover image:</b> "+(C.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),n.length){const o=document.createElement("div");o.innerHTML=n.join("<br>"),ko.output.html=o}else ko.output.html=null}const An={name:"Preview Time",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:$s};function $s(t){const{_audioDuration:e}=t,n=document.createElement("div");e&&e<20?(n.innerHTML=`<b>Unrankable audio length:</b> too short (${j(e)}s)`,An.output.html=n):xn.map.load.audio?An.output.html=null:(n.innerHTML=`<b>No audio:</b> ${C.load.audio?"could not be loaded or not found":"no audio mode is enabled"}`,An.output.html=n)}const So={name:"Preview Time",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:Ls};function Ls(t,e,n){if(!n)throw new Error("something went wrong!");const{_previewStartTime:o,_previewDuration:r}=n;if(o===12&&r===10){const i=document.createElement("div");i.innerHTML="<b>Default preview time:</b> strongly recommended to set for audience's 1st impression",So.output.html=i}else So.output.html=null}const He={name:"Progression",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:ws};function ws(t,e,n,o){const{_audioDuration:r}=t;if(!r){He.output.html=null;return}if(!o)throw new Error("no sps");const i=o.filter(_=>_.mode==="Standard").sort((_,c)=>_.sps.total.overall-c.sps.total.overall);if(!i.length){He.output.html=null;return}const l=r<120?3.2:r<240?4.2:5.2,a=[];r<240&&Oi(i)>l&&ss(i)<60&&a.push(`<b>Minimum SPS not met (<${l}):</b> lowest is ${p(Oi(i),2)}`);const s=as(i,l),u=ls(i,l);if(s&&r<360&&a.push(`<b>Violates progression:</b> ${s.difficulty} exceeded 40% SPS drop`),u&&r<360&&a.push(`<b>Violates progression:</b> ${u.difficulty} has less than 10% SPS drop`),a.length){const _=document.createElement("div");_.innerHTML=a.join("<br>"),He.output.html=_}else He.output.html=null}var fa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",coverImage:ko,audio:An,previewTime:So,progression:He});const Io=450,Ro=350,Ne=document.createElement("div"),ht=document.createElement("input"),Mo=document.createElement("label"),ft=document.createElement("input"),Do=document.createElement("label");Mo.textContent="Effective BPM threshold: ";Mo.htmlFor="input__tools-ebpm";ht.id="input__tools-ebpm";ht.className="input-toggle input--small";ht.type="number";ht.min="0";ht.value=Io.toString();ht.addEventListener("change",xs);Do.textContent=" (swing): ";Do.htmlFor="input__tools-ebpms";ft.id="input__tools-ebpms";ft.className="input-toggle input--small";ft.type="number";ft.min="0";ft.value=Ro.toString();ft.addEventListener("change",As);Ne.appendChild(Mo);Ne.appendChild(ht);Ne.appendChild(Do);Ne.appendChild(ft);const N={name:"Effective BPM",description:"Placeholder",type:"note",order:{input:0,output:100},input:{enabled:!0,params:{ebpmThres:Io,ebpmsThres:Ro},html:Ne,adjustTime:Cs},output:{html:null},run:Ss};function Cs(t){N.input.params.ebpmThres=p(Math.min(Io,t.value*2*1.285714),1),N.input.params.ebpmsThres=p(Math.min(Ro,t.value*2),1),ht.value=N.input.params.ebpmThres.toString(),ft.value=N.input.params.ebpmsThres.toString()}function xs(){N.input.params.ebpmThres=p(Math.abs(parseFloat(this.value)),1),this.value=N.input.params.ebpmThres.toString()}function As(){N.input.params.ebpmsThres=p(Math.abs(parseFloat(this.value)),1),this.value=N.input.params.ebpmsThres.toString()}function ks(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{ebpmThres:r,ebpmsThres:i}=N.input.params,l=Bi(o,n).filter(s=>s._ebpm>r).map(s=>s._time),a=Eo(o,n).filter(s=>s._ebpm>i).map(s=>s._time);return{base:l,swing:a}}function Ss(t,e){if(!e)throw new Error("something went wrong!");const n=ks(t,e),{ebpmThres:o,ebpmsThres:r}=N.input.params,i=[];if(n.base.length&&i.push(`<b>>${o}EBPM warning [${n.base.length}]:</b> ${n.base.map(l=>p(t._bpm.adjustTime(l),3)).join(", ")}`),n.swing.length&&i.push(`<b>>${r}EBPM (swing) warning [${n.swing.length}]:</b> ${n.swing.map(l=>p(t._bpm.adjustTime(l),3)).join(", ")}`),i.length){const l=document.createElement("div");l.innerHTML=i.join("<br>"),N.output.html=l}else N.output.html=null}const ga=[8,6],Bo=document.createElement("div"),_e=document.createElement("input"),Ho=document.createElement("label");Ho.textContent="Acceptable beat precision: ";Ho.htmlFor="input__tools-prec";_e.id="input__tools-prec";_e.className="input-toggle input--small";_e.type="text";_e.value=ga.join(" ");_e.addEventListener("change",Is);Bo.appendChild(Ho);Bo.appendChild(_e);const pe={name:"Acceptable Beat Precision",description:"Placeholder",type:"note",order:{input:10,output:110},input:{enabled:!0,params:{prec:[...ga]},html:Bo},output:{html:null},run:Ms};function Is(){pe.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=pe.input.params.prec.join(" ")}function Rs(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{prec:r}=pe.input.params;return Eo(o,n).map(i=>i._time).filter((i,l,a)=>!l||i!==a[l-1]).filter(i=>{if(!r.length)return!1;for(let l=0;l<r.length;l++)if((n.adjustTime(i)+.001)%(1/r[l])<.01)return!1;return!0})}function Ms(t,e){if(!e)throw new Error("something went wrong!");const n=Rs(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Off-beat precision [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,pe.output.html=o}else pe.output.html=null}const No=document.createElement("div"),Bt=document.createElement("input"),Po=document.createElement("label");Po.textContent=" Varying swing speed";Po.htmlFor="input__tools-vary-swing-check";Bt.id="input__tools-vary-swing-check";Bt.className="input-toggle";Bt.type="checkbox";Bt.checked=!0;Bt.addEventListener("change",Ds);No.appendChild(Bt);No.appendChild(Po);const kn={name:"Varying Swing Speed",description:"Placeholder",type:"note",order:{input:20,output:130},input:{enabled:Bt.checked,params:{},html:No},output:{html:null},run:Hs};function Ds(){kn.input.enabled=this.checked}function Bs(t,e){const{_bpm:n}=t,{_notes:o}=e._data;return cn(o,n).filter(r=>Math.abs(r._minSpeed-r._maxSpeed)>.002).map(r=>r._time).filter((r,i,l)=>!i||r!==l[i-1])}function Hs(t,e){if(!e)throw new Error("something went wrong!");const n=Bs(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Varying swing speed [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,kn.output.html=o}else kn.output.html=null}const ba=.025,gt=document.createElement("div"),Ht=document.createElement("input"),Oo=document.createElement("label"),bt=document.createElement("input"),Fo=document.createElement("label"),yt=document.createElement("input"),jo=document.createElement("label");let he;Oo.textContent=" Slow slider";Oo.htmlFor="input__tools-slow-slider-check";Ht.id="input__tools-slow-slider-check";Ht.className="input-toggle";Ht.type="checkbox";Ht.checked=!0;Ht.addEventListener("change",Ps);Fo.textContent="min speed (ms): ";Fo.htmlFor="input__tools-slow-slider-time";bt.id="input__tools-slow-slider-time";bt.className="input-toggle input--small";bt.type="number";bt.min="0";bt.value=p(ba*1e3,1).toString();bt.addEventListener("change",Os);jo.textContent=" (prec): ";jo.htmlFor="input__tools-slow-slider-prec";yt.id="input__tools-slow-slider-prec";yt.className="input-toggle input--small";yt.type="number";yt.min="0";yt.addEventListener("change",Fs);gt.appendChild(Ht);gt.appendChild(Oo);gt.appendChild(document.createElement("br"));gt.appendChild(Fo);gt.appendChild(bt);gt.appendChild(jo);gt.appendChild(yt);const U={name:"Slow Slider",description:"Placeholder",type:"note",order:{input:21,output:120},input:{enabled:Ht.checked,params:{minSpeed:ba},html:gt,adjustTime:Ns},output:{html:null},run:qs};function Ns(t){he=t,yt.value=p(1/he.toBeatTime(U.input.params.minSpeed),2).toString()}function Ps(){U.input.enabled=this.checked}function Os(){U.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=p(U.input.params.minSpeed*1e3,1).toString(),he&&(yt.value=p(1/he.toBeatTime(U.input.params.minSpeed),2).toString())}function Fs(){if(!he){this.value="0";return}let t=p(Math.abs(parseFloat(this.value)),2)||1;U.input.params.minSpeed=he.toRealTime(1/t),bt.value=p(U.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}function js(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{minSpeed:r}=U.input.params;return cn(o,n).filter(i=>i._maxSpeed>r||i._minSpeed>r).map(i=>i._time).filter((i,l,a)=>!l||i!==a[l-1])}function qs(t,e){if(!e)throw new Error("something went wrong!");const{minSpeed:n}=U.input.params,o=js(t,e);if(o.length){const r=document.createElement("div");r.innerHTML=`<b>Slow slider (>${p(n*1e3,1)}ms) [${o.length}]:</b> ${o.map(i=>p(t._bpm.adjustTime(i),3)).join(", ")}`,U.output.html=r}else U.output.html=null}const ya=.15;let fe;const Et=document.createElement("div"),Nt=document.createElement("input"),qo=document.createElement("label"),vt=document.createElement("input"),Go=document.createElement("label"),lt=document.createElement("input"),Uo=document.createElement("label");qo.textContent=" Inline sharp angle";qo.htmlFor="input__tools-inline-angle-check";Nt.id="input__tools-inline-angle-check";Nt.className="input-toggle";Nt.type="checkbox";Nt.checked=!0;Nt.addEventListener("change",Us);Go.textContent="max time (ms): ";Go.htmlFor="input__tools-inline-angle-time";vt.id="input__tools-inline-angle-time";vt.className="input-toggle input--small";vt.type="number";vt.min="0";vt.value=p(ya*1e3,1).toString();vt.addEventListener("change",Js);Uo.textContent=" (beat): ";Uo.htmlFor="input__tools-inline-angle-beat";lt.id="input__tools-inline-angle-beat";lt.className="input-toggle input--small";lt.type="number";lt.min="0";lt.step="0.1";lt.addEventListener("change",Vs);Et.appendChild(Nt);Et.appendChild(qo);Et.appendChild(document.createElement("br"));Et.appendChild(Go);Et.appendChild(vt);Et.appendChild(Uo);Et.appendChild(lt);const X={name:"Inline Sharp Angle",description:"Placeholder",type:"note",order:{input:30,output:160},input:{enabled:Nt.checked,params:{maxTime:ya},html:Et,adjustTime:Gs},output:{html:null},run:Ys};function Gs(t){fe=t,lt.value=p(fe.toBeatTime(X.input.params.maxTime),2).toString()}function Us(){X.input.enabled=this.checked}function Js(){X.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=p(X.input.params.maxTime*1e3,1).toString(),fe&&(lt.value=p(fe.toBeatTime(X.input.params.maxTime),2).toString())}function Vs(){if(!fe){this.value="0";return}let t=p(Math.abs(parseFloat(this.value)),2)||1;X.input.params.maxTime=fe.toRealTime(t),vt.value=p(X.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Xs(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:r}=X.input.params,i=n.toBeatTime(r)+.001,l={},a={},s={},u={0:[],1:[],3:[]},_=[];let c=0,g=0;for(let m=0,f=o.length;m<f;m++){const d=o[m];S(d)&&l[d._type]?M(d,l[d._type],n,u[d._type])?(s[d._type]&&(s[d._type]=null,a[d._type]=(a[d._type]+180)%360),Ea(d,o,g,i)&&Ie(d,a[d._type],90,!0)&&_.push(d),d._cutDirection===8?s[d._type]=d:a[d._type]=H(d),u[d._type]=[]):(s[d._type]&&Ea(d,o,g,i)&&Ie(d,a[d._type],90,!0)&&(_.push(s[d._type]),s[d._type]=null),d._cutDirection!==8&&(a[d._type]=H(d))):a[d._type]=H(d),c<d._time-i&&(c=d._time-i,g=m),l[d._type]=d,u[d._type].push(d),d._type===3&&(d._lineLayer===0&&(d._lineIndex===1&&(a[0]=it[0],s[0]=null),d._lineIndex===2&&(a[1]=it[0],s[1]=null)),d._lineLayer===2&&(d._lineIndex===1&&(a[0]=it[1],s[0]=null),d._lineIndex===2&&(a[1]=it[1],s[1]=null)))}return _.map(m=>m._time).filter(function(m,f,d){return!f||m!==d[f-1]})}function Ea(t,e,n,o){for(let r=n;e[r]._time<t._time;r++)if(an(t,e[r])&&t._time-e[r]._time<=o)return!0;return!1}function Ys(t,e){if(!e)throw new Error("something went wrong!");const n=Xs(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Inline sharp angle [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,X.output.html=o}else X.output.html=null}const va=.15,Ta=1;let ge;const Y=document.createElement("div"),Pt=document.createElement("input"),Jo=document.createElement("label"),Ot=document.createElement("input"),Vo=document.createElement("label"),Tt=document.createElement("input"),Xo=document.createElement("label"),st=document.createElement("input"),Yo=document.createElement("label");Jo.textContent=" shrado angle";Jo.htmlFor="input__tools-shrado-angle-check";Pt.id="input__tools-shrado-angle-check";Pt.className="input-toggle";Pt.type="checkbox";Pt.checked=!1;Pt.addEventListener("change",zs);Vo.textContent="min distance: ";Vo.htmlFor="input__tools-shrado-angle-distance";Ot.id="input__tools-shrado-angle-distance";Ot.className="input-toggle input--small";Ot.type="number";Ot.min="0";Ot.value=Ta.toString();Ot.addEventListener("change",Ws);Xo.textContent="max time (ms): ";Xo.htmlFor="input__tools-shrado-angle-time";Tt.id="input__tools-shrado-angle-time";Tt.className="input-toggle input--small";Tt.type="number";Tt.min="0";Tt.value=p(va*1e3,1).toString();Tt.addEventListener("change",Zs);Yo.textContent=" (beat): ";Yo.htmlFor="input__tools-shrado-angle-beat";st.id="input__tools-shrado-angle-beat";st.className="input-toggle input--small";st.type="number";st.min="0";st.step="0.1";st.addEventListener("change",Qs);Y.appendChild(Pt);Y.appendChild(Jo);Y.appendChild(document.createElement("br"));Y.appendChild(Vo);Y.appendChild(Ot);Y.appendChild(document.createElement("br"));Y.appendChild(Xo);Y.appendChild(Tt);Y.appendChild(Yo);Y.appendChild(st);const P={name:"shrado Angle",description:"Placeholder",type:"note",order:{input:40,output:170},input:{enabled:Pt.checked,params:{distance:Ta,maxTime:va},html:Y,adjustTime:Ks},output:{html:null},run:ec};function Ks(t){ge=t,st.value=p(ge.toBeatTime(P.input.params.maxTime),2).toString()}function zs(){P.input.enabled=this.checked}function Ws(){P.input.params.distance=Math.max(parseInt(this.value),0),this.value=P.input.params.distance.toString()}function Zs(){P.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=p(P.input.params.maxTime*1e3,1).toString(),ge&&(st.value=p(ge.toBeatTime(P.input.params.maxTime),2).toString())}function Qs(){if(!ge){this.value="0";return}let t=p(Math.abs(parseFloat(this.value)),2)||1;P.input.params.maxTime=ge.toRealTime(t),Tt.value=p(P.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function tc(t,e){var g;const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:r,distance:i}=P.input.params,l=n.toBeatTime(r)+.001,a={},s={},u={},_={0:[],1:[],3:[]},c=[];for(let m=0,f=o.length;m<f;m++){const d=o[m];S(d)&&a[d._type]?M(d,a[d._type],n,_[d._type])?(u[d._type]&&(u[d._type]=null,s[d._type]=(g=Ul[s[d._type]])!=null?g:8),pt(d,a[d._type])>=i&&$a(d._cutDirection,s[d._type],d._type)&&d._time-a[d._type]._time<=l&&c.push(d),d._cutDirection===8?u[d._type]=d:s[d._type]=d._cutDirection,_[d._type]=[]):(u[d._type]&&pt(d,a[d._type])>=i&&$a(d._cutDirection,s[d._type],d._type)&&d._time-a[d._type]._time<=l&&(c.push(u[d._type]),u[d._type]=null),d._cutDirection!==8&&(s[d._type]=d._cutDirection)):s[d._type]=d._cutDirection,a[d._type]=d,_[d._type].push(d)}return c.map(m=>m._time).filter(function(m,f,d){return!f||m!==d[f-1]})}function $a(t,e,n){return t===8||e===8?!1:(n===0?e===7:e===6)&&t===0}function ec(t,e){if(!e)throw new Error("something went wrong!");const n=tc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>shrado angle [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,P.output.html=o}else P.output.html=null}const La=.075,$t=document.createElement("div"),Ft=document.createElement("input"),Ko=document.createElement("label"),Lt=document.createElement("input"),zo=document.createElement("label"),wt=document.createElement("input"),Wo=document.createElement("label");let be;Ko.textContent=" Speed pause (EXPERIMENTAL)";Ko.htmlFor="input__tools-speed-pause-check";Ft.id="input__tools-speed-pause-check";Ft.className="input-toggle";Ft.type="checkbox";Ft.checked=!1;Ft.addEventListener("change",oc);zo.textContent="stream speed (ms): ";zo.htmlFor="input__tools-speed-pause-time";Lt.id="input__tools-speed-pause-time";Lt.className="input-toggle input--small";Lt.type="number";Lt.min="0";Lt.value=p(La*1e3,1).toString();Lt.addEventListener("change",rc);Wo.textContent=" (prec): ";Wo.htmlFor="input__tools-speed-pause-prec";wt.id="input__tools-speed-pause-prec";wt.className="input-toggle input--small";wt.type="number";wt.min="0";wt.addEventListener("change",ic);$t.appendChild(Ft);$t.appendChild(Ko);$t.appendChild(document.createElement("br"));$t.appendChild(zo);$t.appendChild(Lt);$t.appendChild(Wo);$t.appendChild(wt);const K={name:"Speed Pause",description:"Placeholder",type:"note",order:{input:50,output:180},input:{enabled:Ft.checked,params:{maxTime:La},html:$t,adjustTime:nc},output:{html:null},run:lc};function nc(t){be=t,wt.value=p(1/be.toBeatTime(K.input.params.maxTime),2).toString()}function oc(){K.input.enabled=this.checked}function rc(){K.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=p(K.input.params.maxTime*1e3,1).toString(),be&&(wt.value=p(1/be.toBeatTime(K.input.params.maxTime),2).toString())}function ic(){if(!be){this.value="0";return}let t=p(Math.abs(parseFloat(this.value)),2)||1;K.input.params.maxTime=be.toRealTime(1/t),Lt.value=p(K.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function ac(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:r}=K.input.params,i=n.toBeatTime(r)+.001,l={},a={},s={0:!1,1:!1,3:!1},u={0:[],1:[],3:[]},_=[];for(let c=0,g=o.length;c<g;c++){const m=o[c];S(m)&&l[m._type]?M(m,l[m._type],n,u[m._type])&&(m._time-l[m._type]._time<=i*2?(s[0]&&s[1]&&l[m._type]._time-a[m._type]._time<=i*3&&_.push(l[m._type]),s[m._type]=!1):s[m._type]||(s[m._type]=!0,a[m._type]=l[m._type]),u[m._type]=[],l[m._type]=m):l[m._type]=m,u[m._type].push(m)}return _.map(c=>c._time).filter(function(c,g,m){return!g||c!==m[g-1]})}function lc(t,e){if(!e)throw new Error("something went wrong!");const n=ac(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Speed pause [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,K.output.html=o}else K.output.html=null}const Zo=document.createElement("div"),jt=document.createElement("input"),Qo=document.createElement("label");Qo.textContent=" Hitbox staircase";Qo.htmlFor="input__tools-hitbox-stair-check";jt.id="input__tools-hitbox-stair-check";jt.className="input-toggle";jt.type="checkbox";jt.checked=!0;jt.addEventListener("change",sc);Zo.appendChild(jt);Zo.appendChild(Qo);const Sn={name:"Hitbox Staircase",description:"Placeholder",type:"note",order:{input:70,output:190},input:{enabled:jt.checked,params:{},html:Zo},output:{html:null},run:uc};function sc(){Sn.input.enabled=this.checked}function cc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,r=n.toBeatTime(.15),i={},l={},a={},s={0:[],1:[],3:[]},u={0:{_time:0,_type:0,_cutDirection:0,_lineIndex:0,_lineLayer:0},1:{_time:0,_type:1,_cutDirection:0,_lineIndex:0,_lineLayer:0},3:{_time:0,_type:3,_cutDirection:0,_lineIndex:0,_lineLayer:0}},_=[];for(let c=0,g=o.length;c<g;c++){const m=o[c];S(m)&&i[m._type]?(M(m,i[m._type],n,s[m._type])?(a[m._type]=m._time-i[m._type]._time,m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+_t[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+_t[m._cutDirection][1]):(u[m._type]._lineIndex=-1,u[m._type]._lineLayer=-1),s[m._type]=[],l[m._type]=m._cutDirection):Ai(m,i[m._type],l[m._type])&&(m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+_t[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+_t[m._cutDirection][1],l[m._type]=m._cutDirection):(u[m._type]._lineIndex=m._lineIndex+_t[l[m._type]][0],u[m._type]._lineLayer=m._lineLayer+_t[l[m._type]][1])),i[(m._type+1)%2]&&m._time-i[(m._type+1)%2]._time!=0&&m._time-i[(m._type+1)%2]._time<Math.min(r,a[(m._type+1)%2])&&m._lineIndex===u[(m._type+1)%2]._lineIndex&&m._lineLayer===u[(m._type+1)%2]._lineLayer&&!Vl(m,o,c)&&_.push(m)):(m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+_t[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+_t[m._cutDirection][1]):(u[m._type]._lineIndex=-1,u[m._type]._lineLayer=-1),l[m._type]=m._cutDirection),i[m._type]=m,s[m._type].push(m)}return _.map(c=>c._time).filter(function(c,g,m){return!g||c!==m[g-1]})}function uc(t,e){if(!e)throw new Error("something went wrong!");const n=cc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox staircase [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,Sn.output.html=o}else Sn.output.html=null}const tr=document.createElement("div"),qt=document.createElement("input"),er=document.createElement("label");er.textContent=" Hitbox reverse staircase";er.htmlFor="input__tools-hitbox-rstair-check";qt.id="input__tools-hitbox-rstair-check";qt.className="input-toggle";qt.type="checkbox";qt.checked=!0;qt.addEventListener("change",mc);tr.appendChild(qt);tr.appendChild(er);const In={name:"Hitbox Reverse Staircase",description:"Placeholder",type:"note",order:{input:71,output:191},input:{enabled:qt.checked,params:{},html:tr},output:{html:null},run:hc};function mc(){In.input.enabled=this.checked}const dc=.03414823529,_c=.03414823529;function pc(t,e){const{_bpm:n,_njs:o}=t,{_notes:r}=e._data,i={},l={0:[],1:[],3:[]},a=[];for(let s=0,u=r.length;s<u;s++){const _=r[s];S(_)&&i[_._type]&&M(_,i[_._type],n,l[_._type])&&(l[_._type]=[]);for(const c of l[(_._type+1)%2])if(c._cutDirection!==8){if(!(n.toRealTime(_._time)>n.toRealTime(c._time)+.01))continue;const g=H(c)%90>15&&H(c)%90<75;if(o.value<1.425/(60*(_._time-c._time)/n.value+(g?_c:dc))&&fo(_,c,[[15,1.5]])[1]){a.push(c);break}}i[_._type]=_,l[_._type].push(_)}return a.map(s=>s._time).filter(function(s,u,_){return!u||s!==_[u-1]})}function hc(t,e){if(!e)throw new Error("something went wrong!");const n=pc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox reverse staircase [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,In.output.html=o}else In.output.html=null}const nr=document.createElement("div"),Gt=document.createElement("input"),or=document.createElement("label");or.textContent=" Hitbox inline";or.htmlFor="input__tools-hitbox-inline-check";Gt.id="input__tools-hitbox-inline-check";Gt.className="input-toggle";Gt.type="checkbox";Gt.checked=!0;Gt.addEventListener("change",fc);nr.appendChild(Gt);nr.appendChild(or);const Rn={name:"Hitbox Inline",description:"Placeholder",type:"note",order:{input:72,output:192},input:{enabled:Gt.checked,params:{},html:nr},output:{html:null},run:yc};function fc(){Rn.input.enabled=this.checked}const gc=0;function bc(t,e){const{_bpm:n,_njs:o}=t,{_notes:r}=e._data,i={},l={0:[],1:[],3:[]},a=[];for(let s=0,u=r.length;s<u;s++){const _=r[s];S(_)&&i[_._type]&&M(_,i[_._type],n,l[_._type])&&(l[_._type]=[]);for(const c of l[(_._type+1)%2])if(o.value<1.425/(60*(_._time-c._time)/n.value+gc)&&an(_,c)){a.push(_);break}i[_._type]=_,l[_._type].push(_)}return a.map(s=>s._time).filter(function(s,u,_){return!u||s!==_[u-1]})}function yc(t,e){if(!e)throw new Error("something went wrong!");const n=bc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox inline [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,Rn.output.html=o}else Rn.output.html=null}const rr=document.createElement("div"),Ut=document.createElement("input"),ir=document.createElement("label");ir.textContent=" Hitbox path";ir.htmlFor="input__tools-hitbox-path-check";Ut.id="input__tools-hitbox-path-check";Ut.className="input-toggle";Ut.type="checkbox";Ut.checked=!0;Ut.addEventListener("change",Ec);rr.appendChild(Ut);rr.appendChild(ir);const Mn={name:"Hitbox Path",description:"Placeholder",type:"note",order:{input:74,output:190},input:{enabled:Ut.checked,params:{},html:rr},output:{html:null},run:Tc};function Ec(){Mn.input.enabled=this.checked}function vc(t,e){const{_bpm:n,_njs:o}=t,{_notes:r}=e._data,i=[];let l=0;for(let a=0,s=r.length;a<s;a++)if(!(n.toRealTime(r[a]._time)<l+.01||r[a]._type===3))for(let u=a+1;u<s&&!(n.toRealTime(r[u]._time)>n.toRealTime(r[a]._time)+.01);u++)r[a]._type===r[u]._type||r[u]._type===3||((de(r[a],r[u])||me(r[a],r[u]))&&fo(r[a],r[u],[[45,1],[15,2]]).some(_=>_)||rn(r[a],r[u])&&fo(r[a],r[u],[[45,1],[15,1.5]]).some(_=>_))&&(i.push(r[a]),l=n.toRealTime(r[a]._time));return i.map(a=>a._time).filter(function(a,s,u){return!s||a!==u[s-1]})}function Tc(t,e){if(!e)throw new Error("something went wrong!");const n=vc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox path [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,Mn.output.html=o}else Mn.output.html=null}const ar=document.createElement("div"),Jt=document.createElement("input"),lr=document.createElement("label");lr.textContent=" Improper window snap";lr.htmlFor="input__tools-window-snap-check";Jt.id="input__tools-window-snap-check";Jt.className="input-toggle";Jt.type="checkbox";Jt.checked=!0;Jt.addEventListener("change",$c);ar.appendChild(Jt);ar.appendChild(lr);const Dn={name:"Improper Window Snap",description:"Placeholder",type:"note",order:{input:60,output:185},input:{enabled:Jt.checked,params:{},html:ar},output:{html:null},run:wc};function $c(){Dn.input.enabled=this.checked}function Lc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,r={},i={0:[],1:[],3:[]},l=[];for(let a=0,s=o.length;a<s;a++){const u=o[a];S(u)&&r[u._type]?M(u,r[u._type],n,i[u._type])?(r[u._type]=u,i[u._type]=[]):ho(u,r[u._type])&&u._time-r[u._type]._time>=.001&&u._cutDirection===r[u._type]._cutDirection&&u._cutDirection!==8&&r[u._type]._cutDirection!==8&&l.push(r[u._type]):r[u._type]=u,i[u._type].push(u)}return l.map(a=>a._time).filter(function(a,s,u){return!s||a!==u[s-1]})}function wc(t,e){if(!e)throw new Error("something went wrong!");const n=Lc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Improper window snap [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,Dn.output.html=o}else Dn.output.html=null}const Pe=(t,e,n,o,...r)=>{const i=document.createElement(n);i.className=o;const l=document.createElement("select");l.className="input-toggle",l.id=t,r.forEach(s=>{const u=document.createElement("option");u.textContent=s.text,u.value=s.value,l.append(u)});const a=document.createElement("label");return a.htmlFor=t,a.innerHTML=`<span>${e}</span>`,i.append(a),i.append(l),i},Bn=document.createElement("div"),Vt=document.createElement("input"),sr=document.createElement("label");Pe("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});Pe("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Pe("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});sr.textContent=" Parity (EXPERIMENTAL)";sr.htmlFor="input__tools-parity-check";Vt.id="input__tools-parity-check";Vt.className="input-toggle";Vt.type="checkbox";Vt.checked=!1;Vt.addEventListener("change",Cc);Bn.appendChild(Vt);Bn.appendChild(sr);Bn.appendChild(document.createElement("br"));const Oe={name:"Parity check",description:"Placeholder",type:"note",order:{input:15,output:135},input:{enabled:Vt.checked,params:{warningThres:90,errorThres:45,allowedRot:90},html:Bn},output:{html:null},run:Ac};function Cc(){Oe.input.enabled=this.checked}function xc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{warningThres:r,errorThres:i,allowedRot:l}=Oe.input.params,a={},s={0:[],1:[],3:[]},u={0:[],1:[]},_={0:[],1:[]},c={0:new yo(o,0,r,i,l),1:new yo(o,1,r,i,l)},g={warning:[],error:[]};for(let m=0,f=o.length;m<f;m++){const d=o[m];if(S(d)&&a[d._type]&&M(d,a[d._type],n,s[d._type])){switch(c[d._type].check(s[d._type],_[d._type])){case"warning":{g.warning.push(s[d._type][0]._time);break}case"error":{g.error.push(s[d._type][0]._time);break}}c[d._type].next(s[d._type],_[d._type]),_[d._type]=u[d._type],u[d._type]=[],s[d._type]=[]}d._type===3&&(u[0].push(d),u[1].push(d)),a[d._type]=d,s[d._type].push(d)}for(let m=0;m<2;m++)if(a[m])switch(c[m].check(s[m],u[m])){case"warning":{g.warning.push(s[m][0]._time);break}case"error":{g.error.push(s[m][0]._time);break}}return g}function Ac(t,e){if(!e)throw new Error("something went wrong!");const n=xc(t,e),o=[];if(n.warning.length&&o.push(`<b>Parity warning [${n.warning.length}]:</b> ${n.warning.filter(function(r,i,l){return!i||r!==l[i-1]}).sort((r,i)=>r-i).map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`),n.error.length&&o.push(`<b>Parity error [${n.error.length}]:</b> ${n.error.filter(function(r,i,l){return!i||r!==l[i-1]}).sort((r,i)=>r-i).map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`),o.length){const r=document.createElement("div");r.innerHTML=o.join("<br>"),Oe.output.html=r}else Oe.output.html=null}const cr=document.createElement("div"),Xt=document.createElement("input"),ur=document.createElement("label");ur.textContent=" Double-directional";ur.htmlFor="input__tools-dd-check";Xt.id="input__tools-dd-check";Xt.className="input-toggle";Xt.type="checkbox";Xt.checked=!0;Xt.addEventListener("change",kc);cr.appendChild(Xt);cr.appendChild(ur);const Hn={name:"Double-directional",description:"Placeholder",type:"note",order:{input:99,output:140},input:{enabled:Xt.checked,params:{},html:cr},output:{html:null},run:Ic};function kc(){Hn.input.enabled=this.checked}function Sc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,r={},i={},l={},a={0:[],1:[],3:[]},s=[];for(let u=0,_=o.length;u<_;u++){const c=o[u];S(c)&&r[c._type]?M(c,r[c._type],n,a[c._type])?(l[c._type]&&(l[c._type]=null,i[c._type]=(i[c._type]+180)%360),Ie(c,i[c._type],45,!0)&&s.push(c),c._cutDirection===8?l[c._type]=c:i[c._type]=H(c),a[c._type]=[]):(l[c._type]&&Ie(c,i[c._type],45,!0)&&(s.push(c),l[c._type]=null,i[c._type]=H(c)),c._cutDirection!==8&&(l[c._type]=null,i[c._type]=H(c))):i[c._type]=H(c),r[c._type]=c,a[c._type].push(c),c._type===3&&(c._lineLayer===0&&(c._lineIndex===1&&(i[0]=it[0],l[0]=null),c._lineIndex===2&&(i[1]=it[0],l[1]=null)),c._lineLayer===2&&(c._lineIndex===1&&(i[0]=it[1],l[0]=null),c._lineIndex===2&&(i[1]=it[1],l[1]=null)))}return s.map(u=>u._time).filter(function(u,_,c){return!_||u!==c[_-1]})}function Ic(t,e){if(!e)throw new Error("something went wrong!");const n=Sc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Double-directional [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,Hn.output.html=o}else Hn.output.html=null}const wa=.1,Ca=.5,xa={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}};let O;const k=document.createElement("div"),Yt=document.createElement("input"),mr=document.createElement("label"),Kt=document.createElement("input"),dr=document.createElement("label"),Ct=document.createElement("input"),_r=document.createElement("label"),xt=document.createElement("input"),pr=document.createElement("label"),ct=document.createElement("input"),hr=document.createElement("label"),Z=document.createElement("input"),fr=document.createElement("label"),z=document.createElement("input"),gr=document.createElement("label");mr.textContent=" Vision block";mr.htmlFor="input__tools-vb-check";Yt.id="input__tools-vb-check";Yt.className="input-toggle";Yt.type="checkbox";Yt.checked=!0;Yt.addEventListener("change",Mc);dr.textContent=" VB time specific ";dr.htmlFor="input__tools-vb-time-check";Kt.id="input__tools-vb-time-check";Kt.className="input-toggle";Kt.type="radio";Kt.name="input__tools-vb-spec";Kt.value="time";Kt.addEventListener("change",Aa);_r.textContent=" VB difficulty specific ";_r.htmlFor="input__tools-vb-diff-check";Ct.id="input__tools-vb-diff-check";Ct.className="input-toggle";Ct.type="radio";Ct.checked=!0;Ct.name="input__tools-vb-spec";Ct.value="difficulty";Ct.addEventListener("change",Aa);pr.textContent="min time (ms): ";pr.htmlFor="input__tools-vb-min-time";xt.id="input__tools-vb-min-time";xt.className="input-toggle input--small";xt.type="number";xt.min="0";xt.value=p(wa*1e3,1).toString();xt.addEventListener("change",Dc);hr.textContent=" (beat): ";hr.htmlFor="input__tools-vb-min-beat";ct.id="input__tools-vb-min-beat";ct.className="input-toggle input--small";ct.type="number";ct.min="0";ct.step="0.1";ct.addEventListener("change",Bc);fr.textContent="max time (ms): ";fr.htmlFor="input__tools-vb-max-time";Z.id="input__tools-vb-max-time";Z.className="input-toggle input--small";Z.type="number";Z.min="0";Z.value=p(Ca*1e3,1).toString();Z.addEventListener("change",Hc);gr.textContent=" (beat): ";gr.htmlFor="input__tools-vb-max-beat";z.id="input__tools-vb-max-beat";z.className="input-toggle input--small";z.type="number";z.min="0";z.step="0.1";z.addEventListener("change",Nc);k.appendChild(Yt);k.appendChild(mr);k.appendChild(document.createElement("br"));k.appendChild(Kt);k.appendChild(dr);k.appendChild(Ct);k.appendChild(_r);k.appendChild(document.createElement("br"));k.appendChild(pr);k.appendChild(xt);k.appendChild(hr);k.appendChild(ct);k.appendChild(document.createElement("br"));k.appendChild(fr);k.appendChild(Z);k.appendChild(gr);k.appendChild(z);const w={name:"Slow Slider",description:"Placeholder",type:"note",order:{input:100,output:120},input:{enabled:Yt.checked,params:{specific:"difficulty",minTime:wa,maxTime:Ca},html:k,adjustTime:Rc},output:{html:null},run:Oc};function Rc(t){O=t,ct.value=p(O.toBeatTime(w.input.params.minTime),2).toString(),z.value=p(O.toBeatTime(w.input.params.maxTime),2).toString()}function Mc(){w.input.enabled=this.checked}function Aa(){w.input.params.specific=this.value}function Dc(){w.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=p(w.input.params.minTime*1e3,1).toString(),O&&(ct.value=p(O.toBeatTime(w.input.params.minTime),2).toString(),w.input.params.minTime>w.input.params.maxTime&&(w.input.params.maxTime=w.input.params.minTime,Z.value=p(w.input.params.maxTime*1e3,1).toString(),z.value=p(O.toBeatTime(w.input.params.maxTime),2).toString()))}function Bc(){if(!O){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;w.input.params.minTime=O.toRealTime(t),xt.value=p(w.input.params.minTime*1e3,1).toString(),this.value=p(t,2).toString(),w.input.params.minTime>w.input.params.maxTime&&(w.input.params.maxTime=w.input.params.minTime,Z.value=p(w.input.params.maxTime*1e3,1).toString(),z.value=p(O.toBeatTime(w.input.params.maxTime),2).toString())}function Hc(){w.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=p(w.input.params.maxTime*1e3,1).toString(),O&&(z.value=p(O.toBeatTime(w.input.params.maxTime),2).toString())}function Nc(){if(!O){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;w.input.params.maxTime=O.toRealTime(t),Z.value=p(w.input.params.maxTime*1e3,1).toString(),this.value=p(t,2).toString()}function Pc(t,e){const{_bpm:n,_njs:o}=t,{_notes:r}=e._data,{minTime:i,maxTime:l,specific:a}=w.input.params,s=a==="time"?n.toBeatTime(i):n.toBeatTime(xa[e._difficulty].min),u=a==="time"?n.toBeatTime(l):Math.min(o.hjd,n.toBeatTime(xa[e._difficulty].max));let _,c;const g=[];for(let m=0,f=r.length;m<f;m++){const d=r[m];_&&(d._time-_._time>=s&&d._time-_._time<=u?d._lineIndex<2&&g.push(d):d._time-_._time>u&&(_=null)),c&&(d._time-c._time>=s&&d._time-c._time<=u?d._lineIndex>1&&g.push(d):d._time-c._time>u&&(c=null)),d._lineLayer===1&&d._lineIndex===1&&(_=d),d._lineLayer===1&&d._lineIndex===2&&(c=d)}return g.map(m=>m._time).filter(function(m,f,d){return!f||m!==d[f-1]})}function Oc(t,e){if(!e)throw new Error("something went wrong!");const n=Pc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Vision block [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,w.output.html=o}else w.output.html=null}const br=document.createElement("div"),zt=document.createElement("input"),yr=document.createElement("label");yr.textContent=" Stacked note";yr.htmlFor="input__tools-stack-note-check";zt.id="input__tools-stack-note-check";zt.className="input-toggle";zt.type="checkbox";zt.checked=!0;zt.addEventListener("change",Fc);br.appendChild(zt);br.appendChild(yr);const Nn={name:"Stacked Note",description:"Placeholder",type:"note",order:{input:98,output:198},input:{enabled:zt.checked,params:{},html:br},output:{html:null},run:Gc};function Fc(){Nn.input.enabled=this.checked}function jc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,r=[];let i=0;for(let l=0,a=o.length;l<a;l++)if(!(n.toRealTime(o[l]._time)<i+.01||o[l]._type===3))for(let s=l+1;s<a&&!(n.toRealTime(o[s]._time)>n.toRealTime(o[l]._time)+.01);s++)an(o[l],o[s])&&(r.push(o[l]),i=n.toRealTime(o[l]._time));return r.map(l=>l._time).filter(function(l,a,s){return!a||l!==s[a-1]})}function qc(t,e){const{_bpm:n,_njs:o}=t,{_notes:r}=e._data,i=[];for(let l=0,a=r.length;l<a;l++)if(r[l]._type===3)for(let s=l+1;s<a&&!(n.toRealTime(r[s]._time)>n.toRealTime(r[l]._time)+1);s++)an(r[l],r[s])&&(o.value<n.value/(120*(r[s]._time-r[l]._time))||n.toRealTime(r[s]._time)<n.toRealTime(r[l]._time)+.02)&&i.push(r[l]);return i.map(l=>l._time).filter(function(l,a,s){return!a||l!==s[a-1]})}function Gc(t,e){if(!e)throw new Error("something went wrong!");const n=jc(t,e),o=qc(t,e),r=[];if(n.length&&r.push(`<b>Stacked note [${n.length}]:</b> ${n.map(i=>p(t._bpm.adjustTime(i),3)).join(", ")}`),o.length&&r.push(`<b>Stacked bomb [${o.length}]:</b> ${o.map(i=>p(t._bpm.adjustTime(i),3)).join(", ")}`),r.length){const i=document.createElement("div");i.innerHTML=r.join("<br>"),Nn.output.html=i}else Nn.output.html=null}const ka=[1,1,1],Sa={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"},Ia=(t,e)=>{var r;let n=(r=Object.keys(t).find(i=>parseFloat(i)>=e))!=null?r:"100",o=parseFloat(n);return t[o]},Er=document.createElement("div"),Wt=document.createElement("input"),vr=document.createElement("label");vr.textContent=" Color check (EXPERIMENTAL)";vr.htmlFor="input__tools-note-color-check";Wt.id="input__tools-note-color-check";Wt.className="input-toggle";Wt.type="checkbox";Wt.checked=!0;Wt.addEventListener("change",Uc);Er.appendChild(Wt);Er.appendChild(vr);const Pn={name:"Color Check",description:"Placeholder",type:"note",order:{input:97,output:45},input:{enabled:Wt.checked,params:{},html:Er},output:{html:null},run:Xc};function Uc(){Pn.input.enabled=this.checked}function Jc(t,e){var r,i,l,a;const n=(i=(r=e._info._customData)==null?void 0:r._colorLeft)!=null?i:D[B[e._environment]]._colorLeft,o=(a=(l=e._info._customData)==null?void 0:l._colorRight)!=null?a:D[B[e._environment]]._colorRight;return n&&o?$o(un(n),un(o)):100}function Vc(t,e){var l,a,s,u;let n=100,o=100;const r=(a=(l=e._info._customData)==null?void 0:l._colorLeft)!=null?a:D[B[e._environment]]._colorLeft,i=(u=(s=e._info._customData)==null?void 0:s._colorRight)!=null?u:D[B[e._environment]]._colorRight;return r&&(n=$o(ka,un(r))),i&&(o=$o(ka,un(i))),Math.min(n,o)}function Xc(t,e){var i,l;if(!e)throw new Error("something went wrong!");if(!((i=e._info._customData)==null?void 0:i._colorLeft)&&!((l=e._info._customData)==null?void 0:l._colorRight))return;const n=Jc(t,e),o=Vc(t,e),r=[];if(n<=20&&r.push(`<b>${Ia(Sa,n)} note color (dE${p(n,1)}):</b> suggest change to better differentiate between 2 note colour`),o<=20&&r.push(`<b>${Ia(Sa,o)} arrow note color (dE${p(o,1)}):</b> may be difficult to see the arrow`),r.length){const a=document.createElement("div");a.innerHTML=r.join("<br>"),Pn.output.html=a}else Pn.output.html=null}var Ra=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",effectiveBPM:N,acceptablePrec:pe,varySwing:kn,slowSlider:U,inlineAngle:X,shradoAngle:P,speedPause:K,hitboxStair:Sn,hitboxReverseStair:In,hitboxInline:Rn,hitboxPath:Mn,improperWindow:Dn,parity:Oe,doubleDirectional:Hn,visionBlock:w,stackedNote:Nn,colorCheck:Pn});const Tr=document.createElement("div"),Zt=document.createElement("input"),$r=document.createElement("label");$r.textContent=" <15ms obstacle";$r.htmlFor="input__tools-short-obstacle-check";Zt.id="input__tools-short-obstacle-check";Zt.className="input-toggle";Zt.type="checkbox";Zt.checked=!0;Zt.addEventListener("change",Yc);Tr.appendChild(Zt);Tr.appendChild($r);const Fe={name:"Short Obstacle",description:"Placeholder",type:"obstacle",order:{input:0,output:50},input:{enabled:Zt.checked,params:{minDur:.015},html:Tr},output:{html:null},run:zc};function Yc(){Fe.input.enabled=this.checked}function Kc(t,e){const{_obstacles:n}=e._data,{_bpm:o}=t,{minDur:r}=Fe.input.params,i=o.toBeatTime(r),l=[];let a={_time:0,_duration:0,_lineIndex:0,_lineLayer:0,_type:0,_width:0,_height:0},s={_time:0,_duration:0,_lineIndex:0,_lineLayer:0,_type:0,_width:0,_height:0},u={_time:0,_duration:0,_lineIndex:0,_lineLayer:0,_type:0,_width:0,_height:0},_={_time:0,_duration:0,_lineIndex:0,_lineLayer:0,_type:0,_width:0,_height:0};return n.forEach(c=>{c._type===0&&c._duration>0?c._width>2||c._width>1&&c._lineIndex===1?($(c,a)&&(c._duration<i&&l.push(c),a=c),$(c,s)&&(c._duration<i&&l.push(c),s=c)):c._width===2?c._lineIndex===0?$(c,a)&&(c._duration<i&&l.push(c),a=c):c._lineIndex===2&&$(c,s)&&(c._duration<i&&l.push(c),s=c):c._width===1&&(c._lineIndex===1?$(c,a)&&(c._duration<i&&l.push(c),a=c):c._lineIndex===2&&$(c,s)&&(c._duration<i&&l.push(c),s=c)):c._type===1&&c._duration>0&&(c._width>2||c._width>1&&c._lineIndex===1?($(c,u)&&(c._duration<i&&$(c,a,i)&&$(c,u,i)&&l.push(c),u=c),$(c,_)&&(c._duration<i&&$(c,s,i)&&$(c,_,i)&&l.push(c),_=c)):c._width===2?c._lineIndex===0?$(c,u)&&(c._duration<i&&$(c,a,i)&&$(c,u,i)&&l.push(c),u=c):c._lineIndex===2&&$(c,_)&&(c._duration<i&&$(c,s,i)&&$(c,_,i)&&l.push(c),_=c):c._width===1&&(c._lineIndex===1?$(c,u)&&(c._duration<i&&$(c,a,i)&&$(c,u,i)&&l.push(c),u=c):c._lineIndex===2&&$(c,_)&&(c._duration<i&&$(c,s,i)&&$(c,_,i)&&l.push(c),_=c)))}),l.map(c=>c._time).filter(function(c,g,m){return!g||c!==m[g-1]})}function zc(t,e){if(!e)throw new Error("something went wrong!");const n=Kc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b><15ms obstacle [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,Fe.output.html=o}else Fe.output.html=null}const Ma=.25;let ye;const At=document.createElement("div"),Qt=document.createElement("input"),Lr=document.createElement("label"),kt=document.createElement("input"),wr=document.createElement("label"),ut=document.createElement("input"),Cr=document.createElement("label");Lr.textContent=" 2-wide center obstacle";Lr.htmlFor="input__tools-center-obstacle-check";Qt.id="input__tools-center-obstacle-check";Qt.className="input-toggle";Qt.type="checkbox";Qt.checked=!0;Qt.addEventListener("change",Zc);wr.textContent="recovery time (ms): ";wr.htmlFor="input__tools-2wide-wall-time";kt.id="input__tools-2wide-wall-time";kt.className="input-toggle input--small";kt.type="number";kt.min="0";kt.value=p(Ma*1e3,1).toString();kt.addEventListener("change",Qc);Cr.textContent=" (beat): ";Cr.htmlFor="input__tools-2wide-wall-beat";ut.id="input__tools-2wide-wall-beat";ut.className="input-toggle input--small";ut.type="number";ut.min="0";ut.step="0.1";ut.addEventListener("change",tu);At.appendChild(Qt);At.appendChild(Lr);At.appendChild(document.createElement("br"));At.appendChild(wr);At.appendChild(kt);At.appendChild(Cr);At.appendChild(ut);const J={name:"2-wide Center Obstacle",description:"Placeholder",type:"obstacle",order:{input:10,output:60},input:{enabled:Qt.checked,params:{recovery:Ma},html:At,adjustTime:Wc},output:{html:null},run:nu};function Wc(t){ye=t,ut.value=p(ye.toBeatTime(J.input.params.recovery),2).toString()}function Zc(){J.input.enabled=this.checked}function Qc(){J.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=p(J.input.params.recovery*1e3,1).toString(),ye&&(ut.value=p(ye.toBeatTime(J.input.params.recovery),2).toString())}function tu(){if(!ye){this.value="0";return}let t=p(Math.abs(parseFloat(this.value)),2)||1;J.input.params.recovery=ye.toRealTime(t),kt.value=p(J.input.params.recovery*1e3,1).toString(),this.value=t.toString()}function eu(t,e){const{_obstacles:n}=e._data,{_bpm:o}=t,{recovery:r}=J.input.params,i=[];let l={_time:0,_duration:0,_lineIndex:0,_lineLayer:0,_type:0,_width:0,_height:0},a={_time:0,_duration:0,_lineIndex:0,_lineLayer:0,_type:0,_width:0,_height:0};return n.forEach(s=>{s._type===0&&(s._width>2&&(i.push(s),$(s,l)&&(l=s),$(s,a)&&(a=s)),s._width===2&&(s._lineIndex===0&&$(s,l)&&(o.toRealTime(s._time)>o.toRealTime(a._time)-r&&o.toRealTime(s._time)<o.toRealTime(a._time+a._duration)+r&&i.push(s),l=s),s._lineIndex===1&&(i.push(s),$(s,l)&&(l=s),$(s,a)&&(a=s)),s._lineIndex===2&&$(s,a)&&(o.toRealTime(s._time)>o.toRealTime(l._time)-r&&o.toRealTime(s._time)<o.toRealTime(l._time+l._duration)+r&&i.push(s),a=s)),s._width===1&&(s._lineIndex===1&&$(s,l)&&(o.toRealTime(s._time)>o.toRealTime(a._time)-r&&o.toRealTime(s._time)<o.toRealTime(a._time+a._duration)+r&&i.push(s),l=s),s._lineIndex===2&&$(s,a)&&(o.toRealTime(s._time)>o.toRealTime(l._time)-r&&o.toRealTime(s._time)<o.toRealTime(l._time+l._duration)+r&&i.push(s),a=s)))}),i.map(s=>s._time).filter(function(s,u,_){return!u||s!==_[u-1]})}function nu(t,e){if(!e)throw new Error("something went wrong!");const n=eu(t,e),{recovery:o}=J.input.params;if(n.length){const r=document.createElement("div");r.innerHTML=`<b>2-wide center obstacle (<${p(o*1e3)}ms) [${n.length}]:</b> ${n.map(i=>p(t._bpm.adjustTime(i),3)).join(", ")}`,J.output.html=r}else J.output.html=null}const xr=document.createElement("div"),te=document.createElement("input"),Ar=document.createElement("label");Ar.textContent=" Zero width/duration obstacle";Ar.htmlFor="input__tools-zero-obstacle-check";te.id="input__tools-zero-obstacle-check";te.className="input-toggle";te.type="checkbox";te.checked=!0;te.addEventListener("change",ou);xr.appendChild(te);xr.appendChild(Ar);const On={name:"Negative Obstacle",description:"Placeholder",type:"obstacle",order:{input:20,output:70},input:{enabled:te.checked,params:{},html:xr},output:{html:null},run:iu};function ou(){On.input.enabled=this.checked}function ru(t,e){const{_obstacles:n}=e._data;return n.filter(o=>o._width===0||o._duration===0).map(o=>o._time)}function iu(t,e){if(!e)throw new Error("something went wrong!");const n=ru(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Zero width/duration obstacle [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,On.output.html=o}else On.output.html=null}const kr=document.createElement("div"),ee=document.createElement("input"),Sr=document.createElement("label");Sr.textContent=" Negative obstacle";Sr.htmlFor="input__tools-negative-obstacle-check";ee.id="input__tools-negative-obstacle-check";ee.className="input-toggle";ee.type="checkbox";ee.checked=!0;ee.addEventListener("change",au);kr.appendChild(ee);kr.appendChild(Sr);const Fn={name:"Negative Obstacle",description:"Placeholder",type:"obstacle",order:{input:30,output:80},input:{enabled:ee.checked,params:{},html:kr},output:{html:null},run:su};function au(){Fn.input.enabled=this.checked}function lu(t,e){var o,r,i,l;const{_obstacles:n}=e._data;return((r=(o=e._info._customData)==null?void 0:o._requirements)==null?void 0:r.includes("Mapping Extensions"))||((l=(i=e._info._customData)==null?void 0:i._requirements)==null?void 0:l.includes("Noodle Extensions"))?[]:n.filter(a=>a._width<0||a._duration<0).map(a=>a._time)}function su(t,e){if(!e)throw new Error("something went wrong!");const n=lu(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Negative obstacle [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,Fn.output.html=o}else Fn.output.html=null}var Da=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",shortObstacle:Fe,centerObstacle:J,zeroObstacle:On,negativeObstacle:Fn});const Ir=document.createElement("div"),ne=document.createElement("input"),Rr=document.createElement("label");Rr.textContent=" Insufficient lighting event";Rr.htmlFor="input__tools-insufficient-light-check";ne.id="input__tools-insufficient-light-check";ne.className="input-toggle";ne.type="checkbox";ne.checked=!0;ne.addEventListener("change",cu);Ir.appendChild(ne);Ir.appendChild(Rr);const jn={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:0,output:0},input:{enabled:ne.checked,params:{},html:Ir},output:{html:null},run:mu};function cu(){jn.input.enabled=this.checked}const uu=t=>{let e=0;for(let n=t.length-1;n>=0;n--)if(on(t[n])&&t[n]._value!==0&&t[n]._value!==4&&(e++,e>10))return!0;return!1};function mu(t,e){if(!e)throw new Error("something went wrong!");if(uu(e._data._events))jn.output.html=null;else{const o=document.createElement("div");o.innerHTML="<b>Insufficient lighting event</b>",jn.output.html=o}}const Mr=document.createElement("div"),oe=document.createElement("input"),Dr=document.createElement("label");Dr.textContent=" Old value 4 event";Dr.htmlFor="input__tools-light-4";oe.id="input__tools-light-4";oe.className="input-toggle";oe.type="checkbox";oe.checked=!0;oe.addEventListener("change",du);Mr.appendChild(oe);Mr.appendChild(Dr);const qn={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:1,output:1},input:{enabled:oe.checked,params:{},html:Mr},output:{html:null},run:pu};function du(){qn.input.enabled=this.checked}function _u(t,e){const{_events:n}=e._data,o=[];if(To(e._data._version,"difficulty")==="old")for(let r=n.length-1;r>=0;r--)on(n[r])&&n[r]._value===4&&o.push(n[r]);else return[];return o.map(r=>r._time).filter(function(r,i,l){return!i||r!==l[i-1]})}function pu(t,e){if(!e)throw new Error("something went wrong!");const n=_u(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Event with value 4 [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,qn.output.html=o}else qn.output.html=null}const Br=document.createElement("div"),re=document.createElement("input"),Hr=document.createElement("label");Hr.textContent=" Unlit bomb";Hr.htmlFor="input__tools-unlit-bomb";re.id="input__tools-unlit-bomb";re.className="input-toggle";re.type="checkbox";re.checked=!0;re.addEventListener("change",hu);Br.appendChild(re);Br.appendChild(Hr);const Gn={name:"Unlit Bomb",description:"Placeholder",type:"event",order:{input:3,output:203},input:{enabled:re.checked,params:{},html:Br},output:{html:null},run:gu};function hu(){Gn.input.enabled=this.checked}const fu=(t,e,n,o)=>{var _,c;if(!e.length)return[];const r=[],i=e.filter(g=>on(g)&&ao[o].includes(g._type)).sort((g,m)=>g._type-m._type),l={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},a={};ao[o].forEach(g=>a[g]=[[0,!1]]);const s=n.toBeatTime(1),u=n.toBeatTime(.25);for(let g=0,m=i.length;g<m;g++){const f=i[g];if((Dl(f)||Bl(f))&&l[f._type].state!=="on"){l[f._type]={state:"on",time:f._time,fadeTime:0};const d=a[f._type].find(v=>v[0]>=f._time);d?(d[0]=f._time,d[1]=!0):a[f._type].push([f._time,!0])}if(Hl(f)){l[f._type]={state:"off",time:f._time,fadeTime:s};const d=a[f._type].find(v=>v[0]>=f._time);d?(d[0]=f._time,d[1]=!0):a[f._type].push([f._time,!0]),a[f._type].push([f._time+s,!1])}(((_=f==null?void 0:f._floatValue)!=null?_:1)<.25||Ml(f)||((c=f._customData)==null?void 0:c._color)&&(typeof f._customData._color[3]=="number"&&f._customData._color[3]<.25||Math.max(f._customData._color[0],f._customData._color[1],f._customData._color[2])<.25))&&l[f._type].state!=="off"&&(l[f._type]={state:"off",time:f._time,fadeTime:l[f._type].state==="on"?u:Math.min(u,l[f._type].fadeTime)},a[f._type].push([f._time+(l[f._type].state==="on"?u:Math.min(u,l[f._type].fadeTime)),!1]))}for(const g in a)a[g].reverse();for(let g=0,m=t.length,f=!1;g<m;g++){const d=t[g];if(!!Jl(d)){f=!1;for(const v in a){const y=a[v].find(E=>E[0]<=d._time);y&&(f=f||y[1])}f||r.push(d)}}return r.map(g=>g._time).filter(function(g,m,f){return!m||g!==f[m-1]})};function gu(t,e){if(!e)throw new Error("something went wrong!");const n=fu(e._data._notes,e._data._events,t._bpm,e._environment);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Unlit bomb [${n.length}]:</b> ${n.map(r=>p(t._bpm.adjustTime(r),3)).join(", ")}`,Gn.output.html=o}else Gn.output.html=null}const Nr=document.createElement("div"),ie=document.createElement("input"),Pr=document.createElement("label");Pr.textContent=" Event peak (1 second) and per second";Pr.htmlFor="input__tools-light-stats";ie.id="input__tools-light-stats";ie.className="input-toggle";ie.type="checkbox";ie.checked=!1;ie.addEventListener("change",bu);Nr.appendChild(ie);Nr.appendChild(Pr);const Un={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:2,output:2},input:{enabled:ie.checked,params:{},html:Nr},output:{html:null},run:Eu};function bu(){Un.input.enabled=this.checked}function yu(t,e){const{_bpm:n,_audioDuration:o}=t,{_events:r}=e._data;let i=n.toBeatTime(1),l=0,a=0;for(let s=0;s<r.length;s++){for(;r[s]._time-r[a]._time>i;)a++;l=Math.max(l,(s-a+i)/(1/n.value*60))}return{EPS:o?p(r.length/o,3):0,peakEPS:p(l,3)}}function Eu(t,e){if(!e)throw new Error("something went wrong!");const n=yu(t,e);if(n){const o=document.createElement("div");o.innerHTML=`<b>Events per second:</b> ${n.EPS}<br><b>Peak Event (1s):</b> ${n.peakEPS}`,Un.output.html=o}else Un.output.html=null}var Ba=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",insufficientLight:jn,oldEventValue:qn,unlitBomb:Gn,testEvent:Un});const Ha=1.5,Or=document.createElement("div"),St=document.createElement("input"),Fr=document.createElement("label");Fr.textContent="Hot start (s): ";Fr.htmlFor="input__tools-hot-start";St.id="input__tools-hot-start";St.className="input-toggle input--small";St.type="number";St.min="0";St.step="0.1";St.value=Ha.toString();St.addEventListener("change",vu);Or.appendChild(Fr);Or.appendChild(St);const Ee={name:"Hot Start",description:"Placeholder",type:"other",order:{input:0,output:0},input:{enabled:!0,params:{time:Ha},html:Or},output:{html:null},run:Tu};function vu(){Ee.input.params.time=p(Math.abs(parseFloat(this.value)),3),this.value=Ee.input.params.time.toString()}function Tu(t,e){if(!e)throw new Error("something went wrong!");const{time:n}=Ee.input.params,o=t._bpm.toRealTime(Ti(e._data));if(o<n){const r=document.createElement("div");r.innerHTML=`<b>Hot start:</b> ${p(o,2)}s`,Ee.output.html=r}else Ee.output.html=null}const jr={name:"Difficulty Label",description:"Placeholder",type:"other",order:{input:30,output:30},input:{enabled:!0,params:{}},output:{html:null},run:$u};function $u(t,e){var o;if(!e)throw new Error("something went wrong!");const n=(o=e._info._customData)==null?void 0:o._difficultyLabel;if(n&&n.length>30){const r=document.createElement("div");r.innerHTML=`<b>Difficulty label is too long (${n.length} characters):</b> exceeded 30 max characters by ranking criteria`,jr.output.html=r}else jr.output.html=null}const qr={name:"Note Jump Speed",description:"Placeholder",type:"other",order:{input:40,output:40},input:{enabled:!0,params:{}},output:{html:null},run:Lu};function Lu(t,e){if(!e)throw new Error("something went wrong!");const{_njs:n,_bpm:o}=t,r=[];if(e._info._noteJumpMovementSpeed===0&&r.push("<b>Unset NJS</b>: fallback NJS is used"),n.value>23&&r.push(`<b>NJS is too high (${p(n.value,2)}):</b> use lower whenever necessary`),n.jd<18&&r.push(`<b>Very low jump distance:</b> ${p(n.jd,2)}`),n.jd>36&&r.push(`<b>Very high jump distance:</b> ${p(n.jd,2)}`),n.jd>n.calcJumpDistanceOptimalHigh()&&r.push(`<b>High jump distance warning (>${p(n.calcJumpDistanceOptimalHigh(),2)}):</b> ${p(n.jd,2)} at ${p(n.value,2)} NJS may be uncomfortable to play`),o.toRealTime(n.hjd)<.45&&r.push(`<b>Very quick reaction time (${p(o.toRealTime(n.hjd)*1e3)}ms):</b> may lead to suboptimal gameplay`),n.calcHalfJumpDurationRaw()+n.offset<n.hjdMin&&r.push(`<b>Unnecessary negative offset:</b> will not drop below ${n.hjdMin}`),r.length){const i=document.createElement("div");i.innerHTML=r.join("<br>"),qr.output.html=i}else qr.output.html=null}const Gr=document.createElement("div"),ae=document.createElement("input"),Ur=document.createElement("label");Ur.textContent=" Outside playable object";Ur.htmlFor="input__tools-outside-object-check";ae.id="input__tools-outside-object-check";ae.className="input-toggle";ae.type="checkbox";ae.checked=!0;ae.addEventListener("change",wu);Gr.appendChild(ae);Gr.appendChild(Ur);const Jn={name:"Difficulty Label",description:"Placeholder",type:"other",order:{input:10,output:10},input:{enabled:ae.checked,params:{},html:Gr},output:{html:null},run:Cu};function wu(){Jn.input.enabled=this.checked}function Cu(t,e){if(!e)throw new Error("something went wrong!");const{_bpm:n,_audioDuration:o}=t,{_notes:r,_obstacles:i,_events:l}=e._data,a=[];if(o){let s=n.toBeatTime(o);r.length&&r[0]._time<0&&a.push(`<b>Note(s) before start time:</b> ${p(r[0]._time,3)} (${j(n.toRealTime(r[0]._time))})`),i.length&&i[0]._time<0&&a.push(`<b>Obstacle(s) before start time:</b> ${p(i[0]._time,3)} (${j(n.toRealTime(i[0]._time))})`),l.length&&l[0]._time<0&&a.push(`<b>Event(s) before start time:</b> ${p(l[0]._time,3)} (${j(n.toRealTime(l[0]._time))})`),r.length&&r[r.length-1]._time>s&&a.push(`<b>Note(s) after end time:</b> ${p(r[r.length-1]._time,3)} (${j(n.toRealTime(r[r.length-1]._time))})`),i.length&&i[i.length-1]._time>s&&a.push(`<b>Obstacle(s) after end time:</b> ${p(i[i.length-1]._time,3)} (${j(n.toRealTime(i[i.length-1]._time))})`),l.length&&l[l.length-1]._time>s&&a.push(`<b>Event(s) after end time:</b> ${p(l[l.length-1]._time,3)} (${j(n.toRealTime(l[l.length-1]._time))})`)}if(a.length){const s=document.createElement("div");s.innerHTML=a.join("<br>"),Jn.output.html=s}else Jn.output.html=null}const Jr=document.createElement("div"),le=document.createElement("input"),Vr=document.createElement("label");Vr.textContent=" Invalid object";Vr.htmlFor="input__tools-invalid-object-check";le.id="input__tools-invalid-object-check";le.className="input-toggle";le.type="checkbox";le.checked=!0;le.addEventListener("change",xu);Jr.appendChild(le);Jr.appendChild(Vr);const Vn={name:"Invalid Object",description:"Placeholder",type:"other",order:{input:20,output:20},input:{enabled:le.checked,params:{},html:Jr},output:{html:null},run:Au};function xu(){Vn.input.enabled=this.checked}function Au(t,e){var _,c,g,m;if(!e)throw new Error("something went wrong!");const{_bpm:n}=t,{_notes:o,_obstacles:r,_events:i}=e._data;let l=[],a=[];((c=(_=e._info._customData)==null?void 0:_._requirements)==null?void 0:c.includes("Mapping Extensions"))||(((m=(g=e._info._customData)==null?void 0:g._requirements)==null?void 0:m.includes("Noodle Extensions"))?(l=o.filter(f=>Si(f)&&!Xl(f)).map(f=>f._time),a=r.filter(f=>po(f)&&!vi(f)).map(f=>f._time)):(l=o.filter(f=>!Kl(f)).map(f=>f._time),a=r.filter(f=>!kl(f)).map(f=>f._time)));const s=i.filter(f=>!ql(f)).map(f=>f._time),u=[];if(l.length&&u.push(`<b>Invalid note [${l.length}]:</b> ${l.map(f=>p(n.adjustTime(f),3)).join(", ")}`),a.length&&u.push(`<b>Invalid obstacle [${a.length}]:</b> ${a.map(f=>p(n.adjustTime(f),3)).join(", ")}`),s.length&&u.push(`<b>Invalid event [${s.length}]:</b> ${s.map(f=>p(n.adjustTime(f),3)).join(", ")}`),u.length){const f=document.createElement("div");f.innerHTML=u.join("<br>"),Vn.output.html=f}else Vn.output.html=null}var Na=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",hotStart:Ee,difficultyLabel:jr,njs:qr,outsidePlayable:Jn,invalidObject:Vn});const Pa=()=>Object.keys(Ra).map(t=>Ra[t]),Oa=()=>Object.keys(Da).map(t=>Da[t]),Fa=()=>Object.keys(Ba).map(t=>Ba[t]),ja=()=>Object.keys(Na).map(t=>Na[t]),qa=()=>Object.keys(fa).map(t=>fa[t]),Ga=()=>[...Pa(),...Oa(),...Fa(),...ja()],ku=()=>[...Pa(),...Oa(),...Fa(),...ja(),...qa()],Xr=()=>{b._analysis={general:{html:null},mapSet:[],missing:[],sps:[]}},Su=()=>{var s,u,_;const t=b._mapInfo;if(!t){console.error("could not analyse, missing map info");return}b._analysis||Xr();const e=(s=b._analysis)==null?void 0:s.general,n=(u=b._analysis)==null?void 0:u.sps,o=rt(t._beatsPerMinute),r=lo(o),i={_bpm:o,_njs:r,_audioDuration:(_=b._duration)!=null?_:null,_mapDuration:0},l=qa().sort((c,g)=>c.order.output-g.order.output);console.log("analysing general");const a=[];l.forEach(c=>{if(c.input.enabled)try{c.run(i,void 0,t,n),c.output.html&&a.push(c.output.html)}catch(g){console.error(g)}}),e&&(e.html=a)},Ua=(t,e)=>{var _,c,g,m,f,d,v;const n=b._mapInfo;if(!n){console.error("could not analyse, missing map info");return}const o=(_=b._mapSet)==null?void 0:_.find(y=>y._mode===t&&y._difficulty===e);if(!o){console.error("could not analyse, missing map data");return}b._analysis||Xr();const r=(c=b._analysis)==null?void 0:c.mapSet.find(y=>y.difficulty===e&&y.mode===t),i=rt(n._beatsPerMinute,((g=o._data._customData)==null?void 0:g._BPMChanges)||((m=o._data._customData)==null?void 0:m._bpmChanges),(f=o._info._customData)==null?void 0:f._editorOffset),l=lo(i,o._info._noteJumpMovementSpeed,o._info._noteJumpStartBeatOffset),a={_bpm:i,_njs:l,_audioDuration:(d=b._duration)!=null?d:null,_mapDuration:i.toRealTime(nn(o._data))},s=Ga().sort((y,E)=>y.order.output-E.order.output);console.log(`analysing ${t} ${e}`);const u=[];s.forEach(y=>{if(y.input.enabled)try{y.run(a,o,n),y.output.html&&u.push(y.output.html)}catch(E){console.error(E)}}),r?r.html=u:(v=b._analysis)==null||v.mapSet.push({mode:t,difficulty:e,html:u})},Iu=t=>{Ga().sort((n,o)=>n.order.output-o.order.output).forEach(n=>{n.input.adjustTime&&n.input.adjustTime(t)})},Ru=()=>{var n;let t=b._mapInfo;if(!t){console.error("could not analyse, missing map info");return}let e=rt(t._beatsPerMinute);b._analysis||Xr(),(n=b._mapSet)==null||n.forEach(o=>{var r;return(r=b._analysis)==null?void 0:r.sps.push({mode:o._mode,difficulty:o._difficulty,sps:Pi(o._data,e)})})},Ja=()=>{var t;(t=b._mapSet)==null||t.forEach(e=>Ua(e._mode,e._difficulty))},V="UI Tools: ",It=document.querySelectorAll(".tools__select-mode"),Rt=document.querySelectorAll(".tools__select-difficulty"),Mu=document.querySelectorAll(".difficulty__label"),Yr=document.querySelector(".tools__note-content"),Kr=document.querySelector(".tools__obstacle-content"),zr=document.querySelector(".tools__event-content"),Wr=document.querySelector(".tools__other-content"),Q=document.querySelector(".tools__output-diff"),tt=document.querySelector(".tools__output-general"),Va=document.querySelector(".tools__apply-this"),Xa=document.querySelector(".tools__apply-all");(!Yr||!Kr||!zr||!Wr)&&console.error(V+"missing content element");(!Q||!tt)&&console.error(V+"missing output element");Va&&Xa?(Va.addEventListener("click",Pu),Xa.addEventListener("click",Ou)):console.error(V+"missing apply element");It.forEach(t=>t.addEventListener("change",Hu));Rt.forEach(t=>t.addEventListener("change",Nu));const Du=()=>{var e;if(!tt)throw new Error(V+"output general is missing");const t=(e=b._analysis)==null?void 0:e.general;if(!t){tt.textContent="ERROR: could not find analysis for general";return}if(!t.html){tt.textContent="ERROR: could not find HTML for general";return}tt.innerHTML="",t.html.forEach(n=>tt.appendChild(n)),tt.firstChild||(tt.textContent="No issues found.")},je=(t,e)=>{var o;if(!t&&!e&&(t=It[0].value,e=Rt[0].value),!t||!e)throw new Error(V+"something went wrong!");if(!Q)throw new Error(V+"output difficulty is missing");Q.innerHTML="";const n=(o=b._analysis)==null?void 0:o.mapSet.find(r=>r.difficulty===e&&r.mode===t);if(!n){Q.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!n.html){Q.textContent="ERROR: could not find HTML for "+t+" "+e;return}n.html.forEach(r=>Q.appendChild(r)),Q.firstChild||(Q.textContent="No issues found.")},Zr=t=>{Mu.forEach(e=>e.textContent=t)},Ya=t=>{if(!t)return;Rt.forEach(n=>{for(let o=n.options.length-1;o>=0;o--)n.remove(o)});let e=!0;t._difficultyBeatmaps.forEach(n=>{Rt.forEach(o=>{var i,l,a,s;const r=document.createElement("option");if(r.value=n._difficulty,r.textContent=ue[n._difficulty]+(((i=n._customData)==null?void 0:i._difficultyLabel)?" -- "+((l=n._customData)==null?void 0:l._difficultyLabel):""),e){const u=(a=b._mapSet)==null?void 0:a.find(_=>_._difficulty===n._difficulty&&_._mode===t._beatmapCharacteristicName);if(!u)throw new Error("missing _mapSetData");ca(u),Zr(((s=n._customData)==null?void 0:s._difficultyLabel)||ue[n._difficulty]),je(t._beatmapCharacteristicName,n._difficulty)}e=!1,o.add(r)})})},Ka=t=>{if(!t){It.forEach(n=>Zn(n)),Rt.forEach(n=>Zn(n));return}let e=!0;t._difficultyBeatmapSets.forEach(n=>{It.forEach(o=>{const r=document.createElement("option");r.value=n._beatmapCharacteristicName,r.textContent=tn[n._beatmapCharacteristicName],o.add(r)}),e&&Ya(n),e=!1})},Bu=()=>{const t=b._mapInfo;if(!t)throw new Error(V+"could not find map info");const e=rt(t._beatsPerMinute);Iu(e)};function Hu(t){var o;const e=t.target;It.forEach(r=>{r!==e&&(r.value=e.value)});const n=(o=b._mapInfo)==null?void 0:o._difficultyBeatmapSets.find(r=>r._beatmapCharacteristicName===e.value);Ya(n)}function Nu(t){var r,i,l,a;const e=t.target;Rt.forEach(s=>{s!==e&&(s.value=e.value)});const n=(r=b._mapInfo)==null?void 0:r._difficultyBeatmapSets.find(s=>s._beatmapCharacteristicName===It.item(0).value);if(!n)throw new Error("aaaaaaaaaaaaaaaaaaa");const o=(i=b._mapSet)==null?void 0:i.find(s=>s._difficulty===e.value&&s._mode===n._beatmapCharacteristicName);o&&(ca(o),Zr(((a=(l=o._info)==null?void 0:l._customData)==null?void 0:a._difficultyLabel)||ue[e.value]),je(o._mode,o._difficulty))}function Pu(){const t=It[0].value,e=Rt[0].value;if(!t||!e)throw new Error(V+"mode/difficulty does not exist");L("info",`Re-analysing ${t} ${e}`,100),Ua(t,e),L("info",`Re-analysed ${t} ${e}`,100),je(t,e)}function Ou(){const t=It[0].value,e=Rt[0].value;if(!t||!e)throw new Error(V+"mode/difficulty does not exist");L("info","Re-analysing all difficulties",100),Ja(),L("info","Re-analysed all difficulties",100),je(t,e)}const Fu=()=>{if(!Yr||!Kr||!zr||!Wr){console.error(V+"could not find tools content");return}ku().sort((e,n)=>e.order.input-n.order.input).forEach(e=>{if(e.input.html)switch(e.type){case"note":{Yr.appendChild(e.input.html);break}case"obstacle":{Kr.appendChild(e.input.html);break}case"event":{zr.appendChild(e.input.html);break}case"other":{Wr.appendChild(e.input.html);break}case"general":{console.log(V+"ignoring general tool for "+e.name);break}default:console.error(V+"could not recognise type "+e.type+" for "+e.name)}})},ju=()=>{tt&&(tt.innerHTML="No output."),Q&&(Q.innerHTML="No output.")},qu=()=>{ju(),Zr("Difficulty Label"),Ka()},et="UI Stats: ",h="stats__",ve=document.querySelector("#stats .accordion__collapsible"),Gu=(t,e)=>{const n=rt(t._beatsPerMinute),o=lo(n,e._info._noteJumpMovementSpeed||so[e._difficulty],e._info._noteJumpStartBeatOffset),r=document.createElement("table");return r.className=h+"table",r.innerHTML=`<caption class="${h}table-caption">Map Settings:</caption>
    <tr>
    <th class="${h}table-header" colspan="2">Note Jump Speed</th>
    <td class="${h}table-element">${p(o.value,3)}</td>
    </tr>
    <tr>
    <th class="${h}table-header" colspan="2">Spawn Distance Modifier</th>
    <td class="${h}table-element">${p(o.offset,3)}</td>
    </tr>
    <tr>
    <th class="${h}table-header" colspan="2">Half Jump Duration</th>
    <td class="${h}table-element">${p(o.hjd,3)}</td>
    </tr>
    <tr>
    <th class="${h}table-header" colspan="2">Jump Distance</th>
    <td class="${h}table-element">${p(o.jd,3)}</td>
    </tr>
    <tr>
    <th class="${h}table-header" colspan="2">Reaction Time</th>
    <td class="${h}table-element">${p(o.reactTime*1e3)}ms</td>
    </tr>`,r},Uu=(t,e)=>{const n=rt(t._beatsPerMinute),o=b._duration||0,r=n.toRealTime(nn(e._data)),i=document.createElement("table");return i.className=h+"table",i.innerHTML=`<caption class="${h}table-caption">Note Per Seconds (NPS):</caption>
    <tr>
    <th class="${h}table-header" colspan="2">Overall</th>
    <td class="${h}table-element">${p(Ri(e._data._notes,o),2)}</td>
    </tr>
    <tr>
    <th class="${h}table-header" colspan="2">Mapped</th>
    <td class="${h}table-element">${p(Ri(e._data._notes,r),2)}</td>
    </tr>
    <tr>
    <th class="${h}table-header" rowspan="3">Peak</th>
    <th class="${h}table-header">16-beat</th>
    <td class="${h}table-element">${p(go(e._data._notes,16,n.value),2)}</td>
    </tr>
    <tr>
    <th class="${h}table-header">8-beat</th>
    <td class="${h}table-element">${p(go(e._data._notes,8,n.value),2)}</td>
    </tr>
    <tr>
    <th class="${h}table-header">4-beat</th>
    <td class="${h}table-element">${p(go(e._data._notes,4,n.value),2)}</td>
    </tr>`,i},Ju=(t,e)=>{const n=rt(t._beatsPerMinute),o=Pi(e._data,n),r=document.createElement("table");return r.className=h+"table",r.innerHTML=`<caption class="${h}table-caption">Swing Per Seconds (SPS):</caption>
    <tr>
    <th class="${h}table-header"></th>
    <th class="${h}table-header">Total</th>
    <th class="${h}table-header">Red</th>
    <th class="${h}table-header">Blue</th>
    </tr>
    <tr>
    <th class="${h}table-header">Overall</th>
    <td class="${h}table-element">${p(o.total.overall,2)}</td>
    <td class="${h}table-element">${p(o.red.overall,2)}</td>
    <td class="${h}table-element">${p(o.blue.overall,2)}</td>
    </tr>
    <tr>
    <th class="${h}table-header">Median</th>
    <td class="${h}table-element">${p(o.total.median,2)}</td>
    <td class="${h}table-element">${p(o.red.median,2)}</td>
    <td class="${h}table-element">${p(o.blue.median,2)}</td>
    </tr>
    <tr>
    <th class="${h}table-header">Peak</th>
    <td class="${h}table-element">${p(o.total.peak,2)}</td>
    <td class="${h}table-element">${p(o.red.peak,2)}</td>
    <td class="${h}table-element">${p(o.blue.peak,2)}</td>
    </tr>
    <tr>
    <th class="${h}table-header">Total</th>
    <td class="${h}table-element">${o.total.total}</td>
    <td class="${h}table-element">${o.red.total}</td>
    <td class="${h}table-element">${o.blue.total}</td>
    </tr>`,r},Vu=(t,e)=>{const n=Ii(e._data._notes);let o=`<caption class="${h}table-caption">Notes: ${n.red.total+n.blue.total}<br>R/B Ratio: ${p(n.red.total/n.blue.total,2)}</caption>
    <tr>
    <th class="${h}table-header"></th>
    <th class="${h}table-header">Red</th>
    <th class="${h}table-header">Blue</th>
    <th class="${h}table-header">Bomb</th>
    </tr>
    <tr>
    <th class="${h}table-header">Total</th>
    <td class="${h}table-element">${n.red.total}</td>
    <td class="${h}table-element">${n.blue.total}</td>
    <td class="${h}table-element">${n.bomb.total}</td>
    </tr>`;(n.red.chroma||n.blue.chroma||n.bomb.chroma)&&(o+=`<tr>
        <th class="${h}table-header">Chroma</th>
        <td class="${h}table-element">${n.red.chroma}</td>
        <td class="${h}table-element">${n.blue.chroma}</td>
        <td class="${h}table-element">${n.bomb.chroma}</td>
        </tr>`),(n.red.noodleExtensions||n.blue.noodleExtensions||n.bomb.noodleExtensions)&&(o+=`<tr>
        <th class="${h}table-header">NE</th>
        <td class="${h}table-element">${n.red.noodleExtensions}</td>
        <td class="${h}table-element">${n.blue.noodleExtensions}</td>
        <td class="${h}table-element">${n.bomb.noodleExtensions}</td>
        </tr>`),(n.red.mappingExtensions||n.blue.mappingExtensions||n.bomb.mappingExtensions)&&(o+=`<tr>
        <th class="${h}table-header">ME</th>
        <td class="${h}table-element">${n.red.mappingExtensions}</td>
        <td class="${h}table-element">${n.blue.mappingExtensions}</td>
        <td class="${h}table-element">${n.bomb.mappingExtensions}</td>
        </tr>`);const r=document.createElement("table");return r.className=h+"table",r.innerHTML=o,r};function Xu(t){var s,u;const e=t.target,n=e.id.replace(`${h}table-select-placement-`,"").split("-"),o=n[0],r=n[1],i=(u=(s=b._mapSet)==null?void 0:s.find(_=>_._mode===o&&_._difficulty===r))==null?void 0:u._data._notes;if(!i){console.error(et+"note could not be found");return}let l;switch(e.value){case"note":{l=i.filter(_=>S(_));break}case"red":{l=i.filter(_=>_._type===0);break}case"blue":{l=i.filter(_=>_._type===1);break}case"bomb":{l=i.filter(_=>_._type===3);break}default:l=i}const a=document.querySelector(`#${h}table-placement-${o}-${r}`);if(!a){console.error(et+"table could not be found");return}a.innerHTML=za(l)}function za(t){const e=t.length||1;let n="";for(let o=2;o>=0;o--){n+="<tr>";for(let r=0;r<=3;r++)n+=`<td class="${h}table-element">${Wl(t,r,o)}</td>`;n+=`<td class="${h}table-element ${h}table--no-border">${p(zl(t,o)/e*100,1)}%</td>
        </tr>`}return n+=`<tr>
    <td class="${h}table-element ${h}table--no-border">${p(ln(t,0)/e*100,1)}%</td>
    <td class="${h}table-element ${h}table--no-border">${p(ln(t,1)/e*100,1)}%</td>
    <td class="${h}table-element ${h}table--no-border">${p(ln(t,2)/e*100,1)}%</td>
    <td class="${h}table-element ${h}table--no-border">${p(ln(t,3)/e*100,1)}%</td>
    </tr>`,n}const Yu=(t,e)=>{var i;const n=Pe(`${h}table-select-placement-${e._mode}-${e._difficulty}`,"Note Placement: ","caption",`${h}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Bomb",value:"bomb"});(i=n.querySelector("select"))==null||i.addEventListener("change",Xu);let o=`<tbody id="${h}table-placement-${e._mode}-${e._difficulty}">${za(e._data._notes)}</tbody>`;const r=document.createElement("table");return r.className=h+"table",r.innerHTML=o,r.prepend(n),r};function Ku(t){var s,u;const e=t.target,n=e.id.replace(`${h}table-select-angle-`,"").split("-"),o=n[0],r=n[1],i=(u=(s=b._mapSet)==null?void 0:s.find(_=>_._mode===o&&_._difficulty===r))==null?void 0:u._data._notes;if(!i){console.error(et+"note could not be found");return}let l;switch(e.value){case"note":{l=i.filter(_=>S(_));break}case"red":{l=i.filter(_=>_._type===0);break}case"blue":{l=i.filter(_=>_._type===1);break}case"bomb":{l=i.filter(_=>_._type===3);break}default:l=i}const a=document.querySelector(`#${h}table-angle-${o}-${r}`);if(!a){console.error(et+"table could not be found");return}a.innerHTML=Wa(l)}function Wa(t){const e=t.length||1,n=[4,0,5,2,8,3,6,1,7];let o="";for(let r=0;r<3;r++){o+="<tr>";for(let i=0;i<3;i++){let l=Zl(t,n[r*3+i]);o+=`<td class="${h}table-element">${l}<br>(${p(l/e*100,1)}%)</td>`}o+="</tr>"}return o}const zu=(t,e)=>{var i;const n=Pe(`${h}table-select-angle-${e._mode}-${e._difficulty}`,"Note Angle: ","caption",`${h}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Bomb",value:"bomb"});(i=n.querySelector("select"))==null||i.addEventListener("change",Ku);let o=`<tbody id="${h}table-angle-${e._mode}-${e._difficulty}">${Wa(e._data._notes)}</tbody>`;const r=document.createElement("table");return r.className=h+"table",r.innerHTML=o,r.prepend(n),r},Wu=(t,e)=>{const n=rt(t._beatsPerMinute),o=Ii(e._data._notes);let r=`<caption class="${h}table-caption">Note Information:</caption>
    <tr>
    <th class="${h}table-header" colspan="2">Max Score</th>
    <td class="${h}table-element">${hl(ts(o.red.total+o.blue.total))}</td>
    </tr>
    <tr>
    <th class="${h}table-header" colspan="2">Effective BPM</th>
    <td class="${h}table-element">${p(es(e._data._notes,n),2)}</td>
    </tr>
    <tr>
    <th class="${h}table-header" colspan="2">Effective BPM (swing)</th>
    <td class="${h}table-element">${p(ns(e._data._notes,n),2)}</td>
    </tr>`,i=p(os(e._data._notes,n)*1e3,1),l=p(rs(e._data._notes,n)*1e3,1);i&&l&&(r+=`
        <tr>
        <th class="${h}table-header" colspan="2">Min. Slider Speed</th>
        <td class="${h}table-element">${i}ms</td>
        </tr>
        <tr>
        <th class="${h}table-header" colspan="2">Max. Slider Speed</th>
        <td class="${h}table-element">${l}ms</td>
        </tr>`);const a=document.createElement("table");return a.className=h+"table",a.innerHTML=r,a},Zu=(t,e)=>{const n=Gl(e._data._events,e._environment);let o=0,r=0,i=0,l=0,a=`<caption class="${h}table-caption">Events: ${Object.values(n).reduce((u,{total:_})=>u+_,0)}</caption>`;for(const u in n)o+=n[u].chroma,r+=n[u].chromaOld,i+=n[u].noodleExtensions,l+=n[u].mappingExtensions,a+=`<tr>
        <th class="${h}table-header" colspan="2">${mo[u]}</th>
        <td class="${h}table-element">${n[u].total}</td>
        </tr>`;o&&(a+=`<tr>
        <th class="${h}table-header" colspan="2">Chroma</th>
        <td class="${h}table-element">${o}</td>
        </tr>`),r&&(a+=`<tr>
        <th class="${h}table-header" colspan="2">OG Chroma</th>
        <td class="${h}table-element">${r}</td>
        </tr>`),i&&(a+=`<tr>
        <th class="${h}table-header" colspan="2">Noodle Extensions</th>
        <td class="${h}table-element">${i}</td>
        </tr>`),l&&(a+=`<tr>
        <th class="${h}table-header" colspan="2">Mapping Extensions</th>
        <td class="${h}table-element">${l}</td>
        </tr>`);const s=document.createElement("table");return s.className=h+"table",s.innerHTML=a,s},Qu=(t,e)=>{const n=Sl(e._data._obstacles);let o=`<caption class="${h}table-caption">Obstacles: ${n.total}</caption>`;n.interactive&&(o+=`<tr>
        <th class="${h}table-header" colspan="2">Interactive</th>
        <td class="${h}table-element">${n.interactive}</td>
        </tr>`),n.crouch&&(o+=`<tr>
        <th class="${h}table-header" colspan="2">Crouch</th>
        <td class="${h}table-element">${n.crouch}</td>
        </tr>`),n.chroma&&(o+=`<tr>
        <th class="${h}table-header" colspan="2">Chroma</th>
        <td class="${h}table-element">${n.chroma}</td>
        </tr>`),n.noodleExtensions&&(o+=`<tr>
        <th class="${h}table-header" colspan="2">Noodle Extensions</th>
        <td class="${h}table-element">${n.noodleExtensions}</td>
        </tr>`),n.mappingExtensions&&(o+=`<tr>
        <th class="${h}table-header" colspan="2">Mapping Extensions</th>
        <td class="${h}table-element">${n.mappingExtensions}</td>
        </tr>`);const r=document.createElement("table");return r.className=h+"table",r.innerHTML=o,r},tm=()=>{if(!ve){console.error(et+"HTML stats does not exist");return}if(!b._mapInfo)throw new Error(et+"map info could not be found in savedData");if(!b._mapSet)throw new Error(et+"map data could not be found in savedData");const t=b._mapInfo;t._difficultyBeatmapSets.forEach(e=>{const n=document.createElement("div");n.className=h+"mode-"+e._beatmapCharacteristicName;const o=document.createElement("div");o.className=h+"title",o.textContent=tn[e._beatmapCharacteristicName],n.appendChild(o),e._difficultyBeatmaps.forEach(r=>{var g,m,f;const i=(g=b._mapSet)==null?void 0:g.find(d=>d._mode===e._beatmapCharacteristicName&&d._difficulty===r._difficulty);if(!i)throw new Error(et+"Could not find map data");const l=ml(`${h}${e._beatmapCharacteristicName}-${r._difficulty}`,ue[r._difficulty]+(((m=r._customData)==null?void 0:m._difficultyLabel)?" -- "+((f=r._customData)==null?void 0:f._difficultyLabel):""),r._difficulty,!0),a=l.querySelector(".accordion__collapsible-flex"),s=l.querySelector(".accordion__button");if(!a||!s)throw new Error(et+"something went wrong!");s.checked=C.onLoad.stats;const u=dn("small","half"),_=dn("small","half"),c=dn("small","half");u.append(Gu(t,i)),u.append(document.createElement("br")),u.append(Uu(t,i)),u.append(document.createElement("br")),u.append(Ju(t,i)),_.append(Wu(t,i)),_.append(document.createElement("br")),_.append(Yu(t,i)),_.append(document.createElement("br")),_.append(zu(t,i)),c.append(Vu(t,i)),c.append(document.createElement("br")),c.append(Zu(t,i)),c.append(document.createElement("br")),c.append(Qu(t,i)),a.appendChild(u),a.appendChild(_),a.appendChild(c),n.appendChild(l)}),ve.appendChild(n)})},em=()=>{if(!ve){console.error(et+"HTML stats does not exist");return}for(;ve.firstChild;)ve.removeChild(ve.firstChild)},Za=async t=>new Promise(function(e,n){const o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="json",o.timeout=5e3;let r=Date.now();o.onprogress=()=>{o.timeout+=Date.now()-r},o.onload=()=>{o.status===200&&e(o.response),o.status===404&&n("Error 404: Map does not exist"),o.status===403&&n("Error 403: Forbidden"),n(`Error ${o.status}`)},o.onerror=()=>{n("Error downloading")},o.ontimeout=()=>{n("Connection timeout")},o.send()}),nm=async t=>{const e=`https://api.beatsaver.com/maps/id/${t}`,n=await Za(e);if(n==null?void 0:n.versions.length)return n.versions[n.versions.length-1].downloadURL;throw new Error("could not find map download link")},om=async t=>{const e=`https://api.beatsaver.com/maps/hash/${t}`,n=await Za(e);if(n==null?void 0:n.versions.length)return n.versions[n.versions.length-1].downloadURL;throw new Error("could not find map download link")},Xn=async t=>{let e;try{e=pi(t)}catch(n){throw L("info",n,0),console.error(n),new Error(n)}try{at(!0),console.log(`fetching download URL from BeatSaver for map ID ${e}`),L("info","Fetching download URL from BeatSaver",0);const n=await nm(e);console.log(`downloading from BeatSaver for map ID ${e}`),L("info","Requesting download from BeatSaver",0);const o=await ti(n);io("https://beatsaver.com/maps/"+e,e),qe(o)}catch(n){at(!1),L("error",n,100),console.error(n)}},Qr=async t=>{let e;try{e=_i(t)}catch(n){L("info",n,0),console.error(n);return}if(e.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//)){Xn(e.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);return}try{at(!0),L("info","Requesting download from link",0),console.log(`downloading from ${e}`);let n=await ti(e);io(e),qe(n)}catch(n){at(!1),L("error",n,100)}},Qa=async t=>{let e;try{if(hi(t.trim()))e=t.trim();else throw new Error("invalid hash")}catch(n){throw L("info",n,0),console.error(n),new Error(n)}try{at(!0),console.log(`fetching download URL from BeatSaver for map hash ${e}`),L("info","Fetching download URL from BeatSaver",0);const n=await om(e);console.log(`downloading from BeatSaver for map hash ${e}`),L("info","Requesting download from BeatSaver",0);const o=await ti(n);qe(o)}catch(n){at(!1),L("error",n,100),console.error(n)}},ti=async t=>new Promise(function(e,n){const o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.timeout=5e3;let r=Date.now();o.onprogress=i=>{o.timeout+=Date.now()-r,L("download",`Downloading map: ${p(i.loaded/1024/1024,1)}MB / ${p(i.total/1024/1024,1)}MB`,i.loaded/i.total*100)},o.onload=()=>{o.status===200&&e(o.response),o.status===404&&n("Error 404: Map/link does not exist"),o.status===403&&n("Error 403: Forbidden"),n(`Error ${o.status}`)},o.onerror=()=>{n("Error downloading")},o.ontimeout=()=>{n("Connection timeout")},o.send()}),qe=async t=>{L("info","Extracting zip",0);let e=new ci;console.time("loading time");try{ro(!0),e=await ci.loadAsync(t),await rm(e)}catch(n){Ui(),at(!1),ro(!1),L("error",n,100),console.error(n)}console.timeEnd("loading time")},rm=async t=>{var n,o,r;L("info","Parsing map info...",0),console.log("parsing map info");const e=t.file("Info.dat")||t.file("info.dat");if(e){at(!0);let i=await e.async("string");b._mapInfo=await JSON.parse(i),us(b._mapInfo),fs(b._mapInfo),L("info","Loading image...",10.4375),console.log("loading cover image");let l=t.file(b._mapInfo._coverImageFilename);if(C.load.imageCover&&l){let u=await l.async("base64");fi("data:image;base64,"+u),xn.map.load.image=!0}else console.error(`${b._mapInfo._coverImageFilename} does not exists.`);if(b._contributors=[],(o=(n=b._mapInfo)==null?void 0:n._customData)==null?void 0:o._contributors)for(const u of b._mapInfo._customData._contributors)console.log("loading contributor image "+u._name),l=t.file(u._iconPath),C.load.imageContributor&&l?u._base64=await l.async("base64"):console.error(`${u._iconPath} does not exists.`),b._contributors.push(u);L("info","Loading audio...",20.875),console.log("loading audio");let a=t.file(b._mapInfo._songFilename);if(C.load.audio&&a){let u=!1;setTimeout(()=>{u||L("info","Loading audio... (this may take a while)",20.875)},1e4);let _=await a.async("arraybuffer");Tl(_),await new AudioContext().decodeAudioData(_).then(g=>{u=!0;let m=g.duration;b._duration=m,Ze(m),xn.map.load.audio=!0}).catch(function(g){Ze(),console.error(g)})}else Ze(),console.error(`${b._mapInfo._songFilename} does not exist.`);L("info","Parsing difficulty...",70),b._mapSet=[];const s=b._mapInfo._difficultyBeatmapSets;for(let u=s.length-1;u>=0;u--){const _=s[u]._difficultyBeatmaps;if(_.length===0||!_){console.error("Empty difficulty set, removing..."),s.splice(u,1);continue}for(let c=0;c<_.length;c++){const g=_[c],m=t.file(g._beatmapFilename);if(m){console.log(`parsing ${s[u]._beatmapCharacteristicName} ${g._difficulty}`);let f=JSON.parse(await m.async("string")),d;try{d=ms(f)}catch(v){throw new Error(`${s[u]._beatmapCharacteristicName} ${g._difficulty} ${v}`)}(r=b._mapSet)==null||r.push({_mode:s[u]._beatmapCharacteristicName,_difficulty:g._difficulty,_info:g,_data:d,_environment:b._mapInfo._environmentName})}else if(console.error(`Missing ${g._beatmapFilename} file for ${s[u]._beatmapCharacteristicName} ${g._difficulty}, ignoring.`),s[u]._difficultyBeatmaps.splice(c,1),c--,s[u]._difficultyBeatmaps.length<1){console.error(`${s[u]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),s.splice(u,1);continue}}}Bu(),L("info","Adding map difficulty stats...",80),console.log("adding map stats"),tm(),zi(b._contributors),L("info","Analysing map...",85),console.log("analysing map"),Ru(),Su(),Du(),L("info","Analysing difficulty...",90),Ja(),Ka(b._mapInfo),je(),at(!1),L("info","Map successfully loaded!")}else throw new Error("Couldn't find Info.dat")},Te="UI Intro: ",Ge=document.querySelector(".input__intro-url"),Ue=document.querySelector(".input__intro-id"),Je=document.querySelector(".input__intro-hash"),tl=document.querySelector(".input__search-button"),el=document.querySelector(".input__file"),ei=document.querySelector(".input__file-zone");Ge?Ge.addEventListener("keydown",ni):console.error(Te+"URL input is missing");Ue?Ue.addEventListener("keydown",ni):console.error(Te+"ID input is missing");Je?Je.addEventListener("keydown",ni):console.error(Te+"Hash input is missing");tl?tl.addEventListener("click",im):console.error(Te+"search button is missing");el?el.addEventListener("change",am):console.error(Te+"file input is missing");ei?(ei.addEventListener("drop",lm),ei.addEventListener("dragover",sm)):console.error(Te+"file drop zone is missing");function ni(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&Qr(e.value),e.classList.contains("input__intro-id")&&Xn(e.value))}function im(t){if(Ge&&Ge.value!==""){Qr(Ge.value);return}if(Ue&&Ue.value!==""){Xn(Ue.value);return}if(Je&&Je.value!==""){Qa(Je.value);return}}function am(t){const e=t.target;L("info","Reading file input",0);const n=e.files?e.files[0]:null;try{if(n==null)throw L("info","No file input",0),new Error("No file input");if(n&&(n.name.substr(-4)===".zip"||n.name.substr(-4)===".bsl")){const o=new FileReader;o.readAsArrayBuffer(n),o.addEventListener("load",()=>{qe(n)})}else throw new Error("Unsupported file format, please enter zip file")}catch(o){L("error",o,0),console.error(o)}}function lm(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items&&t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(e),n.addEventListener("load",()=>{qe(e)})}else throw new Error("Unsupported file format, please enter zip file")}}catch(e){L("error",e,0),console.error(e)}}function sm(t){t.preventDefault(),t.stopPropagation()}const cm=["Dark","Light","Monochrome"],um=document.querySelector("body"),nl=t=>{um.className="theme-"+t.toLowerCase().replace(" ","")},se="UI Settings: ",Ve=document.querySelector(".settings__theme"),oi=document.querySelectorAll(".settings__load"),Yn=document.querySelector(".settings__sort"),ri=document.querySelectorAll(".settings__show"),ii=document.querySelectorAll(".settings__onload"),ol=document.querySelector(".settings__clear-button");Ve?(Ve.addEventListener("change",mm),cm.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,Ve.add(e)})):console.error(se+"theme select is missing");oi.length||console.error(se+"empty load list, intentional or typo error?");oi.forEach(t=>t.addEventListener("change",fm));Yn?Yn.addEventListener("change",pm):console.error(se+"sort check is missing");ii.length||console.error(se+"empty onload list, intentional or typo error?");ii.forEach(t=>t.addEventListener("change",bm));ri.length||console.error(se+"empty show list, intentional or typo error?");ri.forEach(t=>t.addEventListener("change",dm));ol?ol.addEventListener("click",vm):console.error(se+"clear button is missing");function mm(t){const e=t.target;C.theme=e.options[e.options.selectedIndex].value,nl(C.theme),C.save()}function dm(t){const e=t.target,n=e.id.replace("settings__show-","");C.show[n]=e.checked,C.save()}const _m=(t,e)=>{ri.forEach(n=>{n.id.endsWith(t)&&(n.checked=e)})};function pm(t){const e=t.target;C.sorting=e.checked,C.save()}const hm=t=>{Yn&&(Yn.checked=t)};function fm(t){const e=t.target,n=e.name;C.load[n]=e.checked,C.save()}const gm=(t,e)=>{oi.forEach(n=>{n.name===t&&(n.checked=e)})};function bm(t){const e=t.target,n=e.name;C.onLoad[n]=e.checked,C.save()}const ym=(t,e)=>{ii.forEach(n=>{n.name===t&&(n.checked=e)})},Em=t=>{if(!Ve){console.error(se+"input element is missing");return}Ve.value=t};function vm(){C.clear(),C.reset(),location.reload()}const Tm=document.querySelectorAll(".input__reset-button");Tm.forEach(t=>t.addEventListener("click",$m));function $m(){Es(),Ll(),bs(),qu(),em(),Ui()}const Lm=2,wm=4,Cm=0,xm="Kival Evan#5480";class Am{constructor(){this._version=`v${Lm}.${wm}.${Cm}`,this._wm=xm}get value(){return this._version}get watermark(){return this._wm}}var rl=new Am;const km="UI Footer: ",il=document.querySelectorAll(".link__watermark"),al=document.querySelectorAll(".link__version");(!il.length||!al.length)&&console.error(km+"missing part");const Sm=t=>{il.forEach(e=>e.textContent=t)},Im=t=>{al.forEach(e=>e.textContent=t)};var Rm=function(){let t=!1;return function(){if(!t){t=!0,Em(C.theme),Sm(rl.watermark),Im(rl.value),Fu();for(const e in C.load)gm(e,C.load[e]);hm(C.sorting);for(const e in C.show)dl(e,C.show[e]),_m(e,C.show[e]);for(const e in C.onLoad)ym(e,C.onLoad[e]);nl(C.theme),console.log("user interface initialised.")}}}();const ai=new URL(location.href),ll=ai.searchParams.get("url"),sl=ai.searchParams.get("id"),li=ai.searchParams.get("hash");Rm();ll?Qr(_i(decodeURI(ll))):sl?Xn(pi(decodeURI(sl))):li&&hi(decodeURI(li).trim())&&Qa(decodeURI(li).trim());
