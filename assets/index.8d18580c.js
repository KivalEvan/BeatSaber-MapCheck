var du=Object.defineProperty;var fu=(i,t,e)=>t in i?du(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var $=(i,t,e)=>(fu(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();var Xo=(i=>(i.none="",i.ExpertPlus="accordion__label--bg-expertplus",i.Expert="accordion__label--bg-expert",i.Hard="accordion__label--bg-hard",i.Normal="accordion__label--bg-normal",i.Easy="accordion__label--bg-easy",i))(Xo||{});const mu="UI Accordion: ",wn="accordion__",jo=document.querySelectorAll(".accordion__button");jo.length||console.error(mu+"empty accordion list, intentional or typo error?");const Yo={create:(i,t,e,n=!1)=>{const a=document.createElement("div");a.className="accordion";const o=document.createElement("input");o.className=wn+"button",o.id=i,o.setAttribute("type","checkbox");const r=document.createElement("label");r.className=wn+"label unselectable",r.htmlFor=i,r.textContent=t,e&&r.classList.add(Xo[e]);const s=document.createElement("div");return s.className=n?wn+"collapsible-flex":wn+"collapsible",s.id=i+"-content",a.appendChild(o),a.appendChild(r),a.appendChild(s),a},show:(i,t)=>{jo.forEach(e=>{e.id.endsWith(i)&&(e.checked=t)})}},Yr=new Map([[0,"VERBOSE"],[1,"DEBUG"],[2,"INFO"],[3,"WARN"],[4,"!!ERROR!!"],[5,"NONE"]]);class pu{constructor(){$(this,"logLevel",2)}log(t,...e){if(t<this.logLevel)return;const n=[Yr.get(t),">",...e];switch(t){case 1:return console.debug(...n);case 2:return console.info(...n);case 3:return console.warn(...n);case 4:return console.error(...n);default:return console.log(...n)}}setLevel(t){t=Math.min(t,5),this.logLevel=t,this.info("[logger::setLevel]",`Log level set to ${Yr.get(t)}`)}verbose(...t){this.log(0,...t)}debug(...t){this.log(1,...t)}info(...t){this.log(2,...t)}warn(...t){this.log(3,...t)}error(...t){this.log(4,...t)}}const et=new pu;function gu(i){return i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function M(i,t=0){return Math.round(i*Math.pow(10,t))/Math.pow(10,t)}function ka(i){return i*(180/Math.PI)}function xi(i){return i*(Math.PI/180)}function Ur(i,t){t<0&&(t=-t);const e=i%t;return e<0?e+t:e}function Gr(i,t,e){return Math.min(Ur(i-t,e),Ur(t-i,e))}function wa(i){if(i.length===0)return 0;i.sort((e,n)=>e-n);const t=Math.floor(i.length/2);return i.length%2?i[t]:(i[t-1]+i[t])/2}function Wr(i,t,e){return Math.min(Math.max(t,i),e)}function bt(i){if(typeof i!="object")throw new Error("Received non-object type");return JSON.parse(JSON.stringify(i))}function Uo(i){return/[a-fA-F0-9]*/g.test(i)}function Gn(i){const t=[i.r,i.g,i.b];return typeof i.a=="number"&&t.push(i.a),t}function Sn(i){const t=i.toString(16);return t.length===1?"0"+t:t}function _u(i){return i>1&&!(i<0)?255:M(i*255)}function $t(i){const t={r:0,g:0,b:0};for(const e in i){const n=i[e];n!==void 0&&(t[e]=_u(n))}return`#${Sn(t.r)}${Sn(t.g)}${Sn(t.b)}${typeof t.a=="number"?Sn(t.a):""}`}function Vr(i){let t=i[0],e=i[1],n=i[2],a,o,r;return t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,a=(t*.4124+e*.3576+n*.1805)/.95047,o=(t*.2126+e*.7152+n*.0722)/1,r=(t*.0193+e*.1192+n*.9505)/1.08883,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,[116*o-16,500*(a-o),200*(o-r)]}function Jr(i,t){let e=0;return i>=0&&t===0?0:i<0&&t===0?180:i===0&&t>0?90:i===0&&t<0?270:(i>0&&t>0&&(e=0),i<0&&(e=180),i>0&&t<0&&(e=360),ka(Math.atan(t/i))+e)}function xa(i,t){const[e,n,a]=Vr(i),[o,r,s]=Vr(t),l=1,u=1,c=1;let h,f,d,m,g,_,y,v,w,T,L,F,A,x,N,U,tt,S,P,b;return h=Math.sqrt(n*n+a*a),f=Math.sqrt(r*r+s*s),d=(h+f)/2,g=.5*(1-Math.sqrt((d^7)/((d^7)+30))),w=(1+g)*n,h=Math.sqrt(w*w+a*a),_=Jr(w,a),w=(1+g)*r,f=Math.sqrt(w*w+s*s),y=Jr(w,s),S=o-e,P=f-h,h*f==0?b=0:(w=M(y-_,12),Math.abs(w)<=180?b=y-_:w>180?b=y-_-360:b=y-_+360),b=2*Math.sqrt(h*f)*Math.sin(xi(b/2)),T=(e+o)/2,m=(h+f)/2,h*f==0?v=_+y:(w=Math.abs(M(_-y,12)),w>180?y+_<360?v=_+y+360:v=_+y-360:v=_+y,v/=2),L=1-.17*Math.cos(xi(v-30))+.24*Math.cos(xi(2*v))+.32*Math.cos(xi(3*v+6))-.2*Math.cos(xi(4*v-63)),N=30*Math.exp(-((v-275)/25)*((v-275)/25)),U=2*Math.sqrt((m^7)/((m^7)+30)),F=1+.015*((T-50)*(T-50))/Math.sqrt(20+(T-50)*(T-50)),A=1+.045*m,x=1+.015*m*L,tt=-Math.sin(xi(2*N))*U,S=S/(l*F),P=P/(u*A),b=b/(c*x),Math.sqrt(S*S+P*P+b*b+tt*P*b)}function kt(i){if(!i)return"0:00";const t=Math.floor(i),e=t/60,n=e<0?`-${Math.ceil(e).toString()}`:Math.floor(e).toString(),a=Math.abs(t%60).toString().padStart(2,"0");return`${n}:${a}`}function bu(i){if(!i)return"0:00:00";const t=Math.round(i*60%60).toString().padStart(2,"0");return`${kt(i)}:${t}`}function Nn(i){var e;if(!i)return"0:00.000";const t=((e=(i%1).toString().split(".")[1])==null?void 0:e.padEnd(3,"0").slice(0,3))||"000";return`${kt(i)}.${t}`}function Go(i){const t=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(i=i.trim(),/^http:\/\//.test(i)&&(i=i.replace("http://","https://")),t.test(i))return i;throw new Error("Invalid URL")}function Wo(i){const t=/^[0-9a-fA-F]{1,6}$/;if(i=i.trim(),/^!bsr /.test(i)&&(i=i.replace("!bsr ","")),t.test(i))return i;throw new Error("Invalid ID")}function Ra(i){for(let t=i.options.length-1;t>=0;t--)i.remove(t)}const nr="UI Header: ",Na=document.querySelector(".intro"),Ia=document.querySelector(".metadata"),fi=document.querySelector(".cover__link"),ar=document.querySelector(".cover__image"),Vo=document.querySelector(".metadata__song-name"),Jo=document.querySelector(".metadata__song-subname"),qo=document.querySelector(".metadata__song-author"),Zo=document.querySelector(".metadata__song-bpm"),Aa=document.querySelector(".metadata__song-duration"),Ko=document.querySelector(".audio");if(!Na||!Ia)throw new Error(nr+"header component is missing one of the two section");if(!fi||!ar)throw new Error(nr+"cover component is missing");if(!Vo||!Jo||!qo||!Zo||!Aa)throw new Error(nr+"metadata component is missing one of the part");function Qo(i){i?(Na.classList.remove("hidden"),Ia.classList.add("hidden")):(Na.classList.add("hidden"),Ia.classList.remove("hidden"))}function tl(i){ar.src=i||"./img/unknown.jpg"}function yu(){return ar.src}function el(i,t){if(i==null&&t==null){fi.textContent="",fi.href="",fi.classList.add("disabled");return}i!=null&&(fi.textContent=t!=null?t:"Download Link",fi.href=i,fi.classList.remove("disabled"))}function vu(i){Vo.textContent=i}function Eu(i){Jo.textContent=i}function Du(i){qo.textContent=i}function wu(i,t,e){t==null&&typeof e=="number"&&(t=Math.min(i,e)),e==null&&typeof t=="number"&&(e=Math.max(i,t));let n=M(i,2).toString()+"BPM";t&&e&&(n+=` (${M(t,2)}-${M(e,2)})`),Zo.textContent=n}function il(i){i?Aa.textContent=Nn(i):Aa.textContent="No audio"}async function Su(i){const t=new Blob([i],{type:"audio/ogg"});Ko.src=window.URL.createObjectURL(t)}function nl(){Ko.src="",window.URL.revokeObjectURL("")}function Tu(){Qo(!0),tl(null),el(),il(0),nl()}const Xt={switchHeader:Qo,setCoverImage:tl,getCoverImage:yu,setCoverLink:el,setSongName:vu,setSongSubname:Eu,setSongAuthor:Du,setSongBPM:wu,setSongDuration:il,setAudio:Su,unloadAudio:nl,reset:Tu},Xi=new class{constructor(){$(this,"loading",{info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1})}resetLoad(){this.loading.info=!1,this.loading.difficulty=!1,this.loading.analysis=!1,this.loading.audio=!1,this.loading.coverImage=!1,this.loading.contributorImage=!1,this.loading.finished=!1}},lt=new class{constructor(){$(this,"beatmapInfo",null);$(this,"beatmapDifficulty",[]);$(this,"contributors",[]);$(this,"analysis",null);$(this,"duration",null)}retrieveSafe(){if(!this.beatmapInfo)throw new Error("Beatmap info is not loaded.");if(!this.analysis)throw new Error("Beatmap analysis is not loaded.");if(this.duration===null)throw new Error("Audio is not loaded.");if(Xi.loading.finished)return{beatmapInfo:this.beatmapInfo,beatmapDifficulty:this.beatmapDifficulty,contributors:this.contributors,analysis:this.analysis,duration:this.duration};throw new Error("Could not retrieve saved data, loading process is not finished.")}clear(){Xi.loading.finished=!1,this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}},Fr=class{constructor(t,e=[],n=0){$(this,"_bpm");$(this,"_bpmChange");$(this,"_timeScale");$(this,"_offset");this._bpm=t,this._offset=n/1e3,this._timeScale=this.getTimeScale(e.filter(a=>{if(a.m===0)throw new Error("v3 BPM Change of value 0 detected.");return a.m!=null&&a.o==null})),this._bpmChange=this.getBPMChangeTime(e.filter(a=>a._time!=null||a.o!=null))}get value(){return this._bpm}set value(t){this._bpm=t}get change(){return this._bpmChange}set change(t){this._bpmChange=t}set timescale(t){this._timeScale=this.getTimeScale(t)}get offset(){return this._offset*1e3}set offset(t){this._offset=t/1e3}getBPMChangeTime(t=[]){var a,o,r,s,l;let e;const n=[];for(let u=0;u<t.length;u++){const c={time:(a=t[u]._time)!=null?a:t[u].b,BPM:(r=(o=t[u]._BPM)!=null?o:t[u]._bpm)!=null?r:t[u].m,beatsPerBar:(s=t[u]._beatsPerBar)!=null?s:t[u].p,metronomeOffset:(l=t[u]._metronomeOffset)!=null?l:t[u].o,newTime:0};e?c.newTime=Math.ceil((c.time-e.time)/this._bpm*e.BPM+e.newTime-.01):c.newTime=Math.ceil(c.time-this._offset*this._bpm/60-.01),n.push(c),e=c}return n}getTimeScale(t=[]){return t.map(e=>({time:e.b,scale:this._bpm/e.m}))}offsetBegone(t){return this.toBeatTime(this.toRealTime(t,!1)-this._offset)}toRealTime(t,e=!0){if(!e)return t/this._bpm*60;let n=0;for(let a=this._timeScale.length-1;a>=0;a--)t>this._timeScale[a].time&&(n+=(t-this._timeScale[a].time)*this._timeScale[a].scale,t=this._timeScale[a].time);return(t+n)/this._bpm*60}toBeatTime(t,e=!1){if(!e)return t*this._bpm/60;let n=0;for(let a=this._timeScale.length-1;a>=0;a--){const o=this.toRealTime(this._timeScale[a].time);t>o&&(n+=(t-o)/this._timeScale[a].scale,t=o)}return this.toBeatTime(t+n)}toJSONTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e].newTime)return(t-this._bpmChange[e].newTime)/this._bpmChange[e].BPM*this._bpm+this._bpmChange[e].time;return this.toBeatTime(this.toRealTime(t,!1)+this._offset)}adjustTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e].time)return(t-this._bpmChange[e].time)/this._bpm*this._bpmChange[e].BPM+this._bpmChange[e].newTime;return this.offsetBegone(t)}};let ye=Fr;$(ye,"create",(t,e,n)=>new Fr(t,e,n));const Lu={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",GlassDesertEnvironment:"Glass Desert"},Si={DefaultEnvironment:[[0,1,2,3,4,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,8,9,12,13],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],TheSecondEnvironment:[[0,1,2,3,4,9],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],LizzoEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,16,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]],TheWeekndEnvironment:[[0,1,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,29,30,31,32,33,34,35,36,37,38,40]]},_a="UI Info: ",Ba=document.querySelector(".info__version"),$a=document.querySelector(".info__play-time"),Oa=document.querySelector(".info__time-spend"),Ma=document.querySelector(".info__custom-color"),Pa=document.querySelector(".info__requirements"),Fa=document.querySelector(".info__suggestions"),Ha=document.querySelector(".info__information"),za=document.querySelector(".info__warnings"),Xa=document.querySelector(".info__bookmarks"),ja=document.querySelector(".info__bpm-changes"),Ya=document.querySelector(".info__environment-enhancement"),Ua=document.querySelector(".info__point-definitions"),Ga=document.querySelector(".info__custom-events"),al=document.querySelectorAll(".info__table-element");if(!Ba||!$a||!Oa||!Ma||!Pa||!Fa||!Ha||!za||!Xa||!ja||!Ya||!Ua||!Ga||!al)throw new Error(_a+"table info component is missing part");const Wa=document.querySelector(".info__level-author"),Va=document.querySelector(".info__environment"),In=document.querySelector(".info__editors"),An=document.querySelector(".info__contributors"),Wn=document.querySelector(".info__contributors-select"),Cu=document.querySelector(".info__contributors-image"),rl=document.querySelector(".info__contributors-name"),sl=document.querySelector(".info__contributors-role");if(!Wa||!Va||!In)throw new Error(_a+"info component is missing part");if(!An||!rl||!sl)throw new Error(_a+"contributors component is missing part");if(Wn)Wn.addEventListener("change",Nu);else throw new Error(_a+"contributors select is missing");function ol(i){if(!i){Wa.textContent="";return}Wa.textContent="Mapped by "+i}function ll(i){if(!i){Va.textContent="";return}Va.textContent=(Lu[i]||"Unknown")+" Environment"}function cl(i){if(!i||!i._lastEditedBy){In.classList.add("hidden");return}In.classList.remove("hidden");const t=i._lastEditedBy||"Undefined";let e="Last edited on "+t;if(i[t]){const n=i[t];e+=" v"+n.version}In.textContent=e}function ku(i){Cu.src=i||"./img/unknown.jpg"}function xu(i){rl.textContent=i}function Ru(i){sl.textContent=i}function ul(i){ku(i._base64?"data:image;base64,"+i._base64:null),xu(i._name),Ru(i._role)}function hl(i){if(An&&(!i||!i.length)){An.classList.add("hidden"),Ra(Wn);return}if(i){An.classList.remove("hidden");let t=!0;i.forEach((e,n)=>{t&&(t=!1,ul(e));const a=document.createElement("option");a.value=n.toString(),a.text=e._name+" -- "+e._role,Wn.add(a)})}}function Nu(i){const t=i.target;ul(lt.contributors[parseInt(t.value)])}const an={version:3,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",infoRowHeight:4,rounding:3,dataCheck:!0,dataError:!0,theme:"Dark",onLoad:{stats:!1},show:{info:!1,tools:!1,stats:!1,settings:!1}},it=new class{constructor(){$(this,"property",bt(an));$(this,"stringify",()=>JSON.stringify({settings:this.property}));$(this,"init",()=>{var e,n;if(localStorage==null)return;const t=localStorage.getItem("settings");if(t){const a=JSON.parse(t);if(!((e=a.settings)!=null&&e.version)){this.clear();return}this.property=(n=a.settings)!=null?n:this.property;for(const o in an)typeof this.property[o]>"u"&&(this.property[o]=an[o]);this.property.version=an.version,this.save()}});$(this,"save",()=>{localStorage&&localStorage.setItem("settings",this.stringify())});$(this,"clear",()=>{localStorage&&localStorage.clear()});$(this,"reset",()=>{this.property=bt(an)});this.init()}get version(){return this.property.version}get load(){return this.property.load}get sorting(){return this.property.sorting}set sorting(t){this.property.sorting=t}get beatNumbering(){return this.property.beatNumbering}set beatNumbering(t){this.property.beatNumbering=t}get infoRowHeight(){return this.property.infoRowHeight}set infoRowHeight(t){this.property.infoRowHeight=t}get rounding(){return this.property.rounding}set rounding(t){this.property.rounding=t}get dataCheck(){return this.property.dataCheck}set dataCheck(t){this.property.dataCheck=t}get dataError(){return this.property.dataError}set dataError(t){this.property.dataError=t}get theme(){return this.property.theme}set theme(t){this.property.theme=t}get onLoad(){return this.property.onLoad}get show(){return this.property.show}};var dl=(i=>(i.tiny="panel--tiny",i.small="panel--small",i.medium="panel--medium",i.large="panel--large",i.max="panel--max",i))(dl||{}),fl=(i=>(i.normal="panel--offset",i.half="panel--offset-half",i.none="",i))(fl||{});const sn={create:(i,t,e,n)=>{const a=document.createElement("div");return a.className=`panel ${dl[i]}`,t&&t!=="none"&&a.classList.add(fl[t]),e&&a.classList.add("panel--flex"+n?"-column":""),a}};function Kt(i){const t=i.querySelector(".info__table-element");t&&(t.innerHTML=""),i.classList.add("hidden")}function Qt(i,t){const e=i.querySelector(".info__table-element");if(e){for(;e.firstChild;)e.removeChild(e.firstChild);typeof t=="string"?e.textContent=t:(t.forEach(n=>{if(typeof n=="string"){const a=document.createElement("span");a.textContent=n,e.appendChild(a),e.appendChild(document.createElement("br"))}else e.appendChild(n),e.appendChild(document.createElement("br"))}),e.lastChild&&e.removeChild(e.lastChild))}i.classList.remove("hidden")}function ml(i){al.forEach(t=>t.style.maxHeight=`${i}rem`)}function pl(i,t){if(i==null||!i.length){Kt(Xa);return}const e=sn.create("max","none",!0);i.forEach((n,a)=>{let o=n.b,r;const s=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div");s.appendChild(l),s.appendChild(u),l.className="info__color-dot",l.style.backgroundColor="#000000",u.className="info__color-text",typeof n.n!="string"&&(u.textContent=`Error parsing bookmarks[${a}]`,e.appendChild(s)),t&&(o=t.adjustTime(o),r=t.toRealTime(o)),l.style.backgroundColor=n.c?$t({r:n.c[0],g:n.c[1],b:n.c[2]}):"#333333",u.textContent=`${M(n.b,it.rounding)}${r?" | "+kt(r):""} -- ${n.n!=""?n.n:"**EMPTY NAME**"}`,e.appendChild(s)}),Qt(Xa,[e])}function gl(i){if(!i||!i.change.length){Kt(ja);return}const t=i.change.map(e=>{const n=M(e.newTime,it.rounding),a=i.toRealTime(e.time);return`${n} | ${kt(a)} -- ${e.BPM}`});Qt(ja,t)}const ge={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",GlassDesertEnvironment:"Glass Desert"},Iu={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},_e={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.5320754,g:.5320754,b:.5320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"The Second":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8235294,g:.08627451,b:.8509804},_envColorRightBoost:{r:0,g:1,b:.6478302},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Lizzo:{_colorLeft:{r:1,g:.8132076,b:.3773585},_colorRight:{r:.6705883,g:.254902,b:.8980392},_envColorLeft:{r:.8392157,g:.6470588,b:.2156863},_envColorRight:{r:.8196079,g:.2392157,b:.8784314},_envColorLeftBoost:{r:1,g:.4,b:.5529412},_envColorRightBoost:{r:.3686275,g:.7960784,b:1},_obstacleColor:{r:1,g:.5020987,b:.1882353}},"The Weeknd":{_colorLeft:{r:.5843138,g:.1294118,b:.1294118},_colorRight:{r:.2235294,g:.2901961,b:.3294118},_envColorLeft:{r:1,g:.2979701,b:.1411765},_envColorRight:{r:.1668743,g:.3753689,b:.7075472},_envColorLeftBoost:{r:.9568628,g:.6039216,b:.1215686},_envColorRightBoost:{r:.5254902,g:.8274511,b:.9921569},_obstacleColor:{r:.9176471,g:.2980392,b:.007843138}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}};function _l(i,t){var l,u,c,h,f,d,m;if(!i||!i._colorLeft&&!i._colorRight&&!i._envColorLeft&&!i._envColorLeftBoost&&!i._envColorRight&&!i._envColorRightBoost&&!i._obstacleColor){Kt(Ma);return}t||(t="DefaultEnvironment");const e={_colorLeft:(l=_e[ge[t]])==null?void 0:l._colorLeft,_colorRight:(u=_e[ge[t]])==null?void 0:u._colorRight,_envColorLeft:(c=_e[ge[t]])==null?void 0:c._envColorLeft,_envColorRight:(h=_e[ge[t]])==null?void 0:h._envColorRight,_envColorLeftBoost:(f=_e[ge[t]])==null?void 0:f._envColorLeftBoost,_envColorRightBoost:(d=_e[ge[t]])==null?void 0:d._envColorRightBoost,_obstacleColor:(m=_e[ge[t]])==null?void 0:m._obstacleColor},n={_colorLeft:e._colorLeft?$t(e._colorLeft):null,_colorRight:e._colorRight?$t(e._colorRight):null,_envColorLeft:e._envColorLeft?$t(e._envColorLeft):null,_envColorRight:e._envColorRight?$t(e._envColorRight):null,_envColorLeftBoost:e._envColorLeftBoost?$t(e._envColorLeftBoost):null,_envColorRightBoost:e._envColorRightBoost?$t(e._envColorRightBoost):null,_obstacleColor:e._obstacleColor?$t(e._obstacleColor):null};i._colorLeft&&(n._colorLeft=$t(i._colorLeft)),i._colorRight&&(n._colorRight=$t(i._colorRight)),i._envColorLeft?n._envColorLeft=$t(i._envColorLeft):i._colorLeft&&(n._envColorLeft=$t(i._colorLeft)),i._envColorRight?n._envColorRight=$t(i._envColorRight):i._colorRight&&(n._envColorRight=$t(i._colorRight));let a,o,r=!1;i._envColorLeftBoost?(a=$t(i._envColorLeftBoost),r=!0):a=e._envColorLeftBoost?$t(e._envColorLeftBoost):n._envColorLeft,i._envColorRightBoost?(o=$t(i._envColorRightBoost),r=!0):o=e._envColorRightBoost?$t(e._envColorRightBoost):n._envColorRight,r&&(n._envColorLeftBoost=a,n._envColorRightBoost=o),i._obstacleColor&&(n._obstacleColor=$t(i._obstacleColor));const s=sn.create("max","none",!0);for(const g in n){if(!n[g])continue;const _=document.createElement("div"),y=document.createElement("div"),v=document.createElement("div"),w=document.createElement("div");y.className="info__color-dot",y.style.backgroundColor=n[g]||"#000000",v.className="info__color-text info__color-text--monospace",v.textContent=`${n[g]}`,w.className="info__color-text",w.textContent=` -- ${Iu[g]}`,_.appendChild(y),_.appendChild(v),_.appendChild(w),s.appendChild(_)}Qt(Ma,[s])}var bl=(i=>(i.duplicate="D",i.active="A",i.scale="S",i.position="P",i.localPosition="Lp",i.rotation="R",i.localRotation="Lr",i.lightID="Li",i.track="T",i))(bl||{}),yl=(i=>(i.childrenTracks="Ct",i.color="C",i.definitePosition="Dp",i.dissolve="D",i.dissolveArrow="Da",i.duration="Dur",i.easing="E",i.interactable="I",i.localRotation="Lr",i.parentTrack="Pt",i.position="P",i.rotation="R",i.scale="S",i.time="T",i.track="Tr",i.worldPositionStays="Wps",i))(yl||{});function vl(i,t){if(i==null||!i.length){Kt(Ga);return}const e=i.map((n,a)=>{let o=n.b,r;t&&(o=t.adjustTime(o),r=t.toRealTime(o));const s=[];if(!n.d)return`Error parsing customEvents[${a}]`;for(const l in n.d){if(l=="_duration"||l=="_easing"||l=="_track"||l=="duration"||l=="easing"||l=="track")continue;const u=yl[l];n.d[l]!=null&&s.push(u)}return`${M(n.b,it.rounding)}${r?" | "+kt(r):""} -- ${n.t} -> [${s.join("")}]${n.t!=="AssignTrackParent"?`(${n.d.track})`:""}`});Qt(Ga,e)}function El(i){if(i==null||!i.length){Kt(Ya);return}const t=i.map((e,n)=>{const a=[];if(!e.id&&!e.geometry)return`Error parsing environment[${n}]`;for(const o in e){if(o=="lookupMethod"||o=="id"||o=="geometry")continue;const r=bl[o];e[o]!=null&&a.push(r)}return`${e.lookupMethod} [${a.join("")}]${e.track?`(${e.track})`:""} -> ${e.geometry?e.geometry.type:e.id}`});Qt(Ya,t)}function Ja(i){if(i==null){Kt(Ba);return}Qt(Ba,i)}function Dl(i){if(i==null){Kt(Oa);return}Qt(Oa,bu(i))}function wl(i){if(i==null||!i.length){Kt(Pa);return}Qt(Pa,i.join(", "))}function Sl(i){if(i==null||!i.length){Kt(Fa);return}Qt(Fa,i.join(", "))}function Tl(i){if(i==null||!i.length){Kt(Ha);return}Qt(Ha,i)}function Ll(i){if(i==null||!i.length){Kt(za);return}Qt(za,i)}function Cl(i){if(i==null){Kt(Ua);return}const t=[];for(const e in i)i[e]||t.push(`Error parsing pointDefinitions[${e}]`),t.push(`${e} -- ${i[e].length} point${i[e].length>1?"s":""}`);Qt(Ua,t)}function kl(i,t){if(i==null||t==null){Kt($a);return}Qt($a,`${kt(i)} to ${kt(t)}${lt.duration?` -- [ ${kt(t-i)} / ${kt(lt.duration)} ]`:""}`)}function Au(i){var t;Xt.setSongName(i._songName),Xt.setSongSubname(i._songSubName),Xt.setSongAuthor(i._songAuthorName),Xt.setSongBPM(i._beatsPerMinute),ol(i._levelAuthorName),ll(i._environmentName),cl((t=i._customData)==null?void 0:t._editors)}function xl(i){var t,e,n,a,o;if(i.rawVersion===2&&Ja(i.rawData._version),i.rawVersion===3&&Ja(i.rawData.version),(t=i.info)!=null&&t._customData&&(_l(i.info._customData),wl(i.info._customData._requirements),Sl(i.info._customData._suggestions),Tl(i.info._customData._information),Ll(i.info._customData._warnings)),(e=i.data)!=null&&e.customData){const r=(n=lt.beatmapInfo)!=null&&n._beatsPerMinute?ye.create(lt.beatmapInfo._beatsPerMinute,i.data.customData._bpmChanges||i.data.customData._BPMChanges||i.data.customData.BPMChanges):null;Dl((a=i.data.customData._time)!=null?a:i.data.customData.time),pl((o=i.data.customData._bookmarks)!=null?o:i.data.customData._bookmarks,r),gl(r),El(i.data.customData.environment),Cl(i.data.customData.pointDefinitions),vl(i.data.customData.customEvents,r)}kl(i.bpm.toRealTime(i.data.getFirstInteractiveTime()),i.bpm.toRealTime(i.data.getLastInteractiveTime()))}function Bu(){ol(),ll(),cl(),hl(),Ja(),kl(),Dl(),_l(),wl(),Sl(),Tl(),Ll(),pl(),gl(),El(),Cl(),vl()}const $u="UI Input: ",Tn={enable:i=>{const t=document.querySelectorAll(".input-toggle");if(!t.length){console.error($u+"empty list, intentional or typo error?");return}t.forEach(e=>{e.disabled=!i})}},Ou="UI Loading: ",Ri=document.querySelector(".loading__bar"),qr="loading__bar--error",Zr="loading__bar--download",Rl=document.querySelector(".loading__text");if(!Ri||!Rl)throw new Error(Ou+"loading component is missing part");function Nl(i,t,e=100){Rl.textContent=t,Ri.style.width=`${e}%`,i==="error"?Ri.classList.add(qr):Ri.classList.remove(qr),i==="download"?Ri.classList.add(Zr):Ri.classList.remove(Zr)}function Mu(){Nl("info","No map loaded",0)}const wt={status:Nl,reset:Mu};var dt=(i=>(i[i.GENERAL_AUDIO=0]="GENERAL_AUDIO",i[i.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",i[i.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",i[i.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",i[i.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",i[i.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",i[i.OTHERS_HOT_START=6]="OTHERS_HOT_START",i[i.OTHERS_NJS=7]="OTHERS_NJS",i[i.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",i[i.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",i[i.EVENTS_INVALID_EVENT_BOX=10]="EVENTS_INVALID_EVENT_BOX",i[i.EVENTS_UNLIT_BOMB=11]="EVENTS_UNLIT_BOMB",i[i.NOTES_EFFECTIVE_BPM=12]="NOTES_EFFECTIVE_BPM",i[i.NOTES_ACCEPTABLE_PRECISION=13]="NOTES_ACCEPTABLE_PRECISION",i[i.NOTES_PARITY=14]="NOTES_PARITY",i[i.NOTES_VARY_SWING=15]="NOTES_VARY_SWING",i[i.NOTES_SLOW_SLIDER=16]="NOTES_SLOW_SLIDER",i[i.NOTES_INLINE_ANGLE=17]="NOTES_INLINE_ANGLE",i[i.NOTES_SHRADO_ANGLE=18]="NOTES_SHRADO_ANGLE",i[i.NOTES_SPEED_PAUSE=19]="NOTES_SPEED_PAUSE",i[i.NOTES_IMPROPER_ARC=20]="NOTES_IMPROPER_ARC",i[i.NOTES_IMPROPER_CHAIN=21]="NOTES_IMPROPER_CHAIN",i[i.NOTES_IMPROPER_WINDOW=22]="NOTES_IMPROPER_WINDOW",i[i.NOTES_HITBOX_STAIR=23]="NOTES_HITBOX_STAIR",i[i.NOTES_HITBOX_REVERSE_STAIR=24]="NOTES_HITBOX_REVERSE_STAIR",i[i.NOTES_HITBOX_INLINE=25]="NOTES_HITBOX_INLINE",i[i.NOTES_HITBOX_PATH=26]="NOTES_HITBOX_PATH",i[i.NOTES_COLOR_CHECK=27]="NOTES_COLOR_CHECK",i[i.NOTES_STACKED_NOTE=28]="NOTES_STACKED_NOTE",i[i.NOTES_DOUBLE_DIRECTIONAL=29]="NOTES_DOUBLE_DIRECTIONAL",i[i.NOTES_VISION_BLOCK=30]="NOTES_VISION_BLOCK",i[i.OBSTACLES_SHORT=31]="OBSTACLES_SHORT",i[i.OBSTACLES_CENTER=32]="OBSTACLES_CENTER",i[i.OBSTACLES_ZERO=33]="OBSTACLES_ZERO",i[i.OBSTACLES_NEGATIVE=34]="OBSTACLES_NEGATIVE",i))(dt||{}),ft=(i=>(i[i.GENERAL_AUDIO=0]="GENERAL_AUDIO",i[i.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",i[i.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",i[i.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",i[i.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",i[i.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",i[i.OTHERS_HOT_START=6]="OTHERS_HOT_START",i[i.OTHERS_NJS=7]="OTHERS_NJS",i[i.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",i[i.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",i[i.EVENTS_INVALID_EVENT_BOX=10]="EVENTS_INVALID_EVENT_BOX",i[i.EVENTS_UNLIT_BOMB=11]="EVENTS_UNLIT_BOMB",i[i.NOTES_COLOR_CHECK=12]="NOTES_COLOR_CHECK",i[i.NOTES_EFFECTIVE_BPM=13]="NOTES_EFFECTIVE_BPM",i[i.NOTES_ACCEPTABLE_PRECISION=14]="NOTES_ACCEPTABLE_PRECISION",i[i.NOTES_PARITY=15]="NOTES_PARITY",i[i.NOTES_VARY_SWING=16]="NOTES_VARY_SWING",i[i.NOTES_SLOW_SLIDER=17]="NOTES_SLOW_SLIDER",i[i.NOTES_INLINE_ANGLE=18]="NOTES_INLINE_ANGLE",i[i.NOTES_SHRADO_ANGLE=19]="NOTES_SHRADO_ANGLE",i[i.NOTES_SPEED_PAUSE=20]="NOTES_SPEED_PAUSE",i[i.NOTES_IMPROPER_ARC=21]="NOTES_IMPROPER_ARC",i[i.NOTES_IMPROPER_CHAIN=22]="NOTES_IMPROPER_CHAIN",i[i.NOTES_IMPROPER_WINDOW=23]="NOTES_IMPROPER_WINDOW",i[i.NOTES_HITBOX_STAIR=24]="NOTES_HITBOX_STAIR",i[i.NOTES_HITBOX_REVERSE_STAIR=25]="NOTES_HITBOX_REVERSE_STAIR",i[i.NOTES_HITBOX_INLINE=26]="NOTES_HITBOX_INLINE",i[i.NOTES_HITBOX_PATH=27]="NOTES_HITBOX_PATH",i[i.NOTES_STACKED_NOTE=28]="NOTES_STACKED_NOTE",i[i.NOTES_DOUBLE_DIRECTIONAL=29]="NOTES_DOUBLE_DIRECTIONAL",i[i.NOTES_VISION_BLOCK=30]="NOTES_VISION_BLOCK",i[i.OBSTACLES_SHORT=31]="OBSTACLES_SHORT",i[i.OBSTACLES_CENTER=32]="OBSTACLES_CENTER",i[i.OBSTACLES_ZERO=33]="OBSTACLES_ZERO",i[i.OBSTACLES_NEGATIVE=34]="OBSTACLES_NEGATIVE",i))(ft||{});function Il(i,t){switch(t){case"rank":i='<span title="Ranking: for rankability reason."> \u{1F6A7} </span>'+i;break;case"error":i='<span title="Error: should be fixed unless you know what you are doing."> \u274C </span>'+i;break;case"warning":i='<span title="Warning: not necessarily needed to be fixed but worth considering."> \u2757 </span>'+i;break;case"info":i='<span title="Info: no action necessary and worth noting."> \u26A0\uFE0F </span>'+i;break}return i}function gt(i,t,e){const n=document.createElement("div");return i=Il(i,e),t?n.innerHTML=`<b>${i}:</b> ${t}`:n.innerHTML=`<b>${i}</b>`,n}function ht(i,t,e,n){const a=document.createElement("div");return i=Il(i,n),a.innerHTML=`<b>${i} [${t.length}]:</b> ${t.map(o=>{switch(it.beatNumbering){case"realtime":return`<span title="Beat ${M(e.adjustTime(o),it.rounding)}">${kt(e.toRealTime(o))}</span>`;case"realtimems":return`<span title="Beat ${M(e.adjustTime(o),it.rounding)}">${Nn(e.toRealTime(o))}</span>`;case"jsontime":return`<span title="Time ${Nn(e.toRealTime(o))}">${M(o,it.rounding)}</span>`;case"beattime":default:return`<span title="Time ${Nn(e.toRealTime(o))}">${M(e.adjustTime(o),it.rounding)}</span>`}}).join(", ")}`,a}const ga=class{constructor(){}};let ct=ga;$(ct,"list",[]),$(ct,"create",(t,e,n,a)=>{const o=t.trim().toLowerCase().replace(" ","-");if(ga.list.includes(o))throw new Error(o+" is already being used.");ga.list.push(o);const r=document.createElement("div"),s=document.createElement("input"),l=document.createElement("label");return l.textContent=" "+t,l.title=e,l.htmlFor="input__tools-"+o,s.id="input__tools-"+o,s.className="input-toggle",s.type="checkbox",s.checked=n,s.addEventListener("change",a),r.appendChild(s),r.appendChild(l),r});const Kr="Validate Cover Image",Qr="Validate cover image.",ts=!0,Vn={name:Kr,description:Qr,type:"general",order:{input:dt.GENERAL_COVER_IMAGE,output:ft.GENERAL_COVER_IMAGE},input:{enabled:ts,params:{},html:ct.create(Kr,Qr,ts,function(){Vn.input.enabled=this.checked})},output:{html:null},run:Pu};function Pu(){const i=new Image,t=Xt.getCoverImage(),e=[];if(Xi.loading.coverImage&&t!==null?(i.src=t,i.width!==i.height&&e.push(gt("Cover image is not square","resize to fit square","error")),(i.width<256||i.height<256)&&e.push(gt("Cover image is too small","require at least 256x256","error"))):e.push(gt("No cover image",it.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),e.length){const n=document.createElement("div");e.forEach(a=>n.append(a)),Vn.output.html=n}else Vn.output.html=null}const es="Audio Duration",is="For ranking purpose, check for audio duration.",ns=!0,on={name:es,description:is,type:"general",order:{input:dt.GENERAL_AUDIO,output:ft.GENERAL_AUDIO},input:{enabled:ns,params:{},html:ct.create(es,is,ns,function(){on.input.enabled=this.checked})},output:{html:null},run:Fu};function Fu(i){const{audioDuration:t}=i.settings;t&&t<20?on.output.html=gt("Unrankable audio length",`too short (${kt(t)}s)`,"rank"):Xi.loading.audio?on.output.html=null:on.output.html=gt("No audio",it.load.audio?"could not be loaded or not found":"no audio mode is enabled")}const as="Preview Time",rs="Warn default editor preview time.",ss=!0,Jn={name:as,description:rs,type:"general",order:{input:dt.GENERAL_PREVIEW_TIME,output:ft.GENERAL_PREVIEW_TIME},input:{enabled:ss,params:{},html:ct.create(as,rs,ss,function(){Jn.input.enabled=this.checked})},output:{html:null},run:Hu};function Hu(i){const{_previewStartTime:t,_previewDuration:e}=i.info;t===12&&e===10?Jn.output.html=gt("Default preview time","strongly recommended to set for audience's 1st impression","info"):Jn.output.html=null}function zu(i){return Math.max(...i.map(t=>t.ebpm),0)}function Xu(i){return Math.max(...i.map(t=>t.ebpmSwing),0)}const ba=4;var nt=(i=>(i[i.RED=0]="RED",i[i.BLUE=1]="BLUE",i))(nt||{}),X=(i=>(i[i.UP=0]="UP",i[i.DOWN=1]="DOWN",i[i.LEFT=2]="LEFT",i[i.RIGHT=3]="RIGHT",i[i.UP_LEFT=4]="UP_LEFT",i[i.UP_RIGHT=5]="UP_RIGHT",i[i.DOWN_LEFT=6]="DOWN_LEFT",i[i.DOWN_RIGHT=7]="DOWN_RIGHT",i[i.ANY=8]="ANY",i))(X||{}),ot=(i=>(i[i.LEFT=0]="LEFT",i[i.MIDDLE_LEFT=1]="MIDDLE_LEFT",i[i.MIDDLE_RIGHT=2]="MIDDLE_RIGHT",i[i.RIGHT=3]="RIGHT",i))(ot||{}),At=(i=>(i[i.BOTTOM=0]="BOTTOM",i[i.MIDDLE=1]="MIDDLE",i[i.TOP=2]="TOP",i))(At||{});const xt={[0]:180,[1]:0,[2]:270,[3]:90,[4]:225,[5]:135,[6]:315,[7]:45,[8]:0},ju={[0]:1,[1]:0,[2]:3,[3]:2,[4]:7,[5]:6,[6]:5,[7]:4,[8]:8},Ye={[0]:[0,1],[1]:[0,-1],[2]:[-1,0],[3]:[1,0],[4]:[-1,1],[5]:[1,1],[6]:[-1,-1],[7]:[1,-1],[8]:[0,0]},Yu={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60};var Al=(i=>(i[i.DIVISION=1]="DIVISION",i[i.STEP_AND_OFFSET=2]="STEP_AND_OFFSET",i))(Al||{});class rr{constructor(t){$(this,"data");this.data=t}serialize(){return JSON.stringify(this.toJSON())}clone(){return new this.constructor(this.toJSON())}}class ya extends rr{setCustomData(t){return this.customData=t,this}resetCustomData(){return this.customData={},this}removeCustomData(t){return typeof t=="string"?delete this.customData[t]:t.forEach(e=>delete this.customData[e]),this}addCustomData(t){return this.customData={...this.customData,object:t},this}func(t){return t(this),this}isChroma(){return!1}isNoodleExtensions(){return!1}isMappingExtensions(){return!1}}class Pe extends ya{setTime(t){return this.time=t,this}}class va extends Pe{setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}mirror(t=!0){return this.posX=ba-1-this.posX,this}swapPosition(t){const e=t.posX;t.posX=this.posX,this.posX=e;const n=t.posY;return t.posY=this.posY,this.posY=n,this}getPosition(t){switch(t){case"vanilla":return[this.posX-2,this.posY];case"me":return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY];case"ne":return[this.posX-2,this.posY];default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getDistance(t){const[e,n]=this.getPosition(),[a,o]=t.getPosition();return Math.sqrt(Math.pow(a-e,2)+Math.pow(o-n,2))}isVertical(t){const[e]=this.getPosition(),[n]=t.getPosition(),a=e-n;return a>-.001&&a<.001}isHorizontal(t){const[e,n]=this.getPosition(),[a,o]=t.getPosition(),r=n-o;return r>-.001&&r<.001}isDiagonal(t){const[e,n]=this.getPosition(),[a,o]=t.getPosition(),r=Math.abs(e-a),s=Math.abs(n-o);return r===s}isInline(t,e=.5){return this.getDistance(t)<=e}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t,e=1.8){return this.getDistance(t)>e}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}}class Bl extends va{setColor(t){return this.color=t,this}setDirection(t){return this.direction=t,this}isRed(){return this.color===0}isBlue(){return this.color===1}mirror(t=!0){switch(t&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return super.mirror(t)}swapRotation(t,e=!0){const n=t.direction;return t.direction=this.direction,this.direction=n,this}getAngle(t){switch(t){case"vanilla":return xt[this.direction]||0;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return xt[this.direction]||0;default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):xt[this.direction]||0}}isDouble(t,e=.01){return t.time>this.time-e&&t.time<this.time+e&&this.color!==t.color}isValidDirection(){return this.direction>=0&&this.direction<=8}isValid(){return!this.isMappingExtensions()&&this.isValidDirection()}}class sr extends Bl{setType(t){return this.type=t,this}setAngleOffset(t){return this.angleOffset=t,this}isNote(){return this.type===0||this.type===1}isBomb(){return this.type===3}mirror(t=!0){return super.mirror(t)}swapRotation(t,e=!0){const n=t.angleOffset;return t.angleOffset=this.angleOffset,this.angleOffset=n,e&&(t.angleOffset=0-t.angleOffset,this.angleOffset=0-this.angleOffset),this}getAngle(t){switch(t){case"vanilla":return(xt[this.direction]||0)+this.angleOffset;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return(xt[this.direction]||0)+this.angleOffset;default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):(xt[this.direction]||0)+this.angleOffset}}isMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0||this.direction>=1e3&&this.direction<=1360||this.direction>=2e3&&this.direction<=2360}}function $l(i,t,e){return i.direction===X.ANY&&t.direction===X.ANY&&e!==X.ANY&&(i.posX>t.posX&&(e===X.UP_RIGHT||e===X.RIGHT||e===X.DOWN_RIGHT)||i.posX<t.posX&&(e===X.DOWN_LEFT||e===X.LEFT||e===X.UP_LEFT)||i.posY>t.posY&&(e===X.UP_LEFT||e===X.UP||e===X.UP_RIGHT)||i.posY<t.posY&&(e===X.DOWN_LEFT||e===X.DOWN||e===X.DOWN_RIGHT))||i.posX>t.posX&&(i.direction===X.UP_RIGHT||i.direction===X.RIGHT||i.direction===X.DOWN_RIGHT||(t.direction===X.UP_RIGHT||t.direction===X.RIGHT||t.direction===X.DOWN_RIGHT)&&i.direction===X.ANY)||i.posX<t.posX&&(i.direction===X.DOWN_LEFT||i.direction===X.LEFT||i.direction===X.UP_LEFT||(t.direction===X.DOWN_LEFT||t.direction===X.LEFT||t.direction===X.UP_LEFT)&&i.direction===X.ANY)||i.posY>t.posY&&(i.direction===X.UP_LEFT||i.direction===X.UP||i.direction===X.UP_RIGHT||(t.direction===X.UP_LEFT||t.direction===X.UP||t.direction===X.UP_RIGHT)&&i.direction===X.ANY)||i.posY<t.posY&&(i.direction===X.DOWN_LEFT||i.direction===X.DOWN||i.direction===X.DOWN_RIGHT||(t.direction===X.DOWN_LEFT||t.direction===X.DOWN||t.direction===X.DOWN_RIGHT)&&i.direction===X.ANY)}function qa(i,t,e,n=!1){const[a,o]=i.getPosition(),[r,s]=t.getPosition(),l=n?540:360;let u=!1;if(i.direction!==8){const h=i.getAngle(),f=(ka(Math.atan2(o-s,a-r))+450)%360;for(const[d,m,g]of e){const _=g!=null?g:0,y=(h+l-d+_)%360,v=(h+l+d+_)%360;if(u=m>=Math.sqrt(Math.pow(a-r,2)+Math.pow(o-s,2))&&(y<v&&y<=f&&f<=v||y>=v&&(f<=v||f>=y))||u,u)break}}let c=!1;if(t instanceof sr&&t.direction!==8){const h=t.getAngle(),f=(ka(Math.atan2(s-o,r-a))+450)%360;for(const[d,m,g]of e){const _=g!=null?g:0,y=(h+l-d+_)%360,v=(h+l+d+_)%360;if(c=m>=Math.sqrt(Math.pow(a-r,2)+Math.pow(o-s,2))&&(y<v&&y<=f&&f<=v||y>=v&&(f<=v||f>=y))||c,c)break}}return[u,c]}function os(i,t){if($l(i,t,X.ANY))return i.direction===X.ANY?t.direction:i.direction;if(i.direction!==X.ANY)return i.direction;if(i.time>t.time){if(i.posX>t.posX&&i.isHorizontal(t))return X.RIGHT;if(i.posX<t.posX&&i.isHorizontal(t))return X.LEFT;if(i.posY>t.posY){if(i.isVertical(t))return X.UP;if(i.posX>t.posX)return X.UP_RIGHT;if(i.posX<t.posX)return X.UP_LEFT}if(i.posY<t.posY){if(i.isVertical(t))return X.DOWN;if(i.posX>t.posX)return X.DOWN_RIGHT;if(i.posX<t.posX)return X.DOWN_LEFT}}return X.ANY}function mn(i,t,e,n){let a,o;if(i===null||t===null)return!1;if(typeof i=="number")a=i;else{if(i.direction===X.ANY)return!1;a=i.getAngle()}if(typeof t=="number")o=t;else{if(t.direction===X.ANY)return!1;o=t.getAngle()}return n?Gr(a,o,360)<=e:Gr(a,o,360)>=e}class jt{constructor(t){$(this,"time");$(this,"duration");$(this,"minSpeed");$(this,"maxSpeed");$(this,"ebpm");$(this,"ebpmSwing");$(this,"data");this.time=t.time,this.duration=t.duration,this.minSpeed=t.minSpeed,this.maxSpeed=t.maxSpeed,this.ebpm=t.ebpm,this.ebpmSwing=t.ebpmSwing,this.data=t.data}static generate(t,e){const n=[];let a=0,o=0,r,s;const l={},u={},c={0:[],1:[]};for(const h of t)h.type==="note"&&(r=0,s=Number.MAX_SAFE_INTEGER,u[h.data.color]?this.next(h,u[h.data.color],e,c[h.data.color])&&(r=this.calcMinSliderSpeed(c[h.data.color],e),s=this.calcMaxSliderSpeed(c[h.data.color],e),r>0&&s!==1/0||(r=0,s=0),n.push({time:l[h.data.color].data.time,duration:u[h.data.color].data.time-l[h.data.color].data.time,data:c[h.data.color],ebpm:a,ebpmSwing:o,maxSpeed:s,minSpeed:r}),o=this.calcEBPMBetweenObject(h.data,l[h.data.color].data,e.value),a=this.calcEBPMBetweenObject(h.data,u[h.data.color].data,e.value),l[h.data.color]=h,c[h.data.color]=[]):l[h.data.color]=h,u[h.data.color]=h,c[h.data.color].push(h));for(let h=0;h<2;h++)u[h]&&(r=this.calcMinSliderSpeed(c[h],e),s=this.calcMaxSliderSpeed(c[h],e),r>0&&s!==1/0||(r=0,s=0),n.push({time:l[h].data.time,duration:u[h].data.time-l[h].data.time,data:c[h],ebpm:a,ebpmSwing:o,maxSpeed:s,minSpeed:r}));return n}}$(jt,"next",(t,e,n,a)=>{if(t.type==="bomb"||e.type==="bomb")throw new Error("Invalid type");if(a&&a.length>0&&n.toRealTime(e.data.time)+.005<n.toRealTime(t.data.time)&&t.data.direction!==X.ANY){for(const o of a)if(o.type==="note"&&o.data.direction!==X.ANY&&mn(t.data,o.data,90,!1))return!0}if(a&&a.length>0){for(const o of a)if(o.type==="note"&&t.data.isInline(o.data))return!0}return t.data.isWindow(e.data)&&n.toRealTime(t.data.time-e.data.time)>.08||n.toRealTime(t.data.time-e.data.time)>.07}),$(jt,"calcEBPMBetweenObject",(t,e,n)=>n/((t.time-e.time)*2)),$(jt,"calcMinSliderSpeed",(t,e)=>{let n=!1,a=!1,o=0;const r=e.toRealTime(Math.max(...t.map((s,l)=>l===0?0:((t[l].data.isHorizontal(t[l-1].data)||t[l].data.isVertical(t[l-1].data))&&!n&&(n=!0,o=(t[l].data.time-t[l-1].data.time)/(t[l].data.getDistance(t[l-1].data)||1)),a=t[l].data.isDiagonal(t[l-1].data)||t[l].data.isSlantedWindow(t[l-1].data)||a,(t[l].data.time-t[l-1].data.time)/(t[l].data.getDistance(t[l-1].data)||1)))));return n&&a?e.toRealTime(o):r}),$(jt,"calcMaxSliderSpeed",(t,e)=>{let n=!1,a=!1,o=Number.MAX_SAFE_INTEGER;const r=e.toRealTime(Math.min(...t.map((s,l)=>l===0?Number.MAX_SAFE_INTEGER:((t[l].data.isHorizontal(t[l-1].data)||t[l].data.isVertical(t[l-1].data))&&!n&&(n=!0,o=(t[l].data.time-t[l-1].data.time)/(t[l].data.getDistance(t[l-1].data)||1)),a=t[l].data.isDiagonal(t[l-1].data)||t[l].data.isSlantedWindow(t[l-1].data)||a,(t[l].data.time-t[l-1].data.time)/(t[l].data.getDistance(t[l-1].data)||1)))));return n&&a?e.toRealTime(o):r});function Uu(i,t,e){const n={left:new Array(Math.floor(t+1)).fill(0),right:new Array(Math.floor(t+1)).fill(0)};let a,o;for(const r of i){if(r.type!=="note")continue;const s=e.toRealTime(r.data.time);r.data.color===0&&(a?jt.next(r,a,e)&&n.left[Math.floor(s)]++:n.left[Math.floor(s)]++,a=r),r.data.color===1&&(o?jt.next(r,o,e)&&n.right[Math.floor(s)]++:n.right[Math.floor(s)]++,o=r)}return n}function Sa(i,t){if(!i.length)return 0;if(i.length<t)return i.reduce((a,o)=>a+o)/i.length;let e=i.slice(0,t).reduce((a,o)=>a+o),n=e;for(let a=0;a<i.length-t;a++)e=e-i[a]+i[a+t],n=Math.max(n,e);return n/t}function ls(i,t,e,n){const o={characteristic:e,difficulty:n,red:{average:0,peak:0,median:0,total:0},blue:{average:0,peak:0,median:0,total:0},total:{average:0,peak:0,median:0,total:0},container:jt.generate(i.getNoteContainer(),t)},r=Math.max(t.toRealTime(i.getLastInteractiveTime()-i.getFirstInteractiveTime()),0),s=Math.max(t.toRealTime(i.getLastInteractiveTime()),0),l=Uu(i.getNoteContainer(),s,t),u=l.left.map((d,m)=>d+l.right[m]);if(u.reduce((d,m)=>d+m)===0)return o;const c=[],h=[],f=[];for(let d=0,m=Math.ceil(u.length/10);d<m;d++){const g=d*10;let _=10;_+g>u.length&&(_=u.length-g);const y=l.left.slice(g,g+_),v=l.right.slice(g,g+_),w=u.slice(g,g+_);c.push(y.reduce((T,L)=>T+L)/_),h.push(v.reduce((T,L)=>T+L)/_),f.push(w.reduce((T,L)=>T+L)/_)}return o.red.total=l.left.reduce((d,m)=>d+m),o.red.average=l.left.reduce((d,m)=>d+m)/r,o.red.peak=Sa(l.left,10),o.red.median=wa(c),o.blue.total=l.right.reduce((d,m)=>d+m),o.blue.average=l.right.reduce((d,m)=>d+m)/r,o.blue.peak=Sa(l.right,10),o.blue.median=wa(h),o.total.total=o.red.total+o.blue.total,o.total.average=u.reduce((d,m)=>d+m)/r,o.total.peak=Sa(u,10),o.total.median=wa(f),o}function Gu(i,t){let e=0,n=0,a;for(const o of i){const r=o.total.average;if(n>0&&r>0&&(e=(1-r/n)*100),n>t&&e>40)return{result:o,comparedTo:a};n=r,a=o}return null}function Wu(i,t){let e=Number.MAX_SAFE_INTEGER,n=0,a;for(const o of i){const r=o.total.average;if(n>0&&r>0&&(e=(1-r/n)*100),n=r>0?r:n,n>t&&e<10)return{result:o,comparedTo:a};a=o}return null}function Vu(i){let t=0,e=Number.MAX_SAFE_INTEGER;return i.forEach(n=>{const a=n.total.average;a>0&&(t=Math.max(t,a),e=Math.min(e,a))}),t||t&&e?(1-e/t)*100:0}function cs(i){let t=Number.MAX_SAFE_INTEGER;return i.forEach(e=>{const n=e.total.average;n>0&&(t=Math.min(t,n))}),t}function us(i){let t=0;return i.forEach(e=>{const n=e.total.average;n>0&&(t=Math.max(t,n))}),t}function Ju(i){return Math.max(...i.map(t=>t.minSpeed),0)}function qu(i){const t=i.map(e=>e.maxSpeed).filter(e=>e!==0);return t.length?Math.min(...t):0}var Ol=(i=>(i[i.Easy=1]="Easy",i[i.Normal=3]="Normal",i[i.Hard=5]="Hard",i[i.Expert=7]="Expert",i[i.ExpertPlus=9]="ExpertPlus",i))(Ol||{}),be=(i=>(i.Easy="Easy",i.Normal="Normal",i.Hard="Hard",i.Expert="Expert",i.ExpertPlus="Expert+",i))(be||{});const Ml="Difficulty Progression",Pl="For ranking purpose, check difficuly progression to fit rankability criteria.",Fl=!0,or=document.createElement("div"),Hl=document.createElement("ul"),Zu=["ExpertPlus","Expert","Hard","Normal","Easy"];for(const i of Zu)Hl.appendChild(ct.create(be[i],`Toggle check progression for Standard ${be[i]}`,!0,function(){Ve.input.params[i]=this.checked}));or.appendChild(ct.create(Ml,Pl,Fl,function(){Ve.input.enabled=this.checked}));or.appendChild(Hl);const Ve={name:Ml,description:Pl,type:"general",order:{input:dt.GENERAL_PROGRESSION,output:ft.GENERAL_PROGRESSION},input:{enabled:Fl,params:{ExpertPlus:!0,Expert:!0,Hard:!0,Normal:!0,Easy:!0},html:or},output:{html:null},run:Ku};function Ku(i){var s,l,u,c,h,f,d,m;const{audioDuration:t}=i.settings;if(!t){Ve.output.html=null;return}const e=lt.beatmapDifficulty.map(g=>g.swingAnalysis).filter(g=>g.characteristic==="Standard"&&Ve.input.params[g.difficulty]||g.total.total!==0).sort((g,_)=>g.total.average-_.total.average).reverse();if(!e.length){Ve.output.html=null;return}const n=Math.max(t<120?3.2:t<240?4.2:5.2,M(us(e)*.4,2)),a=[];t<360&&cs(e)>n&&a.push(gt(`Minimum SPS not met (<${n})`,`lowest SPS is ${M(cs(e),2)}, ${M(Vu(e),2)}% drop from highest SPS (${M(us(e),2)})`,"rank"));const o=Gu(e,n),r=Wu(e,n);if(o&&t<360&&a.push(gt("Violates progression",`${be[o.result.difficulty]} exceeded 40% SPS drop, ${M(o.result.total.average,2)} from ${M(((l=(s=o.comparedTo)==null?void 0:s.total)==null?void 0:l.average)||0,2)} ${be[o.comparedTo.difficulty]}, acceptable range (${M((((c=(u=o.comparedTo)==null?void 0:u.total)==null?void 0:c.average)||0)*.6,2)}-${M((((h=o.comparedTo)==null?void 0:h.total.average)||0)*.9,2)})`,"rank")),r&&t<360&&a.push(gt("Violates progression",`${be[r.result.difficulty]} has less than 10% SPS drop, ${M(r.result.total.average,2)} from ${M(((f=r.comparedTo)==null?void 0:f.total.average)||0,2)} ${be[r.comparedTo.difficulty]}, acceptable range (${M((((d=r.comparedTo)==null?void 0:d.total.average)||0)*.6,2)}-${M((((m=r.comparedTo)==null?void 0:m.total.average)||0)*.9,2)})`,"rank")),a.length){const g=document.createElement("div");a.forEach(_=>g.append(_)),Ve.output.html=g}else Ve.output.html=null}const hs=Object.freeze(Object.defineProperty({__proto__:null,coverImage:Vn,audio:on,previewTime:Jn,progression:Ve},Symbol.toStringTag,{value:"Module"})),zl="Effective BPM",Xl=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,jl=!0,lr=450,cr=350,bn=ct.create(zl+" threshold",Xl,jl,function(){Wt.input.enabled=this.checked}),Qe=document.createElement("input"),ur=document.createElement("label"),ti=document.createElement("input"),hr=document.createElement("label");ur.textContent=": ";ur.htmlFor="input__tools-ebpm";Qe.id="input__tools-ebpm";Qe.className="input-toggle input--small";Qe.type="number";Qe.min="0";Qe.value=lr.toString();Qe.addEventListener("change",th);hr.textContent=" (swing): ";hr.htmlFor="input__tools-ebpms";ti.id="input__tools-ebpms";ti.className="input-toggle input--small";ti.type="number";ti.min="0";ti.value=cr.toString();ti.addEventListener("change",eh);bn.appendChild(ur);bn.appendChild(Qe);bn.appendChild(hr);bn.appendChild(ti);const Wt={name:zl,description:Xl,type:"note",order:{input:dt.NOTES_EFFECTIVE_BPM,output:ft.NOTES_EFFECTIVE_BPM},input:{enabled:jl,params:{ebpmThres:lr,ebpmsThres:cr},html:bn,adjustTime:Qu},output:{html:null},run:nh};function Qu(i){Wt.input.params.ebpmThres=M(Math.min(lr,i.value*2*1.285714),1),Wt.input.params.ebpmsThres=M(Math.min(cr,i.value*2),1),Qe.value=Wt.input.params.ebpmThres.toString(),ti.value=Wt.input.params.ebpmsThres.toString()}function th(){Wt.input.params.ebpmThres=M(Math.abs(parseFloat(this.value)),1),this.value=Wt.input.params.ebpmThres.toString()}function eh(){Wt.input.params.ebpmsThres=M(Math.abs(parseFloat(this.value)),1),this.value=Wt.input.params.ebpmsThres.toString()}function ih(i){const{swingAnalysis:t}=i.difficulty,{ebpmThres:e,ebpmsThres:n}=Wt.input.params,a=t.container.filter(r=>r.ebpm>e).map(r=>r.time),o=t.container.filter(r=>r.ebpmSwing>n).map(r=>r.time);return{base:a,swing:o}}function nh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=ih(i),{ebpmThres:e,ebpmsThres:n}=Wt.input.params,a=[];if(t.base.length&&a.push(ht(`>${e}EBPM warning`,t.base,i.settings.bpm,"warning")),t.swing.length&&a.push(ht(`>${n}EBPM (swing) warning`,t.swing,i.settings.bpm,"warning")),a.length){const o=document.createElement("div");a.forEach(r=>o.append(r)),Wt.output.html=o}else Wt.output.html=null}const Yl="Acceptable Beat Precision",Ul=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,Gl=!0,Wl=[8,6],Vl=ct.create(Yl+": ",Ul,Gl,function(){Ti.input.enabled=this.checked}),Vi=document.createElement("input");Vi.id="input__tools-prec";Vi.className="input-toggle input--small";Vi.type="text";Vi.value=Wl.join(" ");Vi.addEventListener("change",ah);Vl.appendChild(Vi);const Ti={name:Yl,description:Ul,type:"note",order:{input:dt.NOTES_ACCEPTABLE_PRECISION,output:ft.NOTES_ACCEPTABLE_PRECISION},input:{enabled:Gl,params:{prec:[...Wl]},html:Vl},output:{html:null},run:sh};function ah(){Ti.input.params.prec=this.value.trim().split(" ").map(i=>parseInt(i)).filter(i=>i>0?!Number.isNaN(i):!1),this.value=Ti.input.params.prec.join(" ")}function rh(i,t){const{bpm:e}=i,n=t.swingAnalysis.container,{prec:a}=Ti.input.params;return n.map(o=>o.time).filter((o,r,s)=>!r||o!==s[r-1]).filter(o=>{if(!a.length)return!1;for(let r=0;r<a.length;r++)if((e.adjustTime(o)+.001)%(1/a[r])<.01)return!1;return!0})}function sh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=rh(i.settings,i.difficulty);t.length?Ti.output.html=ht("Off-beat precision",t,i.settings.bpm,"warning"):Ti.output.html=null}const ds="Varying Swing Speed",fs="Check for varying swing speed due to changes in slider distance.",ms=!0,qn={name:ds,description:fs,type:"note",order:{input:dt.NOTES_VARY_SWING,output:ft.NOTES_VARY_SWING},input:{enabled:ms,params:{},html:ct.create(ds,fs,ms,function(){qn.input.enabled=this.checked})},output:{html:null},run:lh};function oh(i){const{swingAnalysis:t}=i;return t.container.filter(e=>Math.abs(e.minSpeed-e.maxSpeed)>.002).map(e=>e.time).filter((e,n,a)=>!n||e!==a[n-1])}function lh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=oh(i.difficulty);t.length?qn.output.html=ht("Varying swing speed",t,i.settings.bpm,"error"):qn.output.html=null}const Jl="Slow Slider",ql="Look for slider that require slow swing.",Zl=!0,Kl=.025,Ji=document.createElement("div"),ei=document.createElement("input"),dr=document.createElement("label"),ii=document.createElement("input"),fr=document.createElement("label");let ji;dr.textContent="min speed (ms): ";dr.htmlFor="input__tools-slow-slider-time";ei.id="input__tools-slow-slider-time";ei.className="input-toggle input--small";ei.type="number";ei.min="0";ei.value=M(Kl*1e3,1).toString();ei.addEventListener("change",uh);fr.textContent=" (prec): ";fr.htmlFor="input__tools-slow-slider-prec";ii.id="input__tools-slow-slider-prec";ii.className="input-toggle input--small";ii.type="number";ii.min="0";ii.addEventListener("change",hh);Ji.appendChild(ct.create(Jl,ql,Zl,function(){ce.input.enabled=this.checked}));Ji.appendChild(dr);Ji.appendChild(ei);Ji.appendChild(fr);Ji.appendChild(ii);const ce={name:Jl,description:ql,type:"note",order:{input:dt.NOTES_SLOW_SLIDER,output:ft.NOTES_SLOW_SLIDER},input:{enabled:Zl,params:{minSpeed:Kl},html:Ji,adjustTime:ch},output:{html:null},run:fh};function ch(i){ji=i,ii.value=M(1/ji.toBeatTime(ce.input.params.minSpeed),2).toString()}function uh(){ce.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=M(ce.input.params.minSpeed*1e3,1).toString(),ji&&(ii.value=M(1/ji.toBeatTime(ce.input.params.minSpeed),2).toString())}function hh(){if(!ji){this.value="0";return}let i=M(Math.abs(parseFloat(this.value)),2)||1;ce.input.params.minSpeed=ji.toRealTime(1/i),ei.value=M(ce.input.params.minSpeed*1e3,1).toString(),this.value=i.toString()}function dh(i){const{swingAnalysis:t}=i.difficulty,{minSpeed:e}=ce.input.params;return t.container.filter(n=>n.maxSpeed>e||n.minSpeed>e).map(n=>n.time).filter((n,a,o)=>!a||n!==o[a-1])}function fh(i){if(!i.difficulty){console.error("Something went wrong!");return}const{minSpeed:t}=ce.input.params,e=dh(i);e.length?ce.output.html=ht(`Slow slider (>${M(t*1e3,1)}ms)`,e,i.settings.bpm,"warning"):ce.output.html=null}const Ql="Inline Sharp Angle",tc="Check for angle changes within inline note.",ec=!0,ic=.15;let Yi;const qi=document.createElement("div"),ni=document.createElement("input"),mr=document.createElement("label"),Fe=document.createElement("input"),pr=document.createElement("label");mr.textContent="max time (ms): ";mr.htmlFor="input__tools-inline-angle-time";ni.id="input__tools-inline-angle-time";ni.className="input-toggle input--small";ni.type="number";ni.min="0";ni.value=M(ic*1e3,1).toString();ni.addEventListener("change",ph);pr.textContent=" (beat): ";pr.htmlFor="input__tools-inline-angle-beat";Fe.id="input__tools-inline-angle-beat";Fe.className="input-toggle input--small";Fe.type="number";Fe.min="0";Fe.step="0.1";Fe.addEventListener("change",gh);qi.appendChild(ct.create(Ql,tc,ec,function(){ve.input.enabled=this.checked}));qi.appendChild(mr);qi.appendChild(ni);qi.appendChild(pr);qi.appendChild(Fe);const ve={name:Ql,description:tc,type:"note",order:{input:dt.NOTES_INLINE_ANGLE,output:ft.NOTES_INLINE_ANGLE},input:{enabled:ec,params:{maxTime:ic},html:qi,adjustTime:mh},output:{html:null},run:bh};function mh(i){Yi=i,Fe.value=M(Yi.toBeatTime(ve.input.params.maxTime),2).toString()}function ph(){ve.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(ve.input.params.maxTime*1e3,1).toString(),Yi&&(Fe.value=M(Yi.toBeatTime(ve.input.params.maxTime),2).toString())}function gh(){if(!Yi){this.value="0";return}let i=M(Math.abs(parseFloat(this.value)),2)||1;ve.input.params.maxTime=Yi.toRealTime(i),ni.value=M(ve.input.params.maxTime*1e3,1).toString(),this.value=i.toString()}function _h(i){const{bpm:t}=i.settings,e=i.difficulty.noteContainer,{maxTime:n}=ve.input.params,a=t.toBeatTime(n)+.001,o={},r={},s={},l={[nt.RED]:[],[nt.BLUE]:[]},u=[];let c=0;for(let h=0,f=e.length;h<f;h++){const d=e[h];d.type==="note"&&o[d.data.color]?jt.next(d,o[d.data.color],t,l[d.data.color])?(s[d.data.color]&&(s[d.data.color]=null,r[d.data.color]=(r[d.data.color]+180)%360),ps(d.data,e,c,a)&&mn(d.data,r[d.data.color],90,!0)&&u.push(d.data),d.data.direction===X.ANY?s[d.data.color]=d.data:r[d.data.color]=d.data.getAngle(),l[d.data.color]=[]):(s[d.data.color]&&ps(d.data,e,c,a)&&mn(d.data,r[d.data.color],90,!0)&&(u.push(s[d.data.color]),s[d.data.color]=null),d.data.direction!==X.ANY&&(r[d.data.color]=d.data.getAngle())):d.type==="note"&&(r[d.data.color]=d.data.getAngle()),d.type==="note"&&(o[d.data.color]=d,l[d.data.color].push(d)),d.type==="bomb"&&(d.data.posY===At.BOTTOM&&(d.data.posX===ot.MIDDLE_LEFT&&(r[nt.RED]=xt[X.UP],s[nt.RED]=null),d.data.posX===ot.MIDDLE_RIGHT&&(r[nt.BLUE]=xt[X.UP],s[nt.BLUE]=null)),d.data.posY===At.TOP&&(d.data.posX===ot.MIDDLE_LEFT&&(r[nt.RED]=xt[X.DOWN],s[nt.RED]=null),d.data.posX===ot.MIDDLE_RIGHT&&(r[nt.BLUE]=xt[X.DOWN],s[nt.BLUE]=null)))}return u.map(h=>h.time).filter(function(h,f,d){return!f||h!==d[f-1]})}function ps(i,t,e,n){for(let a=e;t[a].data.time<i.time;a++){const o=t[a];if(o.type==="note"&&i.isInline(o.data)&&i.time-t[a].data.time<=n)return!0}return!1}function bh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=_h(i);t.length?ve.output.html=ht("Inline sharp angle",t,i.settings.bpm,"warning"):ve.output.html=null}const nc="shrado Angle",ac="Look for common negative curvature pattern.",rc=!1,sc=.15,oc=1;let Ui;const He=document.createElement("div"),Ci=document.createElement("input"),gr=document.createElement("label"),ai=document.createElement("input"),_r=document.createElement("label"),ze=document.createElement("input"),br=document.createElement("label");gr.textContent="min distance: ";gr.htmlFor="input__tools-shrado-angle-distance";Ci.id="input__tools-shrado-angle-distance";Ci.className="input-toggle input--small";Ci.type="number";Ci.min="0";Ci.value=oc.toString();Ci.addEventListener("change",vh);_r.textContent="max time (ms): ";_r.htmlFor="input__tools-shrado-angle-time";ai.id="input__tools-shrado-angle-time";ai.className="input-toggle input--small";ai.type="number";ai.min="0";ai.value=M(sc*1e3,1).toString();ai.addEventListener("change",Eh);br.textContent=" (beat): ";br.htmlFor="input__tools-shrado-angle-beat";ze.id="input__tools-shrado-angle-beat";ze.className="input-toggle input--small";ze.type="number";ze.min="0";ze.step="0.1";ze.addEventListener("change",Dh);He.appendChild(ct.create(nc,ac,rc,function(){qt.input.enabled=this.checked}));He.appendChild(gr);He.appendChild(Ci);He.appendChild(document.createElement("br"));He.appendChild(_r);He.appendChild(ai);He.appendChild(br);He.appendChild(ze);const qt={name:nc,description:ac,type:"note",order:{input:dt.NOTES_SHRADO_ANGLE,output:ft.NOTES_SHRADO_ANGLE},input:{enabled:rc,params:{distance:oc,maxTime:sc},html:He,adjustTime:yh},output:{html:null},run:Sh};function yh(i){Ui=i,ze.value=M(Ui.toBeatTime(qt.input.params.maxTime),2).toString()}function vh(){qt.input.params.distance=Math.max(parseInt(this.value),0),this.value=qt.input.params.distance.toString()}function Eh(){qt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(qt.input.params.maxTime*1e3,1).toString(),Ui&&(ze.value=M(Ui.toBeatTime(qt.input.params.maxTime),2).toString())}function Dh(){if(!Ui){this.value="0";return}let i=M(Math.abs(parseFloat(this.value)),2)||1;qt.input.params.maxTime=Ui.toRealTime(i),ai.value=M(qt.input.params.maxTime*1e3,1).toString(),this.value=i.toString()}function wh(i){var h;const{bpm:t}=i.settings,{noteContainer:e}=i.difficulty,{maxTime:n,distance:a}=qt.input.params,o=t.toBeatTime(n)+.001,r={},s={},l={},u={[nt.RED]:[],[nt.BLUE]:[]},c=[];for(let f=0,d=e.length;f<d;f++){if(e[f].type!=="note")continue;const m=e[f];r[m.data.color]?jt.next(m,r[m.data.color],t,u[m.data.color])?(l[m.data.color]&&(l[m.data.color]=null,s[m.data.color]=(h=ju[s[m.data.color]])!=null?h:8),m.data.getDistance(r[m.data.color].data)>=a&&gs(m.data.direction,s[m.data.color],m.data.color)&&m.data.time-r[m.data.color].data.time<=o&&c.push(m),m.data.direction===X.ANY?l[m.data.color]=m:s[m.data.color]=m.data.direction,u[m.data.color]=[]):(l[m.data.color]&&m.data.getDistance(r[m.data.color].data)>=a&&gs(m.data.direction,s[m.data.color],m.data.color)&&m.data.time-r[m.data.color].data.time<=o&&(c.push(l[m.data.color]),l[m.data.color]=null),m.data.direction!==X.ANY&&(s[m.data.color]=m.data.direction)):s[m.data.color]=m.data.direction,r[m.data.color]=m,u[m.data.color].push(m)}return c.map(f=>f.data.time).filter(function(f,d,m){return!d||f!==m[d-1]})}function gs(i,t,e){return i===8||t===8?!1:(e===0?t===7:t===6)&&i===0}function Sh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=wh(i);t.length?qt.output.html=ht("Shrado angle",t,i.settings.bpm,"warning"):qt.output.html=null}const lc="Speed Pause",cc="Look for stream/burst containing timing gap causing sudden change of pace.",uc=!1,hc=.075;let Gi;const Zi=document.createElement("div"),ri=document.createElement("input"),yr=document.createElement("label"),si=document.createElement("input"),vr=document.createElement("label");yr.textContent="stream speed (ms): ";yr.htmlFor="input__tools-speed-pause-time";ri.id="input__tools-speed-pause-time";ri.className="input-toggle input--small";ri.type="number";ri.min="0";ri.value=M(hc*1e3,1).toString();ri.addEventListener("change",Lh);vr.textContent=" (prec): ";vr.htmlFor="input__tools-speed-pause-prec";si.id="input__tools-speed-pause-prec";si.className="input-toggle input--small";si.type="number";si.min="0";si.addEventListener("change",Ch);Zi.appendChild(ct.create(lc,cc,uc,function(){Ee.input.enabled=this.checked}));Zi.appendChild(yr);Zi.appendChild(ri);Zi.appendChild(vr);Zi.appendChild(si);const Ee={name:lc,description:cc,type:"note",order:{input:dt.NOTES_SPEED_PAUSE,output:ft.NOTES_SPEED_PAUSE},input:{enabled:uc,params:{maxTime:hc},html:Zi,adjustTime:Th},output:{html:null},run:xh};function Th(i){Gi=i,si.value=M(1/Gi.toBeatTime(Ee.input.params.maxTime),2).toString()}function Lh(){Ee.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(Ee.input.params.maxTime*1e3,1).toString(),Gi&&(si.value=M(1/Gi.toBeatTime(Ee.input.params.maxTime),2).toString())}function Ch(){if(!Gi){this.value="0";return}let i=M(Math.abs(parseFloat(this.value)),2)||1;Ee.input.params.maxTime=Gi.toRealTime(1/i),ri.value=M(Ee.input.params.maxTime*1e3,1).toString(),this.value=i.toString()}function kh(i,t){const{bpm:e}=i,{noteContainer:n}=t,{maxTime:a}=Ee.input.params,o=e.toBeatTime(a)+.001,r={},s={},l={[nt.RED]:!1,[nt.BLUE]:!1},u={[nt.RED]:[],[nt.BLUE]:[]},c=[];for(let h=0,f=n.length;h<f;h++){if(n[h].type!=="note")continue;const d=n[h];r[d.data.color]?jt.next(d,r[d.data.color],e,u[d.data.color])&&(d.data.time-r[d.data.color].data.time<=o*2?(l[nt.RED]&&l[nt.BLUE]&&r[d.data.color].data.time-s[d.data.color].data.time<=o*3&&c.push(r[d.data.color]),l[d.data.color]=!1):l[d.data.color]||(l[d.data.color]=!0,s[d.data.color]=r[d.data.color]),u[d.data.color]=[],r[d.data.color]=d):r[d.data.color]=d,u[d.data.color].push(d)}return c.map(h=>h.data.time).filter(function(h,f,d){return!f||h!==d[f-1]})}function xh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=kh(i.settings,i.difficulty);t.length?Ee.output.html=ht("Speed pause",t,i.settings.bpm,"warning"):Ee.output.html=null}const Ft=class extends sr{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m,g,_;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:Ft.default.b,x:(s=(r=n.posX)!=null?r:n.x)!=null?s:Ft.default.x,y:(u=(l=n.posY)!=null?l:n.y)!=null?u:Ft.default.y,c:(h=(c=n.color)!=null?c:n.c)!=null?h:Ft.default.c,d:(d=(f=n.direction)!=null?f:n.d)!=null?d:Ft.default.d,a:(g=(m=n.angleOffset)!=null?m:n.a)!=null?g:Ft.default.a,customData:(_=n.customData)!=null?_:Ft.default.customData()}))}),e.length?e:[new this({b:Ft.default.b,x:Ft.default.x,y:Ft.default.y,c:Ft.default.c,d:Ft.default.d,a:Ft.default.a,customData:Ft.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,a:this.angleOffset,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get color(){return this.data.c}set color(t){this.data.c=t}get type(){return this.data.c}set type(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get angleOffset(){return this.data.a}set angleOffset(t){this.data.a=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]})),super.mirror(t)}getAngle(t){switch(t){case"vanilla":return(xt[this.direction]||0)+this.angleOffset;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return(xt[this.direction]||0)+this.angleOffset;default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):(xt[this.direction]||0)+this.angleOffset}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.track=="string"}};let Ie=Ft;$(Ie,"default",{b:0,c:0,x:0,y:0,d:0,a:0,customData:()=>({})});const _s="Hitbox Staircase",bs="Check for overlapping post-swing hitbox with note hitbox during swing.",ys=!0,Zn={name:_s,description:bs,type:"note",order:{input:dt.NOTES_HITBOX_STAIR,output:ft.NOTES_HITBOX_STAIR},input:{enabled:ys,params:{},html:ct.create(_s,bs,ys,function(){Zn.input.enabled=this.checked})},output:{html:null},run:Ih};function Rh(i,t,e){for(let n=e,a=t.length;n<a;n++)if(t[n].type==="note"){if(t[n].data.time<i.data.time+.01&&t[n].data.color!==i.data.color)return!0;if(t[n].data.time>i.data.time+.01)return!1}return!1}function Nh(i){const{bpm:t}=i.settings,{noteContainer:e}=i.difficulty,n=t.toBeatTime(.15),a={},o={},r={},s={[nt.RED]:[],[nt.BLUE]:[]},l={[nt.RED]:Ie.create()[0],[nt.BLUE]:Ie.create({c:1})[0]},u=[];for(let c=0,h=e.length;c<h;c++){if(e[c].type!=="note")continue;const f=e[c];a[f.data.color]?(jt.next(f,a[f.data.color],t,s[f.data.color])?(r[f.data.color]=f.data.time-a[f.data.color].data.time,f.data.direction!==X.ANY?(l[f.data.color].posX=f.data.posX+Ye[f.data.direction][0],l[f.data.color].posY=f.data.posY+Ye[f.data.direction][1]):(l[f.data.color].posX=-1,l[f.data.color].posY=-1),s[f.data.color]=[],o[f.data.color]=f.data.direction):$l(f.data,a[f.data.color].data,o[f.data.color])&&(f.data.direction!==X.ANY?(l[f.data.color].posX=f.data.posX+Ye[f.data.direction][0],l[f.data.color].posY=f.data.posY+Ye[f.data.direction][1],o[f.data.color]=f.data.direction):(l[f.data.color].posX=f.data.posX+Ye[o[f.data.color]][0],l[f.data.color].posY=f.data.posY+Ye[o[f.data.color]][1])),a[(f.data.color+1)%2]&&f.data.time-a[(f.data.color+1)%2].data.time!==0&&f.data.time-a[(f.data.color+1)%2].data.time<Math.min(n,r[(f.data.color+1)%2])&&f.data.posX===l[(f.data.color+1)%2].posX&&f.data.posY===l[(f.data.color+1)%2].posY&&!Rh(f,e,c)&&u.push(f)):(f.data.direction!==X.ANY?(l[f.data.color].posX=f.data.posX+Ye[f.data.direction][0],l[f.data.color].posY=f.data.posY+Ye[f.data.direction][1]):(l[f.data.color].posX=-1,l[f.data.color].posY=-1),o[f.data.color]=f.data.direction),a[f.data.color]=f,s[f.data.color].push(f)}return u.map(c=>c.data.time).filter(function(c,h,f){return!h||c!==f[h-1]})}function Ih(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=Nh(i);t.length?Zn.output.html=ht("Hitbox staircase",t,i.settings.bpm,"rank"):Zn.output.html=null}const vs="Hitbox Reverse Staircase",Es="Check for overlapping pre-swing hitbox with note hitbox during swing.",Ds=!0,Kn={name:vs,description:Es,type:"note",order:{input:dt.NOTES_HITBOX_REVERSE_STAIR,output:ft.NOTES_HITBOX_REVERSE_STAIR},input:{enabled:Ds,params:{},html:ct.create(vs,Es,Ds,function(){Kn.input.enabled=this.checked})},output:{html:null},run:Oh},Ah=.03414823529,Bh=.03414823529;function $h(i){const{bpm:t,njs:e}=i.settings,{noteContainer:n}=i.difficulty,a={},o={[nt.RED]:[],[nt.BLUE]:[]},r=[];for(let s=0,l=n.length;s<l;s++){if(n[s].type!=="note")continue;const u=n[s];a[u.data.color]&&jt.next(u,a[u.data.color],t,o[u.data.color])&&(o[u.data.color]=[]);for(const c of o[(u.data.color+1)%2])if(c.type==="note"&&c.data.direction!==X.ANY){if(!(t.toRealTime(u.data.time)>t.toRealTime(c.data.time)+.01))continue;const h=c.data.getAngle()%90>15&&c.data.getAngle()%90<75;if(e.value<1.425/(60*(u.data.time-c.data.time)/t.value+(h?Bh:Ah))&&qa(u.data,c.data,[[15,1.5]])[1]){r.push(c);break}}a[u.data.color]=u,o[u.data.color].push(u)}return r.map(s=>s.data.time).filter(function(s,l,u){return!l||s!==u[l-1]})}function Oh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=$h(i);t.length?Kn.output.html=ht("Hitbox reverse Staircase",t,i.settings.bpm,"rank"):Kn.output.html=null}const ws="Hitbox Inline",Ss="Check for overlapping note hitbox for inline note.",Ts=!0,Qn={name:ws,description:Ss,type:"note",order:{input:dt.NOTES_HITBOX_INLINE,output:ft.NOTES_HITBOX_INLINE},input:{enabled:Ts,params:{},html:ct.create(ws,Ss,Ts,function(){Qn.input.enabled=this.checked})},output:{html:null},run:Fh},Mh=0;function Ph(i){const{bpm:t,njs:e}=i.settings,{noteContainer:n}=i.difficulty,a={},o={[nt.RED]:[],[nt.BLUE]:[]},r=[];for(let s=0,l=n.length;s<l;s++){if(n[s].type!=="note")continue;const u=n[s];a[u.data.color]&&jt.next(u,a[u.data.color],t,o[u.data.color])&&(o[u.data.color]=[]);for(const c of o[(u.data.color+1)%2])if(c.type==="note"&&e.value<1.425/(60*(u.data.time-c.data.time)/t.value+Mh)&&u.data.isInline(c.data)){r.push(u);break}a[u.data.color]=u,o[u.data.color].push(u)}return r.map(s=>s.data.time).filter(function(s,l,u){return!l||s!==u[l-1]})}function Fh(i){const t=Ph(i);t.length?Qn.output.html=ht("Hitbox inline",t,i.settings.bpm,"rank"):Qn.output.html=null}const Ls="Hitbox Path",Cs="Check for overlapping pre-swing note hitbox at same time.",ks=!0,ta={name:Ls,description:Cs,type:"note",order:{input:dt.NOTES_HITBOX_PATH,output:ft.NOTES_HITBOX_PATH},input:{enabled:ks,params:{},html:ct.create(Ls,Cs,ks,function(){ta.input.enabled=this.checked})},output:{html:null},run:zh};function Hh(i){const{bpm:t}=i.settings,e=i.difficulty.noteContainer.filter(o=>o.type==="bomb"||o.type==="note"),n=[];let a=0;for(let o=0,r=e.length;o<r;o++){const s=e[o];if(!(s.type==="bomb"||s.type==="slider"||s.type==="burstSlider"||t.toRealTime(s.data.time)<a+.01))for(let l=o+1;l<r;l++){const u=e[l];if(t.toRealTime(u.data.time)>t.toRealTime(s.data.time)+.01)break;u.type==="note"&&s.data.color===u.data.color||((s.data.isHorizontal(u.data)||s.data.isVertical(u.data))&&qa(s.data,u.data,[[45,1],[15,2]]).some(c=>c)||s.data.isDiagonal(u.data)&&qa(s.data,u.data,[[45,1],[15,1.5]]).some(c=>c))&&(n.push(s.data),a=t.toRealTime(s.data.time))}}return n.map(o=>o.time).filter(function(o,r,s){return!r||o!==s[r-1]})}function zh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=Hh(i);t.length?ta.output.html=ht("Hitbox path",t,i.settings.bpm,"error"):ta.output.html=null}const xs="Improper Arc",Rs="Check for correct use of arc.",Ns=!0,ea={name:xs,description:Rs,type:"note",order:{input:dt.NOTES_IMPROPER_ARC,output:ft.NOTES_IMPROPER_ARC},input:{enabled:Ns,params:{},html:ct.create(xs,Rs,Ns,function(){ea.input.enabled=this.checked})},output:{html:null},run:jh};function Xh(i){const t=[...i.difficulty.noteContainer].sort((n,a)=>n.type!=="slider"?1:a.type!=="slider"?-1:0).sort((n,a)=>n.data.time-a.data.time),e=[];for(let n=0,a=!0,o=t.length;n<o;n++){const r=t[n];if(r.type==="slider"){a=!0;for(let s=n,l=!1;s<o;s++){const u=t[s];if(u.type==="note"&&r.data.posX===u.data.posX&&r.data.posY===u.data.posY&&u.data.time<=r.data.time+.001&&r.data.color===u.data.color&&(u.data.direction!==X.ANY?r.data.direction===u.data.direction:!0)){for(let c=s;c<o;c++){const h=t[s];if(h.type==="bomb"&&r.data.posX===h.data.posX&&r.data.posY===h.data.posY&&h.data.time<=r.data.time+.001){l=!0;break}if(!(h.type!=="note"||h.data.time<r.data.tailTime)){if(r.data.posX===u.data.posX&&r.data.posY===u.data.posY&&u.data.time<=r.data.time+.001&&(r.data.color!==u.data.color||(u.data.direction!==X.ANY?r.data.direction!==u.data.direction:!0))){l=!0;break}if(u.data.time>r.data.tailTime+.001)break}}a=l||!1;break}if(u.type==="bomb"&&r.data.posX===u.data.posX&&r.data.posY===u.data.posY&&u.data.time<=r.data.time+.001||u.data.time>r.data.time+.001)break}a&&e.push(r)}}return e.map(n=>n.data.time).filter(function(n,a,o){return!a||n!==o[a-1]})}function jh(i){const t=Xh(i);t.length?ea.output.html=ht("Improper arc",t,i.settings.bpm,"error"):ea.output.html=null}const Is="Improper Chain",As="Check for correct use of chain.",Bs=!0,ia={name:Is,description:As,type:"note",order:{input:dt.NOTES_IMPROPER_CHAIN,output:ft.NOTES_IMPROPER_CHAIN},input:{enabled:Bs,params:{},html:ct.create(Is,As,Bs,function(){ia.input.enabled=this.checked})},output:{html:null},run:Uh};function Yh(i){const t=[...i.difficulty.noteContainer].sort((n,a)=>n.type!=="burstSlider"?1:a.type!=="burstSlider"?-1:0).sort((n,a)=>n.data.time-a.data.time),e=[];for(let n=0,a=!0,o=t.length;n<o;n++){const r=t[n];if(r.type==="burstSlider"){a=!0;for(let s=n;s<o;s++){const l=t[s];if(l.type==="note"&&r.data.posX===l.data.posX&&r.data.posY===l.data.posY&&l.data.time<=r.data.time+.001&&r.data.color===l.data.color&&(l.data.direction!==X.ANY?r.data.direction===l.data.direction:!0)){a=!1;break}if(l.type==="bomb"&&r.data.posX===l.data.posX&&r.data.posY===l.data.posY&&l.data.time<=r.data.time+.001||l.data.time>r.data.time+.001)break}a&&e.push(r)}}return e.map(n=>n.data.time).filter(function(n,a,o){return!a||n!==o[a-1]})}function Uh(i){const t=Yh(i);t.length?ia.output.html=ht("Improper chain",t,i.settings.bpm,"error"):ia.output.html=null}const $s="Improper Window Snap",Os="Check for slanted window snap timing.",Ms=!0,na={name:$s,description:Os,type:"note",order:{input:dt.NOTES_IMPROPER_WINDOW,output:ft.NOTES_IMPROPER_WINDOW},input:{enabled:Ms,params:{},html:ct.create($s,Os,Ms,function(){na.input.enabled=this.checked})},output:{html:null},run:Wh};function Gh(i){const{bpm:t}=i.settings,{noteContainer:e}=i.difficulty,n={},a={[nt.RED]:[],[nt.BLUE]:[]},o=[];for(let r=0,s=e.length;r<s;r++){if(e[r].type!=="note")continue;const l=e[r];n[l.data.color]?jt.next(l,n[l.data.color],t,a[l.data.color])?(n[l.data.color]=l,a[l.data.color]=[]):l.data.isSlantedWindow(n[l.data.color].data)&&l.data.time-n[l.data.color].data.time>=.001&&l.data.direction===n[l.data.color].data.direction&&l.data.direction!==X.ANY&&n[l.data.color].data.direction!==X.ANY&&o.push(n[l.data.color]):n[l.data.color]=l,a[l.data.color].push(l)}return o.map(r=>r.data.time).filter(function(r,s,l){return!s||r!==l[s-1]})}function Wh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=Gh(i);t.length?na.output.html=ht("Improper window snap",t,i.settings.bpm,"error"):na.output.html=null}const yn={create:(i,t,e,n,...a)=>{const o=document.createElement(e);o.className=n;const r=document.createElement("select");r.className="input-toggle",r.id=i,a.forEach(l=>{const u=document.createElement("option");u.textContent=l.text,u.value=l.value,r.append(u)});const s=document.createElement("label");return s.htmlFor=i,s.innerHTML=`<span>${t}</span>`,o.append(s),o.append(r),o}};var dc=(i=>(i.forehand="backhand",i.backhand="forehand",i))(dc||{});const Ln={[nt.RED]:{forehand:[X.DOWN,X.RIGHT,X.DOWN_LEFT,X.DOWN_RIGHT],backhand:[X.UP,X.LEFT,X.UP_LEFT,X.UP_RIGHT]},[nt.BLUE]:{forehand:[X.DOWN,X.LEFT,X.DOWN_LEFT,X.DOWN_RIGHT],backhand:[X.UP,X.RIGHT,X.UP_LEFT,X.UP_RIGHT]}},di={[nt.RED]:[0,0,90,90,45,-45,45,-45],[nt.BLUE]:[0,0,-90,-90,-45,45,-45,45]},Ps={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},Ii=class{constructor(t,e,n,a,o,r){$(this,"state");$(this,"color");$(this,"rotation");$(this,"position");$(this,"warningThreshold");$(this,"errorThreshold");$(this,"allowedRotation");this.color=e,this.warningThreshold=n,this.errorThreshold=a,this.allowedRotation=o,r&&r!=="neutral"?(this.state=r,this.rotation=0):(this.state=this.predictStartState(t,e),this.rotation=this.predictStartRotation(t,e)),this.position=this.predictStartPosition(t,e)}check(t,e){if(this.state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const n=t[0].data.time,a=this.color;let o=this.state,r=this.rotation;e.forEach(c=>{c.data.time-.001>n||(c.data.posY===At.BOTTOM&&c.data.posX===(a?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(o="backhand",r=0),c.data.posY===At.TOP&&c.data.posX===(a?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(o="forehand",r=0))});let s,l=X.ANY;for(const c of t)c.type==="note"&&(c.data.direction!==X.ANY&&(l=c.data.direction),s&&l===X.ANY&&(l=os(c.data,s.data)),s=c);if(l===X.ANY)return"none";const u=Ps[a][dc[o]][l];return(r>u?r-u:u-r)>180||u<Ii.CONSTRAINT_ROTATION[a][0]+this.errorThreshold||u>Ii.CONSTRAINT_ROTATION[a][1]-this.errorThreshold?"error":u<Ii.CONSTRAINT_ROTATION[a][0]+this.warningThreshold||u>Ii.CONSTRAINT_ROTATION[a][1]-this.warningThreshold||(r>u?r-u:u-r)>this.allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let s=0;s<t.length;s++){if(t[s].type!=="note")continue;const l=t[s];if(Ln[l.data.color].forehand.includes(l.data.direction)){this.state="backhand";break}if(Ln[l.data.color].backhand.includes(l.data.direction)){this.state="forehand";break}this.state==="neutral"&&l.data.direction===X.ANY&&(l.data.posY===0&&(this.state="backhand"),l.data.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const n=t[0].data.time,a=this.color;e.forEach(s=>{s.data.time-.001>n||(s.data.posY===At.BOTTOM&&s.data.posX===(a?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(this.state="forehand",this.rotation=0),s.data.posY===At.TOP&&s.data.posX===(a?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(this.state="backhand",this.rotation=0))});let o,r=X.ANY;for(const s of t)s.type==="note"&&(s.data.direction!==X.ANY&&(r=s.data.direction),o&&r===X.ANY&&(r=os(s.data,o.data)),o=s);r!==X.ANY&&(this.rotation=Ps[this.color][this.state][r])}predictStartState(t,e){let n="neutral";for(let a=0,o=t.length;a<o;a++){if(t[a].type==="bomb"&&(t[a].data.posY===At.BOTTOM&&(t[a].data.posX===e?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(n="backhand"),t[a].data.posY===At.TOP&&(t[a].data.posX===e?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(n="forehand")),t[a].type!=="note")continue;let r=t[a];if(r.data.color!==Math.abs(e-1)&&r.data.color===e){if(n!=="neutral")break;const s=r.data.time;for(let l=a;l<t.length&&!(t[l].data.time>r.data.time+.001&&s<r.data.time+.001);l++){if(r=t[l],Ln[r.data.color].forehand.includes(r.data.direction))return"backhand";if(Ln[r.data.color].backhand.includes(r.data.direction))return"forehand";n==="neutral"&&r.data.direction===X.ANY&&(r.data.posY===At.BOTTOM&&(n="backhand"),r.data.posY>At.BOTTOM&&(n="forehand"))}break}}return n}predictStartRotation(t,e){let n=0;for(let a=0,o=t.length;a<o;a++){if(t[a].type!=="note")continue;let r=t[a];if(r.data.color===e&&r.data.color===e){const s=r.data.time;for(let l=a;l<t.length&&!(t[l].data.time>r.data.time+.001&&s<r.data.time+.001);l++){if(r=t[l],r.data.direction!==X.ANY)return di[r.data.color][r.data.direction];r.data.direction===X.ANY&&(r.data.posY===At.BOTTOM&&(r.data.posX===ot.LEFT&&(n=di[r.data.color][6]),r.data.posX===ot.RIGHT&&(n=di[r.data.color][7])),r.data.posY===At.MIDDLE&&(r.data.posX===ot.LEFT&&(n=di[r.data.color][2]),r.data.posX===ot.RIGHT&&(n=di[r.data.color][3])),r.data.posY===At.BOTTOM&&(r.data.posX===ot.LEFT&&(n=di[r.data.color][4]),r.data.posX===ot.RIGHT&&(n=di[r.data.color][5])))}break}}return n}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let ln=Ii;$(ln,"CONSTRAINT_ROTATION",[[-155,195],[-195,155]]);const fc="Parity Check",mc="Perform parity check.",pc=!1,gc=document.createElement("div");yn.create("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});yn.create("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});yn.create("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});gc.appendChild(ct.create(fc+" (EXPERIMENTAL)",mc,pc,function(){pn.input.enabled=this.checked}));const pn={name:fc,description:mc,type:"note",order:{input:dt.NOTES_PARITY,output:ft.NOTES_PARITY},input:{enabled:pc,params:{warningThres:90,errorThres:45,allowedRot:90},html:gc},output:{html:null},run:Jh};function Vh(i){const{bpm:t}=i.settings,{noteContainer:e}=i.difficulty,{warningThres:n,errorThres:a,allowedRot:o}=pn.input.params,r={},s={[nt.RED]:[],[nt.BLUE]:[]},l={[nt.RED]:[],[nt.BLUE]:[]},u={[nt.RED]:[],[nt.BLUE]:[]},c={[nt.RED]:new ln(e,0,n,a,o),[nt.BLUE]:new ln(e,1,n,a,o)},h={warning:[],error:[]};for(let f=0,d=e.length;f<d;f++){const m=e[f];if(m.type==="note"&&r[m.data.color]&&jt.next(m,r[m.data.color],t,s[m.data.color])){switch(c[m.data.color].check(s[m.data.color],u[m.data.color])){case"warning":{h.warning.push(s[m.data.color][0].data.time);break}case"error":{h.error.push(s[m.data.color][0].data.time);break}}c[m.data.color].next(s[m.data.color],u[m.data.color]),u[m.data.color]=l[m.data.color],l[m.data.color]=[],s[m.data.color]=[]}m.type==="bomb"&&(l[nt.RED].push(m),l[nt.BLUE].push(m)),m.type==="note"&&(r[m.data.color]=m,s[m.data.color].push(m))}for(let f=0;f<2;f++)if(r[f])switch(c[f].check(s[f],l[f])){case"warning":{h.warning.push(s[f][0].data.time);break}case"error":{h.error.push(s[f][0].data.time);break}}return h}function Jh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=Vh(i);t.warning=t.warning.filter(function(n,a,o){return!a||n!==o[a-1]}).sort((n,a)=>n-a),t.error=t.error.filter(function(n,a,o){return!a||n!==o[a-1]}).sort((n,a)=>n-a);const e=[];if(t.warning.length&&e.push(ht("Parity warning",t.warning,i.settings.bpm,"warning")),t.error.length&&e.push(ht("Parity error",t.error,i.settings.bpm,"error")),e.length){const n=document.createElement("div");e.forEach(a=>n.append(a)),pn.output.html=n}else pn.output.html=null}const Fs="Double-directional",Hs="Check double-directional note swing (this may not mean parity break).",zs=!0,aa={name:Fs,description:Hs,type:"note",order:{input:dt.NOTES_DOUBLE_DIRECTIONAL,output:ft.NOTES_DOUBLE_DIRECTIONAL},input:{enabled:zs,params:{},html:ct.create(Fs,Hs,zs,function(){aa.input.enabled=this.checked})},output:{html:null},run:Zh};function qh(i,t){const{bpm:e}=i,n=t.noteContainer,a={},o={},r={},s={[nt.RED]:[],[nt.BLUE]:[]},l=[];for(let u=0,c=n.length;u<c;u++){const h=n[u];h.type==="note"&&a[h.data.color]?jt.next(h,a[h.data.color],e,s[h.data.color])?(r[h.data.color]&&(r[h.data.color]=null,o[h.data.color]=(o[h.data.color]+180)%360),mn(h.data,o[h.data.color],45,!0)&&l.push(h.data),h.data.direction===X.ANY?r[h.data.color]=h.data:o[h.data.color]=h.data.getAngle(),s[h.data.color]=[]):(r[h.data.color]&&mn(h.data,o[h.data.color],45,!0)&&(l.push(h.data),r[h.data.color]=null,o[h.data.color]=h.data.getAngle()),h.data.direction!==X.ANY&&(r[h.data.color]=null,o[h.data.color]=h.data.getAngle())):h.type==="note"&&(o[h.data.color]=h.data.getAngle()),h.type==="note"&&(a[h.data.color]=h,s[h.data.color].push(h)),h.type==="bomb"&&(h.data.posY===At.BOTTOM&&(h.data.posX===ot.MIDDLE_LEFT&&(o[nt.RED]=xt[X.UP],r[nt.RED]=null),h.data.posX===ot.MIDDLE_RIGHT&&(o[nt.BLUE]=xt[X.UP],r[nt.BLUE]=null)),h.data.posY===At.TOP&&(h.data.posX===ot.MIDDLE_LEFT&&(o[nt.RED]=xt[X.DOWN],r[nt.RED]=null),h.data.posX===ot.MIDDLE_RIGHT&&(o[nt.BLUE]=xt[X.DOWN],r[nt.BLUE]=null)))}return l.map(u=>u.time).filter(function(u,c,h){return!c||u!==h[c-1]})}function Zh(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=qh(i.settings,i.difficulty);t.length?aa.output.html=ht("Double-directional",t,i.settings.bpm,"warning"):aa.output.html=null}const _c="Vision Block",bc="Check for vision block caused by center note.",yc=!0,vc=.1,Ec=.5;let Zt;const Xs={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},Yt=document.createElement("div"),ki=document.createElement("input"),Er=document.createElement("label"),oi=document.createElement("input"),Dr=document.createElement("label"),li=document.createElement("input"),wr=document.createElement("label"),Xe=document.createElement("input"),Sr=document.createElement("label"),Ae=document.createElement("input"),Tr=document.createElement("label"),De=document.createElement("input"),Lr=document.createElement("label");Er.textContent=" VB time specific ";Er.htmlFor="input__tools-vb-time-check";ki.id="input__tools-vb-time-check";ki.className="input-toggle";ki.type="radio";ki.name="input__tools-vb-spec";ki.value="time";ki.addEventListener("change",Dc);Dr.textContent=" VB difficulty specific ";Dr.htmlFor="input__tools-vb-diff-check";oi.id="input__tools-vb-diff-check";oi.className="input-toggle";oi.type="radio";oi.checked=!0;oi.name="input__tools-vb-spec";oi.value="difficulty";oi.addEventListener("change",Dc);wr.textContent="min time (ms): ";wr.htmlFor="input__tools-vb-min-time";li.id="input__tools-vb-min-time";li.className="input-toggle input--small";li.type="number";li.min="0";li.value=M(vc*1e3,1).toString();li.addEventListener("change",Qh);Sr.textContent=" (beat): ";Sr.htmlFor="input__tools-vb-min-beat";Xe.id="input__tools-vb-min-beat";Xe.className="input-toggle input--small";Xe.type="number";Xe.min="0";Xe.step="0.1";Xe.addEventListener("change",td);Tr.textContent="max time (ms): ";Tr.htmlFor="input__tools-vb-max-time";Ae.id="input__tools-vb-max-time";Ae.className="input-toggle input--small";Ae.type="number";Ae.min="0";Ae.value=M(Ec*1e3,1).toString();Ae.addEventListener("change",ed);Lr.textContent=" (beat): ";Lr.htmlFor="input__tools-vb-max-beat";De.id="input__tools-vb-max-beat";De.className="input-toggle input--small";De.type="number";De.min="0";De.step="0.1";De.addEventListener("change",id);Yt.appendChild(ct.create(_c,bc,yc,function(){vt.input.enabled=this.checked}));Yt.appendChild(ki);Yt.appendChild(Er);Yt.appendChild(oi);Yt.appendChild(Dr);Yt.appendChild(document.createElement("br"));Yt.appendChild(wr);Yt.appendChild(li);Yt.appendChild(Sr);Yt.appendChild(Xe);Yt.appendChild(document.createElement("br"));Yt.appendChild(Tr);Yt.appendChild(Ae);Yt.appendChild(Lr);Yt.appendChild(De);const vt={name:_c,description:bc,type:"note",order:{input:dt.NOTES_VISION_BLOCK,output:ft.NOTES_VISION_BLOCK},input:{enabled:yc,params:{specific:"difficulty",minTime:vc,maxTime:Ec},html:Yt,adjustTime:Kh},output:{html:null},run:ad};function Kh(i){Zt=i,Xe.value=M(Zt.toBeatTime(vt.input.params.minTime),2).toString(),De.value=M(Zt.toBeatTime(vt.input.params.maxTime),2).toString()}function Dc(){vt.input.params.specific=this.value}function Qh(){vt.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(vt.input.params.minTime*1e3,1).toString(),Zt&&(Xe.value=M(Zt.toBeatTime(vt.input.params.minTime),2).toString(),vt.input.params.minTime>vt.input.params.maxTime&&(vt.input.params.maxTime=vt.input.params.minTime,Ae.value=M(vt.input.params.maxTime*1e3,1).toString(),De.value=M(Zt.toBeatTime(vt.input.params.maxTime),2).toString()))}function td(){if(!Zt){this.value="0";return}const i=Math.abs(parseFloat(this.value))||1;vt.input.params.minTime=Zt.toRealTime(i),li.value=M(vt.input.params.minTime*1e3,1).toString(),this.value=M(i,2).toString(),vt.input.params.minTime>vt.input.params.maxTime&&(vt.input.params.maxTime=vt.input.params.minTime,Ae.value=M(vt.input.params.maxTime*1e3,1).toString(),De.value=M(Zt.toBeatTime(vt.input.params.maxTime),2).toString())}function ed(){vt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(vt.input.params.maxTime*1e3,1).toString(),Zt&&(De.value=M(Zt.toBeatTime(vt.input.params.maxTime),2).toString())}function id(){if(!Zt){this.value="0";return}const i=Math.abs(parseFloat(this.value))||1;vt.input.params.maxTime=Zt.toRealTime(i),Ae.value=M(vt.input.params.maxTime*1e3,1).toString(),this.value=M(i,2).toString()}function nd(i){const{bpm:t,njs:e}=i.settings,n=i.difficulty.data.getNoteContainer().filter(f=>f.type!=="slider"),{minTime:a,maxTime:o,specific:r}=vt.input.params,s=r==="time"?t.toBeatTime(a):t.toBeatTime(Xs[i.difficulty.difficulty].min),l=r==="time"?t.toBeatTime(o):Math.min(e.hjd,t.toBeatTime(Xs[i.difficulty.difficulty].max));let u=null,c=null;const h=[];for(let f=0,d=n.length;f<d;f++){const m=n[f];u&&(m.data.time-u.data.time>=s&&m.data.time-u.data.time<=l?m.data.posX<ot.MIDDLE_RIGHT&&h.push(m):m.data.time-u.data.time>l&&(u=null)),c&&(m.data.time-c.data.time>=s&&m.data.time-c.data.time<=l?m.data.posX>ot.MIDDLE_LEFT&&h.push(m):m.data.time-c.data.time>l&&(c=null)),m.data.posY===At.MIDDLE&&m.data.posX===ot.MIDDLE_LEFT&&(u=m),m.data.posY===At.MIDDLE&&m.data.posX===ot.MIDDLE_RIGHT&&(c=m)}return h.map(f=>f.data.time).filter(function(f,d,m){return!d||f!==m[d-1]})}function ad(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=nd(i);t.length?vt.output.html=ht("Vision block",t,i.settings.bpm,"warning"):vt.output.html=null}const js="Stacked Note",Ys="Look for stacked note.",Us=!0,ra={name:js,description:Ys,type:"note",order:{input:dt.NOTES_STACKED_NOTE,output:ft.NOTES_STACKED_NOTE},input:{enabled:Us,params:{},html:ct.create(js,Ys,Us,function(){ra.input.enabled=this.checked})},output:{html:null},run:od};function rd(i,t){const{bpm:e}=i,{colorNotes:n}=t.data,a=[];let o=0;for(let r=0,s=n.length;r<s;r++)if(!(e.toRealTime(n[r].time)<o+.01))for(let l=r+1;l<s&&!(e.toRealTime(n[l].time)>e.toRealTime(n[r].time)+.01);l++)n[l].isInline(n[r])&&(a.push(n[r]),o=e.toRealTime(n[r].time));return a.map(r=>r.time).filter(function(r,s,l){return!s||r!==l[s-1]})}function sd(i,t){const{bpm:e,njs:n}=i,{bombNotes:a}=t.data,o=[];for(let r=0,s=a.length;r<s;r++)for(let l=r+1;l<s&&!(e.toRealTime(a[l].time)>e.toRealTime(a[r].time)+1);l++)a[r].isInline(a[l])&&(n.value<e.value/(120*(a[l].time-a[r].time))||e.toRealTime(a[l].time)<e.toRealTime(a[r].time)+.02)&&o.push(a[r]);return o.map(r=>r.time).filter(function(r,s,l){return!s||r!==l[s-1]})}function od(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=rd(i.settings,i.difficulty),e=sd(i.settings,i.difficulty),n=[];if(t.length&&n.push(ht("Stacked note",t,i.settings.bpm,"error")),e.length&&n.push(ht("Stacked bomb",e,i.settings.bpm,"error")),n.length){const a=document.createElement("div");n.forEach(o=>a.append(o)),ra.output.html=a}else ra.output.html=null}const Gs="Color Check",Ws="Compare note color with other colored note and the arrow on itself.",Vs=!0,Js=[1,1,1],qs={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"};function Zs(i,t){var a;let e=(a=Object.keys(i).find(o=>parseFloat(o)>=t))!=null?a:"100",n=parseFloat(e);return i[n]}const sa={name:Gs,description:Ws,type:"note",order:{input:dt.NOTES_COLOR_CHECK,output:ft.NOTES_COLOR_CHECK},input:{enabled:Vs,params:{},html:ct.create(Gs+" (EXPERIMENTAL)",Ws,Vs,function(){sa.input.enabled=this.checked})},output:{html:null},run:ud};function ld(i){var n,a,o,r,s,l,u,c;const t=(r=(a=(n=i.difficulty)==null?void 0:n.info._customData)==null?void 0:a._colorLeft)!=null?r:_e[(o=ge[i.info._environmentName])!=null?o:"The First"]._colorLeft,e=(c=(l=(s=i.difficulty)==null?void 0:s.info._customData)==null?void 0:l._colorRight)!=null?c:_e[(u=ge[i.info._environmentName])!=null?u:"The First"]._colorRight;return t&&e?xa(Gn(t),Gn(e)):100}function cd(i){var o,r,s,l,u,c,h,f;let t=100,e=100;const n=(l=(r=(o=i.difficulty)==null?void 0:o.info._customData)==null?void 0:r._colorLeft)!=null?l:_e[(s=ge[i.info._environmentName])!=null?s:"The First"]._colorLeft,a=(f=(c=(u=i.difficulty)==null?void 0:u.info._customData)==null?void 0:c._colorRight)!=null?f:_e[(h=ge[i.info._environmentName])!=null?h:"The First"]._colorRight;return n&&(t=xa(Js,Gn(n))),a&&(e=xa(Js,Gn(a))),Math.min(t,e)}function ud(i){var a,o,r,s;if(!((o=(a=i.difficulty)==null?void 0:a.info._customData)!=null&&o._colorLeft)&&!((s=(r=i.difficulty)==null?void 0:r.info._customData)!=null&&s._colorRight))return;const t=ld(i),e=cd(i),n=[];if(t<=20&&n.push(gt(`${Zs(qs,t)} note color (dE${M(t,1)})`,"suggest change to better differentiate between 2 note colour","warning")),e<=20&&n.push(gt(`${Zs(qs,e)} arrow note color (dE${M(e,1)})`,"may be difficult to see the arrow","warning")),n.length){const l=document.createElement("div");n.forEach(u=>l.append(u)),sa.output.html=l}else sa.output.html=null}const Ks=Object.freeze(Object.defineProperty({__proto__:null,effectiveBPM:Wt,acceptablePrec:Ti,varySwing:qn,slowSlider:ce,inlineAngle:ve,shradoAngle:qt,speedPause:Ee,hitboxStair:Zn,hitboxReverseStair:Kn,hitboxInline:Qn,hitboxPath:ta,improperArc:ea,improperChain:ia,improperWindow:na,parity:pn,doubleDirectional:aa,visionBlock:vt,stackedNote:ra,colorCheck:sa},Symbol.toStringTag,{value:"Module"}));class wc extends va{setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}mirror(){return this.posX=ba-1-(this.posX+this.width-1),this}getPosition(){return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}isInteractive(){return this.posX<0&&this.width>1-this.posX||this.posX===0&&this.width>1||this.posX===1||this.posX===2}isLonger(t,e=0){return this.time+this.duration>t.time+t.duration+e}hasZero(){return this.duration===0||this.width===0||this.height===0}hasNegative(){return this.posY<0||this.duration<0||this.width<0||this.height<0}isMappingExtensions(){return this.posY>2||this.posX<=-1e3||this.posX>=1e3}isValid(){return!this.isMappingExtensions()&&!this.hasZero()&&!this.hasNegative()}}const Ht=class extends wc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m,g,_;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:Ht.default.b,x:(s=(r=n.posX)!=null?r:n.x)!=null?s:Ht.default.x,y:(u=(l=n.posY)!=null?l:n.y)!=null?u:Ht.default.y,d:(h=(c=n.duration)!=null?c:n.d)!=null?h:Ht.default.d,w:(d=(f=n.width)!=null?f:n.w)!=null?d:Ht.default.w,h:(g=(m=n.height)!=null?m:n.h)!=null?g:Ht.default.h,customData:(_=n.customData)!=null?_:Ht.default.customData()}))}),e.length?e:[new this({b:Ht.default.b,x:Ht.default.x,y:Ht.default.y,d:Ht.default.d,w:Ht.default.w,h:Ht.default.h,customData:Ht.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.duration,w:this.width,h:this.height,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get duration(){return this.data.d}set duration(t){this.data.d=t}get width(){return this.data.w}set width(t){this.data.w=t}get height(){return this.data.h}set height(t){this.data.h=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(){var e,n;const t=(n=(e=this.customData.size)==null?void 0:e[0])!=null?n:this.width;return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(a=>{a[0]=-a[0]-(this.posX+t-1)}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(a=>{a[0]=-a[0]-(this.posX+t-1)})),super.mirror()}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:super.getPosition()}isChroma(){return Array.isArray(this.customData.color)}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||Array.isArray(this.customData.size)||typeof this.customData.track=="string"}};let Vt=Ht;$(Vt,"default",{b:0,x:0,y:0,d:1,w:1,h:1,customData:()=>({})});const Qs="<15ms Obstacle",to=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,eo=!0,gn={name:Qs,description:to,type:"obstacle",order:{input:dt.OBSTACLES_SHORT,output:ft.OBSTACLES_SHORT},input:{enabled:eo,params:{minDur:.015},html:ct.create(Qs,to,eo,function(){gn.input.enabled=this.checked})},output:{html:null},run:dd};function hd(i){const{obstacles:t}=i.difficulty.data,{bpm:e}=i.settings,{minDur:n}=gn.input.params,a=e.toBeatTime(n),o=[];let r=Vt.create()[0],s=Vt.create()[0],l=Vt.create()[0],u=Vt.create()[0];return t.forEach(c=>{c.posY===At.BOTTOM&&c.height>2&&c.duration>0?c.width>2||c.width>1&&c.posX===1?(c.isLonger(r)&&(c.duration<a&&o.push(c),r=c),c.isLonger(s)&&(c.duration<a&&o.push(c),s=c)):c.width===2?c.posX===ot.LEFT?c.isLonger(r)&&(c.duration<a&&o.push(c),r=c):c.posX===ot.MIDDLE_RIGHT&&c.isLonger(s)&&(c.duration<a&&o.push(c),s=c):c.width===1&&(c.posX===ot.MIDDLE_LEFT?c.isLonger(r)&&(c.duration<a&&o.push(c),r=c):c.posX===ot.MIDDLE_RIGHT&&c.isLonger(s)&&(c.duration<a&&o.push(c),s=c)):c.posY===At.TOP&&c.height>2&&c.duration>0&&(c.width>2||c.width>1&&c.posX===ot.MIDDLE_LEFT?(c.isLonger(l)&&(c.duration<a&&c.isLonger(r,a)&&c.isLonger(l,a)&&o.push(c),l=c),c.isLonger(u)&&(c.duration<a&&c.isLonger(s,a)&&c.isLonger(u,a)&&o.push(c),u=c)):c.width===2?c.posX===ot.LEFT?c.isLonger(l)&&(c.duration<a&&c.isLonger(r,a)&&c.isLonger(l,a)&&o.push(c),l=c):c.posX===ot.MIDDLE_RIGHT&&c.isLonger(u)&&(c.duration<a&&c.isLonger(s,a)&&c.isLonger(u,a)&&o.push(c),u=c):c.width===1&&(c.posX===ot.MIDDLE_LEFT?c.isLonger(l)&&(c.duration<a&&c.isLonger(r,a)&&c.isLonger(l,a)&&o.push(c),l=c):c.posX===ot.MIDDLE_RIGHT&&c.isLonger(u)&&(c.duration<a&&c.isLonger(s,a)&&c.isLonger(u,a)&&o.push(c),u=c)))}),o.map(c=>c.time).filter(function(c,h,f){return!h||c!==f[h-1]})}function dd(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=hd(i);t.length?gn.output.html=ht("<15ms obstacle",t,i.settings.bpm,"warning"):gn.output.html=null}const Sc="2-wide Center Obstacle",Tc="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",Lc=!0,Cc=.25;let Wi;const Ki=document.createElement("div"),ci=document.createElement("input"),Cr=document.createElement("label"),je=document.createElement("input"),kr=document.createElement("label");Cr.textContent="recovery time (ms): ";Cr.htmlFor="input__tools-2wide-wall-time";ci.id="input__tools-2wide-wall-time";ci.className="input-toggle input--small";ci.type="number";ci.min="0";ci.value=M(Cc*1e3,1).toString();ci.addEventListener("change",md);kr.textContent=" (beat): ";kr.htmlFor="input__tools-2wide-wall-beat";je.id="input__tools-2wide-wall-beat";je.className="input-toggle input--small";je.type="number";je.min="0";je.step="0.1";je.addEventListener("change",pd);Ki.appendChild(ct.create(Sc,Tc,Lc,function(){ue.input.enabled=this.checked}));Ki.appendChild(Cr);Ki.appendChild(ci);Ki.appendChild(kr);Ki.appendChild(je);const ue={name:Sc,description:Tc,type:"obstacle",order:{input:dt.OBSTACLES_CENTER,output:ft.OBSTACLES_CENTER},input:{enabled:Lc,params:{recovery:Cc},html:Ki,adjustTime:fd},output:{html:null},run:_d};function fd(i){Wi=i,je.value=M(Wi.toBeatTime(ue.input.params.recovery),2).toString()}function md(){ue.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=M(ue.input.params.recovery*1e3,1).toString(),Wi&&(je.value=M(Wi.toBeatTime(ue.input.params.recovery),2).toString())}function pd(){if(!Wi){this.value="0";return}let i=M(Math.abs(parseFloat(this.value)),2)||1;ue.input.params.recovery=Wi.toRealTime(i),ci.value=M(ue.input.params.recovery*1e3,1).toString(),this.value=i.toString()}function gd(i){const{obstacles:t}=i.difficulty.data,{bpm:e}=i.settings,{recovery:n}=ue.input.params,a=[];let o=Vt.create()[0],r=Vt.create()[0];return t.forEach(s=>{s.posY<At.TOP&&s.height>1&&(s.width>2&&(a.push(s),s.isLonger(o)&&(o=s),s.isLonger(r)&&(r=s)),s.width===2&&(s.posX===ot.LEFT&&s.isLonger(o)&&(e.toRealTime(s.time)>e.toRealTime(r.time)-n&&e.toRealTime(s.time)<e.toRealTime(r.time+r.duration)+n&&a.push(s),o=s),s.posX===ot.MIDDLE_LEFT&&(a.push(s),s.isLonger(o)&&(o=s),s.isLonger(r)&&(r=s)),s.posX===ot.MIDDLE_RIGHT&&s.isLonger(r)&&(e.toRealTime(s.time)>e.toRealTime(o.time)-n&&e.toRealTime(s.time)<e.toRealTime(o.time+o.duration)+n&&a.push(s),r=s)),s.width===1&&(s.posX===ot.MIDDLE_LEFT&&s.isLonger(o)&&(e.toRealTime(s.time)>e.toRealTime(r.time)-n&&e.toRealTime(s.time)<e.toRealTime(r.time+r.duration)+n&&a.push(s),o=s),s.posX===ot.MIDDLE_RIGHT&&s.isLonger(r)&&(e.toRealTime(s.time)>e.toRealTime(o.time)-n&&e.toRealTime(s.time)<e.toRealTime(o.time+o.duration)+n&&a.push(s),r=s)))}),a.map(s=>s.time).filter(function(s,l,u){return!l||s!==u[l-1]})}function _d(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=gd(i),{recovery:e}=ue.input.params;t.length?ue.output.html=ht(`2-wide center obstacle (<${M(e*1e3)}ms)`,t,i.settings.bpm,"error"):ue.output.html=null}const io="Zero Obstacle",no="Look for obstacle with zero value.",ao=!0,oa={name:io,description:no,type:"obstacle",order:{input:dt.OBSTACLES_ZERO,output:ft.OBSTACLES_ZERO},input:{enabled:ao,params:{},html:ct.create(io,no,ao,function(){oa.input.enabled=this.checked})},output:{html:null},run:yd};function bd(i){const{obstacles:t}=i.difficulty.data;return t.filter(e=>e.hasZero()).map(e=>e.time)}function yd(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=bd(i);t.length?oa.output.html=ht("Zero value obstacle",t,i.settings.bpm,"error"):oa.output.html=null}const ro=Object.freeze(Object.defineProperty({__proto__:null,shortObstacle:gn,centerObstacle:ue,zeroObstacle:oa},Symbol.toStringTag,{value:"Module"})),so="Insufficient Lighting Event",oo="Check if there is enough light event.",lo=!0,la={name:so,description:oo,type:"event",order:{input:dt.EVENTS_INSUFFICIENT_LIGHT,output:ft.EVENTS_INSUFFICIENT_LIGHT},input:{enabled:lo,params:{},html:ct.create(so,oo,lo,function(){la.input.enabled=this.checked})},output:{html:null},run:Ed};function vd(i,t){let e=0;for(let n=i.length-1;n>=0;n--)if(i[n].isLightEvent(t)&&!i[n].isOff()&&(e++,e>10))return!0;return!1}function Ed(i){if(!i.difficulty){console.error("Something went wrong!");return}vd(i.difficulty.data.basicEvents,i.difficulty.characteristic==="360Degree"||i.difficulty.characteristic==="90Degree"?i.info._allDirectionsEnvironmentName:i.info._environmentName)?la.output.html=null:la.output.html=gt("Insufficient light event","","rank")}var xr=(i=>(i.Standard="Standard",i.NoArrows="No Arrows",i.OneSaber="One Saber",i["360Degree"]="360 Degree",i["90Degree"]="90 Degree",i.Lightshow="Lightshow",i.Lawless="Lawless",i))(xr||{}),Za=(i=>(i[i.Standard=0]="Standard",i[i.NoArrows=1]="NoArrows",i[i.OneSaber=2]="OneSaber",i[i["360Degree"]=3]="360Degree",i[i["90Degree"]=4]="90Degree",i[i.Lightshow=5]="Lightshow",i[i.Lawless=6]="Lawless",i))(Za||{});const mi=class{constructor(t,e=10,n=0){$(this,"_bpm");$(this,"_njs");$(this,"_sdm");$(this,"_hjd");$(this,"_jd");$(this,"_jdMin");$(this,"_reactionTime");this._bpm=t,this._njs=e,this._sdm=n,this.update()}static create(t,e=10,n=0){return new mi(typeof t=="number"?ye.create(t):t,e,n)}get value(){return this._njs}set value(t){this._njs=t,this.update()}get offset(){return this._sdm}set offset(t){this._sdm=t,this.update()}get hjd(){return this._hjd}get hjdMin(){return mi.HJD_MIN}get reactTime(){return this._reactionTime}get jd(){return this._jd}get jdMin(){return this._jdMin}update(){this._hjd=this.calcHJD(),this._jd=this.calcJD(),this._jdMin=this.calcJD(mi.HJD_MIN),this._reactionTime=this.calcRTFromHJD()}calcHJDRaw(){const e=this._njs*this._njs/this._njs,n=60/this._bpm.value;let a=mi.HJD_START;for(;e*n*a>17.999;)a/=2;return a<1&&(a=1),a}calcHJD(t=this.offset){return Math.max(this.calcHJDRaw()+t,mi.HJD_MIN)}calcHJDFromJD(t=this.calcJD()){return t/(60/this._bpm.value*this._njs*2)}calcHJDFromRT(t=this.calcRTFromHJD()){return t/(60/this._bpm.value)}calcJD(t=this.calcHJD()){return this._njs*(60/this._bpm.value)*t*2}calcJDOptimalHigh(){return 18*(1/1.07)**this._njs+18}calcJDOptimalLow(){return-(18/(this._njs+1))+18}calcRTFromJD(t=this.calcJD()){return t/(2*this._njs)}calcRTFromHJD(t=this.calcHJD()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let le=mi;$(le,"HJD_START",4),$(le,"HJD_MIN",.25),$(le,"FallbackNJS",{ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10});function Dd(i,t){const e=co(i),n=co(t);for(const a in e){if(e[a]<n[a])return"old";if(e[a]>n[a])return"new"}return"current"}function co(i){return i.replace("v","").split(".").map(t=>parseInt(t))}class wd extends va{isMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0}isValid(){return!this.isMappingExtensions()}}class Sd extends Pe{setBPM(t){return this.bpm=t,this}isValid(){return this.bpm>0}}class kc extends Bl{setTailTime(t){return this.tailTime=t,this}setTailPosX(t){return this.tailPosX=t,this}setTailPosY(t){return this.tailPosY=t,this}mirror(t=!0){return this.tailPosX=ba-1-this.tailPosX,super.mirror(t)}getTailPosition(t){switch(t){case"vanilla":return[this.tailPosX,this.tailPosY];case"me":return[(this.tailPosX<=-1e3?this.tailPosX/1e3:this.tailPosX>=1e3?this.tailPosX/1e3:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY];case"ne":return[this.tailPosX,this.tailPosY];default:return[(this.tailPosX<=-1e3?this.tailPosX/1e3:this.tailPosX>=1e3?this.tailPosX/1e3:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY]}}getAngle(t){switch(t){case"vanilla":return xt[this.direction]||0;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return xt[this.direction]||0}return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):xt[this.direction]||0}getDistance(t){const[e,n]=this.getPosition(),[a,o]=t.getPosition();return Math.sqrt(Math.pow(a-e,2)+Math.pow(o-n,2))}isVertical(t){const[e]=this.getPosition(),[n]=t.getPosition(),a=e-n;return a>-.001&&a<.001}isHorizontal(t){const[e,n]=this.getPosition(),[a,o]=t.getPosition(),r=n-o;return r>-.001&&r<.001}isDiagonal(t){const[e,n]=this.getPosition(),[a,o]=t.getPosition(),r=Math.abs(e-a),s=Math.abs(n-o);return r===s}isInline(t,e=.5){return this.getDistance(t)<=e}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t,e=1.8){return this.getDistance(t)>e}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}isInverse(){return this.time>this.tailTime}}class Td extends kc{setSliceCount(t){return this.sliceCount=t,this}setSquish(t){return this.squish=t,this}isMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360}isValid(){return!(this.isMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)&&!(this.posX===this.tailPosX&&this.posY===this.tailPosY)}}class Ld extends Pe{setToggle(t){return this.toggle=t,this}isValid(){return!0}}class xc extends ya{constructor(){super(...arguments);$(this,"_fileName","UnnamedDifficulty.dat")}clone(){return super.clone().setFileName(this.fileName)}set fileName(e){this._fileName=e.trim()}get fileName(){return this._fileName}setFileName(e){return this.fileName=e,this}nps(e){const n=this.getNoteContainer().filter(a=>a.type!=="bomb");return e?n.length/e:0}peak(e,n){let a=0,o=0;n=typeof n=="number"?ye.create(n):n;const r=this.getNoteContainer().filter(s=>s.type!=="bomb");for(let s=0;s<r.length;s++){for(;r[s].data.time-r[o].data.time>e;)o++;a=Math.max(a,(s-o+1)/n.toRealTime(e))}return a}getFirstInteractiveTime(){const e=this.getNoteContainer().filter(o=>o.type!=="bomb");let n=Number.MAX_VALUE;e.length>0&&(n=e[0].data.time);const a=this.findFirstInteractiveObstacleTime();return Math.min(n,a)}getLastInteractiveTime(){const e=this.getNoteContainer().filter(o=>o.type!=="bomb");let n=0;e.length>0&&(n=e[e.length-1].data.time);const a=this.findLastInteractiveObstacleTime();return Math.max(n,a)}findFirstInteractiveObstacleTime(){for(let e=0,n=this.obstacles.length;e<n;e++)if(this.obstacles[e].isInteractive())return this.obstacles[e].time;return Number.MAX_VALUE}findLastInteractiveObstacleTime(){let e=0;for(let n=this.obstacles.length-1;n>=0;n--)this.obstacles[n].isInteractive()&&(e=Math.max(e,this.obstacles[n].time+this.obstacles[n].duration));return e}getNoteContainer(){const e=[];return this.colorNotes.forEach(n=>e.push({type:"note",data:n})),this.sliders.forEach(n=>e.push({type:"slider",data:n})),this.burstSliders.forEach(n=>e.push({type:"burstSlider",data:n})),this.bombNotes.forEach(n=>e.push({type:"bomb",data:n})),e.sort((n,a)=>n.data.time-a.data.time)}getEventContainer(){const e=[];return this.basicEvents.forEach(n=>e.push({type:"basicEvent",data:n})),this.colorBoostEvents.forEach(n=>e.push({type:"boost",data:n})),e.sort((n,a)=>n.data.time-a.data.time)}}class Rc extends Pe{setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}isOff(){return this.value===0}isOn(){return this.value===1||this.value===5||this.value===9}isFlash(){return this.value===2||this.value===6||this.value===10}isFade(){return this.value===3||this.value===7||this.value===11}isTransition(){return this.value===4||this.value===8||this.value===12}isBlue(){return this.value===1||this.value===2||this.value===3||this.value===4}isRed(){return this.value===5||this.value===6||this.value===7||this.value===8}isWhite(){return this.value===9||this.value===10||this.value===11||this.value===12}isLightEvent(t){switch(t){case"LizzoEnvironment":return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===8||this.type===9||this.type===10||this.type===11||this.type===12;default:return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}}isColorBoost(){return this.type===5}isRingEvent(t){switch(t){case"LizzoEnvironment":return!1;default:return this.type===8||this.type===9}}isLaserRotationEvent(t){switch(t){case"LizzoEnvironment":return!1;default:return this.type===12||this.type===13}}isLaneRotationEvent(t){return this.type===14||this.type===15}isExtraEvent(t){return this.type===16||this.type===17||this.type===18||this.type===19}isSpecialEvent(t){return this.type===40||this.type===41||this.type===42||this.type===43}isBPMChangeEvent(){return this.type===100}isLightingEvent(t){return this.isLightEvent(t)||this.isRingEvent(t)||this.isLaserRotationEvent(t)||this.isExtraEvent(t)}isOldChroma(){return this.value>=2e9}isValidType(){return this.type>=0&&this.type<=19||this.type>=40&&this.type<=43||this.type===100}isValid(){return this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.isOldChroma())}}class Nc extends rr{setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const e=this.events.indexOf(t,0);return e>-1&&this.events.splice(e,1),this}}class Ic extends rr{setData(t){return this.list=t,this}removeData(t){return this.list=this.list.filter(e=>e.keyword!==t),this}}class Cd extends ya{setType(t){return this.type=t,this}setP0(t){return this.p0=t,this}setP1(t){return this.p1=t,this}setReverse(t){return this.reverse=t,this}setChunks(t){return this.chunks=t,this}setRandom(t){return this.random=t,this}setSeed(t){return this.seed=t,this}setLimit(t){return this.limit=t,this}setLimitAffectsType(t){return this.limitAffectsType=t,this}isValid(){return(this.type===1||this.type===2)&&this.p0>=0&&this.p1>=0&&(this.reverse===0||this.reverse===1)&&this.chunks>=0&&this.random>=0&&this.random<=2&&this.limit>=0&&this.limit<=0&&this.limitAffectsType>=0&&this.limitAffectsType<=2}}class kd extends Pe{setTransition(t){return this.transition=t,this}setColor(t){return this.color=t,this}setBrightness(t){return this.brightness=t,this}setFrequency(t){return this.frequency=t,this}isValid(){return this.transition>=0&&this.transition<=2&&this.color>=0&&this.color<=2&&this.brightness>=0&&this.frequency>=0}}class Rr extends ya{setFilter(t){return this.filter=t,this}setBeatDistribution(t){return this.beatDistribution=t,this}setBeatDistributionType(t){return this.beatDistributionType=t,this}setEasing(t){return this.easing=t,this}isValid(){return(this.beatDistributionType===1||this.beatDistributionType===2)&&this.easing>=0&&this.easing<=3&&this.events.every(t=>t.isValid())&&this.filter.isValid()}}class xd extends Rr{setBrightnessDistribution(t){return this.brightnessDistribution=t,this}setBrightnessDistributionType(t){return this.brightnessDistributionType=t,this}setAffectFirst(t){return this.affectFirst=t,this}isValid(){return super.isValid()&&(this.brightnessDistributionType===1||this.brightnessDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}}class Nr extends Pe{isValid(){return this.id>=0&&this.events.every(t=>t.isValid())}}class Rd extends Nr{}class Nd extends Pe{setPrevious(t){return this.previous=t,this}setEasing(t){return this.easing=t,this}setLoop(t){return this.loop=t,this}setRotation(t){return this.rotation=t,this}setDirection(t){return this.direction=t,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3&&(this.loop===0||this.loop===1)&&this.direction>=0&&this.direction<=2}}class Id extends Rr{setRotationDistribution(t){return this.rotationDistribution=t,this}setRotationDistributionType(t){return this.rotationDistributionType=t,this}setAxis(t){return this.axis=t,this}setFlip(t){return this.flip=t,this}setAffectFirst(t){return this.affectFirst=t,this}isValid(){return super.isValid()&&(this.rotationDistributionType===1||this.rotationDistributionType===2)&&(this.axis===0||this.axis===1)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}class Ad extends Nr{}class Bd extends Pe{setExecutionTime(t){return this.executionTime=t,this}setRotation(t){return this.rotation=t,this}isValid(){return this.executionTime===0||this.executionTime===1}}class Ac extends kc{setLengthMultiplier(t){return this.lengthMultiplier=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setTailDirection(t){return this.tailDirection=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0){switch(this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),super.mirror(t)}getTailAngle(t){switch(t){case"vanilla":return xt[this.tailDirection]||0;case"me":if(this.tailDirection>=1e3)return Math.abs(this.tailDirection%1e3%360-360);case"ne":return xt[this.tailDirection]||0;default:return this.tailDirection>=1e3?Math.abs(this.tailDirection%1e3%360-360):xt[this.tailDirection]||0}}isMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360||this.tailDirection>=1e3&&this.tailDirection<=1360}isValid(){return!(this.isMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3||this.posX===this.tailPosX&&this.posY===this.tailPosY&&this.time===this.tailTime)}}class Bc extends va{setDirection(t){return this.direction=t,this}mirror(){switch(this.posX=ba-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}isValid(){return this.direction>=0&&this.direction<=9&&this.direction!==8}}const Ut=class extends sr{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m,g;return e.push(new this({_time:(o=(a=n.time)!=null?a:n._time)!=null?o:Ut.default._time,_lineIndex:(s=(r=n.posX)!=null?r:n._lineIndex)!=null?s:Ut.default._lineIndex,_lineLayer:(u=(l=n.posY)!=null?l:n._lineLayer)!=null?u:Ut.default._lineLayer,_type:(h=(c=n.type)!=null?c:n._type)!=null?h:Ut.default._type,_cutDirection:(d=(f=n.direction)!=null?f:n._cutDirection)!=null?d:Ut.default._cutDirection,_customData:(g=(m=n.customData)!=null?m:n._customData)!=null?g:Ut.default._customData()}))}),e.length?e:[new this({_time:Ut.default._time,_lineIndex:Ut.default._lineIndex,_lineLayer:Ut.default._lineLayer,_type:Ut.default._type,_cutDirection:Ut.default._cutDirection,_customData:Ut.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_cutDirection:this.direction,_customData:bt(this.customData)}}get time(){return this.data._time}set time(t){this.data._time=t}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get color(){return this.data._type}set color(t){this.data._type=t}get direction(){return this.data._cutDirection}set direction(t){this.data._cutDirection=t}get angleOffset(){return 0}set angleOffset(t){}get customData(){return this.data._customData}set customData(t){this.data._customData=t}getPosition(t){return this.customData._position?[this.customData._position[0],this.customData._position[1]]:super.getPosition(t)}getAngle(t){return this.customData._cutDirection?this.customData._cutDirection>0?this.customData._cutDirection%360:360+this.customData._cutDirection%360:super.getAngle(t)}isChroma(){return Array.isArray(this.customData._color)||typeof this.customData._disableSpawnEffect=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._cutDirection=="number"||typeof this.customData._disableNoteGravity=="boolean"||typeof this.customData._disableNoteLook=="boolean"||typeof this.customData._fake=="boolean"||Array.isArray(this.customData._flip)||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||typeof this.customData._track=="string"}};let Je=Ut;$(Je,"default",{_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0,_customData:()=>({})});const Et=class extends Ac{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m,g,_,y,v,w,T,L,F,A,x,N,U,tt,S,P,b,H;return e.push(new this({_colorType:(o=(a=n.color)!=null?a:n._colorType)!=null?o:Et.default._colorType,_headTime:(l=(s=(r=n.time)!=null?r:n._headTime)!=null?s:n._tailTime)!=null?l:Et.default._headTime,_headLineIndex:(c=(u=n.posX)!=null?u:n._headLineIndex)!=null?c:Et.default._headLineIndex,_headLineLayer:(f=(h=n.posY)!=null?h:n._headLineLayer)!=null?f:Et.default._headLineLayer,_headCutDirection:(m=(d=n.direction)!=null?d:n._headCutDirection)!=null?m:Et.default._headCutDirection,_headControlPointLengthMultiplier:(_=(g=n.lengthMultiplier)!=null?g:n._headControlPointLengthMultiplier)!=null?_:Et.default._headControlPointLengthMultiplier,_tailTime:(w=(v=(y=n.tailTime)!=null?y:n._tailTime)!=null?v:n._headTime)!=null?w:Et.default._tailTime,_tailLineIndex:(L=(T=n.tailPosX)!=null?T:n._tailLineIndex)!=null?L:Et.default._tailLineIndex,_tailLineLayer:(A=(F=n.tailPosY)!=null?F:n._tailLineLayer)!=null?A:Et.default._tailLineLayer,_tailCutDirection:(N=(x=n.tailDirection)!=null?x:n._tailCutDirection)!=null?N:Et.default._tailCutDirection,_tailControlPointLengthMultiplier:(tt=(U=n.tailLengthMultiplier)!=null?U:n._tailControlPointLengthMultiplier)!=null?tt:Et.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:(P=(S=n.midAnchor)!=null?S:n._sliderMidAnchorMode)!=null?P:Et.default._sliderMidAnchorMode,_customData:(H=(b=n.customData)!=null?b:n._customData)!=null?H:Et.default._customData()}))}),e.length?e:[new this({_colorType:Et.default._colorType,_headTime:Et.default._headTime,_headLineIndex:Et.default._headLineIndex,_headLineLayer:Et.default._headLineLayer,_headCutDirection:Et.default._headCutDirection,_headControlPointLengthMultiplier:Et.default._headControlPointLengthMultiplier,_tailTime:Et.default._tailTime,_tailLineIndex:Et.default._tailLineIndex,_tailLineLayer:Et.default._tailLineLayer,_tailCutDirection:Et.default._tailCutDirection,_tailControlPointLengthMultiplier:Et.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:Et.default._sliderMidAnchorMode,_customData:Et.default._customData()})]}toJSON(){return{_colorType:this.color,_headTime:this.time,_headLineIndex:this.posX,_headLineLayer:this.posY,_headCutDirection:this.direction,_headControlPointLengthMultiplier:this.lengthMultiplier,_tailTime:this.tailTime,_tailLineIndex:this.tailPosX,_tailLineLayer:this.tailPosY,_tailCutDirection:this.tailDirection,_tailControlPointLengthMultiplier:this.tailLengthMultiplier,_sliderMidAnchorMode:this.midAnchor,_customData:bt(this.customData)}}get color(){return this.data._colorType}set color(t){this.data._colorType=t}get time(){return this.data._headTime}set time(t){this.data._headTime=t}get posX(){return this.data._headLineIndex}set posX(t){this.data._headLineIndex=t}get posY(){return this.data._headLineLayer}set posY(t){this.data._headLineLayer=t}get direction(){return this.data._headCutDirection}set direction(t){this.data._headCutDirection=t}get lengthMultiplier(){return this.data._headControlPointLengthMultiplier}set lengthMultiplier(t){this.data._headControlPointLengthMultiplier=t}get tailTime(){return this.data._tailTime}set tailTime(t){this.data._tailTime=t}get tailPosX(){return this.data._tailLineIndex}set tailPosX(t){this.data._tailLineIndex=t}get tailPosY(){return this.data._tailLineLayer}set tailPosY(t){this.data._tailLineLayer=t}get tailDirection(){return this.data._tailCutDirection}set tailDirection(t){this.data._tailCutDirection=t}get tailLengthMultiplier(){return this.data._tailControlPointLengthMultiplier}set tailLengthMultiplier(t){this.data._tailControlPointLengthMultiplier=t}get midAnchor(){return this.data._sliderMidAnchorMode}set midAnchor(t){this.data._sliderMidAnchorMode=t}get customData(){return this.data._customData}set customData(t){this.data._customData=t}};let $i=Et;$($i,"default",{_colorType:0,_headTime:0,_headLineIndex:0,_headLineLayer:0,_headCutDirection:0,_headControlPointLengthMultiplier:1,_tailTime:0,_tailLineIndex:0,_tailLineLayer:0,_tailCutDirection:0,_tailControlPointLengthMultiplier:1,_sliderMidAnchorMode:0,_customData:()=>({})});const Mt=class extends wc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m,g,_,y,v;return e.push(new this({_time:(o=(a=n.time)!=null?a:n._time)!=null?o:Mt.default._time,_type:(r=n._type)!=null?r:Mt.default._type,_lineIndex:(l=(s=n.posX)!=null?s:n._lineIndex)!=null?l:Mt.default._lineIndex,_lineLayer:(c=(u=n.posY)!=null?u:n._lineLayer)!=null?c:Mt.default._lineLayer,_duration:(f=(h=n.duration)!=null?h:n._duration)!=null?f:Mt.default._duration,_width:(m=(d=n.width)!=null?d:n._width)!=null?m:Mt.default._width,_height:(_=(g=n.height)!=null?g:n._height)!=null?_:Mt.default._height,_customData:(v=(y=n.customData)!=null?y:n._customData)!=null?v:Mt.default._customData()}))}),e.length?e:[new this({_time:Mt.default._time,_type:Mt.default._type,_lineIndex:Mt.default._lineIndex,_lineLayer:Mt.default._lineLayer,_duration:Mt.default._duration,_width:Mt.default._width,_height:Mt.default._height,_customData:Mt.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_duration:this.duration,_width:this.width,_height:this.height,_customData:bt(this.customData)}}get time(){return this.data._time}set time(t){this.data._time=t}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get duration(){return this.data._duration}set duration(t){this.data._duration=t}get width(){return this.data._width}set width(t){this.data._width=t}get height(){return this.data._height}set height(t){this.data._height=t}get customData(){return this.data._customData}set customData(t){this.data._customData=t}getPosition(){return this.customData._position?[this.customData._position[0],this.customData._position[1]]:super.getPosition()}isChroma(){return Array.isArray(this.customData._color)}isNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._fake=="boolean"||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||Array.isArray(this.customData._scale)||typeof this.customData._track=="string"}};let Oi=Mt;$(Oi,"default",{_time:0,_lineIndex:0,_lineLayer:0,_type:0,_duration:1,_width:1,_height:1,_customData:()=>({})});const ie=class extends Rc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d;return e.push(new this({_time:(o=(a=n.time)!=null?a:n._time)!=null?o:ie.default._time,_type:(s=(r=n.type)!=null?r:n._type)!=null?s:ie.default._type,_value:(u=(l=n.value)!=null?l:n._value)!=null?u:ie.default._value,_floatValue:(h=(c=n.floatValue)!=null?c:n._floatValue)!=null?h:ie.default._floatValue,_customData:(d=(f=n.customData)!=null?f:n._customData)!=null?d:ie.default._customData()}))}),e.length?e:[new this({_time:ie.default._time,_type:ie.default._type,_value:ie.default._value,_floatValue:ie.default._floatValue,_customData:ie.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_value:this.value,_floatValue:this.floatValue,_customData:bt(this.customData)}}get time(){return this.data._time}set time(t){this.data._time=t}get type(){return this.data._type}set type(t){this.data._type=t}get value(){return this.data._value}set value(t){this.data._value=t}get floatValue(){return this.data._floatValue}set floatValue(t){this.data._floatValue=t}get customData(){return this.data._customData}set customData(t){this.data._customData=t}isLightEvent(t){return super.isLightEvent(t)}isRingEvent(t){return super.isRingEvent(t)}isLaserRotationEvent(t){return super.isLaserRotationEvent(t)}isLaneRotationEvent(t){return super.isLaneRotationEvent(t)}isChroma(){return this.isLightEvent()?Array.isArray(this.customData._color)||typeof this.customData._lightID=="number"||Array.isArray(this.customData._lightID)||typeof this.customData._propID=="number"||typeof this.customData._lightGradient=="object"||typeof this.customData._easing=="string"||typeof this.customData._lerpType=="string":this.isRingEvent()?typeof this.customData._nameFilter=="string"||typeof this.customData._reset=="boolean"||typeof this.customData._rotation=="number"||typeof this.customData._step=="number"||typeof this.customData._prop=="number"||typeof this.customData._speed=="number"||typeof this.customData._direction=="number"||typeof this.customData._counterSpin=="boolean"||typeof this.customData._stepMult=="number"||typeof this.customData._propMult=="number"||typeof this.customData._speedMult=="number":this.isLaserRotationEvent()?typeof this.customData._lockPosition=="boolean"||typeof this.customData._speed=="number"||typeof this.customData._preciseSpeed=="number"||typeof this.customData._direction=="number":!1}isNoodleExtensions(){return this.isLaneRotationEvent()&&typeof this.customData._rotation=="number"}isMappingExtensions(){return this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720}};let oe=ie;$(oe,"default",{_time:0,_type:0,_value:0,_floatValue:1,_customData:()=>({})});const ne=class extends Bc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d;return e.push(new this({_time:(o=(a=n.time)!=null?a:n._time)!=null?o:ne.default._time,_lineIndex:(s=(r=n.posX)!=null?r:n._lineIndex)!=null?s:ne.default._lineIndex,_lineLayer:(u=(l=n.posY)!=null?l:n._lineLayer)!=null?u:ne.default._lineLayer,_offsetDirection:(h=(c=n.direction)!=null?c:n._offsetDirection)!=null?h:ne.default._offsetDirection,_customData:(d=(f=n.customData)!=null?f:n._customData)!=null?d:ne.default._customData()}))}),e.length?e:[new this({_time:ne.default._time,_lineIndex:ne.default._lineIndex,_lineLayer:ne.default._lineLayer,_offsetDirection:ne.default._offsetDirection,_customData:ne.default._customData()})]}toJSON(){return{_time:this.time,_lineIndex:this.posX,_lineLayer:this.posY,_offsetDirection:this.direction,_customData:bt(this.customData)}}get time(){return this.data._time}set time(t){this.data._time=t}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get direction(){return this.data._offsetDirection}set direction(t){this.data._offsetDirection=t}get customData(){return this.data._customData}set customData(t){this.data._customData=t}};let Mi=ne;$(Mi,"default",{_time:0,_lineIndex:0,_lineLayer:0,_offsetDirection:1,_customData:()=>({})});const Ai=class extends Nc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s;return e.push(new this({_keyword:(o=(a=n.keyword)!=null?a:n._keyword)!=null?o:Ai.default._keyword,_specialEvents:(s=(r=n.events)!=null?r:n._specialEvents)!=null?s:Ai.default._specialEvents()}))}),e.length?e:[new this({_keyword:Ai.default._keyword,_specialEvents:Ai.default._specialEvents()})]}toJSON(){return{_keyword:this.keyword,_specialEvents:this.events}}get keyword(){return this.data._keyword}set keyword(t){this.data._keyword=t}get events(){return this.data._specialEvents}set events(t){this.data._specialEvents=t}};let Bn=Ai;$(Bn,"default",{_keyword:"",_specialEvents:()=>[]});const Hr=class extends Ic{constructor(e){super(e);$(this,"_d");this._d=e._keywords.map(n=>Bn.create({_keyword:n._keyword,_specialEvents:n._specialEvents})[0])}static create(e={}){var n,a,o;return new this({_keywords:(o=(a=(n=e.list)==null?void 0:n.map(r=>({_keyword:r==null?void 0:r.keyword,_specialEvents:r==null?void 0:r.events})))!=null?a:e._keywords)!=null?o:Hr.default._keywords()})}toJSON(){return{_keywords:this._d.map(e=>e.toJSON())}}get list(){return this._d}set list(e){this._d=e}addData(e){return this._d.push(e),this}};let $n=Hr;$($n,"default",{_keywords:()=>[]});class $d extends xc{constructor(e){super(e);$(this,"version");$(this,"bpmEvents",[]);$(this,"rotationEvents",[]);$(this,"colorNotes");$(this,"bombNotes",[]);$(this,"obstacles");$(this,"sliders");$(this,"burstSliders",[]);$(this,"waypoints");$(this,"basicEvents");$(this,"colorBoostEvents",[]);$(this,"lightColorEventBoxGroups",[]);$(this,"lightRotationEventBoxGroups",[]);$(this,"lightTranslationEventBoxGroups",[]);$(this,"eventTypesWithKeywords");$(this,"useNormalEventsAsCompatibleEvents",!0);this.version="2.6.0",this.colorNotes=e._notes.map(n=>Je.create(n)[0]),this.sliders=e._sliders.map(n=>$i.create(n)[0]),this.obstacles=e._obstacles.map(n=>Oi.create(n)[0]),this.basicEvents=e._events.map(n=>oe.create(n)[0]),this.waypoints=e._waypoints.map(n=>Mi.create(n)[0]),this.eventTypesWithKeywords=$n.create(e._specialEventsKeywordFilters),this.customData=e._customData}static create(e={}){var n,a,o,r,s,l,u;return new this({_version:"2.6.0",_notes:(n=e._notes)!=null?n:[],_sliders:(a=e._sliders)!=null?a:[],_obstacles:(o=e._obstacles)!=null?o:[],_events:(r=e._events)!=null?r:[],_waypoints:(s=e._waypoints)!=null?s:[],_specialEventsKeywordFilters:(l=e._specialEventsKeywordFilters)!=null?l:{_keywords:[]},_customData:(u=e._customData)!=null?u:{}})}toJSON(){return{_version:"2.6.0",_notes:this.colorNotes.map(e=>e.toJSON()),_sliders:this.sliders.map(e=>e.toJSON()),_obstacles:this.obstacles.map(e=>e.toJSON()),_events:this.basicEvents.map(e=>e.toJSON()),_waypoints:this.waypoints.map(e=>e.toJSON()),_specialEventsKeywordFilters:this.eventTypesWithKeywords.toJSON(),_customData:bt(this.customData)}}clone(){const e=this.fileName;return super.clone().setFileName(e)}get customData(){return this.data._customData}set customData(e){this.data._customData=e}addBPMEvents(...e){this.basicEvents.push(...e.map(n=>n instanceof oe?n:oe.create({...n,type:100,value:n.bpm})[0]))}addRotationEvents(...e){this.basicEvents.push(...e.map(n=>n instanceof oe?n:oe.create({...n,type:typeof n.executionTime=="number"?n.executionTime===0?14:15:n._type})[0])),et.warn("This may not work correctly")}addColorNotes(...e){this.colorNotes.push(...e.map(n=>n instanceof Je?n:Je.create(n)[0]))}addBombNotes(...e){this.colorNotes.push(...e.map(n=>n instanceof Je?n:Je.create({...n,type:3})[0]))}addObstacles(...e){this.obstacles.push(...e.map(n=>n instanceof Oi?n:Oi.create(n)[0]))}addSliders(...e){this.sliders.push(...e.map(n=>n instanceof $i?n:$i.create(n)[0]))}addBurstSliders(...e){et.warn("Burst Slider does not exist in beatmap V2")}addWaypoints(...e){this.waypoints.push(...e.map(n=>n instanceof Mi?n:Mi.create(n)[0]))}addBasicEvents(...e){this.basicEvents.push(...e.map(n=>n instanceof oe?n:oe.create(n)[0]))}addColorBoostEvents(...e){this.basicEvents.push(...e.map(n=>n instanceof oe?n:oe.create({...n,value:n.toggle?1:n._value})[0]))}addLightColorEventBoxGroups(...e){et.warn("Light Color Event Box Group does not exist in beatmap V2")}addLightRotationEventBoxGroups(...e){et.warn("Light Rotation Event Box Group does not exist in beatmap V2")}addLightTranslationEventBoxGroups(...e){et.warn("Light Translation Event Box Group does not exist in beatmap V2")}isValid(){throw new Error("Method not implemented.")}}const ae=class extends Rc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:ae.default.b,et:(s=(r=n.type)!=null?r:n.et)!=null?s:ae.default.et,i:(u=(l=n.value)!=null?l:n.i)!=null?u:ae.default.i,f:(h=(c=n.floatValue)!=null?c:n.f)!=null?h:ae.default.f,customData:(f=n.customData)!=null?f:ae.default.customData()}))}),e.length?e:[new this({b:ae.default.b,et:ae.default.et,i:ae.default.i,f:ae.default.f,customData:ae.default.customData()})]}toJSON(){return{b:this.time,et:this.type,i:this.value,f:this.floatValue,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get type(){return this.data.et}set type(t){this.data.et=t}get value(){return this.data.i}set value(t){this.data.i=t}get floatValue(){return this.data.f}set floatValue(t){this.data.f=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}isLightEvent(t){return super.isLightEvent(t)}isRingEvent(t){return super.isRingEvent(t)}isLaserRotationEvent(t){return super.isLaserRotationEvent(t)}isLaneRotationEvent(t){return super.isLaneRotationEvent(t)}isChroma(){return this.isLightEvent()?Array.isArray(this.customData.color)||typeof this.customData.lightID=="number"||Array.isArray(this.customData.lightID)||typeof this.customData.easing=="string"||typeof this.customData.lerpType=="string":this.isRingEvent()?typeof this.customData.nameFilter=="string"||typeof this.customData.rotation=="number"||typeof this.customData.step=="number"||typeof this.customData.prop=="number"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":this.isLaserRotationEvent()?typeof this.customData.lockRotation=="boolean"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":!1}};let gi=ae;$(gi,"default",{b:0,et:0,i:0,f:1,customData:()=>({})});const Bi=class extends Nc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s;return e.push(new this({k:(o=(a=n.keyword)!=null?a:n.k)!=null?o:Bi.default.k,e:(s=(r=n.events)!=null?r:n.e)!=null?s:Bi.default.e()}))}),e.length?e:[new this({k:Bi.default.k,e:Bi.default.e()})]}toJSON(){return{k:this.keyword,e:this.events}}get keyword(){return this.data.k}set keyword(t){this.data.k=t}get events(){return this.data.e}set events(t){this.data.e=t}};let On=Bi;$(On,"default",{k:"",e:()=>[]});const zr=class extends Ic{constructor(e){super(e);$(this,"d");this.d=e.d.map(n=>On.create({e:n.e,k:n.k})[0])}static create(e={}){var n,a,o;return new this({d:(o=(a=(n=e.list)==null?void 0:n.map(r=>({k:r==null?void 0:r.keyword,e:r==null?void 0:r.events})))!=null?a:e.d)!=null?o:zr.default.d()})}toJSON(){return{d:this.list.map(e=>e.toJSON())}}get list(){return this.d}set list(e){this.d=e}addData(e){return this.list.push(e),this}};let cn=zr;$(cn,"default",{d:()=>[]});const Ce=class extends wd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:Ce.default.b,x:(s=(r=n.posX)!=null?r:n.x)!=null?s:Ce.default.x,y:(u=(l=n.posY)!=null?l:n.y)!=null?u:Ce.default.y,customData:(c=n.customData)!=null?c:Ce.default.customData()}))}),e.length?e:[new this({b:Ce.default.b,x:Ce.default.x,y:Ce.default.y,customData:Ce.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(t=>{t[0]=-t[0]}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(t=>{t[0]=-t[0]})),super.mirror()}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.track=="string"}};let qe=Ce;$(qe,"default",{b:0,x:0,y:0,customData:()=>({})});const Ge=class extends Sd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:Ge.default.b,m:(s=(r=n.bpm)!=null?r:n.m)!=null?s:Ge.default.m,customData:(l=n.customData)!=null?l:Ge.default.customData()}))}),e.length?e:[new this({b:Ge.default.b,m:Ge.default.m,customData:Ge.default.customData()})]}toJSON(){return{b:this.time,m:this.bpm,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get bpm(){return this.data.m}set bpm(t){this.data.m=t}setBPM(t){return this.bpm=t,this}get customData(){return this.data.customData}set customData(t){this.data.customData=t}isValid(){return this.bpm>0}};let _i=Ge;$(_i,"default",{b:0,m:0,customData:()=>({})});const Tt=class extends Td{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m,g,_,y,v,w,T,L,F,A,x,N,U;return e.push(new this({b:(r=(o=(a=n.time)!=null?a:n.b)!=null?o:n.tb)!=null?r:Tt.default.b,c:(l=(s=n.color)!=null?s:n.c)!=null?l:Tt.default.c,x:(c=(u=n.posX)!=null?u:n.x)!=null?c:Tt.default.x,y:(f=(h=n.posY)!=null?h:n.y)!=null?f:Tt.default.y,d:(m=(d=n.direction)!=null?d:n.d)!=null?m:Tt.default.d,tb:(y=(_=(g=n.tailTime)!=null?g:n.tb)!=null?_:n.b)!=null?y:Tt.default.tb,tx:(w=(v=n.tailPosX)!=null?v:n.tx)!=null?w:Tt.default.tx,ty:(L=(T=n.tailPosY)!=null?T:n.ty)!=null?L:Tt.default.ty,sc:(A=(F=n.sliceCount)!=null?F:n.sc)!=null?A:Tt.default.sc,s:(N=(x=n.squish)!=null?x:n.s)!=null?N:Tt.default.s,customData:(U=n.customData)!=null?U:Tt.default.customData()}))}),e.length?e:[new this({b:Tt.default.b,c:Tt.default.c,x:Tt.default.x,y:Tt.default.y,d:Tt.default.d,tb:Tt.default.tb,tx:Tt.default.tx,ty:Tt.default.ty,sc:Tt.default.sc,s:Tt.default.s,customData:Tt.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,sc:this.sliceCount,s:this.squish,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get color(){return this.data.c}set color(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get tailTime(){return this.data.tb}set tailTime(t){this.data.tb=t}get tailPosX(){return this.data.tx}set tailPosX(t){this.data.tx=t}get tailPosY(){return this.data.ty}set tailPosY(t){this.data.ty=t}get sliceCount(){return this.data.sc}set sliceCount(t){this.data.sc=t}get squish(){return this.data.s}set squish(t){this.data.s=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]})),super.mirror(t)}};let Pi=Tt;$(Pi,"default",{b:0,c:0,x:0,y:0,d:0,tb:0,tx:0,ty:0,sc:1,s:1,customData:()=>({})});const We=class extends Ld{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:We.default.b,o:(s=(r=n.toggle)!=null?r:n.o)!=null?s:We.default.o,customData:(l=n.customData)!=null?l:We.default.customData()}))}),e.length?e:[new this({b:We.default.b,o:We.default.o,customData:We.default.customData()})]}toJSON(){return{b:this.time,o:this.toggle,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get toggle(){return this.data.o}set toggle(t){this.data.o=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}isValid(){return!0}};let bi=We;$(bi,"default",{b:0,o:!1,customData:()=>({})});const Jt=class extends Cd{constructor(t){super(t),this.data.f===1&&(this.p0=this.p0?this.p0:1)}static create(t={}){var e,n,a,o,r,s,l,u,c,h,f,d,m,g,_,y,v,w,T;return new Jt({f:(n=(e=t.type)!=null?e:t.f)!=null?n:Jt.default.f,p:(o=(a=t.p0)!=null?a:t.p)!=null?o:Jt.default.p,t:(s=(r=t.p1)!=null?r:t.t)!=null?s:Jt.default.t,r:(u=(l=t.reverse)!=null?l:t.r)!=null?u:Jt.default.r,c:(h=(c=t.chunks)!=null?c:t.c)!=null?h:Jt.default.c,n:(d=(f=t.random)!=null?f:t.n)!=null?d:Jt.default.n,s:(g=(m=t.seed)!=null?m:t.s)!=null?g:Jt.default.s,l:(y=(_=t.limit)!=null?_:t.l)!=null?y:Jt.default.l,d:(w=(v=t.limitAffectsType)!=null?v:t.d)!=null?w:Jt.default.d,customData:(T=t.customData)!=null?T:Jt.default.customData})}toJSON(){return{f:this.type,p:this.p0,t:this.p1,r:this.reverse,c:this.chunks,n:this.random,s:this.seed,l:this.limit,d:this.limitAffectsType,customData:bt(this.customData)}}get type(){return this.data.f}set type(t){this.data.f=t}get p0(){return this.data.p}set p0(t){this.data.p=t}get p1(){return this.data.t}set p1(t){this.data.t=t}get reverse(){return this.data.r}set reverse(t){this.data.r=t}get chunks(){return this.data.c}set chunks(t){this.data.c=t}get limit(){return this.data.l}set limit(t){this.data.l=t}get limitAffectsType(){return this.data.d}set limitAffectsType(t){this.data.d=t}get random(){return this.data.n}set random(t){this.data.n=t}get seed(){return this.data.s}set seed(t){this.data.s=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let _t=Jt;$(_t,"default",{f:1,p:0,t:0,r:0,c:0,n:0,s:0,l:0,d:0,customData:()=>({})});const Gt=class extends kd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:Gt.default.b,i:(s=(r=n.transition)!=null?r:n.i)!=null?s:Gt.default.i,c:(u=(l=n.color)!=null?l:n.c)!=null?u:Gt.default.c,s:(h=(c=n.brightness)!=null?c:n.s)!=null?h:Gt.default.s,f:(d=(f=n.frequency)!=null?f:n.f)!=null?d:Gt.default.f,customData:(m=n.customData)!=null?m:Gt.default.customData()}))}),e.length?e:[new this({b:Gt.default.b,i:Gt.default.i,c:Gt.default.c,s:Gt.default.s,f:Gt.default.f,customData:Gt.default.customData()})]}toJSON(){return{b:this.time,i:this.transition,c:this.color,s:this.brightness,f:this.frequency,customData:bt(this.data.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get transition(){return this.data.i}set transition(t){this.data.i=t}get color(){return this.data.c}set color(t){this.data.c=t}get brightness(){return this.data.s}set brightness(t){this.data.s=t}get frequency(){return this.data.f}set frequency(t){this.data.f=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let Mn=Gt;$(Mn,"default",{b:0,i:0,c:0,s:1,f:0,customData:()=>({})});const Bt=class extends xd{constructor(e){super(e);$(this,"_f");$(this,"_e");this._f=_t.create(e.f),this._e=e.e.map(a=>Mn.create(a)[0]);const n=Math.max(...this._e.map(a=>a.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<n?n:this.beatDistribution)}static create(...e){const n=[];return e==null||e.forEach(a=>{var o,r,s,l,u,c,h,f,d,m,g,_,y,v,w,T,L;return n.push(new this({f:(r=(o=a.filter)!=null?o:a.f)!=null?r:Bt.default.f(),w:(l=(s=a.beatDistribution)!=null?s:a.w)!=null?l:Bt.default.w,d:(c=(u=a.beatDistributionType)!=null?u:a.d)!=null?c:Bt.default.d,r:(f=(h=a.brightnessDistribution)!=null?h:a.r)!=null?f:Bt.default.r,t:(m=(d=a.brightnessDistributionType)!=null?d:a.t)!=null?m:Bt.default.t,b:(_=(g=a.affectFirst)!=null?g:a.b)!=null?_:Bt.default.b,i:(v=(y=a.easing)!=null?y:a.i)!=null?v:Bt.default.i,e:(T=(w=a.events)!=null?w:a.e)!=null?T:Bt.default.e(),customData:(L=a.customData)!=null?L:Bt.default.customData()}))}),n.length?n:[new this({f:Bt.default.f(),w:Bt.default.w,d:Bt.default.d,r:Bt.default.r,t:Bt.default.t,b:Bt.default.b,i:Bt.default.i,e:Bt.default.e(),customData:Bt.default.customData()})]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,r:this.brightnessDistribution,t:this.brightnessDistributionType,b:this.affectFirst,i:this.easing,e:this.events.map(e=>e.toJSON()),customData:bt(this.customData)}}get filter(){return this._f}set filter(e){this._f=e}get beatDistribution(){return this.data.w}set beatDistribution(e){this.data.w=e}get beatDistributionType(){return this.data.d}set beatDistributionType(e){this.data.d=e}get brightnessDistribution(){return this.data.r}set brightnessDistribution(e){this.data.r=e}get brightnessDistributionType(){return this.data.t}set brightnessDistributionType(e){this.data.t=e}get affectFirst(){return this.data.b}set affectFirst(e){this.data.b=e?1:0}get easing(){return this.data.i}set easing(e){this.data.i=e}get events(){return this._e}set events(e){this._e=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}setEvents(e){return this.events=e,this}};let Pn=Bt;$(Pn,"default",{f:()=>({f:_t.default.f,p:_t.default.p,t:_t.default.t,r:_t.default.r,c:_t.default.c,n:_t.default.n,s:_t.default.s,l:_t.default.l,d:_t.default.d}),w:0,d:1,r:0,t:1,b:0,i:0,e:()=>[],customData:()=>({})});const ke=class extends Rd{constructor(e){super(e);$(this,"_e");this._e=e.e.map(n=>Pn.create(n)[0])}static create(...e){const n=[];return e==null||e.forEach(a=>{var o,r,s,l,u,c,h;return n.push(new this({b:(r=(o=a.time)!=null?o:a.b)!=null?r:ke.default.b,g:(l=(s=a.id)!=null?s:a.g)!=null?l:ke.default.g,e:(c=(u=a.events)!=null?u:a.e)!=null?c:ke.default.e(),customData:(h=a.customData)!=null?h:ke.default.customData()}))}),n.length?n:[new this({b:ke.default.b,g:ke.default.g,e:ke.default.e(),customData:ke.default.customData()})]}toJSON(){return{b:this.time,g:this.id,e:this.events.map(e=>e.toJSON()),customData:bt(this.customData)}}get time(){return this.data.b}set time(e){this.data.b=e}get id(){return this.data.g}set id(e){this.data.g=e}get events(){return this._e}set events(e){this._e=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}isValid(){return this.id>=0}};let Fi=ke;$(Fi,"default",{b:0,g:0,e:()=>[],customData:()=>({})});const zt=class extends Nd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m,g,_;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:zt.default.b,p:(s=(r=n.previous)!=null?r:n.p)!=null?s:zt.default.p,e:(u=(l=n.easing)!=null?l:n.e)!=null?u:zt.default.e,l:(h=(c=n.loop)!=null?c:n.l)!=null?h:zt.default.l,r:(d=(f=n.rotation)!=null?f:n.r)!=null?d:zt.default.r,o:(g=(m=n.direction)!=null?m:n.o)!=null?g:zt.default.o,customData:(_=n.customData)!=null?_:zt.default.customData()}))}),e.length?e:[new this({b:zt.default.b,p:zt.default.p,e:zt.default.e,l:zt.default.l,r:zt.default.r,o:zt.default.o,customData:zt.default.customData()})]}toJSON(){return{b:this.time,p:this.previous,e:this.easing,l:this.loop,r:this.rotation,o:this.direction,customData:bt(this.data.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get previous(){return this.data.p}set previous(t){this.data.p=t}get easing(){return this.data.e}set easing(t){this.data.e=t}get loop(){return this.data.l}set loop(t){this.data.l=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}get direction(){return this.data.o}set direction(t){this.data.o=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let Fn=zt;$(Fn,"default",{b:0,p:0,e:0,l:0,r:0,o:0,customData:()=>({})});const Lt=class extends Id{constructor(e){super(e);$(this,"_f");$(this,"_l");this._f=_t.create(e.f),this._l=e.l.map(a=>Fn.create(a)[0]);const n=Math.max(...this._l.map(a=>a.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<n?n:this.beatDistribution)}static create(...e){const n=[];return e==null||e.forEach(a=>{var o,r,s,l,u,c,h,f,d,m,g,_,y,v,w,T,L,F,A,x,N;return n.push(new this({f:(r=(o=a.filter)!=null?o:a.f)!=null?r:Lt.default.f(),w:(l=(s=a.beatDistribution)!=null?s:a.w)!=null?l:Lt.default.w,d:(c=(u=a.beatDistributionType)!=null?u:a.d)!=null?c:Lt.default.d,s:(f=(h=a.rotationDistribution)!=null?h:a.s)!=null?f:Lt.default.s,t:(m=(d=a.rotationDistributionType)!=null?d:a.t)!=null?m:Lt.default.t,a:(_=(g=a.axis)!=null?g:a.a)!=null?_:Lt.default.a,r:(v=(y=a.flip)!=null?y:a.r)!=null?v:Lt.default.r,b:(T=(w=a.affectFirst)!=null?w:a.b)!=null?T:Lt.default.b,i:(F=(L=a.easing)!=null?L:a.i)!=null?F:Lt.default.i,l:(x=(A=a.events)!=null?A:a.l)!=null?x:Lt.default.l(),customData:(N=a.customData)!=null?N:Lt.default.customData()}))}),n.length?n:[new this({f:Lt.default.f(),w:Lt.default.w,d:Lt.default.d,s:Lt.default.s,t:Lt.default.t,a:Lt.default.a,r:Lt.default.r,b:Lt.default.b,i:Lt.default.i,l:Lt.default.l(),customData:Lt.default.customData()})]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.rotationDistribution,t:this.rotationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,i:this.easing,l:this.events.map(e=>e.toJSON()),customData:bt(this.customData)}}get filter(){return this._f}set filter(e){this._f=e}get beatDistribution(){return this.data.w}set beatDistribution(e){this.data.w=e}get beatDistributionType(){return this.data.d}set beatDistributionType(e){this.data.d=e}get rotationDistribution(){return this.data.s}set rotationDistribution(e){this.data.s=e}get rotationDistributionType(){return this.data.t}set rotationDistributionType(e){this.data.t=e}get axis(){return this.data.a}set axis(e){this.data.a=e}get flip(){return this.data.r}set flip(e){this.data.r=e?1:0}get affectFirst(){return this.data.b}set affectFirst(e){this.data.b=e?1:0}get easing(){return this.data.i}set easing(e){this.data.i=e}get events(){return this._l}set events(e){this._l=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}setEvents(e){return this.events=e,this}};let Hn=Lt;$(Hn,"default",{f:()=>({f:_t.default.f,p:_t.default.p,t:_t.default.t,r:_t.default.r,c:_t.default.c,n:_t.default.n,s:_t.default.s,l:_t.default.l,d:_t.default.d}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,i:0,l:()=>[],customData:()=>({})});const xe=class extends Ad{constructor(e){super(e);$(this,"_e");this._e=e.e.map(n=>Hn.create(n)[0])}static create(...e){const n=[];return e==null||e.forEach(a=>{var o,r,s,l,u,c,h;return n.push(new this({b:(r=(o=a.time)!=null?o:a.b)!=null?r:xe.default.b,g:(l=(s=a.id)!=null?s:a.g)!=null?l:xe.default.g,e:(c=(u=a.events)!=null?u:a.e)!=null?c:xe.default.e(),customData:(h=a.customData)!=null?h:xe.default.customData()}))}),n.length?n:[new this({b:xe.default.b,g:xe.default.g,e:xe.default.e(),customData:xe.default.customData()})]}toJSON(){return{b:this.time,g:this.id,e:this.events.map(e=>e.toJSON()),customData:bt(this.customData)}}get time(){return this.data.b}set time(e){this.data.b=e}get id(){return this.data.g}set id(e){this.data.g=e}get events(){return this._e}set events(e){this._e=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}isValid(){return this.id>=0}};let Hi=xe;$(Hi,"default",{b:0,g:0,e:()=>[],customData:()=>({})});class Od extends Rr{setTranslationDistribution(t){return this.translationDistribution=t,this}setTranslationDistributionType(t){return this.translationDistributionType=t,this}setAxis(t){return this.axis=t,this}setFlip(t){return this.flip=t,this}setAffectFirst(t){return this.affectFirst=t,this}isValid(){return super.isValid()&&(this.translationDistributionType===1||this.translationDistributionType===2)&&(this.axis===0||this.axis===1)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}class Md extends Pe{setPrevious(t){return this.previous=t,this}setEasing(t){return this.easing=t,this}setTranslation(t){return this.translation=t,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3}}const re=class extends Md{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:re.default.b,p:(s=(r=n.previous)!=null?r:n.p)!=null?s:re.default.p,e:(u=(l=n.easing)!=null?l:n.e)!=null?u:re.default.e,t:(h=(c=n.translation)!=null?c:n.t)!=null?h:re.default.t,customData:(f=n.customData)!=null?f:re.default.customData()}))}),e.length?e:[new this({b:re.default.b,p:re.default.p,e:re.default.e,t:re.default.t,customData:re.default.customData()})]}toJSON(){return{b:this.time,p:this.previous,e:this.easing,t:this.translation,customData:bt(this.data.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get previous(){return this.data.p}set previous(t){this.data.p=t}get easing(){return this.data.e}set easing(t){this.data.e=t}get translation(){return this.data.t}set translation(t){this.data.t=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let zn=re;$(zn,"default",{b:0,p:0,e:0,t:0,customData:()=>({})});const Ct=class extends Od{constructor(e){super(e);$(this,"_f");$(this,"_l");this._f=_t.create(e.f),this._l=e.l.map(a=>zn.create(a)[0]);const n=Math.max(...this._l.map(a=>a.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<n?n:this.beatDistribution)}static create(...e){const n=[];return e==null||e.forEach(a=>{var o,r,s,l,u,c,h,f,d,m,g,_,y,v,w,T,L,F,A,x,N;return n.push(new this({f:(r=(o=a.filter)!=null?o:a.f)!=null?r:Ct.default.f(),w:(l=(s=a.beatDistribution)!=null?s:a.w)!=null?l:Ct.default.w,d:(c=(u=a.beatDistributionType)!=null?u:a.d)!=null?c:Ct.default.d,s:(f=(h=a.translationDistribution)!=null?h:a.s)!=null?f:Ct.default.s,t:(m=(d=a.translationDistributionType)!=null?d:a.t)!=null?m:Ct.default.t,a:(_=(g=a.axis)!=null?g:a.a)!=null?_:Ct.default.a,r:(v=(y=a.flip)!=null?y:a.r)!=null?v:Ct.default.r,b:(T=(w=a.affectFirst)!=null?w:a.b)!=null?T:Ct.default.b,i:(F=(L=a.easing)!=null?L:a.i)!=null?F:Ct.default.i,l:(x=(A=a.events)!=null?A:a.l)!=null?x:Ct.default.l(),customData:(N=a.customData)!=null?N:Ct.default.customData()}))}),n.length?n:[new this({f:Ct.default.f(),w:Ct.default.w,d:Ct.default.d,s:Ct.default.s,t:Ct.default.t,a:Ct.default.a,r:Ct.default.r,b:Ct.default.b,i:Ct.default.i,l:Ct.default.l(),customData:Ct.default.customData()})]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.translationDistribution,t:this.translationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,i:this.easing,l:this.events.map(e=>e.toJSON()),customData:bt(this.customData)}}get filter(){return this._f}set filter(e){this._f=e}get beatDistribution(){return this.data.w}set beatDistribution(e){this.data.w=e}get beatDistributionType(){return this.data.d}set beatDistributionType(e){this.data.d=e}get translationDistribution(){return this.data.s}set translationDistribution(e){this.data.s=e}get translationDistributionType(){return this.data.t}set translationDistributionType(e){this.data.t=e}get axis(){return this.data.a}set axis(e){this.data.a=e}get flip(){return this.data.r}set flip(e){this.data.r=e?1:0}get affectFirst(){return this.data.b}set affectFirst(e){this.data.b=e?1:0}get easing(){return this.data.i}set easing(e){this.data.i=e}get events(){return this._l}set events(e){this._l=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}setEvents(e){return this.events=e,this}};let Xn=Ct;$(Xn,"default",{f:()=>({f:_t.default.f,p:_t.default.p,t:_t.default.t,r:_t.default.r,c:_t.default.c,n:_t.default.n,s:_t.default.s,l:_t.default.l,d:_t.default.d}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,i:0,l:()=>[],customData:()=>({})});class Pd extends Nr{}const Re=class extends Pd{constructor(e){super(e);$(this,"_e");this._e=e.e.map(n=>Xn.create(n)[0])}static create(...e){const n=[];return e==null||e.forEach(a=>{var o,r,s,l,u,c,h;return n.push(new this({b:(r=(o=a.time)!=null?o:a.b)!=null?r:Re.default.b,g:(l=(s=a.id)!=null?s:a.g)!=null?l:Re.default.g,e:(c=(u=a.events)!=null?u:a.e)!=null?c:Re.default.e(),customData:(h=a.customData)!=null?h:Re.default.customData()}))}),n.length?n:[new this({b:Re.default.b,g:Re.default.g,e:Re.default.e(),customData:Re.default.customData()})]}toJSON(){return{b:this.time,g:this.id,e:this.events.map(e=>e.toJSON()),customData:bt(this.customData)}}get time(){return this.data.b}set time(e){this.data.b=e}get id(){return this.data.g}set id(e){this.data.g=e}get events(){return this._e}set events(e){this._e=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}setCustomData(e){return this.customData=e,this}addCustomData(e){return this.customData={...this.customData,object:e},this}isValid(){return this.id>=0}};let zi=Re;$(zi,"default",{b:0,g:0,e:()=>[],customData:()=>({})});const Ne=class extends Bd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:Ne.default.b,e:(s=(r=n.executionTime)!=null?r:n.e)!=null?s:Ne.default.e,r:(u=(l=n.rotation)!=null?l:n.r)!=null?u:Ne.default.r,customData:(c=n.customData)!=null?c:Ne.default.customData()}))}),e.length?e:[new this({b:Ne.default.b,e:Ne.default.e,r:Ne.default.r,customData:Ne.default.customData()})]}toJSON(){return{b:this.time,e:this.executionTime,r:this.rotation,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get executionTime(){return this.data.e}set executionTime(t){this.data.e=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let yi=Ne;$(yi,"default",{b:0,e:0,r:0,customData:()=>({})});const Dt=class extends Ac{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f,d,m,g,_,y,v,w,T,L,F,A,x,N,U,tt,S;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:Dt.default.b,c:(s=(r=n.color)!=null?r:n.c)!=null?s:Dt.default.c,x:(u=(l=n.posX)!=null?l:n.x)!=null?u:Dt.default.x,y:(h=(c=n.posY)!=null?c:n.y)!=null?h:Dt.default.y,d:(d=(f=n.direction)!=null?f:n.d)!=null?d:Dt.default.d,mu:(g=(m=n.lengthMultiplier)!=null?m:n.mu)!=null?g:Dt.default.mu,tb:(y=(_=n.tailTime)!=null?_:n.tb)!=null?y:Dt.default.tb,tx:(w=(v=n.tailPosX)!=null?v:n.tx)!=null?w:Dt.default.tx,ty:(L=(T=n.tailPosY)!=null?T:n.ty)!=null?L:Dt.default.ty,tc:(A=(F=n.tailDirection)!=null?F:n.tc)!=null?A:Dt.default.tc,tmu:(N=(x=n.tailLengthMultiplier)!=null?x:n.tmu)!=null?N:Dt.default.tmu,m:(tt=(U=n.midAnchor)!=null?U:n.m)!=null?tt:Dt.default.m,customData:(S=n.customData)!=null?S:Dt.default.customData()}))}),e.length?e:[new this({b:Dt.default.b,c:Dt.default.c,x:Dt.default.x,y:Dt.default.y,d:Dt.default.d,mu:Dt.default.mu,tb:Dt.default.tb,tx:Dt.default.tx,ty:Dt.default.ty,tc:Dt.default.tc,tmu:Dt.default.tmu,m:Dt.default.m,customData:Dt.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,mu:this.lengthMultiplier,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,tc:this.tailDirection,tmu:this.tailLengthMultiplier,m:this.midAnchor,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get color(){return this.data.c}set color(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get lengthMultiplier(){return this.data.mu}set lengthMultiplier(t){this.data.mu=t}get tailTime(){return this.data.tb}set tailTime(t){this.data.tb=t}get tailPosX(){return this.data.tx}set tailPosX(t){this.data.tx=t}get tailPosY(){return this.data.ty}set tailPosY(t){this.data.ty=t}get tailDirection(){return this.data.tc}set tailDirection(t){this.data.tc=t}get tailLengthMultiplier(){return this.data.tmu}set tailLengthMultiplier(t){this.data.tmu=t}get midAnchor(){return this.data.m}set midAnchor(t){this.data.m=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]})),super.mirror(t)}getTailPosition(t){switch(t){case"ne":return this.customData.tailCoordinates?[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]]:[this.tailPosX,this.tailPosY];default:return this.customData.tailCoordinates?[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]]:super.getTailPosition(t)}}};let vi=Dt;$(vi,"default",{b:0,c:0,x:0,y:0,d:0,mu:1,tb:0,tx:0,ty:0,tc:0,tmu:1,m:0,customData:()=>({})});const se=class extends Bc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var a,o,r,s,l,u,c,h,f;return e.push(new this({b:(o=(a=n.time)!=null?a:n.b)!=null?o:se.default.b,x:(s=(r=n.posX)!=null?r:n.x)!=null?s:se.default.x,y:(u=(l=n.posY)!=null?l:n.y)!=null?u:se.default.y,d:(h=(c=n.direction)!=null?c:n.d)!=null?h:se.default.d,customData:(f=n.customData)!=null?f:se.default.customData()}))}),e.length?e:[new this({b:se.default.b,x:se.default.x,y:se.default.y,d:se.default.d,customData:se.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.direction,customData:bt(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let Ei=se;$(Ei,"default",{b:0,x:0,y:0,d:1,customData:()=>({})});class $c extends xc{constructor(e){var n,a,o,r,s,l,u,c,h,f,d,m,g,_,y,v,w,T,L,F,A,x,N,U,tt,S,P,b,H;super(e);$(this,"version");$(this,"bpmEvents");$(this,"rotationEvents");$(this,"colorNotes");$(this,"bombNotes");$(this,"obstacles");$(this,"sliders");$(this,"burstSliders");$(this,"waypoints");$(this,"basicEvents");$(this,"colorBoostEvents");$(this,"lightColorEventBoxGroups");$(this,"lightRotationEventBoxGroups");$(this,"lightTranslationEventBoxGroups");$(this,"eventTypesWithKeywords");$(this,"useNormalEventsAsCompatibleEvents");this.version="3.2.0",this.bpmEvents=(a=(n=e.bpmEvents)==null?void 0:n.map(Z=>_i.create(Z)[0]))!=null?a:[],this.rotationEvents=(r=(o=e.rotationEvents)==null?void 0:o.map(Z=>yi.create(Z)[0]))!=null?r:[],this.colorNotes=(l=(s=e.colorNotes)==null?void 0:s.map(Z=>Ie.create(Z)[0]))!=null?l:[],this.bombNotes=(c=(u=e.bombNotes)==null?void 0:u.map(Z=>qe.create(Z)[0]))!=null?c:[],this.obstacles=(f=(h=e.obstacles)==null?void 0:h.map(Z=>Vt.create(Z)[0]))!=null?f:[],this.sliders=(m=(d=e.sliders)==null?void 0:d.map(Z=>vi.create(Z)[0]))!=null?m:[],this.burstSliders=(_=(g=e.burstSliders)==null?void 0:g.map(Z=>Pi.create(Z)[0]))!=null?_:[],this.waypoints=(v=(y=e.waypoints)==null?void 0:y.map(Z=>Ei.create(Z)[0]))!=null?v:[],this.basicEvents=(T=(w=e.basicBeatmapEvents)==null?void 0:w.map(Z=>gi.create(Z)[0]))!=null?T:[],this.colorBoostEvents=(F=(L=e.colorBoostBeatmapEvents)==null?void 0:L.map(Z=>bi.create(Z)[0]))!=null?F:[],this.lightColorEventBoxGroups=(x=(A=e.lightColorEventBoxGroups)==null?void 0:A.map(Z=>Fi.create(Z)[0]))!=null?x:[],this.lightRotationEventBoxGroups=(U=(N=e.lightRotationEventBoxGroups)==null?void 0:N.map(Z=>Hi.create(Z)[0]))!=null?U:[],this.lightTranslationEventBoxGroups=(S=(tt=e.lightTranslationEventBoxGroups)==null?void 0:tt.map(Z=>zi.create(Z)[0]))!=null?S:[],this.eventTypesWithKeywords=(P=cn.create(e.basicEventTypesWithKeywords))!=null?P:{d:[]},this.useNormalEventsAsCompatibleEvents=(b=e.useNormalEventsAsCompatibleEvents)!=null?b:!1,this.customData=(H=e.customData)!=null?H:{}}static create(e={}){var n,a,o,r,s,l,u,c,h,f,d,m,g,_,y,v;return new this({version:"3.2.0",bpmEvents:(n=e.bpmEvents)!=null?n:[],rotationEvents:(a=e.rotationEvents)!=null?a:[],colorNotes:(o=e.colorNotes)!=null?o:[],bombNotes:(r=e.bombNotes)!=null?r:[],obstacles:(s=e.obstacles)!=null?s:[],sliders:(l=e.sliders)!=null?l:[],burstSliders:(u=e.burstSliders)!=null?u:[],waypoints:(c=e.waypoints)!=null?c:[],basicBeatmapEvents:(h=e.basicBeatmapEvents)!=null?h:[],colorBoostBeatmapEvents:(f=e.colorBoostBeatmapEvents)!=null?f:[],lightColorEventBoxGroups:(d=e.lightColorEventBoxGroups)!=null?d:[],lightRotationEventBoxGroups:(m=e.lightRotationEventBoxGroups)!=null?m:[],lightTranslationEventBoxGroups:(g=e.lightTranslationEventBoxGroups)!=null?g:[],basicEventTypesWithKeywords:(_=e.basicEventTypesWithKeywords)!=null?_:{d:[]},useNormalEventsAsCompatibleEvents:(y=e.useNormalEventsAsCompatibleEvents)!=null?y:!1,customData:(v=e.customData)!=null?v:{}})}toJSON(){return{version:"3.2.0",bpmEvents:this.bpmEvents.map(e=>e.toJSON()),rotationEvents:this.rotationEvents.map(e=>e.toJSON()),colorNotes:this.colorNotes.map(e=>e.toJSON()),bombNotes:this.bombNotes.map(e=>e.toJSON()),obstacles:this.obstacles.map(e=>e.toJSON()),sliders:this.sliders.map(e=>e.toJSON()),burstSliders:this.burstSliders.map(e=>e.toJSON()),waypoints:this.waypoints.map(e=>e.toJSON()),basicBeatmapEvents:this.basicEvents.map(e=>e.toJSON()),colorBoostBeatmapEvents:this.colorBoostEvents.map(e=>e.toJSON()),lightColorEventBoxGroups:this.lightColorEventBoxGroups.map(e=>e.toJSON()),lightRotationEventBoxGroups:this.lightRotationEventBoxGroups.map(e=>e.toJSON()),lightTranslationEventBoxGroups:this.lightTranslationEventBoxGroups.map(e=>e.toJSON()),basicEventTypesWithKeywords:this.eventTypesWithKeywords.toJSON(),useNormalEventsAsCompatibleEvents:this.useNormalEventsAsCompatibleEvents,customData:bt(this.customData)}}clone(){const e=this.fileName;return super.clone().setFileName(e)}get customData(){return this.data.customData}set customData(e){this.data.customData=e}addBPMEvents(...e){this.bpmEvents.push(...e.map(n=>n instanceof _i?n:_i.create(n)[0]))}addRotationEvents(...e){this.rotationEvents.push(...e.map(n=>n instanceof yi?n:yi.create(n)[0]))}addColorNotes(...e){this.colorNotes.push(...e.map(n=>n instanceof Ie?n:Ie.create(n)[0]))}addBombNotes(...e){this.bombNotes.push(...e.map(n=>n instanceof qe?n:qe.create(n)[0]))}addObstacles(...e){this.obstacles.push(...e.map(n=>n instanceof Vt?n:Vt.create(n)[0]))}addSliders(...e){this.sliders.push(...e.map(n=>n instanceof vi?n:vi.create(n)[0]))}addBurstSliders(...e){this.burstSliders.push(...e.map(n=>n instanceof Pi?n:Pi.create(n)[0]))}addWaypoints(...e){this.waypoints.push(...e.map(n=>n instanceof Ei?n:Ei.create(n)[0]))}addBasicEvents(...e){this.basicEvents.push(...e.map(n=>n instanceof gi?n:gi.create(n)[0]))}addColorBoostEvents(...e){this.colorBoostEvents.push(...e.map(n=>n instanceof bi?n:bi.create(n)[0]))}addLightColorEventBoxGroups(...e){this.lightColorEventBoxGroups.push(...e.map(n=>n instanceof Fi?n:Fi.create(n)[0]))}addLightRotationEventBoxGroups(...e){this.lightRotationEventBoxGroups.push(...e.map(n=>n instanceof Hi?n:Hi.create(n)[0]))}addLightTranslationEventBoxGroups(...e){this.lightTranslationEventBoxGroups.push(...e.map(n=>n instanceof zi?n:zi.create(n)[0]))}isValid(){throw new Error("Method not implemented.")}}const Ta=i=>`[shared::parse::${i}]`;function Fd(i){return et.info(Ta("info"),"Parsing beatmap info v2.x.x"),i._difficultyBeatmapSets.sort((t,e)=>Za[t._beatmapCharacteristicName]-Za[e._beatmapCharacteristicName]),i._difficultyBeatmapSets.forEach(t=>{let e=0;t._difficultyBeatmaps.forEach(n=>{var a,o;n._difficultyRank-e<=0&&et.warn(Ta("info"),n._difficulty+" is unordered"),Ol[n._difficulty]!==n._difficultyRank&&et.error(Ta("info"),n._difficulty+" has invalid rank"),e=n._difficultyRank,typeof((a=n._customData)==null?void 0:a._editorOffset)=="number"&&n._customData._editorOffset===0&&delete n._customData._editorOffset,typeof((o=n._customData)==null?void 0:o._editorOldOffset)=="number"&&n._customData._editorOldOffset===0&&delete n._customData._editorOldOffset}),t._difficultyBeatmaps.sort((n,a)=>n._difficultyRank-a._difficultyRank)}),i}const Oc=i=>`[shared::dataCheck::${i}]`;function Ue(i,t,e){if(t)throw Error(i);et.warn(Oc("deepCheck"),i),e.push(i)}function un(i,t,e,n,a=!0,o=[]){if(et.verbose(Oc("deepCheck"),`Looking up ${e}`),Array.isArray(i)){i.forEach((s,l)=>un(s,t,`${e}[${l}]`,n));return}const r=Object.keys(t);for(const s in i){if(!r.length)break;r.includes(s)||Ue(`Unused key ${s} found in ${e}`,!1,o)}for(const s in t){if(typeof i[s]>"u"){if(t[s].optional||Dd(n,t[s].version)==="old")continue;Ue(`Missing ${s} in object ${e}!`,a,o)}i[s]==null&&Ue(`${s} contain null value in object ${e}!`,a,o),t[s].type==="array"&&(Array.isArray(i[s])||Ue(`${s} is not an array in object ${e}!`,a,o),un(i[s],t[s].check,`${e} ${s}`,n)),t[s].type==="object"&&(!Array.isArray(i[s])&&typeof i[s]!="object"?Ue(`${s} is not an object in object ${e}!`,a,o):un(i[s],t[s].check,`${e} ${s}`,n)),t[s].type!=="array"&&typeof i[s]!==t[s].type&&Ue(`${s} is not ${t[s].type} in object ${e}!`,a,o),t[s].type==="number"&&typeof i[s]=="number"&&(t[s].int&&i[s]%1!==0&&Ue(`${e} ${s} cannot be float!`,!1,o),t[s].unsigned&&i[s]<0&&Ue(`${e} ${s} cannot be negative!`,!1,o))}}const Hd={_time:{type:"number",version:"2.0.0"},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_lineIndex:{type:"number",int:!0,version:"2.0.0"},_lineLayer:{type:"number",int:!0,version:"2.0.0"},_cutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},zd={_colorType:{type:"number",version:"2.0.0"},_headTime:{type:"number",version:"2.0.0"},_headLineIndex:{type:"number",int:!0,version:"2.0.0"},_headLineLayer:{type:"number",int:!0,version:"2.0.0"},_headCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_headControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_tailTime:{type:"number",version:"2.0.0"},_tailLineIndex:{type:"number",int:!0,version:"2.0.0"},_tailLineLayer:{type:"number",int:!0,version:"2.0.0"},_tailCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_tailControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_sliderMidAnchorMode:{type:"number",version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Xd={_time:{type:"number",version:"2.0.0"},_lineIndex:{type:"number",int:!0,version:"2.0.0"},_lineLayer:{type:"number",int:!0,version:"2.6.0",optional:!0},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_duration:{type:"number",version:"2.0.0"},_width:{type:"number",int:!0,version:"2.0.0"},_height:{type:"number",int:!0,version:"2.6.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},jd={_time:{type:"number",version:"2.0.0"},_type:{type:"number",int:!0,version:"2.0.0"},_value:{type:"number",int:!0,version:"2.0.0"},_floatValue:{type:"number",version:"2.5.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Yd={_time:{type:"number",version:"2.2.0"},_lineIndex:{type:"number",int:!0,version:"2.2.0"},_lineLayer:{type:"number",int:!0,version:"2.2.0"},_offsetDirection:{type:"number",int:!0,version:"2.2.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Ud={_keyword:{type:"string",version:"2.4.0"},_specialEvents:{type:"number",int:!0,version:"2.4.0"}},Gd={_keywords:{type:"array",version:"2.4.0",check:Ud}},Wd={_version:{type:"string",version:"2.0.0"},_notes:{type:"array",version:"2.0.0",check:Hd},_sliders:{type:"array",version:"2.6.0",check:zd},_obstacles:{type:"array",version:"2.0.0",check:Xd},_events:{type:"array",version:"2.0.0",check:jd},_waypoints:{type:"array",version:"2.2.0",check:Yd,optional:!0},_specialEventsKeywordFilters:{type:"object",version:"2.4.0",check:Gd,optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},uo=i=>`[v2::parse::${i}]`,Cn=(i,t)=>i._time-t._time;function Vd(i,t={enable:!0,throwError:!0}){var e,n,a,o,r,s;return et.info(uo("difficulty"),"Parsing beatmap difficulty v2.x.x"),(e=i._version)!=null&&e.startsWith("2")||(et.warn(uo("difficulty"),"Unidentified beatmap version"),i._version="2.0.0"),t.enable&&un(i,Wd,"difficulty",i._version,t.throwError),i._notes=(n=i._notes)!=null?n:[],i._sliders=(a=i._sliders)!=null?a:[],i._obstacles=(o=i._obstacles)!=null?o:[],i._events=(r=i._events)!=null?r:[],i._waypoints=(s=i._waypoints)!=null?s:[],i._notes.sort(Cn),i._sliders.sort((l,u)=>l._headTime-u._headTime),i._obstacles.sort(Cn),i._events.sort(Cn),i._waypoints.sort(Cn),$d.create(i)}const Jd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},a:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},qd={b:{type:"number",version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Zd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},mu:{type:"number",version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",int:!0,version:"3.0.0"},ty:{type:"number",int:!0,version:"3.0.0"},tc:{type:"number",int:!0,version:"3.0.0"},tmu:{type:"number",version:"3.0.0"},m:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Kd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",int:!0,version:"3.0.0"},ty:{type:"number",int:!0,version:"3.0.0"},sc:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Qd={b:{type:"number",version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",version:"3.0.0"},w:{type:"number",int:!0,version:"3.0.0"},h:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},tf={b:{type:"number",version:"3.0.0"},et:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ef={b:{type:"number",version:"3.0.0"},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},nf={b:{type:"number",version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"},r:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},af={b:{type:"number",version:"3.0.0"},o:{type:"boolean",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ir={f:{type:"number",int:!0,version:"3.0.0"},p:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},r:{type:"number",int:!0,version:"3.0.0"},c:{type:"number",int:!0,version:"3.1.0"},l:{type:"number",version:"3.1.0"},d:{type:"number",int:!0,version:"3.1.0"},n:{type:"number",int:!0,version:"3.1.0"},s:{type:"number",int:!0,version:"3.1.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},rf={b:{type:"number",version:"3.0.0"},i:{type:"number",int:!0,version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},sf={f:{type:"object",version:"3.0.0",check:Ir},w:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},r:{type:"number",version:"3.0.0"},t:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:rf},b:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},of={b:{type:"number",version:"3.0.0"},g:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:sf},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},lf={b:{type:"number",version:"3.0.0"},p:{type:"number",int:!0,version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"},l:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},o:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},cf={f:{type:"object",version:"3.0.0",check:Ir},w:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},t:{type:"number",int:!0,version:"3.0.0"},a:{type:"number",int:!0,version:"3.0.0"},l:{type:"array",version:"3.0.0",check:lf},r:{type:"number",int:!0,version:"3.0.0"},b:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},uf={b:{type:"number",version:"3.0.0"},g:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:cf},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},hf={b:{type:"number",version:"3.2.0"},p:{type:"number",int:!0,version:"3.2.0"},e:{type:"number",int:!0,version:"3.2.0"},t:{type:"number",version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},df={f:{type:"object",version:"3.2.0",check:Ir},w:{type:"number",version:"3.2.0"},d:{type:"number",int:!0,version:"3.2.0"},s:{type:"number",version:"3.2.0"},t:{type:"number",int:!0,version:"3.2.0"},a:{type:"number",int:!0,version:"3.2.0"},l:{type:"array",version:"3.2.0",check:hf},r:{type:"number",int:!0,version:"3.2.0"},b:{type:"number",int:!0,version:"3.2.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ff={b:{type:"number",version:"3.2.0"},g:{type:"number",int:!0,version:"3.2.0"},e:{type:"array",version:"3.2.0",check:df},customData:{type:"object",version:"3.2.0",check:{},optional:!0}},mf={k:{type:"string",version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"}},pf={d:{type:"array",version:"3.0.0",check:mf,optional:!0}},gf={b:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},_f={version:{type:"string",version:"3.0.0"},bpmEvents:{type:"array",version:"3.0.0",check:ef,optional:!0},rotationEvents:{type:"array",version:"3.0.0",check:nf,optional:!0},colorNotes:{type:"array",version:"3.0.0",check:Jd,optional:!0},bombNotes:{type:"array",version:"3.0.0",check:qd,optional:!0},obstacles:{type:"array",version:"3.0.0",check:Qd,optional:!0},sliders:{type:"array",version:"3.0.0",check:Zd,optional:!0},burstSliders:{type:"array",version:"3.0.0",check:Kd,optional:!0},waypoints:{type:"array",version:"3.0.0",check:gf,optional:!0},basicBeatmapEvents:{type:"array",version:"3.0.0",check:tf,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:af,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:of,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:uf,optional:!0},lightTranslationEventBoxGroups:{type:"array",version:"3.2.0",check:ff,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"3.0.0",check:pf},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ho=i=>`[v3::parse::${i}]`,ee=(i,t)=>i.b-t.b;function bf(i,t={enable:!0,throwError:!0}){var e,n,a,o,r,s,l,u,c,h,f,d;return et.info(ho("difficulty"),"Parsing beatmap difficulty v3.x.x"),i.version==="3.0.0"||i.version==="3.1.0"||i.version==="3.2.0"||(et.warn(ho("difficulty"),"Unidentified beatmap version"),i.version="3.0.0"),t.enable&&un(i,_f,"difficulty",i.version,t.throwError),i.bpmEvents=(e=i.bpmEvents)!=null?e:[],i.rotationEvents=(n=i.rotationEvents)!=null?n:[],i.colorNotes=(a=i.colorNotes)!=null?a:[],i.bombNotes=(o=i.bombNotes)!=null?o:[],i.obstacles=(r=i.obstacles)!=null?r:[],i.sliders=(s=i.sliders)!=null?s:[],i.burstSliders=(l=i.burstSliders)!=null?l:[],i.waypoints=(u=i.waypoints)!=null?u:[],i.basicBeatmapEvents=(c=i.basicBeatmapEvents)!=null?c:[],i.colorBoostBeatmapEvents=(h=i.colorBoostBeatmapEvents)!=null?h:[],i.lightColorEventBoxGroups=(f=i.lightColorEventBoxGroups)!=null?f:[],i.lightRotationEventBoxGroups=(d=i.lightRotationEventBoxGroups)!=null?d:[],i.bpmEvents.sort(ee),i.rotationEvents.sort(ee),i.colorNotes.sort(ee),i.bombNotes.sort(ee),i.obstacles.sort(ee),i.sliders.sort(ee),i.burstSliders.sort(ee),i.waypoints.sort(ee),i.basicBeatmapEvents.sort(ee),i.colorBoostBeatmapEvents.sort(ee),i.lightColorEventBoxGroups.sort(ee),i.lightRotationEventBoxGroups.sort(ee),$c.create(i)}const fo="Invalid Event Box",mo="Check for valid event box group usage.",po=!0,ca={name:fo,description:mo,type:"event",order:{input:dt.EVENTS_INVALID_EVENT_BOX,output:ft.EVENTS_INVALID_EVENT_BOX},input:{enabled:po,params:{},html:ct.create(fo,mo,po,function(){ca.input.enabled=this.checked})},output:{html:null},run:Df},yf=["EDMEnvironment","LizzoEnvironment","PyroEnvironment","TheSecondEnvironment","TheWeekndEnvironment","WeaveEnvironment"],vf={EDMEnvironment:{0:24,1:24,2:24,3:24,4:24,5:24,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:1,15:1,16:1,17:1},LizzoEnvironment:{0:40,1:16,2:16,3:16,4:16,5:16,6:1,7:1,8:12,9:12,10:12,11:6,12:6,13:14,14:14,15:4,16:4,17:3,18:3,19:14},PyroEnvironment:{0:3,1:3,2:5,3:5,4:3,5:12,6:48,7:48,8:4,9:4,10:3,11:3,12:10,13:10},TheSecondEnvironment:{0:15,1:24,2:12,3:12,4:12,5:12,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4},TheWeekndEnvironment:{0:4,1:4,2:4,3:4,4:8,5:4,6:4,7:12,8:1,9:6,10:25,11:25,12:25,13:25,14:25,15:25,16:25,17:25,18:25,19:25,20:3,21:3,22:8,23:8,29:3,30:3,31:3,32:3,33:3,34:3,35:3,36:3,37:6,38:6,40:2},WeaveEnvironment:{0:8,1:8,2:8,3:8,4:8,5:8,6:8,7:8,8:8,9:8,10:8,11:8,12:12,13:12,14:8,15:8}};function Ef(i,t){const e=[],n=[];if(!yf.includes(t))return{defectID:[],defectFilter:[]};const a=t,o=Si[a][1],r=[...i.lightColorEventBoxGroups,...i.lightRotationEventBoxGroups,...i.lightTranslationEventBoxGroups];for(const s of r){o.includes(s.id)||e.push(s);for(const l of s.events){const u=l.filter;u.type===Al.STEP_AND_OFFSET&&u.p0>vf[a][s.id]&&n.push(s)}}return{defectID:e.map(s=>s.time).filter(function(s,l,u){return!l||s!==u[l-1]}),defectFilter:n.map(s=>s.time).filter(function(s,l,u){return!l||s!==u[l-1]})}}function Df(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=Ef(i.difficulty.data,i.difficulty.characteristic==="360Degree"||i.difficulty.characteristic==="90Degree"?i.info._allDirectionsEnvironmentName:i.info._environmentName),e=[];if(t.defectID.length&&e.push(ht("Invalid event box group ID",t.defectID,i.settings.bpm,"error")),t.defectFilter.length&&e.push(ht("Invalid event box filter",t.defectFilter,i.settings.bpm,"error")),e.length){const n=document.createElement("div");e.forEach(a=>n.append(a)),ca.output.html=n}else ca.output.html=null}const go="Unlit Bomb",_o="Check for lighting around bomb.",bo=!0,ua={name:go,description:_o,type:"event",order:{input:dt.EVENTS_UNLIT_BOMB,output:ft.EVENTS_UNLIT_BOMB},input:{enabled:bo,params:{},html:ct.create(go,_o,bo,function(){ua.input.enabled=this.checked})},output:{html:null},run:Sf},wf=(i,t,e,n)=>{var h,f,d;if(!t.length)return[];const a=[],o=(f=(h=Si[n])==null?void 0:h[0])!=null?f:Si.DefaultEnvironment[0],r=t.filter(m=>m.isLightEvent(n)&&o.includes(m.type)).sort((m,g)=>m.type-g.type),s={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},l={};o.forEach(m=>l[m]=[[0,!1]]);const u=e.toBeatTime(1),c=e.toBeatTime(.25);for(let m=0,g=r.length;m<g;m++){const _=r[m];if((_.isOn()||_.isFlash())&&s[_.type].state!=="on"){s[_.type]={state:"on",time:_.time,fadeTime:0};const y=l[_.type].find(v=>v[0]>=_.time);y?(y[0]=_.time,y[1]=!0):l[_.type].push([_.time,!0])}if(_.isFade()){s[_.type]={state:"off",time:_.time,fadeTime:u};const y=l[_.type].find(v=>v[0]>=_.time);y?(y[0]=_.time,y[1]=!0):l[_.type].push([_.time,!0]),l[_.type].push([_.time+u,!1])}(((d=_==null?void 0:_.floatValue)!=null?d:1)<.25||_.isOff()||_.customData._color&&(typeof _.customData._color[3]=="number"&&_.customData._color[3]<.25||Math.max(_.customData._color[0],_.customData._color[1],_.customData._color[2])<.25))&&s[_.type].state!=="off"&&(s[_.type]={state:"off",time:_.time,fadeTime:s[_.type].state==="on"?c:Math.min(c,s[_.type].fadeTime)},l[_.type].push([_.time+(s[_.type].state==="on"?c:Math.min(c,s[_.type].fadeTime)),!1]))}for(const m in l)l[m].reverse();for(let m=0,g=i.length,_=!1;m<g;m++){const y=i[m];_=!1;for(const v in l){const w=l[v].find(T=>T[0]<=y.time);w&&(_=_||w[1])}_||a.push(y)}return a.map(m=>m.time).filter(function(m,g,_){return!g||m!==_[g-1]})};function Sf(i){if(!i.difficulty){console.error("Something went wrong!");return}const t=wf(i.difficulty.data.bombNotes,i.difficulty.data.basicEvents,i.settings.bpm,i.info._environmentName);t.length?ua.output.html=ht("Unlit bomb",t,i.settings.bpm,"warning"):ua.output.html=null}const yo=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:la,invalidEventBox:ca,unlitBomb:ua},Symbol.toStringTag,{value:"Module"})),Mc="Hot Start",Pc="Check for first interactive object starting from start time.",Fc=!0,Hc=1.5,ui=document.createElement("input");ui.id="input__tools-hot-start";ui.className="input-toggle input--small";ui.type="number";ui.min="0";ui.step="0.1";ui.value=Hc.toString();ui.addEventListener("change",Tf);const zc=ct.create(Mc+" (s): ",Pc,Fc,function(){Di.input.enabled=this.checked});zc.appendChild(ui);const Di={name:Mc,description:Pc,type:"other",order:{input:dt.OTHERS_HOT_START,output:ft.OTHERS_HOT_START},input:{enabled:Fc,params:{time:Hc},html:zc},output:{html:null},run:Lf};function Tf(){Di.input.params.time=M(Math.abs(parseFloat(this.value)),3),this.value=Di.input.params.time.toString()}function Lf(i){if(!i.difficulty){console.error("Something went wrong!");return}const{time:t}=Di.input.params,e=i.settings.bpm.toRealTime(i.difficulty.data.getFirstInteractiveTime());e<t?Di.output.html=gt("Hot start",`${M(e,2)}s`,"warning"):Di.output.html=null}const vo="Difficulty Label Check",Eo="For ranking purpose, check difficulty label to fit rankability criteria.",Do=!0,ha={name:vo,description:Eo,type:"other",order:{input:dt.OTHERS_DIFFICULTY_LABEL,output:ft.OTHERS_DIFFICULTY_LABEL},input:{enabled:Do,params:{},html:ct.create(vo,Eo,Do,function(){ha.input.enabled=this.checked})},output:{html:null},run:Cf};function Cf(i){var e;if(!i.difficulty){console.error("Something went wrong!");return}const t=(e=i.difficulty.info._customData)==null?void 0:e._difficultyLabel;t&&t.length>30?ha.output.html=gt(`Difficulty label is too long (${t.length} characters)`,"exceeded 30 max characters by ranking criteria","rank"):ha.output.html=null}const wo="NJS Check",So="Check note jump speed for suitable value.",To=!0,da={name:wo,description:So,type:"other",order:{input:dt.OTHERS_NJS,output:ft.OTHERS_NJS},input:{enabled:To,params:{},html:ct.create(wo,So,To,function(){da.input.enabled=this.checked})},output:{html:null},run:kf};function kf(i){if(!i.difficulty){console.error("Something went wrong!");return}const{njs:t,bpm:e}=i.settings,n=[];if(i.difficulty.info._noteJumpMovementSpeed===0&&n.push(gt("Unset NJS","fallback NJS is used","error")),t.value>23&&n.push(gt(`NJS is too high (${M(t.value,2)})`,"use lower whenever necessary","warning")),t.value<3&&n.push(gt(`NJS is too low (${M(t.value,2)})`,"timing is less significant below this","warning")),t.jd>36&&n.push(gt("Very high jump distance",`${M(t.jd,2)}`,"warning")),t.jd<18&&n.push(gt("Very low jump distance",`${M(t.jd,2)}`,"warning")),t.jd>t.calcJDOptimalHigh()&&n.push(gt(`High jump distance warning (>${M(t.calcJDOptimalHigh(),2)})`,"NJS & offset may be uncomfortable to play","warning")),e.toRealTime(t.hjd)<.42&&n.push(gt(`Very quick reaction time (${M(e.toRealTime(t.hjd)*1e3)}ms)`,"may lead to suboptimal gameplay","warning")),t.calcHJDRaw()+t.offset<le.HJD_MIN&&n.push(gt("Unnecessary negative offset",`will not drop below ${le.HJD_MIN}`,"warning")),n.length){const a=document.createElement("div");n.forEach(o=>a.append(o)),da.output.html=a}else da.output.html=null}const Lo="Outside Playable Object",Co="Look for any object starting before and after song timer.",ko=!0,fa={name:Lo,description:Co,type:"other",order:{input:dt.OTHERS_OUTSIDE_PLAYABLE,output:ft.OTHERS_OUTSIDE_PLAYABLE},input:{enabled:ko,params:{},html:ct.create(Lo,Co,ko,function(){fa.input.enabled=this.checked})},output:{html:null},run:xf};function xf(i){if(!i.difficulty){console.error("Something went wrong!");return}const{bpm:t,audioDuration:e}=i.settings,{colorNotes:n,bombNotes:a,obstacles:o,basicEvents:r,sliders:s,burstSliders:l}=i.difficulty.data,u=[];if(e){let c=t.toBeatTime(e,!0);n.length&&n[0].time<0&&u.push(gt("Note(s) before start time",`${M(n[0].time,3)} (${kt(t.toRealTime(n[0].time))}`,"error")),a.length&&a[0].time<0&&u.push(gt("Bomb(s) before start time",`${M(a[0].time,3)} (${kt(t.toRealTime(a[0].time))}`,"error")),s.length&&s[0].time<0&&u.push(gt("Arc(s) before start time",`${M(s[0].time,3)} (${kt(t.toRealTime(s[0].time))}`,"error")),l.length&&l[0].time<0&&u.push(gt("Chain(s) before start time",`${M(l[0].time,3)} (${kt(t.toRealTime(l[0].time))}`,"error")),o.length&&o[0].time<0&&u.push(gt("Obstacle(s) before start time",`${M(o[0].time,3)} (${kt(t.toRealTime(o[0].time))}`,"error")),r.length&&r[0].time<0&&u.push(gt("Event(s) before start time",`${M(r[0].time,3)} (${kt(t.toRealTime(r[0].time))}`,"error")),n.length&&n[n.length-1].time>c&&u.push(gt("Note(s) after end time",`${M(n[n.length-1].time,3)} (${kt(t.toRealTime(n[n.length-1].time))})`,"error")),a.length&&a[a.length-1].time>c&&u.push(gt("Bomb(s) after end time",`${M(a[a.length-1].time,3)} (${kt(t.toRealTime(a[a.length-1].time))})`,"error")),s.length&&s[s.length-1].time>c&&u.push(gt("Arc(s) after end time",`${M(s[s.length-1].time,3)} (${kt(t.toRealTime(s[s.length-1].time))})`,"error")),l.length&&l[l.length-1].time>c&&u.push(gt("Chain(s) after end time",`${M(l[l.length-1].time,3)} (${kt(t.toRealTime(l[l.length-1].time))})`,"error")),o.length&&o[o.length-1].time>c&&u.push(gt("Obstacle(s) after end time",`${M(o[o.length-1].time,3)} (${kt(t.toRealTime(o[o.length-1].time))})`,"error")),r.length&&r[r.length-1].time>c&&u.push(gt("Event(s) after end time",`${M(r[r.length-1].time,3)} (${kt(t.toRealTime(r[r.length-1].time))})`,"error"))}if(u.length){const c=document.createElement("div");u.forEach(h=>c.append(h)),fa.output.html=c}else fa.output.html=null}const xo="Invalid Object",Ro="Validate beatmap object to be compatible with vanilla (ignores for modded).",No=!0,ma={name:xo,description:Ro,type:"other",order:{input:dt.OTHERS_INVALID_OBJECT,output:ft.OTHERS_INVALID_OBJECT},input:{enabled:No,params:{},html:ct.create(xo,Ro,No,function(){ma.input.enabled=this.checked})},output:{html:null},run:Rf};function Rf(i){var T,L,F,A;if(!i.difficulty){console.error("Something went wrong!");return}const{colorNotes:t,bombNotes:e,obstacles:n,basicEvents:a,sliders:o,burstSliders:r,lightColorEventBoxGroups:s,lightRotationEventBoxGroups:l,lightTranslationEventBoxGroups:u}=i.difficulty.data;let c=[],h=[],f=[],d=[],m=[];(L=(T=i.difficulty.info._customData)==null?void 0:T._requirements)!=null&&L.includes("Mapping Extensions")||((A=(F=i.difficulty.info._customData)==null?void 0:F._requirements)!=null&&A.includes("Noodle Extensions")?(c=t.filter(x=>x.isMappingExtensions()).map(x=>x.time),h=n.filter(x=>x.isMappingExtensions()).map(x=>x.time),f=e.filter(x=>x.isMappingExtensions()).map(x=>x.time),d=o.filter(x=>x.isMappingExtensions()).map(x=>x.time),m=r.filter(x=>x.isMappingExtensions()).map(x=>x.time)):(c=t.filter(x=>!x.isValid()).map(x=>x.time),h=n.filter(x=>!x.isValid()).map(x=>x.time),f=e.filter(x=>!x.isValid()).map(x=>x.time),d=o.filter(x=>!x.isValid()).map(x=>x.time),m=r.filter(x=>!x.isValid()).map(x=>x.time)));const g=a.filter(x=>!x.isValid()).map(x=>x.time),_=s.filter(x=>!x.isValid()).map(x=>x.time),y=l.filter(x=>!x.isValid()).map(x=>x.time),v=u.filter(x=>!x.isValid()).map(x=>x.time),w=[];if(c.length&&w.push(ht("Invalid note",c,i.settings.bpm,"error")),f.length&&w.push(ht("Invalid bomb",f,i.settings.bpm,"error")),d.length&&w.push(ht("Invalid arc",d,i.settings.bpm,"error")),m.length&&w.push(ht("Invalid chain",m,i.settings.bpm,"error")),h.length&&w.push(ht("Invalid obstacle",h,i.settings.bpm,"error")),g.length&&w.push(ht("Invalid event",g,i.settings.bpm,"error")),_.length&&w.push(ht("Invalid light color event",_,i.settings.bpm,"error")),y.length&&w.push(ht("Invalid light rotation event",y,i.settings.bpm,"error")),v.length&&w.push(ht("Invalid light translation event",v,i.settings.bpm,"error")),w.length){const x=document.createElement("div");w.forEach(N=>x.append(N)),ma.output.html=x}else ma.output.html=null}const Io=Object.freeze(Object.defineProperty({__proto__:null,hotStart:Di,difficultyLabel:ha,njs:da,outsidePlayable:fa,invalidObject:ma},Symbol.toStringTag,{value:"Module"})),pe=class{constructor(){}};let me=pe;$(me,"getNote",()=>Object.keys(Ks).map(t=>Ks[t])),$(me,"getObstacle",()=>Object.keys(ro).map(t=>ro[t])),$(me,"getEvent",()=>Object.keys(yo).map(t=>yo[t])),$(me,"getOther",()=>Object.keys(Io).map(t=>Io[t])),$(me,"getGeneral",()=>Object.keys(hs).map(t=>hs[t])),$(me,"getDifficulty",()=>[...pe.getNote(),...pe.getObstacle(),...pe.getEvent(),...pe.getOther()]),$(me,"getAll",()=>[...pe.getNote(),...pe.getObstacle(),...pe.getEvent(),...pe.getOther(),...pe.getGeneral()]);const pi=i=>`[analyzer::${i}]`,Xc=me.getAll().sort((i,t)=>i.order.input-t.order.input),jc=[...Xc].sort((i,t)=>i.order.output-t.order.output);function Yc(){lt.analysis={general:{html:null},map:[]}}function Nf(){var r,s;const i=lt.beatmapInfo;if(!i){et.error(pi("runGeneral"),"Could not analyse, missing map info");return}lt.analysis||Yc();const t=(r=lt.analysis)==null?void 0:r.general,e=ye.create(i._beatsPerMinute),n=le.create(e),a={bpm:e,njs:n,audioDuration:(s=lt.duration)!=null?s:null,mapDuration:0};et.info(pi("runGeneral"),"Analysing general");const o=[];jc.filter(l=>l.type==="general").forEach(l=>{if(l.input.enabled)try{l.run({settings:a,info:i}),l.output.html&&o.push(l.output.html)}catch(u){et.error(pi("runGeneral"),u)}}),t&&(t.html=o)}function Uc(i,t){var l,u,c,h;const e=lt.beatmapInfo;if(!e){et.error(pi("runDifficulty"),"Could not analyse, missing map info");return}lt.analysis||Yc();const n=(l=lt.beatmapDifficulty)==null?void 0:l.find(f=>f.characteristic===i&&f.difficulty===t);if(!n){et.error(pi("runDifficulty"),"Could not analyse, missing map data");return}const a=(u=lt.analysis)==null?void 0:u.map.find(f=>f.difficulty===t&&f.mode===i),o=le.create(n.bpm,n.info._noteJumpMovementSpeed||le.FallbackNJS[n.difficulty],n.info._noteJumpStartBeatOffset),r={bpm:n.bpm,njs:o,audioDuration:(c=lt.duration)!=null?c:null,mapDuration:n.bpm.toRealTime(n.data.getLastInteractiveTime())};et.info(pi("runDifficulty"),`Analysing ${i} ${t}`);const s=[];jc.filter(f=>f.type!=="general").forEach(f=>{if(f.input.enabled)try{f.run({settings:r,difficulty:n,info:e}),f.output.html&&s.push(f.output.html)}catch(d){et.error(pi("runDifficulty"),d)}}),a?a.html=s:(h=lt.analysis)==null||h.map.push({mode:i,difficulty:t,html:s})}function If(i){me.getDifficulty().sort((e,n)=>e.order.output-n.order.output).forEach(e=>{e.input.adjustTime&&e.input.adjustTime(i)})}function Af(){var i;(i=lt.beatmapDifficulty)==null||i.forEach(t=>Uc(t.characteristic,t.difficulty))}const Li={toolListInput:Xc,runGeneral:Nf,runDifficulty:Uc,adjustTime:If,applyAll:Af},hi="UI Tools: ",Ze=document.querySelectorAll(".tools__select-mode"),Ke=document.querySelectorAll(".tools__select-difficulty"),Bf=document.querySelectorAll(".difficulty__label"),Gc=document.querySelector(".tools__note-content"),Wc=document.querySelector(".tools__obstacle-content"),Vc=document.querySelector(".tools__event-content"),Jc=document.querySelector(".tools__other-content"),qc=document.querySelector(".tools__general-content"),$e=document.querySelector(".tools__output-diff"),Oe=document.querySelector(".tools__output-general"),Ao=document.querySelector(".tools__apply-this"),Bo=document.querySelector(".tools__apply-all"),$o=document.querySelector(".tools__apply-general");if(!Gc||!Wc||!Vc||!Jc||!qc)throw new Error(hi+"missing content element");if(!$e||!Oe)throw new Error(hi+"missing output element");if(Ao&&Bo&&$o)Ao.addEventListener("click",zf),Bo.addEventListener("click",Xf),$o.addEventListener("click",jf);else throw new Error(hi+"missing apply element");Ze.forEach(i=>i.addEventListener("change",Ff));Ke.forEach(i=>i.addEventListener("change",Hf));function Zc(){var t;const i=(t=lt.analysis)==null?void 0:t.general;if(!i){Oe.textContent="ERROR: could not find analysis for general";return}if(!i.html){Oe.textContent="ERROR: could not find HTML for general";return}Oe.innerHTML="",i.html.forEach(e=>Oe.appendChild(e)),Oe.firstChild||(Oe.textContent="No issues found.")}function vn(i,t){var n;if(!i&&!t&&(i=Ze[0].value,t=Ke[0].value),!i||!t)throw new Error(hi+"something went wrong!");$e.innerHTML="";const e=(n=lt.analysis)==null?void 0:n.map.find(a=>a.difficulty===t&&a.mode===i);if(!e){$e.textContent="ERROR: could not find analysis for "+i+" "+t;return}if(!e.html){$e.textContent="ERROR: could not find HTML for "+i+" "+t;return}e.html.forEach(a=>$e.appendChild(a)),$e.firstChild||($e.textContent="No issues found.")}function Ea(i){Bf.forEach(t=>t.textContent=i)}function Kc(i){if(!i)return;Ke.forEach(e=>{for(let n=e.options.length-1;n>=0;n--)e.remove(n)});let t=!0;for(let e=i._difficultyBeatmaps.length-1;e>=0;e--){const n=i._difficultyBeatmaps[e];Ke.forEach(a=>{var r,s,l,u;const o=document.createElement("option");if(o.value=n._difficulty,o.textContent=be[n._difficulty]+((r=n._customData)!=null&&r._difficultyLabel?" -- "+((s=n._customData)==null?void 0:s._difficultyLabel):""),t){const c=(l=lt.beatmapDifficulty)==null?void 0:l.find(h=>h.difficulty===n._difficulty&&h.characteristic===i._beatmapCharacteristicName);if(!c)throw new Error("missing _mapSetData");xl(c),Ea(((u=n._customData)==null?void 0:u._difficultyLabel)||be[n._difficulty]),vn(i._beatmapCharacteristicName,n._difficulty)}t=!1,a.add(o)})}}function Qc(i){if(!i){Ze.forEach(e=>Ra(e)),Ke.forEach(e=>Ra(e));return}let t=!0;i._difficultyBeatmapSets.forEach(e=>{Ze.forEach(n=>{const a=document.createElement("option");a.value=e._beatmapCharacteristicName,a.textContent=xr[e._beatmapCharacteristicName],n.add(a)}),t&&Kc(e),t=!1})}function $f(){const i=lt.beatmapInfo;if(!i)throw new Error(hi+"could not find map info");const t=ye.create(i._beatsPerMinute);Li.adjustTime(t)}function Of(){Li.toolListInput.forEach(i=>{if(i.input.html)switch(i.type){case"note":{Gc.appendChild(i.input.html);break}case"obstacle":{Wc.appendChild(i.input.html);break}case"event":{Vc.appendChild(i.input.html);break}case"other":{Jc.appendChild(i.input.html);break}case"general":{qc.appendChild(i.input.html);break}default:console.error(hi+"could not recognise type "+i.type+" for "+i.name)}})}function Mf(){Oe&&(Oe.innerHTML="No output."),$e&&($e.innerHTML="No output.")}function Pf(){Mf(),Ea("Difficulty Label"),Qc()}function Ff(i){var n;const t=i.target;Ze.forEach(a=>{a!==t&&(a.value=t.value)});const e=(n=lt.beatmapInfo)==null?void 0:n._difficultyBeatmapSets.find(a=>a._beatmapCharacteristicName===t.value);Kc(e)}function Hf(i){var a,o,r,s;const t=i.target;Ke.forEach(l=>{l!==t&&(l.value=t.value)});const e=(a=lt.beatmapInfo)==null?void 0:a._difficultyBeatmapSets.find(l=>l._beatmapCharacteristicName===Ze.item(0).value);if(!e)throw new Error("aaaaaaaaaaaaaaaaaaa");const n=(o=lt.beatmapDifficulty)==null?void 0:o.find(l=>l.difficulty===t.value&&l.characteristic===e._beatmapCharacteristicName);n&&(xl(n),Ea(((s=(r=n.info)==null?void 0:r._customData)==null?void 0:s._difficultyLabel)||be[t.value]),vn(n.characteristic,n.difficulty))}function zf(){const i=Ze[0].value,t=Ke[0].value;if(!i||!t)throw new Error(hi+"mode/difficulty does not exist");wt.status("info",`Re-analysing ${i} ${t}`,100),Li.runDifficulty(i,t),wt.status("info",`Re-analysed ${i} ${t}`,100),vn(i,t)}function Xf(){const i=Ze[0].value,t=Ke[0].value;if(!i||!t)throw new Error(hi+"mode/difficulty does not exist");wt.status("info","Re-analysing all difficulties",100),Li.applyAll(),wt.status("info","Re-analysed all difficulties",100),vn(i,t)}function jf(){wt.status("info","Re-analysing all difficulties",100),Li.runGeneral(),wt.status("info","Re-analysed all difficulties",100),Zc()}const Ni={displayOutputGeneral:Zc,displayOutputDifficulty:vn,setDifficultyLabel:Ea,adjustTime:$f,populateSelect:Qc,populateTool:Of,reset:Pf},wi="UI Stats: ",k="stats__";function Yf(i,t){const e=t.bpm,n=lt.duration||0,a=e.toRealTime(t.data.getLastInteractiveTime()),o=document.createElement("table");return o.className=k+"table",o.innerHTML=`<caption class="${k}table-caption">Note Per Seconds (NPS):</caption><tr><th class="${k}table-header" colspan="2">Overall</th><td class="${k}table-element">${M(t.data.nps(n),2)}</td></tr><tr><th class="${k}table-header" colspan="2">Mapped</th><td class="${k}table-element">${M(t.data.nps(a),2)}</td></tr><tr><th class="${k}table-header" rowspan="3">Peak</th><th class="${k}table-header">16-beat</th><td class="${k}table-element">${M(t.data.peak(16,e.value),2)}</td></tr><tr><th class="${k}table-header">8-beat</th><td class="${k}table-element">${M(t.data.peak(8,e.value),2)}</td></tr><tr><th class="${k}table-header">4-beat</th><td class="${k}table-element">${M(t.data.peak(4,e.value),2)}</td></tr>`,o}function Uf(i,t){const e=ye.create(i._beatsPerMinute),n=le.create(e,t.info._noteJumpMovementSpeed||le.FallbackNJS[t.difficulty],t.info._noteJumpStartBeatOffset),a=document.createElement("table");return a.className=k+"table",a.innerHTML=`<caption class="${k}table-caption">Map Settings:</caption><tr><th class="${k}table-header" colspan="2">Note Jump Speed</th><td class="${k}table-element">${M(n.value,3)}</td></tr><tr><th class="${k}table-header" colspan="2">Spawn Distance Modifier</th><td class="${k}table-element">${M(n.offset,3)}</td></tr><tr><th class="${k}table-header" colspan="2">Half Jump Duration</th><td class="${k}table-element">${M(n.hjd,3)}</td></tr><tr><th class="${k}table-header" colspan="2">Jump Distance</th><td class="${k}table-element">${M(n.jd,3)}</td></tr><tr><th class="${k}table-header" colspan="2">Reaction Time</th><td class="${k}table-element">${M(n.reactTime*1e3)}ms</td></tr>`,a}function Gf(i,t){const e=t.swingAnalysis,n=document.createElement("table");return n.className=k+"table",n.innerHTML=`<caption class="${k}table-caption">Swing Per Seconds (SPS):</caption><tr><th class="${k}table-header"></th><th class="${k}table-header">Total</th><th class="${k}table-header">Red</th><th class="${k}table-header">Blue</th></tr><tr><th class="${k}table-header">Average</th><td class="${k}table-element">${M(e.total.average,2)}</td><td class="${k}table-element">${M(e.red.average,2)}</td><td class="${k}table-element">${M(e.blue.average,2)}</td></tr><tr><th class="${k}table-header">Median</th><td class="${k}table-element">${M(e.total.median,2)}</td><td class="${k}table-element">${M(e.red.median,2)}</td><td class="${k}table-element">${M(e.blue.median,2)}</td></tr><tr><th class="${k}table-header">Peak</th><td class="${k}table-element">${M(e.total.peak,2)}</td><td class="${k}table-element">${M(e.red.peak,2)}</td><td class="${k}table-element">${M(e.blue.peak,2)}</td></tr><tr><th class="${k}table-header">Total</th><td class="${k}table-element">${e.total.total}</td><td class="${k}table-element">${e.red.total}</td><td class="${k}table-element">${e.blue.total}</td></tr>`,n}function jn(i){const t={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let e=i.length-1;e>=0;e--)i[e].color===0?(t.red.total++,i[e].isChroma()&&t.red.chroma++,i[e].isNoodleExtensions()&&t.red.noodleExtensions++,i[e].isMappingExtensions()&&t.red.mappingExtensions++):i[e].color===1&&(t.blue.total++,i[e].isChroma()&&t.blue.chroma++,i[e].isNoodleExtensions()&&t.blue.noodleExtensions++,i[e].isMappingExtensions()&&t.blue.mappingExtensions++);return t}function Wf(i){const t={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let e=i.length-1;e>=0;e--)t.total++,i[e].isChroma()&&t.chroma++,i[e].isNoodleExtensions()&&t.noodleExtensions++,i[e].isMappingExtensions()&&t.mappingExtensions++;return t}function kn(i,t){return i.filter(e=>e.data.posX===t).length}function Vf(i,t){return i.filter(e=>e.data.posY===t).length}function Jf(i,t,e){return i.filter(n=>n.data.posX===t&&n.data.posY===e).length}function qf(i,t){return i.filter(e=>e.type!=="bomb"&&e.data.direction===t).length}function tu(i,t){switch(t){case"note":return i.filter(e=>e.type==="note");case"red":return i.filter(e=>e.type==="note"&&e.data.color===0);case"blue":return i.filter(e=>e.type==="note"&&e.data.color===1);case"arc":return i.filter(e=>e.type==="slider");case"redArc":return i.filter(e=>e.type==="slider"&&e.data.color===0);case"blueArc":return i.filter(e=>e.type==="slider"&&e.data.color===1);case"chain":return i.filter(e=>e.type==="burstSlider");case"redChain":return i.filter(e=>e.type==="burstSlider"&&e.data.color===0);case"blueChain":return i.filter(e=>e.type==="burstSlider"&&e.data.color===1);case"bomb":return i.filter(e=>e.type==="bomb");default:return i}}function Zf(i){var l;const t=i.target,e=t.id.replace(`${k}table-select-angle-`,"").split("-"),n=e[0],a=e[1],o=(l=lt.beatmapDifficulty.find(u=>u.characteristic===n&&u.difficulty===a))==null?void 0:l.noteContainer;if(!o){console.error(wi+"note could not be found");return}const r=tu(o,t.value),s=document.querySelector(`#${k}table-angle-${n}-${a}`);if(!s){console.error(wi+"table could not be found");return}s.innerHTML=eu(r)}function eu(i){const t=i.length||1,e=[4,0,5,2,8,3,6,1,7];let n="";for(let a=0;a<3;a++){n+="<tr>";for(let o=0;o<3;o++){let r=qf(i,e[a*3+o]);n+=`<td class="${k}table-element">${r}<br>(${M(r/t*100,1)}%)</td>`}n+="</tr>"}return n}function Kf(i,t){var o;const e=yn.create(`${k}table-select-angle-${t.characteristic}-${t.difficulty}`,"Note Angle: ","caption",`${k}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"});(o=e.querySelector("select"))==null||o.addEventListener("change",Zf);let n=`<tbody id="${k}table-angle-${t.characteristic}-${t.difficulty}">${eu(t.noteContainer)}</tbody>`;const a=document.createElement("table");return a.className=k+"table",a.innerHTML=n,a.prepend(e),a}function Qf(i,t,e="DefaultEnvironment"){var o,r;const n=(r=(o=Si[e])==null?void 0:o[0])!=null?r:Si.DefaultEnvironment[0],a={};for(let s=n.length-1;s>=0;s--)a[n[s]]={total:0,chroma:0,chromaOld:0};a[5]={total:t.length,chroma:0,chromaOld:0};for(let s=i.length-1;s>=0;s--)i[s].isValidType()&&(a[i[s].type]||(a[i[s].type]={total:0,chroma:0,chromaOld:0}),a[i[s].type].total++,i[s].isChroma()&&a[i[s].type].chroma++,i[s].isOldChroma()&&a[i[s].type].chromaOld++);return a}function La(i,t="DefaultEnvironment"){var a,o;const e=(o=(a=Si[t])==null?void 0:a[1])!=null?o:Si.DefaultEnvironment[1],n={};for(let r=e.length-1;r>=0;r--)n[e[r]]={total:0,eventBox:0,base:0};for(let r=i.length-1;r>=0;r--)n[i[r].id]||(n[i[r].id]={total:0,eventBox:0,base:0}),n[i[r].id].total++,n[i[r].id].eventBox+=i[r].events.length,n[i[r].id].base+=i[r].events.reduce((s,l)=>s+l.events.length,0);return n}function tm(i){const t={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let e=i.length-1;e>-1;e--)t.total++,i[e].isInteractive()&&t.interactive++,i[e].isChroma()&&t.chroma++,i[e].isNoodleExtensions()&&t.noodleExtensions++,i[e].isMappingExtensions()&&t.mappingExtensions++;return t}function em(i,t){switch(t){case"LinkinParkEnvironment":switch(i){case 0:return"Lane Light";case 1:return"Ceiling Lights";case 8:return"Laser Mode"}break;case"BTSEnvironment":switch(i){case 0:return"Door Light";case 1:return"Vertical Pillar Lights";case 8:return"Distant Tower Spin";case 9:return"Raise/Lower Pillars";case 40:return"BTS Event 1";case 41:return"BTS Event 2";case 42:return"BTS Event 3";case 43:return"BTS Event 4"}break;case"KaleidoscopeEnvironment":switch(i){case 0:return"Spike Tip Lights";case 1:return"Spike Mid Lights";case 2:return"Spike Left Lights";case 3:return"Spike Right Lights";case 4:return"Distant Lasers and Spike Top Lights"}break;case"InterscopeEnvironment":switch(i){case 0:return"Gate 1";case 1:return"Gate 2";case 2:return"Gate 3";case 3:return"Gate 4";case 4:return"Gate 5";case 6:return"Extra 1";case 7:return"Extra 2"}break;case"SkrillexEnvironment":switch(i){case 0:return"Logo";case 1:return"Top Lanes and 1st Ring Set";case 4:return"Bottom Lanes and 2nd Ring Set";case 6:return"Left Panel";case 7:return"Right Panel";case 12:return"Left Laser & Panel Speed";case 13:return"Right Laser & Panel Speed"}break;case"BillieEnvironment":switch(i){case 0:return"Water 4";case 1:return"Water 1";case 2:return"Left Sun Beams";case 3:return"Right Sun Beams";case 4:return"Sun";case 6:return"Water 2";case 7:return"Water 3";case 8:return"Toggle Rain";case 9:return"Sunbeam Mode";case 10:return"Left Bottom Lasers";case 11:return"Right Bottom Lasers";case 12:return"Left Sun Beams Speed";case 13:return"Right Sun Beams Speed"}break;case"HalloweenEnvironment":switch(i){case 0:return"Sky Lasers";case 1:return"Moon";case 4:return"Lane + Castle Interior"}break;case"GagaEnvironment":switch(i){case 0:return"Aurora 1";case 1:return"Aurora 2";case 2:return"Tower 1";case 3:return"Tower 2";case 4:return"Logo";case 6:return"Tower 3";case 7:return"Tower 4";case 10:return"Tower 5";case 11:return"Tower 6";case 14:return"Tower 1 Height";case 15:return"Tower 2 Height";case 16:return"Tower 3 Height";case 17:return"Tower 4 Height";case 18:return"Tower 5 Height";case 19:return"Tower 6 Height"}break;case"WeaveEnvironment":switch(i){case 4:return"Player Space"}break;case"PyroEnvironment":switch(i){case 0:return"Video Alpha";case 1:return"Logo";case 2:return"Left Projectors";case 3:return"Right Projectors";case 4:return"Platform";case 6:return"Ambient";case 40:return"Video Projection"}break;case"EDMEnvironment":switch(i){case 0:return"Lane Lights Bottom";case 1:return"Lane Lights Top";case 4:return"Player Space & Spectrogram"}break;case"TheSecondEnvironment":switch(i){case 0:return"Logo";case 1:return"Runway";case 2:return"Left Flags";case 3:return"Right Flags";case 4:return"Buildings"}break;case"LizzoEnvironment":switch(i){case 0:return"Runway Left";case 1:return"Runway Right";case 2:return"Left Ring";case 3:return"Right Ring";case 4:return"Top Square";case 6:return"Ambient";case 7:return"Cherry Left";case 8:return"Cherry Right";case 9:return"LI Sign";case 10:return"Z Left Sign";case 11:return"Z Right Sign";case 12:return"O Sign";case 16:return"Left Balloon Particles";case 17:return"Right Balloon Particles"}break;case"TheWeekndEnvironment":switch(i){case 0:return"Runway Left";case 1:return"Runway Right";case 6:return"Ambient"}break}switch(i){case 0:return"Back Lasers";case 1:return"Ring Lights";case 2:return"Left Lasers";case 3:return"Right Lasers";case 4:return"Center Lights";case 5:return"Boost Colors";case 6:return"Extra Left Lights";case 7:return"Extra Right Lights";case 8:return"Ring Rotation";case 9:return"Ring Zoom";case 10:return"Extra Left Lasers";case 11:return"Extra Right Lasers";case 12:return"Left Laser Speed";case 13:return"Right Laser Speed";case 14:return"Early Lane Rotation";case 15:return"Late Lane Rotation";case 16:return"Utility Event 1";case 17:return"Utility Event 2";case 18:return"Utility Event 3";case 19:return"Utility Event 4";case 40:return"Special Event 1";case 41:return"Special Event 2";case 42:return"Special Event 3";case 43:return"Special Event 4";default:return"Unknown"}}function im(i,t){switch(t){case"WeaveEnvironment":switch(i){case 0:return"Outer Square Bottom Left Laser";case 1:return"Outer Square Bottom Right Laser";case 2:return"Outer Square Top Left Laser";case 3:return"Outer Square Top Right Laser";case 4:return"Inner Square Bottom Left Laser";case 5:return"Inner Square Bottom Right Laser";case 6:return"Inner Square Top Left Laser";case 7:return"Inner Square Top Right Laser";case 8:return"Side Square Bottom Left Laser";case 9:return"Side Square Bottom Right Laser";case 10:return"Side Square Top Left Laser";case 11:return"Side Square Top Right Laser";case 12:return"Distant Square Top Laser";case 13:return"Distant Square Bottom Laser";case 14:return"Distant Square Left Laser";case 15:return"Distant Square Right Laser"}case"PyroEnvironment":switch(i){case 0:return"Stage Left Platform";case 1:return"Stage Right Platform";case 2:return"Top Stage Left Laser";case 3:return"Top Stage Right Laser";case 4:return"Top Stage Middle Laser";case 5:return"Top Stage Light";case 6:return"Side Panels Left Tower";case 7:return"Side Panels Right Tower";case 8:return"Stage Left Laser";case 9:return"Stage Right Laser";case 10:return"Side Panels Left Laser";case 11:return"Side Panels Right Laser";case 12:return"Fire Left";case 13:return"Fire Right"}case"EDMEnvironment":switch(i){case 0:return"Circles Top";case 1:return"Circles Close";case 2:return"Circles Distant";case 3:return"Circles Distant 2";case 4:return"Single Source Circles Left";case 5:return"Single Source Circles Right";case 6:return"Single Source Lasers Left (Up)";case 7:return"Single Source Lasers Left (Out)";case 8:return"Single Source Lasers Right (Up)";case 9:return"Single Source Lasers Right (Out)";case 10:return"Single Source Lasers Left (Down)";case 11:return"Single Source Lasers Right (Down)";case 12:return"Single Source Lasers Left (Down) / Circle Rotations Top";case 13:return"Single Source Lasers Right (Up) / Circle Rotations Close";case 14:return"Circle Rotations Distant";case 15:return"Circle Rotations Distant 2";case 16:return"Circle Rotations Single Source Left";case 17:return"Circle Rotations Single Source Right"}case"TheSecondEnvironment":switch(i){case 0:return"Rings Big";case 1:return"Rings Small";case 2:return"Runway Left";case 3:return"Runway Right";case 4:return"Spotlight Left";case 5:return"Spotlight Right";case 6:return"Top Lasers Left Bottom";case 7:return"Top Lasers Right Bottom";case 8:return"Top Lasers Left Top";case 9:return"Top Lasers Right Top";case 10:return"Bottom Lasers Left Bottom";case 11:return"Bottom Lasers Right Bottom";case 12:return"Bottom Lasers Left Top";case 13:return"Bottom Lasers Right Top"}case"LizzoEnvironment":switch(i){case 0:return"Main Floor";case 1:return"Rainbow Arcs Inner";case 2:return"Rainbow Arcs 2";case 3:return"Rainbow Arcs 3";case 4:return"Rainbow Arcs 4";case 5:return"Rainbow Arcs Outer";case 6:return"Rainbow Rings Left";case 7:return"Rainbow Rings Right";case 8:return"Rainbow Rings Lasers Left";case 9:return"Rainbow Rings Lasers Right";case 10:return"Main Top Lasers";case 11:return"Environment Stands Left";case 12:return"Environment Stands Right";case 13:return"Environment Clouds Left";case 14:return"Environment Clouds Right";case 15:return"Main Left Lasers";case 16:return"Main Right Lasers";case 17:return"Environment Stand Lasers Left";case 18:return"Environment Stand Lasers Right";case 19:return"Rainbow Arcs Laser"}case"TheWeekndEnvironment":switch(i){case 0:return"Lamps Poles Left";case 1:return"Lamps Poles Right";case 2:return"Lamps Rings Left";case 3:return"Lamps Rings Right";case 4:return"Environment Arrows";case 5:return"Environment Side Lasers Left";case 6:return"Environment Side Lasers Right";case 7:return"Environment Runway Lane";case 8:return"Environment Center Ring";case 9:return"Environment Center Ring Lasers";case 10:return"Windows Left 1 Front";case 11:return"Windows Left 1 Side";case 12:return"Windows Left 2 Side";case 13:return"Windows Left 3 Front";case 14:return"Windows Left 3 Side";case 15:return"Windows Right 1 Front";case 16:return"Windows Right 1 Side";case 17:return"Windows Right 2 Side";case 18:return"Windows Right 3 Front";case 19:return"Windows Right 3 Side";case 20:return"Buildings Left";case 21:return"Buildings Right";case 22:return"Buildings Roof Left";case 23:return"Buildings Roof Right";case 29:return"Lamp Rings Left 1";case 30:return"Lamp Rings Left 2";case 31:return"Lamp Rings Left 3";case 32:return"Lamp Rings Left 4";case 33:return"Lamp Rings Right 1";case 34:return"Lamp Rings Right 2";case 35:return"Lamp Rings Right 3";case 36:return"Lamp Rings Right 4";case 37:return"Buildings Background Left";case 38:return"Buildings Background Right";case 40:return"Buildings Side Buildings"}default:return"Unknown"}}function nm(i,t){const e=t.characteristic==="360Degree"||t.characteristic==="90Degree"?i._allDirectionsEnvironmentName:i._environmentName,n=Qf(t.data.basicEvents,t.data.colorBoostEvents,e);let a=0,o=0,r=`<caption class="${k}table-caption">Events: ${Object.values(n).reduce((l,{total:u})=>l+u,0)}</caption>`;for(const l in n)a+=n[l].chroma,o+=n[l].chromaOld,r+=`<tr><th class="${k}table-header">${l}</th><th class="${k}table-header" colspan="4">${em(parseInt(l),e)}</th><td class="${k}table-element">${n[l].total}</td></tr>`;a&&(r+=`<tr><th class="${k}table-header" colspan="5">Chroma</th><td class="${k}table-element">${a}</td></tr>`),o&&(r+=`<tr><th class="${k}table-header" colspan="5">OG Chroma</th><td class="${k}table-element">${o}</td></tr>`);const s=document.createElement("table");return s.className=k+"table",s.innerHTML=r,s}function am(i,t){const e=t.characteristic==="360Degree"||t.characteristic==="90Degree"?i._allDirectionsEnvironmentName:i._environmentName,n=La(t.data.lightColorEventBoxGroups,e),a=La(t.data.lightRotationEventBoxGroups,e),o=La(t.data.lightTranslationEventBoxGroups,e);for(const h in n)a[h]||(a[h]={total:0,eventBox:0,base:0}),o[h]||(o[h]={total:0,eventBox:0,base:0});for(const h in a)n[h]||(n[h]={total:0,eventBox:0,base:0}),o[h]||(o[h]={total:0,eventBox:0,base:0});for(const h in o)a[h]||(a[h]={total:0,eventBox:0,base:0}),n[h]||(n[h]={total:0,eventBox:0,base:0});let r=`<caption class="${k}table-caption">Event Box Group:</caption><tr><th class="${k}table-header"></th><th class="${k}table-header">Group</th><th class="${k}table-header">Box</th><th class="${k}table-header">Base</th><tr><th class="${k}table-header">Color</th><td class="${k}table-element">${Object.values(n).reduce((h,{total:f})=>h+f,0)}</td><td class="${k}table-element">${Object.values(n).reduce((h,{eventBox:f})=>h+f,0)}</td><td class="${k}table-element">${Object.values(n).reduce((h,{base:f})=>h+f,0)}</td></tr><tr><th class="${k}table-header">Rotate</th><td class="${k}table-element">${Object.values(a).reduce((h,{total:f})=>h+f,0)}</td><td class="${k}table-element">${Object.values(a).reduce((h,{eventBox:f})=>h+f,0)}</td><td class="${k}table-element">${Object.values(a).reduce((h,{base:f})=>h+f,0)}</td></tr><tr><th class="${k}table-header">Translate</th><td class="${k}table-element">${Object.values(o).reduce((h,{total:f})=>h+f,0)}</td><td class="${k}table-element">${Object.values(o).reduce((h,{eventBox:f})=>h+f,0)}</td><td class="${k}table-element">${Object.values(o).reduce((h,{base:f})=>h+f,0)}</td></tr><tr><th class="${k}table-header">Total</th><td class="${k}table-element">${Object.values(n).reduce((h,{total:f})=>h+f,0)+Object.values(a).reduce((h,{total:f})=>h+f,0)+Object.values(o).reduce((h,{total:f})=>h+f,0)}</td><td class="${k}table-element">${Object.values(n).reduce((h,{eventBox:f})=>h+f,0)+Object.values(a).reduce((h,{eventBox:f})=>h+f,0)+Object.values(o).reduce((h,{eventBox:f})=>h+f,0)}</td><td class="${k}table-element">${Object.values(n).reduce((h,{base:f})=>h+f,0)+Object.values(a).reduce((h,{base:f})=>h+f,0)+Object.values(o).reduce((h,{base:f})=>h+f,0)}</td></tr>`,s=`<caption class="${k}table-caption">Event Box Group ID:</caption>`;for(const h in n)s+=`<tr><th class="${k}table-header">${h}</th><th class="${k}table-header" colspan="5">${im(parseInt(h),e)}</th><td class="${k}table-element" title="${n[h].eventBox} Box (${n[h].base} Base)">${n[h].total}</td><td class="${k}table-element" title="${a[h].eventBox} Box (${a[h].base} Base)">${a[h].total}</td><td class="${k}table-element" title="${o[h].eventBox} Box (${o[h].base} Base)">${o[h].total}</td></tr>`;const l=document.createElement("table");l.className=k+"table",l.innerHTML=r;const u=document.createElement("table");u.className=k+"table",u.innerHTML=s;const c=document.createElement("div");return c.appendChild(l),c.appendChild(document.createElement("br")),c.appendChild(u),c}const rm=115;function sm(i){let t=0,e=1;for(let n=0,a=i.filter(o=>o.type==="note"&&!(typeof o.data.customData.uninteractable<"u"||!o.data.customData.uninteractable)).length;n<a;n++)e<8&&n===-3+e*4&&(e*=2),t+=rm*e;return t}function om(i,t){const e=jn(t.data.colorNotes);let n=`<caption class="${k}table-caption">Note Information:</caption><tr><th class="${k}table-header" colspan="2">R/B Ratio</th><td class="${k}table-element">${M(e.red.total/e.blue.total,2)}</td></tr><tr><th class="${k}table-header" colspan="2">Max Score</th><td class="${k}table-element">${gu(sm(t.noteContainer))}</td></tr><tr><th class="${k}table-header" colspan="2">Effective BPM</th><td class="${k}table-element">${M(zu(t.swingAnalysis.container),2)}</td></tr><tr><th class="${k}table-header" colspan="2">Effective BPM (swing)</th><td class="${k}table-element">${M(Xu(t.swingAnalysis.container),2)}</td></tr>`,a=M(Ju(t.swingAnalysis.container)*1e3,1),o=M(qu(t.swingAnalysis.container)*1e3,1);a&&o&&(n+=`<tr><th class="${k}table-header" colspan="2">Min. Slider Speed</th><td class="${k}table-element">${a}ms</td></tr><tr><th class="${k}table-header" colspan="2">Max. Slider Speed</th><td class="${k}table-element">${o}ms</td></tr>`);const r=document.createElement("table");return r.className=k+"table",r.innerHTML=n,r}function lm(i,t){const e=jn(t.data.colorNotes),n=jn(t.data.sliders),a=jn(t.data.burstSliders),o=Wf(t.data.bombNotes);let r=`<caption class="${k}table-caption">Note Count:</caption><tr><th class="${k}table-header"></th><th class="${k}table-header">Note</th><th class="${k}table-header">Arc</th><th class="${k}table-header">Chain</th><th class="${k}table-header">Bomb</th></tr><tr><th class="${k}table-header">Total</th><td class="${k}table-element">${e.red.total+e.blue.total}</td><td class="${k}table-element">${n.red.total+n.blue.total}</td><td class="${k}table-element">${a.red.total+a.blue.total}</td><td class="${k}table-element">${o.total}</td></tr><tr><th class="${k}table-header">Red</th><td class="${k}table-element">${e.red.total}</td><td class="${k}table-element">${n.red.total}</td><td class="${k}table-element">${a.red.total}</td><td class="${k}table-element">0</td></tr><tr><th class="${k}table-header">Blue</th><td class="${k}table-element">${e.blue.total}</td><td class="${k}table-element">${n.blue.total}</td><td class="${k}table-element">${a.blue.total}</td><td class="${k}table-element">0</td></tr>`;(e.red.chroma||e.blue.chroma||n.red.chroma||n.blue.chroma||a.red.chroma||a.blue.chroma||o.chroma)&&(r+=`<tr><th class="${k}table-header">Chroma</th><td class="${k}table-element">${e.red.chroma+e.blue.chroma}</td><td class="${k}table-element">${n.red.chroma+n.blue.chroma}</td><td class="${k}table-element">${a.red.chroma+a.blue.chroma}</td><td class="${k}table-element">${o.chroma}</td></tr>`),(e.red.noodleExtensions||e.blue.noodleExtensions||n.red.noodleExtensions||n.blue.noodleExtensions||a.red.noodleExtensions||a.blue.noodleExtensions||o.noodleExtensions)&&(r+=`<tr><th class="${k}table-header">NE</th><td class="${k}table-element">${e.red.noodleExtensions+e.blue.noodleExtensions}</td><td class="${k}table-element">${n.red.noodleExtensions+n.blue.noodleExtensions}</td><td class="${k}table-element">${a.red.noodleExtensions+a.blue.noodleExtensions}</td><td class="${k}table-element">${o.noodleExtensions}</td></tr></tr>`),(e.red.mappingExtensions||e.blue.mappingExtensions||n.red.mappingExtensions||n.blue.mappingExtensions||a.red.mappingExtensions||a.blue.mappingExtensions||o.mappingExtensions)&&(r+=`<tr><th class="${k}table-header">ME</th><td class="${k}table-element">${e.red.mappingExtensions+e.blue.mappingExtensions}</td><td class="${k}table-element">${n.red.mappingExtensions+n.blue.mappingExtensions}</td><td class="${k}table-element">${a.red.mappingExtensions+a.blue.mappingExtensions}</td><td class="${k}table-element">${o.mappingExtensions}</td></tr></tr>`);const s=document.createElement("table");return s.className=k+"table",s.innerHTML=r,s}function cm(i){var l;const t=i.target,e=t.id.replace(`${k}table-select-placement-`,"").split("-"),n=e[0],a=e[1],o=(l=lt.beatmapDifficulty.find(u=>u.characteristic===n&&u.difficulty===a))==null?void 0:l.noteContainer;if(!o){console.error(wi+"note could not be found");return}const r=tu(o,t.value),s=document.querySelector(`#${k}table-placement-${n}-${a}`);if(!s){console.error(wi+"table could not be found");return}s.innerHTML=iu(r)}function iu(i){const t=i.length||1;let e="";for(let n=2;n>=0;n--){e+="<tr>";for(let a=0;a<=3;a++)e+=`<td class="${k}table-element">${Jf(i,a,n)}</td>`;e+=`<td class="${k}table-element ${k}table--no-border">${M(Vf(i,n)/t*100,1)}%</td>
        </tr>`}return e+=`<tr><td class="${k}table-element ${k}table--no-border">${M(kn(i,0)/t*100,1)}%</td><td class="${k}table-element ${k}table--no-border">${M(kn(i,1)/t*100,1)}%</td><td class="${k}table-element ${k}table--no-border">${M(kn(i,2)/t*100,1)}%</td><td class="${k}table-element ${k}table--no-border">${M(kn(i,3)/t*100,1)}%</td></tr>`,e}function um(i,t){var o;const e=yn.create(`${k}table-select-placement-${t.characteristic}-${t.difficulty}`,"Note Placement: ","caption",`${k}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"},{text:"Bomb",value:"bomb"});(o=e.querySelector("select"))==null||o.addEventListener("change",cm);let n=`<tbody id="${k}table-placement-${t.characteristic}-${t.difficulty}">${iu(t.noteContainer)}</tbody>`;const a=document.createElement("table");return a.className=k+"table",a.innerHTML=n,a.prepend(e),a}function hm(i,t){const e=tm(t.data.obstacles);let n=`<caption class="${k}table-caption">Obstacles: ${e.total}</caption>`;e.interactive&&(n+=`<tr><th class="${k}table-header" colspan="2">Interactive</th><td class="${k}table-element">${e.interactive}</td></tr>`),e.chroma&&(n+=`<tr><th class="${k}table-header" colspan="2">Chroma</th><td class="${k}table-element">${e.chroma}</td></tr>`),e.noodleExtensions&&(n+=`<tr><th class="${k}table-header" colspan="2">Noodle Extensions</th><td class="${k}table-element">${e.noodleExtensions}</td></tr>`),e.mappingExtensions&&(n+=`<tr><th class="${k}table-header" colspan="2">Mapping Extensions</th><td class="${k}table-element">${e.mappingExtensions}</td></tr>`);const a=document.createElement("table");return a.className=k+"table",a.innerHTML=n,a}const Yn=document.querySelector("#stats .accordion__collapsible");function dm(){if(!lt.beatmapInfo)throw new Error(wi+"map info could not be found in savedData");const i=lt.beatmapInfo;i._difficultyBeatmapSets.forEach(t=>{var a,o;const e=document.createElement("div");e.className=k+"mode-"+t._beatmapCharacteristicName;const n=document.createElement("div");n.className=k+"title",n.textContent=xr[t._beatmapCharacteristicName],e.appendChild(n);for(let r=t._difficultyBeatmaps.length-1;r>=0;r--){const s=t._difficultyBeatmaps[r],l=lt.beatmapDifficulty.find(g=>g.characteristic===t._beatmapCharacteristicName&&g.difficulty===s._difficulty);if(!l)throw new Error(wi+"Could not find map data");const u=Yo.create(`${k}${t._beatmapCharacteristicName}-${s._difficulty}`,be[s._difficulty]+((a=s._customData)!=null&&a._difficultyLabel?" -- "+((o=s._customData)==null?void 0:o._difficultyLabel):""),s._difficulty,!0),c=u.querySelector(".accordion__collapsible-flex"),h=u.querySelector(".accordion__button");if(!c||!h)throw new Error(wi+"something went wrong!");h.checked=it.onLoad.stats;const f=sn.create("small","half"),d=sn.create("small","half"),m=sn.create("small","half");f.append(Uf(i,l)),f.append(document.createElement("br")),f.append(Yf(i,l)),f.append(document.createElement("br")),f.append(Gf(i,l)),d.append(om(i,l)),d.append(document.createElement("br")),d.append(lm(i,l)),d.append(document.createElement("br")),d.append(um(i,l)),d.append(document.createElement("br")),d.append(Kf(i,l)),m.append(nm(i,l)),m.append(document.createElement("br")),m.append(am(i,l)),m.append(document.createElement("br")),m.append(hm(i,l)),c.appendChild(f),c.appendChild(d),c.appendChild(m),e.appendChild(u)}Yn.appendChild(e)})}function fm(){for(;Yn.firstChild;)Yn.removeChild(Yn.firstChild)}function Oo(i){var e,n,a,o,r,s,l,u,c,h,f,d,m,g;if(!i)return{};const t=bt(i);return Object.keys(t).length?((e=t.color)!=null||(t.color=t._color),(n=t.coordinates)!=null||(t.coordinates=t._position),(a=t.disableNoteGravity)!=null||(t.disableNoteGravity=t._disableNoteGravity),(o=t.disableNoteLook)!=null||(t.disableNoteLook=t._disableNoteLook),(r=t.flip)!=null||(t.flip=t._flip),(s=t.localRotation)!=null||(t.localRotation=t._localRotation),(l=t.noteJumpMovementSpeed)!=null||(t.noteJumpMovementSpeed=t._noteJumpMovementSpeed),(u=t.noteJumpStartBeatOffset)!=null||(t.noteJumpStartBeatOffset=t._noteJumpStartBeatOffset),(c=t.spawnEffect)!=null||(t.spawnEffect=typeof t._disableSpawnEffect=="boolean"?!t._disableSpawnEffect:void 0),(h=t.size)!=null||(t.size=t._scale),(f=t.track)!=null||(t.track=t._track),(d=t.uninteractable)!=null||(t.uninteractable=typeof t._interactable=="boolean"?!t._interactable:void 0),(m=t.worldRotation)!=null||(t.worldRotation=t._rotation),t._animation&&((g=t.animation)!=null||(t.animation={color:t._animation._color,definitePosition:t._animation._definitePosition,dissolve:t._animation._dissolve,dissolveArrow:t._animation._dissolveArrow,interactable:t._animation._interactable,localRotation:t._animation._localRotation,offsetPosition:t._animation._position,offsetRotation:t._animation._rotation,scale:t._animation._scale,time:t._animation._time})),delete t._color,delete t._position,delete t._disableNoteGravity,delete t._disableNoteLook,delete t._flip,delete t._cutDirection,delete t._localRotation,delete t._noteJumpMovementSpeed,delete t._noteJumpStartBeatOffset,delete t._disableSpawnEffect,delete t._scale,delete t._track,delete t._interactable,delete t._rotation,delete t._animation,t):{}}function mm(i){var n,a,o,r,s,l,u,c,h,f,d,m;if(!i)return{};const t=bt(i);if(!Object.keys(t).length)return{};const e=(n=t._preciseSpeed)!=null?n:t._speed;return(a=t.color)!=null||(t.color=t._color),(o=t.lightID)!=null||(t.lightID=t._lightID),(r=t.easing)!=null||(t.easing=t._easing),(s=t.lerpType)!=null||(t.lerpType=t._lerpType),(l=t.nameFilter)!=null||(t.nameFilter=t._nameFilter),(u=t.rotation)!=null||(t.rotation=t._rotation),(c=t.step)!=null||(t.step=t._step),(h=t.prop)!=null||(t.prop=t._prop),(f=t.speed)!=null||(t.speed=e),(d=t.direction)!=null||(t.direction=t._direction),(m=t.lockRotation)!=null||(t.lockRotation=t._lockPosition),delete t._color,delete t._lightID,delete t._easing,delete t._lerpType,delete t._propID,delete t._lightGradient,delete t._nameFilter,delete t._rotation,delete t._step,delete t._prop,delete t._speed,delete t._preciseSpeed,delete t._direction,delete t._reset,delete t._counterSpin,delete t._stepMult,delete t._propMult,delete t._speedMult,delete t._lockPosition,t}const de=i=>`[convert::${i}]`;function pm(i,t){var n,a,o,r,s,l;if(t)et.warn(de("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!");else{if(et.warn(de("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!"),prompt("Proceed with conversion? (y/N):","n")[0].toLowerCase()!=="y")throw Error("Conversion to beatmap v3 denied.");et.info(de("V2toV3"),"Converting beatmap v2 to v3")}const e=$c.create();if(e.fileName=i.fileName,e.customData.fakeBombNotes=[],e.customData.fakeColorNotes=[],e.customData.fakeObstacles=[],i.colorNotes.forEach((u,c)=>{const h=Oo(u.customData);if(typeof u.customData._cutDirection=="number"&&et.debug(de("V2toV3"),`notes[${c}] at time ${u.time} NE _cutDirection will be converted.`),u.isBomb()&&(u.customData._fake?e.customData.fakeBombNotes.push(qe.create({b:u.time,x:u.posX,y:u.posY,customData:h})[0].toJSON()):e.bombNotes.push(qe.create({b:u.time,x:u.posX,y:u.posY,customData:h})[0])),u.isNote()){let f=0;typeof u.customData._cutDirection=="number"?f=u.customData._cutDirection>0?u.customData._cutDirection%360:360+u.customData._cutDirection%360:u.direction>=1e3&&(f=Math.abs(u.direction%1e3%360-360)),u.customData._fake?e.customData.fakeColorNotes.push(Ie.create({b:u.time,c:u.type,x:u.posX,y:u.posY,d:u.direction>=1e3||typeof u.customData._cutDirection=="number"?u.direction===8?8:1:Wr(u.direction,0,8),a:f,customData:h})[0].toJSON()):e.colorNotes.push(Ie.create({b:u.time,c:u.type,x:u.posX,y:u.posY,d:u.direction>=1e3||typeof u.customData._cutDirection=="number"?u.direction===8?8:1:Wr(u.direction,0,8),a:f,customData:h})[0])}}),i.obstacles.forEach(u=>{const c=Oo(u.customData);u.customData._fake?e.customData.fakeObstacles.push(Vt.create({b:u.time,x:u.posX,y:u.type===2?u.posY:u.type?2:0,d:u.duration,w:u.width,h:u.type===2?u.height:u.type?3:5,customData:c})[0].toJSON()):e.obstacles.push(Vt.create({b:u.time,x:u.posX,y:u.type===2?u.posY:u.type?2:0,d:u.duration,w:u.width,h:u.type===2?u.height:u.type?3:5,customData:c})[0])}),i.basicEvents.forEach((u,c)=>{var h;if(u.isColorBoost())e.colorBoostEvents.push(bi.create({b:u.time,o:!!u.value})[0]);else if(u.isLaneRotationEvent())e.rotationEvents.push(yi.create({b:u.time,e:u.type===14?0:1,r:typeof u.customData._rotation=="number"?u.customData._rotation:u.value>=1e3?(u.value-1360)%360:(h=Yu[u.value])!=null?h:0})[0]);else if(u.isBPMChangeEvent())e.bpmEvents.push(_i.create({b:u.time,m:u.floatValue})[0]);else{const f=mm(u.customData);u.isLightEvent()&&(u.customData._propID&&et.warn(de("V2toV3"),`events[${c}] at time ${u.time} Chroma _propID will be removed.`),u.customData._lightGradient&&et.warn(de("V2toV3"),`events[${c}] at time ${u.time} Chroma _lightGradient will be removed.`)),u.isRingEvent()&&(u.customData._reset&&et.warn(de("V2toV3"),`events[${c}] at time ${u.time} Chroma _reset will be removed.`),u.customData._counterSpin&&et.warn(de("V2toV3"),`events[${c}] at time ${u.time} Chroma _counterSpin will be removed.`),(u.customData._stepMult||u.customData._propMult||u.customData._speedMult)&&et.warn(de("V2toV3"),`events[${c}] at time ${u.time} Chroma _mult will be removed.`)),e.basicEvents.push(gi.create({b:u.time,et:u.type,i:u.value,f:u.floatValue,customData:f})[0])}}),i.waypoints.forEach(u=>{e.waypoints.push(Ei.create({b:u.time,x:u.posX,y:u.posY,d:u.direction})[0])}),i.sliders.forEach(u=>e.sliders.push(vi.create({c:u.color,b:u.time,x:u.posX,y:u.posY,d:u.direction,mu:u.lengthMultiplier,tb:u.tailTime,tx:u.tailPosX,ty:u.tailPosY,tc:u.tailDirection,tmu:u.tailLengthMultiplier,m:u.midAnchor})[0])),e.eventTypesWithKeywords=cn.create({d:(o=(a=(n=i.eventTypesWithKeywords)==null?void 0:n.list)==null?void 0:a.map(u=>({k:u.keyword,e:u.events})))!=null?o:[]}),i.customData)for(const u in i.customData){if(u==="_customEvents"){e.customData.customEvents=[],i.customData._customEvents.forEach(c=>{var h,f,d,m,g;c._type==="AnimateTrack"&&((h=e.customData.customEvents)==null||h.push({b:c._time,t:"AnimateTrack",d:{track:c._data._track,duration:c._data._duration,easing:c._data._easing,position:c._data._position,rotation:c._data._rotation,localRotation:c._data._localRotation,scale:c._data._scale,dissolve:c._data._dissolve,dissolveArrow:c._data._dissolveArrow,color:c._data._color,interactable:c._data._interactable,time:c._data._time}})),c._type==="AssignPathAnimation"&&((f=e.customData.customEvents)==null||f.push({b:c._time,t:"AssignPathAnimation",d:{track:c._data._track,easing:c._data._easing,position:c._data._position,rotation:c._data._rotation,localRotation:c._data._localRotation,scale:c._data._scale,dissolve:c._data._dissolve,dissolveArrow:c._data._dissolveArrow,color:c._data._color,interactable:c._data._interactable,definitePosition:c._data._definitePosition}})),c._type==="AssignTrackParent"&&((d=e.customData.customEvents)==null||d.push({b:c._time,t:"AssignTrackParent",d:{childrenTracks:c._data._childrenTracks,parentTrack:c._data._parentTrack,worldPositionStays:c._data._worldPositionStays}})),c._type==="AssignPlayerToTrack"&&((m=e.customData.customEvents)==null||m.push({b:c._time,t:"AssignPlayerToTrack",d:{track:c._data._track,playerTrackObject:c._data._playerTrackObject}})),c._type==="AssignFogTrack"&&((g=e.customData.customEvents)==null||g.push({b:c._time,t:"AnimateComponent",d:{track:c._data._track,duration:c._data._duration||0,BloomFogEnvironment:{attenuation:typeof c._data._attenuation=="number"?[[c._data._attenuation,0]]:c._data._attenuation,height:typeof c._data._height=="number"?[[c._data._height,0]]:c._data._height,offset:typeof c._data._offset=="number"?[[c._data._offset,0]]:c._data._offset,startY:typeof c._data._startY=="number"?[[c._data._startY,0]]:c._data._startY}}}))});continue}if(u==="_environment"){e.customData.environment=i.customData._environment.map(c=>{var f,d,m,g;let h={};if(c._lightID&&(h={ILightWithId:{lightID:c._lightID}}),c._id&&c._lookupMethod)return{id:c._id,lookupMethod:c._lookupMethod,track:c._track,duplicate:c._duplicate,active:c._active,scale:c._scale,position:(f=c._position)==null?void 0:f.map(_=>_*.6),rotation:c._rotation,localPosition:(d=c._localPosition)==null?void 0:d.map(_=>_*.6),localRotation:c._localRotation,components:h};if(c._geometry)return c._lightID&&h.ILightWithId&&(h.ILightWithId.type=0),{geometry:c._geometry._type==="CUSTOM"?{type:c._geometry._type,mesh:{vertices:c._geometry._mesh._vertices,uv:c._geometry._mesh._uv,triangles:c._geometry._mesh._triangles},material:typeof c._geometry._material=="string"?c._geometry._material:{shader:c._geometry._material._shader,shaderKeywords:c._geometry._material._shaderKeywords,collision:c._geometry._material._collision,track:c._geometry._material._track,color:c._geometry._material._color},collision:c._geometry._collision}:{type:c._geometry._type,material:typeof c._geometry._material=="string"?c._geometry._material:{shader:c._geometry._material._shader,shaderKeywords:c._geometry._material._shaderKeywords,collision:c._geometry._material._collision,track:c._geometry._material._track,color:c._geometry._material._color},collision:c._geometry._collision},track:c._track,duplicate:c._duplicate,active:c._active,scale:c._scale,position:(m=c._position)==null?void 0:m.map(_=>_*.6),rotation:c._rotation,localPosition:(g=c._localPosition)==null?void 0:g.map(_=>_*.6),localRotation:c._localRotation,components:h};throw new Error("Error converting environment v2 to v3")});continue}if(u==="_materials"){e.customData.materials={};for(const c in i.customData._materials)e.customData.materials[c]={shader:i.customData._materials[c]._shader,shaderKeywords:i.customData._materials[c]._shaderKeywords,collision:i.customData._materials[c]._collision,track:i.customData._materials[c]._track,color:i.customData._materials[c]._color};continue}if(u==="_pointDefinitions"){e.customData.pointDefinitions={},i.customData._pointDefinitions.forEach(c=>{e.customData.pointDefinitions[c._name]=c._points});continue}if(u==="_time"){e.customData.time=i.customData[u];continue}if(u==="_BPMChanges"){e.customData.BPMChanges=(r=i.customData[u])==null?void 0:r.map(c=>({b:c._time,m:c._BPM,p:c._beatsPerBar,o:c._metronomeOffset}));continue}if(u==="_bpmChanges"){e.customData.BPMChanges=(s=i.customData[u])==null?void 0:s.map(c=>({b:c._time,m:c._bpm,p:c._beatsPerBar,o:c._metronomeOffset}));continue}if(u==="_bookmarks"){e.customData.bookmarks=(l=i.customData._bookmarks)==null?void 0:l.map(c=>({b:c._time,n:c._name,c:c._color}));continue}e.customData[u]=i.customData[u]}if(e.customData.environment){const u=[];for(const h of e.customData.environment)h.track&&u.push(h.track);const c=[];if(e.customData.customEvents){for(const h of e.customData.customEvents)if(h.t==="AnimateTrack"){if(typeof h.d.track=="string"&&u.includes(h.d.track))c.push(h);else if(Array.isArray(h.d.track)){for(const f of h.d.track)if(u.includes(f)){c.push(h);break}}}}for(const h of c)typeof h.d.track=="string"?typeof h.d.position=="string"?et.warn(de("V2toV3"),"Cannot convert point definitions, unknown use."):Array.isArray(h.d.position)&&h.d.position.forEach(f=>{f[0]*=.6,f[1]*=.6,f[2]*=.6}):et.warn(de("V2toV3"),"Environment animate track array conversion not yet implemented.")}return e.useNormalEventsAsCompatibleEvents=!0,e}const rn=i=>`[load::${i}]`;async function gm(i){const t=i.file("Info.dat")||i.file("info.dat");if(!t)throw new Error("Couldn't find Info.dat");return et.info(rn("loadInfo"),"loading info"),Fd(JSON.parse(await t.async("string")))}async function _m(i,t){var a,o,r,s,l,u;const e=[],n=i._difficultyBeatmapSets;for(let c=n.length-1;c>=0;c--){const h=n[c]._difficultyBeatmaps;if(h.length===0||!h){et.error(rn("loadDifficulty"),"Empty difficulty set, removing..."),n.splice(c,1);continue}for(let f=0;f<h.length;f++){const d=h[f],m=t.file(d._beatmapFilename);if(m){et.info(rn("loadDifficulty"),`Loading ${n[c]._beatmapCharacteristicName} ${d._difficulty}`);let g;try{g=JSON.parse(await m.async("string"))}catch(_){throw new Error(`${n[c]._beatmapCharacteristicName} ${d._difficulty} ${_}`)}try{if(g._notes&&g.version&&et.error(rn("loadDifficulty"),`${n[c]._beatmapCharacteristicName} ${d._difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`),g.version){const _=bf(g),y=ye.create(i._beatsPerMinute,[...(a=_.customData.BPMChanges)!=null?a:[],..._.bpmEvents.map(v=>v.toJSON())],(o=d._customData)==null?void 0:o._editorOffset);e.push({info:d,characteristic:n[c]._beatmapCharacteristicName,difficulty:d._difficulty,bpm:y,data:_,noteContainer:_.getNoteContainer(),eventContainer:_.getEventContainer(),swingAnalysis:ls(_,y,n[c]._beatmapCharacteristicName,d._difficulty),rawVersion:3,rawData:g})}else{const _=pm(Vd(g),!0),y=ye.create(i._beatsPerMinute,(l=(r=g._customData)==null?void 0:r._BPMChanges)!=null?l:(s=g._customData)==null?void 0:s._bpmChanges,(u=d._customData)==null?void 0:u._editorOffset);e.push({info:d,characteristic:n[c]._beatmapCharacteristicName,difficulty:d._difficulty,bpm:y,data:_,noteContainer:_.getNoteContainer(),eventContainer:_.getEventContainer(),swingAnalysis:ls(_,y,n[c]._beatmapCharacteristicName,d._difficulty),rawVersion:2,rawData:g})}}catch(_){throw new Error(`${n[c]._beatmapCharacteristicName} ${d._difficulty} ${_}`)}}else if(et.error(rn("loadDifficulty"),`Missing ${d._beatmapFilename} file for ${n[c]._beatmapCharacteristicName} ${d._difficulty}, ignoring.`),n[c]._difficultyBeatmaps.splice(f,1),f--,n[c]._difficultyBeatmaps.length<1){et.error(`${n[c]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),n.splice(c,1);continue}}}return e}async function nu(i){return new Promise(function(t,e){const n=new XMLHttpRequest;n.open("GET",i,!0),n.responseType="json",n.timeout=5e3;let a=Date.now();n.onprogress=()=>{n.timeout+=Date.now()-a},n.onload=()=>{n.status===200&&t(n.response),n.status===404&&e("Error 404: Map does not exist"),n.status===403&&e("Error 403: Forbidden"),e(`Error ${n.status}`)},n.onerror=()=>{e("Error downloading")},n.ontimeout=()=>{e("Connection timeout")},n.send()})}async function bm(i){const t=`https://api.beatsaver.com/maps/id/${i}`,e=await nu(t);if(e!=null&&e.versions.length)return e.versions[e.versions.length-1].downloadURL;throw new Error("could not find map download link")}async function ym(i){const t=`https://api.beatsaver.com/maps/hash/${i}`,e=await nu(t);if(e!=null&&e.versions.length)return e.versions[e.versions.length-1].downloadURL;throw new Error("could not find map download link")}const _n=i=>`[download::${i}]`;async function Ar(i){return new Promise(function(t,e){const n=new XMLHttpRequest;n.open("GET",i,!0),n.responseType="arraybuffer",n.timeout=5e3;let a=Date.now();n.onprogress=o=>{n.timeout+=Date.now()-a,wt.status("download",`Downloading map: ${M(o.loaded/1024/1024,1)}MB / ${M(o.total/1024/1024,1)}MB`,o.loaded/o.total*100)},n.onload=()=>{n.status===200&&t(n.response),n.status===404&&e("Error 404: Map/link does not exist"),n.status===403&&e("Error 403: Forbidden"),e(`Error ${n.status}`)},n.onerror=()=>{e("Error downloading")},n.ontimeout=()=>{e("Connection timeout")},n.send()})}async function au(i){const t=Wo(i);et.info(_n("downloadFromID"),`fetching download URL from BeatSaver for map ID ${t}`),wt.status("info","Fetching download URL from BeatSaver",0);const e=await bm(t);et.info(_n("downloadFromID"),`downloading from BeatSaver for map ID ${t}`),wt.status("info","Requesting download from BeatSaver",0);const n=await Ar(e);return Xt.setCoverLink("https://beatsaver.com/maps/"+t,t),n}async function vm(i){const t=Go(i);if(t.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return au(t.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);wt.status("info","Requesting download from link",0),et.info(_n("downloadFromURL"),`downloading from ${t}`);let e=await Ar("https://cors.bsmg.dev/"+t);return Xt.setCoverLink(t),e}async function Em(i){let t;if(Uo(i.trim()))t=i.trim();else throw new Error("invalid hash");et.info(_n("downloadFromHash"),`fetching download URL from BeatSaver for map hash ${t}`),wt.status("info","Fetching download URL from BeatSaver",0);const e=await ym(t);return et.info(_n("downloadFromHash"),`downloading from BeatSaver for map hash ${t}`),wt.status("info","Requesting download from BeatSaver",0),await Ar(e)}var xn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rn(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ru={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,t){(function(e){i.exports=e()})(function(){return function e(n,a,o){function r(u,c){if(!a[u]){if(!n[u]){var h=typeof Rn=="function"&&Rn;if(!c&&h)return h(u,!0);if(s)return s(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var d=a[u]={exports:{}};n[u][0].call(d.exports,function(m){var g=n[u][1][m];return r(g||m)},d,d.exports,e,n,a,o)}return a[u].exports}for(var s=typeof Rn=="function"&&Rn,l=0;l<o.length;l++)r(o[l]);return r}({1:[function(e,n,a){var o=e("./utils"),r=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(l){for(var u,c,h,f,d,m,g,_=[],y=0,v=l.length,w=v,T=o.getTypeOf(l)!=="string";y<l.length;)w=v-y,h=T?(u=l[y++],c=y<v?l[y++]:0,y<v?l[y++]:0):(u=l.charCodeAt(y++),c=y<v?l.charCodeAt(y++):0,y<v?l.charCodeAt(y++):0),f=u>>2,d=(3&u)<<4|c>>4,m=1<w?(15&c)<<2|h>>6:64,g=2<w?63&h:64,_.push(s.charAt(f)+s.charAt(d)+s.charAt(m)+s.charAt(g));return _.join("")},a.decode=function(l){var u,c,h,f,d,m,g=0,_=0,y="data:";if(l.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===s.charAt(64)&&w--,l.charAt(l.length-2)===s.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=r.uint8array?new Uint8Array(0|w):new Array(0|w);g<l.length;)u=s.indexOf(l.charAt(g++))<<2|(f=s.indexOf(l.charAt(g++)))>>4,c=(15&f)<<4|(d=s.indexOf(l.charAt(g++)))>>2,h=(3&d)<<6|(m=s.indexOf(l.charAt(g++))),v[_++]=u,d!==64&&(v[_++]=c),m!==64&&(v[_++]=h);return v}},{"./support":30,"./utils":32}],2:[function(e,n,a){var o=e("./external"),r=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function u(c,h,f,d,m){this.compressedSize=c,this.uncompressedSize=h,this.crc32=f,this.compression=d,this.compressedContent=m}u.prototype={getContentWorker:function(){var c=new r(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),h=this;return c.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),c},getCompressedWorker:function(){return new r(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(c,h,f){return c.pipe(new s).pipe(new l("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",h)},n.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,a){var o=e("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},a.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,a){var o=e("./utils"),r=function(){for(var s,l=[],u=0;u<256;u++){s=u;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;l[u]=s}return l}();n.exports=function(s,l){return s!==void 0&&s.length?o.getTypeOf(s)!=="string"?function(u,c,h,f){var d=r,m=f+h;u^=-1;for(var g=f;g<m;g++)u=u>>>8^d[255&(u^c[g])];return-1^u}(0|l,s,s.length,0):function(u,c,h,f){var d=r,m=f+h;u^=-1;for(var g=f;g<m;g++)u=u>>>8^d[255&(u^c.charCodeAt(g))];return-1^u}(0|l,s,s.length,0):0}},{"./utils":32}],5:[function(e,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(e,n,a){var o=null;o=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:o}},{lie:37}],7:[function(e,n,a){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=e("pako"),s=e("./utils"),l=e("./stream/GenericWorker"),u=o?"uint8array":"array";function c(h,f){l.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}a.magic="\b\0",s.inherits(c,l),c.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(u,h.data),!1)},c.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},c.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},c.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},a.compressWorker=function(h){return new c("Deflate",h)},a.uncompressWorker=function(){return new c("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,a){function o(d,m){var g,_="";for(g=0;g<m;g++)_+=String.fromCharCode(255&d),d>>>=8;return _}function r(d,m,g,_,y,v){var w,T,L=d.file,F=d.compression,A=v!==u.utf8encode,x=s.transformTo("string",v(L.name)),N=s.transformTo("string",u.utf8encode(L.name)),U=L.comment,tt=s.transformTo("string",v(U)),S=s.transformTo("string",u.utf8encode(U)),P=N.length!==L.name.length,b=S.length!==U.length,H="",Z="",G="",ut=L.dir,W=L.date,st={crc32:0,compressedSize:0,uncompressedSize:0};m&&!g||(st.crc32=d.crc32,st.compressedSize=d.compressedSize,st.uncompressedSize=d.uncompressedSize);var B=0;m&&(B|=8),A||!P&&!b||(B|=2048);var I=0,rt=0;ut&&(I|=16),y==="UNIX"?(rt=798,I|=function(q,Rt){var Pt=q;return q||(Pt=Rt?16893:33204),(65535&Pt)<<16}(L.unixPermissions,ut)):(rt=20,I|=function(q){return 63&(q||0)}(L.dosPermissions)),w=W.getUTCHours(),w<<=6,w|=W.getUTCMinutes(),w<<=5,w|=W.getUTCSeconds()/2,T=W.getUTCFullYear()-1980,T<<=4,T|=W.getUTCMonth()+1,T<<=5,T|=W.getUTCDate(),P&&(Z=o(1,1)+o(c(x),4)+N,H+="up"+o(Z.length,2)+Z),b&&(G=o(1,1)+o(c(tt),4)+S,H+="uc"+o(G.length,2)+G);var K="";return K+=`
\0`,K+=o(B,2),K+=F.magic,K+=o(w,2),K+=o(T,2),K+=o(st.crc32,4),K+=o(st.compressedSize,4),K+=o(st.uncompressedSize,4),K+=o(x.length,2),K+=o(H.length,2),{fileRecord:h.LOCAL_FILE_HEADER+K+x+H,dirRecord:h.CENTRAL_FILE_HEADER+o(rt,2)+K+o(tt.length,2)+"\0\0\0\0"+o(I,4)+o(_,4)+x+H+tt}}var s=e("../utils"),l=e("../stream/GenericWorker"),u=e("../utf8"),c=e("../crc32"),h=e("../signature");function f(d,m,g,_){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=g,this.encodeFileName=_,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(f,l),f.prototype.push=function(d){var m=d.meta.percent||0,g=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:g?(m+100*(g-_-1))/g:100}}))},f.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var m=this.streamFiles&&!d.file.dir;if(m){var g=r(d,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(d){this.accumulate=!1;var m=this.streamFiles&&!d.file.dir,g=r(d,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),m)this.push({data:function(_){return h.DATA_DESCRIPTOR+o(_.crc32,4)+o(_.compressedSize,4)+o(_.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var d=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var g=this.bytesWritten-d,_=function(y,v,w,T,L){var F=s.transformTo("string",L(T));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(y,2)+o(y,2)+o(v,4)+o(w,4)+o(F.length,2)+F}(this.dirRecords.length,g,d,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(d){this._sources.push(d);var m=this;return d.on("data",function(g){m.processChunk(g)}),d.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),d.on("error",function(g){m.error(g)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(d){var m=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var g=0;g<m.length;g++)try{m[g].error(d)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,m=0;m<d.length;m++)d[m].lock()},n.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,a){var o=e("../compressions"),r=e("./ZipFileWorker");a.generateWorker=function(s,l,u){var c=new r(l.streamFiles,u,l.platform,l.encodeFileName),h=0;try{s.forEach(function(f,d){h++;var m=function(v,w){var T=v||w,L=o[T];if(!L)throw new Error(T+" is not a valid compression method !");return L}(d.options.compression,l.compression),g=d.options.compressionOptions||l.compressionOptions||{},_=d.dir,y=d.date;d._compressWorker(m,g).withStreamInfo("file",{name:f,dir:_,date:y,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(c)}),c.entriesCount=h}catch(f){c.error(f)}return c}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,a){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new o;for(var s in this)typeof this[s]!="function"&&(r[s]=this[s]);return r}}(o.prototype=e("./object")).loadAsync=e("./load"),o.support=e("./support"),o.defaults=e("./defaults"),o.version="3.10.1",o.loadAsync=function(r,s){return new o().loadAsync(r,s)},o.external=e("./external"),n.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,a){var o=e("./utils"),r=e("./external"),s=e("./utf8"),l=e("./zipEntries"),u=e("./stream/Crc32Probe"),c=e("./nodejsUtils");function h(f){return new r.Promise(function(d,m){var g=f.decompressed.getContentWorker().pipe(new u);g.on("error",function(_){m(_)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}n.exports=function(f,d){var m=this;return d=o.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),c.isNode&&c.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",f,!0,d.optimizedBinaryString,d.base64).then(function(g){var _=new l(d);return _.load(g),_}).then(function(g){var _=[r.Promise.resolve(g)],y=g.files;if(d.checkCRC32)for(var v=0;v<y.length;v++)_.push(h(y[v]));return r.Promise.all(_)}).then(function(g){for(var _=g.shift(),y=_.files,v=0;v<y.length;v++){var w=y[v],T=w.fileNameStr,L=o.resolve(w.fileNameStr);m.file(L,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:d.createFolders}),w.dir||(m.file(L).unsafeOriginalName=T)}return _.zipComment.length&&(m.comment=_.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,a){var o=e("../utils"),r=e("../stream/GenericWorker");function s(l,u){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}o.inherits(s,r),s.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(c){u.push({data:c,meta:{percent:0}})}).on("error",function(c){u.isPaused?this.generatedError=c:u.error(c)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},s.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,a){var o=e("readable-stream").Readable;function r(s,l,u){o.call(this,l),this._helper=s;var c=this;s.on("data",function(h,f){c.push(h)||c._helper.pause(),u&&u(f)}).on("error",function(h){c.emit("error",h)}).on("end",function(){c.push(null)})}e("../utils").inherits(r,o),r.prototype._read=function(){this._helper.resume()},n.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,r);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,r)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var r=new Buffer(o);return r.fill(0),r},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(e,n,a){function o(L,F,A){var x,N=s.getTypeOf(F),U=s.extend(A||{},c);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(L=y(L)),U.createFolders&&(x=_(L))&&v.call(this,x,!0);var tt=N==="string"&&U.binary===!1&&U.base64===!1;A&&A.binary!==void 0||(U.binary=!tt),(F instanceof h&&F.uncompressedSize===0||U.dir||!F||F.length===0)&&(U.base64=!1,U.binary=!0,F="",U.compression="STORE",N="string");var S=null;S=F instanceof h||F instanceof l?F:m.isNode&&m.isStream(F)?new g(L,F):s.prepareContent(L,F,U.binary,U.optimizedBinaryString,U.base64);var P=new f(L,S,U);this.files[L]=P}var r=e("./utf8"),s=e("./utils"),l=e("./stream/GenericWorker"),u=e("./stream/StreamHelper"),c=e("./defaults"),h=e("./compressedObject"),f=e("./zipObject"),d=e("./generate"),m=e("./nodejsUtils"),g=e("./nodejs/NodejsStreamInputAdapter"),_=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var F=L.lastIndexOf("/");return 0<F?L.substring(0,F):""},y=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},v=function(L,F){return F=F!==void 0?F:c.createFolders,L=y(L),this.files[L]||o.call(this,L,null,{dir:!0,createFolders:F}),this.files[L]};function w(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var F,A,x;for(F in this.files)x=this.files[F],(A=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&L(A,x)},filter:function(L){var F=[];return this.forEach(function(A,x){L(A,x)&&F.push(x)}),F},file:function(L,F,A){if(arguments.length!==1)return L=this.root+L,o.call(this,L,F,A),this;if(w(L)){var x=L;return this.filter(function(U,tt){return!tt.dir&&x.test(U)})}var N=this.files[this.root+L];return N&&!N.dir?N:null},folder:function(L){if(!L)return this;if(w(L))return this.filter(function(N,U){return U.dir&&L.test(N)});var F=this.root+L,A=v.call(this,F),x=this.clone();return x.root=A.name,x},remove:function(L){L=this.root+L;var F=this.files[L];if(F||(L.slice(-1)!=="/"&&(L+="/"),F=this.files[L]),F&&!F.dir)delete this.files[L];else for(var A=this.filter(function(N,U){return U.name.slice(0,L.length)===L}),x=0;x<A.length;x++)delete this.files[A[x].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var F,A={};try{if((A=s.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");s.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var x=A.comment||this.comment||"";F=d.generateWorker(this,A,x)}catch(N){(F=new l("error")).error(N)}return new u(F,A.type||"string",A.mimeType)},generateAsync:function(L,F){return this.generateInternalStream(L).accumulate(F)},generateNodeStream:function(L,F){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(F)}};n.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,a){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,a){var o=e("./DataReader");function r(s){o.call(this,s);for(var l=0;l<this.data.length;l++)s[l]=255&s[l]}e("../utils").inherits(r,o),r.prototype.byteAt=function(s){return this.data[this.zero+s]},r.prototype.lastIndexOfSignature=function(s){for(var l=s.charCodeAt(0),u=s.charCodeAt(1),c=s.charCodeAt(2),h=s.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===u&&this.data[f+2]===c&&this.data[f+3]===h)return f-this.zero;return-1},r.prototype.readAndCheckSignature=function(s){var l=s.charCodeAt(0),u=s.charCodeAt(1),c=s.charCodeAt(2),h=s.charCodeAt(3),f=this.readData(4);return l===f[0]&&u===f[1]&&c===f[2]&&h===f[3]},r.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},n.exports=r},{"../utils":32,"./DataReader":18}],18:[function(e,n,a){var o=e("../utils");function r(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var l,u=0;for(this.checkOffset(s),l=this.index+s-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=s,u},readString:function(s){return o.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},n.exports=r},{"../utils":32}],19:[function(e,n,a){var o=e("./Uint8ArrayReader");function r(s){o.call(this,s)}e("../utils").inherits(r,o),r.prototype.readData=function(s){this.checkOffset(s);var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},n.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,a){var o=e("./DataReader");function r(s){o.call(this,s)}e("../utils").inherits(r,o),r.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},r.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},r.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},r.prototype.readData=function(s){this.checkOffset(s);var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},n.exports=r},{"../utils":32,"./DataReader":18}],21:[function(e,n,a){var o=e("./ArrayReader");function r(s){o.call(this,s)}e("../utils").inherits(r,o),r.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},n.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,a){var o=e("../utils"),r=e("../support"),s=e("./ArrayReader"),l=e("./StringReader"),u=e("./NodeBufferReader"),c=e("./Uint8ArrayReader");n.exports=function(h){var f=o.getTypeOf(h);return o.checkSupport(f),f!=="string"||r.uint8array?f==="nodebuffer"?new u(h):r.uint8array?new c(o.transformTo("uint8array",h)):new s(o.transformTo("array",h)):new l(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,a){var o=e("./GenericWorker"),r=e("../utils");function s(l){o.call(this,"ConvertWorker to "+l),this.destType=l}r.inherits(s,o),s.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},n.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,a){var o=e("./GenericWorker"),r=e("../crc32");function s(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,o),s.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,a){var o=e("../utils"),r=e("./GenericWorker");function s(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}o.inherits(s,r),s.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}r.prototype.processChunk.call(this,l)},n.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,a){var o=e("../utils"),r=e("./GenericWorker");function s(l){r.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(c){u.dataIsReady=!0,u.data=c,u.max=c&&c.length||0,u.type=o.getTypeOf(c),u.isPaused||u._tickAndRepeat()},function(c){u.error(c)})}o.inherits(s,r),s.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,a){function o(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,s){return this._listeners[r].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,s){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,s)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var s=this;return r.on("data",function(l){s.processChunk(l)}),r.on("end",function(){s.end()}),r.on("error",function(l){s.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,s){return this.extraStreamInfo[r]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},n.exports=o},{}],29:[function(e,n,a){var o=e("../utils"),r=e("./ConvertWorker"),s=e("./GenericWorker"),l=e("../base64"),u=e("../support"),c=e("../external"),h=null;if(u.nodestream)try{h=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(m,g){return new c.Promise(function(_,y){var v=[],w=m._internalType,T=m._outputType,L=m._mimeType;m.on("data",function(F,A){v.push(F),g&&g(A)}).on("error",function(F){v=[],y(F)}).on("end",function(){try{var F=function(A,x,N){switch(A){case"blob":return o.newBlob(o.transformTo("arraybuffer",x),N);case"base64":return l.encode(x);default:return o.transformTo(A,x)}}(T,function(A,x){var N,U=0,tt=null,S=0;for(N=0;N<x.length;N++)S+=x[N].length;switch(A){case"string":return x.join("");case"array":return Array.prototype.concat.apply([],x);case"uint8array":for(tt=new Uint8Array(S),N=0;N<x.length;N++)tt.set(x[N],U),U+=x[N].length;return tt;case"nodebuffer":return Buffer.concat(x);default:throw new Error("concat : unsupported type '"+A+"'")}}(w,v),L);_(F)}catch(A){y(A)}v=[]}).resume()})}function d(m,g,_){var y=g;switch(g){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=g,this._mimeType=_,o.checkSupport(y),this._worker=m.pipe(new r(y)),m.lock()}catch(v){this._worker=new s("error"),this._worker.error(v)}}d.prototype={accumulate:function(m){return f(this,m)},on:function(m,g){var _=this;return m==="data"?this._worker.on(m,function(y){g.call(_,y.data,y.meta)}):this._worker.on(m,function(){o.delay(g,arguments,_)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var o=new ArrayBuffer(0);try{a.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(o),a.blob=r.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!e("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,a){for(var o=e("./utils"),r=e("./support"),s=e("./nodejsUtils"),l=e("./stream/GenericWorker"),u=new Array(256),c=0;c<256;c++)u[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;u[254]=u[254]=1;function h(){l.call(this,"utf-8 decode"),this.leftOver=null}function f(){l.call(this,"utf-8 encode")}a.utf8encode=function(d){return r.nodebuffer?s.newBufferFrom(d,"utf-8"):function(m){var g,_,y,v,w,T=m.length,L=0;for(v=0;v<T;v++)(64512&(_=m.charCodeAt(v)))==55296&&v+1<T&&(64512&(y=m.charCodeAt(v+1)))==56320&&(_=65536+(_-55296<<10)+(y-56320),v++),L+=_<128?1:_<2048?2:_<65536?3:4;for(g=r.uint8array?new Uint8Array(L):new Array(L),v=w=0;w<L;v++)(64512&(_=m.charCodeAt(v)))==55296&&v+1<T&&(64512&(y=m.charCodeAt(v+1)))==56320&&(_=65536+(_-55296<<10)+(y-56320),v++),_<128?g[w++]=_:(_<2048?g[w++]=192|_>>>6:(_<65536?g[w++]=224|_>>>12:(g[w++]=240|_>>>18,g[w++]=128|_>>>12&63),g[w++]=128|_>>>6&63),g[w++]=128|63&_);return g}(d)},a.utf8decode=function(d){return r.nodebuffer?o.transformTo("nodebuffer",d).toString("utf-8"):function(m){var g,_,y,v,w=m.length,T=new Array(2*w);for(g=_=0;g<w;)if((y=m[g++])<128)T[_++]=y;else if(4<(v=u[y]))T[_++]=65533,g+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&g<w;)y=y<<6|63&m[g++],v--;1<v?T[_++]=65533:y<65536?T[_++]=y:(y-=65536,T[_++]=55296|y>>10&1023,T[_++]=56320|1023&y)}return T.length!==_&&(T.subarray?T=T.subarray(0,_):T.length=_),o.applyFromCharCode(T)}(d=o.transformTo(r.uint8array?"uint8array":"array",d))},o.inherits(h,l),h.prototype.processChunk=function(d){var m=o.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var g=m;(m=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),m.set(g,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var _=function(v,w){var T;for((w=w||v.length)>v.length&&(w=v.length),T=w-1;0<=T&&(192&v[T])==128;)T--;return T<0||T===0?w:T+u[v[T]]>w?T:w}(m),y=m;_!==m.length&&(r.uint8array?(y=m.subarray(0,_),this.leftOver=m.subarray(_,m.length)):(y=m.slice(0,_),this.leftOver=m.slice(_,m.length))),this.push({data:a.utf8decode(y),meta:d.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=h,o.inherits(f,l),f.prototype.processChunk=function(d){this.push({data:a.utf8encode(d.data),meta:d.meta})},a.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,a){var o=e("./support"),r=e("./base64"),s=e("./nodejsUtils"),l=e("./external");function u(g){return g}function c(g,_){for(var y=0;y<g.length;++y)_[y]=255&g.charCodeAt(y);return _}e("setimmediate"),a.newBlob=function(g,_){a.checkSupport("blob");try{return new Blob([g],{type:_})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(g),y.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(g,_,y){var v=[],w=0,T=g.length;if(T<=y)return String.fromCharCode.apply(null,g);for(;w<T;)_==="array"||_==="nodebuffer"?v.push(String.fromCharCode.apply(null,g.slice(w,Math.min(w+y,T)))):v.push(String.fromCharCode.apply(null,g.subarray(w,Math.min(w+y,T)))),w+=y;return v.join("")},stringifyByChar:function(g){for(var _="",y=0;y<g.length;y++)_+=String.fromCharCode(g[y]);return _},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function f(g){var _=65536,y=a.getTypeOf(g),v=!0;if(y==="uint8array"?v=h.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=h.applyCanBeUsed.nodebuffer),v)for(;1<_;)try{return h.stringifyByChunk(g,y,_)}catch{_=Math.floor(_/2)}return h.stringifyByChar(g)}function d(g,_){for(var y=0;y<g.length;y++)_[y]=g[y];return _}a.applyFromCharCode=f;var m={};m.string={string:u,array:function(g){return c(g,new Array(g.length))},arraybuffer:function(g){return m.string.uint8array(g).buffer},uint8array:function(g){return c(g,new Uint8Array(g.length))},nodebuffer:function(g){return c(g,s.allocBuffer(g.length))}},m.array={string:f,array:u,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return s.newBufferFrom(g)}},m.arraybuffer={string:function(g){return f(new Uint8Array(g))},array:function(g){return d(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:u,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return s.newBufferFrom(new Uint8Array(g))}},m.uint8array={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:u,nodebuffer:function(g){return s.newBufferFrom(g)}},m.nodebuffer={string:f,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return m.nodebuffer.uint8array(g).buffer},uint8array:function(g){return d(g,new Uint8Array(g.length))},nodebuffer:u},a.transformTo=function(g,_){if(_=_||"",!g)return _;a.checkSupport(g);var y=a.getTypeOf(_);return m[y][g](_)},a.resolve=function(g){for(var _=g.split("/"),y=[],v=0;v<_.length;v++){var w=_[v];w==="."||w===""&&v!==0&&v!==_.length-1||(w===".."?y.pop():y.push(w))}return y.join("/")},a.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":o.nodebuffer&&s.isBuffer(g)?"nodebuffer":o.uint8array&&g instanceof Uint8Array?"uint8array":o.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(g){if(!o[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(g){var _,y,v="";for(y=0;y<(g||"").length;y++)v+="\\x"+((_=g.charCodeAt(y))<16?"0":"")+_.toString(16).toUpperCase();return v},a.delay=function(g,_,y){setImmediate(function(){g.apply(y||null,_||[])})},a.inherits=function(g,_){function y(){}y.prototype=_.prototype,g.prototype=new y},a.extend=function(){var g,_,y={};for(g=0;g<arguments.length;g++)for(_ in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],_)&&y[_]===void 0&&(y[_]=arguments[g][_]);return y},a.prepareContent=function(g,_,y,v,w){return l.Promise.resolve(_).then(function(T){return o.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new l.Promise(function(L,F){var A=new FileReader;A.onload=function(x){L(x.target.result)},A.onerror=function(x){F(x.target.error)},A.readAsArrayBuffer(T)}):T}).then(function(T){var L=a.getTypeOf(T);return L?(L==="arraybuffer"?T=a.transformTo("uint8array",T):L==="string"&&(w?T=r.decode(T):y&&v!==!0&&(T=function(F){return c(F,o.uint8array?new Uint8Array(F.length):new Array(F.length))}(T))),T):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,a){var o=e("./reader/readerFor"),r=e("./utils"),s=e("./signature"),l=e("./zipEntry"),u=e("./support");function c(h){this.files=[],this.loadOptions=h}c.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(h)+")")}},isSignature:function(h,f){var d=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===f;return this.reader.setIndex(d),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=u.uint8array?"uint8array":"array",d=r.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,d,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),f=this.reader.readInt(4),d=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(h=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var m=f-d;if(0<m)this.isSignature(f,s.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=o(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=c},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,a){var o=e("./reader/readerFor"),r=e("./utils"),s=e("./compressedObject"),l=e("./crc32"),u=e("./utf8"),c=e("./compressions"),h=e("./support");function f(d,m){this.options=d,this.loadOptions=m}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var m,g;if(d.skip(22),this.fileNameLength=d.readInt(2),g=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(_){for(var y in c)if(Object.prototype.hasOwnProperty.call(c,y)&&c[y].magic===_)return c[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,m,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var m=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(m),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=o(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var m,g,_,y=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<y;)m=d.readInt(2),g=d.readInt(2),_=d.readData(g),this.extraFields[m]={id:m,length:g,value:_};d.setIndex(y)},handleUTF8:function(){var d=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var g=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var y=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var m=o(d.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:u.utf8decode(m.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var m=o(d.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:u.utf8decode(m.readData(d.length-5))}return null}},n.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,a){function o(m,g,_){this.name=m,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=g,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var r=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),l=e("./utf8"),u=e("./compressedObject"),c=e("./stream/GenericWorker");o.prototype={internalStream:function(m){var g=null,_="string";try{if(!m)throw new Error("No output type specified.");var y=(_=m.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),g=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(g=g.pipe(new l.Utf8EncodeWorker)),!v&&y&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(w){(g=new c("error")).error(w)}return new r(g,_,"")},async:function(m,g){return this.internalStream(m).accumulate(g)},nodeStream:function(m,g){return this.internalStream(m||"nodebuffer").toNodejsStream(g)},_compressWorker:function(m,g){if(this._data instanceof u&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(_,m,g)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof c?this._data:new s(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<h.length;d++)o.prototype[h[d]]=f;n.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,a){(function(o){var r,s,l=o.MutationObserver||o.WebKitMutationObserver;if(l){var u=0,c=new l(m),h=o.document.createTextNode("");c.observe(h,{characterData:!0}),r=function(){h.data=u=++u%2}}else if(o.setImmediate||o.MessageChannel===void 0)r="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var g=o.document.createElement("script");g.onreadystatechange=function(){m(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},o.document.documentElement.appendChild(g)}:function(){setTimeout(m,0)};else{var f=new o.MessageChannel;f.port1.onmessage=m,r=function(){f.port2.postMessage(0)}}var d=[];function m(){var g,_;s=!0;for(var y=d.length;y;){for(_=d,d=[],g=-1;++g<y;)_[g]();y=d.length}s=!1}n.exports=function(g){d.push(g)!==1||s||r()}}).call(this,typeof xn<"u"?xn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,a){var o=e("immediate");function r(){}var s={},l=["REJECTED"],u=["FULFILLED"],c=["PENDING"];function h(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,y!==r&&g(this,y)}function f(y,v,w){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function d(y,v,w){o(function(){var T;try{T=v(w)}catch(L){return s.reject(y,L)}T===y?s.reject(y,new TypeError("Cannot resolve promise with itself")):s.resolve(y,T)})}function m(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function g(y,v){var w=!1;function T(A){w||(w=!0,s.reject(y,A))}function L(A){w||(w=!0,s.resolve(y,A))}var F=_(function(){v(L,T)});F.status==="error"&&T(F.value)}function _(y,v){var w={};try{w.value=y(v),w.status="success"}catch(T){w.status="error",w.value=T}return w}(n.exports=h).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(w){return v.resolve(y()).then(function(){return w})},function(w){return v.resolve(y()).then(function(){throw w})})},h.prototype.catch=function(y){return this.then(null,y)},h.prototype.then=function(y,v){if(typeof y!="function"&&this.state===u||typeof v!="function"&&this.state===l)return this;var w=new this.constructor(r);return this.state!==c?d(w,this.state===u?y:v,this.outcome):this.queue.push(new f(w,y,v)),w},f.prototype.callFulfilled=function(y){s.resolve(this.promise,y)},f.prototype.otherCallFulfilled=function(y){d(this.promise,this.onFulfilled,y)},f.prototype.callRejected=function(y){s.reject(this.promise,y)},f.prototype.otherCallRejected=function(y){d(this.promise,this.onRejected,y)},s.resolve=function(y,v){var w=_(m,v);if(w.status==="error")return s.reject(y,w.value);var T=w.value;if(T)g(y,T);else{y.state=u,y.outcome=v;for(var L=-1,F=y.queue.length;++L<F;)y.queue[L].callFulfilled(v)}return y},s.reject=function(y,v){y.state=l,y.outcome=v;for(var w=-1,T=y.queue.length;++w<T;)y.queue[w].callRejected(v);return y},h.resolve=function(y){return y instanceof this?y:s.resolve(new this(r),y)},h.reject=function(y){var v=new this(r);return s.reject(v,y)},h.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=y.length,T=!1;if(!w)return this.resolve([]);for(var L=new Array(w),F=0,A=-1,x=new this(r);++A<w;)N(y[A],A);return x;function N(U,tt){v.resolve(U).then(function(S){L[tt]=S,++F!==w||T||(T=!0,s.resolve(x,L))},function(S){T||(T=!0,s.reject(x,S))})}},h.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=y.length,T=!1;if(!w)return this.resolve([]);for(var L=-1,F=new this(r);++L<w;)A=y[L],v.resolve(A).then(function(x){T||(T=!0,s.resolve(F,x))},function(x){T||(T=!0,s.reject(F,x))});var A;return F}},{immediate:36}],38:[function(e,n,a){var o={};(0,e("./lib/utils/common").assign)(o,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,a){var o=e("./zlib/deflate"),r=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/messages"),u=e("./zlib/zstream"),c=Object.prototype.toString,h=0,f=-1,d=0,m=8;function g(y){if(!(this instanceof g))return new g(y);this.options=r.assign({level:f,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var w=o.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(w!==h)throw new Error(l[w]);if(v.header&&o.deflateSetHeader(this.strm,v.header),v.dictionary){var T;if(T=typeof v.dictionary=="string"?s.string2buf(v.dictionary):c.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(w=o.deflateSetDictionary(this.strm,T))!==h)throw new Error(l[w]);this._dict_set=!0}}function _(y,v){var w=new g(v);if(w.push(y,!0),w.err)throw w.msg||l[w.err];return w.result}g.prototype.push=function(y,v){var w,T,L=this.strm,F=this.options.chunkSize;if(this.ended)return!1;T=v===~~v?v:v===!0?4:0,typeof y=="string"?L.input=s.string2buf(y):c.call(y)==="[object ArrayBuffer]"?L.input=new Uint8Array(y):L.input=y,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new r.Buf8(F),L.next_out=0,L.avail_out=F),(w=o.deflate(L,T))!==1&&w!==h)return this.onEnd(w),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(r.shrinkBuf(L.output,L.next_out))):this.onData(r.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&w!==1);return T===4?(w=o.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===h):T!==2||(this.onEnd(h),!(L.avail_out=0))},g.prototype.onData=function(y){this.chunks.push(y)},g.prototype.onEnd=function(y){y===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},a.Deflate=g,a.deflate=_,a.deflateRaw=function(y,v){return(v=v||{}).raw=!0,_(y,v)},a.gzip=function(y,v){return(v=v||{}).gzip=!0,_(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,a){var o=e("./zlib/inflate"),r=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/constants"),u=e("./zlib/messages"),c=e("./zlib/zstream"),h=e("./zlib/gzheader"),f=Object.prototype.toString;function d(g){if(!(this instanceof d))return new d(g);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},g||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||g&&g.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&(15&_.windowBits)==0&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=o.inflateInit2(this.strm,_.windowBits);if(y!==l.Z_OK)throw new Error(u[y]);this.header=new h,o.inflateGetHeader(this.strm,this.header)}function m(g,_){var y=new d(_);if(y.push(g,!0),y.err)throw y.msg||u[y.err];return y.result}d.prototype.push=function(g,_){var y,v,w,T,L,F,A=this.strm,x=this.options.chunkSize,N=this.options.dictionary,U=!1;if(this.ended)return!1;v=_===~~_?_:_===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?A.input=s.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?A.input=new Uint8Array(g):A.input=g,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new r.Buf8(x),A.next_out=0,A.avail_out=x),(y=o.inflate(A,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&N&&(F=typeof N=="string"?s.string2buf(N):f.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,y=o.inflateSetDictionary(this.strm,F)),y===l.Z_BUF_ERROR&&U===!0&&(y=l.Z_OK,U=!1),y!==l.Z_STREAM_END&&y!==l.Z_OK)return this.onEnd(y),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&y!==l.Z_STREAM_END&&(A.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=s.utf8border(A.output,A.next_out),T=A.next_out-w,L=s.buf2string(A.output,w),A.next_out=T,A.avail_out=x-T,T&&r.arraySet(A.output,A.output,w,T,0),this.onData(L)):this.onData(r.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(U=!0)}while((0<A.avail_in||A.avail_out===0)&&y!==l.Z_STREAM_END);return y===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(y=o.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(A.avail_out=0))},d.prototype.onData=function(g){this.chunks.push(g)},d.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},a.Inflate=d,a.inflate=m,a.inflateRaw=function(g,_){return(_=_||{}).raw=!0,m(g,_)},a.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,a){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var c=u.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var h in c)c.hasOwnProperty(h)&&(l[h]=c[h])}}return l},a.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var r={arraySet:function(l,u,c,h,f){if(u.subarray&&l.subarray)l.set(u.subarray(c,c+h),f);else for(var d=0;d<h;d++)l[f+d]=u[c+d]},flattenChunks:function(l){var u,c,h,f,d,m;for(u=h=0,c=l.length;u<c;u++)h+=l[u].length;for(m=new Uint8Array(h),u=f=0,c=l.length;u<c;u++)d=l[u],m.set(d,f),f+=d.length;return m}},s={arraySet:function(l,u,c,h,f){for(var d=0;d<h;d++)l[f+d]=u[c+d]},flattenChunks:function(l){return[].concat.apply([],l)}};a.setTyped=function(l){l?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,r)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,s))},a.setTyped(o)},{}],42:[function(e,n,a){var o=e("./common"),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var l=new o.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function c(h,f){if(f<65537&&(h.subarray&&s||!h.subarray&&r))return String.fromCharCode.apply(null,o.shrinkBuf(h,f));for(var d="",m=0;m<f;m++)d+=String.fromCharCode(h[m]);return d}l[254]=l[254]=1,a.string2buf=function(h){var f,d,m,g,_,y=h.length,v=0;for(g=0;g<y;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<y&&(64512&(m=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),g++),v+=d<128?1:d<2048?2:d<65536?3:4;for(f=new o.Buf8(v),g=_=0;_<v;g++)(64512&(d=h.charCodeAt(g)))==55296&&g+1<y&&(64512&(m=h.charCodeAt(g+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),g++),d<128?f[_++]=d:(d<2048?f[_++]=192|d>>>6:(d<65536?f[_++]=224|d>>>12:(f[_++]=240|d>>>18,f[_++]=128|d>>>12&63),f[_++]=128|d>>>6&63),f[_++]=128|63&d);return f},a.buf2binstring=function(h){return c(h,h.length)},a.binstring2buf=function(h){for(var f=new o.Buf8(h.length),d=0,m=f.length;d<m;d++)f[d]=h.charCodeAt(d);return f},a.buf2string=function(h,f){var d,m,g,_,y=f||h.length,v=new Array(2*y);for(d=m=0;d<y;)if((g=h[d++])<128)v[m++]=g;else if(4<(_=l[g]))v[m++]=65533,d+=_-1;else{for(g&=_===2?31:_===3?15:7;1<_&&d<y;)g=g<<6|63&h[d++],_--;1<_?v[m++]=65533:g<65536?v[m++]=g:(g-=65536,v[m++]=55296|g>>10&1023,v[m++]=56320|1023&g)}return c(v,m)},a.utf8border=function(h,f){var d;for((f=f||h.length)>h.length&&(f=h.length),d=f-1;0<=d&&(192&h[d])==128;)d--;return d<0||d===0?f:d+l[h[d]]>f?d:f}},{"./common":41}],43:[function(e,n,a){n.exports=function(o,r,s,l){for(var u=65535&o|0,c=o>>>16&65535|0,h=0;s!==0;){for(s-=h=2e3<s?2e3:s;c=c+(u=u+r[l++]|0)|0,--h;);u%=65521,c%=65521}return u|c<<16|0}},{}],44:[function(e,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,a){var o=function(){for(var r,s=[],l=0;l<256;l++){r=l;for(var u=0;u<8;u++)r=1&r?3988292384^r>>>1:r>>>1;s[l]=r}return s}();n.exports=function(r,s,l,u){var c=o,h=u+l;r^=-1;for(var f=u;f<h;f++)r=r>>>8^c[255&(r^s[f])];return-1^r}},{}],46:[function(e,n,a){var o,r=e("../utils/common"),s=e("./trees"),l=e("./adler32"),u=e("./crc32"),c=e("./messages"),h=0,f=4,d=0,m=-2,g=-1,_=4,y=2,v=8,w=9,T=286,L=30,F=19,A=2*T+1,x=15,N=3,U=258,tt=U+N+1,S=42,P=113,b=1,H=2,Z=3,G=4;function ut(p,z){return p.msg=c[z],z}function W(p){return(p<<1)-(4<p?9:0)}function st(p){for(var z=p.length;0<=--z;)p[z]=0}function B(p){var z=p.state,O=z.pending;O>p.avail_out&&(O=p.avail_out),O!==0&&(r.arraySet(p.output,z.pending_buf,z.pending_out,O,p.next_out),p.next_out+=O,z.pending_out+=O,p.total_out+=O,p.avail_out-=O,z.pending-=O,z.pending===0&&(z.pending_out=0))}function I(p,z){s._tr_flush_block(p,0<=p.block_start?p.block_start:-1,p.strstart-p.block_start,z),p.block_start=p.strstart,B(p.strm)}function rt(p,z){p.pending_buf[p.pending++]=z}function K(p,z){p.pending_buf[p.pending++]=z>>>8&255,p.pending_buf[p.pending++]=255&z}function q(p,z){var O,D,E=p.max_chain_length,C=p.strstart,j=p.prev_length,Y=p.nice_match,R=p.strstart>p.w_size-tt?p.strstart-(p.w_size-tt):0,V=p.window,Q=p.w_mask,J=p.prev,at=p.strstart+U,St=V[C+j-1],pt=V[C+j];p.prev_length>=p.good_match&&(E>>=2),Y>p.lookahead&&(Y=p.lookahead);do if(V[(O=z)+j]===pt&&V[O+j-1]===St&&V[O]===V[C]&&V[++O]===V[C+1]){C+=2,O++;do;while(V[++C]===V[++O]&&V[++C]===V[++O]&&V[++C]===V[++O]&&V[++C]===V[++O]&&V[++C]===V[++O]&&V[++C]===V[++O]&&V[++C]===V[++O]&&V[++C]===V[++O]&&C<at);if(D=U-(at-C),C=at-U,j<D){if(p.match_start=z,Y<=(j=D))break;St=V[C+j-1],pt=V[C+j]}}while((z=J[z&Q])>R&&--E!=0);return j<=p.lookahead?j:p.lookahead}function Rt(p){var z,O,D,E,C,j,Y,R,V,Q,J=p.w_size;do{if(E=p.window_size-p.lookahead-p.strstart,p.strstart>=J+(J-tt)){for(r.arraySet(p.window,p.window,J,J,0),p.match_start-=J,p.strstart-=J,p.block_start-=J,z=O=p.hash_size;D=p.head[--z],p.head[z]=J<=D?D-J:0,--O;);for(z=O=J;D=p.prev[--z],p.prev[z]=J<=D?D-J:0,--O;);E+=J}if(p.strm.avail_in===0)break;if(j=p.strm,Y=p.window,R=p.strstart+p.lookahead,V=E,Q=void 0,Q=j.avail_in,V<Q&&(Q=V),O=Q===0?0:(j.avail_in-=Q,r.arraySet(Y,j.input,j.next_in,Q,R),j.state.wrap===1?j.adler=l(j.adler,Y,Q,R):j.state.wrap===2&&(j.adler=u(j.adler,Y,Q,R)),j.next_in+=Q,j.total_in+=Q,Q),p.lookahead+=O,p.lookahead+p.insert>=N)for(C=p.strstart-p.insert,p.ins_h=p.window[C],p.ins_h=(p.ins_h<<p.hash_shift^p.window[C+1])&p.hash_mask;p.insert&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[C+N-1])&p.hash_mask,p.prev[C&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=C,C++,p.insert--,!(p.lookahead+p.insert<N)););}while(p.lookahead<tt&&p.strm.avail_in!==0)}function Pt(p,z){for(var O,D;;){if(p.lookahead<tt){if(Rt(p),p.lookahead<tt&&z===h)return b;if(p.lookahead===0)break}if(O=0,p.lookahead>=N&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+N-1])&p.hash_mask,O=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),O!==0&&p.strstart-O<=p.w_size-tt&&(p.match_length=q(p,O)),p.match_length>=N)if(D=s._tr_tally(p,p.strstart-p.match_start,p.match_length-N),p.lookahead-=p.match_length,p.match_length<=p.max_lazy_match&&p.lookahead>=N){for(p.match_length--;p.strstart++,p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+N-1])&p.hash_mask,O=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart,--p.match_length!=0;);p.strstart++}else p.strstart+=p.match_length,p.match_length=0,p.ins_h=p.window[p.strstart],p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+1])&p.hash_mask;else D=s._tr_tally(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++;if(D&&(I(p,!1),p.strm.avail_out===0))return b}return p.insert=p.strstart<N-1?p.strstart:N-1,z===f?(I(p,!0),p.strm.avail_out===0?Z:G):p.last_lit&&(I(p,!1),p.strm.avail_out===0)?b:H}function mt(p,z){for(var O,D,E;;){if(p.lookahead<tt){if(Rt(p),p.lookahead<tt&&z===h)return b;if(p.lookahead===0)break}if(O=0,p.lookahead>=N&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+N-1])&p.hash_mask,O=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),p.prev_length=p.match_length,p.prev_match=p.match_start,p.match_length=N-1,O!==0&&p.prev_length<p.max_lazy_match&&p.strstart-O<=p.w_size-tt&&(p.match_length=q(p,O),p.match_length<=5&&(p.strategy===1||p.match_length===N&&4096<p.strstart-p.match_start)&&(p.match_length=N-1)),p.prev_length>=N&&p.match_length<=p.prev_length){for(E=p.strstart+p.lookahead-N,D=s._tr_tally(p,p.strstart-1-p.prev_match,p.prev_length-N),p.lookahead-=p.prev_length-1,p.prev_length-=2;++p.strstart<=E&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+N-1])&p.hash_mask,O=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),--p.prev_length!=0;);if(p.match_available=0,p.match_length=N-1,p.strstart++,D&&(I(p,!1),p.strm.avail_out===0))return b}else if(p.match_available){if((D=s._tr_tally(p,0,p.window[p.strstart-1]))&&I(p,!1),p.strstart++,p.lookahead--,p.strm.avail_out===0)return b}else p.match_available=1,p.strstart++,p.lookahead--}return p.match_available&&(D=s._tr_tally(p,0,p.window[p.strstart-1]),p.match_available=0),p.insert=p.strstart<N-1?p.strstart:N-1,z===f?(I(p,!0),p.strm.avail_out===0?Z:G):p.last_lit&&(I(p,!1),p.strm.avail_out===0)?b:H}function yt(p,z,O,D,E){this.good_length=p,this.max_lazy=z,this.nice_length=O,this.max_chain=D,this.func=E}function Ot(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*A),this.dyn_dtree=new r.Buf16(2*(2*L+1)),this.bl_tree=new r.Buf16(2*(2*F+1)),st(this.dyn_ltree),st(this.dyn_dtree),st(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(x+1),this.heap=new r.Buf16(2*T+1),st(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*T+1),st(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Nt(p){var z;return p&&p.state?(p.total_in=p.total_out=0,p.data_type=y,(z=p.state).pending=0,z.pending_out=0,z.wrap<0&&(z.wrap=-z.wrap),z.status=z.wrap?S:P,p.adler=z.wrap===2?0:1,z.last_flush=h,s._tr_init(z),d):ut(p,m)}function Se(p){var z=Nt(p);return z===d&&function(O){O.window_size=2*O.w_size,st(O.head),O.max_lazy_match=o[O.level].max_lazy,O.good_match=o[O.level].good_length,O.nice_match=o[O.level].nice_length,O.max_chain_length=o[O.level].max_chain,O.strstart=0,O.block_start=0,O.lookahead=0,O.insert=0,O.match_length=O.prev_length=N-1,O.match_available=0,O.ins_h=0}(p.state),z}function he(p,z,O,D,E,C){if(!p)return m;var j=1;if(z===g&&(z=6),D<0?(j=0,D=-D):15<D&&(j=2,D-=16),E<1||w<E||O!==v||D<8||15<D||z<0||9<z||C<0||_<C)return ut(p,m);D===8&&(D=9);var Y=new Ot;return(p.state=Y).strm=p,Y.wrap=j,Y.gzhead=null,Y.w_bits=D,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=E+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+N-1)/N),Y.window=new r.Buf8(2*Y.w_size),Y.head=new r.Buf16(Y.hash_size),Y.prev=new r.Buf16(Y.w_size),Y.lit_bufsize=1<<E+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new r.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=z,Y.strategy=C,Y.method=O,Se(p)}o=[new yt(0,0,0,0,function(p,z){var O=65535;for(O>p.pending_buf_size-5&&(O=p.pending_buf_size-5);;){if(p.lookahead<=1){if(Rt(p),p.lookahead===0&&z===h)return b;if(p.lookahead===0)break}p.strstart+=p.lookahead,p.lookahead=0;var D=p.block_start+O;if((p.strstart===0||p.strstart>=D)&&(p.lookahead=p.strstart-D,p.strstart=D,I(p,!1),p.strm.avail_out===0)||p.strstart-p.block_start>=p.w_size-tt&&(I(p,!1),p.strm.avail_out===0))return b}return p.insert=0,z===f?(I(p,!0),p.strm.avail_out===0?Z:G):(p.strstart>p.block_start&&(I(p,!1),p.strm.avail_out),b)}),new yt(4,4,8,4,Pt),new yt(4,5,16,8,Pt),new yt(4,6,32,32,Pt),new yt(4,4,16,16,mt),new yt(8,16,32,32,mt),new yt(8,16,128,128,mt),new yt(8,32,128,256,mt),new yt(32,128,258,1024,mt),new yt(32,258,258,4096,mt)],a.deflateInit=function(p,z){return he(p,z,v,15,8,0)},a.deflateInit2=he,a.deflateReset=Se,a.deflateResetKeep=Nt,a.deflateSetHeader=function(p,z){return p&&p.state?p.state.wrap!==2?m:(p.state.gzhead=z,d):m},a.deflate=function(p,z){var O,D,E,C;if(!p||!p.state||5<z||z<0)return p?ut(p,m):m;if(D=p.state,!p.output||!p.input&&p.avail_in!==0||D.status===666&&z!==f)return ut(p,p.avail_out===0?-5:m);if(D.strm=p,O=D.last_flush,D.last_flush=z,D.status===S)if(D.wrap===2)p.adler=0,rt(D,31),rt(D,139),rt(D,8),D.gzhead?(rt(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),rt(D,255&D.gzhead.time),rt(D,D.gzhead.time>>8&255),rt(D,D.gzhead.time>>16&255),rt(D,D.gzhead.time>>24&255),rt(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),rt(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(rt(D,255&D.gzhead.extra.length),rt(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(p.adler=u(p.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(rt(D,0),rt(D,0),rt(D,0),rt(D,0),rt(D,0),rt(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),rt(D,3),D.status=P);else{var j=v+(D.w_bits-8<<4)<<8;j|=(2<=D.strategy||D.level<2?0:D.level<6?1:D.level===6?2:3)<<6,D.strstart!==0&&(j|=32),j+=31-j%31,D.status=P,K(D,j),D.strstart!==0&&(K(D,p.adler>>>16),K(D,65535&p.adler)),p.adler=1}if(D.status===69)if(D.gzhead.extra){for(E=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),B(p),E=D.pending,D.pending!==D.pending_buf_size));)rt(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(D.status===73)if(D.gzhead.name){E=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),B(p),E=D.pending,D.pending===D.pending_buf_size)){C=1;break}C=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,rt(D,C)}while(C!==0);D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),C===0&&(D.gzindex=0,D.status=91)}else D.status=91;if(D.status===91)if(D.gzhead.comment){E=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),B(p),E=D.pending,D.pending===D.pending_buf_size)){C=1;break}C=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,rt(D,C)}while(C!==0);D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),C===0&&(D.status=103)}else D.status=103;if(D.status===103&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&B(p),D.pending+2<=D.pending_buf_size&&(rt(D,255&p.adler),rt(D,p.adler>>8&255),p.adler=0,D.status=P)):D.status=P),D.pending!==0){if(B(p),p.avail_out===0)return D.last_flush=-1,d}else if(p.avail_in===0&&W(z)<=W(O)&&z!==f)return ut(p,-5);if(D.status===666&&p.avail_in!==0)return ut(p,-5);if(p.avail_in!==0||D.lookahead!==0||z!==h&&D.status!==666){var Y=D.strategy===2?function(R,V){for(var Q;;){if(R.lookahead===0&&(Rt(R),R.lookahead===0)){if(V===h)return b;break}if(R.match_length=0,Q=s._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,Q&&(I(R,!1),R.strm.avail_out===0))return b}return R.insert=0,V===f?(I(R,!0),R.strm.avail_out===0?Z:G):R.last_lit&&(I(R,!1),R.strm.avail_out===0)?b:H}(D,z):D.strategy===3?function(R,V){for(var Q,J,at,St,pt=R.window;;){if(R.lookahead<=U){if(Rt(R),R.lookahead<=U&&V===h)return b;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=N&&0<R.strstart&&(J=pt[at=R.strstart-1])===pt[++at]&&J===pt[++at]&&J===pt[++at]){St=R.strstart+U;do;while(J===pt[++at]&&J===pt[++at]&&J===pt[++at]&&J===pt[++at]&&J===pt[++at]&&J===pt[++at]&&J===pt[++at]&&J===pt[++at]&&at<St);R.match_length=U-(St-at),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=N?(Q=s._tr_tally(R,1,R.match_length-N),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(Q=s._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),Q&&(I(R,!1),R.strm.avail_out===0))return b}return R.insert=0,V===f?(I(R,!0),R.strm.avail_out===0?Z:G):R.last_lit&&(I(R,!1),R.strm.avail_out===0)?b:H}(D,z):o[D.level].func(D,z);if(Y!==Z&&Y!==G||(D.status=666),Y===b||Y===Z)return p.avail_out===0&&(D.last_flush=-1),d;if(Y===H&&(z===1?s._tr_align(D):z!==5&&(s._tr_stored_block(D,0,0,!1),z===3&&(st(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),B(p),p.avail_out===0))return D.last_flush=-1,d}return z!==f?d:D.wrap<=0?1:(D.wrap===2?(rt(D,255&p.adler),rt(D,p.adler>>8&255),rt(D,p.adler>>16&255),rt(D,p.adler>>24&255),rt(D,255&p.total_in),rt(D,p.total_in>>8&255),rt(D,p.total_in>>16&255),rt(D,p.total_in>>24&255)):(K(D,p.adler>>>16),K(D,65535&p.adler)),B(p),0<D.wrap&&(D.wrap=-D.wrap),D.pending!==0?d:1)},a.deflateEnd=function(p){var z;return p&&p.state?(z=p.state.status)!==S&&z!==69&&z!==73&&z!==91&&z!==103&&z!==P&&z!==666?ut(p,m):(p.state=null,z===P?ut(p,-3):d):m},a.deflateSetDictionary=function(p,z){var O,D,E,C,j,Y,R,V,Q=z.length;if(!p||!p.state||(C=(O=p.state).wrap)===2||C===1&&O.status!==S||O.lookahead)return m;for(C===1&&(p.adler=l(p.adler,z,Q,0)),O.wrap=0,Q>=O.w_size&&(C===0&&(st(O.head),O.strstart=0,O.block_start=0,O.insert=0),V=new r.Buf8(O.w_size),r.arraySet(V,z,Q-O.w_size,O.w_size,0),z=V,Q=O.w_size),j=p.avail_in,Y=p.next_in,R=p.input,p.avail_in=Q,p.next_in=0,p.input=z,Rt(O);O.lookahead>=N;){for(D=O.strstart,E=O.lookahead-(N-1);O.ins_h=(O.ins_h<<O.hash_shift^O.window[D+N-1])&O.hash_mask,O.prev[D&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=D,D++,--E;);O.strstart=D,O.lookahead=N-1,Rt(O)}return O.strstart+=O.lookahead,O.block_start=O.strstart,O.insert=O.lookahead,O.lookahead=0,O.match_length=O.prev_length=N-1,O.match_available=0,p.next_in=Y,p.input=R,p.avail_in=j,O.wrap=C,d},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,a){n.exports=function(o,r){var s,l,u,c,h,f,d,m,g,_,y,v,w,T,L,F,A,x,N,U,tt,S,P,b,H;s=o.state,l=o.next_in,b=o.input,u=l+(o.avail_in-5),c=o.next_out,H=o.output,h=c-(r-o.avail_out),f=c+(o.avail_out-257),d=s.dmax,m=s.wsize,g=s.whave,_=s.wnext,y=s.window,v=s.hold,w=s.bits,T=s.lencode,L=s.distcode,F=(1<<s.lenbits)-1,A=(1<<s.distbits)-1;t:do{w<15&&(v+=b[l++]<<w,w+=8,v+=b[l++]<<w,w+=8),x=T[v&F];e:for(;;){if(v>>>=N=x>>>24,w-=N,(N=x>>>16&255)===0)H[c++]=65535&x;else{if(!(16&N)){if((64&N)==0){x=T[(65535&x)+(v&(1<<N)-1)];continue e}if(32&N){s.mode=12;break t}o.msg="invalid literal/length code",s.mode=30;break t}U=65535&x,(N&=15)&&(w<N&&(v+=b[l++]<<w,w+=8),U+=v&(1<<N)-1,v>>>=N,w-=N),w<15&&(v+=b[l++]<<w,w+=8,v+=b[l++]<<w,w+=8),x=L[v&A];i:for(;;){if(v>>>=N=x>>>24,w-=N,!(16&(N=x>>>16&255))){if((64&N)==0){x=L[(65535&x)+(v&(1<<N)-1)];continue i}o.msg="invalid distance code",s.mode=30;break t}if(tt=65535&x,w<(N&=15)&&(v+=b[l++]<<w,(w+=8)<N&&(v+=b[l++]<<w,w+=8)),d<(tt+=v&(1<<N)-1)){o.msg="invalid distance too far back",s.mode=30;break t}if(v>>>=N,w-=N,(N=c-h)<tt){if(g<(N=tt-N)&&s.sane){o.msg="invalid distance too far back",s.mode=30;break t}if(P=y,(S=0)===_){if(S+=m-N,N<U){for(U-=N;H[c++]=y[S++],--N;);S=c-tt,P=H}}else if(_<N){if(S+=m+_-N,(N-=_)<U){for(U-=N;H[c++]=y[S++],--N;);if(S=0,_<U){for(U-=N=_;H[c++]=y[S++],--N;);S=c-tt,P=H}}}else if(S+=_-N,N<U){for(U-=N;H[c++]=y[S++],--N;);S=c-tt,P=H}for(;2<U;)H[c++]=P[S++],H[c++]=P[S++],H[c++]=P[S++],U-=3;U&&(H[c++]=P[S++],1<U&&(H[c++]=P[S++]))}else{for(S=c-tt;H[c++]=H[S++],H[c++]=H[S++],H[c++]=H[S++],2<(U-=3););U&&(H[c++]=H[S++],1<U&&(H[c++]=H[S++]))}break}}break}}while(l<u&&c<f);l-=U=w>>3,v&=(1<<(w-=U<<3))-1,o.next_in=l,o.next_out=c,o.avail_in=l<u?u-l+5:5-(l-u),o.avail_out=c<f?f-c+257:257-(c-f),s.hold=v,s.bits=w}},{}],49:[function(e,n,a){var o=e("../utils/common"),r=e("./adler32"),s=e("./crc32"),l=e("./inffast"),u=e("./inftrees"),c=1,h=2,f=0,d=-2,m=1,g=852,_=592;function y(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(S){var P;return S&&S.state?(P=S.state,S.total_in=S.total_out=P.total=0,S.msg="",P.wrap&&(S.adler=1&P.wrap),P.mode=m,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new o.Buf32(g),P.distcode=P.distdyn=new o.Buf32(_),P.sane=1,P.back=-1,f):d}function T(S){var P;return S&&S.state?((P=S.state).wsize=0,P.whave=0,P.wnext=0,w(S)):d}function L(S,P){var b,H;return S&&S.state?(H=S.state,P<0?(b=0,P=-P):(b=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?d:(H.window!==null&&H.wbits!==P&&(H.window=null),H.wrap=b,H.wbits=P,T(S))):d}function F(S,P){var b,H;return S?(H=new v,(S.state=H).window=null,(b=L(S,P))!==f&&(S.state=null),b):d}var A,x,N=!0;function U(S){if(N){var P;for(A=new o.Buf32(512),x=new o.Buf32(32),P=0;P<144;)S.lens[P++]=8;for(;P<256;)S.lens[P++]=9;for(;P<280;)S.lens[P++]=7;for(;P<288;)S.lens[P++]=8;for(u(c,S.lens,0,288,A,0,S.work,{bits:9}),P=0;P<32;)S.lens[P++]=5;u(h,S.lens,0,32,x,0,S.work,{bits:5}),N=!1}S.lencode=A,S.lenbits=9,S.distcode=x,S.distbits=5}function tt(S,P,b,H){var Z,G=S.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),H>=G.wsize?(o.arraySet(G.window,P,b-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(H<(Z=G.wsize-G.wnext)&&(Z=H),o.arraySet(G.window,P,b-H,Z,G.wnext),(H-=Z)?(o.arraySet(G.window,P,b-H,H,0),G.wnext=H,G.whave=G.wsize):(G.wnext+=Z,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=Z))),0}a.inflateReset=T,a.inflateReset2=L,a.inflateResetKeep=w,a.inflateInit=function(S){return F(S,15)},a.inflateInit2=F,a.inflate=function(S,P){var b,H,Z,G,ut,W,st,B,I,rt,K,q,Rt,Pt,mt,yt,Ot,Nt,Se,he,p,z,O,D,E=0,C=new o.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return d;(b=S.state).mode===12&&(b.mode=13),ut=S.next_out,Z=S.output,st=S.avail_out,G=S.next_in,H=S.input,W=S.avail_in,B=b.hold,I=b.bits,rt=W,K=st,z=f;t:for(;;)switch(b.mode){case m:if(b.wrap===0){b.mode=13;break}for(;I<16;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if(2&b.wrap&&B===35615){C[b.check=0]=255&B,C[1]=B>>>8&255,b.check=s(b.check,C,2,0),I=B=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&B)<<8)+(B>>8))%31){S.msg="incorrect header check",b.mode=30;break}if((15&B)!=8){S.msg="unknown compression method",b.mode=30;break}if(I-=4,p=8+(15&(B>>>=4)),b.wbits===0)b.wbits=p;else if(p>b.wbits){S.msg="invalid window size",b.mode=30;break}b.dmax=1<<p,S.adler=b.check=1,b.mode=512&B?10:12,I=B=0;break;case 2:for(;I<16;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if(b.flags=B,(255&b.flags)!=8){S.msg="unknown compression method",b.mode=30;break}if(57344&b.flags){S.msg="unknown header flags set",b.mode=30;break}b.head&&(b.head.text=B>>8&1),512&b.flags&&(C[0]=255&B,C[1]=B>>>8&255,b.check=s(b.check,C,2,0)),I=B=0,b.mode=3;case 3:for(;I<32;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}b.head&&(b.head.time=B),512&b.flags&&(C[0]=255&B,C[1]=B>>>8&255,C[2]=B>>>16&255,C[3]=B>>>24&255,b.check=s(b.check,C,4,0)),I=B=0,b.mode=4;case 4:for(;I<16;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}b.head&&(b.head.xflags=255&B,b.head.os=B>>8),512&b.flags&&(C[0]=255&B,C[1]=B>>>8&255,b.check=s(b.check,C,2,0)),I=B=0,b.mode=5;case 5:if(1024&b.flags){for(;I<16;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}b.length=B,b.head&&(b.head.extra_len=B),512&b.flags&&(C[0]=255&B,C[1]=B>>>8&255,b.check=s(b.check,C,2,0)),I=B=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(W<(q=b.length)&&(q=W),q&&(b.head&&(p=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Array(b.head.extra_len)),o.arraySet(b.head.extra,H,G,q,p)),512&b.flags&&(b.check=s(b.check,H,q,G)),W-=q,G+=q,b.length-=q),b.length))break t;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(W===0)break t;for(q=0;p=H[G+q++],b.head&&p&&b.length<65536&&(b.head.name+=String.fromCharCode(p)),p&&q<W;);if(512&b.flags&&(b.check=s(b.check,H,q,G)),W-=q,G+=q,p)break t}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(W===0)break t;for(q=0;p=H[G+q++],b.head&&p&&b.length<65536&&(b.head.comment+=String.fromCharCode(p)),p&&q<W;);if(512&b.flags&&(b.check=s(b.check,H,q,G)),W-=q,G+=q,p)break t}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;I<16;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if(B!==(65535&b.check)){S.msg="header crc mismatch",b.mode=30;break}I=B=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),S.adler=b.check=0,b.mode=12;break;case 10:for(;I<32;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}S.adler=b.check=y(B),I=B=0,b.mode=11;case 11:if(b.havedict===0)return S.next_out=ut,S.avail_out=st,S.next_in=G,S.avail_in=W,b.hold=B,b.bits=I,2;S.adler=b.check=1,b.mode=12;case 12:if(P===5||P===6)break t;case 13:if(b.last){B>>>=7&I,I-=7&I,b.mode=27;break}for(;I<3;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}switch(b.last=1&B,I-=1,3&(B>>>=1)){case 0:b.mode=14;break;case 1:if(U(b),b.mode=20,P!==6)break;B>>>=2,I-=2;break t;case 2:b.mode=17;break;case 3:S.msg="invalid block type",b.mode=30}B>>>=2,I-=2;break;case 14:for(B>>>=7&I,I-=7&I;I<32;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if((65535&B)!=(B>>>16^65535)){S.msg="invalid stored block lengths",b.mode=30;break}if(b.length=65535&B,I=B=0,b.mode=15,P===6)break t;case 15:b.mode=16;case 16:if(q=b.length){if(W<q&&(q=W),st<q&&(q=st),q===0)break t;o.arraySet(Z,H,G,q,ut),W-=q,G+=q,st-=q,ut+=q,b.length-=q;break}b.mode=12;break;case 17:for(;I<14;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if(b.nlen=257+(31&B),B>>>=5,I-=5,b.ndist=1+(31&B),B>>>=5,I-=5,b.ncode=4+(15&B),B>>>=4,I-=4,286<b.nlen||30<b.ndist){S.msg="too many length or distance symbols",b.mode=30;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;I<3;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}b.lens[j[b.have++]]=7&B,B>>>=3,I-=3}for(;b.have<19;)b.lens[j[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,O={bits:b.lenbits},z=u(0,b.lens,0,19,b.lencode,0,b.work,O),b.lenbits=O.bits,z){S.msg="invalid code lengths set",b.mode=30;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;yt=(E=b.lencode[B&(1<<b.lenbits)-1])>>>16&255,Ot=65535&E,!((mt=E>>>24)<=I);){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if(Ot<16)B>>>=mt,I-=mt,b.lens[b.have++]=Ot;else{if(Ot===16){for(D=mt+2;I<D;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if(B>>>=mt,I-=mt,b.have===0){S.msg="invalid bit length repeat",b.mode=30;break}p=b.lens[b.have-1],q=3+(3&B),B>>>=2,I-=2}else if(Ot===17){for(D=mt+3;I<D;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}I-=mt,p=0,q=3+(7&(B>>>=mt)),B>>>=3,I-=3}else{for(D=mt+7;I<D;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}I-=mt,p=0,q=11+(127&(B>>>=mt)),B>>>=7,I-=7}if(b.have+q>b.nlen+b.ndist){S.msg="invalid bit length repeat",b.mode=30;break}for(;q--;)b.lens[b.have++]=p}}if(b.mode===30)break;if(b.lens[256]===0){S.msg="invalid code -- missing end-of-block",b.mode=30;break}if(b.lenbits=9,O={bits:b.lenbits},z=u(c,b.lens,0,b.nlen,b.lencode,0,b.work,O),b.lenbits=O.bits,z){S.msg="invalid literal/lengths set",b.mode=30;break}if(b.distbits=6,b.distcode=b.distdyn,O={bits:b.distbits},z=u(h,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,O),b.distbits=O.bits,z){S.msg="invalid distances set",b.mode=30;break}if(b.mode=20,P===6)break t;case 20:b.mode=21;case 21:if(6<=W&&258<=st){S.next_out=ut,S.avail_out=st,S.next_in=G,S.avail_in=W,b.hold=B,b.bits=I,l(S,K),ut=S.next_out,Z=S.output,st=S.avail_out,G=S.next_in,H=S.input,W=S.avail_in,B=b.hold,I=b.bits,b.mode===12&&(b.back=-1);break}for(b.back=0;yt=(E=b.lencode[B&(1<<b.lenbits)-1])>>>16&255,Ot=65535&E,!((mt=E>>>24)<=I);){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if(yt&&(240&yt)==0){for(Nt=mt,Se=yt,he=Ot;yt=(E=b.lencode[he+((B&(1<<Nt+Se)-1)>>Nt)])>>>16&255,Ot=65535&E,!(Nt+(mt=E>>>24)<=I);){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}B>>>=Nt,I-=Nt,b.back+=Nt}if(B>>>=mt,I-=mt,b.back+=mt,b.length=Ot,yt===0){b.mode=26;break}if(32&yt){b.back=-1,b.mode=12;break}if(64&yt){S.msg="invalid literal/length code",b.mode=30;break}b.extra=15&yt,b.mode=22;case 22:if(b.extra){for(D=b.extra;I<D;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}b.length+=B&(1<<b.extra)-1,B>>>=b.extra,I-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;yt=(E=b.distcode[B&(1<<b.distbits)-1])>>>16&255,Ot=65535&E,!((mt=E>>>24)<=I);){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if((240&yt)==0){for(Nt=mt,Se=yt,he=Ot;yt=(E=b.distcode[he+((B&(1<<Nt+Se)-1)>>Nt)])>>>16&255,Ot=65535&E,!(Nt+(mt=E>>>24)<=I);){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}B>>>=Nt,I-=Nt,b.back+=Nt}if(B>>>=mt,I-=mt,b.back+=mt,64&yt){S.msg="invalid distance code",b.mode=30;break}b.offset=Ot,b.extra=15&yt,b.mode=24;case 24:if(b.extra){for(D=b.extra;I<D;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}b.offset+=B&(1<<b.extra)-1,B>>>=b.extra,I-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){S.msg="invalid distance too far back",b.mode=30;break}b.mode=25;case 25:if(st===0)break t;if(q=K-st,b.offset>q){if((q=b.offset-q)>b.whave&&b.sane){S.msg="invalid distance too far back",b.mode=30;break}Rt=q>b.wnext?(q-=b.wnext,b.wsize-q):b.wnext-q,q>b.length&&(q=b.length),Pt=b.window}else Pt=Z,Rt=ut-b.offset,q=b.length;for(st<q&&(q=st),st-=q,b.length-=q;Z[ut++]=Pt[Rt++],--q;);b.length===0&&(b.mode=21);break;case 26:if(st===0)break t;Z[ut++]=b.length,st--,b.mode=21;break;case 27:if(b.wrap){for(;I<32;){if(W===0)break t;W--,B|=H[G++]<<I,I+=8}if(K-=st,S.total_out+=K,b.total+=K,K&&(S.adler=b.check=b.flags?s(b.check,Z,K,ut-K):r(b.check,Z,K,ut-K)),K=st,(b.flags?B:y(B))!==b.check){S.msg="incorrect data check",b.mode=30;break}I=B=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;I<32;){if(W===0)break t;W--,B+=H[G++]<<I,I+=8}if(B!==(4294967295&b.total)){S.msg="incorrect length check",b.mode=30;break}I=B=0}b.mode=29;case 29:z=1;break t;case 30:z=-3;break t;case 31:return-4;case 32:default:return d}return S.next_out=ut,S.avail_out=st,S.next_in=G,S.avail_in=W,b.hold=B,b.bits=I,(b.wsize||K!==S.avail_out&&b.mode<30&&(b.mode<27||P!==4))&&tt(S,S.output,S.next_out,K-S.avail_out)?(b.mode=31,-4):(rt-=S.avail_in,K-=S.avail_out,S.total_in+=rt,S.total_out+=K,b.total+=K,b.wrap&&K&&(S.adler=b.check=b.flags?s(b.check,Z,K,S.next_out-K):r(b.check,Z,K,S.next_out-K)),S.data_type=b.bits+(b.last?64:0)+(b.mode===12?128:0)+(b.mode===20||b.mode===15?256:0),(rt==0&&K===0||P===4)&&z===f&&(z=-5),z)},a.inflateEnd=function(S){if(!S||!S.state)return d;var P=S.state;return P.window&&(P.window=null),S.state=null,f},a.inflateGetHeader=function(S,P){var b;return S&&S.state?(2&(b=S.state).wrap)==0?d:((b.head=P).done=!1,f):d},a.inflateSetDictionary=function(S,P){var b,H=P.length;return S&&S.state?(b=S.state).wrap!==0&&b.mode!==11?d:b.mode===11&&r(1,P,H,0)!==b.check?-3:tt(S,P,H,H)?(b.mode=31,-4):(b.havedict=1,f):d},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,a){var o=e("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(c,h,f,d,m,g,_,y){var v,w,T,L,F,A,x,N,U,tt=y.bits,S=0,P=0,b=0,H=0,Z=0,G=0,ut=0,W=0,st=0,B=0,I=null,rt=0,K=new o.Buf16(16),q=new o.Buf16(16),Rt=null,Pt=0;for(S=0;S<=15;S++)K[S]=0;for(P=0;P<d;P++)K[h[f+P]]++;for(Z=tt,H=15;1<=H&&K[H]===0;H--);if(H<Z&&(Z=H),H===0)return m[g++]=20971520,m[g++]=20971520,y.bits=1,0;for(b=1;b<H&&K[b]===0;b++);for(Z<b&&(Z=b),S=W=1;S<=15;S++)if(W<<=1,(W-=K[S])<0)return-1;if(0<W&&(c===0||H!==1))return-1;for(q[1]=0,S=1;S<15;S++)q[S+1]=q[S]+K[S];for(P=0;P<d;P++)h[f+P]!==0&&(_[q[h[f+P]]++]=P);if(A=c===0?(I=Rt=_,19):c===1?(I=r,rt-=257,Rt=s,Pt-=257,256):(I=l,Rt=u,-1),S=b,F=g,ut=P=B=0,T=-1,L=(st=1<<(G=Z))-1,c===1&&852<st||c===2&&592<st)return 1;for(;;){for(x=S-ut,U=_[P]<A?(N=0,_[P]):_[P]>A?(N=Rt[Pt+_[P]],I[rt+_[P]]):(N=96,0),v=1<<S-ut,b=w=1<<G;m[F+(B>>ut)+(w-=v)]=x<<24|N<<16|U|0,w!==0;);for(v=1<<S-1;B&v;)v>>=1;if(v!==0?(B&=v-1,B+=v):B=0,P++,--K[S]==0){if(S===H)break;S=h[f+_[P]]}if(Z<S&&(B&L)!==T){for(ut===0&&(ut=Z),F+=b,W=1<<(G=S-ut);G+ut<H&&!((W-=K[G+ut])<=0);)G++,W<<=1;if(st+=1<<G,c===1&&852<st||c===2&&592<st)return 1;m[T=B&L]=Z<<24|G<<16|F-g|0}}return B!==0&&(m[F+B]=S-ut<<24|64<<16|0),y.bits=Z,0}},{"../utils/common":41}],51:[function(e,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,a){var o=e("../utils/common"),r=0,s=1;function l(E){for(var C=E.length;0<=--C;)E[C]=0}var u=0,c=29,h=256,f=h+1+c,d=30,m=19,g=2*f+1,_=15,y=16,v=7,w=256,T=16,L=17,F=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],tt=new Array(2*(f+2));l(tt);var S=new Array(2*d);l(S);var P=new Array(512);l(P);var b=new Array(256);l(b);var H=new Array(c);l(H);var Z,G,ut,W=new Array(d);function st(E,C,j,Y,R){this.static_tree=E,this.extra_bits=C,this.extra_base=j,this.elems=Y,this.max_length=R,this.has_stree=E&&E.length}function B(E,C){this.dyn_tree=E,this.max_code=0,this.stat_desc=C}function I(E){return E<256?P[E]:P[256+(E>>>7)]}function rt(E,C){E.pending_buf[E.pending++]=255&C,E.pending_buf[E.pending++]=C>>>8&255}function K(E,C,j){E.bi_valid>y-j?(E.bi_buf|=C<<E.bi_valid&65535,rt(E,E.bi_buf),E.bi_buf=C>>y-E.bi_valid,E.bi_valid+=j-y):(E.bi_buf|=C<<E.bi_valid&65535,E.bi_valid+=j)}function q(E,C,j){K(E,j[2*C],j[2*C+1])}function Rt(E,C){for(var j=0;j|=1&E,E>>>=1,j<<=1,0<--C;);return j>>>1}function Pt(E,C,j){var Y,R,V=new Array(_+1),Q=0;for(Y=1;Y<=_;Y++)V[Y]=Q=Q+j[Y-1]<<1;for(R=0;R<=C;R++){var J=E[2*R+1];J!==0&&(E[2*R]=Rt(V[J]++,J))}}function mt(E){var C;for(C=0;C<f;C++)E.dyn_ltree[2*C]=0;for(C=0;C<d;C++)E.dyn_dtree[2*C]=0;for(C=0;C<m;C++)E.bl_tree[2*C]=0;E.dyn_ltree[2*w]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function yt(E){8<E.bi_valid?rt(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function Ot(E,C,j,Y){var R=2*C,V=2*j;return E[R]<E[V]||E[R]===E[V]&&Y[C]<=Y[j]}function Nt(E,C,j){for(var Y=E.heap[j],R=j<<1;R<=E.heap_len&&(R<E.heap_len&&Ot(C,E.heap[R+1],E.heap[R],E.depth)&&R++,!Ot(C,Y,E.heap[R],E.depth));)E.heap[j]=E.heap[R],j=R,R<<=1;E.heap[j]=Y}function Se(E,C,j){var Y,R,V,Q,J=0;if(E.last_lit!==0)for(;Y=E.pending_buf[E.d_buf+2*J]<<8|E.pending_buf[E.d_buf+2*J+1],R=E.pending_buf[E.l_buf+J],J++,Y===0?q(E,R,C):(q(E,(V=b[R])+h+1,C),(Q=A[V])!==0&&K(E,R-=H[V],Q),q(E,V=I(--Y),j),(Q=x[V])!==0&&K(E,Y-=W[V],Q)),J<E.last_lit;);q(E,w,C)}function he(E,C){var j,Y,R,V=C.dyn_tree,Q=C.stat_desc.static_tree,J=C.stat_desc.has_stree,at=C.stat_desc.elems,St=-1;for(E.heap_len=0,E.heap_max=g,j=0;j<at;j++)V[2*j]!==0?(E.heap[++E.heap_len]=St=j,E.depth[j]=0):V[2*j+1]=0;for(;E.heap_len<2;)V[2*(R=E.heap[++E.heap_len]=St<2?++St:0)]=1,E.depth[R]=0,E.opt_len--,J&&(E.static_len-=Q[2*R+1]);for(C.max_code=St,j=E.heap_len>>1;1<=j;j--)Nt(E,V,j);for(R=at;j=E.heap[1],E.heap[1]=E.heap[E.heap_len--],Nt(E,V,1),Y=E.heap[1],E.heap[--E.heap_max]=j,E.heap[--E.heap_max]=Y,V[2*R]=V[2*j]+V[2*Y],E.depth[R]=(E.depth[j]>=E.depth[Y]?E.depth[j]:E.depth[Y])+1,V[2*j+1]=V[2*Y+1]=R,E.heap[1]=R++,Nt(E,V,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],function(pt,te){var tn,Te,en,It,En,Da,Be=te.dyn_tree,Xr=te.max_code,cu=te.stat_desc.static_tree,uu=te.stat_desc.has_stree,hu=te.stat_desc.extra_bits,jr=te.stat_desc.extra_base,nn=te.stat_desc.max_length,Dn=0;for(It=0;It<=_;It++)pt.bl_count[It]=0;for(Be[2*pt.heap[pt.heap_max]+1]=0,tn=pt.heap_max+1;tn<g;tn++)nn<(It=Be[2*Be[2*(Te=pt.heap[tn])+1]+1]+1)&&(It=nn,Dn++),Be[2*Te+1]=It,Xr<Te||(pt.bl_count[It]++,En=0,jr<=Te&&(En=hu[Te-jr]),Da=Be[2*Te],pt.opt_len+=Da*(It+En),uu&&(pt.static_len+=Da*(cu[2*Te+1]+En)));if(Dn!==0){do{for(It=nn-1;pt.bl_count[It]===0;)It--;pt.bl_count[It]--,pt.bl_count[It+1]+=2,pt.bl_count[nn]--,Dn-=2}while(0<Dn);for(It=nn;It!==0;It--)for(Te=pt.bl_count[It];Te!==0;)Xr<(en=pt.heap[--tn])||(Be[2*en+1]!==It&&(pt.opt_len+=(It-Be[2*en+1])*Be[2*en],Be[2*en+1]=It),Te--)}}(E,C),Pt(V,St,E.bl_count)}function p(E,C,j){var Y,R,V=-1,Q=C[1],J=0,at=7,St=4;for(Q===0&&(at=138,St=3),C[2*(j+1)+1]=65535,Y=0;Y<=j;Y++)R=Q,Q=C[2*(Y+1)+1],++J<at&&R===Q||(J<St?E.bl_tree[2*R]+=J:R!==0?(R!==V&&E.bl_tree[2*R]++,E.bl_tree[2*T]++):J<=10?E.bl_tree[2*L]++:E.bl_tree[2*F]++,V=R,St=(J=0)===Q?(at=138,3):R===Q?(at=6,3):(at=7,4))}function z(E,C,j){var Y,R,V=-1,Q=C[1],J=0,at=7,St=4;for(Q===0&&(at=138,St=3),Y=0;Y<=j;Y++)if(R=Q,Q=C[2*(Y+1)+1],!(++J<at&&R===Q)){if(J<St)for(;q(E,R,E.bl_tree),--J!=0;);else R!==0?(R!==V&&(q(E,R,E.bl_tree),J--),q(E,T,E.bl_tree),K(E,J-3,2)):J<=10?(q(E,L,E.bl_tree),K(E,J-3,3)):(q(E,F,E.bl_tree),K(E,J-11,7));V=R,St=(J=0)===Q?(at=138,3):R===Q?(at=6,3):(at=7,4)}}l(W);var O=!1;function D(E,C,j,Y){K(E,(u<<1)+(Y?1:0),3),function(R,V,Q,J){yt(R),J&&(rt(R,Q),rt(R,~Q)),o.arraySet(R.pending_buf,R.window,V,Q,R.pending),R.pending+=Q}(E,C,j,!0)}a._tr_init=function(E){O||(function(){var C,j,Y,R,V,Q=new Array(_+1);for(R=Y=0;R<c-1;R++)for(H[R]=Y,C=0;C<1<<A[R];C++)b[Y++]=R;for(b[Y-1]=R,R=V=0;R<16;R++)for(W[R]=V,C=0;C<1<<x[R];C++)P[V++]=R;for(V>>=7;R<d;R++)for(W[R]=V<<7,C=0;C<1<<x[R]-7;C++)P[256+V++]=R;for(j=0;j<=_;j++)Q[j]=0;for(C=0;C<=143;)tt[2*C+1]=8,C++,Q[8]++;for(;C<=255;)tt[2*C+1]=9,C++,Q[9]++;for(;C<=279;)tt[2*C+1]=7,C++,Q[7]++;for(;C<=287;)tt[2*C+1]=8,C++,Q[8]++;for(Pt(tt,f+1,Q),C=0;C<d;C++)S[2*C+1]=5,S[2*C]=Rt(C,5);Z=new st(tt,A,h+1,f,_),G=new st(S,x,0,d,_),ut=new st(new Array(0),N,0,m,v)}(),O=!0),E.l_desc=new B(E.dyn_ltree,Z),E.d_desc=new B(E.dyn_dtree,G),E.bl_desc=new B(E.bl_tree,ut),E.bi_buf=0,E.bi_valid=0,mt(E)},a._tr_stored_block=D,a._tr_flush_block=function(E,C,j,Y){var R,V,Q=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=function(J){var at,St=4093624447;for(at=0;at<=31;at++,St>>>=1)if(1&St&&J.dyn_ltree[2*at]!==0)return r;if(J.dyn_ltree[18]!==0||J.dyn_ltree[20]!==0||J.dyn_ltree[26]!==0)return s;for(at=32;at<h;at++)if(J.dyn_ltree[2*at]!==0)return s;return r}(E)),he(E,E.l_desc),he(E,E.d_desc),Q=function(J){var at;for(p(J,J.dyn_ltree,J.l_desc.max_code),p(J,J.dyn_dtree,J.d_desc.max_code),he(J,J.bl_desc),at=m-1;3<=at&&J.bl_tree[2*U[at]+1]===0;at--);return J.opt_len+=3*(at+1)+5+5+4,at}(E),R=E.opt_len+3+7>>>3,(V=E.static_len+3+7>>>3)<=R&&(R=V)):R=V=j+5,j+4<=R&&C!==-1?D(E,C,j,Y):E.strategy===4||V===R?(K(E,2+(Y?1:0),3),Se(E,tt,S)):(K(E,4+(Y?1:0),3),function(J,at,St,pt){var te;for(K(J,at-257,5),K(J,St-1,5),K(J,pt-4,4),te=0;te<pt;te++)K(J,J.bl_tree[2*U[te]+1],3);z(J,J.dyn_ltree,at-1),z(J,J.dyn_dtree,St-1)}(E,E.l_desc.max_code+1,E.d_desc.max_code+1,Q+1),Se(E,E.dyn_ltree,E.dyn_dtree)),mt(E),Y&&yt(E)},a._tr_tally=function(E,C,j){return E.pending_buf[E.d_buf+2*E.last_lit]=C>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&C,E.pending_buf[E.l_buf+E.last_lit]=255&j,E.last_lit++,C===0?E.dyn_ltree[2*j]++:(E.matches++,C--,E.dyn_ltree[2*(b[j]+h+1)]++,E.dyn_dtree[2*I(C)]++),E.last_lit===E.lit_bufsize-1},a._tr_align=function(E){K(E,2,3),q(E,w,tt),function(C){C.bi_valid===16?(rt(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):8<=C.bi_valid&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)}(E)}},{"../utils/common":41}],53:[function(e,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,a){(function(o){(function(r,s){if(!r.setImmediate){var l,u,c,h,f=1,d={},m=!1,g=r.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(r);_=_&&_.setTimeout?_:r,l={}.toString.call(r.process)==="[object process]"?function(T){process.nextTick(function(){v(T)})}:function(){if(r.postMessage&&!r.importScripts){var T=!0,L=r.onmessage;return r.onmessage=function(){T=!1},r.postMessage("","*"),r.onmessage=L,T}}()?(h="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",w,!1):r.attachEvent("onmessage",w),function(T){r.postMessage(h+T,"*")}):r.MessageChannel?((c=new MessageChannel).port1.onmessage=function(T){v(T.data)},function(T){c.port2.postMessage(T)}):g&&"onreadystatechange"in g.createElement("script")?(u=g.documentElement,function(T){var L=g.createElement("script");L.onreadystatechange=function(){v(T),L.onreadystatechange=null,u.removeChild(L),L=null},u.appendChild(L)}):function(T){setTimeout(v,0,T)},_.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var L=new Array(arguments.length-1),F=0;F<L.length;F++)L[F]=arguments[F+1];var A={callback:T,args:L};return d[f]=A,l(f),f++},_.clearImmediate=y}function y(T){delete d[T]}function v(T){if(m)setTimeout(v,0,T);else{var L=d[T];if(L){m=!0;try{(function(F){var A=F.callback,x=F.args;switch(x.length){case 0:A();break;case 1:A(x[0]);break;case 2:A(x[0],x[1]);break;case 3:A(x[0],x[1],x[2]);break;default:A.apply(s,x)}})(L)}finally{y(T),m=!1}}}}function w(T){T.source===r&&typeof T.data=="string"&&T.data.indexOf(h)===0&&v(+T.data.slice(h.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof xn<"u"?xn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ru);const Dm=ru.exports;async function wm(i){return await Dm.loadAsync(i)}const fe=()=>"[main]",Me=async i=>{var t;try{console.time("loading time"),Tn.enable(!1);let e;if(i.file)e=i.file;else if(i.link)e=await vm(Go(decodeURI(i.link)));else if(i.id)e=await au(Wo(decodeURI(i.id)));else if(i.hash&&Uo(decodeURI(i.hash).trim()))e=await Em(decodeURI(i.hash).trim());else throw new Error("Could not search for file.");wt.status("info","Extracting zip",0),Xt.switchHeader(!1);const n=await wm(e);Tn.enable(!1),wt.status("info","Parsing map info...",0),et.info(fe(),"Parsing map info");const a=await gm(n);lt.beatmapInfo=a,Au(a),wt.status("info","Loading image...",10.4375),et.info(fe(),"Loading cover image");let o=n.file(a._coverImageFilename);if(it.load.imageCover&&o){let u=await o.async("base64");Xt.setCoverImage("data:image;base64,"+u),Xi.loading.coverImage=!0}else et.error(fe(),`${a._coverImageFilename} does not exists.`);if(lt.contributors=[],(t=a==null?void 0:a._customData)!=null&&t._contributors)for(const u of a._customData._contributors){et.info(fe(),"Loading contributor image "+u._name),o=n.file(u._iconPath);let c=null;it.load.imageContributor&&o?c=await o.async("base64"):et.error(fe(),`${u._iconPath} does not exists.`),lt.contributors.push({...u,_base64:c})}wt.status("info","Loading audio...",20.875),et.info(fe(),"Loading audio");let r=n.file(a._songFilename);if(it.load.audio&&r){let u=!1;setTimeout(()=>{u||wt.status("info","Loading audio... (this may take a while)",20.875)},1e4);let c=await r.async("arraybuffer");Xt.setAudio(c),await new AudioContext().decodeAudioData(c).then(f=>{u=!0;let d=f.duration;lt.duration=d,Xt.setSongDuration(d),Xi.loading.audio=!0}).catch(function(f){Xt.setSongDuration(),et.error(fe(),f)})}else Xt.setSongDuration(),et.error(fe(),`${a._songFilename} does not exist.`);wt.status("info","Parsing difficulty...",70),lt.beatmapDifficulty=await _m(a,n),Ni.adjustTime(),wt.status("info","Adding map difficulty stats...",80),et.info(fe(),"Adding map stats"),dm(),hl(lt.contributors);let s=a._beatsPerMinute,l=a._beatsPerMinute;lt.beatmapDifficulty.forEach(u=>{const c=u.bpm.change.map(f=>f.BPM),h=u.data.bpmEvents.map(f=>f.bpm);s=Math.min(s,...c,...h),l=Math.max(l,...c,...h)}),s!==l&&Xt.setSongBPM(a._beatsPerMinute,s,l),wt.status("info","Analysing general...",85),et.info(fe(),"Analysing map"),Li.runGeneral(),Ni.displayOutputGeneral(),wt.status("info","Analysing difficulty...",90),Li.applyAll(),Ni.populateSelect(a),Ni.displayOutputDifficulty(),Tn.enable(!0),wt.status("info","Map successfully loaded!"),console.timeEnd("loading time")}catch(e){wt.status("error",e,100),et.error(fe(),e),lt.clear(),Tn.enable(!0),Xt.switchHeader(!0)}},Qi="UI Intro: ",hn=document.querySelector(".input__intro-url"),dn=document.querySelector(".input__intro-id"),fn=document.querySelector(".input__intro-hash"),Mo=document.querySelector(".input__search-button"),Po=document.querySelector(".input__file"),Ca=document.querySelector(".input__file-zone");if(hn)hn.addEventListener("keydown",Br);else throw new Error(Qi+"URL input is missing");if(dn)dn.addEventListener("keydown",Br);else throw new Error(Qi+"ID input is missing");if(fn)fn.addEventListener("keydown",Br);else throw new Error(Qi+"Hash input is missing");if(Mo)Mo.addEventListener("click",Sm);else throw new Error(Qi+"search button is missing");if(Po)Po.addEventListener("change",Tm);else throw new Error(Qi+"file input is missing");if(Ca)Ca.addEventListener("drop",Lm),Ca.addEventListener("dragover",Cm);else throw new Error(Qi+"file drop zone is missing");function Br(i){const t=i.target;i.key==="Enter"&&t.value!==""&&(t.classList.contains("input__intro-url")&&Me({link:t.value}),t.classList.contains("input__intro-id")&&Me({id:t.value}),t.classList.contains("input__intro-hash")&&Me({hash:t.value}))}function Sm(i){if(hn&&hn.value!==""){Me({link:hn.value});return}if(dn&&dn.value!==""){Me({id:dn.value});return}if(fn&&fn.value!==""){Me({hash:fn.value});return}}function Tm(i){const t=i.target;wt.status("info","Reading file input",0);const e=t.files?t.files[0]:null;try{if(e==null)throw wt.status("info","No file input",0),new Error("No file input");if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(e),n.addEventListener("load",()=>{Me({file:e})})}else throw new Error("Unsupported file format, please enter zip file")}catch(n){wt.status("error",n,0),console.error(n)}}function Lm(i){i.preventDefault(),i.stopPropagation();try{if(i.dataTransfer==null)throw new Error("No file input");if(i.dataTransfer.items&&i.dataTransfer.items[0].kind==="file"){let t=i.dataTransfer.items[0].getAsFile();if(t&&(t.name.substr(-4)===".zip"||t.name.substr(-4)===".bsl")){const e=new FileReader;e.readAsArrayBuffer(t),e.addEventListener("load",()=>{Me({file:t})})}else throw new Error("Unsupported file format, please enter zip file")}}catch(t){wt.status("error",t,0),console.error(t)}}function Cm(i){i.preventDefault(),i.stopPropagation()}const km=document.querySelector("body"),xm=["Dark","Light","Monochrome"],$r={list:xm,set:i=>{km.className="theme-"+i.toLowerCase().replace(" ","")}},we="UI Settings: ",Un=document.querySelector(".settings__theme"),Ka=document.querySelector(".settings__beat-numbering"),Qa=document.querySelector(".settings__rounding"),tr=document.querySelector(".settings__info-height"),er=document.querySelector(".settings__data-check"),ir=document.querySelector(".settings__data-error"),Or=document.querySelectorAll(".settings__load"),pa=document.querySelector(".settings__sort"),Mr=document.querySelectorAll(".settings__show"),Pr=document.querySelectorAll(".settings__onload"),Fo=document.querySelector(".settings__clear-button");if(Un)Un.addEventListener("change",Rm),$r.list.forEach(i=>{const t=document.createElement("option");t.value=i,t.textContent=i,Un.add(t)});else throw new Error(we+"theme select is missing");if(Ka)Ka.addEventListener("change",Nm);else throw new Error(we+"missing settings");if(Qa)Qa.addEventListener("change",Im);else throw new Error(we+"missing settings");if(tr)tr.addEventListener("change",Am);else throw new Error(we+"missing settings");if(er)er.addEventListener("change",Bm);else throw new Error(we+"missing settings");if(ir)ir.addEventListener("change",$m);else throw new Error(we+"missing settings");Or.length||console.error(we+"empty load list, intentional or typo error?");Or.forEach(i=>i.addEventListener("change",Hm));if(pa)pa.addEventListener("change",Pm);else throw new Error(we+"sort check is missing");Pr.length||console.error(we+"empty onload list, intentional or typo error?");Pr.forEach(i=>i.addEventListener("change",Xm));Mr.length||console.error(we+"empty show list, intentional or typo error?");Mr.forEach(i=>i.addEventListener("change",Om));if(Fo)Fo.addEventListener("click",su);else throw new Error(we+"clear button is missing");function Rm(i){const t=i.target;it.theme=t.options[t.options.selectedIndex].value,$r.set(it.theme),it.save()}function Nm(i){const t=i.target;it.beatNumbering=t.options[t.options.selectedIndex].value,it.save()}function Im(i){const t=i.target;it.rounding=parseInt(t.value),it.save()}function Am(i){const t=i.target;it.infoRowHeight=parseInt(t.value),ml(it.infoRowHeight),it.save()}function Bm(i){const t=i.target;it.dataCheck=t.checked,it.save()}function $m(i){const t=i.target;it.dataError=t.checked,it.save()}function Om(i){const t=i.target,e=t.id.replace("settings__show-","");it.show[e]=t.checked,it.save()}function Mm(i,t){Mr.forEach(e=>{e.id.endsWith(i)&&(e.checked=t)})}function Pm(i){const t=i.target;it.sorting=t.checked,it.save()}function Fm(i){pa&&(pa.checked=i)}function Hm(i){const t=i.target,e=t.name;it.load[e]=t.checked,it.save()}function zm(i,t){Or.forEach(e=>{e.name===i&&(e.checked=t)})}function Xm(i){const t=i.target,e=t.name;it.onLoad[e]=t.checked,it.save()}function jm(i,t){Pr.forEach(e=>{e.name===i&&(e.checked=t)})}function Ym(i){Un.value=i}function Um(i){Ka.value=i}function Gm(i){Qa.value=i.toString()}function Wm(i){tr.value=i.toString(),ml(it.infoRowHeight)}function Vm(i){er.checked=i}function Jm(i){ir.checked=i}function su(){it.clear(),it.reset(),location.reload()}const Le={setShowCheck:Mm,setSortCheck:Fm,setLoadCheck:zm,setOnLoadCheck:jm,setTheme:Ym,setBeatNumbering:Um,setRounding:Gm,setInfoHeight:Wm,setDataCheck:Vm,setDataError:Jm,clear:su},qm=document.querySelectorAll(".input__reset-button");qm.forEach(i=>i.addEventListener("click",Zm));function Zm(){wt.reset(),Xt.reset(),Bu(),Ni.reset(),fm(),lt.clear()}const Km=2,Qm=5,tp=7,ep="Kival Evan#5480",Ho=new class{constructor(){$(this,"_version",`${Km}.${Qm}.${tp}`);$(this,"_wm",ep)}get value(){return this._version}get watermark(){return this._wm}},ip="UI Footer: ",ou=document.querySelectorAll(".link__watermark"),lu=document.querySelectorAll(".link__version");(!ou.length||!lu.length)&&console.error(ip+"missing part");const zo={setWatermark:i=>{ou.forEach(t=>t.textContent=i)},setVersion:i=>{lu.forEach(t=>t.textContent=i)}},np=function(){let i=!1;return function(){if(!i){i=!0,zo.setWatermark(Ho.watermark),zo.setVersion(Ho.value),Ni.populateTool(),Le.setTheme(it.theme),Le.setBeatNumbering(it.beatNumbering),Le.setRounding(it.rounding),Le.setInfoHeight(it.infoRowHeight),Le.setDataCheck(it.dataCheck),Le.setDataError(it.dataError);for(const t in it.load)Le.setLoadCheck(t,it.load[t]);Le.setSortCheck(it.sorting);for(const t in it.show)Yo.show(t,it.show[t]),Le.setShowCheck(t,it.show[t]);for(const t in it.onLoad)Le.setOnLoadCheck(t,it.onLoad[t]);$r.set(it.theme),et.info("User interface initialised")}}}();(function(){np();const i=new URL(location.href),t=i.searchParams.get("url"),e=i.searchParams.get("id"),n=i.searchParams.get("hash");(e||t||n)&&Me({link:t,id:e,hash:n})})();
