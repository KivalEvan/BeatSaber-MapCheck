var Mc=Object.defineProperty,Oc=Object.defineProperties;var Pc=Object.getOwnPropertyDescriptors;var Ir=Object.getOwnPropertySymbols;var Fc=Object.prototype.hasOwnProperty,Hc=Object.prototype.propertyIsEnumerable;var Ar=(t,e,n)=>e in t?Mc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Zn=(t,e)=>{for(var n in e||(e={}))Fc.call(e,n)&&Ar(t,n,e[n]);if(Ir)for(var n of Ir(e))Hc.call(e,n)&&Ar(t,n,e[n]);return t},Jn=(t,e)=>Oc(t,Pc(e));const jc=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}};jc();var xs=(t=>(t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy",t))(xs||{});const zc="UI Accordion: ",Kn="accordion__",Rs=document.querySelectorAll(".accordion__button");Rs.length||console.error(zc+"empty accordion list, intentional or typo error?");var Is={create:(t,e,n,i=!1)=>{const r=document.createElement("div");r.className="accordion";const a=document.createElement("input");a.className=Kn+"button",a.id=t,a.setAttribute("type","checkbox");const s=document.createElement("label");s.className=Kn+"label unselectable",s.htmlFor=t,s.textContent=e,n&&s.classList.add(xs[n]);const o=document.createElement("div");return o.className=i?Kn+"collapsible-flex":Kn+"collapsible",o.id=t+"-content",r.appendChild(a),r.appendChild(s),r.appendChild(o),r},show:(t,e)=>{Rs.forEach(n=>{n.id.endsWith(t)&&(n.checked=e)})}};const Br=new Map([[0,"VERBOSE"],[1,"DEBUG"],[2,"INFO"],[3,"WARN"],[4,"!!ERROR!!"],[5,"NONE"]]);var nt=new class{constructor(){this.logLevel=2}log(e,...n){if(e<this.logLevel)return;const i=[Br.get(e),">",...n];switch(e){case 1:return console.debug(...i);case 2:return console.info(...i);case 3:return console.warn(...i);case 4:return console.error(...i);default:return console.log(...i)}}setLevel(e){e=Math.min(e,5),this.logLevel=e,this.info("[logger::setLevel]",`Log level set to ${Br.get(e)}`)}verbose(...e){this.log(0,...e)}debug(...e){this.log(1,...e)}info(...e){this.log(2,...e)}warn(...e){this.log(3,...e)}error(...e){this.log(4,...e)}};const Xc=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),O=(t,e=0)=>Math.round(t*Math.pow(10,e))/Math.pow(10,e),Ji=t=>t*(180/Math.PI),hn=t=>t*(Math.PI/180),$r=(t,e)=>{e<0&&(e=-e);const n=t%e;return n<0?n+e:n},Nr=(t,e,n)=>Math.min($r(t-e,n),$r(e-t,n)),Yi=t=>{if(t.length===0)return 0;t.sort((n,i)=>n-i);const e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2},Uc=(t,e,n)=>Math.min(Math.max(e,t),n),ui=t=>[t.r,t.g,t.b],Qn=t=>{const e=t.toString(16);return e.length===1?"0"+e:e},Gc=t=>t>1&&!(t<0)?255:O(t*255),Lt=t=>{if(!t)return null;const e={r:0,g:0,b:0};for(const n in t){const i=t[n];i!==void 0&&(e[n]=Gc(i))}return`#${Qn(e.r)}${Qn(e.g)}${Qn(e.b)}${e.a?Qn(e.a):""}`},Mr=t=>{let e=t[0],n=t[1],i=t[2],r,a,s;return e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,r=(e*.4124+n*.3576+i*.1805)/.95047,a=(e*.2126+n*.7152+i*.0722)/1,s=(e*.0193+n*.1192+i*.9505)/1.08883,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,[116*a-16,500*(r-a),200*(a-s)]},Or=(t,e)=>{let n=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(n=0),t<0&&(n=180),t>0&&e<0&&(n=360),Ji(Math.atan(e/t))+n)},Ki=(t,e)=>{const[n,i,r]=Mr(t),[a,s,o]=Mr(e),c=1,l=1,u=1;let p,g,d,m,_,b,y,v,S,D,k,F,M,X,$,G,K,C,N,h;return p=Math.sqrt(i*i+r*r),g=Math.sqrt(s*s+o*o),d=(p+g)/2,_=.5*(1-Math.sqrt((d^7)/((d^7)+30))),S=(1+_)*i,p=Math.sqrt(S*S+r*r),b=Or(S,r),S=(1+_)*s,g=Math.sqrt(S*S+o*o),y=Or(S,o),C=a-n,N=g-p,p*g==0?h=0:(S=O(y-b,12),Math.abs(S)<=180?h=y-b:S>180?h=y-b-360:h=y-b+360),h=2*Math.sqrt(p*g)*Math.sin(hn(h/2)),D=(n+a)/2,m=(p+g)/2,p*g==0?v=b+y:(S=Math.abs(O(b-y,12)),S>180?y+b<360?v=b+y+360:v=b+y-360:v=b+y,v/=2),k=1-.17*Math.cos(hn(v-30))+.24*Math.cos(hn(2*v))+.32*Math.cos(hn(3*v+6))-.2*Math.cos(hn(4*v-63)),$=30*Math.exp(-((v-275)/25)*((v-275)/25)),G=2*Math.sqrt((m^7)/((m^7)+30)),F=1+.015*((D-50)*(D-50))/Math.sqrt(20+(D-50)*(D-50)),M=1+.045*m,X=1+.015*m*k,K=-Math.sin(hn(2*$))*G,C=C/(c*F),N=N/(l*M),h=h/(u*X),Math.sqrt(C*C+N*N+h*h+K*N*h)},Yc=t=>`[utils::misc::${t}]`,As=t=>/[a-fA-F0-9]*/g.test(t),Ct=t=>(typeof t!="object"&&nt.error(Yc("deepCopy"),"Received non-object type"),JSON.parse(JSON.stringify(t))),Dt=t=>{if(!t)return"0:00";const e=Math.floor(t),n=e/60,i=n<0?`-${Math.ceil(n).toString()}`:Math.floor(n).toString(),r=Math.abs(e%60).toString().padStart(2,"0");return`${i}:${r}`},Vc=t=>{if(!t)return"0:00:00";const e=Math.round(t*60%60).toString().padStart(2,"0");return`${Dt(t)}:${e}`},Bs=t=>{var n;if(!t)return"0:00.000";const e=((n=(t%1).toString().split(".")[1])==null?void 0:n.padEnd(3,"0").slice(0,3))||"000";return`${Dt(t)}.${e}`},$s=t=>{const e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")},Ns=t=>{const e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")},Qi=t=>{for(let e=t.options.length-1;e>=0;e--)t.remove(e)},Na="UI Header: ",ta=document.querySelector(".intro"),ea=document.querySelector(".metadata"),tn=document.querySelector(".cover__link"),Ma=document.querySelector(".cover__image"),Ms=document.querySelector(".metadata__song-name"),Os=document.querySelector(".metadata__song-subname"),Ps=document.querySelector(".metadata__song-author"),Fs=document.querySelector(".metadata__song-bpm"),na=document.querySelector(".metadata__song-duration"),Hs=document.querySelector(".audio"),Wc="";if(!ta||!ea)throw new Error(Na+"header component is missing one of the two section");if(!tn||!Ma)throw new Error(Na+"cover component is missing");if(!Ms||!Os||!Ps||!Fs||!na)throw new Error(Na+"metadata component is missing one of the part");const js=t=>{t?(ta.classList.remove("hidden"),ea.classList.add("hidden")):(ta.classList.add("hidden"),ea.classList.remove("hidden"))},zs=t=>{Ma.src=t||"./img/unknown.jpg"},qc=()=>Ma.src,Xs=(t,e)=>{if(t==null&&e==null){tn.textContent="",tn.href="",tn.classList.add("disabled");return}t!=null&&(tn.textContent=e!=null?e:"Download Link",tn.href=t,tn.classList.remove("disabled"))},Zc=t=>{Ms.textContent=t},Jc=t=>{Os.textContent=t},Kc=t=>{Ps.textContent=t},Qc=(t,e,n)=>{let i=O(t,2).toString()+"BPM";Fs.textContent=i},Us=t=>{t?na.textContent=Bs(t):na.textContent="No audio"},tu=async t=>{const e=new Blob([t],{type:"audio/ogg"});Hs.src=window.URL.createObjectURL(e)},Gs=()=>{Hs.src="",window.URL.revokeObjectURL(Wc)},eu=()=>{js(!0),zs(null),Xs(),Us(0),Gs()};var Ot={switchHeader:js,setCoverImage:zs,getCoverImage:qc,setCoverLink:Xs,setSongName:Zc,setSongSubname:Jc,setSongAuthor:Kc,setSongBPM:Qc,setSongDuration:Us,setAudio:tu,unloadAudio:Gs,reset:eu},Ys=(t=>(t.tiny="panel--tiny",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t.max="panel--max",t))(Ys||{}),Vs=(t=>(t.normal="panel--offset",t.half="panel--offset-half",t.none="",t))(Vs||{}),ri={create:(t,e,n,i)=>{const r=document.createElement("div");return r.className=`panel ${Ys[t]}`,e&&e!=="none"&&r.classList.add(Vs[e]),n&&r.classList.add("panel--flex"+i?"-column":""),r}},gn=new class{constructor(){this.loading={info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1}}resetLoad(){this.loading.info=!1,this.loading.difficulty=!1,this.loading.analysis=!1,this.loading.audio=!1,this.loading.coverImage=!1,this.loading.contributorImage=!1,this.loading.finished=!1}},rt=new class{constructor(){this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}retrieveSafe(){if(!this.beatmapInfo)throw new Error("Beatmap info is not loaded.");if(!this.analysis)throw new Error("Beatmap analysis is not loaded.");if(this.duration===null)throw new Error("Audio is not loaded.");if(gn.loading.finished)return{beatmapInfo:this.beatmapInfo,beatmapDifficulty:this.beatmapDifficulty,contributors:this.contributors,analysis:this.analysis,duration:this.duration};throw new Error("Could not retrieve saved data, loading process is not finished.")}clear(){gn.loading.finished=!1,this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}};const Pr={version:1,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",rounding:3,theme:"Dark",onLoad:{stats:!1},show:{info:!1,tools:!1,stats:!1,settings:!1}};var it=new class{constructor(){this.property=Ct(Pr),this.stringify=()=>JSON.stringify({settings:this.property}),this.init=()=>{var n,i;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const r=JSON.parse(e);if(!((n=r.settings)!=null&&n.version)){this.clear();return}this.property=(i=r.settings)!=null?i:this.property,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this.property=Ct(Pr)},this.init()}get version(){return this.property.version}get load(){return this.property.load}get sorting(){return this.property.sorting}set sorting(e){this.property.sorting=e}get beatNumbering(){return this.property.beatNumbering}set beatNumbering(e){this.property.beatNumbering=e}get rounding(){return this.property.rounding}set rounding(e){this.property.rounding=e}get theme(){return this.property.theme}set theme(e){this.property.theme=e}get onLoad(){return this.property.onLoad}get show(){return this.property.show}};const Ws=class{constructor(t,e=[],n=0){this._bpm=t,this._offset=n/1e3,this._bpmChange=this.getBPMChangeTime([...e])}get value(){return this._bpm}set value(t){this._bpm=t}get change(){return this._bpmChange}set change(t){this._bpmChange=this.getBPMChangeTime([...t])}get offset(){return this._offset*1e3}set offset(t){this._offset=t/1e3}getBPMChangeTime(t=[]){var i;let e;const n=[];for(let r=0;r<t.length;r++){const a={_BPM:(i=t[r]._BPM)!=null?i:t[r]._bpm,_time:t[r]._time,_beatsPerBar:t[r]._beatsPerBar,_metronomeOffset:t[r]._metronomeOffset,_newTime:0};e?a._newTime=Math.ceil((a._time-e._time)/this._bpm*e._BPM+e._newTime-.01):a._newTime=Math.ceil(a._time-this._offset*this._bpm/60-.01),n.push(a),e=a}return n}offsetBegone(t){return(this.toRealTime(t)-this._offset)*this._bpm/60}toRealTime(t){return t/this._bpm*60}toBeatTime(t){return t*this._bpm/60}toJSONTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e]._newTime)return(t-this._bpmChange[e]._newTime)/this._bpmChange[e]._BPM*this._bpm+this._bpmChange[e]._time;return(this.toRealTime(t)+this._offset)*this._bpm/60}adjustTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e]._time)return(t-this._bpmChange[e]._time)/this._bpm*this._bpmChange[e]._BPM+this._bpmChange[e]._newTime;return this.offsetBegone(t)}};let be=Ws;be.create=(t,e,n)=>new Ws(t,e,n);var Oa=(t=>(t.Standard="Standard",t.NoArrows="No Arrows",t.OneSaber="One Saber",t["360Degree"]="360 Degree",t["90Degree"]="90 Degree",t.Lightshow="Lightshow",t.Lawless="Lawless",t))(Oa||{}),ia=(t=>(t[t.Standard=0]="Standard",t[t.NoArrows=1]="NoArrows",t[t.OneSaber=2]="OneSaber",t[t["360Degree"]=3]="360Degree",t[t["90Degree"]=4]="90Degree",t[t.Lightshow=5]="Lightshow",t[t.Lawless=6]="Lawless",t))(ia||{});const Ut={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",GlassDesertEnvironment:"Glass Desert"},nu={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},Gt={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.5320754,g:.5320754,b:.5320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}},he=4,Jt={[0]:180,[1]:0,[2]:270,[3]:90,[4]:225,[5]:135,[6]:315,[7]:45,[8]:0},iu={[0]:1,[1]:0,[2]:3,[3]:2,[4]:7,[5]:6,[6]:5,[7]:4,[8]:8},Ae={[0]:[0,1],[1]:[0,-1],[2]:[-1,0],[3]:[1,0],[4]:[-1,1],[5]:[1,1],[6]:[-1,-1],[7]:[1,-1],[8]:[0,0]},au={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60};var Hn=(t=>(t.Easy="Easy",t.Normal="Normal",t.Hard="Hard",t.Expert="Expert",t.ExpertPlus="Expert+",t))(Hn||{});const ru={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",GlassDesertEnvironment:"Glass Desert"},Be={DefaultEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,5,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,5,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,5,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]]},an=class{constructor(t,e=10,n=0){this._bpm=t,this._njs=e,this._sdm=n,this.update()}get value(){return this._njs}set value(t){this._njs=t,this.update()}get offset(){return this._sdm}set offset(t){this._sdm=t,this.update()}get hjd(){return this._hjd}get hjdMin(){return an.HJD_MIN}get reactTime(){return this._reactionTime}get jd(){return this._jd}get jdMin(){return this._jdMin}update(){this._hjd=this.calcHalfJumpDuration(),this._jd=this.calcJumpDistance(),this._jdMin=this.calcJumpDistance(an.HJD_MIN),this._reactionTime=this.calcReactionTimeFromHJD()}calcHalfJumpDurationRaw(){const e=this._njs*this._njs/this._njs,n=60/this._bpm.value;let i=an.HJD_START;for(;e*n*i>17.999;)i/=2;return i<1&&(i=1),i}calcHalfJumpDuration(t=this.offset){return Math.max(this.calcHalfJumpDurationRaw()+t,an.HJD_MIN)}calcHalfJumpDurationFromJD(t=this.calcJumpDistance()){return t/(60/this._bpm.value*this._njs*2)}calcHalfJumpDurationFromRT(t=this.calcReactionTimeFromHJD()){return t/(60/this._bpm.value)}calcJumpDistance(t=this.calcHalfJumpDuration()){return this._njs*(60/this._bpm.value)*t*2}calcJumpDistanceOptimalHigh(){return 18*(1/1.07)**this._njs+18}calcJumpDistanceOptimalLow(){return-(18/(this._njs+1))+18}calcReactionTimeFromJD(t=this.calcJumpDistance()){return t/(2*this._njs)}calcReactionTimeFromHJD(t=this.calcHalfJumpDuration()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let $e=an;$e.HJD_START=4;$e.HJD_MIN=.25;$e.create=(t,e=10,n=0)=>typeof t=="number"?new an(be.create(t),e,n):new an(t,e,n);$e.FallbackNJS={ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10};const ou=(t,e)=>{const n=Fr(t),i=Fr(e);for(const r in n){if(n[r]<i[r])return"old";if(n[r]>i[r])return"new"}return"current"},Fr=t=>t.replace("v","").split(".").map(e=>parseInt(e));class Wt{constructor(e){this.data=e}serialize(){return JSON.stringify(this.toObject())}clone(){const e=Ct(this.data),n=new this.constructor;return n.data=e,n}}class ji extends Wt{get time(){return this.data._time}set time(e){this.data._time=e}get customData(){return this.data._customData}set customData(e){this.data._customData=e}setTime(e){return this.time=e,this}setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return this.customData&&delete this.customData[e],this}addCustomData(e){return this.customData=Jn(Zn({},this.customData),{object:e}),this}}const Nt=class extends ji{constructor(t){super(t),this.isNote=()=>this.type===0||this.type===1,this.isBomb=()=>this.type===3,this.getPosition=()=>this.customData._position?[this.customData._position[0],this.customData._position[1]]:[(this.lineIndex<=-1e3?this.lineIndex/1e3:this.lineIndex>=1e3?this.lineIndex/1e3:this.lineIndex)-2,this.lineLayer<=-1e3?this.lineLayer/1e3:this.lineLayer>=1e3?this.lineLayer/1e3:this.lineLayer],this.getAngle=()=>this.customData._cutDirection?this.customData._cutDirection>0?this.customData._cutDirection%360:360+this.customData._cutDirection%360:this.cutDirection>=1e3?Math.abs(this.cutDirection%1e3%360-360):Jt[this.cutDirection]||0,this.getDistance=e=>{const[n,i]=this.getPosition(),[r,a]=e.getPosition();return Math.sqrt(Math.pow(r-n,2)+Math.pow(a-i,2))},this.isVertical=e=>{const[n]=this.getPosition(),[i]=e.getPosition(),r=n-i;return r>-.001&&r<.001},this.isHorizontal=e=>{const[n,i]=this.getPosition(),[r,a]=e.getPosition(),s=i-a;return s>-.001&&s<.001},this.isDiagonal=e=>{const[n,i]=this.getPosition(),[r,a]=e.getPosition(),s=Math.abs(n-r),o=Math.abs(i-a);return s===o},this.isInline=(e,n=.5)=>this.getDistance(e)<=n,this.isDouble=(e,n)=>{for(let i=n,r=e.length;i<r;i++){if(e[i].time<this.time+.01&&e[i].type!==this.type)return!0;if(e[i].time>this.time+.01)return!1}return!1},this.isAdjacent=e=>{const n=this.getDistance(e);return n>.499&&n<1.001},this.isWindow=e=>this.getDistance(e)>1.8,this.isSlantedWindow=e=>this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e),this.hasChroma=()=>Array.isArray(this.customData._color)||typeof this.customData._disableSpawnEffect=="boolean",this.hasNoodleExtensions=()=>Array.isArray(this.customData._animation)||typeof this.customData._cutDirection=="number"||typeof this.customData._disableNoteGravity=="boolean"||typeof this.customData._disableNoteLook=="boolean"||typeof this.customData._fake=="boolean"||Array.isArray(this.customData._flip)||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||typeof this.customData._track=="string",this.hasMappingExtensions=()=>this.cutDirection>=1e3||this.lineIndex>3||this.lineIndex<0||this.lineLayer>2||this.lineLayer<0,this.isValidDirection=()=>this.cutDirection>=0&&this.cutDirection<=8,this.isValid=()=>!this.hasMappingExtensions()&&this.isValidDirection()}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c;return e.push(new Nt({_time:(i=n._time)!=null?i:Nt.default._time,_lineIndex:(r=n._lineIndex)!=null?r:Nt.default._lineIndex,_lineLayer:(a=n._lineLayer)!=null?a:Nt.default._lineLayer,_type:(s=n._type)!=null?s:Nt.default._type,_cutDirection:(o=n._cutDirection)!=null?o:Nt.default._cutDirection,_customData:(c=n._customData)!=null?c:Nt.default._customData()}))}),e.length===1?e[0]:e.length?e:new Nt({_time:Nt.default._time,_lineIndex:Nt.default._lineIndex,_lineLayer:Nt.default._lineLayer,_type:Nt.default._type,_cutDirection:Nt.default._cutDirection,_customData:Nt.default._customData()})}toObject(){return{_time:this.time,_type:this.type,_lineIndex:this.lineIndex,_lineLayer:this.lineLayer,_cutDirection:this.cutDirection,_customData:Ct(this.customData)}}get lineIndex(){return this.data._lineIndex}set lineIndex(t){this.data._lineIndex=t}get lineLayer(){return this.data._lineLayer}set lineLayer(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get cutDirection(){return this.data._cutDirection}set cutDirection(t){this.data._cutDirection=t}setLineIndex(t){return this.lineIndex=t,this}setLineLayer(t){return this.lineLayer=t,this}setType(t){return this.type=t,this}setCutDirection(t){return this.cutDirection=t,this}};let aa=Nt;aa.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0,_customData:()=>({})};const gt=class extends Wt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c,l,u,p,g,d,m,_,b;return e.push(new gt({_colorType:(i=n._colorType)!=null?i:gt.default._colorType,_headTime:(a=(r=n._headTime)!=null?r:n._tailTime)!=null?a:gt.default._headTime,_headLineIndex:(s=n._headLineIndex)!=null?s:gt.default._headLineIndex,_headLineLayer:(o=n._headLineLayer)!=null?o:gt.default._headLineLayer,_headCutDirection:(c=n._headCutDirection)!=null?c:gt.default._headCutDirection,_headControlPointlengthMultiplier:(l=n._headControlPointlengthMultiplier)!=null?l:gt.default._headControlPointlengthMultiplier,_tailTime:(p=(u=n._tailTime)!=null?u:n._headTime)!=null?p:gt.default._tailTime,_tailLineIndex:(g=n._tailLineIndex)!=null?g:gt.default._tailLineIndex,_tailLineLayer:(d=n._tailLineLayer)!=null?d:gt.default._tailLineLayer,_tailCutDirection:(m=n._tailCutDirection)!=null?m:gt.default._tailCutDirection,_tailControlPointLengthMultiplier:(_=n._tailControlPointLengthMultiplier)!=null?_:gt.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:(b=n._sliderMidAnchorMode)!=null?b:gt.default._sliderMidAnchorMode}))}),e.length===1?e[0]:e.length?e:new gt({_colorType:gt.default._colorType,_headTime:gt.default._headTime,_headLineIndex:gt.default._headLineIndex,_headLineLayer:gt.default._headLineLayer,_headCutDirection:gt.default._headCutDirection,_headControlPointlengthMultiplier:gt.default._headControlPointlengthMultiplier,_tailTime:gt.default._tailTime,_tailLineIndex:gt.default._tailLineIndex,_tailLineLayer:gt.default._tailLineLayer,_tailCutDirection:gt.default._tailCutDirection,_tailControlPointLengthMultiplier:gt.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:gt.default._sliderMidAnchorMode})}toObject(){return{_colorType:this.colorType,_headTime:this.headTime,_headLineIndex:this.headLineIndex,_headLineLayer:this.headLineLayer,_headCutDirection:this.headCutDirection,_headControlPointlengthMultiplier:this.headLengthMultiplier,_tailTime:this.tailTime,_tailLineIndex:this.tailLineIndex,_tailLineLayer:this.tailLineLayer,_tailCutDirection:this.tailCutDirection,_tailControlPointLengthMultiplier:this.tailLengthMultiplier,_sliderMidAnchorMode:this.midAnchor}}get colorType(){return this.data._colorType}set colorType(t){this.data._colorType=t}get headTime(){return this.data._headTime}set headTime(t){this.data._headTime=t}get headLineIndex(){return this.data._headLineIndex}set headLineIndex(t){this.data._headLineIndex=t}get headLineLayer(){return this.data._headLineLayer}set headLineLayer(t){this.data._headLineLayer=t}get headCutDirection(){return this.data._headCutDirection}set headCutDirection(t){this.data._headCutDirection=t}get headLengthMultiplier(){return this.data._headControlPointlengthMultiplier}set headLengthMultiplier(t){this.data._headControlPointlengthMultiplier=t}get tailTime(){return this.data._tailTime}set tailTime(t){this.data._tailTime=t}get tailLineIndex(){return this.data._tailLineIndex}set tailLineIndex(t){this.data._tailLineIndex=t}get tailLineLayer(){return this.data._tailLineLayer}set tailLineLayer(t){this.data._tailLineLayer=t}get tailCutDirection(){return this.data._tailCutDirection}set tailCutDirection(t){this.data._tailCutDirection=t}get tailLengthMultiplier(){return this.data._tailControlPointLengthMultiplier}set tailLengthMultiplier(t){this.data._tailControlPointLengthMultiplier=t}get midAnchor(){return this.data._sliderMidAnchorMode}set midAnchor(t){this.data._sliderMidAnchorMode=t}setColor(t){return this.colorType=t,this}setPosX(t){return this.headLineIndex=t,this}setPosY(t){return this.headLineLayer=t,this}setDirection(t){return this.headCutDirection=t,this}setLengthMultiplier(t){return this.headLengthMultiplier=t,this}setTailTime(t){return this.tailTime=t,this}setTailPosX(t){return this.tailLineIndex=t,this}setTailPosY(t){return this.tailLineLayer=t,this}setTailDirection(t){return this.tailCutDirection=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0){switch(this.headLineIndex=he-1-this.headLineIndex,this.tailLineIndex=he-1-this.tailLineIndex,t&&(this.colorType=(1+this.colorType)%2),this.headCutDirection){case 2:this.headCutDirection=3;break;case 3:this.headCutDirection=2;break;case 6:this.headCutDirection=7;break;case 7:this.headCutDirection=6;break;case 4:this.headCutDirection=5;break;case 5:this.headCutDirection=4;break}switch(this.tailCutDirection){case 2:this.tailCutDirection=3;break;case 3:this.tailCutDirection=2;break;case 6:this.tailCutDirection=7;break;case 7:this.tailCutDirection=6;break;case 4:this.tailCutDirection=5;break;case 5:this.tailCutDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),this}hasMappingExtensions(){return this.headLineLayer>2||this.headLineLayer<0||this.headLineIndex<=-1e3||this.headLineIndex>=1e3||this.headCutDirection>=1e3&&this.headCutDirection<=1360||this.tailCutDirection>=1e3&&this.tailCutDirection<=1360}};let ra=gt;ra.default={_colorType:0,_headTime:0,_headLineIndex:0,_headLineLayer:0,_headCutDirection:0,_headControlPointlengthMultiplier:.5,_tailTime:0,_tailLineIndex:0,_tailLineLayer:0,_tailCutDirection:0,_tailControlPointLengthMultiplier:.5,_sliderMidAnchorMode:0};const kt=class extends ji{constructor(t){super(t),this.getPosition=()=>this.customData._position?[this.customData._position[0],this.customData._position[1]]:[(this.lineIndex<=-1e3?this.lineIndex/1e3:this.lineIndex>=1e3?this.lineIndex/1e3:this.lineIndex)-2,this.type<=-1e3?this.type/1e3:this.type>=1e3?this.type/1e3:this.type],this.isInteractive=()=>this.width>=2||this.lineIndex===1||this.lineIndex===2,this.isCrouch=()=>this.type===1&&(this.width>2||this.width===2&&this.lineIndex===1),this.isZero=()=>this.duration===0||this.width===0,this.isLonger=(e,n,i=0)=>e._time+e._duration>n._time+n._duration+i,this.hasChroma=()=>Array.isArray(this.customData._color),this.hasNoodleExtensions=()=>Array.isArray(this.customData._animation)||typeof this.customData._fake=="boolean"||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||Array.isArray(this.customData._scale)||typeof this.customData._track=="string",this.hasMappingExtensions=()=>this.width>=1e3||this.type>=1e3||this.lineIndex>3||this.lineIndex<0,this.isValid=()=>!this.hasMappingExtensions()&&this.width>0&&this.width<=4}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c,l,u;return e.push(new kt({_time:(i=n._time)!=null?i:kt.default._time,_type:(r=n._type)!=null?r:kt.default._type,_lineIndex:(a=n._lineIndex)!=null?a:kt.default._lineIndex,_lineLayer:(s=n._lineLayer)!=null?s:kt.default._lineLayer,_duration:(o=n._duration)!=null?o:kt.default._duration,_width:(c=n._width)!=null?c:kt.default._width,_height:(l=n._height)!=null?l:kt.default._height,_customData:(u=n._customData)!=null?u:kt.default._customData()}))}),e.length===1?e[0]:e.length?e:new kt({_time:kt.default._time,_type:kt.default._type,_lineIndex:kt.default._lineIndex,_lineLayer:kt.default._lineLayer,_duration:kt.default._duration,_width:kt.default._width,_height:kt.default._height,_customData:kt.default._customData()})}toObject(){return{_time:this.time,_type:this.type,_lineIndex:this.lineIndex,_lineLayer:this.lineLayer,_duration:this.duration,_width:this.width,_height:this.height,_customData:Ct(this.customData)}}get lineIndex(){return this.data._lineIndex}set lineIndex(t){this.data._lineIndex=t}get lineLayer(){return this.data._lineLayer}set lineLayer(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get duration(){return this.data._duration}set duration(t){this.data._duration=t}get width(){return this.data._width}set width(t){this.data._width=t}get height(){return this.data._height}set height(t){this.data._height=t}setType(t){return this.type=t,this}setLineIndex(t){return this.lineIndex=t,this}setLineLayer(t){return this.lineLayer=t,this}setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}};let oa=kt;oa.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_duration:1,_width:1,_height:1,_customData:()=>({})};const Ft=class extends ji{constructor(t){super(t),this.isOff=()=>this.value===0,this.isOn=()=>this.value===1||this.value===5||this.value===9,this.isFlash=()=>this.value===2||this.value===6||this.value===10,this.isFade=()=>this.value===3||this.value===7||this.value===11,this.isTransition=()=>this.value===4||this.value===8||this.value===12,this.isValidType=()=>this.type>=0&&this.type<=17||this.type===100,this.isLightEvent=()=>this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11,this.isColorBoost=()=>this.type===5,this.isRingEvent=()=>this.type===8||this.type===9,this.isLaserRotationEvent=()=>this.type===12||this.type===13,this.isLaneRotationEvent=()=>this.type===14||this.type===15,this.isExtraEvent=()=>this.type===16||this.type===17||this.type===18||this.type===19,this.isSpecialEvent=()=>this.type===40||this.type===41||this.type===42||this.type===43,this.isBPMChangeEvent=()=>this.type===100,this.isLightingEvent=()=>this.isLightEvent()||this.isRingEvent()||this.isLaserRotationEvent()||this.isExtraEvent(),this.hasChroma=()=>this.isLightEvent()?Array.isArray(this.customData._color)||typeof this.customData._lightID=="number"||Array.isArray(this.customData._lightID)||typeof this.customData._propID=="number"||typeof this.customData._lightGradient=="object"||typeof this.customData._easing=="string"||typeof this.customData._lerpType=="string":this.isRingEvent()?typeof this.customData._nameFilter=="string"||typeof this.customData._reset=="boolean"||typeof this.customData._rotation=="number"||typeof this.customData._step=="number"||typeof this.customData._prop=="number"||typeof this.customData._speed=="number"||typeof this.customData._direction=="number"||typeof this.customData._counterSpin=="boolean"||typeof this.customData._stepMult=="number"||typeof this.customData._propMult=="number"||typeof this.customData._speedMult=="number":this.isLaserRotationEvent()?typeof this.customData._lockPosition=="boolean"||typeof this.customData._speed=="number"||typeof this.customData._preciseSpeed=="number"||typeof this.customData._direction=="number":!1,this.hasOldChroma=()=>this.value>=2e9,this.hasNoodleExtensions=()=>this.isLaneRotationEvent()&&typeof this.customData._rotation=="number",this.hasMappingExtensions=()=>this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720,this.isValid=()=>this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.hasOldChroma())}static create(...t){const e=[];return t.forEach(n=>{var i,r,a,s,o;return e.push(new Ft({_time:(i=n._time)!=null?i:Ft.default._time,_type:(r=n._type)!=null?r:Ft.default._type,_value:(a=n._value)!=null?a:Ft.default._value,_floatValue:(s=n._floatValue)!=null?s:Ft.default._floatValue,_customData:(o=n._customData)!=null?o:Ft.default._customData()}))}),e.length===1?e[0]:e.length?e:new Ft({_time:Ft.default._time,_type:Ft.default._type,_value:Ft.default._value,_floatValue:Ft.default._floatValue,_customData:Ft.default._customData()})}toObject(){return{_time:this.time,_type:this.type,_value:this.value,_floatValue:this.floatValue,_customData:Ct(this.customData)}}get type(){return this.data._type}set type(t){this.data._type=t}get value(){return this.data._value}set value(t){this.data._value=t}get floatValue(){return this.data._floatValue}set floatValue(t){this.data._floatValue=t}setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}};let sa=Ft;sa.default={_time:0,_type:0,_value:0,_floatValue:1,_customData:()=>({})};const Ht=class extends ji{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o;return e.push(new Ht({_time:(i=n._time)!=null?i:Ht.default._time,_lineIndex:(r=n._lineIndex)!=null?r:Ht.default._lineIndex,_lineLayer:(a=n._lineLayer)!=null?a:Ht.default._lineLayer,_offsetDirection:(s=n._offsetDirection)!=null?s:Ht.default._offsetDirection,_customData:(o=n._customData)!=null?o:Ht.default._customData()}))}),e.length===1?e[0]:e.length?e:new Ht({_time:Ht.default._time,_lineIndex:Ht.default._lineIndex,_lineLayer:Ht.default._lineLayer,_offsetDirection:Ht.default._offsetDirection,_customData:Ht.default._customData()})}toObject(){return{_time:this.time,_lineIndex:this.lineIndex,_lineLayer:this.lineLayer,_offsetDirection:this.direction,_customData:Ct(this.customData)}}get lineIndex(){return this.data._lineIndex}set lineIndex(t){this.data._lineIndex=t}get lineLayer(){return this.data._lineLayer}set lineLayer(t){this.data._lineLayer=t}get direction(){return this.data._offsetDirection}set direction(t){this.data._offsetDirection=t}setLineIndex(t){return this.lineIndex=t,this}setLineLayer(t){return this.lineLayer=t,this}setDirection(t){return this.direction=t,this}mirror(){switch(this.lineIndex=he-1-this.lineIndex,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}};let la=Ht;la.default={_time:0,_lineIndex:0,_lineLayer:0,_offsetDirection:1,_customData:()=>({})};const en=class extends Wt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r;return e.push(new en({_keyword:(i=n._keyword)!=null?i:en.default._keyword,_specialEvents:(r=n._specialEvents)!=null?r:en.default._specialEvents()}))}),e.length===1?e[0]:e.length?e:new en({_keyword:en.default._keyword,_specialEvents:en.default._specialEvents()})}toObject(){return{_keyword:this.keyword,_specialEvents:this.events}}get keyword(){return this.data._keyword}set keyword(t){this.data._keyword=t}get events(){return this.data._specialEvents}set events(t){this.data._specialEvents=t}setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const e=this.events.indexOf(t,0);return e>-1&&this.events.splice(e,1),this}};let ca=en;ca.default={_keyword:"",_specialEvents:()=>[]};const ua=class extends Wt{constructor(t){super(t),this.keywords=t._keywords.map(e=>ca.create({_keyword:e._keyword,_specialEvents:e._specialEvents}))}static create(t={}){var e;return new ua({_keywords:(e=t._keywords)!=null?e:ua.default._keywords()})}toObject(){return{_keywords:this.keywords.map(t=>t.toObject())}}setKeyword(t){return this.keywords=t,this}addKeyword(t){return this.keywords.push(ca.create(t)),this}removeKeyword(t){return this.keywords=this.keywords.filter(e=>e.keyword!==t),this}};let qs=ua;qs.default={_keywords:()=>[]};class Pa extends Wt{constructor(e){super(e),this.getFirstInteractiveTime=()=>{let n=Number.MAX_VALUE;this.notes.length>0&&(n=this.notes[0].time);const i=this.findFirstInteractiveObstacleTime();return Math.min(n,i)},this.getLastInteractiveTime=()=>{let n=0;this.notes.length>0&&(n=this.notes[this.notes.length-1].time);const i=this.findLastInteractiveObstacleTime();return Math.max(n,i)},this.findFirstInteractiveObstacleTime=()=>{for(let n=0,i=this.obstacles.length;n<i;n++)if(this.obstacles[n].isInteractive())return this.obstacles[n].time;return Number.MAX_VALUE},this.findLastInteractiveObstacleTime=()=>{let n=0;for(let i=this.obstacles.length-1;i>=0;i--)this.obstacles[i].isInteractive()&&(n=Math.max(n,this.obstacles[i].time+this.obstacles[i].duration));return n},this.addNotes=(...n)=>{n.forEach(i=>{this.notes.push(aa.create(i))})},this.addObstacles=(...n)=>{n.forEach(i=>{this.obstacles.push(oa.create(i))})},this.addEvents=(...n)=>{n.forEach(i=>{this.events.push(sa.create(i))})},this.addWaypoints=(...n)=>{n.forEach(i=>{this.waypoints.push(la.create(i))})},this.addSliders=(...n)=>{n.forEach(i=>{this.sliders.push(ra.create(i))})},this.version="2.6.0",this.notes=e._notes.map(n=>aa.create(n)),this.sliders=e._sliders.map(n=>ra.create(n)),this.obstacles=e._obstacles.map(n=>oa.create(n)),this.events=e._events.map(n=>sa.create(n)),this.waypoints=e._waypoints.map(n=>la.create(n)),this.specialEventsKeywordFilters=qs.create(e._specialEventsKeywordFilters),this.customData=e._customData}static create(e={}){var n,i,r,a,s,o,c;return new Pa({_version:"2.6.0",_notes:(n=e._notes)!=null?n:[],_sliders:(i=e._sliders)!=null?i:[],_obstacles:(r=e._obstacles)!=null?r:[],_events:(a=e._events)!=null?a:[],_waypoints:(s=e._waypoints)!=null?s:[],_specialEventsKeywordFilters:(o=e._specialEventsKeywordFilters)!=null?o:{_keywords:[]},_customData:(c=e._customData)!=null?c:{}})}toObject(){var e;return{_version:this.version||"2.6.0",_notes:this.notes.map(n=>n.toObject()),_sliders:this.sliders.map(n=>n.toObject()),_obstacles:this.obstacles.map(n=>n.toObject()),_events:this.events.map(n=>n.toObject()),_waypoints:this.waypoints.map(n=>n.toObject()),_specialEventsKeywordFilters:(e=this.specialEventsKeywordFilters)==null?void 0:e.toObject(),_customData:Ct(this.customData)}}}class Oe extends Wt{get time(){return this.data.b}set time(e){this.data.b=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}setTime(e){return this.time=e,this}setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return this.customData&&delete this.customData[e],this}addCustomData(e){return this.customData=Jn(Zn({},this.customData),{object:e}),this}}const jt=class extends Oe{constructor(t){super(t),this.hasChroma=()=>this.isLightEvent()?Array.isArray(this.customData._color)||typeof this.customData._lightID=="number"||Array.isArray(this.customData._lightID)||typeof this.customData._propID=="number"||typeof this.customData._lightGradient=="object"||typeof this.customData._easing=="string"||typeof this.customData._lerpType=="string":this.isRingEvent()?typeof this.customData._nameFilter=="string"||typeof this.customData._reset=="boolean"||typeof this.customData._rotation=="number"||typeof this.customData._step=="number"||typeof this.customData._prop=="number"||typeof this.customData._speed=="number"||typeof this.customData._direction=="number"||typeof this.customData._counterSpin=="boolean"||typeof this.customData._stepMult=="number"||typeof this.customData._propMult=="number"||typeof this.customData._speedMult=="number":this.isLaserRotationEvent()?typeof this.customData._lockPosition=="boolean"||typeof this.customData._speed=="number"||typeof this.customData._preciseSpeed=="number"||typeof this.customData._direction=="number":!1}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o;return e.push(new jt({b:(i=n.b)!=null?i:jt.default.b,et:(r=n.et)!=null?r:jt.default.et,i:(a=n.i)!=null?a:jt.default.i,f:(s=n.f)!=null?s:jt.default.f,customData:(o=n.customData)!=null?o:jt.default.customData()}))}),e.length===1?e[0]:e.length?e:new jt({b:jt.default.b,et:jt.default.et,i:jt.default.i,f:jt.default.f,customData:jt.default.customData()})}toObject(){return{b:this.time,et:this.type,i:this.value,f:this.floatValue,customData:Ct(this.customData)}}get type(){return this.data.et}set type(t){this.data.et=t}get value(){return this.data.i}set value(t){this.data.i=t}get floatValue(){return this.data.f}set floatValue(t){this.data.f=t}setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}isOff(){return this.value===0}isOn(){return this.value===1||this.value===5||this.value===9}isFlash(){return this.value===2||this.value===6||this.value===10}isFade(){return this.value===3||this.value===7||this.value===11}isTransition(){return this.value===4||this.value===8||this.value===12}isValidType(){return this.type>=0&&this.type<=17||this.type===100}isLightEvent(){return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}isColorBoost(){return this.type===5}isRingEvent(){return this.type===8}isLaserRotationEvent(){return this.type===12||this.type===13}isLaneRotationEvent(){return this.type===14||this.type===15}isExtraEvent(){return this.type===16||this.type===17||this.type===18||this.type===19}isSpecialEvent(){return this.type===40||this.type===41||this.type===42||this.type===43}isBPMChangeEvent(){return this.type===100}isLightingEvent(){return this.isLightEvent()||this.isRingEvent()||this.isLaserRotationEvent()||this.isExtraEvent()}hasOldChroma(){return this.value>=2e9}isValid(){return this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.hasOldChroma())}};let hi=jt;hi.default={b:0,et:0,i:0,f:1,customData:()=>({})};const nn=class extends Wt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r;return e.push(new nn({k:(i=n.k)!=null?i:nn.default.k,e:(r=n.e)!=null?r:nn.default.e()}))}),e.length===1?e[0]:e.length?e:new nn({k:nn.default.k,e:nn.default.e()})}toObject(){return{k:this.keyword,e:this.events}}get keyword(){return this.data.k}set keyword(t){this.data.k=t}get events(){return this.data.e}set events(t){this.data.e=t}setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const e=this.events.indexOf(t,0);return e>-1&&this.events.splice(e,1),this}};let ha=nn;ha.default={k:"",e:()=>[]};const da=class extends Wt{constructor(t){super(t),this.d=t.d.map(e=>ha.create({e:e.e,k:e.k}))}static create(t={}){var e;return new da({d:(e=t.d)!=null?e:da.default.d()})}toObject(){return{d:this.list.map(t=>t.toObject())}}get list(){return this.d}set list(t){this.d=t}setData(t){return this.list=t,this}addData(t){return this.list.push(ha.create(t)),this}removeData(t){return this.list=this.list.filter(e=>e.keyword!==t),this}};let Fa=da;Fa.default={d:()=>[]};class Ha extends Oe{get posX(){return this.data.x}set posX(e){this.data.x=e}get posY(){return this.data.y}set posY(e){this.data.y=e}setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}swapPosition(e){const n=e.posX;e.posX=this.posX,this.posX=n;const i=e.posY;return e.posY=this.posY,this.posY=i,this}}const re=class extends Ha{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean",this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s;return e.push(new re({b:(i=n.b)!=null?i:re.default.b,x:(r=n.x)!=null?r:re.default.x,y:(a=n.y)!=null?a:re.default.y,customData:(s=n.customData)!=null?s:re.default.customData()}))}),e.length===1?e[0]:e.length?e:new re({b:re.default.b,x:re.default.x,y:re.default.y,customData:re.default.customData()})}toObject(){return{b:this.time,x:this.posX,y:this.posY,customData:Ct(this.customData)}}mirror(){return this.posX=he-1-this.posX,this}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}getDistance(t){const[e,n]=this.getPosition(),[i,r]=t.getPosition();return Math.sqrt(Math.pow(i-e,2)+Math.pow(r-n,2))}isVertical(t){const[e]=this.getPosition(),[n]=t.getPosition(),i=e-n;return i>-.001&&i<.001}isHorizontal(t){const[e,n]=this.getPosition(),[i,r]=t.getPosition(),a=n-r;return a>-.001&&a<.001}isDiagonal(t){const[e,n]=this.getPosition(),[i,r]=t.getPosition(),a=Math.abs(e-i),s=Math.abs(n-r);return a===s}isInline(t,e=.5){return this.getDistance(t)<=e}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t,e=1.8){return this.getDistance(t)>e}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}hasMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0}isValid(){return!this.hasMappingExtensions()}};let di=re;di.default={b:0,x:0,y:0,customData:()=>({})};const Ee=class extends Oe{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a;return e.push(new Ee({b:(i=n.b)!=null?i:Ee.default.b,m:(r=n.m)!=null?r:Ee.default.m,customData:(a=n.customData)!=null?a:Ee.default.customData()}))}),e.length===1?e[0]:e.length?e:new Ee({b:Ee.default.b,m:Ee.default.m,customData:Ee.default.customData()})}toObject(){return{b:this.time,m:this.bpm,customData:Ct(this.customData)}}get bpm(){return this.data.m}set bpm(t){this.data.m=t}setBPM(t){return this.bpm=t,this}};let fi=Ee;fi.default={b:0,m:0,customData:()=>({})};class Zs extends Ha{constructor(){super(...arguments),this.hasChroma=()=>!1,this.hasNoodleExtensions=()=>!1}get color(){return this.data.c}set color(e){this.data.c=e}get direction(){return this.data.d}set direction(e){this.data.d=e}get tailTime(){return this.data.tb}set tailTime(e){this.data.tb=e}get tailPosX(){return this.data.tx}set tailPosX(e){this.data.tx=e}get tailPosY(){return this.data.ty}set tailPosY(e){this.data.ty=e}setColor(e){return this.color=e,this}setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}setDirection(e){return this.direction=e,this}setTailTime(e){return this.tailTime=e,this}setTailPosX(e){return this.tailPosX=e,this}setTailPosY(e){return this.tailPosY=e,this}getPosition(){return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}getDistance(e){const[n,i]=this.getPosition(),[r,a]=e.getPosition();return Math.sqrt(Math.pow(r-n,2)+Math.pow(a-i,2))}isVertical(e){const[n]=this.getPosition(),[i]=e.getPosition(),r=n-i;return r>-.001&&r<.001}isHorizontal(e){const[n,i]=this.getPosition(),[r,a]=e.getPosition(),s=i-a;return s>-.001&&s<.001}isDiagonal(e){const[n,i]=this.getPosition(),[r,a]=e.getPosition(),s=Math.abs(n-r),o=Math.abs(i-a);return s===o}isInline(e,n=.5){return this.getDistance(e)<=n}isAdjacent(e){const n=this.getDistance(e);return n>.499&&n<1.001}isWindow(e,n=1.8){return this.getDistance(e)>n}isSlantedWindow(e){return this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e)}isInverse(){return this.time>this.tailTime}}const yt=class extends Zs{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c,l,u,p,g,d,m,_;return e.push(new yt({b:(r=(i=n.b)!=null?i:n.tb)!=null?r:yt.default.b,c:(a=n.c)!=null?a:yt.default.c,x:(s=n.x)!=null?s:yt.default.x,y:(o=n.y)!=null?o:yt.default.y,d:(c=n.d)!=null?c:yt.default.d,tb:(u=(l=n.tb)!=null?l:n.b)!=null?u:yt.default.tb,tx:(p=n.tx)!=null?p:yt.default.tx,ty:(g=n.ty)!=null?g:yt.default.ty,sc:(d=n.sc)!=null?d:yt.default.sc,s:(m=n.s)!=null?m:yt.default.s,customData:(_=n.customData)!=null?_:yt.default.customData()}))}),e.length===1?e[0]:e.length?e:new yt({b:yt.default.b,c:yt.default.c,x:yt.default.x,y:yt.default.y,d:yt.default.d,tb:yt.default.tb,tx:yt.default.tx,ty:yt.default.ty,sc:yt.default.sc,s:yt.default.s,customData:yt.default.customData()})}toObject(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,sc:this.sliceCount,s:this.squish,customData:Ct(this.customData)}}get sliceCount(){return this.data.sc}set sliceCount(t){this.data.sc=t}get squish(){return this.data.s}set squish(t){this.data.s=t}setSliceCount(t){return this.sliceCount=t,this}setSquish(t){return this.squish=t,this}mirror(t=!0){switch(this.posX=he-1-this.posX,this.tailPosX=he-1-this.tailPosX,t&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}getAngle(){return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):Jt[this.direction]||0}hasMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360}isValid(){return!(this.hasMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)&&!(this.posX===this.tailPosX&&this.posY===this.tailPosY)}};let fa=yt;fa.default={b:0,c:0,x:0,y:0,d:0,tb:0,tx:0,ty:0,sc:1,s:1,customData:()=>({})};const we=class extends Oe{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a;return e.push(new we({b:(i=n.b)!=null?i:we.default.b,o:(r=n.o)!=null?r:we.default.o,customData:(a=n.customData)!=null?a:we.default.customData()}))}),e.length===1?e[0]:e.length?e:new we({b:we.default.b,o:we.default.o,customData:we.default.customData()})}toObject(){return{b:this.time,o:this.toggle,customData:Ct(this.customData)}}get toggle(){return this.data.o}set toggle(t){this.data.o=t}};let mi=we;mi.default={b:0,o:!1,customData:()=>({})};const xt=class extends Ha{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean",this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c,l;return e.push(new xt({b:(i=n.b)!=null?i:xt.default.b,x:(r=n.x)!=null?r:xt.default.x,y:(a=n.y)!=null?a:xt.default.y,c:(s=n.c)!=null?s:xt.default.c,d:(o=n.d)!=null?o:xt.default.d,a:(c=n.a)!=null?c:xt.default.a,customData:(l=n.customData)!=null?l:xt.default.customData()}))}),e.length===1?e[0]:e.length?e:new xt({b:xt.default.b,x:xt.default.x,y:xt.default.y,c:xt.default.c,d:xt.default.d,a:xt.default.a,customData:xt.default.customData()})}toObject(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,a:this.angleOffset,customData:Ct(this.customData)}}get color(){return this.data.c}set color(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get angleOffset(){return this.data.a}set angleOffset(t){this.data.a=t}setColor(t){return this.color=t,this}setDirection(t){return this.direction=t,this}setAngleOffset(t){return this.angleOffset=t,this}mirror(){return this.posX=he-1-this.posX,this}swapRotation(t,e=!0){const n=t.direction;t.direction=this.direction,this.direction=n;const i=t.angleOffset;return t.angleOffset=this.angleOffset,this.angleOffset=i,e&&(t.angleOffset=0-t.angleOffset,this.angleOffset=0-this.angleOffset),this}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}getAngle(){return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):(Jt[this.direction]||0)+this.angleOffset}getDistance(t){const[e,n]=this.getPosition(),[i,r]=t.getPosition();return Math.sqrt(Math.pow(i-e,2)+Math.pow(r-n,2))}isRed(){return this.color===0}isBlue(){return this.color===1}isVertical(t){if(t){const[e]=this.getPosition(),[n]=t.getPosition(),i=e-n;return i>-.001&&i<.001}return 22.5<=Math.abs(this.getAngle())%180+90&&Math.abs(this.getAngle())%180+90<=67.5}isHorizontal(t){if(t){const[e,n]=this.getPosition(),[i,r]=t.getPosition(),a=n-r;return a>-.001&&a<.001}return 22.5<=Math.abs(this.getAngle())%180+90&&Math.abs(this.getAngle())%180+90<=67.5}isDiagonal(t){if(t){const[e,n]=this.getPosition(),[i,r]=t.getPosition(),a=Math.abs(e-i),s=Math.abs(n-r);return a===s}return 22.5<=Math.abs(this.getAngle())%90&&Math.abs(this.getAngle())%90<=67.5}isInline(t,e=.5){return this.getDistance(t)<=e}isDouble(t,e=.01){return t.time>this.time-e&&t.time<this.time+e&&this.color!==t.color}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t,e=1.8){return this.getDistance(t)>e}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}hasMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0||this.direction>=1e3&&this.direction<=1360||this.direction>=2e3&&this.direction<=2360}isValidDirection(){return this.direction>=0&&this.direction<=8}isValid(){return!this.hasMappingExtensions()&&this.isValidDirection()}};let _n=xt;_n.default={b:0,c:0,x:0,y:0,d:0,a:0,customData:()=>({})};class su extends Oe{get groupID(){return this.data.g}set groupID(e){this.data.g=e}}class Js extends su{constructor(e,n){super(e),this.e=n}toObject(){return{b:this.time,g:this.groupID,e:this.events.map(e=>e.toObject()),customData:Ct(this.customData)}}get events(){return this.e}set events(e){this.e=e}}const dn=class extends Wt{constructor(t){super(t),this.data.f===1&&(this.p0=this.p0?this.p0:1)}static create(t={}){var e,n,i,r;return new dn({f:(e=t.f)!=null?e:dn.default.f,p:(n=t.p)!=null?n:dn.default.p,t:(i=t.t)!=null?i:dn.default.t,r:(r=t.r)!=null?r:dn.default.r})}toObject(){return{f:this.type,p:this.p0,t:this.p1,r:this.reverse}}get type(){return this.data.f}set type(t){this.data.f=t}get p0(){return this.data.p}set p0(t){this.data.p=t}get p1(){return this.data.t}set p1(t){this.data.t=t}get reverse(){return this.data.r}set reverse(t){this.data.r=t}};let ge=dn;ge.default={f:1,p:0,t:0,r:0};class Ks extends Wt{constructor(e){super(e),this.f=ge.create(e.f)}get filter(){return this.f}set filter(e){this.f=e}get beatDistribution(){return this.data.w}set beatDistribution(e){this.data.w=e}get beatDistributionType(){return this.data.d}set beatDistributionType(e){this.data.d=e}setFilter(e){return this.filter=e,this}setBeatDistribution(e){return this.beatDistribution=e,this}setBeatDistributionType(e){return this.beatDistributionType=e,this}}const zt=class extends Wt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o;return e.push(new zt({b:(i=n.b)!=null?i:zt.default.b,i:(r=n.i)!=null?r:zt.default.i,c:(a=n.c)!=null?a:zt.default.c,s:(s=n.s)!=null?s:zt.default.s,f:(o=n.f)!=null?o:zt.default.f}))}),e.length===1?e[0]:e.length?e:new zt({b:zt.default.b,i:zt.default.i,c:zt.default.c,s:zt.default.s,f:zt.default.f})}toObject(){return{b:this.time,i:this.transition,c:this.color,s:this.brightness,f:this.frequency}}get time(){return this.data.b}set time(t){this.data.b=t}get transition(){return this.data.i}set transition(t){this.data.i=t}get color(){return this.data.c}set color(t){this.data.c=t}get brightness(){return this.data.s}set brightness(t){this.data.s=t}get frequency(){return this.data.f}set frequency(t){this.data.f=t}};let Qs=zt;Qs.default={b:0,i:0,c:0,s:1,f:0};const Rt=class extends Ks{constructor(t){super(t),this.e=t.e.map(n=>Qs.create(n));const e=Math.max(...this.e.map(n=>n.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<e?e:this.beatDistribution)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c,l;return e.push(new Rt({f:(i=n.f)!=null?i:Rt.default.f(),w:(r=n.w)!=null?r:Rt.default.w,d:(a=n.d)!=null?a:Rt.default.d,r:(s=n.r)!=null?s:Rt.default.r,t:(o=n.t)!=null?o:Rt.default.t,b:(c=n.b)!=null?c:Rt.default.b,e:(l=n.e)!=null?l:Rt.default.e()}))}),e.length===1?e[0]:e.length?e:new Rt({f:Rt.default.f(),w:Rt.default.w,d:Rt.default.d,r:Rt.default.r,t:Rt.default.t,b:Rt.default.b,e:Rt.default.e()})}toObject(){return{f:this.filter.toObject(),w:this.beatDistribution,d:this.beatDistributionType,r:this.brightnessDistribution,t:this.brightnessDistributionType,b:this.affectFirst,e:this.events.map(t=>t.toObject())}}get brightnessDistribution(){return this.data.r}set brightnessDistribution(t){this.data.r=t}get brightnessDistributionType(){return this.data.t}set brightnessDistributionType(t){this.data.t=t}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get events(){return this.e}set events(t){this.e=t}};let tl=Rt;tl.default={f:()=>({f:ge.default.f,p:ge.default.p,t:ge.default.t,r:ge.default.r}),w:0,d:1,r:0,t:1,b:0,e:()=>[]};const oe=class extends Js{constructor(t){super(t,t.e.map(e=>tl.create(e)))}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s;return e.push(new oe({b:(i=n.b)!=null?i:oe.default.b,g:(r=n.g)!=null?r:oe.default.g,e:(a=n.e)!=null?a:oe.default.e(),customData:(s=n.customData)!=null?s:oe.default.customData()}))}),e.length===1?e[0]:e.length?e:new oe({b:oe.default.b,g:oe.default.g,e:oe.default.e(),customData:oe.default.customData()})}};let ma=oe;ma.default={b:0,g:0,e:()=>[],customData:()=>({})};const Mt=class extends Wt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c;return e.push(new Mt({b:(i=n.b)!=null?i:Mt.default.b,p:(r=n.p)!=null?r:Mt.default.p,e:(a=n.e)!=null?a:Mt.default.e,l:(s=n.l)!=null?s:Mt.default.l,r:(o=n.r)!=null?o:Mt.default.r,o:(c=n.o)!=null?c:Mt.default.o}))}),e.length===1?e[0]:e.length?e:new Mt({b:Mt.default.b,p:Mt.default.p,e:Mt.default.e,l:Mt.default.l,r:Mt.default.r,o:Mt.default.o})}toObject(){return{b:this.time,p:this.previous,e:this.ease,l:this.loop,r:this.rotation,o:this.direction}}get time(){return this.data.b}set time(t){this.data.b=t}get previous(){return this.data.p}set previous(t){this.data.p=t}get ease(){return this.data.e}set ease(t){this.data.e=t}get loop(){return this.data.l}set loop(t){this.data.l=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}get direction(){return this.data.o}set direction(t){this.data.o=t}};let el=Mt;el.default={b:0,p:0,e:0,l:0,r:0,o:0};const St=class extends Ks{constructor(t){super(t),this.l=t.l.map(n=>el.create(n));const e=Math.max(...this.l.map(n=>n.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<e?e:this.beatDistribution)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c,l,u,p;return e.push(new St({f:(i=n.f)!=null?i:St.default.f(),w:(r=n.w)!=null?r:St.default.w,d:(a=n.d)!=null?a:St.default.d,s:(s=n.s)!=null?s:St.default.s,t:(o=n.t)!=null?o:St.default.t,a:(c=n.a)!=null?c:St.default.a,r:(l=n.r)!=null?l:St.default.r,b:(u=n.b)!=null?u:St.default.b,l:(p=n.l)!=null?p:St.default.l()}))}),e.length===1?e[0]:e.length?e:new St({f:St.default.f(),w:St.default.w,d:St.default.d,s:St.default.s,t:St.default.t,a:St.default.a,r:St.default.r,b:St.default.b,l:St.default.l()})}toObject(){return{f:this.filter.toObject(),w:this.beatDistribution,d:this.beatDistributionType,s:this.rotationDistribution,t:this.rotationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,l:this.events.map(t=>t.toObject())}}get rotationDistribution(){return this.data.s}set rotationDistribution(t){this.data.s=t}get rotationDistributionType(){return this.data.t}set rotationDistributionType(t){this.data.t=t}get axis(){return this.data.a}set axis(t){this.data.a=t}get flip(){return this.data.r}set flip(t){this.data.r=t?1:0}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get events(){return this.l}set events(t){this.l=t}};let nl=St;nl.default={f:()=>({f:ge.default.f,p:ge.default.p,t:ge.default.t,r:ge.default.r}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,l:()=>[]};const se=class extends Js{constructor(t){super(t,t.e.map(e=>nl.create(e)))}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s;return e.push(new se({b:(i=n.b)!=null?i:se.default.b,g:(r=n.g)!=null?r:se.default.g,e:(a=n.e)!=null?a:se.default.e(),customData:(s=n.customData)!=null?s:se.default.customData()}))}),e.length===1?e[0]:e.length?e:new se({b:se.default.b,g:se.default.g,e:se.default.e(),customData:se.default.customData()})}};let pa=se;pa.default={b:0,g:0,e:()=>[],customData:()=>({})};const It=class extends Oe{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color),this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||Array.isArray(this.customData.size)||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c,l;return e.push(new It({b:(i=n.b)!=null?i:It.default.b,x:(r=n.x)!=null?r:It.default.x,y:(a=n.y)!=null?a:It.default.y,d:(s=n.d)!=null?s:It.default.d,w:(o=n.w)!=null?o:It.default.w,h:(c=n.h)!=null?c:It.default.h,customData:(l=n.customData)!=null?l:It.default.customData()}))}),e.length===1?e[0]:e.length?e:new It({b:It.default.b,x:It.default.x,y:It.default.y,d:It.default.d,w:It.default.w,h:It.default.h,customData:It.default.customData()})}toObject(){return{b:this.time,x:this.posX,y:this.posY,d:this.duration,w:this.width,h:this.height,customData:Ct(this.customData)}}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get duration(){return this.data.d}set duration(t){this.data.d=t}get width(){return this.data.w}set width(t){this.data.w=t}get height(){return this.data.h}set height(t){this.data.h=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}mirror(){return this.posX=he-1-this.posX,this}isInteractive(){return this.posX<0&&this.width>1-this.posX||this.width>1||this.posX===1||this.posX===2}hasZero(){return this.duration===0||this.width===0||this.height===0}hasNegative(){return this.posY<0||this.duration<0||this.width<0||this.height<0}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}isLonger(t,e=0){return this.time+this.duration>t.time+t.duration+e}hasMappingExtensions(){return this.posY>2||this.posX<=-1e3||this.posX>=1e3}isValid(){return!this.hasMappingExtensions()&&!this.hasZero()&&!this.hasNegative()}};let _e=It;_e.default={b:0,x:0,y:0,d:1,w:1,h:1,customData:()=>({})};const le=class extends Oe{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s;return e.push(new le({b:(i=n.b)!=null?i:le.default.b,e:(r=n.e)!=null?r:le.default.e,r:(a=n.r)!=null?a:le.default.r,customData:(s=n.customData)!=null?s:le.default.customData()}))}),e.length===1?e[0]:e.length?e:new le({b:le.default.b,e:le.default.e,r:le.default.r,customData:le.default.customData()})}toObject(){return{b:this.time,e:this.executionTime,r:this.rotation,customData:Ct(this.customData)}}get executionTime(){return this.data.e}set executionTime(t){this.data.e=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}setExecutionTime(t){return this.executionTime=t,this}setRotation(t){return this.rotation=t,this}};let pi=le;pi.default={b:0,e:0,r:0,customData:()=>({})};const pt=class extends Zs{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o,c,l,u,p,g,d,m,_;return e.push(new pt({b:(i=n.b)!=null?i:pt.default.b,c:(r=n.c)!=null?r:pt.default.c,x:(a=n.x)!=null?a:pt.default.x,y:(s=n.y)!=null?s:pt.default.y,d:(o=n.d)!=null?o:pt.default.d,mu:(c=n.mu)!=null?c:pt.default.mu,tb:(l=n.tb)!=null?l:pt.default.tb,tx:(u=n.tx)!=null?u:pt.default.tx,ty:(p=n.ty)!=null?p:pt.default.ty,tc:(g=n.tc)!=null?g:pt.default.tc,tmu:(d=n.tmu)!=null?d:pt.default.tmu,m:(m=n.m)!=null?m:pt.default.m,customData:(_=n.customData)!=null?_:pt.default.customData()}))}),e.length===1?e[0]:e.length?e:new pt({b:pt.default.b,c:pt.default.c,x:pt.default.x,y:pt.default.y,d:pt.default.d,mu:pt.default.mu,tb:pt.default.tb,tx:pt.default.tx,ty:pt.default.ty,tc:pt.default.tc,tmu:pt.default.tmu,m:pt.default.m,customData:pt.default.customData()})}toObject(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,mu:this.lengthMultiplier,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,tc:this.tailDirection,tmu:this.tailLengthMultiplier,m:this.midAnchor,customData:Ct(this.customData)}}get lengthMultiplier(){return this.data.mu}set lengthMultiplier(t){this.data.mu=t}get tailLengthMultiplier(){return this.data.tmu}set tailLengthMultiplier(t){this.data.tmu=t}get tailDirection(){return this.data.tc}set tailDirection(t){this.data.tc=t}get midAnchor(){return this.data.m}set midAnchor(t){this.data.m=t}setLengthMultiplier(t){return this.lengthMultiplier=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setTailDirection(t){return this.tailDirection=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0){switch(this.posX=he-1-this.posX,this.tailPosX=he-1-this.tailPosX,t&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}switch(this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),this}getAngle(){return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):Jt[this.direction]||0}hasMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360||this.tailDirection>=1e3&&this.tailDirection<=1360}isValid(){return!(this.hasMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)}};let gi=pt;gi.default={b:0,c:0,x:0,y:0,d:0,mu:.5,tb:0,tx:0,ty:0,tc:0,tmu:.5,m:1,customData:()=>({})};const Xt=class extends Oe{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(n=>{var i,r,a,s,o;return e.push(new Xt({b:(i=n.b)!=null?i:Xt.default.b,x:(r=n.x)!=null?r:Xt.default.x,y:(a=n.y)!=null?a:Xt.default.y,d:(s=n.d)!=null?s:Xt.default.d,customData:(o=n.customData)!=null?o:Xt.default.customData()}))}),e.length===1?e[0]:e.length?e:new Xt({b:Xt.default.b,x:Xt.default.x,y:Xt.default.y,d:Xt.default.d,customData:Xt.default.customData()})}toObject(){return{b:this.time,x:this.posX,y:this.posY,d:this.direction,customData:Ct(this.customData)}}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get direction(){return this.data.d}set direction(t){this.data.d=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDirection(t){return this.direction=t,this}mirror(){switch(this.posX=he-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}};let _i=Xt;_i.default={b:0,x:0,y:0,d:1,customData:()=>({})};class zi extends Wt{constructor(e){var n,i,r,a,s,o,c,l,u,p,g,d,m,_,b,y,v,S,D,k,F,M,X,$,G,K,C,N;super(e),this.nps=h=>{const L=this.getNoteContainer().filter(J=>J.type!=="bomb");return h?L.length/h:0},this.peak=(h,L)=>{let J=0,j=0;const at=typeof L=="number"?L:L.value,U=this.getNoteContainer().filter(Q=>Q.type!=="bomb");for(let Q=0;Q<U.length;Q++){for(;U[Q].data.time-U[j].data.time>h;)j++;J=Math.max(J,(Q-j+1)/(h/at*60))}return J},this.getFirstInteractiveTime=()=>{const h=this.getNoteContainer().filter(j=>j.type!=="bomb");let L=Number.MAX_VALUE;h.length>0&&(L=h[0].data.time);const J=this.findFirstInteractiveObstacleTime();return Math.min(L,J)},this.getLastInteractiveTime=()=>{const h=this.getNoteContainer().filter(j=>j.type!=="bomb");let L=0;h.length>0&&(L=h[h.length-1].data.time);const J=this.findLastInteractiveObstacleTime();return Math.max(L,J)},this.findFirstInteractiveObstacleTime=()=>{for(let h=0,L=this.obstacles.length;h<L;h++)if(this.obstacles[h].isInteractive())return this.obstacles[h].time;return Number.MAX_VALUE},this.findLastInteractiveObstacleTime=()=>{let h=0;for(let L=this.obstacles.length-1;L>=0;L--)this.obstacles[L].isInteractive()&&(h=Math.max(h,this.obstacles[L].time+this.obstacles[L].duration));return h},this.getNoteContainer=()=>{const h=[];return this.colorNotes.forEach(L=>h.push({type:"note",data:L})),this.sliders.forEach(L=>h.push({type:"slider",data:L})),this.burstSliders.forEach(L=>h.push({type:"burstSlider",data:L})),this.bombNotes.forEach(L=>h.push({type:"bomb",data:L})),h.sort((L,J)=>L.data.time-J.data.time)},this.getEventContainer=()=>{const h=[];return this.basicBeatmapEvents.forEach(L=>h.push({type:"basicEvent",data:L})),this.colorBoostBeatmapEvents.forEach(L=>h.push({type:"boost",data:L})),h.sort((L,J)=>L.data.time-J.data.time)},this.addBPMEvents=(...h)=>{h.forEach(L=>{this.bpmEvents.push(fi.create(L))})},this.addRotationEvents=(...h)=>{h.forEach(L=>{this.rotationEvents.push(pi.create(L))})},this.addColorNotes=(...h)=>{h.forEach(L=>{this.colorNotes.push(_n.create(L))})},this.addBombNotes=(...h)=>{h.forEach(L=>{this.bombNotes.push(di.create(L))})},this.addObstacles=(...h)=>{h.forEach(L=>{this.obstacles.push(_e.create(L))})},this.addSliders=(...h)=>{h.forEach(L=>{this.sliders.push(gi.create(L))})},this.addBurstSliders=(...h)=>{h.forEach(L=>{this.burstSliders.push(fa.create(L))})},this.addWaypoints=(...h)=>{h.forEach(L=>{this.waypoints.push(_i.create(L))})},this.addBasicBeatmapEvents=(...h)=>{h.forEach(L=>{this.basicBeatmapEvents.push(hi.create(L))})},this.addColorBoostBeatmapEvents=(...h)=>{h.forEach(L=>{this.colorBoostBeatmapEvents.push(mi.create(L))})},this.addLightColorEventBoxGroups=(...h)=>{h.forEach(L=>{this.lightColorEventBoxGroups.push(ma.create(L))})},this.addLightRotationEventBoxGroups=(...h)=>{h.forEach(L=>{this.lightRotationEventBoxGroups.push(pa.create(L))})},this.version=(n=e.version)!=null?n:"3.0.0",this.bpmEvents=(r=(i=e.bpmEvents)==null?void 0:i.map(h=>fi.create(h)))!=null?r:[],this.rotationEvents=(s=(a=e.rotationEvents)==null?void 0:a.map(h=>pi.create(h)))!=null?s:[],this.colorNotes=(c=(o=e.colorNotes)==null?void 0:o.map(h=>_n.create(h)))!=null?c:[],this.bombNotes=(u=(l=e.bombNotes)==null?void 0:l.map(h=>di.create(h)))!=null?u:[],this.obstacles=(g=(p=e.obstacles)==null?void 0:p.map(h=>_e.create(h)))!=null?g:[],this.sliders=(m=(d=e.sliders)==null?void 0:d.map(h=>gi.create(h)))!=null?m:[],this.burstSliders=(b=(_=e.burstSliders)==null?void 0:_.map(h=>fa.create(h)))!=null?b:[],this.waypoints=(v=(y=e.waypoints)==null?void 0:y.map(h=>_i.create(h)))!=null?v:[],this.basicBeatmapEvents=(D=(S=e.basicBeatmapEvents)==null?void 0:S.map(h=>hi.create(h)))!=null?D:[],this.colorBoostBeatmapEvents=(F=(k=e.colorBoostBeatmapEvents)==null?void 0:k.map(h=>mi.create(h)))!=null?F:[],this.lightColorEventBoxGroups=(X=(M=e.lightColorEventBoxGroups)==null?void 0:M.map(h=>ma.create(h)))!=null?X:[],this.lightRotationEventBoxGroups=(G=($=e.lightRotationEventBoxGroups)==null?void 0:$.map(h=>pa.create(h)))!=null?G:[],this.basicEventTypesWithKeywords=(K=Fa.create(e.basicEventTypesWithKeywords))!=null?K:{d:[]},this.useNormalEventsAsCompatibleEvents=(C=e.useNormalEventsAsCompatibleEvents)!=null?C:!1,this.customData=(N=e.customData)!=null?N:{}}static create(e={}){var n,i,r,a,s,o,c,l,u,p,g,d,m,_,b;return new zi({version:e.version||"3.0.0",bpmEvents:(n=e.bpmEvents)!=null?n:[],rotationEvents:(i=e.rotationEvents)!=null?i:[],colorNotes:(r=e.colorNotes)!=null?r:[],bombNotes:(a=e.bombNotes)!=null?a:[],obstacles:(s=e.obstacles)!=null?s:[],sliders:(o=e.sliders)!=null?o:[],burstSliders:(c=e.burstSliders)!=null?c:[],waypoints:(l=e.waypoints)!=null?l:[],basicBeatmapEvents:(u=e.basicBeatmapEvents)!=null?u:[],colorBoostBeatmapEvents:(p=e.colorBoostBeatmapEvents)!=null?p:[],lightColorEventBoxGroups:(g=e.lightColorEventBoxGroups)!=null?g:[],lightRotationEventBoxGroups:(d=e.lightRotationEventBoxGroups)!=null?d:[],basicEventTypesWithKeywords:(m=e.basicEventTypesWithKeywords)!=null?m:{d:[]},useNormalEventsAsCompatibleEvents:(_=e.useNormalEventsAsCompatibleEvents)!=null?_:!1,customData:(b=e.customData)!=null?b:{}})}toObject(){return{version:this.version||"3.0.0",bpmEvents:this.bpmEvents.map(e=>e.toObject()),rotationEvents:this.rotationEvents.map(e=>e.toObject()),colorNotes:this.colorNotes.map(e=>e.toObject()),bombNotes:this.bombNotes.map(e=>e.toObject()),obstacles:this.obstacles.map(e=>e.toObject()),sliders:this.sliders.map(e=>e.toObject()),burstSliders:this.burstSliders.map(e=>e.toObject()),waypoints:this.waypoints.map(e=>e.toObject()),basicBeatmapEvents:this.basicBeatmapEvents.map(e=>e.toObject()),colorBoostBeatmapEvents:this.colorBoostBeatmapEvents.map(e=>e.toObject()),lightColorEventBoxGroups:this.lightColorEventBoxGroups.map(e=>e.toObject()),lightRotationEventBoxGroups:this.lightRotationEventBoxGroups.map(e=>e.toObject()),basicEventTypesWithKeywords:this.basicEventTypesWithKeywords.toObject(),useNormalEventsAsCompatibleEvents:this.useNormalEventsAsCompatibleEvents,customData:Ct(this.customData)}}}var il=(t=>(t[t.Easy=1]="Easy",t[t.Normal=3]="Normal",t[t.Hard=5]="Hard",t[t.Expert=7]="Expert",t[t.ExpertPlus=9]="ExpertPlus",t))(il||{}),al=(t=>(t.duplicate="D",t.active="A",t.scale="S",t.position="P",t.localPosition="Lp",t.rotation="R",t.localRotation="Lr",t.lightID="Li",t.track="T",t))(al||{}),rl=(t=>(t.childrenTracks="Ct",t.color="C",t.definitePosition="Dp",t.dissolve="D",t.dissolveArrow="Da",t.duration="Dur",t.easing="E",t.interactable="I",t.localRotation="Lr",t.parentTrack="Pt",t.position="P",t.rotation="R",t.scale="S",t.time="T",t.track="Tr",t.worldPositionStays="Wps",t))(rl||{});const Vi=t=>`[shared::parse::${t}]`,lu=t=>(nt.info(Vi("info"),"Parsing beatmap info v2.x.x"),t._difficultyBeatmapSets.sort((e,n)=>ia[e._beatmapCharacteristicName]-ia[n._beatmapCharacteristicName]),t._difficultyBeatmapSets.forEach(e=>{let n=0;e._difficultyBeatmaps.forEach(i=>{i._difficultyRank-n<=0&&nt.warn(Vi("info"),i._difficulty+" is unordered"),il[i._difficulty]!==i._difficultyRank&&nt.error(Vi("info"),i._difficulty+" has invalid rank"),n=i._difficultyRank}),e._difficultyBeatmaps.sort((i,r)=>i._difficultyRank-r._difficultyRank)}),t),Hr=t=>`[shared::dataCheck::${t}]`,Nn=(t,e,n,i)=>{if(nt.verbose(Hr("deepCheck"),`Looking up ${n}`),Array.isArray(t)){t.forEach((a,s)=>Nn(a,e,`${n}[${s}]`,i));return}const r=Object.keys(e);for(const a in t){if(!r.length)break;r.includes(a)||nt.warn(Hr("deepCheck"),`Unused key ${a} found in ${n}`)}for(const a in e){if(typeof t[a]=="undefined"){if(e[a].optional||ou(i,e[a].version)==="old")continue;throw Error(`Missing ${a} in object ${n}!`)}if(t[a]==null)throw Error(`${a} contain null value in object ${n}!`);if(e[a].type==="array"){if(!Array.isArray(t[a]))throw Error(`${a} is not an array in object ${n}!`);Nn(t[a],e[a].check,`${n} ${a}`,i)}if(e[a].type==="object"){if(!Array.isArray(t[a])&&typeof t[a]!="object")throw Error(`${a} is not an object in object ${n}!`);Nn(t[a],e[a].check,`${n} ${a}`,i)}if(e[a].type!=="array"&&typeof t[a]!==e[a].type)throw Error(`${a} is not ${e[a].type} in object ${n}!`)}},cu={_time:{type:"number",version:"2.0.0"},_type:{type:"number",version:"2.0.0"},_lineIndex:{type:"number",version:"2.0.0"},_lineLayer:{type:"number",version:"2.0.0"},_cutDirection:{type:"number",version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},uu={_colorType:{type:"number",version:"2.0.0"},_headTime:{type:"number",version:"2.0.0"},_headLineIndex:{type:"number",version:"2.0.0"},_headLineLayer:{type:"number",version:"2.0.0"},_headCutDirection:{type:"number",version:"2.0.0"},_headControlPointlengthMultiplier:{type:"number",version:"2.0.0"},_tailTime:{type:"number",version:"2.0.0"},_tailLineIndex:{type:"number",version:"2.0.0"},_tailLineLayer:{type:"number",version:"2.0.0"},_tailCutDirection:{type:"number",version:"2.0.0"},_tailControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_sliderMidAnchorMode:{type:"number",version:"2.0.0"}},hu={_time:{type:"number",version:"2.0.0"},_lineIndex:{type:"number",version:"2.0.0"},_lineLayer:{type:"number",version:"2.6.0"},_type:{type:"number",version:"2.0.0"},_duration:{type:"number",version:"2.0.0"},_width:{type:"number",version:"2.0.0"},_height:{type:"number",version:"2.6.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},du={_time:{type:"number",version:"2.0.0"},_type:{type:"number",version:"2.0.0"},_value:{type:"number",version:"2.0.0"},_floatValue:{type:"number",version:"2.5.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},fu={_time:{type:"number",version:"2.2.0"},_lineIndex:{type:"number",version:"2.2.0"},_lineLayer:{type:"number",version:"2.2.0"},_offsetDirection:{type:"number",version:"2.2.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},mu={_keyword:{type:"string",version:"2.4.0"},_specialEvents:{type:"number",version:"2.4.0"}},pu={_keywords:{type:"array",version:"2.4.0",check:mu}},gu={_version:{type:"string",version:"2.0.0"},_notes:{type:"array",version:"2.0.0",check:cu},_sliders:{type:"array",version:"2.6.0",check:uu},_obstacles:{type:"array",version:"2.0.0",check:hu},_events:{type:"array",version:"2.0.0",check:du},_waypoints:{type:"array",version:"2.2.0",check:fu},_specialEventsKeywordFilters:{type:"object",version:"2.4.0",check:pu,optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},jr=t=>`[v2::parse::${t}]`,_u=t=>{var e,n,i,r,a,s;return nt.info(jr("difficulty"),"Parsing beatmap difficulty v2.x.x"),(e=t._version)!=null&&e.startsWith("2")||(nt.warn(jr("difficulty"),"Unidentified beatmap version"),t._version="2.0.0"),Nn(t,gu,"difficulty",t._version),t._notes=(n=t._notes)!=null?n:[],t._sliders=(i=t._sliders)!=null?i:[],t._obstacles=(r=t._obstacles)!=null?r:[],t._events=(a=t._events)!=null?a:[],t._waypoints=(s=t._waypoints)!=null?s:[],t._notes.sort((o,c)=>o._time-c._time),t._sliders.sort((o,c)=>o._headTime-c._headTime),t._obstacles.sort((o,c)=>o._time-c._time),t._events.sort((o,c)=>o._time-c._time),t._waypoints.sort((o,c)=>o._time-c._time),Pa.create(t)},bu={b:{type:"number",version:"3.0.0"},c:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},a:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},yu={b:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},vu={b:{type:"number",version:"3.0.0"},c:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},mu:{type:"number",version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",version:"3.0.0"},ty:{type:"number",version:"3.0.0"},tc:{type:"number",version:"3.0.0"},tmu:{type:"number",version:"3.0.0"},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Eu={b:{type:"number",version:"3.0.0"},c:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",version:"3.0.0"},ty:{type:"number",version:"3.0.0"},sc:{type:"number",version:"3.0.0"},s:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},wu={b:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},w:{type:"number",version:"3.0.0"},h:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Su={b:{type:"number",version:"3.0.0"},et:{type:"number",version:"3.0.0"},i:{type:"number",version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Cu={b:{type:"number",version:"3.0.0"},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ku={b:{type:"number",version:"3.0.0"},e:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Du={b:{type:"number",version:"3.0.0"},o:{type:"boolean",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ol={f:{type:"number",version:"3.0.0"},p:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"}},Tu={b:{type:"number",version:"3.0.0"},i:{type:"number",version:"3.0.0"},c:{type:"number",version:"3.0.0"},s:{type:"number",version:"3.0.0"},f:{type:"number",version:"3.0.0"}},Lu={f:{type:"object",version:"3.0.0",check:ol},w:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Tu},b:{type:"number",version:"3.0.0"}},xu={b:{type:"number",version:"3.0.0"},g:{type:"number",version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Lu},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ru={b:{type:"number",version:"3.0.0"},p:{type:"number",version:"3.0.0"},e:{type:"number",version:"3.0.0"},l:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},o:{type:"number",version:"3.0.0"}},Iu={f:{type:"object",version:"3.0.0",check:ol},w:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},s:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},a:{type:"number",version:"3.0.0"},l:{type:"array",version:"3.0.0",check:Ru},r:{type:"number",version:"3.0.0"},b:{type:"number",version:"3.0.0"}},Au={b:{type:"number",version:"3.0.0"},g:{type:"number",version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Iu},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Bu={k:{type:"string",version:"3.0.0"},e:{type:"number",version:"3.0.0"}},$u={d:{type:"array",version:"3.0.0",check:Bu,optional:!0}},Nu={b:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Mu={version:{type:"string",version:"3.0.0"},bpmEvents:{type:"array",version:"3.0.0",check:Cu,optional:!0},rotationEvents:{type:"array",version:"3.0.0",check:ku,optional:!0},colorNotes:{type:"array",version:"3.0.0",check:bu,optional:!0},bombNotes:{type:"array",version:"3.0.0",check:yu,optional:!0},obstacles:{type:"array",version:"3.0.0",check:wu,optional:!0},sliders:{type:"array",version:"3.0.0",check:vu,optional:!0},burstSliders:{type:"array",version:"3.0.0",check:Eu,optional:!0},waypoints:{type:"array",version:"3.0.0",check:Nu,optional:!0},basicBeatmapEvents:{type:"array",version:"3.0.0",check:Su,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:Du,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:xu,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:Au,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"3.0.0",check:$u},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},zr=t=>`[v3::parse::${t}]`,Zt=(t,e)=>t.b-e.b,Ou=t=>{var e,n,i,r,a,s,o,c,l,u,p,g;return nt.info(zr("difficulty"),"Parsing beatmap difficulty v3.x.x"),t.version!=="3.0.0"&&(nt.warn(zr("difficulty"),"Unidentified beatmap version"),t.version="3.0.0"),Nn(t,Mu,"difficulty",t.version),t.bpmEvents=(e=t.bpmEvents)!=null?e:[],t.rotationEvents=(n=t.rotationEvents)!=null?n:[],t.colorNotes=(i=t.colorNotes)!=null?i:[],t.bombNotes=(r=t.bombNotes)!=null?r:[],t.obstacles=(a=t.obstacles)!=null?a:[],t.sliders=(s=t.sliders)!=null?s:[],t.burstSliders=(o=t.burstSliders)!=null?o:[],t.waypoints=(c=t.waypoints)!=null?c:[],t.basicBeatmapEvents=(l=t.basicBeatmapEvents)!=null?l:[],t.colorBoostBeatmapEvents=(u=t.colorBoostBeatmapEvents)!=null?u:[],t.lightColorEventBoxGroups=(p=t.lightColorEventBoxGroups)!=null?p:[],t.lightRotationEventBoxGroups=(g=t.lightRotationEventBoxGroups)!=null?g:[],t.bpmEvents.sort(Zt),t.rotationEvents.sort(Zt),t.colorNotes.sort(Zt),t.bombNotes.sort(Zt),t.obstacles.sort(Zt),t.sliders.sort(Zt),t.burstSliders.sort(Zt),t.waypoints.sort(Zt),t.basicBeatmapEvents.sort(Zt),t.colorBoostBeatmapEvents.sort(Zt),t.lightColorEventBoxGroups.sort(Zt),t.lightRotationEventBoxGroups.sort(Zt),zi.create(t)},Xi="UI Info: ",ga=document.querySelector(".info__level-author"),_a=document.querySelector(".info__environment"),oi=document.querySelector(".info__editors"),si=document.querySelector(".info__contributors"),bi=document.querySelector(".info__contributors-select"),Pu=document.querySelector(".info__contributors-image"),sl=document.querySelector(".info__contributors-name"),ll=document.querySelector(".info__contributors-role"),ba=document.querySelector(".info__version"),ya=document.querySelector(".info__time-spend"),va=document.querySelector(".info__custom-color"),Ea=document.querySelector(".info__requirements"),wa=document.querySelector(".info__suggestions"),Sa=document.querySelector(".info__information"),Ca=document.querySelector(".info__warnings"),ka=document.querySelector(".info__bookmarks"),Da=document.querySelector(".info__bpm-changes"),Ta=document.querySelector(".info__environment-enhancement"),La=document.querySelector(".info__point-definitions"),xa=document.querySelector(".info__custom-events");if(!ga||!_a||!oi)throw new Error(Xi+"info component is missing part");if(!si||!sl||!ll)throw new Error(Xi+"contributors component is missing part");if(bi)bi.addEventListener("change",Uu);else throw new Error(Xi+"contributors select is missing");if(!ba||!ya||!va||!Ea||!wa||!Sa||!Ca||!ka||!Da||!Ta||!La||!xa)throw new Error(Xi+"table info component is missing part");const ja=t=>{if(!t){ga.textContent="";return}ga.textContent="Mapped by "+t},za=t=>{if(!t){_a.textContent="";return}_a.textContent=(ru[t]||"Unknown")+" Environment"},Xa=t=>{if(!t||!t._lastEditedBy){oi.classList.add("hidden");return}oi.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let n="Last edited on "+e;if(t[e]){const i=t[e];n+=" v"+i.version}oi.textContent=n},Fu=t=>{Pu.src=t||"./img/unknown.jpg"},Hu=t=>{sl.textContent=t},ju=t=>{ll.textContent=t},Ua=t=>{Fu(t._base64?"data:image;base64,"+t._base64:null),Hu(t._name),ju(t._role)},cl=t=>{if(si&&(!t||!t.length)){si.classList.add("hidden"),Qi(bi);return}if(t){si.classList.remove("hidden");let e=!0;t.forEach((n,i)=>{e&&(e=!1,Ua(n));const r=document.createElement("option");r.value=i.toString(),r.text=n._name+" -- "+n._role,bi.add(r)})}},te=t=>{const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")},ee=(t,e)=>{const n=t.querySelector(".info__table-element");if(n){for(;n.firstChild;)n.removeChild(n.firstChild);typeof e=="string"?n.textContent=e:(e.forEach(i=>{if(typeof i=="string"){let r=document.createElement("span");r.textContent=i,n.appendChild(r),n.appendChild(document.createElement("br"))}else n.appendChild(i),n.appendChild(document.createElement("br"))}),n.lastChild&&n.removeChild(n.lastChild))}t.classList.remove("hidden")},yi=t=>{if(t==null){te(ba);return}ee(ba,t)},Ga=t=>{if(t==null){te(ya);return}ee(ya,Vc(t))},Ya=(t,e)=>{var c,l,u,p,g,d,m,_,b;if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._obstacleColor){te(va);return}e||(e="DefaultEnvironment");let n={_colorLeft:Lt((c=Gt[Ut[e]])==null?void 0:c._colorLeft)||null,_colorRight:Lt((l=Gt[Ut[e]])==null?void 0:l._colorRight)||null,_envColorLeft:Lt((u=Gt[Ut[e]])==null?void 0:u._envColorLeft)||null,_envColorRight:Lt((p=Gt[Ut[e]])==null?void 0:p._envColorRight)||null,_envColorLeftBoost:Lt((g=Gt[Ut[e]])==null?void 0:g._envColorLeftBoost)||null,_envColorRightBoost:Lt((d=Gt[Ut[e]])==null?void 0:d._envColorRightBoost)||null,_obstacleColor:Lt((m=Gt[Ut[e]])==null?void 0:m._obstacleColor)||null};t._colorLeft&&(n._colorLeft=Lt(t._colorLeft)),t._colorRight&&(n._colorRight=Lt(t._colorRight)),t._envColorLeft?n._envColorLeft=Lt(t._envColorLeft):t._colorLeft&&(n._envColorLeft=Lt(t._colorLeft)),t._envColorRight?n._envColorRight=Lt(t._envColorRight):t._colorRight&&(n._envColorRight=Lt(t._colorRight));let i,r,a=!1;t._envColorLeftBoost?(i=Lt(t._envColorLeftBoost),a=!0):i=Lt((_=Gt[Ut[e]])==null?void 0:_._envColorLeftBoost)||n._envColorLeft,t._envColorRightBoost?(r=Lt(t._envColorRightBoost),a=!0):r=Lt((b=Gt[Ut[e]])==null?void 0:b._envColorRightBoost)||n._envColorRight,a&&(n._envColorLeftBoost=i,n._envColorRightBoost=r),t._obstacleColor&&(n._obstacleColor=Lt(t._obstacleColor));const s=ri.create("max","none",!0);for(const y in n){if(!n[y])continue;const v=document.createElement("div"),S=document.createElement("div"),D=document.createElement("div"),k=document.createElement("div");S.className="info__color-dot",S.style.backgroundColor=n[y]||"#000000",D.className="info__color-text info__color-text--monospace",D.textContent=`${n[y]}`,k.className="info__color-text",k.textContent=` -- ${nu[y]}`,v.appendChild(S),v.appendChild(D),v.appendChild(k),s.appendChild(v)}ee(va,[s])},Va=t=>{if(t==null||!t.length){te(Ea);return}ee(Ea,t.join(", "))},Wa=t=>{if(t==null||!t.length){te(wa);return}ee(wa,t.join(", "))},qa=t=>{if(t==null||!t.length){te(Sa);return}ee(Sa,t)},Za=t=>{if(t==null||!t.length){te(Ca);return}ee(Ca,t)},Ja=(t,e)=>{if(t==null||!t.length){te(ka);return}const n=t.map(i=>{let r=i._time,a;return e&&(r=e.adjustTime(r),a=e.toRealTime(r)),`${O(i._time,it.rounding)}${a?" | "+Dt(a):""} -- ${i._name!=""?i._name:"**EMPTY NAME**"}`});ee(ka,n)},Ka=t=>{if(!t||!t.change.length){te(Da);return}const e=t.change.map(n=>{let i=O(n._newTime,it.rounding),r=t.toRealTime(n._time);return`${i} | ${Dt(r)} -- ${n._BPM}`});ee(Da,e)},Qa=t=>{if(t==null||!t.length){te(Ta);return}const e=t.map(n=>{let i=[];for(const r in n){if(r=="_lookupMethod"||r=="_id"||r=="lookupMethod"||r=="id")continue;let a=al[r];n[r]!=null&&i.push(a)}return`${n.lookupMethod} [${i.join("")}]${n.track?`(${n.track})`:""} -> ${n.id}`});ee(Ta,e)},tr=t=>{if(t==null||!t.length){te(La);return}const e=t.map(n=>`${n.name} -- ${n.points.length} point${n.points.length>1?"s":""}`);ee(La,e)},er=(t,e)=>{if(t==null||!t.length){te(xa);return}const n=t.map(i=>{let r=i.beat,a;e&&(r=e.adjustTime(r),a=e.toRealTime(r));let s=[];for(const o in i.data){if(o=="_duration"||o=="_easing"||o=="_track"||o=="duration"||o=="easing"||o=="track")continue;let c=rl[o];i.data[o]!=null&&s.push(c)}return`${O(i.beat,it.rounding)}${a?" | "+Dt(a):""} -- ${i.time} -> [${s.join("")}]${i.time!=="AssignTrackParent"?`(${i.data.track})`:""}`});ee(xa,n)},zu=t=>{var e;Ot.setSongName(t._songName),Ot.setSongSubname(t._songSubName),Ot.setSongAuthor(t._songAuthorName),Ot.setSongBPM(t._beatsPerMinute),ja(t._levelAuthorName),za(t._environmentName),Xa((e=t._customData)==null?void 0:e._editors)},Xu=t=>{var e,n,i,r,a;if(t.rawVersion===2&&yi(t.rawData._version),t.rawVersion===3&&yi(t.rawData.version),(e=t.info)!=null&&e._customData&&(Ya(t.info._customData),Va(t.info._customData._requirements),Wa(t.info._customData._suggestions),qa(t.info._customData._information),Za(t.info._customData._warnings)),(n=t.data)!=null&&n.customData){const s=(i=rt.beatmapInfo)!=null&&i._beatsPerMinute?be.create(rt.beatmapInfo._beatsPerMinute,t.data.customData._bpmChanges||t.data.customData._BPMChanges||t.data.customData.BPMChanges):null;Ga((r=t.data.customData._time)!=null?r:t.data.customData.time),Ja((a=t.data.customData._bookmarks)!=null?a:t.data.customData.bookmarks,s),Ka(s),Qa(t.data.customData.environment),tr(t.data.customData.pointDefinitions),er(t.data.customData.customEvents,s)}};function Uu(t){const e=t.target;Ua(rt.contributors[parseInt(e.value)])}const Gu=()=>{ja(),za(),Xa(),cl(),yi(),Ga(),Ya(),Va(),Wa(),qa(),Za(),Ja(),Ka(),Qa(),tr(),er()};var jn={setLevelAuthor:ja,setEnvironment:za,setEditors:Xa,setContributors:Ua,populateContributors:cl,setVersion:yi,setTimeSpend:Ga,setCustomColor:Ya,setRequirements:Va,setSuggestions:Wa,setInformation:qa,setWarnings:Za,setBookmarks:Ja,setBPMChanges:Ka,setEnvironmentEnhancement:Qa,setPointDefinitions:tr,setCustomEvents:er,setInfo:zu,setDiffInfoTable:Xu,reset:Gu};const Yu="UI Input: ";var ti={enable:t=>{const e=document.querySelectorAll(".input-toggle");if(!e.length){console.error(Yu+"empty list, intentional or typo error?");return}e.forEach(n=>{n.disabled=!t})}};const Vu="UI Loading: ",fn=document.querySelector(".loading__bar"),Xr="loading__bar--error",Ur="loading__bar--download",ul=document.querySelector(".loading__text");if(!fn||!ul)throw new Error(Vu+"loading component is missing part");const hl=(t,e,n=100)=>{ul.textContent=e,fn.style.width=`${n}%`,t==="error"?fn.classList.add(Xr):fn.classList.remove(Xr),t==="download"?fn.classList.add(Ur):fn.classList.remove(Ur)},Wu=()=>{hl("info","No map loaded",0)};var bt={status:hl,reset:Wu},ct=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_UNLIT_BOMB=10]="EVENTS_UNLIT_BOMB",t[t.NOTES_EFFECTIVE_BPM=11]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=12]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=13]="NOTES_PARITY",t[t.NOTES_VARY_SWING=14]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=15]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=16]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=17]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=18]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=19]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=20]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=21]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=22]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=23]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=24]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=25]="NOTES_HITBOX_PATH",t[t.NOTES_COLOR_CHECK=26]="NOTES_COLOR_CHECK",t[t.NOTES_STACKED_NOTE=27]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=28]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=29]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=30]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=31]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=32]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=33]="OBSTACLES_NEGATIVE",t))(ct||{}),ut=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_UNLIT_BOMB=10]="EVENTS_UNLIT_BOMB",t[t.NOTES_COLOR_CHECK=11]="NOTES_COLOR_CHECK",t[t.NOTES_EFFECTIVE_BPM=12]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=13]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=14]="NOTES_PARITY",t[t.NOTES_VARY_SWING=15]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=16]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=17]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=18]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=19]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=20]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=21]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=22]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=23]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=24]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=25]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=26]="NOTES_HITBOX_PATH",t[t.NOTES_STACKED_NOTE=27]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=28]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=29]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=30]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=31]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=32]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=33]="OBSTACLES_NEGATIVE",t))(ut||{});const ht=(t,e)=>{const n=document.createElement("div");return e?n.innerHTML=`<b>${t}:</b> ${e}`:n.innerHTML=`<b>${t}</b>`,n},dt=(t,e,n)=>{const i=document.createElement("div");return i.innerHTML=`<b>${t} [${e.length}]:</b> ${e.map(r=>{switch(it.beatNumbering){case"realtime":return Dt(n.toRealTime(r));case"realtimems":return Bs(n.toRealTime(r));case"jsontime":return O(r,it.rounding);case"beattime":default:return O(n.adjustTime(r),it.rounding)}}).join(", ")}`,i},Ra=class{constructor(){}};let ot=Ra;ot.list=[];ot.create=(t,e,n,i)=>{const r=t.trim().toLowerCase().replace(" ","-");if(Ra.list.includes(r))throw new Error(r+" is already being used.");Ra.list.push(r);const a=document.createElement("div"),s=document.createElement("input"),o=document.createElement("label");return o.textContent=" "+t,o.title=e,o.htmlFor="input__tools-"+r,s.id="input__tools-"+r,s.className="input-toggle",s.type="checkbox",s.checked=n,s.addEventListener("change",i),a.appendChild(s),a.appendChild(o),a};const Gr="Validate Cover Image",Yr="Validate cover image.",Vr=!0,vi={name:Gr,description:Yr,type:"general",order:{input:ct.GENERAL_COVER_IMAGE,output:ut.GENERAL_COVER_IMAGE},input:{enabled:Vr,params:{},html:ot.create(Gr,Yr,Vr,function(){vi.input.enabled=this.checked})},output:{html:null},run:qu};function qu(){const t=new Image,e=Ot.getCoverImage(),n=[];if(gn.loading.coverImage&&e!==null?(t.src=e,t.width!==t.height&&n.push(ht("Cover image is not square","resize to fit square")),(t.width<256||t.height<256)&&n.push(ht("Cover image is too small","require at least 256x256"))):n.push(ht("No cover image",it.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),n.length){const i=document.createElement("div");n.forEach(r=>i.append(r)),vi.output.html=i}else vi.output.html=null}const Wr="Audio Duration",qr="For ranking purpose, check for audio duration.",Zr=!0,Mn={name:Wr,description:qr,type:"general",order:{input:ct.GENERAL_AUDIO,output:ut.GENERAL_AUDIO},input:{enabled:Zr,params:{},html:ot.create(Wr,qr,Zr,function(){Mn.input.enabled=this.checked})},output:{html:null},run:Zu};function Zu(t){const{audioDuration:e}=t.settings;e&&e<20?Mn.output.html=ht("Unrankable audio length",`too short (${Dt(e)}s)`):gn.loading.audio?Mn.output.html=null:Mn.output.html=ht("No audio",it.load.audio?"could not be loaded or not found":"no audio mode is enabled")}const Jr="Preview Time",Kr="Warn default editor preview time.",Qr=!0,Ei={name:Jr,description:Kr,type:"general",order:{input:ct.GENERAL_PREVIEW_TIME,output:ut.GENERAL_PREVIEW_TIME},input:{enabled:Qr,params:{},html:ot.create(Jr,Kr,Qr,function(){Ei.input.enabled=this.checked})},output:{html:null},run:Ju};function Ju(t){const{_previewStartTime:e,_previewDuration:n}=t.info;if(e===12&&n===10){const i=document.createElement("div");i.innerHTML="<b>Default preview time:</b> strongly recommended to set for audience's 1st impression",Ei.output.html=i}else Ei.output.html=null}const Ku=t=>Math.max(...t.map(e=>e.ebpm),0),Qu=t=>Math.max(...t.map(e=>e.ebpmSwing),0),dl=(t,e,n)=>t.direction===8&&e.direction===8&&n!==8&&(t.posX>e.posX&&(n===5||n===3||n===7)||t.posX<e.posX&&(n===6||n===2||n===4)||t.posY>e.posY&&(n===4||n===0||n===5)||t.posY<e.posY&&(n===6||n===1||n===7))||t.posX>e.posX&&(t.direction===5||t.direction===3||t.direction===7||(e.direction===5||e.direction===3||e.direction===7)&&t.direction===8)||t.posX<e.posX&&(t.direction===6||t.direction===2||t.direction===4||(e.direction===6||e.direction===2||e.direction===4)&&t.direction===8)||t.posY>e.posY&&(t.direction===4||t.direction===0||t.direction===5||(e.direction===4||e.direction===0||e.direction===5)&&t.direction===8)||t.posY<e.posY&&(t.direction===6||t.direction===1||t.direction===7||(e.direction===6||e.direction===1||e.direction===7)&&t.direction===8),Ia=(t,e,n,i=!1)=>{const[r,a]=t.getPosition(),[s,o]=e.getPosition(),c=t.getAngle(),l=e.getAngle(),u=i?540:360;let p=!1;if(t.direction!==8){const d=(Ji(Math.atan2(a-o,r-s))+450)%360;for(const[m,_,b]of n){const y=b!=null?b:0,v=(c+u-m+y)%360,S=(c+u+m+y)%360;if(p=_>=Math.sqrt(Math.pow(r-s,2)+Math.pow(a-o,2))&&(v<S&&v<=d&&d<=S||v>=S&&(d<=S||d>=v))||p,p)break}}let g=!1;if(e.direction!==8){const d=(Ji(Math.atan2(o-a,s-r))+450)%360;for(const[m,_,b]of n){const y=b!=null?b:0,v=(l+u-m+y)%360,S=(l+u+m+y)%360;if(g=_>=Math.sqrt(Math.pow(r-s,2)+Math.pow(a-o,2))&&(v<S&&v<=d&&d<=S||v>=S&&(d<=S||d>=v))||g,g)break}}return[p,g]},to=(t,e)=>{if(dl(t,e,8))return t.direction===8?e.direction:t.direction;if(t.direction!==8)return t.direction;if(t.time>e.time){if(t.posX>e.posX&&t.isHorizontal(e))return 3;if(t.posX<e.posX&&t.isHorizontal(e))return 2;if(t.posY>e.posY){if(t.isVertical(e))return 0;if(t.posX>e.posX)return 5;if(t.posX<e.posX)return 4}if(t.posY<e.posY){if(t.isVertical(e))return 1;if(t.posX>e.posX)return 7;if(t.posX<e.posX)return 6}}return 8},zn=(t,e,n,i)=>{let r,a;if(t===null||e===null)return!1;if(typeof t=="number")r=t;else{if(t.direction===8)return!1;r=t.getAngle()}if(typeof e=="number")a=e;else{if(e.direction===8)return!1;a=e.getAngle()}return i?Nr(r,a,360)<=n:Nr(r,a,360)>=n};class Bt{constructor(e){this.time=e.time,this.duration=e.duration,this.minSpeed=e.minSpeed,this.maxSpeed=e.maxSpeed,this.ebpm=e.ebpm,this.ebpmSwing=e.ebpmSwing,this.data=e.data}static generate(e,n){const i=[];let r=0,a=0,s,o;const c={},l={},u={0:[],1:[]};for(const p of e)p.type==="note"&&(s=0,o=Number.MAX_SAFE_INTEGER,l[p.data.color]?this.next(p,l[p.data.color],n,u[p.data.color])&&(a=this.calcEBPMBetweenObject(p.data,c[p.data.color].data,n.value),r=this.calcEBPMBetweenObject(p.data,l[p.data.color].data,n.value),s=this.calcMinSliderSpeed(u[p.data.color],n),o=this.calcMaxSliderSpeed(u[p.data.color],n),s>0&&o!==1/0||(s=0,o=0),i.push({time:c[p.data.color].data.time,duration:l[p.data.color].data.time-c[p.data.color].data.time,data:u[p.data.color],ebpm:r,ebpmSwing:a,maxSpeed:o,minSpeed:s}),c[p.data.color]=p,u[p.data.color]=[]):c[p.data.color]=p,l[p.data.color]=p,u[p.data.color].push(p));for(let p=0;p<2;p++)l[p]&&(a=0,r=0,s=this.calcMinSliderSpeed(u[p],n),o=this.calcMaxSliderSpeed(u[p],n),s>0&&o!==1/0||(s=0,o=0),i.push({time:c[p].data.time,duration:l[p].data.time-c[p].data.time,data:u[p],ebpm:r,ebpmSwing:a,maxSpeed:o,minSpeed:s}));return i}}Bt.next=(t,e,n,i)=>{if(t.type==="bomb"||e.type==="bomb")throw new Error("Invalid type");if(i&&i.length>0&&n.toRealTime(e.data.time)+.005<n.toRealTime(t.data.time)&&t.data.direction!==8){for(const r of i)if(r.type==="note"&&r.data.direction!==8&&zn(t.data,r.data,90,!1))return!0}if(i&&i.length>0){for(const r of i)if(r.type==="note"&&t.data.isInline(r.data))return!0}return t.data.isWindow(e.data)&&n.toRealTime(t.data.time-e.data.time)>.08||n.toRealTime(t.data.time-e.data.time)>.07};Bt.calcEBPMBetweenObject=(t,e,n)=>n/((t.time-e.time)*2);Bt.calcMinSliderSpeed=(t,e)=>{let n=!1,i=!1,r=0;const a=e.toRealTime(Math.max(...t.map((s,o)=>o===0?0:((t[o].data.isHorizontal(t[o-1].data)||t[o].data.isVertical(t[o-1].data))&&!n&&(n=!0,r=(t[o].data.time-t[o-1].data.time)/(t[o].data.getDistance(t[o-1].data)||1)),i=t[o].data.isDiagonal(t[o-1].data)||t[o].data.isSlantedWindow(t[o-1].data)||i,(t[o].data.time-t[o-1].data.time)/(t[o].data.getDistance(t[o-1].data)||1)))));return n&&i?e.toRealTime(r):a};Bt.calcMaxSliderSpeed=(t,e)=>{let n=!1,i=!1,r=Number.MAX_SAFE_INTEGER;const a=e.toRealTime(Math.min(...t.map((s,o)=>o===0?Number.MAX_SAFE_INTEGER:((t[o].data.isHorizontal(t[o-1].data)||t[o].data.isVertical(t[o-1].data))&&!n&&(n=!0,r=(t[o].data.time-t[o-1].data.time)/(t[o].data.getDistance(t[o-1].data)||1)),i=t[o].data.isDiagonal(t[o-1].data)||t[o].data.isSlantedWindow(t[o-1].data)||i,(t[o].data.time-t[o-1].data.time)/(t[o].data.getDistance(t[o-1].data)||1)))));return n&&i?e.toRealTime(r):a};const th=(t,e,n)=>{const i={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let r,a;for(const s of t){if(s.type!=="note")continue;const o=n.toRealTime(s.data.time);s.data.color===0&&(r?Bt.next(s,r,n)&&i.left[Math.floor(o)]++:i.left[Math.floor(o)]++,r=s),s.data.color===1&&(a?Bt.next(s,a,n)&&i.right[Math.floor(o)]++:i.right[Math.floor(o)]++,a=s)}return i},Wi=(t,e)=>{if(!t.length)return 0;if(t.length<e)return t.reduce((r,a)=>r+a)/t.length;let n=t.slice(0,e).reduce((r,a)=>r+a),i=n;for(let r=0;r<t.length-e;r++)n=n-t[r]+t[r+e],i=Math.max(i,n);return i/e},eo=(t,e,n,i)=>{const a={characteristic:n,difficulty:i,red:{count:0,peak:0,median:0,total:0},blue:{count:0,peak:0,median:0,total:0},total:{count:0,peak:0,median:0,total:0},container:Bt.generate(t.getNoteContainer(),e)},s=Math.max(e.toRealTime(t.getLastInteractiveTime()-t.getFirstInteractiveTime()),0),o=Math.max(e.toRealTime(t.getLastInteractiveTime()),0),c=th(t.getNoteContainer(),o,e),l=c.left.map((d,m)=>d+c.right[m]);if(l.reduce((d,m)=>d+m)===0)return a;const u=[],p=[],g=[];for(let d=0,m=Math.ceil(l.length/10);d<m;d++){const _=d*10;let b=10;b+_>l.length&&(b=l.length-_);const y=c.left.slice(_,_+b),v=c.right.slice(_,_+b),S=l.slice(_,_+b);u.push(y.reduce((D,k)=>D+k)/b),p.push(v.reduce((D,k)=>D+k)/b),g.push(S.reduce((D,k)=>D+k)/b)}return a.red.total=c.left.reduce((d,m)=>d+m),a.red.count=c.left.reduce((d,m)=>d+m)/s,a.red.peak=Wi(c.left,10),a.red.median=Yi(u),a.blue.total=c.right.reduce((d,m)=>d+m),a.blue.count=c.right.reduce((d,m)=>d+m)/s,a.blue.peak=Wi(c.right,10),a.blue.median=Yi(p),a.total.total=a.red.total+a.blue.total,a.total.count=l.reduce((d,m)=>d+m)/s,a.total.peak=Wi(l,10),a.total.median=Yi(g),a},eh=(t,e)=>{let n=0,i=0;for(const r of t){const a=r.total.count;if(i>0&&a>0&&(n=(1-i/a)*100),i=a>0?a:i,i>e&&n>40)return r}return null},nh=(t,e)=>{let n=Number.MAX_SAFE_INTEGER,i=0;for(const r of t){const a=r.total.count;if(i>0&&a>0&&(n=(1-i/a)*100),i=a>0?a:i,i>e&&n<10)return r}return null},ih=t=>{let e=0,n=Number.MAX_SAFE_INTEGER;return t.forEach(i=>{const r=i.total.count;r>0&&(e=Math.max(e,r),n=Math.min(n,r))}),e||e&&n?(1-n/e)*100:0},no=t=>{let e=Number.MAX_SAFE_INTEGER;return t.forEach(n=>{const i=n.total.count;i>0&&(e=Math.min(e,i))}),e},ah=t=>Math.max(...t.map(e=>e.minSpeed),0),rh=t=>{const e=t.map(n=>n.maxSpeed).filter(n=>n!==0);return e.length?Math.min(...e):0},io="Difficulty Progression",ao="For ranking purpose, check difficuly progression to fit rankability criteria.",ro=!0,mn={name:io,description:ao,type:"general",order:{input:ct.GENERAL_PROGRESSION,output:ut.GENERAL_PROGRESSION},input:{enabled:ro,params:{},html:ot.create(io,ao,ro,function(){mn.input.enabled=this.checked})},output:{html:null},run:oh};function oh(t){const{audioDuration:e}=t.settings;if(!e){mn.output.html=null;return}const n=rt.beatmapDifficulty.map(o=>o.swingAnalysis).filter(o=>o.characteristic==="Standard").sort((o,c)=>o.total.count-c.total.count);if(!n.length){mn.output.html=null;return}const i=e<120?3.2:e<240?4.2:5.2,r=[];e<240&&no(n)>i&&ih(n)<60&&r.push(ht(`Minimum SPS not met (<${i})`,`lowest is ${O(no(n),2)}`));const a=eh(n,i),s=nh(n,i);if(a&&e<360&&r.push(ht("Violates progression",`${a.difficulty} exceeded 40% SPS drop`)),s&&e<360&&r.push(ht("Violates progression",`${s.difficulty} has less than 10% SPS drop`)),r.length){const o=document.createElement("div");r.forEach(c=>o.append(c)),mn.output.html=o}else mn.output.html=null}var oo=Object.freeze(Object.defineProperty({__proto__:null,coverImage:vi,audio:Mn,previewTime:Ei,progression:mn},Symbol.toStringTag,{value:"Module"}));const fl="Effective BPM",ml=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,pl=!0,nr=450,ir=350,Gn=ot.create(fl+" threshold",ml,pl,function(){Pt.input.enabled=this.checked}),Pe=document.createElement("input"),ar=document.createElement("label"),Fe=document.createElement("input"),rr=document.createElement("label");ar.textContent=": ";ar.htmlFor="input__tools-ebpm";Pe.id="input__tools-ebpm";Pe.className="input-toggle input--small";Pe.type="number";Pe.min="0";Pe.value=nr.toString();Pe.addEventListener("change",lh);rr.textContent=" (swing): ";rr.htmlFor="input__tools-ebpms";Fe.id="input__tools-ebpms";Fe.className="input-toggle input--small";Fe.type="number";Fe.min="0";Fe.value=ir.toString();Fe.addEventListener("change",ch);Gn.appendChild(ar);Gn.appendChild(Pe);Gn.appendChild(rr);Gn.appendChild(Fe);const Pt={name:fl,description:ml,type:"note",order:{input:ct.NOTES_EFFECTIVE_BPM,output:ut.NOTES_EFFECTIVE_BPM},input:{enabled:pl,params:{ebpmThres:nr,ebpmsThres:ir},html:Gn,adjustTime:sh},output:{html:null},run:hh};function sh(t){Pt.input.params.ebpmThres=O(Math.min(nr,t.value*2*1.285714),1),Pt.input.params.ebpmsThres=O(Math.min(ir,t.value*2),1),Pe.value=Pt.input.params.ebpmThres.toString(),Fe.value=Pt.input.params.ebpmsThres.toString()}function lh(){Pt.input.params.ebpmThres=O(Math.abs(parseFloat(this.value)),1),this.value=Pt.input.params.ebpmThres.toString()}function ch(){Pt.input.params.ebpmsThres=O(Math.abs(parseFloat(this.value)),1),this.value=Pt.input.params.ebpmsThres.toString()}function uh(t){const{swingAnalysis:e}=t.difficulty,{ebpmThres:n,ebpmsThres:i}=Pt.input.params,r=e.container.filter(s=>s.ebpm>n).map(s=>s.time),a=e.container.filter(s=>s.ebpmSwing>i).map(s=>s.time);return{base:r,swing:a}}function hh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=uh(t),{ebpmThres:n,ebpmsThres:i}=Pt.input.params,r=[];if(e.base.length&&r.push(dt(`>${n}EBPM warning`,e.base,t.settings.bpm)),e.swing.length&&r.push(dt(`>${i}EBPM (swing) warning`,e.swing,t.settings.bpm)),r.length){const a=document.createElement("div");r.forEach(s=>a.append(s)),Pt.output.html=a}else Pt.output.html=null}const gl="Acceptable Beat Precision",_l=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,bl=!0,yl=[8,6],vl=ot.create(gl+": ",_l,bl,function(){ln.input.enabled=this.checked}),Cn=document.createElement("input");Cn.id="input__tools-prec";Cn.className="input-toggle input--small";Cn.type="text";Cn.value=yl.join(" ");Cn.addEventListener("change",dh);vl.appendChild(Cn);const ln={name:gl,description:_l,type:"note",order:{input:ct.NOTES_ACCEPTABLE_PRECISION,output:ut.NOTES_ACCEPTABLE_PRECISION},input:{enabled:bl,params:{prec:[...yl]},html:vl},output:{html:null},run:mh};function dh(){ln.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=ln.input.params.prec.join(" ")}function fh(t,e){const{bpm:n}=t,i=e.swingAnalysis.container,{prec:r}=ln.input.params;return i.map(a=>a.time).filter((a,s,o)=>!s||a!==o[s-1]).filter(a=>{if(!r.length)return!1;for(let s=0;s<r.length;s++)if((n.adjustTime(a)+.001)%(1/r[s])<.01)return!1;return!0})}function mh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=fh(t.settings,t.difficulty);e.length?ln.output.html=dt("Off-beat precision",e,t.settings.bpm):ln.output.html=null}const so="Varying Swing Speed",lo="Check for varying swing speed due to changes in slider distance.",co=!0,wi={name:so,description:lo,type:"note",order:{input:ct.NOTES_VARY_SWING,output:ut.NOTES_VARY_SWING},input:{enabled:co,params:{},html:ot.create(so,lo,co,function(){wi.input.enabled=this.checked})},output:{html:null},run:gh};function ph(t){const{swingAnalysis:e}=t;return e.container.filter(n=>Math.abs(n.minSpeed-n.maxSpeed)>.002).map(n=>n.time).filter((n,i,r)=>!i||n!==r[i-1])}function gh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=ph(t.difficulty);e.length?wi.output.html=dt("Varying swing speed",e,t.settings.bpm):wi.output.html=null}const El="Slow Slider",wl="Look for slider that require slow swing.",Sl=!0,Cl=.025,kn=document.createElement("div"),He=document.createElement("input"),or=document.createElement("label"),je=document.createElement("input"),sr=document.createElement("label");let bn;or.textContent="min speed (ms): ";or.htmlFor="input__tools-slow-slider-time";He.id="input__tools-slow-slider-time";He.className="input-toggle input--small";He.type="number";He.min="0";He.value=O(Cl*1e3,1).toString();He.addEventListener("change",bh);sr.textContent=" (prec): ";sr.htmlFor="input__tools-slow-slider-prec";je.id="input__tools-slow-slider-prec";je.className="input-toggle input--small";je.type="number";je.min="0";je.addEventListener("change",yh);kn.appendChild(ot.create(El,wl,Sl,function(){Kt.input.enabled=this.checked}));kn.appendChild(or);kn.appendChild(He);kn.appendChild(sr);kn.appendChild(je);const Kt={name:El,description:wl,type:"note",order:{input:ct.NOTES_SLOW_SLIDER,output:ut.NOTES_SLOW_SLIDER},input:{enabled:Sl,params:{minSpeed:Cl},html:kn,adjustTime:_h},output:{html:null},run:Eh};function _h(t){bn=t,je.value=O(1/bn.toBeatTime(Kt.input.params.minSpeed),2).toString()}function bh(){Kt.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=O(Kt.input.params.minSpeed*1e3,1).toString(),bn&&(je.value=O(1/bn.toBeatTime(Kt.input.params.minSpeed),2).toString())}function yh(){if(!bn){this.value="0";return}let t=O(Math.abs(parseFloat(this.value)),2)||1;Kt.input.params.minSpeed=bn.toRealTime(1/t),He.value=O(Kt.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}function vh(t){const{swingAnalysis:e}=t.difficulty,{minSpeed:n}=Kt.input.params;return e.container.filter(i=>i.maxSpeed>n||i.minSpeed>n).map(i=>i.time).filter((i,r,a)=>!r||i!==a[r-1])}function Eh(t){if(!t.difficulty){console.error("Something went wrong!");return}const{minSpeed:e}=Kt.input.params,n=vh(t);n.length?Kt.output.html=dt(`Slow slider (>${O(e*1e3,1)}ms)`,n,t.settings.bpm):Kt.output.html=null}const kl="Inline Sharp Angle",Dl="Check for angle changes within inline note.",Tl=!0,Ll=.15;let yn;const Dn=document.createElement("div"),ze=document.createElement("input"),lr=document.createElement("label"),De=document.createElement("input"),cr=document.createElement("label");lr.textContent="max time (ms): ";lr.htmlFor="input__tools-inline-angle-time";ze.id="input__tools-inline-angle-time";ze.className="input-toggle input--small";ze.type="number";ze.min="0";ze.value=O(Ll*1e3,1).toString();ze.addEventListener("change",Sh);cr.textContent=" (beat): ";cr.htmlFor="input__tools-inline-angle-beat";De.id="input__tools-inline-angle-beat";De.className="input-toggle input--small";De.type="number";De.min="0";De.step="0.1";De.addEventListener("change",Ch);Dn.appendChild(ot.create(kl,Dl,Tl,function(){ce.input.enabled=this.checked}));Dn.appendChild(lr);Dn.appendChild(ze);Dn.appendChild(cr);Dn.appendChild(De);const ce={name:kl,description:Dl,type:"note",order:{input:ct.NOTES_INLINE_ANGLE,output:ut.NOTES_INLINE_ANGLE},input:{enabled:Tl,params:{maxTime:Ll},html:Dn,adjustTime:wh},output:{html:null},run:Dh};function wh(t){yn=t,De.value=O(yn.toBeatTime(ce.input.params.maxTime),2).toString()}function Sh(){ce.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=O(ce.input.params.maxTime*1e3,1).toString(),yn&&(De.value=O(yn.toBeatTime(ce.input.params.maxTime),2).toString())}function Ch(){if(!yn){this.value="0";return}let t=O(Math.abs(parseFloat(this.value)),2)||1;ce.input.params.maxTime=yn.toRealTime(t),ze.value=O(ce.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function kh(t){const{bpm:e}=t.settings,n=t.difficulty.noteContainer,{maxTime:i}=ce.input.params,r=e.toBeatTime(i)+.001,a={},s={},o={},c={0:[],1:[],3:[]},l=[];let u=0;for(let p=0,g=n.length;p<g;p++){const d=n[p];d.type==="note"&&a[d.data.color]?Bt.next(d,a[d.data.color],e,c[d.data.color])?(o[d.data.color]&&(o[d.data.color]=null,s[d.data.color]=(s[d.data.color]+180)%360),uo(d.data,n,u,r)&&zn(d.data,s[d.data.color],90,!0)&&l.push(d.data),d.data.direction===8?o[d.data.color]=d.data:s[d.data.color]=d.data.getAngle(),c[d.data.color]=[]):(o[d.data.color]&&uo(d.data,n,u,r)&&zn(d.data,s[d.data.color],90,!0)&&(l.push(o[d.data.color]),o[d.data.color]=null),d.data.direction!==8&&(s[d.data.color]=d.data.getAngle())):d.type==="note"&&(s[d.data.color]=d.data.getAngle()),d.type==="note"&&(a[d.data.color]=d,c[d.data.color].push(d)),d.type==="bomb"&&(d.data.posY===0&&(d.data.posX===1&&(s[0]=Jt[0],o[0]=null),d.data.posX===2&&(s[1]=Jt[0],o[1]=null)),d.data.posY===2&&(d.data.posX===1&&(s[0]=Jt[1],o[0]=null),d.data.posX===2&&(s[1]=Jt[1],o[1]=null)))}return l.map(p=>p.time).filter(function(p,g,d){return!g||p!==d[g-1]})}function uo(t,e,n,i){for(let r=n;e[r].data.time<t.time;r++){const a=e[r];if(a.type==="note"&&t.isInline(a.data)&&t.time-e[r].data.time<=i)return!0}return!1}function Dh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=kh(t);e.length?ce.output.html=dt("Inline sharp angle",e,t.settings.bpm):ce.output.html=null}const xl="shrado Angle",Rl="Look for common negative curvature pattern.",Il=!1,Al=.15,Bl=1;let vn;const Te=document.createElement("div"),cn=document.createElement("input"),ur=document.createElement("label"),Xe=document.createElement("input"),hr=document.createElement("label"),Le=document.createElement("input"),dr=document.createElement("label");ur.textContent="min distance: ";ur.htmlFor="input__tools-shrado-angle-distance";cn.id="input__tools-shrado-angle-distance";cn.className="input-toggle input--small";cn.type="number";cn.min="0";cn.value=Bl.toString();cn.addEventListener("change",Lh);hr.textContent="max time (ms): ";hr.htmlFor="input__tools-shrado-angle-time";Xe.id="input__tools-shrado-angle-time";Xe.className="input-toggle input--small";Xe.type="number";Xe.min="0";Xe.value=O(Al*1e3,1).toString();Xe.addEventListener("change",xh);dr.textContent=" (beat): ";dr.htmlFor="input__tools-shrado-angle-beat";Le.id="input__tools-shrado-angle-beat";Le.className="input-toggle input--small";Le.type="number";Le.min="0";Le.step="0.1";Le.addEventListener("change",Rh);Te.appendChild(ot.create(xl,Rl,Il,function(){Yt.input.enabled=this.checked}));Te.appendChild(ur);Te.appendChild(cn);Te.appendChild(document.createElement("br"));Te.appendChild(hr);Te.appendChild(Xe);Te.appendChild(dr);Te.appendChild(Le);const Yt={name:xl,description:Rl,type:"note",order:{input:ct.NOTES_SHRADO_ANGLE,output:ut.NOTES_SHRADO_ANGLE},input:{enabled:Il,params:{distance:Bl,maxTime:Al},html:Te,adjustTime:Th},output:{html:null},run:Ah};function Th(t){vn=t,Le.value=O(vn.toBeatTime(Yt.input.params.maxTime),2).toString()}function Lh(){Yt.input.params.distance=Math.max(parseInt(this.value),0),this.value=Yt.input.params.distance.toString()}function xh(){Yt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=O(Yt.input.params.maxTime*1e3,1).toString(),vn&&(Le.value=O(vn.toBeatTime(Yt.input.params.maxTime),2).toString())}function Rh(){if(!vn){this.value="0";return}let t=O(Math.abs(parseFloat(this.value)),2)||1;Yt.input.params.maxTime=vn.toRealTime(t),Xe.value=O(Yt.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Ih(t){var p;const{bpm:e}=t.settings,{noteContainer:n}=t.difficulty,{maxTime:i,distance:r}=Yt.input.params,a=e.toBeatTime(i)+.001,s={},o={},c={},l={0:[],1:[],3:[]},u=[];for(let g=0,d=n.length;g<d;g++){if(n[g].type!=="note")continue;const m=n[g];s[m.data.color]?Bt.next(m,s[m.data.color],e,l[m.data.color])?(c[m.data.color]&&(c[m.data.color]=null,o[m.data.color]=(p=iu[o[m.data.color]])!=null?p:8),m.data.getDistance(s[m.data.color].data)>=r&&ho(m.data.direction,o[m.data.color],m.data.color)&&m.data.time-s[m.data.color].data.time<=a&&u.push(m),m.data.direction===8?c[m.data.color]=m:o[m.data.color]=m.data.direction,l[m.data.color]=[]):(c[m.data.color]&&m.data.getDistance(s[m.data.color].data)>=r&&ho(m.data.direction,o[m.data.color],m.data.color)&&m.data.time-s[m.data.color].data.time<=a&&(u.push(c[m.data.color]),c[m.data.color]=null),m.data.direction!==8&&(o[m.data.color]=m.data.direction)):o[m.data.color]=m.data.direction,s[m.data.color]=m,l[m.data.color].push(m)}return u.map(g=>g.data.time).filter(function(g,d,m){return!d||g!==m[d-1]})}function ho(t,e,n){return t===8||e===8?!1:(n===0?e===7:e===6)&&t===0}function Ah(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Ih(t);e.length?Yt.output.html=dt("Shrado angle",e,t.settings.bpm):Yt.output.html=null}const $l="Speed Pause",Nl="Look for stream/burst containing timing gap causing sudden change of pace.",Ml=!1,Ol=.075;let En;const Tn=document.createElement("div"),Ue=document.createElement("input"),fr=document.createElement("label"),Ge=document.createElement("input"),mr=document.createElement("label");fr.textContent="stream speed (ms): ";fr.htmlFor="input__tools-speed-pause-time";Ue.id="input__tools-speed-pause-time";Ue.className="input-toggle input--small";Ue.type="number";Ue.min="0";Ue.value=O(Ol*1e3,1).toString();Ue.addEventListener("change",$h);mr.textContent=" (prec): ";mr.htmlFor="input__tools-speed-pause-prec";Ge.id="input__tools-speed-pause-prec";Ge.className="input-toggle input--small";Ge.type="number";Ge.min="0";Ge.addEventListener("change",Nh);Tn.appendChild(ot.create($l,Nl,Ml,function(){ue.input.enabled=this.checked}));Tn.appendChild(fr);Tn.appendChild(Ue);Tn.appendChild(mr);Tn.appendChild(Ge);const ue={name:$l,description:Nl,type:"note",order:{input:ct.NOTES_SPEED_PAUSE,output:ut.NOTES_SPEED_PAUSE},input:{enabled:Ml,params:{maxTime:Ol},html:Tn,adjustTime:Bh},output:{html:null},run:Oh};function Bh(t){En=t,Ge.value=O(1/En.toBeatTime(ue.input.params.maxTime),2).toString()}function $h(){ue.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=O(ue.input.params.maxTime*1e3,1).toString(),En&&(Ge.value=O(1/En.toBeatTime(ue.input.params.maxTime),2).toString())}function Nh(){if(!En){this.value="0";return}let t=O(Math.abs(parseFloat(this.value)),2)||1;ue.input.params.maxTime=En.toRealTime(1/t),Ue.value=O(ue.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Mh(t,e){const{bpm:n}=t,{noteContainer:i}=e,{maxTime:r}=ue.input.params,a=n.toBeatTime(r)+.001,s={},o={},c={0:!1,1:!1,3:!1},l={0:[],1:[],3:[]},u=[];for(let p=0,g=i.length;p<g;p++){if(i[p].type!=="note")continue;const d=i[p];s[d.data.color]?Bt.next(d,s[d.data.color],n,l[d.data.color])&&(d.data.time-s[d.data.color].data.time<=a*2?(c[0]&&c[1]&&s[d.data.color].data.time-o[d.data.color].data.time<=a*3&&u.push(s[d.data.color]),c[d.data.color]=!1):c[d.data.color]||(c[d.data.color]=!0,o[d.data.color]=s[d.data.color]),l[d.data.color]=[],s[d.data.color]=d):s[d.data.color]=d,l[d.data.color].push(d)}return u.map(p=>p.data.time).filter(function(p,g,d){return!g||p!==d[g-1]})}function Oh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Mh(t.settings,t.difficulty);e.length?ue.output.html=dt("Speed pause",e,t.settings.bpm):ue.output.html=null}const fo="Hitbox Staircase",mo="Check for overlapping post-swing hitbox with note hitbox during swing.",po=!0,Si={name:fo,description:mo,type:"note",order:{input:ct.NOTES_HITBOX_STAIR,output:ut.NOTES_HITBOX_STAIR},input:{enabled:po,params:{},html:ot.create(fo,mo,po,function(){Si.input.enabled=this.checked})},output:{html:null},run:Hh},Ph=(t,e,n)=>{for(let i=n,r=e.length;i<r;i++)if(e[i].type==="note"){if(e[i].data.time<t.data.time+.01&&e[i].data.color!==t.data.color)return!0;if(e[i].data.time>t.data.time+.01)return!1}return!1};function Fh(t){const{bpm:e}=t.settings,{noteContainer:n}=t.difficulty,i=e.toBeatTime(.15),r={},a={},s={},o={0:[],1:[],3:[]},c={0:_n.create(),1:_n.create({c:1})},l=[];for(let u=0,p=n.length;u<p;u++){if(n[u].type!=="note")continue;const g=n[u];r[g.data.color]?(Bt.next(g,r[g.data.color],e,o[g.data.color])?(s[g.data.color]=g.data.time-r[g.data.color].data.time,g.data.direction!==8?(c[g.data.color].posX=g.data.posX+Ae[g.data.direction][0],c[g.data.color].posY=g.data.posY+Ae[g.data.direction][1]):(c[g.data.color].posX=-1,c[g.data.color].posY=-1),o[g.data.color]=[],a[g.data.color]=g.data.direction):dl(g.data,r[g.data.color].data,a[g.data.color])&&(g.data.direction!==8?(c[g.data.color].posX=g.data.posX+Ae[g.data.direction][0],c[g.data.color].posY=g.data.posY+Ae[g.data.direction][1],a[g.data.color]=g.data.direction):(c[g.data.color].posX=g.data.posX+Ae[a[g.data.color]][0],c[g.data.color].posY=g.data.posY+Ae[a[g.data.color]][1])),r[(g.data.color+1)%2]&&g.data.time-r[(g.data.color+1)%2].data.time!==0&&g.data.time-r[(g.data.color+1)%2].data.time<Math.min(i,s[(g.data.color+1)%2])&&g.data.posX===c[(g.data.color+1)%2].posX&&g.data.posY===c[(g.data.color+1)%2].posY&&!Ph(g,n,u)&&l.push(g)):(g.data.direction!==8?(c[g.data.color].posX=g.data.posX+Ae[g.data.direction][0],c[g.data.color].posY=g.data.posY+Ae[g.data.direction][1]):(c[g.data.color].posX=-1,c[g.data.color].posY=-1),a[g.data.color]=g.data.direction),r[g.data.color]=g,o[g.data.color].push(g)}return l.map(u=>u.data.time).filter(function(u,p,g){return!p||u!==g[p-1]})}function Hh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Fh(t);e.length?Si.output.html=dt("Hitbox staircase",e,t.settings.bpm):Si.output.html=null}const go="Hitbox Reverse Staircase",_o="Check for overlapping pre-swing hitbox with note hitbox during swing.",bo=!0,Ci={name:go,description:_o,type:"note",order:{input:ct.NOTES_HITBOX_REVERSE_STAIR,output:ut.NOTES_HITBOX_REVERSE_STAIR},input:{enabled:bo,params:{},html:ot.create(go,_o,bo,function(){Ci.input.enabled=this.checked})},output:{html:null},run:Uh},jh=.03414823529,zh=.03414823529;function Xh(t){const{bpm:e,njs:n}=t.settings,{noteContainer:i}=t.difficulty,r={},a={0:[],1:[]},s=[];for(let o=0,c=i.length;o<c;o++){if(i[o].type!=="note")continue;const l=i[o];r[l.data.color]&&Bt.next(l,r[l.data.color],e,a[l.data.color])&&(a[l.data.color]=[]);for(const u of a[(l.data.color+1)%2])if(u.type==="note"&&u.data.direction!==8){if(!(e.toRealTime(l.data.time)>e.toRealTime(u.data.time)+.01))continue;const p=u.data.getAngle()%90>15&&u.data.getAngle()%90<75;if(n.value<1.425/(60*(l.data.time-u.data.time)/e.value+(p?zh:jh))&&Ia(l.data,u.data,[[15,1.5]])[1]){s.push(u);break}}r[l.data.color]=l,a[l.data.color].push(l)}return s.map(o=>o.data.time).filter(function(o,c,l){return!c||o!==l[c-1]})}function Uh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Xh(t);e.length?Ci.output.html=dt("Hitbox reverse Staircase",e,t.settings.bpm):Ci.output.html=null}const yo="Hitbox Inline",vo="Check for overlapping note hitbox for inline note.",Eo=!0,ki={name:yo,description:vo,type:"note",order:{input:ct.NOTES_HITBOX_INLINE,output:ut.NOTES_HITBOX_INLINE},input:{enabled:Eo,params:{},html:ot.create(yo,vo,Eo,function(){ki.input.enabled=this.checked})},output:{html:null},run:Vh},Gh=0;function Yh(t){const{bpm:e,njs:n}=t.settings,{noteContainer:i}=t.difficulty,r={},a={0:[],1:[],3:[]},s=[];for(let o=0,c=i.length;o<c;o++){if(i[o].type!=="note")continue;const l=i[o];r[l.data.color]&&Bt.next(l,r[l.data.color],e,a[l.data.color])&&(a[l.data.color]=[]);for(const u of a[(l.data.color+1)%2])if(u.type==="note"&&n.value<1.425/(60*(l.data.time-u.data.time)/e.value+Gh)&&l.data.isInline(u.data)){s.push(l);break}r[l.data.color]=l,a[l.data.color].push(l)}return s.map(o=>o.data.time).filter(function(o,c,l){return!c||o!==l[c-1]})}function Vh(t){const e=Yh(t);e.length?ki.output.html=dt("Hitbox inline",e,t.settings.bpm):ki.output.html=null}const wo="Hitbox Path",So="Check for overlapping pre-swing note hitbox at same time.",Co=!0,Di={name:wo,description:So,type:"note",order:{input:ct.NOTES_HITBOX_PATH,output:ut.NOTES_HITBOX_PATH},input:{enabled:Co,params:{},html:ot.create(wo,So,Co,function(){Di.input.enabled=this.checked})},output:{html:null},run:qh};function Wh(t){const{bpm:e}=t.settings,{colorNotes:n}=t.difficulty.data,i=[];let r=0;for(let a=0,s=n.length;a<s;a++)if(!(e.toRealTime(n[a].time)<r+.01))for(let o=a+1;o<s&&!(e.toRealTime(n[o].time)>e.toRealTime(n[a].time)+.01);o++)n[a].color!==n[o].color&&((n[a].isHorizontal(n[o])||n[a].isVertical(n[o]))&&Ia(n[a],n[o],[[45,1],[15,2]]).some(c=>c)||n[a].isDiagonal(n[o])&&Ia(n[a],n[o],[[45,1],[15,1.5]]).some(c=>c))&&(i.push(n[a]),r=e.toRealTime(n[a].time));return i.map(a=>a.time).filter(function(a,s,o){return!s||a!==o[s-1]})}function qh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Wh(t);e.length?Di.output.html=dt("Hitbox path",e,t.settings.bpm):Di.output.html=null}const ko="Improper Arc",Do="Check for correct use of arc.",To=!0,Ti={name:ko,description:Do,type:"note",order:{input:ct.NOTES_IMPROPER_ARC,output:ut.NOTES_IMPROPER_ARC},input:{enabled:To,params:{},html:ot.create(ko,Do,To,function(){Ti.input.enabled=this.checked})},output:{html:null},run:Jh};function Zh(t){const e=[...t.difficulty.noteContainer].sort((i,r)=>i.type!=="slider"?1:r.type!=="slider"?-1:0).sort((i,r)=>i.data.time-r.data.time);console.log(e);const n=[];for(let i=0,r=!0,a=e.length;i<a;i++){const s=e[i];if(s.type==="slider"){r=!0;for(let o=i,c=!1;o<a;o++){const l=e[o];if(l.type==="note"&&s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001&&s.data.color===l.data.color&&(l.data.direction!==8?s.data.direction===l.data.direction:!0)){for(let u=o;u<a;u++){const p=e[o];if(!(p.type!=="note"||p.data.time<s.data.tailTime)){if(s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001&&(s.data.color!==l.data.color||(l.data.direction!==8?s.data.direction!==l.data.direction:!0))){c=!0;break}if(l.data.time>s.data.tailTime+.001)break}}r=c||!1;break}if(l.type==="bomb"&&s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001||l.data.time>s.data.time+.001)break}r&&n.push(s)}}return n.map(i=>i.data.time).filter(function(i,r,a){return!r||i!==a[r-1]})}function Jh(t){const e=Zh(t);e.length?Ti.output.html=dt("Improper arc",e,t.settings.bpm):Ti.output.html=null}const Lo="Improper Chain",xo="Check for correct use of chain.",Ro=!0,Li={name:Lo,description:xo,type:"note",order:{input:ct.NOTES_IMPROPER_CHAIN,output:ut.NOTES_IMPROPER_CHAIN},input:{enabled:Ro,params:{},html:ot.create(Lo,xo,Ro,function(){Li.input.enabled=this.checked})},output:{html:null},run:Qh};function Kh(t){const e=[...t.difficulty.noteContainer].sort((i,r)=>i.type!=="burstSlider"?1:r.type!=="burstSlider"?-1:0).sort((i,r)=>i.data.time-r.data.time),n=[];for(let i=0,r=!0,a=e.length;i<a;i++){const s=e[i];if(s.type==="burstSlider"){r=!0;for(let o=i;o<a;o++){const c=e[o];if(c.type==="note"&&s.data.posX===c.data.posX&&s.data.posY===c.data.posY&&c.data.time<=s.data.time+.001&&s.data.color===c.data.color&&(c.data.direction!==8?s.data.direction===c.data.direction:!0)){r=!1;break}if(c.type==="bomb"&&s.data.posX===c.data.posX&&s.data.posY===c.data.posY&&c.data.time<=s.data.time+.001||c.data.time>s.data.time+.001)break}r&&n.push(s)}}return n.map(i=>i.data.time).filter(function(i,r,a){return!r||i!==a[r-1]})}function Qh(t){const e=Kh(t);e.length?Li.output.html=dt("Improper chain",e,t.settings.bpm):Li.output.html=null}const Io="Improper Window Snap",Ao="Check for slanted window snap timing.",Bo=!0,xi={name:Io,description:Ao,type:"note",order:{input:ct.NOTES_IMPROPER_WINDOW,output:ut.NOTES_IMPROPER_WINDOW},input:{enabled:Bo,params:{},html:ot.create(Io,Ao,Bo,function(){xi.input.enabled=this.checked})},output:{html:null},run:ed};function td(t){const{bpm:e}=t.settings,{noteContainer:n}=t.difficulty,i={},r={0:[],1:[],3:[]},a=[];for(let s=0,o=n.length;s<o;s++){if(n[s].type!=="note")continue;const c=n[s];i[c.data.color]?Bt.next(c,i[c.data.color],e,r[c.data.color])?(i[c.data.color]=c,r[c.data.color]=[]):c.data.isSlantedWindow(i[c.data.color].data)&&c.data.time-i[c.data.color].data.time>=.001&&c.data.direction===i[c.data.color].data.direction&&c.data.direction!==8&&i[c.data.color].data.direction!==8&&a.push(i[c.data.color]):i[c.data.color]=c,r[c.data.color].push(c)}return a.map(s=>s.data.time).filter(function(s,o,c){return!o||s!==c[o-1]})}function ed(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=td(t);e.length?xi.output.html=dt("Improper window snap",e,t.settings.bpm):xi.output.html=null}var Yn={create:(t,e,n,i,...r)=>{const a=document.createElement(n);a.className=i;const s=document.createElement("select");s.className="input-toggle",s.id=t,r.forEach(c=>{const l=document.createElement("option");l.textContent=c.text,l.value=c.value,s.append(l)});const o=document.createElement("label");return o.htmlFor=t,o.innerHTML=`<span>${e}</span>`,a.append(o),a.append(s),a}},Pl=(t=>(t.forehand="backhand",t.backhand="forehand",t))(Pl||{});const ei={0:{forehand:[1,3,6,7],backhand:[0,2,4,5]},1:{forehand:[1,2,6,7],backhand:[0,3,4,5]}},Ke={0:[0,0,90,90,45,-45,45,-45],1:[0,0,-90,-90,-45,45,-45,45]},$o={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},Bn=class{constructor(t,e,n,i,r,a){this.color=e,this.warningThreshold=n,this.errorThreshold=i,this.allowedRotation=r,a&&a!=="neutral"?(this.state=a,this.rotation=0):(this.state=this.predictStartState(t,e),this.rotation=this.predictStartRotation(t,e)),this.position=this.predictStartPosition(t,e)}check(t,e){if(this.state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const n=t[0].data.time,i=this.color;let r=this.state,a=this.rotation;e.forEach(l=>{l.data.time-.001>n||(l.data.posY===0&&l.data.posX===(i?2:1)&&(r="backhand",a=0),l.data.posY===2&&l.data.posX===(i?2:1)&&(r="forehand",a=0))});let s,o=8;for(const l of t)l.type==="note"&&(l.data.direction!==8&&(o=l.data.direction),s&&o===8&&(o=to(l.data,s.data)),s=l);if(o===8)return"none";const c=$o[i][Pl[r]][o];return(a>c?a-c:c-a)>180||c<Bn.CONSTRAINT_ROTATION[i][0]+this.errorThreshold||c>Bn.CONSTRAINT_ROTATION[i][1]-this.errorThreshold?"error":c<Bn.CONSTRAINT_ROTATION[i][0]+this.warningThreshold||c>Bn.CONSTRAINT_ROTATION[i][1]-this.warningThreshold||(a>c?a-c:c-a)>this.allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let s=0;s<t.length;s++){if(t[s].type!=="note")continue;const o=t[s];if(ei[o.data.color].forehand.includes(o.data.direction)){this.state="backhand";break}if(ei[o.data.color].backhand.includes(o.data.direction)){this.state="forehand";break}this.state==="neutral"&&o.data.direction===8&&(o.data.posY===0&&(this.state="backhand"),o.data.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const n=t[0].data.time,i=this.color;e.forEach(s=>{s.data.time-.001>n||(s.data.posY===0&&s.data.posX===(i?2:1)&&(this.state="forehand",this.rotation=0),s.data.posY===2&&s.data.posX===(i?2:1)&&(this.state="backhand",this.rotation=0))});let r,a=8;for(const s of t)s.type==="note"&&(s.data.direction!==8&&(a=s.data.direction),r&&a===8&&(a=to(s.data,r.data)),r=s);a!==8&&(this.rotation=$o[this.color][this.state][a])}predictStartState(t,e){let n="neutral";for(let i=0,r=t.length;i<r;i++){if(t[i].type==="bomb"&&(t[i].data.posY===0&&(t[i].data.posX,n="backhand"),t[i].data.posY===2&&(t[i].data.posX,n="forehand")),t[i].type!=="note")continue;let a=t[i];if(a.data.color!==Math.abs(e-1)&&a.data.color===e){if(n!=="neutral")break;const s=a.data.time;for(let o=i;o<t.length&&!(t[o].data.time>a.data.time+.001&&s<a.data.time+.001);o++){if(a=t[o],ei[a.data.color].forehand.includes(a.data.direction))return"backhand";if(ei[a.data.color].backhand.includes(a.data.direction))return"forehand";n==="neutral"&&a.data.direction===8&&(a.data.posY===0&&(n="backhand"),a.data.posY>0&&(n="forehand"))}break}}return n}predictStartRotation(t,e){let n=0;for(let i=0,r=t.length;i<r;i++){if(t[i].type!=="note")continue;let a=t[i];if(a.data.color===e&&a.data.color===e){const s=a.data.time;for(let o=i;o<t.length&&!(t[o].data.time>a.data.time+.001&&s<a.data.time+.001);o++){if(a=t[o],a.data.direction!==8)return Ke[a.data.color][a.data.direction];a.data.direction===8&&(a.data.posY===0&&(a.data.posX===0&&(n=Ke[a.data.color][6]),a.data.posX===3&&(n=Ke[a.data.color][7])),a.data.posY===1&&(a.data.posX===0&&(n=Ke[a.data.color][2]),a.data.posX===3&&(n=Ke[a.data.color][3])),a.data.posY===2&&(a.data.posX===0&&(n=Ke[a.data.color][4]),a.data.posX===3&&(n=Ke[a.data.color][5])))}break}}return n}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let Aa=Bn;Aa.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];const Fl="Parity Check",Hl="Perform parity check.",jl=!1,zl=document.createElement("div");Yn.create("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});Yn.create("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Yn.create("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});zl.appendChild(ot.create(Fl+" (EXPERIMENTAL)",Hl,jl,function(){Xn.input.enabled=this.checked}));const Xn={name:Fl,description:Hl,type:"note",order:{input:ct.NOTES_PARITY,output:ut.NOTES_PARITY},input:{enabled:jl,params:{warningThres:90,errorThres:45,allowedRot:90},html:zl},output:{html:null},run:id};function nd(t){const{bpm:e}=t.settings,{noteContainer:n}=t.difficulty,{warningThres:i,errorThres:r,allowedRot:a}=Xn.input.params,s={},o={0:[],1:[]},c={0:[],1:[]},l={0:[],1:[]},u={0:new Aa(n,0,i,r,a),1:new Aa(n,1,i,r,a)},p={warning:[],error:[]};for(let g=0,d=n.length;g<d;g++){const m=n[g];if(m.type==="note"&&s[m.data.color]&&Bt.next(m,s[m.data.color],e,o[m.data.color])){switch(u[m.data.color].check(o[m.data.color],l[m.data.color])){case"warning":{p.warning.push(o[m.data.color][0].data.time);break}case"error":{p.error.push(o[m.data.color][0].data.time);break}}u[m.data.color].next(o[m.data.color],l[m.data.color]),l[m.data.color]=c[m.data.color],c[m.data.color]=[],o[m.data.color]=[]}m.type==="bomb"&&(c[0].push(m),c[1].push(m)),m.type==="note"&&(s[m.data.color]=m,o[m.data.color].push(m))}for(let g=0;g<2;g++)if(s[g])switch(u[g].check(o[g],c[g])){case"warning":{p.warning.push(o[g][0].data.time);break}case"error":{p.error.push(o[g][0].data.time);break}}return p}function id(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=nd(t);e.warning=e.warning.filter(function(i,r,a){return!r||i!==a[r-1]}).sort((i,r)=>i-r),e.error=e.error.filter(function(i,r,a){return!r||i!==a[r-1]}).sort((i,r)=>i-r);const n=[];if(e.warning.length&&n.push(dt("Parity warning",e.warning,t.settings.bpm)),e.error.length&&n.push(dt("Parity error",e.error,t.settings.bpm)),n.length){const i=document.createElement("div");n.forEach(r=>i.append(r)),Xn.output.html=i}else Xn.output.html=null}const No="Double-directional",Mo="Check double-directional note swing (this may not mean parity break).",Oo=!0,Ri={name:No,description:Mo,type:"note",order:{input:ct.NOTES_DOUBLE_DIRECTIONAL,output:ut.NOTES_DOUBLE_DIRECTIONAL},input:{enabled:Oo,params:{},html:ot.create(No,Mo,Oo,function(){Ri.input.enabled=this.checked})},output:{html:null},run:rd};function ad(t,e){const{bpm:n}=t,i=e.noteContainer,r={},a={},s={},o={0:[],1:[]},c=[];for(let l=0,u=i.length;l<u;l++){const p=i[l];p.type==="note"&&r[p.data.color]?Bt.next(p,r[p.data.color],n,o[p.data.color])?(s[p.data.color]&&(s[p.data.color]=null,a[p.data.color]=(a[p.data.color]+180)%360),zn(p.data,a[p.data.color],45,!0)&&c.push(p.data),p.data.direction===8?s[p.data.color]=p.data:a[p.data.color]=p.data.getAngle(),o[p.data.color]=[]):(s[p.data.color]&&zn(p.data,a[p.data.color],45,!0)&&(c.push(p.data),s[p.data.color]=null,a[p.data.color]=p.data.getAngle()),p.data.direction!==8&&(s[p.data.color]=null,a[p.data.color]=p.data.getAngle())):p.type==="note"&&(a[p.data.color]=p.data.getAngle()),p.type==="note"&&(r[p.data.color]=p,o[p.data.color].push(p)),p.type==="bomb"&&(p.data.posY===0&&(p.data.posX===1&&(a[0]=Jt[0],s[0]=null),p.data.posX===2&&(a[1]=Jt[0],s[1]=null)),p.data.posY===2&&(p.data.posX===1&&(a[0]=Jt[1],s[0]=null),p.data.posX===2&&(a[1]=Jt[1],s[1]=null)))}return c.map(l=>l.time).filter(function(l,u,p){return!u||l!==p[u-1]})}function rd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=ad(t.settings,t.difficulty);e.length?Ri.output.html=dt("Double-directional",e,t.settings.bpm):Ri.output.html=null}const Xl="Vision Block",Ul="Check for vision block caused by center note.",Gl=!0,Yl=.1,Vl=.5;let Vt;const Po={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},$t=document.createElement("div"),un=document.createElement("input"),pr=document.createElement("label"),Ye=document.createElement("input"),gr=document.createElement("label"),Ve=document.createElement("input"),_r=document.createElement("label"),xe=document.createElement("input"),br=document.createElement("label"),ye=document.createElement("input"),yr=document.createElement("label"),de=document.createElement("input"),vr=document.createElement("label");pr.textContent=" VB time specific ";pr.htmlFor="input__tools-vb-time-check";un.id="input__tools-vb-time-check";un.className="input-toggle";un.type="radio";un.name="input__tools-vb-spec";un.value="time";un.addEventListener("change",Wl);gr.textContent=" VB difficulty specific ";gr.htmlFor="input__tools-vb-diff-check";Ye.id="input__tools-vb-diff-check";Ye.className="input-toggle";Ye.type="radio";Ye.checked=!0;Ye.name="input__tools-vb-spec";Ye.value="difficulty";Ye.addEventListener("change",Wl);_r.textContent="min time (ms): ";_r.htmlFor="input__tools-vb-min-time";Ve.id="input__tools-vb-min-time";Ve.className="input-toggle input--small";Ve.type="number";Ve.min="0";Ve.value=O(Yl*1e3,1).toString();Ve.addEventListener("change",sd);br.textContent=" (beat): ";br.htmlFor="input__tools-vb-min-beat";xe.id="input__tools-vb-min-beat";xe.className="input-toggle input--small";xe.type="number";xe.min="0";xe.step="0.1";xe.addEventListener("change",ld);yr.textContent="max time (ms): ";yr.htmlFor="input__tools-vb-max-time";ye.id="input__tools-vb-max-time";ye.className="input-toggle input--small";ye.type="number";ye.min="0";ye.value=O(Vl*1e3,1).toString();ye.addEventListener("change",cd);vr.textContent=" (beat): ";vr.htmlFor="input__tools-vb-max-beat";de.id="input__tools-vb-max-beat";de.className="input-toggle input--small";de.type="number";de.min="0";de.step="0.1";de.addEventListener("change",ud);$t.appendChild(ot.create(Xl,Ul,Gl,function(){mt.input.enabled=this.checked}));$t.appendChild(un);$t.appendChild(pr);$t.appendChild(Ye);$t.appendChild(gr);$t.appendChild(document.createElement("br"));$t.appendChild(_r);$t.appendChild(Ve);$t.appendChild(br);$t.appendChild(xe);$t.appendChild(document.createElement("br"));$t.appendChild(yr);$t.appendChild(ye);$t.appendChild(vr);$t.appendChild(de);const mt={name:Xl,description:Ul,type:"note",order:{input:ct.NOTES_VISION_BLOCK,output:ut.NOTES_VISION_BLOCK},input:{enabled:Gl,params:{specific:"difficulty",minTime:Yl,maxTime:Vl},html:$t,adjustTime:od},output:{html:null},run:dd};function od(t){Vt=t,xe.value=O(Vt.toBeatTime(mt.input.params.minTime),2).toString(),de.value=O(Vt.toBeatTime(mt.input.params.maxTime),2).toString()}function Wl(){mt.input.params.specific=this.value}function sd(){mt.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=O(mt.input.params.minTime*1e3,1).toString(),Vt&&(xe.value=O(Vt.toBeatTime(mt.input.params.minTime),2).toString(),mt.input.params.minTime>mt.input.params.maxTime&&(mt.input.params.maxTime=mt.input.params.minTime,ye.value=O(mt.input.params.maxTime*1e3,1).toString(),de.value=O(Vt.toBeatTime(mt.input.params.maxTime),2).toString()))}function ld(){if(!Vt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;mt.input.params.minTime=Vt.toRealTime(t),Ve.value=O(mt.input.params.minTime*1e3,1).toString(),this.value=O(t,2).toString(),mt.input.params.minTime>mt.input.params.maxTime&&(mt.input.params.maxTime=mt.input.params.minTime,ye.value=O(mt.input.params.maxTime*1e3,1).toString(),de.value=O(Vt.toBeatTime(mt.input.params.maxTime),2).toString())}function cd(){mt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=O(mt.input.params.maxTime*1e3,1).toString(),Vt&&(de.value=O(Vt.toBeatTime(mt.input.params.maxTime),2).toString())}function ud(){if(!Vt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;mt.input.params.maxTime=Vt.toRealTime(t),ye.value=O(mt.input.params.maxTime*1e3,1).toString(),this.value=O(t,2).toString()}function hd(t){const{bpm:e,njs:n}=t.settings,i=t.difficulty.data.getNoteContainer().filter(g=>g.type!=="slider"),{minTime:r,maxTime:a,specific:s}=mt.input.params,o=s==="time"?e.toBeatTime(r):e.toBeatTime(Po[t.difficulty.difficulty].min),c=s==="time"?e.toBeatTime(a):Math.min(n.hjd,e.toBeatTime(Po[t.difficulty.difficulty].max));let l=null,u=null;const p=[];for(let g=0,d=i.length;g<d;g++){const m=i[g];l&&(m.data.time-l.data.time>=o&&m.data.time-l.data.time<=c?m.data.posX<2&&p.push(m):m.data.time-l.data.time>c&&(l=null)),u&&(m.data.time-u.data.time>=o&&m.data.time-u.data.time<=c?m.data.posX>1&&p.push(m):m.data.time-u.data.time>c&&(u=null)),m.data.posY===1&&m.data.posX===1&&(l=m),m.data.posY===1&&m.data.posX===2&&(u=m)}return p.map(g=>g.data.time).filter(function(g,d,m){return!d||g!==m[d-1]})}function dd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=hd(t);e.length?mt.output.html=dt("Vision block",e,t.settings.bpm):mt.output.html=null}const Fo="Stacked Note",Ho="Look for stacked note.",jo=!0,Ii={name:Fo,description:Ho,type:"note",order:{input:ct.NOTES_STACKED_NOTE,output:ut.NOTES_STACKED_NOTE},input:{enabled:jo,params:{},html:ot.create(Fo,Ho,jo,function(){Ii.input.enabled=this.checked})},output:{html:null},run:pd};function fd(t,e){const{bpm:n}=t,{colorNotes:i}=e.data,r=[];let a=0;for(let s=0,o=i.length;s<o;s++)if(!(n.toRealTime(i[s].time)<a+.01))for(let c=s+1;c<o&&!(n.toRealTime(i[c].time)>n.toRealTime(i[s].time)+.01);c++)i[c].isInline(i[s])&&(r.push(i[s]),a=n.toRealTime(i[s].time));return r.map(s=>s.time).filter(function(s,o,c){return!o||s!==c[o-1]})}function md(t,e){const{bpm:n,njs:i}=t,{bombNotes:r}=e.data,a=[];for(let s=0,o=r.length;s<o;s++)for(let c=s+1;c<o&&!(n.toRealTime(r[c].time)>n.toRealTime(r[s].time)+1);c++)r[s].isInline(r[c])&&(i.value<n.value/(120*(r[c].time-r[s].time))||n.toRealTime(r[c].time)<n.toRealTime(r[s].time)+.02)&&a.push(r[s]);return a.map(s=>s.time).filter(function(s,o,c){return!o||s!==c[o-1]})}function pd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=fd(t.settings,t.difficulty),n=md(t.settings,t.difficulty),i=[];if(e.length&&i.push(dt("Stacked note",e,t.settings.bpm)),n.length&&i.push(dt("Stacked bomb",n,t.settings.bpm)),i.length){const r=document.createElement("div");i.forEach(a=>r.append(a)),Ii.output.html=r}else Ii.output.html=null}const zo="Color Check",Xo="Compare note color with other colored note and the arrow on itself.",Uo=!0,Go=[1,1,1],Yo={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"},Vo=(t,e)=>{var r;let n=(r=Object.keys(t).find(a=>parseFloat(a)>=e))!=null?r:"100",i=parseFloat(n);return t[i]},Ai={name:zo,description:Xo,type:"note",order:{input:ct.NOTES_COLOR_CHECK,output:ut.NOTES_COLOR_CHECK},input:{enabled:Uo,params:{},html:ot.create(zo+" (EXPERIMENTAL)",Xo,Uo,function(){Ai.input.enabled=this.checked})},output:{html:null},run:bd};function gd(t){var i,r,a,s,o,c,l,u;const e=(s=(r=(i=t.difficulty)==null?void 0:i.info._customData)==null?void 0:r._colorLeft)!=null?s:Gt[(a=Ut[t.info._environmentName])!=null?a:"The First"]._colorLeft,n=(u=(c=(o=t.difficulty)==null?void 0:o.info._customData)==null?void 0:c._colorRight)!=null?u:Gt[(l=Ut[t.info._environmentName])!=null?l:"The First"]._colorRight;return e&&n?Ki(ui(e),ui(n)):100}function _d(t){var a,s,o,c,l,u,p,g;let e=100,n=100;const i=(c=(s=(a=t.difficulty)==null?void 0:a.info._customData)==null?void 0:s._colorLeft)!=null?c:Gt[(o=Ut[t.info._environmentName])!=null?o:"The First"]._colorLeft,r=(g=(u=(l=t.difficulty)==null?void 0:l.info._customData)==null?void 0:u._colorRight)!=null?g:Gt[(p=Ut[t.info._environmentName])!=null?p:"The First"]._colorRight;return i&&(e=Ki(Go,ui(i))),r&&(n=Ki(Go,ui(r))),Math.min(e,n)}function bd(t){var r,a,s,o;if(!((a=(r=t.difficulty)==null?void 0:r.info._customData)!=null&&a._colorLeft)&&!((o=(s=t.difficulty)==null?void 0:s.info._customData)!=null&&o._colorRight))return;const e=gd(t),n=_d(t),i=[];if(e<=20&&i.push(ht(`${Vo(Yo,e)} note color (dE${O(e,1)})`,"suggest change to better differentiate between 2 note colour")),n<=20&&i.push(ht(`${Vo(Yo,n)} arrow note color (dE${O(n,1)})`,"may be difficult to see the arrow")),i.length){const c=document.createElement("div");i.forEach(l=>c.append(l)),Ai.output.html=c}else Ai.output.html=null}var Wo=Object.freeze(Object.defineProperty({__proto__:null,effectiveBPM:Pt,acceptablePrec:ln,varySwing:wi,slowSlider:Kt,inlineAngle:ce,shradoAngle:Yt,speedPause:ue,hitboxStair:Si,hitboxReverseStair:Ci,hitboxInline:ki,hitboxPath:Di,improperArc:Ti,improperChain:Li,improperWindow:xi,parity:Xn,doubleDirectional:Ri,visionBlock:mt,stackedNote:Ii,colorCheck:Ai},Symbol.toStringTag,{value:"Module"}));const qo="<15ms Obstacle",Zo=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,Jo=!0,Un={name:qo,description:Zo,type:"obstacle",order:{input:ct.OBSTACLES_SHORT,output:ut.OBSTACLES_SHORT},input:{enabled:Jo,params:{minDur:.015},html:ot.create(qo,Zo,Jo,function(){Un.input.enabled=this.checked})},output:{html:null},run:vd};function yd(t){const{obstacles:e}=t.difficulty.data,{bpm:n}=t.settings,{minDur:i}=Un.input.params,r=n.toBeatTime(i),a=[];let s=_e.create(),o=_e.create(),c=_e.create(),l=_e.create();return e.forEach(u=>{u.posY===0&&u.height>2&&u.duration>0?u.width>2||u.width>1&&u.posX===1?(u.isLonger(s)&&(u.duration<r&&a.push(u),s=u),u.isLonger(o)&&(u.duration<r&&a.push(u),o=u)):u.width===2?u.posX===0?u.isLonger(s)&&(u.duration<r&&a.push(u),s=u):u.posX===2&&u.isLonger(o)&&(u.duration<r&&a.push(u),o=u):u.width===1&&(u.posX===1?u.isLonger(s)&&(u.duration<r&&a.push(u),s=u):u.posX===2&&u.isLonger(o)&&(u.duration<r&&a.push(u),o=u)):u.posY===2&&u.height>2&&u.duration>0&&(u.width>2||u.width>1&&u.posX===1?(u.isLonger(c)&&(u.duration<r&&u.isLonger(s,r)&&u.isLonger(c,r)&&a.push(u),c=u),u.isLonger(l)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(l,r)&&a.push(u),l=u)):u.width===2?u.posX===0?u.isLonger(c)&&(u.duration<r&&u.isLonger(s,r)&&u.isLonger(c,r)&&a.push(u),c=u):u.posX===2&&u.isLonger(l)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(l,r)&&a.push(u),l=u):u.width===1&&(u.posX===1?u.isLonger(c)&&(u.duration<r&&u.isLonger(s,r)&&u.isLonger(c,r)&&a.push(u),c=u):u.posX===2&&u.isLonger(l)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(l,r)&&a.push(u),l=u)))}),a.map(u=>u.time).filter(function(u,p,g){return!p||u!==g[p-1]})}function vd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=yd(t);e.length?Un.output.html=dt("<15ms obstacle",e,t.settings.bpm):Un.output.html=null}const ql="2-wide Center Obstacle",Zl="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",Jl=!0,Kl=.25;let wn;const Ln=document.createElement("div"),We=document.createElement("input"),Er=document.createElement("label"),Re=document.createElement("input"),wr=document.createElement("label");Er.textContent="recovery time (ms): ";Er.htmlFor="input__tools-2wide-wall-time";We.id="input__tools-2wide-wall-time";We.className="input-toggle input--small";We.type="number";We.min="0";We.value=O(Kl*1e3,1).toString();We.addEventListener("change",wd);wr.textContent=" (beat): ";wr.htmlFor="input__tools-2wide-wall-beat";Re.id="input__tools-2wide-wall-beat";Re.className="input-toggle input--small";Re.type="number";Re.min="0";Re.step="0.1";Re.addEventListener("change",Sd);Ln.appendChild(ot.create(ql,Zl,Jl,function(){Qt.input.enabled=this.checked}));Ln.appendChild(Er);Ln.appendChild(We);Ln.appendChild(wr);Ln.appendChild(Re);const Qt={name:ql,description:Zl,type:"obstacle",order:{input:ct.OBSTACLES_CENTER,output:ut.OBSTACLES_CENTER},input:{enabled:Jl,params:{recovery:Kl},html:Ln,adjustTime:Ed},output:{html:null},run:kd};function Ed(t){wn=t,Re.value=O(wn.toBeatTime(Qt.input.params.recovery),2).toString()}function wd(){Qt.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=O(Qt.input.params.recovery*1e3,1).toString(),wn&&(Re.value=O(wn.toBeatTime(Qt.input.params.recovery),2).toString())}function Sd(){if(!wn){this.value="0";return}let t=O(Math.abs(parseFloat(this.value)),2)||1;Qt.input.params.recovery=wn.toRealTime(t),We.value=O(Qt.input.params.recovery*1e3,1).toString(),this.value=t.toString()}function Cd(t){const{obstacles:e}=t.difficulty.data,{bpm:n}=t.settings,{recovery:i}=Qt.input.params,r=[];let a=_e.create(),s=_e.create();return e.forEach(o=>{o.posY<2&&o.height>1&&(o.width>2&&(r.push(o),o.isLonger(a)&&(a=o),o.isLonger(s)&&(s=o)),o.width===2&&(o.posX===0&&o.isLonger(a)&&(n.toRealTime(o.time)>n.toRealTime(s.time)-i&&n.toRealTime(o.time)<n.toRealTime(s.time+s.duration)+i&&r.push(o),a=o),o.posX===1&&(r.push(o),o.isLonger(a)&&(a=o),o.isLonger(s)&&(s=o)),o.posX===2&&o.isLonger(s)&&(n.toRealTime(o.time)>n.toRealTime(a.time)-i&&n.toRealTime(o.time)<n.toRealTime(a.time+a.duration)+i&&r.push(o),s=o)),o.width===1&&(o.posX===1&&o.isLonger(a)&&(n.toRealTime(o.time)>n.toRealTime(s.time)-i&&n.toRealTime(o.time)<n.toRealTime(s.time+s.duration)+i&&r.push(o),a=o),o.posX===2&&o.isLonger(s)&&(n.toRealTime(o.time)>n.toRealTime(a.time)-i&&n.toRealTime(o.time)<n.toRealTime(a.time+a.duration)+i&&r.push(o),s=o)))}),r.map(o=>o.time).filter(function(o,c,l){return!c||o!==l[c-1]})}function kd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Cd(t),{recovery:n}=Qt.input.params;e.length?Qt.output.html=dt(`2-wide center obstacle (<${O(n*1e3)}ms)`,e,t.settings.bpm):Qt.output.html=null}const Ko="Zero Obstacle",Qo="Look for obstacle with zero value.",ts=!0,Bi={name:Ko,description:Qo,type:"obstacle",order:{input:ct.OBSTACLES_ZERO,output:ut.OBSTACLES_ZERO},input:{enabled:ts,params:{},html:ot.create(Ko,Qo,ts,function(){Bi.input.enabled=this.checked})},output:{html:null},run:Td};function Dd(t){const{obstacles:e}=t.difficulty.data;return e.filter(n=>n.hasZero()).map(n=>n.time)}function Td(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Dd(t);e.length?Bi.output.html=dt("Zero value obstacle",e,t.settings.bpm):Bi.output.html=null}var es=Object.freeze(Object.defineProperty({__proto__:null,shortObstacle:Un,centerObstacle:Qt,zeroObstacle:Bi},Symbol.toStringTag,{value:"Module"}));const ns="Insufficient Lighting Event",is="Check if there is enough light event.",as=!0,$i={name:ns,description:is,type:"event",order:{input:ct.EVENTS_INSUFFICIENT_LIGHT,output:ut.EVENTS_INSUFFICIENT_LIGHT},input:{enabled:as,params:{},html:ot.create(ns,is,as,function(){$i.input.enabled=this.checked})},output:{html:null},run:xd},Ld=t=>{let e=0;for(let n=t.length-1;n>=0;n--)if(t[n].isLightEvent()&&!t[n].isOff()&&(e++,e>10))return!0;return!1};function xd(t){if(!t.difficulty){console.error("Something went wrong!");return}Ld(t.difficulty.data.basicBeatmapEvents)?$i.output.html=null:$i.output.html=ht("Insufficient light event")}const rs="Unlit Bomb",os="Check for lighting around bomb.",ss=!0,Ni={name:rs,description:os,type:"event",order:{input:ct.EVENTS_UNLIT_BOMB,output:ut.EVENTS_UNLIT_BOMB},input:{enabled:ss,params:{},html:ot.create(rs,os,ss,function(){Ni.input.enabled=this.checked})},output:{html:null},run:Id},Rd=(t,e,n,i)=>{var p,g,d;if(!e.length)return[];const r=[],a=(g=(p=Be[i])==null?void 0:p[0])!=null?g:Be.DefaultEnvironment[0],s=e.filter(m=>m.isLightEvent()&&a.includes(m.type)).sort((m,_)=>m.type-_.type),o={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},c={};a.forEach(m=>c[m]=[[0,!1]]);const l=n.toBeatTime(1),u=n.toBeatTime(.25);for(let m=0,_=s.length;m<_;m++){const b=s[m];if((b.isOn()||b.isFlash())&&o[b.type].state!=="on"){o[b.type]={state:"on",time:b.time,fadeTime:0};const y=c[b.type].find(v=>v[0]>=b.time);y?(y[0]=b.time,y[1]=!0):c[b.type].push([b.time,!0])}if(b.isFade()){o[b.type]={state:"off",time:b.time,fadeTime:l};const y=c[b.type].find(v=>v[0]>=b.time);y?(y[0]=b.time,y[1]=!0):c[b.type].push([b.time,!0]),c[b.type].push([b.time+l,!1])}(((d=b==null?void 0:b.floatValue)!=null?d:1)<.25||b.isOff()||b.customData._color&&(typeof b.customData._color[3]=="number"&&b.customData._color[3]<.25||Math.max(b.customData._color[0],b.customData._color[1],b.customData._color[2])<.25))&&o[b.type].state!=="off"&&(o[b.type]={state:"off",time:b.time,fadeTime:o[b.type].state==="on"?u:Math.min(u,o[b.type].fadeTime)},c[b.type].push([b.time+(o[b.type].state==="on"?u:Math.min(u,o[b.type].fadeTime)),!1]))}for(const m in c)c[m].reverse();for(let m=0,_=t.length,b=!1;m<_;m++){const y=t[m];b=!1;for(const v in c){const S=c[v].find(D=>D[0]<=y.time);S&&(b=b||S[1])}b||r.push(y)}return r.map(m=>m.time).filter(function(m,_,b){return!_||m!==b[_-1]})};function Id(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Rd(t.difficulty.data.bombNotes,t.difficulty.data.basicBeatmapEvents,t.settings.bpm,t.info._environmentName);e.length?Ni.output.html=dt("Unlit bomb",e,t.settings.bpm):Ni.output.html=null}var ls=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:$i,unlitBomb:Ni},Symbol.toStringTag,{value:"Module"}));const Ql="Hot Start",tc="Check for first interactive object starting from start time.",ec=!0,nc=1.5,qe=document.createElement("input");qe.id="input__tools-hot-start";qe.className="input-toggle input--small";qe.type="number";qe.min="0";qe.step="0.1";qe.value=nc.toString();qe.addEventListener("change",Ad);const ic=ot.create(Ql+" (s): ",tc,ec,function(){on.input.enabled=this.checked});ic.appendChild(qe);const on={name:Ql,description:tc,type:"other",order:{input:ct.OTHERS_HOT_START,output:ut.OTHERS_HOT_START},input:{enabled:ec,params:{time:nc},html:ic},output:{html:null},run:Bd};function Ad(){on.input.params.time=O(Math.abs(parseFloat(this.value)),3),this.value=on.input.params.time.toString()}function Bd(t){if(!t.difficulty){console.error("Something went wrong!");return}const{time:e}=on.input.params,n=t.settings.bpm.toRealTime(t.difficulty.data.getFirstInteractiveTime());n<e?on.output.html=ht("Hot start",`${O(n,2)}s`):on.output.html=null}const cs="Difficulty Label Check",us="For ranking purpose, check difficulty label to fit rankability criteria.",hs=!0,Mi={name:cs,description:us,type:"other",order:{input:ct.OTHERS_DIFFICULTY_LABEL,output:ut.OTHERS_DIFFICULTY_LABEL},input:{enabled:hs,params:{},html:ot.create(cs,us,hs,function(){Mi.input.enabled=this.checked})},output:{html:null},run:$d};function $d(t){var n;if(!t.difficulty){console.error("Something went wrong!");return}const e=(n=t.difficulty.info._customData)==null?void 0:n._difficultyLabel;e&&e.length>30?Mi.output.html=ht(`Difficulty label is too long (${e.length} characters)`,"exceeded 30 max characters by ranking criteria"):Mi.output.html=null}const ds="NJS Check",fs="Check note jump speed for suitable value.",ms=!0,Oi={name:ds,description:fs,type:"other",order:{input:ct.OTHERS_NJS,output:ut.OTHERS_NJS},input:{enabled:ms,params:{},html:ot.create(ds,fs,ms,function(){Oi.input.enabled=this.checked})},output:{html:null},run:Nd};function Nd(t){if(!t.difficulty){console.error("Something went wrong!");return}const{njs:e,bpm:n}=t.settings,i=[];if(t.difficulty.info._noteJumpMovementSpeed===0&&i.push(ht("Unset NJS","fallback NJS is used")),e.value>23&&i.push(ht(`NJS is too high (${O(e.value,2)})`,"use lower whenever necessary")),e.jd<18&&i.push(ht("Very low jump distance",`${O(e.jd,2)}`)),e.jd>36&&i.push(ht("Very high jump distance",`${O(e.jd,2)}`)),e.jd>e.calcJumpDistanceOptimalHigh()&&i.push(ht(`High jump distance warning (>${O(e.calcJumpDistanceOptimalHigh(),2)})`,"NJS may be uncomfortable to play")),n.toRealTime(e.hjd)<.45&&i.push(ht(`Very quick reaction time (${O(n.toRealTime(e.hjd)*1e3)}ms)`,"may lead to suboptimal gameplay")),e.calcHalfJumpDurationRaw()+e.offset<e.hjdMin&&i.push(ht("Unnecessary negative offset",`will not drop below ${e.hjdMin}`)),i.length){const r=document.createElement("div");i.forEach(a=>r.append(a)),Oi.output.html=r}else Oi.output.html=null}const ps="Outside Playable Object",gs="Look for any object starting before and after song timer.",_s=!0,Pi={name:ps,description:gs,type:"other",order:{input:ct.OTHERS_OUTSIDE_PLAYABLE,output:ut.OTHERS_OUTSIDE_PLAYABLE},input:{enabled:_s,params:{},html:ot.create(ps,gs,_s,function(){Pi.input.enabled=this.checked})},output:{html:null},run:Md};function Md(t){if(!t.difficulty){console.error("Something went wrong!");return}const{bpm:e,audioDuration:n}=t.settings,{colorNotes:i,bombNotes:r,obstacles:a,basicBeatmapEvents:s,sliders:o,burstSliders:c}=t.difficulty.data,l=[];if(n){let u=e.toBeatTime(n);i.length&&i[0].time<0&&l.push(ht("Note(s) before start time",`${O(i[0].time,3)} (${Dt(e.toRealTime(i[0].time))}`)),r.length&&r[0].time<0&&l.push(ht("Bomb(s) before start time",`${O(r[0].time,3)} (${Dt(e.toRealTime(r[0].time))}`)),o.length&&o[0].time<0&&l.push(ht("Arc(s) before start time",`${O(o[0].time,3)} (${Dt(e.toRealTime(o[0].time))}`)),c.length&&c[0].time<0&&l.push(ht("Chain(s) before start time",`${O(c[0].time,3)} (${Dt(e.toRealTime(c[0].time))}`)),a.length&&a[0].time<0&&l.push(ht("Obstacle(s) before start time",`${O(a[0].time,3)} (${Dt(e.toRealTime(a[0].time))}`)),s.length&&s[0].time<0&&l.push(ht("Event(s) before start time",`${O(s[0].time,3)} (${Dt(e.toRealTime(s[0].time))}`)),i.length&&i[i.length-1].time>u&&l.push(ht("Note(s) after end time",`${O(i[i.length-1].time,3)} (${Dt(e.toRealTime(i[i.length-1].time))})`)),r.length&&r[r.length-1].time>u&&l.push(ht("Bomb(s) after end time",`${O(r[r.length-1].time,3)} (${Dt(e.toRealTime(r[r.length-1].time))})`)),o.length&&o[o.length-1].time>u&&l.push(ht("Arc(s) after end time",`${O(o[o.length-1].time,3)} (${Dt(e.toRealTime(o[o.length-1].time))})`)),c.length&&c[c.length-1].time>u&&l.push(ht("Chain(s) after end time",`${O(c[c.length-1].time,3)} (${Dt(e.toRealTime(c[c.length-1].time))})`)),a.length&&a[a.length-1].time>u&&l.push(ht("Obstacle(s) after end time",`${O(a[a.length-1].time,3)} (${Dt(e.toRealTime(a[a.length-1].time))})`)),s.length&&s[s.length-1].time>u&&l.push(ht("Event(s) after end time",`${O(s[s.length-1].time,3)} (${Dt(e.toRealTime(s[s.length-1].time))})`))}if(l.length){const u=document.createElement("div");l.forEach(p=>u.append(p)),Pi.output.html=u}else Pi.output.html=null}const bs="Invalid Object",ys="Validate beatmap object to be compatible with vanilla (ignores for modded).",vs=!0,Fi={name:bs,description:ys,type:"other",order:{input:ct.OTHERS_INVALID_OBJECT,output:ut.OTHERS_INVALID_OBJECT},input:{enabled:vs,params:{},html:ot.create(bs,ys,vs,function(){Fi.input.enabled=this.checked})},output:{html:null},run:Od};function Od(t){var m,_,b,y;if(!t.difficulty){console.error("Something went wrong!");return}const{colorNotes:e,bombNotes:n,obstacles:i,basicBeatmapEvents:r,sliders:a,burstSliders:s}=t.difficulty.data;let o=[],c=[],l=[],u=[],p=[];(_=(m=t.difficulty.info._customData)==null?void 0:m._requirements)!=null&&_.includes("Mapping Extensions")||((y=(b=t.difficulty.info._customData)==null?void 0:b._requirements)!=null&&y.includes("Noodle Extensions")?(o=e.filter(v=>v.hasMappingExtensions()).map(v=>v.time),c=i.filter(v=>v.hasMappingExtensions()).map(v=>v.time),l=n.filter(v=>v.hasMappingExtensions()).map(v=>v.time),u=a.filter(v=>v.hasMappingExtensions()).map(v=>v.time),p=s.filter(v=>v.hasMappingExtensions()).map(v=>v.time)):(o=e.filter(v=>!v.isValid()).map(v=>v.time),c=i.filter(v=>!v.isValid()).map(v=>v.time),l=n.filter(v=>!v.isValid()).map(v=>v.time),u=a.filter(v=>!v.isValid()).map(v=>v.time),p=s.filter(v=>!v.isValid()).map(v=>v.time)));const g=r.filter(v=>!v.isValid()).map(v=>v.time),d=[];if(o.length&&d.push(dt("Invalid note",o,t.settings.bpm)),l.length&&d.push(dt("Invalid bomb",l,t.settings.bpm)),u.length&&d.push(dt("Invalid arc",u,t.settings.bpm)),p.length&&d.push(dt("Invalid chain",p,t.settings.bpm)),c.length&&d.push(dt("Invalid obstacle",c,t.settings.bpm)),g.length&&d.push(dt("Invalid event",g,t.settings.bpm)),d.length){const v=document.createElement("div");d.forEach(S=>v.append(S)),Fi.output.html=v}else Fi.output.html=null}var Es=Object.freeze(Object.defineProperty({__proto__:null,hotStart:on,difficultyLabel:Mi,njs:Oi,outsidePlayable:Pi,invalidObject:Fi},Symbol.toStringTag,{value:"Module"}));const pe=class{constructor(){}};let Ie=pe;Ie.getNote=()=>Object.keys(Wo).map(t=>Wo[t]);Ie.getObstacle=()=>Object.keys(es).map(t=>es[t]);Ie.getEvent=()=>Object.keys(ls).map(t=>ls[t]);Ie.getOther=()=>Object.keys(Es).map(t=>Es[t]);Ie.getGeneral=()=>Object.keys(oo).map(t=>oo[t]);Ie.getDifficulty=()=>[...pe.getNote(),...pe.getObstacle(),...pe.getEvent(),...pe.getOther()];Ie.getAll=()=>[...pe.getNote(),...pe.getObstacle(),...pe.getEvent(),...pe.getOther(),...pe.getGeneral()];const rn=t=>`[analyzer::${t}]`,ac=Ie.getAll().sort((t,e)=>t.order.input-e.order.input),rc=[...ac].sort((t,e)=>t.order.output-e.order.output),oc=()=>{rt.analysis={general:{html:null},map:[]}},Pd=()=>{var s,o;const t=rt.beatmapInfo;if(!t){nt.error(rn("runGeneral"),"Could not analyse, missing map info");return}rt.analysis||oc();const e=(s=rt.analysis)==null?void 0:s.general,n=be.create(t._beatsPerMinute),i=$e.create(n),r={bpm:n,njs:i,audioDuration:(o=rt.duration)!=null?o:null,mapDuration:0};nt.info(rn("runGeneral"),"Analysing general");const a=[];rc.filter(c=>c.type==="general").forEach(c=>{if(c.input.enabled)try{c.run({settings:r,difficulties:rt.beatmapDifficulty,info:t}),c.output.html&&a.push(c.output.html)}catch(l){nt.error(rn("runGeneral"),l)}}),e&&(e.html=a)},sc=(t,e)=>{var l,u,p,g,d;const n=rt.beatmapInfo;if(!n){nt.error(rn("runDifficulty"),"Could not analyse, missing map info");return}rt.analysis||oc();const i=(l=rt.beatmapDifficulty)==null?void 0:l.find(m=>m.characteristic===t&&m.difficulty===e);if(!i){nt.error(rn("runDifficulty"),"Could not analyse, missing map data");return}const r=(u=rt.analysis)==null?void 0:u.map.find(m=>m.difficulty===e&&m.mode===t),a=be.create(n._beatsPerMinute,i.data.customData._BPMChanges||i.data.customData._bpmChanges||i.data.customData.BPMChanges,(p=i.info._customData)==null?void 0:p._editorOffset),s=$e.create(a,i.info._noteJumpMovementSpeed,i.info._noteJumpStartBeatOffset),o={bpm:a,njs:s,audioDuration:(g=rt.duration)!=null?g:null,mapDuration:a.toRealTime(i.data.getLastInteractiveTime())};nt.info(rn("runDifficulty"),`Analysing ${t} ${e}`);const c=[];rc.filter(m=>m.type!=="general").forEach(m=>{if(m.input.enabled)try{m.run({settings:o,difficulty:i,info:n}),m.output.html&&c.push(m.output.html)}catch(_){nt.error(rn("runDifficulty"),_)}}),r?r.html=c:(d=rt.analysis)==null||d.map.push({mode:t,difficulty:e,html:c})},Fd=t=>{Ie.getDifficulty().sort((n,i)=>n.order.output-i.order.output).forEach(n=>{n.input.adjustTime&&n.input.adjustTime(t)})},Hd=()=>{var t;(t=rt.beatmapDifficulty)==null||t.forEach(e=>sc(e.characteristic,e.difficulty))};var Sn={toolListInput:ac,runGeneral:Pd,runDifficulty:sc,adjustTime:Fd,applyAll:Hd};const Ze="UI Tools: ",Ne=document.querySelectorAll(".tools__select-mode"),Me=document.querySelectorAll(".tools__select-difficulty"),jd=document.querySelectorAll(".difficulty__label"),lc=document.querySelector(".tools__note-content"),cc=document.querySelector(".tools__obstacle-content"),uc=document.querySelector(".tools__event-content"),hc=document.querySelector(".tools__other-content"),dc=document.querySelector(".tools__general-content"),Se=document.querySelector(".tools__output-diff"),Ce=document.querySelector(".tools__output-general"),ws=document.querySelector(".tools__apply-this"),Ss=document.querySelector(".tools__apply-all");if(!lc||!cc||!uc||!hc||!dc)throw new Error(Ze+"missing content element");if(!Se||!Ce)throw new Error(Ze+"missing output element");if(ws&&Ss)ws.addEventListener("click",qd),Ss.addEventListener("click",Zd);else throw new Error(Ze+"missing apply element");Ne.forEach(t=>t.addEventListener("change",Vd));Me.forEach(t=>t.addEventListener("change",Wd));const zd=()=>{var e;const t=(e=rt.analysis)==null?void 0:e.general;if(!t){Ce.textContent="ERROR: could not find analysis for general";return}if(!t.html){Ce.textContent="ERROR: could not find HTML for general";return}Ce.innerHTML="",t.html.forEach(n=>Ce.appendChild(n)),Ce.firstChild||(Ce.textContent="No issues found.")},Vn=(t,e)=>{var i;if(!t&&!e&&(t=Ne[0].value,e=Me[0].value),!t||!e)throw new Error(Ze+"something went wrong!");Se.innerHTML="";const n=(i=rt.analysis)==null?void 0:i.map.find(r=>r.difficulty===e&&r.mode===t);if(!n){Se.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!n.html){Se.textContent="ERROR: could not find HTML for "+t+" "+e;return}n.html.forEach(r=>Se.appendChild(r)),Se.firstChild||(Se.textContent="No issues found.")},Ui=t=>{jd.forEach(e=>e.textContent=t)},fc=t=>{if(!t)return;Me.forEach(n=>{for(let i=n.options.length-1;i>=0;i--)n.remove(i)});let e=!0;for(let n=t._difficultyBeatmaps.length-1;n>=0;n--){const i=t._difficultyBeatmaps[n];Me.forEach(r=>{var s,o,c,l;const a=document.createElement("option");if(a.value=i._difficulty,a.textContent=Hn[i._difficulty]+((s=i._customData)!=null&&s._difficultyLabel?" -- "+((o=i._customData)==null?void 0:o._difficultyLabel):""),e){const u=(c=rt.beatmapDifficulty)==null?void 0:c.find(p=>p.difficulty===i._difficulty&&p.characteristic===t._beatmapCharacteristicName);if(!u)throw new Error("missing _mapSetData");jn.setDiffInfoTable(u),Ui(((l=i._customData)==null?void 0:l._difficultyLabel)||Hn[i._difficulty]),Vn(t._beatmapCharacteristicName,i._difficulty)}e=!1,r.add(a)})}},mc=t=>{if(!t){Ne.forEach(n=>Qi(n)),Me.forEach(n=>Qi(n));return}let e=!0;t._difficultyBeatmapSets.forEach(n=>{Ne.forEach(i=>{const r=document.createElement("option");r.value=n._beatmapCharacteristicName,r.textContent=Oa[n._beatmapCharacteristicName],i.add(r)}),e&&fc(n),e=!1})},Xd=()=>{const t=rt.beatmapInfo;if(!t)throw new Error(Ze+"could not find map info");const e=be.create(t._beatsPerMinute);Sn.adjustTime(e)},Ud=()=>{Sn.toolListInput.forEach(t=>{if(t.input.html)switch(t.type){case"note":{lc.appendChild(t.input.html);break}case"obstacle":{cc.appendChild(t.input.html);break}case"event":{uc.appendChild(t.input.html);break}case"other":{hc.appendChild(t.input.html);break}case"general":{dc.appendChild(t.input.html);break}default:console.error(Ze+"could not recognise type "+t.type+" for "+t.name)}})},Gd=()=>{Ce&&(Ce.innerHTML="No output."),Se&&(Se.innerHTML="No output.")},Yd=()=>{Gd(),Ui("Difficulty Label"),mc()};function Vd(t){var i;const e=t.target;Ne.forEach(r=>{r!==e&&(r.value=e.value)});const n=(i=rt.beatmapInfo)==null?void 0:i._difficultyBeatmapSets.find(r=>r._beatmapCharacteristicName===e.value);fc(n)}function Wd(t){var r,a,s,o;const e=t.target;Me.forEach(c=>{c!==e&&(c.value=e.value)});const n=(r=rt.beatmapInfo)==null?void 0:r._difficultyBeatmapSets.find(c=>c._beatmapCharacteristicName===Ne.item(0).value);if(!n)throw new Error("aaaaaaaaaaaaaaaaaaa");const i=(a=rt.beatmapDifficulty)==null?void 0:a.find(c=>c.difficulty===e.value&&c.characteristic===n._beatmapCharacteristicName);i&&(jn.setDiffInfoTable(i),Ui(((o=(s=i.info)==null?void 0:s._customData)==null?void 0:o._difficultyLabel)||Hn[e.value]),Vn(i.characteristic,i.difficulty))}function qd(){const t=Ne[0].value,e=Me[0].value;if(!t||!e)throw new Error(Ze+"mode/difficulty does not exist");bt.status("info",`Re-analysing ${t} ${e}`,100),Sn.runDifficulty(t,e),bt.status("info",`Re-analysed ${t} ${e}`,100),Vn(t,e)}function Zd(){const t=Ne[0].value,e=Me[0].value;if(!t||!e)throw new Error(Ze+"mode/difficulty does not exist");bt.status("info","Re-analysing all difficulties",100),Sn.applyAll(),bt.status("info","Re-analysed all difficulties",100),Vn(t,e)}var pn={displayOutputGeneral:zd,displayOutputDifficulty:Vn,setDifficultyLabel:Ui,adjustTime:Xd,populateSelect:mc,populateTool:Ud,reset:Yd};const qi=t=>{const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let n=t.length-1;n>=0;n--)t[n].color===0?(e.red.total++,t[n].hasChroma()&&e.red.chroma++,t[n].hasNoodleExtensions()&&e.red.noodleExtensions++,t[n].hasMappingExtensions()&&e.red.mappingExtensions++):t[n].color===1&&(e.blue.total++,t[n].hasChroma()&&e.blue.chroma++,t[n].hasNoodleExtensions()&&e.blue.noodleExtensions++,t[n].hasMappingExtensions()&&e.blue.mappingExtensions++);return e},Jd=t=>{const e={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let n=t.length-1;n>=0;n--)e.total++,t[n].hasChroma()&&e.chroma++,t[n].hasNoodleExtensions()&&e.noodleExtensions++,t[n].hasMappingExtensions()&&e.mappingExtensions++;return e},ni=(t,e)=>t.filter(n=>n.data.posX===e).length,Kd=(t,e)=>t.filter(n=>n.data.posY===e).length,Qd=(t,e,n)=>t.filter(i=>i.data.posX===e&&i.data.posY===n).length,tf=(t,e)=>t.filter(n=>n.type!=="bomb"&&n.data.direction===e).length,ef=t=>{const e={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let n=t.length-1;n>-1;n--)e.total++,t[n].isInteractive()&&e.interactive++,t[n].hasChroma()&&e.chroma++,t[n].hasNoodleExtensions()&&e.noodleExtensions++,t[n].hasMappingExtensions()&&e.mappingExtensions++;return e},nf=(t,e="DefaultEnvironment")=>{var r,a;const n=(a=(r=Be[e])==null?void 0:r[0])!=null?a:Be.DefaultEnvironment[0],i={};for(let s=n.length-1;s>=0;s--)i[n[s]]={total:0,chroma:0,chromaOld:0};for(let s=t.length-1;s>=0;s--)t[s].isValidType()&&(i[t[s].type]||(i[t[s].type]={total:0,chroma:0,chromaOld:0}),i[t[s].type].total++,t[s].hasChroma()&&i[t[s].type].chroma++,t[s].hasOldChroma()&&i[t[s].type].chromaOld++);return i},af=(t,e="DefaultEnvironment")=>{var r,a;const n=(a=(r=Be[e])==null?void 0:r[1])!=null?a:Be.DefaultEnvironment[1],i={};for(let s=n.length-1;s>=0;s--)i[n[s]]={total:0,eventBox:0,base:0};for(let s=t.length-1;s>=0;s--)i[t[s].groupID]||(i[t[s].groupID]={total:0,eventBox:0,base:0}),i[t[s].groupID].total++,i[t[s].groupID].eventBox+=t[s].events.length,i[t[s].groupID].base+=t[s].events.reduce((o,c)=>o+c.events.length,0);return i},rf=(t,e="DefaultEnvironment")=>{var r,a;const n=(a=(r=Be[e])==null?void 0:r[1])!=null?a:Be.DefaultEnvironment[1],i={};for(let s=n.length-1;s>=0;s--)i[n[s]]={total:0,eventBox:0,base:0};for(let s=t.length-1;s>=0;s--)i[t[s].groupID]||(i[t[s].groupID]={total:0,eventBox:0,base:0}),i[t[s].groupID].total++,i[t[s].groupID].eventBox+=t[s].events.length,i[t[s].groupID].base+=t[s].events.reduce((o,c)=>o+c.events.length,0);return i},of=115,sf=t=>{let e=0,n=1;for(let i=0,r=t.filter(a=>a.type==="note"&&!(typeof a.data.customData.uninteractable!="undefined"||!a.data.customData.uninteractable)).length;i<r;i++)n<8&&i===-3+n*4&&(n*=2),e+=of*n;return e},lf=(t,e)=>{switch(t){case 0:switch(e){case"LinkinParkEnvironment":return"Lane Light";case"BTSEnvironment":return"Door Light";case"KaleidoscopeEnvironment":return"Spike Tip Lights";case"InterscopeEnvironment":return"Gate 1";case"SkrillexEnvironment":return"Logo";case"BillieEnvironment":return"Water 4";case"HalloweenEnvironment":return"Sky Lasers";case"GagaEnvironment":return"Aurora 1";case"PyroEnvironment":return"Video Alpha";case"EDMEnvironment":return"Lane Lights Bottom";default:return"Back Lasers"}case 1:switch(e){case"LinkinParkEnvironment":return"Ceiling Lights";case"BTSEnvironment":return"Vertical Pillar Lights";case"KaleidoscopeEnvironment":return"Spike Mid Lights";case"InterscopeEnvironment":return"Gate 2";case"SkrillexEnvironment":return"Top Lanes and 1st Ring Set";case"BillieEnvironment":return"Water 1";case"HalloweenEnvironment":return"Moon";case"GagaEnvironment":return"Aurora 2";case"PyroEnvironment":return"Logo";case"EDMEnvironment":return"Lane Lights Top";default:return"Ring Lights"}case 2:switch(e){case"BTSEnvironment":return"Door Light";case"KaleidoscopeEnvironment":return"Spike Left Lights";case"InterscopeEnvironment":return"Gate 3";case"BillieEnvironment":return"Left Sun Beams";case"GagaEnvironment":return"Tower 1";case"PyroEnvironment":return"Left Projectors";default:return"Left Lasers"}case 3:switch(e){case"KaleidoscopeEnvironment":return"Spike Right Lights";case"InterscopeEnvironment":return"Gate 4";case"BillieEnvironment":return"Right Sun Beams";case"GagaEnvironment":return"Tower 2";case"PyroEnvironment":return"Right Projectors";default:return"Right Lasers"}case 4:switch(e){case"KaleidoscopeEnvironment":return"Distant Lasers and Spike Top Lights";case"InterscopeEnvironment":return"Gate 5";case"SkrillexEnvironment":return"Bottom Lanes and 2nd Ring Set";case"BillieEnvironment":return"Sun";case"HalloweenEnvironment":return"Lane + Castle Interior";case"GagaEnvironment":return"Logo";case"PyroEnvironment":return"Platform";case"EDMEnvironment":return"Player Space & Spectrogram";default:return"Center Lights"}case 5:return"Boost Colors";case 6:switch(e){case"InterscopeEnvironment":return"Extra 1";case"SkrillexEnvironment":return"Left Panel";case"BillieEnvironment":return"Water 2";case"GagaEnvironment":return"Tower 3";case"PyroEnvironment":return"Ambient";default:return"Extra Left Lights"}case 7:switch(e){case"InterscopeEnvironment":return"Extra 2";case"SkrillexEnvironment":return"Right Panel";case"BillieEnvironment":return"Water 3";case"GagaEnvironment":return"Tower 4";default:return"Extra Right Lights"}case 8:switch(e){case"LinkinParkEnvironment":return"Laser Mode";case"BTSEnvironment":return"Distant Tower Spin";case"BillieEnvironment":return"Toggle Rain";default:return"Ring Rotation"}case 9:switch(e){case"BTSEnvironment":return"Raise/Lower Pillars";case"BillieEnvironment":return"Sunbeam Mode";default:return"Ring Zoom"}case 10:switch(e){case"BillieEnvironment":return"Left Bottom Lasers";case"GagaEnvironment":return"Tower 5";default:return"Extra Left Lasers"}case 11:switch(e){case"BillieEnvironment":return"Right Bottom Lasers";case"GagaEnvironment":return"Tower 6";default:return"Extra Right Lasers"}case 12:switch(e){case"SkrillexEnvironment":return"Left Laser & Panel Speed";case"GagaEnvironment":return"Tower 1 Height";case"BillieEnvironment":return"Left Sun Beams Speed";default:return"Left Laser Speed"}case 13:switch(e){case"SkrillexEnvironment":return"Right Laser & Panel Speed";case"GagaEnvironment":return"Tower 2 Height";case"BillieEnvironment":return"Right Sun Beams Speed";default:return"Right Laser Speed"}case 14:return"Early Lane Rotation";case 15:return"Late Lane Rotation";case 16:switch(e){case"GagaEnvironment":return"Tower 3 Height";default:return"Utility Event 1"}case 17:switch(e){case"GagaEnvironment":return"Tower 4 Height";default:return"Utility Event 2"}case 18:switch(e){case"GagaEnvironment":return"Tower 5 Height";default:return"Utility Event 3"}case 19:switch(e){case"GagaEnvironment":return"Tower 6 Height";default:return"Utility Event 4"}case 40:switch(e){case"PyroEnvironment":return"Video Projection";default:return"BTS Event 1"}case 41:switch(e){default:return"BTS Event 2"}case 42:switch(e){default:return"BTS Event 3"}case 43:switch(e){default:return"BTS Event 4"}default:return"Unknown"}},cf=(t,e)=>{switch(e){case"WeaveEnvironment":switch(t){case 0:return"Outer Square Bottom Left Laser";case 1:return"Outer Square Bottom Right Laser";case 2:return"Outer Square Top Left Laser";case 3:return"Outer Square Top Right Laser";case 4:return"Inner Square Bottom Left Laser";case 5:return"Inner Square Bottom Right Laser";case 6:return"Inner Square Top Left Laser";case 7:return"Inner Square Top Right Laser";case 8:return"Side Square Bottom Left Laser";case 9:return"Side Square Bottom Right Laser";case 10:return"Side Square Top Left Laser";case 11:return"Side Square Top Right Laser";case 12:return"Distant Square Top Laser";case 13:return"Distant Square Bottom Laser";case 14:return"Distant Square Left Laser";case 15:return"Distant Square Right Laser"}case"PyroEnvironment":switch(t){case 0:return"Left Stage Light";case 1:return"Right Stage Light";case 2:return"Top Left Laser";case 3:return"Top Right Laser";case 4:return"Top Middle Laser";case 5:return"Top Light";case 6:return"Left Light Tower";case 7:return"Right Light Tower";case 8:return"Stage Left Laser";case 9:return"Stage Right Laser";case 10:return"Stage Far Left Laser";case 11:return"Stage Far Right Laser";case 12:return"Left Flame";case 13:return"Right Flame"}case"EDMEnvironment":switch(t){case 0:return"Large Circle Light";case 1:return"Large Circle Light 2";case 2:return"Laser Circle Light";case 3:return"Laser Circle Light 2";case 4:return"Left Vertical Laser";case 5:return"Right Vertical Laser 2";case 6:return"Left Horizontal Laser";case 7:return"Left Horizontal Laser 2";case 8:return"Right Horizontal Laser";case 9:return"Right Horizontal Laser 2";case 10:return"Left Horizontal Laser 3";case 11:return"Right Horizontal Laser 3";case 12:return"Unidentifed";case 13:return"Unidentifed";case 14:return"Unidentifed";case 15:return"Unidentifed";case 16:return"Unidentifed";case 17:return"Unidentifed"}default:return"Unknown"}},sn="UI Stats: ",R="stats__",li=document.querySelector("#stats .accordion__collapsible"),pc=(t,e)=>{const n=be.create(t._beatsPerMinute),i=$e.create(n,e.info._noteJumpMovementSpeed||$e.FallbackNJS[e.difficulty],e.info._noteJumpStartBeatOffset),r=document.createElement("table");return r.className=R+"table",r.innerHTML=`<caption class="${R}table-caption">Map Settings:</caption><tr><th class="${R}table-header" colspan="2">Note Jump Speed</th><td class="${R}table-element">${O(i.value,3)}</td></tr><tr><th class="${R}table-header" colspan="2">Spawn Distance Modifier</th><td class="${R}table-element">${O(i.offset,3)}</td></tr><tr><th class="${R}table-header" colspan="2">Half Jump Duration</th><td class="${R}table-element">${O(i.hjd,3)}</td></tr><tr><th class="${R}table-header" colspan="2">Jump Distance</th><td class="${R}table-element">${O(i.jd,3)}</td></tr><tr><th class="${R}table-header" colspan="2">Reaction Time</th><td class="${R}table-element">${O(i.reactTime*1e3)}ms</td></tr>`,r},gc=(t,e)=>{const n=be.create(t._beatsPerMinute),i=rt.duration||0,r=n.toRealTime(e.data.getLastInteractiveTime()),a=document.createElement("table");return a.className=R+"table",a.innerHTML=`<caption class="${R}table-caption">Note Per Seconds (NPS):</caption><tr><th class="${R}table-header" colspan="2">Overall</th><td class="${R}table-element">${O(e.data.nps(i),2)}</td></tr><tr><th class="${R}table-header" colspan="2">Mapped</th><td class="${R}table-element">${O(e.data.nps(r),2)}</td></tr><tr><th class="${R}table-header" rowspan="3">Peak</th><th class="${R}table-header">16-beat</th><td class="${R}table-element">${O(e.data.peak(16,n.value),2)}</td></tr><tr><th class="${R}table-header">8-beat</th><td class="${R}table-element">${O(e.data.peak(8,n.value),2)}</td></tr><tr><th class="${R}table-header">4-beat</th><td class="${R}table-element">${O(e.data.peak(4,n.value),2)}</td></tr>`,a},_c=(t,e)=>{const n=e.swingAnalysis,i=document.createElement("table");return i.className=R+"table",i.innerHTML=`<caption class="${R}table-caption">Swing Per Seconds (SPS):</caption><tr><th class="${R}table-header"></th><th class="${R}table-header">Total</th><th class="${R}table-header">Red</th><th class="${R}table-header">Blue</th></tr><tr><th class="${R}table-header">Count</th><td class="${R}table-element">${O(n.total.count,2)}</td><td class="${R}table-element">${O(n.red.count,2)}</td><td class="${R}table-element">${O(n.blue.count,2)}</td></tr><tr><th class="${R}table-header">Median</th><td class="${R}table-element">${O(n.total.median,2)}</td><td class="${R}table-element">${O(n.red.median,2)}</td><td class="${R}table-element">${O(n.blue.median,2)}</td></tr><tr><th class="${R}table-header">Peak</th><td class="${R}table-element">${O(n.total.peak,2)}</td><td class="${R}table-element">${O(n.red.peak,2)}</td><td class="${R}table-element">${O(n.blue.peak,2)}</td></tr><tr><th class="${R}table-header">Total</th><td class="${R}table-element">${n.total.total}</td><td class="${R}table-element">${n.red.total}</td><td class="${R}table-element">${n.blue.total}</td></tr>`,i},bc=(t,e)=>{const n=qi(e.data.colorNotes),i=qi(e.data.sliders),r=qi(e.data.burstSliders),a=Jd(e.data.bombNotes);let s=`<caption class="${R}table-caption">Notes: ${n.red.total+n.blue.total}<br>Arc: ${i.red.total+i.blue.total}<br>Chain: ${r.red.total+r.blue.total}<br>Bombs: ${a.total}<br>R/B Ratio: ${O(n.red.total/n.blue.total,2)}</caption><tr><th class="${R}table-header"></th><th class="${R}table-header">Red</th><th class="${R}table-header">Blue</th><th class="${R}table-header">Bomb</th></tr><tr><th class="${R}table-header">Note</th><td class="${R}table-element">${n.red.total}</td><td class="${R}table-element">${n.blue.total}</td><td class="${R}table-element">0</td></tr><tr><th class="${R}table-header">Arc</th><td class="${R}table-element">${i.red.total}</td><td class="${R}table-element">${i.blue.total}</td><td class="${R}table-element">0</td></tr><tr><th class="${R}table-header">Chain</th><td class="${R}table-element">${r.red.total}</td><td class="${R}table-element">${r.blue.total}</td><td class="${R}table-element">0</td></tr><tr><th class="${R}table-header">Bomb</th><td class="${R}table-element">0</td><td class="${R}table-element">0</td><td class="${R}table-element">${a.total}</td></tr>`;(n.red.chroma||n.blue.chroma||a.chroma)&&(s+=`<tr><th class="${R}table-header">Chroma</th><td class="${R}table-element">${n.red.chroma}</td><td class="${R}table-element">${n.blue.chroma}</td><td class="${R}table-element">${a.chroma}</td></tr>`),(n.red.noodleExtensions||n.blue.noodleExtensions||a.noodleExtensions)&&(s+=`<tr><th class="${R}table-header">NE</th><td class="${R}table-element">${n.red.noodleExtensions}</td><td class="${R}table-element">${n.blue.noodleExtensions}</td><td class="${R}table-element">${a.noodleExtensions}</td></tr>`),(n.red.mappingExtensions||n.blue.mappingExtensions||a.mappingExtensions)&&(s+=`<tr><th class="${R}table-header">ME</th><td class="${R}table-element">${n.red.mappingExtensions}</td><td class="${R}table-element">${n.blue.mappingExtensions}</td><td class="${R}table-element">${a.mappingExtensions}</td></tr>`);const o=document.createElement("table");return o.className=R+"table",o.innerHTML=s,o};function uf(t){var c;const e=t.target,n=e.id.replace(`${R}table-select-placement-`,"").split("-"),i=n[0],r=n[1],a=(c=rt.beatmapDifficulty.find(l=>l.characteristic===i&&l.difficulty===r))==null?void 0:c.noteContainer;if(!a){console.error(sn+"note could not be found");return}let s;switch(e.value){case"note":{s=a.filter(l=>l.type==="note");break}case"red":{s=a.filter(l=>l.type==="note"&&l.data.color===0);break}case"blue":{s=a.filter(l=>l.type==="note"&&l.data.color===1);break}case"bomb":{s=a.filter(l=>l.type==="bomb");break}default:s=a}const o=document.querySelector(`#${R}table-placement-${i}-${r}`);if(!o){console.error(sn+"table could not be found");return}o.innerHTML=yc(s)}const yc=t=>{const e=t.length||1;let n="";for(let i=2;i>=0;i--){n+="<tr>";for(let r=0;r<=3;r++)n+=`<td class="${R}table-element">${Qd(t,r,i)}</td>`;n+=`<td class="${R}table-element ${R}table--no-border">${O(Kd(t,i)/e*100,1)}%</td>
        </tr>`}return n+=`<tr><td class="${R}table-element ${R}table--no-border">${O(ni(t,0)/e*100,1)}%</td><td class="${R}table-element ${R}table--no-border">${O(ni(t,1)/e*100,1)}%</td><td class="${R}table-element ${R}table--no-border">${O(ni(t,2)/e*100,1)}%</td><td class="${R}table-element ${R}table--no-border">${O(ni(t,3)/e*100,1)}%</td></tr>`,n},vc=(t,e)=>{var a;const n=Yn.create(`${R}table-select-placement-${e.characteristic}-${e.difficulty}`,"Note Placement: ","caption",`${R}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Bomb",value:"bomb"});(a=n.querySelector("select"))==null||a.addEventListener("change",uf);let i=`<tbody id="${R}table-placement-${e.characteristic}-${e.difficulty}">${yc(e.noteContainer)}</tbody>`;const r=document.createElement("table");return r.className=R+"table",r.innerHTML=i,r.prepend(n),r};function hf(t){var c;const e=t.target,n=e.id.replace(`${R}table-select-angle-`,"").split("-"),i=n[0],r=n[1],a=(c=rt.beatmapDifficulty.find(l=>l.characteristic===i&&l.difficulty===r))==null?void 0:c.noteContainer;if(!a){console.error(sn+"note could not be found");return}let s;switch(e.value){case"red":{s=a.filter(l=>l.type==="note"&&l.data.color===0);break}case"blue":{s=a.filter(l=>l.type==="note"&&l.data.color===1);break}default:s=a}const o=document.querySelector(`#${R}table-angle-${i}-${r}`);if(!o){console.error(sn+"table could not be found");return}o.innerHTML=Ec(s)}const Ec=t=>{const e=t.length||1,n=[4,0,5,2,8,3,6,1,7];let i="";for(let r=0;r<3;r++){i+="<tr>";for(let a=0;a<3;a++){let s=tf(t,n[r*3+a]);i+=`<td class="${R}table-element">${s}<br>(${O(s/e*100,1)}%)</td>`}i+="</tr>"}return i},wc=(t,e)=>{var a;const n=Yn.create(`${R}table-select-angle-${e.characteristic}-${e.difficulty}`,"Note Angle: ","caption",`${R}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"});(a=n.querySelector("select"))==null||a.addEventListener("change",hf);let i=`<tbody id="${R}table-angle-${e.characteristic}-${e.difficulty}">${Ec(e.noteContainer)}</tbody>`;const r=document.createElement("table");return r.className=R+"table",r.innerHTML=i,r.prepend(n),r},Sc=(t,e)=>{let n=`<caption class="${R}table-caption">Note Information:</caption><tr><th class="${R}table-header" colspan="2">Max Score</th><td class="${R}table-element">${Xc(sf(e.noteContainer))}</td></tr><tr><th class="${R}table-header" colspan="2">Effective BPM</th><td class="${R}table-element">${O(Ku(e.swingAnalysis.container),2)}</td></tr><tr><th class="${R}table-header" colspan="2">Effective BPM (swing)</th><td class="${R}table-element">${O(Qu(e.swingAnalysis.container),2)}</td></tr>`,i=O(ah(e.swingAnalysis.container)*1e3,1),r=O(rh(e.swingAnalysis.container)*1e3,1);i&&r&&(n+=`<tr><th class="${R}table-header" colspan="2">Min. Slider Speed</th><td class="${R}table-element">${i}ms</td></tr><tr><th class="${R}table-header" colspan="2">Max. Slider Speed</th><td class="${R}table-element">${r}ms</td></tr>`);const a=document.createElement("table");return a.className=R+"table",a.innerHTML=n,a},Cc=(t,e)=>{const n=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,i=nf(e.data.basicBeatmapEvents,n);let r=0,a=0,s=`<caption class="${R}table-caption">Events: ${Object.values(i).reduce((c,{total:l})=>c+l,0)}</caption>`;for(const c in i)r+=i[c].chroma,a+=i[c].chromaOld,s+=`<tr><th class="${R}table-header">${c}</th><th class="${R}table-header" colspan="4">${lf(parseInt(c),n)}</th><td class="${R}table-element">${i[c].total}</td></tr>`;r&&(s+=`<tr><th class="${R}table-header" colspan="5">Chroma</th><td class="${R}table-element">${r}</td></tr>`),a&&(s+=`<tr><th class="${R}table-header" colspan="5">OG Chroma</th><td class="${R}table-element">${a}</td></tr>`);const o=document.createElement("table");return o.className=R+"table",o.innerHTML=s,o},df=(t,e)=>{const n=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,i=af(e.data.lightColorEventBoxGroups,n),r=rf(e.data.lightRotationEventBoxGroups,n);let a=`<caption class="${R}table-caption">Color Event Box Groups: ${Object.values(i).reduce((o,{total:c})=>o+c,0)}<br>Rotation Event Box Groups: ${Object.values(r).reduce((o,{total:c})=>o+c,0)}</caption>`;for(const o in i)a+=`<tr><th class="${R}table-header">${o}</th><th class="${R}table-header" colspan="4">${cf(parseInt(o),n)}</th><td class="${R}table-element">${i[o].total}</td><td class="${R}table-element">${r[o].total}</td></tr>`;const s=document.createElement("table");return s.className=R+"table",s.innerHTML=a,s},kc=(t,e)=>{const n=ef(e.data.obstacles);let i=`<caption class="${R}table-caption">Obstacles: ${n.total}</caption>`;n.interactive&&(i+=`<tr><th class="${R}table-header" colspan="2">Interactive</th><td class="${R}table-element">${n.interactive}</td></tr>`),n.chroma&&(i+=`<tr><th class="${R}table-header" colspan="2">Chroma</th><td class="${R}table-element">${n.chroma}</td></tr>`),n.noodleExtensions&&(i+=`<tr><th class="${R}table-header" colspan="2">Noodle Extensions</th><td class="${R}table-element">${n.noodleExtensions}</td></tr>`),n.mappingExtensions&&(i+=`<tr><th class="${R}table-header" colspan="2">Mapping Extensions</th><td class="${R}table-element">${n.mappingExtensions}</td></tr>`);const r=document.createElement("table");return r.className=R+"table",r.innerHTML=i,r},ff=()=>{if(!rt.beatmapInfo)throw new Error(sn+"map info could not be found in savedData");const t=rt.beatmapInfo;t._difficultyBeatmapSets.forEach(e=>{var r,a;const n=document.createElement("div");n.className=R+"mode-"+e._beatmapCharacteristicName;const i=document.createElement("div");i.className=R+"title",i.textContent=Oa[e._beatmapCharacteristicName],n.appendChild(i);for(let s=e._difficultyBeatmaps.length-1;s>=0;s--){const o=e._difficultyBeatmaps[s],c=rt.beatmapDifficulty.find(_=>_.characteristic===e._beatmapCharacteristicName&&_.difficulty===o._difficulty);if(!c)throw new Error(sn+"Could not find map data");const l=Is.create(`${R}${e._beatmapCharacteristicName}-${o._difficulty}`,Hn[o._difficulty]+((r=o._customData)!=null&&r._difficultyLabel?" -- "+((a=o._customData)==null?void 0:a._difficultyLabel):""),o._difficulty,!0),u=l.querySelector(".accordion__collapsible-flex"),p=l.querySelector(".accordion__button");if(!u||!p)throw new Error(sn+"something went wrong!");p.checked=it.onLoad.stats;const g=ri.create("small","half"),d=ri.create("small","half"),m=ri.create("small","half");g.append(pc(t,c)),g.append(document.createElement("br")),g.append(gc(t,c)),g.append(document.createElement("br")),g.append(_c(t,c)),d.append(Sc(t,c)),d.append(document.createElement("br")),d.append(vc(t,c)),d.append(document.createElement("br")),d.append(wc(t,c)),m.append(bc(t,c)),m.append(document.createElement("br")),m.append(Cc(t,c)),m.append(document.createElement("br")),m.append(df(t,c)),m.append(document.createElement("br")),m.append(kc(t,c)),u.appendChild(g),u.appendChild(d),u.appendChild(m),n.appendChild(l)}li.appendChild(n)})},mf=()=>{for(;li.firstChild;)li.removeChild(li.firstChild)};var Dc={createSettingsTable:pc,createNPSTable:gc,createSPSTable:_c,createNoteCountTable:bc,createNotePlacementTable:vc,createNoteAngleTable:wc,createInfoTable:Sc,createEventCountTable:Cc,createObstacleCountTable:kc,populate:ff,reset:mf};const ie=t=>`[convert::${t}]`,pf=(t,e)=>{var i,r,a,s,o,c;if(e)nt.warn(ie("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!");else{if(nt.warn(ie("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!"),prompt("Proceed with conversion? (y/N):","n")[0].toLowerCase()!=="y")throw Error("Conversion to beatmap v3 denied.");nt.info(ie("V2toV3"),"Converting beatmap v2 to v3")}const n=zi.create();if(t.notes.forEach((l,u)=>{let p;if(l.customData&&(p={color:l.customData._color,coordinates:l.customData._position,disableNoteGravity:l.customData._disableNoteGravity,disableNoteLook:l.customData._disableNoteLook,flip:l.customData._flip,localRotation:l.customData._localRotation,noteJumpMovementSpeed:l.customData._noteJumpMovementSpeed,noteJumpStartBeatOffset:l.customData._noteJumpStartBeatOffset,spawnEffect:typeof l.customData._disableSpawnEffect=="boolean"?!l.customData._disableSpawnEffect:void 0,track:l.customData._track,uninteractable:typeof l.customData._interactable=="boolean"?!l.customData._interactable:void 0,worldRotation:l.customData._rotation},l.customData._animation&&(p.animation={color:l.customData._animation._color,definitePosition:l.customData._animation._definitePosition,dissolve:l.customData._animation._dissolve,dissolveArrow:l.customData._animation._dissolveArrow,interactable:l.customData._animation._interactable,localRotation:l.customData._animation._localRotation,offsetPosition:l.customData._animation._position,offsetRotation:l.customData._animation._rotation,scale:l.customData._animation._scale,time:l.customData._animation._time}),typeof l.customData._fake=="boolean"&&nt.warn(ie("V2toV3"),`notes[${u}] at time ${l.time} NE _fake will be removed.`),typeof l.customData._cutDirection=="number"&&nt.debug(ie("V2toV3"),`notes[${u}] at time ${l.time} NE _cutDirection will be converted.`)),l.isBomb()&&n.bombNotes.push(di.create({b:l.time,x:l.lineIndex,y:l.lineLayer,customData:p})),l.isNote()){let g=0;typeof l.customData._cutDirection=="number"&&(g=l.customData._cutDirection>0?l.customData._cutDirection%360:360+l.customData._cutDirection%360),l.cutDirection>=1e3&&(g=Math.abs(l.cutDirection%1e3%360-360)),n.colorNotes.push(_n.create({b:l.time,c:l.type,x:l.lineIndex,y:l.lineLayer,d:l.cutDirection>=1e3||typeof l.customData._cutDirection=="number"?l.cutDirection===8?8:1:Uc(l.cutDirection,0,8),a:g,customData:p}))}}),t.obstacles.forEach((l,u)=>{let p;l.customData&&(p={color:l.customData._color,coordinates:l.customData._position,localRotation:l.customData._localRotation,noteJumpMovementSpeed:l.customData._noteJumpMovementSpeed,noteJumpStartBeatOffset:l.customData._noteJumpStartBeatOffset,size:l.customData._scale,track:l.customData._track,uninteractable:typeof l.customData._interactable=="boolean"?!l.customData._interactable:void 0,worldRotation:l.customData._rotation},l.customData._animation&&(p.animation={color:l.customData._animation._color,definitePosition:l.customData._animation._definitePosition,dissolve:l.customData._animation._dissolve,dissolveArrow:l.customData._animation._dissolveArrow,interactable:l.customData._animation._interactable,localRotation:l.customData._animation._localRotation,offsetPosition:l.customData._animation._position,offsetRotation:l.customData._animation._rotation,scale:l.customData._animation._scale,time:l.customData._animation._time}),typeof l.customData._fake=="boolean"&&nt.warn(ie("V2toV3"),`obstacles[${u}] at time ${l.time} NE _fake will be removed.`)),n.obstacles.push(_e.create({b:l.time,x:l.lineIndex,y:l.type===2?l.lineLayer:l.type?2:0,d:l.duration,w:l.width,h:l.type===2?l.height:l.type?3:5,customData:p}))}),t.events.forEach((l,u)=>{var p,g;if(l.isColorBoost())n.colorBoostBeatmapEvents.push(mi.create({b:l.time,o:!!l.value}));else if(l.isLaneRotationEvent())n.rotationEvents.push(pi.create({b:l.time,e:l.type===14?0:1,r:typeof l.customData._rotation=="number"?l.customData._rotation:l.value>=1e3?(l.value-1360)%360:(p=au[l.value])!=null?p:0}));else if(l.isBPMChangeEvent())n.bpmEvents.push(fi.create({b:l.time,m:l.floatValue}));else{let d;if(l.customData&&(l.isLightEvent()&&(d={color:l.customData._color,lightID:l.customData._lightID,easing:l.customData._easing,lerpType:l.customData._lerpType},l.customData._propID&&nt.warn(ie("V2toV3"),`events[${u}] at time ${l.time} Chroma _propID will be removed.`),l.customData._lightGradient&&nt.warn(ie("V2toV3"),`events[${u}] at time ${l.time} Chroma _lightGradient will be removed.`)),l.isRingEvent()&&(d={nameFilter:l.customData._nameFilter,rotation:l.customData._rotation,step:l.customData._step,prop:l.customData._prop,speed:l.customData._speed,direction:l.customData._direction},l.customData._reset&&nt.warn(ie("V2toV3"),`events[${u}] at time ${l.time} Chroma _reset will be removed.`),l.customData._counterSpin&&nt.warn(ie("V2toV3"),`events[${u}] at time ${l.time} Chroma _counterSpin will be removed.`),(l.customData._stepMult||l.customData._propMult||l.customData._speedMult)&&nt.warn(ie("V2toV3"),`events[${u}] at time ${l.time} Chroma _mult will be removed.`)),l.isLaserRotationEvent())){const m=(g=l.customData._preciseSpeed)!=null?g:l.customData._speed;d={lockRotation:l.customData._lockPosition,direction:l.customData._direction,speed:m}}n.basicBeatmapEvents.push(hi.create({b:l.time,et:l.type,i:l.value,f:l.floatValue,customData:d}))}}),t.waypoints.forEach(l=>{n.waypoints.push(_i.create({b:l.time,x:l.lineIndex,y:l.lineLayer,d:l.direction}))}),t.sliders.forEach(l=>n.sliders.push(gi.create({c:l.colorType,b:l.headTime,x:l.headLineIndex,y:l.headLineLayer,d:l.headCutDirection,mu:l.headLengthMultiplier,tb:l.tailTime,tx:l.tailLineIndex,ty:l.tailLineLayer,tc:l.tailCutDirection,tmu:l.tailLengthMultiplier,m:l.midAnchor}))),n.basicEventTypesWithKeywords=Fa.create({d:(a=(r=(i=t.specialEventsKeywordFilters)==null?void 0:i.keywords)==null?void 0:r.map(l=>({k:l.keyword,e:l.events})))!=null?a:[]}),t.customData)for(const l in t.customData){if(l==="_customEvents"){n.customData.customEvents=(s=t.customData._customEvents.map(u=>u._type==="AnimateTrack"?{beat:u._time,time:"AnimateTrack",data:{track:u._data._track,duration:u._data._duration,easing:u._data._easing,position:u._data._position,rotation:u._data._rotation,localRotation:u._data._localRotation,scale:u._data._scale,dissolve:u._data._dissolve,dissolveArrow:u._data._dissolveArrow,color:u._data._color,interactable:u._data._interactable,time:u._data._time}}:u._type==="AssignPathAnimation"?{beat:u._time,time:"AssignPathAnimation",data:{track:u._data._track,duration:u._data._duration,easing:u._data._easing,position:u._data._position,rotation:u._data._rotation,localRotation:u._data._localRotation,scale:u._data._scale,dissolve:u._data._dissolve,dissolveArrow:u._data._dissolveArrow,color:u._data._color,interactable:u._data._interactable,definitePosition:u._data._definitePosition}}:u._type==="AssignTrackParent"?{beat:u._time,time:"AssignTrackParent",data:{childrenTracks:u._data._childrenTracks,parentTrack:u._data._parentTrack,worldPositionStays:u._data._worldPositionStays}}:u._type==="AssignPlayerToTrack"?{beat:u._time,time:"AssignPlayerToTrack",data:{track:u._data._track}}:{beat:u._time,time:"AssignFogTrack",data:{track:u._data._track,attenuation:u._data._attenuation,offset:u._data._offset,startY:u._data._startY,height:u._data._height}}))!=null?s:[];continue}if(l==="_environment"){n.customData.environment=(o=t.customData._environment.map(u=>{var p,g;return{id:u._id,lookupMethod:u._lookupMethod,track:u._track,duplicate:u._duplicate,active:u._active,scale:u._scale,position:(p=u._position)==null?void 0:p.map(d=>d*.6),rotation:u._rotation,localPosition:(g=u._localPosition)==null?void 0:g.map(d=>d*.6),localRotation:u._localRotation,lightID:u._lightID}}))!=null?o:[];continue}if(l==="_pointDefinitions"){n.customData.pointDefinitions=(c=t.customData._pointDefinitions.map(u=>({name:u._name,points:u._points})))!=null?c:[];continue}n.customData[l]=t.customData[l]}return n},$n=t=>`[load::${t}]`,gf=async t=>{const e=t.file("Info.dat")||t.file("info.dat");if(!e)throw new Error("Couldn't find Info.dat");return nt.info($n("loadInfo"),"loading info"),lu(JSON.parse(await e.async("string")))},_f=async(t,e)=>{var r,a,s,o,c;const n=[],i=t._difficultyBeatmapSets;for(let l=i.length-1;l>=0;l--){const u=i[l]._difficultyBeatmaps;if(u.length===0||!u){nt.error($n("loadDifficulty"),"Empty difficulty set, removing..."),i.splice(l,1);continue}for(let p=0;p<u.length;p++){const g=u[p],d=e.file(g._beatmapFilename);if(d){nt.info($n("loadDifficulty"),`Loading ${i[l]._beatmapCharacteristicName} ${g._difficulty}`);let m;try{m=JSON.parse(await d.async("string"))}catch(_){throw new Error(`${i[l]._beatmapCharacteristicName} ${g._difficulty} ${_}`)}try{if(m._notes&&m.version&&nt.error($n("loadDifficulty"),`${i[l]._beatmapCharacteristicName} ${g._difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`),m.version){const _=Ou(m),b=be.create(t._beatsPerMinute,_.customData.BPMChanges,(r=g._customData)==null?void 0:r._editorOffset);n.push({info:g,characteristic:i[l]._beatmapCharacteristicName,difficulty:g._difficulty,bpm:b,data:_,noteContainer:_.getNoteContainer(),eventContainer:_.getEventContainer(),swingAnalysis:eo(_,b,i[l]._beatmapCharacteristicName,g._difficulty),rawVersion:3,rawData:m})}else{const _=pf(_u(m),!0),b=be.create(t._beatsPerMinute,(o=(a=m._customData)==null?void 0:a._BPMChanges)!=null?o:(s=m._customData)==null?void 0:s._bpmChanges,(c=g._customData)==null?void 0:c._editorOffset);n.push({info:g,characteristic:i[l]._beatmapCharacteristicName,difficulty:g._difficulty,bpm:b,data:_,noteContainer:_.getNoteContainer(),eventContainer:_.getEventContainer(),swingAnalysis:eo(_,b,i[l]._beatmapCharacteristicName,g._difficulty),rawVersion:2,rawData:m})}}catch(_){throw new Error(`${i[l]._beatmapCharacteristicName} ${g._difficulty} ${_}`)}}else if(nt.error($n("loadDifficulty"),`Missing ${g._beatmapFilename} file for ${i[l]._beatmapCharacteristicName} ${g._difficulty}, ignoring.`),i[l]._difficultyBeatmaps.splice(p,1),p--,i[l]._difficultyBeatmaps.length<1){nt.error(`${i[l]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),i.splice(l,1);continue}}}return n},Tc=async t=>new Promise(function(e,n){const i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="json",i.timeout=5e3;let r=Date.now();i.onprogress=()=>{i.timeout+=Date.now()-r},i.onload=()=>{i.status===200&&e(i.response),i.status===404&&n("Error 404: Map does not exist"),i.status===403&&n("Error 403: Forbidden"),n(`Error ${i.status}`)},i.onerror=()=>{n("Error downloading")},i.ontimeout=()=>{n("Connection timeout")},i.send()}),bf=async t=>{const e=`https://api.beatsaver.com/maps/id/${t}`,n=await Tc(e);if(n!=null&&n.versions.length)return n.versions[n.versions.length-1].downloadURL;throw new Error("could not find map download link")},yf=async t=>{const e=`https://api.beatsaver.com/maps/hash/${t}`,n=await Tc(e);if(n!=null&&n.versions.length)return n.versions[n.versions.length-1].downloadURL;throw new Error("could not find map download link")},Sr=async t=>new Promise(function(e,n){const i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.timeout=5e3;let r=Date.now();i.onprogress=a=>{i.timeout+=Date.now()-r,bt.status("download",`Downloading map: ${O(a.loaded/1024/1024,1)}MB / ${O(a.total/1024/1024,1)}MB`,a.loaded/a.total*100)},i.onload=()=>{i.status===200&&e(i.response),i.status===404&&n("Error 404: Map/link does not exist"),i.status===403&&n("Error 403: Forbidden"),n(`Error ${i.status}`)},i.onerror=()=>{n("Error downloading")},i.ontimeout=()=>{n("Connection timeout")},i.send()}),Lc=async t=>{const e=Ns(t);console.log(`fetching download URL from BeatSaver for map ID ${e}`),bt.status("info","Fetching download URL from BeatSaver",0);const n=await bf(e);console.log(`downloading from BeatSaver for map ID ${e}`),bt.status("info","Requesting download from BeatSaver",0);const i=await Sr(n);return Ot.setCoverLink("https://beatsaver.com/maps/"+e,e),i},vf=async t=>{const e=$s(t);if(e.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return Lc(e.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);bt.status("info","Requesting download from link",0),console.log(`downloading from ${e}`);let n=await Sr(e);return Ot.setCoverLink(e),n},Ef=async t=>{let e;if(As(t.trim()))e=t.trim();else throw new Error("invalid hash");console.log(`fetching download URL from BeatSaver for map hash ${e}`),bt.status("info","Fetching download URL from BeatSaver",0);const n=await yf(e);return console.log(`downloading from BeatSaver for map hash ${e}`),bt.status("info","Requesting download from BeatSaver",0),await Sr(n)};var ii=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function ai(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xc={exports:{}};/*!

JSZip v3.10.0 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(i,r,a){function s(l,u){if(!r[l]){if(!i[l]){var p=typeof ai=="function"&&ai;if(!u&&p)return p(l,!0);if(o)return o(l,!0);var g=new Error("Cannot find module '"+l+"'");throw g.code="MODULE_NOT_FOUND",g}var d=r[l]={exports:{}};i[l][0].call(d.exports,function(m){var _=i[l][1][m];return s(_||m)},d,d.exports,n,i,r,a)}return r[l].exports}for(var o=typeof ai=="function"&&ai,c=0;c<a.length;c++)s(a[c]);return s}({1:[function(n,i,r){var a=n("./utils"),s=n("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(c){for(var l,u,p,g,d,m,_,b=[],y=0,v=c.length,S=v,D=a.getTypeOf(c)!=="string";y<c.length;)S=v-y,p=D?(l=c[y++],u=y<v?c[y++]:0,y<v?c[y++]:0):(l=c.charCodeAt(y++),u=y<v?c.charCodeAt(y++):0,y<v?c.charCodeAt(y++):0),g=l>>2,d=(3&l)<<4|u>>4,m=1<S?(15&u)<<2|p>>6:64,_=2<S?63&p:64,b.push(o.charAt(g)+o.charAt(d)+o.charAt(m)+o.charAt(_));return b.join("")},r.decode=function(c){var l,u,p,g,d,m,_=0,b=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,S=3*(c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(c.charAt(c.length-1)===o.charAt(64)&&S--,c.charAt(c.length-2)===o.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|S):new Array(0|S);_<c.length;)l=o.indexOf(c.charAt(_++))<<2|(g=o.indexOf(c.charAt(_++)))>>4,u=(15&g)<<4|(d=o.indexOf(c.charAt(_++)))>>2,p=(3&d)<<6|(m=o.indexOf(c.charAt(_++))),v[b++]=l,d!==64&&(v[b++]=u),m!==64&&(v[b++]=p);return v}},{"./support":30,"./utils":32}],2:[function(n,i,r){var a=n("./external"),s=n("./stream/DataWorker"),o=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function l(u,p,g,d,m){this.compressedSize=u,this.uncompressedSize=p,this.crc32=g,this.compression=d,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new s(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new s(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,p,g){return u.pipe(new o).pipe(new c("uncompressedSize")).pipe(p.compressWorker(g)).pipe(new c("compressedSize")).withStreamInfo("compression",p)},i.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,i,r){var a=n("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(s){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},r.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,i,r){var a=n("./utils"),s=function(){for(var o,c=[],l=0;l<256;l++){o=l;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;c[l]=o}return c}();i.exports=function(o,c){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?function(l,u,p,g){var d=s,m=g+p;l^=-1;for(var _=g;_<m;_++)l=l>>>8^d[255&(l^u[_])];return-1^l}(0|c,o,o.length,0):function(l,u,p,g){var d=s,m=g+p;l^=-1;for(var _=g;_<m;_++)l=l>>>8^d[255&(l^u.charCodeAt(_))];return-1^l}(0|c,o,o.length,0):0}},{"./utils":32}],5:[function(n,i,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(n,i,r){var a=null;a=typeof Promise!="undefined"?Promise:n("lie"),i.exports={Promise:a}},{lie:37}],7:[function(n,i,r){var a=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",s=n("pako"),o=n("./utils"),c=n("./stream/GenericWorker"),l=a?"uint8array":"array";function u(p,g){c.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=g,this.meta={}}r.magic="\b\0",o.inherits(u,c),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(l,p.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(g){p.push({data:g,meta:p.meta})}},r.compressWorker=function(p){return new u("Deflate",p)},r.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,i,r){function a(d,m){var _,b="";for(_=0;_<m;_++)b+=String.fromCharCode(255&d),d>>>=8;return b}function s(d,m,_,b,y,v){var S,D,k=d.file,F=d.compression,M=v!==l.utf8encode,X=o.transformTo("string",v(k.name)),$=o.transformTo("string",l.utf8encode(k.name)),G=k.comment,K=o.transformTo("string",v(G)),C=o.transformTo("string",l.utf8encode(G)),N=$.length!==k.name.length,h=C.length!==G.length,L="",J="",j="",at=k.dir,U=k.date,Q={crc32:0,compressedSize:0,uncompressedSize:0};m&&!_||(Q.crc32=d.crc32,Q.compressedSize=d.compressedSize,Q.uncompressedSize=d.uncompressedSize);var A=0;m&&(A|=8),M||!N&&!h||(A|=2048);var I=0,et=0;at&&(I|=16),y==="UNIX"?(et=798,I|=function(W,vt){var At=W;return W||(At=vt?16893:33204),(65535&At)<<16}(k.unixPermissions,at)):(et=20,I|=function(W){return 63&(W||0)}(k.dosPermissions)),S=U.getUTCHours(),S<<=6,S|=U.getUTCMinutes(),S<<=5,S|=U.getUTCSeconds()/2,D=U.getUTCFullYear()-1980,D<<=4,D|=U.getUTCMonth()+1,D<<=5,D|=U.getUTCDate(),N&&(J=a(1,1)+a(u(X),4)+$,L+="up"+a(J.length,2)+J),h&&(j=a(1,1)+a(u(K),4)+C,L+="uc"+a(j.length,2)+j);var q="";return q+=`
\0`,q+=a(A,2),q+=F.magic,q+=a(S,2),q+=a(D,2),q+=a(Q.crc32,4),q+=a(Q.compressedSize,4),q+=a(Q.uncompressedSize,4),q+=a(X.length,2),q+=a(L.length,2),{fileRecord:p.LOCAL_FILE_HEADER+q+X+L,dirRecord:p.CENTRAL_FILE_HEADER+a(et,2)+q+a(K.length,2)+"\0\0\0\0"+a(I,4)+a(b,4)+X+L+K}}var o=n("../utils"),c=n("../stream/GenericWorker"),l=n("../utf8"),u=n("../crc32"),p=n("../signature");function g(d,m,_,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=_,this.encodeFileName=b,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(g,c),g.prototype.push=function(d){var m=d.meta.percent||0,_=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:_?(m+100*(_-b-1))/_:100}}))},g.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var m=this.streamFiles&&!d.file.dir;if(m){var _=s(d,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(d){this.accumulate=!1;var m=this.streamFiles&&!d.file.dir,_=s(d,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),m)this.push({data:function(b){return p.DATA_DESCRIPTOR+a(b.crc32,4)+a(b.compressedSize,4)+a(b.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var d=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var _=this.bytesWritten-d,b=function(y,v,S,D,k){var F=o.transformTo("string",k(D));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(y,2)+a(y,2)+a(v,4)+a(S,4)+a(F.length,2)+F}(this.dirRecords.length,_,d,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(d){this._sources.push(d);var m=this;return d.on("data",function(_){m.processChunk(_)}),d.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),d.on("error",function(_){m.error(_)}),this},g.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(d){var m=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var _=0;_<m.length;_++)try{m[_].error(d)}catch{}return!0},g.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,m=0;m<d.length;m++)d[m].lock()},i.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,i,r){var a=n("../compressions"),s=n("./ZipFileWorker");r.generateWorker=function(o,c,l){var u=new s(c.streamFiles,l,c.platform,c.encodeFileName),p=0;try{o.forEach(function(g,d){p++;var m=function(v,S){var D=v||S,k=a[D];if(!k)throw new Error(D+" is not a valid compression method !");return k}(d.options.compression,c.compression),_=d.options.compressionOptions||c.compressionOptions||{},b=d.dir,y=d.date;d._compressWorker(m,_).withStreamInfo("file",{name:g,dir:b,date:y,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(g){u.error(g)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,i,r){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new a;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(a.prototype=n("./object")).loadAsync=n("./load"),a.support=n("./support"),a.defaults=n("./defaults"),a.version="3.10.0",a.loadAsync=function(s,o){return new a().loadAsync(s,o)},a.external=n("./external"),i.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,i,r){var a=n("./utils"),s=n("./external"),o=n("./utf8"),c=n("./zipEntries"),l=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function p(g){return new s.Promise(function(d,m){var _=g.decompressed.getContentWorker().pipe(new l);_.on("error",function(b){m(b)}).on("end",function(){_.streamInfo.crc32!==g.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}i.exports=function(g,d){var m=this;return d=a.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(g)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",g,!0,d.optimizedBinaryString,d.base64).then(function(_){var b=new c(d);return b.load(_),b}).then(function(_){var b=[s.Promise.resolve(_)],y=_.files;if(d.checkCRC32)for(var v=0;v<y.length;v++)b.push(p(y[v]));return s.Promise.all(b)}).then(function(_){for(var b=_.shift(),y=b.files,v=0;v<y.length;v++){var S=y[v],D=S.fileNameStr,k=a.resolve(S.fileNameStr);m.file(k,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:d.createFolders}),S.dir||(m.file(k).unsafeOriginalName=D)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,i,r){var a=n("../utils"),s=n("../stream/GenericWorker");function o(c,l){s.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}a.inherits(o,s),o.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,i,r){var a=n("readable-stream").Readable;function s(o,c,l){a.call(this,c),this._helper=o;var u=this;o.on("data",function(p,g){u.push(p)||u._helper.pause(),l&&l(g)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}n("../utils").inherits(s,a),s.prototype._read=function(){this._helper.resume()},i.exports=s},{"../utils":32,"readable-stream":16}],14:[function(n,i,r){i.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(a,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,s);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,s)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var s=new Buffer(a);return s.fill(0),s},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(n,i,r){function a(k,F,M){var X,$=o.getTypeOf(F),G=o.extend(M||{},u);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(k=y(k)),G.createFolders&&(X=b(k))&&v.call(this,X,!0);var K=$==="string"&&G.binary===!1&&G.base64===!1;M&&M.binary!==void 0||(G.binary=!K),(F instanceof p&&F.uncompressedSize===0||G.dir||!F||F.length===0)&&(G.base64=!1,G.binary=!0,F="",G.compression="STORE",$="string");var C=null;C=F instanceof p||F instanceof c?F:m.isNode&&m.isStream(F)?new _(k,F):o.prepareContent(k,F,G.binary,G.optimizedBinaryString,G.base64);var N=new g(k,C,G);this.files[k]=N}var s=n("./utf8"),o=n("./utils"),c=n("./stream/GenericWorker"),l=n("./stream/StreamHelper"),u=n("./defaults"),p=n("./compressedObject"),g=n("./zipObject"),d=n("./generate"),m=n("./nodejsUtils"),_=n("./nodejs/NodejsStreamInputAdapter"),b=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var F=k.lastIndexOf("/");return 0<F?k.substring(0,F):""},y=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},v=function(k,F){return F=F!==void 0?F:u.createFolders,k=y(k),this.files[k]||a.call(this,k,null,{dir:!0,createFolders:F}),this.files[k]};function S(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var F,M,X;for(F in this.files)X=this.files[F],(M=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&k(M,X)},filter:function(k){var F=[];return this.forEach(function(M,X){k(M,X)&&F.push(X)}),F},file:function(k,F,M){if(arguments.length!==1)return k=this.root+k,a.call(this,k,F,M),this;if(S(k)){var X=k;return this.filter(function(G,K){return!K.dir&&X.test(G)})}var $=this.files[this.root+k];return $&&!$.dir?$:null},folder:function(k){if(!k)return this;if(S(k))return this.filter(function($,G){return G.dir&&k.test($)});var F=this.root+k,M=v.call(this,F),X=this.clone();return X.root=M.name,X},remove:function(k){k=this.root+k;var F=this.files[k];if(F||(k.slice(-1)!=="/"&&(k+="/"),F=this.files[k]),F&&!F.dir)delete this.files[k];else for(var M=this.filter(function($,G){return G.name.slice(0,k.length)===k}),X=0;X<M.length;X++)delete this.files[M[X].name];return this},generate:function(k){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var F,M={};try{if((M=o.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=M.type.toLowerCase(),M.compression=M.compression.toUpperCase(),M.type==="binarystring"&&(M.type="string"),!M.type)throw new Error("No output type specified.");o.checkSupport(M.type),M.platform!=="darwin"&&M.platform!=="freebsd"&&M.platform!=="linux"&&M.platform!=="sunos"||(M.platform="UNIX"),M.platform==="win32"&&(M.platform="DOS");var X=M.comment||this.comment||"";F=d.generateWorker(this,M,X)}catch($){(F=new c("error")).error($)}return new l(F,M.type||"string",M.mimeType)},generateAsync:function(k,F){return this.generateInternalStream(k).accumulate(F)},generateNodeStream:function(k,F){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(F)}};i.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,i,r){i.exports=n("stream")},{stream:void 0}],17:[function(n,i,r){var a=n("./DataReader");function s(o){a.call(this,o);for(var c=0;c<this.data.length;c++)o[c]=255&o[c]}n("../utils").inherits(s,a),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var c=o.charCodeAt(0),l=o.charCodeAt(1),u=o.charCodeAt(2),p=o.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===c&&this.data[g+1]===l&&this.data[g+2]===u&&this.data[g+3]===p)return g-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var c=o.charCodeAt(0),l=o.charCodeAt(1),u=o.charCodeAt(2),p=o.charCodeAt(3),g=this.readData(4);return c===g[0]&&l===g[1]&&u===g[2]&&p===g[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},i.exports=s},{"../utils":32,"./DataReader":18}],18:[function(n,i,r){var a=n("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(o){},readInt:function(o){var c,l=0;for(this.checkOffset(o),c=this.index+o-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=o,l},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(o){},lastIndexOfSignature:function(o){},readAndCheckSignature:function(o){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},i.exports=s},{"../utils":32}],19:[function(n,i,r){var a=n("./Uint8ArrayReader");function s(o){a.call(this,o)}n("../utils").inherits(s,a),s.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},i.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,i,r){var a=n("./DataReader");function s(o){a.call(this,o)}n("../utils").inherits(s,a),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},i.exports=s},{"../utils":32,"./DataReader":18}],21:[function(n,i,r){var a=n("./ArrayReader");function s(o){a.call(this,o)}n("../utils").inherits(s,a),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},i.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(n,i,r){var a=n("../utils"),s=n("../support"),o=n("./ArrayReader"),c=n("./StringReader"),l=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");i.exports=function(p){var g=a.getTypeOf(p);return a.checkSupport(g),g!=="string"||s.uint8array?g==="nodebuffer"?new l(p):s.uint8array?new u(a.transformTo("uint8array",p)):new o(a.transformTo("array",p)):new c(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,i,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,i,r){var a=n("./GenericWorker"),s=n("../utils");function o(c){a.call(this,"ConvertWorker to "+c),this.destType=c}s.inherits(o,a),o.prototype.processChunk=function(c){this.push({data:s.transformTo(this.destType,c.data),meta:c.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(n,i,r){var a=n("./GenericWorker"),s=n("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(o,a),o.prototype.processChunk=function(c){this.streamInfo.crc32=s(c.data,this.streamInfo.crc32||0),this.push(c)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,i,r){var a=n("../utils"),s=n("./GenericWorker");function o(c){s.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}a.inherits(o,s),o.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}s.prototype.processChunk.call(this,c)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(n,i,r){var a=n("../utils"),s=n("./GenericWorker");function o(c){s.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=a.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}a.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(n,i,r){function a(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var c=0;c<this._listeners[s].length;c++)this._listeners[s][c].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(c){o.processChunk(c)}),s.on("end",function(){o.end()}),s.on("error",function(c){o.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},i.exports=a},{}],29:[function(n,i,r){var a=n("../utils"),s=n("./ConvertWorker"),o=n("./GenericWorker"),c=n("../base64"),l=n("../support"),u=n("../external"),p=null;if(l.nodestream)try{p=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(m,_){return new u.Promise(function(b,y){var v=[],S=m._internalType,D=m._outputType,k=m._mimeType;m.on("data",function(F,M){v.push(F),_&&_(M)}).on("error",function(F){v=[],y(F)}).on("end",function(){try{var F=function(M,X,$){switch(M){case"blob":return a.newBlob(a.transformTo("arraybuffer",X),$);case"base64":return c.encode(X);default:return a.transformTo(M,X)}}(D,function(M,X){var $,G=0,K=null,C=0;for($=0;$<X.length;$++)C+=X[$].length;switch(M){case"string":return X.join("");case"array":return Array.prototype.concat.apply([],X);case"uint8array":for(K=new Uint8Array(C),$=0;$<X.length;$++)K.set(X[$],G),G+=X[$].length;return K;case"nodebuffer":return Buffer.concat(X);default:throw new Error("concat : unsupported type '"+M+"'")}}(S,v),k);b(F)}catch(M){y(M)}v=[]}).resume()})}function d(m,_,b){var y=_;switch(_){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=_,this._mimeType=b,a.checkSupport(y),this._worker=m.pipe(new s(y)),m.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}d.prototype={accumulate:function(m){return g(this,m)},on:function(m,_){var b=this;return m==="data"?this._worker.on(m,function(y){_.call(b,y.data,y.meta)}):this._worker.on(m,function(){a.delay(_,arguments,b)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},m)}},i.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,i,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",r.nodebuffer=typeof Buffer!="undefined",r.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")r.blob=!1;else{var a=new ArrayBuffer(0);try{r.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(a),r.blob=s.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!n("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(n,i,r){for(var a=n("./utils"),s=n("./support"),o=n("./nodejsUtils"),c=n("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function p(){c.call(this,"utf-8 decode"),this.leftOver=null}function g(){c.call(this,"utf-8 encode")}r.utf8encode=function(d){return s.nodebuffer?o.newBufferFrom(d,"utf-8"):function(m){var _,b,y,v,S,D=m.length,k=0;for(v=0;v<D;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<D&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),k+=b<128?1:b<2048?2:b<65536?3:4;for(_=s.uint8array?new Uint8Array(k):new Array(k),v=S=0;S<k;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<D&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),b<128?_[S++]=b:(b<2048?_[S++]=192|b>>>6:(b<65536?_[S++]=224|b>>>12:(_[S++]=240|b>>>18,_[S++]=128|b>>>12&63),_[S++]=128|b>>>6&63),_[S++]=128|63&b);return _}(d)},r.utf8decode=function(d){return s.nodebuffer?a.transformTo("nodebuffer",d).toString("utf-8"):function(m){var _,b,y,v,S=m.length,D=new Array(2*S);for(_=b=0;_<S;)if((y=m[_++])<128)D[b++]=y;else if(4<(v=l[y]))D[b++]=65533,_+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&_<S;)y=y<<6|63&m[_++],v--;1<v?D[b++]=65533:y<65536?D[b++]=y:(y-=65536,D[b++]=55296|y>>10&1023,D[b++]=56320|1023&y)}return D.length!==b&&(D.subarray?D=D.subarray(0,b):D.length=b),a.applyFromCharCode(D)}(d=a.transformTo(s.uint8array?"uint8array":"array",d))},a.inherits(p,c),p.prototype.processChunk=function(d){var m=a.transformTo(s.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var _=m;(m=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),m.set(_,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(v,S){var D;for((S=S||v.length)>v.length&&(S=v.length),D=S-1;0<=D&&(192&v[D])==128;)D--;return D<0||D===0?S:D+l[v[D]]>S?D:S}(m),y=m;b!==m.length&&(s.uint8array?(y=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(y=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:r.utf8decode(y),meta:d.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=p,a.inherits(g,c),g.prototype.processChunk=function(d){this.push({data:r.utf8encode(d.data),meta:d.meta})},r.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,i,r){var a=n("./support"),s=n("./base64"),o=n("./nodejsUtils"),c=n("./external");function l(_){return _}function u(_,b){for(var y=0;y<_.length;++y)b[y]=255&_.charCodeAt(y);return b}n("setimmediate"),r.newBlob=function(_,b){r.checkSupport("blob");try{return new Blob([_],{type:b})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(_),y.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(_,b,y){var v=[],S=0,D=_.length;if(D<=y)return String.fromCharCode.apply(null,_);for(;S<D;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,_.slice(S,Math.min(S+y,D)))):v.push(String.fromCharCode.apply(null,_.subarray(S,Math.min(S+y,D)))),S+=y;return v.join("")},stringifyByChar:function(_){for(var b="",y=0;y<_.length;y++)b+=String.fromCharCode(_[y]);return b},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function g(_){var b=65536,y=r.getTypeOf(_),v=!0;if(y==="uint8array"?v=p.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=p.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return p.stringifyByChunk(_,y,b)}catch{b=Math.floor(b/2)}return p.stringifyByChar(_)}function d(_,b){for(var y=0;y<_.length;y++)b[y]=_[y];return b}r.applyFromCharCode=g;var m={};m.string={string:l,array:function(_){return u(_,new Array(_.length))},arraybuffer:function(_){return m.string.uint8array(_).buffer},uint8array:function(_){return u(_,new Uint8Array(_.length))},nodebuffer:function(_){return u(_,o.allocBuffer(_.length))}},m.array={string:g,array:l,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return o.newBufferFrom(_)}},m.arraybuffer={string:function(_){return g(new Uint8Array(_))},array:function(_){return d(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:l,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return o.newBufferFrom(new Uint8Array(_))}},m.uint8array={string:g,array:function(_){return d(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:l,nodebuffer:function(_){return o.newBufferFrom(_)}},m.nodebuffer={string:g,array:function(_){return d(_,new Array(_.length))},arraybuffer:function(_){return m.nodebuffer.uint8array(_).buffer},uint8array:function(_){return d(_,new Uint8Array(_.length))},nodebuffer:l},r.transformTo=function(_,b){if(b=b||"",!_)return b;r.checkSupport(_);var y=r.getTypeOf(b);return m[y][_](b)},r.resolve=function(_){for(var b=_.split("/"),y=[],v=0;v<b.length;v++){var S=b[v];S==="."||S===""&&v!==0&&v!==b.length-1||(S===".."?y.pop():y.push(S))}return y.join("/")},r.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(_)?"nodebuffer":a.uint8array&&_ instanceof Uint8Array?"uint8array":a.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(_){if(!a[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(_){var b,y,v="";for(y=0;y<(_||"").length;y++)v+="\\x"+((b=_.charCodeAt(y))<16?"0":"")+b.toString(16).toUpperCase();return v},r.delay=function(_,b,y){setImmediate(function(){_.apply(y||null,b||[])})},r.inherits=function(_,b){function y(){}y.prototype=b.prototype,_.prototype=new y},r.extend=function(){var _,b,y={};for(_=0;_<arguments.length;_++)for(b in arguments[_])arguments[_].hasOwnProperty(b)&&y[b]===void 0&&(y[b]=arguments[_][b]);return y},r.prepareContent=function(_,b,y,v,S){return c.Promise.resolve(b).then(function(D){return a.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader!="undefined"?new c.Promise(function(k,F){var M=new FileReader;M.onload=function(X){k(X.target.result)},M.onerror=function(X){F(X.target.error)},M.readAsArrayBuffer(D)}):D}).then(function(D){var k=r.getTypeOf(D);return k?(k==="arraybuffer"?D=r.transformTo("uint8array",D):k==="string"&&(S?D=s.decode(D):y&&v!==!0&&(D=function(F){return u(F,a.uint8array?new Uint8Array(F.length):new Array(F.length))}(D))),D):c.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,i,r){var a=n("./reader/readerFor"),s=n("./utils"),o=n("./signature"),c=n("./zipEntry"),l=(n("./utf8"),n("./support"));function u(p){this.files=[],this.loadOptions=p}u.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(g)+", expected "+s.pretty(p)+")")}},isSignature:function(p,g){var d=this.reader.index;this.reader.setIndex(p);var m=this.reader.readString(4)===g;return this.reader.setIndex(d),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),g=l.uint8array?"uint8array":"array",d=s.transformTo(g,p);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,g,d,m=this.zip64EndOfCentralSize-44;0<m;)p=this.reader.readInt(2),g=this.reader.readInt(4),d=this.reader.readData(g),this.zip64ExtensibleData[p]={id:p,length:g,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,g;for(p=0;p<this.files.length;p++)g=this.files[p],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(p=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var g=p;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var m=g-d;if(0<m)this.isSignature(g,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(p){this.reader=a(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(n,i,r){var a=n("./reader/readerFor"),s=n("./utils"),o=n("./compressedObject"),c=n("./crc32"),l=n("./utf8"),u=n("./compressions"),p=n("./support");function g(d,m){this.options=d,this.loadOptions=m}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var m,_;if(d.skip(22),this.fileNameLength=d.readInt(2),_=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var y in u)if(u.hasOwnProperty(y)&&u[y].magic===b)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var m=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(m),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(d){if(this.extraFields[1]){var m=a(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=m.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=m.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=m.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=m.readInt(4))}},readExtraFields:function(d){var m,_,b,y=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<y;)m=d.readInt(2),_=d.readInt(2),b=d.readData(_),this.extraFields[m]={id:m,length:_,value:b};d.setIndex(y)},handleUTF8:function(){var d=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var _=s.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var y=s.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var m=a(d.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var m=a(d.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(d.length-5))}return null}},i.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,i,r){function a(m,_,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=_,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var s=n("./stream/StreamHelper"),o=n("./stream/DataWorker"),c=n("./utf8"),l=n("./compressedObject"),u=n("./stream/GenericWorker");a.prototype={internalStream:function(m){var _=null,b="string";try{if(!m)throw new Error("No output type specified.");var y=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),_=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(_=_.pipe(new c.Utf8EncodeWorker)),!v&&y&&(_=_.pipe(new c.Utf8DecodeWorker))}catch(S){(_=new u("error")).error(S)}return new s(_,b,"")},async:function(m,_){return this.internalStream(m).accumulate(_)},nodeStream:function(m,_){return this.internalStream(m||"nodebuffer").toNodejsStream(_)},_compressWorker:function(m,_){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,m,_)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<p.length;d++)a.prototype[p[d]]=g;i.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,i,r){(function(a){var s,o,c=a.MutationObserver||a.WebKitMutationObserver;if(c){var l=0,u=new c(m),p=a.document.createTextNode("");u.observe(p,{characterData:!0}),s=function(){p.data=l=++l%2}}else if(a.setImmediate||a.MessageChannel===void 0)s="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var _=a.document.createElement("script");_.onreadystatechange=function(){m(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},a.document.documentElement.appendChild(_)}:function(){setTimeout(m,0)};else{var g=new a.MessageChannel;g.port1.onmessage=m,s=function(){g.port2.postMessage(0)}}var d=[];function m(){var _,b;o=!0;for(var y=d.length;y;){for(b=d,d=[],_=-1;++_<y;)b[_]();y=d.length}o=!1}i.exports=function(_){d.push(_)!==1||o||s()}}).call(this,typeof ii!="undefined"?ii:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(n,i,r){var a=n("immediate");function s(){}var o={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function p(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==s&&_(this,y)}function g(y,v,S){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function d(y,v,S){a(function(){var D;try{D=v(S)}catch(k){return o.reject(y,k)}D===y?o.reject(y,new TypeError("Cannot resolve promise with itself")):o.resolve(y,D)})}function m(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function _(y,v){var S=!1;function D(M){S||(S=!0,o.reject(y,M))}function k(M){S||(S=!0,o.resolve(y,M))}var F=b(function(){v(k,D)});F.status==="error"&&D(F.value)}function b(y,v){var S={};try{S.value=y(v),S.status="success"}catch(D){S.status="error",S.value=D}return S}(i.exports=p).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(S){return v.resolve(y()).then(function(){return S})},function(S){return v.resolve(y()).then(function(){throw S})})},p.prototype.catch=function(y){return this.then(null,y)},p.prototype.then=function(y,v){if(typeof y!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var S=new this.constructor(s);return this.state!==u?d(S,this.state===l?y:v,this.outcome):this.queue.push(new g(S,y,v)),S},g.prototype.callFulfilled=function(y){o.resolve(this.promise,y)},g.prototype.otherCallFulfilled=function(y){d(this.promise,this.onFulfilled,y)},g.prototype.callRejected=function(y){o.reject(this.promise,y)},g.prototype.otherCallRejected=function(y){d(this.promise,this.onRejected,y)},o.resolve=function(y,v){var S=b(m,v);if(S.status==="error")return o.reject(y,S.value);var D=S.value;if(D)_(y,D);else{y.state=l,y.outcome=v;for(var k=-1,F=y.queue.length;++k<F;)y.queue[k].callFulfilled(v)}return y},o.reject=function(y,v){y.state=c,y.outcome=v;for(var S=-1,D=y.queue.length;++S<D;)y.queue[S].callRejected(v);return y},p.resolve=function(y){return y instanceof this?y:o.resolve(new this(s),y)},p.reject=function(y){var v=new this(s);return o.reject(v,y)},p.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=y.length,D=!1;if(!S)return this.resolve([]);for(var k=new Array(S),F=0,M=-1,X=new this(s);++M<S;)$(y[M],M);return X;function $(G,K){v.resolve(G).then(function(C){k[K]=C,++F!==S||D||(D=!0,o.resolve(X,k))},function(C){D||(D=!0,o.reject(X,C))})}},p.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=y.length,D=!1;if(!S)return this.resolve([]);for(var k=-1,F=new this(s);++k<S;)M=y[k],v.resolve(M).then(function(X){D||(D=!0,o.resolve(F,X))},function(X){D||(D=!0,o.reject(F,X))});var M;return F}},{immediate:36}],38:[function(n,i,r){var a={};(0,n("./lib/utils/common").assign)(a,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),i.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,i,r){var a=n("./zlib/deflate"),s=n("./utils/common"),o=n("./utils/strings"),c=n("./zlib/messages"),l=n("./zlib/zstream"),u=Object.prototype.toString,p=0,g=-1,d=0,m=8;function _(y){if(!(this instanceof _))return new _(y);this.options=s.assign({level:g,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var S=a.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(S!==p)throw new Error(c[S]);if(v.header&&a.deflateSetHeader(this.strm,v.header),v.dictionary){var D;if(D=typeof v.dictionary=="string"?o.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(S=a.deflateSetDictionary(this.strm,D))!==p)throw new Error(c[S]);this._dict_set=!0}}function b(y,v){var S=new _(v);if(S.push(y,!0),S.err)throw S.msg||c[S.err];return S.result}_.prototype.push=function(y,v){var S,D,k=this.strm,F=this.options.chunkSize;if(this.ended)return!1;D=v===~~v?v:v===!0?4:0,typeof y=="string"?k.input=o.string2buf(y):u.call(y)==="[object ArrayBuffer]"?k.input=new Uint8Array(y):k.input=y,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(F),k.next_out=0,k.avail_out=F),(S=a.deflate(k,D))!==1&&S!==p)return this.onEnd(S),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(k.output,k.next_out))):this.onData(s.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&S!==1);return D===4?(S=a.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===p):D!==2||(this.onEnd(p),!(k.avail_out=0))},_.prototype.onData=function(y){this.chunks.push(y)},_.prototype.onEnd=function(y){y===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},r.Deflate=_,r.deflate=b,r.deflateRaw=function(y,v){return(v=v||{}).raw=!0,b(y,v)},r.gzip=function(y,v){return(v=v||{}).gzip=!0,b(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,i,r){var a=n("./zlib/inflate"),s=n("./utils/common"),o=n("./utils/strings"),c=n("./zlib/constants"),l=n("./zlib/messages"),u=n("./zlib/zstream"),p=n("./zlib/gzheader"),g=Object.prototype.toString;function d(_){if(!(this instanceof d))return new d(_);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},_||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||_&&_.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&(15&b.windowBits)==0&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=a.inflateInit2(this.strm,b.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new p,a.inflateGetHeader(this.strm,this.header)}function m(_,b){var y=new d(b);if(y.push(_,!0),y.err)throw y.msg||l[y.err];return y.result}d.prototype.push=function(_,b){var y,v,S,D,k,F,M=this.strm,X=this.options.chunkSize,$=this.options.dictionary,G=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof _=="string"?M.input=o.binstring2buf(_):g.call(_)==="[object ArrayBuffer]"?M.input=new Uint8Array(_):M.input=_,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new s.Buf8(X),M.next_out=0,M.avail_out=X),(y=a.inflate(M,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&$&&(F=typeof $=="string"?o.string2buf($):g.call($)==="[object ArrayBuffer]"?new Uint8Array($):$,y=a.inflateSetDictionary(this.strm,F)),y===c.Z_BUF_ERROR&&G===!0&&(y=c.Z_OK,G=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);M.next_out&&(M.avail_out!==0&&y!==c.Z_STREAM_END&&(M.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=o.utf8border(M.output,M.next_out),D=M.next_out-S,k=o.buf2string(M.output,S),M.next_out=D,M.avail_out=X-D,D&&s.arraySet(M.output,M.output,S,D,0),this.onData(k)):this.onData(s.shrinkBuf(M.output,M.next_out)))),M.avail_in===0&&M.avail_out===0&&(G=!0)}while((0<M.avail_in||M.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(y=a.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(M.avail_out=0))},d.prototype.onData=function(_){this.chunks.push(_)},d.prototype.onEnd=function(_){_===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},r.Inflate=d,r.inflate=m,r.inflateRaw=function(_,b){return(b=b||{}).raw=!0,m(_,b)},r.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,i,r){var a=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";r.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(c[p]=u[p])}}return c},r.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var s={arraySet:function(c,l,u,p,g){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+p),g);else for(var d=0;d<p;d++)c[g+d]=l[u+d]},flattenChunks:function(c){var l,u,p,g,d,m;for(l=p=0,u=c.length;l<u;l++)p+=c[l].length;for(m=new Uint8Array(p),l=g=0,u=c.length;l<u;l++)d=c[l],m.set(d,g),g+=d.length;return m}},o={arraySet:function(c,l,u,p,g){for(var d=0;d<p;d++)c[g+d]=l[u+d]},flattenChunks:function(c){return[].concat.apply([],c)}};r.setTyped=function(c){c?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,s)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(a)},{}],42:[function(n,i,r){var a=n("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var c=new a.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(p,g){if(g<65537&&(p.subarray&&o||!p.subarray&&s))return String.fromCharCode.apply(null,a.shrinkBuf(p,g));for(var d="",m=0;m<g;m++)d+=String.fromCharCode(p[m]);return d}c[254]=c[254]=1,r.string2buf=function(p){var g,d,m,_,b,y=p.length,v=0;for(_=0;_<y;_++)(64512&(d=p.charCodeAt(_)))==55296&&_+1<y&&(64512&(m=p.charCodeAt(_+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),_++),v+=d<128?1:d<2048?2:d<65536?3:4;for(g=new a.Buf8(v),_=b=0;b<v;_++)(64512&(d=p.charCodeAt(_)))==55296&&_+1<y&&(64512&(m=p.charCodeAt(_+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),_++),d<128?g[b++]=d:(d<2048?g[b++]=192|d>>>6:(d<65536?g[b++]=224|d>>>12:(g[b++]=240|d>>>18,g[b++]=128|d>>>12&63),g[b++]=128|d>>>6&63),g[b++]=128|63&d);return g},r.buf2binstring=function(p){return u(p,p.length)},r.binstring2buf=function(p){for(var g=new a.Buf8(p.length),d=0,m=g.length;d<m;d++)g[d]=p.charCodeAt(d);return g},r.buf2string=function(p,g){var d,m,_,b,y=g||p.length,v=new Array(2*y);for(d=m=0;d<y;)if((_=p[d++])<128)v[m++]=_;else if(4<(b=c[_]))v[m++]=65533,d+=b-1;else{for(_&=b===2?31:b===3?15:7;1<b&&d<y;)_=_<<6|63&p[d++],b--;1<b?v[m++]=65533:_<65536?v[m++]=_:(_-=65536,v[m++]=55296|_>>10&1023,v[m++]=56320|1023&_)}return u(v,m)},r.utf8border=function(p,g){var d;for((g=g||p.length)>p.length&&(g=p.length),d=g-1;0<=d&&(192&p[d])==128;)d--;return d<0||d===0?g:d+c[p[d]]>g?d:g}},{"./common":41}],43:[function(n,i,r){i.exports=function(a,s,o,c){for(var l=65535&a|0,u=a>>>16&65535|0,p=0;o!==0;){for(o-=p=2e3<o?2e3:o;u=u+(l=l+s[c++]|0)|0,--p;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(n,i,r){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,i,r){var a=function(){for(var s,o=[],c=0;c<256;c++){s=c;for(var l=0;l<8;l++)s=1&s?3988292384^s>>>1:s>>>1;o[c]=s}return o}();i.exports=function(s,o,c,l){var u=a,p=l+c;s^=-1;for(var g=l;g<p;g++)s=s>>>8^u[255&(s^o[g])];return-1^s}},{}],46:[function(n,i,r){var a,s=n("../utils/common"),o=n("./trees"),c=n("./adler32"),l=n("./crc32"),u=n("./messages"),p=0,g=4,d=0,m=-2,_=-1,b=4,y=2,v=8,S=9,D=286,k=30,F=19,M=2*D+1,X=15,$=3,G=258,K=G+$+1,C=42,N=113,h=1,L=2,J=3,j=4;function at(f,P){return f.msg=u[P],P}function U(f){return(f<<1)-(4<f?9:0)}function Q(f){for(var P=f.length;0<=--P;)f[P]=0}function A(f){var P=f.state,B=P.pending;B>f.avail_out&&(B=f.avail_out),B!==0&&(s.arraySet(f.output,P.pending_buf,P.pending_out,B,f.next_out),f.next_out+=B,P.pending_out+=B,f.total_out+=B,f.avail_out-=B,P.pending-=B,P.pending===0&&(P.pending_out=0))}function I(f,P){o._tr_flush_block(f,0<=f.block_start?f.block_start:-1,f.strstart-f.block_start,P),f.block_start=f.strstart,A(f.strm)}function et(f,P){f.pending_buf[f.pending++]=P}function q(f,P){f.pending_buf[f.pending++]=P>>>8&255,f.pending_buf[f.pending++]=255&P}function W(f,P){var B,w,E=f.max_chain_length,T=f.strstart,H=f.prev_length,z=f.nice_match,x=f.strstart>f.w_size-K?f.strstart-(f.w_size-K):0,Y=f.window,Z=f.w_mask,V=f.prev,tt=f.strstart+G,_t=Y[T+H-1],lt=Y[T+H];f.prev_length>=f.good_match&&(E>>=2),z>f.lookahead&&(z=f.lookahead);do if(Y[(B=P)+H]===lt&&Y[B+H-1]===_t&&Y[B]===Y[T]&&Y[++B]===Y[T+1]){T+=2,B++;do;while(Y[++T]===Y[++B]&&Y[++T]===Y[++B]&&Y[++T]===Y[++B]&&Y[++T]===Y[++B]&&Y[++T]===Y[++B]&&Y[++T]===Y[++B]&&Y[++T]===Y[++B]&&Y[++T]===Y[++B]&&T<tt);if(w=G-(tt-T),T=tt-G,H<w){if(f.match_start=P,z<=(H=w))break;_t=Y[T+H-1],lt=Y[T+H]}}while((P=V[P&Z])>x&&--E!=0);return H<=f.lookahead?H:f.lookahead}function vt(f){var P,B,w,E,T,H,z,x,Y,Z,V=f.w_size;do{if(E=f.window_size-f.lookahead-f.strstart,f.strstart>=V+(V-K)){for(s.arraySet(f.window,f.window,V,V,0),f.match_start-=V,f.strstart-=V,f.block_start-=V,P=B=f.hash_size;w=f.head[--P],f.head[P]=V<=w?w-V:0,--B;);for(P=B=V;w=f.prev[--P],f.prev[P]=V<=w?w-V:0,--B;);E+=V}if(f.strm.avail_in===0)break;if(H=f.strm,z=f.window,x=f.strstart+f.lookahead,Y=E,Z=void 0,Z=H.avail_in,Y<Z&&(Z=Y),B=Z===0?0:(H.avail_in-=Z,s.arraySet(z,H.input,H.next_in,Z,x),H.state.wrap===1?H.adler=c(H.adler,z,Z,x):H.state.wrap===2&&(H.adler=l(H.adler,z,Z,x)),H.next_in+=Z,H.total_in+=Z,Z),f.lookahead+=B,f.lookahead+f.insert>=$)for(T=f.strstart-f.insert,f.ins_h=f.window[T],f.ins_h=(f.ins_h<<f.hash_shift^f.window[T+1])&f.hash_mask;f.insert&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[T+$-1])&f.hash_mask,f.prev[T&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=T,T++,f.insert--,!(f.lookahead+f.insert<$)););}while(f.lookahead<K&&f.strm.avail_in!==0)}function At(f,P){for(var B,w;;){if(f.lookahead<K){if(vt(f),f.lookahead<K&&P===p)return h;if(f.lookahead===0)break}if(B=0,f.lookahead>=$&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,B=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),B!==0&&f.strstart-B<=f.w_size-K&&(f.match_length=W(f,B)),f.match_length>=$)if(w=o._tr_tally(f,f.strstart-f.match_start,f.match_length-$),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=$){for(f.match_length--;f.strstart++,f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,B=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart,--f.match_length!=0;);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+1])&f.hash_mask;else w=o._tr_tally(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(w&&(I(f,!1),f.strm.avail_out===0))return h}return f.insert=f.strstart<$-1?f.strstart:$-1,P===g?(I(f,!0),f.strm.avail_out===0?J:j):f.last_lit&&(I(f,!1),f.strm.avail_out===0)?h:L}function st(f,P){for(var B,w,E;;){if(f.lookahead<K){if(vt(f),f.lookahead<K&&P===p)return h;if(f.lookahead===0)break}if(B=0,f.lookahead>=$&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,B=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=$-1,B!==0&&f.prev_length<f.max_lazy_match&&f.strstart-B<=f.w_size-K&&(f.match_length=W(f,B),f.match_length<=5&&(f.strategy===1||f.match_length===$&&4096<f.strstart-f.match_start)&&(f.match_length=$-1)),f.prev_length>=$&&f.match_length<=f.prev_length){for(E=f.strstart+f.lookahead-$,w=o._tr_tally(f,f.strstart-1-f.prev_match,f.prev_length-$),f.lookahead-=f.prev_length-1,f.prev_length-=2;++f.strstart<=E&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,B=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),--f.prev_length!=0;);if(f.match_available=0,f.match_length=$-1,f.strstart++,w&&(I(f,!1),f.strm.avail_out===0))return h}else if(f.match_available){if((w=o._tr_tally(f,0,f.window[f.strstart-1]))&&I(f,!1),f.strstart++,f.lookahead--,f.strm.avail_out===0)return h}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(w=o._tr_tally(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<$-1?f.strstart:$-1,P===g?(I(f,!0),f.strm.avail_out===0?J:j):f.last_lit&&(I(f,!1),f.strm.avail_out===0)?h:L}function ft(f,P,B,w,E){this.good_length=f,this.max_lazy=P,this.nice_length=B,this.max_chain=w,this.func=E}function Tt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*M),this.dyn_dtree=new s.Buf16(2*(2*k+1)),this.bl_tree=new s.Buf16(2*(2*F+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(X+1),this.heap=new s.Buf16(2*D+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*D+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Et(f){var P;return f&&f.state?(f.total_in=f.total_out=0,f.data_type=y,(P=f.state).pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?C:N,f.adler=P.wrap===2?0:1,P.last_flush=p,o._tr_init(P),d):at(f,m)}function fe(f){var P=Et(f);return P===d&&function(B){B.window_size=2*B.w_size,Q(B.head),B.max_lazy_match=a[B.level].max_lazy,B.good_match=a[B.level].good_length,B.nice_match=a[B.level].nice_length,B.max_chain_length=a[B.level].max_chain,B.strstart=0,B.block_start=0,B.lookahead=0,B.insert=0,B.match_length=B.prev_length=$-1,B.match_available=0,B.ins_h=0}(f.state),P}function ne(f,P,B,w,E,T){if(!f)return m;var H=1;if(P===_&&(P=6),w<0?(H=0,w=-w):15<w&&(H=2,w-=16),E<1||S<E||B!==v||w<8||15<w||P<0||9<P||T<0||b<T)return at(f,m);w===8&&(w=9);var z=new Tt;return(f.state=z).strm=f,z.wrap=H,z.gzhead=null,z.w_bits=w,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=E+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+$-1)/$),z.window=new s.Buf8(2*z.w_size),z.head=new s.Buf16(z.hash_size),z.prev=new s.Buf16(z.w_size),z.lit_bufsize=1<<E+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new s.Buf8(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=P,z.strategy=T,z.method=B,fe(f)}a=[new ft(0,0,0,0,function(f,P){var B=65535;for(B>f.pending_buf_size-5&&(B=f.pending_buf_size-5);;){if(f.lookahead<=1){if(vt(f),f.lookahead===0&&P===p)return h;if(f.lookahead===0)break}f.strstart+=f.lookahead,f.lookahead=0;var w=f.block_start+B;if((f.strstart===0||f.strstart>=w)&&(f.lookahead=f.strstart-w,f.strstart=w,I(f,!1),f.strm.avail_out===0)||f.strstart-f.block_start>=f.w_size-K&&(I(f,!1),f.strm.avail_out===0))return h}return f.insert=0,P===g?(I(f,!0),f.strm.avail_out===0?J:j):(f.strstart>f.block_start&&(I(f,!1),f.strm.avail_out),h)}),new ft(4,4,8,4,At),new ft(4,5,16,8,At),new ft(4,6,32,32,At),new ft(4,4,16,16,st),new ft(8,16,32,32,st),new ft(8,16,128,128,st),new ft(8,32,128,256,st),new ft(32,128,258,1024,st),new ft(32,258,258,4096,st)],r.deflateInit=function(f,P){return ne(f,P,v,15,8,0)},r.deflateInit2=ne,r.deflateReset=fe,r.deflateResetKeep=Et,r.deflateSetHeader=function(f,P){return f&&f.state?f.state.wrap!==2?m:(f.state.gzhead=P,d):m},r.deflate=function(f,P){var B,w,E,T;if(!f||!f.state||5<P||P<0)return f?at(f,m):m;if(w=f.state,!f.output||!f.input&&f.avail_in!==0||w.status===666&&P!==g)return at(f,f.avail_out===0?-5:m);if(w.strm=f,B=w.last_flush,w.last_flush=P,w.status===C)if(w.wrap===2)f.adler=0,et(w,31),et(w,139),et(w,8),w.gzhead?(et(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),et(w,255&w.gzhead.time),et(w,w.gzhead.time>>8&255),et(w,w.gzhead.time>>16&255),et(w,w.gzhead.time>>24&255),et(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),et(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(et(w,255&w.gzhead.extra.length),et(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(f.adler=l(f.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(et(w,0),et(w,0),et(w,0),et(w,0),et(w,0),et(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),et(w,3),w.status=N);else{var H=v+(w.w_bits-8<<4)<<8;H|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(H|=32),H+=31-H%31,w.status=N,q(w,H),w.strstart!==0&&(q(w,f.adler>>>16),q(w,65535&f.adler)),f.adler=1}if(w.status===69)if(w.gzhead.extra){for(E=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),A(f),E=w.pending,w.pending!==w.pending_buf_size));)et(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){E=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),A(f),E=w.pending,w.pending===w.pending_buf_size)){T=1;break}T=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,et(w,T)}while(T!==0);w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),T===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){E=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),A(f),E=w.pending,w.pending===w.pending_buf_size)){T=1;break}T=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,et(w,T)}while(T!==0);w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),T===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&A(f),w.pending+2<=w.pending_buf_size&&(et(w,255&f.adler),et(w,f.adler>>8&255),f.adler=0,w.status=N)):w.status=N),w.pending!==0){if(A(f),f.avail_out===0)return w.last_flush=-1,d}else if(f.avail_in===0&&U(P)<=U(B)&&P!==g)return at(f,-5);if(w.status===666&&f.avail_in!==0)return at(f,-5);if(f.avail_in!==0||w.lookahead!==0||P!==p&&w.status!==666){var z=w.strategy===2?function(x,Y){for(var Z;;){if(x.lookahead===0&&(vt(x),x.lookahead===0)){if(Y===p)return h;break}if(x.match_length=0,Z=o._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++,Z&&(I(x,!1),x.strm.avail_out===0))return h}return x.insert=0,Y===g?(I(x,!0),x.strm.avail_out===0?J:j):x.last_lit&&(I(x,!1),x.strm.avail_out===0)?h:L}(w,P):w.strategy===3?function(x,Y){for(var Z,V,tt,_t,lt=x.window;;){if(x.lookahead<=G){if(vt(x),x.lookahead<=G&&Y===p)return h;if(x.lookahead===0)break}if(x.match_length=0,x.lookahead>=$&&0<x.strstart&&(V=lt[tt=x.strstart-1])===lt[++tt]&&V===lt[++tt]&&V===lt[++tt]){_t=x.strstart+G;do;while(V===lt[++tt]&&V===lt[++tt]&&V===lt[++tt]&&V===lt[++tt]&&V===lt[++tt]&&V===lt[++tt]&&V===lt[++tt]&&V===lt[++tt]&&tt<_t);x.match_length=G-(_t-tt),x.match_length>x.lookahead&&(x.match_length=x.lookahead)}if(x.match_length>=$?(Z=o._tr_tally(x,1,x.match_length-$),x.lookahead-=x.match_length,x.strstart+=x.match_length,x.match_length=0):(Z=o._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++),Z&&(I(x,!1),x.strm.avail_out===0))return h}return x.insert=0,Y===g?(I(x,!0),x.strm.avail_out===0?J:j):x.last_lit&&(I(x,!1),x.strm.avail_out===0)?h:L}(w,P):a[w.level].func(w,P);if(z!==J&&z!==j||(w.status=666),z===h||z===J)return f.avail_out===0&&(w.last_flush=-1),d;if(z===L&&(P===1?o._tr_align(w):P!==5&&(o._tr_stored_block(w,0,0,!1),P===3&&(Q(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),A(f),f.avail_out===0))return w.last_flush=-1,d}return P!==g?d:w.wrap<=0?1:(w.wrap===2?(et(w,255&f.adler),et(w,f.adler>>8&255),et(w,f.adler>>16&255),et(w,f.adler>>24&255),et(w,255&f.total_in),et(w,f.total_in>>8&255),et(w,f.total_in>>16&255),et(w,f.total_in>>24&255)):(q(w,f.adler>>>16),q(w,65535&f.adler)),A(f),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?d:1)},r.deflateEnd=function(f){var P;return f&&f.state?(P=f.state.status)!==C&&P!==69&&P!==73&&P!==91&&P!==103&&P!==N&&P!==666?at(f,m):(f.state=null,P===N?at(f,-3):d):m},r.deflateSetDictionary=function(f,P){var B,w,E,T,H,z,x,Y,Z=P.length;if(!f||!f.state||(T=(B=f.state).wrap)===2||T===1&&B.status!==C||B.lookahead)return m;for(T===1&&(f.adler=c(f.adler,P,Z,0)),B.wrap=0,Z>=B.w_size&&(T===0&&(Q(B.head),B.strstart=0,B.block_start=0,B.insert=0),Y=new s.Buf8(B.w_size),s.arraySet(Y,P,Z-B.w_size,B.w_size,0),P=Y,Z=B.w_size),H=f.avail_in,z=f.next_in,x=f.input,f.avail_in=Z,f.next_in=0,f.input=P,vt(B);B.lookahead>=$;){for(w=B.strstart,E=B.lookahead-($-1);B.ins_h=(B.ins_h<<B.hash_shift^B.window[w+$-1])&B.hash_mask,B.prev[w&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=w,w++,--E;);B.strstart=w,B.lookahead=$-1,vt(B)}return B.strstart+=B.lookahead,B.block_start=B.strstart,B.insert=B.lookahead,B.lookahead=0,B.match_length=B.prev_length=$-1,B.match_available=0,f.next_in=z,f.input=x,f.avail_in=H,B.wrap=T,d},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,i,r){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,i,r){i.exports=function(a,s){var o,c,l,u,p,g,d,m,_,b,y,v,S,D,k,F,M,X,$,G,K,C,N,h,L;o=a.state,c=a.next_in,h=a.input,l=c+(a.avail_in-5),u=a.next_out,L=a.output,p=u-(s-a.avail_out),g=u+(a.avail_out-257),d=o.dmax,m=o.wsize,_=o.whave,b=o.wnext,y=o.window,v=o.hold,S=o.bits,D=o.lencode,k=o.distcode,F=(1<<o.lenbits)-1,M=(1<<o.distbits)-1;t:do{S<15&&(v+=h[c++]<<S,S+=8,v+=h[c++]<<S,S+=8),X=D[v&F];e:for(;;){if(v>>>=$=X>>>24,S-=$,($=X>>>16&255)===0)L[u++]=65535&X;else{if(!(16&$)){if((64&$)==0){X=D[(65535&X)+(v&(1<<$)-1)];continue e}if(32&$){o.mode=12;break t}a.msg="invalid literal/length code",o.mode=30;break t}G=65535&X,($&=15)&&(S<$&&(v+=h[c++]<<S,S+=8),G+=v&(1<<$)-1,v>>>=$,S-=$),S<15&&(v+=h[c++]<<S,S+=8,v+=h[c++]<<S,S+=8),X=k[v&M];n:for(;;){if(v>>>=$=X>>>24,S-=$,!(16&($=X>>>16&255))){if((64&$)==0){X=k[(65535&X)+(v&(1<<$)-1)];continue n}a.msg="invalid distance code",o.mode=30;break t}if(K=65535&X,S<($&=15)&&(v+=h[c++]<<S,(S+=8)<$&&(v+=h[c++]<<S,S+=8)),d<(K+=v&(1<<$)-1)){a.msg="invalid distance too far back",o.mode=30;break t}if(v>>>=$,S-=$,($=u-p)<K){if(_<($=K-$)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break t}if(N=y,(C=0)===b){if(C+=m-$,$<G){for(G-=$;L[u++]=y[C++],--$;);C=u-K,N=L}}else if(b<$){if(C+=m+b-$,($-=b)<G){for(G-=$;L[u++]=y[C++],--$;);if(C=0,b<G){for(G-=$=b;L[u++]=y[C++],--$;);C=u-K,N=L}}}else if(C+=b-$,$<G){for(G-=$;L[u++]=y[C++],--$;);C=u-K,N=L}for(;2<G;)L[u++]=N[C++],L[u++]=N[C++],L[u++]=N[C++],G-=3;G&&(L[u++]=N[C++],1<G&&(L[u++]=N[C++]))}else{for(C=u-K;L[u++]=L[C++],L[u++]=L[C++],L[u++]=L[C++],2<(G-=3););G&&(L[u++]=L[C++],1<G&&(L[u++]=L[C++]))}break}}break}}while(c<l&&u<g);c-=G=S>>3,v&=(1<<(S-=G<<3))-1,a.next_in=c,a.next_out=u,a.avail_in=c<l?l-c+5:5-(c-l),a.avail_out=u<g?g-u+257:257-(u-g),o.hold=v,o.bits=S}},{}],49:[function(n,i,r){var a=n("../utils/common"),s=n("./adler32"),o=n("./crc32"),c=n("./inffast"),l=n("./inftrees"),u=1,p=2,g=0,d=-2,m=1,_=852,b=592;function y(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(C){var N;return C&&C.state?(N=C.state,C.total_in=C.total_out=N.total=0,C.msg="",N.wrap&&(C.adler=1&N.wrap),N.mode=m,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new a.Buf32(_),N.distcode=N.distdyn=new a.Buf32(b),N.sane=1,N.back=-1,g):d}function D(C){var N;return C&&C.state?((N=C.state).wsize=0,N.whave=0,N.wnext=0,S(C)):d}function k(C,N){var h,L;return C&&C.state?(L=C.state,N<0?(h=0,N=-N):(h=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?d:(L.window!==null&&L.wbits!==N&&(L.window=null),L.wrap=h,L.wbits=N,D(C))):d}function F(C,N){var h,L;return C?(L=new v,(C.state=L).window=null,(h=k(C,N))!==g&&(C.state=null),h):d}var M,X,$=!0;function G(C){if($){var N;for(M=new a.Buf32(512),X=new a.Buf32(32),N=0;N<144;)C.lens[N++]=8;for(;N<256;)C.lens[N++]=9;for(;N<280;)C.lens[N++]=7;for(;N<288;)C.lens[N++]=8;for(l(u,C.lens,0,288,M,0,C.work,{bits:9}),N=0;N<32;)C.lens[N++]=5;l(p,C.lens,0,32,X,0,C.work,{bits:5}),$=!1}C.lencode=M,C.lenbits=9,C.distcode=X,C.distbits=5}function K(C,N,h,L){var J,j=C.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new a.Buf8(j.wsize)),L>=j.wsize?(a.arraySet(j.window,N,h-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(L<(J=j.wsize-j.wnext)&&(J=L),a.arraySet(j.window,N,h-L,J,j.wnext),(L-=J)?(a.arraySet(j.window,N,h-L,L,0),j.wnext=L,j.whave=j.wsize):(j.wnext+=J,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=J))),0}r.inflateReset=D,r.inflateReset2=k,r.inflateResetKeep=S,r.inflateInit=function(C){return F(C,15)},r.inflateInit2=F,r.inflate=function(C,N){var h,L,J,j,at,U,Q,A,I,et,q,W,vt,At,st,ft,Tt,Et,fe,ne,f,P,B,w,E=0,T=new a.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return d;(h=C.state).mode===12&&(h.mode=13),at=C.next_out,J=C.output,Q=C.avail_out,j=C.next_in,L=C.input,U=C.avail_in,A=h.hold,I=h.bits,et=U,q=Q,P=g;t:for(;;)switch(h.mode){case m:if(h.wrap===0){h.mode=13;break}for(;I<16;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if(2&h.wrap&&A===35615){T[h.check=0]=255&A,T[1]=A>>>8&255,h.check=o(h.check,T,2,0),I=A=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&A)<<8)+(A>>8))%31){C.msg="incorrect header check",h.mode=30;break}if((15&A)!=8){C.msg="unknown compression method",h.mode=30;break}if(I-=4,f=8+(15&(A>>>=4)),h.wbits===0)h.wbits=f;else if(f>h.wbits){C.msg="invalid window size",h.mode=30;break}h.dmax=1<<f,C.adler=h.check=1,h.mode=512&A?10:12,I=A=0;break;case 2:for(;I<16;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if(h.flags=A,(255&h.flags)!=8){C.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){C.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=A>>8&1),512&h.flags&&(T[0]=255&A,T[1]=A>>>8&255,h.check=o(h.check,T,2,0)),I=A=0,h.mode=3;case 3:for(;I<32;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}h.head&&(h.head.time=A),512&h.flags&&(T[0]=255&A,T[1]=A>>>8&255,T[2]=A>>>16&255,T[3]=A>>>24&255,h.check=o(h.check,T,4,0)),I=A=0,h.mode=4;case 4:for(;I<16;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}h.head&&(h.head.xflags=255&A,h.head.os=A>>8),512&h.flags&&(T[0]=255&A,T[1]=A>>>8&255,h.check=o(h.check,T,2,0)),I=A=0,h.mode=5;case 5:if(1024&h.flags){for(;I<16;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}h.length=A,h.head&&(h.head.extra_len=A),512&h.flags&&(T[0]=255&A,T[1]=A>>>8&255,h.check=o(h.check,T,2,0)),I=A=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(U<(W=h.length)&&(W=U),W&&(h.head&&(f=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),a.arraySet(h.head.extra,L,j,W,f)),512&h.flags&&(h.check=o(h.check,L,W,j)),U-=W,j+=W,h.length-=W),h.length))break t;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(U===0)break t;for(W=0;f=L[j+W++],h.head&&f&&h.length<65536&&(h.head.name+=String.fromCharCode(f)),f&&W<U;);if(512&h.flags&&(h.check=o(h.check,L,W,j)),U-=W,j+=W,f)break t}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(U===0)break t;for(W=0;f=L[j+W++],h.head&&f&&h.length<65536&&(h.head.comment+=String.fromCharCode(f)),f&&W<U;);if(512&h.flags&&(h.check=o(h.check,L,W,j)),U-=W,j+=W,f)break t}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;I<16;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if(A!==(65535&h.check)){C.msg="header crc mismatch",h.mode=30;break}I=A=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),C.adler=h.check=0,h.mode=12;break;case 10:for(;I<32;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}C.adler=h.check=y(A),I=A=0,h.mode=11;case 11:if(h.havedict===0)return C.next_out=at,C.avail_out=Q,C.next_in=j,C.avail_in=U,h.hold=A,h.bits=I,2;C.adler=h.check=1,h.mode=12;case 12:if(N===5||N===6)break t;case 13:if(h.last){A>>>=7&I,I-=7&I,h.mode=27;break}for(;I<3;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}switch(h.last=1&A,I-=1,3&(A>>>=1)){case 0:h.mode=14;break;case 1:if(G(h),h.mode=20,N!==6)break;A>>>=2,I-=2;break t;case 2:h.mode=17;break;case 3:C.msg="invalid block type",h.mode=30}A>>>=2,I-=2;break;case 14:for(A>>>=7&I,I-=7&I;I<32;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if((65535&A)!=(A>>>16^65535)){C.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&A,I=A=0,h.mode=15,N===6)break t;case 15:h.mode=16;case 16:if(W=h.length){if(U<W&&(W=U),Q<W&&(W=Q),W===0)break t;a.arraySet(J,L,j,W,at),U-=W,j+=W,Q-=W,at+=W,h.length-=W;break}h.mode=12;break;case 17:for(;I<14;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if(h.nlen=257+(31&A),A>>>=5,I-=5,h.ndist=1+(31&A),A>>>=5,I-=5,h.ncode=4+(15&A),A>>>=4,I-=4,286<h.nlen||30<h.ndist){C.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;I<3;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}h.lens[H[h.have++]]=7&A,A>>>=3,I-=3}for(;h.have<19;)h.lens[H[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,B={bits:h.lenbits},P=l(0,h.lens,0,19,h.lencode,0,h.work,B),h.lenbits=B.bits,P){C.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;ft=(E=h.lencode[A&(1<<h.lenbits)-1])>>>16&255,Tt=65535&E,!((st=E>>>24)<=I);){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if(Tt<16)A>>>=st,I-=st,h.lens[h.have++]=Tt;else{if(Tt===16){for(w=st+2;I<w;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if(A>>>=st,I-=st,h.have===0){C.msg="invalid bit length repeat",h.mode=30;break}f=h.lens[h.have-1],W=3+(3&A),A>>>=2,I-=2}else if(Tt===17){for(w=st+3;I<w;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}I-=st,f=0,W=3+(7&(A>>>=st)),A>>>=3,I-=3}else{for(w=st+7;I<w;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}I-=st,f=0,W=11+(127&(A>>>=st)),A>>>=7,I-=7}if(h.have+W>h.nlen+h.ndist){C.msg="invalid bit length repeat",h.mode=30;break}for(;W--;)h.lens[h.have++]=f}}if(h.mode===30)break;if(h.lens[256]===0){C.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,B={bits:h.lenbits},P=l(u,h.lens,0,h.nlen,h.lencode,0,h.work,B),h.lenbits=B.bits,P){C.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,B={bits:h.distbits},P=l(p,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,B),h.distbits=B.bits,P){C.msg="invalid distances set",h.mode=30;break}if(h.mode=20,N===6)break t;case 20:h.mode=21;case 21:if(6<=U&&258<=Q){C.next_out=at,C.avail_out=Q,C.next_in=j,C.avail_in=U,h.hold=A,h.bits=I,c(C,q),at=C.next_out,J=C.output,Q=C.avail_out,j=C.next_in,L=C.input,U=C.avail_in,A=h.hold,I=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;ft=(E=h.lencode[A&(1<<h.lenbits)-1])>>>16&255,Tt=65535&E,!((st=E>>>24)<=I);){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if(ft&&(240&ft)==0){for(Et=st,fe=ft,ne=Tt;ft=(E=h.lencode[ne+((A&(1<<Et+fe)-1)>>Et)])>>>16&255,Tt=65535&E,!(Et+(st=E>>>24)<=I);){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}A>>>=Et,I-=Et,h.back+=Et}if(A>>>=st,I-=st,h.back+=st,h.length=Tt,ft===0){h.mode=26;break}if(32&ft){h.back=-1,h.mode=12;break}if(64&ft){C.msg="invalid literal/length code",h.mode=30;break}h.extra=15&ft,h.mode=22;case 22:if(h.extra){for(w=h.extra;I<w;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}h.length+=A&(1<<h.extra)-1,A>>>=h.extra,I-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;ft=(E=h.distcode[A&(1<<h.distbits)-1])>>>16&255,Tt=65535&E,!((st=E>>>24)<=I);){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if((240&ft)==0){for(Et=st,fe=ft,ne=Tt;ft=(E=h.distcode[ne+((A&(1<<Et+fe)-1)>>Et)])>>>16&255,Tt=65535&E,!(Et+(st=E>>>24)<=I);){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}A>>>=Et,I-=Et,h.back+=Et}if(A>>>=st,I-=st,h.back+=st,64&ft){C.msg="invalid distance code",h.mode=30;break}h.offset=Tt,h.extra=15&ft,h.mode=24;case 24:if(h.extra){for(w=h.extra;I<w;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}h.offset+=A&(1<<h.extra)-1,A>>>=h.extra,I-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){C.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(Q===0)break t;if(W=q-Q,h.offset>W){if((W=h.offset-W)>h.whave&&h.sane){C.msg="invalid distance too far back",h.mode=30;break}vt=W>h.wnext?(W-=h.wnext,h.wsize-W):h.wnext-W,W>h.length&&(W=h.length),At=h.window}else At=J,vt=at-h.offset,W=h.length;for(Q<W&&(W=Q),Q-=W,h.length-=W;J[at++]=At[vt++],--W;);h.length===0&&(h.mode=21);break;case 26:if(Q===0)break t;J[at++]=h.length,Q--,h.mode=21;break;case 27:if(h.wrap){for(;I<32;){if(U===0)break t;U--,A|=L[j++]<<I,I+=8}if(q-=Q,C.total_out+=q,h.total+=q,q&&(C.adler=h.check=h.flags?o(h.check,J,q,at-q):s(h.check,J,q,at-q)),q=Q,(h.flags?A:y(A))!==h.check){C.msg="incorrect data check",h.mode=30;break}I=A=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;I<32;){if(U===0)break t;U--,A+=L[j++]<<I,I+=8}if(A!==(4294967295&h.total)){C.msg="incorrect length check",h.mode=30;break}I=A=0}h.mode=29;case 29:P=1;break t;case 30:P=-3;break t;case 31:return-4;case 32:default:return d}return C.next_out=at,C.avail_out=Q,C.next_in=j,C.avail_in=U,h.hold=A,h.bits=I,(h.wsize||q!==C.avail_out&&h.mode<30&&(h.mode<27||N!==4))&&K(C,C.output,C.next_out,q-C.avail_out)?(h.mode=31,-4):(et-=C.avail_in,q-=C.avail_out,C.total_in+=et,C.total_out+=q,h.total+=q,h.wrap&&q&&(C.adler=h.check=h.flags?o(h.check,J,q,C.next_out-q):s(h.check,J,q,C.next_out-q)),C.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(et==0&&q===0||N===4)&&P===g&&(P=-5),P)},r.inflateEnd=function(C){if(!C||!C.state)return d;var N=C.state;return N.window&&(N.window=null),C.state=null,g},r.inflateGetHeader=function(C,N){var h;return C&&C.state?(2&(h=C.state).wrap)==0?d:((h.head=N).done=!1,g):d},r.inflateSetDictionary=function(C,N){var h,L=N.length;return C&&C.state?(h=C.state).wrap!==0&&h.mode!==11?d:h.mode===11&&s(1,N,L,0)!==h.check?-3:K(C,N,L,L)?(h.mode=31,-4):(h.havedict=1,g):d},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,i,r){var a=n("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(u,p,g,d,m,_,b,y){var v,S,D,k,F,M,X,$,G,K=y.bits,C=0,N=0,h=0,L=0,J=0,j=0,at=0,U=0,Q=0,A=0,I=null,et=0,q=new a.Buf16(16),W=new a.Buf16(16),vt=null,At=0;for(C=0;C<=15;C++)q[C]=0;for(N=0;N<d;N++)q[p[g+N]]++;for(J=K,L=15;1<=L&&q[L]===0;L--);if(L<J&&(J=L),L===0)return m[_++]=20971520,m[_++]=20971520,y.bits=1,0;for(h=1;h<L&&q[h]===0;h++);for(J<h&&(J=h),C=U=1;C<=15;C++)if(U<<=1,(U-=q[C])<0)return-1;if(0<U&&(u===0||L!==1))return-1;for(W[1]=0,C=1;C<15;C++)W[C+1]=W[C]+q[C];for(N=0;N<d;N++)p[g+N]!==0&&(b[W[p[g+N]]++]=N);if(M=u===0?(I=vt=b,19):u===1?(I=s,et-=257,vt=o,At-=257,256):(I=c,vt=l,-1),C=h,F=_,at=N=A=0,D=-1,k=(Q=1<<(j=J))-1,u===1&&852<Q||u===2&&592<Q)return 1;for(;;){for(X=C-at,G=b[N]<M?($=0,b[N]):b[N]>M?($=vt[At+b[N]],I[et+b[N]]):($=96,0),v=1<<C-at,h=S=1<<j;m[F+(A>>at)+(S-=v)]=X<<24|$<<16|G|0,S!==0;);for(v=1<<C-1;A&v;)v>>=1;if(v!==0?(A&=v-1,A+=v):A=0,N++,--q[C]==0){if(C===L)break;C=p[g+b[N]]}if(J<C&&(A&k)!==D){for(at===0&&(at=J),F+=h,U=1<<(j=C-at);j+at<L&&!((U-=q[j+at])<=0);)j++,U<<=1;if(Q+=1<<j,u===1&&852<Q||u===2&&592<Q)return 1;m[D=A&k]=J<<24|j<<16|F-_|0}}return A!==0&&(m[F+A]=C-at<<24|64<<16|0),y.bits=J,0}},{"../utils/common":41}],51:[function(n,i,r){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,i,r){var a=n("../utils/common"),s=0,o=1;function c(E){for(var T=E.length;0<=--T;)E[T]=0}var l=0,u=29,p=256,g=p+1+u,d=30,m=19,_=2*g+1,b=15,y=16,v=7,S=256,D=16,k=17,F=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(g+2));c(K);var C=new Array(2*d);c(C);var N=new Array(512);c(N);var h=new Array(256);c(h);var L=new Array(u);c(L);var J,j,at,U=new Array(d);function Q(E,T,H,z,x){this.static_tree=E,this.extra_bits=T,this.extra_base=H,this.elems=z,this.max_length=x,this.has_stree=E&&E.length}function A(E,T){this.dyn_tree=E,this.max_code=0,this.stat_desc=T}function I(E){return E<256?N[E]:N[256+(E>>>7)]}function et(E,T){E.pending_buf[E.pending++]=255&T,E.pending_buf[E.pending++]=T>>>8&255}function q(E,T,H){E.bi_valid>y-H?(E.bi_buf|=T<<E.bi_valid&65535,et(E,E.bi_buf),E.bi_buf=T>>y-E.bi_valid,E.bi_valid+=H-y):(E.bi_buf|=T<<E.bi_valid&65535,E.bi_valid+=H)}function W(E,T,H){q(E,H[2*T],H[2*T+1])}function vt(E,T){for(var H=0;H|=1&E,E>>>=1,H<<=1,0<--T;);return H>>>1}function At(E,T,H){var z,x,Y=new Array(b+1),Z=0;for(z=1;z<=b;z++)Y[z]=Z=Z+H[z-1]<<1;for(x=0;x<=T;x++){var V=E[2*x+1];V!==0&&(E[2*x]=vt(Y[V]++,V))}}function st(E){var T;for(T=0;T<g;T++)E.dyn_ltree[2*T]=0;for(T=0;T<d;T++)E.dyn_dtree[2*T]=0;for(T=0;T<m;T++)E.bl_tree[2*T]=0;E.dyn_ltree[2*S]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function ft(E){8<E.bi_valid?et(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function Tt(E,T,H,z){var x=2*T,Y=2*H;return E[x]<E[Y]||E[x]===E[Y]&&z[T]<=z[H]}function Et(E,T,H){for(var z=E.heap[H],x=H<<1;x<=E.heap_len&&(x<E.heap_len&&Tt(T,E.heap[x+1],E.heap[x],E.depth)&&x++,!Tt(T,z,E.heap[x],E.depth));)E.heap[H]=E.heap[x],H=x,x<<=1;E.heap[H]=z}function fe(E,T,H){var z,x,Y,Z,V=0;if(E.last_lit!==0)for(;z=E.pending_buf[E.d_buf+2*V]<<8|E.pending_buf[E.d_buf+2*V+1],x=E.pending_buf[E.l_buf+V],V++,z===0?W(E,x,T):(W(E,(Y=h[x])+p+1,T),(Z=M[Y])!==0&&q(E,x-=L[Y],Z),W(E,Y=I(--z),H),(Z=X[Y])!==0&&q(E,z-=U[Y],Z)),V<E.last_lit;);W(E,S,T)}function ne(E,T){var H,z,x,Y=T.dyn_tree,Z=T.stat_desc.static_tree,V=T.stat_desc.has_stree,tt=T.stat_desc.elems,_t=-1;for(E.heap_len=0,E.heap_max=_,H=0;H<tt;H++)Y[2*H]!==0?(E.heap[++E.heap_len]=_t=H,E.depth[H]=0):Y[2*H+1]=0;for(;E.heap_len<2;)Y[2*(x=E.heap[++E.heap_len]=_t<2?++_t:0)]=1,E.depth[x]=0,E.opt_len--,V&&(E.static_len-=Z[2*x+1]);for(T.max_code=_t,H=E.heap_len>>1;1<=H;H--)Et(E,Y,H);for(x=tt;H=E.heap[1],E.heap[1]=E.heap[E.heap_len--],Et(E,Y,1),z=E.heap[1],E.heap[--E.heap_max]=H,E.heap[--E.heap_max]=z,Y[2*x]=Y[2*H]+Y[2*z],E.depth[x]=(E.depth[H]>=E.depth[z]?E.depth[H]:E.depth[z])+1,Y[2*H+1]=Y[2*z+1]=x,E.heap[1]=x++,Et(E,Y,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],function(lt,qt){var Rn,me,In,wt,Wn,Gi,ve=qt.dyn_tree,xr=qt.max_code,Bc=qt.stat_desc.static_tree,$c=qt.stat_desc.has_stree,Nc=qt.stat_desc.extra_bits,Rr=qt.stat_desc.extra_base,An=qt.stat_desc.max_length,qn=0;for(wt=0;wt<=b;wt++)lt.bl_count[wt]=0;for(ve[2*lt.heap[lt.heap_max]+1]=0,Rn=lt.heap_max+1;Rn<_;Rn++)An<(wt=ve[2*ve[2*(me=lt.heap[Rn])+1]+1]+1)&&(wt=An,qn++),ve[2*me+1]=wt,xr<me||(lt.bl_count[wt]++,Wn=0,Rr<=me&&(Wn=Nc[me-Rr]),Gi=ve[2*me],lt.opt_len+=Gi*(wt+Wn),$c&&(lt.static_len+=Gi*(Bc[2*me+1]+Wn)));if(qn!==0){do{for(wt=An-1;lt.bl_count[wt]===0;)wt--;lt.bl_count[wt]--,lt.bl_count[wt+1]+=2,lt.bl_count[An]--,qn-=2}while(0<qn);for(wt=An;wt!==0;wt--)for(me=lt.bl_count[wt];me!==0;)xr<(In=lt.heap[--Rn])||(ve[2*In+1]!==wt&&(lt.opt_len+=(wt-ve[2*In+1])*ve[2*In],ve[2*In+1]=wt),me--)}}(E,T),At(Y,_t,E.bl_count)}function f(E,T,H){var z,x,Y=-1,Z=T[1],V=0,tt=7,_t=4;for(Z===0&&(tt=138,_t=3),T[2*(H+1)+1]=65535,z=0;z<=H;z++)x=Z,Z=T[2*(z+1)+1],++V<tt&&x===Z||(V<_t?E.bl_tree[2*x]+=V:x!==0?(x!==Y&&E.bl_tree[2*x]++,E.bl_tree[2*D]++):V<=10?E.bl_tree[2*k]++:E.bl_tree[2*F]++,Y=x,_t=(V=0)===Z?(tt=138,3):x===Z?(tt=6,3):(tt=7,4))}function P(E,T,H){var z,x,Y=-1,Z=T[1],V=0,tt=7,_t=4;for(Z===0&&(tt=138,_t=3),z=0;z<=H;z++)if(x=Z,Z=T[2*(z+1)+1],!(++V<tt&&x===Z)){if(V<_t)for(;W(E,x,E.bl_tree),--V!=0;);else x!==0?(x!==Y&&(W(E,x,E.bl_tree),V--),W(E,D,E.bl_tree),q(E,V-3,2)):V<=10?(W(E,k,E.bl_tree),q(E,V-3,3)):(W(E,F,E.bl_tree),q(E,V-11,7));Y=x,_t=(V=0)===Z?(tt=138,3):x===Z?(tt=6,3):(tt=7,4)}}c(U);var B=!1;function w(E,T,H,z){q(E,(l<<1)+(z?1:0),3),function(x,Y,Z,V){ft(x),V&&(et(x,Z),et(x,~Z)),a.arraySet(x.pending_buf,x.window,Y,Z,x.pending),x.pending+=Z}(E,T,H,!0)}r._tr_init=function(E){B||(function(){var T,H,z,x,Y,Z=new Array(b+1);for(x=z=0;x<u-1;x++)for(L[x]=z,T=0;T<1<<M[x];T++)h[z++]=x;for(h[z-1]=x,x=Y=0;x<16;x++)for(U[x]=Y,T=0;T<1<<X[x];T++)N[Y++]=x;for(Y>>=7;x<d;x++)for(U[x]=Y<<7,T=0;T<1<<X[x]-7;T++)N[256+Y++]=x;for(H=0;H<=b;H++)Z[H]=0;for(T=0;T<=143;)K[2*T+1]=8,T++,Z[8]++;for(;T<=255;)K[2*T+1]=9,T++,Z[9]++;for(;T<=279;)K[2*T+1]=7,T++,Z[7]++;for(;T<=287;)K[2*T+1]=8,T++,Z[8]++;for(At(K,g+1,Z),T=0;T<d;T++)C[2*T+1]=5,C[2*T]=vt(T,5);J=new Q(K,M,p+1,g,b),j=new Q(C,X,0,d,b),at=new Q(new Array(0),$,0,m,v)}(),B=!0),E.l_desc=new A(E.dyn_ltree,J),E.d_desc=new A(E.dyn_dtree,j),E.bl_desc=new A(E.bl_tree,at),E.bi_buf=0,E.bi_valid=0,st(E)},r._tr_stored_block=w,r._tr_flush_block=function(E,T,H,z){var x,Y,Z=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=function(V){var tt,_t=4093624447;for(tt=0;tt<=31;tt++,_t>>>=1)if(1&_t&&V.dyn_ltree[2*tt]!==0)return s;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return o;for(tt=32;tt<p;tt++)if(V.dyn_ltree[2*tt]!==0)return o;return s}(E)),ne(E,E.l_desc),ne(E,E.d_desc),Z=function(V){var tt;for(f(V,V.dyn_ltree,V.l_desc.max_code),f(V,V.dyn_dtree,V.d_desc.max_code),ne(V,V.bl_desc),tt=m-1;3<=tt&&V.bl_tree[2*G[tt]+1]===0;tt--);return V.opt_len+=3*(tt+1)+5+5+4,tt}(E),x=E.opt_len+3+7>>>3,(Y=E.static_len+3+7>>>3)<=x&&(x=Y)):x=Y=H+5,H+4<=x&&T!==-1?w(E,T,H,z):E.strategy===4||Y===x?(q(E,2+(z?1:0),3),fe(E,K,C)):(q(E,4+(z?1:0),3),function(V,tt,_t,lt){var qt;for(q(V,tt-257,5),q(V,_t-1,5),q(V,lt-4,4),qt=0;qt<lt;qt++)q(V,V.bl_tree[2*G[qt]+1],3);P(V,V.dyn_ltree,tt-1),P(V,V.dyn_dtree,_t-1)}(E,E.l_desc.max_code+1,E.d_desc.max_code+1,Z+1),fe(E,E.dyn_ltree,E.dyn_dtree)),st(E),z&&ft(E)},r._tr_tally=function(E,T,H){return E.pending_buf[E.d_buf+2*E.last_lit]=T>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&T,E.pending_buf[E.l_buf+E.last_lit]=255&H,E.last_lit++,T===0?E.dyn_ltree[2*H]++:(E.matches++,T--,E.dyn_ltree[2*(h[H]+p+1)]++,E.dyn_dtree[2*I(T)]++),E.last_lit===E.lit_bufsize-1},r._tr_align=function(E){q(E,2,3),W(E,S,K),function(T){T.bi_valid===16?(et(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(E)}},{"../utils/common":41}],53:[function(n,i,r){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,i,r){(function(a){(function(s,o){if(!s.setImmediate){var c,l,u,p,g=1,d={},m=!1,_=s.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(s);b=b&&b.setTimeout?b:s,c={}.toString.call(s.process)==="[object process]"?function(D){process.nextTick(function(){v(D)})}:function(){if(s.postMessage&&!s.importScripts){var D=!0,k=s.onmessage;return s.onmessage=function(){D=!1},s.postMessage("","*"),s.onmessage=k,D}}()?(p="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",S,!1):s.attachEvent("onmessage",S),function(D){s.postMessage(p+D,"*")}):s.MessageChannel?((u=new MessageChannel).port1.onmessage=function(D){v(D.data)},function(D){u.port2.postMessage(D)}):_&&"onreadystatechange"in _.createElement("script")?(l=_.documentElement,function(D){var k=_.createElement("script");k.onreadystatechange=function(){v(D),k.onreadystatechange=null,l.removeChild(k),k=null},l.appendChild(k)}):function(D){setTimeout(v,0,D)},b.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var k=new Array(arguments.length-1),F=0;F<k.length;F++)k[F]=arguments[F+1];var M={callback:D,args:k};return d[g]=M,c(g),g++},b.clearImmediate=y}function y(D){delete d[D]}function v(D){if(m)setTimeout(v,0,D);else{var k=d[D];if(k){m=!0;try{(function(F){var M=F.callback,X=F.args;switch(X.length){case 0:M();break;case 1:M(X[0]);break;case 2:M(X[0],X[1]);break;case 3:M(X[0],X[1],X[2]);break;default:M.apply(o,X)}})(k)}finally{y(D),m=!1}}}}function S(D){D.source===s&&typeof D.data=="string"&&D.data.indexOf(p)===0&&v(+D.data.slice(p.length))}})(typeof self=="undefined"?a===void 0?this:a:self)}).call(this,typeof ii!="undefined"?ii:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(xc);var wf=xc.exports;const Sf=async t=>await wf.loadAsync(t),ae=()=>"[main]";var ke=async t=>{var e;try{console.time("loading time"),ti.enable(!1);let n;if(t.file)n=t.file;else if(t.link)n=await vf($s(decodeURI(t.link)));else if(t.id)n=await Lc(Ns(decodeURI(t.id)));else if(t.hash&&As(decodeURI(t.hash).trim()))n=await Ef(decodeURI(t.hash).trim());else throw new Error("Could not search for file.");bt.status("info","Extracting zip",0),Ot.switchHeader(!1);const i=await Sf(n);ti.enable(!1),bt.status("info","Parsing map info...",0),nt.info(ae(),"Parsing map info");const r=await gf(i);rt.beatmapInfo=r,jn.setInfo(r),bt.status("info","Loading image...",10.4375),nt.info(ae(),"Loading cover image");let a=i.file(r._coverImageFilename);if(it.load.imageCover&&a){let o=await a.async("base64");Ot.setCoverImage("data:image;base64,"+o),gn.loading.coverImage=!0}else nt.error(ae(),`${r._coverImageFilename} does not exists.`);if(rt.contributors=[],(e=r==null?void 0:r._customData)!=null&&e._contributors)for(const o of r._customData._contributors){nt.info(ae(),"Loading contributor image "+o._name),a=i.file(o._iconPath);let c=null;it.load.imageContributor&&a?c=await a.async("base64"):nt.error(ae(),`${o._iconPath} does not exists.`),rt.contributors.push(Jn(Zn({},o),{_base64:c}))}bt.status("info","Loading audio...",20.875),nt.info(ae(),"Loading audio");let s=i.file(r._songFilename);if(it.load.audio&&s){let o=!1;setTimeout(()=>{o||bt.status("info","Loading audio... (this may take a while)",20.875)},1e4);let c=await s.async("arraybuffer");Ot.setAudio(c),await new AudioContext().decodeAudioData(c).then(u=>{o=!0;let p=u.duration;rt.duration=p,Ot.setSongDuration(p),gn.loading.audio=!0}).catch(function(u){Ot.setSongDuration(),nt.error(ae(),u)})}else Ot.setSongDuration(),nt.error(ae(),`${r._songFilename} does not exist.`);bt.status("info","Parsing difficulty...",70),rt.beatmapDifficulty=await _f(r,i),pn.adjustTime(),bt.status("info","Adding map difficulty stats...",80),nt.info(ae(),"Adding map stats"),Dc.populate(),jn.populateContributors(rt.contributors),bt.status("info","Analysing map...",85),nt.info(ae(),"Analysing map"),Sn.runGeneral(),pn.displayOutputGeneral(),bt.status("info","Analysing difficulty...",90),Sn.applyAll(),pn.populateSelect(r),pn.displayOutputDifficulty(),ti.enable(!0),bt.status("info","Map successfully loaded!"),console.timeEnd("loading time")}catch(n){bt.status("error",n,100),nt.error(ae(),n),rt.clear(),ti.enable(!0),Ot.switchHeader(!0)}};const xn="UI Intro: ",On=document.querySelector(".input__intro-url"),Pn=document.querySelector(".input__intro-id"),Fn=document.querySelector(".input__intro-hash"),Cs=document.querySelector(".input__search-button"),ks=document.querySelector(".input__file"),Zi=document.querySelector(".input__file-zone");if(On)On.addEventListener("keydown",Cr);else throw new Error(xn+"URL input is missing");if(Pn)Pn.addEventListener("keydown",Cr);else throw new Error(xn+"ID input is missing");if(Fn)Fn.addEventListener("keydown",Cr);else throw new Error(xn+"Hash input is missing");if(Cs)Cs.addEventListener("click",Cf);else throw new Error(xn+"search button is missing");if(ks)ks.addEventListener("change",kf);else throw new Error(xn+"file input is missing");if(Zi)Zi.addEventListener("drop",Df),Zi.addEventListener("dragover",Tf);else throw new Error(xn+"file drop zone is missing");function Cr(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&ke({link:e.value}),e.classList.contains("input__intro-id")&&ke({id:e.value}),e.classList.contains("input__intro-hash")&&ke({hash:e.value}))}function Cf(t){if(On&&On.value!==""){ke({link:On.value});return}if(Pn&&Pn.value!==""){ke({id:Pn.value});return}if(Fn&&Fn.value!==""){ke({hash:Fn.value});return}}function kf(t){const e=t.target;bt.status("info","Reading file input",0);const n=e.files?e.files[0]:null;try{if(n==null)throw bt.status("info","No file input",0),new Error("No file input");if(n&&(n.name.substr(-4)===".zip"||n.name.substr(-4)===".bsl")){const i=new FileReader;i.readAsArrayBuffer(n),i.addEventListener("load",()=>{ke({file:n})})}else throw new Error("Unsupported file format, please enter zip file")}catch(i){bt.status("error",i,0),console.error(i)}}function Df(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items&&t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(e),n.addEventListener("load",()=>{ke({file:e})})}else throw new Error("Unsupported file format, please enter zip file")}}catch(e){bt.status("error",e,0),console.error(e)}}function Tf(t){t.preventDefault(),t.stopPropagation()}const Lf=document.querySelector("body"),xf=["Dark","Light","Monochrome"];var kr={list:xf,set:t=>{Lf.className="theme-"+t.toLowerCase().replace(" ","")}};const Je="UI Settings: ",ci=document.querySelector(".settings__theme"),Ba=document.querySelector(".settings__beat-numbering"),$a=document.querySelector(".settings__rounding"),Dr=document.querySelectorAll(".settings__load"),Hi=document.querySelector(".settings__sort"),Tr=document.querySelectorAll(".settings__show"),Lr=document.querySelectorAll(".settings__onload"),Ds=document.querySelector(".settings__clear-button");if(ci)ci.addEventListener("change",Rf),kr.list.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,ci.add(e)});else throw new Error(Je+"theme select is missing");if(Ba)Ba.addEventListener("change",If);else throw new Error(Je+"missing settings");if($a)$a.addEventListener("change",Af);else throw new Error(Je+"missing settings");Dr.length||console.error(Je+"empty load list, intentional or typo error?");Dr.forEach(t=>t.addEventListener("change",Of));if(Hi)Hi.addEventListener("change",Nf);else throw new Error(Je+"sort check is missing");Lr.length||console.error(Je+"empty onload list, intentional or typo error?");Lr.forEach(t=>t.addEventListener("change",Ff));Tr.length||console.error(Je+"empty show list, intentional or typo error?");Tr.forEach(t=>t.addEventListener("change",Bf));if(Ds)Ds.addEventListener("click",Rc);else throw new Error(Je+"clear button is missing");function Rf(t){const e=t.target;it.theme=e.options[e.options.selectedIndex].value,kr.set(it.theme),it.save()}function If(t){const e=t.target;it.beatNumbering=e.options[e.options.selectedIndex].value,it.save()}function Af(t){const e=t.target;it.rounding=parseInt(e.value),it.save()}function Bf(t){const e=t.target,n=e.id.replace("settings__show-","");it.show[n]=e.checked,it.save()}const $f=(t,e)=>{Tr.forEach(n=>{n.id.endsWith(t)&&(n.checked=e)})};function Nf(t){const e=t.target;it.sorting=e.checked,it.save()}const Mf=t=>{Hi&&(Hi.checked=t)};function Of(t){const e=t.target,n=e.name;it.load[n]=e.checked,it.save()}const Pf=(t,e)=>{Dr.forEach(n=>{n.name===t&&(n.checked=e)})};function Ff(t){const e=t.target,n=e.name;it.onLoad[n]=e.checked,it.save()}const Hf=(t,e)=>{Lr.forEach(n=>{n.name===t&&(n.checked=e)})},jf=t=>{ci.value=t},zf=t=>{Ba.value=t},Xf=t=>{$a.value=t.toString()};function Rc(){it.clear(),it.reset(),location.reload()}var Qe={setShowCheck:$f,setSortCheck:Mf,setLoadCheck:Pf,setOnLoadCheck:Hf,setTheme:jf,setBeatNumbering:zf,setRounding:Xf,clear:Rc};const Uf=document.querySelectorAll(".input__reset-button");Uf.forEach(t=>t.addEventListener("click",Gf));function Gf(){bt.reset(),Ot.reset(),jn.reset(),pn.reset(),Dc.reset(),rt.clear()}const Yf=2,Vf=5,Wf=0,qf="Kival Evan#5480";var Ts=new class{constructor(){this._version=`pre-${Yf}.${Vf}.${Wf}-3`,this._wm=qf}get value(){return this._version}get watermark(){return this._wm}};const Zf="UI Footer: ",Ic=document.querySelectorAll(".link__watermark"),Ac=document.querySelectorAll(".link__version");(!Ic.length||!Ac.length)&&console.error(Zf+"missing part");var Ls={setWatermark:t=>{Ic.forEach(e=>e.textContent=t)},setVersion:t=>{Ac.forEach(e=>e.textContent=t)}},Jf=function(){let t=!1;return function(){if(!t){t=!0,Ls.setWatermark(Ts.watermark),Ls.setVersion(Ts.value),pn.populateTool(),Qe.setTheme(it.theme),Qe.setBeatNumbering(it.beatNumbering),Qe.setRounding(it.rounding),console.log(it.theme,it.beatNumbering,it.rounding);for(const e in it.load)Qe.setLoadCheck(e,it.load[e]);Qe.setSortCheck(it.sorting);for(const e in it.show)Is.show(e,it.show[e]),Qe.setShowCheck(e,it.show[e]);for(const e in it.onLoad)Qe.setOnLoadCheck(e,it.onLoad[e]);kr.set(it.theme),nt.info("User interface initialised")}}}();(function(){Jf();const t=new URL(location.href),e=t.searchParams.get("url"),n=t.searchParams.get("id"),i=t.searchParams.get("hash");(n||e||i)&&ke({link:e,id:n,hash:i})})();
