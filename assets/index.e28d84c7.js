var Dc=Object.defineProperty,Tc=Object.defineProperties;var Lc=Object.getOwnPropertyDescriptors;var fr=Object.getOwnPropertySymbols;var Rc=Object.prototype.hasOwnProperty,Ac=Object.prototype.propertyIsEnumerable;var mr=(t,e,i)=>e in t?Dc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,qi=(t,e)=>{for(var i in e||(e={}))Rc.call(e,i)&&mr(t,i,e[i]);if(fr)for(var i of fr(e))Ac.call(e,i)&&mr(t,i,e[i]);return t},Zi=(t,e)=>Tc(t,Lc(e));const Bc=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}};Bc();var hs=(t=>(t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy",t))(hs||{});const Ic="UI Accordion: ",Ji="accordion__",ds=document.querySelectorAll(".accordion__button");ds.length||console.error(Ic+"empty accordion list, intentional or typo error?");var fs={create:(t,e,i,n=!1)=>{const r=document.createElement("div");r.className="accordion";const a=document.createElement("input");a.className=Ji+"button",a.id=t,a.setAttribute("type","checkbox");const s=document.createElement("label");s.className=Ji+"label unselectable",s.htmlFor=t,s.textContent=e,i&&s.classList.add(hs[i]);const o=document.createElement("div");return o.className=n?Ji+"collapsible-flex":Ji+"collapsible",o.id=t+"-content",r.appendChild(a),r.appendChild(s),r.appendChild(o),r},show:(t,e)=>{ds.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}};const pr=new Map([[0,"VERBOSE"],[1,"DEBUG"],[2,"INFO"],[3,"WARN"],[4,"!!ERROR!!"],[5,"NONE"]]);var et=new class{constructor(){this.logLevel=2}log(e,...i){if(e<this.logLevel)return;const n=[pr.get(e),">",...i];switch(e){case 1:return console.debug(...n);case 2:return console.info(...n);case 3:return console.warn(...n);case 4:return console.error(...n);default:return console.log(...n)}}setLevel(e){e=Math.min(e,5),this.logLevel=e,this.info("[logger::setLevel]",`Log level set to ${pr.get(e)}`)}verbose(...e){this.log(0,...e)}debug(...e){this.log(1,...e)}info(...e){this.log(2,...e)}warn(...e){this.log(3,...e)}error(...e){this.log(4,...e)}};function $c(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function P(t,e=0){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function Zn(t){return t*(180/Math.PI)}function li(t){return t*(Math.PI/180)}function gr(t,e){e<0&&(e=-e);const i=t%e;return i<0?i+e:i}function _r(t,e,i){return Math.min(gr(t-e,i),gr(e-t,i))}function Vn(t){if(t.length===0)return 0;t.sort((i,n)=>i-n);const e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2}function Nc(t,e,i){return Math.min(Math.max(e,t),i)}function dn(t){return[t.r,t.g,t.b]}function Ki(t){const e=t.toString(16);return e.length===1?"0"+e:e}function Mc(t){return t>1&&!(t<0)?255:P(t*255)}function Dt(t){if(!t)return null;const e={r:0,g:0,b:0};for(const i in t){const n=t[i];n!==void 0&&(e[i]=Mc(n))}return`#${Ki(e.r)}${Ki(e.g)}${Ki(e.b)}${e.a?Ki(e.a):""}`}function br(t){let e=t[0],i=t[1],n=t[2],r,a,s;return e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=(e*.4124+i*.3576+n*.1805)/.95047,a=(e*.2126+i*.7152+n*.0722)/1,s=(e*.0193+i*.1192+n*.9505)/1.08883,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,[116*a-16,500*(r-a),200*(a-s)]}function yr(t,e){let i=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(i=0),t<0&&(i=180),t>0&&e<0&&(i=360),Zn(Math.atan(e/t))+i)}function Jn(t,e){const[i,n,r]=br(t),[a,s,o]=br(e),c=1,l=1,u=1;let p,g,d,m,_,b,y,v,S,C,x,F,M,H,$,U,K,k,N,h;return p=Math.sqrt(n*n+r*r),g=Math.sqrt(s*s+o*o),d=(p+g)/2,_=.5*(1-Math.sqrt((d^7)/((d^7)+30))),S=(1+_)*n,p=Math.sqrt(S*S+r*r),b=yr(S,r),S=(1+_)*s,g=Math.sqrt(S*S+o*o),y=yr(S,o),k=a-i,N=g-p,p*g==0?h=0:(S=P(y-b,12),Math.abs(S)<=180?h=y-b:S>180?h=y-b-360:h=y-b+360),h=2*Math.sqrt(p*g)*Math.sin(li(h/2)),C=(i+a)/2,m=(p+g)/2,p*g==0?v=b+y:(S=Math.abs(P(b-y,12)),S>180?y+b<360?v=b+y+360:v=b+y-360:v=b+y,v/=2),x=1-.17*Math.cos(li(v-30))+.24*Math.cos(li(2*v))+.32*Math.cos(li(3*v+6))-.2*Math.cos(li(4*v-63)),$=30*Math.exp(-((v-275)/25)*((v-275)/25)),U=2*Math.sqrt((m^7)/((m^7)+30)),F=1+.015*((C-50)*(C-50))/Math.sqrt(20+(C-50)*(C-50)),M=1+.045*m,H=1+.015*m*x,K=-Math.sin(li(2*$))*U,k=k/(c*F),N=N/(l*M),h=h/(u*H),Math.sqrt(k*k+N*N+h*h+K*N*h)}const Pc=t=>`[utils::misc::${t}]`;function xt(t){return typeof t!="object"&&et.error(Pc("deepCopy"),"Received non-object type"),JSON.parse(JSON.stringify(t))}function ms(t){return/[a-fA-F0-9]*/g.test(t)}function kt(t){if(!t)return"0:00";const e=Math.floor(t),i=e/60,n=i<0?`-${Math.ceil(i).toString()}`:Math.floor(i).toString(),r=Math.abs(e%60).toString().padStart(2,"0");return`${n}:${r}`}function Oc(t){if(!t)return"0:00:00";const e=Math.round(t*60%60).toString().padStart(2,"0");return`${kt(t)}:${e}`}function rn(t){var i;if(!t)return"0:00.000";const e=((i=(t%1).toString().split(".")[1])==null?void 0:i.padEnd(3,"0").slice(0,3))||"000";return`${kt(t)}.${e}`}function ps(t){const e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")}function gs(t){const e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")}function Kn(t){for(let e=t.options.length-1;e>=0;e--)t.remove(e)}const Ia="UI Header: ",Qn=document.querySelector(".intro"),ta=document.querySelector(".metadata"),Ke=document.querySelector(".cover__link"),$a=document.querySelector(".cover__image"),_s=document.querySelector(".metadata__song-name"),bs=document.querySelector(".metadata__song-subname"),ys=document.querySelector(".metadata__song-author"),vs=document.querySelector(".metadata__song-bpm"),ea=document.querySelector(".metadata__song-duration"),Es=document.querySelector(".audio");if(!Qn||!ta)throw new Error(Ia+"header component is missing one of the two section");if(!Ke||!$a)throw new Error(Ia+"cover component is missing");if(!_s||!bs||!ys||!vs||!ea)throw new Error(Ia+"metadata component is missing one of the part");function ws(t){t?(Qn.classList.remove("hidden"),ta.classList.add("hidden")):(Qn.classList.add("hidden"),ta.classList.remove("hidden"))}function Ss(t){$a.src=t||"./img/unknown.jpg"}function Fc(){return $a.src}function ks(t,e){if(t==null&&e==null){Ke.textContent="",Ke.href="",Ke.classList.add("disabled");return}t!=null&&(Ke.textContent=e!=null?e:"Download Link",Ke.href=t,Ke.classList.remove("disabled"))}function zc(t){_s.textContent=t}function Xc(t){bs.textContent=t}function jc(t){ys.textContent=t}function Hc(t,e,i){let n=P(t,2).toString()+"BPM";vs.textContent=n}function xs(t){t?ea.textContent=rn(t):ea.textContent="No audio"}async function Yc(t){const e=new Blob([t],{type:"audio/ogg"});Es.src=window.URL.createObjectURL(e)}function Cs(){Es.src="",window.URL.revokeObjectURL("")}function Uc(){ws(!0),Ss(null),ks(),xs(0),Cs()}var Nt={switchHeader:ws,setCoverImage:Ss,getCoverImage:Fc,setCoverLink:ks,setSongName:zc,setSongSubname:Xc,setSongAuthor:jc,setSongBPM:Hc,setSongDuration:xs,setAudio:Yc,unloadAudio:Cs,reset:Uc},fi=new class{constructor(){this.loading={info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1}}resetLoad(){this.loading.info=!1,this.loading.difficulty=!1,this.loading.analysis=!1,this.loading.audio=!1,this.loading.coverImage=!1,this.loading.contributorImage=!1,this.loading.finished=!1}},rt=new class{constructor(){this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}retrieveSafe(){if(!this.beatmapInfo)throw new Error("Beatmap info is not loaded.");if(!this.analysis)throw new Error("Beatmap analysis is not loaded.");if(this.duration===null)throw new Error("Audio is not loaded.");if(fi.loading.finished)return{beatmapInfo:this.beatmapInfo,beatmapDifficulty:this.beatmapDifficulty,contributors:this.contributors,analysis:this.analysis,duration:this.duration};throw new Error("Could not retrieve saved data, loading process is not finished.")}clear(){fi.loading.finished=!1,this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}};const Ds=class{constructor(t,e=[],i=0){this._bpm=t,this._offset=i/1e3,this._bpmChange=this.getBPMChangeTime([...e])}get value(){return this._bpm}set value(t){this._bpm=t}get change(){return this._bpmChange}set change(t){this._bpmChange=this.getBPMChangeTime([...t])}get offset(){return this._offset*1e3}set offset(t){this._offset=t/1e3}getBPMChangeTime(t=[]){var n;let e;const i=[];for(let r=0;r<t.length;r++){const a={_BPM:(n=t[r]._BPM)!=null?n:t[r]._bpm,_time:t[r]._time,_beatsPerBar:t[r]._beatsPerBar,_metronomeOffset:t[r]._metronomeOffset,_newTime:0};e?a._newTime=Math.ceil((a._time-e._time)/this._bpm*e._BPM+e._newTime-.01):a._newTime=Math.ceil(a._time-this._offset*this._bpm/60-.01),i.push(a),e=a}return i}offsetBegone(t){return(this.toRealTime(t)-this._offset)*this._bpm/60}toRealTime(t){return t/this._bpm*60}toBeatTime(t){return t*this._bpm/60}toJSONTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e]._newTime)return(t-this._bpmChange[e]._newTime)/this._bpmChange[e]._BPM*this._bpm+this._bpmChange[e]._time;return(this.toRealTime(t)+this._offset)*this._bpm/60}adjustTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e]._time)return(t-this._bpmChange[e]._time)/this._bpm*this._bpmChange[e]._BPM+this._bpmChange[e]._newTime;return this.offsetBegone(t)}};let me=Ds;me.create=(t,e,i)=>new Ds(t,e,i);var Na=(t=>(t.Standard="Standard",t.NoArrows="No Arrows",t.OneSaber="One Saber",t["360Degree"]="360 Degree",t["90Degree"]="90 Degree",t.Lightshow="Lightshow",t.Lawless="Lawless",t))(Na||{}),ia=(t=>(t[t.Standard=0]="Standard",t[t.NoArrows=1]="NoArrows",t[t.OneSaber=2]="OneSaber",t[t["360Degree"]=3]="360Degree",t[t["90Degree"]=4]="90Degree",t[t.Lightshow=5]="Lightshow",t[t.Lawless=6]="Lawless",t))(ia||{});const Ft={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",GlassDesertEnvironment:"Glass Desert"},Vc={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},zt={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.5320754,g:.5320754,b:.5320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"The Second":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8235294,g:.08627451,b:.8509804},_envColorRightBoost:{r:0,g:1,b:.6478302},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}},se=4,Vt={[0]:180,[1]:0,[2]:270,[3]:90,[4]:225,[5]:135,[6]:315,[7]:45,[8]:0},Gc={[0]:1,[1]:0,[2]:3,[3]:2,[4]:7,[5]:6,[6]:5,[7]:4,[8]:8},Re={[0]:[0,1],[1]:[0,-1],[2]:[-1,0],[3]:[1,0],[4]:[-1,1],[5]:[1,1],[6]:[-1,-1],[7]:[1,-1],[8]:[0,0]},Wc={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60};var Ts=(t=>(t[t.Easy=1]="Easy",t[t.Normal=3]="Normal",t[t.Hard=5]="Hard",t[t.Expert=7]="Expert",t[t.ExpertPlus=9]="ExpertPlus",t))(Ts||{}),Fi=(t=>(t.Easy="Easy",t.Normal="Normal",t.Hard="Hard",t.Expert="Expert",t.ExpertPlus="Expert+",t))(Fi||{});const qc={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",GlassDesertEnvironment:"Glass Desert",TheSecondEnvironment:"The Second"},Ae={DefaultEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,5,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,5,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,5,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,5,8,9,12,13],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],TheSecondEnvironment:[[0,1,2,3,4,9],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]]},ei=class{constructor(t,e=10,i=0){this._bpm=t,this._njs=e,this._sdm=i,this.update()}get value(){return this._njs}set value(t){this._njs=t,this.update()}get offset(){return this._sdm}set offset(t){this._sdm=t,this.update()}get hjd(){return this._hjd}get hjdMin(){return ei.HJD_MIN}get reactTime(){return this._reactionTime}get jd(){return this._jd}get jdMin(){return this._jdMin}update(){this._hjd=this.calcHJD(),this._jd=this.calcJD(),this._jdMin=this.calcJD(ei.HJD_MIN),this._reactionTime=this.calcRTFromHJD()}calcHJDRaw(){const e=this._njs*this._njs/this._njs,i=60/this._bpm.value;let n=ei.HJD_START;for(;e*i*n>17.999;)n/=2;return n<1&&(n=1),n}calcHJD(t=this.offset){return Math.max(this.calcHJDRaw()+t,ei.HJD_MIN)}calcHJDFromJD(t=this.calcJD()){return t/(60/this._bpm.value*this._njs*2)}calcHJDFromRT(t=this.calcRTFromHJD()){return t/(60/this._bpm.value)}calcJD(t=this.calcHJD()){return this._njs*(60/this._bpm.value)*t*2}calcJDOptimalHigh(){return 18*(1/1.07)**this._njs+18}calcJDOptimalLow(){return-(18/(this._njs+1))+18}calcRTFromJD(t=this.calcJD()){return t/(2*this._njs)}calcRTFromHJD(t=this.calcHJD()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let Be=ei;Be.HJD_START=4;Be.HJD_MIN=.25;Be.create=(t,e=10,i=0)=>typeof t=="number"?new ei(me.create(t),e,i):new ei(t,e,i);Be.FallbackNJS={ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10};function Zc(t,e){const i=vr(t),n=vr(e);for(const r in i){if(i[r]<n[r])return"old";if(i[r]>n[r])return"new"}return"current"}function vr(t){return t.replace("v","").split(".").map(e=>parseInt(e))}const jn="UI Info: ",na=document.querySelector(".info__version"),aa=document.querySelector(".info__time-spend"),ra=document.querySelector(".info__custom-color"),oa=document.querySelector(".info__requirements"),sa=document.querySelector(".info__suggestions"),la=document.querySelector(".info__information"),ca=document.querySelector(".info__warnings"),ua=document.querySelector(".info__bookmarks"),ha=document.querySelector(".info__bpm-changes"),da=document.querySelector(".info__environment-enhancement"),fa=document.querySelector(".info__point-definitions"),ma=document.querySelector(".info__custom-events");if(!na||!aa||!ra||!oa||!sa||!la||!ca||!ua||!ha||!da||!fa||!ma)throw new Error(jn+"table info component is missing part");const pa=document.querySelector(".info__level-author"),ga=document.querySelector(".info__environment"),on=document.querySelector(".info__editors"),sn=document.querySelector(".info__contributors"),fn=document.querySelector(".info__contributors-select"),Jc=document.querySelector(".info__contributors-image"),Ls=document.querySelector(".info__contributors-name"),Rs=document.querySelector(".info__contributors-role");if(!pa||!ga||!on)throw new Error(jn+"info component is missing part");if(!sn||!Ls||!Rs)throw new Error(jn+"contributors component is missing part");if(fn)fn.addEventListener("change",eu);else throw new Error(jn+"contributors select is missing");function As(t){if(!t){pa.textContent="";return}pa.textContent="Mapped by "+t}function Bs(t){if(!t){ga.textContent="";return}ga.textContent=(qc[t]||"Unknown")+" Environment"}function Is(t){if(!t||!t._lastEditedBy){on.classList.add("hidden");return}on.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let i="Last edited on "+e;if(t[e]){const n=t[e];i+=" v"+n.version}on.textContent=i}function Kc(t){Jc.src=t||"./img/unknown.jpg"}function Qc(t){Ls.textContent=t}function tu(t){Rs.textContent=t}function $s(t){Kc(t._base64?"data:image;base64,"+t._base64:null),Qc(t._name),tu(t._role)}function Ns(t){if(sn&&(!t||!t.length)){sn.classList.add("hidden"),Kn(fn);return}if(t){sn.classList.remove("hidden");let e=!0;t.forEach((i,n)=>{e&&(e=!1,$s(i));const r=document.createElement("option");r.value=n.toString(),r.text=i._name+" -- "+i._role,fn.add(r)})}}function eu(t){const e=t.target;$s(rt.contributors[parseInt(e.value)])}const Er={version:1,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",rounding:3,theme:"Dark",onLoad:{stats:!1},show:{info:!1,tools:!1,stats:!1,settings:!1}};var nt=new class{constructor(){this.property=xt(Er),this.stringify=()=>JSON.stringify({settings:this.property}),this.init=()=>{var i,n;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const r=JSON.parse(e);if(!((i=r.settings)!=null&&i.version)){this.clear();return}this.property=(n=r.settings)!=null?n:this.property,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this.property=xt(Er)},this.init()}get version(){return this.property.version}get load(){return this.property.load}get sorting(){return this.property.sorting}set sorting(e){this.property.sorting=e}get beatNumbering(){return this.property.beatNumbering}set beatNumbering(e){this.property.beatNumbering=e}get rounding(){return this.property.rounding}set rounding(e){this.property.rounding=e}get theme(){return this.property.theme}set theme(e){this.property.theme=e}get onLoad(){return this.property.onLoad}get show(){return this.property.show}};function qt(t){const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")}function Zt(t,e){const i=t.querySelector(".info__table-element");if(i){for(;i.firstChild;)i.removeChild(i.firstChild);typeof e=="string"?i.textContent=e:(e.forEach(n=>{if(typeof n=="string"){const r=document.createElement("span");r.textContent=n,i.appendChild(r),i.appendChild(document.createElement("br"))}else i.appendChild(n),i.appendChild(document.createElement("br"))}),i.lastChild&&i.removeChild(i.lastChild))}t.classList.remove("hidden")}function Ms(t,e){if(t==null||!t.length){qt(ua);return}const i=t.map((n,r)=>{let a=n._time,s;return typeof n._name!="string"?`Error parsing bookmarks[${r}]`:(e&&(a=e.adjustTime(a),s=e.toRealTime(a)),`${P(n._time,nt.rounding)}${s?" | "+kt(s):""} -- ${n._name!=""?n._name:"**EMPTY NAME**"}`)});Zt(ua,i)}function Ps(t){if(!t||!t.change.length){qt(ha);return}const e=t.change.map(i=>{const n=P(i._newTime,nt.rounding),r=t.toRealTime(i._time);return`${n} | ${kt(r)} -- ${i._BPM}`});Zt(ha,e)}var Os=(t=>(t.tiny="panel--tiny",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t.max="panel--max",t))(Os||{}),Fs=(t=>(t.normal="panel--offset",t.half="panel--offset-half",t.none="",t))(Fs||{}),ln={create:(t,e,i,n)=>{const r=document.createElement("div");return r.className=`panel ${Os[t]}`,e&&e!=="none"&&r.classList.add(Fs[e]),i&&r.classList.add("panel--flex"+n?"-column":""),r}};function zs(t,e){var c,l,u,p,g,d,m,_,b;if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._obstacleColor){qt(ra);return}e||(e="DefaultEnvironment");const i={_colorLeft:Dt((c=zt[Ft[e]])==null?void 0:c._colorLeft)||null,_colorRight:Dt((l=zt[Ft[e]])==null?void 0:l._colorRight)||null,_envColorLeft:Dt((u=zt[Ft[e]])==null?void 0:u._envColorLeft)||null,_envColorRight:Dt((p=zt[Ft[e]])==null?void 0:p._envColorRight)||null,_envColorLeftBoost:Dt((g=zt[Ft[e]])==null?void 0:g._envColorLeftBoost)||null,_envColorRightBoost:Dt((d=zt[Ft[e]])==null?void 0:d._envColorRightBoost)||null,_obstacleColor:Dt((m=zt[Ft[e]])==null?void 0:m._obstacleColor)||null};t._colorLeft&&(i._colorLeft=Dt(t._colorLeft)),t._colorRight&&(i._colorRight=Dt(t._colorRight)),t._envColorLeft?i._envColorLeft=Dt(t._envColorLeft):t._colorLeft&&(i._envColorLeft=Dt(t._colorLeft)),t._envColorRight?i._envColorRight=Dt(t._envColorRight):t._colorRight&&(i._envColorRight=Dt(t._colorRight));let n,r,a=!1;t._envColorLeftBoost?(n=Dt(t._envColorLeftBoost),a=!0):n=Dt((_=zt[Ft[e]])==null?void 0:_._envColorLeftBoost)||i._envColorLeft,t._envColorRightBoost?(r=Dt(t._envColorRightBoost),a=!0):r=Dt((b=zt[Ft[e]])==null?void 0:b._envColorRightBoost)||i._envColorRight,a&&(i._envColorLeftBoost=n,i._envColorRightBoost=r),t._obstacleColor&&(i._obstacleColor=Dt(t._obstacleColor));const s=ln.create("max","none",!0);for(const y in i){if(!i[y])continue;const v=document.createElement("div"),S=document.createElement("div"),C=document.createElement("div"),x=document.createElement("div");S.className="info__color-dot",S.style.backgroundColor=i[y]||"#000000",C.className="info__color-text info__color-text--monospace",C.textContent=`${i[y]}`,x.className="info__color-text",x.textContent=` -- ${Vc[y]}`,v.appendChild(S),v.appendChild(C),v.appendChild(x),s.appendChild(v)}Zt(ra,[s])}var Xs=(t=>(t.id="Ct",t.lookupMethod="Lm",t.duplicate="D",t.active="A",t.scale="S",t.position="P",t.localPosition="Lp",t.rotation="R",t.localRotation="Lr",t.lightID="Li",t.track="T",t))(Xs||{}),js=(t=>(t.childrenTracks="Ct",t.color="C",t.definitePosition="Dp",t.dissolve="D",t.dissolveArrow="Da",t.duration="Dur",t.easing="E",t.interactable="I",t.localRotation="Lr",t.parentTrack="Pt",t.position="P",t.rotation="R",t.scale="S",t.time="T",t.track="Tr",t.worldPositionStays="Wps",t))(js||{});function Hs(t,e){if(t==null||!t.length){qt(ma);return}const i=t.map((n,r)=>{let a=n.beat,s;e&&(a=e.adjustTime(a),s=e.toRealTime(a));const o=[];if(!n.data)return`Error parsing customEvents[${r}]`;for(const c in n.data){if(c=="_duration"||c=="_easing"||c=="_track"||c=="duration"||c=="easing"||c=="track")continue;const l=js[c];n.data[c]!=null&&o.push(l)}return`${P(n.beat,nt.rounding)}${s?" | "+kt(s):""} -- ${n.type} -> [${o.join("")}]${n.type!=="AssignTrackParent"?`(${n.data.track})`:""}`});Zt(ma,i)}function Ys(t){if(t==null||!t.length){qt(da);return}const e=t.map((i,n)=>{const r=[];if(!i.id)return`Error parsing environment[${n}]`;for(const a in i){if(a=="_lookupMethod"||a=="_id"||a=="lookupMethod"||a=="id")continue;const s=Xs[a];i[a]!=null&&r.push(s)}return`${i.lookupMethod} [${r.join("")}]${i.track?`(${i.track})`:""} -> ${i.id}`});Zt(da,e)}function _a(t){if(t==null){qt(na);return}Zt(na,t)}function Us(t){if(t==null){qt(aa);return}Zt(aa,Oc(t))}function Vs(t){if(t==null||!t.length){qt(oa);return}Zt(oa,t.join(", "))}function Gs(t){if(t==null||!t.length){qt(sa);return}Zt(sa,t.join(", "))}function Ws(t){if(t==null||!t.length){qt(la);return}Zt(la,t)}function qs(t){if(t==null||!t.length){qt(ca);return}Zt(ca,t)}function Zs(t){if(t==null||!t.length){qt(fa);return}const e=t.map((i,n)=>i.points?`${i.name} -- ${i.points.length} point${i.points.length>1?"s":""}`:`Error parsing pointDefinitions[${n}]`);Zt(fa,e)}function iu(t){var e;Nt.setSongName(t._songName),Nt.setSongSubname(t._songSubName),Nt.setSongAuthor(t._songAuthorName),Nt.setSongBPM(t._beatsPerMinute),As(t._levelAuthorName),Bs(t._environmentName),Is((e=t._customData)==null?void 0:e._editors)}function Js(t){var e,i,n,r,a;if(t.rawVersion===2&&_a(t.rawData._version),t.rawVersion===3&&_a(t.rawData.version),(e=t.info)!=null&&e._customData&&(zs(t.info._customData),Vs(t.info._customData._requirements),Gs(t.info._customData._suggestions),Ws(t.info._customData._information),qs(t.info._customData._warnings)),(i=t.data)!=null&&i.customData){const s=(n=rt.beatmapInfo)!=null&&n._beatsPerMinute?me.create(rt.beatmapInfo._beatsPerMinute,t.data.customData._bpmChanges||t.data.customData._BPMChanges||t.data.customData.BPMChanges):null;Us((r=t.data.customData._time)!=null?r:t.data.customData.time),Ms((a=t.data.customData._bookmarks)!=null?a:t.data.customData._bookmarks,s),Ps(s),Ys(t.data.customData.environment),Zs(t.data.customData.pointDefinitions),Hs(t.data.customData.customEvents,s)}}function nu(){As(),Bs(),Is(),Ns(),_a(),Us(),zs(),Vs(),Gs(),Ws(),qs(),Ms(),Ps(),Ys(),Zs(),Hs()}const au="UI Input: ";var Qi={enable:t=>{const e=document.querySelectorAll(".input-toggle");if(!e.length){console.error(au+"empty list, intentional or typo error?");return}e.forEach(i=>{i.disabled=!t})}};const ru="UI Loading: ",ci=document.querySelector(".loading__bar"),wr="loading__bar--error",Sr="loading__bar--download",Ks=document.querySelector(".loading__text");if(!ci||!Ks)throw new Error(ru+"loading component is missing part");function Qs(t,e,i=100){Ks.textContent=e,ci.style.width=`${i}%`,t==="error"?ci.classList.add(wr):ci.classList.remove(wr),t==="download"?ci.classList.add(Sr):ci.classList.remove(Sr)}function ou(){Qs("info","No map loaded",0)}var _t={status:Qs,reset:ou};class Ht{constructor(e){this.data=e}serialize(){return JSON.stringify(this.toObject())}clone(){return new this.constructor(this.toObject())}}class Hn extends Ht{get time(){return this.data._time}set time(e){this.data._time=e}get customData(){return this.data._customData}set customData(e){this.data._customData=e}setTime(e){return this.time=e,this}setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return this.customData&&delete this.customData[e],this}addCustomData(e){return this.customData=Zi(qi({},this.customData),{object:e}),this}}const Pt=class extends Hn{constructor(t){super(t),this.isNote=()=>this.type===0||this.type===1,this.isBomb=()=>this.type===3,this.getPosition=()=>this.customData._position?[this.customData._position[0],this.customData._position[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY],this.getAngle=()=>this.customData._cutDirection?this.customData._cutDirection>0?this.customData._cutDirection%360:360+this.customData._cutDirection%360:this.cutDirection>=1e3?Math.abs(this.cutDirection%1e3%360-360):Vt[this.cutDirection]||0,this.getDistance=e=>{const[i,n]=this.getPosition(),[r,a]=e.getPosition();return Math.sqrt(Math.pow(r-i,2)+Math.pow(a-n,2))},this.isVertical=e=>{const[i]=this.getPosition(),[n]=e.getPosition(),r=i-n;return r>-.001&&r<.001},this.isHorizontal=e=>{const[i,n]=this.getPosition(),[r,a]=e.getPosition(),s=n-a;return s>-.001&&s<.001},this.isDiagonal=e=>{const[i,n]=this.getPosition(),[r,a]=e.getPosition(),s=Math.abs(i-r),o=Math.abs(n-a);return s===o},this.isInline=(e,i=.5)=>this.getDistance(e)<=i,this.isDouble=(e,i)=>{for(let n=i,r=e.length;n<r;n++){if(e[n].time<this.time+.01&&e[n].type!==this.type)return!0;if(e[n].time>this.time+.01)return!1}return!1},this.isAdjacent=e=>{const i=this.getDistance(e);return i>.499&&i<1.001},this.isWindow=e=>this.getDistance(e)>1.8,this.isSlantedWindow=e=>this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e),this.hasChroma=()=>Array.isArray(this.customData._color)||typeof this.customData._disableSpawnEffect=="boolean",this.hasNoodleExtensions=()=>Array.isArray(this.customData._animation)||typeof this.customData._cutDirection=="number"||typeof this.customData._disableNoteGravity=="boolean"||typeof this.customData._disableNoteLook=="boolean"||typeof this.customData._fake=="boolean"||Array.isArray(this.customData._flip)||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||typeof this.customData._track=="string",this.hasMappingExtensions=()=>this.cutDirection>=1e3||this.posX>3||this.posX<0||this.posY>2||this.posY<0,this.isValidDirection=()=>this.cutDirection>=0&&this.cutDirection<=8,this.isValid=()=>!this.hasMappingExtensions()&&this.isValidDirection()}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c;return e.push(new this({_time:(n=i._time)!=null?n:Pt.default._time,_lineIndex:(r=i._lineIndex)!=null?r:Pt.default._lineIndex,_lineLayer:(a=i._lineLayer)!=null?a:Pt.default._lineLayer,_type:(s=i._type)!=null?s:Pt.default._type,_cutDirection:(o=i._cutDirection)!=null?o:Pt.default._cutDirection,_customData:(c=i._customData)!=null?c:Pt.default._customData()}))}),e.length===1?e[0]:e.length?e:new this({_time:Pt.default._time,_lineIndex:Pt.default._lineIndex,_lineLayer:Pt.default._lineLayer,_type:Pt.default._type,_cutDirection:Pt.default._cutDirection,_customData:Pt.default._customData()})}toObject(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_cutDirection:this.cutDirection,_customData:xt(this.customData)}}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get cutDirection(){return this.data._cutDirection}set cutDirection(t){this.data._cutDirection=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setType(t){return this.type=t,this}setCutDirection(t){return this.cutDirection=t,this}};let ba=Pt;ba.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0,_customData:()=>({})};const bt=class extends Ht{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c,l,u,p,g,d,m,_,b;return e.push(new this({_colorType:(n=i._colorType)!=null?n:bt.default._colorType,_headTime:(a=(r=i._headTime)!=null?r:i._tailTime)!=null?a:bt.default._headTime,_headLineIndex:(s=i._headLineIndex)!=null?s:bt.default._headLineIndex,_headLineLayer:(o=i._headLineLayer)!=null?o:bt.default._headLineLayer,_headCutDirection:(c=i._headCutDirection)!=null?c:bt.default._headCutDirection,_headControlPointlengthMultiplier:(l=i._headControlPointlengthMultiplier)!=null?l:bt.default._headControlPointlengthMultiplier,_tailTime:(p=(u=i._tailTime)!=null?u:i._headTime)!=null?p:bt.default._tailTime,_tailLineIndex:(g=i._tailLineIndex)!=null?g:bt.default._tailLineIndex,_tailLineLayer:(d=i._tailLineLayer)!=null?d:bt.default._tailLineLayer,_tailCutDirection:(m=i._tailCutDirection)!=null?m:bt.default._tailCutDirection,_tailControlPointLengthMultiplier:(_=i._tailControlPointLengthMultiplier)!=null?_:bt.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:(b=i._sliderMidAnchorMode)!=null?b:bt.default._sliderMidAnchorMode}))}),e.length===1?e[0]:e.length?e:new this({_colorType:bt.default._colorType,_headTime:bt.default._headTime,_headLineIndex:bt.default._headLineIndex,_headLineLayer:bt.default._headLineLayer,_headCutDirection:bt.default._headCutDirection,_headControlPointlengthMultiplier:bt.default._headControlPointlengthMultiplier,_tailTime:bt.default._tailTime,_tailLineIndex:bt.default._tailLineIndex,_tailLineLayer:bt.default._tailLineLayer,_tailCutDirection:bt.default._tailCutDirection,_tailControlPointLengthMultiplier:bt.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:bt.default._sliderMidAnchorMode})}toObject(){return{_colorType:this.colorType,_headTime:this.headTime,_headLineIndex:this.headPosX,_headLineLayer:this.headPosY,_headCutDirection:this.headCutDirection,_headControlPointlengthMultiplier:this.headLengthMultiplier,_tailTime:this.tailTime,_tailLineIndex:this.tailPosX,_tailLineLayer:this.tailPosY,_tailCutDirection:this.tailCutDirection,_tailControlPointLengthMultiplier:this.tailLengthMultiplier,_sliderMidAnchorMode:this.midAnchor}}get colorType(){return this.data._colorType}set colorType(t){this.data._colorType=t}get headTime(){return this.data._headTime}set headTime(t){this.data._headTime=t}get headPosX(){return this.data._headLineIndex}set headPosX(t){this.data._headLineIndex=t}get headPosY(){return this.data._headLineLayer}set headPosY(t){this.data._headLineLayer=t}get headCutDirection(){return this.data._headCutDirection}set headCutDirection(t){this.data._headCutDirection=t}get headLengthMultiplier(){return this.data._headControlPointlengthMultiplier}set headLengthMultiplier(t){this.data._headControlPointlengthMultiplier=t}get tailTime(){return this.data._tailTime}set tailTime(t){this.data._tailTime=t}get tailPosX(){return this.data._tailLineIndex}set tailPosX(t){this.data._tailLineIndex=t}get tailPosY(){return this.data._tailLineLayer}set tailPosY(t){this.data._tailLineLayer=t}get tailCutDirection(){return this.data._tailCutDirection}set tailCutDirection(t){this.data._tailCutDirection=t}get tailLengthMultiplier(){return this.data._tailControlPointLengthMultiplier}set tailLengthMultiplier(t){this.data._tailControlPointLengthMultiplier=t}get midAnchor(){return this.data._sliderMidAnchorMode}set midAnchor(t){this.data._sliderMidAnchorMode=t}setColor(t){return this.colorType=t,this}setPosX(t){return this.headPosX=t,this}setPosY(t){return this.headPosY=t,this}setDirection(t){return this.headCutDirection=t,this}setLengthMultiplier(t){return this.headLengthMultiplier=t,this}setTailTime(t){return this.tailTime=t,this}setTailPosX(t){return this.tailPosX=t,this}setTailPosY(t){return this.tailPosY=t,this}setTailDirection(t){return this.tailCutDirection=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0){switch(this.headPosX=se-1-this.headPosX,this.tailPosX=se-1-this.tailPosX,t&&(this.colorType=(1+this.colorType)%2),this.headCutDirection){case 2:this.headCutDirection=3;break;case 3:this.headCutDirection=2;break;case 6:this.headCutDirection=7;break;case 7:this.headCutDirection=6;break;case 4:this.headCutDirection=5;break;case 5:this.headCutDirection=4;break}switch(this.tailCutDirection){case 2:this.tailCutDirection=3;break;case 3:this.tailCutDirection=2;break;case 6:this.tailCutDirection=7;break;case 7:this.tailCutDirection=6;break;case 4:this.tailCutDirection=5;break;case 5:this.tailCutDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),this}hasMappingExtensions(){return this.headPosY>2||this.headPosY<0||this.headPosX<=-1e3||this.headPosX>=1e3||this.headCutDirection>=1e3&&this.headCutDirection<=1360||this.tailCutDirection>=1e3&&this.tailCutDirection<=1360}};let ya=bt;ya.default={_colorType:0,_headTime:0,_headLineIndex:0,_headLineLayer:0,_headCutDirection:0,_headControlPointlengthMultiplier:1,_tailTime:0,_tailLineIndex:0,_tailLineLayer:0,_tailCutDirection:0,_tailControlPointLengthMultiplier:1,_sliderMidAnchorMode:0};const Tt=class extends Hn{constructor(t){super(t),this.getPosition=()=>this.customData._position?[this.customData._position[0],this.customData._position[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.type<=-1e3?this.type/1e3:this.type>=1e3?this.type/1e3:this.type],this.isInteractive=()=>this.width>=2||this.posX===1||this.posX===2,this.isCrouch=()=>this.type===1&&(this.width>2||this.width===2&&this.posX===1),this.isZero=()=>this.duration===0||this.width===0,this.isLonger=(e,i,n=0)=>e._time+e._duration>i._time+i._duration+n,this.hasChroma=()=>Array.isArray(this.customData._color),this.hasNoodleExtensions=()=>Array.isArray(this.customData._animation)||typeof this.customData._fake=="boolean"||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||Array.isArray(this.customData._scale)||typeof this.customData._track=="string",this.hasMappingExtensions=()=>this.width>=1e3||this.type>=1e3||this.posX>3||this.posX<0,this.isValid=()=>!this.hasMappingExtensions()&&this.width>0&&this.width<=4}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c,l,u;return e.push(new this({_time:(n=i._time)!=null?n:Tt.default._time,_type:(r=i._type)!=null?r:Tt.default._type,_lineIndex:(a=i._lineIndex)!=null?a:Tt.default._lineIndex,_lineLayer:(s=i._lineLayer)!=null?s:Tt.default._lineLayer,_duration:(o=i._duration)!=null?o:Tt.default._duration,_width:(c=i._width)!=null?c:Tt.default._width,_height:(l=i._height)!=null?l:Tt.default._height,_customData:(u=i._customData)!=null?u:Tt.default._customData()}))}),e.length===1?e[0]:e.length?e:new this({_time:Tt.default._time,_type:Tt.default._type,_lineIndex:Tt.default._lineIndex,_lineLayer:Tt.default._lineLayer,_duration:Tt.default._duration,_width:Tt.default._width,_height:Tt.default._height,_customData:Tt.default._customData()})}toObject(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_duration:this.duration,_width:this.width,_height:this.height,_customData:xt(this.customData)}}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get duration(){return this.data._duration}set duration(t){this.data._duration=t}get width(){return this.data._width}set width(t){this.data._width=t}get height(){return this.data._height}set height(t){this.data._height=t}setType(t){return this.type=t,this}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}};let va=Tt;va.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_duration:1,_width:1,_height:1,_customData:()=>({})};const te=class extends Hn{constructor(t){super(t),this.isOff=()=>this.value===0,this.isOn=()=>this.value===1||this.value===5||this.value===9,this.isFlash=()=>this.value===2||this.value===6||this.value===10,this.isFade=()=>this.value===3||this.value===7||this.value===11,this.isTransition=()=>this.value===4||this.value===8||this.value===12,this.isValidType=()=>this.type>=0&&this.type<=19||this.type===100,this.isLightEvent=()=>this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11,this.isColorBoost=()=>this.type===5,this.isRingEvent=()=>this.type===8||this.type===9,this.isLaserRotationEvent=()=>this.type===12||this.type===13,this.isLaneRotationEvent=()=>this.type===14||this.type===15,this.isExtraEvent=()=>this.type===16||this.type===17||this.type===18||this.type===19,this.isSpecialEvent=()=>this.type===40||this.type===41||this.type===42||this.type===43,this.isBPMChangeEvent=()=>this.type===100,this.isLightingEvent=()=>this.isLightEvent()||this.isRingEvent()||this.isLaserRotationEvent()||this.isExtraEvent(),this.hasChroma=()=>this.isLightEvent()?Array.isArray(this.customData._color)||typeof this.customData._lightID=="number"||Array.isArray(this.customData._lightID)||typeof this.customData._propID=="number"||typeof this.customData._lightGradient=="object"||typeof this.customData._easing=="string"||typeof this.customData._lerpType=="string":this.isRingEvent()?typeof this.customData._nameFilter=="string"||typeof this.customData._reset=="boolean"||typeof this.customData._rotation=="number"||typeof this.customData._step=="number"||typeof this.customData._prop=="number"||typeof this.customData._speed=="number"||typeof this.customData._direction=="number"||typeof this.customData._counterSpin=="boolean"||typeof this.customData._stepMult=="number"||typeof this.customData._propMult=="number"||typeof this.customData._speedMult=="number":this.isLaserRotationEvent()?typeof this.customData._lockPosition=="boolean"||typeof this.customData._speed=="number"||typeof this.customData._preciseSpeed=="number"||typeof this.customData._direction=="number":!1,this.hasOldChroma=()=>this.value>=2e9,this.hasNoodleExtensions=()=>this.isLaneRotationEvent()&&typeof this.customData._rotation=="number",this.hasMappingExtensions=()=>this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720,this.isValid=()=>this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.hasOldChroma())}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o;return e.push(new this({_time:(n=i._time)!=null?n:te.default._time,_type:(r=i._type)!=null?r:te.default._type,_value:(a=i._value)!=null?a:te.default._value,_floatValue:(s=i._floatValue)!=null?s:te.default._floatValue,_customData:(o=i._customData)!=null?o:te.default._customData()}))}),e.length===1?e[0]:e.length?e:new this({_time:te.default._time,_type:te.default._type,_value:te.default._value,_floatValue:te.default._floatValue,_customData:te.default._customData()})}toObject(){return{_time:this.time,_type:this.type,_value:this.value,_floatValue:this.floatValue,_customData:xt(this.customData)}}get type(){return this.data._type}set type(t){this.data._type=t}get value(){return this.data._value}set value(t){this.data._value=t}get floatValue(){return this.data._floatValue}set floatValue(t){this.data._floatValue=t}setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}};let Ea=te;Ea.default={_time:0,_type:0,_value:0,_floatValue:1,_customData:()=>({})};const ee=class extends Hn{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o;return e.push(new this({_time:(n=i._time)!=null?n:ee.default._time,_lineIndex:(r=i._lineIndex)!=null?r:ee.default._lineIndex,_lineLayer:(a=i._lineLayer)!=null?a:ee.default._lineLayer,_offsetDirection:(s=i._offsetDirection)!=null?s:ee.default._offsetDirection,_customData:(o=i._customData)!=null?o:ee.default._customData()}))}),e.length===1?e[0]:e.length?e:new this({_time:ee.default._time,_lineIndex:ee.default._lineIndex,_lineLayer:ee.default._lineLayer,_offsetDirection:ee.default._offsetDirection,_customData:ee.default._customData()})}toObject(){return{_time:this.time,_lineIndex:this.posX,_lineLayer:this.posY,_offsetDirection:this.direction,_customData:xt(this.customData)}}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get direction(){return this.data._offsetDirection}set direction(t){this.data._offsetDirection=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDirection(t){return this.direction=t,this}mirror(){switch(this.posX=se-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}};let wa=ee;wa.default={_time:0,_lineIndex:0,_lineLayer:0,_offsetDirection:1,_customData:()=>({})};const Ri=class extends Ht{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r;return e.push(new this({_keyword:(n=i._keyword)!=null?n:Ri.default._keyword,_specialEvents:(r=i._specialEvents)!=null?r:Ri.default._specialEvents()}))}),e.length===1?e[0]:e.length?e:new this({_keyword:Ri.default._keyword,_specialEvents:Ri.default._specialEvents()})}toObject(){return{_keyword:this.keyword,_specialEvents:this.events}}get keyword(){return this.data._keyword}set keyword(t){this.data._keyword=t}get events(){return this.data._specialEvents}set events(t){this.data._specialEvents=t}setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const e=this.events.indexOf(t,0);return e>-1&&this.events.splice(e,1),this}};let Sa=Ri;Sa.default={_keyword:"",_specialEvents:()=>[]};const tl=class extends Ht{constructor(t){super(t),this.keywords=t._keywords.map(e=>Sa.create({_keyword:e._keyword,_specialEvents:e._specialEvents}))}static create(t={}){var e;return new this({_keywords:(e=t._keywords)!=null?e:tl.default._keywords()})}toObject(){return{_keywords:this.keywords.map(t=>t.toObject())}}setKeyword(t){return this.keywords=t,this}addKeyword(t){return this.keywords.push(Sa.create(t)),this}removeKeyword(t){return this.keywords=this.keywords.filter(e=>e.keyword!==t),this}};let el=tl;el.default={_keywords:()=>[]};class su extends Ht{constructor(e){super(e),this._fileName="UnnamedDifficulty.dat",this.getFirstInteractiveTime=()=>{let i=Number.MAX_VALUE;this.notes.length>0&&(i=this.notes[0].time);const n=this.findFirstInteractiveObstacleTime();return Math.min(i,n)},this.getLastInteractiveTime=()=>{let i=0;this.notes.length>0&&(i=this.notes[this.notes.length-1].time);const n=this.findLastInteractiveObstacleTime();return Math.max(i,n)},this.findFirstInteractiveObstacleTime=()=>{for(let i=0,n=this.obstacles.length;i<n;i++)if(this.obstacles[i].isInteractive())return this.obstacles[i].time;return Number.MAX_VALUE},this.findLastInteractiveObstacleTime=()=>{let i=0;for(let n=this.obstacles.length-1;n>=0;n--)this.obstacles[n].isInteractive()&&(i=Math.max(i,this.obstacles[n].time+this.obstacles[n].duration));return i},this.addNotes=(...i)=>{i.forEach(n=>{this.notes.push(ba.create(n))})},this.addObstacles=(...i)=>{i.forEach(n=>{this.obstacles.push(va.create(n))})},this.addEvents=(...i)=>{i.forEach(n=>{this.events.push(Ea.create(n))})},this.addWaypoints=(...i)=>{i.forEach(n=>{this.waypoints.push(wa.create(n))})},this.addSliders=(...i)=>{i.forEach(n=>{this.sliders.push(ya.create(n))})},this.version="2.6.0",this.notes=e._notes.map(i=>ba.create(i)),this.sliders=e._sliders.map(i=>ya.create(i)),this.obstacles=e._obstacles.map(i=>va.create(i)),this.events=e._events.map(i=>Ea.create(i)),this.waypoints=e._waypoints.map(i=>wa.create(i)),this.specialEventsKeywordFilters=el.create(e._specialEventsKeywordFilters),this.customData=e._customData}static create(e={}){var i,n,r,a,s,o,c;return new this({_version:"2.6.0",_notes:(i=e._notes)!=null?i:[],_sliders:(n=e._sliders)!=null?n:[],_obstacles:(r=e._obstacles)!=null?r:[],_events:(a=e._events)!=null?a:[],_waypoints:(s=e._waypoints)!=null?s:[],_specialEventsKeywordFilters:(o=e._specialEventsKeywordFilters)!=null?o:{_keywords:[]},_customData:(c=e._customData)!=null?c:{}})}toObject(){return{_version:this.version||"2.6.0",_notes:this.notes.map(e=>e.toObject()),_sliders:this.sliders.map(e=>e.toObject()),_obstacles:this.obstacles.map(e=>e.toObject()),_events:this.events.map(e=>e.toObject()),_waypoints:this.waypoints.map(e=>e.toObject()),_specialEventsKeywordFilters:this.specialEventsKeywordFilters.toObject(),_customData:xt(this.customData)}}set fileName(e){this._fileName=e.trim()}get fileName(){return this._fileName}setFileName(e){return this.fileName=e,this}}class Ne extends Ht{get time(){return this.data.b}set time(e){this.data.b=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}setTime(e){return this.time=e,this}setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return this.customData&&delete this.customData[e],this}addCustomData(e){return this.customData=Zi(qi({},this.customData),{object:e}),this}}const ie=class extends Ne{constructor(t){super(t),this.hasChroma=()=>this.isLightEvent()?Array.isArray(this.customData.color)||typeof this.customData.lightID=="number"||Array.isArray(this.customData.lightID)||typeof this.customData.easing=="string"||typeof this.customData.lerpType=="string":this.isRingEvent()?typeof this.customData.nameFilter=="string"||typeof this.customData.rotation=="number"||typeof this.customData.step=="number"||typeof this.customData.prop=="number"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":this.isLaserRotationEvent()?typeof this.customData.lockRotation=="boolean"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":!1}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o;return e.push(new this({b:(n=i.b)!=null?n:ie.default.b,et:(r=i.et)!=null?r:ie.default.et,i:(a=i.i)!=null?a:ie.default.i,f:(s=i.f)!=null?s:ie.default.f,customData:(o=i.customData)!=null?o:ie.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:ie.default.b,et:ie.default.et,i:ie.default.i,f:ie.default.f,customData:ie.default.customData()})}toObject(){return{b:this.time,et:this.type,i:this.value,f:this.floatValue,customData:xt(this.customData)}}get type(){return this.data.et}set type(t){this.data.et=t}get value(){return this.data.i}set value(t){this.data.i=t}get floatValue(){return this.data.f}set floatValue(t){this.data.f=t}setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}isOff(){return this.value===0}isOn(){return this.value===1||this.value===5||this.value===9}isFlash(){return this.value===2||this.value===6||this.value===10}isFade(){return this.value===3||this.value===7||this.value===11}isTransition(){return this.value===4||this.value===8||this.value===12}isValidType(){return this.type>=0&&this.type<=19||this.type===100}isLightEvent(){return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}isColorBoost(){return this.type===5}isRingEvent(){return this.type===8||this.type===9}isLaserRotationEvent(){return this.type===12||this.type===13}isLaneRotationEvent(){return this.type===14||this.type===15}isExtraEvent(){return this.type===16||this.type===17||this.type===18||this.type===19}isSpecialEvent(){return this.type===40||this.type===41||this.type===42||this.type===43}isBPMChangeEvent(){return this.type===100}isLightingEvent(){return this.isLightEvent()||this.isRingEvent()||this.isLaserRotationEvent()||this.isExtraEvent()}hasOldChroma(){return this.value>=2e9}isValid(){return this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.hasOldChroma())}};let mn=ie;mn.default={b:0,et:0,i:0,f:1,customData:()=>({})};const Ai=class extends Ht{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r;return e.push(new this({k:(n=i.k)!=null?n:Ai.default.k,e:(r=i.e)!=null?r:Ai.default.e()}))}),e.length===1?e[0]:e.length?e:new this({k:Ai.default.k,e:Ai.default.e()})}toObject(){return{k:this.keyword,e:this.events}}get keyword(){return this.data.k}set keyword(t){this.data.k=t}get events(){return this.data.e}set events(t){this.data.e=t}setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const e=this.events.indexOf(t,0);return e>-1&&this.events.splice(e,1),this}};let ka=Ai;ka.default={k:"",e:()=>[]};const il=class extends Ht{constructor(t){super(t),this.d=t.d.map(e=>ka.create({e:e.e,k:e.k}))}static create(t={}){var e;return new this({d:(e=t.d)!=null?e:il.default.d()})}toObject(){return{d:this.list.map(t=>t.toObject())}}get list(){return this.d}set list(t){this.d=t}setData(t){return this.list=t,this}addData(t){return this.list.push(ka.create(t)),this}removeData(t){return this.list=this.list.filter(e=>e.keyword!==t),this}};let Ma=il;Ma.default={d:()=>[]};class Pa extends Ne{get posX(){return this.data.x}set posX(e){this.data.x=e}get posY(){return this.data.y}set posY(e){this.data.y=e}setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}swapPosition(e){const i=e.posX;e.posX=this.posX,this.posX=i;const n=e.posY;return e.posY=this.posY,this.posY=n,this}}const _e=class extends Pa{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean",this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s;return e.push(new this({b:(n=i.b)!=null?n:_e.default.b,x:(r=i.x)!=null?r:_e.default.x,y:(a=i.y)!=null?a:_e.default.y,customData:(s=i.customData)!=null?s:_e.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:_e.default.b,x:_e.default.x,y:_e.default.y,customData:_e.default.customData()})}toObject(){return{b:this.time,x:this.posX,y:this.posY,customData:xt(this.customData)}}mirror(){return this.posX=se-1-this.posX,this}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}getDistance(t){const[e,i]=this.getPosition(),[n,r]=t.getPosition();return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-i,2))}isVertical(t){const[e]=this.getPosition(),[i]=t.getPosition(),n=e-i;return n>-.001&&n<.001}isHorizontal(t){const[e,i]=this.getPosition(),[n,r]=t.getPosition(),a=i-r;return a>-.001&&a<.001}isDiagonal(t){const[e,i]=this.getPosition(),[n,r]=t.getPosition(),a=Math.abs(e-n),s=Math.abs(i-r);return a===s}isInline(t,e=.5){return this.getDistance(t)<=e}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t,e=1.8){return this.getDistance(t)>e}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}hasMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0}isValid(){return!this.hasMappingExtensions()}};let pn=_e;pn.default={b:0,x:0,y:0,customData:()=>({})};const Qe=class extends Ne{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a;return e.push(new this({b:(n=i.b)!=null?n:Qe.default.b,m:(r=i.m)!=null?r:Qe.default.m,customData:(a=i.customData)!=null?a:Qe.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:Qe.default.b,m:Qe.default.m,customData:Qe.default.customData()})}toObject(){return{b:this.time,m:this.bpm,customData:xt(this.customData)}}get bpm(){return this.data.m}set bpm(t){this.data.m=t}setBPM(t){return this.bpm=t,this}};let gn=Qe;gn.default={b:0,m:0,customData:()=>({})};class nl extends Pa{constructor(){super(...arguments),this.hasChroma=()=>!1,this.hasNoodleExtensions=()=>!1}get color(){return this.data.c}set color(e){this.data.c=e}get direction(){return this.data.d}set direction(e){this.data.d=e}get tailTime(){return this.data.tb}set tailTime(e){this.data.tb=e}get tailPosX(){return this.data.tx}set tailPosX(e){this.data.tx=e}get tailPosY(){return this.data.ty}set tailPosY(e){this.data.ty=e}setColor(e){return this.color=e,this}setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}setDirection(e){return this.direction=e,this}setTailTime(e){return this.tailTime=e,this}setTailPosX(e){return this.tailPosX=e,this}setTailPosY(e){return this.tailPosY=e,this}getPosition(){return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}getDistance(e){const[i,n]=this.getPosition(),[r,a]=e.getPosition();return Math.sqrt(Math.pow(r-i,2)+Math.pow(a-n,2))}isVertical(e){const[i]=this.getPosition(),[n]=e.getPosition(),r=i-n;return r>-.001&&r<.001}isHorizontal(e){const[i,n]=this.getPosition(),[r,a]=e.getPosition(),s=n-a;return s>-.001&&s<.001}isDiagonal(e){const[i,n]=this.getPosition(),[r,a]=e.getPosition(),s=Math.abs(i-r),o=Math.abs(n-a);return s===o}isInline(e,i=.5){return this.getDistance(e)<=i}isAdjacent(e){const i=this.getDistance(e);return i>.499&&i<1.001}isWindow(e,i=1.8){return this.getDistance(e)>i}isSlantedWindow(e){return this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e)}isInverse(){return this.time>this.tailTime}}const yt=class extends nl{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c,l,u,p,g,d,m,_;return e.push(new this({b:(r=(n=i.b)!=null?n:i.tb)!=null?r:yt.default.b,c:(a=i.c)!=null?a:yt.default.c,x:(s=i.x)!=null?s:yt.default.x,y:(o=i.y)!=null?o:yt.default.y,d:(c=i.d)!=null?c:yt.default.d,tb:(u=(l=i.tb)!=null?l:i.b)!=null?u:yt.default.tb,tx:(p=i.tx)!=null?p:yt.default.tx,ty:(g=i.ty)!=null?g:yt.default.ty,sc:(d=i.sc)!=null?d:yt.default.sc,s:(m=i.s)!=null?m:yt.default.s,customData:(_=i.customData)!=null?_:yt.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:yt.default.b,c:yt.default.c,x:yt.default.x,y:yt.default.y,d:yt.default.d,tb:yt.default.tb,tx:yt.default.tx,ty:yt.default.ty,sc:yt.default.sc,s:yt.default.s,customData:yt.default.customData()})}toObject(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,sc:this.sliceCount,s:this.squish,customData:xt(this.customData)}}get sliceCount(){return this.data.sc}set sliceCount(t){this.data.sc=t}get squish(){return this.data.s}set squish(t){this.data.s=t}setSliceCount(t){return this.sliceCount=t,this}setSquish(t){return this.squish=t,this}mirror(t=!0){switch(this.posX=se-1-this.posX,this.tailPosX=se-1-this.tailPosX,t&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}getAngle(){return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):Vt[this.direction]||0}hasMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360}isValid(){return!(this.hasMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)&&!(this.posX===this.tailPosX&&this.posY===this.tailPosY)}};let xa=yt;xa.default={b:0,c:0,x:0,y:0,d:0,tb:0,tx:0,ty:0,sc:1,s:1,customData:()=>({})};const ti=class extends Ne{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a;return e.push(new this({b:(n=i.b)!=null?n:ti.default.b,o:(r=i.o)!=null?r:ti.default.o,customData:(a=i.customData)!=null?a:ti.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:ti.default.b,o:ti.default.o,customData:ti.default.customData()})}toObject(){return{b:this.time,o:this.toggle,customData:xt(this.customData)}}get toggle(){return this.data.o}set toggle(t){this.data.o=t}};let _n=ti;_n.default={b:0,o:!1,customData:()=>({})};const Bt=class extends Pa{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean",this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c,l;return e.push(new this({b:(n=i.b)!=null?n:Bt.default.b,x:(r=i.x)!=null?r:Bt.default.x,y:(a=i.y)!=null?a:Bt.default.y,c:(s=i.c)!=null?s:Bt.default.c,d:(o=i.d)!=null?o:Bt.default.d,a:(c=i.a)!=null?c:Bt.default.a,customData:(l=i.customData)!=null?l:Bt.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:Bt.default.b,x:Bt.default.x,y:Bt.default.y,c:Bt.default.c,d:Bt.default.d,a:Bt.default.a,customData:Bt.default.customData()})}toObject(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,a:this.angleOffset,customData:xt(this.customData)}}get color(){return this.data.c}set color(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get angleOffset(){return this.data.a}set angleOffset(t){this.data.a=t}setColor(t){return this.color=t,this}setDirection(t){return this.direction=t,this}setAngleOffset(t){return this.angleOffset=t,this}mirror(){return this.posX=se-1-this.posX,this}swapRotation(t,e=!0){const i=t.direction;t.direction=this.direction,this.direction=i;const n=t.angleOffset;return t.angleOffset=this.angleOffset,this.angleOffset=n,e&&(t.angleOffset=0-t.angleOffset,this.angleOffset=0-this.angleOffset),this}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}getAngle(){return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):(Vt[this.direction]||0)+this.angleOffset}getDistance(t){const[e,i]=this.getPosition(),[n,r]=t.getPosition();return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-i,2))}isRed(){return this.color===0}isBlue(){return this.color===1}isVertical(t){if(t){const[e]=this.getPosition(),[i]=t.getPosition(),n=e-i;return n>-.001&&n<.001}return 22.5<=Math.abs(this.getAngle())%180+90&&Math.abs(this.getAngle())%180+90<=67.5}isHorizontal(t){if(t){const[e,i]=this.getPosition(),[n,r]=t.getPosition(),a=i-r;return a>-.001&&a<.001}return 22.5<=Math.abs(this.getAngle())%180+90&&Math.abs(this.getAngle())%180+90<=67.5}isDiagonal(t){if(t){const[e,i]=this.getPosition(),[n,r]=t.getPosition(),a=Math.abs(e-n),s=Math.abs(i-r);return a===s}return 22.5<=Math.abs(this.getAngle())%90&&Math.abs(this.getAngle())%90<=67.5}isInline(t,e=.5){return this.getDistance(t)<=e}isDouble(t,e=.01){return t.time>this.time-e&&t.time<this.time+e&&this.color!==t.color}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t,e=1.8){return this.getDistance(t)>e}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}hasMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0||this.direction>=1e3&&this.direction<=1360||this.direction>=2e3&&this.direction<=2360}isValidDirection(){return this.direction>=0&&this.direction<=8}isValid(){return!this.hasMappingExtensions()&&this.isValidDirection()}};let mi=Bt;mi.default={b:0,c:0,x:0,y:0,d:0,a:0,customData:()=>({})};class lu extends Ne{get groupID(){return this.data.g}set groupID(e){this.data.g=e}}class al extends lu{constructor(e,i){super(e),this.e=i}toObject(){return{b:this.time,g:this.groupID,e:this.events.map(e=>e.toObject()),customData:xt(this.customData)}}get events(){return this.e}set events(e){this.e=e}}const ui=class extends Ht{constructor(t){super(t),this.data.f===1&&(this.p0=this.p0?this.p0:1)}static create(t={}){var e,i,n,r;return new ui({f:(e=t.f)!=null?e:ui.default.f,p:(i=t.p)!=null?i:ui.default.p,t:(n=t.t)!=null?n:ui.default.t,r:(r=t.r)!=null?r:ui.default.r})}toObject(){return{f:this.type,p:this.p0,t:this.p1,r:this.reverse}}get type(){return this.data.f}set type(t){this.data.f=t}get p0(){return this.data.p}set p0(t){this.data.p=t}get p1(){return this.data.t}set p1(t){this.data.t=t}get reverse(){return this.data.r}set reverse(t){this.data.r=t}};let de=ui;de.default={f:1,p:0,t:0,r:0};class rl extends Ht{constructor(e){super(e),this.f=de.create(e.f)}get filter(){return this.f}set filter(e){this.f=e}get beatDistribution(){return this.data.w}set beatDistribution(e){this.data.w=e}get beatDistributionType(){return this.data.d}set beatDistributionType(e){this.data.d=e}setFilter(e){return this.filter=e,this}setBeatDistribution(e){return this.beatDistribution=e,this}setBeatDistributionType(e){return this.beatDistributionType=e,this}}const ne=class extends Ht{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o;return e.push(new this({b:(n=i.b)!=null?n:ne.default.b,i:(r=i.i)!=null?r:ne.default.i,c:(a=i.c)!=null?a:ne.default.c,s:(s=i.s)!=null?s:ne.default.s,f:(o=i.f)!=null?o:ne.default.f}))}),e.length===1?e[0]:e.length?e:new this({b:ne.default.b,i:ne.default.i,c:ne.default.c,s:ne.default.s,f:ne.default.f})}toObject(){return{b:this.time,i:this.transition,c:this.color,s:this.brightness,f:this.frequency}}get time(){return this.data.b}set time(t){this.data.b=t}get transition(){return this.data.i}set transition(t){this.data.i=t}get color(){return this.data.c}set color(t){this.data.c=t}get brightness(){return this.data.s}set brightness(t){this.data.s=t}get frequency(){return this.data.f}set frequency(t){this.data.f=t}};let ol=ne;ol.default={b:0,i:0,c:0,s:1,f:0};const It=class extends rl{constructor(t){super(t),this.e=t.e.map(i=>ol.create(i));const e=Math.max(...this.e.map(i=>i.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<e?e:this.beatDistribution)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c,l;return e.push(new this({f:(n=i.f)!=null?n:It.default.f(),w:(r=i.w)!=null?r:It.default.w,d:(a=i.d)!=null?a:It.default.d,r:(s=i.r)!=null?s:It.default.r,t:(o=i.t)!=null?o:It.default.t,b:(c=i.b)!=null?c:It.default.b,e:(l=i.e)!=null?l:It.default.e()}))}),e.length===1?e[0]:e.length?e:new this({f:It.default.f(),w:It.default.w,d:It.default.d,r:It.default.r,t:It.default.t,b:It.default.b,e:It.default.e()})}toObject(){return{f:this.filter.toObject(),w:this.beatDistribution,d:this.beatDistributionType,r:this.brightnessDistribution,t:this.brightnessDistributionType,b:this.affectFirst,e:this.events.map(t=>t.toObject())}}get brightnessDistribution(){return this.data.r}set brightnessDistribution(t){this.data.r=t}get brightnessDistributionType(){return this.data.t}set brightnessDistributionType(t){this.data.t=t}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get events(){return this.e}set events(t){this.e=t}};let sl=It;sl.default={f:()=>({f:de.default.f,p:de.default.p,t:de.default.t,r:de.default.r}),w:0,d:1,r:0,t:1,b:0,e:()=>[]};const be=class extends al{constructor(t){super(t,t.e.map(e=>sl.create(e)))}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s;return e.push(new this({b:(n=i.b)!=null?n:be.default.b,g:(r=i.g)!=null?r:be.default.g,e:(a=i.e)!=null?a:be.default.e(),customData:(s=i.customData)!=null?s:be.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:be.default.b,g:be.default.g,e:be.default.e(),customData:be.default.customData()})}};let Ca=be;Ca.default={b:0,g:0,e:()=>[],customData:()=>({})};const Ot=class extends Ht{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c;return e.push(new this({b:(n=i.b)!=null?n:Ot.default.b,p:(r=i.p)!=null?r:Ot.default.p,e:(a=i.e)!=null?a:Ot.default.e,l:(s=i.l)!=null?s:Ot.default.l,r:(o=i.r)!=null?o:Ot.default.r,o:(c=i.o)!=null?c:Ot.default.o}))}),e.length===1?e[0]:e.length?e:new this({b:Ot.default.b,p:Ot.default.p,e:Ot.default.e,l:Ot.default.l,r:Ot.default.r,o:Ot.default.o})}toObject(){return{b:this.time,p:this.previous,e:this.ease,l:this.loop,r:this.rotation,o:this.direction}}get time(){return this.data.b}set time(t){this.data.b=t}get previous(){return this.data.p}set previous(t){this.data.p=t}get ease(){return this.data.e}set ease(t){this.data.e=t}get loop(){return this.data.l}set loop(t){this.data.l=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}get direction(){return this.data.o}set direction(t){this.data.o=t}};let ll=Ot;ll.default={b:0,p:0,e:0,l:0,r:0,o:0};const St=class extends rl{constructor(t){super(t),this.l=t.l.map(i=>ll.create(i));const e=Math.max(...this.l.map(i=>i.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<e?e:this.beatDistribution)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c,l,u,p;return e.push(new this({f:(n=i.f)!=null?n:St.default.f(),w:(r=i.w)!=null?r:St.default.w,d:(a=i.d)!=null?a:St.default.d,s:(s=i.s)!=null?s:St.default.s,t:(o=i.t)!=null?o:St.default.t,a:(c=i.a)!=null?c:St.default.a,r:(l=i.r)!=null?l:St.default.r,b:(u=i.b)!=null?u:St.default.b,l:(p=i.l)!=null?p:St.default.l()}))}),e.length===1?e[0]:e.length?e:new this({f:St.default.f(),w:St.default.w,d:St.default.d,s:St.default.s,t:St.default.t,a:St.default.a,r:St.default.r,b:St.default.b,l:St.default.l()})}toObject(){return{f:this.filter.toObject(),w:this.beatDistribution,d:this.beatDistributionType,s:this.rotationDistribution,t:this.rotationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,l:this.events.map(t=>t.toObject())}}get rotationDistribution(){return this.data.s}set rotationDistribution(t){this.data.s=t}get rotationDistributionType(){return this.data.t}set rotationDistributionType(t){this.data.t=t}get axis(){return this.data.a}set axis(t){this.data.a=t}get flip(){return this.data.r}set flip(t){this.data.r=t?1:0}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get events(){return this.l}set events(t){this.l=t}};let cl=St;cl.default={f:()=>({f:de.default.f,p:de.default.p,t:de.default.t,r:de.default.r}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,l:()=>[]};const ye=class extends al{constructor(t){super(t,t.e.map(e=>cl.create(e)))}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s;return e.push(new this({b:(n=i.b)!=null?n:ye.default.b,g:(r=i.g)!=null?r:ye.default.g,e:(a=i.e)!=null?a:ye.default.e(),customData:(s=i.customData)!=null?s:ye.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:ye.default.b,g:ye.default.g,e:ye.default.e(),customData:ye.default.customData()})}};let Da=ye;Da.default={b:0,g:0,e:()=>[],customData:()=>({})};const $t=class extends Ne{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color),this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||Array.isArray(this.customData.size)||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c,l;return e.push(new this({b:(n=i.b)!=null?n:$t.default.b,x:(r=i.x)!=null?r:$t.default.x,y:(a=i.y)!=null?a:$t.default.y,d:(s=i.d)!=null?s:$t.default.d,w:(o=i.w)!=null?o:$t.default.w,h:(c=i.h)!=null?c:$t.default.h,customData:(l=i.customData)!=null?l:$t.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:$t.default.b,x:$t.default.x,y:$t.default.y,d:$t.default.d,w:$t.default.w,h:$t.default.h,customData:$t.default.customData()})}toObject(){return{b:this.time,x:this.posX,y:this.posY,d:this.duration,w:this.width,h:this.height,customData:xt(this.customData)}}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get duration(){return this.data.d}set duration(t){this.data.d=t}get width(){return this.data.w}set width(t){this.data.w=t}get height(){return this.data.h}set height(t){this.data.h=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}mirror(){return this.posX=se-1-this.posX,this}isInteractive(){return this.posX<0&&this.width>1-this.posX||this.width>1||this.posX===1||this.posX===2}hasZero(){return this.duration===0||this.width===0||this.height===0}hasNegative(){return this.posY<0||this.duration<0||this.width<0||this.height<0}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}isLonger(t,e=0){return this.time+this.duration>t.time+t.duration+e}hasMappingExtensions(){return this.posY>2||this.posX<=-1e3||this.posX>=1e3}isValid(){return!this.hasMappingExtensions()&&!this.hasZero()&&!this.hasNegative()}};let fe=$t;fe.default={b:0,x:0,y:0,d:1,w:1,h:1,customData:()=>({})};const ve=class extends Ne{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s;return e.push(new this({b:(n=i.b)!=null?n:ve.default.b,e:(r=i.e)!=null?r:ve.default.e,r:(a=i.r)!=null?a:ve.default.r,customData:(s=i.customData)!=null?s:ve.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:ve.default.b,e:ve.default.e,r:ve.default.r,customData:ve.default.customData()})}toObject(){return{b:this.time,e:this.executionTime,r:this.rotation,customData:xt(this.customData)}}get executionTime(){return this.data.e}set executionTime(t){this.data.e=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}setExecutionTime(t){return this.executionTime=t,this}setRotation(t){return this.rotation=t,this}};let bn=ve;bn.default={b:0,e:0,r:0,customData:()=>({})};const pt=class extends nl{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o,c,l,u,p,g,d,m,_;return e.push(new this({b:(n=i.b)!=null?n:pt.default.b,c:(r=i.c)!=null?r:pt.default.c,x:(a=i.x)!=null?a:pt.default.x,y:(s=i.y)!=null?s:pt.default.y,d:(o=i.d)!=null?o:pt.default.d,mu:(c=i.mu)!=null?c:pt.default.mu,tb:(l=i.tb)!=null?l:pt.default.tb,tx:(u=i.tx)!=null?u:pt.default.tx,ty:(p=i.ty)!=null?p:pt.default.ty,tc:(g=i.tc)!=null?g:pt.default.tc,tmu:(d=i.tmu)!=null?d:pt.default.tmu,m:(m=i.m)!=null?m:pt.default.m,customData:(_=i.customData)!=null?_:pt.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:pt.default.b,c:pt.default.c,x:pt.default.x,y:pt.default.y,d:pt.default.d,mu:pt.default.mu,tb:pt.default.tb,tx:pt.default.tx,ty:pt.default.ty,tc:pt.default.tc,tmu:pt.default.tmu,m:pt.default.m,customData:pt.default.customData()})}toObject(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,mu:this.lengthMultiplier,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,tc:this.tailDirection,tmu:this.tailLengthMultiplier,m:this.midAnchor,customData:xt(this.customData)}}get lengthMultiplier(){return this.data.mu}set lengthMultiplier(t){this.data.mu=t}get tailLengthMultiplier(){return this.data.tmu}set tailLengthMultiplier(t){this.data.tmu=t}get tailDirection(){return this.data.tc}set tailDirection(t){this.data.tc=t}get midAnchor(){return this.data.m}set midAnchor(t){this.data.m=t}setLengthMultiplier(t){return this.lengthMultiplier=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setTailDirection(t){return this.tailDirection=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0){switch(this.posX=se-1-this.posX,this.tailPosX=se-1-this.tailPosX,t&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}switch(this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),this}getAngle(){return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):Vt[this.direction]||0}hasMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360||this.tailDirection>=1e3&&this.tailDirection<=1360}isValid(){return!(this.hasMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)}};let yn=pt;yn.default={b:0,c:0,x:0,y:0,d:0,mu:1,tb:0,tx:0,ty:0,tc:0,tmu:1,m:0,customData:()=>({})};const ae=class extends Ne{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var n,r,a,s,o;return e.push(new this({b:(n=i.b)!=null?n:ae.default.b,x:(r=i.x)!=null?r:ae.default.x,y:(a=i.y)!=null?a:ae.default.y,d:(s=i.d)!=null?s:ae.default.d,customData:(o=i.customData)!=null?o:ae.default.customData()}))}),e.length===1?e[0]:e.length?e:new this({b:ae.default.b,x:ae.default.x,y:ae.default.y,d:ae.default.d,customData:ae.default.customData()})}toObject(){return{b:this.time,x:this.posX,y:this.posY,d:this.direction,customData:xt(this.customData)}}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get direction(){return this.data.d}set direction(t){this.data.d=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDirection(t){return this.direction=t,this}mirror(){switch(this.posX=se-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}};let vn=ae;vn.default={b:0,x:0,y:0,d:1,customData:()=>({})};class ul extends Ht{constructor(e){var i,n,r,a,s,o,c,l,u,p,g,d,m,_,b,y,v,S,C,x,F,M,H,$,U,K,k,N;super(e),this._fileName="UnnamedDifficulty.dat",this.nps=h=>{const T=this.getNoteContainer().filter(J=>J.type!=="bomb");return h?T.length/h:0},this.peak=(h,T)=>{let J=0,X=0;const at=typeof T=="number"?T:T.value,Y=this.getNoteContainer().filter(Q=>Q.type!=="bomb");for(let Q=0;Q<Y.length;Q++){for(;Y[Q].data.time-Y[X].data.time>h;)X++;J=Math.max(J,(Q-X+1)/(h/at*60))}return J},this.getFirstInteractiveTime=()=>{const h=this.getNoteContainer().filter(X=>X.type!=="bomb");let T=Number.MAX_VALUE;h.length>0&&(T=h[0].data.time);const J=this.findFirstInteractiveObstacleTime();return Math.min(T,J)},this.getLastInteractiveTime=()=>{const h=this.getNoteContainer().filter(X=>X.type!=="bomb");let T=0;h.length>0&&(T=h[h.length-1].data.time);const J=this.findLastInteractiveObstacleTime();return Math.max(T,J)},this.findFirstInteractiveObstacleTime=()=>{for(let h=0,T=this.obstacles.length;h<T;h++)if(this.obstacles[h].isInteractive())return this.obstacles[h].time;return Number.MAX_VALUE},this.findLastInteractiveObstacleTime=()=>{let h=0;for(let T=this.obstacles.length-1;T>=0;T--)this.obstacles[T].isInteractive()&&(h=Math.max(h,this.obstacles[T].time+this.obstacles[T].duration));return h},this.getNoteContainer=()=>{const h=[];return this.colorNotes.forEach(T=>h.push({type:"note",data:T})),this.sliders.forEach(T=>h.push({type:"slider",data:T})),this.burstSliders.forEach(T=>h.push({type:"burstSlider",data:T})),this.bombNotes.forEach(T=>h.push({type:"bomb",data:T})),h.sort((T,J)=>T.data.time-J.data.time)},this.getEventContainer=()=>{const h=[];return this.basicBeatmapEvents.forEach(T=>h.push({type:"basicEvent",data:T})),this.colorBoostBeatmapEvents.forEach(T=>h.push({type:"boost",data:T})),h.sort((T,J)=>T.data.time-J.data.time)},this.addBPMEvents=(...h)=>{h.forEach(T=>{this.bpmEvents.push(gn.create(T))})},this.addRotationEvents=(...h)=>{h.forEach(T=>{this.rotationEvents.push(bn.create(T))})},this.addColorNotes=(...h)=>{h.forEach(T=>{this.colorNotes.push(mi.create(T))})},this.addBombNotes=(...h)=>{h.forEach(T=>{this.bombNotes.push(pn.create(T))})},this.addObstacles=(...h)=>{h.forEach(T=>{this.obstacles.push(fe.create(T))})},this.addSliders=(...h)=>{h.forEach(T=>{this.sliders.push(yn.create(T))})},this.addBurstSliders=(...h)=>{h.forEach(T=>{this.burstSliders.push(xa.create(T))})},this.addWaypoints=(...h)=>{h.forEach(T=>{this.waypoints.push(vn.create(T))})},this.addBasicBeatmapEvents=(...h)=>{h.forEach(T=>{this.basicBeatmapEvents.push(mn.create(T))})},this.addColorBoostBeatmapEvents=(...h)=>{h.forEach(T=>{this.colorBoostBeatmapEvents.push(_n.create(T))})},this.addLightColorEventBoxGroups=(...h)=>{h.forEach(T=>{this.lightColorEventBoxGroups.push(Ca.create(T))})},this.addLightRotationEventBoxGroups=(...h)=>{h.forEach(T=>{this.lightRotationEventBoxGroups.push(Da.create(T))})},this.version=(i=e.version)!=null?i:"3.0.0",this.bpmEvents=(r=(n=e.bpmEvents)==null?void 0:n.map(h=>gn.create(h)))!=null?r:[],this.rotationEvents=(s=(a=e.rotationEvents)==null?void 0:a.map(h=>bn.create(h)))!=null?s:[],this.colorNotes=(c=(o=e.colorNotes)==null?void 0:o.map(h=>mi.create(h)))!=null?c:[],this.bombNotes=(u=(l=e.bombNotes)==null?void 0:l.map(h=>pn.create(h)))!=null?u:[],this.obstacles=(g=(p=e.obstacles)==null?void 0:p.map(h=>fe.create(h)))!=null?g:[],this.sliders=(m=(d=e.sliders)==null?void 0:d.map(h=>yn.create(h)))!=null?m:[],this.burstSliders=(b=(_=e.burstSliders)==null?void 0:_.map(h=>xa.create(h)))!=null?b:[],this.waypoints=(v=(y=e.waypoints)==null?void 0:y.map(h=>vn.create(h)))!=null?v:[],this.basicBeatmapEvents=(C=(S=e.basicBeatmapEvents)==null?void 0:S.map(h=>mn.create(h)))!=null?C:[],this.colorBoostBeatmapEvents=(F=(x=e.colorBoostBeatmapEvents)==null?void 0:x.map(h=>_n.create(h)))!=null?F:[],this.lightColorEventBoxGroups=(H=(M=e.lightColorEventBoxGroups)==null?void 0:M.map(h=>Ca.create(h)))!=null?H:[],this.lightRotationEventBoxGroups=(U=($=e.lightRotationEventBoxGroups)==null?void 0:$.map(h=>Da.create(h)))!=null?U:[],this.basicEventTypesWithKeywords=(K=Ma.create(e.basicEventTypesWithKeywords))!=null?K:{d:[]},this.useNormalEventsAsCompatibleEvents=(k=e.useNormalEventsAsCompatibleEvents)!=null?k:!1,this.customData=(N=e.customData)!=null?N:{}}static create(e={}){var i,n,r,a,s,o,c,l,u,p,g,d,m,_,b;return new this({version:e.version||"3.0.0",bpmEvents:(i=e.bpmEvents)!=null?i:[],rotationEvents:(n=e.rotationEvents)!=null?n:[],colorNotes:(r=e.colorNotes)!=null?r:[],bombNotes:(a=e.bombNotes)!=null?a:[],obstacles:(s=e.obstacles)!=null?s:[],sliders:(o=e.sliders)!=null?o:[],burstSliders:(c=e.burstSliders)!=null?c:[],waypoints:(l=e.waypoints)!=null?l:[],basicBeatmapEvents:(u=e.basicBeatmapEvents)!=null?u:[],colorBoostBeatmapEvents:(p=e.colorBoostBeatmapEvents)!=null?p:[],lightColorEventBoxGroups:(g=e.lightColorEventBoxGroups)!=null?g:[],lightRotationEventBoxGroups:(d=e.lightRotationEventBoxGroups)!=null?d:[],basicEventTypesWithKeywords:(m=e.basicEventTypesWithKeywords)!=null?m:{d:[]},useNormalEventsAsCompatibleEvents:(_=e.useNormalEventsAsCompatibleEvents)!=null?_:!1,customData:(b=e.customData)!=null?b:{}})}toObject(){return{version:this.version||"3.0.0",bpmEvents:this.bpmEvents.map(e=>e.toObject()),rotationEvents:this.rotationEvents.map(e=>e.toObject()),colorNotes:this.colorNotes.map(e=>e.toObject()),bombNotes:this.bombNotes.map(e=>e.toObject()),obstacles:this.obstacles.map(e=>e.toObject()),sliders:this.sliders.map(e=>e.toObject()),burstSliders:this.burstSliders.map(e=>e.toObject()),waypoints:this.waypoints.map(e=>e.toObject()),basicBeatmapEvents:this.basicBeatmapEvents.map(e=>e.toObject()),colorBoostBeatmapEvents:this.colorBoostBeatmapEvents.map(e=>e.toObject()),lightColorEventBoxGroups:this.lightColorEventBoxGroups.map(e=>e.toObject()),lightRotationEventBoxGroups:this.lightRotationEventBoxGroups.map(e=>e.toObject()),basicEventTypesWithKeywords:this.basicEventTypesWithKeywords.toObject(),useNormalEventsAsCompatibleEvents:this.useNormalEventsAsCompatibleEvents,customData:xt(this.customData)}}set fileName(e){this._fileName=e.trim()}get fileName(){return this._fileName}setFileName(e){return this.fileName=e,this}}const Gn=t=>`[shared::parse::${t}]`;function cu(t){return et.info(Gn("info"),"Parsing beatmap info v2.x.x"),t._difficultyBeatmapSets.sort((e,i)=>ia[e._beatmapCharacteristicName]-ia[i._beatmapCharacteristicName]),t._difficultyBeatmapSets.forEach(e=>{let i=0;e._difficultyBeatmaps.forEach(n=>{n._difficultyRank-i<=0&&et.warn(Gn("info"),n._difficulty+" is unordered"),Ts[n._difficulty]!==n._difficultyRank&&et.error(Gn("info"),n._difficulty+" has invalid rank"),i=n._difficultyRank}),e._difficultyBeatmaps.sort((n,r)=>n._difficultyRank-r._difficultyRank)}),t}const kr=t=>`[shared::dataCheck::${t}]`;function $i(t,e,i,n){if(et.verbose(kr("deepCheck"),`Looking up ${i}`),Array.isArray(t)){t.forEach((a,s)=>$i(a,e,`${i}[${s}]`,n));return}const r=Object.keys(e);for(const a in t){if(!r.length)break;r.includes(a)||et.warn(kr("deepCheck"),`Unused key ${a} found in ${i}`)}for(const a in e){if(typeof t[a]=="undefined"){if(e[a].optional||Zc(n,e[a].version)==="old")continue;throw Error(`Missing ${a} in object ${i}!`)}if(t[a]==null)throw Error(`${a} contain null value in object ${i}!`);if(e[a].type==="array"){if(!Array.isArray(t[a]))throw Error(`${a} is not an array in object ${i}!`);$i(t[a],e[a].check,`${i} ${a}`,n)}if(e[a].type==="object"){if(!Array.isArray(t[a])&&typeof t[a]!="object")throw Error(`${a} is not an object in object ${i}!`);$i(t[a],e[a].check,`${i} ${a}`,n)}if(e[a].type!=="array"&&typeof t[a]!==e[a].type)throw Error(`${a} is not ${e[a].type} in object ${i}!`)}}const uu={_time:{type:"number",version:"2.0.0"},_type:{type:"number",version:"2.0.0"},_lineIndex:{type:"number",version:"2.0.0"},_lineLayer:{type:"number",version:"2.0.0"},_cutDirection:{type:"number",version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},hu={_colorType:{type:"number",version:"2.0.0"},_headTime:{type:"number",version:"2.0.0"},_headLineIndex:{type:"number",version:"2.0.0"},_headLineLayer:{type:"number",version:"2.0.0"},_headCutDirection:{type:"number",version:"2.0.0"},_headControlPointlengthMultiplier:{type:"number",version:"2.0.0"},_tailTime:{type:"number",version:"2.0.0"},_tailLineIndex:{type:"number",version:"2.0.0"},_tailLineLayer:{type:"number",version:"2.0.0"},_tailCutDirection:{type:"number",version:"2.0.0"},_tailControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_sliderMidAnchorMode:{type:"number",version:"2.0.0"}},du={_time:{type:"number",version:"2.0.0"},_lineIndex:{type:"number",version:"2.0.0"},_lineLayer:{type:"number",version:"2.6.0",optional:!0},_type:{type:"number",version:"2.0.0"},_duration:{type:"number",version:"2.0.0"},_width:{type:"number",version:"2.0.0"},_height:{type:"number",version:"2.6.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},fu={_time:{type:"number",version:"2.0.0"},_type:{type:"number",version:"2.0.0"},_value:{type:"number",version:"2.0.0"},_floatValue:{type:"number",version:"2.5.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},mu={_time:{type:"number",version:"2.2.0"},_lineIndex:{type:"number",version:"2.2.0"},_lineLayer:{type:"number",version:"2.2.0"},_offsetDirection:{type:"number",version:"2.2.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},pu={_keyword:{type:"string",version:"2.4.0"},_specialEvents:{type:"number",version:"2.4.0"}},gu={_keywords:{type:"array",version:"2.4.0",check:pu}},_u={_version:{type:"string",version:"2.0.0"},_notes:{type:"array",version:"2.0.0",check:uu},_sliders:{type:"array",version:"2.6.0",check:hu},_obstacles:{type:"array",version:"2.0.0",check:du},_events:{type:"array",version:"2.0.0",check:fu},_waypoints:{type:"array",version:"2.2.0",check:mu},_specialEventsKeywordFilters:{type:"object",version:"2.4.0",check:gu,optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},xr=t=>`[v2::parse::${t}]`;function bu(t){var e,i,n,r,a,s;return et.info(xr("difficulty"),"Parsing beatmap difficulty v2.x.x"),(e=t._version)!=null&&e.startsWith("2")||(et.warn(xr("difficulty"),"Unidentified beatmap version"),t._version="2.0.0"),$i(t,_u,"difficulty",t._version),t._notes=(i=t._notes)!=null?i:[],t._sliders=(n=t._sliders)!=null?n:[],t._obstacles=(r=t._obstacles)!=null?r:[],t._events=(a=t._events)!=null?a:[],t._waypoints=(s=t._waypoints)!=null?s:[],t._notes.sort((o,c)=>o._time-c._time),t._sliders.sort((o,c)=>o._headTime-c._headTime),t._obstacles.sort((o,c)=>o._time-c._time),t._events.sort((o,c)=>o._time-c._time),t._waypoints.sort((o,c)=>o._time-c._time),su.create(t)}const yu={b:{type:"number",version:"3.0.0"},c:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},a:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},vu={b:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Eu={b:{type:"number",version:"3.0.0"},c:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},mu:{type:"number",version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",version:"3.0.0"},ty:{type:"number",version:"3.0.0"},tc:{type:"number",version:"3.0.0"},tmu:{type:"number",version:"3.0.0"},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},wu={b:{type:"number",version:"3.0.0"},c:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",version:"3.0.0"},ty:{type:"number",version:"3.0.0"},sc:{type:"number",version:"3.0.0"},s:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Su={b:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},w:{type:"number",version:"3.0.0"},h:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ku={b:{type:"number",version:"3.0.0"},et:{type:"number",version:"3.0.0"},i:{type:"number",version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},xu={b:{type:"number",version:"3.0.0"},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Cu={b:{type:"number",version:"3.0.0"},e:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Du={b:{type:"number",version:"3.0.0"},o:{type:"boolean",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},hl={f:{type:"number",version:"3.0.0"},p:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"}},Tu={b:{type:"number",version:"3.0.0"},i:{type:"number",version:"3.0.0"},c:{type:"number",version:"3.0.0"},s:{type:"number",version:"3.0.0"},f:{type:"number",version:"3.0.0"}},Lu={f:{type:"object",version:"3.0.0",check:hl},w:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Tu},b:{type:"number",version:"3.0.0"}},Ru={b:{type:"number",version:"3.0.0"},g:{type:"number",version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Lu},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Au={b:{type:"number",version:"3.0.0"},p:{type:"number",version:"3.0.0"},e:{type:"number",version:"3.0.0"},l:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},o:{type:"number",version:"3.0.0"}},Bu={f:{type:"object",version:"3.0.0",check:hl},w:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},s:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},a:{type:"number",version:"3.0.0"},l:{type:"array",version:"3.0.0",check:Au},r:{type:"number",version:"3.0.0"},b:{type:"number",version:"3.0.0"}},Iu={b:{type:"number",version:"3.0.0"},g:{type:"number",version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Bu},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},$u={k:{type:"string",version:"3.0.0"},e:{type:"number",version:"3.0.0"}},Nu={d:{type:"array",version:"3.0.0",check:$u,optional:!0}},Mu={b:{type:"number",version:"3.0.0"},d:{type:"number",version:"3.0.0"},x:{type:"number",version:"3.0.0"},y:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Pu={version:{type:"string",version:"3.0.0"},bpmEvents:{type:"array",version:"3.0.0",check:xu,optional:!0},rotationEvents:{type:"array",version:"3.0.0",check:Cu,optional:!0},colorNotes:{type:"array",version:"3.0.0",check:yu,optional:!0},bombNotes:{type:"array",version:"3.0.0",check:vu,optional:!0},obstacles:{type:"array",version:"3.0.0",check:Su,optional:!0},sliders:{type:"array",version:"3.0.0",check:Eu,optional:!0},burstSliders:{type:"array",version:"3.0.0",check:wu,optional:!0},waypoints:{type:"array",version:"3.0.0",check:Mu,optional:!0},basicBeatmapEvents:{type:"array",version:"3.0.0",check:ku,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:Du,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:Ru,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:Iu,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"3.0.0",check:Nu},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Cr=t=>`[v3::parse::${t}]`,Ut=(t,e)=>t.b-e.b;function Ou(t){var e,i,n,r,a,s,o,c,l,u,p,g;return et.info(Cr("difficulty"),"Parsing beatmap difficulty v3.x.x"),t.version!=="3.0.0"&&(et.warn(Cr("difficulty"),"Unidentified beatmap version"),t.version="3.0.0"),$i(t,Pu,"difficulty",t.version),t.bpmEvents=(e=t.bpmEvents)!=null?e:[],t.rotationEvents=(i=t.rotationEvents)!=null?i:[],t.colorNotes=(n=t.colorNotes)!=null?n:[],t.bombNotes=(r=t.bombNotes)!=null?r:[],t.obstacles=(a=t.obstacles)!=null?a:[],t.sliders=(s=t.sliders)!=null?s:[],t.burstSliders=(o=t.burstSliders)!=null?o:[],t.waypoints=(c=t.waypoints)!=null?c:[],t.basicBeatmapEvents=(l=t.basicBeatmapEvents)!=null?l:[],t.colorBoostBeatmapEvents=(u=t.colorBoostBeatmapEvents)!=null?u:[],t.lightColorEventBoxGroups=(p=t.lightColorEventBoxGroups)!=null?p:[],t.lightRotationEventBoxGroups=(g=t.lightRotationEventBoxGroups)!=null?g:[],t.bpmEvents.sort(Ut),t.rotationEvents.sort(Ut),t.colorNotes.sort(Ut),t.bombNotes.sort(Ut),t.obstacles.sort(Ut),t.sliders.sort(Ut),t.burstSliders.sort(Ut),t.waypoints.sort(Ut),t.basicBeatmapEvents.sort(Ut),t.colorBoostBeatmapEvents.sort(Ut),t.lightColorEventBoxGroups.sort(Ut),t.lightRotationEventBoxGroups.sort(Ut),ul.create(t)}var ct=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_UNLIT_BOMB=10]="EVENTS_UNLIT_BOMB",t[t.NOTES_EFFECTIVE_BPM=11]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=12]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=13]="NOTES_PARITY",t[t.NOTES_VARY_SWING=14]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=15]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=16]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=17]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=18]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=19]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=20]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=21]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=22]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=23]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=24]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=25]="NOTES_HITBOX_PATH",t[t.NOTES_COLOR_CHECK=26]="NOTES_COLOR_CHECK",t[t.NOTES_STACKED_NOTE=27]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=28]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=29]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=30]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=31]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=32]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=33]="OBSTACLES_NEGATIVE",t))(ct||{}),ut=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_UNLIT_BOMB=10]="EVENTS_UNLIT_BOMB",t[t.NOTES_COLOR_CHECK=11]="NOTES_COLOR_CHECK",t[t.NOTES_EFFECTIVE_BPM=12]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=13]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=14]="NOTES_PARITY",t[t.NOTES_VARY_SWING=15]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=16]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=17]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=18]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=19]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=20]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=21]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=22]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=23]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=24]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=25]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=26]="NOTES_HITBOX_PATH",t[t.NOTES_STACKED_NOTE=27]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=28]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=29]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=30]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=31]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=32]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=33]="OBSTACLES_NEGATIVE",t))(ut||{});function ht(t,e){const i=document.createElement("div");return e?i.innerHTML=`<b>${t}:</b> ${e}`:i.innerHTML=`<b>${t}</b>`,i}function dt(t,e,i){const n=document.createElement("div");return n.innerHTML=`<b>${t} [${e.length}]:</b> ${e.map(r=>{switch(nt.beatNumbering){case"realtime":return`<span title="Beat ${P(i.adjustTime(r),nt.rounding)}">${kt(i.toRealTime(r))}</span>`;case"realtimems":return`<span title="Beat ${P(i.adjustTime(r),nt.rounding)}">${rn(i.toRealTime(r))}</span>`;case"jsontime":return`<span title="Time ${rn(i.toRealTime(r))}">${P(r,nt.rounding)}</span>`;case"beattime":default:return`<span title="Time ${rn(i.toRealTime(r))}">${P(i.adjustTime(r),nt.rounding)}</span>`}}).join(", ")}`,n}const Ta=class{constructor(){}};let ot=Ta;ot.list=[];ot.create=(t,e,i,n)=>{const r=t.trim().toLowerCase().replace(" ","-");if(Ta.list.includes(r))throw new Error(r+" is already being used.");Ta.list.push(r);const a=document.createElement("div"),s=document.createElement("input"),o=document.createElement("label");return o.textContent=" "+t,o.title=e,o.htmlFor="input__tools-"+r,s.id="input__tools-"+r,s.className="input-toggle",s.type="checkbox",s.checked=i,s.addEventListener("change",n),a.appendChild(s),a.appendChild(o),a};const Dr="Validate Cover Image",Tr="Validate cover image.",Lr=!0,En={name:Dr,description:Tr,type:"general",order:{input:ct.GENERAL_COVER_IMAGE,output:ut.GENERAL_COVER_IMAGE},input:{enabled:Lr,params:{},html:ot.create(Dr,Tr,Lr,function(){En.input.enabled=this.checked})},output:{html:null},run:Fu};function Fu(){const t=new Image,e=Nt.getCoverImage(),i=[];if(fi.loading.coverImage&&e!==null?(t.src=e,t.width!==t.height&&i.push(ht("Cover image is not square","resize to fit square")),(t.width<256||t.height<256)&&i.push(ht("Cover image is too small","require at least 256x256"))):i.push(ht("No cover image",nt.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),i.length){const n=document.createElement("div");i.forEach(r=>n.append(r)),En.output.html=n}else En.output.html=null}const Rr="Audio Duration",Ar="For ranking purpose, check for audio duration.",Br=!0,Ni={name:Rr,description:Ar,type:"general",order:{input:ct.GENERAL_AUDIO,output:ut.GENERAL_AUDIO},input:{enabled:Br,params:{},html:ot.create(Rr,Ar,Br,function(){Ni.input.enabled=this.checked})},output:{html:null},run:zu};function zu(t){const{audioDuration:e}=t.settings;e&&e<20?Ni.output.html=ht("Unrankable audio length",`too short (${kt(e)}s)`):fi.loading.audio?Ni.output.html=null:Ni.output.html=ht("No audio",nt.load.audio?"could not be loaded or not found":"no audio mode is enabled")}const Ir="Preview Time",$r="Warn default editor preview time.",Nr=!0,wn={name:Ir,description:$r,type:"general",order:{input:ct.GENERAL_PREVIEW_TIME,output:ut.GENERAL_PREVIEW_TIME},input:{enabled:Nr,params:{},html:ot.create(Ir,$r,Nr,function(){wn.input.enabled=this.checked})},output:{html:null},run:Xu};function Xu(t){const{_previewStartTime:e,_previewDuration:i}=t.info;if(e===12&&i===10){const n=document.createElement("div");n.innerHTML="<b>Default preview time:</b> strongly recommended to set for audience's 1st impression",wn.output.html=n}else wn.output.html=null}function ju(t){return Math.max(...t.map(e=>e.ebpm),0)}function Hu(t){return Math.max(...t.map(e=>e.ebpmSwing),0)}function dl(t,e,i){return t.direction===8&&e.direction===8&&i!==8&&(t.posX>e.posX&&(i===5||i===3||i===7)||t.posX<e.posX&&(i===6||i===2||i===4)||t.posY>e.posY&&(i===4||i===0||i===5)||t.posY<e.posY&&(i===6||i===1||i===7))||t.posX>e.posX&&(t.direction===5||t.direction===3||t.direction===7||(e.direction===5||e.direction===3||e.direction===7)&&t.direction===8)||t.posX<e.posX&&(t.direction===6||t.direction===2||t.direction===4||(e.direction===6||e.direction===2||e.direction===4)&&t.direction===8)||t.posY>e.posY&&(t.direction===4||t.direction===0||t.direction===5||(e.direction===4||e.direction===0||e.direction===5)&&t.direction===8)||t.posY<e.posY&&(t.direction===6||t.direction===1||t.direction===7||(e.direction===6||e.direction===1||e.direction===7)&&t.direction===8)}function La(t,e,i,n=!1){const[r,a]=t.getPosition(),[s,o]=e.getPosition(),c=t.getAngle(),l=e.getAngle(),u=n?540:360;let p=!1;if(t.direction!==8){const d=(Zn(Math.atan2(a-o,r-s))+450)%360;for(const[m,_,b]of i){const y=b!=null?b:0,v=(c+u-m+y)%360,S=(c+u+m+y)%360;if(p=_>=Math.sqrt(Math.pow(r-s,2)+Math.pow(a-o,2))&&(v<S&&v<=d&&d<=S||v>=S&&(d<=S||d>=v))||p,p)break}}let g=!1;if(e.direction!==8){const d=(Zn(Math.atan2(o-a,s-r))+450)%360;for(const[m,_,b]of i){const y=b!=null?b:0,v=(l+u-m+y)%360,S=(l+u+m+y)%360;if(g=_>=Math.sqrt(Math.pow(r-s,2)+Math.pow(a-o,2))&&(v<S&&v<=d&&d<=S||v>=S&&(d<=S||d>=v))||g,g)break}}return[p,g]}function Mr(t,e){if(dl(t,e,8))return t.direction===8?e.direction:t.direction;if(t.direction!==8)return t.direction;if(t.time>e.time){if(t.posX>e.posX&&t.isHorizontal(e))return 3;if(t.posX<e.posX&&t.isHorizontal(e))return 2;if(t.posY>e.posY){if(t.isVertical(e))return 0;if(t.posX>e.posX)return 5;if(t.posX<e.posX)return 4}if(t.posY<e.posY){if(t.isVertical(e))return 1;if(t.posX>e.posX)return 7;if(t.posX<e.posX)return 6}}return 8}function zi(t,e,i,n){let r,a;if(t===null||e===null)return!1;if(typeof t=="number")r=t;else{if(t.direction===8)return!1;r=t.getAngle()}if(typeof e=="number")a=e;else{if(e.direction===8)return!1;a=e.getAngle()}return n?_r(r,a,360)<=i:_r(r,a,360)>=i}class Rt{constructor(e){this.time=e.time,this.duration=e.duration,this.minSpeed=e.minSpeed,this.maxSpeed=e.maxSpeed,this.ebpm=e.ebpm,this.ebpmSwing=e.ebpmSwing,this.data=e.data}static generate(e,i){const n=[];let r=0,a=0,s,o;const c={},l={},u={0:[],1:[]};for(const p of e)p.type==="note"&&(s=0,o=Number.MAX_SAFE_INTEGER,l[p.data.color]?this.next(p,l[p.data.color],i,u[p.data.color])&&(a=this.calcEBPMBetweenObject(p.data,c[p.data.color].data,i.value),r=this.calcEBPMBetweenObject(p.data,l[p.data.color].data,i.value),s=this.calcMinSliderSpeed(u[p.data.color],i),o=this.calcMaxSliderSpeed(u[p.data.color],i),s>0&&o!==1/0||(s=0,o=0),n.push({time:c[p.data.color].data.time,duration:l[p.data.color].data.time-c[p.data.color].data.time,data:u[p.data.color],ebpm:r,ebpmSwing:a,maxSpeed:o,minSpeed:s}),c[p.data.color]=p,u[p.data.color]=[]):c[p.data.color]=p,l[p.data.color]=p,u[p.data.color].push(p));for(let p=0;p<2;p++)l[p]&&(a=0,r=0,s=this.calcMinSliderSpeed(u[p],i),o=this.calcMaxSliderSpeed(u[p],i),s>0&&o!==1/0||(s=0,o=0),n.push({time:c[p].data.time,duration:l[p].data.time-c[p].data.time,data:u[p],ebpm:r,ebpmSwing:a,maxSpeed:o,minSpeed:s}));return n}}Rt.next=(t,e,i,n)=>{if(t.type==="bomb"||e.type==="bomb")throw new Error("Invalid type");if(n&&n.length>0&&i.toRealTime(e.data.time)+.005<i.toRealTime(t.data.time)&&t.data.direction!==8){for(const r of n)if(r.type==="note"&&r.data.direction!==8&&zi(t.data,r.data,90,!1))return!0}if(n&&n.length>0){for(const r of n)if(r.type==="note"&&t.data.isInline(r.data))return!0}return t.data.isWindow(e.data)&&i.toRealTime(t.data.time-e.data.time)>.08||i.toRealTime(t.data.time-e.data.time)>.07};Rt.calcEBPMBetweenObject=(t,e,i)=>i/((t.time-e.time)*2);Rt.calcMinSliderSpeed=(t,e)=>{let i=!1,n=!1,r=0;const a=e.toRealTime(Math.max(...t.map((s,o)=>o===0?0:((t[o].data.isHorizontal(t[o-1].data)||t[o].data.isVertical(t[o-1].data))&&!i&&(i=!0,r=(t[o].data.time-t[o-1].data.time)/(t[o].data.getDistance(t[o-1].data)||1)),n=t[o].data.isDiagonal(t[o-1].data)||t[o].data.isSlantedWindow(t[o-1].data)||n,(t[o].data.time-t[o-1].data.time)/(t[o].data.getDistance(t[o-1].data)||1)))));return i&&n?e.toRealTime(r):a};Rt.calcMaxSliderSpeed=(t,e)=>{let i=!1,n=!1,r=Number.MAX_SAFE_INTEGER;const a=e.toRealTime(Math.min(...t.map((s,o)=>o===0?Number.MAX_SAFE_INTEGER:((t[o].data.isHorizontal(t[o-1].data)||t[o].data.isVertical(t[o-1].data))&&!i&&(i=!0,r=(t[o].data.time-t[o-1].data.time)/(t[o].data.getDistance(t[o-1].data)||1)),n=t[o].data.isDiagonal(t[o-1].data)||t[o].data.isSlantedWindow(t[o-1].data)||n,(t[o].data.time-t[o-1].data.time)/(t[o].data.getDistance(t[o-1].data)||1)))));return i&&n?e.toRealTime(r):a};function Yu(t,e,i){const n={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let r,a;for(const s of t){if(s.type!=="note")continue;const o=i.toRealTime(s.data.time);s.data.color===0&&(r?Rt.next(s,r,i)&&n.left[Math.floor(o)]++:n.left[Math.floor(o)]++,r=s),s.data.color===1&&(a?Rt.next(s,a,i)&&n.right[Math.floor(o)]++:n.right[Math.floor(o)]++,a=s)}return n}function Wn(t,e){if(!t.length)return 0;if(t.length<e)return t.reduce((r,a)=>r+a)/t.length;let i=t.slice(0,e).reduce((r,a)=>r+a),n=i;for(let r=0;r<t.length-e;r++)i=i-t[r]+t[r+e],n=Math.max(n,i);return n/e}function Pr(t,e,i,n){const a={characteristic:i,difficulty:n,red:{count:0,peak:0,median:0,total:0},blue:{count:0,peak:0,median:0,total:0},total:{count:0,peak:0,median:0,total:0},container:Rt.generate(t.getNoteContainer(),e)},s=Math.max(e.toRealTime(t.getLastInteractiveTime()-t.getFirstInteractiveTime()),0),o=Math.max(e.toRealTime(t.getLastInteractiveTime()),0),c=Yu(t.getNoteContainer(),o,e),l=c.left.map((d,m)=>d+c.right[m]);if(l.reduce((d,m)=>d+m)===0)return a;const u=[],p=[],g=[];for(let d=0,m=Math.ceil(l.length/10);d<m;d++){const _=d*10;let b=10;b+_>l.length&&(b=l.length-_);const y=c.left.slice(_,_+b),v=c.right.slice(_,_+b),S=l.slice(_,_+b);u.push(y.reduce((C,x)=>C+x)/b),p.push(v.reduce((C,x)=>C+x)/b),g.push(S.reduce((C,x)=>C+x)/b)}return a.red.total=c.left.reduce((d,m)=>d+m),a.red.count=c.left.reduce((d,m)=>d+m)/s,a.red.peak=Wn(c.left,10),a.red.median=Vn(u),a.blue.total=c.right.reduce((d,m)=>d+m),a.blue.count=c.right.reduce((d,m)=>d+m)/s,a.blue.peak=Wn(c.right,10),a.blue.median=Vn(p),a.total.total=a.red.total+a.blue.total,a.total.count=l.reduce((d,m)=>d+m)/s,a.total.peak=Wn(l,10),a.total.median=Vn(g),a}function Uu(t,e){let i=0,n=0;for(const r of t){const a=r.total.count;if(n>0&&a>0&&(i=(1-n/a)*100),n=a>0?a:n,n>e&&i>40)return r}return null}function Vu(t,e){let i=Number.MAX_SAFE_INTEGER,n=0;for(const r of t){const a=r.total.count;if(n>0&&a>0&&(i=(1-n/a)*100),n=a>0?a:n,n>e&&i<10)return r}return null}function Gu(t){let e=0,i=Number.MAX_SAFE_INTEGER;return t.forEach(n=>{const r=n.total.count;r>0&&(e=Math.max(e,r),i=Math.min(i,r))}),e||e&&i?(1-i/e)*100:0}function Or(t){let e=Number.MAX_SAFE_INTEGER;return t.forEach(i=>{const n=i.total.count;n>0&&(e=Math.min(e,n))}),e}function Wu(t){return Math.max(...t.map(e=>e.minSpeed),0)}function qu(t){const e=t.map(i=>i.maxSpeed).filter(i=>i!==0);return e.length?Math.min(...e):0}const Fr="Difficulty Progression",zr="For ranking purpose, check difficuly progression to fit rankability criteria.",Xr=!0,hi={name:Fr,description:zr,type:"general",order:{input:ct.GENERAL_PROGRESSION,output:ut.GENERAL_PROGRESSION},input:{enabled:Xr,params:{},html:ot.create(Fr,zr,Xr,function(){hi.input.enabled=this.checked})},output:{html:null},run:Zu};function Zu(t){const{audioDuration:e}=t.settings;if(!e){hi.output.html=null;return}const i=rt.beatmapDifficulty.map(o=>o.swingAnalysis).filter(o=>o.characteristic==="Standard").sort((o,c)=>o.total.count-c.total.count);if(!i.length){hi.output.html=null;return}const n=e<120?3.2:e<240?4.2:5.2,r=[];e<240&&Or(i)>n&&Gu(i)<60&&r.push(ht(`Minimum SPS not met (<${n})`,`lowest is ${P(Or(i),2)}`));const a=Uu(i,n),s=Vu(i,n);if(a&&e<360&&r.push(ht("Violates progression",`${a.difficulty} exceeded 40% SPS drop`)),s&&e<360&&r.push(ht("Violates progression",`${s.difficulty} has less than 10% SPS drop`)),r.length){const o=document.createElement("div");r.forEach(c=>o.append(c)),hi.output.html=o}else hi.output.html=null}var jr=Object.freeze(Object.defineProperty({__proto__:null,coverImage:En,audio:Ni,previewTime:wn,progression:hi},Symbol.toStringTag,{value:"Module"}));const fl="Effective BPM",ml=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,pl=!0,Oa=450,Fa=350,Yi=ot.create(fl+" threshold",ml,pl,function(){Mt.input.enabled=this.checked}),Me=document.createElement("input"),za=document.createElement("label"),Pe=document.createElement("input"),Xa=document.createElement("label");za.textContent=": ";za.htmlFor="input__tools-ebpm";Me.id="input__tools-ebpm";Me.className="input-toggle input--small";Me.type="number";Me.min="0";Me.value=Oa.toString();Me.addEventListener("change",Ku);Xa.textContent=" (swing): ";Xa.htmlFor="input__tools-ebpms";Pe.id="input__tools-ebpms";Pe.className="input-toggle input--small";Pe.type="number";Pe.min="0";Pe.value=Fa.toString();Pe.addEventListener("change",Qu);Yi.appendChild(za);Yi.appendChild(Me);Yi.appendChild(Xa);Yi.appendChild(Pe);const Mt={name:fl,description:ml,type:"note",order:{input:ct.NOTES_EFFECTIVE_BPM,output:ut.NOTES_EFFECTIVE_BPM},input:{enabled:pl,params:{ebpmThres:Oa,ebpmsThres:Fa},html:Yi,adjustTime:Ju},output:{html:null},run:eh};function Ju(t){Mt.input.params.ebpmThres=P(Math.min(Oa,t.value*2*1.285714),1),Mt.input.params.ebpmsThres=P(Math.min(Fa,t.value*2),1),Me.value=Mt.input.params.ebpmThres.toString(),Pe.value=Mt.input.params.ebpmsThres.toString()}function Ku(){Mt.input.params.ebpmThres=P(Math.abs(parseFloat(this.value)),1),this.value=Mt.input.params.ebpmThres.toString()}function Qu(){Mt.input.params.ebpmsThres=P(Math.abs(parseFloat(this.value)),1),this.value=Mt.input.params.ebpmsThres.toString()}function th(t){const{swingAnalysis:e}=t.difficulty,{ebpmThres:i,ebpmsThres:n}=Mt.input.params,r=e.container.filter(s=>s.ebpm>i).map(s=>s.time),a=e.container.filter(s=>s.ebpmSwing>n).map(s=>s.time);return{base:r,swing:a}}function eh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=th(t),{ebpmThres:i,ebpmsThres:n}=Mt.input.params,r=[];if(e.base.length&&r.push(dt(`>${i}EBPM warning`,e.base,t.settings.bpm)),e.swing.length&&r.push(dt(`>${n}EBPM (swing) warning`,e.swing,t.settings.bpm)),r.length){const a=document.createElement("div");r.forEach(s=>a.append(s)),Mt.output.html=a}else Mt.output.html=null}const gl="Acceptable Beat Precision",_l=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,bl=!0,yl=[8,6],vl=ot.create(gl+": ",_l,bl,function(){ri.input.enabled=this.checked}),Ei=document.createElement("input");Ei.id="input__tools-prec";Ei.className="input-toggle input--small";Ei.type="text";Ei.value=yl.join(" ");Ei.addEventListener("change",ih);vl.appendChild(Ei);const ri={name:gl,description:_l,type:"note",order:{input:ct.NOTES_ACCEPTABLE_PRECISION,output:ut.NOTES_ACCEPTABLE_PRECISION},input:{enabled:bl,params:{prec:[...yl]},html:vl},output:{html:null},run:ah};function ih(){ri.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=ri.input.params.prec.join(" ")}function nh(t,e){const{bpm:i}=t,n=e.swingAnalysis.container,{prec:r}=ri.input.params;return n.map(a=>a.time).filter((a,s,o)=>!s||a!==o[s-1]).filter(a=>{if(!r.length)return!1;for(let s=0;s<r.length;s++)if((i.adjustTime(a)+.001)%(1/r[s])<.01)return!1;return!0})}function ah(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=nh(t.settings,t.difficulty);e.length?ri.output.html=dt("Off-beat precision",e,t.settings.bpm):ri.output.html=null}const Hr="Varying Swing Speed",Yr="Check for varying swing speed due to changes in slider distance.",Ur=!0,Sn={name:Hr,description:Yr,type:"note",order:{input:ct.NOTES_VARY_SWING,output:ut.NOTES_VARY_SWING},input:{enabled:Ur,params:{},html:ot.create(Hr,Yr,Ur,function(){Sn.input.enabled=this.checked})},output:{html:null},run:oh};function rh(t){const{swingAnalysis:e}=t;return e.container.filter(i=>Math.abs(i.minSpeed-i.maxSpeed)>.002).map(i=>i.time).filter((i,n,r)=>!n||i!==r[n-1])}function oh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=rh(t.difficulty);e.length?Sn.output.html=dt("Varying swing speed",e,t.settings.bpm):Sn.output.html=null}const El="Slow Slider",wl="Look for slider that require slow swing.",Sl=!0,kl=.025,wi=document.createElement("div"),Oe=document.createElement("input"),ja=document.createElement("label"),Fe=document.createElement("input"),Ha=document.createElement("label");let pi;ja.textContent="min speed (ms): ";ja.htmlFor="input__tools-slow-slider-time";Oe.id="input__tools-slow-slider-time";Oe.className="input-toggle input--small";Oe.type="number";Oe.min="0";Oe.value=P(kl*1e3,1).toString();Oe.addEventListener("change",lh);Ha.textContent=" (prec): ";Ha.htmlFor="input__tools-slow-slider-prec";Fe.id="input__tools-slow-slider-prec";Fe.className="input-toggle input--small";Fe.type="number";Fe.min="0";Fe.addEventListener("change",ch);wi.appendChild(ot.create(El,wl,Sl,function(){Gt.input.enabled=this.checked}));wi.appendChild(ja);wi.appendChild(Oe);wi.appendChild(Ha);wi.appendChild(Fe);const Gt={name:El,description:wl,type:"note",order:{input:ct.NOTES_SLOW_SLIDER,output:ut.NOTES_SLOW_SLIDER},input:{enabled:Sl,params:{minSpeed:kl},html:wi,adjustTime:sh},output:{html:null},run:hh};function sh(t){pi=t,Fe.value=P(1/pi.toBeatTime(Gt.input.params.minSpeed),2).toString()}function lh(){Gt.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=P(Gt.input.params.minSpeed*1e3,1).toString(),pi&&(Fe.value=P(1/pi.toBeatTime(Gt.input.params.minSpeed),2).toString())}function ch(){if(!pi){this.value="0";return}let t=P(Math.abs(parseFloat(this.value)),2)||1;Gt.input.params.minSpeed=pi.toRealTime(1/t),Oe.value=P(Gt.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}function uh(t){const{swingAnalysis:e}=t.difficulty,{minSpeed:i}=Gt.input.params;return e.container.filter(n=>n.maxSpeed>i||n.minSpeed>i).map(n=>n.time).filter((n,r,a)=>!r||n!==a[r-1])}function hh(t){if(!t.difficulty){console.error("Something went wrong!");return}const{minSpeed:e}=Gt.input.params,i=uh(t);i.length?Gt.output.html=dt(`Slow slider (>${P(e*1e3,1)}ms)`,i,t.settings.bpm):Gt.output.html=null}const xl="Inline Sharp Angle",Cl="Check for angle changes within inline note.",Dl=!0,Tl=.15;let gi;const Si=document.createElement("div"),ze=document.createElement("input"),Ya=document.createElement("label"),ke=document.createElement("input"),Ua=document.createElement("label");Ya.textContent="max time (ms): ";Ya.htmlFor="input__tools-inline-angle-time";ze.id="input__tools-inline-angle-time";ze.className="input-toggle input--small";ze.type="number";ze.min="0";ze.value=P(Tl*1e3,1).toString();ze.addEventListener("change",fh);Ua.textContent=" (beat): ";Ua.htmlFor="input__tools-inline-angle-beat";ke.id="input__tools-inline-angle-beat";ke.className="input-toggle input--small";ke.type="number";ke.min="0";ke.step="0.1";ke.addEventListener("change",mh);Si.appendChild(ot.create(xl,Cl,Dl,function(){re.input.enabled=this.checked}));Si.appendChild(Ya);Si.appendChild(ze);Si.appendChild(Ua);Si.appendChild(ke);const re={name:xl,description:Cl,type:"note",order:{input:ct.NOTES_INLINE_ANGLE,output:ut.NOTES_INLINE_ANGLE},input:{enabled:Dl,params:{maxTime:Tl},html:Si,adjustTime:dh},output:{html:null},run:gh};function dh(t){gi=t,ke.value=P(gi.toBeatTime(re.input.params.maxTime),2).toString()}function fh(){re.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=P(re.input.params.maxTime*1e3,1).toString(),gi&&(ke.value=P(gi.toBeatTime(re.input.params.maxTime),2).toString())}function mh(){if(!gi){this.value="0";return}let t=P(Math.abs(parseFloat(this.value)),2)||1;re.input.params.maxTime=gi.toRealTime(t),ze.value=P(re.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function ph(t){const{bpm:e}=t.settings,i=t.difficulty.noteContainer,{maxTime:n}=re.input.params,r=e.toBeatTime(n)+.001,a={},s={},o={},c={0:[],1:[],3:[]},l=[];let u=0;for(let p=0,g=i.length;p<g;p++){const d=i[p];d.type==="note"&&a[d.data.color]?Rt.next(d,a[d.data.color],e,c[d.data.color])?(o[d.data.color]&&(o[d.data.color]=null,s[d.data.color]=(s[d.data.color]+180)%360),Vr(d.data,i,u,r)&&zi(d.data,s[d.data.color],90,!0)&&l.push(d.data),d.data.direction===8?o[d.data.color]=d.data:s[d.data.color]=d.data.getAngle(),c[d.data.color]=[]):(o[d.data.color]&&Vr(d.data,i,u,r)&&zi(d.data,s[d.data.color],90,!0)&&(l.push(o[d.data.color]),o[d.data.color]=null),d.data.direction!==8&&(s[d.data.color]=d.data.getAngle())):d.type==="note"&&(s[d.data.color]=d.data.getAngle()),d.type==="note"&&(a[d.data.color]=d,c[d.data.color].push(d)),d.type==="bomb"&&(d.data.posY===0&&(d.data.posX===1&&(s[0]=Vt[0],o[0]=null),d.data.posX===2&&(s[1]=Vt[0],o[1]=null)),d.data.posY===2&&(d.data.posX===1&&(s[0]=Vt[1],o[0]=null),d.data.posX===2&&(s[1]=Vt[1],o[1]=null)))}return l.map(p=>p.time).filter(function(p,g,d){return!g||p!==d[g-1]})}function Vr(t,e,i,n){for(let r=i;e[r].data.time<t.time;r++){const a=e[r];if(a.type==="note"&&t.isInline(a.data)&&t.time-e[r].data.time<=n)return!0}return!1}function gh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=ph(t);e.length?re.output.html=dt("Inline sharp angle",e,t.settings.bpm):re.output.html=null}const Ll="shrado Angle",Rl="Look for common negative curvature pattern.",Al=!1,Bl=.15,Il=1;let _i;const xe=document.createElement("div"),oi=document.createElement("input"),Va=document.createElement("label"),Xe=document.createElement("input"),Ga=document.createElement("label"),Ce=document.createElement("input"),Wa=document.createElement("label");Va.textContent="min distance: ";Va.htmlFor="input__tools-shrado-angle-distance";oi.id="input__tools-shrado-angle-distance";oi.className="input-toggle input--small";oi.type="number";oi.min="0";oi.value=Il.toString();oi.addEventListener("change",bh);Ga.textContent="max time (ms): ";Ga.htmlFor="input__tools-shrado-angle-time";Xe.id="input__tools-shrado-angle-time";Xe.className="input-toggle input--small";Xe.type="number";Xe.min="0";Xe.value=P(Bl*1e3,1).toString();Xe.addEventListener("change",yh);Wa.textContent=" (beat): ";Wa.htmlFor="input__tools-shrado-angle-beat";Ce.id="input__tools-shrado-angle-beat";Ce.className="input-toggle input--small";Ce.type="number";Ce.min="0";Ce.step="0.1";Ce.addEventListener("change",vh);xe.appendChild(ot.create(Ll,Rl,Al,function(){Xt.input.enabled=this.checked}));xe.appendChild(Va);xe.appendChild(oi);xe.appendChild(document.createElement("br"));xe.appendChild(Ga);xe.appendChild(Xe);xe.appendChild(Wa);xe.appendChild(Ce);const Xt={name:Ll,description:Rl,type:"note",order:{input:ct.NOTES_SHRADO_ANGLE,output:ut.NOTES_SHRADO_ANGLE},input:{enabled:Al,params:{distance:Il,maxTime:Bl},html:xe,adjustTime:_h},output:{html:null},run:wh};function _h(t){_i=t,Ce.value=P(_i.toBeatTime(Xt.input.params.maxTime),2).toString()}function bh(){Xt.input.params.distance=Math.max(parseInt(this.value),0),this.value=Xt.input.params.distance.toString()}function yh(){Xt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=P(Xt.input.params.maxTime*1e3,1).toString(),_i&&(Ce.value=P(_i.toBeatTime(Xt.input.params.maxTime),2).toString())}function vh(){if(!_i){this.value="0";return}let t=P(Math.abs(parseFloat(this.value)),2)||1;Xt.input.params.maxTime=_i.toRealTime(t),Xe.value=P(Xt.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Eh(t){var p;const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,{maxTime:n,distance:r}=Xt.input.params,a=e.toBeatTime(n)+.001,s={},o={},c={},l={0:[],1:[],3:[]},u=[];for(let g=0,d=i.length;g<d;g++){if(i[g].type!=="note")continue;const m=i[g];s[m.data.color]?Rt.next(m,s[m.data.color],e,l[m.data.color])?(c[m.data.color]&&(c[m.data.color]=null,o[m.data.color]=(p=Gc[o[m.data.color]])!=null?p:8),m.data.getDistance(s[m.data.color].data)>=r&&Gr(m.data.direction,o[m.data.color],m.data.color)&&m.data.time-s[m.data.color].data.time<=a&&u.push(m),m.data.direction===8?c[m.data.color]=m:o[m.data.color]=m.data.direction,l[m.data.color]=[]):(c[m.data.color]&&m.data.getDistance(s[m.data.color].data)>=r&&Gr(m.data.direction,o[m.data.color],m.data.color)&&m.data.time-s[m.data.color].data.time<=a&&(u.push(c[m.data.color]),c[m.data.color]=null),m.data.direction!==8&&(o[m.data.color]=m.data.direction)):o[m.data.color]=m.data.direction,s[m.data.color]=m,l[m.data.color].push(m)}return u.map(g=>g.data.time).filter(function(g,d,m){return!d||g!==m[d-1]})}function Gr(t,e,i){return t===8||e===8?!1:(i===0?e===7:e===6)&&t===0}function wh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Eh(t);e.length?Xt.output.html=dt("Shrado angle",e,t.settings.bpm):Xt.output.html=null}const $l="Speed Pause",Nl="Look for stream/burst containing timing gap causing sudden change of pace.",Ml=!1,Pl=.075;let bi;const ki=document.createElement("div"),je=document.createElement("input"),qa=document.createElement("label"),He=document.createElement("input"),Za=document.createElement("label");qa.textContent="stream speed (ms): ";qa.htmlFor="input__tools-speed-pause-time";je.id="input__tools-speed-pause-time";je.className="input-toggle input--small";je.type="number";je.min="0";je.value=P(Pl*1e3,1).toString();je.addEventListener("change",kh);Za.textContent=" (prec): ";Za.htmlFor="input__tools-speed-pause-prec";He.id="input__tools-speed-pause-prec";He.className="input-toggle input--small";He.type="number";He.min="0";He.addEventListener("change",xh);ki.appendChild(ot.create($l,Nl,Ml,function(){oe.input.enabled=this.checked}));ki.appendChild(qa);ki.appendChild(je);ki.appendChild(Za);ki.appendChild(He);const oe={name:$l,description:Nl,type:"note",order:{input:ct.NOTES_SPEED_PAUSE,output:ut.NOTES_SPEED_PAUSE},input:{enabled:Ml,params:{maxTime:Pl},html:ki,adjustTime:Sh},output:{html:null},run:Dh};function Sh(t){bi=t,He.value=P(1/bi.toBeatTime(oe.input.params.maxTime),2).toString()}function kh(){oe.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=P(oe.input.params.maxTime*1e3,1).toString(),bi&&(He.value=P(1/bi.toBeatTime(oe.input.params.maxTime),2).toString())}function xh(){if(!bi){this.value="0";return}let t=P(Math.abs(parseFloat(this.value)),2)||1;oe.input.params.maxTime=bi.toRealTime(1/t),je.value=P(oe.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Ch(t,e){const{bpm:i}=t,{noteContainer:n}=e,{maxTime:r}=oe.input.params,a=i.toBeatTime(r)+.001,s={},o={},c={0:!1,1:!1,3:!1},l={0:[],1:[],3:[]},u=[];for(let p=0,g=n.length;p<g;p++){if(n[p].type!=="note")continue;const d=n[p];s[d.data.color]?Rt.next(d,s[d.data.color],i,l[d.data.color])&&(d.data.time-s[d.data.color].data.time<=a*2?(c[0]&&c[1]&&s[d.data.color].data.time-o[d.data.color].data.time<=a*3&&u.push(s[d.data.color]),c[d.data.color]=!1):c[d.data.color]||(c[d.data.color]=!0,o[d.data.color]=s[d.data.color]),l[d.data.color]=[],s[d.data.color]=d):s[d.data.color]=d,l[d.data.color].push(d)}return u.map(p=>p.data.time).filter(function(p,g,d){return!g||p!==d[g-1]})}function Dh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Ch(t.settings,t.difficulty);e.length?oe.output.html=dt("Speed pause",e,t.settings.bpm):oe.output.html=null}const Wr="Hitbox Staircase",qr="Check for overlapping post-swing hitbox with note hitbox during swing.",Zr=!0,kn={name:Wr,description:qr,type:"note",order:{input:ct.NOTES_HITBOX_STAIR,output:ut.NOTES_HITBOX_STAIR},input:{enabled:Zr,params:{},html:ot.create(Wr,qr,Zr,function(){kn.input.enabled=this.checked})},output:{html:null},run:Rh};function Th(t,e,i){for(let n=i,r=e.length;n<r;n++)if(e[n].type==="note"){if(e[n].data.time<t.data.time+.01&&e[n].data.color!==t.data.color)return!0;if(e[n].data.time>t.data.time+.01)return!1}return!1}function Lh(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,n=e.toBeatTime(.15),r={},a={},s={},o={0:[],1:[],3:[]},c={0:mi.create(),1:mi.create({c:1})},l=[];for(let u=0,p=i.length;u<p;u++){if(i[u].type!=="note")continue;const g=i[u];r[g.data.color]?(Rt.next(g,r[g.data.color],e,o[g.data.color])?(s[g.data.color]=g.data.time-r[g.data.color].data.time,g.data.direction!==8?(c[g.data.color].posX=g.data.posX+Re[g.data.direction][0],c[g.data.color].posY=g.data.posY+Re[g.data.direction][1]):(c[g.data.color].posX=-1,c[g.data.color].posY=-1),o[g.data.color]=[],a[g.data.color]=g.data.direction):dl(g.data,r[g.data.color].data,a[g.data.color])&&(g.data.direction!==8?(c[g.data.color].posX=g.data.posX+Re[g.data.direction][0],c[g.data.color].posY=g.data.posY+Re[g.data.direction][1],a[g.data.color]=g.data.direction):(c[g.data.color].posX=g.data.posX+Re[a[g.data.color]][0],c[g.data.color].posY=g.data.posY+Re[a[g.data.color]][1])),r[(g.data.color+1)%2]&&g.data.time-r[(g.data.color+1)%2].data.time!==0&&g.data.time-r[(g.data.color+1)%2].data.time<Math.min(n,s[(g.data.color+1)%2])&&g.data.posX===c[(g.data.color+1)%2].posX&&g.data.posY===c[(g.data.color+1)%2].posY&&!Th(g,i,u)&&l.push(g)):(g.data.direction!==8?(c[g.data.color].posX=g.data.posX+Re[g.data.direction][0],c[g.data.color].posY=g.data.posY+Re[g.data.direction][1]):(c[g.data.color].posX=-1,c[g.data.color].posY=-1),a[g.data.color]=g.data.direction),r[g.data.color]=g,o[g.data.color].push(g)}return l.map(u=>u.data.time).filter(function(u,p,g){return!p||u!==g[p-1]})}function Rh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Lh(t);e.length?kn.output.html=dt("Hitbox staircase",e,t.settings.bpm):kn.output.html=null}const Jr="Hitbox Reverse Staircase",Kr="Check for overlapping pre-swing hitbox with note hitbox during swing.",Qr=!0,xn={name:Jr,description:Kr,type:"note",order:{input:ct.NOTES_HITBOX_REVERSE_STAIR,output:ut.NOTES_HITBOX_REVERSE_STAIR},input:{enabled:Qr,params:{},html:ot.create(Jr,Kr,Qr,function(){xn.input.enabled=this.checked})},output:{html:null},run:$h},Ah=.03414823529,Bh=.03414823529;function Ih(t){const{bpm:e,njs:i}=t.settings,{noteContainer:n}=t.difficulty,r={},a={0:[],1:[]},s=[];for(let o=0,c=n.length;o<c;o++){if(n[o].type!=="note")continue;const l=n[o];r[l.data.color]&&Rt.next(l,r[l.data.color],e,a[l.data.color])&&(a[l.data.color]=[]);for(const u of a[(l.data.color+1)%2])if(u.type==="note"&&u.data.direction!==8){if(!(e.toRealTime(l.data.time)>e.toRealTime(u.data.time)+.01))continue;const p=u.data.getAngle()%90>15&&u.data.getAngle()%90<75;if(i.value<1.425/(60*(l.data.time-u.data.time)/e.value+(p?Bh:Ah))&&La(l.data,u.data,[[15,1.5]])[1]){s.push(u);break}}r[l.data.color]=l,a[l.data.color].push(l)}return s.map(o=>o.data.time).filter(function(o,c,l){return!c||o!==l[c-1]})}function $h(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Ih(t);e.length?xn.output.html=dt("Hitbox reverse Staircase",e,t.settings.bpm):xn.output.html=null}const to="Hitbox Inline",eo="Check for overlapping note hitbox for inline note.",io=!0,Cn={name:to,description:eo,type:"note",order:{input:ct.NOTES_HITBOX_INLINE,output:ut.NOTES_HITBOX_INLINE},input:{enabled:io,params:{},html:ot.create(to,eo,io,function(){Cn.input.enabled=this.checked})},output:{html:null},run:Ph},Nh=0;function Mh(t){const{bpm:e,njs:i}=t.settings,{noteContainer:n}=t.difficulty,r={},a={0:[],1:[],3:[]},s=[];for(let o=0,c=n.length;o<c;o++){if(n[o].type!=="note")continue;const l=n[o];r[l.data.color]&&Rt.next(l,r[l.data.color],e,a[l.data.color])&&(a[l.data.color]=[]);for(const u of a[(l.data.color+1)%2])if(u.type==="note"&&i.value<1.425/(60*(l.data.time-u.data.time)/e.value+Nh)&&l.data.isInline(u.data)){s.push(l);break}r[l.data.color]=l,a[l.data.color].push(l)}return s.map(o=>o.data.time).filter(function(o,c,l){return!c||o!==l[c-1]})}function Ph(t){const e=Mh(t);e.length?Cn.output.html=dt("Hitbox inline",e,t.settings.bpm):Cn.output.html=null}const no="Hitbox Path",ao="Check for overlapping pre-swing note hitbox at same time.",ro=!0,Dn={name:no,description:ao,type:"note",order:{input:ct.NOTES_HITBOX_PATH,output:ut.NOTES_HITBOX_PATH},input:{enabled:ro,params:{},html:ot.create(no,ao,ro,function(){Dn.input.enabled=this.checked})},output:{html:null},run:Fh};function Oh(t){const{bpm:e}=t.settings,{colorNotes:i}=t.difficulty.data,n=[];let r=0;for(let a=0,s=i.length;a<s;a++)if(!(e.toRealTime(i[a].time)<r+.01))for(let o=a+1;o<s&&!(e.toRealTime(i[o].time)>e.toRealTime(i[a].time)+.01);o++)i[a].color!==i[o].color&&((i[a].isHorizontal(i[o])||i[a].isVertical(i[o]))&&La(i[a],i[o],[[45,1],[15,2]]).some(c=>c)||i[a].isDiagonal(i[o])&&La(i[a],i[o],[[45,1],[15,1.5]]).some(c=>c))&&(n.push(i[a]),r=e.toRealTime(i[a].time));return n.map(a=>a.time).filter(function(a,s,o){return!s||a!==o[s-1]})}function Fh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Oh(t);e.length?Dn.output.html=dt("Hitbox path",e,t.settings.bpm):Dn.output.html=null}const oo="Improper Arc",so="Check for correct use of arc.",lo=!0,Tn={name:oo,description:so,type:"note",order:{input:ct.NOTES_IMPROPER_ARC,output:ut.NOTES_IMPROPER_ARC},input:{enabled:lo,params:{},html:ot.create(oo,so,lo,function(){Tn.input.enabled=this.checked})},output:{html:null},run:Xh};function zh(t){const e=[...t.difficulty.noteContainer].sort((n,r)=>n.type!=="slider"?1:r.type!=="slider"?-1:0).sort((n,r)=>n.data.time-r.data.time),i=[];for(let n=0,r=!0,a=e.length;n<a;n++){const s=e[n];if(s.type==="slider"){r=!0;for(let o=n,c=!1;o<a;o++){const l=e[o];if(l.type==="note"&&s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001&&s.data.color===l.data.color&&(l.data.direction!==8?s.data.direction===l.data.direction:!0)){for(let u=o;u<a;u++){const p=e[o];if(p.type==="bomb"&&s.data.posX===p.data.posX&&s.data.posY===p.data.posY&&p.data.time<=s.data.time+.001){c=!0;break}if(!(p.type!=="note"||p.data.time<s.data.tailTime)){if(s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001&&(s.data.color!==l.data.color||(l.data.direction!==8?s.data.direction!==l.data.direction:!0))){c=!0;break}if(l.data.time>s.data.tailTime+.001)break}}r=c||!1;break}if(l.type==="bomb"&&s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001||l.data.time>s.data.time+.001)break}r&&i.push(s)}}return i.map(n=>n.data.time).filter(function(n,r,a){return!r||n!==a[r-1]})}function Xh(t){const e=zh(t);e.length?Tn.output.html=dt("Improper arc",e,t.settings.bpm):Tn.output.html=null}const co="Improper Chain",uo="Check for correct use of chain.",ho=!0,Ln={name:co,description:uo,type:"note",order:{input:ct.NOTES_IMPROPER_CHAIN,output:ut.NOTES_IMPROPER_CHAIN},input:{enabled:ho,params:{},html:ot.create(co,uo,ho,function(){Ln.input.enabled=this.checked})},output:{html:null},run:Hh};function jh(t){const e=[...t.difficulty.noteContainer].sort((n,r)=>n.type!=="burstSlider"?1:r.type!=="burstSlider"?-1:0).sort((n,r)=>n.data.time-r.data.time),i=[];for(let n=0,r=!0,a=e.length;n<a;n++){const s=e[n];if(s.type==="burstSlider"){r=!0;for(let o=n;o<a;o++){const c=e[o];if(c.type==="note"&&s.data.posX===c.data.posX&&s.data.posY===c.data.posY&&c.data.time<=s.data.time+.001&&s.data.color===c.data.color&&(c.data.direction!==8?s.data.direction===c.data.direction:!0)){r=!1;break}if(c.type==="bomb"&&s.data.posX===c.data.posX&&s.data.posY===c.data.posY&&c.data.time<=s.data.time+.001||c.data.time>s.data.time+.001)break}r&&i.push(s)}}return i.map(n=>n.data.time).filter(function(n,r,a){return!r||n!==a[r-1]})}function Hh(t){const e=jh(t);e.length?Ln.output.html=dt("Improper chain",e,t.settings.bpm):Ln.output.html=null}const fo="Improper Window Snap",mo="Check for slanted window snap timing.",po=!0,Rn={name:fo,description:mo,type:"note",order:{input:ct.NOTES_IMPROPER_WINDOW,output:ut.NOTES_IMPROPER_WINDOW},input:{enabled:po,params:{},html:ot.create(fo,mo,po,function(){Rn.input.enabled=this.checked})},output:{html:null},run:Uh};function Yh(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,n={},r={0:[],1:[],3:[]},a=[];for(let s=0,o=i.length;s<o;s++){if(i[s].type!=="note")continue;const c=i[s];n[c.data.color]?Rt.next(c,n[c.data.color],e,r[c.data.color])?(n[c.data.color]=c,r[c.data.color]=[]):c.data.isSlantedWindow(n[c.data.color].data)&&c.data.time-n[c.data.color].data.time>=.001&&c.data.direction===n[c.data.color].data.direction&&c.data.direction!==8&&n[c.data.color].data.direction!==8&&a.push(n[c.data.color]):n[c.data.color]=c,r[c.data.color].push(c)}return a.map(s=>s.data.time).filter(function(s,o,c){return!o||s!==c[o-1]})}function Uh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Yh(t);e.length?Rn.output.html=dt("Improper window snap",e,t.settings.bpm):Rn.output.html=null}var Ui={create:(t,e,i,n,...r)=>{const a=document.createElement(i);a.className=n;const s=document.createElement("select");s.className="input-toggle",s.id=t,r.forEach(c=>{const l=document.createElement("option");l.textContent=c.text,l.value=c.value,s.append(l)});const o=document.createElement("label");return o.htmlFor=t,o.innerHTML=`<span>${e}</span>`,a.append(o),a.append(s),a}},Ol=(t=>(t.forehand="backhand",t.backhand="forehand",t))(Ol||{});const tn={0:{forehand:[1,3,6,7],backhand:[0,2,4,5]},1:{forehand:[1,2,6,7],backhand:[0,3,4,5]}},Ze={0:[0,0,90,90,45,-45,45,-45],1:[0,0,-90,-90,-45,45,-45,45]},go={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},Bi=class{constructor(t,e,i,n,r,a){this.color=e,this.warningThreshold=i,this.errorThreshold=n,this.allowedRotation=r,a&&a!=="neutral"?(this.state=a,this.rotation=0):(this.state=this.predictStartState(t,e),this.rotation=this.predictStartRotation(t,e)),this.position=this.predictStartPosition(t,e)}check(t,e){if(this.state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const i=t[0].data.time,n=this.color;let r=this.state,a=this.rotation;e.forEach(l=>{l.data.time-.001>i||(l.data.posY===0&&l.data.posX===(n?2:1)&&(r="backhand",a=0),l.data.posY===2&&l.data.posX===(n?2:1)&&(r="forehand",a=0))});let s,o=8;for(const l of t)l.type==="note"&&(l.data.direction!==8&&(o=l.data.direction),s&&o===8&&(o=Mr(l.data,s.data)),s=l);if(o===8)return"none";const c=go[n][Ol[r]][o];return(a>c?a-c:c-a)>180||c<Bi.CONSTRAINT_ROTATION[n][0]+this.errorThreshold||c>Bi.CONSTRAINT_ROTATION[n][1]-this.errorThreshold?"error":c<Bi.CONSTRAINT_ROTATION[n][0]+this.warningThreshold||c>Bi.CONSTRAINT_ROTATION[n][1]-this.warningThreshold||(a>c?a-c:c-a)>this.allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let s=0;s<t.length;s++){if(t[s].type!=="note")continue;const o=t[s];if(tn[o.data.color].forehand.includes(o.data.direction)){this.state="backhand";break}if(tn[o.data.color].backhand.includes(o.data.direction)){this.state="forehand";break}this.state==="neutral"&&o.data.direction===8&&(o.data.posY===0&&(this.state="backhand"),o.data.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const i=t[0].data.time,n=this.color;e.forEach(s=>{s.data.time-.001>i||(s.data.posY===0&&s.data.posX===(n?2:1)&&(this.state="forehand",this.rotation=0),s.data.posY===2&&s.data.posX===(n?2:1)&&(this.state="backhand",this.rotation=0))});let r,a=8;for(const s of t)s.type==="note"&&(s.data.direction!==8&&(a=s.data.direction),r&&a===8&&(a=Mr(s.data,r.data)),r=s);a!==8&&(this.rotation=go[this.color][this.state][a])}predictStartState(t,e){let i="neutral";for(let n=0,r=t.length;n<r;n++){if(t[n].type==="bomb"&&(t[n].data.posY===0&&(t[n].data.posX,i="backhand"),t[n].data.posY===2&&(t[n].data.posX,i="forehand")),t[n].type!=="note")continue;let a=t[n];if(a.data.color!==Math.abs(e-1)&&a.data.color===e){if(i!=="neutral")break;const s=a.data.time;for(let o=n;o<t.length&&!(t[o].data.time>a.data.time+.001&&s<a.data.time+.001);o++){if(a=t[o],tn[a.data.color].forehand.includes(a.data.direction))return"backhand";if(tn[a.data.color].backhand.includes(a.data.direction))return"forehand";i==="neutral"&&a.data.direction===8&&(a.data.posY===0&&(i="backhand"),a.data.posY>0&&(i="forehand"))}break}}return i}predictStartRotation(t,e){let i=0;for(let n=0,r=t.length;n<r;n++){if(t[n].type!=="note")continue;let a=t[n];if(a.data.color===e&&a.data.color===e){const s=a.data.time;for(let o=n;o<t.length&&!(t[o].data.time>a.data.time+.001&&s<a.data.time+.001);o++){if(a=t[o],a.data.direction!==8)return Ze[a.data.color][a.data.direction];a.data.direction===8&&(a.data.posY===0&&(a.data.posX===0&&(i=Ze[a.data.color][6]),a.data.posX===3&&(i=Ze[a.data.color][7])),a.data.posY===1&&(a.data.posX===0&&(i=Ze[a.data.color][2]),a.data.posX===3&&(i=Ze[a.data.color][3])),a.data.posY===2&&(a.data.posX===0&&(i=Ze[a.data.color][4]),a.data.posX===3&&(i=Ze[a.data.color][5])))}break}}return i}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let Ra=Bi;Ra.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];const Fl="Parity Check",zl="Perform parity check.",Xl=!1,jl=document.createElement("div");Ui.create("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});Ui.create("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Ui.create("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});jl.appendChild(ot.create(Fl+" (EXPERIMENTAL)",zl,Xl,function(){Xi.input.enabled=this.checked}));const Xi={name:Fl,description:zl,type:"note",order:{input:ct.NOTES_PARITY,output:ut.NOTES_PARITY},input:{enabled:Xl,params:{warningThres:90,errorThres:45,allowedRot:90},html:jl},output:{html:null},run:Gh};function Vh(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,{warningThres:n,errorThres:r,allowedRot:a}=Xi.input.params,s={},o={0:[],1:[]},c={0:[],1:[]},l={0:[],1:[]},u={0:new Ra(i,0,n,r,a),1:new Ra(i,1,n,r,a)},p={warning:[],error:[]};for(let g=0,d=i.length;g<d;g++){const m=i[g];if(m.type==="note"&&s[m.data.color]&&Rt.next(m,s[m.data.color],e,o[m.data.color])){switch(u[m.data.color].check(o[m.data.color],l[m.data.color])){case"warning":{p.warning.push(o[m.data.color][0].data.time);break}case"error":{p.error.push(o[m.data.color][0].data.time);break}}u[m.data.color].next(o[m.data.color],l[m.data.color]),l[m.data.color]=c[m.data.color],c[m.data.color]=[],o[m.data.color]=[]}m.type==="bomb"&&(c[0].push(m),c[1].push(m)),m.type==="note"&&(s[m.data.color]=m,o[m.data.color].push(m))}for(let g=0;g<2;g++)if(s[g])switch(u[g].check(o[g],c[g])){case"warning":{p.warning.push(o[g][0].data.time);break}case"error":{p.error.push(o[g][0].data.time);break}}return p}function Gh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Vh(t);e.warning=e.warning.filter(function(n,r,a){return!r||n!==a[r-1]}).sort((n,r)=>n-r),e.error=e.error.filter(function(n,r,a){return!r||n!==a[r-1]}).sort((n,r)=>n-r);const i=[];if(e.warning.length&&i.push(dt("Parity warning",e.warning,t.settings.bpm)),e.error.length&&i.push(dt("Parity error",e.error,t.settings.bpm)),i.length){const n=document.createElement("div");i.forEach(r=>n.append(r)),Xi.output.html=n}else Xi.output.html=null}const _o="Double-directional",bo="Check double-directional note swing (this may not mean parity break).",yo=!0,An={name:_o,description:bo,type:"note",order:{input:ct.NOTES_DOUBLE_DIRECTIONAL,output:ut.NOTES_DOUBLE_DIRECTIONAL},input:{enabled:yo,params:{},html:ot.create(_o,bo,yo,function(){An.input.enabled=this.checked})},output:{html:null},run:qh};function Wh(t,e){const{bpm:i}=t,n=e.noteContainer,r={},a={},s={},o={0:[],1:[]},c=[];for(let l=0,u=n.length;l<u;l++){const p=n[l];p.type==="note"&&r[p.data.color]?Rt.next(p,r[p.data.color],i,o[p.data.color])?(s[p.data.color]&&(s[p.data.color]=null,a[p.data.color]=(a[p.data.color]+180)%360),zi(p.data,a[p.data.color],45,!0)&&c.push(p.data),p.data.direction===8?s[p.data.color]=p.data:a[p.data.color]=p.data.getAngle(),o[p.data.color]=[]):(s[p.data.color]&&zi(p.data,a[p.data.color],45,!0)&&(c.push(p.data),s[p.data.color]=null,a[p.data.color]=p.data.getAngle()),p.data.direction!==8&&(s[p.data.color]=null,a[p.data.color]=p.data.getAngle())):p.type==="note"&&(a[p.data.color]=p.data.getAngle()),p.type==="note"&&(r[p.data.color]=p,o[p.data.color].push(p)),p.type==="bomb"&&(p.data.posY===0&&(p.data.posX===1&&(a[0]=Vt[0],s[0]=null),p.data.posX===2&&(a[1]=Vt[0],s[1]=null)),p.data.posY===2&&(p.data.posX===1&&(a[0]=Vt[1],s[0]=null),p.data.posX===2&&(a[1]=Vt[1],s[1]=null)))}return c.map(l=>l.time).filter(function(l,u,p){return!u||l!==p[u-1]})}function qh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Wh(t.settings,t.difficulty);e.length?An.output.html=dt("Double-directional",e,t.settings.bpm):An.output.html=null}const Hl="Vision Block",Yl="Check for vision block caused by center note.",Ul=!0,Vl=.1,Gl=.5;let jt;const vo={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},At=document.createElement("div"),si=document.createElement("input"),Ja=document.createElement("label"),Ye=document.createElement("input"),Ka=document.createElement("label"),Ue=document.createElement("input"),Qa=document.createElement("label"),De=document.createElement("input"),tr=document.createElement("label"),pe=document.createElement("input"),er=document.createElement("label"),le=document.createElement("input"),ir=document.createElement("label");Ja.textContent=" VB time specific ";Ja.htmlFor="input__tools-vb-time-check";si.id="input__tools-vb-time-check";si.className="input-toggle";si.type="radio";si.name="input__tools-vb-spec";si.value="time";si.addEventListener("change",Wl);Ka.textContent=" VB difficulty specific ";Ka.htmlFor="input__tools-vb-diff-check";Ye.id="input__tools-vb-diff-check";Ye.className="input-toggle";Ye.type="radio";Ye.checked=!0;Ye.name="input__tools-vb-spec";Ye.value="difficulty";Ye.addEventListener("change",Wl);Qa.textContent="min time (ms): ";Qa.htmlFor="input__tools-vb-min-time";Ue.id="input__tools-vb-min-time";Ue.className="input-toggle input--small";Ue.type="number";Ue.min="0";Ue.value=P(Vl*1e3,1).toString();Ue.addEventListener("change",Jh);tr.textContent=" (beat): ";tr.htmlFor="input__tools-vb-min-beat";De.id="input__tools-vb-min-beat";De.className="input-toggle input--small";De.type="number";De.min="0";De.step="0.1";De.addEventListener("change",Kh);er.textContent="max time (ms): ";er.htmlFor="input__tools-vb-max-time";pe.id="input__tools-vb-max-time";pe.className="input-toggle input--small";pe.type="number";pe.min="0";pe.value=P(Gl*1e3,1).toString();pe.addEventListener("change",Qh);ir.textContent=" (beat): ";ir.htmlFor="input__tools-vb-max-beat";le.id="input__tools-vb-max-beat";le.className="input-toggle input--small";le.type="number";le.min="0";le.step="0.1";le.addEventListener("change",td);At.appendChild(ot.create(Hl,Yl,Ul,function(){mt.input.enabled=this.checked}));At.appendChild(si);At.appendChild(Ja);At.appendChild(Ye);At.appendChild(Ka);At.appendChild(document.createElement("br"));At.appendChild(Qa);At.appendChild(Ue);At.appendChild(tr);At.appendChild(De);At.appendChild(document.createElement("br"));At.appendChild(er);At.appendChild(pe);At.appendChild(ir);At.appendChild(le);const mt={name:Hl,description:Yl,type:"note",order:{input:ct.NOTES_VISION_BLOCK,output:ut.NOTES_VISION_BLOCK},input:{enabled:Ul,params:{specific:"difficulty",minTime:Vl,maxTime:Gl},html:At,adjustTime:Zh},output:{html:null},run:id};function Zh(t){jt=t,De.value=P(jt.toBeatTime(mt.input.params.minTime),2).toString(),le.value=P(jt.toBeatTime(mt.input.params.maxTime),2).toString()}function Wl(){mt.input.params.specific=this.value}function Jh(){mt.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=P(mt.input.params.minTime*1e3,1).toString(),jt&&(De.value=P(jt.toBeatTime(mt.input.params.minTime),2).toString(),mt.input.params.minTime>mt.input.params.maxTime&&(mt.input.params.maxTime=mt.input.params.minTime,pe.value=P(mt.input.params.maxTime*1e3,1).toString(),le.value=P(jt.toBeatTime(mt.input.params.maxTime),2).toString()))}function Kh(){if(!jt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;mt.input.params.minTime=jt.toRealTime(t),Ue.value=P(mt.input.params.minTime*1e3,1).toString(),this.value=P(t,2).toString(),mt.input.params.minTime>mt.input.params.maxTime&&(mt.input.params.maxTime=mt.input.params.minTime,pe.value=P(mt.input.params.maxTime*1e3,1).toString(),le.value=P(jt.toBeatTime(mt.input.params.maxTime),2).toString())}function Qh(){mt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=P(mt.input.params.maxTime*1e3,1).toString(),jt&&(le.value=P(jt.toBeatTime(mt.input.params.maxTime),2).toString())}function td(){if(!jt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;mt.input.params.maxTime=jt.toRealTime(t),pe.value=P(mt.input.params.maxTime*1e3,1).toString(),this.value=P(t,2).toString()}function ed(t){const{bpm:e,njs:i}=t.settings,n=t.difficulty.data.getNoteContainer().filter(g=>g.type!=="slider"),{minTime:r,maxTime:a,specific:s}=mt.input.params,o=s==="time"?e.toBeatTime(r):e.toBeatTime(vo[t.difficulty.difficulty].min),c=s==="time"?e.toBeatTime(a):Math.min(i.hjd,e.toBeatTime(vo[t.difficulty.difficulty].max));let l=null,u=null;const p=[];for(let g=0,d=n.length;g<d;g++){const m=n[g];l&&(m.data.time-l.data.time>=o&&m.data.time-l.data.time<=c?m.data.posX<2&&p.push(m):m.data.time-l.data.time>c&&(l=null)),u&&(m.data.time-u.data.time>=o&&m.data.time-u.data.time<=c?m.data.posX>1&&p.push(m):m.data.time-u.data.time>c&&(u=null)),m.data.posY===1&&m.data.posX===1&&(l=m),m.data.posY===1&&m.data.posX===2&&(u=m)}return p.map(g=>g.data.time).filter(function(g,d,m){return!d||g!==m[d-1]})}function id(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=ed(t);e.length?mt.output.html=dt("Vision block",e,t.settings.bpm):mt.output.html=null}const Eo="Stacked Note",wo="Look for stacked note.",So=!0,Bn={name:Eo,description:wo,type:"note",order:{input:ct.NOTES_STACKED_NOTE,output:ut.NOTES_STACKED_NOTE},input:{enabled:So,params:{},html:ot.create(Eo,wo,So,function(){Bn.input.enabled=this.checked})},output:{html:null},run:rd};function nd(t,e){const{bpm:i}=t,{colorNotes:n}=e.data,r=[];let a=0;for(let s=0,o=n.length;s<o;s++)if(!(i.toRealTime(n[s].time)<a+.01))for(let c=s+1;c<o&&!(i.toRealTime(n[c].time)>i.toRealTime(n[s].time)+.01);c++)n[c].isInline(n[s])&&(r.push(n[s]),a=i.toRealTime(n[s].time));return r.map(s=>s.time).filter(function(s,o,c){return!o||s!==c[o-1]})}function ad(t,e){const{bpm:i,njs:n}=t,{bombNotes:r}=e.data,a=[];for(let s=0,o=r.length;s<o;s++)for(let c=s+1;c<o&&!(i.toRealTime(r[c].time)>i.toRealTime(r[s].time)+1);c++)r[s].isInline(r[c])&&(n.value<i.value/(120*(r[c].time-r[s].time))||i.toRealTime(r[c].time)<i.toRealTime(r[s].time)+.02)&&a.push(r[s]);return a.map(s=>s.time).filter(function(s,o,c){return!o||s!==c[o-1]})}function rd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=nd(t.settings,t.difficulty),i=ad(t.settings,t.difficulty),n=[];if(e.length&&n.push(dt("Stacked note",e,t.settings.bpm)),i.length&&n.push(dt("Stacked bomb",i,t.settings.bpm)),n.length){const r=document.createElement("div");n.forEach(a=>r.append(a)),Bn.output.html=r}else Bn.output.html=null}const ko="Color Check",xo="Compare note color with other colored note and the arrow on itself.",Co=!0,Do=[1,1,1],To={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"};function Lo(t,e){var r;let i=(r=Object.keys(t).find(a=>parseFloat(a)>=e))!=null?r:"100",n=parseFloat(i);return t[n]}const In={name:ko,description:xo,type:"note",order:{input:ct.NOTES_COLOR_CHECK,output:ut.NOTES_COLOR_CHECK},input:{enabled:Co,params:{},html:ot.create(ko+" (EXPERIMENTAL)",xo,Co,function(){In.input.enabled=this.checked})},output:{html:null},run:ld};function od(t){var n,r,a,s,o,c,l,u;const e=(s=(r=(n=t.difficulty)==null?void 0:n.info._customData)==null?void 0:r._colorLeft)!=null?s:zt[(a=Ft[t.info._environmentName])!=null?a:"The First"]._colorLeft,i=(u=(c=(o=t.difficulty)==null?void 0:o.info._customData)==null?void 0:c._colorRight)!=null?u:zt[(l=Ft[t.info._environmentName])!=null?l:"The First"]._colorRight;return e&&i?Jn(dn(e),dn(i)):100}function sd(t){var a,s,o,c,l,u,p,g;let e=100,i=100;const n=(c=(s=(a=t.difficulty)==null?void 0:a.info._customData)==null?void 0:s._colorLeft)!=null?c:zt[(o=Ft[t.info._environmentName])!=null?o:"The First"]._colorLeft,r=(g=(u=(l=t.difficulty)==null?void 0:l.info._customData)==null?void 0:u._colorRight)!=null?g:zt[(p=Ft[t.info._environmentName])!=null?p:"The First"]._colorRight;return n&&(e=Jn(Do,dn(n))),r&&(i=Jn(Do,dn(r))),Math.min(e,i)}function ld(t){var r,a,s,o;if(!((a=(r=t.difficulty)==null?void 0:r.info._customData)!=null&&a._colorLeft)&&!((o=(s=t.difficulty)==null?void 0:s.info._customData)!=null&&o._colorRight))return;const e=od(t),i=sd(t),n=[];if(e<=20&&n.push(ht(`${Lo(To,e)} note color (dE${P(e,1)})`,"suggest change to better differentiate between 2 note colour")),i<=20&&n.push(ht(`${Lo(To,i)} arrow note color (dE${P(i,1)})`,"may be difficult to see the arrow")),n.length){const c=document.createElement("div");n.forEach(l=>c.append(l)),In.output.html=c}else In.output.html=null}var Ro=Object.freeze(Object.defineProperty({__proto__:null,effectiveBPM:Mt,acceptablePrec:ri,varySwing:Sn,slowSlider:Gt,inlineAngle:re,shradoAngle:Xt,speedPause:oe,hitboxStair:kn,hitboxReverseStair:xn,hitboxInline:Cn,hitboxPath:Dn,improperArc:Tn,improperChain:Ln,improperWindow:Rn,parity:Xi,doubleDirectional:An,visionBlock:mt,stackedNote:Bn,colorCheck:In},Symbol.toStringTag,{value:"Module"}));const Ao="<15ms Obstacle",Bo=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,Io=!0,ji={name:Ao,description:Bo,type:"obstacle",order:{input:ct.OBSTACLES_SHORT,output:ut.OBSTACLES_SHORT},input:{enabled:Io,params:{minDur:.015},html:ot.create(Ao,Bo,Io,function(){ji.input.enabled=this.checked})},output:{html:null},run:ud};function cd(t){const{obstacles:e}=t.difficulty.data,{bpm:i}=t.settings,{minDur:n}=ji.input.params,r=i.toBeatTime(n),a=[];let s=fe.create(),o=fe.create(),c=fe.create(),l=fe.create();return e.forEach(u=>{u.posY===0&&u.height>2&&u.duration>0?u.width>2||u.width>1&&u.posX===1?(u.isLonger(s)&&(u.duration<r&&a.push(u),s=u),u.isLonger(o)&&(u.duration<r&&a.push(u),o=u)):u.width===2?u.posX===0?u.isLonger(s)&&(u.duration<r&&a.push(u),s=u):u.posX===2&&u.isLonger(o)&&(u.duration<r&&a.push(u),o=u):u.width===1&&(u.posX===1?u.isLonger(s)&&(u.duration<r&&a.push(u),s=u):u.posX===2&&u.isLonger(o)&&(u.duration<r&&a.push(u),o=u)):u.posY===2&&u.height>2&&u.duration>0&&(u.width>2||u.width>1&&u.posX===1?(u.isLonger(c)&&(u.duration<r&&u.isLonger(s,r)&&u.isLonger(c,r)&&a.push(u),c=u),u.isLonger(l)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(l,r)&&a.push(u),l=u)):u.width===2?u.posX===0?u.isLonger(c)&&(u.duration<r&&u.isLonger(s,r)&&u.isLonger(c,r)&&a.push(u),c=u):u.posX===2&&u.isLonger(l)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(l,r)&&a.push(u),l=u):u.width===1&&(u.posX===1?u.isLonger(c)&&(u.duration<r&&u.isLonger(s,r)&&u.isLonger(c,r)&&a.push(u),c=u):u.posX===2&&u.isLonger(l)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(l,r)&&a.push(u),l=u)))}),a.map(u=>u.time).filter(function(u,p,g){return!p||u!==g[p-1]})}function ud(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=cd(t);e.length?ji.output.html=dt("<15ms obstacle",e,t.settings.bpm):ji.output.html=null}const ql="2-wide Center Obstacle",Zl="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",Jl=!0,Kl=.25;let yi;const xi=document.createElement("div"),Ve=document.createElement("input"),nr=document.createElement("label"),Te=document.createElement("input"),ar=document.createElement("label");nr.textContent="recovery time (ms): ";nr.htmlFor="input__tools-2wide-wall-time";Ve.id="input__tools-2wide-wall-time";Ve.className="input-toggle input--small";Ve.type="number";Ve.min="0";Ve.value=P(Kl*1e3,1).toString();Ve.addEventListener("change",dd);ar.textContent=" (beat): ";ar.htmlFor="input__tools-2wide-wall-beat";Te.id="input__tools-2wide-wall-beat";Te.className="input-toggle input--small";Te.type="number";Te.min="0";Te.step="0.1";Te.addEventListener("change",fd);xi.appendChild(ot.create(ql,Zl,Jl,function(){Wt.input.enabled=this.checked}));xi.appendChild(nr);xi.appendChild(Ve);xi.appendChild(ar);xi.appendChild(Te);const Wt={name:ql,description:Zl,type:"obstacle",order:{input:ct.OBSTACLES_CENTER,output:ut.OBSTACLES_CENTER},input:{enabled:Jl,params:{recovery:Kl},html:xi,adjustTime:hd},output:{html:null},run:pd};function hd(t){yi=t,Te.value=P(yi.toBeatTime(Wt.input.params.recovery),2).toString()}function dd(){Wt.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=P(Wt.input.params.recovery*1e3,1).toString(),yi&&(Te.value=P(yi.toBeatTime(Wt.input.params.recovery),2).toString())}function fd(){if(!yi){this.value="0";return}let t=P(Math.abs(parseFloat(this.value)),2)||1;Wt.input.params.recovery=yi.toRealTime(t),Ve.value=P(Wt.input.params.recovery*1e3,1).toString(),this.value=t.toString()}function md(t){const{obstacles:e}=t.difficulty.data,{bpm:i}=t.settings,{recovery:n}=Wt.input.params,r=[];let a=fe.create(),s=fe.create();return e.forEach(o=>{o.posY<2&&o.height>1&&(o.width>2&&(r.push(o),o.isLonger(a)&&(a=o),o.isLonger(s)&&(s=o)),o.width===2&&(o.posX===0&&o.isLonger(a)&&(i.toRealTime(o.time)>i.toRealTime(s.time)-n&&i.toRealTime(o.time)<i.toRealTime(s.time+s.duration)+n&&r.push(o),a=o),o.posX===1&&(r.push(o),o.isLonger(a)&&(a=o),o.isLonger(s)&&(s=o)),o.posX===2&&o.isLonger(s)&&(i.toRealTime(o.time)>i.toRealTime(a.time)-n&&i.toRealTime(o.time)<i.toRealTime(a.time+a.duration)+n&&r.push(o),s=o)),o.width===1&&(o.posX===1&&o.isLonger(a)&&(i.toRealTime(o.time)>i.toRealTime(s.time)-n&&i.toRealTime(o.time)<i.toRealTime(s.time+s.duration)+n&&r.push(o),a=o),o.posX===2&&o.isLonger(s)&&(i.toRealTime(o.time)>i.toRealTime(a.time)-n&&i.toRealTime(o.time)<i.toRealTime(a.time+a.duration)+n&&r.push(o),s=o)))}),r.map(o=>o.time).filter(function(o,c,l){return!c||o!==l[c-1]})}function pd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=md(t),{recovery:i}=Wt.input.params;e.length?Wt.output.html=dt(`2-wide center obstacle (<${P(i*1e3)}ms)`,e,t.settings.bpm):Wt.output.html=null}const $o="Zero Obstacle",No="Look for obstacle with zero value.",Mo=!0,$n={name:$o,description:No,type:"obstacle",order:{input:ct.OBSTACLES_ZERO,output:ut.OBSTACLES_ZERO},input:{enabled:Mo,params:{},html:ot.create($o,No,Mo,function(){$n.input.enabled=this.checked})},output:{html:null},run:_d};function gd(t){const{obstacles:e}=t.difficulty.data;return e.filter(i=>i.hasZero()).map(i=>i.time)}function _d(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=gd(t);e.length?$n.output.html=dt("Zero value obstacle",e,t.settings.bpm):$n.output.html=null}var Po=Object.freeze(Object.defineProperty({__proto__:null,shortObstacle:ji,centerObstacle:Wt,zeroObstacle:$n},Symbol.toStringTag,{value:"Module"}));const Oo="Insufficient Lighting Event",Fo="Check if there is enough light event.",zo=!0,Nn={name:Oo,description:Fo,type:"event",order:{input:ct.EVENTS_INSUFFICIENT_LIGHT,output:ut.EVENTS_INSUFFICIENT_LIGHT},input:{enabled:zo,params:{},html:ot.create(Oo,Fo,zo,function(){Nn.input.enabled=this.checked})},output:{html:null},run:yd};function bd(t){let e=0;for(let i=t.length-1;i>=0;i--)if(t[i].isLightEvent()&&!t[i].isOff()&&(e++,e>10))return!0;return!1}function yd(t){if(!t.difficulty){console.error("Something went wrong!");return}bd(t.difficulty.data.basicBeatmapEvents)?Nn.output.html=null:Nn.output.html=ht("Insufficient light event")}const Xo="Unlit Bomb",jo="Check for lighting around bomb.",Ho=!0,Mn={name:Xo,description:jo,type:"event",order:{input:ct.EVENTS_UNLIT_BOMB,output:ut.EVENTS_UNLIT_BOMB},input:{enabled:Ho,params:{},html:ot.create(Xo,jo,Ho,function(){Mn.input.enabled=this.checked})},output:{html:null},run:Ed},vd=(t,e,i,n)=>{var p,g,d;if(!e.length)return[];const r=[],a=(g=(p=Ae[n])==null?void 0:p[0])!=null?g:Ae.DefaultEnvironment[0],s=e.filter(m=>m.isLightEvent()&&a.includes(m.type)).sort((m,_)=>m.type-_.type),o={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},c={};a.forEach(m=>c[m]=[[0,!1]]);const l=i.toBeatTime(1),u=i.toBeatTime(.25);for(let m=0,_=s.length;m<_;m++){const b=s[m];if((b.isOn()||b.isFlash())&&o[b.type].state!=="on"){o[b.type]={state:"on",time:b.time,fadeTime:0};const y=c[b.type].find(v=>v[0]>=b.time);y?(y[0]=b.time,y[1]=!0):c[b.type].push([b.time,!0])}if(b.isFade()){o[b.type]={state:"off",time:b.time,fadeTime:l};const y=c[b.type].find(v=>v[0]>=b.time);y?(y[0]=b.time,y[1]=!0):c[b.type].push([b.time,!0]),c[b.type].push([b.time+l,!1])}(((d=b==null?void 0:b.floatValue)!=null?d:1)<.25||b.isOff()||b.customData._color&&(typeof b.customData._color[3]=="number"&&b.customData._color[3]<.25||Math.max(b.customData._color[0],b.customData._color[1],b.customData._color[2])<.25))&&o[b.type].state!=="off"&&(o[b.type]={state:"off",time:b.time,fadeTime:o[b.type].state==="on"?u:Math.min(u,o[b.type].fadeTime)},c[b.type].push([b.time+(o[b.type].state==="on"?u:Math.min(u,o[b.type].fadeTime)),!1]))}for(const m in c)c[m].reverse();for(let m=0,_=t.length,b=!1;m<_;m++){const y=t[m];b=!1;for(const v in c){const S=c[v].find(C=>C[0]<=y.time);S&&(b=b||S[1])}b||r.push(y)}return r.map(m=>m.time).filter(function(m,_,b){return!_||m!==b[_-1]})};function Ed(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=vd(t.difficulty.data.bombNotes,t.difficulty.data.basicBeatmapEvents,t.settings.bpm,t.info._environmentName);e.length?Mn.output.html=dt("Unlit bomb",e,t.settings.bpm):Mn.output.html=null}var Yo=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:Nn,unlitBomb:Mn},Symbol.toStringTag,{value:"Module"}));const Ql="Hot Start",tc="Check for first interactive object starting from start time.",ec=!0,ic=1.5,Ge=document.createElement("input");Ge.id="input__tools-hot-start";Ge.className="input-toggle input--small";Ge.type="number";Ge.min="0";Ge.step="0.1";Ge.value=ic.toString();Ge.addEventListener("change",wd);const nc=ot.create(Ql+" (s): ",tc,ec,function(){ni.input.enabled=this.checked});nc.appendChild(Ge);const ni={name:Ql,description:tc,type:"other",order:{input:ct.OTHERS_HOT_START,output:ut.OTHERS_HOT_START},input:{enabled:ec,params:{time:ic},html:nc},output:{html:null},run:Sd};function wd(){ni.input.params.time=P(Math.abs(parseFloat(this.value)),3),this.value=ni.input.params.time.toString()}function Sd(t){if(!t.difficulty){console.error("Something went wrong!");return}const{time:e}=ni.input.params,i=t.settings.bpm.toRealTime(t.difficulty.data.getFirstInteractiveTime());i<e?ni.output.html=ht("Hot start",`${P(i,2)}s`):ni.output.html=null}const Uo="Difficulty Label Check",Vo="For ranking purpose, check difficulty label to fit rankability criteria.",Go=!0,Pn={name:Uo,description:Vo,type:"other",order:{input:ct.OTHERS_DIFFICULTY_LABEL,output:ut.OTHERS_DIFFICULTY_LABEL},input:{enabled:Go,params:{},html:ot.create(Uo,Vo,Go,function(){Pn.input.enabled=this.checked})},output:{html:null},run:kd};function kd(t){var i;if(!t.difficulty){console.error("Something went wrong!");return}const e=(i=t.difficulty.info._customData)==null?void 0:i._difficultyLabel;e&&e.length>30?Pn.output.html=ht(`Difficulty label is too long (${e.length} characters)`,"exceeded 30 max characters by ranking criteria"):Pn.output.html=null}const Wo="NJS Check",qo="Check note jump speed for suitable value.",Zo=!0,On={name:Wo,description:qo,type:"other",order:{input:ct.OTHERS_NJS,output:ut.OTHERS_NJS},input:{enabled:Zo,params:{},html:ot.create(Wo,qo,Zo,function(){On.input.enabled=this.checked})},output:{html:null},run:xd};function xd(t){if(!t.difficulty){console.error("Something went wrong!");return}const{njs:e,bpm:i}=t.settings,n=[];if(t.difficulty.info._noteJumpMovementSpeed===0&&n.push(ht("Unset NJS","fallback NJS is used")),e.value>23&&n.push(ht(`NJS is too high (${P(e.value,2)})`,"use lower whenever necessary")),e.jd<18&&n.push(ht("Very low jump distance",`${P(e.jd,2)}`)),e.jd>36&&n.push(ht("Very high jump distance",`${P(e.jd,2)}`)),e.jd>e.calcJDOptimalHigh()&&n.push(ht(`High jump distance warning (>${P(e.calcJDOptimalHigh(),2)})`,"NJS may be uncomfortable to play")),i.toRealTime(e.hjd)<.45&&n.push(ht(`Very quick reaction time (${P(i.toRealTime(e.hjd)*1e3)}ms)`,"may lead to suboptimal gameplay")),e.calcHJDRaw()+e.offset<e.hjdMin&&n.push(ht("Unnecessary negative offset",`will not drop below ${e.hjdMin}`)),n.length){const r=document.createElement("div");n.forEach(a=>r.append(a)),On.output.html=r}else On.output.html=null}const Jo="Outside Playable Object",Ko="Look for any object starting before and after song timer.",Qo=!0,Fn={name:Jo,description:Ko,type:"other",order:{input:ct.OTHERS_OUTSIDE_PLAYABLE,output:ut.OTHERS_OUTSIDE_PLAYABLE},input:{enabled:Qo,params:{},html:ot.create(Jo,Ko,Qo,function(){Fn.input.enabled=this.checked})},output:{html:null},run:Cd};function Cd(t){if(!t.difficulty){console.error("Something went wrong!");return}const{bpm:e,audioDuration:i}=t.settings,{colorNotes:n,bombNotes:r,obstacles:a,basicBeatmapEvents:s,sliders:o,burstSliders:c}=t.difficulty.data,l=[];if(i){let u=e.toBeatTime(i);n.length&&n[0].time<0&&l.push(ht("Note(s) before start time",`${P(n[0].time,3)} (${kt(e.toRealTime(n[0].time))}`)),r.length&&r[0].time<0&&l.push(ht("Bomb(s) before start time",`${P(r[0].time,3)} (${kt(e.toRealTime(r[0].time))}`)),o.length&&o[0].time<0&&l.push(ht("Arc(s) before start time",`${P(o[0].time,3)} (${kt(e.toRealTime(o[0].time))}`)),c.length&&c[0].time<0&&l.push(ht("Chain(s) before start time",`${P(c[0].time,3)} (${kt(e.toRealTime(c[0].time))}`)),a.length&&a[0].time<0&&l.push(ht("Obstacle(s) before start time",`${P(a[0].time,3)} (${kt(e.toRealTime(a[0].time))}`)),s.length&&s[0].time<0&&l.push(ht("Event(s) before start time",`${P(s[0].time,3)} (${kt(e.toRealTime(s[0].time))}`)),n.length&&n[n.length-1].time>u&&l.push(ht("Note(s) after end time",`${P(n[n.length-1].time,3)} (${kt(e.toRealTime(n[n.length-1].time))})`)),r.length&&r[r.length-1].time>u&&l.push(ht("Bomb(s) after end time",`${P(r[r.length-1].time,3)} (${kt(e.toRealTime(r[r.length-1].time))})`)),o.length&&o[o.length-1].time>u&&l.push(ht("Arc(s) after end time",`${P(o[o.length-1].time,3)} (${kt(e.toRealTime(o[o.length-1].time))})`)),c.length&&c[c.length-1].time>u&&l.push(ht("Chain(s) after end time",`${P(c[c.length-1].time,3)} (${kt(e.toRealTime(c[c.length-1].time))})`)),a.length&&a[a.length-1].time>u&&l.push(ht("Obstacle(s) after end time",`${P(a[a.length-1].time,3)} (${kt(e.toRealTime(a[a.length-1].time))})`)),s.length&&s[s.length-1].time>u&&l.push(ht("Event(s) after end time",`${P(s[s.length-1].time,3)} (${kt(e.toRealTime(s[s.length-1].time))})`))}if(l.length){const u=document.createElement("div");l.forEach(p=>u.append(p)),Fn.output.html=u}else Fn.output.html=null}const ts="Invalid Object",es="Validate beatmap object to be compatible with vanilla (ignores for modded).",is=!0,zn={name:ts,description:es,type:"other",order:{input:ct.OTHERS_INVALID_OBJECT,output:ut.OTHERS_INVALID_OBJECT},input:{enabled:is,params:{},html:ot.create(ts,es,is,function(){zn.input.enabled=this.checked})},output:{html:null},run:Dd};function Dd(t){var m,_,b,y;if(!t.difficulty){console.error("Something went wrong!");return}const{colorNotes:e,bombNotes:i,obstacles:n,basicBeatmapEvents:r,sliders:a,burstSliders:s}=t.difficulty.data;let o=[],c=[],l=[],u=[],p=[];(_=(m=t.difficulty.info._customData)==null?void 0:m._requirements)!=null&&_.includes("Mapping Extensions")||((y=(b=t.difficulty.info._customData)==null?void 0:b._requirements)!=null&&y.includes("Noodle Extensions")?(o=e.filter(v=>v.hasMappingExtensions()).map(v=>v.time),c=n.filter(v=>v.hasMappingExtensions()).map(v=>v.time),l=i.filter(v=>v.hasMappingExtensions()).map(v=>v.time),u=a.filter(v=>v.hasMappingExtensions()).map(v=>v.time),p=s.filter(v=>v.hasMappingExtensions()).map(v=>v.time)):(o=e.filter(v=>!v.isValid()).map(v=>v.time),c=n.filter(v=>!v.isValid()).map(v=>v.time),l=i.filter(v=>!v.isValid()).map(v=>v.time),u=a.filter(v=>!v.isValid()).map(v=>v.time),p=s.filter(v=>!v.isValid()).map(v=>v.time)));const g=r.filter(v=>!v.isValid()).map(v=>v.time),d=[];if(o.length&&d.push(dt("Invalid note",o,t.settings.bpm)),l.length&&d.push(dt("Invalid bomb",l,t.settings.bpm)),u.length&&d.push(dt("Invalid arc",u,t.settings.bpm)),p.length&&d.push(dt("Invalid chain",p,t.settings.bpm)),c.length&&d.push(dt("Invalid obstacle",c,t.settings.bpm)),g.length&&d.push(dt("Invalid event",g,t.settings.bpm)),d.length){const v=document.createElement("div");d.forEach(S=>v.append(S)),zn.output.html=v}else zn.output.html=null}var ns=Object.freeze(Object.defineProperty({__proto__:null,hotStart:ni,difficultyLabel:Pn,njs:On,outsidePlayable:Fn,invalidObject:zn},Symbol.toStringTag,{value:"Module"}));const he=class{constructor(){}};let Le=he;Le.getNote=()=>Object.keys(Ro).map(t=>Ro[t]);Le.getObstacle=()=>Object.keys(Po).map(t=>Po[t]);Le.getEvent=()=>Object.keys(Yo).map(t=>Yo[t]);Le.getOther=()=>Object.keys(ns).map(t=>ns[t]);Le.getGeneral=()=>Object.keys(jr).map(t=>jr[t]);Le.getDifficulty=()=>[...he.getNote(),...he.getObstacle(),...he.getEvent(),...he.getOther()];Le.getAll=()=>[...he.getNote(),...he.getObstacle(),...he.getEvent(),...he.getOther(),...he.getGeneral()];const ii=t=>`[analyzer::${t}]`,ac=Le.getAll().sort((t,e)=>t.order.input-e.order.input),rc=[...ac].sort((t,e)=>t.order.output-e.order.output);function oc(){rt.analysis={general:{html:null},map:[]}}function Td(){var s,o;const t=rt.beatmapInfo;if(!t){et.error(ii("runGeneral"),"Could not analyse, missing map info");return}rt.analysis||oc();const e=(s=rt.analysis)==null?void 0:s.general,i=me.create(t._beatsPerMinute),n=Be.create(i),r={bpm:i,njs:n,audioDuration:(o=rt.duration)!=null?o:null,mapDuration:0};et.info(ii("runGeneral"),"Analysing general");const a=[];rc.filter(c=>c.type==="general").forEach(c=>{if(c.input.enabled)try{c.run({settings:r,difficulties:rt.beatmapDifficulty,info:t}),c.output.html&&a.push(c.output.html)}catch(l){et.error(ii("runGeneral"),l)}}),e&&(e.html=a)}function sc(t,e){var l,u,p,g,d;const i=rt.beatmapInfo;if(!i){et.error(ii("runDifficulty"),"Could not analyse, missing map info");return}rt.analysis||oc();const n=(l=rt.beatmapDifficulty)==null?void 0:l.find(m=>m.characteristic===t&&m.difficulty===e);if(!n){et.error(ii("runDifficulty"),"Could not analyse, missing map data");return}const r=(u=rt.analysis)==null?void 0:u.map.find(m=>m.difficulty===e&&m.mode===t),a=me.create(i._beatsPerMinute,n.data.customData._BPMChanges||n.data.customData._bpmChanges||n.data.customData.BPMChanges,(p=n.info._customData)==null?void 0:p._editorOffset),s=Be.create(a,n.info._noteJumpMovementSpeed,n.info._noteJumpStartBeatOffset),o={bpm:a,njs:s,audioDuration:(g=rt.duration)!=null?g:null,mapDuration:a.toRealTime(n.data.getLastInteractiveTime())};et.info(ii("runDifficulty"),`Analysing ${t} ${e}`);const c=[];rc.filter(m=>m.type!=="general").forEach(m=>{if(m.input.enabled)try{m.run({settings:o,difficulty:n,info:i}),m.output.html&&c.push(m.output.html)}catch(_){et.error(ii("runDifficulty"),_)}}),r?r.html=c:(d=rt.analysis)==null||d.map.push({mode:t,difficulty:e,html:c})}function Ld(t){Le.getDifficulty().sort((i,n)=>i.order.output-n.order.output).forEach(i=>{i.input.adjustTime&&i.input.adjustTime(t)})}function Rd(){var t;(t=rt.beatmapDifficulty)==null||t.forEach(e=>sc(e.characteristic,e.difficulty))}var vi={toolListInput:ac,runGeneral:Td,runDifficulty:sc,adjustTime:Ld,applyAll:Rd};const We="UI Tools: ",Ie=document.querySelectorAll(".tools__select-mode"),$e=document.querySelectorAll(".tools__select-difficulty"),Ad=document.querySelectorAll(".difficulty__label"),lc=document.querySelector(".tools__note-content"),cc=document.querySelector(".tools__obstacle-content"),uc=document.querySelector(".tools__event-content"),hc=document.querySelector(".tools__other-content"),dc=document.querySelector(".tools__general-content"),Ee=document.querySelector(".tools__output-diff"),we=document.querySelector(".tools__output-general"),as=document.querySelector(".tools__apply-this"),rs=document.querySelector(".tools__apply-all");if(!lc||!cc||!uc||!hc||!dc)throw new Error(We+"missing content element");if(!Ee||!we)throw new Error(We+"missing output element");if(as&&rs)as.addEventListener("click",Fd),rs.addEventListener("click",zd);else throw new Error(We+"missing apply element");Ie.forEach(t=>t.addEventListener("change",Pd));$e.forEach(t=>t.addEventListener("change",Od));function Bd(){var e;const t=(e=rt.analysis)==null?void 0:e.general;if(!t){we.textContent="ERROR: could not find analysis for general";return}if(!t.html){we.textContent="ERROR: could not find HTML for general";return}we.innerHTML="",t.html.forEach(i=>we.appendChild(i)),we.firstChild||(we.textContent="No issues found.")}function Vi(t,e){var n;if(!t&&!e&&(t=Ie[0].value,e=$e[0].value),!t||!e)throw new Error(We+"something went wrong!");Ee.innerHTML="";const i=(n=rt.analysis)==null?void 0:n.map.find(r=>r.difficulty===e&&r.mode===t);if(!i){Ee.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!i.html){Ee.textContent="ERROR: could not find HTML for "+t+" "+e;return}i.html.forEach(r=>Ee.appendChild(r)),Ee.firstChild||(Ee.textContent="No issues found.")}function Yn(t){Ad.forEach(e=>e.textContent=t)}function fc(t){if(!t)return;$e.forEach(i=>{for(let n=i.options.length-1;n>=0;n--)i.remove(n)});let e=!0;for(let i=t._difficultyBeatmaps.length-1;i>=0;i--){const n=t._difficultyBeatmaps[i];$e.forEach(r=>{var s,o,c,l;const a=document.createElement("option");if(a.value=n._difficulty,a.textContent=Fi[n._difficulty]+((s=n._customData)!=null&&s._difficultyLabel?" -- "+((o=n._customData)==null?void 0:o._difficultyLabel):""),e){const u=(c=rt.beatmapDifficulty)==null?void 0:c.find(p=>p.difficulty===n._difficulty&&p.characteristic===t._beatmapCharacteristicName);if(!u)throw new Error("missing _mapSetData");Js(u),Yn(((l=n._customData)==null?void 0:l._difficultyLabel)||Fi[n._difficulty]),Vi(t._beatmapCharacteristicName,n._difficulty)}e=!1,r.add(a)})}}function mc(t){if(!t){Ie.forEach(i=>Kn(i)),$e.forEach(i=>Kn(i));return}let e=!0;t._difficultyBeatmapSets.forEach(i=>{Ie.forEach(n=>{const r=document.createElement("option");r.value=i._beatmapCharacteristicName,r.textContent=Na[i._beatmapCharacteristicName],n.add(r)}),e&&fc(i),e=!1})}function Id(){const t=rt.beatmapInfo;if(!t)throw new Error(We+"could not find map info");const e=me.create(t._beatsPerMinute);vi.adjustTime(e)}function $d(){vi.toolListInput.forEach(t=>{if(t.input.html)switch(t.type){case"note":{lc.appendChild(t.input.html);break}case"obstacle":{cc.appendChild(t.input.html);break}case"event":{uc.appendChild(t.input.html);break}case"other":{hc.appendChild(t.input.html);break}case"general":{dc.appendChild(t.input.html);break}default:console.error(We+"could not recognise type "+t.type+" for "+t.name)}})}function Nd(){we&&(we.innerHTML="No output."),Ee&&(Ee.innerHTML="No output.")}function Md(){Nd(),Yn("Difficulty Label"),mc()}function Pd(t){var n;const e=t.target;Ie.forEach(r=>{r!==e&&(r.value=e.value)});const i=(n=rt.beatmapInfo)==null?void 0:n._difficultyBeatmapSets.find(r=>r._beatmapCharacteristicName===e.value);fc(i)}function Od(t){var r,a,s,o;const e=t.target;$e.forEach(c=>{c!==e&&(c.value=e.value)});const i=(r=rt.beatmapInfo)==null?void 0:r._difficultyBeatmapSets.find(c=>c._beatmapCharacteristicName===Ie.item(0).value);if(!i)throw new Error("aaaaaaaaaaaaaaaaaaa");const n=(a=rt.beatmapDifficulty)==null?void 0:a.find(c=>c.difficulty===e.value&&c.characteristic===i._beatmapCharacteristicName);n&&(Js(n),Yn(((o=(s=n.info)==null?void 0:s._customData)==null?void 0:o._difficultyLabel)||Fi[e.value]),Vi(n.characteristic,n.difficulty))}function Fd(){const t=Ie[0].value,e=$e[0].value;if(!t||!e)throw new Error(We+"mode/difficulty does not exist");_t.status("info",`Re-analysing ${t} ${e}`,100),vi.runDifficulty(t,e),_t.status("info",`Re-analysed ${t} ${e}`,100),Vi(t,e)}function zd(){const t=Ie[0].value,e=$e[0].value;if(!t||!e)throw new Error(We+"mode/difficulty does not exist");_t.status("info","Re-analysing all difficulties",100),vi.applyAll(),_t.status("info","Re-analysed all difficulties",100),Vi(t,e)}var di={displayOutputGeneral:Bd,displayOutputDifficulty:Vi,setDifficultyLabel:Yn,adjustTime:Id,populateSelect:mc,populateTool:$d,reset:Md};const ai="UI Stats: ",R="stats__";function Xd(t,e){const i=me.create(t._beatsPerMinute),n=rt.duration||0,r=i.toRealTime(e.data.getLastInteractiveTime()),a=document.createElement("table");return a.className=R+"table",a.innerHTML=`<caption class="${R}table-caption">Note Per Seconds (NPS):</caption><tr><th class="${R}table-header" colspan="2">Overall</th><td class="${R}table-element">${P(e.data.nps(n),2)}</td></tr><tr><th class="${R}table-header" colspan="2">Mapped</th><td class="${R}table-element">${P(e.data.nps(r),2)}</td></tr><tr><th class="${R}table-header" rowspan="3">Peak</th><th class="${R}table-header">16-beat</th><td class="${R}table-element">${P(e.data.peak(16,i.value),2)}</td></tr><tr><th class="${R}table-header">8-beat</th><td class="${R}table-element">${P(e.data.peak(8,i.value),2)}</td></tr><tr><th class="${R}table-header">4-beat</th><td class="${R}table-element">${P(e.data.peak(4,i.value),2)}</td></tr>`,a}function jd(t,e){const i=me.create(t._beatsPerMinute),n=Be.create(i,e.info._noteJumpMovementSpeed||Be.FallbackNJS[e.difficulty],e.info._noteJumpStartBeatOffset),r=document.createElement("table");return r.className=R+"table",r.innerHTML=`<caption class="${R}table-caption">Map Settings:</caption><tr><th class="${R}table-header" colspan="2">Note Jump Speed</th><td class="${R}table-element">${P(n.value,3)}</td></tr><tr><th class="${R}table-header" colspan="2">Spawn Distance Modifier</th><td class="${R}table-element">${P(n.offset,3)}</td></tr><tr><th class="${R}table-header" colspan="2">Half Jump Duration</th><td class="${R}table-element">${P(n.hjd,3)}</td></tr><tr><th class="${R}table-header" colspan="2">Jump Distance</th><td class="${R}table-element">${P(n.jd,3)}</td></tr><tr><th class="${R}table-header" colspan="2">Reaction Time</th><td class="${R}table-element">${P(n.reactTime*1e3)}ms</td></tr>`,r}function Hd(t,e){const i=e.swingAnalysis,n=document.createElement("table");return n.className=R+"table",n.innerHTML=`<caption class="${R}table-caption">Swing Per Seconds (SPS):</caption><tr><th class="${R}table-header"></th><th class="${R}table-header">Total</th><th class="${R}table-header">Red</th><th class="${R}table-header">Blue</th></tr><tr><th class="${R}table-header">Count</th><td class="${R}table-element">${P(i.total.count,2)}</td><td class="${R}table-element">${P(i.red.count,2)}</td><td class="${R}table-element">${P(i.blue.count,2)}</td></tr><tr><th class="${R}table-header">Median</th><td class="${R}table-element">${P(i.total.median,2)}</td><td class="${R}table-element">${P(i.red.median,2)}</td><td class="${R}table-element">${P(i.blue.median,2)}</td></tr><tr><th class="${R}table-header">Peak</th><td class="${R}table-element">${P(i.total.peak,2)}</td><td class="${R}table-element">${P(i.red.peak,2)}</td><td class="${R}table-element">${P(i.blue.peak,2)}</td></tr><tr><th class="${R}table-header">Total</th><td class="${R}table-element">${i.total.total}</td><td class="${R}table-element">${i.red.total}</td><td class="${R}table-element">${i.blue.total}</td></tr>`,n}function cn(t){const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let i=t.length-1;i>=0;i--)t[i].color===0?(e.red.total++,t[i].hasChroma()&&e.red.chroma++,t[i].hasNoodleExtensions()&&e.red.noodleExtensions++,t[i].hasMappingExtensions()&&e.red.mappingExtensions++):t[i].color===1&&(e.blue.total++,t[i].hasChroma()&&e.blue.chroma++,t[i].hasNoodleExtensions()&&e.blue.noodleExtensions++,t[i].hasMappingExtensions()&&e.blue.mappingExtensions++);return e}function Yd(t){const e={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>=0;i--)e.total++,t[i].hasChroma()&&e.chroma++,t[i].hasNoodleExtensions()&&e.noodleExtensions++,t[i].hasMappingExtensions()&&e.mappingExtensions++;return e}function en(t,e){return t.filter(i=>i.data.posX===e).length}function Ud(t,e){return t.filter(i=>i.data.posY===e).length}function Vd(t,e,i){return t.filter(n=>n.data.posX===e&&n.data.posY===i).length}function Gd(t,e){return t.filter(i=>i.type!=="bomb"&&i.data.direction===e).length}function pc(t,e){switch(e){case"note":return t.filter(i=>i.type==="note");case"red":return t.filter(i=>i.type==="note"&&i.data.color===0);case"blue":return t.filter(i=>i.type==="note"&&i.data.color===1);case"arc":return t.filter(i=>i.type==="slider");case"redArc":return t.filter(i=>i.type==="slider"&&i.data.color===0);case"blueArc":return t.filter(i=>i.type==="slider"&&i.data.color===1);case"chain":return t.filter(i=>i.type==="burstSlider");case"redChain":return t.filter(i=>i.type==="burstSlider"&&i.data.color===0);case"blueChain":return t.filter(i=>i.type==="burstSlider"&&i.data.color===1);case"bomb":return t.filter(i=>i.type==="bomb");default:return t}}function Wd(t){var c;const e=t.target,i=e.id.replace(`${R}table-select-angle-`,"").split("-"),n=i[0],r=i[1],a=(c=rt.beatmapDifficulty.find(l=>l.characteristic===n&&l.difficulty===r))==null?void 0:c.noteContainer;if(!a){console.error(ai+"note could not be found");return}const s=pc(a,e.value),o=document.querySelector(`#${R}table-angle-${n}-${r}`);if(!o){console.error(ai+"table could not be found");return}o.innerHTML=gc(s)}function gc(t){const e=t.length||1,i=[4,0,5,2,8,3,6,1,7];let n="";for(let r=0;r<3;r++){n+="<tr>";for(let a=0;a<3;a++){let s=Gd(t,i[r*3+a]);n+=`<td class="${R}table-element">${s}<br>(${P(s/e*100,1)}%)</td>`}n+="</tr>"}return n}function qd(t,e){var a;const i=Ui.create(`${R}table-select-angle-${e.characteristic}-${e.difficulty}`,"Note Angle: ","caption",`${R}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"});(a=i.querySelector("select"))==null||a.addEventListener("change",Wd);let n=`<tbody id="${R}table-angle-${e.characteristic}-${e.difficulty}">${gc(e.noteContainer)}</tbody>`;const r=document.createElement("table");return r.className=R+"table",r.innerHTML=n,r.prepend(i),r}function Zd(t,e="DefaultEnvironment"){var r,a;const i=(a=(r=Ae[e])==null?void 0:r[0])!=null?a:Ae.DefaultEnvironment[0],n={};for(let s=i.length-1;s>=0;s--)n[i[s]]={total:0,chroma:0,chromaOld:0};for(let s=t.length-1;s>=0;s--)t[s].isValidType()&&(n[t[s].type]||(n[t[s].type]={total:0,chroma:0,chromaOld:0}),n[t[s].type].total++,t[s].hasChroma()&&n[t[s].type].chroma++,t[s].hasOldChroma()&&n[t[s].type].chromaOld++);return n}function Jd(t,e="DefaultEnvironment"){var r,a;const i=(a=(r=Ae[e])==null?void 0:r[1])!=null?a:Ae.DefaultEnvironment[1],n={};for(let s=i.length-1;s>=0;s--)n[i[s]]={total:0,eventBox:0,base:0};for(let s=t.length-1;s>=0;s--)n[t[s].groupID]||(n[t[s].groupID]={total:0,eventBox:0,base:0}),n[t[s].groupID].total++,n[t[s].groupID].eventBox+=t[s].events.length,n[t[s].groupID].base+=t[s].events.reduce((o,c)=>o+c.events.length,0);return n}function Kd(t,e="DefaultEnvironment"){var r,a;const i=(a=(r=Ae[e])==null?void 0:r[1])!=null?a:Ae.DefaultEnvironment[1],n={};for(let s=i.length-1;s>=0;s--)n[i[s]]={total:0,eventBox:0,base:0};for(let s=t.length-1;s>=0;s--)n[t[s].groupID]||(n[t[s].groupID]={total:0,eventBox:0,base:0}),n[t[s].groupID].total++,n[t[s].groupID].eventBox+=t[s].events.length,n[t[s].groupID].base+=t[s].events.reduce((o,c)=>o+c.events.length,0);return n}function Qd(t){const e={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>-1;i--)e.total++,t[i].isInteractive()&&e.interactive++,t[i].hasChroma()&&e.chroma++,t[i].hasNoodleExtensions()&&e.noodleExtensions++,t[i].hasMappingExtensions()&&e.mappingExtensions++;return e}function tf(t,e){switch(e){case"LinkinParkEnvironment":switch(t){case 0:return"Lane Light";case 1:return"Ceiling Lights";case 8:return"Laser Mode"}break;case"BTSEnvironment":switch(t){case 0:return"Door Light";case 1:return"Vertical Pillar Lights";case 8:return"Distant Tower Spin";case 9:return"Raise/Lower Pillars";case 40:return"BTS Event 1";case 41:return"BTS Event 2";case 42:return"BTS Event 3";case 43:return"BTS Event 4"}break;case"KaleidoscopeEnvironment":switch(t){case 0:return"Spike Tip Lights";case 1:return"Spike Mid Lights";case 2:return"Spike Left Lights";case 3:return"Spike Right Lights";case 4:return"Distant Lasers and Spike Top Lights"}break;case"InterscopeEnvironment":switch(t){case 0:return"Gate 1";case 1:return"Gate 2";case 2:return"Gate 3";case 3:return"Gate 4";case 4:return"Gate 5";case 6:return"Extra 1";case 7:return"Extra 2"}break;case"SkrillexEnvironment":switch(t){case 0:return"Logo";case 1:return"Top Lanes and 1st Ring Set";case 4:return"Bottom Lanes and 2nd Ring Set";case 6:return"Left Panel";case 7:return"Right Panel";case 12:return"Left Laser & Panel Speed";case 13:return"Right Laser & Panel Speed"}break;case"BillieEnvironment":switch(t){case 0:return"Water 4";case 1:return"Water 1";case 2:return"Left Sun Beams";case 3:return"Right Sun Beams";case 4:return"Sun";case 6:return"Water 2";case 7:return"Water 3";case 8:return"Toggle Rain";case 9:return"Sunbeam Mode";case 10:return"Left Bottom Lasers";case 11:return"Right Bottom Lasers";case 12:return"Left Sun Beams Speed";case 13:return"Right Sun Beams Speed"}break;case"HalloweenEnvironment":switch(t){case 0:return"Sky Lasers";case 1:return"Moon";case 4:return"Lane + Castle Interior"}break;case"GagaEnvironment":switch(t){case 0:return"Aurora 1";case 1:return"Aurora 2";case 2:return"Tower 1";case 3:return"Tower 2";case 4:return"Logo";case 6:return"Tower 3";case 7:return"Tower 4";case 10:return"Tower 5";case 11:return"Tower 6";case 14:return"Tower 1 Height";case 15:return"Tower 2 Height";case 16:return"Tower 3 Height";case 17:return"Tower 4 Height";case 18:return"Tower 5 Height";case 19:return"Tower 6 Height"}break;case"WeaveEnvironment":switch(t){case 4:return"Player Space"}break;case"PyroEnvironment":switch(t){case 0:return"Video Alpha";case 1:return"Logo";case 2:return"Left Projectors";case 3:return"Right Projectors";case 4:return"Platform";case 6:return"Ambient";case 40:return"Video Projection"}break;case"EDMEnvironment":switch(t){case 0:return"Lane Lights Bottom";case 1:return"Lane Lights Top";case 4:return"Player Space & Spectrogram"}break;case"TheSecondEnvironment":switch(t){case 0:return"Logo";case 1:return"Runway";case 2:return"Left Flags";case 3:return"Right Flags";case 4:return"Buildings"}break}switch(t){case 0:return"Back Lasers";case 1:return"Ring Lights";case 2:return"Left Lasers";case 3:return"Right Lasers";case 4:return"Center Lights";case 5:return"Boost Colors";case 6:return"Extra Left Lights";case 7:return"Extra Right Lights";case 8:return"Ring Rotation";case 9:return"Ring Zoom";case 10:return"Extra Left Lasers";case 11:return"Extra Right Lasers";case 12:return"Left Laser Speed";case 13:return"Right Laser Speed";case 14:return"Early Lane Rotation";case 15:return"Late Lane Rotation";case 16:return"Utility Event 1";case 17:return"Utility Event 2";case 18:return"Utility Event 3";case 19:return"Utility Event 4";default:return"Unknown"}}function ef(t,e){switch(e){case"WeaveEnvironment":switch(t){case 0:return"Outer Square Bottom Left Laser";case 1:return"Outer Square Bottom Right Laser";case 2:return"Outer Square Top Left Laser";case 3:return"Outer Square Top Right Laser";case 4:return"Inner Square Bottom Left Laser";case 5:return"Inner Square Bottom Right Laser";case 6:return"Inner Square Top Left Laser";case 7:return"Inner Square Top Right Laser";case 8:return"Side Square Bottom Left Laser";case 9:return"Side Square Bottom Right Laser";case 10:return"Side Square Top Left Laser";case 11:return"Side Square Top Right Laser";case 12:return"Distant Square Top Laser";case 13:return"Distant Square Bottom Laser";case 14:return"Distant Square Left Laser";case 15:return"Distant Square Right Laser"}case"PyroEnvironment":switch(t){case 0:return"Left Stage Light";case 1:return"Right Stage Light";case 2:return"Top Left Laser";case 3:return"Top Right Laser";case 4:return"Top Middle Laser";case 5:return"Top Light";case 6:return"Left Light Tower";case 7:return"Right Light Tower";case 8:return"Stage Left Laser";case 9:return"Stage Right Laser";case 10:return"Stage Far Left Laser";case 11:return"Stage Far Right Laser";case 12:return"Left Flame";case 13:return"Right Flame"}case"EDMEnvironment":switch(t){case 0:return"Top Circle";case 1:return"Close Circle";case 2:return"Distant Circle";case 3:return"Distant Circle 2";case 4:return"Left Single Source Circle";case 5:return"Right Single Source Circle";case 6:return"Left Laser (Up)";case 7:return"Left Laser (Out)";case 8:return"Right Laser (Up)";case 9:return"Right Laser (Out)";case 10:return"Left Laser (Down)";case 11:return"Right Laser (Down)";case 12:return"Left Laser (Down) / Top Circle Rotation";case 13:return"Right Laser (Up) / Close Circle Rotation";case 14:return"Distant Circle Rotation";case 15:return"Distant Circle 2 Rotation";case 16:return"Left Single Source Circle Rotation";case 17:return"Right Single Source Circle Rotation"}case"TheSecondEnvironment":switch(t){case 0:return"Bing Rings";case 1:return"Small Rings";case 2:return"Runway Left";case 3:return"Runway Right";case 4:return"Spotlight Left";case 5:return"Spotlight Right";case 6:return"Top Lasers Left Bottom";case 7:return"Top Lasers Right Bottom";case 8:return"Top Lasers Left Top";case 9:return"Top Lasers Right Top";case 10:return"Bottom Lasers Left Bottom";case 11:return"Bottom Lasers Right Bottom";case 12:return"Bottom Lasers Left Top";case 13:return"Bottom Lasers Right Top"}default:return"Unknown"}}function nf(t,e){const i=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,n=Zd(e.data.basicBeatmapEvents,i);let r=0,a=0,s=`<caption class="${R}table-caption">Events: ${Object.values(n).reduce((c,{total:l})=>c+l,0)}</caption>`;for(const c in n)r+=n[c].chroma,a+=n[c].chromaOld,s+=`<tr><th class="${R}table-header">${c}</th><th class="${R}table-header" colspan="4">${tf(parseInt(c),i)}</th><td class="${R}table-element">${n[c].total}</td></tr>`;r&&(s+=`<tr><th class="${R}table-header" colspan="5">Chroma</th><td class="${R}table-element">${r}</td></tr>`),a&&(s+=`<tr><th class="${R}table-header" colspan="5">OG Chroma</th><td class="${R}table-element">${a}</td></tr>`);const o=document.createElement("table");return o.className=R+"table",o.innerHTML=s,o}function af(t,e){const i=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,n=Jd(e.data.lightColorEventBoxGroups,i),r=Kd(e.data.lightRotationEventBoxGroups,i);let a=`<caption class="${R}table-caption">Color Event Box Groups: <span title="${Object.values(n).reduce((o,{eventBox:c})=>o+c,0)} Box (${Object.values(n).reduce((o,{base:c})=>o+c,0)} Base)">${Object.values(n).reduce((o,{total:c})=>o+c,0)}</span><br>Rotation Event Box Groups: <span title="${Object.values(r).reduce((o,{eventBox:c})=>o+c,0)} Box (${Object.values(r).reduce((o,{base:c})=>o+c,0)} Base)">${Object.values(r).reduce((o,{total:c})=>o+c,0)}</span></caption>`;for(const o in n)a+=`<tr><th class="${R}table-header">${o}</th><th class="${R}table-header" colspan="4">${ef(parseInt(o),i)}</th><td class="${R}table-element" title="${n[o].eventBox} Box (${n[o].base} Base)">${n[o].total}</td><td class="${R}table-element" title="${r[o].eventBox} Box (${r[o].base} Base)">${r[o].total}</td></tr>`;const s=document.createElement("table");return s.className=R+"table",s.innerHTML=a,s}const rf=115;function of(t){let e=0,i=1;for(let n=0,r=t.filter(a=>a.type==="note"&&!(typeof a.data.customData.uninteractable!="undefined"||!a.data.customData.uninteractable)).length;n<r;n++)i<8&&n===-3+i*4&&(i*=2),e+=rf*i;return e}function sf(t,e){const i=cn(e.data.colorNotes);let n=`<caption class="${R}table-caption">Note Information:</caption><tr><th class="${R}table-header" colspan="2">R/B Ratio</th><td class="${R}table-element">${P(i.red.total/i.blue.total,2)}</td></tr><tr><th class="${R}table-header" colspan="2">Max Score</th><td class="${R}table-element">${$c(of(e.noteContainer))}</td></tr><tr><th class="${R}table-header" colspan="2">Effective BPM</th><td class="${R}table-element">${P(ju(e.swingAnalysis.container),2)}</td></tr><tr><th class="${R}table-header" colspan="2">Effective BPM (swing)</th><td class="${R}table-element">${P(Hu(e.swingAnalysis.container),2)}</td></tr>`,r=P(Wu(e.swingAnalysis.container)*1e3,1),a=P(qu(e.swingAnalysis.container)*1e3,1);r&&a&&(n+=`<tr><th class="${R}table-header" colspan="2">Min. Slider Speed</th><td class="${R}table-element">${r}ms</td></tr><tr><th class="${R}table-header" colspan="2">Max. Slider Speed</th><td class="${R}table-element">${a}ms</td></tr>`);const s=document.createElement("table");return s.className=R+"table",s.innerHTML=n,s}function lf(t,e){const i=cn(e.data.colorNotes),n=cn(e.data.sliders),r=cn(e.data.burstSliders),a=Yd(e.data.bombNotes);let s=`<caption class="${R}table-caption">Note Count:</caption><tr><th class="${R}table-header"></th><th class="${R}table-header">Note</th><th class="${R}table-header">Arc</th><th class="${R}table-header">Chain</th><th class="${R}table-header">Bomb</th></tr><tr><th class="${R}table-header">Total</th><td class="${R}table-element">${i.red.total+i.blue.total}</td><td class="${R}table-element">${n.red.total+n.blue.total}</td><td class="${R}table-element">${r.red.total+r.blue.total}</td><td class="${R}table-element">${a.total}</td></tr><tr><th class="${R}table-header">Red</th><td class="${R}table-element">${i.red.total}</td><td class="${R}table-element">${n.red.total}</td><td class="${R}table-element">${r.red.total}</td><td class="${R}table-element">0</td></tr><tr><th class="${R}table-header">Blue</th><td class="${R}table-element">${i.blue.total}</td><td class="${R}table-element">${n.blue.total}</td><td class="${R}table-element">${r.blue.total}</td><td class="${R}table-element">0</td></tr>`;(i.red.chroma||i.blue.chroma||n.red.chroma||n.blue.chroma||r.red.chroma||r.blue.chroma||a.chroma)&&(s+=`<tr><th class="${R}table-header">Chroma</th><td class="${R}table-element">${i.red.chroma+i.blue.chroma}</td><td class="${R}table-element">${n.red.chroma+n.blue.chroma}</td><td class="${R}table-element">${r.red.chroma+r.blue.chroma}</td><td class="${R}table-element">${a.chroma}</td></tr>`),(i.red.noodleExtensions||i.blue.noodleExtensions||n.red.noodleExtensions||n.blue.noodleExtensions||r.red.noodleExtensions||r.blue.noodleExtensions||a.noodleExtensions)&&(s+=`<tr><th class="${R}table-header">NE</th><td class="${R}table-element">${i.red.noodleExtensions+i.blue.noodleExtensions}</td><td class="${R}table-element">${n.red.noodleExtensions+n.blue.noodleExtensions}</td><td class="${R}table-element">${r.red.noodleExtensions+r.blue.noodleExtensions}</td><td class="${R}table-element">${a.noodleExtensions}</td></tr></tr>`),(i.red.mappingExtensions||i.blue.mappingExtensions||n.red.mappingExtensions||n.blue.mappingExtensions||r.red.mappingExtensions||r.blue.mappingExtensions||a.mappingExtensions)&&(s+=`<tr><th class="${R}table-header">ME</th><td class="${R}table-element">${i.red.mappingExtensions+i.blue.mappingExtensions}</td><td class="${R}table-element">${n.red.mappingExtensions+n.blue.mappingExtensions}</td><td class="${R}table-element">${r.red.mappingExtensions+r.blue.mappingExtensions}</td><td class="${R}table-element">${a.mappingExtensions}</td></tr></tr>`);const o=document.createElement("table");return o.className=R+"table",o.innerHTML=s,o}function cf(t){var c;const e=t.target,i=e.id.replace(`${R}table-select-placement-`,"").split("-"),n=i[0],r=i[1],a=(c=rt.beatmapDifficulty.find(l=>l.characteristic===n&&l.difficulty===r))==null?void 0:c.noteContainer;if(!a){console.error(ai+"note could not be found");return}const s=pc(a,e.value),o=document.querySelector(`#${R}table-placement-${n}-${r}`);if(!o){console.error(ai+"table could not be found");return}o.innerHTML=_c(s)}function _c(t){const e=t.length||1;let i="";for(let n=2;n>=0;n--){i+="<tr>";for(let r=0;r<=3;r++)i+=`<td class="${R}table-element">${Vd(t,r,n)}</td>`;i+=`<td class="${R}table-element ${R}table--no-border">${P(Ud(t,n)/e*100,1)}%</td>
        </tr>`}return i+=`<tr><td class="${R}table-element ${R}table--no-border">${P(en(t,0)/e*100,1)}%</td><td class="${R}table-element ${R}table--no-border">${P(en(t,1)/e*100,1)}%</td><td class="${R}table-element ${R}table--no-border">${P(en(t,2)/e*100,1)}%</td><td class="${R}table-element ${R}table--no-border">${P(en(t,3)/e*100,1)}%</td></tr>`,i}function uf(t,e){var a;const i=Ui.create(`${R}table-select-placement-${e.characteristic}-${e.difficulty}`,"Note Placement: ","caption",`${R}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"},{text:"Bomb",value:"bomb"});(a=i.querySelector("select"))==null||a.addEventListener("change",cf);let n=`<tbody id="${R}table-placement-${e.characteristic}-${e.difficulty}">${_c(e.noteContainer)}</tbody>`;const r=document.createElement("table");return r.className=R+"table",r.innerHTML=n,r.prepend(i),r}function hf(t,e){const i=Qd(e.data.obstacles);let n=`<caption class="${R}table-caption">Obstacles: ${i.total}</caption>`;i.interactive&&(n+=`<tr><th class="${R}table-header" colspan="2">Interactive</th><td class="${R}table-element">${i.interactive}</td></tr>`),i.chroma&&(n+=`<tr><th class="${R}table-header" colspan="2">Chroma</th><td class="${R}table-element">${i.chroma}</td></tr>`),i.noodleExtensions&&(n+=`<tr><th class="${R}table-header" colspan="2">Noodle Extensions</th><td class="${R}table-element">${i.noodleExtensions}</td></tr>`),i.mappingExtensions&&(n+=`<tr><th class="${R}table-header" colspan="2">Mapping Extensions</th><td class="${R}table-element">${i.mappingExtensions}</td></tr>`);const r=document.createElement("table");return r.className=R+"table",r.innerHTML=n,r}const un=document.querySelector("#stats .accordion__collapsible");function df(){if(!rt.beatmapInfo)throw new Error(ai+"map info could not be found in savedData");const t=rt.beatmapInfo;t._difficultyBeatmapSets.forEach(e=>{var r,a;const i=document.createElement("div");i.className=R+"mode-"+e._beatmapCharacteristicName;const n=document.createElement("div");n.className=R+"title",n.textContent=Na[e._beatmapCharacteristicName],i.appendChild(n);for(let s=e._difficultyBeatmaps.length-1;s>=0;s--){const o=e._difficultyBeatmaps[s],c=rt.beatmapDifficulty.find(_=>_.characteristic===e._beatmapCharacteristicName&&_.difficulty===o._difficulty);if(!c)throw new Error(ai+"Could not find map data");const l=fs.create(`${R}${e._beatmapCharacteristicName}-${o._difficulty}`,Fi[o._difficulty]+((r=o._customData)!=null&&r._difficultyLabel?" -- "+((a=o._customData)==null?void 0:a._difficultyLabel):""),o._difficulty,!0),u=l.querySelector(".accordion__collapsible-flex"),p=l.querySelector(".accordion__button");if(!u||!p)throw new Error(ai+"something went wrong!");p.checked=nt.onLoad.stats;const g=ln.create("small","half"),d=ln.create("small","half"),m=ln.create("small","half");g.append(jd(t,c)),g.append(document.createElement("br")),g.append(Xd(t,c)),g.append(document.createElement("br")),g.append(Hd(t,c)),d.append(sf(t,c)),d.append(document.createElement("br")),d.append(lf(t,c)),d.append(document.createElement("br")),d.append(uf(t,c)),d.append(document.createElement("br")),d.append(qd(t,c)),m.append(nf(t,c)),m.append(document.createElement("br")),m.append(af(t,c)),m.append(document.createElement("br")),m.append(hf(t,c)),u.appendChild(g),u.appendChild(d),u.appendChild(m),i.appendChild(l)}un.appendChild(i)})}function ff(){for(;un.firstChild;)un.removeChild(un.firstChild)}const Kt=t=>`[convert::${t}]`;function mf(t,e){var n,r,a,s,o,c;if(e)et.warn(Kt("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!");else{if(et.warn(Kt("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!"),prompt("Proceed with conversion? (y/N):","n")[0].toLowerCase()!=="y")throw Error("Conversion to beatmap v3 denied.");et.info(Kt("V2toV3"),"Converting beatmap v2 to v3")}const i=ul.create();if(i.fileName=t.fileName,t.notes.forEach((l,u)=>{let p;if(l.customData&&(p={color:l.customData._color,coordinates:l.customData._position,disableNoteGravity:l.customData._disableNoteGravity,disableNoteLook:l.customData._disableNoteLook,flip:l.customData._flip,localRotation:l.customData._localRotation,noteJumpMovementSpeed:l.customData._noteJumpMovementSpeed,noteJumpStartBeatOffset:l.customData._noteJumpStartBeatOffset,spawnEffect:typeof l.customData._disableSpawnEffect=="boolean"?!l.customData._disableSpawnEffect:void 0,track:l.customData._track,uninteractable:typeof l.customData._interactable=="boolean"?!l.customData._interactable:void 0,worldRotation:l.customData._rotation},l.customData._animation&&(p.animation={color:l.customData._animation._color,definitePosition:l.customData._animation._definitePosition,dissolve:l.customData._animation._dissolve,dissolveArrow:l.customData._animation._dissolveArrow,interactable:l.customData._animation._interactable,localRotation:l.customData._animation._localRotation,offsetPosition:l.customData._animation._position,offsetRotation:l.customData._animation._rotation,scale:l.customData._animation._scale,time:l.customData._animation._time}),typeof l.customData._fake=="boolean"&&et.warn(Kt("V2toV3"),`notes[${u}] at time ${l.time} NE _fake will be removed.`),typeof l.customData._cutDirection=="number"&&et.debug(Kt("V2toV3"),`notes[${u}] at time ${l.time} NE _cutDirection will be converted.`)),l.isBomb()&&i.bombNotes.push(pn.create({b:l.time,x:l.posX,y:l.posY,customData:p})),l.isNote()){let g=0;typeof l.customData._cutDirection=="number"&&(g=l.customData._cutDirection>0?l.customData._cutDirection%360:360+l.customData._cutDirection%360),l.cutDirection>=1e3&&(g=Math.abs(l.cutDirection%1e3%360-360)),i.colorNotes.push(mi.create({b:l.time,c:l.type,x:l.posX,y:l.posY,d:l.cutDirection>=1e3||typeof l.customData._cutDirection=="number"?l.cutDirection===8?8:1:Nc(l.cutDirection,0,8),a:g,customData:p}))}}),t.obstacles.forEach((l,u)=>{let p;l.customData&&(p={color:l.customData._color,coordinates:l.customData._position,localRotation:l.customData._localRotation,noteJumpMovementSpeed:l.customData._noteJumpMovementSpeed,noteJumpStartBeatOffset:l.customData._noteJumpStartBeatOffset,size:l.customData._scale,track:l.customData._track,uninteractable:typeof l.customData._interactable=="boolean"?!l.customData._interactable:void 0,worldRotation:l.customData._rotation},l.customData._animation&&(p.animation={color:l.customData._animation._color,definitePosition:l.customData._animation._definitePosition,dissolve:l.customData._animation._dissolve,dissolveArrow:l.customData._animation._dissolveArrow,interactable:l.customData._animation._interactable,localRotation:l.customData._animation._localRotation,offsetPosition:l.customData._animation._position,offsetRotation:l.customData._animation._rotation,scale:l.customData._animation._scale,time:l.customData._animation._time}),typeof l.customData._fake=="boolean"&&et.warn(Kt("V2toV3"),`obstacles[${u}] at time ${l.time} NE _fake will be removed.`)),i.obstacles.push(fe.create({b:l.time,x:l.posX,y:l.type===2?l.posY:l.type?2:0,d:l.duration,w:l.width,h:l.type===2?l.height:l.type?3:5,customData:p}))}),t.events.forEach((l,u)=>{var p,g;if(l.isColorBoost())i.colorBoostBeatmapEvents.push(_n.create({b:l.time,o:!!l.value}));else if(l.isLaneRotationEvent())i.rotationEvents.push(bn.create({b:l.time,e:l.type===14?0:1,r:typeof l.customData._rotation=="number"?l.customData._rotation:l.value>=1e3?(l.value-1360)%360:(p=Wc[l.value])!=null?p:0}));else if(l.isBPMChangeEvent())i.bpmEvents.push(gn.create({b:l.time,m:l.floatValue}));else{let d;if(l.customData&&(l.isLightEvent()&&(d={color:l.customData._color,lightID:l.customData._lightID,easing:l.customData._easing,lerpType:l.customData._lerpType},l.customData._propID&&et.warn(Kt("V2toV3"),`events[${u}] at time ${l.time} Chroma _propID will be removed.`),l.customData._lightGradient&&et.warn(Kt("V2toV3"),`events[${u}] at time ${l.time} Chroma _lightGradient will be removed.`)),l.isRingEvent()&&(d={nameFilter:l.customData._nameFilter,rotation:l.customData._rotation,step:l.customData._step,prop:l.customData._prop,speed:l.customData._speed,direction:l.customData._direction},l.customData._reset&&et.warn(Kt("V2toV3"),`events[${u}] at time ${l.time} Chroma _reset will be removed.`),l.customData._counterSpin&&et.warn(Kt("V2toV3"),`events[${u}] at time ${l.time} Chroma _counterSpin will be removed.`),(l.customData._stepMult||l.customData._propMult||l.customData._speedMult)&&et.warn(Kt("V2toV3"),`events[${u}] at time ${l.time} Chroma _mult will be removed.`)),l.isLaserRotationEvent())){const m=(g=l.customData._preciseSpeed)!=null?g:l.customData._speed;d={lockRotation:l.customData._lockPosition,direction:l.customData._direction,speed:m}}i.basicBeatmapEvents.push(mn.create({b:l.time,et:l.type,i:l.value,f:l.floatValue,customData:d}))}}),t.waypoints.forEach(l=>{i.waypoints.push(vn.create({b:l.time,x:l.posX,y:l.posY,d:l.direction}))}),t.sliders.forEach(l=>i.sliders.push(yn.create({c:l.colorType,b:l.headTime,x:l.headPosX,y:l.headPosY,d:l.headCutDirection,mu:l.headLengthMultiplier,tb:l.tailTime,tx:l.tailPosX,ty:l.tailPosY,tc:l.tailCutDirection,tmu:l.tailLengthMultiplier,m:l.midAnchor}))),i.basicEventTypesWithKeywords=Ma.create({d:(a=(r=(n=t.specialEventsKeywordFilters)==null?void 0:n.keywords)==null?void 0:r.map(l=>({k:l.keyword,e:l.events})))!=null?a:[]}),t.customData)for(const l in t.customData){if(l==="_customEvents"){i.customData.customEvents=(s=t.customData._customEvents.map(u=>u._type==="AnimateTrack"?{beat:u._time,type:"AnimateTrack",data:{track:u._data._track,duration:u._data._duration,easing:u._data._easing,position:u._data._position,rotation:u._data._rotation,localRotation:u._data._localRotation,scale:u._data._scale,dissolve:u._data._dissolve,dissolveArrow:u._data._dissolveArrow,color:u._data._color,interactable:u._data._interactable,time:u._data._time}}:u._type==="AssignPathAnimation"?{beat:u._time,type:"AssignPathAnimation",data:{track:u._data._track,duration:u._data._duration,easing:u._data._easing,position:u._data._position,rotation:u._data._rotation,localRotation:u._data._localRotation,scale:u._data._scale,dissolve:u._data._dissolve,dissolveArrow:u._data._dissolveArrow,color:u._data._color,interactable:u._data._interactable,definitePosition:u._data._definitePosition}}:u._type==="AssignTrackParent"?{beat:u._time,type:"AssignTrackParent",data:{childrenTracks:u._data._childrenTracks,parentTrack:u._data._parentTrack,worldPositionStays:u._data._worldPositionStays}}:u._type==="AssignPlayerToTrack"?{beat:u._time,type:"AssignPlayerToTrack",data:{track:u._data._track}}:{beat:u._time,type:"AssignFogTrack",data:{track:u._data._track,attenuation:u._data._attenuation,offset:u._data._offset,startY:u._data._startY,height:u._data._height}}))!=null?s:[];continue}if(l==="_environment"){i.customData.environment=(o=t.customData._environment.map(u=>{var p,g;return{id:u._id,lookupMethod:u._lookupMethod,track:u._track,duplicate:u._duplicate,active:u._active,scale:u._scale,position:(p=u._position)==null?void 0:p.map(d=>d*.6),rotation:u._rotation,localPosition:(g=u._localPosition)==null?void 0:g.map(d=>d*.6),localRotation:u._localRotation,lightID:u._lightID}}))!=null?o:[];continue}if(l==="_pointDefinitions"){i.customData.pointDefinitions=(c=t.customData._pointDefinitions.map(u=>({name:u._name,points:u._points})))!=null?c:[];continue}i.customData[l]=t.customData[l]}return i.useNormalEventsAsCompatibleEvents=!0,i}const Ii=t=>`[load::${t}]`;async function pf(t){const e=t.file("Info.dat")||t.file("info.dat");if(!e)throw new Error("Couldn't find Info.dat");return et.info(Ii("loadInfo"),"loading info"),cu(JSON.parse(await e.async("string")))}async function gf(t,e){var r,a,s,o,c;const i=[],n=t._difficultyBeatmapSets;for(let l=n.length-1;l>=0;l--){const u=n[l]._difficultyBeatmaps;if(u.length===0||!u){et.error(Ii("loadDifficulty"),"Empty difficulty set, removing..."),n.splice(l,1);continue}for(let p=0;p<u.length;p++){const g=u[p],d=e.file(g._beatmapFilename);if(d){et.info(Ii("loadDifficulty"),`Loading ${n[l]._beatmapCharacteristicName} ${g._difficulty}`);let m;try{m=JSON.parse(await d.async("string"))}catch(_){throw new Error(`${n[l]._beatmapCharacteristicName} ${g._difficulty} ${_}`)}try{if(m._notes&&m.version&&et.error(Ii("loadDifficulty"),`${n[l]._beatmapCharacteristicName} ${g._difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`),m.version){const _=Ou(m),b=me.create(t._beatsPerMinute,_.customData.BPMChanges,(r=g._customData)==null?void 0:r._editorOffset);i.push({info:g,characteristic:n[l]._beatmapCharacteristicName,difficulty:g._difficulty,bpm:b,data:_,noteContainer:_.getNoteContainer(),eventContainer:_.getEventContainer(),swingAnalysis:Pr(_,b,n[l]._beatmapCharacteristicName,g._difficulty),rawVersion:3,rawData:m})}else{const _=mf(bu(m),!0),b=me.create(t._beatsPerMinute,(o=(a=m._customData)==null?void 0:a._BPMChanges)!=null?o:(s=m._customData)==null?void 0:s._bpmChanges,(c=g._customData)==null?void 0:c._editorOffset);i.push({info:g,characteristic:n[l]._beatmapCharacteristicName,difficulty:g._difficulty,bpm:b,data:_,noteContainer:_.getNoteContainer(),eventContainer:_.getEventContainer(),swingAnalysis:Pr(_,b,n[l]._beatmapCharacteristicName,g._difficulty),rawVersion:2,rawData:m})}}catch(_){throw new Error(`${n[l]._beatmapCharacteristicName} ${g._difficulty} ${_}`)}}else if(et.error(Ii("loadDifficulty"),`Missing ${g._beatmapFilename} file for ${n[l]._beatmapCharacteristicName} ${g._difficulty}, ignoring.`),n[l]._difficultyBeatmaps.splice(p,1),p--,n[l]._difficultyBeatmaps.length<1){et.error(`${n[l]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),n.splice(l,1);continue}}}return i}async function bc(t){return new Promise(function(e,i){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="json",n.timeout=5e3;let r=Date.now();n.onprogress=()=>{n.timeout+=Date.now()-r},n.onload=()=>{n.status===200&&e(n.response),n.status===404&&i("Error 404: Map does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function _f(t){const e=`https://api.beatsaver.com/maps/id/${t}`,i=await bc(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}async function bf(t){const e=`https://api.beatsaver.com/maps/hash/${t}`,i=await bc(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}const Hi=t=>`[download::${t}]`;async function rr(t){return new Promise(function(e,i){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.timeout=5e3;let r=Date.now();n.onprogress=a=>{n.timeout+=Date.now()-r,_t.status("download",`Downloading map: ${P(a.loaded/1024/1024,1)}MB / ${P(a.total/1024/1024,1)}MB`,a.loaded/a.total*100)},n.onload=()=>{n.status===200&&e(n.response),n.status===404&&i("Error 404: Map/link does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function yc(t){const e=gs(t);et.info(Hi("downloadFromID"),`fetching download URL from BeatSaver for map ID ${e}`),_t.status("info","Fetching download URL from BeatSaver",0);const i=await _f(e);et.info(Hi("downloadFromID"),`downloading from BeatSaver for map ID ${e}`),_t.status("info","Requesting download from BeatSaver",0);const n=await rr(i);return Nt.setCoverLink("https://beatsaver.com/maps/"+e,e),n}async function yf(t){const e=ps(t);if(e.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return yc(e.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);_t.status("info","Requesting download from link",0),et.info(Hi("downloadFromURL"),`downloading from ${e}`);let i=await rr(e);return Nt.setCoverLink(e),i}async function vf(t){let e;if(ms(t.trim()))e=t.trim();else throw new Error("invalid hash");et.info(Hi("downloadFromHash"),`fetching download URL from BeatSaver for map hash ${e}`),_t.status("info","Fetching download URL from BeatSaver",0);const i=await bf(e);return et.info(Hi("downloadFromHash"),`downloading from BeatSaver for map hash ${e}`),_t.status("info","Requesting download from BeatSaver",0),await rr(i)}var nn=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function an(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vc={exports:{}};/*!

JSZip v3.10.0 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(i){t.exports=i()})(function(){return function i(n,r,a){function s(l,u){if(!r[l]){if(!n[l]){var p=typeof an=="function"&&an;if(!u&&p)return p(l,!0);if(o)return o(l,!0);var g=new Error("Cannot find module '"+l+"'");throw g.code="MODULE_NOT_FOUND",g}var d=r[l]={exports:{}};n[l][0].call(d.exports,function(m){var _=n[l][1][m];return s(_||m)},d,d.exports,i,n,r,a)}return r[l].exports}for(var o=typeof an=="function"&&an,c=0;c<a.length;c++)s(a[c]);return s}({1:[function(i,n,r){var a=i("./utils"),s=i("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(c){for(var l,u,p,g,d,m,_,b=[],y=0,v=c.length,S=v,C=a.getTypeOf(c)!=="string";y<c.length;)S=v-y,p=C?(l=c[y++],u=y<v?c[y++]:0,y<v?c[y++]:0):(l=c.charCodeAt(y++),u=y<v?c.charCodeAt(y++):0,y<v?c.charCodeAt(y++):0),g=l>>2,d=(3&l)<<4|u>>4,m=1<S?(15&u)<<2|p>>6:64,_=2<S?63&p:64,b.push(o.charAt(g)+o.charAt(d)+o.charAt(m)+o.charAt(_));return b.join("")},r.decode=function(c){var l,u,p,g,d,m,_=0,b=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,S=3*(c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(c.charAt(c.length-1)===o.charAt(64)&&S--,c.charAt(c.length-2)===o.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|S):new Array(0|S);_<c.length;)l=o.indexOf(c.charAt(_++))<<2|(g=o.indexOf(c.charAt(_++)))>>4,u=(15&g)<<4|(d=o.indexOf(c.charAt(_++)))>>2,p=(3&d)<<6|(m=o.indexOf(c.charAt(_++))),v[b++]=l,d!==64&&(v[b++]=u),m!==64&&(v[b++]=p);return v}},{"./support":30,"./utils":32}],2:[function(i,n,r){var a=i("./external"),s=i("./stream/DataWorker"),o=i("./stream/Crc32Probe"),c=i("./stream/DataLengthProbe");function l(u,p,g,d,m){this.compressedSize=u,this.uncompressedSize=p,this.crc32=g,this.compression=d,this.compressedContent=m}l.prototype={getContentWorker:function(){var u=new s(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new s(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(u,p,g){return u.pipe(new o).pipe(new c("uncompressedSize")).pipe(p.compressWorker(g)).pipe(new c("compressedSize")).withStreamInfo("compression",p)},n.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,n,r){var a=i("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(s){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},r.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,n,r){var a=i("./utils"),s=function(){for(var o,c=[],l=0;l<256;l++){o=l;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;c[l]=o}return c}();n.exports=function(o,c){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?function(l,u,p,g){var d=s,m=g+p;l^=-1;for(var _=g;_<m;_++)l=l>>>8^d[255&(l^u[_])];return-1^l}(0|c,o,o.length,0):function(l,u,p,g){var d=s,m=g+p;l^=-1;for(var _=g;_<m;_++)l=l>>>8^d[255&(l^u.charCodeAt(_))];return-1^l}(0|c,o,o.length,0):0}},{"./utils":32}],5:[function(i,n,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(i,n,r){var a=null;a=typeof Promise!="undefined"?Promise:i("lie"),n.exports={Promise:a}},{lie:37}],7:[function(i,n,r){var a=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",s=i("pako"),o=i("./utils"),c=i("./stream/GenericWorker"),l=a?"uint8array":"array";function u(p,g){c.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=g,this.meta={}}r.magic="\b\0",o.inherits(u,c),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(l,p.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(g){p.push({data:g,meta:p.meta})}},r.compressWorker=function(p){return new u("Deflate",p)},r.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,n,r){function a(d,m){var _,b="";for(_=0;_<m;_++)b+=String.fromCharCode(255&d),d>>>=8;return b}function s(d,m,_,b,y,v){var S,C,x=d.file,F=d.compression,M=v!==l.utf8encode,H=o.transformTo("string",v(x.name)),$=o.transformTo("string",l.utf8encode(x.name)),U=x.comment,K=o.transformTo("string",v(U)),k=o.transformTo("string",l.utf8encode(U)),N=$.length!==x.name.length,h=k.length!==U.length,T="",J="",X="",at=x.dir,Y=x.date,Q={crc32:0,compressedSize:0,uncompressedSize:0};m&&!_||(Q.crc32=d.crc32,Q.compressedSize=d.compressedSize,Q.uncompressedSize=d.uncompressedSize);var B=0;m&&(B|=8),M||!N&&!h||(B|=2048);var A=0,it=0;at&&(A|=16),y==="UNIX"?(it=798,A|=function(W,vt){var Lt=W;return W||(Lt=vt?16893:33204),(65535&Lt)<<16}(x.unixPermissions,at)):(it=20,A|=function(W){return 63&(W||0)}(x.dosPermissions)),S=Y.getUTCHours(),S<<=6,S|=Y.getUTCMinutes(),S<<=5,S|=Y.getUTCSeconds()/2,C=Y.getUTCFullYear()-1980,C<<=4,C|=Y.getUTCMonth()+1,C<<=5,C|=Y.getUTCDate(),N&&(J=a(1,1)+a(u(H),4)+$,T+="up"+a(J.length,2)+J),h&&(X=a(1,1)+a(u(K),4)+k,T+="uc"+a(X.length,2)+X);var q="";return q+=`
\0`,q+=a(B,2),q+=F.magic,q+=a(S,2),q+=a(C,2),q+=a(Q.crc32,4),q+=a(Q.compressedSize,4),q+=a(Q.uncompressedSize,4),q+=a(H.length,2),q+=a(T.length,2),{fileRecord:p.LOCAL_FILE_HEADER+q+H+T,dirRecord:p.CENTRAL_FILE_HEADER+a(it,2)+q+a(K.length,2)+"\0\0\0\0"+a(A,4)+a(b,4)+H+T+K}}var o=i("../utils"),c=i("../stream/GenericWorker"),l=i("../utf8"),u=i("../crc32"),p=i("../signature");function g(d,m,_,b){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=_,this.encodeFileName=b,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(g,c),g.prototype.push=function(d){var m=d.meta.percent||0,_=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,c.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:_?(m+100*(_-b-1))/_:100}}))},g.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var m=this.streamFiles&&!d.file.dir;if(m){var _=s(d,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},g.prototype.closedSource=function(d){this.accumulate=!1;var m=this.streamFiles&&!d.file.dir,_=s(d,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),m)this.push({data:function(b){return p.DATA_DESCRIPTOR+a(b.crc32,4)+a(b.compressedSize,4)+a(b.uncompressedSize,4)}(d),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},g.prototype.flush=function(){for(var d=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var _=this.bytesWritten-d,b=function(y,v,S,C,x){var F=o.transformTo("string",x(C));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(y,2)+a(y,2)+a(v,4)+a(S,4)+a(F.length,2)+F}(this.dirRecords.length,_,d,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},g.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},g.prototype.registerPrevious=function(d){this._sources.push(d);var m=this;return d.on("data",function(_){m.processChunk(_)}),d.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),d.on("error",function(_){m.error(_)}),this},g.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},g.prototype.error=function(d){var m=this._sources;if(!c.prototype.error.call(this,d))return!1;for(var _=0;_<m.length;_++)try{m[_].error(d)}catch{}return!0},g.prototype.lock=function(){c.prototype.lock.call(this);for(var d=this._sources,m=0;m<d.length;m++)d[m].lock()},n.exports=g},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,n,r){var a=i("../compressions"),s=i("./ZipFileWorker");r.generateWorker=function(o,c,l){var u=new s(c.streamFiles,l,c.platform,c.encodeFileName),p=0;try{o.forEach(function(g,d){p++;var m=function(v,S){var C=v||S,x=a[C];if(!x)throw new Error(C+" is not a valid compression method !");return x}(d.options.compression,c.compression),_=d.options.compressionOptions||c.compressionOptions||{},b=d.dir,y=d.date;d._compressWorker(m,_).withStreamInfo("file",{name:g,dir:b,date:y,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(g){u.error(g)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,n,r){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new a;for(var o in this)typeof this[o]!="function"&&(s[o]=this[o]);return s}}(a.prototype=i("./object")).loadAsync=i("./load"),a.support=i("./support"),a.defaults=i("./defaults"),a.version="3.10.0",a.loadAsync=function(s,o){return new a().loadAsync(s,o)},a.external=i("./external"),n.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,n,r){var a=i("./utils"),s=i("./external"),o=i("./utf8"),c=i("./zipEntries"),l=i("./stream/Crc32Probe"),u=i("./nodejsUtils");function p(g){return new s.Promise(function(d,m){var _=g.decompressed.getContentWorker().pipe(new l);_.on("error",function(b){m(b)}).on("end",function(){_.streamInfo.crc32!==g.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}n.exports=function(g,d){var m=this;return d=a.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(g)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",g,!0,d.optimizedBinaryString,d.base64).then(function(_){var b=new c(d);return b.load(_),b}).then(function(_){var b=[s.Promise.resolve(_)],y=_.files;if(d.checkCRC32)for(var v=0;v<y.length;v++)b.push(p(y[v]));return s.Promise.all(b)}).then(function(_){for(var b=_.shift(),y=b.files,v=0;v<y.length;v++){var S=y[v],C=S.fileNameStr,x=a.resolve(S.fileNameStr);m.file(x,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:d.createFolders}),S.dir||(m.file(x).unsafeOriginalName=C)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,n,r){var a=i("../utils"),s=i("../stream/GenericWorker");function o(c,l){s.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(l)}a.inherits(o,s),o.prototype._bindStream=function(c){var l=this;(this._stream=c).pause(),c.on("data",function(u){l.push({data:u,meta:{percent:0}})}).on("error",function(u){l.isPaused?this.generatedError=u:l.error(u)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},o.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,n,r){var a=i("readable-stream").Readable;function s(o,c,l){a.call(this,c),this._helper=o;var u=this;o.on("data",function(p,g){u.push(p)||u._helper.pause(),l&&l(g)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}i("../utils").inherits(s,a),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(i,n,r){n.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(a,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,s);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,s)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var s=new Buffer(a);return s.fill(0),s},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(i,n,r){function a(x,F,M){var H,$=o.getTypeOf(F),U=o.extend(M||{},u);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(x=y(x)),U.createFolders&&(H=b(x))&&v.call(this,H,!0);var K=$==="string"&&U.binary===!1&&U.base64===!1;M&&M.binary!==void 0||(U.binary=!K),(F instanceof p&&F.uncompressedSize===0||U.dir||!F||F.length===0)&&(U.base64=!1,U.binary=!0,F="",U.compression="STORE",$="string");var k=null;k=F instanceof p||F instanceof c?F:m.isNode&&m.isStream(F)?new _(x,F):o.prepareContent(x,F,U.binary,U.optimizedBinaryString,U.base64);var N=new g(x,k,U);this.files[x]=N}var s=i("./utf8"),o=i("./utils"),c=i("./stream/GenericWorker"),l=i("./stream/StreamHelper"),u=i("./defaults"),p=i("./compressedObject"),g=i("./zipObject"),d=i("./generate"),m=i("./nodejsUtils"),_=i("./nodejs/NodejsStreamInputAdapter"),b=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var F=x.lastIndexOf("/");return 0<F?x.substring(0,F):""},y=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},v=function(x,F){return F=F!==void 0?F:u.createFolders,x=y(x),this.files[x]||a.call(this,x,null,{dir:!0,createFolders:F}),this.files[x]};function S(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var F,M,H;for(F in this.files)H=this.files[F],(M=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&x(M,H)},filter:function(x){var F=[];return this.forEach(function(M,H){x(M,H)&&F.push(H)}),F},file:function(x,F,M){if(arguments.length!==1)return x=this.root+x,a.call(this,x,F,M),this;if(S(x)){var H=x;return this.filter(function(U,K){return!K.dir&&H.test(U)})}var $=this.files[this.root+x];return $&&!$.dir?$:null},folder:function(x){if(!x)return this;if(S(x))return this.filter(function($,U){return U.dir&&x.test($)});var F=this.root+x,M=v.call(this,F),H=this.clone();return H.root=M.name,H},remove:function(x){x=this.root+x;var F=this.files[x];if(F||(x.slice(-1)!=="/"&&(x+="/"),F=this.files[x]),F&&!F.dir)delete this.files[x];else for(var M=this.filter(function($,U){return U.name.slice(0,x.length)===x}),H=0;H<M.length;H++)delete this.files[M[H].name];return this},generate:function(x){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var F,M={};try{if((M=o.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=M.type.toLowerCase(),M.compression=M.compression.toUpperCase(),M.type==="binarystring"&&(M.type="string"),!M.type)throw new Error("No output type specified.");o.checkSupport(M.type),M.platform!=="darwin"&&M.platform!=="freebsd"&&M.platform!=="linux"&&M.platform!=="sunos"||(M.platform="UNIX"),M.platform==="win32"&&(M.platform="DOS");var H=M.comment||this.comment||"";F=d.generateWorker(this,M,H)}catch($){(F=new c("error")).error($)}return new l(F,M.type||"string",M.mimeType)},generateAsync:function(x,F){return this.generateInternalStream(x).accumulate(F)},generateNodeStream:function(x,F){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(F)}};n.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,n,r){n.exports=i("stream")},{stream:void 0}],17:[function(i,n,r){var a=i("./DataReader");function s(o){a.call(this,o);for(var c=0;c<this.data.length;c++)o[c]=255&o[c]}i("../utils").inherits(s,a),s.prototype.byteAt=function(o){return this.data[this.zero+o]},s.prototype.lastIndexOfSignature=function(o){for(var c=o.charCodeAt(0),l=o.charCodeAt(1),u=o.charCodeAt(2),p=o.charCodeAt(3),g=this.length-4;0<=g;--g)if(this.data[g]===c&&this.data[g+1]===l&&this.data[g+2]===u&&this.data[g+3]===p)return g-this.zero;return-1},s.prototype.readAndCheckSignature=function(o){var c=o.charCodeAt(0),l=o.charCodeAt(1),u=o.charCodeAt(2),p=o.charCodeAt(3),g=this.readData(4);return c===g[0]&&l===g[1]&&u===g[2]&&p===g[3]},s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(i,n,r){var a=i("../utils");function s(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(o){},readInt:function(o){var c,l=0;for(this.checkOffset(o),c=this.index+o-1;c>=this.index;c--)l=(l<<8)+this.byteAt(c);return this.index+=o,l},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(o){},lastIndexOfSignature:function(o){},readAndCheckSignature:function(o){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=s},{"../utils":32}],19:[function(i,n,r){var a=i("./Uint8ArrayReader");function s(o){a.call(this,o)}i("../utils").inherits(s,a),s.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,n,r){var a=i("./DataReader");function s(o){a.call(this,o)}i("../utils").inherits(s,a),s.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},s.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},s.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},s.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(i,n,r){var a=i("./ArrayReader");function s(o){a.call(this,o)}i("../utils").inherits(s,a),s.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(i,n,r){var a=i("../utils"),s=i("../support"),o=i("./ArrayReader"),c=i("./StringReader"),l=i("./NodeBufferReader"),u=i("./Uint8ArrayReader");n.exports=function(p){var g=a.getTypeOf(p);return a.checkSupport(g),g!=="string"||s.uint8array?g==="nodebuffer"?new l(p):s.uint8array?new u(a.transformTo("uint8array",p)):new o(a.transformTo("array",p)):new c(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,n,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,n,r){var a=i("./GenericWorker"),s=i("../utils");function o(c){a.call(this,"ConvertWorker to "+c),this.destType=c}s.inherits(o,a),o.prototype.processChunk=function(c){this.push({data:s.transformTo(this.destType,c.data),meta:c.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(i,n,r){var a=i("./GenericWorker"),s=i("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}i("../utils").inherits(o,a),o.prototype.processChunk=function(c){this.streamInfo.crc32=s(c.data,this.streamInfo.crc32||0),this.push(c)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,n,r){var a=i("../utils"),s=i("./GenericWorker");function o(c){s.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}a.inherits(o,s),o.prototype.processChunk=function(c){if(c){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+c.data.length}s.prototype.processChunk.call(this,c)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(i,n,r){var a=i("../utils"),s=i("./GenericWorker");function o(c){s.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){l.dataIsReady=!0,l.data=u,l.max=u&&u.length||0,l.type=a.getTypeOf(u),l.isPaused||l._tickAndRepeat()},function(u){l.error(u)})}a.inherits(o,s),o.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,l);break;case"uint8array":c=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":c=this.data.slice(this.index,l)}return this.index=l,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(i,n,r){function a(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,o){return this._listeners[s].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,o){if(this._listeners[s])for(var c=0;c<this._listeners[s].length;c++)this._listeners[s][c].call(this,o)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var o=this;return s.on("data",function(c){o.processChunk(c)}),s.on("end",function(){o.end()}),s.on("error",function(c){o.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,o){return this.extraStreamInfo[s]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=a},{}],29:[function(i,n,r){var a=i("../utils"),s=i("./ConvertWorker"),o=i("./GenericWorker"),c=i("../base64"),l=i("../support"),u=i("../external"),p=null;if(l.nodestream)try{p=i("../nodejs/NodejsStreamOutputAdapter")}catch{}function g(m,_){return new u.Promise(function(b,y){var v=[],S=m._internalType,C=m._outputType,x=m._mimeType;m.on("data",function(F,M){v.push(F),_&&_(M)}).on("error",function(F){v=[],y(F)}).on("end",function(){try{var F=function(M,H,$){switch(M){case"blob":return a.newBlob(a.transformTo("arraybuffer",H),$);case"base64":return c.encode(H);default:return a.transformTo(M,H)}}(C,function(M,H){var $,U=0,K=null,k=0;for($=0;$<H.length;$++)k+=H[$].length;switch(M){case"string":return H.join("");case"array":return Array.prototype.concat.apply([],H);case"uint8array":for(K=new Uint8Array(k),$=0;$<H.length;$++)K.set(H[$],U),U+=H[$].length;return K;case"nodebuffer":return Buffer.concat(H);default:throw new Error("concat : unsupported type '"+M+"'")}}(S,v),x);b(F)}catch(M){y(M)}v=[]}).resume()})}function d(m,_,b){var y=_;switch(_){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=_,this._mimeType=b,a.checkSupport(y),this._worker=m.pipe(new s(y)),m.lock()}catch(v){this._worker=new o("error"),this._worker.error(v)}}d.prototype={accumulate:function(m){return g(this,m)},on:function(m,_){var b=this;return m==="data"?this._worker.on(m,function(y){_.call(b,y.data,y.meta)}):this._worker.on(m,function(){a.delay(_,arguments,b)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},m)}},n.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,n,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",r.nodebuffer=typeof Buffer!="undefined",r.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")r.blob=!1;else{var a=new ArrayBuffer(0);try{r.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(a),r.blob=s.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!i("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(i,n,r){for(var a=i("./utils"),s=i("./support"),o=i("./nodejsUtils"),c=i("./stream/GenericWorker"),l=new Array(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;l[254]=l[254]=1;function p(){c.call(this,"utf-8 decode"),this.leftOver=null}function g(){c.call(this,"utf-8 encode")}r.utf8encode=function(d){return s.nodebuffer?o.newBufferFrom(d,"utf-8"):function(m){var _,b,y,v,S,C=m.length,x=0;for(v=0;v<C;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<C&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),x+=b<128?1:b<2048?2:b<65536?3:4;for(_=s.uint8array?new Uint8Array(x):new Array(x),v=S=0;S<x;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<C&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),b<128?_[S++]=b:(b<2048?_[S++]=192|b>>>6:(b<65536?_[S++]=224|b>>>12:(_[S++]=240|b>>>18,_[S++]=128|b>>>12&63),_[S++]=128|b>>>6&63),_[S++]=128|63&b);return _}(d)},r.utf8decode=function(d){return s.nodebuffer?a.transformTo("nodebuffer",d).toString("utf-8"):function(m){var _,b,y,v,S=m.length,C=new Array(2*S);for(_=b=0;_<S;)if((y=m[_++])<128)C[b++]=y;else if(4<(v=l[y]))C[b++]=65533,_+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&_<S;)y=y<<6|63&m[_++],v--;1<v?C[b++]=65533:y<65536?C[b++]=y:(y-=65536,C[b++]=55296|y>>10&1023,C[b++]=56320|1023&y)}return C.length!==b&&(C.subarray?C=C.subarray(0,b):C.length=b),a.applyFromCharCode(C)}(d=a.transformTo(s.uint8array?"uint8array":"array",d))},a.inherits(p,c),p.prototype.processChunk=function(d){var m=a.transformTo(s.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var _=m;(m=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),m.set(_,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(v,S){var C;for((S=S||v.length)>v.length&&(S=v.length),C=S-1;0<=C&&(192&v[C])==128;)C--;return C<0||C===0?S:C+l[v[C]]>S?C:S}(m),y=m;b!==m.length&&(s.uint8array?(y=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(y=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:r.utf8decode(y),meta:d.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=p,a.inherits(g,c),g.prototype.processChunk=function(d){this.push({data:r.utf8encode(d.data),meta:d.meta})},r.Utf8EncodeWorker=g},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,n,r){var a=i("./support"),s=i("./base64"),o=i("./nodejsUtils"),c=i("./external");function l(_){return _}function u(_,b){for(var y=0;y<_.length;++y)b[y]=255&_.charCodeAt(y);return b}i("setimmediate"),r.newBlob=function(_,b){r.checkSupport("blob");try{return new Blob([_],{type:b})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(_),y.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(_,b,y){var v=[],S=0,C=_.length;if(C<=y)return String.fromCharCode.apply(null,_);for(;S<C;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,_.slice(S,Math.min(S+y,C)))):v.push(String.fromCharCode.apply(null,_.subarray(S,Math.min(S+y,C)))),S+=y;return v.join("")},stringifyByChar:function(_){for(var b="",y=0;y<_.length;y++)b+=String.fromCharCode(_[y]);return b},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function g(_){var b=65536,y=r.getTypeOf(_),v=!0;if(y==="uint8array"?v=p.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=p.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return p.stringifyByChunk(_,y,b)}catch{b=Math.floor(b/2)}return p.stringifyByChar(_)}function d(_,b){for(var y=0;y<_.length;y++)b[y]=_[y];return b}r.applyFromCharCode=g;var m={};m.string={string:l,array:function(_){return u(_,new Array(_.length))},arraybuffer:function(_){return m.string.uint8array(_).buffer},uint8array:function(_){return u(_,new Uint8Array(_.length))},nodebuffer:function(_){return u(_,o.allocBuffer(_.length))}},m.array={string:g,array:l,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return o.newBufferFrom(_)}},m.arraybuffer={string:function(_){return g(new Uint8Array(_))},array:function(_){return d(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:l,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return o.newBufferFrom(new Uint8Array(_))}},m.uint8array={string:g,array:function(_){return d(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:l,nodebuffer:function(_){return o.newBufferFrom(_)}},m.nodebuffer={string:g,array:function(_){return d(_,new Array(_.length))},arraybuffer:function(_){return m.nodebuffer.uint8array(_).buffer},uint8array:function(_){return d(_,new Uint8Array(_.length))},nodebuffer:l},r.transformTo=function(_,b){if(b=b||"",!_)return b;r.checkSupport(_);var y=r.getTypeOf(b);return m[y][_](b)},r.resolve=function(_){for(var b=_.split("/"),y=[],v=0;v<b.length;v++){var S=b[v];S==="."||S===""&&v!==0&&v!==b.length-1||(S===".."?y.pop():y.push(S))}return y.join("/")},r.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(_)?"nodebuffer":a.uint8array&&_ instanceof Uint8Array?"uint8array":a.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(_){if(!a[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(_){var b,y,v="";for(y=0;y<(_||"").length;y++)v+="\\x"+((b=_.charCodeAt(y))<16?"0":"")+b.toString(16).toUpperCase();return v},r.delay=function(_,b,y){setImmediate(function(){_.apply(y||null,b||[])})},r.inherits=function(_,b){function y(){}y.prototype=b.prototype,_.prototype=new y},r.extend=function(){var _,b,y={};for(_=0;_<arguments.length;_++)for(b in arguments[_])arguments[_].hasOwnProperty(b)&&y[b]===void 0&&(y[b]=arguments[_][b]);return y},r.prepareContent=function(_,b,y,v,S){return c.Promise.resolve(b).then(function(C){return a.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader!="undefined"?new c.Promise(function(x,F){var M=new FileReader;M.onload=function(H){x(H.target.result)},M.onerror=function(H){F(H.target.error)},M.readAsArrayBuffer(C)}):C}).then(function(C){var x=r.getTypeOf(C);return x?(x==="arraybuffer"?C=r.transformTo("uint8array",C):x==="string"&&(S?C=s.decode(C):y&&v!==!0&&(C=function(F){return u(F,a.uint8array?new Uint8Array(F.length):new Array(F.length))}(C))),C):c.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,n,r){var a=i("./reader/readerFor"),s=i("./utils"),o=i("./signature"),c=i("./zipEntry"),l=(i("./utf8"),i("./support"));function u(p){this.files=[],this.loadOptions=p}u.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var g=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(g)+", expected "+s.pretty(p)+")")}},isSignature:function(p,g){var d=this.reader.index;this.reader.setIndex(p);var m=this.reader.readString(4)===g;return this.reader.setIndex(d),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),g=l.uint8array?"uint8array":"array",d=s.transformTo(g,p);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,g,d,m=this.zip64EndOfCentralSize-44;0<m;)p=this.reader.readInt(2),g=this.reader.readInt(4),d=this.reader.readData(g),this.zip64ExtensibleData[p]={id:p,length:g,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,g;for(p=0;p<this.files.length;p++)g=this.files[p],this.reader.setIndex(g.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),g.readLocalPart(this.reader),g.handleUTF8(),g.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(p=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var g=p;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var m=g-d;if(0<m)this.isSignature(g,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(p){this.reader=a(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(i,n,r){var a=i("./reader/readerFor"),s=i("./utils"),o=i("./compressedObject"),c=i("./crc32"),l=i("./utf8"),u=i("./compressions"),p=i("./support");function g(d,m){this.options=d,this.loadOptions=m}g.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var m,_;if(d.skip(22),this.fileNameLength=d.readInt(2),_=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var y in u)if(u.hasOwnProperty(y)&&u[y].magic===b)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var m=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(m),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(d){if(this.extraFields[1]){var m=a(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=m.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=m.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=m.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=m.readInt(4))}},readExtraFields:function(d){var m,_,b,y=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<y;)m=d.readInt(2),_=d.readInt(2),b=d.readData(_),this.extraFields[m]={id:m,length:_,value:b};d.setIndex(y)},handleUTF8:function(){var d=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var _=s.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var y=s.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var m=a(d.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:l.utf8decode(m.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var m=a(d.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:l.utf8decode(m.readData(d.length-5))}return null}},n.exports=g},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,n,r){function a(m,_,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=_,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var s=i("./stream/StreamHelper"),o=i("./stream/DataWorker"),c=i("./utf8"),l=i("./compressedObject"),u=i("./stream/GenericWorker");a.prototype={internalStream:function(m){var _=null,b="string";try{if(!m)throw new Error("No output type specified.");var y=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),_=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(_=_.pipe(new c.Utf8EncodeWorker)),!v&&y&&(_=_.pipe(new c.Utf8DecodeWorker))}catch(S){(_=new u("error")).error(S)}return new s(_,b,"")},async:function(m,_){return this.internalStream(m).accumulate(_)},nodeStream:function(m,_){return this.internalStream(m||"nodebuffer").toNodejsStream(_)},_compressWorker:function(m,_){if(this._data instanceof l&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new c.Utf8EncodeWorker)),l.createWorkerFrom(b,m,_)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],g=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<p.length;d++)a.prototype[p[d]]=g;n.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,n,r){(function(a){var s,o,c=a.MutationObserver||a.WebKitMutationObserver;if(c){var l=0,u=new c(m),p=a.document.createTextNode("");u.observe(p,{characterData:!0}),s=function(){p.data=l=++l%2}}else if(a.setImmediate||a.MessageChannel===void 0)s="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var _=a.document.createElement("script");_.onreadystatechange=function(){m(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},a.document.documentElement.appendChild(_)}:function(){setTimeout(m,0)};else{var g=new a.MessageChannel;g.port1.onmessage=m,s=function(){g.port2.postMessage(0)}}var d=[];function m(){var _,b;o=!0;for(var y=d.length;y;){for(b=d,d=[],_=-1;++_<y;)b[_]();y=d.length}o=!1}n.exports=function(_){d.push(_)!==1||o||s()}}).call(this,typeof nn!="undefined"?nn:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(i,n,r){var a=i("immediate");function s(){}var o={},c=["REJECTED"],l=["FULFILLED"],u=["PENDING"];function p(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==s&&_(this,y)}function g(y,v,S){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function d(y,v,S){a(function(){var C;try{C=v(S)}catch(x){return o.reject(y,x)}C===y?o.reject(y,new TypeError("Cannot resolve promise with itself")):o.resolve(y,C)})}function m(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function _(y,v){var S=!1;function C(M){S||(S=!0,o.reject(y,M))}function x(M){S||(S=!0,o.resolve(y,M))}var F=b(function(){v(x,C)});F.status==="error"&&C(F.value)}function b(y,v){var S={};try{S.value=y(v),S.status="success"}catch(C){S.status="error",S.value=C}return S}(n.exports=p).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(S){return v.resolve(y()).then(function(){return S})},function(S){return v.resolve(y()).then(function(){throw S})})},p.prototype.catch=function(y){return this.then(null,y)},p.prototype.then=function(y,v){if(typeof y!="function"&&this.state===l||typeof v!="function"&&this.state===c)return this;var S=new this.constructor(s);return this.state!==u?d(S,this.state===l?y:v,this.outcome):this.queue.push(new g(S,y,v)),S},g.prototype.callFulfilled=function(y){o.resolve(this.promise,y)},g.prototype.otherCallFulfilled=function(y){d(this.promise,this.onFulfilled,y)},g.prototype.callRejected=function(y){o.reject(this.promise,y)},g.prototype.otherCallRejected=function(y){d(this.promise,this.onRejected,y)},o.resolve=function(y,v){var S=b(m,v);if(S.status==="error")return o.reject(y,S.value);var C=S.value;if(C)_(y,C);else{y.state=l,y.outcome=v;for(var x=-1,F=y.queue.length;++x<F;)y.queue[x].callFulfilled(v)}return y},o.reject=function(y,v){y.state=c,y.outcome=v;for(var S=-1,C=y.queue.length;++S<C;)y.queue[S].callRejected(v);return y},p.resolve=function(y){return y instanceof this?y:o.resolve(new this(s),y)},p.reject=function(y){var v=new this(s);return o.reject(v,y)},p.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=y.length,C=!1;if(!S)return this.resolve([]);for(var x=new Array(S),F=0,M=-1,H=new this(s);++M<S;)$(y[M],M);return H;function $(U,K){v.resolve(U).then(function(k){x[K]=k,++F!==S||C||(C=!0,o.resolve(H,x))},function(k){C||(C=!0,o.reject(H,k))})}},p.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=y.length,C=!1;if(!S)return this.resolve([]);for(var x=-1,F=new this(s);++x<S;)M=y[x],v.resolve(M).then(function(H){C||(C=!0,o.resolve(F,H))},function(H){C||(C=!0,o.reject(F,H))});var M;return F}},{immediate:36}],38:[function(i,n,r){var a={};(0,i("./lib/utils/common").assign)(a,i("./lib/deflate"),i("./lib/inflate"),i("./lib/zlib/constants")),n.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,n,r){var a=i("./zlib/deflate"),s=i("./utils/common"),o=i("./utils/strings"),c=i("./zlib/messages"),l=i("./zlib/zstream"),u=Object.prototype.toString,p=0,g=-1,d=0,m=8;function _(y){if(!(this instanceof _))return new _(y);this.options=s.assign({level:g,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var S=a.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(S!==p)throw new Error(c[S]);if(v.header&&a.deflateSetHeader(this.strm,v.header),v.dictionary){var C;if(C=typeof v.dictionary=="string"?o.string2buf(v.dictionary):u.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(S=a.deflateSetDictionary(this.strm,C))!==p)throw new Error(c[S]);this._dict_set=!0}}function b(y,v){var S=new _(v);if(S.push(y,!0),S.err)throw S.msg||c[S.err];return S.result}_.prototype.push=function(y,v){var S,C,x=this.strm,F=this.options.chunkSize;if(this.ended)return!1;C=v===~~v?v:v===!0?4:0,typeof y=="string"?x.input=o.string2buf(y):u.call(y)==="[object ArrayBuffer]"?x.input=new Uint8Array(y):x.input=y,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new s.Buf8(F),x.next_out=0,x.avail_out=F),(S=a.deflate(x,C))!==1&&S!==p)return this.onEnd(S),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(s.shrinkBuf(x.output,x.next_out))):this.onData(s.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&S!==1);return C===4?(S=a.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===p):C!==2||(this.onEnd(p),!(x.avail_out=0))},_.prototype.onData=function(y){this.chunks.push(y)},_.prototype.onEnd=function(y){y===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},r.Deflate=_,r.deflate=b,r.deflateRaw=function(y,v){return(v=v||{}).raw=!0,b(y,v)},r.gzip=function(y,v){return(v=v||{}).gzip=!0,b(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,n,r){var a=i("./zlib/inflate"),s=i("./utils/common"),o=i("./utils/strings"),c=i("./zlib/constants"),l=i("./zlib/messages"),u=i("./zlib/zstream"),p=i("./zlib/gzheader"),g=Object.prototype.toString;function d(_){if(!(this instanceof d))return new d(_);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},_||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||_&&_.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&(15&b.windowBits)==0&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=a.inflateInit2(this.strm,b.windowBits);if(y!==c.Z_OK)throw new Error(l[y]);this.header=new p,a.inflateGetHeader(this.strm,this.header)}function m(_,b){var y=new d(b);if(y.push(_,!0),y.err)throw y.msg||l[y.err];return y.result}d.prototype.push=function(_,b){var y,v,S,C,x,F,M=this.strm,H=this.options.chunkSize,$=this.options.dictionary,U=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof _=="string"?M.input=o.binstring2buf(_):g.call(_)==="[object ArrayBuffer]"?M.input=new Uint8Array(_):M.input=_,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new s.Buf8(H),M.next_out=0,M.avail_out=H),(y=a.inflate(M,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&$&&(F=typeof $=="string"?o.string2buf($):g.call($)==="[object ArrayBuffer]"?new Uint8Array($):$,y=a.inflateSetDictionary(this.strm,F)),y===c.Z_BUF_ERROR&&U===!0&&(y=c.Z_OK,U=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);M.next_out&&(M.avail_out!==0&&y!==c.Z_STREAM_END&&(M.avail_in!==0||v!==c.Z_FINISH&&v!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=o.utf8border(M.output,M.next_out),C=M.next_out-S,x=o.buf2string(M.output,S),M.next_out=C,M.avail_out=H-C,C&&s.arraySet(M.output,M.output,S,C,0),this.onData(x)):this.onData(s.shrinkBuf(M.output,M.next_out)))),M.avail_in===0&&M.avail_out===0&&(U=!0)}while((0<M.avail_in||M.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(v=c.Z_FINISH),v===c.Z_FINISH?(y=a.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):v!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(M.avail_out=0))},d.prototype.onData=function(_){this.chunks.push(_)},d.prototype.onEnd=function(_){_===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},r.Inflate=d,r.inflate=m,r.inflateRaw=function(_,b){return(b=b||{}).raw=!0,m(_,b)},r.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,n,r){var a=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";r.assign=function(c){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var u=l.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(c[p]=u[p])}}return c},r.shrinkBuf=function(c,l){return c.length===l?c:c.subarray?c.subarray(0,l):(c.length=l,c)};var s={arraySet:function(c,l,u,p,g){if(l.subarray&&c.subarray)c.set(l.subarray(u,u+p),g);else for(var d=0;d<p;d++)c[g+d]=l[u+d]},flattenChunks:function(c){var l,u,p,g,d,m;for(l=p=0,u=c.length;l<u;l++)p+=c[l].length;for(m=new Uint8Array(p),l=g=0,u=c.length;l<u;l++)d=c[l],m.set(d,g),g+=d.length;return m}},o={arraySet:function(c,l,u,p,g){for(var d=0;d<p;d++)c[g+d]=l[u+d]},flattenChunks:function(c){return[].concat.apply([],c)}};r.setTyped=function(c){c?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,s)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(a)},{}],42:[function(i,n,r){var a=i("./common"),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var c=new a.Buf8(256),l=0;l<256;l++)c[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function u(p,g){if(g<65537&&(p.subarray&&o||!p.subarray&&s))return String.fromCharCode.apply(null,a.shrinkBuf(p,g));for(var d="",m=0;m<g;m++)d+=String.fromCharCode(p[m]);return d}c[254]=c[254]=1,r.string2buf=function(p){var g,d,m,_,b,y=p.length,v=0;for(_=0;_<y;_++)(64512&(d=p.charCodeAt(_)))==55296&&_+1<y&&(64512&(m=p.charCodeAt(_+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),_++),v+=d<128?1:d<2048?2:d<65536?3:4;for(g=new a.Buf8(v),_=b=0;b<v;_++)(64512&(d=p.charCodeAt(_)))==55296&&_+1<y&&(64512&(m=p.charCodeAt(_+1)))==56320&&(d=65536+(d-55296<<10)+(m-56320),_++),d<128?g[b++]=d:(d<2048?g[b++]=192|d>>>6:(d<65536?g[b++]=224|d>>>12:(g[b++]=240|d>>>18,g[b++]=128|d>>>12&63),g[b++]=128|d>>>6&63),g[b++]=128|63&d);return g},r.buf2binstring=function(p){return u(p,p.length)},r.binstring2buf=function(p){for(var g=new a.Buf8(p.length),d=0,m=g.length;d<m;d++)g[d]=p.charCodeAt(d);return g},r.buf2string=function(p,g){var d,m,_,b,y=g||p.length,v=new Array(2*y);for(d=m=0;d<y;)if((_=p[d++])<128)v[m++]=_;else if(4<(b=c[_]))v[m++]=65533,d+=b-1;else{for(_&=b===2?31:b===3?15:7;1<b&&d<y;)_=_<<6|63&p[d++],b--;1<b?v[m++]=65533:_<65536?v[m++]=_:(_-=65536,v[m++]=55296|_>>10&1023,v[m++]=56320|1023&_)}return u(v,m)},r.utf8border=function(p,g){var d;for((g=g||p.length)>p.length&&(g=p.length),d=g-1;0<=d&&(192&p[d])==128;)d--;return d<0||d===0?g:d+c[p[d]]>g?d:g}},{"./common":41}],43:[function(i,n,r){n.exports=function(a,s,o,c){for(var l=65535&a|0,u=a>>>16&65535|0,p=0;o!==0;){for(o-=p=2e3<o?2e3:o;u=u+(l=l+s[c++]|0)|0,--p;);l%=65521,u%=65521}return l|u<<16|0}},{}],44:[function(i,n,r){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,n,r){var a=function(){for(var s,o=[],c=0;c<256;c++){s=c;for(var l=0;l<8;l++)s=1&s?3988292384^s>>>1:s>>>1;o[c]=s}return o}();n.exports=function(s,o,c,l){var u=a,p=l+c;s^=-1;for(var g=l;g<p;g++)s=s>>>8^u[255&(s^o[g])];return-1^s}},{}],46:[function(i,n,r){var a,s=i("../utils/common"),o=i("./trees"),c=i("./adler32"),l=i("./crc32"),u=i("./messages"),p=0,g=4,d=0,m=-2,_=-1,b=4,y=2,v=8,S=9,C=286,x=30,F=19,M=2*C+1,H=15,$=3,U=258,K=U+$+1,k=42,N=113,h=1,T=2,J=3,X=4;function at(f,O){return f.msg=u[O],O}function Y(f){return(f<<1)-(4<f?9:0)}function Q(f){for(var O=f.length;0<=--O;)f[O]=0}function B(f){var O=f.state,I=O.pending;I>f.avail_out&&(I=f.avail_out),I!==0&&(s.arraySet(f.output,O.pending_buf,O.pending_out,I,f.next_out),f.next_out+=I,O.pending_out+=I,f.total_out+=I,f.avail_out-=I,O.pending-=I,O.pending===0&&(O.pending_out=0))}function A(f,O){o._tr_flush_block(f,0<=f.block_start?f.block_start:-1,f.strstart-f.block_start,O),f.block_start=f.strstart,B(f.strm)}function it(f,O){f.pending_buf[f.pending++]=O}function q(f,O){f.pending_buf[f.pending++]=O>>>8&255,f.pending_buf[f.pending++]=255&O}function W(f,O){var I,w,E=f.max_chain_length,D=f.strstart,z=f.prev_length,j=f.nice_match,L=f.strstart>f.w_size-K?f.strstart-(f.w_size-K):0,V=f.window,Z=f.w_mask,G=f.prev,tt=f.strstart+U,gt=V[D+z-1],lt=V[D+z];f.prev_length>=f.good_match&&(E>>=2),j>f.lookahead&&(j=f.lookahead);do if(V[(I=O)+z]===lt&&V[I+z-1]===gt&&V[I]===V[D]&&V[++I]===V[D+1]){D+=2,I++;do;while(V[++D]===V[++I]&&V[++D]===V[++I]&&V[++D]===V[++I]&&V[++D]===V[++I]&&V[++D]===V[++I]&&V[++D]===V[++I]&&V[++D]===V[++I]&&V[++D]===V[++I]&&D<tt);if(w=U-(tt-D),D=tt-U,z<w){if(f.match_start=O,j<=(z=w))break;gt=V[D+z-1],lt=V[D+z]}}while((O=G[O&Z])>L&&--E!=0);return z<=f.lookahead?z:f.lookahead}function vt(f){var O,I,w,E,D,z,j,L,V,Z,G=f.w_size;do{if(E=f.window_size-f.lookahead-f.strstart,f.strstart>=G+(G-K)){for(s.arraySet(f.window,f.window,G,G,0),f.match_start-=G,f.strstart-=G,f.block_start-=G,O=I=f.hash_size;w=f.head[--O],f.head[O]=G<=w?w-G:0,--I;);for(O=I=G;w=f.prev[--O],f.prev[O]=G<=w?w-G:0,--I;);E+=G}if(f.strm.avail_in===0)break;if(z=f.strm,j=f.window,L=f.strstart+f.lookahead,V=E,Z=void 0,Z=z.avail_in,V<Z&&(Z=V),I=Z===0?0:(z.avail_in-=Z,s.arraySet(j,z.input,z.next_in,Z,L),z.state.wrap===1?z.adler=c(z.adler,j,Z,L):z.state.wrap===2&&(z.adler=l(z.adler,j,Z,L)),z.next_in+=Z,z.total_in+=Z,Z),f.lookahead+=I,f.lookahead+f.insert>=$)for(D=f.strstart-f.insert,f.ins_h=f.window[D],f.ins_h=(f.ins_h<<f.hash_shift^f.window[D+1])&f.hash_mask;f.insert&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[D+$-1])&f.hash_mask,f.prev[D&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=D,D++,f.insert--,!(f.lookahead+f.insert<$)););}while(f.lookahead<K&&f.strm.avail_in!==0)}function Lt(f,O){for(var I,w;;){if(f.lookahead<K){if(vt(f),f.lookahead<K&&O===p)return h;if(f.lookahead===0)break}if(I=0,f.lookahead>=$&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,I=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),I!==0&&f.strstart-I<=f.w_size-K&&(f.match_length=W(f,I)),f.match_length>=$)if(w=o._tr_tally(f,f.strstart-f.match_start,f.match_length-$),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=$){for(f.match_length--;f.strstart++,f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,I=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart,--f.match_length!=0;);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+1])&f.hash_mask;else w=o._tr_tally(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(w&&(A(f,!1),f.strm.avail_out===0))return h}return f.insert=f.strstart<$-1?f.strstart:$-1,O===g?(A(f,!0),f.strm.avail_out===0?J:X):f.last_lit&&(A(f,!1),f.strm.avail_out===0)?h:T}function st(f,O){for(var I,w,E;;){if(f.lookahead<K){if(vt(f),f.lookahead<K&&O===p)return h;if(f.lookahead===0)break}if(I=0,f.lookahead>=$&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,I=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=$-1,I!==0&&f.prev_length<f.max_lazy_match&&f.strstart-I<=f.w_size-K&&(f.match_length=W(f,I),f.match_length<=5&&(f.strategy===1||f.match_length===$&&4096<f.strstart-f.match_start)&&(f.match_length=$-1)),f.prev_length>=$&&f.match_length<=f.prev_length){for(E=f.strstart+f.lookahead-$,w=o._tr_tally(f,f.strstart-1-f.prev_match,f.prev_length-$),f.lookahead-=f.prev_length-1,f.prev_length-=2;++f.strstart<=E&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,I=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),--f.prev_length!=0;);if(f.match_available=0,f.match_length=$-1,f.strstart++,w&&(A(f,!1),f.strm.avail_out===0))return h}else if(f.match_available){if((w=o._tr_tally(f,0,f.window[f.strstart-1]))&&A(f,!1),f.strstart++,f.lookahead--,f.strm.avail_out===0)return h}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(w=o._tr_tally(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<$-1?f.strstart:$-1,O===g?(A(f,!0),f.strm.avail_out===0?J:X):f.last_lit&&(A(f,!1),f.strm.avail_out===0)?h:T}function ft(f,O,I,w,E){this.good_length=f,this.max_lazy=O,this.nice_length=I,this.max_chain=w,this.func=E}function Ct(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*M),this.dyn_dtree=new s.Buf16(2*(2*x+1)),this.bl_tree=new s.Buf16(2*(2*F+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(H+1),this.heap=new s.Buf16(2*C+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*C+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Et(f){var O;return f&&f.state?(f.total_in=f.total_out=0,f.data_type=y,(O=f.state).pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?k:N,f.adler=O.wrap===2?0:1,O.last_flush=p,o._tr_init(O),d):at(f,m)}function ce(f){var O=Et(f);return O===d&&function(I){I.window_size=2*I.w_size,Q(I.head),I.max_lazy_match=a[I.level].max_lazy,I.good_match=a[I.level].good_length,I.nice_match=a[I.level].nice_length,I.max_chain_length=a[I.level].max_chain,I.strstart=0,I.block_start=0,I.lookahead=0,I.insert=0,I.match_length=I.prev_length=$-1,I.match_available=0,I.ins_h=0}(f.state),O}function Jt(f,O,I,w,E,D){if(!f)return m;var z=1;if(O===_&&(O=6),w<0?(z=0,w=-w):15<w&&(z=2,w-=16),E<1||S<E||I!==v||w<8||15<w||O<0||9<O||D<0||b<D)return at(f,m);w===8&&(w=9);var j=new Ct;return(f.state=j).strm=f,j.wrap=z,j.gzhead=null,j.w_bits=w,j.w_size=1<<j.w_bits,j.w_mask=j.w_size-1,j.hash_bits=E+7,j.hash_size=1<<j.hash_bits,j.hash_mask=j.hash_size-1,j.hash_shift=~~((j.hash_bits+$-1)/$),j.window=new s.Buf8(2*j.w_size),j.head=new s.Buf16(j.hash_size),j.prev=new s.Buf16(j.w_size),j.lit_bufsize=1<<E+6,j.pending_buf_size=4*j.lit_bufsize,j.pending_buf=new s.Buf8(j.pending_buf_size),j.d_buf=1*j.lit_bufsize,j.l_buf=3*j.lit_bufsize,j.level=O,j.strategy=D,j.method=I,ce(f)}a=[new ft(0,0,0,0,function(f,O){var I=65535;for(I>f.pending_buf_size-5&&(I=f.pending_buf_size-5);;){if(f.lookahead<=1){if(vt(f),f.lookahead===0&&O===p)return h;if(f.lookahead===0)break}f.strstart+=f.lookahead,f.lookahead=0;var w=f.block_start+I;if((f.strstart===0||f.strstart>=w)&&(f.lookahead=f.strstart-w,f.strstart=w,A(f,!1),f.strm.avail_out===0)||f.strstart-f.block_start>=f.w_size-K&&(A(f,!1),f.strm.avail_out===0))return h}return f.insert=0,O===g?(A(f,!0),f.strm.avail_out===0?J:X):(f.strstart>f.block_start&&(A(f,!1),f.strm.avail_out),h)}),new ft(4,4,8,4,Lt),new ft(4,5,16,8,Lt),new ft(4,6,32,32,Lt),new ft(4,4,16,16,st),new ft(8,16,32,32,st),new ft(8,16,128,128,st),new ft(8,32,128,256,st),new ft(32,128,258,1024,st),new ft(32,258,258,4096,st)],r.deflateInit=function(f,O){return Jt(f,O,v,15,8,0)},r.deflateInit2=Jt,r.deflateReset=ce,r.deflateResetKeep=Et,r.deflateSetHeader=function(f,O){return f&&f.state?f.state.wrap!==2?m:(f.state.gzhead=O,d):m},r.deflate=function(f,O){var I,w,E,D;if(!f||!f.state||5<O||O<0)return f?at(f,m):m;if(w=f.state,!f.output||!f.input&&f.avail_in!==0||w.status===666&&O!==g)return at(f,f.avail_out===0?-5:m);if(w.strm=f,I=w.last_flush,w.last_flush=O,w.status===k)if(w.wrap===2)f.adler=0,it(w,31),it(w,139),it(w,8),w.gzhead?(it(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),it(w,255&w.gzhead.time),it(w,w.gzhead.time>>8&255),it(w,w.gzhead.time>>16&255),it(w,w.gzhead.time>>24&255),it(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),it(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(it(w,255&w.gzhead.extra.length),it(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(f.adler=l(f.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(it(w,0),it(w,0),it(w,0),it(w,0),it(w,0),it(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),it(w,3),w.status=N);else{var z=v+(w.w_bits-8<<4)<<8;z|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(z|=32),z+=31-z%31,w.status=N,q(w,z),w.strstart!==0&&(q(w,f.adler>>>16),q(w,65535&f.adler)),f.adler=1}if(w.status===69)if(w.gzhead.extra){for(E=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),B(f),E=w.pending,w.pending!==w.pending_buf_size));)it(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){E=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),B(f),E=w.pending,w.pending===w.pending_buf_size)){D=1;break}D=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,it(w,D)}while(D!==0);w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),D===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){E=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),B(f),E=w.pending,w.pending===w.pending_buf_size)){D=1;break}D=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,it(w,D)}while(D!==0);w.gzhead.hcrc&&w.pending>E&&(f.adler=l(f.adler,w.pending_buf,w.pending-E,E)),D===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&B(f),w.pending+2<=w.pending_buf_size&&(it(w,255&f.adler),it(w,f.adler>>8&255),f.adler=0,w.status=N)):w.status=N),w.pending!==0){if(B(f),f.avail_out===0)return w.last_flush=-1,d}else if(f.avail_in===0&&Y(O)<=Y(I)&&O!==g)return at(f,-5);if(w.status===666&&f.avail_in!==0)return at(f,-5);if(f.avail_in!==0||w.lookahead!==0||O!==p&&w.status!==666){var j=w.strategy===2?function(L,V){for(var Z;;){if(L.lookahead===0&&(vt(L),L.lookahead===0)){if(V===p)return h;break}if(L.match_length=0,Z=o._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,Z&&(A(L,!1),L.strm.avail_out===0))return h}return L.insert=0,V===g?(A(L,!0),L.strm.avail_out===0?J:X):L.last_lit&&(A(L,!1),L.strm.avail_out===0)?h:T}(w,O):w.strategy===3?function(L,V){for(var Z,G,tt,gt,lt=L.window;;){if(L.lookahead<=U){if(vt(L),L.lookahead<=U&&V===p)return h;if(L.lookahead===0)break}if(L.match_length=0,L.lookahead>=$&&0<L.strstart&&(G=lt[tt=L.strstart-1])===lt[++tt]&&G===lt[++tt]&&G===lt[++tt]){gt=L.strstart+U;do;while(G===lt[++tt]&&G===lt[++tt]&&G===lt[++tt]&&G===lt[++tt]&&G===lt[++tt]&&G===lt[++tt]&&G===lt[++tt]&&G===lt[++tt]&&tt<gt);L.match_length=U-(gt-tt),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=$?(Z=o._tr_tally(L,1,L.match_length-$),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(Z=o._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),Z&&(A(L,!1),L.strm.avail_out===0))return h}return L.insert=0,V===g?(A(L,!0),L.strm.avail_out===0?J:X):L.last_lit&&(A(L,!1),L.strm.avail_out===0)?h:T}(w,O):a[w.level].func(w,O);if(j!==J&&j!==X||(w.status=666),j===h||j===J)return f.avail_out===0&&(w.last_flush=-1),d;if(j===T&&(O===1?o._tr_align(w):O!==5&&(o._tr_stored_block(w,0,0,!1),O===3&&(Q(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),B(f),f.avail_out===0))return w.last_flush=-1,d}return O!==g?d:w.wrap<=0?1:(w.wrap===2?(it(w,255&f.adler),it(w,f.adler>>8&255),it(w,f.adler>>16&255),it(w,f.adler>>24&255),it(w,255&f.total_in),it(w,f.total_in>>8&255),it(w,f.total_in>>16&255),it(w,f.total_in>>24&255)):(q(w,f.adler>>>16),q(w,65535&f.adler)),B(f),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?d:1)},r.deflateEnd=function(f){var O;return f&&f.state?(O=f.state.status)!==k&&O!==69&&O!==73&&O!==91&&O!==103&&O!==N&&O!==666?at(f,m):(f.state=null,O===N?at(f,-3):d):m},r.deflateSetDictionary=function(f,O){var I,w,E,D,z,j,L,V,Z=O.length;if(!f||!f.state||(D=(I=f.state).wrap)===2||D===1&&I.status!==k||I.lookahead)return m;for(D===1&&(f.adler=c(f.adler,O,Z,0)),I.wrap=0,Z>=I.w_size&&(D===0&&(Q(I.head),I.strstart=0,I.block_start=0,I.insert=0),V=new s.Buf8(I.w_size),s.arraySet(V,O,Z-I.w_size,I.w_size,0),O=V,Z=I.w_size),z=f.avail_in,j=f.next_in,L=f.input,f.avail_in=Z,f.next_in=0,f.input=O,vt(I);I.lookahead>=$;){for(w=I.strstart,E=I.lookahead-($-1);I.ins_h=(I.ins_h<<I.hash_shift^I.window[w+$-1])&I.hash_mask,I.prev[w&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=w,w++,--E;);I.strstart=w,I.lookahead=$-1,vt(I)}return I.strstart+=I.lookahead,I.block_start=I.strstart,I.insert=I.lookahead,I.lookahead=0,I.match_length=I.prev_length=$-1,I.match_available=0,f.next_in=j,f.input=L,f.avail_in=z,I.wrap=D,d},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,n,r){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,n,r){n.exports=function(a,s){var o,c,l,u,p,g,d,m,_,b,y,v,S,C,x,F,M,H,$,U,K,k,N,h,T;o=a.state,c=a.next_in,h=a.input,l=c+(a.avail_in-5),u=a.next_out,T=a.output,p=u-(s-a.avail_out),g=u+(a.avail_out-257),d=o.dmax,m=o.wsize,_=o.whave,b=o.wnext,y=o.window,v=o.hold,S=o.bits,C=o.lencode,x=o.distcode,F=(1<<o.lenbits)-1,M=(1<<o.distbits)-1;t:do{S<15&&(v+=h[c++]<<S,S+=8,v+=h[c++]<<S,S+=8),H=C[v&F];e:for(;;){if(v>>>=$=H>>>24,S-=$,($=H>>>16&255)===0)T[u++]=65535&H;else{if(!(16&$)){if((64&$)==0){H=C[(65535&H)+(v&(1<<$)-1)];continue e}if(32&$){o.mode=12;break t}a.msg="invalid literal/length code",o.mode=30;break t}U=65535&H,($&=15)&&(S<$&&(v+=h[c++]<<S,S+=8),U+=v&(1<<$)-1,v>>>=$,S-=$),S<15&&(v+=h[c++]<<S,S+=8,v+=h[c++]<<S,S+=8),H=x[v&M];i:for(;;){if(v>>>=$=H>>>24,S-=$,!(16&($=H>>>16&255))){if((64&$)==0){H=x[(65535&H)+(v&(1<<$)-1)];continue i}a.msg="invalid distance code",o.mode=30;break t}if(K=65535&H,S<($&=15)&&(v+=h[c++]<<S,(S+=8)<$&&(v+=h[c++]<<S,S+=8)),d<(K+=v&(1<<$)-1)){a.msg="invalid distance too far back",o.mode=30;break t}if(v>>>=$,S-=$,($=u-p)<K){if(_<($=K-$)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break t}if(N=y,(k=0)===b){if(k+=m-$,$<U){for(U-=$;T[u++]=y[k++],--$;);k=u-K,N=T}}else if(b<$){if(k+=m+b-$,($-=b)<U){for(U-=$;T[u++]=y[k++],--$;);if(k=0,b<U){for(U-=$=b;T[u++]=y[k++],--$;);k=u-K,N=T}}}else if(k+=b-$,$<U){for(U-=$;T[u++]=y[k++],--$;);k=u-K,N=T}for(;2<U;)T[u++]=N[k++],T[u++]=N[k++],T[u++]=N[k++],U-=3;U&&(T[u++]=N[k++],1<U&&(T[u++]=N[k++]))}else{for(k=u-K;T[u++]=T[k++],T[u++]=T[k++],T[u++]=T[k++],2<(U-=3););U&&(T[u++]=T[k++],1<U&&(T[u++]=T[k++]))}break}}break}}while(c<l&&u<g);c-=U=S>>3,v&=(1<<(S-=U<<3))-1,a.next_in=c,a.next_out=u,a.avail_in=c<l?l-c+5:5-(c-l),a.avail_out=u<g?g-u+257:257-(u-g),o.hold=v,o.bits=S}},{}],49:[function(i,n,r){var a=i("../utils/common"),s=i("./adler32"),o=i("./crc32"),c=i("./inffast"),l=i("./inftrees"),u=1,p=2,g=0,d=-2,m=1,_=852,b=592;function y(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(k){var N;return k&&k.state?(N=k.state,k.total_in=k.total_out=N.total=0,k.msg="",N.wrap&&(k.adler=1&N.wrap),N.mode=m,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new a.Buf32(_),N.distcode=N.distdyn=new a.Buf32(b),N.sane=1,N.back=-1,g):d}function C(k){var N;return k&&k.state?((N=k.state).wsize=0,N.whave=0,N.wnext=0,S(k)):d}function x(k,N){var h,T;return k&&k.state?(T=k.state,N<0?(h=0,N=-N):(h=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?d:(T.window!==null&&T.wbits!==N&&(T.window=null),T.wrap=h,T.wbits=N,C(k))):d}function F(k,N){var h,T;return k?(T=new v,(k.state=T).window=null,(h=x(k,N))!==g&&(k.state=null),h):d}var M,H,$=!0;function U(k){if($){var N;for(M=new a.Buf32(512),H=new a.Buf32(32),N=0;N<144;)k.lens[N++]=8;for(;N<256;)k.lens[N++]=9;for(;N<280;)k.lens[N++]=7;for(;N<288;)k.lens[N++]=8;for(l(u,k.lens,0,288,M,0,k.work,{bits:9}),N=0;N<32;)k.lens[N++]=5;l(p,k.lens,0,32,H,0,k.work,{bits:5}),$=!1}k.lencode=M,k.lenbits=9,k.distcode=H,k.distbits=5}function K(k,N,h,T){var J,X=k.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new a.Buf8(X.wsize)),T>=X.wsize?(a.arraySet(X.window,N,h-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(T<(J=X.wsize-X.wnext)&&(J=T),a.arraySet(X.window,N,h-T,J,X.wnext),(T-=J)?(a.arraySet(X.window,N,h-T,T,0),X.wnext=T,X.whave=X.wsize):(X.wnext+=J,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=J))),0}r.inflateReset=C,r.inflateReset2=x,r.inflateResetKeep=S,r.inflateInit=function(k){return F(k,15)},r.inflateInit2=F,r.inflate=function(k,N){var h,T,J,X,at,Y,Q,B,A,it,q,W,vt,Lt,st,ft,Ct,Et,ce,Jt,f,O,I,w,E=0,D=new a.Buf8(4),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return d;(h=k.state).mode===12&&(h.mode=13),at=k.next_out,J=k.output,Q=k.avail_out,X=k.next_in,T=k.input,Y=k.avail_in,B=h.hold,A=h.bits,it=Y,q=Q,O=g;t:for(;;)switch(h.mode){case m:if(h.wrap===0){h.mode=13;break}for(;A<16;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if(2&h.wrap&&B===35615){D[h.check=0]=255&B,D[1]=B>>>8&255,h.check=o(h.check,D,2,0),A=B=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&B)<<8)+(B>>8))%31){k.msg="incorrect header check",h.mode=30;break}if((15&B)!=8){k.msg="unknown compression method",h.mode=30;break}if(A-=4,f=8+(15&(B>>>=4)),h.wbits===0)h.wbits=f;else if(f>h.wbits){k.msg="invalid window size",h.mode=30;break}h.dmax=1<<f,k.adler=h.check=1,h.mode=512&B?10:12,A=B=0;break;case 2:for(;A<16;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if(h.flags=B,(255&h.flags)!=8){k.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){k.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=B>>8&1),512&h.flags&&(D[0]=255&B,D[1]=B>>>8&255,h.check=o(h.check,D,2,0)),A=B=0,h.mode=3;case 3:for(;A<32;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}h.head&&(h.head.time=B),512&h.flags&&(D[0]=255&B,D[1]=B>>>8&255,D[2]=B>>>16&255,D[3]=B>>>24&255,h.check=o(h.check,D,4,0)),A=B=0,h.mode=4;case 4:for(;A<16;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}h.head&&(h.head.xflags=255&B,h.head.os=B>>8),512&h.flags&&(D[0]=255&B,D[1]=B>>>8&255,h.check=o(h.check,D,2,0)),A=B=0,h.mode=5;case 5:if(1024&h.flags){for(;A<16;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}h.length=B,h.head&&(h.head.extra_len=B),512&h.flags&&(D[0]=255&B,D[1]=B>>>8&255,h.check=o(h.check,D,2,0)),A=B=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(Y<(W=h.length)&&(W=Y),W&&(h.head&&(f=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),a.arraySet(h.head.extra,T,X,W,f)),512&h.flags&&(h.check=o(h.check,T,W,X)),Y-=W,X+=W,h.length-=W),h.length))break t;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(Y===0)break t;for(W=0;f=T[X+W++],h.head&&f&&h.length<65536&&(h.head.name+=String.fromCharCode(f)),f&&W<Y;);if(512&h.flags&&(h.check=o(h.check,T,W,X)),Y-=W,X+=W,f)break t}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(Y===0)break t;for(W=0;f=T[X+W++],h.head&&f&&h.length<65536&&(h.head.comment+=String.fromCharCode(f)),f&&W<Y;);if(512&h.flags&&(h.check=o(h.check,T,W,X)),Y-=W,X+=W,f)break t}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;A<16;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if(B!==(65535&h.check)){k.msg="header crc mismatch",h.mode=30;break}A=B=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),k.adler=h.check=0,h.mode=12;break;case 10:for(;A<32;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}k.adler=h.check=y(B),A=B=0,h.mode=11;case 11:if(h.havedict===0)return k.next_out=at,k.avail_out=Q,k.next_in=X,k.avail_in=Y,h.hold=B,h.bits=A,2;k.adler=h.check=1,h.mode=12;case 12:if(N===5||N===6)break t;case 13:if(h.last){B>>>=7&A,A-=7&A,h.mode=27;break}for(;A<3;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}switch(h.last=1&B,A-=1,3&(B>>>=1)){case 0:h.mode=14;break;case 1:if(U(h),h.mode=20,N!==6)break;B>>>=2,A-=2;break t;case 2:h.mode=17;break;case 3:k.msg="invalid block type",h.mode=30}B>>>=2,A-=2;break;case 14:for(B>>>=7&A,A-=7&A;A<32;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if((65535&B)!=(B>>>16^65535)){k.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&B,A=B=0,h.mode=15,N===6)break t;case 15:h.mode=16;case 16:if(W=h.length){if(Y<W&&(W=Y),Q<W&&(W=Q),W===0)break t;a.arraySet(J,T,X,W,at),Y-=W,X+=W,Q-=W,at+=W,h.length-=W;break}h.mode=12;break;case 17:for(;A<14;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if(h.nlen=257+(31&B),B>>>=5,A-=5,h.ndist=1+(31&B),B>>>=5,A-=5,h.ncode=4+(15&B),B>>>=4,A-=4,286<h.nlen||30<h.ndist){k.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;A<3;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}h.lens[z[h.have++]]=7&B,B>>>=3,A-=3}for(;h.have<19;)h.lens[z[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,I={bits:h.lenbits},O=l(0,h.lens,0,19,h.lencode,0,h.work,I),h.lenbits=I.bits,O){k.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;ft=(E=h.lencode[B&(1<<h.lenbits)-1])>>>16&255,Ct=65535&E,!((st=E>>>24)<=A);){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if(Ct<16)B>>>=st,A-=st,h.lens[h.have++]=Ct;else{if(Ct===16){for(w=st+2;A<w;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if(B>>>=st,A-=st,h.have===0){k.msg="invalid bit length repeat",h.mode=30;break}f=h.lens[h.have-1],W=3+(3&B),B>>>=2,A-=2}else if(Ct===17){for(w=st+3;A<w;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}A-=st,f=0,W=3+(7&(B>>>=st)),B>>>=3,A-=3}else{for(w=st+7;A<w;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}A-=st,f=0,W=11+(127&(B>>>=st)),B>>>=7,A-=7}if(h.have+W>h.nlen+h.ndist){k.msg="invalid bit length repeat",h.mode=30;break}for(;W--;)h.lens[h.have++]=f}}if(h.mode===30)break;if(h.lens[256]===0){k.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,I={bits:h.lenbits},O=l(u,h.lens,0,h.nlen,h.lencode,0,h.work,I),h.lenbits=I.bits,O){k.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,I={bits:h.distbits},O=l(p,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,I),h.distbits=I.bits,O){k.msg="invalid distances set",h.mode=30;break}if(h.mode=20,N===6)break t;case 20:h.mode=21;case 21:if(6<=Y&&258<=Q){k.next_out=at,k.avail_out=Q,k.next_in=X,k.avail_in=Y,h.hold=B,h.bits=A,c(k,q),at=k.next_out,J=k.output,Q=k.avail_out,X=k.next_in,T=k.input,Y=k.avail_in,B=h.hold,A=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;ft=(E=h.lencode[B&(1<<h.lenbits)-1])>>>16&255,Ct=65535&E,!((st=E>>>24)<=A);){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if(ft&&(240&ft)==0){for(Et=st,ce=ft,Jt=Ct;ft=(E=h.lencode[Jt+((B&(1<<Et+ce)-1)>>Et)])>>>16&255,Ct=65535&E,!(Et+(st=E>>>24)<=A);){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}B>>>=Et,A-=Et,h.back+=Et}if(B>>>=st,A-=st,h.back+=st,h.length=Ct,ft===0){h.mode=26;break}if(32&ft){h.back=-1,h.mode=12;break}if(64&ft){k.msg="invalid literal/length code",h.mode=30;break}h.extra=15&ft,h.mode=22;case 22:if(h.extra){for(w=h.extra;A<w;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}h.length+=B&(1<<h.extra)-1,B>>>=h.extra,A-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;ft=(E=h.distcode[B&(1<<h.distbits)-1])>>>16&255,Ct=65535&E,!((st=E>>>24)<=A);){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if((240&ft)==0){for(Et=st,ce=ft,Jt=Ct;ft=(E=h.distcode[Jt+((B&(1<<Et+ce)-1)>>Et)])>>>16&255,Ct=65535&E,!(Et+(st=E>>>24)<=A);){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}B>>>=Et,A-=Et,h.back+=Et}if(B>>>=st,A-=st,h.back+=st,64&ft){k.msg="invalid distance code",h.mode=30;break}h.offset=Ct,h.extra=15&ft,h.mode=24;case 24:if(h.extra){for(w=h.extra;A<w;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}h.offset+=B&(1<<h.extra)-1,B>>>=h.extra,A-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){k.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(Q===0)break t;if(W=q-Q,h.offset>W){if((W=h.offset-W)>h.whave&&h.sane){k.msg="invalid distance too far back",h.mode=30;break}vt=W>h.wnext?(W-=h.wnext,h.wsize-W):h.wnext-W,W>h.length&&(W=h.length),Lt=h.window}else Lt=J,vt=at-h.offset,W=h.length;for(Q<W&&(W=Q),Q-=W,h.length-=W;J[at++]=Lt[vt++],--W;);h.length===0&&(h.mode=21);break;case 26:if(Q===0)break t;J[at++]=h.length,Q--,h.mode=21;break;case 27:if(h.wrap){for(;A<32;){if(Y===0)break t;Y--,B|=T[X++]<<A,A+=8}if(q-=Q,k.total_out+=q,h.total+=q,q&&(k.adler=h.check=h.flags?o(h.check,J,q,at-q):s(h.check,J,q,at-q)),q=Q,(h.flags?B:y(B))!==h.check){k.msg="incorrect data check",h.mode=30;break}A=B=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;A<32;){if(Y===0)break t;Y--,B+=T[X++]<<A,A+=8}if(B!==(4294967295&h.total)){k.msg="incorrect length check",h.mode=30;break}A=B=0}h.mode=29;case 29:O=1;break t;case 30:O=-3;break t;case 31:return-4;case 32:default:return d}return k.next_out=at,k.avail_out=Q,k.next_in=X,k.avail_in=Y,h.hold=B,h.bits=A,(h.wsize||q!==k.avail_out&&h.mode<30&&(h.mode<27||N!==4))&&K(k,k.output,k.next_out,q-k.avail_out)?(h.mode=31,-4):(it-=k.avail_in,q-=k.avail_out,k.total_in+=it,k.total_out+=q,h.total+=q,h.wrap&&q&&(k.adler=h.check=h.flags?o(h.check,J,q,k.next_out-q):s(h.check,J,q,k.next_out-q)),k.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(it==0&&q===0||N===4)&&O===g&&(O=-5),O)},r.inflateEnd=function(k){if(!k||!k.state)return d;var N=k.state;return N.window&&(N.window=null),k.state=null,g},r.inflateGetHeader=function(k,N){var h;return k&&k.state?(2&(h=k.state).wrap)==0?d:((h.head=N).done=!1,g):d},r.inflateSetDictionary=function(k,N){var h,T=N.length;return k&&k.state?(h=k.state).wrap!==0&&h.mode!==11?d:h.mode===11&&s(1,N,T,0)!==h.check?-3:K(k,N,T,T)?(h.mode=31,-4):(h.havedict=1,g):d},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,n,r){var a=i("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,p,g,d,m,_,b,y){var v,S,C,x,F,M,H,$,U,K=y.bits,k=0,N=0,h=0,T=0,J=0,X=0,at=0,Y=0,Q=0,B=0,A=null,it=0,q=new a.Buf16(16),W=new a.Buf16(16),vt=null,Lt=0;for(k=0;k<=15;k++)q[k]=0;for(N=0;N<d;N++)q[p[g+N]]++;for(J=K,T=15;1<=T&&q[T]===0;T--);if(T<J&&(J=T),T===0)return m[_++]=20971520,m[_++]=20971520,y.bits=1,0;for(h=1;h<T&&q[h]===0;h++);for(J<h&&(J=h),k=Y=1;k<=15;k++)if(Y<<=1,(Y-=q[k])<0)return-1;if(0<Y&&(u===0||T!==1))return-1;for(W[1]=0,k=1;k<15;k++)W[k+1]=W[k]+q[k];for(N=0;N<d;N++)p[g+N]!==0&&(b[W[p[g+N]]++]=N);if(M=u===0?(A=vt=b,19):u===1?(A=s,it-=257,vt=o,Lt-=257,256):(A=c,vt=l,-1),k=h,F=_,at=N=B=0,C=-1,x=(Q=1<<(X=J))-1,u===1&&852<Q||u===2&&592<Q)return 1;for(;;){for(H=k-at,U=b[N]<M?($=0,b[N]):b[N]>M?($=vt[Lt+b[N]],A[it+b[N]]):($=96,0),v=1<<k-at,h=S=1<<X;m[F+(B>>at)+(S-=v)]=H<<24|$<<16|U|0,S!==0;);for(v=1<<k-1;B&v;)v>>=1;if(v!==0?(B&=v-1,B+=v):B=0,N++,--q[k]==0){if(k===T)break;k=p[g+b[N]]}if(J<k&&(B&x)!==C){for(at===0&&(at=J),F+=h,Y=1<<(X=k-at);X+at<T&&!((Y-=q[X+at])<=0);)X++,Y<<=1;if(Q+=1<<X,u===1&&852<Q||u===2&&592<Q)return 1;m[C=B&x]=J<<24|X<<16|F-_|0}}return B!==0&&(m[F+B]=k-at<<24|64<<16|0),y.bits=J,0}},{"../utils/common":41}],51:[function(i,n,r){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,n,r){var a=i("../utils/common"),s=0,o=1;function c(E){for(var D=E.length;0<=--D;)E[D]=0}var l=0,u=29,p=256,g=p+1+u,d=30,m=19,_=2*g+1,b=15,y=16,v=7,S=256,C=16,x=17,F=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(g+2));c(K);var k=new Array(2*d);c(k);var N=new Array(512);c(N);var h=new Array(256);c(h);var T=new Array(u);c(T);var J,X,at,Y=new Array(d);function Q(E,D,z,j,L){this.static_tree=E,this.extra_bits=D,this.extra_base=z,this.elems=j,this.max_length=L,this.has_stree=E&&E.length}function B(E,D){this.dyn_tree=E,this.max_code=0,this.stat_desc=D}function A(E){return E<256?N[E]:N[256+(E>>>7)]}function it(E,D){E.pending_buf[E.pending++]=255&D,E.pending_buf[E.pending++]=D>>>8&255}function q(E,D,z){E.bi_valid>y-z?(E.bi_buf|=D<<E.bi_valid&65535,it(E,E.bi_buf),E.bi_buf=D>>y-E.bi_valid,E.bi_valid+=z-y):(E.bi_buf|=D<<E.bi_valid&65535,E.bi_valid+=z)}function W(E,D,z){q(E,z[2*D],z[2*D+1])}function vt(E,D){for(var z=0;z|=1&E,E>>>=1,z<<=1,0<--D;);return z>>>1}function Lt(E,D,z){var j,L,V=new Array(b+1),Z=0;for(j=1;j<=b;j++)V[j]=Z=Z+z[j-1]<<1;for(L=0;L<=D;L++){var G=E[2*L+1];G!==0&&(E[2*L]=vt(V[G]++,G))}}function st(E){var D;for(D=0;D<g;D++)E.dyn_ltree[2*D]=0;for(D=0;D<d;D++)E.dyn_dtree[2*D]=0;for(D=0;D<m;D++)E.bl_tree[2*D]=0;E.dyn_ltree[2*S]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function ft(E){8<E.bi_valid?it(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function Ct(E,D,z,j){var L=2*D,V=2*z;return E[L]<E[V]||E[L]===E[V]&&j[D]<=j[z]}function Et(E,D,z){for(var j=E.heap[z],L=z<<1;L<=E.heap_len&&(L<E.heap_len&&Ct(D,E.heap[L+1],E.heap[L],E.depth)&&L++,!Ct(D,j,E.heap[L],E.depth));)E.heap[z]=E.heap[L],z=L,L<<=1;E.heap[z]=j}function ce(E,D,z){var j,L,V,Z,G=0;if(E.last_lit!==0)for(;j=E.pending_buf[E.d_buf+2*G]<<8|E.pending_buf[E.d_buf+2*G+1],L=E.pending_buf[E.l_buf+G],G++,j===0?W(E,L,D):(W(E,(V=h[L])+p+1,D),(Z=M[V])!==0&&q(E,L-=T[V],Z),W(E,V=A(--j),z),(Z=H[V])!==0&&q(E,j-=Y[V],Z)),G<E.last_lit;);W(E,S,D)}function Jt(E,D){var z,j,L,V=D.dyn_tree,Z=D.stat_desc.static_tree,G=D.stat_desc.has_stree,tt=D.stat_desc.elems,gt=-1;for(E.heap_len=0,E.heap_max=_,z=0;z<tt;z++)V[2*z]!==0?(E.heap[++E.heap_len]=gt=z,E.depth[z]=0):V[2*z+1]=0;for(;E.heap_len<2;)V[2*(L=E.heap[++E.heap_len]=gt<2?++gt:0)]=1,E.depth[L]=0,E.opt_len--,G&&(E.static_len-=Z[2*L+1]);for(D.max_code=gt,z=E.heap_len>>1;1<=z;z--)Et(E,V,z);for(L=tt;z=E.heap[1],E.heap[1]=E.heap[E.heap_len--],Et(E,V,1),j=E.heap[1],E.heap[--E.heap_max]=z,E.heap[--E.heap_max]=j,V[2*L]=V[2*z]+V[2*j],E.depth[L]=(E.depth[z]>=E.depth[j]?E.depth[z]:E.depth[j])+1,V[2*z+1]=V[2*j+1]=L,E.heap[1]=L++,Et(E,V,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],function(lt,Yt){var Di,ue,Ti,wt,Gi,Un,ge=Yt.dyn_tree,hr=Yt.max_code,kc=Yt.stat_desc.static_tree,xc=Yt.stat_desc.has_stree,Cc=Yt.stat_desc.extra_bits,dr=Yt.stat_desc.extra_base,Li=Yt.stat_desc.max_length,Wi=0;for(wt=0;wt<=b;wt++)lt.bl_count[wt]=0;for(ge[2*lt.heap[lt.heap_max]+1]=0,Di=lt.heap_max+1;Di<_;Di++)Li<(wt=ge[2*ge[2*(ue=lt.heap[Di])+1]+1]+1)&&(wt=Li,Wi++),ge[2*ue+1]=wt,hr<ue||(lt.bl_count[wt]++,Gi=0,dr<=ue&&(Gi=Cc[ue-dr]),Un=ge[2*ue],lt.opt_len+=Un*(wt+Gi),xc&&(lt.static_len+=Un*(kc[2*ue+1]+Gi)));if(Wi!==0){do{for(wt=Li-1;lt.bl_count[wt]===0;)wt--;lt.bl_count[wt]--,lt.bl_count[wt+1]+=2,lt.bl_count[Li]--,Wi-=2}while(0<Wi);for(wt=Li;wt!==0;wt--)for(ue=lt.bl_count[wt];ue!==0;)hr<(Ti=lt.heap[--Di])||(ge[2*Ti+1]!==wt&&(lt.opt_len+=(wt-ge[2*Ti+1])*ge[2*Ti],ge[2*Ti+1]=wt),ue--)}}(E,D),Lt(V,gt,E.bl_count)}function f(E,D,z){var j,L,V=-1,Z=D[1],G=0,tt=7,gt=4;for(Z===0&&(tt=138,gt=3),D[2*(z+1)+1]=65535,j=0;j<=z;j++)L=Z,Z=D[2*(j+1)+1],++G<tt&&L===Z||(G<gt?E.bl_tree[2*L]+=G:L!==0?(L!==V&&E.bl_tree[2*L]++,E.bl_tree[2*C]++):G<=10?E.bl_tree[2*x]++:E.bl_tree[2*F]++,V=L,gt=(G=0)===Z?(tt=138,3):L===Z?(tt=6,3):(tt=7,4))}function O(E,D,z){var j,L,V=-1,Z=D[1],G=0,tt=7,gt=4;for(Z===0&&(tt=138,gt=3),j=0;j<=z;j++)if(L=Z,Z=D[2*(j+1)+1],!(++G<tt&&L===Z)){if(G<gt)for(;W(E,L,E.bl_tree),--G!=0;);else L!==0?(L!==V&&(W(E,L,E.bl_tree),G--),W(E,C,E.bl_tree),q(E,G-3,2)):G<=10?(W(E,x,E.bl_tree),q(E,G-3,3)):(W(E,F,E.bl_tree),q(E,G-11,7));V=L,gt=(G=0)===Z?(tt=138,3):L===Z?(tt=6,3):(tt=7,4)}}c(Y);var I=!1;function w(E,D,z,j){q(E,(l<<1)+(j?1:0),3),function(L,V,Z,G){ft(L),G&&(it(L,Z),it(L,~Z)),a.arraySet(L.pending_buf,L.window,V,Z,L.pending),L.pending+=Z}(E,D,z,!0)}r._tr_init=function(E){I||(function(){var D,z,j,L,V,Z=new Array(b+1);for(L=j=0;L<u-1;L++)for(T[L]=j,D=0;D<1<<M[L];D++)h[j++]=L;for(h[j-1]=L,L=V=0;L<16;L++)for(Y[L]=V,D=0;D<1<<H[L];D++)N[V++]=L;for(V>>=7;L<d;L++)for(Y[L]=V<<7,D=0;D<1<<H[L]-7;D++)N[256+V++]=L;for(z=0;z<=b;z++)Z[z]=0;for(D=0;D<=143;)K[2*D+1]=8,D++,Z[8]++;for(;D<=255;)K[2*D+1]=9,D++,Z[9]++;for(;D<=279;)K[2*D+1]=7,D++,Z[7]++;for(;D<=287;)K[2*D+1]=8,D++,Z[8]++;for(Lt(K,g+1,Z),D=0;D<d;D++)k[2*D+1]=5,k[2*D]=vt(D,5);J=new Q(K,M,p+1,g,b),X=new Q(k,H,0,d,b),at=new Q(new Array(0),$,0,m,v)}(),I=!0),E.l_desc=new B(E.dyn_ltree,J),E.d_desc=new B(E.dyn_dtree,X),E.bl_desc=new B(E.bl_tree,at),E.bi_buf=0,E.bi_valid=0,st(E)},r._tr_stored_block=w,r._tr_flush_block=function(E,D,z,j){var L,V,Z=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=function(G){var tt,gt=4093624447;for(tt=0;tt<=31;tt++,gt>>>=1)if(1&gt&&G.dyn_ltree[2*tt]!==0)return s;if(G.dyn_ltree[18]!==0||G.dyn_ltree[20]!==0||G.dyn_ltree[26]!==0)return o;for(tt=32;tt<p;tt++)if(G.dyn_ltree[2*tt]!==0)return o;return s}(E)),Jt(E,E.l_desc),Jt(E,E.d_desc),Z=function(G){var tt;for(f(G,G.dyn_ltree,G.l_desc.max_code),f(G,G.dyn_dtree,G.d_desc.max_code),Jt(G,G.bl_desc),tt=m-1;3<=tt&&G.bl_tree[2*U[tt]+1]===0;tt--);return G.opt_len+=3*(tt+1)+5+5+4,tt}(E),L=E.opt_len+3+7>>>3,(V=E.static_len+3+7>>>3)<=L&&(L=V)):L=V=z+5,z+4<=L&&D!==-1?w(E,D,z,j):E.strategy===4||V===L?(q(E,2+(j?1:0),3),ce(E,K,k)):(q(E,4+(j?1:0),3),function(G,tt,gt,lt){var Yt;for(q(G,tt-257,5),q(G,gt-1,5),q(G,lt-4,4),Yt=0;Yt<lt;Yt++)q(G,G.bl_tree[2*U[Yt]+1],3);O(G,G.dyn_ltree,tt-1),O(G,G.dyn_dtree,gt-1)}(E,E.l_desc.max_code+1,E.d_desc.max_code+1,Z+1),ce(E,E.dyn_ltree,E.dyn_dtree)),st(E),j&&ft(E)},r._tr_tally=function(E,D,z){return E.pending_buf[E.d_buf+2*E.last_lit]=D>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&D,E.pending_buf[E.l_buf+E.last_lit]=255&z,E.last_lit++,D===0?E.dyn_ltree[2*z]++:(E.matches++,D--,E.dyn_ltree[2*(h[z]+p+1)]++,E.dyn_dtree[2*A(D)]++),E.last_lit===E.lit_bufsize-1},r._tr_align=function(E){q(E,2,3),W(E,S,K),function(D){D.bi_valid===16?(it(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):8<=D.bi_valid&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)}(E)}},{"../utils/common":41}],53:[function(i,n,r){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,n,r){(function(a){(function(s,o){if(!s.setImmediate){var c,l,u,p,g=1,d={},m=!1,_=s.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(s);b=b&&b.setTimeout?b:s,c={}.toString.call(s.process)==="[object process]"?function(C){process.nextTick(function(){v(C)})}:function(){if(s.postMessage&&!s.importScripts){var C=!0,x=s.onmessage;return s.onmessage=function(){C=!1},s.postMessage("","*"),s.onmessage=x,C}}()?(p="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",S,!1):s.attachEvent("onmessage",S),function(C){s.postMessage(p+C,"*")}):s.MessageChannel?((u=new MessageChannel).port1.onmessage=function(C){v(C.data)},function(C){u.port2.postMessage(C)}):_&&"onreadystatechange"in _.createElement("script")?(l=_.documentElement,function(C){var x=_.createElement("script");x.onreadystatechange=function(){v(C),x.onreadystatechange=null,l.removeChild(x),x=null},l.appendChild(x)}):function(C){setTimeout(v,0,C)},b.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var x=new Array(arguments.length-1),F=0;F<x.length;F++)x[F]=arguments[F+1];var M={callback:C,args:x};return d[g]=M,c(g),g++},b.clearImmediate=y}function y(C){delete d[C]}function v(C){if(m)setTimeout(v,0,C);else{var x=d[C];if(x){m=!0;try{(function(F){var M=F.callback,H=F.args;switch(H.length){case 0:M();break;case 1:M(H[0]);break;case 2:M(H[0],H[1]);break;case 3:M(H[0],H[1],H[2]);break;default:M.apply(o,H)}})(x)}finally{y(C),m=!1}}}}function S(C){C.source===s&&typeof C.data=="string"&&C.data.indexOf(p)===0&&v(+C.data.slice(p.length))}})(typeof self=="undefined"?a===void 0?this:a:self)}).call(this,typeof nn!="undefined"?nn:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(vc);var Ef=vc.exports;async function wf(t){return await Ef.loadAsync(t)}const Qt=()=>"[main]";var Se=async t=>{var e;try{console.time("loading time"),Qi.enable(!1);let i;if(t.file)i=t.file;else if(t.link)i=await yf(ps(decodeURI(t.link)));else if(t.id)i=await yc(gs(decodeURI(t.id)));else if(t.hash&&ms(decodeURI(t.hash).trim()))i=await vf(decodeURI(t.hash).trim());else throw new Error("Could not search for file.");_t.status("info","Extracting zip",0),Nt.switchHeader(!1);const n=await wf(i);Qi.enable(!1),_t.status("info","Parsing map info...",0),et.info(Qt(),"Parsing map info");const r=await pf(n);rt.beatmapInfo=r,iu(r),_t.status("info","Loading image...",10.4375),et.info(Qt(),"Loading cover image");let a=n.file(r._coverImageFilename);if(nt.load.imageCover&&a){let o=await a.async("base64");Nt.setCoverImage("data:image;base64,"+o),fi.loading.coverImage=!0}else et.error(Qt(),`${r._coverImageFilename} does not exists.`);if(rt.contributors=[],(e=r==null?void 0:r._customData)!=null&&e._contributors)for(const o of r._customData._contributors){et.info(Qt(),"Loading contributor image "+o._name),a=n.file(o._iconPath);let c=null;nt.load.imageContributor&&a?c=await a.async("base64"):et.error(Qt(),`${o._iconPath} does not exists.`),rt.contributors.push(Zi(qi({},o),{_base64:c}))}_t.status("info","Loading audio...",20.875),et.info(Qt(),"Loading audio");let s=n.file(r._songFilename);if(nt.load.audio&&s){let o=!1;setTimeout(()=>{o||_t.status("info","Loading audio... (this may take a while)",20.875)},1e4);let c=await s.async("arraybuffer");Nt.setAudio(c),await new AudioContext().decodeAudioData(c).then(u=>{o=!0;let p=u.duration;rt.duration=p,Nt.setSongDuration(p),fi.loading.audio=!0}).catch(function(u){Nt.setSongDuration(),et.error(Qt(),u)})}else Nt.setSongDuration(),et.error(Qt(),`${r._songFilename} does not exist.`);_t.status("info","Parsing difficulty...",70),rt.beatmapDifficulty=await gf(r,n),di.adjustTime(),_t.status("info","Adding map difficulty stats...",80),et.info(Qt(),"Adding map stats"),df(),Ns(rt.contributors),_t.status("info","Analysing map...",85),et.info(Qt(),"Analysing map"),vi.runGeneral(),di.displayOutputGeneral(),_t.status("info","Analysing difficulty...",90),vi.applyAll(),di.populateSelect(r),di.displayOutputDifficulty(),Qi.enable(!0),_t.status("info","Map successfully loaded!"),console.timeEnd("loading time")}catch(i){_t.status("error",i,100),et.error(Qt(),i),rt.clear(),Qi.enable(!0),Nt.switchHeader(!0)}};const Ci="UI Intro: ",Mi=document.querySelector(".input__intro-url"),Pi=document.querySelector(".input__intro-id"),Oi=document.querySelector(".input__intro-hash"),os=document.querySelector(".input__search-button"),ss=document.querySelector(".input__file"),qn=document.querySelector(".input__file-zone");if(Mi)Mi.addEventListener("keydown",or);else throw new Error(Ci+"URL input is missing");if(Pi)Pi.addEventListener("keydown",or);else throw new Error(Ci+"ID input is missing");if(Oi)Oi.addEventListener("keydown",or);else throw new Error(Ci+"Hash input is missing");if(os)os.addEventListener("click",Sf);else throw new Error(Ci+"search button is missing");if(ss)ss.addEventListener("change",kf);else throw new Error(Ci+"file input is missing");if(qn)qn.addEventListener("drop",xf),qn.addEventListener("dragover",Cf);else throw new Error(Ci+"file drop zone is missing");function or(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&Se({link:e.value}),e.classList.contains("input__intro-id")&&Se({id:e.value}),e.classList.contains("input__intro-hash")&&Se({hash:e.value}))}function Sf(t){if(Mi&&Mi.value!==""){Se({link:Mi.value});return}if(Pi&&Pi.value!==""){Se({id:Pi.value});return}if(Oi&&Oi.value!==""){Se({hash:Oi.value});return}}function kf(t){const e=t.target;_t.status("info","Reading file input",0);const i=e.files?e.files[0]:null;try{if(i==null)throw _t.status("info","No file input",0),new Error("No file input");if(i&&(i.name.substr(-4)===".zip"||i.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(i),n.addEventListener("load",()=>{Se({file:i})})}else throw new Error("Unsupported file format, please enter zip file")}catch(n){_t.status("error",n,0),console.error(n)}}function xf(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items&&t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const i=new FileReader;i.readAsArrayBuffer(e),i.addEventListener("load",()=>{Se({file:e})})}else throw new Error("Unsupported file format, please enter zip file")}}catch(e){_t.status("error",e,0),console.error(e)}}function Cf(t){t.preventDefault(),t.stopPropagation()}const Df=document.querySelector("body"),Tf=["Dark","Light","Monochrome"];var sr={list:Tf,set:t=>{Df.className="theme-"+t.toLowerCase().replace(" ","")}};const qe="UI Settings: ",hn=document.querySelector(".settings__theme"),Aa=document.querySelector(".settings__beat-numbering"),Ba=document.querySelector(".settings__rounding"),lr=document.querySelectorAll(".settings__load"),Xn=document.querySelector(".settings__sort"),cr=document.querySelectorAll(".settings__show"),ur=document.querySelectorAll(".settings__onload"),ls=document.querySelector(".settings__clear-button");if(hn)hn.addEventListener("change",Lf),sr.list.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,hn.add(e)});else throw new Error(qe+"theme select is missing");if(Aa)Aa.addEventListener("change",Rf);else throw new Error(qe+"missing settings");if(Ba)Ba.addEventListener("change",Af);else throw new Error(qe+"missing settings");lr.length||console.error(qe+"empty load list, intentional or typo error?");lr.forEach(t=>t.addEventListener("change",Mf));if(Xn)Xn.addEventListener("change",$f);else throw new Error(qe+"sort check is missing");ur.length||console.error(qe+"empty onload list, intentional or typo error?");ur.forEach(t=>t.addEventListener("change",Of));cr.length||console.error(qe+"empty show list, intentional or typo error?");cr.forEach(t=>t.addEventListener("change",Bf));if(ls)ls.addEventListener("click",Ec);else throw new Error(qe+"clear button is missing");function Lf(t){const e=t.target;nt.theme=e.options[e.options.selectedIndex].value,sr.set(nt.theme),nt.save()}function Rf(t){const e=t.target;nt.beatNumbering=e.options[e.options.selectedIndex].value,nt.save()}function Af(t){const e=t.target;nt.rounding=parseInt(e.value),nt.save()}function Bf(t){const e=t.target,i=e.id.replace("settings__show-","");nt.show[i]=e.checked,nt.save()}function If(t,e){cr.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}function $f(t){const e=t.target;nt.sorting=e.checked,nt.save()}function Nf(t){Xn&&(Xn.checked=t)}function Mf(t){const e=t.target,i=e.name;nt.load[i]=e.checked,nt.save()}function Pf(t,e){lr.forEach(i=>{i.name===t&&(i.checked=e)})}function Of(t){const e=t.target,i=e.name;nt.onLoad[i]=e.checked,nt.save()}function Ff(t,e){ur.forEach(i=>{i.name===t&&(i.checked=e)})}function zf(t){hn.value=t}function Xf(t){Aa.value=t}function jf(t){Ba.value=t.toString()}function Ec(){nt.clear(),nt.reset(),location.reload()}var Je={setShowCheck:If,setSortCheck:Nf,setLoadCheck:Pf,setOnLoadCheck:Ff,setTheme:zf,setBeatNumbering:Xf,setRounding:jf,clear:Ec};const Hf=document.querySelectorAll(".input__reset-button");Hf.forEach(t=>t.addEventListener("click",Yf));function Yf(){_t.reset(),Nt.reset(),nu(),di.reset(),ff(),rt.clear()}const Uf=2,Vf=5,Gf=0,Wf="Kival Evan#5480";var cs=new class{constructor(){this._version=`${Uf}.${Vf}.${Gf}`,this._wm=Wf}get value(){return this._version}get watermark(){return this._wm}};const qf="UI Footer: ",wc=document.querySelectorAll(".link__watermark"),Sc=document.querySelectorAll(".link__version");(!wc.length||!Sc.length)&&console.error(qf+"missing part");var us={setWatermark:t=>{wc.forEach(e=>e.textContent=t)},setVersion:t=>{Sc.forEach(e=>e.textContent=t)}},Zf=function(){let t=!1;return function(){if(!t){t=!0,us.setWatermark(cs.watermark),us.setVersion(cs.value),di.populateTool(),Je.setTheme(nt.theme),Je.setBeatNumbering(nt.beatNumbering),Je.setRounding(nt.rounding);for(const e in nt.load)Je.setLoadCheck(e,nt.load[e]);Je.setSortCheck(nt.sorting);for(const e in nt.show)fs.show(e,nt.show[e]),Je.setShowCheck(e,nt.show[e]);for(const e in nt.onLoad)Je.setOnLoadCheck(e,nt.onLoad[e]);sr.set(nt.theme),et.info("User interface initialised")}}}();(function(){Zf();const t=new URL(location.href),e=t.searchParams.get("url"),i=t.searchParams.get("id"),n=t.searchParams.get("hash");(i||e||n)&&Se({link:e,id:i,hash:n})})();
