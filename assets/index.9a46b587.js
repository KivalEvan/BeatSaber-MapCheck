(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();var gs=(t=>(t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy",t))(gs||{});const Xc="UI Accordion: ",un="accordion__",bs=document.querySelectorAll(".accordion__button");bs.length||console.error(Xc+"empty accordion list, intentional or typo error?");const ys={create:(t,e,i,a=!1)=>{const o=document.createElement("div");o.className="accordion";const r=document.createElement("input");r.className=un+"button",r.id=t,r.setAttribute("type","checkbox");const s=document.createElement("label");s.className=un+"label unselectable",s.htmlFor=t,s.textContent=e,i&&s.classList.add(gs[i]);const n=document.createElement("div");return n.className=a?un+"collapsible-flex":un+"collapsible",n.id=t+"-content",o.appendChild(r),o.appendChild(s),o.appendChild(n),o},show:(t,e)=>{bs.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}},wr=new Map([[0,"VERBOSE"],[1,"DEBUG"],[2,"INFO"],[3,"WARN"],[4,"!!ERROR!!"],[5,"NONE"]]);class zc{constructor(){this.logLevel=2}log(e,...i){if(e<this.logLevel)return;const a=[wr.get(e),">",...i];switch(e){case 1:return console.debug(...a);case 2:return console.info(...a);case 3:return console.warn(...a);case 4:return console.error(...a);default:return console.log(...a)}}setLevel(e){e=Math.min(e,5),this.logLevel=e,this.info("[logger::setLevel]",`Log level set to ${wr.get(e)}`)}verbose(...e){this.log(0,...e)}debug(...e){this.log(1,...e)}info(...e){this.log(2,...e)}warn(...e){this.log(3,...e)}error(...e){this.log(4,...e)}}const nt=new zc;function Yc(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function B(t,e=0){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function ca(t){return t*(180/Math.PI)}function gi(t){return t*(Math.PI/180)}function Sr(t,e){e<0&&(e=-e);const i=t%e;return i<0?i+e:i}function Dr(t,e,i){return Math.min(Sr(t-e,i),Sr(e-t,i))}function ra(t){if(t.length===0)return 0;t.sort((i,a)=>i-a);const e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2}function Tr(t,e,i){return Math.min(Math.max(e,t),i)}function St(t){if(typeof t!="object")throw new Error("Received non-object type");return JSON.parse(JSON.stringify(t))}function vs(t){return/[a-fA-F0-9]*/g.test(t)}function Nn(t){const e=[t.r,t.g,t.b];return typeof t.a=="number"&&e.push(t.a),e}function hn(t){const e=t.toString(16);return e.length===1?"0"+e:e}function Uc(t){return t>1&&!(t<0)?255:B(t*255)}function Rt(t){const e={r:0,g:0,b:0};for(const i in t){const a=t[i];a!==void 0&&(e[i]=Uc(a))}return`#${hn(e.r)}${hn(e.g)}${hn(e.b)}${typeof e.a=="number"?hn(e.a):""}`}function Cr(t){let e=t[0],i=t[1],a=t[2],o,r,s;return e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,o=(e*.4124+i*.3576+a*.1805)/.95047,r=(e*.2126+i*.7152+a*.0722)/1,s=(e*.0193+i*.1192+a*.9505)/1.08883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,[116*r-16,500*(o-r),200*(r-s)]}function Lr(t,e){let i=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(i=0),t<0&&(i=180),t>0&&e<0&&(i=360),ca(Math.atan(e/t))+i)}function ua(t,e){const[i,a,o]=Cr(t),[r,s,n]=Cr(e),l=1,c=1,h=1;let f,p,u,m,_,b,y,v,D,C,L,P,M,Y,$,j,K,S,R,g;return f=Math.sqrt(a*a+o*o),p=Math.sqrt(s*s+n*n),u=(f+p)/2,_=.5*(1-Math.sqrt((u^7)/((u^7)+30))),D=(1+_)*a,f=Math.sqrt(D*D+o*o),b=Lr(D,o),D=(1+_)*s,p=Math.sqrt(D*D+n*n),y=Lr(D,n),S=r-i,R=p-f,f*p==0?g=0:(D=B(y-b,12),Math.abs(D)<=180?g=y-b:D>180?g=y-b-360:g=y-b+360),g=2*Math.sqrt(f*p)*Math.sin(gi(g/2)),C=(i+r)/2,m=(f+p)/2,f*p==0?v=b+y:(D=Math.abs(B(b-y,12)),D>180?y+b<360?v=b+y+360:v=b+y-360:v=b+y,v/=2),L=1-.17*Math.cos(gi(v-30))+.24*Math.cos(gi(2*v))+.32*Math.cos(gi(3*v+6))-.2*Math.cos(gi(4*v-63)),$=30*Math.exp(-((v-275)/25)*((v-275)/25)),j=2*Math.sqrt((m^7)/((m^7)+30)),P=1+.015*((C-50)*(C-50))/Math.sqrt(20+(C-50)*(C-50)),M=1+.045*m,Y=1+.015*m*L,K=-Math.sin(gi(2*$))*j,S=S/(l*P),R=R/(c*M),g=g/(h*Y),Math.sqrt(S*S+R*R+g*g+K*R*g)}function Nt(t){if(!t)return"0:00";const e=Math.floor(t),i=e/60,a=i<0?`-${Math.ceil(i).toString()}`:Math.floor(i).toString(),o=Math.abs(e%60).toString().padStart(2,"0");return`${a}:${o}`}function jc(t){if(!t)return"0:00:00";const e=Math.round(t*60%60).toString().padStart(2,"0");return`${Nt(t)}:${e}`}function bn(t){var i;if(!t)return"0:00.000";const e=((i=(t%1).toString().split(".")[1])==null?void 0:i.padEnd(3,"0").slice(0,3))||"000";return`${Nt(t)}.${e}`}function Es(t){const e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")}function ws(t){const e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")}function ha(t){for(let e=t.options.length-1;e>=0;e--)t.remove(e)}const Xa="UI Header: ",da=document.querySelector(".intro"),fa=document.querySelector(".metadata"),si=document.querySelector(".cover__link"),za=document.querySelector(".cover__image"),Ss=document.querySelector(".metadata__song-name"),Ds=document.querySelector(".metadata__song-subname"),Ts=document.querySelector(".metadata__song-author"),Cs=document.querySelector(".metadata__song-bpm"),ma=document.querySelector(".metadata__song-duration"),Ls=document.querySelector(".audio");if(!da||!fa)throw new Error(Xa+"header component is missing one of the two section");if(!si||!za)throw new Error(Xa+"cover component is missing");if(!Ss||!Ds||!Ts||!Cs||!ma)throw new Error(Xa+"metadata component is missing one of the part");function ks(t){t?(da.classList.remove("hidden"),fa.classList.add("hidden")):(da.classList.add("hidden"),fa.classList.remove("hidden"))}function xs(t){za.src=t||"./img/unknown.jpg"}function Gc(){return za.src}function Rs(t,e){if(t==null&&e==null){si.textContent="",si.href="",si.classList.add("disabled");return}t!=null&&(si.textContent=e!=null?e:"Download Link",si.href=t,si.classList.remove("disabled"))}function Wc(t){Ss.textContent=t}function Vc(t){Ds.textContent=t}function Jc(t){Ts.textContent=t}function qc(t,e,i){let a=B(t,2).toString()+"BPM";Cs.textContent=a}function Is(t){t?ma.textContent=bn(t):ma.textContent="No audio"}async function Zc(t){const e=new Blob([t],{type:"audio/ogg"});Ls.src=window.URL.createObjectURL(e)}function Ns(){Ls.src="",window.URL.revokeObjectURL("")}function Kc(){ks(!0),xs(null),Rs(),Is(0),Ns()}const zt={switchHeader:ks,setCoverImage:xs,getCoverImage:Gc,setCoverLink:Rs,setSongName:Wc,setSongSubname:Vc,setSongAuthor:Jc,setSongBPM:qc,setSongDuration:Is,setAudio:Zc,unloadAudio:Ns,reset:Kc},wi=new class{constructor(){this.loading={info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1}}resetLoad(){this.loading.info=!1,this.loading.difficulty=!1,this.loading.analysis=!1,this.loading.audio=!1,this.loading.coverImage=!1,this.loading.contributorImage=!1,this.loading.finished=!1}},lt=new class{constructor(){this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}retrieveSafe(){if(!this.beatmapInfo)throw new Error("Beatmap info is not loaded.");if(!this.analysis)throw new Error("Beatmap analysis is not loaded.");if(this.duration===null)throw new Error("Audio is not loaded.");if(wi.loading.finished)return{beatmapInfo:this.beatmapInfo,beatmapDifficulty:this.beatmapDifficulty,contributors:this.contributors,analysis:this.analysis,duration:this.duration};throw new Error("Could not retrieve saved data, loading process is not finished.")}clear(){wi.loading.finished=!1,this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}},As=class{constructor(t,e=[],i=0){this._bpm=t,this._offset=i/1e3,this._timeScale=this.getTimeScale(e.filter(a=>{if(a.m===0)throw new Error("v3 BPM Change of value 0 detected.");return a.m!=null})),this._bpmChange=this.getBPMChangeTime(e.filter(a=>a.m==null))}get value(){return this._bpm}set value(t){this._bpm=t}get change(){return this._bpmChange}set change(t){this._bpmChange=this.getBPMChangeTime([...t])}set timescale(t){this._timeScale=this.getTimeScale(t)}get offset(){return this._offset*1e3}set offset(t){this._offset=t/1e3}getBPMChangeTime(t=[]){var a;let e;const i=[];for(let o=0;o<t.length;o++){const r={_BPM:(a=t[o]._BPM)!=null?a:t[o]._bpm,_time:t[o]._time,_beatsPerBar:t[o]._beatsPerBar,_metronomeOffset:t[o]._metronomeOffset,_newTime:0};e?r._newTime=Math.ceil((r._time-e._time)/this._bpm*e._BPM+e._newTime-.01):r._newTime=Math.ceil(r._time-this._offset*this._bpm/60-.01),i.push(r),e=r}return i}getTimeScale(t=[]){return t.map(e=>({_time:e.b,_scale:this._bpm/e.m}))}offsetBegone(t){return this.toBeatTime(this.toRealTime(t,!1)-this._offset)}toRealTime(t,e=!0){if(!e)return t/this._bpm*60;let i=0;for(let a=this._timeScale.length-1;a>=0;a--)t>this._timeScale[a]._time&&(i+=(t-this._timeScale[a]._time)*this._timeScale[a]._scale,t=this._timeScale[a]._time);return(t+i)/this._bpm*60}toBeatTime(t,e=!1){if(!e)return t*this._bpm/60;let i=0;for(let a=this._timeScale.length-1;a>=0;a--){const o=this.toRealTime(this._timeScale[a]._time);t>o&&(i+=(t-o)/this._timeScale[a]._scale,t=o)}return this.toBeatTime(t+i)}toJSONTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e]._newTime)return(t-this._bpmChange[e]._newTime)/this._bpmChange[e]._BPM*this._bpm+this._bpmChange[e]._time;return this.toBeatTime(this.toRealTime(t,!1)+this._offset)}adjustTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e]._time)return(t-this._bpmChange[e]._time)/this._bpm*this._bpmChange[e]._BPM+this._bpmChange[e]._newTime;return this.offsetBegone(t)}};let Ae=As;Ae.create=(t,e,i)=>new As(t,e,i);const Qc={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",GlassDesertEnvironment:"Glass Desert"},Ye={DefaultEnvironment:[[0,1,2,3,4,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,8,9,12,13],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],TheSecondEnvironment:[[0,1,2,3,4,9],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],LizzoEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,16,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]]},ea="UI Info: ",pa=document.querySelector(".info__version"),_a=document.querySelector(".info__time-spend"),ga=document.querySelector(".info__custom-color"),ba=document.querySelector(".info__requirements"),ya=document.querySelector(".info__suggestions"),va=document.querySelector(".info__information"),Ea=document.querySelector(".info__warnings"),wa=document.querySelector(".info__bookmarks"),Sa=document.querySelector(".info__bpm-changes"),Da=document.querySelector(".info__environment-enhancement"),Ta=document.querySelector(".info__point-definitions"),Ca=document.querySelector(".info__custom-events"),Bs=document.querySelectorAll(".info__table-element");if(!pa||!_a||!ga||!ba||!ya||!va||!Ea||!wa||!Sa||!Da||!Ta||!Ca||!Bs)throw new Error(ea+"table info component is missing part");const La=document.querySelector(".info__level-author"),ka=document.querySelector(".info__environment"),yn=document.querySelector(".info__editors"),vn=document.querySelector(".info__contributors"),An=document.querySelector(".info__contributors-select"),tu=document.querySelector(".info__contributors-image"),$s=document.querySelector(".info__contributors-name"),Ms=document.querySelector(".info__contributors-role");if(!La||!ka||!yn)throw new Error(ea+"info component is missing part");if(!vn||!$s||!Ms)throw new Error(ea+"contributors component is missing part");if(An)An.addEventListener("change",au);else throw new Error(ea+"contributors select is missing");function Os(t){if(!t){La.textContent="";return}La.textContent="Mapped by "+t}function Ps(t){if(!t){ka.textContent="";return}ka.textContent=(Qc[t]||"Unknown")+" Environment"}function Fs(t){if(!t||!t._lastEditedBy){yn.classList.add("hidden");return}yn.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let i="Last edited on "+e;if(t[e]){const a=t[e];i+=" v"+a.version}yn.textContent=i}function eu(t){tu.src=t||"./img/unknown.jpg"}function iu(t){$s.textContent=t}function nu(t){Ms.textContent=t}function Hs(t){eu(t._base64?"data:image;base64,"+t._base64:null),iu(t._name),nu(t._role)}function Xs(t){if(vn&&(!t||!t.length)){vn.classList.add("hidden"),ha(An);return}if(t){vn.classList.remove("hidden");let e=!0;t.forEach((i,a)=>{e&&(e=!1,Hs(i));const o=document.createElement("option");o.value=a.toString(),o.text=i._name+" -- "+i._role,An.add(o)})}}function au(t){const e=t.target;Hs(lt.contributors[parseInt(e.value)])}const Oi={version:3,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",infoRowHeight:4,rounding:3,dataCheck:!0,dataError:!0,theme:"Dark",onLoad:{stats:!1},show:{info:!1,tools:!1,stats:!1,settings:!1}},Q=new class{constructor(){this.property=St(Oi),this.stringify=()=>JSON.stringify({settings:this.property}),this.init=()=>{var i,a;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const o=JSON.parse(e);if(!((i=o.settings)!=null&&i.version)){this.clear();return}this.property=(a=o.settings)!=null?a:this.property;for(const r in Oi)typeof this.property[r]>"u"&&(this.property[r]=Oi[r]);this.property.version=Oi.version,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this.property=St(Oi)},this.init()}get version(){return this.property.version}get load(){return this.property.load}get sorting(){return this.property.sorting}set sorting(e){this.property.sorting=e}get beatNumbering(){return this.property.beatNumbering}set beatNumbering(e){this.property.beatNumbering=e}get infoRowHeight(){return this.property.infoRowHeight}set infoRowHeight(e){this.property.infoRowHeight=e}get rounding(){return this.property.rounding}set rounding(e){this.property.rounding=e}get dataCheck(){return this.property.dataCheck}set dataCheck(e){this.property.dataCheck=e}get dataError(){return this.property.dataError}set dataError(e){this.property.dataError=e}get theme(){return this.property.theme}set theme(e){this.property.theme=e}get onLoad(){return this.property.onLoad}get show(){return this.property.show}};var zs=(t=>(t.tiny="panel--tiny",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t.max="panel--max",t))(zs||{}),Ys=(t=>(t.normal="panel--offset",t.half="panel--offset-half",t.none="",t))(Ys||{});const zi={create:(t,e,i,a)=>{const o=document.createElement("div");return o.className=`panel ${zs[t]}`,e&&e!=="none"&&o.classList.add(Ys[e]),i&&o.classList.add("panel--flex"+a?"-column":""),o}};function te(t){const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")}function ee(t,e){const i=t.querySelector(".info__table-element");if(i){for(;i.firstChild;)i.removeChild(i.firstChild);typeof e=="string"?i.textContent=e:(e.forEach(a=>{if(typeof a=="string"){const o=document.createElement("span");o.textContent=a,i.appendChild(o),i.appendChild(document.createElement("br"))}else i.appendChild(a),i.appendChild(document.createElement("br"))}),i.lastChild&&i.removeChild(i.lastChild))}t.classList.remove("hidden")}function Us(t){Bs.forEach(e=>e.style.maxHeight=`${t}rem`)}function js(t,e){if(t==null||!t.length){te(wa);return}const i=zi.create("max","none",!0);t.forEach((a,o)=>{let r=a._time,s;const n=document.createElement("div"),l=document.createElement("div"),c=document.createElement("div");n.appendChild(l),n.appendChild(c),l.className="info__color-dot",l.style.backgroundColor="#000000",c.className="info__color-text",typeof a._name!="string"&&(c.textContent=`Error parsing bookmarks[${o}]`,i.appendChild(n)),e&&(r=e.adjustTime(r),s=e.toRealTime(r)),l.style.backgroundColor=a._color?Rt({r:a._color[0],g:a._color[1],b:a._color[2]}):"#333333",c.textContent=`${B(a._time,Q.rounding)}${s?" | "+Nt(s):""} -- ${a._name!=""?a._name:"**EMPTY NAME**"}`,i.appendChild(n)}),ee(wa,[i])}function Gs(t){if(!t||!t.change.length){te(Sa);return}const e=t.change.map(i=>{const a=B(i._newTime,Q.rounding),o=t.toRealTime(i._time);return`${a} | ${Nt(o)} -- ${i._BPM}`});ee(Sa,e)}const ue={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",GlassDesertEnvironment:"Glass Desert"},ru={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},he={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.5320754,g:.5320754,b:.5320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"The Second":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8235294,g:.08627451,b:.8509804},_envColorRightBoost:{r:0,g:1,b:.6478302},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Lizzo:{_colorLeft:{r:1,g:.8132076,b:.3773585},_colorRight:{r:.6705883,g:.254902,b:.8980392},_envColorLeft:{r:.8392157,g:.6470588,b:.2156863},_envColorRight:{r:.8196079,g:.2392157,b:.8784314},_envColorLeftBoost:{r:1,g:.4,b:.5529412},_envColorRightBoost:{r:.3686275,g:.7960784,b:1},_obstacleColor:{r:1,g:.5020987,b:.1882353}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}};function Ws(t,e){var l,c,h,f,p,u,m;if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._obstacleColor){te(ga);return}e||(e="DefaultEnvironment");const i={_colorLeft:(l=he[ue[e]])==null?void 0:l._colorLeft,_colorRight:(c=he[ue[e]])==null?void 0:c._colorRight,_envColorLeft:(h=he[ue[e]])==null?void 0:h._envColorLeft,_envColorRight:(f=he[ue[e]])==null?void 0:f._envColorRight,_envColorLeftBoost:(p=he[ue[e]])==null?void 0:p._envColorLeftBoost,_envColorRightBoost:(u=he[ue[e]])==null?void 0:u._envColorRightBoost,_obstacleColor:(m=he[ue[e]])==null?void 0:m._obstacleColor},a={_colorLeft:i._colorLeft?Rt(i._colorLeft):null,_colorRight:i._colorRight?Rt(i._colorRight):null,_envColorLeft:i._envColorLeft?Rt(i._envColorLeft):null,_envColorRight:i._envColorRight?Rt(i._envColorRight):null,_envColorLeftBoost:i._envColorLeftBoost?Rt(i._envColorLeftBoost):null,_envColorRightBoost:i._envColorRightBoost?Rt(i._envColorRightBoost):null,_obstacleColor:i._obstacleColor?Rt(i._obstacleColor):null};t._colorLeft&&(a._colorLeft=Rt(t._colorLeft)),t._colorRight&&(a._colorRight=Rt(t._colorRight)),t._envColorLeft?a._envColorLeft=Rt(t._envColorLeft):t._colorLeft&&(a._envColorLeft=Rt(t._colorLeft)),t._envColorRight?a._envColorRight=Rt(t._envColorRight):t._colorRight&&(a._envColorRight=Rt(t._colorRight));let o,r,s=!1;t._envColorLeftBoost?(o=Rt(t._envColorLeftBoost),s=!0):o=i._envColorLeftBoost?Rt(i._envColorLeftBoost):a._envColorLeft,t._envColorRightBoost?(r=Rt(t._envColorRightBoost),s=!0):r=i._envColorRightBoost?Rt(i._envColorRightBoost):a._envColorRight,s&&(a._envColorLeftBoost=o,a._envColorRightBoost=r),t._obstacleColor&&(a._obstacleColor=Rt(t._obstacleColor));const n=zi.create("max","none",!0);for(const _ in a){if(!a[_])continue;const b=document.createElement("div"),y=document.createElement("div"),v=document.createElement("div"),D=document.createElement("div");y.className="info__color-dot",y.style.backgroundColor=a[_]||"#000000",v.className="info__color-text info__color-text--monospace",v.textContent=`${a[_]}`,D.className="info__color-text",D.textContent=` -- ${ru[_]}`,b.appendChild(y),b.appendChild(v),b.appendChild(D),n.appendChild(b)}ee(ga,[n])}var Vs=(t=>(t.duplicate="D",t.active="A",t.scale="S",t.position="P",t.localPosition="Lp",t.rotation="R",t.localRotation="Lr",t.lightID="Li",t.track="T",t))(Vs||{}),Js=(t=>(t.childrenTracks="Ct",t.color="C",t.definitePosition="Dp",t.dissolve="D",t.dissolveArrow="Da",t.duration="Dur",t.easing="E",t.interactable="I",t.localRotation="Lr",t.parentTrack="Pt",t.position="P",t.rotation="R",t.scale="S",t.time="T",t.track="Tr",t.worldPositionStays="Wps",t))(Js||{});function qs(t,e){if(t==null||!t.length){te(Ca);return}const i=t.map((a,o)=>{let r=a.b,s;e&&(r=e.adjustTime(r),s=e.toRealTime(r));const n=[];if(!a.d)return`Error parsing customEvents[${o}]`;for(const l in a.d){if(l=="_duration"||l=="_easing"||l=="_track"||l=="duration"||l=="easing"||l=="track")continue;const c=Js[l];a.d[l]!=null&&n.push(c)}return`${B(a.b,Q.rounding)}${s?" | "+Nt(s):""} -- ${a.t} -> [${n.join("")}]${a.t!=="AssignTrackParent"?`(${a.d.track})`:""}`});ee(Ca,i)}function Zs(t){if(t==null||!t.length){te(Da);return}const e=t.map((i,a)=>{const o=[];if(!i.id&&!i.geometry)return`Error parsing environment[${a}]`;for(const r in i){if(r=="lookupMethod"||r=="id"||r=="geometry")continue;const s=Vs[r];i[r]!=null&&o.push(s)}return`${i.lookupMethod} [${o.join("")}]${i.track?`(${i.track})`:""} -> ${i.geometry?i.geometry.type:i.id}`});ee(Da,e)}function xa(t){if(t==null){te(pa);return}ee(pa,t)}function Ks(t){if(t==null){te(_a);return}ee(_a,jc(t))}function Qs(t){if(t==null||!t.length){te(ba);return}ee(ba,t.join(", "))}function tl(t){if(t==null||!t.length){te(ya);return}ee(ya,t.join(", "))}function el(t){if(t==null||!t.length){te(va);return}ee(va,t)}function il(t){if(t==null||!t.length){te(Ea);return}ee(Ea,t)}function nl(t){if(t==null||!t.length){te(Ta);return}const e=[];for(const i in t)t[i]||e.push(`Error parsing pointDefinitions[${i}]`),e.push(`${i} -- ${t[i].length} point${t[i].length>1?"s":""}`);ee(Ta,e)}function ou(t){var e;zt.setSongName(t._songName),zt.setSongSubname(t._songSubName),zt.setSongAuthor(t._songAuthorName),zt.setSongBPM(t._beatsPerMinute),Os(t._levelAuthorName),Ps(t._environmentName),Fs((e=t._customData)==null?void 0:e._editors)}function al(t){var e,i,a,o,r;if(t.rawVersion===2&&xa(t.rawData._version),t.rawVersion===3&&xa(t.rawData.version),(e=t.info)!=null&&e._customData&&(Ws(t.info._customData),Qs(t.info._customData._requirements),tl(t.info._customData._suggestions),el(t.info._customData._information),il(t.info._customData._warnings)),(i=t.data)!=null&&i.customData){const s=(a=lt.beatmapInfo)!=null&&a._beatsPerMinute?Ae.create(lt.beatmapInfo._beatsPerMinute,t.data.customData._bpmChanges||t.data.customData._BPMChanges||t.data.customData.BPMChanges):null;Ks((o=t.data.customData._time)!=null?o:t.data.customData.time),js((r=t.data.customData._bookmarks)!=null?r:t.data.customData._bookmarks,s),Gs(s),Zs(t.data.customData.environment),nl(t.data.customData.pointDefinitions),qs(t.data.customData.customEvents,s)}}function su(){Os(),Ps(),Fs(),Xs(),xa(),Ks(),Ws(),Qs(),tl(),el(),il(),js(),Gs(),Zs(),nl(),qs()}const lu="UI Input: ",dn={enable:t=>{const e=document.querySelectorAll(".input-toggle");if(!e.length){console.error(lu+"empty list, intentional or typo error?");return}e.forEach(i=>{i.disabled=!t})}},cu="UI Loading: ",bi=document.querySelector(".loading__bar"),kr="loading__bar--error",xr="loading__bar--download",rl=document.querySelector(".loading__text");if(!bi||!rl)throw new Error(cu+"loading component is missing part");function ol(t,e,i=100){rl.textContent=e,bi.style.width=`${i}%`,t==="error"?bi.classList.add(kr):bi.classList.remove(kr),t==="download"?bi.classList.add(xr):bi.classList.remove(xr)}function uu(){ol("info","No map loaded",0)}const bt={status:ol,reset:uu};var dt=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_UNLIT_BOMB=10]="EVENTS_UNLIT_BOMB",t[t.NOTES_EFFECTIVE_BPM=11]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=12]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=13]="NOTES_PARITY",t[t.NOTES_VARY_SWING=14]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=15]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=16]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=17]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=18]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=19]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=20]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=21]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=22]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=23]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=24]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=25]="NOTES_HITBOX_PATH",t[t.NOTES_COLOR_CHECK=26]="NOTES_COLOR_CHECK",t[t.NOTES_STACKED_NOTE=27]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=28]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=29]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=30]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=31]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=32]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=33]="OBSTACLES_NEGATIVE",t))(dt||{}),ft=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_UNLIT_BOMB=10]="EVENTS_UNLIT_BOMB",t[t.NOTES_COLOR_CHECK=11]="NOTES_COLOR_CHECK",t[t.NOTES_EFFECTIVE_BPM=12]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=13]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=14]="NOTES_PARITY",t[t.NOTES_VARY_SWING=15]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=16]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=17]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=18]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=19]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=20]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=21]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=22]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=23]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=24]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=25]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=26]="NOTES_HITBOX_PATH",t[t.NOTES_STACKED_NOTE=27]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=28]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=29]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=30]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=31]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=32]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=33]="OBSTACLES_NEGATIVE",t))(ft||{});function mt(t,e){const i=document.createElement("div");return e?i.innerHTML=`<b>${t}:</b> ${e}`:i.innerHTML=`<b>${t}</b>`,i}function pt(t,e,i){const a=document.createElement("div");return a.innerHTML=`<b>${t} [${e.length}]:</b> ${e.map(o=>{switch(Q.beatNumbering){case"realtime":return`<span title="Beat ${B(i.adjustTime(o),Q.rounding)}">${Nt(i.toRealTime(o))}</span>`;case"realtimems":return`<span title="Beat ${B(i.adjustTime(o),Q.rounding)}">${bn(i.toRealTime(o))}</span>`;case"jsontime":return`<span title="Time ${bn(i.toRealTime(o))}">${B(o,Q.rounding)}</span>`;case"beattime":default:return`<span title="Time ${bn(i.toRealTime(o))}">${B(i.adjustTime(o),Q.rounding)}</span>`}}).join(", ")}`,a}const Ra=class{constructor(){}};let ct=Ra;ct.list=[];ct.create=(t,e,i,a)=>{const o=t.trim().toLowerCase().replace(" ","-");if(Ra.list.includes(o))throw new Error(o+" is already being used.");Ra.list.push(o);const r=document.createElement("div"),s=document.createElement("input"),n=document.createElement("label");return n.textContent=" "+t,n.title=e,n.htmlFor="input__tools-"+o,s.id="input__tools-"+o,s.className="input-toggle",s.type="checkbox",s.checked=i,s.addEventListener("change",a),r.appendChild(s),r.appendChild(n),r};const Rr="Validate Cover Image",Ir="Validate cover image.",Nr=!0,Bn={name:Rr,description:Ir,type:"general",order:{input:dt.GENERAL_COVER_IMAGE,output:ft.GENERAL_COVER_IMAGE},input:{enabled:Nr,params:{},html:ct.create(Rr,Ir,Nr,function(){Bn.input.enabled=this.checked})},output:{html:null},run:hu};function hu(){const t=new Image,e=zt.getCoverImage(),i=[];if(wi.loading.coverImage&&e!==null?(t.src=e,t.width!==t.height&&i.push(mt("Cover image is not square","resize to fit square")),(t.width<256||t.height<256)&&i.push(mt("Cover image is too small","require at least 256x256"))):i.push(mt("No cover image",Q.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),i.length){const a=document.createElement("div");i.forEach(o=>a.append(o)),Bn.output.html=a}else Bn.output.html=null}const Ar="Audio Duration",Br="For ranking purpose, check for audio duration.",$r=!0,Yi={name:Ar,description:Br,type:"general",order:{input:dt.GENERAL_AUDIO,output:ft.GENERAL_AUDIO},input:{enabled:$r,params:{},html:ct.create(Ar,Br,$r,function(){Yi.input.enabled=this.checked})},output:{html:null},run:du};function du(t){const{audioDuration:e}=t.settings;e&&e<20?Yi.output.html=mt("Unrankable audio length",`too short (${Nt(e)}s)`):wi.loading.audio?Yi.output.html=null:Yi.output.html=mt("No audio",Q.load.audio?"could not be loaded or not found":"no audio mode is enabled")}const Mr="Preview Time",Or="Warn default editor preview time.",Pr=!0,$n={name:Mr,description:Or,type:"general",order:{input:dt.GENERAL_PREVIEW_TIME,output:ft.GENERAL_PREVIEW_TIME},input:{enabled:Pr,params:{},html:ct.create(Mr,Or,Pr,function(){$n.input.enabled=this.checked})},output:{html:null},run:fu};function fu(t){const{_previewStartTime:e,_previewDuration:i}=t.info;if(e===12&&i===10){const a=document.createElement("div");a.innerHTML="<b>Default preview time:</b> strongly recommended to set for audience's 1st impression",$n.output.html=a}else $n.output.html=null}function mu(t){return Math.max(...t.map(e=>e.ebpm),0)}function pu(t){return Math.max(...t.map(e=>e.ebpmSwing),0)}const pe=4;var tt=(t=>(t[t.RED=0]="RED",t[t.BLUE=1]="BLUE",t))(tt||{}),F=(t=>(t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.UP_LEFT=4]="UP_LEFT",t[t.UP_RIGHT=5]="UP_RIGHT",t[t.DOWN_LEFT=6]="DOWN_LEFT",t[t.DOWN_RIGHT=7]="DOWN_RIGHT",t[t.ANY=8]="ANY",t))(F||{}),rt=(t=>(t[t.LEFT=0]="LEFT",t[t.MIDDLE_LEFT=1]="MIDDLE_LEFT",t[t.MIDDLE_RIGHT=2]="MIDDLE_RIGHT",t[t.RIGHT=3]="RIGHT",t))(rt||{}),Lt=(t=>(t[t.BOTTOM=0]="BOTTOM",t[t.MIDDLE=1]="MIDDLE",t[t.TOP=2]="TOP",t))(Lt||{});const kt={[0]:180,[1]:0,[2]:270,[3]:90,[4]:225,[5]:135,[6]:315,[7]:45,[8]:0},_u={[0]:1,[1]:0,[2]:3,[3]:2,[4]:7,[5]:6,[6]:5,[7]:4,[8]:8},He={[0]:[0,1],[1]:[0,-1],[2]:[-1,0],[3]:[1,0],[4]:[-1,1],[5]:[1,1],[6]:[-1,-1],[7]:[1,-1],[8]:[0,0]},gu={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60};class Vt{constructor(e){this.data=e}serialize(){return JSON.stringify(this.toJSON())}clone(){return new this.constructor(this.toJSON())}}class Ge extends Vt{get time(){return this.data.b}set time(e){this.data.b=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}setTime(e){return this.time=e,this}setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return this.customData&&delete this.customData[e],this}addCustomData(e){return this.customData={...this.customData,...e},this}func(e){return e(this),this}}class Ya extends Ge{get posX(){return this.data.x}set posX(e){this.data.x=e}get posY(){return this.data.y}set posY(e){this.data.y=e}setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}swapPosition(e){const i=e.posX;e.posX=this.posX,this.posX=i;const a=e.posY;return e.posY=this.posY,this.posY=a,this}getPosition(e){switch(e){case"vanilla":return[this.posX-2,this.posY];case"me":return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY];case"ne":return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[this.posX-2,this.posY];default:return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}}const Pt=class extends Ya{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean",this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c;return e.push(new this({b:(a=i.b)!=null?a:Pt.default.b,x:(o=i.x)!=null?o:Pt.default.x,y:(r=i.y)!=null?r:Pt.default.y,c:(s=i.c)!=null?s:Pt.default.c,d:(n=i.d)!=null?n:Pt.default.d,a:(l=i.a)!=null?l:Pt.default.a,customData:(c=i.customData)!=null?c:Pt.default.customData()}))}),e.length?e:[new this({b:Pt.default.b,x:Pt.default.x,y:Pt.default.y,c:Pt.default.c,d:Pt.default.d,a:Pt.default.a,customData:Pt.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,a:this.angleOffset,customData:St(this.customData)}}get color(){return this.data.c}set color(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get angleOffset(){return this.data.a}set angleOffset(t){this.data.a=t}setColor(t){return this.color=t,this}setDirection(t){return this.direction=t,this}setAngleOffset(t){return this.angleOffset=t,this}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]})),t&&(this.color=(1+this.color)%2),this.posX=pe-1-this.posX,this}swapRotation(t,e=!0){const i=t.direction;t.direction=this.direction,this.direction=i;const a=t.angleOffset;return t.angleOffset=this.angleOffset,this.angleOffset=a,e&&(t.angleOffset=0-t.angleOffset,this.angleOffset=0-this.angleOffset),this}getAngle(t){switch(t){case"vanilla":return(kt[this.direction]||0)+this.angleOffset;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return(kt[this.direction]||0)+this.angleOffset;default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):(kt[this.direction]||0)+this.angleOffset}}getDistance(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition();return Math.sqrt(Math.pow(a-e,2)+Math.pow(o-i,2))}isRed(){return this.color===0}isBlue(){return this.color===1}isVertical(t){if(t){const[e]=this.getPosition(),[i]=t.getPosition(),a=e-i;return a>-.001&&a<.001}return 22.5<=Math.abs(this.getAngle())%180+90&&Math.abs(this.getAngle())%180+90<=67.5}isHorizontal(t){if(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition(),r=i-o;return r>-.001&&r<.001}return 22.5<=Math.abs(this.getAngle())%180+90&&Math.abs(this.getAngle())%180+90<=67.5}isDiagonal(t){if(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition(),r=Math.abs(e-a),s=Math.abs(i-o);return r===s}return 22.5<=Math.abs(this.getAngle())%90&&Math.abs(this.getAngle())%90<=67.5}isInline(t,e=.5){return this.getDistance(t)<=e}isDouble(t,e=.01){return t.time>this.time-e&&t.time<this.time+e&&this.color!==t.color}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t,e=1.8){return this.getDistance(t)>e}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}hasMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0||this.direction>=1e3&&this.direction<=1360||this.direction>=2e3&&this.direction<=2360}isValidDirection(){return this.direction>=0&&this.direction<=8}isValid(){return!this.hasMappingExtensions()&&this.isValidDirection()}};let Ie=Pt;Ie.default={b:0,c:0,x:0,y:0,d:0,a:0,customData:()=>({})};function sl(t,e,i){return t.direction===F.ANY&&e.direction===F.ANY&&i!==F.ANY&&(t.posX>e.posX&&(i===F.UP_RIGHT||i===F.RIGHT||i===F.DOWN_RIGHT)||t.posX<e.posX&&(i===F.DOWN_LEFT||i===F.LEFT||i===F.UP_LEFT)||t.posY>e.posY&&(i===F.UP_LEFT||i===F.UP||i===F.UP_RIGHT)||t.posY<e.posY&&(i===F.DOWN_LEFT||i===F.DOWN||i===F.DOWN_RIGHT))||t.posX>e.posX&&(t.direction===F.UP_RIGHT||t.direction===F.RIGHT||t.direction===F.DOWN_RIGHT||(e.direction===F.UP_RIGHT||e.direction===F.RIGHT||e.direction===F.DOWN_RIGHT)&&t.direction===F.ANY)||t.posX<e.posX&&(t.direction===F.DOWN_LEFT||t.direction===F.LEFT||t.direction===F.UP_LEFT||(e.direction===F.DOWN_LEFT||e.direction===F.LEFT||e.direction===F.UP_LEFT)&&t.direction===F.ANY)||t.posY>e.posY&&(t.direction===F.UP_LEFT||t.direction===F.UP||t.direction===F.UP_RIGHT||(e.direction===F.UP_LEFT||e.direction===F.UP||e.direction===F.UP_RIGHT)&&t.direction===F.ANY)||t.posY<e.posY&&(t.direction===F.DOWN_LEFT||t.direction===F.DOWN||t.direction===F.DOWN_RIGHT||(e.direction===F.DOWN_LEFT||e.direction===F.DOWN||e.direction===F.DOWN_RIGHT)&&t.direction===F.ANY)}function Ia(t,e,i,a=!1){const[o,r]=t.getPosition(),[s,n]=e.getPosition(),l=a?540:360;let c=!1;if(t.direction!==8){const f=t.getAngle(),p=(ca(Math.atan2(r-n,o-s))+450)%360;for(const[u,m,_]of i){const b=_!=null?_:0,y=(f+l-u+b)%360,v=(f+l+u+b)%360;if(c=m>=Math.sqrt(Math.pow(o-s,2)+Math.pow(r-n,2))&&(y<v&&y<=p&&p<=v||y>=v&&(p<=v||p>=y))||c,c)break}}let h=!1;if(e instanceof Ie&&e.direction!==8){const f=e.getAngle(),p=(ca(Math.atan2(n-r,s-o))+450)%360;for(const[u,m,_]of i){const b=_!=null?_:0,y=(f+l-u+b)%360,v=(f+l+u+b)%360;if(h=m>=Math.sqrt(Math.pow(o-s,2)+Math.pow(r-n,2))&&(y<v&&y<=p&&p<=v||y>=v&&(p<=v||p>=y))||h,h)break}}return[c,h]}function Fr(t,e){if(sl(t,e,F.ANY))return t.direction===F.ANY?e.direction:t.direction;if(t.direction!==F.ANY)return t.direction;if(t.time>e.time){if(t.posX>e.posX&&t.isHorizontal(e))return F.RIGHT;if(t.posX<e.posX&&t.isHorizontal(e))return F.LEFT;if(t.posY>e.posY){if(t.isVertical(e))return F.UP;if(t.posX>e.posX)return F.UP_RIGHT;if(t.posX<e.posX)return F.UP_LEFT}if(t.posY<e.posY){if(t.isVertical(e))return F.DOWN;if(t.posX>e.posX)return F.DOWN_RIGHT;if(t.posX<e.posX)return F.DOWN_LEFT}}return F.ANY}function tn(t,e,i,a){let o,r;if(t===null||e===null)return!1;if(typeof t=="number")o=t;else{if(t.direction===F.ANY)return!1;o=t.getAngle()}if(typeof e=="number")r=e;else{if(e.direction===F.ANY)return!1;r=e.getAngle()}return a?Dr(o,r,360)<=i:Dr(o,r,360)>=i}class Mt{constructor(e){this.time=e.time,this.duration=e.duration,this.minSpeed=e.minSpeed,this.maxSpeed=e.maxSpeed,this.ebpm=e.ebpm,this.ebpmSwing=e.ebpmSwing,this.data=e.data}static generate(e,i){const a=[];let o=0,r=0,s,n;const l={},c={},h={0:[],1:[]};for(const f of e)f.type==="note"&&(s=0,n=Number.MAX_SAFE_INTEGER,c[f.data.color]?this.next(f,c[f.data.color],i,h[f.data.color])&&(s=this.calcMinSliderSpeed(h[f.data.color],i),n=this.calcMaxSliderSpeed(h[f.data.color],i),s>0&&n!==1/0||(s=0,n=0),a.push({time:l[f.data.color].data.time,duration:c[f.data.color].data.time-l[f.data.color].data.time,data:h[f.data.color],ebpm:o,ebpmSwing:r,maxSpeed:n,minSpeed:s}),r=this.calcEBPMBetweenObject(f.data,l[f.data.color].data,i.value),o=this.calcEBPMBetweenObject(f.data,c[f.data.color].data,i.value),l[f.data.color]=f,h[f.data.color]=[]):l[f.data.color]=f,c[f.data.color]=f,h[f.data.color].push(f));for(let f=0;f<2;f++)c[f]&&(s=this.calcMinSliderSpeed(h[f],i),n=this.calcMaxSliderSpeed(h[f],i),s>0&&n!==1/0||(s=0,n=0),a.push({time:l[f].data.time,duration:c[f].data.time-l[f].data.time,data:h[f],ebpm:o,ebpmSwing:r,maxSpeed:n,minSpeed:s}));return a}}Mt.next=(t,e,i,a)=>{if(t.type==="bomb"||e.type==="bomb")throw new Error("Invalid type");if(a&&a.length>0&&i.toRealTime(e.data.time)+.005<i.toRealTime(t.data.time)&&t.data.direction!==8){for(const o of a)if(o.type==="note"&&o.data.direction!==8&&tn(t.data,o.data,90,!1))return!0}if(a&&a.length>0){for(const o of a)if(o.type==="note"&&t.data.isInline(o.data))return!0}return t.data.isWindow(e.data)&&i.toRealTime(t.data.time-e.data.time)>.08||i.toRealTime(t.data.time-e.data.time)>.07};Mt.calcEBPMBetweenObject=(t,e,i)=>i/((t.time-e.time)*2);Mt.calcMinSliderSpeed=(t,e)=>{let i=!1,a=!1,o=0;const r=e.toRealTime(Math.max(...t.map((s,n)=>n===0?0:((t[n].data.isHorizontal(t[n-1].data)||t[n].data.isVertical(t[n-1].data))&&!i&&(i=!0,o=(t[n].data.time-t[n-1].data.time)/(t[n].data.getDistance(t[n-1].data)||1)),a=t[n].data.isDiagonal(t[n-1].data)||t[n].data.isSlantedWindow(t[n-1].data)||a,(t[n].data.time-t[n-1].data.time)/(t[n].data.getDistance(t[n-1].data)||1)))));return i&&a?e.toRealTime(o):r};Mt.calcMaxSliderSpeed=(t,e)=>{let i=!1,a=!1,o=Number.MAX_SAFE_INTEGER;const r=e.toRealTime(Math.min(...t.map((s,n)=>n===0?Number.MAX_SAFE_INTEGER:((t[n].data.isHorizontal(t[n-1].data)||t[n].data.isVertical(t[n-1].data))&&!i&&(i=!0,o=(t[n].data.time-t[n-1].data.time)/(t[n].data.getDistance(t[n-1].data)||1)),a=t[n].data.isDiagonal(t[n-1].data)||t[n].data.isSlantedWindow(t[n-1].data)||a,(t[n].data.time-t[n-1].data.time)/(t[n].data.getDistance(t[n-1].data)||1)))));return i&&a?e.toRealTime(o):r};function bu(t,e,i){const a={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let o,r;for(const s of t){if(s.type!=="note")continue;const n=i.toRealTime(s.data.time);s.data.color===0&&(o?Mt.next(s,o,i)&&a.left[Math.floor(n)]++:a.left[Math.floor(n)]++,o=s),s.data.color===1&&(r?Mt.next(s,r,i)&&a.right[Math.floor(n)]++:a.right[Math.floor(n)]++,r=s)}return a}function oa(t,e){if(!t.length)return 0;if(t.length<e)return t.reduce((o,r)=>o+r)/t.length;let i=t.slice(0,e).reduce((o,r)=>o+r),a=i;for(let o=0;o<t.length-e;o++)i=i-t[o]+t[o+e],a=Math.max(a,i);return a/e}function Hr(t,e,i,a){const r={characteristic:i,difficulty:a,red:{average:0,peak:0,median:0,total:0},blue:{average:0,peak:0,median:0,total:0},total:{average:0,peak:0,median:0,total:0},container:Mt.generate(t.getNoteContainer(),e)},s=Math.max(e.toRealTime(t.getLastInteractiveTime()-t.getFirstInteractiveTime()),0),n=Math.max(e.toRealTime(t.getLastInteractiveTime()),0),l=bu(t.getNoteContainer(),n,e),c=l.left.map((u,m)=>u+l.right[m]);if(c.reduce((u,m)=>u+m)===0)return r;const h=[],f=[],p=[];for(let u=0,m=Math.ceil(c.length/10);u<m;u++){const _=u*10;let b=10;b+_>c.length&&(b=c.length-_);const y=l.left.slice(_,_+b),v=l.right.slice(_,_+b),D=c.slice(_,_+b);h.push(y.reduce((C,L)=>C+L)/b),f.push(v.reduce((C,L)=>C+L)/b),p.push(D.reduce((C,L)=>C+L)/b)}return r.red.total=l.left.reduce((u,m)=>u+m),r.red.average=l.left.reduce((u,m)=>u+m)/s,r.red.peak=oa(l.left,10),r.red.median=ra(h),r.blue.total=l.right.reduce((u,m)=>u+m),r.blue.average=l.right.reduce((u,m)=>u+m)/s,r.blue.peak=oa(l.right,10),r.blue.median=ra(f),r.total.total=r.red.total+r.blue.total,r.total.average=c.reduce((u,m)=>u+m)/s,r.total.peak=oa(c,10),r.total.median=ra(p),r}function yu(t,e){let i=0,a=0,o;for(const r of t){const s=r.total.average;if(a>0&&s>0&&(i=Math.abs(1-a/s)*100),a=s>0?s:a,a>e&&i>40)return{result:r,comparedTo:o};o=r}return null}function vu(t,e){let i=Number.MAX_SAFE_INTEGER,a=0,o;for(const r of t){const s=r.total.average;if(a>0&&s>0&&(i=Math.abs(1-a/s)*100),a=s>0?s:a,a>e&&i<10)return{result:r,comparedTo:o};o=r}return null}function Eu(t){let e=0,i=Number.MAX_SAFE_INTEGER;return t.forEach(a=>{const o=a.total.average;o>0&&(e=Math.max(e,o),i=Math.min(i,o))}),e||e&&i?(1-i/e)*100:0}function Xr(t){let e=Number.MAX_SAFE_INTEGER;return t.forEach(i=>{const a=i.total.average;a>0&&(e=Math.min(e,a))}),e}function zr(t){let e=0;return t.forEach(i=>{const a=i.total.average;a>0&&(e=Math.max(e,a))}),e}function wu(t){return Math.max(...t.map(e=>e.minSpeed),0)}function Su(t){const e=t.map(i=>i.maxSpeed).filter(i=>i!==0);return e.length?Math.min(...e):0}var ll=(t=>(t[t.Easy=1]="Easy",t[t.Normal=3]="Normal",t[t.Hard=5]="Hard",t[t.Expert=7]="Expert",t[t.ExpertPlus=9]="ExpertPlus",t))(ll||{}),de=(t=>(t.Easy="Easy",t.Normal="Normal",t.Hard="Hard",t.Expert="Expert",t.ExpertPlus="Expert+",t))(de||{});const cl="Difficulty Progression",ul="For ranking purpose, check difficuly progression to fit rankability criteria.",hl=!0,Ua=document.createElement("div"),dl=document.createElement("ul"),Du=["ExpertPlus","Expert","Hard","Normal","Easy"];for(const t of Du)dl.appendChild(ct.create(de[t],`Toggle check progression for Standard ${de[t]}`,!0,function(){ze.input.params[t]=this.checked}));Ua.appendChild(ct.create(cl,ul,hl,function(){ze.input.enabled=this.checked}));Ua.appendChild(dl);const ze={name:cl,description:ul,type:"general",order:{input:dt.GENERAL_PROGRESSION,output:ft.GENERAL_PROGRESSION},input:{enabled:hl,params:{ExpertPlus:!0,Expert:!0,Hard:!0,Normal:!0,Easy:!0},html:Ua},output:{html:null},run:Tu};function Tu(t){var n,l,c,h,f,p,u,m;const{audioDuration:e}=t.settings;if(!e){ze.output.html=null;return}const i=lt.beatmapDifficulty.map(_=>_.swingAnalysis).filter(_=>_.characteristic==="Standard"&&ze.input.params[_.difficulty]||_.total.total===0).sort((_,b)=>_.total.average-b.total.average).reverse();if(!i.length){ze.output.html=null;return}const a=Math.max(e<120?3.2:e<240?4.2:5.2,B(zr(i)*.4,2)),o=[];e<360&&Xr(i)>a&&o.push(mt(`Minimum SPS not met (<${a})`,`lowest SPS is ${B(Xr(i),2)}, ${B(Eu(i),2)}% drop from highest SPS (${B(zr(i),2)})`));const r=yu(i,a),s=vu(i,a);if(r&&e<360&&o.push(mt("Violates progression",`${de[r.result.difficulty]} exceeded 40% SPS drop, ${B(r.result.total.average,2)} from ${B(((l=(n=r.comparedTo)==null?void 0:n.total)==null?void 0:l.average)||0,2)} ${de[r.comparedTo.difficulty]}, acceptable range (${B((((h=(c=r.comparedTo)==null?void 0:c.total)==null?void 0:h.average)||0)*.6,2)}-${B((((f=r.comparedTo)==null?void 0:f.total.average)||0)*.9,2)})`)),s&&e<360&&o.push(mt("Violates progression",`${de[s.result.difficulty]} has less than 10% SPS drop, ${B(s.result.total.average,2)} from ${B(((p=s.comparedTo)==null?void 0:p.total.average)||0,2)} ${de[s.comparedTo.difficulty]}, acceptable range (${B((((u=s.comparedTo)==null?void 0:u.total.average)||0)*.6,2)}-${B((((m=s.comparedTo)==null?void 0:m.total.average)||0)*.9,2)})`)),o.length){const _=document.createElement("div");o.forEach(b=>_.append(b)),ze.output.html=_}else ze.output.html=null}const Yr=Object.freeze(Object.defineProperty({__proto__:null,coverImage:Bn,audio:Yi,previewTime:$n,progression:ze},Symbol.toStringTag,{value:"Module"})),fl="Effective BPM",ml=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,pl=!0,ja=450,Ga=350,rn=ct.create(fl+" threshold",ml,pl,function(){Yt.input.enabled=this.checked}),We=document.createElement("input"),Wa=document.createElement("label"),Ve=document.createElement("input"),Va=document.createElement("label");Wa.textContent=": ";Wa.htmlFor="input__tools-ebpm";We.id="input__tools-ebpm";We.className="input-toggle input--small";We.type="number";We.min="0";We.value=ja.toString();We.addEventListener("change",Lu);Va.textContent=" (swing): ";Va.htmlFor="input__tools-ebpms";Ve.id="input__tools-ebpms";Ve.className="input-toggle input--small";Ve.type="number";Ve.min="0";Ve.value=Ga.toString();Ve.addEventListener("change",ku);rn.appendChild(Wa);rn.appendChild(We);rn.appendChild(Va);rn.appendChild(Ve);const Yt={name:fl,description:ml,type:"note",order:{input:dt.NOTES_EFFECTIVE_BPM,output:ft.NOTES_EFFECTIVE_BPM},input:{enabled:pl,params:{ebpmThres:ja,ebpmsThres:Ga},html:rn,adjustTime:Cu},output:{html:null},run:Ru};function Cu(t){Yt.input.params.ebpmThres=B(Math.min(ja,t.value*2*1.285714),1),Yt.input.params.ebpmsThres=B(Math.min(Ga,t.value*2),1),We.value=Yt.input.params.ebpmThres.toString(),Ve.value=Yt.input.params.ebpmsThres.toString()}function Lu(){Yt.input.params.ebpmThres=B(Math.abs(parseFloat(this.value)),1),this.value=Yt.input.params.ebpmThres.toString()}function ku(){Yt.input.params.ebpmsThres=B(Math.abs(parseFloat(this.value)),1),this.value=Yt.input.params.ebpmsThres.toString()}function xu(t){const{swingAnalysis:e}=t.difficulty,{ebpmThres:i,ebpmsThres:a}=Yt.input.params,o=e.container.filter(s=>s.ebpm>i).map(s=>s.time),r=e.container.filter(s=>s.ebpmSwing>a).map(s=>s.time);return{base:o,swing:r}}function Ru(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=xu(t),{ebpmThres:i,ebpmsThres:a}=Yt.input.params,o=[];if(e.base.length&&o.push(pt(`>${i}EBPM warning`,e.base,t.settings.bpm)),e.swing.length&&o.push(pt(`>${a}EBPM (swing) warning`,e.swing,t.settings.bpm)),o.length){const r=document.createElement("div");o.forEach(s=>r.append(s)),Yt.output.html=r}else Yt.output.html=null}const _l="Acceptable Beat Precision",gl=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,bl=!0,yl=[8,6],vl=ct.create(_l+": ",gl,bl,function(){fi.input.enabled=this.checked}),ki=document.createElement("input");ki.id="input__tools-prec";ki.className="input-toggle input--small";ki.type="text";ki.value=yl.join(" ");ki.addEventListener("change",Iu);vl.appendChild(ki);const fi={name:_l,description:gl,type:"note",order:{input:dt.NOTES_ACCEPTABLE_PRECISION,output:ft.NOTES_ACCEPTABLE_PRECISION},input:{enabled:bl,params:{prec:[...yl]},html:vl},output:{html:null},run:Au};function Iu(){fi.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=fi.input.params.prec.join(" ")}function Nu(t,e){const{bpm:i}=t,a=e.swingAnalysis.container,{prec:o}=fi.input.params;return a.map(r=>r.time).filter((r,s,n)=>!s||r!==n[s-1]).filter(r=>{if(!o.length)return!1;for(let s=0;s<o.length;s++)if((i.adjustTime(r)+.001)%(1/o[s])<.01)return!1;return!0})}function Au(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Nu(t.settings,t.difficulty);e.length?fi.output.html=pt("Off-beat precision",e,t.settings.bpm):fi.output.html=null}const Ur="Varying Swing Speed",jr="Check for varying swing speed due to changes in slider distance.",Gr=!0,Mn={name:Ur,description:jr,type:"note",order:{input:dt.NOTES_VARY_SWING,output:ft.NOTES_VARY_SWING},input:{enabled:Gr,params:{},html:ct.create(Ur,jr,Gr,function(){Mn.input.enabled=this.checked})},output:{html:null},run:$u};function Bu(t){const{swingAnalysis:e}=t;return e.container.filter(i=>Math.abs(i.minSpeed-i.maxSpeed)>.002).map(i=>i.time).filter((i,a,o)=>!a||i!==o[a-1])}function $u(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Bu(t.difficulty);e.length?Mn.output.html=pt("Varying swing speed",e,t.settings.bpm):Mn.output.html=null}const El="Slow Slider",wl="Look for slider that require slow swing.",Sl=!0,Dl=.025,xi=document.createElement("div"),Je=document.createElement("input"),Ja=document.createElement("label"),qe=document.createElement("input"),qa=document.createElement("label");let Si;Ja.textContent="min speed (ms): ";Ja.htmlFor="input__tools-slow-slider-time";Je.id="input__tools-slow-slider-time";Je.className="input-toggle input--small";Je.type="number";Je.min="0";Je.value=B(Dl*1e3,1).toString();Je.addEventListener("change",Ou);qa.textContent=" (prec): ";qa.htmlFor="input__tools-slow-slider-prec";qe.id="input__tools-slow-slider-prec";qe.className="input-toggle input--small";qe.type="number";qe.min="0";qe.addEventListener("change",Pu);xi.appendChild(ct.create(El,wl,Sl,function(){Kt.input.enabled=this.checked}));xi.appendChild(Ja);xi.appendChild(Je);xi.appendChild(qa);xi.appendChild(qe);const Kt={name:El,description:wl,type:"note",order:{input:dt.NOTES_SLOW_SLIDER,output:ft.NOTES_SLOW_SLIDER},input:{enabled:Sl,params:{minSpeed:Dl},html:xi,adjustTime:Mu},output:{html:null},run:Hu};function Mu(t){Si=t,qe.value=B(1/Si.toBeatTime(Kt.input.params.minSpeed),2).toString()}function Ou(){Kt.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=B(Kt.input.params.minSpeed*1e3,1).toString(),Si&&(qe.value=B(1/Si.toBeatTime(Kt.input.params.minSpeed),2).toString())}function Pu(){if(!Si){this.value="0";return}let t=B(Math.abs(parseFloat(this.value)),2)||1;Kt.input.params.minSpeed=Si.toRealTime(1/t),Je.value=B(Kt.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}function Fu(t){const{swingAnalysis:e}=t.difficulty,{minSpeed:i}=Kt.input.params;return e.container.filter(a=>a.maxSpeed>i||a.minSpeed>i).map(a=>a.time).filter((a,o,r)=>!o||a!==r[o-1])}function Hu(t){if(!t.difficulty){console.error("Something went wrong!");return}const{minSpeed:e}=Kt.input.params,i=Fu(t);i.length?Kt.output.html=pt(`Slow slider (>${B(e*1e3,1)}ms)`,i,t.settings.bpm):Kt.output.html=null}const Tl="Inline Sharp Angle",Cl="Check for angle changes within inline note.",Ll=!0,kl=.15;let Di;const Ri=document.createElement("div"),Ze=document.createElement("input"),Za=document.createElement("label"),Be=document.createElement("input"),Ka=document.createElement("label");Za.textContent="max time (ms): ";Za.htmlFor="input__tools-inline-angle-time";Ze.id="input__tools-inline-angle-time";Ze.className="input-toggle input--small";Ze.type="number";Ze.min="0";Ze.value=B(kl*1e3,1).toString();Ze.addEventListener("change",zu);Ka.textContent=" (beat): ";Ka.htmlFor="input__tools-inline-angle-beat";Be.id="input__tools-inline-angle-beat";Be.className="input-toggle input--small";Be.type="number";Be.min="0";Be.step="0.1";Be.addEventListener("change",Yu);Ri.appendChild(ct.create(Tl,Cl,Ll,function(){fe.input.enabled=this.checked}));Ri.appendChild(Za);Ri.appendChild(Ze);Ri.appendChild(Ka);Ri.appendChild(Be);const fe={name:Tl,description:Cl,type:"note",order:{input:dt.NOTES_INLINE_ANGLE,output:ft.NOTES_INLINE_ANGLE},input:{enabled:Ll,params:{maxTime:kl},html:Ri,adjustTime:Xu},output:{html:null},run:ju};function Xu(t){Di=t,Be.value=B(Di.toBeatTime(fe.input.params.maxTime),2).toString()}function zu(){fe.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=B(fe.input.params.maxTime*1e3,1).toString(),Di&&(Be.value=B(Di.toBeatTime(fe.input.params.maxTime),2).toString())}function Yu(){if(!Di){this.value="0";return}let t=B(Math.abs(parseFloat(this.value)),2)||1;fe.input.params.maxTime=Di.toRealTime(t),Ze.value=B(fe.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Uu(t){const{bpm:e}=t.settings,i=t.difficulty.noteContainer,{maxTime:a}=fe.input.params,o=e.toBeatTime(a)+.001,r={},s={},n={},l={[tt.RED]:[],[tt.BLUE]:[]},c=[];let h=0;for(let f=0,p=i.length;f<p;f++){const u=i[f];u.type==="note"&&r[u.data.color]?Mt.next(u,r[u.data.color],e,l[u.data.color])?(n[u.data.color]&&(n[u.data.color]=null,s[u.data.color]=(s[u.data.color]+180)%360),Wr(u.data,i,h,o)&&tn(u.data,s[u.data.color],90,!0)&&c.push(u.data),u.data.direction===F.ANY?n[u.data.color]=u.data:s[u.data.color]=u.data.getAngle(),l[u.data.color]=[]):(n[u.data.color]&&Wr(u.data,i,h,o)&&tn(u.data,s[u.data.color],90,!0)&&(c.push(n[u.data.color]),n[u.data.color]=null),u.data.direction!==F.ANY&&(s[u.data.color]=u.data.getAngle())):u.type==="note"&&(s[u.data.color]=u.data.getAngle()),u.type==="note"&&(r[u.data.color]=u,l[u.data.color].push(u)),u.type==="bomb"&&(u.data.posY===Lt.BOTTOM&&(u.data.posX===rt.MIDDLE_LEFT&&(s[tt.RED]=kt[F.UP],n[tt.RED]=null),u.data.posX===rt.MIDDLE_RIGHT&&(s[tt.BLUE]=kt[F.UP],n[tt.BLUE]=null)),u.data.posY===Lt.TOP&&(u.data.posX===rt.MIDDLE_LEFT&&(s[tt.RED]=kt[F.DOWN],n[tt.RED]=null),u.data.posX===rt.MIDDLE_RIGHT&&(s[tt.BLUE]=kt[F.DOWN],n[tt.BLUE]=null)))}return c.map(f=>f.time).filter(function(f,p,u){return!p||f!==u[p-1]})}function Wr(t,e,i,a){for(let o=i;e[o].data.time<t.time;o++){const r=e[o];if(r.type==="note"&&t.isInline(r.data)&&t.time-e[o].data.time<=a)return!0}return!1}function ju(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Uu(t);e.length?fe.output.html=pt("Inline sharp angle",e,t.settings.bpm):fe.output.html=null}const xl="shrado Angle",Rl="Look for common negative curvature pattern.",Il=!1,Nl=.15,Al=1;let Ti;const $e=document.createElement("div"),pi=document.createElement("input"),Qa=document.createElement("label"),Ke=document.createElement("input"),tr=document.createElement("label"),Me=document.createElement("input"),er=document.createElement("label");Qa.textContent="min distance: ";Qa.htmlFor="input__tools-shrado-angle-distance";pi.id="input__tools-shrado-angle-distance";pi.className="input-toggle input--small";pi.type="number";pi.min="0";pi.value=Al.toString();pi.addEventListener("change",Wu);tr.textContent="max time (ms): ";tr.htmlFor="input__tools-shrado-angle-time";Ke.id="input__tools-shrado-angle-time";Ke.className="input-toggle input--small";Ke.type="number";Ke.min="0";Ke.value=B(Nl*1e3,1).toString();Ke.addEventListener("change",Vu);er.textContent=" (beat): ";er.htmlFor="input__tools-shrado-angle-beat";Me.id="input__tools-shrado-angle-beat";Me.className="input-toggle input--small";Me.type="number";Me.min="0";Me.step="0.1";Me.addEventListener("change",Ju);$e.appendChild(ct.create(xl,Rl,Il,function(){Gt.input.enabled=this.checked}));$e.appendChild(Qa);$e.appendChild(pi);$e.appendChild(document.createElement("br"));$e.appendChild(tr);$e.appendChild(Ke);$e.appendChild(er);$e.appendChild(Me);const Gt={name:xl,description:Rl,type:"note",order:{input:dt.NOTES_SHRADO_ANGLE,output:ft.NOTES_SHRADO_ANGLE},input:{enabled:Il,params:{distance:Al,maxTime:Nl},html:$e,adjustTime:Gu},output:{html:null},run:Zu};function Gu(t){Ti=t,Me.value=B(Ti.toBeatTime(Gt.input.params.maxTime),2).toString()}function Wu(){Gt.input.params.distance=Math.max(parseInt(this.value),0),this.value=Gt.input.params.distance.toString()}function Vu(){Gt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=B(Gt.input.params.maxTime*1e3,1).toString(),Ti&&(Me.value=B(Ti.toBeatTime(Gt.input.params.maxTime),2).toString())}function Ju(){if(!Ti){this.value="0";return}let t=B(Math.abs(parseFloat(this.value)),2)||1;Gt.input.params.maxTime=Ti.toRealTime(t),Ke.value=B(Gt.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function qu(t){var f;const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,{maxTime:a,distance:o}=Gt.input.params,r=e.toBeatTime(a)+.001,s={},n={},l={},c={[tt.RED]:[],[tt.BLUE]:[]},h=[];for(let p=0,u=i.length;p<u;p++){if(i[p].type!=="note")continue;const m=i[p];s[m.data.color]?Mt.next(m,s[m.data.color],e,c[m.data.color])?(l[m.data.color]&&(l[m.data.color]=null,n[m.data.color]=(f=_u[n[m.data.color]])!=null?f:8),m.data.getDistance(s[m.data.color].data)>=o&&Vr(m.data.direction,n[m.data.color],m.data.color)&&m.data.time-s[m.data.color].data.time<=r&&h.push(m),m.data.direction===F.ANY?l[m.data.color]=m:n[m.data.color]=m.data.direction,c[m.data.color]=[]):(l[m.data.color]&&m.data.getDistance(s[m.data.color].data)>=o&&Vr(m.data.direction,n[m.data.color],m.data.color)&&m.data.time-s[m.data.color].data.time<=r&&(h.push(l[m.data.color]),l[m.data.color]=null),m.data.direction!==F.ANY&&(n[m.data.color]=m.data.direction)):n[m.data.color]=m.data.direction,s[m.data.color]=m,c[m.data.color].push(m)}return h.map(p=>p.data.time).filter(function(p,u,m){return!u||p!==m[u-1]})}function Vr(t,e,i){return t===8||e===8?!1:(i===0?e===7:e===6)&&t===0}function Zu(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=qu(t);e.length?Gt.output.html=pt("Shrado angle",e,t.settings.bpm):Gt.output.html=null}const Bl="Speed Pause",$l="Look for stream/burst containing timing gap causing sudden change of pace.",Ml=!1,Ol=.075;let Ci;const Ii=document.createElement("div"),Qe=document.createElement("input"),ir=document.createElement("label"),ti=document.createElement("input"),nr=document.createElement("label");ir.textContent="stream speed (ms): ";ir.htmlFor="input__tools-speed-pause-time";Qe.id="input__tools-speed-pause-time";Qe.className="input-toggle input--small";Qe.type="number";Qe.min="0";Qe.value=B(Ol*1e3,1).toString();Qe.addEventListener("change",Qu);nr.textContent=" (prec): ";nr.htmlFor="input__tools-speed-pause-prec";ti.id="input__tools-speed-pause-prec";ti.className="input-toggle input--small";ti.type="number";ti.min="0";ti.addEventListener("change",th);Ii.appendChild(ct.create(Bl,$l,Ml,function(){me.input.enabled=this.checked}));Ii.appendChild(ir);Ii.appendChild(Qe);Ii.appendChild(nr);Ii.appendChild(ti);const me={name:Bl,description:$l,type:"note",order:{input:dt.NOTES_SPEED_PAUSE,output:ft.NOTES_SPEED_PAUSE},input:{enabled:Ml,params:{maxTime:Ol},html:Ii,adjustTime:Ku},output:{html:null},run:ih};function Ku(t){Ci=t,ti.value=B(1/Ci.toBeatTime(me.input.params.maxTime),2).toString()}function Qu(){me.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=B(me.input.params.maxTime*1e3,1).toString(),Ci&&(ti.value=B(1/Ci.toBeatTime(me.input.params.maxTime),2).toString())}function th(){if(!Ci){this.value="0";return}let t=B(Math.abs(parseFloat(this.value)),2)||1;me.input.params.maxTime=Ci.toRealTime(1/t),Qe.value=B(me.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function eh(t,e){const{bpm:i}=t,{noteContainer:a}=e,{maxTime:o}=me.input.params,r=i.toBeatTime(o)+.001,s={},n={},l={[tt.RED]:!1,[tt.BLUE]:!1},c={[tt.RED]:[],[tt.BLUE]:[]},h=[];for(let f=0,p=a.length;f<p;f++){if(a[f].type!=="note")continue;const u=a[f];s[u.data.color]?Mt.next(u,s[u.data.color],i,c[u.data.color])&&(u.data.time-s[u.data.color].data.time<=r*2?(l[tt.RED]&&l[tt.BLUE]&&s[u.data.color].data.time-n[u.data.color].data.time<=r*3&&h.push(s[u.data.color]),l[u.data.color]=!1):l[u.data.color]||(l[u.data.color]=!0,n[u.data.color]=s[u.data.color]),c[u.data.color]=[],s[u.data.color]=u):s[u.data.color]=u,c[u.data.color].push(u)}return h.map(f=>f.data.time).filter(function(f,p,u){return!p||f!==u[p-1]})}function ih(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=eh(t.settings,t.difficulty);e.length?me.output.html=pt("Speed pause",e,t.settings.bpm):me.output.html=null}const Jr="Hitbox Staircase",qr="Check for overlapping post-swing hitbox with note hitbox during swing.",Zr=!0,On={name:Jr,description:qr,type:"note",order:{input:dt.NOTES_HITBOX_STAIR,output:ft.NOTES_HITBOX_STAIR},input:{enabled:Zr,params:{},html:ct.create(Jr,qr,Zr,function(){On.input.enabled=this.checked})},output:{html:null},run:rh};function nh(t,e,i){for(let a=i,o=e.length;a<o;a++)if(e[a].type==="note"){if(e[a].data.time<t.data.time+.01&&e[a].data.color!==t.data.color)return!0;if(e[a].data.time>t.data.time+.01)return!1}return!1}function ah(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,a=e.toBeatTime(.15),o={},r={},s={},n={[tt.RED]:[],[tt.BLUE]:[]},l={[tt.RED]:Ie.create()[0],[tt.BLUE]:Ie.create({c:1})[0]},c=[];for(let h=0,f=i.length;h<f;h++){if(i[h].type!=="note")continue;const p=i[h];o[p.data.color]?(Mt.next(p,o[p.data.color],e,n[p.data.color])?(s[p.data.color]=p.data.time-o[p.data.color].data.time,p.data.direction!==F.ANY?(l[p.data.color].posX=p.data.posX+He[p.data.direction][0],l[p.data.color].posY=p.data.posY+He[p.data.direction][1]):(l[p.data.color].posX=-1,l[p.data.color].posY=-1),n[p.data.color]=[],r[p.data.color]=p.data.direction):sl(p.data,o[p.data.color].data,r[p.data.color])&&(p.data.direction!==F.ANY?(l[p.data.color].posX=p.data.posX+He[p.data.direction][0],l[p.data.color].posY=p.data.posY+He[p.data.direction][1],r[p.data.color]=p.data.direction):(l[p.data.color].posX=p.data.posX+He[r[p.data.color]][0],l[p.data.color].posY=p.data.posY+He[r[p.data.color]][1])),o[(p.data.color+1)%2]&&p.data.time-o[(p.data.color+1)%2].data.time!==0&&p.data.time-o[(p.data.color+1)%2].data.time<Math.min(a,s[(p.data.color+1)%2])&&p.data.posX===l[(p.data.color+1)%2].posX&&p.data.posY===l[(p.data.color+1)%2].posY&&!nh(p,i,h)&&c.push(p)):(p.data.direction!==F.ANY?(l[p.data.color].posX=p.data.posX+He[p.data.direction][0],l[p.data.color].posY=p.data.posY+He[p.data.direction][1]):(l[p.data.color].posX=-1,l[p.data.color].posY=-1),r[p.data.color]=p.data.direction),o[p.data.color]=p,n[p.data.color].push(p)}return c.map(h=>h.data.time).filter(function(h,f,p){return!f||h!==p[f-1]})}function rh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=ah(t);e.length?On.output.html=pt("Hitbox staircase",e,t.settings.bpm):On.output.html=null}const Kr="Hitbox Reverse Staircase",Qr="Check for overlapping pre-swing hitbox with note hitbox during swing.",to=!0,Pn={name:Kr,description:Qr,type:"note",order:{input:dt.NOTES_HITBOX_REVERSE_STAIR,output:ft.NOTES_HITBOX_REVERSE_STAIR},input:{enabled:to,params:{},html:ct.create(Kr,Qr,to,function(){Pn.input.enabled=this.checked})},output:{html:null},run:ch},oh=.03414823529,sh=.03414823529;function lh(t){const{bpm:e,njs:i}=t.settings,{noteContainer:a}=t.difficulty,o={},r={[tt.RED]:[],[tt.BLUE]:[]},s=[];for(let n=0,l=a.length;n<l;n++){if(a[n].type!=="note")continue;const c=a[n];o[c.data.color]&&Mt.next(c,o[c.data.color],e,r[c.data.color])&&(r[c.data.color]=[]);for(const h of r[(c.data.color+1)%2])if(h.type==="note"&&h.data.direction!==F.ANY){if(!(e.toRealTime(c.data.time)>e.toRealTime(h.data.time)+.01))continue;const f=h.data.getAngle()%90>15&&h.data.getAngle()%90<75;if(i.value<1.425/(60*(c.data.time-h.data.time)/e.value+(f?sh:oh))&&Ia(c.data,h.data,[[15,1.5]])[1]){s.push(h);break}}o[c.data.color]=c,r[c.data.color].push(c)}return s.map(n=>n.data.time).filter(function(n,l,c){return!l||n!==c[l-1]})}function ch(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=lh(t);e.length?Pn.output.html=pt("Hitbox reverse Staircase",e,t.settings.bpm):Pn.output.html=null}const eo="Hitbox Inline",io="Check for overlapping note hitbox for inline note.",no=!0,Fn={name:eo,description:io,type:"note",order:{input:dt.NOTES_HITBOX_INLINE,output:ft.NOTES_HITBOX_INLINE},input:{enabled:no,params:{},html:ct.create(eo,io,no,function(){Fn.input.enabled=this.checked})},output:{html:null},run:dh},uh=0;function hh(t){const{bpm:e,njs:i}=t.settings,{noteContainer:a}=t.difficulty,o={},r={[tt.RED]:[],[tt.BLUE]:[]},s=[];for(let n=0,l=a.length;n<l;n++){if(a[n].type!=="note")continue;const c=a[n];o[c.data.color]&&Mt.next(c,o[c.data.color],e,r[c.data.color])&&(r[c.data.color]=[]);for(const h of r[(c.data.color+1)%2])if(h.type==="note"&&i.value<1.425/(60*(c.data.time-h.data.time)/e.value+uh)&&c.data.isInline(h.data)){s.push(c);break}o[c.data.color]=c,r[c.data.color].push(c)}return s.map(n=>n.data.time).filter(function(n,l,c){return!l||n!==c[l-1]})}function dh(t){const e=hh(t);e.length?Fn.output.html=pt("Hitbox inline",e,t.settings.bpm):Fn.output.html=null}const ao="Hitbox Path",ro="Check for overlapping pre-swing note hitbox at same time.",oo=!0,Hn={name:ao,description:ro,type:"note",order:{input:dt.NOTES_HITBOX_PATH,output:ft.NOTES_HITBOX_PATH},input:{enabled:oo,params:{},html:ct.create(ao,ro,oo,function(){Hn.input.enabled=this.checked})},output:{html:null},run:mh};function fh(t){const{bpm:e}=t.settings,i=t.difficulty.noteContainer.filter(r=>r.type==="bomb"||r.type==="note"),a=[];let o=0;for(let r=0,s=i.length;r<s;r++){const n=i[r];if(!(n.type==="bomb"||n.type==="slider"||n.type==="burstSlider"||e.toRealTime(n.data.time)<o+.01))for(let l=r+1;l<s;l++){const c=i[l];if(e.toRealTime(c.data.time)>e.toRealTime(n.data.time)+.01)break;c.type==="note"&&n.data.color===c.data.color||((n.data.isHorizontal(c.data)||n.data.isVertical(c.data))&&Ia(n.data,c.data,[[45,1],[15,2]]).some(h=>h)||n.data.isDiagonal(c.data)&&Ia(n.data,c.data,[[45,1],[15,1.5]]).some(h=>h))&&(a.push(n.data),o=e.toRealTime(n.data.time))}}return a.map(r=>r.time).filter(function(r,s,n){return!s||r!==n[s-1]})}function mh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=fh(t);e.length?Hn.output.html=pt("Hitbox path",e,t.settings.bpm):Hn.output.html=null}const so="Improper Arc",lo="Check for correct use of arc.",co=!0,Xn={name:so,description:lo,type:"note",order:{input:dt.NOTES_IMPROPER_ARC,output:ft.NOTES_IMPROPER_ARC},input:{enabled:co,params:{},html:ct.create(so,lo,co,function(){Xn.input.enabled=this.checked})},output:{html:null},run:_h};function ph(t){const e=[...t.difficulty.noteContainer].sort((a,o)=>a.type!=="slider"?1:o.type!=="slider"?-1:0).sort((a,o)=>a.data.time-o.data.time),i=[];for(let a=0,o=!0,r=e.length;a<r;a++){const s=e[a];if(s.type==="slider"){o=!0;for(let n=a,l=!1;n<r;n++){const c=e[n];if(c.type==="note"&&s.data.posX===c.data.posX&&s.data.posY===c.data.posY&&c.data.time<=s.data.time+.001&&s.data.color===c.data.color&&(c.data.direction!==F.ANY?s.data.direction===c.data.direction:!0)){for(let h=n;h<r;h++){const f=e[n];if(f.type==="bomb"&&s.data.posX===f.data.posX&&s.data.posY===f.data.posY&&f.data.time<=s.data.time+.001){l=!0;break}if(!(f.type!=="note"||f.data.time<s.data.tailTime)){if(s.data.posX===c.data.posX&&s.data.posY===c.data.posY&&c.data.time<=s.data.time+.001&&(s.data.color!==c.data.color||(c.data.direction!==F.ANY?s.data.direction!==c.data.direction:!0))){l=!0;break}if(c.data.time>s.data.tailTime+.001)break}}o=l||!1;break}if(c.type==="bomb"&&s.data.posX===c.data.posX&&s.data.posY===c.data.posY&&c.data.time<=s.data.time+.001||c.data.time>s.data.time+.001)break}o&&i.push(s)}}return i.map(a=>a.data.time).filter(function(a,o,r){return!o||a!==r[o-1]})}function _h(t){const e=ph(t);e.length?Xn.output.html=pt("Improper arc",e,t.settings.bpm):Xn.output.html=null}const uo="Improper Chain",ho="Check for correct use of chain.",fo=!0,zn={name:uo,description:ho,type:"note",order:{input:dt.NOTES_IMPROPER_CHAIN,output:ft.NOTES_IMPROPER_CHAIN},input:{enabled:fo,params:{},html:ct.create(uo,ho,fo,function(){zn.input.enabled=this.checked})},output:{html:null},run:bh};function gh(t){const e=[...t.difficulty.noteContainer].sort((a,o)=>a.type!=="burstSlider"?1:o.type!=="burstSlider"?-1:0).sort((a,o)=>a.data.time-o.data.time),i=[];for(let a=0,o=!0,r=e.length;a<r;a++){const s=e[a];if(s.type==="burstSlider"){o=!0;for(let n=a;n<r;n++){const l=e[n];if(l.type==="note"&&s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001&&s.data.color===l.data.color&&(l.data.direction!==F.ANY?s.data.direction===l.data.direction:!0)){o=!1;break}if(l.type==="bomb"&&s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001||l.data.time>s.data.time+.001)break}o&&i.push(s)}}return i.map(a=>a.data.time).filter(function(a,o,r){return!o||a!==r[o-1]})}function bh(t){const e=gh(t);e.length?zn.output.html=pt("Improper chain",e,t.settings.bpm):zn.output.html=null}const mo="Improper Window Snap",po="Check for slanted window snap timing.",_o=!0,Yn={name:mo,description:po,type:"note",order:{input:dt.NOTES_IMPROPER_WINDOW,output:ft.NOTES_IMPROPER_WINDOW},input:{enabled:_o,params:{},html:ct.create(mo,po,_o,function(){Yn.input.enabled=this.checked})},output:{html:null},run:vh};function yh(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,a={},o={[tt.RED]:[],[tt.BLUE]:[]},r=[];for(let s=0,n=i.length;s<n;s++){if(i[s].type!=="note")continue;const l=i[s];a[l.data.color]?Mt.next(l,a[l.data.color],e,o[l.data.color])?(a[l.data.color]=l,o[l.data.color]=[]):l.data.isSlantedWindow(a[l.data.color].data)&&l.data.time-a[l.data.color].data.time>=.001&&l.data.direction===a[l.data.color].data.direction&&l.data.direction!==F.ANY&&a[l.data.color].data.direction!==F.ANY&&r.push(a[l.data.color]):a[l.data.color]=l,o[l.data.color].push(l)}return r.map(s=>s.data.time).filter(function(s,n,l){return!n||s!==l[n-1]})}function vh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=yh(t);e.length?Yn.output.html=pt("Improper window snap",e,t.settings.bpm):Yn.output.html=null}const on={create:(t,e,i,a,...o)=>{const r=document.createElement(i);r.className=a;const s=document.createElement("select");s.className="input-toggle",s.id=t,o.forEach(l=>{const c=document.createElement("option");c.textContent=l.text,c.value=l.value,s.append(c)});const n=document.createElement("label");return n.htmlFor=t,n.innerHTML=`<span>${e}</span>`,r.append(n),r.append(s),r}};var Pl=(t=>(t.forehand="backhand",t.backhand="forehand",t))(Pl||{});const fn={[tt.RED]:{forehand:[F.DOWN,F.RIGHT,F.DOWN_LEFT,F.DOWN_RIGHT],backhand:[F.UP,F.LEFT,F.UP_LEFT,F.UP_RIGHT]},[tt.BLUE]:{forehand:[F.DOWN,F.LEFT,F.DOWN_LEFT,F.DOWN_RIGHT],backhand:[F.UP,F.RIGHT,F.UP_LEFT,F.UP_RIGHT]}},oi={[tt.RED]:[0,0,90,90,45,-45,45,-45],[tt.BLUE]:[0,0,-90,-90,-45,45,-45,45]},go={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},Pi=class{constructor(t,e,i,a,o,r){this.color=e,this.warningThreshold=i,this.errorThreshold=a,this.allowedRotation=o,r&&r!=="neutral"?(this.state=r,this.rotation=0):(this.state=this.predictStartState(t,e),this.rotation=this.predictStartRotation(t,e)),this.position=this.predictStartPosition(t,e)}check(t,e){if(this.state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const i=t[0].data.time,a=this.color;let o=this.state,r=this.rotation;e.forEach(c=>{c.data.time-.001>i||(c.data.posY===Lt.BOTTOM&&c.data.posX===(a?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(o="backhand",r=0),c.data.posY===Lt.TOP&&c.data.posX===(a?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(o="forehand",r=0))});let s,n=F.ANY;for(const c of t)c.type==="note"&&(c.data.direction!==F.ANY&&(n=c.data.direction),s&&n===F.ANY&&(n=Fr(c.data,s.data)),s=c);if(n===F.ANY)return"none";const l=go[a][Pl[o]][n];return(r>l?r-l:l-r)>180||l<Pi.CONSTRAINT_ROTATION[a][0]+this.errorThreshold||l>Pi.CONSTRAINT_ROTATION[a][1]-this.errorThreshold?"error":l<Pi.CONSTRAINT_ROTATION[a][0]+this.warningThreshold||l>Pi.CONSTRAINT_ROTATION[a][1]-this.warningThreshold||(r>l?r-l:l-r)>this.allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let s=0;s<t.length;s++){if(t[s].type!=="note")continue;const n=t[s];if(fn[n.data.color].forehand.includes(n.data.direction)){this.state="backhand";break}if(fn[n.data.color].backhand.includes(n.data.direction)){this.state="forehand";break}this.state==="neutral"&&n.data.direction===F.ANY&&(n.data.posY===0&&(this.state="backhand"),n.data.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const i=t[0].data.time,a=this.color;e.forEach(s=>{s.data.time-.001>i||(s.data.posY===Lt.BOTTOM&&s.data.posX===(a?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(this.state="forehand",this.rotation=0),s.data.posY===Lt.TOP&&s.data.posX===(a?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(this.state="backhand",this.rotation=0))});let o,r=F.ANY;for(const s of t)s.type==="note"&&(s.data.direction!==F.ANY&&(r=s.data.direction),o&&r===F.ANY&&(r=Fr(s.data,o.data)),o=s);r!==F.ANY&&(this.rotation=go[this.color][this.state][r])}predictStartState(t,e){let i="neutral";for(let a=0,o=t.length;a<o;a++){if(t[a].type==="bomb"&&(t[a].data.posY===Lt.BOTTOM&&(t[a].data.posX===e?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(i="backhand"),t[a].data.posY===Lt.TOP&&(t[a].data.posX===e?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(i="forehand")),t[a].type!=="note")continue;let r=t[a];if(r.data.color!==Math.abs(e-1)&&r.data.color===e){if(i!=="neutral")break;const s=r.data.time;for(let n=a;n<t.length&&!(t[n].data.time>r.data.time+.001&&s<r.data.time+.001);n++){if(r=t[n],fn[r.data.color].forehand.includes(r.data.direction))return"backhand";if(fn[r.data.color].backhand.includes(r.data.direction))return"forehand";i==="neutral"&&r.data.direction===F.ANY&&(r.data.posY===Lt.BOTTOM&&(i="backhand"),r.data.posY>Lt.BOTTOM&&(i="forehand"))}break}}return i}predictStartRotation(t,e){let i=0;for(let a=0,o=t.length;a<o;a++){if(t[a].type!=="note")continue;let r=t[a];if(r.data.color===e&&r.data.color===e){const s=r.data.time;for(let n=a;n<t.length&&!(t[n].data.time>r.data.time+.001&&s<r.data.time+.001);n++){if(r=t[n],r.data.direction!==F.ANY)return oi[r.data.color][r.data.direction];r.data.direction===F.ANY&&(r.data.posY===Lt.BOTTOM&&(r.data.posX===rt.LEFT&&(i=oi[r.data.color][6]),r.data.posX===rt.RIGHT&&(i=oi[r.data.color][7])),r.data.posY===Lt.MIDDLE&&(r.data.posX===rt.LEFT&&(i=oi[r.data.color][2]),r.data.posX===rt.RIGHT&&(i=oi[r.data.color][3])),r.data.posY===Lt.BOTTOM&&(r.data.posX===rt.LEFT&&(i=oi[r.data.color][4]),r.data.posX===rt.RIGHT&&(i=oi[r.data.color][5])))}break}}return i}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let Na=Pi;Na.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];const Fl="Parity Check",Hl="Perform parity check.",Xl=!1,zl=document.createElement("div");on.create("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});on.create("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});on.create("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});zl.appendChild(ct.create(Fl+" (EXPERIMENTAL)",Hl,Xl,function(){en.input.enabled=this.checked}));const en={name:Fl,description:Hl,type:"note",order:{input:dt.NOTES_PARITY,output:ft.NOTES_PARITY},input:{enabled:Xl,params:{warningThres:90,errorThres:45,allowedRot:90},html:zl},output:{html:null},run:wh};function Eh(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,{warningThres:a,errorThres:o,allowedRot:r}=en.input.params,s={},n={[tt.RED]:[],[tt.BLUE]:[]},l={[tt.RED]:[],[tt.BLUE]:[]},c={[tt.RED]:[],[tt.BLUE]:[]},h={[tt.RED]:new Na(i,0,a,o,r),[tt.BLUE]:new Na(i,1,a,o,r)},f={warning:[],error:[]};for(let p=0,u=i.length;p<u;p++){const m=i[p];if(m.type==="note"&&s[m.data.color]&&Mt.next(m,s[m.data.color],e,n[m.data.color])){switch(h[m.data.color].check(n[m.data.color],c[m.data.color])){case"warning":{f.warning.push(n[m.data.color][0].data.time);break}case"error":{f.error.push(n[m.data.color][0].data.time);break}}h[m.data.color].next(n[m.data.color],c[m.data.color]),c[m.data.color]=l[m.data.color],l[m.data.color]=[],n[m.data.color]=[]}m.type==="bomb"&&(l[tt.RED].push(m),l[tt.BLUE].push(m)),m.type==="note"&&(s[m.data.color]=m,n[m.data.color].push(m))}for(let p=0;p<2;p++)if(s[p])switch(h[p].check(n[p],l[p])){case"warning":{f.warning.push(n[p][0].data.time);break}case"error":{f.error.push(n[p][0].data.time);break}}return f}function wh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Eh(t);e.warning=e.warning.filter(function(a,o,r){return!o||a!==r[o-1]}).sort((a,o)=>a-o),e.error=e.error.filter(function(a,o,r){return!o||a!==r[o-1]}).sort((a,o)=>a-o);const i=[];if(e.warning.length&&i.push(pt("Parity warning",e.warning,t.settings.bpm)),e.error.length&&i.push(pt("Parity error",e.error,t.settings.bpm)),i.length){const a=document.createElement("div");i.forEach(o=>a.append(o)),en.output.html=a}else en.output.html=null}const bo="Double-directional",yo="Check double-directional note swing (this may not mean parity break).",vo=!0,Un={name:bo,description:yo,type:"note",order:{input:dt.NOTES_DOUBLE_DIRECTIONAL,output:ft.NOTES_DOUBLE_DIRECTIONAL},input:{enabled:vo,params:{},html:ct.create(bo,yo,vo,function(){Un.input.enabled=this.checked})},output:{html:null},run:Dh};function Sh(t,e){const{bpm:i}=t,a=e.noteContainer,o={},r={},s={},n={[tt.RED]:[],[tt.BLUE]:[]},l=[];for(let c=0,h=a.length;c<h;c++){const f=a[c];f.type==="note"&&o[f.data.color]?Mt.next(f,o[f.data.color],i,n[f.data.color])?(s[f.data.color]&&(s[f.data.color]=null,r[f.data.color]=(r[f.data.color]+180)%360),tn(f.data,r[f.data.color],45,!0)&&l.push(f.data),f.data.direction===F.ANY?s[f.data.color]=f.data:r[f.data.color]=f.data.getAngle(),n[f.data.color]=[]):(s[f.data.color]&&tn(f.data,r[f.data.color],45,!0)&&(l.push(f.data),s[f.data.color]=null,r[f.data.color]=f.data.getAngle()),f.data.direction!==F.ANY&&(s[f.data.color]=null,r[f.data.color]=f.data.getAngle())):f.type==="note"&&(r[f.data.color]=f.data.getAngle()),f.type==="note"&&(o[f.data.color]=f,n[f.data.color].push(f)),f.type==="bomb"&&(f.data.posY===Lt.BOTTOM&&(f.data.posX===rt.MIDDLE_LEFT&&(r[tt.RED]=kt[F.UP],s[tt.RED]=null),f.data.posX===rt.MIDDLE_RIGHT&&(r[tt.BLUE]=kt[F.UP],s[tt.BLUE]=null)),f.data.posY===Lt.TOP&&(f.data.posX===rt.MIDDLE_LEFT&&(r[tt.RED]=kt[F.DOWN],s[tt.RED]=null),f.data.posX===rt.MIDDLE_RIGHT&&(r[tt.BLUE]=kt[F.DOWN],s[tt.BLUE]=null)))}return l.map(c=>c.time).filter(function(c,h,f){return!h||c!==f[h-1]})}function Dh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Sh(t.settings,t.difficulty);e.length?Un.output.html=pt("Double-directional",e,t.settings.bpm):Un.output.html=null}const Yl="Vision Block",Ul="Check for vision block caused by center note.",jl=!0,Gl=.1,Wl=.5;let Wt;const Eo={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},Ot=document.createElement("div"),_i=document.createElement("input"),ar=document.createElement("label"),ei=document.createElement("input"),rr=document.createElement("label"),ii=document.createElement("input"),or=document.createElement("label"),Oe=document.createElement("input"),sr=document.createElement("label"),Se=document.createElement("input"),lr=document.createElement("label"),_e=document.createElement("input"),cr=document.createElement("label");ar.textContent=" VB time specific ";ar.htmlFor="input__tools-vb-time-check";_i.id="input__tools-vb-time-check";_i.className="input-toggle";_i.type="radio";_i.name="input__tools-vb-spec";_i.value="time";_i.addEventListener("change",Vl);rr.textContent=" VB difficulty specific ";rr.htmlFor="input__tools-vb-diff-check";ei.id="input__tools-vb-diff-check";ei.className="input-toggle";ei.type="radio";ei.checked=!0;ei.name="input__tools-vb-spec";ei.value="difficulty";ei.addEventListener("change",Vl);or.textContent="min time (ms): ";or.htmlFor="input__tools-vb-min-time";ii.id="input__tools-vb-min-time";ii.className="input-toggle input--small";ii.type="number";ii.min="0";ii.value=B(Gl*1e3,1).toString();ii.addEventListener("change",Ch);sr.textContent=" (beat): ";sr.htmlFor="input__tools-vb-min-beat";Oe.id="input__tools-vb-min-beat";Oe.className="input-toggle input--small";Oe.type="number";Oe.min="0";Oe.step="0.1";Oe.addEventListener("change",Lh);lr.textContent="max time (ms): ";lr.htmlFor="input__tools-vb-max-time";Se.id="input__tools-vb-max-time";Se.className="input-toggle input--small";Se.type="number";Se.min="0";Se.value=B(Wl*1e3,1).toString();Se.addEventListener("change",kh);cr.textContent=" (beat): ";cr.htmlFor="input__tools-vb-max-beat";_e.id="input__tools-vb-max-beat";_e.className="input-toggle input--small";_e.type="number";_e.min="0";_e.step="0.1";_e.addEventListener("change",xh);Ot.appendChild(ct.create(Yl,Ul,jl,function(){gt.input.enabled=this.checked}));Ot.appendChild(_i);Ot.appendChild(ar);Ot.appendChild(ei);Ot.appendChild(rr);Ot.appendChild(document.createElement("br"));Ot.appendChild(or);Ot.appendChild(ii);Ot.appendChild(sr);Ot.appendChild(Oe);Ot.appendChild(document.createElement("br"));Ot.appendChild(lr);Ot.appendChild(Se);Ot.appendChild(cr);Ot.appendChild(_e);const gt={name:Yl,description:Ul,type:"note",order:{input:dt.NOTES_VISION_BLOCK,output:ft.NOTES_VISION_BLOCK},input:{enabled:jl,params:{specific:"difficulty",minTime:Gl,maxTime:Wl},html:Ot,adjustTime:Th},output:{html:null},run:Ih};function Th(t){Wt=t,Oe.value=B(Wt.toBeatTime(gt.input.params.minTime),2).toString(),_e.value=B(Wt.toBeatTime(gt.input.params.maxTime),2).toString()}function Vl(){gt.input.params.specific=this.value}function Ch(){gt.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=B(gt.input.params.minTime*1e3,1).toString(),Wt&&(Oe.value=B(Wt.toBeatTime(gt.input.params.minTime),2).toString(),gt.input.params.minTime>gt.input.params.maxTime&&(gt.input.params.maxTime=gt.input.params.minTime,Se.value=B(gt.input.params.maxTime*1e3,1).toString(),_e.value=B(Wt.toBeatTime(gt.input.params.maxTime),2).toString()))}function Lh(){if(!Wt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;gt.input.params.minTime=Wt.toRealTime(t),ii.value=B(gt.input.params.minTime*1e3,1).toString(),this.value=B(t,2).toString(),gt.input.params.minTime>gt.input.params.maxTime&&(gt.input.params.maxTime=gt.input.params.minTime,Se.value=B(gt.input.params.maxTime*1e3,1).toString(),_e.value=B(Wt.toBeatTime(gt.input.params.maxTime),2).toString())}function kh(){gt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=B(gt.input.params.maxTime*1e3,1).toString(),Wt&&(_e.value=B(Wt.toBeatTime(gt.input.params.maxTime),2).toString())}function xh(){if(!Wt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;gt.input.params.maxTime=Wt.toRealTime(t),Se.value=B(gt.input.params.maxTime*1e3,1).toString(),this.value=B(t,2).toString()}function Rh(t){const{bpm:e,njs:i}=t.settings,a=t.difficulty.data.getNoteContainer().filter(p=>p.type!=="slider"),{minTime:o,maxTime:r,specific:s}=gt.input.params,n=s==="time"?e.toBeatTime(o):e.toBeatTime(Eo[t.difficulty.difficulty].min),l=s==="time"?e.toBeatTime(r):Math.min(i.hjd,e.toBeatTime(Eo[t.difficulty.difficulty].max));let c=null,h=null;const f=[];for(let p=0,u=a.length;p<u;p++){const m=a[p];c&&(m.data.time-c.data.time>=n&&m.data.time-c.data.time<=l?m.data.posX<rt.MIDDLE_RIGHT&&f.push(m):m.data.time-c.data.time>l&&(c=null)),h&&(m.data.time-h.data.time>=n&&m.data.time-h.data.time<=l?m.data.posX>rt.MIDDLE_LEFT&&f.push(m):m.data.time-h.data.time>l&&(h=null)),m.data.posY===Lt.MIDDLE&&m.data.posX===rt.MIDDLE_LEFT&&(c=m),m.data.posY===Lt.MIDDLE&&m.data.posX===rt.MIDDLE_RIGHT&&(h=m)}return f.map(p=>p.data.time).filter(function(p,u,m){return!u||p!==m[u-1]})}function Ih(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Rh(t);e.length?gt.output.html=pt("Vision block",e,t.settings.bpm):gt.output.html=null}const wo="Stacked Note",So="Look for stacked note.",Do=!0,jn={name:wo,description:So,type:"note",order:{input:dt.NOTES_STACKED_NOTE,output:ft.NOTES_STACKED_NOTE},input:{enabled:Do,params:{},html:ct.create(wo,So,Do,function(){jn.input.enabled=this.checked})},output:{html:null},run:Bh};function Nh(t,e){const{bpm:i}=t,{colorNotes:a}=e.data,o=[];let r=0;for(let s=0,n=a.length;s<n;s++)if(!(i.toRealTime(a[s].time)<r+.01))for(let l=s+1;l<n&&!(i.toRealTime(a[l].time)>i.toRealTime(a[s].time)+.01);l++)a[l].isInline(a[s])&&(o.push(a[s]),r=i.toRealTime(a[s].time));return o.map(s=>s.time).filter(function(s,n,l){return!n||s!==l[n-1]})}function Ah(t,e){const{bpm:i,njs:a}=t,{bombNotes:o}=e.data,r=[];for(let s=0,n=o.length;s<n;s++)for(let l=s+1;l<n&&!(i.toRealTime(o[l].time)>i.toRealTime(o[s].time)+1);l++)o[s].isInline(o[l])&&(a.value<i.value/(120*(o[l].time-o[s].time))||i.toRealTime(o[l].time)<i.toRealTime(o[s].time)+.02)&&r.push(o[s]);return r.map(s=>s.time).filter(function(s,n,l){return!n||s!==l[n-1]})}function Bh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Nh(t.settings,t.difficulty),i=Ah(t.settings,t.difficulty),a=[];if(e.length&&a.push(pt("Stacked note",e,t.settings.bpm)),i.length&&a.push(pt("Stacked bomb",i,t.settings.bpm)),a.length){const o=document.createElement("div");a.forEach(r=>o.append(r)),jn.output.html=o}else jn.output.html=null}const To="Color Check",Co="Compare note color with other colored note and the arrow on itself.",Lo=!0,ko=[1,1,1],xo={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"};function Ro(t,e){var o;let i=(o=Object.keys(t).find(r=>parseFloat(r)>=e))!=null?o:"100",a=parseFloat(i);return t[a]}const Gn={name:To,description:Co,type:"note",order:{input:dt.NOTES_COLOR_CHECK,output:ft.NOTES_COLOR_CHECK},input:{enabled:Lo,params:{},html:ct.create(To+" (EXPERIMENTAL)",Co,Lo,function(){Gn.input.enabled=this.checked})},output:{html:null},run:Oh};function $h(t){var a,o,r,s,n,l,c,h;const e=(s=(o=(a=t.difficulty)==null?void 0:a.info._customData)==null?void 0:o._colorLeft)!=null?s:he[(r=ue[t.info._environmentName])!=null?r:"The First"]._colorLeft,i=(h=(l=(n=t.difficulty)==null?void 0:n.info._customData)==null?void 0:l._colorRight)!=null?h:he[(c=ue[t.info._environmentName])!=null?c:"The First"]._colorRight;return e&&i?ua(Nn(e),Nn(i)):100}function Mh(t){var r,s,n,l,c,h,f,p;let e=100,i=100;const a=(l=(s=(r=t.difficulty)==null?void 0:r.info._customData)==null?void 0:s._colorLeft)!=null?l:he[(n=ue[t.info._environmentName])!=null?n:"The First"]._colorLeft,o=(p=(h=(c=t.difficulty)==null?void 0:c.info._customData)==null?void 0:h._colorRight)!=null?p:he[(f=ue[t.info._environmentName])!=null?f:"The First"]._colorRight;return a&&(e=ua(ko,Nn(a))),o&&(i=ua(ko,Nn(o))),Math.min(e,i)}function Oh(t){var o,r,s,n;if(!((r=(o=t.difficulty)==null?void 0:o.info._customData)!=null&&r._colorLeft)&&!((n=(s=t.difficulty)==null?void 0:s.info._customData)!=null&&n._colorRight))return;const e=$h(t),i=Mh(t),a=[];if(e<=20&&a.push(mt(`${Ro(xo,e)} note color (dE${B(e,1)})`,"suggest change to better differentiate between 2 note colour")),i<=20&&a.push(mt(`${Ro(xo,i)} arrow note color (dE${B(i,1)})`,"may be difficult to see the arrow")),a.length){const l=document.createElement("div");a.forEach(c=>l.append(c)),Gn.output.html=l}else Gn.output.html=null}const Io=Object.freeze(Object.defineProperty({__proto__:null,effectiveBPM:Yt,acceptablePrec:fi,varySwing:Mn,slowSlider:Kt,inlineAngle:fe,shradoAngle:Gt,speedPause:me,hitboxStair:On,hitboxReverseStair:Pn,hitboxInline:Fn,hitboxPath:Hn,improperArc:Xn,improperChain:zn,improperWindow:Yn,parity:en,doubleDirectional:Un,visionBlock:gt,stackedNote:jn,colorCheck:Gn},Symbol.toStringTag,{value:"Module"})),Ft=class extends Ge{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color),this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||Array.isArray(this.customData.size)||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c;return e.push(new this({b:(a=i.b)!=null?a:Ft.default.b,x:(o=i.x)!=null?o:Ft.default.x,y:(r=i.y)!=null?r:Ft.default.y,d:(s=i.d)!=null?s:Ft.default.d,w:(n=i.w)!=null?n:Ft.default.w,h:(l=i.h)!=null?l:Ft.default.h,customData:(c=i.customData)!=null?c:Ft.default.customData()}))}),e.length?e:[new this({b:Ft.default.b,x:Ft.default.x,y:Ft.default.y,d:Ft.default.d,w:Ft.default.w,h:Ft.default.h,customData:Ft.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.duration,w:this.width,h:this.height,customData:St(this.customData)}}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get duration(){return this.data.d}set duration(t){this.data.d=t}get width(){return this.data.w}set width(t){this.data.w=t}get height(){return this.data.h}set height(t){this.data.h=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}mirror(){var e,i;const t=(i=(e=this.customData.size)==null?void 0:e[0])!=null?i:this.width;return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(a=>{a[0]=-a[0]-(this.posX+t-1)}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(a=>{a[0]=-a[0]-(this.posX+t-1)})),this.posX=pe-1-(this.posX+this.width-1),this}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}isInteractive(){return this.posX<0&&this.width>1-this.posX||this.width>1||this.posX===1||this.posX===2}hasZero(){return this.duration===0||this.width===0||this.height===0}hasNegative(){return this.posY<0||this.duration<0||this.width<0||this.height<0}isLonger(t,e=0){return this.time+this.duration>t.time+t.duration+e}hasMappingExtensions(){return this.posY>2||this.posX<=-1e3||this.posX>=1e3}isValid(){return!this.hasMappingExtensions()&&!this.hasZero()&&!this.hasNegative()}};let Zt=Ft;Zt.default={b:0,x:0,y:0,d:1,w:1,h:1,customData:()=>({})};const No="<15ms Obstacle",Ao=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,Bo=!0,nn={name:No,description:Ao,type:"obstacle",order:{input:dt.OBSTACLES_SHORT,output:ft.OBSTACLES_SHORT},input:{enabled:Bo,params:{minDur:.015},html:ct.create(No,Ao,Bo,function(){nn.input.enabled=this.checked})},output:{html:null},run:Fh};function Ph(t){const{obstacles:e}=t.difficulty.data,{bpm:i}=t.settings,{minDur:a}=nn.input.params,o=i.toBeatTime(a),r=[];let s=Zt.create()[0],n=Zt.create()[0],l=Zt.create()[0],c=Zt.create()[0];return e.forEach(h=>{h.posY===Lt.BOTTOM&&h.height>2&&h.duration>0?h.width>2||h.width>1&&h.posX===1?(h.isLonger(s)&&(h.duration<o&&r.push(h),s=h),h.isLonger(n)&&(h.duration<o&&r.push(h),n=h)):h.width===2?h.posX===rt.LEFT?h.isLonger(s)&&(h.duration<o&&r.push(h),s=h):h.posX===rt.MIDDLE_RIGHT&&h.isLonger(n)&&(h.duration<o&&r.push(h),n=h):h.width===1&&(h.posX===rt.MIDDLE_LEFT?h.isLonger(s)&&(h.duration<o&&r.push(h),s=h):h.posX===rt.MIDDLE_RIGHT&&h.isLonger(n)&&(h.duration<o&&r.push(h),n=h)):h.posY===Lt.TOP&&h.height>2&&h.duration>0&&(h.width>2||h.width>1&&h.posX===rt.MIDDLE_LEFT?(h.isLonger(l)&&(h.duration<o&&h.isLonger(s,o)&&h.isLonger(l,o)&&r.push(h),l=h),h.isLonger(c)&&(h.duration<o&&h.isLonger(n,o)&&h.isLonger(c,o)&&r.push(h),c=h)):h.width===2?h.posX===rt.LEFT?h.isLonger(l)&&(h.duration<o&&h.isLonger(s,o)&&h.isLonger(l,o)&&r.push(h),l=h):h.posX===rt.MIDDLE_RIGHT&&h.isLonger(c)&&(h.duration<o&&h.isLonger(n,o)&&h.isLonger(c,o)&&r.push(h),c=h):h.width===1&&(h.posX===rt.MIDDLE_LEFT?h.isLonger(l)&&(h.duration<o&&h.isLonger(s,o)&&h.isLonger(l,o)&&r.push(h),l=h):h.posX===rt.MIDDLE_RIGHT&&h.isLonger(c)&&(h.duration<o&&h.isLonger(n,o)&&h.isLonger(c,o)&&r.push(h),c=h)))}),r.map(h=>h.time).filter(function(h,f,p){return!f||h!==p[f-1]})}function Fh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Ph(t);e.length?nn.output.html=pt("<15ms obstacle",e,t.settings.bpm):nn.output.html=null}const Jl="2-wide Center Obstacle",ql="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",Zl=!0,Kl=.25;let Li;const Ni=document.createElement("div"),ni=document.createElement("input"),ur=document.createElement("label"),Pe=document.createElement("input"),hr=document.createElement("label");ur.textContent="recovery time (ms): ";ur.htmlFor="input__tools-2wide-wall-time";ni.id="input__tools-2wide-wall-time";ni.className="input-toggle input--small";ni.type="number";ni.min="0";ni.value=B(Kl*1e3,1).toString();ni.addEventListener("change",Xh);hr.textContent=" (beat): ";hr.htmlFor="input__tools-2wide-wall-beat";Pe.id="input__tools-2wide-wall-beat";Pe.className="input-toggle input--small";Pe.type="number";Pe.min="0";Pe.step="0.1";Pe.addEventListener("change",zh);Ni.appendChild(ct.create(Jl,ql,Zl,function(){Qt.input.enabled=this.checked}));Ni.appendChild(ur);Ni.appendChild(ni);Ni.appendChild(hr);Ni.appendChild(Pe);const Qt={name:Jl,description:ql,type:"obstacle",order:{input:dt.OBSTACLES_CENTER,output:ft.OBSTACLES_CENTER},input:{enabled:Zl,params:{recovery:Kl},html:Ni,adjustTime:Hh},output:{html:null},run:Uh};function Hh(t){Li=t,Pe.value=B(Li.toBeatTime(Qt.input.params.recovery),2).toString()}function Xh(){Qt.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=B(Qt.input.params.recovery*1e3,1).toString(),Li&&(Pe.value=B(Li.toBeatTime(Qt.input.params.recovery),2).toString())}function zh(){if(!Li){this.value="0";return}let t=B(Math.abs(parseFloat(this.value)),2)||1;Qt.input.params.recovery=Li.toRealTime(t),ni.value=B(Qt.input.params.recovery*1e3,1).toString(),this.value=t.toString()}function Yh(t){const{obstacles:e}=t.difficulty.data,{bpm:i}=t.settings,{recovery:a}=Qt.input.params,o=[];let r=Zt.create()[0],s=Zt.create()[0];return e.forEach(n=>{n.posY<Lt.TOP&&n.height>1&&(n.width>2&&(o.push(n),n.isLonger(r)&&(r=n),n.isLonger(s)&&(s=n)),n.width===2&&(n.posX===rt.LEFT&&n.isLonger(r)&&(i.toRealTime(n.time)>i.toRealTime(s.time)-a&&i.toRealTime(n.time)<i.toRealTime(s.time+s.duration)+a&&o.push(n),r=n),n.posX===rt.MIDDLE_LEFT&&(o.push(n),n.isLonger(r)&&(r=n),n.isLonger(s)&&(s=n)),n.posX===rt.MIDDLE_RIGHT&&n.isLonger(s)&&(i.toRealTime(n.time)>i.toRealTime(r.time)-a&&i.toRealTime(n.time)<i.toRealTime(r.time+r.duration)+a&&o.push(n),s=n)),n.width===1&&(n.posX===rt.MIDDLE_LEFT&&n.isLonger(r)&&(i.toRealTime(n.time)>i.toRealTime(s.time)-a&&i.toRealTime(n.time)<i.toRealTime(s.time+s.duration)+a&&o.push(n),r=n),n.posX===rt.MIDDLE_RIGHT&&n.isLonger(s)&&(i.toRealTime(n.time)>i.toRealTime(r.time)-a&&i.toRealTime(n.time)<i.toRealTime(r.time+r.duration)+a&&o.push(n),s=n)))}),o.map(n=>n.time).filter(function(n,l,c){return!l||n!==c[l-1]})}function Uh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Yh(t),{recovery:i}=Qt.input.params;e.length?Qt.output.html=pt(`2-wide center obstacle (<${B(i*1e3)}ms)`,e,t.settings.bpm):Qt.output.html=null}const $o="Zero Obstacle",Mo="Look for obstacle with zero value.",Oo=!0,Wn={name:$o,description:Mo,type:"obstacle",order:{input:dt.OBSTACLES_ZERO,output:ft.OBSTACLES_ZERO},input:{enabled:Oo,params:{},html:ct.create($o,Mo,Oo,function(){Wn.input.enabled=this.checked})},output:{html:null},run:Gh};function jh(t){const{obstacles:e}=t.difficulty.data;return e.filter(i=>i.hasZero()).map(i=>i.time)}function Gh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=jh(t);e.length?Wn.output.html=pt("Zero value obstacle",e,t.settings.bpm):Wn.output.html=null}const Po=Object.freeze(Object.defineProperty({__proto__:null,shortObstacle:nn,centerObstacle:Qt,zeroObstacle:Wn},Symbol.toStringTag,{value:"Module"})),Fo="Insufficient Lighting Event",Ho="Check if there is enough light event.",Xo=!0,Vn={name:Fo,description:Ho,type:"event",order:{input:dt.EVENTS_INSUFFICIENT_LIGHT,output:ft.EVENTS_INSUFFICIENT_LIGHT},input:{enabled:Xo,params:{},html:ct.create(Fo,Ho,Xo,function(){Vn.input.enabled=this.checked})},output:{html:null},run:Vh};function Wh(t,e){let i=0;for(let a=t.length-1;a>=0;a--)if(t[a].isLightEvent(e)&&!t[a].isOff()&&(i++,i>10))return!0;return!1}function Vh(t){if(!t.difficulty){console.error("Something went wrong!");return}Wh(t.difficulty.data.basicBeatmapEvents,t.difficulty.characteristic==="360Degree"||t.difficulty.characteristic==="90Degree"?t.info._allDirectionsEnvironmentName:t.info._environmentName)?Vn.output.html=null:Vn.output.html=mt("Insufficient light event")}const zo="Unlit Bomb",Yo="Check for lighting around bomb.",Uo=!0,Jn={name:zo,description:Yo,type:"event",order:{input:dt.EVENTS_UNLIT_BOMB,output:ft.EVENTS_UNLIT_BOMB},input:{enabled:Uo,params:{},html:ct.create(zo,Yo,Uo,function(){Jn.input.enabled=this.checked})},output:{html:null},run:qh},Jh=(t,e,i,a)=>{var f,p,u;if(!e.length)return[];const o=[],r=(p=(f=Ye[a])==null?void 0:f[0])!=null?p:Ye.DefaultEnvironment[0],s=e.filter(m=>m.isLightEvent(a)&&r.includes(m.type)).sort((m,_)=>m.type-_.type),n={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},l={};r.forEach(m=>l[m]=[[0,!1]]);const c=i.toBeatTime(1),h=i.toBeatTime(.25);for(let m=0,_=s.length;m<_;m++){const b=s[m];if((b.isOn()||b.isFlash())&&n[b.type].state!=="on"){n[b.type]={state:"on",time:b.time,fadeTime:0};const y=l[b.type].find(v=>v[0]>=b.time);y?(y[0]=b.time,y[1]=!0):l[b.type].push([b.time,!0])}if(b.isFade()){n[b.type]={state:"off",time:b.time,fadeTime:c};const y=l[b.type].find(v=>v[0]>=b.time);y?(y[0]=b.time,y[1]=!0):l[b.type].push([b.time,!0]),l[b.type].push([b.time+c,!1])}(((u=b==null?void 0:b.floatValue)!=null?u:1)<.25||b.isOff()||b.customData._color&&(typeof b.customData._color[3]=="number"&&b.customData._color[3]<.25||Math.max(b.customData._color[0],b.customData._color[1],b.customData._color[2])<.25))&&n[b.type].state!=="off"&&(n[b.type]={state:"off",time:b.time,fadeTime:n[b.type].state==="on"?h:Math.min(h,n[b.type].fadeTime)},l[b.type].push([b.time+(n[b.type].state==="on"?h:Math.min(h,n[b.type].fadeTime)),!1]))}for(const m in l)l[m].reverse();for(let m=0,_=t.length,b=!1;m<_;m++){const y=t[m];b=!1;for(const v in l){const D=l[v].find(C=>C[0]<=y.time);D&&(b=b||D[1])}b||o.push(y)}return o.map(m=>m.time).filter(function(m,_,b){return!_||m!==b[_-1]})};function qh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Jh(t.difficulty.data.bombNotes,t.difficulty.data.basicBeatmapEvents,t.settings.bpm,t.info._environmentName);e.length?Jn.output.html=pt("Unlit bomb",e,t.settings.bpm):Jn.output.html=null}const jo=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:Vn,unlitBomb:Jn},Symbol.toStringTag,{value:"Module"})),Ql="Hot Start",tc="Check for first interactive object starting from start time.",ec=!0,ic=1.5,ai=document.createElement("input");ai.id="input__tools-hot-start";ai.className="input-toggle input--small";ai.type="number";ai.min="0";ai.step="0.1";ai.value=ic.toString();ai.addEventListener("change",Zh);const nc=ct.create(Ql+" (s): ",tc,ec,function(){hi.input.enabled=this.checked});nc.appendChild(ai);const hi={name:Ql,description:tc,type:"other",order:{input:dt.OTHERS_HOT_START,output:ft.OTHERS_HOT_START},input:{enabled:ec,params:{time:ic},html:nc},output:{html:null},run:Kh};function Zh(){hi.input.params.time=B(Math.abs(parseFloat(this.value)),3),this.value=hi.input.params.time.toString()}function Kh(t){if(!t.difficulty){console.error("Something went wrong!");return}const{time:e}=hi.input.params,i=t.settings.bpm.toRealTime(t.difficulty.data.getFirstInteractiveTime());i<e?hi.output.html=mt("Hot start",`${B(i,2)}s`):hi.output.html=null}const Go="Difficulty Label Check",Wo="For ranking purpose, check difficulty label to fit rankability criteria.",Vo=!0,qn={name:Go,description:Wo,type:"other",order:{input:dt.OTHERS_DIFFICULTY_LABEL,output:ft.OTHERS_DIFFICULTY_LABEL},input:{enabled:Vo,params:{},html:ct.create(Go,Wo,Vo,function(){qn.input.enabled=this.checked})},output:{html:null},run:Qh};function Qh(t){var i;if(!t.difficulty){console.error("Something went wrong!");return}const e=(i=t.difficulty.info._customData)==null?void 0:i._difficultyLabel;e&&e.length>30?qn.output.html=mt(`Difficulty label is too long (${e.length} characters)`,"exceeded 30 max characters by ranking criteria"):qn.output.html=null}var dr=(t=>(t.Standard="Standard",t.NoArrows="No Arrows",t.OneSaber="One Saber",t["360Degree"]="360 Degree",t["90Degree"]="90 Degree",t.Lightshow="Lightshow",t.Lawless="Lawless",t))(dr||{}),Aa=(t=>(t[t.Standard=0]="Standard",t[t.NoArrows=1]="NoArrows",t[t.OneSaber=2]="OneSaber",t[t["360Degree"]=3]="360Degree",t[t["90Degree"]=4]="90Degree",t[t.Lightshow=5]="Lightshow",t[t.Lawless=6]="Lawless",t))(Aa||{});const yi=class{constructor(t,e=10,i=0){this._bpm=t,this._njs=e,this._sdm=i,this.update()}static create(t,e=10,i=0){return new yi(typeof t=="number"?Ae.create(t):t,e,i)}get value(){return this._njs}set value(t){this._njs=t,this.update()}get offset(){return this._sdm}set offset(t){this._sdm=t,this.update()}get hjd(){return this._hjd}get hjdMin(){return yi.HJD_MIN}get reactTime(){return this._reactionTime}get jd(){return this._jd}get jdMin(){return this._jdMin}update(){this._hjd=this.calcHJD(),this._jd=this.calcJD(),this._jdMin=this.calcJD(yi.HJD_MIN),this._reactionTime=this.calcRTFromHJD()}calcHJDRaw(){const e=this._njs*this._njs/this._njs,i=60/this._bpm.value;let a=yi.HJD_START;for(;e*i*a>17.999;)a/=2;return a<1&&(a=1),a}calcHJD(t=this.offset){return Math.max(this.calcHJDRaw()+t,yi.HJD_MIN)}calcHJDFromJD(t=this.calcJD()){return t/(60/this._bpm.value*this._njs*2)}calcHJDFromRT(t=this.calcRTFromHJD()){return t/(60/this._bpm.value)}calcJD(t=this.calcHJD()){return this._njs*(60/this._bpm.value)*t*2}calcJDOptimalHigh(){return 18*(1/1.07)**this._njs+18}calcJDOptimalLow(){return-(18/(this._njs+1))+18}calcRTFromJD(t=this.calcJD()){return t/(2*this._njs)}calcRTFromHJD(t=this.calcHJD()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let we=yi;we.HJD_START=4;we.HJD_MIN=.25;we.FallbackNJS={ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10};function td(t,e){const i=Jo(t),a=Jo(e);for(const o in i){if(i[o]<a[o])return"old";if(i[o]>a[o])return"new"}return"current"}function Jo(t){return t.replace("v","").split(".").map(e=>parseInt(e))}class ia extends Vt{get time(){return this.data._time}set time(e){this.data._time=e}get customData(){return this.data._customData}set customData(e){this.data._customData=e}setTime(e){return this.time=e,this}setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return this.customData&&delete this.customData[e],this}addCustomData(e){return this.customData={...this.customData,object:e},this}func(e){return e(this),this}}const Ut=class extends ia{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l;return e.push(new this({_time:(a=i._time)!=null?a:Ut.default._time,_lineIndex:(o=i._lineIndex)!=null?o:Ut.default._lineIndex,_lineLayer:(r=i._lineLayer)!=null?r:Ut.default._lineLayer,_type:(s=i._type)!=null?s:Ut.default._type,_cutDirection:(n=i._cutDirection)!=null?n:Ut.default._cutDirection,_customData:(l=i._customData)!=null?l:Ut.default._customData()}))}),e.length?e:[new this({_time:Ut.default._time,_lineIndex:Ut.default._lineIndex,_lineLayer:Ut.default._lineLayer,_type:Ut.default._type,_cutDirection:Ut.default._cutDirection,_customData:Ut.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_cutDirection:this.direction,_customData:St(this.customData)}}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get direction(){return this.data._cutDirection}set direction(t){this.data._cutDirection=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setType(t){return this.type=t,this}setCutDirection(t){return this.direction=t,this}isNote(){return this.type===0||this.type===1}isBomb(){return this.type===3}getPosition(){return this.customData._position?[this.customData._position[0],this.customData._position[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}getAngle(){return this.customData._cutDirection?this.customData._cutDirection>0?this.customData._cutDirection%360:360+this.customData._cutDirection%360:this.direction>=1e3?Math.abs(this.direction%1e3%360-360):kt[this.direction]||0}getDistance(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition();return Math.sqrt(Math.pow(a-e,2)+Math.pow(o-i,2))}isVertical(t){const[e]=this.getPosition(),[i]=t.getPosition(),a=e-i;return a>-.001&&a<.001}isHorizontal(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition(),r=i-o;return r>-.001&&r<.001}isDiagonal(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition(),r=Math.abs(e-a),s=Math.abs(i-o);return r===s}isInline(t,e=.5){return this.getDistance(t)<=e}isDouble(t,e){for(let i=e,a=t.length;i<a;i++){if(t[i].time<this.time+.01&&t[i].type!==this.type)return!0;if(t[i].time>this.time+.01)return!1}return!1}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t){return this.getDistance(t)>1.8}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}hasChroma(){return Array.isArray(this.customData._color)||typeof this.customData._disableSpawnEffect=="boolean"}hasNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._cutDirection=="number"||typeof this.customData._disableNoteGravity=="boolean"||typeof this.customData._disableNoteLook=="boolean"||typeof this.customData._fake=="boolean"||Array.isArray(this.customData._flip)||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||typeof this.customData._track=="string"}hasMappingExtensions(){return this.direction>=1e3||this.posX>3||this.posX<0||this.posY>2||this.posY<0}isValidDirection(){return this.direction>=0&&this.direction<=8}isValid(){return!this.hasMappingExtensions()&&this.isValidDirection()}};let En=Ut;En.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0,_customData:()=>({})};const Et=class extends Vt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c,h,f,p,u,m,_,b;return e.push(new this({_colorType:(a=i._colorType)!=null?a:Et.default._colorType,_headTime:(r=(o=i._headTime)!=null?o:i._tailTime)!=null?r:Et.default._headTime,_headLineIndex:(s=i._headLineIndex)!=null?s:Et.default._headLineIndex,_headLineLayer:(n=i._headLineLayer)!=null?n:Et.default._headLineLayer,_headCutDirection:(l=i._headCutDirection)!=null?l:Et.default._headCutDirection,_headControlPointLengthMultiplier:(c=i._headControlPointLengthMultiplier)!=null?c:Et.default._headControlPointLengthMultiplier,_tailTime:(f=(h=i._tailTime)!=null?h:i._headTime)!=null?f:Et.default._tailTime,_tailLineIndex:(p=i._tailLineIndex)!=null?p:Et.default._tailLineIndex,_tailLineLayer:(u=i._tailLineLayer)!=null?u:Et.default._tailLineLayer,_tailCutDirection:(m=i._tailCutDirection)!=null?m:Et.default._tailCutDirection,_tailControlPointLengthMultiplier:(_=i._tailControlPointLengthMultiplier)!=null?_:Et.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:(b=i._sliderMidAnchorMode)!=null?b:Et.default._sliderMidAnchorMode}))}),e.length?e:[new this({_colorType:Et.default._colorType,_headTime:Et.default._headTime,_headLineIndex:Et.default._headLineIndex,_headLineLayer:Et.default._headLineLayer,_headCutDirection:Et.default._headCutDirection,_headControlPointLengthMultiplier:Et.default._headControlPointLengthMultiplier,_tailTime:Et.default._tailTime,_tailLineIndex:Et.default._tailLineIndex,_tailLineLayer:Et.default._tailLineLayer,_tailCutDirection:Et.default._tailCutDirection,_tailControlPointLengthMultiplier:Et.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:Et.default._sliderMidAnchorMode})]}toJSON(){return{_colorType:this.colorType,_headTime:this.headTime,_headLineIndex:this.headPosX,_headLineLayer:this.headPosY,_headCutDirection:this.headDirection,_headControlPointLengthMultiplier:this.headLengthMultiplier,_tailTime:this.tailTime,_tailLineIndex:this.tailPosX,_tailLineLayer:this.tailPosY,_tailCutDirection:this.tailDirection,_tailControlPointLengthMultiplier:this.tailLengthMultiplier,_sliderMidAnchorMode:this.midAnchor}}get colorType(){return this.data._colorType}set colorType(t){this.data._colorType=t}get headTime(){return this.data._headTime}set headTime(t){this.data._headTime=t}get headPosX(){return this.data._headLineIndex}set headPosX(t){this.data._headLineIndex=t}get headPosY(){return this.data._headLineLayer}set headPosY(t){this.data._headLineLayer=t}get headDirection(){return this.data._headCutDirection}set headDirection(t){this.data._headCutDirection=t}get headLengthMultiplier(){return this.data._headControlPointLengthMultiplier}set headLengthMultiplier(t){this.data._headControlPointLengthMultiplier=t}get tailTime(){return this.data._tailTime}set tailTime(t){this.data._tailTime=t}get tailPosX(){return this.data._tailLineIndex}set tailPosX(t){this.data._tailLineIndex=t}get tailPosY(){return this.data._tailLineLayer}set tailPosY(t){this.data._tailLineLayer=t}get tailDirection(){return this.data._tailCutDirection}set tailDirection(t){this.data._tailCutDirection=t}get tailLengthMultiplier(){return this.data._tailControlPointLengthMultiplier}set tailLengthMultiplier(t){this.data._tailControlPointLengthMultiplier=t}get midAnchor(){return this.data._sliderMidAnchorMode}set midAnchor(t){this.data._sliderMidAnchorMode=t}setColor(t){return this.colorType=t,this}setPosX(t){return this.headPosX=t,this}setPosY(t){return this.headPosY=t,this}setDirection(t){return this.headDirection=t,this}setLengthMultiplier(t){return this.headLengthMultiplier=t,this}setTailTime(t){return this.tailTime=t,this}setTailPosX(t){return this.tailPosX=t,this}setTailPosY(t){return this.tailPosY=t,this}setTailDirection(t){return this.tailDirection=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0){switch(this.headPosX=pe-1-this.headPosX,this.tailPosX=pe-1-this.tailPosX,t&&(this.colorType=(1+this.colorType)%2),this.headDirection){case 2:this.headDirection=3;break;case 3:this.headDirection=2;break;case 6:this.headDirection=7;break;case 7:this.headDirection=6;break;case 4:this.headDirection=5;break;case 5:this.headDirection=4;break}switch(this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),this}hasMappingExtensions(){return this.headPosY>2||this.headPosY<0||this.headPosX<=-1e3||this.headPosX>=1e3||this.headDirection>=1e3&&this.headDirection<=1360||this.tailDirection>=1e3&&this.tailDirection<=1360}};let wn=Et;wn.default={_colorType:0,_headTime:0,_headLineIndex:0,_headLineLayer:0,_headCutDirection:0,_headControlPointLengthMultiplier:1,_tailTime:0,_tailLineIndex:0,_tailLineLayer:0,_tailCutDirection:0,_tailControlPointLengthMultiplier:1,_sliderMidAnchorMode:0};const Bt=class extends ia{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c,h;return e.push(new this({_time:(a=i._time)!=null?a:Bt.default._time,_type:(o=i._type)!=null?o:Bt.default._type,_lineIndex:(r=i._lineIndex)!=null?r:Bt.default._lineIndex,_lineLayer:(s=i._lineLayer)!=null?s:Bt.default._lineLayer,_duration:(n=i._duration)!=null?n:Bt.default._duration,_width:(l=i._width)!=null?l:Bt.default._width,_height:(c=i._height)!=null?c:Bt.default._height,_customData:(h=i._customData)!=null?h:Bt.default._customData()}))}),e.length?e:[new this({_time:Bt.default._time,_type:Bt.default._type,_lineIndex:Bt.default._lineIndex,_lineLayer:Bt.default._lineLayer,_duration:Bt.default._duration,_width:Bt.default._width,_height:Bt.default._height,_customData:Bt.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_duration:this.duration,_width:this.width,_height:this.height,_customData:St(this.customData)}}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get duration(){return this.data._duration}set duration(t){this.data._duration=t}get width(){return this.data._width}set width(t){this.data._width=t}get height(){return this.data._height}set height(t){this.data._height=t}setType(t){return this.type=t,this}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}getPosition(){return this.customData._position?[this.customData._position[0],this.customData._position[1]]:[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.type<=-1e3?this.type/1e3:this.type>=1e3?this.type/1e3:this.type]}isInteractive(){return this.width>=2||this.posX===1||this.posX===2}isCrouch(){return this.type===1&&(this.width>2||this.width===2&&this.posX===1)}isZero(){return this.duration===0||this.width===0}isLonger(t,e,i=0){return t._time+t._duration>e._time+e._duration+i}hasChroma(){return Array.isArray(this.customData._color)}hasNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._fake=="boolean"||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||Array.isArray(this.customData._scale)||typeof this.customData._track=="string"}hasMappingExtensions(){return this.width>=1e3||this.type>=1e3||this.posX>3||this.posX<0}isValid(){return!this.hasMappingExtensions()&&this.width>0&&this.width<=4}};let Sn=Bt;Sn.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_duration:1,_width:1,_height:1,_customData:()=>({})};const re=class extends ia{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n;return e.push(new this({_time:(a=i._time)!=null?a:re.default._time,_type:(o=i._type)!=null?o:re.default._type,_value:(r=i._value)!=null?r:re.default._value,_floatValue:(s=i._floatValue)!=null?s:re.default._floatValue,_customData:(n=i._customData)!=null?n:re.default._customData()}))}),e.length?e:[new this({_time:re.default._time,_type:re.default._type,_value:re.default._value,_floatValue:re.default._floatValue,_customData:re.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_value:this.value,_floatValue:this.floatValue,_customData:St(this.customData)}}get type(){return this.data._type}set type(t){this.data._type=t}get value(){return this.data._value}set value(t){this.data._value=t}get floatValue(){return this.data._floatValue}set floatValue(t){this.data._floatValue=t}setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}isOff(){return this.value===0}isOn(){return this.value===1||this.value===5||this.value===9}isFlash(){return this.value===2||this.value===6||this.value===10}isFade(){return this.value===3||this.value===7||this.value===11}isTransition(){return this.value===4||this.value===8||this.value===12}isRed(){return this.value===5||this.value===6||this.value===7||this.value===8}isBlue(){return this.value===1||this.value===2||this.value===3||this.value===4}isWhite(){return this.value===9||this.value===10||this.value===11||this.value===12}isValidType(){return this.type>=0&&this.type<=19||this.type===100}isLightEvent(t){switch(t){case"LizzoEnvironment":return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===8||this.type===9||this.type===10||this.type===11||this.type===12;default:return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}}isColorBoost(){return this.type===5}isRingEvent(t){switch(t){case"LizzoEnvironment":return!1;default:return this.type===8||this.type===9}}isLaserRotationEvent(t){switch(t){case"LizzoEnvironment":return!1;default:return this.type===12||this.type===13}}isLaneRotationEvent(t){return this.type===14||this.type===15}isExtraEvent(t){return this.type===16||this.type===17||this.type===18||this.type===19}isSpecialEvent(t){return this.type===40||this.type===41||this.type===42||this.type===43}isBPMChangeEvent(){return this.type===100}isLightingEvent(){return this.isLightEvent()||this.isRingEvent()||this.isLaserRotationEvent()||this.isExtraEvent()}hasChroma(){return this.isLightEvent()?Array.isArray(this.customData._color)||typeof this.customData._lightID=="number"||Array.isArray(this.customData._lightID)||typeof this.customData._propID=="number"||typeof this.customData._lightGradient=="object"||typeof this.customData._easing=="string"||typeof this.customData._lerpType=="string":this.isRingEvent()?typeof this.customData._nameFilter=="string"||typeof this.customData._reset=="boolean"||typeof this.customData._rotation=="number"||typeof this.customData._step=="number"||typeof this.customData._prop=="number"||typeof this.customData._speed=="number"||typeof this.customData._direction=="number"||typeof this.customData._counterSpin=="boolean"||typeof this.customData._stepMult=="number"||typeof this.customData._propMult=="number"||typeof this.customData._speedMult=="number":this.isLaserRotationEvent()?typeof this.customData._lockPosition=="boolean"||typeof this.customData._speed=="number"||typeof this.customData._preciseSpeed=="number"||typeof this.customData._direction=="number":!1}hasOldChroma(){return this.value>=2e9}hasNoodleExtensions(){return this.isLaneRotationEvent()&&typeof this.customData._rotation=="number"}hasMappingExtensions(){return this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720}isValid(){return this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.hasOldChroma())}};let Dn=re;Dn.default={_time:0,_type:0,_value:0,_floatValue:1,_customData:()=>({})};const oe=class extends ia{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n;return e.push(new this({_time:(a=i._time)!=null?a:oe.default._time,_lineIndex:(o=i._lineIndex)!=null?o:oe.default._lineIndex,_lineLayer:(r=i._lineLayer)!=null?r:oe.default._lineLayer,_offsetDirection:(s=i._offsetDirection)!=null?s:oe.default._offsetDirection,_customData:(n=i._customData)!=null?n:oe.default._customData()}))}),e.length?e:[new this({_time:oe.default._time,_lineIndex:oe.default._lineIndex,_lineLayer:oe.default._lineLayer,_offsetDirection:oe.default._offsetDirection,_customData:oe.default._customData()})]}toJSON(){return{_time:this.time,_lineIndex:this.posX,_lineLayer:this.posY,_offsetDirection:this.direction,_customData:St(this.customData)}}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get direction(){return this.data._offsetDirection}set direction(t){this.data._offsetDirection=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDirection(t){return this.direction=t,this}mirror(){switch(this.posX=pe-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}};let Tn=oe;Tn.default={_time:0,_lineIndex:0,_lineLayer:0,_offsetDirection:1,_customData:()=>({})};const Fi=class extends Vt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o;return e.push(new this({_keyword:(a=i._keyword)!=null?a:Fi.default._keyword,_specialEvents:(o=i._specialEvents)!=null?o:Fi.default._specialEvents()}))}),e.length?e:[new this({_keyword:Fi.default._keyword,_specialEvents:Fi.default._specialEvents()})]}toJSON(){return{_keyword:this.keyword,_specialEvents:this.events}}get keyword(){return this.data._keyword}set keyword(t){this.data._keyword=t}get events(){return this.data._specialEvents}set events(t){this.data._specialEvents=t}setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const e=this.events.indexOf(t,0);return e>-1&&this.events.splice(e,1),this}};let Ba=Fi;Ba.default={_keyword:"",_specialEvents:()=>[]};const ac=class extends Vt{constructor(t){super(t),this.keywords=t._keywords.map(e=>Ba.create({_keyword:e._keyword,_specialEvents:e._specialEvents})[0])}static create(t={}){var e;return new this({_keywords:(e=t._keywords)!=null?e:ac.default._keywords()})}toJSON(){return{_keywords:this.keywords.map(t=>t.toJSON())}}setKeyword(t){return this.keywords=t,this}addKeyword(t){return this.keywords.push(Ba.create(t)[0]),this}removeKeyword(t){return this.keywords=this.keywords.filter(e=>e.keyword!==t),this}};let rc=ac;rc.default={_keywords:()=>[]};class ed extends Vt{constructor(e){super(e),this._fileName="UnnamedDifficulty.dat",this.version="2.6.0",this.notes=e._notes.map(i=>En.create(i)[0]),this.sliders=e._sliders.map(i=>wn.create(i)[0]),this.obstacles=e._obstacles.map(i=>Sn.create(i)[0]),this.events=e._events.map(i=>Dn.create(i)[0]),this.waypoints=e._waypoints.map(i=>Tn.create(i)[0]),this.specialEventsKeywordFilters=rc.create(e._specialEventsKeywordFilters),this.customData=e._customData}static create(e={}){var i,a,o,r,s,n,l;return new this({_version:"2.6.0",_notes:(i=e._notes)!=null?i:[],_sliders:(a=e._sliders)!=null?a:[],_obstacles:(o=e._obstacles)!=null?o:[],_events:(r=e._events)!=null?r:[],_waypoints:(s=e._waypoints)!=null?s:[],_specialEventsKeywordFilters:(n=e._specialEventsKeywordFilters)!=null?n:{_keywords:[]},_customData:(l=e._customData)!=null?l:{}})}toJSON(){return{_version:"2.6.0",_notes:this.notes.map(e=>e.toJSON()),_sliders:this.sliders.map(e=>e.toJSON()),_obstacles:this.obstacles.map(e=>e.toJSON()),_events:this.events.map(e=>e.toJSON()),_waypoints:this.waypoints.map(e=>e.toJSON()),_specialEventsKeywordFilters:this.specialEventsKeywordFilters.toJSON(),_customData:St(this.customData)}}clone(){const e=this.fileName;return super.clone().setFileName(e)}set fileName(e){this._fileName=e.trim()}get fileName(){return this._fileName}setFileName(e){return this.fileName=e,this}getFirstInteractiveTime(){let e=Number.MAX_VALUE;this.notes.length>0&&(e=this.notes[0].time);const i=this.findFirstInteractiveObstacleTime();return Math.min(e,i)}getLastInteractiveTime(){let e=0;this.notes.length>0&&(e=this.notes[this.notes.length-1].time);const i=this.findLastInteractiveObstacleTime();return Math.max(e,i)}findFirstInteractiveObstacleTime(){for(let e=0,i=this.obstacles.length;e<i;e++)if(this.obstacles[e].isInteractive())return this.obstacles[e].time;return Number.MAX_VALUE}findLastInteractiveObstacleTime(){let e=0;for(let i=this.obstacles.length-1;i>=0;i--)this.obstacles[i].isInteractive()&&(e=Math.max(e,this.obstacles[i].time+this.obstacles[i].duration));return e}addNotes(...e){this.notes.push(...e.map(i=>i instanceof En?i:En.create(i)[0]))}addObstacles(...e){this.obstacles.push(...e.map(i=>i instanceof Sn?i:Sn.create(i)[0]))}addEvents(...e){this.events.push(...e.map(i=>i instanceof Dn?i:Dn.create(i)[0]))}addWaypoints(...e){this.waypoints.push(...e.map(i=>i instanceof Tn?i:Tn.create(i)[0]))}addSliders(...e){this.sliders.push(...e.map(i=>i instanceof wn?i:wn.create(i)[0]))}}const se=class extends Ge{constructor(t){super(t),this.hasChroma=()=>this.isLightEvent()?Array.isArray(this.customData.color)||typeof this.customData.lightID=="number"||Array.isArray(this.customData.lightID)||typeof this.customData.easing=="string"||typeof this.customData.lerpType=="string":this.isRingEvent()?typeof this.customData.nameFilter=="string"||typeof this.customData.rotation=="number"||typeof this.customData.step=="number"||typeof this.customData.prop=="number"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":this.isLaserRotationEvent()?typeof this.customData.lockRotation=="boolean"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":!1}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n;return e.push(new this({b:(a=i.b)!=null?a:se.default.b,et:(o=i.et)!=null?o:se.default.et,i:(r=i.i)!=null?r:se.default.i,f:(s=i.f)!=null?s:se.default.f,customData:(n=i.customData)!=null?n:se.default.customData()}))}),e.length?e:[new this({b:se.default.b,et:se.default.et,i:se.default.i,f:se.default.f,customData:se.default.customData()})]}toJSON(){return{b:this.time,et:this.type,i:this.value,f:this.floatValue,customData:St(this.customData)}}get type(){return this.data.et}set type(t){this.data.et=t}get value(){return this.data.i}set value(t){this.data.i=t}get floatValue(){return this.data.f}set floatValue(t){this.data.f=t}setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}isOff(){return this.value===0}isOn(){return this.value===1||this.value===5||this.value===9}isFlash(){return this.value===2||this.value===6||this.value===10}isFade(){return this.value===3||this.value===7||this.value===11}isRed(){return this.value===5||this.value===6||this.value===7||this.value===8}isBlue(){return this.value===1||this.value===2||this.value===3||this.value===4}isWhite(){return this.value===9||this.value===10||this.value===11||this.value===12}isTransition(){return this.value===4||this.value===8||this.value===12}isValidType(){return this.type>=0&&this.type<=19||this.type===100}isLightEvent(t){switch(t){case"LizzoEnvironment":return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===8||this.type===9||this.type===10||this.type===11||this.type===12;default:return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}}isColorBoost(){return this.type===5}isRingEvent(t){switch(t){case"LizzoEnvironment":return!1;default:return this.type===8||this.type===9}}isLaserRotationEvent(t){switch(t){case"LizzoEnvironment":return!1;default:return this.type===12||this.type===13}}isLaneRotationEvent(t){return this.type===14||this.type===15}isExtraEvent(t){return this.type===16||this.type===17||this.type===18||this.type===19}isSpecialEvent(t){return this.type===40||this.type===41||this.type===42||this.type===43}isBPMChangeEvent(){return this.type===100}isLightingEvent(){return this.isLightEvent()||this.isRingEvent()||this.isLaserRotationEvent()||this.isExtraEvent()}hasOldChroma(){return this.value>=2e9}isValid(){return this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.hasOldChroma())}};let Ui=se;Ui.default={b:0,et:0,i:0,f:1,customData:()=>({})};const Hi=class extends Vt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o;return e.push(new this({k:(a=i.k)!=null?a:Hi.default.k,e:(o=i.e)!=null?o:Hi.default.e()}))}),e.length?e:[new this({k:Hi.default.k,e:Hi.default.e()})]}toJSON(){return{k:this.keyword,e:this.events}}get keyword(){return this.data.k}set keyword(t){this.data.k=t}get events(){return this.data.e}set events(t){this.data.e=t}setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const e=this.events.indexOf(t,0);return e>-1&&this.events.splice(e,1),this}};let $a=Hi;$a.default={k:"",e:()=>[]};const oc=class extends Vt{constructor(t){super(t),this.d=t.d.map(e=>$a.create({e:e.e,k:e.k})[0])}static create(t={}){var e;return new this({d:(e=t.d)!=null?e:oc.default.d()})}toJSON(){return{d:this.list.map(t=>t.toJSON())}}get list(){return this.d}set list(t){this.d=t}setData(t){return this.list=t,this}addData(t){return this.list.push($a.create(t)[0]),this}removeData(t){return this.list=this.list.filter(e=>e.keyword!==t),this}};let fr=oc;fr.default={d:()=>[]};const Te=class extends Ya{constructor(t){super(t),this.hasChroma=()=>Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean",this.hasNoodleExtensions=()=>Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.track=="string"}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s;return e.push(new this({b:(a=i.b)!=null?a:Te.default.b,x:(o=i.x)!=null?o:Te.default.x,y:(r=i.y)!=null?r:Te.default.y,customData:(s=i.customData)!=null?s:Te.default.customData()}))}),e.length?e:[new this({b:Te.default.b,x:Te.default.x,y:Te.default.y,customData:Te.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,customData:St(this.customData)}}mirror(){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(t=>{t[0]=-t[0]}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(t=>{t[0]=-t[0]})),this.posX=pe-1-this.posX,this}getDistance(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition();return Math.sqrt(Math.pow(a-e,2)+Math.pow(o-i,2))}isVertical(t){const[e]=this.getPosition(),[i]=t.getPosition(),a=e-i;return a>-.001&&a<.001}isHorizontal(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition(),r=i-o;return r>-.001&&r<.001}isDiagonal(t){const[e,i]=this.getPosition(),[a,o]=t.getPosition(),r=Math.abs(e-a),s=Math.abs(i-o);return r===s}isInline(t,e=.5){return this.getDistance(t)<=e}isAdjacent(t){const e=this.getDistance(t);return e>.499&&e<1.001}isWindow(t,e=1.8){return this.getDistance(t)>e}isSlantedWindow(t){return this.isWindow(t)&&!this.isDiagonal(t)&&!this.isHorizontal(t)&&!this.isVertical(t)}hasMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0}isValid(){return!this.hasMappingExtensions()}};let Ei=Te;Ei.default={b:0,x:0,y:0,customData:()=>({})};const li=class extends Ge{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r;return e.push(new this({b:(a=i.b)!=null?a:li.default.b,m:(o=i.m)!=null?o:li.default.m,customData:(r=i.customData)!=null?r:li.default.customData()}))}),e.length?e:[new this({b:li.default.b,m:li.default.m,customData:li.default.customData()})]}toJSON(){return{b:this.time,m:this.bpm,customData:St(this.customData)}}get bpm(){return this.data.m}set bpm(t){this.data.m=t}setBPM(t){return this.bpm=t,this}};let ji=li;ji.default={b:0,m:0,customData:()=>({})};class sc extends Ya{constructor(){super(...arguments),this.hasChroma=()=>!1,this.hasNoodleExtensions=()=>!1}get color(){return this.data.c}set color(e){this.data.c=e}get direction(){return this.data.d}set direction(e){this.data.d=e}get tailTime(){return this.data.tb}set tailTime(e){this.data.tb=e}get tailPosX(){return this.data.tx}set tailPosX(e){this.data.tx=e}get tailPosY(){return this.data.ty}set tailPosY(e){this.data.ty=e}setColor(e){return this.color=e,this}setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}setDirection(e){return this.direction=e,this}setTailTime(e){return this.tailTime=e,this}setTailPosX(e){return this.tailPosX=e,this}setTailPosY(e){return this.tailPosY=e,this}getTailPosition(e){switch(e){case"vanilla":return[this.tailPosX,this.tailPosY];case"me":return[(this.tailPosX<=-1e3?this.tailPosX/1e3:this.tailPosX>=1e3?this.tailPosX/1e3:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY];case"ne":return this.customData.tailCoordinates?[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]]:[this.tailPosX,this.tailPosY];default:return this.customData.tailCoordinates?[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]]:[(this.tailPosX<=-1e3?this.tailPosX/1e3:this.tailPosX>=1e3?this.tailPosX/1e3:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY]}}getAngle(e){switch(e){case"vanilla":return kt[this.direction]||0;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return kt[this.direction]||0}return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):kt[this.direction]||0}getDistance(e){const[i,a]=this.getPosition(),[o,r]=e.getPosition();return Math.sqrt(Math.pow(o-i,2)+Math.pow(r-a,2))}isVertical(e){const[i]=this.getPosition(),[a]=e.getPosition(),o=i-a;return o>-.001&&o<.001}isHorizontal(e){const[i,a]=this.getPosition(),[o,r]=e.getPosition(),s=a-r;return s>-.001&&s<.001}isDiagonal(e){const[i,a]=this.getPosition(),[o,r]=e.getPosition(),s=Math.abs(i-o),n=Math.abs(a-r);return s===n}isInline(e,i=.5){return this.getDistance(e)<=i}isAdjacent(e){const i=this.getDistance(e);return i>.499&&i<1.001}isWindow(e,i=1.8){return this.getDistance(e)>i}isSlantedWindow(e){return this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e)}isInverse(){return this.time>this.tailTime}}const wt=class extends sc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c,h,f,p,u,m,_;return e.push(new this({b:(o=(a=i.b)!=null?a:i.tb)!=null?o:wt.default.b,c:(r=i.c)!=null?r:wt.default.c,x:(s=i.x)!=null?s:wt.default.x,y:(n=i.y)!=null?n:wt.default.y,d:(l=i.d)!=null?l:wt.default.d,tb:(h=(c=i.tb)!=null?c:i.b)!=null?h:wt.default.tb,tx:(f=i.tx)!=null?f:wt.default.tx,ty:(p=i.ty)!=null?p:wt.default.ty,sc:(u=i.sc)!=null?u:wt.default.sc,s:(m=i.s)!=null?m:wt.default.s,customData:(_=i.customData)!=null?_:wt.default.customData()}))}),e.length?e:[new this({b:wt.default.b,c:wt.default.c,x:wt.default.x,y:wt.default.y,d:wt.default.d,tb:wt.default.tb,tx:wt.default.tx,ty:wt.default.ty,sc:wt.default.sc,s:wt.default.s,customData:wt.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,sc:this.sliceCount,s:this.squish,customData:St(this.customData)}}get sliceCount(){return this.data.sc}set sliceCount(t){this.data.sc=t}get squish(){return this.data.s}set squish(t){this.data.s=t}setSliceCount(t){return this.sliceCount=t,this}setSquish(t){return this.squish=t,this}mirror(t=!0){switch(this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]})),this.posX=pe-1-this.posX,this.tailPosX=pe-1-this.tailPosX,t&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}getAngle(t){switch(t){case"vanilla":return kt[this.direction]||0;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return kt[this.direction]||0;default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):kt[this.direction]||0}}hasMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360}isValid(){return!(this.hasMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)&&!(this.posX===this.tailPosX&&this.posY===this.tailPosY)}};let Cn=wt;Cn.default={b:0,c:0,x:0,y:0,d:0,tb:0,tx:0,ty:0,sc:1,s:1,customData:()=>({})};const ci=class extends Ge{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r;return e.push(new this({b:(a=i.b)!=null?a:ci.default.b,o:(o=i.o)!=null?o:ci.default.o,customData:(r=i.customData)!=null?r:ci.default.customData()}))}),e.length?e:[new this({b:ci.default.b,o:ci.default.o,customData:ci.default.customData()})]}toJSON(){return{b:this.time,o:this.toggle,customData:St(this.customData)}}get toggle(){return this.data.o}set toggle(t){this.data.o=t}};let Gi=ci;Gi.default={b:0,o:!1,customData:()=>({})};class id extends Ge{get groupID(){return this.data.g}set groupID(e){this.data.g=e}}class lc extends id{constructor(e,i){super(e),this._e=i}toJSON(){return{b:this.time,g:this.groupID,e:this.events.map(e=>e.toJSON()),customData:St(this.customData)}}get events(){return this._e}set events(e){this._e=e}}const le=class extends Vt{constructor(t){super(t),this.data.f===1&&(this.p0=this.p0?this.p0:1)}static create(t={}){var e,i,a,o,r,s,n,l,c;return new le({f:(e=t.f)!=null?e:le.default.f,p:(i=t.p)!=null?i:le.default.p,t:(a=t.t)!=null?a:le.default.t,r:(o=t.r)!=null?o:le.default.r,c:(r=t.c)!=null?r:le.default.c,l:(s=t.l)!=null?s:le.default.l,d:(n=t.d)!=null?n:le.default.d,n:(l=t.n)!=null?l:le.default.n,s:(c=t.s)!=null?c:le.default.s})}toJSON(){return{f:this.type,p:this.p0,t:this.p1,r:this.reverse,c:this.chunks,l:this.limit,d:this.limitAffectsType,n:this.random,s:this.seed}}get type(){return this.data.f}set type(t){this.data.f=t}get p0(){return this.data.p}set p0(t){this.data.p=t}get p1(){return this.data.t}set p1(t){this.data.t=t}get reverse(){return this.data.r}set reverse(t){this.data.r=t}get chunks(){return this.data.c}set chunks(t){this.data.c=t}get limit(){return this.data.l}set limit(t){this.data.l=t}get limitAffectsType(){return this.data.d}set limitAffectsType(t){this.data.d=t}get random(){return this.data.n}set random(t){this.data.n=t}get seed(){return this.data.s}set seed(t){this.data.s=t}};let xt=le;xt.default={f:1,p:0,t:0,r:0,c:0,l:0,d:0,n:0,s:0};class cc extends Vt{constructor(e){super(e),this._f=xt.create(e.f)}get filter(){return this._f}set filter(e){this._f=e}get beatDistribution(){return this.data.w}set beatDistribution(e){this.data.w=e}get beatDistributionType(){return this.data.d}set beatDistributionType(e){this.data.d=e}setFilter(e){return this.filter=e,this}setBeatDistribution(e){return this.beatDistribution=e,this}setBeatDistributionType(e){return this.beatDistributionType=e,this}}const jt=class extends Vt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l;return e.push(new this({b:(a=i.b)!=null?a:jt.default.b,i:(o=i.i)!=null?o:jt.default.i,c:(r=i.c)!=null?r:jt.default.c,s:(s=i.s)!=null?s:jt.default.s,f:(n=i.f)!=null?n:jt.default.f,customData:(l=i.customData)!=null?l:jt.default.customData()}))}),e.length?e:[new this({b:jt.default.b,i:jt.default.i,c:jt.default.c,s:jt.default.s,f:jt.default.f,customData:jt.default.customData()})]}toJSON(){return{b:this.time,i:this.transition,c:this.color,s:this.brightness,f:this.frequency,customData:St(this.data.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get transition(){return this.data.i}set transition(t){this.data.i=t}get color(){return this.data.c}set color(t){this.data.c=t}get brightness(){return this.data.s}set brightness(t){this.data.s=t}get frequency(){return this.data.f}set frequency(t){this.data.f=t}};let uc=jt;uc.default={b:0,i:0,c:0,s:1,f:0,customData:()=>({})};const Ht=class extends cc{constructor(t){super(t),this._e=t.e.map(i=>uc.create(i)[0]);const e=Math.max(...this._e.map(i=>i.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<e?e:this.beatDistribution)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c;return e.push(new this({f:(a=i.f)!=null?a:Ht.default.f(),w:(o=i.w)!=null?o:Ht.default.w,d:(r=i.d)!=null?r:Ht.default.d,r:(s=i.r)!=null?s:Ht.default.r,t:(n=i.t)!=null?n:Ht.default.t,b:(l=i.b)!=null?l:Ht.default.b,e:(c=i.e)!=null?c:Ht.default.e()}))}),e.length?e:[new this({f:Ht.default.f(),w:Ht.default.w,d:Ht.default.d,r:Ht.default.r,t:Ht.default.t,b:Ht.default.b,e:Ht.default.e()})]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,r:this.brightnessDistribution,t:this.brightnessDistributionType,b:this.affectFirst,e:this.events.map(t=>t.toJSON())}}get brightnessDistribution(){return this.data.r}set brightnessDistribution(t){this.data.r=t}get brightnessDistributionType(){return this.data.t}set brightnessDistributionType(t){this.data.t=t}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get events(){return this._e}set events(t){this._e=t}};let hc=Ht;hc.default={f:()=>({f:xt.default.f,p:xt.default.p,t:xt.default.t,r:xt.default.r,c:xt.default.c,l:xt.default.l,d:xt.default.d,n:xt.default.n,s:xt.default.s}),w:0,d:1,r:0,t:1,b:0,e:()=>[]};const Ce=class extends lc{constructor(t){super(t,t.e.map(e=>hc.create(e)[0]))}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s;return e.push(new this({b:(a=i.b)!=null?a:Ce.default.b,g:(o=i.g)!=null?o:Ce.default.g,e:(r=i.e)!=null?r:Ce.default.e(),customData:(s=i.customData)!=null?s:Ce.default.customData()}))}),e.length?e:[new this({b:Ce.default.b,g:Ce.default.g,e:Ce.default.e(),customData:Ce.default.customData()})]}};let Ln=Ce;Ln.default={b:0,g:0,e:()=>[],customData:()=>({})};const Xt=class extends Vt{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c;return e.push(new this({b:(a=i.b)!=null?a:Xt.default.b,p:(o=i.p)!=null?o:Xt.default.p,e:(r=i.e)!=null?r:Xt.default.e,l:(s=i.l)!=null?s:Xt.default.l,r:(n=i.r)!=null?n:Xt.default.r,o:(l=i.o)!=null?l:Xt.default.o,customData:(c=i.customData)!=null?c:Xt.default.customData()}))}),e.length?e:[new this({b:Xt.default.b,p:Xt.default.p,e:Xt.default.e,l:Xt.default.l,r:Xt.default.r,o:Xt.default.o,customData:Xt.default.customData()})]}toJSON(){return{b:this.time,p:this.previous,e:this.ease,l:this.loop,r:this.rotation,o:this.direction,customData:St(this.data.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get previous(){return this.data.p}set previous(t){this.data.p=t}get ease(){return this.data.e}set ease(t){this.data.e=t}get loop(){return this.data.l}set loop(t){this.data.l=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}get direction(){return this.data.o}set direction(t){this.data.o=t}};let dc=Xt;dc.default={b:0,p:0,e:0,l:0,r:0,o:0,customData:()=>({})};const It=class extends cc{constructor(t){super(t),this._l=t.l.map(i=>dc.create(i)[0]);const e=Math.max(...this._l.map(i=>i.time));this.beatDistributionType===2&&(this.beatDistribution=this.beatDistribution<e?e:this.beatDistribution)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c,h,f;return e.push(new this({f:(a=i.f)!=null?a:It.default.f(),w:(o=i.w)!=null?o:It.default.w,d:(r=i.d)!=null?r:It.default.d,s:(s=i.s)!=null?s:It.default.s,t:(n=i.t)!=null?n:It.default.t,a:(l=i.a)!=null?l:It.default.a,r:(c=i.r)!=null?c:It.default.r,b:(h=i.b)!=null?h:It.default.b,l:(f=i.l)!=null?f:It.default.l()}))}),e.length?e:[new this({f:It.default.f(),w:It.default.w,d:It.default.d,s:It.default.s,t:It.default.t,a:It.default.a,r:It.default.r,b:It.default.b,l:It.default.l()})]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.rotationDistribution,t:this.rotationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,l:this.events.map(t=>t.toJSON())}}get rotationDistribution(){return this.data.s}set rotationDistribution(t){this.data.s=t}get rotationDistributionType(){return this.data.t}set rotationDistributionType(t){this.data.t=t}get axis(){return this.data.a}set axis(t){this.data.a=t}get flip(){return this.data.r}set flip(t){this.data.r=t?1:0}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get events(){return this._l}set events(t){this._l=t}};let fc=It;fc.default={f:()=>({f:xt.default.f,p:xt.default.p,t:xt.default.t,r:xt.default.r,c:xt.default.c,l:xt.default.l,d:xt.default.d,n:xt.default.n,s:xt.default.s}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,l:()=>[]};const Le=class extends lc{constructor(t){super(t,t.e.map(e=>fc.create(e)[0]))}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s;return e.push(new this({b:(a=i.b)!=null?a:Le.default.b,g:(o=i.g)!=null?o:Le.default.g,e:(r=i.e)!=null?r:Le.default.e(),customData:(s=i.customData)!=null?s:Le.default.customData()}))}),e.length?e:[new this({b:Le.default.b,g:Le.default.g,e:Le.default.e(),customData:Le.default.customData()})]}};let kn=Le;kn.default={b:0,g:0,e:()=>[],customData:()=>({})};const ke=class extends Ge{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s;return e.push(new this({b:(a=i.b)!=null?a:ke.default.b,e:(o=i.e)!=null?o:ke.default.e,r:(r=i.r)!=null?r:ke.default.r,customData:(s=i.customData)!=null?s:ke.default.customData()}))}),e.length?e:[new this({b:ke.default.b,e:ke.default.e,r:ke.default.r,customData:ke.default.customData()})]}toJSON(){return{b:this.time,e:this.executionTime,r:this.rotation,customData:St(this.customData)}}get executionTime(){return this.data.e}set executionTime(t){this.data.e=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}setExecutionTime(t){return this.executionTime=t,this}setRotation(t){return this.rotation=t,this}};let Wi=ke;Wi.default={b:0,e:0,r:0,customData:()=>({})};const yt=class extends sc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n,l,c,h,f,p,u,m,_;return e.push(new this({b:(a=i.b)!=null?a:yt.default.b,c:(o=i.c)!=null?o:yt.default.c,x:(r=i.x)!=null?r:yt.default.x,y:(s=i.y)!=null?s:yt.default.y,d:(n=i.d)!=null?n:yt.default.d,mu:(l=i.mu)!=null?l:yt.default.mu,tb:(c=i.tb)!=null?c:yt.default.tb,tx:(h=i.tx)!=null?h:yt.default.tx,ty:(f=i.ty)!=null?f:yt.default.ty,tc:(p=i.tc)!=null?p:yt.default.tc,tmu:(u=i.tmu)!=null?u:yt.default.tmu,m:(m=i.m)!=null?m:yt.default.m,customData:(_=i.customData)!=null?_:yt.default.customData()}))}),e.length?e:[new this({b:yt.default.b,c:yt.default.c,x:yt.default.x,y:yt.default.y,d:yt.default.d,mu:yt.default.mu,tb:yt.default.tb,tx:yt.default.tx,ty:yt.default.ty,tc:yt.default.tc,tmu:yt.default.tmu,m:yt.default.m,customData:yt.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,mu:this.lengthMultiplier,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,tc:this.tailDirection,tmu:this.tailLengthMultiplier,m:this.midAnchor,customData:St(this.customData)}}get lengthMultiplier(){return this.data.mu}set lengthMultiplier(t){this.data.mu=t}get tailLengthMultiplier(){return this.data.tmu}set tailLengthMultiplier(t){this.data.tmu=t}get tailDirection(){return this.data.tc}set tailDirection(t){this.data.tc=t}get midAnchor(){return this.data.m}set midAnchor(t){this.data.m=t}setLengthMultiplier(t){return this.lengthMultiplier=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setTailDirection(t){return this.tailDirection=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0){switch(this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]}),Array.isArray(this.customData.animation.offsetPosition)&&this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]})),this.posX=pe-1-this.posX,this.tailPosX=pe-1-this.tailPosX,t&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}switch(this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),this}getTailAngle(t){switch(t){case"vanilla":return kt[this.tailDirection]||0;case"me":if(this.tailDirection>=1e3)return Math.abs(this.tailDirection%1e3%360-360);case"ne":return kt[this.tailDirection]||0;default:return this.tailDirection>=1e3?Math.abs(this.tailDirection%1e3%360-360):kt[this.tailDirection]||0}}hasMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360||this.tailDirection>=1e3&&this.tailDirection<=1360}isValid(){return!(this.hasMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3||this.posX===this.tailPosX&&this.posY===this.tailPosY&&this.time===this.tailTime)}};let Vi=yt;Vi.default={b:0,c:0,x:0,y:0,d:0,mu:1,tb:0,tx:0,ty:0,tc:0,tmu:1,m:0,customData:()=>({})};const ce=class extends Ge{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>{var a,o,r,s,n;return e.push(new this({b:(a=i.b)!=null?a:ce.default.b,x:(o=i.x)!=null?o:ce.default.x,y:(r=i.y)!=null?r:ce.default.y,d:(s=i.d)!=null?s:ce.default.d,customData:(n=i.customData)!=null?n:ce.default.customData()}))}),e.length?e:[new this({b:ce.default.b,x:ce.default.x,y:ce.default.y,d:ce.default.d,customData:ce.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.direction,customData:St(this.customData)}}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get direction(){return this.data.d}set direction(t){this.data.d=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setDirection(t){return this.direction=t,this}mirror(){switch(this.posX=pe-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}};let Ji=ce;Ji.default={b:0,x:0,y:0,d:1,customData:()=>({})};class mc extends Vt{constructor(e){var i,a,o,r,s,n,l,c,h,f,p,u,m,_,b,y,v,D,C,L,P,M,Y,$,j,K,S;super(e),this._fileName="UnnamedDifficulty.dat",this.version="3.1.0",this.bpmEvents=(a=(i=e.bpmEvents)==null?void 0:i.map(R=>ji.create(R)[0]))!=null?a:[],this.rotationEvents=(r=(o=e.rotationEvents)==null?void 0:o.map(R=>Wi.create(R)[0]))!=null?r:[],this.colorNotes=(n=(s=e.colorNotes)==null?void 0:s.map(R=>Ie.create(R)[0]))!=null?n:[],this.bombNotes=(c=(l=e.bombNotes)==null?void 0:l.map(R=>Ei.create(R)[0]))!=null?c:[],this.obstacles=(f=(h=e.obstacles)==null?void 0:h.map(R=>Zt.create(R)[0]))!=null?f:[],this.sliders=(u=(p=e.sliders)==null?void 0:p.map(R=>Vi.create(R)[0]))!=null?u:[],this.burstSliders=(_=(m=e.burstSliders)==null?void 0:m.map(R=>Cn.create(R)[0]))!=null?_:[],this.waypoints=(y=(b=e.waypoints)==null?void 0:b.map(R=>Ji.create(R)[0]))!=null?y:[],this.basicBeatmapEvents=(D=(v=e.basicBeatmapEvents)==null?void 0:v.map(R=>Ui.create(R)[0]))!=null?D:[],this.colorBoostBeatmapEvents=(L=(C=e.colorBoostBeatmapEvents)==null?void 0:C.map(R=>Gi.create(R)[0]))!=null?L:[],this.lightColorEventBoxGroups=(M=(P=e.lightColorEventBoxGroups)==null?void 0:P.map(R=>Ln.create(R)[0]))!=null?M:[],this.lightRotationEventBoxGroups=($=(Y=e.lightRotationEventBoxGroups)==null?void 0:Y.map(R=>kn.create(R)[0]))!=null?$:[],this.basicEventTypesWithKeywords=(j=fr.create(e.basicEventTypesWithKeywords))!=null?j:{d:[]},this.useNormalEventsAsCompatibleEvents=(K=e.useNormalEventsAsCompatibleEvents)!=null?K:!1,this.customData=(S=e.customData)!=null?S:{}}static create(e={}){var i,a,o,r,s,n,l,c,h,f,p,u,m,_,b;return new this({version:"3.1.0",bpmEvents:(i=e.bpmEvents)!=null?i:[],rotationEvents:(a=e.rotationEvents)!=null?a:[],colorNotes:(o=e.colorNotes)!=null?o:[],bombNotes:(r=e.bombNotes)!=null?r:[],obstacles:(s=e.obstacles)!=null?s:[],sliders:(n=e.sliders)!=null?n:[],burstSliders:(l=e.burstSliders)!=null?l:[],waypoints:(c=e.waypoints)!=null?c:[],basicBeatmapEvents:(h=e.basicBeatmapEvents)!=null?h:[],colorBoostBeatmapEvents:(f=e.colorBoostBeatmapEvents)!=null?f:[],lightColorEventBoxGroups:(p=e.lightColorEventBoxGroups)!=null?p:[],lightRotationEventBoxGroups:(u=e.lightRotationEventBoxGroups)!=null?u:[],basicEventTypesWithKeywords:(m=e.basicEventTypesWithKeywords)!=null?m:{d:[]},useNormalEventsAsCompatibleEvents:(_=e.useNormalEventsAsCompatibleEvents)!=null?_:!1,customData:(b=e.customData)!=null?b:{}})}toJSON(){return{version:"3.1.0",bpmEvents:this.bpmEvents.map(e=>e.toJSON()),rotationEvents:this.rotationEvents.map(e=>e.toJSON()),colorNotes:this.colorNotes.map(e=>e.toJSON()),bombNotes:this.bombNotes.map(e=>e.toJSON()),obstacles:this.obstacles.map(e=>e.toJSON()),sliders:this.sliders.map(e=>e.toJSON()),burstSliders:this.burstSliders.map(e=>e.toJSON()),waypoints:this.waypoints.map(e=>e.toJSON()),basicBeatmapEvents:this.basicBeatmapEvents.map(e=>e.toJSON()),colorBoostBeatmapEvents:this.colorBoostBeatmapEvents.map(e=>e.toJSON()),lightColorEventBoxGroups:this.lightColorEventBoxGroups.map(e=>e.toJSON()),lightRotationEventBoxGroups:this.lightRotationEventBoxGroups.map(e=>e.toJSON()),basicEventTypesWithKeywords:this.basicEventTypesWithKeywords.toJSON(),useNormalEventsAsCompatibleEvents:this.useNormalEventsAsCompatibleEvents,customData:St(this.customData)}}clone(){const e=this.fileName;return super.clone().setFileName(e)}set fileName(e){this._fileName=e.trim()}get fileName(){return this._fileName}setFileName(e){return this.fileName=e,this}nps(e){const i=this.getNoteContainer().filter(a=>a.type!=="bomb");return e?i.length/e:0}peak(e,i){let a=0,o=0;i=typeof i=="number"?Ae.create(i):i;const r=this.getNoteContainer().filter(s=>s.type!=="bomb");for(let s=0;s<r.length;s++){for(;r[s].data.time-r[o].data.time>e;)o++;a=Math.max(a,(s-o+1)/i.toRealTime(e))}return a}getFirstInteractiveTime(){const e=this.getNoteContainer().filter(o=>o.type!=="bomb");let i=Number.MAX_VALUE;e.length>0&&(i=e[0].data.time);const a=this.findFirstInteractiveObstacleTime();return Math.min(i,a)}getLastInteractiveTime(){const e=this.getNoteContainer().filter(o=>o.type!=="bomb");let i=0;e.length>0&&(i=e[e.length-1].data.time);const a=this.findLastInteractiveObstacleTime();return Math.max(i,a)}findFirstInteractiveObstacleTime(){for(let e=0,i=this.obstacles.length;e<i;e++)if(this.obstacles[e].isInteractive())return this.obstacles[e].time;return Number.MAX_VALUE}findLastInteractiveObstacleTime(){let e=0;for(let i=this.obstacles.length-1;i>=0;i--)this.obstacles[i].isInteractive()&&(e=Math.max(e,this.obstacles[i].time+this.obstacles[i].duration));return e}getNoteContainer(){const e=[];return this.colorNotes.forEach(i=>e.push({type:"note",data:i})),this.sliders.forEach(i=>e.push({type:"slider",data:i})),this.burstSliders.forEach(i=>e.push({type:"burstSlider",data:i})),this.bombNotes.forEach(i=>e.push({type:"bomb",data:i})),e.sort((i,a)=>i.data.time-a.data.time)}getEventContainer(){const e=[];return this.basicBeatmapEvents.forEach(i=>e.push({type:"basicEvent",data:i})),this.colorBoostBeatmapEvents.forEach(i=>e.push({type:"boost",data:i})),e.sort((i,a)=>i.data.time-a.data.time)}addBPMEvents(...e){this.bpmEvents.push(...e.map(i=>i instanceof ji?i:ji.create(i)[0]))}addRotationEvents(...e){this.rotationEvents.push(...e.map(i=>i instanceof Wi?i:Wi.create(i)[0]))}addColorNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof Ie?i:Ie.create(i)[0]))}addBombNotes(...e){this.bombNotes.push(...e.map(i=>i instanceof Ei?i:Ei.create(i)[0]))}addObstacles(...e){this.obstacles.push(...e.map(i=>i instanceof Zt?i:Zt.create(i)[0]))}addSliders(...e){this.sliders.push(...e.map(i=>i instanceof Vi?i:Vi.create(i)[0]))}addBurstSliders(...e){this.burstSliders.push(...e.map(i=>i instanceof Cn?i:Cn.create(i)[0]))}addWaypoints(...e){this.waypoints.push(...e.map(i=>i instanceof Ji?i:Ji.create(i)[0]))}addBasicEvents(...e){this.basicBeatmapEvents.push(...e.map(i=>i instanceof Ui?i:Ui.create(i)[0]))}addColorBoostEvents(...e){this.colorBoostBeatmapEvents.push(...e.map(i=>i instanceof Gi?i:Gi.create(i)[0]))}addLightColorEventBoxGroups(...e){this.lightColorEventBoxGroups.push(...e.map(i=>i instanceof Ln?i:Ln.create(i)[0]))}addLightRotationEventBoxGroups(...e){this.lightRotationEventBoxGroups.push(...e.map(i=>i instanceof kn?i:kn.create(i)[0]))}}const sa=t=>`[shared::parse::${t}]`;function nd(t){return nt.info(sa("info"),"Parsing beatmap info v2.x.x"),t._difficultyBeatmapSets.sort((e,i)=>Aa[e._beatmapCharacteristicName]-Aa[i._beatmapCharacteristicName]),t._difficultyBeatmapSets.forEach(e=>{let i=0;e._difficultyBeatmaps.forEach(a=>{var o,r;a._difficultyRank-i<=0&&nt.warn(sa("info"),a._difficulty+" is unordered"),ll[a._difficulty]!==a._difficultyRank&&nt.error(sa("info"),a._difficulty+" has invalid rank"),i=a._difficultyRank,typeof((o=a._customData)==null?void 0:o._editorOffset)=="number"&&a._customData._editorOffset===0&&delete a._customData._editorOffset,typeof((r=a._customData)==null?void 0:r._editorOldOffset)=="number"&&a._customData._editorOldOffset===0&&delete a._customData._editorOldOffset}),e._difficultyBeatmaps.sort((a,o)=>a._difficultyRank-o._difficultyRank)}),t}const pc=t=>`[shared::dataCheck::${t}]`;function Xe(t,e,i){if(e)throw Error(t);nt.warn(pc("deepCheck"),t),i.push(t)}function qi(t,e,i,a,o=!0,r=[]){if(nt.verbose(pc("deepCheck"),`Looking up ${i}`),Array.isArray(t)){t.forEach((n,l)=>qi(n,e,`${i}[${l}]`,a));return}const s=Object.keys(e);for(const n in t){if(!s.length)break;s.includes(n)||Xe(`Unused key ${n} found in ${i}`,!1,r)}for(const n in e){if(typeof t[n]>"u"){if(e[n].optional||td(a,e[n].version)==="old")continue;Xe(`Missing ${n} in object ${i}!`,o,r)}t[n]==null&&Xe(`${n} contain null value in object ${i}!`,o,r),e[n].type==="array"&&(Array.isArray(t[n])||Xe(`${n} is not an array in object ${i}!`,o,r),qi(t[n],e[n].check,`${i} ${n}`,a)),e[n].type==="object"&&(!Array.isArray(t[n])&&typeof t[n]!="object"?Xe(`${n} is not an object in object ${i}!`,o,r):qi(t[n],e[n].check,`${i} ${n}`,a)),e[n].type!=="array"&&typeof t[n]!==e[n].type&&Xe(`${n} is not ${e[n].type} in object ${i}!`,o,r),e[n].type==="number"&&typeof t[n]=="number"&&(e[n].int&&t[n]%1!==0&&Xe(`${i} ${n} cannot be float!`,!1,r),e[n].unsigned&&t[n]<0&&Xe(`${i} ${n} cannot be negative!`,!1,r))}}const ad={_time:{type:"number",version:"2.0.0"},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_lineIndex:{type:"number",int:!0,version:"2.0.0"},_lineLayer:{type:"number",int:!0,version:"2.0.0"},_cutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},rd={_colorType:{type:"number",version:"2.0.0"},_headTime:{type:"number",version:"2.0.0"},_headLineIndex:{type:"number",int:!0,version:"2.0.0"},_headLineLayer:{type:"number",int:!0,version:"2.0.0"},_headCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_headControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_tailTime:{type:"number",version:"2.0.0"},_tailLineIndex:{type:"number",int:!0,version:"2.0.0"},_tailLineLayer:{type:"number",int:!0,version:"2.0.0"},_tailCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_tailControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_sliderMidAnchorMode:{type:"number",version:"2.0.0"}},od={_time:{type:"number",version:"2.0.0"},_lineIndex:{type:"number",int:!0,version:"2.0.0"},_lineLayer:{type:"number",int:!0,version:"2.6.0",optional:!0},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_duration:{type:"number",version:"2.0.0"},_width:{type:"number",int:!0,version:"2.0.0"},_height:{type:"number",int:!0,version:"2.6.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},sd={_time:{type:"number",version:"2.0.0"},_type:{type:"number",int:!0,version:"2.0.0"},_value:{type:"number",int:!0,version:"2.0.0"},_floatValue:{type:"number",version:"2.5.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},ld={_time:{type:"number",version:"2.2.0"},_lineIndex:{type:"number",int:!0,version:"2.2.0"},_lineLayer:{type:"number",int:!0,version:"2.2.0"},_offsetDirection:{type:"number",int:!0,version:"2.2.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},cd={_keyword:{type:"string",version:"2.4.0"},_specialEvents:{type:"number",int:!0,version:"2.4.0"}},ud={_keywords:{type:"array",version:"2.4.0",check:cd}},hd={_version:{type:"string",version:"2.0.0"},_notes:{type:"array",version:"2.0.0",check:ad},_sliders:{type:"array",version:"2.6.0",check:rd},_obstacles:{type:"array",version:"2.0.0",check:od},_events:{type:"array",version:"2.0.0",check:sd},_waypoints:{type:"array",version:"2.2.0",check:ld,optional:!0},_specialEventsKeywordFilters:{type:"object",version:"2.4.0",check:ud,optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},qo=t=>`[v2::parse::${t}]`,mn=(t,e)=>t._time-e._time;function dd(t,e={enable:!0,throwError:!0}){var i,a,o,r,s,n;return nt.info(qo("difficulty"),"Parsing beatmap difficulty v2.x.x"),(i=t._version)!=null&&i.startsWith("2")||(nt.warn(qo("difficulty"),"Unidentified beatmap version"),t._version="2.0.0"),e.enable&&qi(t,hd,"difficulty",t._version,e.throwError),t._notes=(a=t._notes)!=null?a:[],t._sliders=(o=t._sliders)!=null?o:[],t._obstacles=(r=t._obstacles)!=null?r:[],t._events=(s=t._events)!=null?s:[],t._waypoints=(n=t._waypoints)!=null?n:[],t._notes.sort(mn),t._sliders.sort((l,c)=>l._headTime-c._headTime),t._obstacles.sort(mn),t._events.sort(mn),t._waypoints.sort(mn),ed.create(t)}const fd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},a:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},md={b:{type:"number",version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},pd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},mu:{type:"number",version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",int:!0,version:"3.0.0"},ty:{type:"number",int:!0,version:"3.0.0"},tc:{type:"number",int:!0,version:"3.0.0"},tmu:{type:"number",version:"3.0.0"},m:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},_d={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",int:!0,version:"3.0.0"},ty:{type:"number",int:!0,version:"3.0.0"},sc:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},gd={b:{type:"number",version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",version:"3.0.0"},w:{type:"number",int:!0,version:"3.0.0"},h:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},bd={b:{type:"number",version:"3.0.0"},et:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},yd={b:{type:"number",version:"3.0.0"},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},vd={b:{type:"number",version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"},r:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ed={b:{type:"number",version:"3.0.0"},o:{type:"boolean",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},_c={f:{type:"number",int:!0,version:"3.0.0"},p:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},r:{type:"number",int:!0,version:"3.0.0"},c:{type:"number",int:!0,version:"3.1.0"},l:{type:"number",version:"3.1.0"},d:{type:"number",int:!0,version:"3.1.0"},n:{type:"number",int:!0,version:"3.1.0"},s:{type:"number",int:!0,version:"3.1.0"}},wd={b:{type:"number",version:"3.0.0"},i:{type:"number",int:!0,version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Sd={f:{type:"object",version:"3.0.0",check:_c},w:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},r:{type:"number",version:"3.0.0"},t:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:wd},b:{type:"number",int:!0,version:"3.0.0"}},Dd={b:{type:"number",version:"3.0.0"},g:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Sd},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Td={b:{type:"number",version:"3.0.0"},p:{type:"number",int:!0,version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"},l:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},o:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Cd={f:{type:"object",version:"3.0.0",check:_c},w:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},t:{type:"number",int:!0,version:"3.0.0"},a:{type:"number",int:!0,version:"3.0.0"},l:{type:"array",version:"3.0.0",check:Td},r:{type:"number",int:!0,version:"3.0.0"},b:{type:"number",int:!0,version:"3.0.0"}},Ld={b:{type:"number",version:"3.0.0"},g:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Cd},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},kd={k:{type:"string",version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"}},xd={d:{type:"array",version:"3.0.0",check:kd,optional:!0}},Rd={b:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Id={version:{type:"string",version:"3.0.0"},bpmEvents:{type:"array",version:"3.0.0",check:yd,optional:!0},rotationEvents:{type:"array",version:"3.0.0",check:vd,optional:!0},colorNotes:{type:"array",version:"3.0.0",check:fd,optional:!0},bombNotes:{type:"array",version:"3.0.0",check:md,optional:!0},obstacles:{type:"array",version:"3.0.0",check:gd,optional:!0},sliders:{type:"array",version:"3.0.0",check:pd,optional:!0},burstSliders:{type:"array",version:"3.0.0",check:_d,optional:!0},waypoints:{type:"array",version:"3.0.0",check:Rd,optional:!0},basicBeatmapEvents:{type:"array",version:"3.0.0",check:bd,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:Ed,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:Dd,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:Ld,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"3.0.0",check:xd},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Zo=t=>`[v3::parse::${t}]`,qt=(t,e)=>t.b-e.b;function Nd(t,e={enable:!0,throwError:!0}){var i,a,o,r,s,n,l,c,h,f,p,u;return nt.info(Zo("difficulty"),"Parsing beatmap difficulty v3.x.x"),t.version!=="3.0.0"&&(nt.warn(Zo("difficulty"),"Unidentified beatmap version"),t.version="3.0.0"),e.enable&&qi(t,Id,"difficulty",t.version,e.throwError),t.bpmEvents=(i=t.bpmEvents)!=null?i:[],t.rotationEvents=(a=t.rotationEvents)!=null?a:[],t.colorNotes=(o=t.colorNotes)!=null?o:[],t.bombNotes=(r=t.bombNotes)!=null?r:[],t.obstacles=(s=t.obstacles)!=null?s:[],t.sliders=(n=t.sliders)!=null?n:[],t.burstSliders=(l=t.burstSliders)!=null?l:[],t.waypoints=(c=t.waypoints)!=null?c:[],t.basicBeatmapEvents=(h=t.basicBeatmapEvents)!=null?h:[],t.colorBoostBeatmapEvents=(f=t.colorBoostBeatmapEvents)!=null?f:[],t.lightColorEventBoxGroups=(p=t.lightColorEventBoxGroups)!=null?p:[],t.lightRotationEventBoxGroups=(u=t.lightRotationEventBoxGroups)!=null?u:[],t.bpmEvents.sort(qt),t.rotationEvents.sort(qt),t.colorNotes.sort(qt),t.bombNotes.sort(qt),t.obstacles.sort(qt),t.sliders.sort(qt),t.burstSliders.sort(qt),t.waypoints.sort(qt),t.basicBeatmapEvents.sort(qt),t.colorBoostBeatmapEvents.sort(qt),t.lightColorEventBoxGroups.sort(qt),t.lightRotationEventBoxGroups.sort(qt),mc.create(t)}const Ko="NJS Check",Qo="Check note jump speed for suitable value.",ts=!0,Zn={name:Ko,description:Qo,type:"other",order:{input:dt.OTHERS_NJS,output:ft.OTHERS_NJS},input:{enabled:ts,params:{},html:ct.create(Ko,Qo,ts,function(){Zn.input.enabled=this.checked})},output:{html:null},run:Ad};function Ad(t){if(!t.difficulty){console.error("Something went wrong!");return}const{njs:e,bpm:i}=t.settings,a=[];if(t.difficulty.info._noteJumpMovementSpeed===0&&a.push(mt("Unset NJS","fallback NJS is used")),e.value>23&&a.push(mt(`NJS is too high (${B(e.value,2)})`,"use lower whenever necessary")),e.value<3&&a.push(mt(`NJS is too low (${B(e.value,2)})`,"timing is less significant below this")),e.jd>36&&a.push(mt("Very high jump distance",`${B(e.jd,2)}`)),e.jd<18&&a.push(mt("Very low jump distance",`${B(e.jd,2)}`)),e.jd>e.calcJDOptimalHigh()&&a.push(mt(`High jump distance warning (>${B(e.calcJDOptimalHigh(),2)})`,"NJS & offset may be uncomfortable to play")),i.toRealTime(e.hjd)<.42&&a.push(mt(`Very quick reaction time (${B(i.toRealTime(e.hjd)*1e3)}ms)`,"may lead to suboptimal gameplay")),e.calcHJDRaw()+e.offset<we.HJD_MIN&&a.push(mt("Unnecessary negative offset",`will not drop below ${we.HJD_MIN}`)),a.length){const o=document.createElement("div");a.forEach(r=>o.append(r)),Zn.output.html=o}else Zn.output.html=null}const es="Outside Playable Object",is="Look for any object starting before and after song timer.",ns=!0,Kn={name:es,description:is,type:"other",order:{input:dt.OTHERS_OUTSIDE_PLAYABLE,output:ft.OTHERS_OUTSIDE_PLAYABLE},input:{enabled:ns,params:{},html:ct.create(es,is,ns,function(){Kn.input.enabled=this.checked})},output:{html:null},run:Bd};function Bd(t){if(!t.difficulty){console.error("Something went wrong!");return}const{bpm:e,audioDuration:i}=t.settings,{colorNotes:a,bombNotes:o,obstacles:r,basicBeatmapEvents:s,sliders:n,burstSliders:l}=t.difficulty.data,c=[];if(i){let h=e.toBeatTime(i,!0);a.length&&a[0].time<0&&c.push(mt("Note(s) before start time",`${B(a[0].time,3)} (${Nt(e.toRealTime(a[0].time))}`)),o.length&&o[0].time<0&&c.push(mt("Bomb(s) before start time",`${B(o[0].time,3)} (${Nt(e.toRealTime(o[0].time))}`)),n.length&&n[0].time<0&&c.push(mt("Arc(s) before start time",`${B(n[0].time,3)} (${Nt(e.toRealTime(n[0].time))}`)),l.length&&l[0].time<0&&c.push(mt("Chain(s) before start time",`${B(l[0].time,3)} (${Nt(e.toRealTime(l[0].time))}`)),r.length&&r[0].time<0&&c.push(mt("Obstacle(s) before start time",`${B(r[0].time,3)} (${Nt(e.toRealTime(r[0].time))}`)),s.length&&s[0].time<0&&c.push(mt("Event(s) before start time",`${B(s[0].time,3)} (${Nt(e.toRealTime(s[0].time))}`)),a.length&&a[a.length-1].time>h&&c.push(mt("Note(s) after end time",`${B(a[a.length-1].time,3)} (${Nt(e.toRealTime(a[a.length-1].time))})`)),o.length&&o[o.length-1].time>h&&c.push(mt("Bomb(s) after end time",`${B(o[o.length-1].time,3)} (${Nt(e.toRealTime(o[o.length-1].time))})`)),n.length&&n[n.length-1].time>h&&c.push(mt("Arc(s) after end time",`${B(n[n.length-1].time,3)} (${Nt(e.toRealTime(n[n.length-1].time))})`)),l.length&&l[l.length-1].time>h&&c.push(mt("Chain(s) after end time",`${B(l[l.length-1].time,3)} (${Nt(e.toRealTime(l[l.length-1].time))})`)),r.length&&r[r.length-1].time>h&&c.push(mt("Obstacle(s) after end time",`${B(r[r.length-1].time,3)} (${Nt(e.toRealTime(r[r.length-1].time))})`)),s.length&&s[s.length-1].time>h&&c.push(mt("Event(s) after end time",`${B(s[s.length-1].time,3)} (${Nt(e.toRealTime(s[s.length-1].time))})`))}if(c.length){const h=document.createElement("div");c.forEach(f=>h.append(f)),Kn.output.html=h}else Kn.output.html=null}const as="Invalid Object",rs="Validate beatmap object to be compatible with vanilla (ignores for modded).",os=!0,Qn={name:as,description:rs,type:"other",order:{input:dt.OTHERS_INVALID_OBJECT,output:ft.OTHERS_INVALID_OBJECT},input:{enabled:os,params:{},html:ct.create(as,rs,os,function(){Qn.input.enabled=this.checked})},output:{html:null},run:$d};function $d(t){var m,_,b,y;if(!t.difficulty){console.error("Something went wrong!");return}const{colorNotes:e,bombNotes:i,obstacles:a,basicBeatmapEvents:o,sliders:r,burstSliders:s}=t.difficulty.data;let n=[],l=[],c=[],h=[],f=[];(_=(m=t.difficulty.info._customData)==null?void 0:m._requirements)!=null&&_.includes("Mapping Extensions")||((y=(b=t.difficulty.info._customData)==null?void 0:b._requirements)!=null&&y.includes("Noodle Extensions")?(n=e.filter(v=>v.hasMappingExtensions()).map(v=>v.time),l=a.filter(v=>v.hasMappingExtensions()).map(v=>v.time),c=i.filter(v=>v.hasMappingExtensions()).map(v=>v.time),h=r.filter(v=>v.hasMappingExtensions()).map(v=>v.time),f=s.filter(v=>v.hasMappingExtensions()).map(v=>v.time)):(n=e.filter(v=>!v.isValid()).map(v=>v.time),l=a.filter(v=>!v.isValid()).map(v=>v.time),c=i.filter(v=>!v.isValid()).map(v=>v.time),h=r.filter(v=>!v.isValid()).map(v=>v.time),f=s.filter(v=>!v.isValid()).map(v=>v.time)));const p=o.filter(v=>!v.isValid()).map(v=>v.time),u=[];if(n.length&&u.push(pt("Invalid note",n,t.settings.bpm)),c.length&&u.push(pt("Invalid bomb",c,t.settings.bpm)),h.length&&u.push(pt("Invalid arc",h,t.settings.bpm)),f.length&&u.push(pt("Invalid chain",f,t.settings.bpm)),l.length&&u.push(pt("Invalid obstacle",l,t.settings.bpm)),p.length&&u.push(pt("Invalid event",p,t.settings.bpm)),u.length){const v=document.createElement("div");u.forEach(D=>v.append(D)),Qn.output.html=v}else Qn.output.html=null}const ss=Object.freeze(Object.defineProperty({__proto__:null,hotStart:hi,difficultyLabel:qn,njs:Zn,outsidePlayable:Kn,invalidObject:Qn},Symbol.toStringTag,{value:"Module"})),Ee=class{constructor(){}};let Fe=Ee;Fe.getNote=()=>Object.keys(Io).map(t=>Io[t]);Fe.getObstacle=()=>Object.keys(Po).map(t=>Po[t]);Fe.getEvent=()=>Object.keys(jo).map(t=>jo[t]);Fe.getOther=()=>Object.keys(ss).map(t=>ss[t]);Fe.getGeneral=()=>Object.keys(Yr).map(t=>Yr[t]);Fe.getDifficulty=()=>[...Ee.getNote(),...Ee.getObstacle(),...Ee.getEvent(),...Ee.getOther()];Fe.getAll=()=>[...Ee.getNote(),...Ee.getObstacle(),...Ee.getEvent(),...Ee.getOther(),...Ee.getGeneral()];const ui=t=>`[analyzer::${t}]`,gc=Fe.getAll().sort((t,e)=>t.order.input-e.order.input),bc=[...gc].sort((t,e)=>t.order.output-e.order.output);function yc(){lt.analysis={general:{html:null},map:[]}}function Md(){var s,n;const t=lt.beatmapInfo;if(!t){nt.error(ui("runGeneral"),"Could not analyse, missing map info");return}lt.analysis||yc();const e=(s=lt.analysis)==null?void 0:s.general,i=Ae.create(t._beatsPerMinute),a=we.create(i),o={bpm:i,njs:a,audioDuration:(n=lt.duration)!=null?n:null,mapDuration:0};nt.info(ui("runGeneral"),"Analysing general");const r=[];bc.filter(l=>l.type==="general").forEach(l=>{if(l.input.enabled)try{l.run({settings:o,info:t}),l.output.html&&r.push(l.output.html)}catch(c){nt.error(ui("runGeneral"),c)}}),e&&(e.html=r)}function vc(t,e){var l,c,h,f;const i=lt.beatmapInfo;if(!i){nt.error(ui("runDifficulty"),"Could not analyse, missing map info");return}lt.analysis||yc();const a=(l=lt.beatmapDifficulty)==null?void 0:l.find(p=>p.characteristic===t&&p.difficulty===e);if(!a){nt.error(ui("runDifficulty"),"Could not analyse, missing map data");return}const o=(c=lt.analysis)==null?void 0:c.map.find(p=>p.difficulty===e&&p.mode===t),r=we.create(a.bpm,a.info._noteJumpMovementSpeed||we.FallbackNJS[a.difficulty],a.info._noteJumpStartBeatOffset),s={bpm:a.bpm,njs:r,audioDuration:(h=lt.duration)!=null?h:null,mapDuration:a.bpm.toRealTime(a.data.getLastInteractiveTime())};nt.info(ui("runDifficulty"),`Analysing ${t} ${e}`);const n=[];bc.filter(p=>p.type!=="general").forEach(p=>{if(p.input.enabled)try{p.run({settings:s,difficulty:a,info:i}),p.output.html&&n.push(p.output.html)}catch(u){nt.error(ui("runDifficulty"),u)}}),o?o.html=n:(f=lt.analysis)==null||f.map.push({mode:t,difficulty:e,html:n})}function Od(t){Fe.getDifficulty().sort((i,a)=>i.order.output-a.order.output).forEach(i=>{i.input.adjustTime&&i.input.adjustTime(t)})}function Pd(){var t;(t=lt.beatmapDifficulty)==null||t.forEach(e=>vc(e.characteristic,e.difficulty))}const mi={toolListInput:gc,runGeneral:Md,runDifficulty:vc,adjustTime:Od,applyAll:Pd},ri="UI Tools: ",Ue=document.querySelectorAll(".tools__select-mode"),je=document.querySelectorAll(".tools__select-difficulty"),Fd=document.querySelectorAll(".difficulty__label"),Ec=document.querySelector(".tools__note-content"),wc=document.querySelector(".tools__obstacle-content"),Sc=document.querySelector(".tools__event-content"),Dc=document.querySelector(".tools__other-content"),Tc=document.querySelector(".tools__general-content"),xe=document.querySelector(".tools__output-diff"),Re=document.querySelector(".tools__output-general"),ls=document.querySelector(".tools__apply-this"),cs=document.querySelector(".tools__apply-all"),us=document.querySelector(".tools__apply-general");if(!Ec||!wc||!Sc||!Dc||!Tc)throw new Error(ri+"missing content element");if(!xe||!Re)throw new Error(ri+"missing output element");if(ls&&cs&&us)ls.addEventListener("click",Gd),cs.addEventListener("click",Wd),us.addEventListener("click",Vd);else throw new Error(ri+"missing apply element");Ue.forEach(t=>t.addEventListener("change",Ud));je.forEach(t=>t.addEventListener("change",jd));function Cc(){var e;const t=(e=lt.analysis)==null?void 0:e.general;if(!t){Re.textContent="ERROR: could not find analysis for general";return}if(!t.html){Re.textContent="ERROR: could not find HTML for general";return}Re.innerHTML="",t.html.forEach(i=>Re.appendChild(i)),Re.firstChild||(Re.textContent="No issues found.")}function sn(t,e){var a;if(!t&&!e&&(t=Ue[0].value,e=je[0].value),!t||!e)throw new Error(ri+"something went wrong!");xe.innerHTML="";const i=(a=lt.analysis)==null?void 0:a.map.find(o=>o.difficulty===e&&o.mode===t);if(!i){xe.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!i.html){xe.textContent="ERROR: could not find HTML for "+t+" "+e;return}i.html.forEach(o=>xe.appendChild(o)),xe.firstChild||(xe.textContent="No issues found.")}function na(t){Fd.forEach(e=>e.textContent=t)}function Lc(t){if(!t)return;je.forEach(i=>{for(let a=i.options.length-1;a>=0;a--)i.remove(a)});let e=!0;for(let i=t._difficultyBeatmaps.length-1;i>=0;i--){const a=t._difficultyBeatmaps[i];je.forEach(o=>{var s,n,l,c;const r=document.createElement("option");if(r.value=a._difficulty,r.textContent=de[a._difficulty]+((s=a._customData)!=null&&s._difficultyLabel?" -- "+((n=a._customData)==null?void 0:n._difficultyLabel):""),e){const h=(l=lt.beatmapDifficulty)==null?void 0:l.find(f=>f.difficulty===a._difficulty&&f.characteristic===t._beatmapCharacteristicName);if(!h)throw new Error("missing _mapSetData");al(h),na(((c=a._customData)==null?void 0:c._difficultyLabel)||de[a._difficulty]),sn(t._beatmapCharacteristicName,a._difficulty)}e=!1,o.add(r)})}}function kc(t){if(!t){Ue.forEach(i=>ha(i)),je.forEach(i=>ha(i));return}let e=!0;t._difficultyBeatmapSets.forEach(i=>{Ue.forEach(a=>{const o=document.createElement("option");o.value=i._beatmapCharacteristicName,o.textContent=dr[i._beatmapCharacteristicName],a.add(o)}),e&&Lc(i),e=!1})}function Hd(){const t=lt.beatmapInfo;if(!t)throw new Error(ri+"could not find map info");const e=Ae.create(t._beatsPerMinute);mi.adjustTime(e)}function Xd(){mi.toolListInput.forEach(t=>{if(t.input.html)switch(t.type){case"note":{Ec.appendChild(t.input.html);break}case"obstacle":{wc.appendChild(t.input.html);break}case"event":{Sc.appendChild(t.input.html);break}case"other":{Dc.appendChild(t.input.html);break}case"general":{Tc.appendChild(t.input.html);break}default:console.error(ri+"could not recognise type "+t.type+" for "+t.name)}})}function zd(){Re&&(Re.innerHTML="No output."),xe&&(xe.innerHTML="No output.")}function Yd(){zd(),na("Difficulty Label"),kc()}function Ud(t){var a;const e=t.target;Ue.forEach(o=>{o!==e&&(o.value=e.value)});const i=(a=lt.beatmapInfo)==null?void 0:a._difficultyBeatmapSets.find(o=>o._beatmapCharacteristicName===e.value);Lc(i)}function jd(t){var o,r,s,n;const e=t.target;je.forEach(l=>{l!==e&&(l.value=e.value)});const i=(o=lt.beatmapInfo)==null?void 0:o._difficultyBeatmapSets.find(l=>l._beatmapCharacteristicName===Ue.item(0).value);if(!i)throw new Error("aaaaaaaaaaaaaaaaaaa");const a=(r=lt.beatmapDifficulty)==null?void 0:r.find(l=>l.difficulty===e.value&&l.characteristic===i._beatmapCharacteristicName);a&&(al(a),na(((n=(s=a.info)==null?void 0:s._customData)==null?void 0:n._difficultyLabel)||de[e.value]),sn(a.characteristic,a.difficulty))}function Gd(){const t=Ue[0].value,e=je[0].value;if(!t||!e)throw new Error(ri+"mode/difficulty does not exist");bt.status("info",`Re-analysing ${t} ${e}`,100),mi.runDifficulty(t,e),bt.status("info",`Re-analysed ${t} ${e}`,100),sn(t,e)}function Wd(){const t=Ue[0].value,e=je[0].value;if(!t||!e)throw new Error(ri+"mode/difficulty does not exist");bt.status("info","Re-analysing all difficulties",100),mi.applyAll(),bt.status("info","Re-analysed all difficulties",100),sn(t,e)}function Vd(){bt.status("info","Re-analysing all difficulties",100),mi.runGeneral(),bt.status("info","Re-analysed all difficulties",100),Cc()}const vi={displayOutputGeneral:Cc,displayOutputDifficulty:sn,setDifficultyLabel:na,adjustTime:Hd,populateSelect:kc,populateTool:Xd,reset:Yd},di="UI Stats: ",x="stats__";function Jd(t,e){const i=e.bpm,a=lt.duration||0,o=i.toRealTime(e.data.getLastInteractiveTime()),r=document.createElement("table");return r.className=x+"table",r.innerHTML=`<caption class="${x}table-caption">Note Per Seconds (NPS):</caption><tr><th class="${x}table-header" colspan="2">Overall</th><td class="${x}table-element">${B(e.data.nps(a),2)}</td></tr><tr><th class="${x}table-header" colspan="2">Mapped</th><td class="${x}table-element">${B(e.data.nps(o),2)}</td></tr><tr><th class="${x}table-header" rowspan="3">Peak</th><th class="${x}table-header">16-beat</th><td class="${x}table-element">${B(e.data.peak(16,i.value),2)}</td></tr><tr><th class="${x}table-header">8-beat</th><td class="${x}table-element">${B(e.data.peak(8,i.value),2)}</td></tr><tr><th class="${x}table-header">4-beat</th><td class="${x}table-element">${B(e.data.peak(4,i.value),2)}</td></tr>`,r}function qd(t,e){const i=Ae.create(t._beatsPerMinute),a=we.create(i,e.info._noteJumpMovementSpeed||we.FallbackNJS[e.difficulty],e.info._noteJumpStartBeatOffset),o=document.createElement("table");return o.className=x+"table",o.innerHTML=`<caption class="${x}table-caption">Map Settings:</caption><tr><th class="${x}table-header" colspan="2">Note Jump Speed</th><td class="${x}table-element">${B(a.value,3)}</td></tr><tr><th class="${x}table-header" colspan="2">Spawn Distance Modifier</th><td class="${x}table-element">${B(a.offset,3)}</td></tr><tr><th class="${x}table-header" colspan="2">Half Jump Duration</th><td class="${x}table-element">${B(a.hjd,3)}</td></tr><tr><th class="${x}table-header" colspan="2">Jump Distance</th><td class="${x}table-element">${B(a.jd,3)}</td></tr><tr><th class="${x}table-header" colspan="2">Reaction Time</th><td class="${x}table-element">${B(a.reactTime*1e3)}ms</td></tr>`,o}function Zd(t,e){const i=e.swingAnalysis,a=document.createElement("table");return a.className=x+"table",a.innerHTML=`<caption class="${x}table-caption">Swing Per Seconds (SPS):</caption><tr><th class="${x}table-header"></th><th class="${x}table-header">Total</th><th class="${x}table-header">Red</th><th class="${x}table-header">Blue</th></tr><tr><th class="${x}table-header">Average</th><td class="${x}table-element">${B(i.total.average,2)}</td><td class="${x}table-element">${B(i.red.average,2)}</td><td class="${x}table-element">${B(i.blue.average,2)}</td></tr><tr><th class="${x}table-header">Median</th><td class="${x}table-element">${B(i.total.median,2)}</td><td class="${x}table-element">${B(i.red.median,2)}</td><td class="${x}table-element">${B(i.blue.median,2)}</td></tr><tr><th class="${x}table-header">Peak</th><td class="${x}table-element">${B(i.total.peak,2)}</td><td class="${x}table-element">${B(i.red.peak,2)}</td><td class="${x}table-element">${B(i.blue.peak,2)}</td></tr><tr><th class="${x}table-header">Total</th><td class="${x}table-element">${i.total.total}</td><td class="${x}table-element">${i.red.total}</td><td class="${x}table-element">${i.blue.total}</td></tr>`,a}function xn(t){const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let i=t.length-1;i>=0;i--)t[i].color===0?(e.red.total++,t[i].hasChroma()&&e.red.chroma++,t[i].hasNoodleExtensions()&&e.red.noodleExtensions++,t[i].hasMappingExtensions()&&e.red.mappingExtensions++):t[i].color===1&&(e.blue.total++,t[i].hasChroma()&&e.blue.chroma++,t[i].hasNoodleExtensions()&&e.blue.noodleExtensions++,t[i].hasMappingExtensions()&&e.blue.mappingExtensions++);return e}function Kd(t){const e={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>=0;i--)e.total++,t[i].hasChroma()&&e.chroma++,t[i].hasNoodleExtensions()&&e.noodleExtensions++,t[i].hasMappingExtensions()&&e.mappingExtensions++;return e}function pn(t,e){return t.filter(i=>i.data.posX===e).length}function Qd(t,e){return t.filter(i=>i.data.posY===e).length}function tf(t,e,i){return t.filter(a=>a.data.posX===e&&a.data.posY===i).length}function ef(t,e){return t.filter(i=>i.type!=="bomb"&&i.data.direction===e).length}function xc(t,e){switch(e){case"note":return t.filter(i=>i.type==="note");case"red":return t.filter(i=>i.type==="note"&&i.data.color===0);case"blue":return t.filter(i=>i.type==="note"&&i.data.color===1);case"arc":return t.filter(i=>i.type==="slider");case"redArc":return t.filter(i=>i.type==="slider"&&i.data.color===0);case"blueArc":return t.filter(i=>i.type==="slider"&&i.data.color===1);case"chain":return t.filter(i=>i.type==="burstSlider");case"redChain":return t.filter(i=>i.type==="burstSlider"&&i.data.color===0);case"blueChain":return t.filter(i=>i.type==="burstSlider"&&i.data.color===1);case"bomb":return t.filter(i=>i.type==="bomb");default:return t}}function nf(t){var l;const e=t.target,i=e.id.replace(`${x}table-select-angle-`,"").split("-"),a=i[0],o=i[1],r=(l=lt.beatmapDifficulty.find(c=>c.characteristic===a&&c.difficulty===o))==null?void 0:l.noteContainer;if(!r){console.error(di+"note could not be found");return}const s=xc(r,e.value),n=document.querySelector(`#${x}table-angle-${a}-${o}`);if(!n){console.error(di+"table could not be found");return}n.innerHTML=Rc(s)}function Rc(t){const e=t.length||1,i=[4,0,5,2,8,3,6,1,7];let a="";for(let o=0;o<3;o++){a+="<tr>";for(let r=0;r<3;r++){let s=ef(t,i[o*3+r]);a+=`<td class="${x}table-element">${s}<br>(${B(s/e*100,1)}%)</td>`}a+="</tr>"}return a}function af(t,e){var r;const i=on.create(`${x}table-select-angle-${e.characteristic}-${e.difficulty}`,"Note Angle: ","caption",`${x}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"});(r=i.querySelector("select"))==null||r.addEventListener("change",nf);let a=`<tbody id="${x}table-angle-${e.characteristic}-${e.difficulty}">${Rc(e.noteContainer)}</tbody>`;const o=document.createElement("table");return o.className=x+"table",o.innerHTML=a,o.prepend(i),o}function rf(t,e,i="DefaultEnvironment"){var r,s;const a=(s=(r=Ye[i])==null?void 0:r[0])!=null?s:Ye.DefaultEnvironment[0],o={};for(let n=a.length-1;n>=0;n--)o[a[n]]={total:0,chroma:0,chromaOld:0};o[5]={total:e.length,chroma:0,chromaOld:0};for(let n=t.length-1;n>=0;n--)t[n].isValidType()&&(o[t[n].type]||(o[t[n].type]={total:0,chroma:0,chromaOld:0}),o[t[n].type].total++,t[n].hasChroma()&&o[t[n].type].chroma++,t[n].hasOldChroma()&&o[t[n].type].chromaOld++);return o}function of(t,e="DefaultEnvironment"){var o,r;const i=(r=(o=Ye[e])==null?void 0:o[1])!=null?r:Ye.DefaultEnvironment[1],a={};for(let s=i.length-1;s>=0;s--)a[i[s]]={total:0,eventBox:0,base:0};for(let s=t.length-1;s>=0;s--)a[t[s].groupID]||(a[t[s].groupID]={total:0,eventBox:0,base:0}),a[t[s].groupID].total++,a[t[s].groupID].eventBox+=t[s].events.length,a[t[s].groupID].base+=t[s].events.reduce((n,l)=>n+l.events.length,0);return a}function sf(t,e="DefaultEnvironment"){var o,r;const i=(r=(o=Ye[e])==null?void 0:o[1])!=null?r:Ye.DefaultEnvironment[1],a={};for(let s=i.length-1;s>=0;s--)a[i[s]]={total:0,eventBox:0,base:0};for(let s=t.length-1;s>=0;s--)a[t[s].groupID]||(a[t[s].groupID]={total:0,eventBox:0,base:0}),a[t[s].groupID].total++,a[t[s].groupID].eventBox+=t[s].events.length,a[t[s].groupID].base+=t[s].events.reduce((n,l)=>n+l.events.length,0);return a}function lf(t){const e={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>-1;i--)e.total++,t[i].isInteractive()&&e.interactive++,t[i].hasChroma()&&e.chroma++,t[i].hasNoodleExtensions()&&e.noodleExtensions++,t[i].hasMappingExtensions()&&e.mappingExtensions++;return e}function cf(t,e){switch(e){case"LinkinParkEnvironment":switch(t){case 0:return"Lane Light";case 1:return"Ceiling Lights";case 8:return"Laser Mode"}break;case"BTSEnvironment":switch(t){case 0:return"Door Light";case 1:return"Vertical Pillar Lights";case 8:return"Distant Tower Spin";case 9:return"Raise/Lower Pillars";case 40:return"BTS Event 1";case 41:return"BTS Event 2";case 42:return"BTS Event 3";case 43:return"BTS Event 4"}break;case"KaleidoscopeEnvironment":switch(t){case 0:return"Spike Tip Lights";case 1:return"Spike Mid Lights";case 2:return"Spike Left Lights";case 3:return"Spike Right Lights";case 4:return"Distant Lasers and Spike Top Lights"}break;case"InterscopeEnvironment":switch(t){case 0:return"Gate 1";case 1:return"Gate 2";case 2:return"Gate 3";case 3:return"Gate 4";case 4:return"Gate 5";case 6:return"Extra 1";case 7:return"Extra 2"}break;case"SkrillexEnvironment":switch(t){case 0:return"Logo";case 1:return"Top Lanes and 1st Ring Set";case 4:return"Bottom Lanes and 2nd Ring Set";case 6:return"Left Panel";case 7:return"Right Panel";case 12:return"Left Laser & Panel Speed";case 13:return"Right Laser & Panel Speed"}break;case"BillieEnvironment":switch(t){case 0:return"Water 4";case 1:return"Water 1";case 2:return"Left Sun Beams";case 3:return"Right Sun Beams";case 4:return"Sun";case 6:return"Water 2";case 7:return"Water 3";case 8:return"Toggle Rain";case 9:return"Sunbeam Mode";case 10:return"Left Bottom Lasers";case 11:return"Right Bottom Lasers";case 12:return"Left Sun Beams Speed";case 13:return"Right Sun Beams Speed"}break;case"HalloweenEnvironment":switch(t){case 0:return"Sky Lasers";case 1:return"Moon";case 4:return"Lane + Castle Interior"}break;case"GagaEnvironment":switch(t){case 0:return"Aurora 1";case 1:return"Aurora 2";case 2:return"Tower 1";case 3:return"Tower 2";case 4:return"Logo";case 6:return"Tower 3";case 7:return"Tower 4";case 10:return"Tower 5";case 11:return"Tower 6";case 14:return"Tower 1 Height";case 15:return"Tower 2 Height";case 16:return"Tower 3 Height";case 17:return"Tower 4 Height";case 18:return"Tower 5 Height";case 19:return"Tower 6 Height"}break;case"WeaveEnvironment":switch(t){case 4:return"Player Space"}break;case"PyroEnvironment":switch(t){case 0:return"Video Alpha";case 1:return"Logo";case 2:return"Left Projectors";case 3:return"Right Projectors";case 4:return"Platform";case 6:return"Ambient";case 40:return"Video Projection"}break;case"EDMEnvironment":switch(t){case 0:return"Lane Lights Bottom";case 1:return"Lane Lights Top";case 4:return"Player Space & Spectrogram"}break;case"TheSecondEnvironment":switch(t){case 0:return"Logo";case 1:return"Runway";case 2:return"Left Flags";case 3:return"Right Flags";case 4:return"Buildings"}break;case"LizzoEnvironment":switch(t){case 0:return"Runway Left";case 1:return"Runway Right";case 2:return"Left Ring";case 3:return"Right Ring";case 4:return"Top Square";case 6:return"Ambient";case 7:return"Cherry Left";case 8:return"Cherry Right";case 9:return"LI Sign";case 10:return"Z Left Sign";case 11:return"Z Right Sign";case 12:return"O Sign";case 16:return"Left Balloon Particles";case 17:return"Right Balloon Particles"}break}switch(t){case 0:return"Back Lasers";case 1:return"Ring Lights";case 2:return"Left Lasers";case 3:return"Right Lasers";case 4:return"Center Lights";case 5:return"Boost Colors";case 6:return"Extra Left Lights";case 7:return"Extra Right Lights";case 8:return"Ring Rotation";case 9:return"Ring Zoom";case 10:return"Extra Left Lasers";case 11:return"Extra Right Lasers";case 12:return"Left Laser Speed";case 13:return"Right Laser Speed";case 14:return"Early Lane Rotation";case 15:return"Late Lane Rotation";case 16:return"Utility Event 1";case 17:return"Utility Event 2";case 18:return"Utility Event 3";case 19:return"Utility Event 4";case 40:return"Special Event 1";case 41:return"Special Event 2";case 42:return"Special Event 3";case 43:return"Special Event 4";default:return"Unknown"}}function uf(t,e){switch(e){case"WeaveEnvironment":switch(t){case 0:return"Outer Square Bottom Left Laser";case 1:return"Outer Square Bottom Right Laser";case 2:return"Outer Square Top Left Laser";case 3:return"Outer Square Top Right Laser";case 4:return"Inner Square Bottom Left Laser";case 5:return"Inner Square Bottom Right Laser";case 6:return"Inner Square Top Left Laser";case 7:return"Inner Square Top Right Laser";case 8:return"Side Square Bottom Left Laser";case 9:return"Side Square Bottom Right Laser";case 10:return"Side Square Top Left Laser";case 11:return"Side Square Top Right Laser";case 12:return"Distant Square Top Laser";case 13:return"Distant Square Bottom Laser";case 14:return"Distant Square Left Laser";case 15:return"Distant Square Right Laser"}case"PyroEnvironment":switch(t){case 0:return"Left Stage Light";case 1:return"Right Stage Light";case 2:return"Top Left Laser";case 3:return"Top Right Laser";case 4:return"Top Middle Laser";case 5:return"Top Light";case 6:return"Left Light Tower";case 7:return"Right Light Tower";case 8:return"Stage Left Laser";case 9:return"Stage Right Laser";case 10:return"Stage Far Left Laser";case 11:return"Stage Far Right Laser";case 12:return"Left Flame";case 13:return"Right Flame"}case"EDMEnvironment":switch(t){case 0:return"Top Circle";case 1:return"Close Circle";case 2:return"Distant Circle";case 3:return"Distant Circle 2";case 4:return"Left Single Source Circle";case 5:return"Right Single Source Circle";case 6:return"Left Laser (Up)";case 7:return"Left Laser (Out)";case 8:return"Right Laser (Up)";case 9:return"Right Laser (Out)";case 10:return"Left Laser (Down)";case 11:return"Right Laser (Down)";case 12:return"Left Laser (Down) / Top Circle Rotation";case 13:return"Right Laser (Up) / Close Circle Rotation";case 14:return"Distant Circle Rotation";case 15:return"Distant Circle 2 Rotation";case 16:return"Left Single Source Circle Rotation";case 17:return"Right Single Source Circle Rotation"}case"TheSecondEnvironment":switch(t){case 0:return"Big Rings";case 1:return"Small Rings";case 2:return"Runway Left";case 3:return"Runway Right";case 4:return"Spotlight Left";case 5:return"Spotlight Right";case 6:return"Top Lasers Left Bottom";case 7:return"Top Lasers Right Bottom";case 8:return"Top Lasers Left Top";case 9:return"Top Lasers Right Top";case 10:return"Bottom Lasers Left Bottom";case 11:return"Bottom Lasers Right Bottom";case 12:return"Bottom Lasers Left Top";case 13:return"Bottom Lasers Right Top"}case"LizzoEnvironment":switch(t){case 0:return"Main Floor Color";case 1:return"Rainbow Arcs Inner Color";case 2:return"Rainbow Arcs 2 Color";case 3:return"Rainbow Arcs 3 Color";case 4:return"Rainbow Arcs 4 Color";case 5:return"Rainbow Arcs Outer Color";case 6:return"Rainbow Rings Left Rotation";case 7:return"Rainbow Rings Right Rotation";case 8:return"Rainbow Rings Lasers Left Color";case 9:return"Rainbow Rings Lasers Right Color";case 10:return"Main Top Lasers Color";case 11:return"Environment Stands Left Color";case 12:return"Environment Stands Right Color";case 13:return"Environment Clouds Left Color";case 14:return"Environment Clouds Right Color";case 15:return"Main Left Lasers Color";case 16:return"Main Right Lasers Color";case 17:return"Environment Stand Lasers Left Color";case 18:return"Environment Stand Lasers Right Color";case 19:return"Rainbow Arcs Laser Color"}default:return"Unknown"}}function hf(t,e){const i=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,a=rf(e.data.basicBeatmapEvents,e.data.colorBoostBeatmapEvents,i);let o=0,r=0,s=`<caption class="${x}table-caption">Events: ${Object.values(a).reduce((l,{total:c})=>l+c,0)}</caption>`;for(const l in a)o+=a[l].chroma,r+=a[l].chromaOld,s+=`<tr><th class="${x}table-header">${l}</th><th class="${x}table-header" colspan="4">${cf(parseInt(l),i)}</th><td class="${x}table-element">${a[l].total}</td></tr>`;o&&(s+=`<tr><th class="${x}table-header" colspan="5">Chroma</th><td class="${x}table-element">${o}</td></tr>`),r&&(s+=`<tr><th class="${x}table-header" colspan="5">OG Chroma</th><td class="${x}table-element">${r}</td></tr>`);const n=document.createElement("table");return n.className=x+"table",n.innerHTML=s,n}function df(t,e){const i=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,a=of(e.data.lightColorEventBoxGroups,i),o=sf(e.data.lightRotationEventBoxGroups,i);let r=`<caption class="${x}table-caption">Color Event Box Groups: <span title="${Object.values(a).reduce((n,{eventBox:l})=>n+l,0)} Box (${Object.values(a).reduce((n,{base:l})=>n+l,0)} Base)">${Object.values(a).reduce((n,{total:l})=>n+l,0)}</span><br>Rotation Event Box Groups: <span title="${Object.values(o).reduce((n,{eventBox:l})=>n+l,0)} Box (${Object.values(o).reduce((n,{base:l})=>n+l,0)} Base)">${Object.values(o).reduce((n,{total:l})=>n+l,0)}</span></caption>`;for(const n in a)r+=`<tr><th class="${x}table-header">${n}</th><th class="${x}table-header" colspan="4">${uf(parseInt(n),i)}</th><td class="${x}table-element" title="${a[n].eventBox} Box (${a[n].base} Base)">${a[n].total}</td><td class="${x}table-element" title="${o[n].eventBox} Box (${o[n].base} Base)">${o[n].total}</td></tr>`;const s=document.createElement("table");return s.className=x+"table",s.innerHTML=r,s}const ff=115;function mf(t){let e=0,i=1;for(let a=0,o=t.filter(r=>r.type==="note"&&!(typeof r.data.customData.uninteractable<"u"||!r.data.customData.uninteractable)).length;a<o;a++)i<8&&a===-3+i*4&&(i*=2),e+=ff*i;return e}function pf(t,e){const i=xn(e.data.colorNotes);let a=`<caption class="${x}table-caption">Note Information:</caption><tr><th class="${x}table-header" colspan="2">R/B Ratio</th><td class="${x}table-element">${B(i.red.total/i.blue.total,2)}</td></tr><tr><th class="${x}table-header" colspan="2">Max Score</th><td class="${x}table-element">${Yc(mf(e.noteContainer))}</td></tr><tr><th class="${x}table-header" colspan="2">Effective BPM</th><td class="${x}table-element">${B(mu(e.swingAnalysis.container),2)}</td></tr><tr><th class="${x}table-header" colspan="2">Effective BPM (swing)</th><td class="${x}table-element">${B(pu(e.swingAnalysis.container),2)}</td></tr>`,o=B(wu(e.swingAnalysis.container)*1e3,1),r=B(Su(e.swingAnalysis.container)*1e3,1);o&&r&&(a+=`<tr><th class="${x}table-header" colspan="2">Min. Slider Speed</th><td class="${x}table-element">${o}ms</td></tr><tr><th class="${x}table-header" colspan="2">Max. Slider Speed</th><td class="${x}table-element">${r}ms</td></tr>`);const s=document.createElement("table");return s.className=x+"table",s.innerHTML=a,s}function _f(t,e){const i=xn(e.data.colorNotes),a=xn(e.data.sliders),o=xn(e.data.burstSliders),r=Kd(e.data.bombNotes);let s=`<caption class="${x}table-caption">Note Count:</caption><tr><th class="${x}table-header"></th><th class="${x}table-header">Note</th><th class="${x}table-header">Arc</th><th class="${x}table-header">Chain</th><th class="${x}table-header">Bomb</th></tr><tr><th class="${x}table-header">Total</th><td class="${x}table-element">${i.red.total+i.blue.total}</td><td class="${x}table-element">${a.red.total+a.blue.total}</td><td class="${x}table-element">${o.red.total+o.blue.total}</td><td class="${x}table-element">${r.total}</td></tr><tr><th class="${x}table-header">Red</th><td class="${x}table-element">${i.red.total}</td><td class="${x}table-element">${a.red.total}</td><td class="${x}table-element">${o.red.total}</td><td class="${x}table-element">0</td></tr><tr><th class="${x}table-header">Blue</th><td class="${x}table-element">${i.blue.total}</td><td class="${x}table-element">${a.blue.total}</td><td class="${x}table-element">${o.blue.total}</td><td class="${x}table-element">0</td></tr>`;(i.red.chroma||i.blue.chroma||a.red.chroma||a.blue.chroma||o.red.chroma||o.blue.chroma||r.chroma)&&(s+=`<tr><th class="${x}table-header">Chroma</th><td class="${x}table-element">${i.red.chroma+i.blue.chroma}</td><td class="${x}table-element">${a.red.chroma+a.blue.chroma}</td><td class="${x}table-element">${o.red.chroma+o.blue.chroma}</td><td class="${x}table-element">${r.chroma}</td></tr>`),(i.red.noodleExtensions||i.blue.noodleExtensions||a.red.noodleExtensions||a.blue.noodleExtensions||o.red.noodleExtensions||o.blue.noodleExtensions||r.noodleExtensions)&&(s+=`<tr><th class="${x}table-header">NE</th><td class="${x}table-element">${i.red.noodleExtensions+i.blue.noodleExtensions}</td><td class="${x}table-element">${a.red.noodleExtensions+a.blue.noodleExtensions}</td><td class="${x}table-element">${o.red.noodleExtensions+o.blue.noodleExtensions}</td><td class="${x}table-element">${r.noodleExtensions}</td></tr></tr>`),(i.red.mappingExtensions||i.blue.mappingExtensions||a.red.mappingExtensions||a.blue.mappingExtensions||o.red.mappingExtensions||o.blue.mappingExtensions||r.mappingExtensions)&&(s+=`<tr><th class="${x}table-header">ME</th><td class="${x}table-element">${i.red.mappingExtensions+i.blue.mappingExtensions}</td><td class="${x}table-element">${a.red.mappingExtensions+a.blue.mappingExtensions}</td><td class="${x}table-element">${o.red.mappingExtensions+o.blue.mappingExtensions}</td><td class="${x}table-element">${r.mappingExtensions}</td></tr></tr>`);const n=document.createElement("table");return n.className=x+"table",n.innerHTML=s,n}function gf(t){var l;const e=t.target,i=e.id.replace(`${x}table-select-placement-`,"").split("-"),a=i[0],o=i[1],r=(l=lt.beatmapDifficulty.find(c=>c.characteristic===a&&c.difficulty===o))==null?void 0:l.noteContainer;if(!r){console.error(di+"note could not be found");return}const s=xc(r,e.value),n=document.querySelector(`#${x}table-placement-${a}-${o}`);if(!n){console.error(di+"table could not be found");return}n.innerHTML=Ic(s)}function Ic(t){const e=t.length||1;let i="";for(let a=2;a>=0;a--){i+="<tr>";for(let o=0;o<=3;o++)i+=`<td class="${x}table-element">${tf(t,o,a)}</td>`;i+=`<td class="${x}table-element ${x}table--no-border">${B(Qd(t,a)/e*100,1)}%</td>
        </tr>`}return i+=`<tr><td class="${x}table-element ${x}table--no-border">${B(pn(t,0)/e*100,1)}%</td><td class="${x}table-element ${x}table--no-border">${B(pn(t,1)/e*100,1)}%</td><td class="${x}table-element ${x}table--no-border">${B(pn(t,2)/e*100,1)}%</td><td class="${x}table-element ${x}table--no-border">${B(pn(t,3)/e*100,1)}%</td></tr>`,i}function bf(t,e){var r;const i=on.create(`${x}table-select-placement-${e.characteristic}-${e.difficulty}`,"Note Placement: ","caption",`${x}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"},{text:"Bomb",value:"bomb"});(r=i.querySelector("select"))==null||r.addEventListener("change",gf);let a=`<tbody id="${x}table-placement-${e.characteristic}-${e.difficulty}">${Ic(e.noteContainer)}</tbody>`;const o=document.createElement("table");return o.className=x+"table",o.innerHTML=a,o.prepend(i),o}function yf(t,e){const i=lf(e.data.obstacles);let a=`<caption class="${x}table-caption">Obstacles: ${i.total}</caption>`;i.interactive&&(a+=`<tr><th class="${x}table-header" colspan="2">Interactive</th><td class="${x}table-element">${i.interactive}</td></tr>`),i.chroma&&(a+=`<tr><th class="${x}table-header" colspan="2">Chroma</th><td class="${x}table-element">${i.chroma}</td></tr>`),i.noodleExtensions&&(a+=`<tr><th class="${x}table-header" colspan="2">Noodle Extensions</th><td class="${x}table-element">${i.noodleExtensions}</td></tr>`),i.mappingExtensions&&(a+=`<tr><th class="${x}table-header" colspan="2">Mapping Extensions</th><td class="${x}table-element">${i.mappingExtensions}</td></tr>`);const o=document.createElement("table");return o.className=x+"table",o.innerHTML=a,o}const Rn=document.querySelector("#stats .accordion__collapsible");function vf(){if(!lt.beatmapInfo)throw new Error(di+"map info could not be found in savedData");const t=lt.beatmapInfo;t._difficultyBeatmapSets.forEach(e=>{var o,r;const i=document.createElement("div");i.className=x+"mode-"+e._beatmapCharacteristicName;const a=document.createElement("div");a.className=x+"title",a.textContent=dr[e._beatmapCharacteristicName],i.appendChild(a);for(let s=e._difficultyBeatmaps.length-1;s>=0;s--){const n=e._difficultyBeatmaps[s],l=lt.beatmapDifficulty.find(_=>_.characteristic===e._beatmapCharacteristicName&&_.difficulty===n._difficulty);if(!l)throw new Error(di+"Could not find map data");const c=ys.create(`${x}${e._beatmapCharacteristicName}-${n._difficulty}`,de[n._difficulty]+((o=n._customData)!=null&&o._difficultyLabel?" -- "+((r=n._customData)==null?void 0:r._difficultyLabel):""),n._difficulty,!0),h=c.querySelector(".accordion__collapsible-flex"),f=c.querySelector(".accordion__button");if(!h||!f)throw new Error(di+"something went wrong!");f.checked=Q.onLoad.stats;const p=zi.create("small","half"),u=zi.create("small","half"),m=zi.create("small","half");p.append(qd(t,l)),p.append(document.createElement("br")),p.append(Jd(t,l)),p.append(document.createElement("br")),p.append(Zd(t,l)),u.append(pf(t,l)),u.append(document.createElement("br")),u.append(_f(t,l)),u.append(document.createElement("br")),u.append(bf(t,l)),u.append(document.createElement("br")),u.append(af(t,l)),m.append(hf(t,l)),m.append(document.createElement("br")),m.append(df(t,l)),m.append(document.createElement("br")),m.append(yf(t,l)),h.appendChild(p),h.appendChild(u),h.appendChild(m),i.appendChild(c)}Rn.appendChild(i)})}function Ef(){for(;Rn.firstChild;)Rn.removeChild(Rn.firstChild)}function hs(t){var i,a,o,r,s,n,l,c,h,f,p,u,m,_;if(!t)return{};const e=St(t);return Object.keys(e).length?((i=e.color)!=null||(e.color=e._color),(a=e.coordinates)!=null||(e.coordinates=e._position),(o=e.disableNoteGravity)!=null||(e.disableNoteGravity=e._disableNoteGravity),(r=e.disableNoteLook)!=null||(e.disableNoteLook=e._disableNoteLook),(s=e.flip)!=null||(e.flip=e._flip),(n=e.localRotation)!=null||(e.localRotation=e._localRotation),(l=e.noteJumpMovementSpeed)!=null||(e.noteJumpMovementSpeed=e._noteJumpMovementSpeed),(c=e.noteJumpStartBeatOffset)!=null||(e.noteJumpStartBeatOffset=e._noteJumpStartBeatOffset),(h=e.spawnEffect)!=null||(e.spawnEffect=typeof e._disableSpawnEffect=="boolean"?!e._disableSpawnEffect:void 0),(f=e.size)!=null||(e.size=e._scale),(p=e.track)!=null||(e.track=e._track),(u=e.uninteractable)!=null||(e.uninteractable=typeof e._interactable=="boolean"?!e._interactable:void 0),(m=e.worldRotation)!=null||(e.worldRotation=e._rotation),e._animation&&((_=e.animation)!=null||(e.animation={color:e._animation._color,definitePosition:e._animation._definitePosition,dissolve:e._animation._dissolve,dissolveArrow:e._animation._dissolveArrow,interactable:e._animation._interactable,localRotation:e._animation._localRotation,offsetPosition:e._animation._position,offsetRotation:e._animation._rotation,scale:e._animation._scale,time:e._animation._time})),delete e._color,delete e._position,delete e._disableNoteGravity,delete e._disableNoteLook,delete e._flip,delete e._cutDirection,delete e._localRotation,delete e._noteJumpMovementSpeed,delete e._noteJumpStartBeatOffset,delete e._disableSpawnEffect,delete e._scale,delete e._track,delete e._interactable,delete e._rotation,delete e._animation,e):{}}function wf(t){var a,o,r,s,n,l,c,h,f,p,u,m;if(!t)return{};const e=St(t);if(!Object.keys(e).length)return{};const i=(a=e._preciseSpeed)!=null?a:e._speed;return(o=e.color)!=null||(e.color=e._color),(r=e.lightID)!=null||(e.lightID=e._lightID),(s=e.easing)!=null||(e.easing=e._easing),(n=e.lerpType)!=null||(e.lerpType=e._lerpType),(l=e.nameFilter)!=null||(e.nameFilter=e._nameFilter),(c=e.rotation)!=null||(e.rotation=e._rotation),(h=e.step)!=null||(e.step=e._step),(f=e.prop)!=null||(e.prop=e._prop),(p=e.speed)!=null||(e.speed=i),(u=e.direction)!=null||(e.direction=e._direction),(m=e.lockRotation)!=null||(e.lockRotation=e._lockPosition),delete e._color,delete e._lightID,delete e._easing,delete e._lerpType,delete e._propID,delete e._lightGradient,delete e._nameFilter,delete e._rotation,delete e._step,delete e._prop,delete e._speed,delete e._preciseSpeed,delete e._direction,delete e._reset,delete e._counterSpin,delete e._stepMult,delete e._propMult,delete e._speedMult,delete e._lockPosition,e}const ne=t=>`[convert::${t}]`;function Sf(t,e){var a,o,r,s;if(e)nt.warn(ne("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!");else{if(nt.warn(ne("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!"),prompt("Proceed with conversion? (y/N):","n")[0].toLowerCase()!=="y")throw Error("Conversion to beatmap v3 denied.");nt.info(ne("V2toV3"),"Converting beatmap v2 to v3")}const i=mc.create();if(i.fileName=t.fileName,i.customData.fakeBombNotes=[],i.customData.fakeColorNotes=[],i.customData.fakeObstacles=[],t.notes.forEach((n,l)=>{const c=hs(n.customData);if(typeof n.customData._cutDirection=="number"&&nt.debug(ne("V2toV3"),`notes[${l}] at time ${n.time} NE _cutDirection will be converted.`),n.isBomb()&&(n.customData._fake?i.customData.fakeBombNotes.push(Ei.create({b:n.time,x:n.posX,y:n.posY,customData:c})[0].toJSON()):i.bombNotes.push(Ei.create({b:n.time,x:n.posX,y:n.posY,customData:c})[0])),n.isNote()){let h=0;typeof n.customData._cutDirection=="number"?h=n.customData._cutDirection>0?n.customData._cutDirection%360:360+n.customData._cutDirection%360:n.direction>=1e3&&(h=Math.abs(n.direction%1e3%360-360)),n.customData._fake?i.customData.fakeColorNotes.push(Ie.create({b:n.time,c:n.type,x:n.posX,y:n.posY,d:n.direction>=1e3||typeof n.customData._cutDirection=="number"?n.direction===8?8:1:Tr(n.direction,0,8),a:h,customData:c})[0].toJSON()):i.colorNotes.push(Ie.create({b:n.time,c:n.type,x:n.posX,y:n.posY,d:n.direction>=1e3||typeof n.customData._cutDirection=="number"?n.direction===8?8:1:Tr(n.direction,0,8),a:h,customData:c})[0])}}),t.obstacles.forEach(n=>{const l=hs(n.customData);n.customData._fake?i.customData.fakeObstacles.push(Zt.create({b:n.time,x:n.posX,y:n.type===2?n.posY:n.type?2:0,d:n.duration,w:n.width,h:n.type===2?n.height:n.type?3:5,customData:l})[0].toJSON()):i.obstacles.push(Zt.create({b:n.time,x:n.posX,y:n.type===2?n.posY:n.type?2:0,d:n.duration,w:n.width,h:n.type===2?n.height:n.type?3:5,customData:l})[0])}),t.events.forEach((n,l)=>{var c;if(n.isColorBoost())i.colorBoostBeatmapEvents.push(Gi.create({b:n.time,o:!!n.value})[0]);else if(n.isLaneRotationEvent())i.rotationEvents.push(Wi.create({b:n.time,e:n.type===14?0:1,r:typeof n.customData._rotation=="number"?n.customData._rotation:n.value>=1e3?(n.value-1360)%360:(c=gu[n.value])!=null?c:0})[0]);else if(n.isBPMChangeEvent())i.bpmEvents.push(ji.create({b:n.time,m:n.floatValue})[0]);else{const h=wf(n.customData);n.isLightEvent()&&(n.customData._propID&&nt.warn(ne("V2toV3"),`events[${l}] at time ${n.time} Chroma _propID will be removed.`),n.customData._lightGradient&&nt.warn(ne("V2toV3"),`events[${l}] at time ${n.time} Chroma _lightGradient will be removed.`)),n.isRingEvent()&&(n.customData._reset&&nt.warn(ne("V2toV3"),`events[${l}] at time ${n.time} Chroma _reset will be removed.`),n.customData._counterSpin&&nt.warn(ne("V2toV3"),`events[${l}] at time ${n.time} Chroma _counterSpin will be removed.`),(n.customData._stepMult||n.customData._propMult||n.customData._speedMult)&&nt.warn(ne("V2toV3"),`events[${l}] at time ${n.time} Chroma _mult will be removed.`)),i.basicBeatmapEvents.push(Ui.create({b:n.time,et:n.type,i:n.value,f:n.floatValue,customData:h})[0])}}),t.waypoints.forEach(n=>{i.waypoints.push(Ji.create({b:n.time,x:n.posX,y:n.posY,d:n.direction})[0])}),t.sliders.forEach(n=>i.sliders.push(Vi.create({c:n.colorType,b:n.headTime,x:n.headPosX,y:n.headPosY,d:n.headDirection,mu:n.headLengthMultiplier,tb:n.tailTime,tx:n.tailPosX,ty:n.tailPosY,tc:n.tailDirection,tmu:n.tailLengthMultiplier,m:n.midAnchor})[0])),i.basicEventTypesWithKeywords=fr.create({d:(r=(o=(a=t.specialEventsKeywordFilters)==null?void 0:a.keywords)==null?void 0:o.map(n=>({k:n.keyword,e:n.events})))!=null?r:[]}),t.customData)for(const n in t.customData){if(n==="_customEvents"){i.customData.customEvents=[],t.customData._customEvents.forEach(l=>{var c,h,f,p,u;l._type==="AnimateTrack"&&((c=i.customData.customEvents)==null||c.push({b:l._time,t:"AnimateTrack",d:{track:l._data._track,duration:l._data._duration,easing:l._data._easing,position:l._data._position,rotation:l._data._rotation,localRotation:l._data._localRotation,scale:l._data._scale,dissolve:l._data._dissolve,dissolveArrow:l._data._dissolveArrow,color:l._data._color,interactable:l._data._interactable,time:l._data._time}})),l._type==="AssignPathAnimation"&&((h=i.customData.customEvents)==null||h.push({b:l._time,t:"AssignPathAnimation",d:{track:l._data._track,easing:l._data._easing,position:l._data._position,rotation:l._data._rotation,localRotation:l._data._localRotation,scale:l._data._scale,dissolve:l._data._dissolve,dissolveArrow:l._data._dissolveArrow,color:l._data._color,interactable:l._data._interactable,definitePosition:l._data._definitePosition}})),l._type==="AssignTrackParent"&&((f=i.customData.customEvents)==null||f.push({b:l._time,t:"AssignTrackParent",d:{childrenTracks:l._data._childrenTracks,parentTrack:l._data._parentTrack,worldPositionStays:l._data._worldPositionStays}})),l._type==="AssignPlayerToTrack"&&((p=i.customData.customEvents)==null||p.push({b:l._time,t:"AssignPlayerToTrack",d:{track:l._data._track,playerTrackObject:l._data._playerTrackObject}})),l._type==="AssignFogTrack"&&((u=i.customData.customEvents)==null||u.push({b:l._time,t:"AnimateComponent",d:{track:l._data._track,duration:l._data._duration||0,BloomFogEnvironment:{attenuation:typeof l._data._attenuation=="number"?[[l._data._attenuation,0]]:l._data._attenuation,height:typeof l._data._height=="number"?[[l._data._height,0]]:l._data._height,offset:typeof l._data._offset=="number"?[[l._data._offset,0]]:l._data._offset,startY:typeof l._data._startY=="number"?[[l._data._startY,0]]:l._data._startY}}}))});continue}if(n==="_environment"){i.customData.environment=t.customData._environment.map(l=>{var h,f,p,u;let c={};if(l._lightID&&(c={ILightWithId:{lightID:l._lightID}}),l._id&&l._lookupMethod)return{id:l._id,lookupMethod:l._lookupMethod,track:l._track,duplicate:l._duplicate,active:l._active,scale:l._scale,position:(h=l._position)==null?void 0:h.map(m=>m*.6),rotation:l._rotation,localPosition:(f=l._localPosition)==null?void 0:f.map(m=>m*.6),localRotation:l._localRotation,components:c};if(l._geometry)return l._lightID&&c.ILightWithId&&(c.ILightWithId.type=0),{geometry:l._geometry._type==="CUSTOM"?{type:l._geometry._type,mesh:{vertices:l._geometry._mesh._vertices,uv:l._geometry._mesh._uv,triangles:l._geometry._mesh._triangles},material:typeof l._geometry._material=="string"?l._geometry._material:{shader:l._geometry._material._shader,shaderKeywords:l._geometry._material._shaderKeywords,collision:l._geometry._material._collision,track:l._geometry._material._track,color:l._geometry._material._color},collision:l._geometry._collision}:{type:l._geometry._type,material:typeof l._geometry._material=="string"?l._geometry._material:{shader:l._geometry._material._shader,shaderKeywords:l._geometry._material._shaderKeywords,collision:l._geometry._material._collision,track:l._geometry._material._track,color:l._geometry._material._color},collision:l._geometry._collision},track:l._track,duplicate:l._duplicate,active:l._active,scale:l._scale,position:(p=l._position)==null?void 0:p.map(m=>m*.6),rotation:l._rotation,localPosition:(u=l._localPosition)==null?void 0:u.map(m=>m*.6),localRotation:l._localRotation,components:c};throw new Error("Error converting environment v2 to v3")});continue}if(n==="_materials"){i.customData.materials={};for(const l in t.customData._materials)i.customData.materials[l]={shader:t.customData._materials[l]._shader,shaderKeywords:t.customData._materials[l]._shaderKeywords,collision:t.customData._materials[l]._collision,track:t.customData._materials[l]._track,color:t.customData._materials[l]._color};continue}if(n==="_pointDefinitions"){i.customData.pointDefinitions={},t.customData._pointDefinitions.forEach(l=>{i.customData.pointDefinitions[l._name]=l._points});continue}if(n==="_time"){i.customData.time=t.customData[n];continue}if(n==="_BPMChanges"){i.customData.BPMChanges=t.customData[n];continue}if(n==="_bpmChanges"){i.customData.BPMChanges=(s=t.customData[n])==null?void 0:s.map(l=>({_time:l._time,_BPM:l._bpm,_beatsPerBar:l._beatsPerBar,_metronomeOffset:l._metronomeOffset}));continue}if(n==="_bookmarks"){i.customData.bookmarks=t.customData[n];continue}i.customData[n]=t.customData[n]}if(i.customData.environment){const n=[];for(const c of i.customData.environment)c.track&&n.push(c.track);const l=[];if(i.customData.customEvents){for(const c of i.customData.customEvents)if(c.t==="AnimateTrack"){if(typeof c.d.track=="string"&&n.includes(c.d.track))l.push(c);else if(Array.isArray(c.d.track)){for(const h of c.d.track)if(n.includes(h)){l.push(c);break}}}}for(const c of l)typeof c.d.track=="string"?typeof c.d.position=="string"?nt.warn(ne("V2toV3"),"Cannot convert point definitions, unknown use."):Array.isArray(c.d.position)&&c.d.position.forEach(h=>{h[0]*=.6,h[1]*=.6,h[2]*=.6}):nt.warn(ne("V2toV3"),"Environment animate track array conversion not yet implemented.")}return i.useNormalEventsAsCompatibleEvents=!0,i}const Xi=t=>`[load::${t}]`;async function Df(t){const e=t.file("Info.dat")||t.file("info.dat");if(!e)throw new Error("Couldn't find Info.dat");return nt.info(Xi("loadInfo"),"loading info"),nd(JSON.parse(await e.async("string")))}async function Tf(t,e){var o,r,s,n,l,c;const i=[],a=t._difficultyBeatmapSets;for(let h=a.length-1;h>=0;h--){const f=a[h]._difficultyBeatmaps;if(f.length===0||!f){nt.error(Xi("loadDifficulty"),"Empty difficulty set, removing..."),a.splice(h,1);continue}for(let p=0;p<f.length;p++){const u=f[p],m=e.file(u._beatmapFilename);if(m){nt.info(Xi("loadDifficulty"),`Loading ${a[h]._beatmapCharacteristicName} ${u._difficulty}`);let _;try{_=JSON.parse(await m.async("string"))}catch(b){throw new Error(`${a[h]._beatmapCharacteristicName} ${u._difficulty} ${b}`)}try{if(_._notes&&_.version&&nt.error(Xi("loadDifficulty"),`${a[h]._beatmapCharacteristicName} ${u._difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`),_.version){const b=Nd(_),y=Ae.create(t._beatsPerMinute,[...(o=b.customData.BPMChanges)!=null?o:[],...b.bpmEvents.map(v=>v.toJSON())],(r=u._customData)==null?void 0:r._editorOffset);i.push({info:u,characteristic:a[h]._beatmapCharacteristicName,difficulty:u._difficulty,bpm:y,data:b,noteContainer:b.getNoteContainer(),eventContainer:b.getEventContainer(),swingAnalysis:Hr(b,y,a[h]._beatmapCharacteristicName,u._difficulty),rawVersion:3,rawData:_})}else{const b=Sf(dd(_),!0),y=Ae.create(t._beatsPerMinute,(l=(s=_._customData)==null?void 0:s._BPMChanges)!=null?l:(n=_._customData)==null?void 0:n._bpmChanges,(c=u._customData)==null?void 0:c._editorOffset);i.push({info:u,characteristic:a[h]._beatmapCharacteristicName,difficulty:u._difficulty,bpm:y,data:b,noteContainer:b.getNoteContainer(),eventContainer:b.getEventContainer(),swingAnalysis:Hr(b,y,a[h]._beatmapCharacteristicName,u._difficulty),rawVersion:2,rawData:_})}}catch(b){throw new Error(`${a[h]._beatmapCharacteristicName} ${u._difficulty} ${b}`)}}else if(nt.error(Xi("loadDifficulty"),`Missing ${u._beatmapFilename} file for ${a[h]._beatmapCharacteristicName} ${u._difficulty}, ignoring.`),a[h]._difficultyBeatmaps.splice(p,1),p--,a[h]._difficultyBeatmaps.length<1){nt.error(`${a[h]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),a.splice(h,1);continue}}}return i}async function Nc(t){return new Promise(function(e,i){const a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="json",a.timeout=5e3;let o=Date.now();a.onprogress=()=>{a.timeout+=Date.now()-o},a.onload=()=>{a.status===200&&e(a.response),a.status===404&&i("Error 404: Map does not exist"),a.status===403&&i("Error 403: Forbidden"),i(`Error ${a.status}`)},a.onerror=()=>{i("Error downloading")},a.ontimeout=()=>{i("Connection timeout")},a.send()})}async function Cf(t){const e=`https://api.beatsaver.com/maps/id/${t}`,i=await Nc(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}async function Lf(t){const e=`https://api.beatsaver.com/maps/hash/${t}`,i=await Nc(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}const an=t=>`[download::${t}]`;async function mr(t){return new Promise(function(e,i){const a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="arraybuffer",a.timeout=5e3;let o=Date.now();a.onprogress=r=>{a.timeout+=Date.now()-o,bt.status("download",`Downloading map: ${B(r.loaded/1024/1024,1)}MB / ${B(r.total/1024/1024,1)}MB`,r.loaded/r.total*100)},a.onload=()=>{a.status===200&&e(a.response),a.status===404&&i("Error 404: Map/link does not exist"),a.status===403&&i("Error 403: Forbidden"),i(`Error ${a.status}`)},a.onerror=()=>{i("Error downloading")},a.ontimeout=()=>{i("Connection timeout")},a.send()})}async function Ac(t){const e=ws(t);nt.info(an("downloadFromID"),`fetching download URL from BeatSaver for map ID ${e}`),bt.status("info","Fetching download URL from BeatSaver",0);const i=await Cf(e);nt.info(an("downloadFromID"),`downloading from BeatSaver for map ID ${e}`),bt.status("info","Requesting download from BeatSaver",0);const a=await mr(i);return zt.setCoverLink("https://beatsaver.com/maps/"+e,e),a}async function kf(t){const e=Es(t);if(e.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return Ac(e.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);bt.status("info","Requesting download from link",0),nt.info(an("downloadFromURL"),`downloading from ${e}`);let i=await mr("https://cors.bsmg.dev/"+e);return zt.setCoverLink(e),i}async function xf(t){let e;if(vs(t.trim()))e=t.trim();else throw new Error("invalid hash");nt.info(an("downloadFromHash"),`fetching download URL from BeatSaver for map hash ${e}`),bt.status("info","Fetching download URL from BeatSaver",0);const i=await Lf(e);return nt.info(an("downloadFromHash"),`downloading from BeatSaver for map hash ${e}`),bt.status("info","Requesting download from BeatSaver",0),await mr(i)}var _n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gn(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bc={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(i){t.exports=i()})(function(){return function i(a,o,r){function s(c,h){if(!o[c]){if(!a[c]){var f=typeof gn=="function"&&gn;if(!h&&f)return f(c,!0);if(n)return n(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var u=o[c]={exports:{}};a[c][0].call(u.exports,function(m){var _=a[c][1][m];return s(_||m)},u,u.exports,i,a,o,r)}return o[c].exports}for(var n=typeof gn=="function"&&gn,l=0;l<r.length;l++)s(r[l]);return s}({1:[function(i,a,o){var r=i("./utils"),s=i("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(l){for(var c,h,f,p,u,m,_,b=[],y=0,v=l.length,D=v,C=r.getTypeOf(l)!=="string";y<l.length;)D=v-y,f=C?(c=l[y++],h=y<v?l[y++]:0,y<v?l[y++]:0):(c=l.charCodeAt(y++),h=y<v?l.charCodeAt(y++):0,y<v?l.charCodeAt(y++):0),p=c>>2,u=(3&c)<<4|h>>4,m=1<D?(15&h)<<2|f>>6:64,_=2<D?63&f:64,b.push(n.charAt(p)+n.charAt(u)+n.charAt(m)+n.charAt(_));return b.join("")},o.decode=function(l){var c,h,f,p,u,m,_=0,b=0,y="data:";if(l.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var v,D=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===n.charAt(64)&&D--,l.charAt(l.length-2)===n.charAt(64)&&D--,D%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=s.uint8array?new Uint8Array(0|D):new Array(0|D);_<l.length;)c=n.indexOf(l.charAt(_++))<<2|(p=n.indexOf(l.charAt(_++)))>>4,h=(15&p)<<4|(u=n.indexOf(l.charAt(_++)))>>2,f=(3&u)<<6|(m=n.indexOf(l.charAt(_++))),v[b++]=c,u!==64&&(v[b++]=h),m!==64&&(v[b++]=f);return v}},{"./support":30,"./utils":32}],2:[function(i,a,o){var r=i("./external"),s=i("./stream/DataWorker"),n=i("./stream/Crc32Probe"),l=i("./stream/DataLengthProbe");function c(h,f,p,u,m){this.compressedSize=h,this.uncompressedSize=f,this.crc32=p,this.compression=u,this.compressedContent=m}c.prototype={getContentWorker:function(){var h=new s(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),f=this;return h.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new s(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,f,p){return h.pipe(new n).pipe(new l("uncompressedSize")).pipe(f.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",f)},a.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,a,o){var r=i("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},o.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,a,o){var r=i("./utils"),s=function(){for(var n,l=[],c=0;c<256;c++){n=c;for(var h=0;h<8;h++)n=1&n?3988292384^n>>>1:n>>>1;l[c]=n}return l}();a.exports=function(n,l){return n!==void 0&&n.length?r.getTypeOf(n)!=="string"?function(c,h,f,p){var u=s,m=p+f;c^=-1;for(var _=p;_<m;_++)c=c>>>8^u[255&(c^h[_])];return-1^c}(0|l,n,n.length,0):function(c,h,f,p){var u=s,m=p+f;c^=-1;for(var _=p;_<m;_++)c=c>>>8^u[255&(c^h.charCodeAt(_))];return-1^c}(0|l,n,n.length,0):0}},{"./utils":32}],5:[function(i,a,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(i,a,o){var r=null;r=typeof Promise<"u"?Promise:i("lie"),a.exports={Promise:r}},{lie:37}],7:[function(i,a,o){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=i("pako"),n=i("./utils"),l=i("./stream/GenericWorker"),c=r?"uint8array":"array";function h(f,p){l.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=p,this.meta={}}o.magic="\b\0",n.inherits(h,l),h.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(c,f.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(p){f.push({data:p,meta:f.meta})}},o.compressWorker=function(f){return new h("Deflate",f)},o.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,a,o){function r(u,m){var _,b="";for(_=0;_<m;_++)b+=String.fromCharCode(255&u),u>>>=8;return b}function s(u,m,_,b,y,v){var D,C,L=u.file,P=u.compression,M=v!==c.utf8encode,Y=n.transformTo("string",v(L.name)),$=n.transformTo("string",c.utf8encode(L.name)),j=L.comment,K=n.transformTo("string",v(j)),S=n.transformTo("string",c.utf8encode(j)),R=$.length!==L.name.length,g=S.length!==j.length,H="",ot="",U="",st=L.dir,G=L.date,at={crc32:0,compressedSize:0,uncompressedSize:0};m&&!_||(at.crc32=u.crc32,at.compressedSize=u.compressedSize,at.uncompressedSize=u.uncompressedSize);var N=0;m&&(N|=8),M||!R&&!g||(N|=2048);var I=0,it=0;st&&(I|=16),y==="UNIX"?(it=798,I|=function(J,Dt){var $t=J;return J||($t=Dt?16893:33204),(65535&$t)<<16}(L.unixPermissions,st)):(it=20,I|=function(J){return 63&(J||0)}(L.dosPermissions)),D=G.getUTCHours(),D<<=6,D|=G.getUTCMinutes(),D<<=5,D|=G.getUTCSeconds()/2,C=G.getUTCFullYear()-1980,C<<=4,C|=G.getUTCMonth()+1,C<<=5,C|=G.getUTCDate(),R&&(ot=r(1,1)+r(h(Y),4)+$,H+="up"+r(ot.length,2)+ot),g&&(U=r(1,1)+r(h(K),4)+S,H+="uc"+r(U.length,2)+U);var q="";return q+=`
\0`,q+=r(N,2),q+=P.magic,q+=r(D,2),q+=r(C,2),q+=r(at.crc32,4),q+=r(at.compressedSize,4),q+=r(at.uncompressedSize,4),q+=r(Y.length,2),q+=r(H.length,2),{fileRecord:f.LOCAL_FILE_HEADER+q+Y+H,dirRecord:f.CENTRAL_FILE_HEADER+r(it,2)+q+r(K.length,2)+"\0\0\0\0"+r(I,4)+r(b,4)+Y+H+K}}var n=i("../utils"),l=i("../stream/GenericWorker"),c=i("../utf8"),h=i("../crc32"),f=i("../signature");function p(u,m,_,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=_,this.encodeFileName=b,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(p,l),p.prototype.push=function(u){var m=u.meta.percent||0,_=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,l.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:_?(m+100*(_-b-1))/_:100}}))},p.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var m=this.streamFiles&&!u.file.dir;if(m){var _=s(u,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(u){this.accumulate=!1;var m=this.streamFiles&&!u.file.dir,_=s(u,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),m)this.push({data:function(b){return f.DATA_DESCRIPTOR+r(b.crc32,4)+r(b.compressedSize,4)+r(b.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var u=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var _=this.bytesWritten-u,b=function(y,v,D,C,L){var P=n.transformTo("string",L(C));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(y,2)+r(y,2)+r(v,4)+r(D,4)+r(P.length,2)+P}(this.dirRecords.length,_,u,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(u){this._sources.push(u);var m=this;return u.on("data",function(_){m.processChunk(_)}),u.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),u.on("error",function(_){m.error(_)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(u){var m=this._sources;if(!l.prototype.error.call(this,u))return!1;for(var _=0;_<m.length;_++)try{m[_].error(u)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var u=this._sources,m=0;m<u.length;m++)u[m].lock()},a.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,a,o){var r=i("../compressions"),s=i("./ZipFileWorker");o.generateWorker=function(n,l,c){var h=new s(l.streamFiles,c,l.platform,l.encodeFileName),f=0;try{n.forEach(function(p,u){f++;var m=function(v,D){var C=v||D,L=r[C];if(!L)throw new Error(C+" is not a valid compression method !");return L}(u.options.compression,l.compression),_=u.options.compressionOptions||l.compressionOptions||{},b=u.dir,y=u.date;u._compressWorker(m,_).withStreamInfo("file",{name:p,dir:b,date:y,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(h)}),h.entriesCount=f}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,a,o){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new r;for(var n in this)typeof this[n]!="function"&&(s[n]=this[n]);return s}}(r.prototype=i("./object")).loadAsync=i("./load"),r.support=i("./support"),r.defaults=i("./defaults"),r.version="3.10.1",r.loadAsync=function(s,n){return new r().loadAsync(s,n)},r.external=i("./external"),a.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,a,o){var r=i("./utils"),s=i("./external"),n=i("./utf8"),l=i("./zipEntries"),c=i("./stream/Crc32Probe"),h=i("./nodejsUtils");function f(p){return new s.Promise(function(u,m){var _=p.decompressed.getContentWorker().pipe(new c);_.on("error",function(b){m(b)}).on("end",function(){_.streamInfo.crc32!==p.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}a.exports=function(p,u){var m=this;return u=r.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),h.isNode&&h.isStream(p)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",p,!0,u.optimizedBinaryString,u.base64).then(function(_){var b=new l(u);return b.load(_),b}).then(function(_){var b=[s.Promise.resolve(_)],y=_.files;if(u.checkCRC32)for(var v=0;v<y.length;v++)b.push(f(y[v]));return s.Promise.all(b)}).then(function(_){for(var b=_.shift(),y=b.files,v=0;v<y.length;v++){var D=y[v],C=D.fileNameStr,L=r.resolve(D.fileNameStr);m.file(L,D.decompressed,{binary:!0,optimizedBinaryString:!0,date:D.date,dir:D.dir,comment:D.fileCommentStr.length?D.fileCommentStr:null,unixPermissions:D.unixPermissions,dosPermissions:D.dosPermissions,createFolders:u.createFolders}),D.dir||(m.file(L).unsafeOriginalName=C)}return b.zipComment.length&&(m.comment=b.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,a,o){var r=i("../utils"),s=i("../stream/GenericWorker");function n(l,c){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(n,s),n.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},n.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},a.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,a,o){var r=i("readable-stream").Readable;function s(n,l,c){r.call(this,l),this._helper=n;var h=this;n.on("data",function(f,p){h.push(f)||h._helper.pause(),c&&c(p)}).on("error",function(f){h.emit("error",f)}).on("end",function(){h.push(null)})}i("../utils").inherits(s,r),s.prototype._read=function(){this._helper.resume()},a.exports=s},{"../utils":32,"readable-stream":16}],14:[function(i,a,o){a.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,s);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,s)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var s=new Buffer(r);return s.fill(0),s},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(i,a,o){function r(L,P,M){var Y,$=n.getTypeOf(P),j=n.extend(M||{},h);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(L=y(L)),j.createFolders&&(Y=b(L))&&v.call(this,Y,!0);var K=$==="string"&&j.binary===!1&&j.base64===!1;M&&M.binary!==void 0||(j.binary=!K),(P instanceof f&&P.uncompressedSize===0||j.dir||!P||P.length===0)&&(j.base64=!1,j.binary=!0,P="",j.compression="STORE",$="string");var S=null;S=P instanceof f||P instanceof l?P:m.isNode&&m.isStream(P)?new _(L,P):n.prepareContent(L,P,j.binary,j.optimizedBinaryString,j.base64);var R=new p(L,S,j);this.files[L]=R}var s=i("./utf8"),n=i("./utils"),l=i("./stream/GenericWorker"),c=i("./stream/StreamHelper"),h=i("./defaults"),f=i("./compressedObject"),p=i("./zipObject"),u=i("./generate"),m=i("./nodejsUtils"),_=i("./nodejs/NodejsStreamInputAdapter"),b=function(L){L.slice(-1)==="/"&&(L=L.substring(0,L.length-1));var P=L.lastIndexOf("/");return 0<P?L.substring(0,P):""},y=function(L){return L.slice(-1)!=="/"&&(L+="/"),L},v=function(L,P){return P=P!==void 0?P:h.createFolders,L=y(L),this.files[L]||r.call(this,L,null,{dir:!0,createFolders:P}),this.files[L]};function D(L){return Object.prototype.toString.call(L)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(L){var P,M,Y;for(P in this.files)Y=this.files[P],(M=P.slice(this.root.length,P.length))&&P.slice(0,this.root.length)===this.root&&L(M,Y)},filter:function(L){var P=[];return this.forEach(function(M,Y){L(M,Y)&&P.push(Y)}),P},file:function(L,P,M){if(arguments.length!==1)return L=this.root+L,r.call(this,L,P,M),this;if(D(L)){var Y=L;return this.filter(function(j,K){return!K.dir&&Y.test(j)})}var $=this.files[this.root+L];return $&&!$.dir?$:null},folder:function(L){if(!L)return this;if(D(L))return this.filter(function($,j){return j.dir&&L.test($)});var P=this.root+L,M=v.call(this,P),Y=this.clone();return Y.root=M.name,Y},remove:function(L){L=this.root+L;var P=this.files[L];if(P||(L.slice(-1)!=="/"&&(L+="/"),P=this.files[L]),P&&!P.dir)delete this.files[L];else for(var M=this.filter(function($,j){return j.name.slice(0,L.length)===L}),Y=0;Y<M.length;Y++)delete this.files[M[Y].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(L){var P,M={};try{if((M=n.extend(L||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=M.type.toLowerCase(),M.compression=M.compression.toUpperCase(),M.type==="binarystring"&&(M.type="string"),!M.type)throw new Error("No output type specified.");n.checkSupport(M.type),M.platform!=="darwin"&&M.platform!=="freebsd"&&M.platform!=="linux"&&M.platform!=="sunos"||(M.platform="UNIX"),M.platform==="win32"&&(M.platform="DOS");var Y=M.comment||this.comment||"";P=u.generateWorker(this,M,Y)}catch($){(P=new l("error")).error($)}return new c(P,M.type||"string",M.mimeType)},generateAsync:function(L,P){return this.generateInternalStream(L).accumulate(P)},generateNodeStream:function(L,P){return(L=L||{}).type||(L.type="nodebuffer"),this.generateInternalStream(L).toNodejsStream(P)}};a.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,a,o){a.exports=i("stream")},{stream:void 0}],17:[function(i,a,o){var r=i("./DataReader");function s(n){r.call(this,n);for(var l=0;l<this.data.length;l++)n[l]=255&n[l]}i("../utils").inherits(s,r),s.prototype.byteAt=function(n){return this.data[this.zero+n]},s.prototype.lastIndexOfSignature=function(n){for(var l=n.charCodeAt(0),c=n.charCodeAt(1),h=n.charCodeAt(2),f=n.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===c&&this.data[p+2]===h&&this.data[p+3]===f)return p-this.zero;return-1},s.prototype.readAndCheckSignature=function(n){var l=n.charCodeAt(0),c=n.charCodeAt(1),h=n.charCodeAt(2),f=n.charCodeAt(3),p=this.readData(4);return l===p[0]&&c===p[1]&&h===p[2]&&f===p[3]},s.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},a.exports=s},{"../utils":32,"./DataReader":18}],18:[function(i,a,o){var r=i("../utils");function s(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(){},readInt:function(n){var l,c=0;for(this.checkOffset(n),l=this.index+n-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=n,c},readString:function(n){return r.transformTo("string",this.readData(n))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},a.exports=s},{"../utils":32}],19:[function(i,a,o){var r=i("./Uint8ArrayReader");function s(n){r.call(this,n)}i("../utils").inherits(s,r),s.prototype.readData=function(n){this.checkOffset(n);var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},a.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,a,o){var r=i("./DataReader");function s(n){r.call(this,n)}i("../utils").inherits(s,r),s.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},s.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},s.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},s.prototype.readData=function(n){this.checkOffset(n);var l=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},a.exports=s},{"../utils":32,"./DataReader":18}],21:[function(i,a,o){var r=i("./ArrayReader");function s(n){r.call(this,n)}i("../utils").inherits(s,r),s.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,l},a.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(i,a,o){var r=i("../utils"),s=i("../support"),n=i("./ArrayReader"),l=i("./StringReader"),c=i("./NodeBufferReader"),h=i("./Uint8ArrayReader");a.exports=function(f){var p=r.getTypeOf(f);return r.checkSupport(p),p!=="string"||s.uint8array?p==="nodebuffer"?new c(f):s.uint8array?new h(r.transformTo("uint8array",f)):new n(r.transformTo("array",f)):new l(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,a,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,a,o){var r=i("./GenericWorker"),s=i("../utils");function n(l){r.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(n,r),n.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},a.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(i,a,o){var r=i("./GenericWorker"),s=i("../crc32");function n(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}i("../utils").inherits(n,r),n.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},a.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,a,o){var r=i("../utils"),s=i("./GenericWorker");function n(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(n,s),n.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}s.prototype.processChunk.call(this,l)},a.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(i,a,o){var r=i("../utils"),s=i("./GenericWorker");function n(l){s.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}r.inherits(n,s),n.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},a.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(i,a,o){function r(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,n){return this._listeners[s].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,n){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,n)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var n=this;return s.on("data",function(l){n.processChunk(l)}),s.on("end",function(){n.end()}),s.on("error",function(l){n.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,n){return this.extraStreamInfo[s]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},a.exports=r},{}],29:[function(i,a,o){var r=i("../utils"),s=i("./ConvertWorker"),n=i("./GenericWorker"),l=i("../base64"),c=i("../support"),h=i("../external"),f=null;if(c.nodestream)try{f=i("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(m,_){return new h.Promise(function(b,y){var v=[],D=m._internalType,C=m._outputType,L=m._mimeType;m.on("data",function(P,M){v.push(P),_&&_(M)}).on("error",function(P){v=[],y(P)}).on("end",function(){try{var P=function(M,Y,$){switch(M){case"blob":return r.newBlob(r.transformTo("arraybuffer",Y),$);case"base64":return l.encode(Y);default:return r.transformTo(M,Y)}}(C,function(M,Y){var $,j=0,K=null,S=0;for($=0;$<Y.length;$++)S+=Y[$].length;switch(M){case"string":return Y.join("");case"array":return Array.prototype.concat.apply([],Y);case"uint8array":for(K=new Uint8Array(S),$=0;$<Y.length;$++)K.set(Y[$],j),j+=Y[$].length;return K;case"nodebuffer":return Buffer.concat(Y);default:throw new Error("concat : unsupported type '"+M+"'")}}(D,v),L);b(P)}catch(M){y(M)}v=[]}).resume()})}function u(m,_,b){var y=_;switch(_){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=_,this._mimeType=b,r.checkSupport(y),this._worker=m.pipe(new s(y)),m.lock()}catch(v){this._worker=new n("error"),this._worker.error(v)}}u.prototype={accumulate:function(m){return p(this,m)},on:function(m,_){var b=this;return m==="data"?this._worker.on(m,function(y){_.call(b,y.data,y.meta)}):this._worker.on(m,function(){r.delay(_,arguments,b)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},m)}},a.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,a,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var r=new ArrayBuffer(0);try{o.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(r),o.blob=s.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!i("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(i,a,o){for(var r=i("./utils"),s=i("./support"),n=i("./nodejsUtils"),l=i("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function f(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}o.utf8encode=function(u){return s.nodebuffer?n.newBufferFrom(u,"utf-8"):function(m){var _,b,y,v,D,C=m.length,L=0;for(v=0;v<C;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<C&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),L+=b<128?1:b<2048?2:b<65536?3:4;for(_=s.uint8array?new Uint8Array(L):new Array(L),v=D=0;D<L;v++)(64512&(b=m.charCodeAt(v)))==55296&&v+1<C&&(64512&(y=m.charCodeAt(v+1)))==56320&&(b=65536+(b-55296<<10)+(y-56320),v++),b<128?_[D++]=b:(b<2048?_[D++]=192|b>>>6:(b<65536?_[D++]=224|b>>>12:(_[D++]=240|b>>>18,_[D++]=128|b>>>12&63),_[D++]=128|b>>>6&63),_[D++]=128|63&b);return _}(u)},o.utf8decode=function(u){return s.nodebuffer?r.transformTo("nodebuffer",u).toString("utf-8"):function(m){var _,b,y,v,D=m.length,C=new Array(2*D);for(_=b=0;_<D;)if((y=m[_++])<128)C[b++]=y;else if(4<(v=c[y]))C[b++]=65533,_+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&_<D;)y=y<<6|63&m[_++],v--;1<v?C[b++]=65533:y<65536?C[b++]=y:(y-=65536,C[b++]=55296|y>>10&1023,C[b++]=56320|1023&y)}return C.length!==b&&(C.subarray?C=C.subarray(0,b):C.length=b),r.applyFromCharCode(C)}(u=r.transformTo(s.uint8array?"uint8array":"array",u))},r.inherits(f,l),f.prototype.processChunk=function(u){var m=r.transformTo(s.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var _=m;(m=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),m.set(_,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var b=function(v,D){var C;for((D=D||v.length)>v.length&&(D=v.length),C=D-1;0<=C&&(192&v[C])==128;)C--;return C<0||C===0?D:C+c[v[C]]>D?C:D}(m),y=m;b!==m.length&&(s.uint8array?(y=m.subarray(0,b),this.leftOver=m.subarray(b,m.length)):(y=m.slice(0,b),this.leftOver=m.slice(b,m.length))),this.push({data:o.utf8decode(y),meta:u.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=f,r.inherits(p,l),p.prototype.processChunk=function(u){this.push({data:o.utf8encode(u.data),meta:u.meta})},o.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,a,o){var r=i("./support"),s=i("./base64"),n=i("./nodejsUtils"),l=i("./external");function c(_){return _}function h(_,b){for(var y=0;y<_.length;++y)b[y]=255&_.charCodeAt(y);return b}i("setimmediate"),o.newBlob=function(_,b){o.checkSupport("blob");try{return new Blob([_],{type:b})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(_),y.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(_,b,y){var v=[],D=0,C=_.length;if(C<=y)return String.fromCharCode.apply(null,_);for(;D<C;)b==="array"||b==="nodebuffer"?v.push(String.fromCharCode.apply(null,_.slice(D,Math.min(D+y,C)))):v.push(String.fromCharCode.apply(null,_.subarray(D,Math.min(D+y,C)))),D+=y;return v.join("")},stringifyByChar:function(_){for(var b="",y=0;y<_.length;y++)b+=String.fromCharCode(_[y]);return b},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}}()}};function p(_){var b=65536,y=o.getTypeOf(_),v=!0;if(y==="uint8array"?v=f.applyCanBeUsed.uint8array:y==="nodebuffer"&&(v=f.applyCanBeUsed.nodebuffer),v)for(;1<b;)try{return f.stringifyByChunk(_,y,b)}catch{b=Math.floor(b/2)}return f.stringifyByChar(_)}function u(_,b){for(var y=0;y<_.length;y++)b[y]=_[y];return b}o.applyFromCharCode=p;var m={};m.string={string:c,array:function(_){return h(_,new Array(_.length))},arraybuffer:function(_){return m.string.uint8array(_).buffer},uint8array:function(_){return h(_,new Uint8Array(_.length))},nodebuffer:function(_){return h(_,n.allocBuffer(_.length))}},m.array={string:p,array:c,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return n.newBufferFrom(_)}},m.arraybuffer={string:function(_){return p(new Uint8Array(_))},array:function(_){return u(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:c,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return n.newBufferFrom(new Uint8Array(_))}},m.uint8array={string:p,array:function(_){return u(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:c,nodebuffer:function(_){return n.newBufferFrom(_)}},m.nodebuffer={string:p,array:function(_){return u(_,new Array(_.length))},arraybuffer:function(_){return m.nodebuffer.uint8array(_).buffer},uint8array:function(_){return u(_,new Uint8Array(_.length))},nodebuffer:c},o.transformTo=function(_,b){if(b=b||"",!_)return b;o.checkSupport(_);var y=o.getTypeOf(b);return m[y][_](b)},o.resolve=function(_){for(var b=_.split("/"),y=[],v=0;v<b.length;v++){var D=b[v];D==="."||D===""&&v!==0&&v!==b.length-1||(D===".."?y.pop():y.push(D))}return y.join("/")},o.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":r.nodebuffer&&n.isBuffer(_)?"nodebuffer":r.uint8array&&_ instanceof Uint8Array?"uint8array":r.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(_){if(!r[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(_){var b,y,v="";for(y=0;y<(_||"").length;y++)v+="\\x"+((b=_.charCodeAt(y))<16?"0":"")+b.toString(16).toUpperCase();return v},o.delay=function(_,b,y){setImmediate(function(){_.apply(y||null,b||[])})},o.inherits=function(_,b){function y(){}y.prototype=b.prototype,_.prototype=new y},o.extend=function(){var _,b,y={};for(_=0;_<arguments.length;_++)for(b in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],b)&&y[b]===void 0&&(y[b]=arguments[_][b]);return y},o.prepareContent=function(_,b,y,v,D){return l.Promise.resolve(b).then(function(C){return r.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new l.Promise(function(L,P){var M=new FileReader;M.onload=function(Y){L(Y.target.result)},M.onerror=function(Y){P(Y.target.error)},M.readAsArrayBuffer(C)}):C}).then(function(C){var L=o.getTypeOf(C);return L?(L==="arraybuffer"?C=o.transformTo("uint8array",C):L==="string"&&(D?C=s.decode(C):y&&v!==!0&&(C=function(P){return h(P,r.uint8array?new Uint8Array(P.length):new Array(P.length))}(C))),C):l.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,a,o){var r=i("./reader/readerFor"),s=i("./utils"),n=i("./signature"),l=i("./zipEntry"),c=i("./support");function h(f){this.files=[],this.loadOptions=f}h.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(p)+", expected "+s.pretty(f)+")")}},isSignature:function(f,p){var u=this.reader.index;this.reader.setIndex(f);var m=this.reader.readString(4)===p;return this.reader.setIndex(u),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),p=c.uint8array?"uint8array":"array",u=s.transformTo(p,f);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,p,u,m=this.zip64EndOfCentralSize-44;0<m;)f=this.reader.readInt(2),p=this.reader.readInt(4),u=this.reader.readData(p),this.zip64ExtensibleData[f]={id:f,length:p,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,p;for(f=0;f<this.files.length;f++)p=this.files[f],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(f=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var p=f;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var m=p-u;if(0<m)this.isSignature(p,n.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(f){this.reader=r(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},a.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(i,a,o){var r=i("./reader/readerFor"),s=i("./utils"),n=i("./compressedObject"),l=i("./crc32"),c=i("./utf8"),h=i("./compressions"),f=i("./support");function p(u,m){this.options=u,this.loadOptions=m}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var m,_;if(u.skip(22),this.fileNameLength=u.readInt(2),_=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(b){for(var y in h)if(Object.prototype.hasOwnProperty.call(h,y)&&h[y].magic===b)return h[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,m,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var m=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(m),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=r(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var m,_,b,y=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<y;)m=u.readInt(2),_=u.readInt(2),b=u.readData(_),this.extraFields[m]={id:m,length:_,value:b};u.setIndex(y)},handleUTF8:function(){var u=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var _=s.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var y=s.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var m=r(u.value);return m.readInt(1)!==1||l(this.fileName)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var m=r(u.value);return m.readInt(1)!==1||l(this.fileComment)!==m.readInt(4)?null:c.utf8decode(m.readData(u.length-5))}return null}},a.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,a,o){function r(m,_,b){this.name=m,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=_,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var s=i("./stream/StreamHelper"),n=i("./stream/DataWorker"),l=i("./utf8"),c=i("./compressedObject"),h=i("./stream/GenericWorker");r.prototype={internalStream:function(m){var _=null,b="string";try{if(!m)throw new Error("No output type specified.");var y=(b=m.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),_=this._decompressWorker();var v=!this._dataBinary;v&&!y&&(_=_.pipe(new l.Utf8EncodeWorker)),!v&&y&&(_=_.pipe(new l.Utf8DecodeWorker))}catch(D){(_=new h("error")).error(D)}return new s(_,b,"")},async:function(m,_){return this.internalStream(m).accumulate(_)},nodeStream:function(m,_){return this.internalStream(m||"nodebuffer").toNodejsStream(_)},_compressWorker:function(m,_){if(this._data instanceof c&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,m,_)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new n(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<f.length;u++)r.prototype[f[u]]=p;a.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,a,o){(function(r){var s,n,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(m),f=r.document.createTextNode("");h.observe(f,{characterData:!0}),s=function(){f.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)s="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var _=r.document.createElement("script");_.onreadystatechange=function(){m(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},r.document.documentElement.appendChild(_)}:function(){setTimeout(m,0)};else{var p=new r.MessageChannel;p.port1.onmessage=m,s=function(){p.port2.postMessage(0)}}var u=[];function m(){var _,b;n=!0;for(var y=u.length;y;){for(b=u,u=[],_=-1;++_<y;)b[_]();y=u.length}n=!1}a.exports=function(_){u.push(_)!==1||n||s()}}).call(this,typeof _n<"u"?_n:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(i,a,o){var r=i("immediate");function s(){}var n={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function f(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,y!==s&&_(this,y)}function p(y,v,D){this.promise=y,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof D=="function"&&(this.onRejected=D,this.callRejected=this.otherCallRejected)}function u(y,v,D){r(function(){var C;try{C=v(D)}catch(L){return n.reject(y,L)}C===y?n.reject(y,new TypeError("Cannot resolve promise with itself")):n.resolve(y,C)})}function m(y){var v=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof v=="function")return function(){v.apply(y,arguments)}}function _(y,v){var D=!1;function C(M){D||(D=!0,n.reject(y,M))}function L(M){D||(D=!0,n.resolve(y,M))}var P=b(function(){v(L,C)});P.status==="error"&&C(P.value)}function b(y,v){var D={};try{D.value=y(v),D.status="success"}catch(C){D.status="error",D.value=C}return D}(a.exports=f).prototype.finally=function(y){if(typeof y!="function")return this;var v=this.constructor;return this.then(function(D){return v.resolve(y()).then(function(){return D})},function(D){return v.resolve(y()).then(function(){throw D})})},f.prototype.catch=function(y){return this.then(null,y)},f.prototype.then=function(y,v){if(typeof y!="function"&&this.state===c||typeof v!="function"&&this.state===l)return this;var D=new this.constructor(s);return this.state!==h?u(D,this.state===c?y:v,this.outcome):this.queue.push(new p(D,y,v)),D},p.prototype.callFulfilled=function(y){n.resolve(this.promise,y)},p.prototype.otherCallFulfilled=function(y){u(this.promise,this.onFulfilled,y)},p.prototype.callRejected=function(y){n.reject(this.promise,y)},p.prototype.otherCallRejected=function(y){u(this.promise,this.onRejected,y)},n.resolve=function(y,v){var D=b(m,v);if(D.status==="error")return n.reject(y,D.value);var C=D.value;if(C)_(y,C);else{y.state=c,y.outcome=v;for(var L=-1,P=y.queue.length;++L<P;)y.queue[L].callFulfilled(v)}return y},n.reject=function(y,v){y.state=l,y.outcome=v;for(var D=-1,C=y.queue.length;++D<C;)y.queue[D].callRejected(v);return y},f.resolve=function(y){return y instanceof this?y:n.resolve(new this(s),y)},f.reject=function(y){var v=new this(s);return n.reject(v,y)},f.all=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=y.length,C=!1;if(!D)return this.resolve([]);for(var L=new Array(D),P=0,M=-1,Y=new this(s);++M<D;)$(y[M],M);return Y;function $(j,K){v.resolve(j).then(function(S){L[K]=S,++P!==D||C||(C=!0,n.resolve(Y,L))},function(S){C||(C=!0,n.reject(Y,S))})}},f.race=function(y){var v=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=y.length,C=!1;if(!D)return this.resolve([]);for(var L=-1,P=new this(s);++L<D;)M=y[L],v.resolve(M).then(function(Y){C||(C=!0,n.resolve(P,Y))},function(Y){C||(C=!0,n.reject(P,Y))});var M;return P}},{immediate:36}],38:[function(i,a,o){var r={};(0,i("./lib/utils/common").assign)(r,i("./lib/deflate"),i("./lib/inflate"),i("./lib/zlib/constants")),a.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,a,o){var r=i("./zlib/deflate"),s=i("./utils/common"),n=i("./utils/strings"),l=i("./zlib/messages"),c=i("./zlib/zstream"),h=Object.prototype.toString,f=0,p=-1,u=0,m=8;function _(y){if(!(this instanceof _))return new _(y);this.options=s.assign({level:p,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},y||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var D=r.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(D!==f)throw new Error(l[D]);if(v.header&&r.deflateSetHeader(this.strm,v.header),v.dictionary){var C;if(C=typeof v.dictionary=="string"?n.string2buf(v.dictionary):h.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(D=r.deflateSetDictionary(this.strm,C))!==f)throw new Error(l[D]);this._dict_set=!0}}function b(y,v){var D=new _(v);if(D.push(y,!0),D.err)throw D.msg||l[D.err];return D.result}_.prototype.push=function(y,v){var D,C,L=this.strm,P=this.options.chunkSize;if(this.ended)return!1;C=v===~~v?v:v===!0?4:0,typeof y=="string"?L.input=n.string2buf(y):h.call(y)==="[object ArrayBuffer]"?L.input=new Uint8Array(y):L.input=y,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new s.Buf8(P),L.next_out=0,L.avail_out=P),(D=r.deflate(L,C))!==1&&D!==f)return this.onEnd(D),!(this.ended=!0);L.avail_out!==0&&(L.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(s.shrinkBuf(L.output,L.next_out))):this.onData(s.shrinkBuf(L.output,L.next_out)))}while((0<L.avail_in||L.avail_out===0)&&D!==1);return C===4?(D=r.deflateEnd(this.strm),this.onEnd(D),this.ended=!0,D===f):C!==2||(this.onEnd(f),!(L.avail_out=0))},_.prototype.onData=function(y){this.chunks.push(y)},_.prototype.onEnd=function(y){y===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},o.Deflate=_,o.deflate=b,o.deflateRaw=function(y,v){return(v=v||{}).raw=!0,b(y,v)},o.gzip=function(y,v){return(v=v||{}).gzip=!0,b(y,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,a,o){var r=i("./zlib/inflate"),s=i("./utils/common"),n=i("./utils/strings"),l=i("./zlib/constants"),c=i("./zlib/messages"),h=i("./zlib/zstream"),f=i("./zlib/gzheader"),p=Object.prototype.toString;function u(_){if(!(this instanceof u))return new u(_);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},_||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||_&&_.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&(15&b.windowBits)==0&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var y=r.inflateInit2(this.strm,b.windowBits);if(y!==l.Z_OK)throw new Error(c[y]);this.header=new f,r.inflateGetHeader(this.strm,this.header)}function m(_,b){var y=new u(b);if(y.push(_,!0),y.err)throw y.msg||c[y.err];return y.result}u.prototype.push=function(_,b){var y,v,D,C,L,P,M=this.strm,Y=this.options.chunkSize,$=this.options.dictionary,j=!1;if(this.ended)return!1;v=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof _=="string"?M.input=n.binstring2buf(_):p.call(_)==="[object ArrayBuffer]"?M.input=new Uint8Array(_):M.input=_,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new s.Buf8(Y),M.next_out=0,M.avail_out=Y),(y=r.inflate(M,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&$&&(P=typeof $=="string"?n.string2buf($):p.call($)==="[object ArrayBuffer]"?new Uint8Array($):$,y=r.inflateSetDictionary(this.strm,P)),y===l.Z_BUF_ERROR&&j===!0&&(y=l.Z_OK,j=!1),y!==l.Z_STREAM_END&&y!==l.Z_OK)return this.onEnd(y),!(this.ended=!0);M.next_out&&(M.avail_out!==0&&y!==l.Z_STREAM_END&&(M.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(D=n.utf8border(M.output,M.next_out),C=M.next_out-D,L=n.buf2string(M.output,D),M.next_out=C,M.avail_out=Y-C,C&&s.arraySet(M.output,M.output,D,C,0),this.onData(L)):this.onData(s.shrinkBuf(M.output,M.next_out)))),M.avail_in===0&&M.avail_out===0&&(j=!0)}while((0<M.avail_in||M.avail_out===0)&&y!==l.Z_STREAM_END);return y===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(y=r.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(M.avail_out=0))},u.prototype.onData=function(_){this.chunks.push(_)},u.prototype.onEnd=function(_){_===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},o.Inflate=u,o.inflate=m,o.inflateRaw=function(_,b){return(b=b||{}).raw=!0,m(_,b)},o.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,a,o){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var f in h)h.hasOwnProperty(f)&&(l[f]=h[f])}}return l},o.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var s={arraySet:function(l,c,h,f,p){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+f),p);else for(var u=0;u<f;u++)l[p+u]=c[h+u]},flattenChunks:function(l){var c,h,f,p,u,m;for(c=f=0,h=l.length;c<h;c++)f+=l[c].length;for(m=new Uint8Array(f),c=p=0,h=l.length;c<h;c++)u=l[c],m.set(u,p),p+=u.length;return m}},n={arraySet:function(l,c,h,f,p){for(var u=0;u<f;u++)l[p+u]=c[h+u]},flattenChunks:function(l){return[].concat.apply([],l)}};o.setTyped=function(l){l?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,n))},o.setTyped(r)},{}],42:[function(i,a,o){var r=i("./common"),s=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(f,p){if(p<65537&&(f.subarray&&n||!f.subarray&&s))return String.fromCharCode.apply(null,r.shrinkBuf(f,p));for(var u="",m=0;m<p;m++)u+=String.fromCharCode(f[m]);return u}l[254]=l[254]=1,o.string2buf=function(f){var p,u,m,_,b,y=f.length,v=0;for(_=0;_<y;_++)(64512&(u=f.charCodeAt(_)))==55296&&_+1<y&&(64512&(m=f.charCodeAt(_+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),_++),v+=u<128?1:u<2048?2:u<65536?3:4;for(p=new r.Buf8(v),_=b=0;b<v;_++)(64512&(u=f.charCodeAt(_)))==55296&&_+1<y&&(64512&(m=f.charCodeAt(_+1)))==56320&&(u=65536+(u-55296<<10)+(m-56320),_++),u<128?p[b++]=u:(u<2048?p[b++]=192|u>>>6:(u<65536?p[b++]=224|u>>>12:(p[b++]=240|u>>>18,p[b++]=128|u>>>12&63),p[b++]=128|u>>>6&63),p[b++]=128|63&u);return p},o.buf2binstring=function(f){return h(f,f.length)},o.binstring2buf=function(f){for(var p=new r.Buf8(f.length),u=0,m=p.length;u<m;u++)p[u]=f.charCodeAt(u);return p},o.buf2string=function(f,p){var u,m,_,b,y=p||f.length,v=new Array(2*y);for(u=m=0;u<y;)if((_=f[u++])<128)v[m++]=_;else if(4<(b=l[_]))v[m++]=65533,u+=b-1;else{for(_&=b===2?31:b===3?15:7;1<b&&u<y;)_=_<<6|63&f[u++],b--;1<b?v[m++]=65533:_<65536?v[m++]=_:(_-=65536,v[m++]=55296|_>>10&1023,v[m++]=56320|1023&_)}return h(v,m)},o.utf8border=function(f,p){var u;for((p=p||f.length)>f.length&&(p=f.length),u=p-1;0<=u&&(192&f[u])==128;)u--;return u<0||u===0?p:u+l[f[u]]>p?u:p}},{"./common":41}],43:[function(i,a,o){a.exports=function(r,s,n,l){for(var c=65535&r|0,h=r>>>16&65535|0,f=0;n!==0;){for(n-=f=2e3<n?2e3:n;h=h+(c=c+s[l++]|0)|0,--f;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(i,a,o){a.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,a,o){var r=function(){for(var s,n=[],l=0;l<256;l++){s=l;for(var c=0;c<8;c++)s=1&s?3988292384^s>>>1:s>>>1;n[l]=s}return n}();a.exports=function(s,n,l,c){var h=r,f=c+l;s^=-1;for(var p=c;p<f;p++)s=s>>>8^h[255&(s^n[p])];return-1^s}},{}],46:[function(i,a,o){var r,s=i("../utils/common"),n=i("./trees"),l=i("./adler32"),c=i("./crc32"),h=i("./messages"),f=0,p=4,u=0,m=-2,_=-1,b=4,y=2,v=8,D=9,C=286,L=30,P=19,M=2*C+1,Y=15,$=3,j=258,K=j+$+1,S=42,R=113,g=1,H=2,ot=3,U=4;function st(d,O){return d.msg=h[O],O}function G(d){return(d<<1)-(4<d?9:0)}function at(d){for(var O=d.length;0<=--O;)d[O]=0}function N(d){var O=d.state,A=O.pending;A>d.avail_out&&(A=d.avail_out),A!==0&&(s.arraySet(d.output,O.pending_buf,O.pending_out,A,d.next_out),d.next_out+=A,O.pending_out+=A,d.total_out+=A,d.avail_out-=A,O.pending-=A,O.pending===0&&(O.pending_out=0))}function I(d,O){n._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,O),d.block_start=d.strstart,N(d.strm)}function it(d,O){d.pending_buf[d.pending++]=O}function q(d,O){d.pending_buf[d.pending++]=O>>>8&255,d.pending_buf[d.pending++]=255&O}function J(d,O){var A,w,E=d.max_chain_length,T=d.strstart,X=d.prev_length,z=d.nice_match,k=d.strstart>d.w_size-K?d.strstart-(d.w_size-K):0,W=d.window,Z=d.w_mask,V=d.prev,et=d.strstart+j,vt=W[T+X-1],ht=W[T+X];d.prev_length>=d.good_match&&(E>>=2),z>d.lookahead&&(z=d.lookahead);do if(W[(A=O)+X]===ht&&W[A+X-1]===vt&&W[A]===W[T]&&W[++A]===W[T+1]){T+=2,A++;do;while(W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&T<et);if(w=j-(et-T),T=et-j,X<w){if(d.match_start=O,z<=(X=w))break;vt=W[T+X-1],ht=W[T+X]}}while((O=V[O&Z])>k&&--E!=0);return X<=d.lookahead?X:d.lookahead}function Dt(d){var O,A,w,E,T,X,z,k,W,Z,V=d.w_size;do{if(E=d.window_size-d.lookahead-d.strstart,d.strstart>=V+(V-K)){for(s.arraySet(d.window,d.window,V,V,0),d.match_start-=V,d.strstart-=V,d.block_start-=V,O=A=d.hash_size;w=d.head[--O],d.head[O]=V<=w?w-V:0,--A;);for(O=A=V;w=d.prev[--O],d.prev[O]=V<=w?w-V:0,--A;);E+=V}if(d.strm.avail_in===0)break;if(X=d.strm,z=d.window,k=d.strstart+d.lookahead,W=E,Z=void 0,Z=X.avail_in,W<Z&&(Z=W),A=Z===0?0:(X.avail_in-=Z,s.arraySet(z,X.input,X.next_in,Z,k),X.state.wrap===1?X.adler=l(X.adler,z,Z,k):X.state.wrap===2&&(X.adler=c(X.adler,z,Z,k)),X.next_in+=Z,X.total_in+=Z,Z),d.lookahead+=A,d.lookahead+d.insert>=$)for(T=d.strstart-d.insert,d.ins_h=d.window[T],d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+$-1])&d.hash_mask,d.prev[T&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=T,T++,d.insert--,!(d.lookahead+d.insert<$)););}while(d.lookahead<K&&d.strm.avail_in!==0)}function $t(d,O){for(var A,w;;){if(d.lookahead<K){if(Dt(d),d.lookahead<K&&O===f)return g;if(d.lookahead===0)break}if(A=0,d.lookahead>=$&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+$-1])&d.hash_mask,A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),A!==0&&d.strstart-A<=d.w_size-K&&(d.match_length=J(d,A)),d.match_length>=$)if(w=n._tr_tally(d,d.strstart-d.match_start,d.match_length-$),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=$){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+$-1])&d.hash_mask,A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else w=n._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(w&&(I(d,!1),d.strm.avail_out===0))return g}return d.insert=d.strstart<$-1?d.strstart:$-1,O===p?(I(d,!0),d.strm.avail_out===0?ot:U):d.last_lit&&(I(d,!1),d.strm.avail_out===0)?g:H}function ut(d,O){for(var A,w,E;;){if(d.lookahead<K){if(Dt(d),d.lookahead<K&&O===f)return g;if(d.lookahead===0)break}if(A=0,d.lookahead>=$&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+$-1])&d.hash_mask,A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=$-1,A!==0&&d.prev_length<d.max_lazy_match&&d.strstart-A<=d.w_size-K&&(d.match_length=J(d,A),d.match_length<=5&&(d.strategy===1||d.match_length===$&&4096<d.strstart-d.match_start)&&(d.match_length=$-1)),d.prev_length>=$&&d.match_length<=d.prev_length){for(E=d.strstart+d.lookahead-$,w=n._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-$),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=E&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+$-1])&d.hash_mask,A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=$-1,d.strstart++,w&&(I(d,!1),d.strm.avail_out===0))return g}else if(d.match_available){if((w=n._tr_tally(d,0,d.window[d.strstart-1]))&&I(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return g}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(w=n._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<$-1?d.strstart:$-1,O===p?(I(d,!0),d.strm.avail_out===0?ot:U):d.last_lit&&(I(d,!1),d.strm.avail_out===0)?g:H}function _t(d,O,A,w,E){this.good_length=d,this.max_lazy=O,this.nice_length=A,this.max_chain=w,this.func=E}function At(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*M),this.dyn_dtree=new s.Buf16(2*(2*L+1)),this.bl_tree=new s.Buf16(2*(2*P+1)),at(this.dyn_ltree),at(this.dyn_dtree),at(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(Y+1),this.heap=new s.Buf16(2*C+1),at(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*C+1),at(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Tt(d){var O;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=y,(O=d.state).pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?S:R,d.adler=O.wrap===2?0:1,O.last_flush=f,n._tr_init(O),u):st(d,m)}function be(d){var O=Tt(d);return O===u&&function(A){A.window_size=2*A.w_size,at(A.head),A.max_lazy_match=r[A.level].max_lazy,A.good_match=r[A.level].good_length,A.nice_match=r[A.level].nice_length,A.max_chain_length=r[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=$-1,A.match_available=0,A.ins_h=0}(d.state),O}function ie(d,O,A,w,E,T){if(!d)return m;var X=1;if(O===_&&(O=6),w<0?(X=0,w=-w):15<w&&(X=2,w-=16),E<1||D<E||A!==v||w<8||15<w||O<0||9<O||T<0||b<T)return st(d,m);w===8&&(w=9);var z=new At;return(d.state=z).strm=d,z.wrap=X,z.gzhead=null,z.w_bits=w,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=E+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+$-1)/$),z.window=new s.Buf8(2*z.w_size),z.head=new s.Buf16(z.hash_size),z.prev=new s.Buf16(z.w_size),z.lit_bufsize=1<<E+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new s.Buf8(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=O,z.strategy=T,z.method=A,be(d)}r=[new _t(0,0,0,0,function(d,O){var A=65535;for(A>d.pending_buf_size-5&&(A=d.pending_buf_size-5);;){if(d.lookahead<=1){if(Dt(d),d.lookahead===0&&O===f)return g;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var w=d.block_start+A;if((d.strstart===0||d.strstart>=w)&&(d.lookahead=d.strstart-w,d.strstart=w,I(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-K&&(I(d,!1),d.strm.avail_out===0))return g}return d.insert=0,O===p?(I(d,!0),d.strm.avail_out===0?ot:U):(d.strstart>d.block_start&&(I(d,!1),d.strm.avail_out),g)}),new _t(4,4,8,4,$t),new _t(4,5,16,8,$t),new _t(4,6,32,32,$t),new _t(4,4,16,16,ut),new _t(8,16,32,32,ut),new _t(8,16,128,128,ut),new _t(8,32,128,256,ut),new _t(32,128,258,1024,ut),new _t(32,258,258,4096,ut)],o.deflateInit=function(d,O){return ie(d,O,v,15,8,0)},o.deflateInit2=ie,o.deflateReset=be,o.deflateResetKeep=Tt,o.deflateSetHeader=function(d,O){return d&&d.state?d.state.wrap!==2?m:(d.state.gzhead=O,u):m},o.deflate=function(d,O){var A,w,E,T;if(!d||!d.state||5<O||O<0)return d?st(d,m):m;if(w=d.state,!d.output||!d.input&&d.avail_in!==0||w.status===666&&O!==p)return st(d,d.avail_out===0?-5:m);if(w.strm=d,A=w.last_flush,w.last_flush=O,w.status===S)if(w.wrap===2)d.adler=0,it(w,31),it(w,139),it(w,8),w.gzhead?(it(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),it(w,255&w.gzhead.time),it(w,w.gzhead.time>>8&255),it(w,w.gzhead.time>>16&255),it(w,w.gzhead.time>>24&255),it(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),it(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(it(w,255&w.gzhead.extra.length),it(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(d.adler=c(d.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(it(w,0),it(w,0),it(w,0),it(w,0),it(w,0),it(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),it(w,3),w.status=R);else{var X=v+(w.w_bits-8<<4)<<8;X|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(X|=32),X+=31-X%31,w.status=R,q(w,X),w.strstart!==0&&(q(w,d.adler>>>16),q(w,65535&d.adler)),d.adler=1}if(w.status===69)if(w.gzhead.extra){for(E=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>E&&(d.adler=c(d.adler,w.pending_buf,w.pending-E,E)),N(d),E=w.pending,w.pending!==w.pending_buf_size));)it(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>E&&(d.adler=c(d.adler,w.pending_buf,w.pending-E,E)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){E=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>E&&(d.adler=c(d.adler,w.pending_buf,w.pending-E,E)),N(d),E=w.pending,w.pending===w.pending_buf_size)){T=1;break}T=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,it(w,T)}while(T!==0);w.gzhead.hcrc&&w.pending>E&&(d.adler=c(d.adler,w.pending_buf,w.pending-E,E)),T===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){E=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>E&&(d.adler=c(d.adler,w.pending_buf,w.pending-E,E)),N(d),E=w.pending,w.pending===w.pending_buf_size)){T=1;break}T=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,it(w,T)}while(T!==0);w.gzhead.hcrc&&w.pending>E&&(d.adler=c(d.adler,w.pending_buf,w.pending-E,E)),T===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&N(d),w.pending+2<=w.pending_buf_size&&(it(w,255&d.adler),it(w,d.adler>>8&255),d.adler=0,w.status=R)):w.status=R),w.pending!==0){if(N(d),d.avail_out===0)return w.last_flush=-1,u}else if(d.avail_in===0&&G(O)<=G(A)&&O!==p)return st(d,-5);if(w.status===666&&d.avail_in!==0)return st(d,-5);if(d.avail_in!==0||w.lookahead!==0||O!==f&&w.status!==666){var z=w.strategy===2?function(k,W){for(var Z;;){if(k.lookahead===0&&(Dt(k),k.lookahead===0)){if(W===f)return g;break}if(k.match_length=0,Z=n._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++,Z&&(I(k,!1),k.strm.avail_out===0))return g}return k.insert=0,W===p?(I(k,!0),k.strm.avail_out===0?ot:U):k.last_lit&&(I(k,!1),k.strm.avail_out===0)?g:H}(w,O):w.strategy===3?function(k,W){for(var Z,V,et,vt,ht=k.window;;){if(k.lookahead<=j){if(Dt(k),k.lookahead<=j&&W===f)return g;if(k.lookahead===0)break}if(k.match_length=0,k.lookahead>=$&&0<k.strstart&&(V=ht[et=k.strstart-1])===ht[++et]&&V===ht[++et]&&V===ht[++et]){vt=k.strstart+j;do;while(V===ht[++et]&&V===ht[++et]&&V===ht[++et]&&V===ht[++et]&&V===ht[++et]&&V===ht[++et]&&V===ht[++et]&&V===ht[++et]&&et<vt);k.match_length=j-(vt-et),k.match_length>k.lookahead&&(k.match_length=k.lookahead)}if(k.match_length>=$?(Z=n._tr_tally(k,1,k.match_length-$),k.lookahead-=k.match_length,k.strstart+=k.match_length,k.match_length=0):(Z=n._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++),Z&&(I(k,!1),k.strm.avail_out===0))return g}return k.insert=0,W===p?(I(k,!0),k.strm.avail_out===0?ot:U):k.last_lit&&(I(k,!1),k.strm.avail_out===0)?g:H}(w,O):r[w.level].func(w,O);if(z!==ot&&z!==U||(w.status=666),z===g||z===ot)return d.avail_out===0&&(w.last_flush=-1),u;if(z===H&&(O===1?n._tr_align(w):O!==5&&(n._tr_stored_block(w,0,0,!1),O===3&&(at(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),N(d),d.avail_out===0))return w.last_flush=-1,u}return O!==p?u:w.wrap<=0?1:(w.wrap===2?(it(w,255&d.adler),it(w,d.adler>>8&255),it(w,d.adler>>16&255),it(w,d.adler>>24&255),it(w,255&d.total_in),it(w,d.total_in>>8&255),it(w,d.total_in>>16&255),it(w,d.total_in>>24&255)):(q(w,d.adler>>>16),q(w,65535&d.adler)),N(d),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?u:1)},o.deflateEnd=function(d){var O;return d&&d.state?(O=d.state.status)!==S&&O!==69&&O!==73&&O!==91&&O!==103&&O!==R&&O!==666?st(d,m):(d.state=null,O===R?st(d,-3):u):m},o.deflateSetDictionary=function(d,O){var A,w,E,T,X,z,k,W,Z=O.length;if(!d||!d.state||(T=(A=d.state).wrap)===2||T===1&&A.status!==S||A.lookahead)return m;for(T===1&&(d.adler=l(d.adler,O,Z,0)),A.wrap=0,Z>=A.w_size&&(T===0&&(at(A.head),A.strstart=0,A.block_start=0,A.insert=0),W=new s.Buf8(A.w_size),s.arraySet(W,O,Z-A.w_size,A.w_size,0),O=W,Z=A.w_size),X=d.avail_in,z=d.next_in,k=d.input,d.avail_in=Z,d.next_in=0,d.input=O,Dt(A);A.lookahead>=$;){for(w=A.strstart,E=A.lookahead-($-1);A.ins_h=(A.ins_h<<A.hash_shift^A.window[w+$-1])&A.hash_mask,A.prev[w&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=w,w++,--E;);A.strstart=w,A.lookahead=$-1,Dt(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=$-1,A.match_available=0,d.next_in=z,d.input=k,d.avail_in=X,A.wrap=T,u},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,a,o){a.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,a,o){a.exports=function(r,s){var n,l,c,h,f,p,u,m,_,b,y,v,D,C,L,P,M,Y,$,j,K,S,R,g,H;n=r.state,l=r.next_in,g=r.input,c=l+(r.avail_in-5),h=r.next_out,H=r.output,f=h-(s-r.avail_out),p=h+(r.avail_out-257),u=n.dmax,m=n.wsize,_=n.whave,b=n.wnext,y=n.window,v=n.hold,D=n.bits,C=n.lencode,L=n.distcode,P=(1<<n.lenbits)-1,M=(1<<n.distbits)-1;t:do{D<15&&(v+=g[l++]<<D,D+=8,v+=g[l++]<<D,D+=8),Y=C[v&P];e:for(;;){if(v>>>=$=Y>>>24,D-=$,($=Y>>>16&255)===0)H[h++]=65535&Y;else{if(!(16&$)){if((64&$)==0){Y=C[(65535&Y)+(v&(1<<$)-1)];continue e}if(32&$){n.mode=12;break t}r.msg="invalid literal/length code",n.mode=30;break t}j=65535&Y,($&=15)&&(D<$&&(v+=g[l++]<<D,D+=8),j+=v&(1<<$)-1,v>>>=$,D-=$),D<15&&(v+=g[l++]<<D,D+=8,v+=g[l++]<<D,D+=8),Y=L[v&M];i:for(;;){if(v>>>=$=Y>>>24,D-=$,!(16&($=Y>>>16&255))){if((64&$)==0){Y=L[(65535&Y)+(v&(1<<$)-1)];continue i}r.msg="invalid distance code",n.mode=30;break t}if(K=65535&Y,D<($&=15)&&(v+=g[l++]<<D,(D+=8)<$&&(v+=g[l++]<<D,D+=8)),u<(K+=v&(1<<$)-1)){r.msg="invalid distance too far back",n.mode=30;break t}if(v>>>=$,D-=$,($=h-f)<K){if(_<($=K-$)&&n.sane){r.msg="invalid distance too far back",n.mode=30;break t}if(R=y,(S=0)===b){if(S+=m-$,$<j){for(j-=$;H[h++]=y[S++],--$;);S=h-K,R=H}}else if(b<$){if(S+=m+b-$,($-=b)<j){for(j-=$;H[h++]=y[S++],--$;);if(S=0,b<j){for(j-=$=b;H[h++]=y[S++],--$;);S=h-K,R=H}}}else if(S+=b-$,$<j){for(j-=$;H[h++]=y[S++],--$;);S=h-K,R=H}for(;2<j;)H[h++]=R[S++],H[h++]=R[S++],H[h++]=R[S++],j-=3;j&&(H[h++]=R[S++],1<j&&(H[h++]=R[S++]))}else{for(S=h-K;H[h++]=H[S++],H[h++]=H[S++],H[h++]=H[S++],2<(j-=3););j&&(H[h++]=H[S++],1<j&&(H[h++]=H[S++]))}break}}break}}while(l<c&&h<p);l-=j=D>>3,v&=(1<<(D-=j<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<p?p-h+257:257-(h-p),n.hold=v,n.bits=D}},{}],49:[function(i,a,o){var r=i("../utils/common"),s=i("./adler32"),n=i("./crc32"),l=i("./inffast"),c=i("./inftrees"),h=1,f=2,p=0,u=-2,m=1,_=852,b=592;function y(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function D(S){var R;return S&&S.state?(R=S.state,S.total_in=S.total_out=R.total=0,S.msg="",R.wrap&&(S.adler=1&R.wrap),R.mode=m,R.last=0,R.havedict=0,R.dmax=32768,R.head=null,R.hold=0,R.bits=0,R.lencode=R.lendyn=new r.Buf32(_),R.distcode=R.distdyn=new r.Buf32(b),R.sane=1,R.back=-1,p):u}function C(S){var R;return S&&S.state?((R=S.state).wsize=0,R.whave=0,R.wnext=0,D(S)):u}function L(S,R){var g,H;return S&&S.state?(H=S.state,R<0?(g=0,R=-R):(g=1+(R>>4),R<48&&(R&=15)),R&&(R<8||15<R)?u:(H.window!==null&&H.wbits!==R&&(H.window=null),H.wrap=g,H.wbits=R,C(S))):u}function P(S,R){var g,H;return S?(H=new v,(S.state=H).window=null,(g=L(S,R))!==p&&(S.state=null),g):u}var M,Y,$=!0;function j(S){if($){var R;for(M=new r.Buf32(512),Y=new r.Buf32(32),R=0;R<144;)S.lens[R++]=8;for(;R<256;)S.lens[R++]=9;for(;R<280;)S.lens[R++]=7;for(;R<288;)S.lens[R++]=8;for(c(h,S.lens,0,288,M,0,S.work,{bits:9}),R=0;R<32;)S.lens[R++]=5;c(f,S.lens,0,32,Y,0,S.work,{bits:5}),$=!1}S.lencode=M,S.lenbits=9,S.distcode=Y,S.distbits=5}function K(S,R,g,H){var ot,U=S.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new r.Buf8(U.wsize)),H>=U.wsize?(r.arraySet(U.window,R,g-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(H<(ot=U.wsize-U.wnext)&&(ot=H),r.arraySet(U.window,R,g-H,ot,U.wnext),(H-=ot)?(r.arraySet(U.window,R,g-H,H,0),U.wnext=H,U.whave=U.wsize):(U.wnext+=ot,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=ot))),0}o.inflateReset=C,o.inflateReset2=L,o.inflateResetKeep=D,o.inflateInit=function(S){return P(S,15)},o.inflateInit2=P,o.inflate=function(S,R){var g,H,ot,U,st,G,at,N,I,it,q,J,Dt,$t,ut,_t,At,Tt,be,ie,d,O,A,w,E=0,T=new r.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return u;(g=S.state).mode===12&&(g.mode=13),st=S.next_out,ot=S.output,at=S.avail_out,U=S.next_in,H=S.input,G=S.avail_in,N=g.hold,I=g.bits,it=G,q=at,O=p;t:for(;;)switch(g.mode){case m:if(g.wrap===0){g.mode=13;break}for(;I<16;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if(2&g.wrap&&N===35615){T[g.check=0]=255&N,T[1]=N>>>8&255,g.check=n(g.check,T,2,0),I=N=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&N)<<8)+(N>>8))%31){S.msg="incorrect header check",g.mode=30;break}if((15&N)!=8){S.msg="unknown compression method",g.mode=30;break}if(I-=4,d=8+(15&(N>>>=4)),g.wbits===0)g.wbits=d;else if(d>g.wbits){S.msg="invalid window size",g.mode=30;break}g.dmax=1<<d,S.adler=g.check=1,g.mode=512&N?10:12,I=N=0;break;case 2:for(;I<16;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if(g.flags=N,(255&g.flags)!=8){S.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){S.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=N>>8&1),512&g.flags&&(T[0]=255&N,T[1]=N>>>8&255,g.check=n(g.check,T,2,0)),I=N=0,g.mode=3;case 3:for(;I<32;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}g.head&&(g.head.time=N),512&g.flags&&(T[0]=255&N,T[1]=N>>>8&255,T[2]=N>>>16&255,T[3]=N>>>24&255,g.check=n(g.check,T,4,0)),I=N=0,g.mode=4;case 4:for(;I<16;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}g.head&&(g.head.xflags=255&N,g.head.os=N>>8),512&g.flags&&(T[0]=255&N,T[1]=N>>>8&255,g.check=n(g.check,T,2,0)),I=N=0,g.mode=5;case 5:if(1024&g.flags){for(;I<16;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}g.length=N,g.head&&(g.head.extra_len=N),512&g.flags&&(T[0]=255&N,T[1]=N>>>8&255,g.check=n(g.check,T,2,0)),I=N=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(G<(J=g.length)&&(J=G),J&&(g.head&&(d=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),r.arraySet(g.head.extra,H,U,J,d)),512&g.flags&&(g.check=n(g.check,H,J,U)),G-=J,U+=J,g.length-=J),g.length))break t;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(G===0)break t;for(J=0;d=H[U+J++],g.head&&d&&g.length<65536&&(g.head.name+=String.fromCharCode(d)),d&&J<G;);if(512&g.flags&&(g.check=n(g.check,H,J,U)),G-=J,U+=J,d)break t}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(G===0)break t;for(J=0;d=H[U+J++],g.head&&d&&g.length<65536&&(g.head.comment+=String.fromCharCode(d)),d&&J<G;);if(512&g.flags&&(g.check=n(g.check,H,J,U)),G-=J,U+=J,d)break t}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;I<16;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if(N!==(65535&g.check)){S.msg="header crc mismatch",g.mode=30;break}I=N=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),S.adler=g.check=0,g.mode=12;break;case 10:for(;I<32;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}S.adler=g.check=y(N),I=N=0,g.mode=11;case 11:if(g.havedict===0)return S.next_out=st,S.avail_out=at,S.next_in=U,S.avail_in=G,g.hold=N,g.bits=I,2;S.adler=g.check=1,g.mode=12;case 12:if(R===5||R===6)break t;case 13:if(g.last){N>>>=7&I,I-=7&I,g.mode=27;break}for(;I<3;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}switch(g.last=1&N,I-=1,3&(N>>>=1)){case 0:g.mode=14;break;case 1:if(j(g),g.mode=20,R!==6)break;N>>>=2,I-=2;break t;case 2:g.mode=17;break;case 3:S.msg="invalid block type",g.mode=30}N>>>=2,I-=2;break;case 14:for(N>>>=7&I,I-=7&I;I<32;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if((65535&N)!=(N>>>16^65535)){S.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&N,I=N=0,g.mode=15,R===6)break t;case 15:g.mode=16;case 16:if(J=g.length){if(G<J&&(J=G),at<J&&(J=at),J===0)break t;r.arraySet(ot,H,U,J,st),G-=J,U+=J,at-=J,st+=J,g.length-=J;break}g.mode=12;break;case 17:for(;I<14;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if(g.nlen=257+(31&N),N>>>=5,I-=5,g.ndist=1+(31&N),N>>>=5,I-=5,g.ncode=4+(15&N),N>>>=4,I-=4,286<g.nlen||30<g.ndist){S.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;I<3;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}g.lens[X[g.have++]]=7&N,N>>>=3,I-=3}for(;g.have<19;)g.lens[X[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,A={bits:g.lenbits},O=c(0,g.lens,0,19,g.lencode,0,g.work,A),g.lenbits=A.bits,O){S.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;_t=(E=g.lencode[N&(1<<g.lenbits)-1])>>>16&255,At=65535&E,!((ut=E>>>24)<=I);){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if(At<16)N>>>=ut,I-=ut,g.lens[g.have++]=At;else{if(At===16){for(w=ut+2;I<w;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if(N>>>=ut,I-=ut,g.have===0){S.msg="invalid bit length repeat",g.mode=30;break}d=g.lens[g.have-1],J=3+(3&N),N>>>=2,I-=2}else if(At===17){for(w=ut+3;I<w;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}I-=ut,d=0,J=3+(7&(N>>>=ut)),N>>>=3,I-=3}else{for(w=ut+7;I<w;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}I-=ut,d=0,J=11+(127&(N>>>=ut)),N>>>=7,I-=7}if(g.have+J>g.nlen+g.ndist){S.msg="invalid bit length repeat",g.mode=30;break}for(;J--;)g.lens[g.have++]=d}}if(g.mode===30)break;if(g.lens[256]===0){S.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,A={bits:g.lenbits},O=c(h,g.lens,0,g.nlen,g.lencode,0,g.work,A),g.lenbits=A.bits,O){S.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,A={bits:g.distbits},O=c(f,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,A),g.distbits=A.bits,O){S.msg="invalid distances set",g.mode=30;break}if(g.mode=20,R===6)break t;case 20:g.mode=21;case 21:if(6<=G&&258<=at){S.next_out=st,S.avail_out=at,S.next_in=U,S.avail_in=G,g.hold=N,g.bits=I,l(S,q),st=S.next_out,ot=S.output,at=S.avail_out,U=S.next_in,H=S.input,G=S.avail_in,N=g.hold,I=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;_t=(E=g.lencode[N&(1<<g.lenbits)-1])>>>16&255,At=65535&E,!((ut=E>>>24)<=I);){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if(_t&&(240&_t)==0){for(Tt=ut,be=_t,ie=At;_t=(E=g.lencode[ie+((N&(1<<Tt+be)-1)>>Tt)])>>>16&255,At=65535&E,!(Tt+(ut=E>>>24)<=I);){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}N>>>=Tt,I-=Tt,g.back+=Tt}if(N>>>=ut,I-=ut,g.back+=ut,g.length=At,_t===0){g.mode=26;break}if(32&_t){g.back=-1,g.mode=12;break}if(64&_t){S.msg="invalid literal/length code",g.mode=30;break}g.extra=15&_t,g.mode=22;case 22:if(g.extra){for(w=g.extra;I<w;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}g.length+=N&(1<<g.extra)-1,N>>>=g.extra,I-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;_t=(E=g.distcode[N&(1<<g.distbits)-1])>>>16&255,At=65535&E,!((ut=E>>>24)<=I);){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if((240&_t)==0){for(Tt=ut,be=_t,ie=At;_t=(E=g.distcode[ie+((N&(1<<Tt+be)-1)>>Tt)])>>>16&255,At=65535&E,!(Tt+(ut=E>>>24)<=I);){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}N>>>=Tt,I-=Tt,g.back+=Tt}if(N>>>=ut,I-=ut,g.back+=ut,64&_t){S.msg="invalid distance code",g.mode=30;break}g.offset=At,g.extra=15&_t,g.mode=24;case 24:if(g.extra){for(w=g.extra;I<w;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}g.offset+=N&(1<<g.extra)-1,N>>>=g.extra,I-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){S.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(at===0)break t;if(J=q-at,g.offset>J){if((J=g.offset-J)>g.whave&&g.sane){S.msg="invalid distance too far back",g.mode=30;break}Dt=J>g.wnext?(J-=g.wnext,g.wsize-J):g.wnext-J,J>g.length&&(J=g.length),$t=g.window}else $t=ot,Dt=st-g.offset,J=g.length;for(at<J&&(J=at),at-=J,g.length-=J;ot[st++]=$t[Dt++],--J;);g.length===0&&(g.mode=21);break;case 26:if(at===0)break t;ot[st++]=g.length,at--,g.mode=21;break;case 27:if(g.wrap){for(;I<32;){if(G===0)break t;G--,N|=H[U++]<<I,I+=8}if(q-=at,S.total_out+=q,g.total+=q,q&&(S.adler=g.check=g.flags?n(g.check,ot,q,st-q):s(g.check,ot,q,st-q)),q=at,(g.flags?N:y(N))!==g.check){S.msg="incorrect data check",g.mode=30;break}I=N=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;I<32;){if(G===0)break t;G--,N+=H[U++]<<I,I+=8}if(N!==(4294967295&g.total)){S.msg="incorrect length check",g.mode=30;break}I=N=0}g.mode=29;case 29:O=1;break t;case 30:O=-3;break t;case 31:return-4;case 32:default:return u}return S.next_out=st,S.avail_out=at,S.next_in=U,S.avail_in=G,g.hold=N,g.bits=I,(g.wsize||q!==S.avail_out&&g.mode<30&&(g.mode<27||R!==4))&&K(S,S.output,S.next_out,q-S.avail_out)?(g.mode=31,-4):(it-=S.avail_in,q-=S.avail_out,S.total_in+=it,S.total_out+=q,g.total+=q,g.wrap&&q&&(S.adler=g.check=g.flags?n(g.check,ot,q,S.next_out-q):s(g.check,ot,q,S.next_out-q)),S.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(it==0&&q===0||R===4)&&O===p&&(O=-5),O)},o.inflateEnd=function(S){if(!S||!S.state)return u;var R=S.state;return R.window&&(R.window=null),S.state=null,p},o.inflateGetHeader=function(S,R){var g;return S&&S.state?(2&(g=S.state).wrap)==0?u:((g.head=R).done=!1,p):u},o.inflateSetDictionary=function(S,R){var g,H=R.length;return S&&S.state?(g=S.state).wrap!==0&&g.mode!==11?u:g.mode===11&&s(1,R,H,0)!==g.check?-3:K(S,R,H,H)?(g.mode=31,-4):(g.havedict=1,p):u},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,a,o){var r=i("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];a.exports=function(h,f,p,u,m,_,b,y){var v,D,C,L,P,M,Y,$,j,K=y.bits,S=0,R=0,g=0,H=0,ot=0,U=0,st=0,G=0,at=0,N=0,I=null,it=0,q=new r.Buf16(16),J=new r.Buf16(16),Dt=null,$t=0;for(S=0;S<=15;S++)q[S]=0;for(R=0;R<u;R++)q[f[p+R]]++;for(ot=K,H=15;1<=H&&q[H]===0;H--);if(H<ot&&(ot=H),H===0)return m[_++]=20971520,m[_++]=20971520,y.bits=1,0;for(g=1;g<H&&q[g]===0;g++);for(ot<g&&(ot=g),S=G=1;S<=15;S++)if(G<<=1,(G-=q[S])<0)return-1;if(0<G&&(h===0||H!==1))return-1;for(J[1]=0,S=1;S<15;S++)J[S+1]=J[S]+q[S];for(R=0;R<u;R++)f[p+R]!==0&&(b[J[f[p+R]]++]=R);if(M=h===0?(I=Dt=b,19):h===1?(I=s,it-=257,Dt=n,$t-=257,256):(I=l,Dt=c,-1),S=g,P=_,st=R=N=0,C=-1,L=(at=1<<(U=ot))-1,h===1&&852<at||h===2&&592<at)return 1;for(;;){for(Y=S-st,j=b[R]<M?($=0,b[R]):b[R]>M?($=Dt[$t+b[R]],I[it+b[R]]):($=96,0),v=1<<S-st,g=D=1<<U;m[P+(N>>st)+(D-=v)]=Y<<24|$<<16|j|0,D!==0;);for(v=1<<S-1;N&v;)v>>=1;if(v!==0?(N&=v-1,N+=v):N=0,R++,--q[S]==0){if(S===H)break;S=f[p+b[R]]}if(ot<S&&(N&L)!==C){for(st===0&&(st=ot),P+=g,G=1<<(U=S-st);U+st<H&&!((G-=q[U+st])<=0);)U++,G<<=1;if(at+=1<<U,h===1&&852<at||h===2&&592<at)return 1;m[C=N&L]=ot<<24|U<<16|P-_|0}}return N!==0&&(m[P+N]=S-st<<24|64<<16|0),y.bits=ot,0}},{"../utils/common":41}],51:[function(i,a,o){a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,a,o){var r=i("../utils/common"),s=0,n=1;function l(E){for(var T=E.length;0<=--T;)E[T]=0}var c=0,h=29,f=256,p=f+1+h,u=30,m=19,_=2*p+1,b=15,y=16,v=7,D=256,C=16,L=17,P=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=new Array(2*(p+2));l(K);var S=new Array(2*u);l(S);var R=new Array(512);l(R);var g=new Array(256);l(g);var H=new Array(h);l(H);var ot,U,st,G=new Array(u);function at(E,T,X,z,k){this.static_tree=E,this.extra_bits=T,this.extra_base=X,this.elems=z,this.max_length=k,this.has_stree=E&&E.length}function N(E,T){this.dyn_tree=E,this.max_code=0,this.stat_desc=T}function I(E){return E<256?R[E]:R[256+(E>>>7)]}function it(E,T){E.pending_buf[E.pending++]=255&T,E.pending_buf[E.pending++]=T>>>8&255}function q(E,T,X){E.bi_valid>y-X?(E.bi_buf|=T<<E.bi_valid&65535,it(E,E.bi_buf),E.bi_buf=T>>y-E.bi_valid,E.bi_valid+=X-y):(E.bi_buf|=T<<E.bi_valid&65535,E.bi_valid+=X)}function J(E,T,X){q(E,X[2*T],X[2*T+1])}function Dt(E,T){for(var X=0;X|=1&E,E>>>=1,X<<=1,0<--T;);return X>>>1}function $t(E,T,X){var z,k,W=new Array(b+1),Z=0;for(z=1;z<=b;z++)W[z]=Z=Z+X[z-1]<<1;for(k=0;k<=T;k++){var V=E[2*k+1];V!==0&&(E[2*k]=Dt(W[V]++,V))}}function ut(E){var T;for(T=0;T<p;T++)E.dyn_ltree[2*T]=0;for(T=0;T<u;T++)E.dyn_dtree[2*T]=0;for(T=0;T<m;T++)E.bl_tree[2*T]=0;E.dyn_ltree[2*D]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function _t(E){8<E.bi_valid?it(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function At(E,T,X,z){var k=2*T,W=2*X;return E[k]<E[W]||E[k]===E[W]&&z[T]<=z[X]}function Tt(E,T,X){for(var z=E.heap[X],k=X<<1;k<=E.heap_len&&(k<E.heap_len&&At(T,E.heap[k+1],E.heap[k],E.depth)&&k++,!At(T,z,E.heap[k],E.depth));)E.heap[X]=E.heap[k],X=k,k<<=1;E.heap[X]=z}function be(E,T,X){var z,k,W,Z,V=0;if(E.last_lit!==0)for(;z=E.pending_buf[E.d_buf+2*V]<<8|E.pending_buf[E.d_buf+2*V+1],k=E.pending_buf[E.l_buf+V],V++,z===0?J(E,k,T):(J(E,(W=g[k])+f+1,T),(Z=M[W])!==0&&q(E,k-=H[W],Z),J(E,W=I(--z),X),(Z=Y[W])!==0&&q(E,z-=G[W],Z)),V<E.last_lit;);J(E,D,T)}function ie(E,T){var X,z,k,W=T.dyn_tree,Z=T.stat_desc.static_tree,V=T.stat_desc.has_stree,et=T.stat_desc.elems,vt=-1;for(E.heap_len=0,E.heap_max=_,X=0;X<et;X++)W[2*X]!==0?(E.heap[++E.heap_len]=vt=X,E.depth[X]=0):W[2*X+1]=0;for(;E.heap_len<2;)W[2*(k=E.heap[++E.heap_len]=vt<2?++vt:0)]=1,E.depth[k]=0,E.opt_len--,V&&(E.static_len-=Z[2*k+1]);for(T.max_code=vt,X=E.heap_len>>1;1<=X;X--)Tt(E,W,X);for(k=et;X=E.heap[1],E.heap[1]=E.heap[E.heap_len--],Tt(E,W,1),z=E.heap[1],E.heap[--E.heap_max]=X,E.heap[--E.heap_max]=z,W[2*k]=W[2*X]+W[2*z],E.depth[k]=(E.depth[X]>=E.depth[z]?E.depth[X]:E.depth[z])+1,W[2*X+1]=W[2*z+1]=k,E.heap[1]=k++,Tt(E,W,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],function(ht,Jt){var Bi,ye,$i,Ct,ln,aa,De=Jt.dyn_tree,vr=Jt.max_code,Pc=Jt.stat_desc.static_tree,Fc=Jt.stat_desc.has_stree,Hc=Jt.stat_desc.extra_bits,Er=Jt.stat_desc.extra_base,Mi=Jt.stat_desc.max_length,cn=0;for(Ct=0;Ct<=b;Ct++)ht.bl_count[Ct]=0;for(De[2*ht.heap[ht.heap_max]+1]=0,Bi=ht.heap_max+1;Bi<_;Bi++)Mi<(Ct=De[2*De[2*(ye=ht.heap[Bi])+1]+1]+1)&&(Ct=Mi,cn++),De[2*ye+1]=Ct,vr<ye||(ht.bl_count[Ct]++,ln=0,Er<=ye&&(ln=Hc[ye-Er]),aa=De[2*ye],ht.opt_len+=aa*(Ct+ln),Fc&&(ht.static_len+=aa*(Pc[2*ye+1]+ln)));if(cn!==0){do{for(Ct=Mi-1;ht.bl_count[Ct]===0;)Ct--;ht.bl_count[Ct]--,ht.bl_count[Ct+1]+=2,ht.bl_count[Mi]--,cn-=2}while(0<cn);for(Ct=Mi;Ct!==0;Ct--)for(ye=ht.bl_count[Ct];ye!==0;)vr<($i=ht.heap[--Bi])||(De[2*$i+1]!==Ct&&(ht.opt_len+=(Ct-De[2*$i+1])*De[2*$i],De[2*$i+1]=Ct),ye--)}}(E,T),$t(W,vt,E.bl_count)}function d(E,T,X){var z,k,W=-1,Z=T[1],V=0,et=7,vt=4;for(Z===0&&(et=138,vt=3),T[2*(X+1)+1]=65535,z=0;z<=X;z++)k=Z,Z=T[2*(z+1)+1],++V<et&&k===Z||(V<vt?E.bl_tree[2*k]+=V:k!==0?(k!==W&&E.bl_tree[2*k]++,E.bl_tree[2*C]++):V<=10?E.bl_tree[2*L]++:E.bl_tree[2*P]++,W=k,vt=(V=0)===Z?(et=138,3):k===Z?(et=6,3):(et=7,4))}function O(E,T,X){var z,k,W=-1,Z=T[1],V=0,et=7,vt=4;for(Z===0&&(et=138,vt=3),z=0;z<=X;z++)if(k=Z,Z=T[2*(z+1)+1],!(++V<et&&k===Z)){if(V<vt)for(;J(E,k,E.bl_tree),--V!=0;);else k!==0?(k!==W&&(J(E,k,E.bl_tree),V--),J(E,C,E.bl_tree),q(E,V-3,2)):V<=10?(J(E,L,E.bl_tree),q(E,V-3,3)):(J(E,P,E.bl_tree),q(E,V-11,7));W=k,vt=(V=0)===Z?(et=138,3):k===Z?(et=6,3):(et=7,4)}}l(G);var A=!1;function w(E,T,X,z){q(E,(c<<1)+(z?1:0),3),function(k,W,Z,V){_t(k),V&&(it(k,Z),it(k,~Z)),r.arraySet(k.pending_buf,k.window,W,Z,k.pending),k.pending+=Z}(E,T,X,!0)}o._tr_init=function(E){A||(function(){var T,X,z,k,W,Z=new Array(b+1);for(k=z=0;k<h-1;k++)for(H[k]=z,T=0;T<1<<M[k];T++)g[z++]=k;for(g[z-1]=k,k=W=0;k<16;k++)for(G[k]=W,T=0;T<1<<Y[k];T++)R[W++]=k;for(W>>=7;k<u;k++)for(G[k]=W<<7,T=0;T<1<<Y[k]-7;T++)R[256+W++]=k;for(X=0;X<=b;X++)Z[X]=0;for(T=0;T<=143;)K[2*T+1]=8,T++,Z[8]++;for(;T<=255;)K[2*T+1]=9,T++,Z[9]++;for(;T<=279;)K[2*T+1]=7,T++,Z[7]++;for(;T<=287;)K[2*T+1]=8,T++,Z[8]++;for($t(K,p+1,Z),T=0;T<u;T++)S[2*T+1]=5,S[2*T]=Dt(T,5);ot=new at(K,M,f+1,p,b),U=new at(S,Y,0,u,b),st=new at(new Array(0),$,0,m,v)}(),A=!0),E.l_desc=new N(E.dyn_ltree,ot),E.d_desc=new N(E.dyn_dtree,U),E.bl_desc=new N(E.bl_tree,st),E.bi_buf=0,E.bi_valid=0,ut(E)},o._tr_stored_block=w,o._tr_flush_block=function(E,T,X,z){var k,W,Z=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=function(V){var et,vt=4093624447;for(et=0;et<=31;et++,vt>>>=1)if(1&vt&&V.dyn_ltree[2*et]!==0)return s;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return n;for(et=32;et<f;et++)if(V.dyn_ltree[2*et]!==0)return n;return s}(E)),ie(E,E.l_desc),ie(E,E.d_desc),Z=function(V){var et;for(d(V,V.dyn_ltree,V.l_desc.max_code),d(V,V.dyn_dtree,V.d_desc.max_code),ie(V,V.bl_desc),et=m-1;3<=et&&V.bl_tree[2*j[et]+1]===0;et--);return V.opt_len+=3*(et+1)+5+5+4,et}(E),k=E.opt_len+3+7>>>3,(W=E.static_len+3+7>>>3)<=k&&(k=W)):k=W=X+5,X+4<=k&&T!==-1?w(E,T,X,z):E.strategy===4||W===k?(q(E,2+(z?1:0),3),be(E,K,S)):(q(E,4+(z?1:0),3),function(V,et,vt,ht){var Jt;for(q(V,et-257,5),q(V,vt-1,5),q(V,ht-4,4),Jt=0;Jt<ht;Jt++)q(V,V.bl_tree[2*j[Jt]+1],3);O(V,V.dyn_ltree,et-1),O(V,V.dyn_dtree,vt-1)}(E,E.l_desc.max_code+1,E.d_desc.max_code+1,Z+1),be(E,E.dyn_ltree,E.dyn_dtree)),ut(E),z&&_t(E)},o._tr_tally=function(E,T,X){return E.pending_buf[E.d_buf+2*E.last_lit]=T>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&T,E.pending_buf[E.l_buf+E.last_lit]=255&X,E.last_lit++,T===0?E.dyn_ltree[2*X]++:(E.matches++,T--,E.dyn_ltree[2*(g[X]+f+1)]++,E.dyn_dtree[2*I(T)]++),E.last_lit===E.lit_bufsize-1},o._tr_align=function(E){q(E,2,3),J(E,D,K),function(T){T.bi_valid===16?(it(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(E)}},{"../utils/common":41}],53:[function(i,a,o){a.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,a,o){(function(r){(function(s,n){if(!s.setImmediate){var l,c,h,f,p=1,u={},m=!1,_=s.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(s);b=b&&b.setTimeout?b:s,l={}.toString.call(s.process)==="[object process]"?function(C){process.nextTick(function(){v(C)})}:function(){if(s.postMessage&&!s.importScripts){var C=!0,L=s.onmessage;return s.onmessage=function(){C=!1},s.postMessage("","*"),s.onmessage=L,C}}()?(f="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",D,!1):s.attachEvent("onmessage",D),function(C){s.postMessage(f+C,"*")}):s.MessageChannel?((h=new MessageChannel).port1.onmessage=function(C){v(C.data)},function(C){h.port2.postMessage(C)}):_&&"onreadystatechange"in _.createElement("script")?(c=_.documentElement,function(C){var L=_.createElement("script");L.onreadystatechange=function(){v(C),L.onreadystatechange=null,c.removeChild(L),L=null},c.appendChild(L)}):function(C){setTimeout(v,0,C)},b.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var L=new Array(arguments.length-1),P=0;P<L.length;P++)L[P]=arguments[P+1];var M={callback:C,args:L};return u[p]=M,l(p),p++},b.clearImmediate=y}function y(C){delete u[C]}function v(C){if(m)setTimeout(v,0,C);else{var L=u[C];if(L){m=!0;try{(function(P){var M=P.callback,Y=P.args;switch(Y.length){case 0:M();break;case 1:M(Y[0]);break;case 2:M(Y[0],Y[1]);break;case 3:M(Y[0],Y[1],Y[2]);break;default:M.apply(n,Y)}})(L)}finally{y(C),m=!1}}}}function D(C){C.source===s&&typeof C.data=="string"&&C.data.indexOf(f)===0&&v(+C.data.slice(f.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof _n<"u"?_n:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Bc);const Rf=Bc.exports;async function If(t){return await Rf.loadAsync(t)}const ae=()=>"[main]",Ne=async t=>{var e;try{console.time("loading time"),dn.enable(!1);let i;if(t.file)i=t.file;else if(t.link)i=await kf(Es(decodeURI(t.link)));else if(t.id)i=await Ac(ws(decodeURI(t.id)));else if(t.hash&&vs(decodeURI(t.hash).trim()))i=await xf(decodeURI(t.hash).trim());else throw new Error("Could not search for file.");bt.status("info","Extracting zip",0),zt.switchHeader(!1);const a=await If(i);dn.enable(!1),bt.status("info","Parsing map info...",0),nt.info(ae(),"Parsing map info");const o=await Df(a);lt.beatmapInfo=o,ou(o),bt.status("info","Loading image...",10.4375),nt.info(ae(),"Loading cover image");let r=a.file(o._coverImageFilename);if(Q.load.imageCover&&r){let n=await r.async("base64");zt.setCoverImage("data:image;base64,"+n),wi.loading.coverImage=!0}else nt.error(ae(),`${o._coverImageFilename} does not exists.`);if(lt.contributors=[],(e=o==null?void 0:o._customData)!=null&&e._contributors)for(const n of o._customData._contributors){nt.info(ae(),"Loading contributor image "+n._name),r=a.file(n._iconPath);let l=null;Q.load.imageContributor&&r?l=await r.async("base64"):nt.error(ae(),`${n._iconPath} does not exists.`),lt.contributors.push({...n,_base64:l})}bt.status("info","Loading audio...",20.875),nt.info(ae(),"Loading audio");let s=a.file(o._songFilename);if(Q.load.audio&&s){let n=!1;setTimeout(()=>{n||bt.status("info","Loading audio... (this may take a while)",20.875)},1e4);let l=await s.async("arraybuffer");zt.setAudio(l),await new AudioContext().decodeAudioData(l).then(h=>{n=!0;let f=h.duration;lt.duration=f,zt.setSongDuration(f),wi.loading.audio=!0}).catch(function(h){zt.setSongDuration(),nt.error(ae(),h)})}else zt.setSongDuration(),nt.error(ae(),`${o._songFilename} does not exist.`);bt.status("info","Parsing difficulty...",70),lt.beatmapDifficulty=await Tf(o,a),vi.adjustTime(),bt.status("info","Adding map difficulty stats...",80),nt.info(ae(),"Adding map stats"),vf(),Xs(lt.contributors),bt.status("info","Analysing map...",85),nt.info(ae(),"Analysing map"),mi.runGeneral(),vi.displayOutputGeneral(),bt.status("info","Analysing difficulty...",90),mi.applyAll(),vi.populateSelect(o),vi.displayOutputDifficulty(),dn.enable(!0),bt.status("info","Map successfully loaded!"),console.timeEnd("loading time")}catch(i){bt.status("error",i,100),nt.error(ae(),i),lt.clear(),dn.enable(!0),zt.switchHeader(!0)}},Ai="UI Intro: ",Zi=document.querySelector(".input__intro-url"),Ki=document.querySelector(".input__intro-id"),Qi=document.querySelector(".input__intro-hash"),ds=document.querySelector(".input__search-button"),fs=document.querySelector(".input__file"),la=document.querySelector(".input__file-zone");if(Zi)Zi.addEventListener("keydown",pr);else throw new Error(Ai+"URL input is missing");if(Ki)Ki.addEventListener("keydown",pr);else throw new Error(Ai+"ID input is missing");if(Qi)Qi.addEventListener("keydown",pr);else throw new Error(Ai+"Hash input is missing");if(ds)ds.addEventListener("click",Nf);else throw new Error(Ai+"search button is missing");if(fs)fs.addEventListener("change",Af);else throw new Error(Ai+"file input is missing");if(la)la.addEventListener("drop",Bf),la.addEventListener("dragover",$f);else throw new Error(Ai+"file drop zone is missing");function pr(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&Ne({link:e.value}),e.classList.contains("input__intro-id")&&Ne({id:e.value}),e.classList.contains("input__intro-hash")&&Ne({hash:e.value}))}function Nf(t){if(Zi&&Zi.value!==""){Ne({link:Zi.value});return}if(Ki&&Ki.value!==""){Ne({id:Ki.value});return}if(Qi&&Qi.value!==""){Ne({hash:Qi.value});return}}function Af(t){const e=t.target;bt.status("info","Reading file input",0);const i=e.files?e.files[0]:null;try{if(i==null)throw bt.status("info","No file input",0),new Error("No file input");if(i&&(i.name.substr(-4)===".zip"||i.name.substr(-4)===".bsl")){const a=new FileReader;a.readAsArrayBuffer(i),a.addEventListener("load",()=>{Ne({file:i})})}else throw new Error("Unsupported file format, please enter zip file")}catch(a){bt.status("error",a,0),console.error(a)}}function Bf(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items&&t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const i=new FileReader;i.readAsArrayBuffer(e),i.addEventListener("load",()=>{Ne({file:e})})}else throw new Error("Unsupported file format, please enter zip file")}}catch(e){bt.status("error",e,0),console.error(e)}}function $f(t){t.preventDefault(),t.stopPropagation()}const Mf=document.querySelector("body"),Of=["Dark","Light","Monochrome"],_r={list:Of,set:t=>{Mf.className="theme-"+t.toLowerCase().replace(" ","")}},ge="UI Settings: ",In=document.querySelector(".settings__theme"),Ma=document.querySelector(".settings__beat-numbering"),Oa=document.querySelector(".settings__rounding"),Pa=document.querySelector(".settings__info-height"),Fa=document.querySelector(".settings__data-check"),Ha=document.querySelector(".settings__data-error"),gr=document.querySelectorAll(".settings__load"),ta=document.querySelector(".settings__sort"),br=document.querySelectorAll(".settings__show"),yr=document.querySelectorAll(".settings__onload"),ms=document.querySelector(".settings__clear-button");if(In)In.addEventListener("change",Pf),_r.list.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,In.add(e)});else throw new Error(ge+"theme select is missing");if(Ma)Ma.addEventListener("change",Ff);else throw new Error(ge+"missing settings");if(Oa)Oa.addEventListener("change",Hf);else throw new Error(ge+"missing settings");if(Pa)Pa.addEventListener("change",Xf);else throw new Error(ge+"missing settings");if(Fa)Fa.addEventListener("change",zf);else throw new Error(ge+"missing settings");if(Ha)Ha.addEventListener("change",Yf);else throw new Error(ge+"missing settings");gr.length||console.error(ge+"empty load list, intentional or typo error?");gr.forEach(t=>t.addEventListener("change",Vf));if(ta)ta.addEventListener("change",Gf);else throw new Error(ge+"sort check is missing");yr.length||console.error(ge+"empty onload list, intentional or typo error?");yr.forEach(t=>t.addEventListener("change",qf));br.length||console.error(ge+"empty show list, intentional or typo error?");br.forEach(t=>t.addEventListener("change",Uf));if(ms)ms.addEventListener("click",$c);else throw new Error(ge+"clear button is missing");function Pf(t){const e=t.target;Q.theme=e.options[e.options.selectedIndex].value,_r.set(Q.theme),Q.save()}function Ff(t){const e=t.target;Q.beatNumbering=e.options[e.options.selectedIndex].value,Q.save()}function Hf(t){const e=t.target;Q.rounding=parseInt(e.value),Q.save()}function Xf(t){const e=t.target;Q.infoRowHeight=parseInt(e.value),Us(Q.infoRowHeight),Q.save()}function zf(t){const e=t.target;Q.dataCheck=e.checked,Q.save()}function Yf(t){const e=t.target;Q.dataError=e.checked,Q.save()}function Uf(t){const e=t.target,i=e.id.replace("settings__show-","");Q.show[i]=e.checked,Q.save()}function jf(t,e){br.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}function Gf(t){const e=t.target;Q.sorting=e.checked,Q.save()}function Wf(t){ta&&(ta.checked=t)}function Vf(t){const e=t.target,i=e.name;Q.load[i]=e.checked,Q.save()}function Jf(t,e){gr.forEach(i=>{i.name===t&&(i.checked=e)})}function qf(t){const e=t.target,i=e.name;Q.onLoad[i]=e.checked,Q.save()}function Zf(t,e){yr.forEach(i=>{i.name===t&&(i.checked=e)})}function Kf(t){In.value=t}function Qf(t){Ma.value=t}function tm(t){Oa.value=t.toString()}function em(t){Pa.value=t.toString(),Us(Q.infoRowHeight)}function im(t){Fa.checked=t}function nm(t){Ha.checked=t}function $c(){Q.clear(),Q.reset(),location.reload()}const ve={setShowCheck:jf,setSortCheck:Wf,setLoadCheck:Jf,setOnLoadCheck:Zf,setTheme:Kf,setBeatNumbering:Qf,setRounding:tm,setInfoHeight:em,setDataCheck:im,setDataError:nm,clear:$c},am=document.querySelectorAll(".input__reset-button");am.forEach(t=>t.addEventListener("click",rm));function rm(){bt.reset(),zt.reset(),su(),vi.reset(),Ef(),lt.clear()}const om=2,sm=5,lm=4,cm="Kival Evan#5480",ps=new class{constructor(){this._version=`${om}.${sm}.${lm}`,this._wm=cm}get value(){return this._version}get watermark(){return this._wm}},um="UI Footer: ",Mc=document.querySelectorAll(".link__watermark"),Oc=document.querySelectorAll(".link__version");(!Mc.length||!Oc.length)&&console.error(um+"missing part");const _s={setWatermark:t=>{Mc.forEach(e=>e.textContent=t)},setVersion:t=>{Oc.forEach(e=>e.textContent=t)}},hm=function(){let t=!1;return function(){if(!t){t=!0,_s.setWatermark(ps.watermark),_s.setVersion(ps.value),vi.populateTool(),ve.setTheme(Q.theme),ve.setBeatNumbering(Q.beatNumbering),ve.setRounding(Q.rounding),ve.setInfoHeight(Q.infoRowHeight),ve.setDataCheck(Q.dataCheck),ve.setDataError(Q.dataError);for(const e in Q.load)ve.setLoadCheck(e,Q.load[e]);ve.setSortCheck(Q.sorting);for(const e in Q.show)ys.show(e,Q.show[e]),ve.setShowCheck(e,Q.show[e]);for(const e in Q.onLoad)ve.setOnLoadCheck(e,Q.onLoad[e]);_r.set(Q.theme),nt.info("User interface initialised")}}}();(function(){hm();const t=new URL(location.href),e=t.searchParams.get("url"),i=t.searchParams.get("id"),a=t.searchParams.get("hash");(i||e||a)&&Ne({link:e,id:i,hash:a})})();
