import{J as sr}from"./vendor.6089e67f.js";const il=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}};il();const rl="UI Accordion: ",Oe="accordion__";var An;(function(t){t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy"})(An||(An={}));const cr=document.querySelectorAll(".accordion__button");cr.length||console.error(rl+"empty accordion list, intentional or typo error?");const al=(t,e,n,o=!1)=>{const i=document.createElement("div");i.className="accordion";const r=document.createElement("input");r.className=Oe+"button",r.id=t,r.setAttribute("type","checkbox");const a=document.createElement("label");a.className=Oe+"label unselectable",a.htmlFor=t,a.textContent=e,n&&a.classList.add(An[n]);const l=document.createElement("div");return l.className=o?Oe+"collapsible-flex":Oe+"collapsible",l.id=t+"-content",i.appendChild(r),i.appendChild(a),i.appendChild(l),i},ll=(t,e)=>{cr.forEach(n=>{n.id.endsWith(t)&&(n.checked=e)})},F=t=>{if(!t)return"0:00";const e=Math.floor(t),n=e/60,o=n<0?`-${Math.ceil(n).toString()}`:Math.floor(n).toString(),i=Math.abs(e%60).toString().padStart(2,"0");return`${o}:${i}`},sl=t=>{var n;if(!t)return"0:00.000";const e=((n=(t%1).toString().split(".")[1])==null?void 0:n.padEnd(3,"0").slice(0,3))||"000";return`${F(t)}.${e}`},cl=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),_=(t,e=0)=>Math.round(t*Math.pow(10,e))/Math.pow(10,e),On=t=>t*(180/Math.PI),se=t=>t*(Math.PI/180),ur=(t,e)=>{e<0&&(e=-e);let n=t%e;return n<0?n+e:n},mr=(t,e,n)=>Math.min(ur(t-e,n),ur(e-t,n)),qn=t=>{if(t.length===0)return 0;t.sort((n,o)=>n-o);const e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2},dr=t=>{let e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")},pr=t=>{let e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")},hr=t=>/[a-fA-F0-9]*/g.test(t),Jn=t=>{for(let e=t.options.length-1;e>=0;e--)t.remove(e)},D="UI Header: ",qe=document.querySelector(".intro"),Je=document.querySelector(".metadata"),mt=document.querySelector(".cover__link"),Te=document.querySelector(".cover__image"),Un=document.querySelector(".metadata__song-name"),Gn=document.querySelector(".metadata__song-subname"),Xn=document.querySelector(".metadata__song-author"),Vn=document.querySelector(".metadata__song-bpm"),Ue=document.querySelector(".metadata__song-duration"),Ge=document.querySelector(".audio");(!qe||!Je)&&console.error(D+"header component is missing one of the two section");(!mt||!Te)&&console.error(D+"cover component is missing");(!Un||!Gn||!Xn||!Vn||!Ue)&&console.error(D+"metadata component is missing one of the part");const zn=t=>{if(!qe||!Je){console.error(D+"could not switch header, one of the section is missing");return}t?qe.classList.add("hidden"):qe.classList.remove("hidden"),t?Je.classList.remove("hidden"):Je.classList.add("hidden")},_r=t=>{if(!Te){console.error(D+"missing HTML element for cover image");return}Te.src=t||"./img/unknown.jpg"},ul=()=>Te?Te.src:(console.error(D+"missing HTML element for cover image"),null),Yn=(t,e)=>{if(!mt){console.error(D+"missing HTML element for cover link");return}if(t==null&&e==null){mt.textContent="",mt.href="",mt.classList.add("disabled");return}t!=null&&(mt.textContent=e!=null?e:"Download Link",mt.href=t,mt.classList.remove("disabled"))},ml=t=>{if(!Un){console.error(D+"missing HTML element for song name");return}Un.textContent=t},dl=t=>{if(!Gn){console.error(D+"missing HTML element for song subname");return}Gn.textContent=t},pl=t=>{if(!Xn){console.error(D+"missing HTML element for song author");return}Xn.textContent=t},hl=(t,e,n)=>{if(!Vn){console.error(D+"missing HTML element for song bpm");return}let o=_(t,2).toString()+"BPM";Vn.textContent=o},Xe=t=>{if(!Ue){console.error(D+"missing HTML element for song duration");return}t?Ue.textContent=sl(t):Ue.textContent="No audio"};let _l;const fl=async t=>{if(!Ge){console.error(D+"missing HTML element for audio");return}const e=new Blob([t],{type:"audio/ogg"});Ge.src=window.URL.createObjectURL(e)},gl=()=>{if(!Ge){console.error(D+"missing HTML element for audio");return}Ge.src="",window.URL.revokeObjectURL(_l)},bl=()=>{zn(!1),_r(null),Yn(),Xe(0),gl()};class yl{constructor(e,n=[],o=0){this._bpm=e,this._offset=o/1e3,this._bpmChange=this.getBPMChangeTime([...n])}get value(){return this._bpm}set value(e){this._bpm=e}get change(){return this._bpmChange}set change(e){this._bpmChange=this.getBPMChangeTime([...e])}get offset(){return this._offset*1e3}set offset(e){this._offset=e/1e3}getBPMChangeTime(e=[]){var i;let n;const o=[];for(let r=0;r<e.length;r++){let a={_BPM:(i=e[r]._BPM)!=null?i:e[r]._bpm,_time:e[r]._time,_newTime:0};n?a._newTime=Math.ceil((a._time-n._time)/this._bpm*n._BPM+n._newTime-.01):a._newTime=Math.ceil(a._time-this._offset*this._bpm/60-.01),o.push(a),n=a}return o}offsetBegone(e){return(this.toRealTime(e)-this._offset)*this._bpm/60}toRealTime(e){return e/this._bpm*60}toBeatTime(e){return e*this._bpm/60}adjustTime(e){for(let n=this._bpmChange.length-1;n>=0;n--)if(e>this._bpmChange[n]._time)return(e-this._bpmChange[n]._time)/this._bpm*this._bpmChange[n]._BPM+this._bpmChange[n]._newTime;return this.offsetBegone(e)}}const it=(t,e,n)=>new yl(t,e,n);var Ve;(function(t){t.Standard="Standard",t.NoArrows="No Arrows",t.OneSaber="One Saber",t["360Degree"]="360 Degree",t["90Degree"]="90 Degree",t.Lightshow="Lightshow",t.Lawless="Lawless"})(Ve||(Ve={}));var ze;(function(t){t[t.Standard=0]="Standard",t[t.NoArrows=1]="NoArrows",t[t.OneSaber=2]="OneSaber",t[t["360Degree"]=3]="360Degree",t[t["90Degree"]=4]="90Degree",t[t.Lightshow=5]="Lightshow",t[t.Lawless=6]="Lawless"})(ze||(ze={}));var Kn;(function(t){t._id="Ct",t._lookupMethod="Lm",t._duplicate="D",t._active="A",t._scale="S",t._position="P",t._localPosition="Lp",t._rotation="R",t._localRotation="Lr",t._lightID="Li",t._track="T"})(Kn||(Kn={}));var ce;(function(t){t.Easy="Easy",t.Normal="Normal",t.Hard="Hard",t.Expert="Expert",t.ExpertPlus="Expert+"})(ce||(ce={}));var Wn;(function(t){t[t.Easy=1]="Easy",t[t.Normal=3]="Normal",t[t.Hard=5]="Hard",t[t.Expert=7]="Expert",t[t.ExpertPlus=9]="ExpertPlus"})(Wn||(Wn={}));var Zn;(function(t){t._colorLeft="Left Note Color",t._colorRight="Right Note Color",t._envColorLeft="Left Environment Color",t._envColorRight="Right Environment Color",t._envColorLeftBoost="Left Environment Boost Color",t._envColorRightBoost="Right Environment Boost Color",t._obstacleColor="Obstacle Color"})(Zn||(Zn={}));var Qn;(function(t){t.DefaultEnvironment="The First",t.OriginsEnvironment="Origins",t.Origins="Origins",t.TriangleEnvironment="Triangle",t.NiceEnvironment="Nice",t.BigMirrorEnvironment="Big Mirror",t.DragonsEnvironment="Dragons",t.KDAEnvironment="K/DA",t.MonstercatEnvironment="Monstercat",t.CrabRaveEnvironment="Crab Rave",t.PanicEnvironment="Panic",t.RocketEnvironment="Rocket",t.GreenDayEnvironment="Green Day",t.GreenDayGrenadeEnvironment="Green Day Grenade",t.TimbalandEnvironment="Timbaland",t.FitBeatEnvironment="FitBeat",t.LinkinParkEnvironment="Linkin Park",t.BTSEnvironment="BTS",t.KaleidoscopeEnvironment="Kaleidoscope",t.InterscopeEnvironment="Interscope",t.SkrillexEnvironment="Skrillex",t.BillieEnvironment="Billie",t.HalloweenEnvironment="Spooky",t.GlassDesertEnvironment="Glass Desert"})(Qn||(Qn={}));var S;(function(t){t.DefaultEnvironment="The First",t.OriginsEnvironment="Origins",t.Origins="Origins",t.TriangleEnvironment="The First",t.NiceEnvironment="The First",t.BigMirrorEnvironment="The First",t.DragonsEnvironment="The First",t.KDAEnvironment="KDA",t.MonstercatEnvironment="The First",t.CrabRaveEnvironment="Crab Rave",t.PanicEnvironment="The First",t.RocketEnvironment="Rocket",t.GreenDayEnvironment="Green Day",t.GreenDayGrenadeEnvironment="Green Day",t.TimbalandEnvironment="Timbaland",t.FitBeatEnvironment="FitBeat",t.LinkinParkEnvironment="Linkin Park",t.BTSEnvironment="BTS",t.KaleidoscopeEnvironment="Kaleidoscope",t.InterscopeEnvironment="Interscope",t.SkrillexEnvironment="Skrillex",t.BillieEnvironment="Billie Eilish",t.HalloweenEnvironment="Spooky",t.GlassDesertEnvironment="Glass Desert"})(S||(S={}));const B={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}},to=t=>t._width>=2||t._lineIndex===1||t._lineIndex===2,vl=t=>t._type===1&&(t._width>2||t._width===2&&t._lineIndex===1),v=(t,e,n=0)=>t._time+t._duration>e._time+e._duration+n,$l=t=>{var e;return Array.isArray((e=t._customData)==null?void 0:e._color)},fr=t=>{var e,n,o,i,r,a,l,s,u,d;return Array.isArray((e=t._customData)==null?void 0:e._animation)||typeof((n=t._customData)==null?void 0:n._fake)=="boolean"||typeof((o=t._customData)==null?void 0:o._interactable)=="boolean"||Array.isArray((i=t._customData)==null?void 0:i._localRotation)||typeof((r=t._customData)==null?void 0:r._noteJumpMovementSpeed)=="number"||typeof((a=t._customData)==null?void 0:a._noteJumpStartBeatOffset)=="number"||Array.isArray((l=t._customData)==null?void 0:l._position)||Array.isArray((s=t._customData)==null?void 0:s._rotation)||Array.isArray((u=t._customData)==null?void 0:u._scale)||typeof((d=t._customData)==null?void 0:d._track)=="string"},eo=t=>t._width>=1e3||t._type>=1e3||t._lineIndex>3||t._lineIndex<0,El=t=>!eo(t)&&t._width>0&&t._width<=4,Tl=t=>{const e={total:0,interactive:0,crouch:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let n=t.length-1;n>=0;n--)e.total++,to(t[n])&&e.interactive++,vl(t[n])&&e.crouch++,$l(t[n])&&e.chroma++,fr(t[n])&&e.noodleExtensions++,eo(t[n])&&e.mappingExtensions++;return e},Ll=t=>{for(let e=0,n=t.length;e<n;e++)if(to(t[e]))return t[e]._time;return Number.MAX_VALUE},wl=t=>{let e=0;for(let n=t.length-1;n>=0;n--)to(t[n])&&(e=Math.max(e,t[n]._time+t[n]._duration));return e},gr=t=>{const{_notes:e,_obstacles:n}=t;let o=Number.MAX_VALUE;e.length>0&&(o=e[0]._time);const i=Ll(n);return Math.min(o,i)},Ye=t=>{const{_notes:e,_obstacles:n}=t;let o=0;e.length>0&&(o=e[e.length-1]._time);const i=wl(n);return Math.max(o,i)},Le=class{constructor(t,e=10,n=0){this._bpm=t,this._njs=e,this._sdm=n,this.update()}set value(t){this._njs=t,this.update()}get value(){return this._njs}set offset(t){this._sdm=t,this.update()}get offset(){return this._sdm}get hjd(){return this._hjd}get hjdMin(){return Le.HJD_MIN}get reactTime(){return this._reactionTime}get jd(){return this._jd}get jdMin(){return this._jdMin}update(){this._hjd=this.calcHalfJumpDuration(),this._jd=this.calcJumpDistance(),this._jdMin=this.calcJumpDistance(Le.HJD_MIN),this._reactionTime=this.calcReactionTimeFromHJD()}calcHalfJumpDurationRaw(){const t=18,e=this._njs*this._njs/this._njs,n=60/this._bpm.value;let o=Le.HJD_START;for(;e*n*o>t;)o/=2;return o<1&&(o=1),o}calcHalfJumpDuration(t=this.offset){return Math.max(this.calcHalfJumpDurationRaw()+t,Le.HJD_MIN)}calcHalfJumpDurationFromJD(t=this.calcJumpDistance()){return t/(60/this._bpm.value*this._njs*2)}calcHalfJumpDurationFromRT(t=this.calcReactionTimeFromHJD()){return t/(60/this._bpm.value)}calcJumpDistance(t=this.calcHalfJumpDuration()){return this._njs*(60/this._bpm.value)*t*2}calcJumpDistanceOptimalHigh(){return 18*(1/1.07)**this._njs+18}calcJumpDistanceOptimalLow(){return-(18/(this._njs+1))+18}calcReactionTimeFromJD(t=this.calcJumpDistance()){return t/(2*this._njs)}calcReactionTimeFromHJD(t=this.calcHalfJumpDuration()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let no=Le;no.HJD_START=4;no.HJD_MIN=.25;const oo=(t,e=10,n=0)=>new no(t,e,n);var io;(function(t){t[t.ExpertPlus=16]="ExpertPlus",t[t.Expert=12]="Expert",t[t.Hard=10]="Hard",t[t.Normal=10]="Normal",t[t.Easy=10]="Easy"})(io||(io={}));var ro;(function(t){t._childrenTracks="Ct",t._color="C",t._definitePosition="Dp",t._dissolve="D",t._dissolveArrow="Da",t._duration="Dur",t._easing="E",t._interactable="I",t._localRotation="Lr",t._parentTrack="Pt",t._position="P",t._rotation="R",t._scale="S",t._time="T",t._track="Tr"})(ro||(ro={}));var br;(function(t){t.audio="Audio",t.imageCover="Cover Image",t.imageContributor="Contributor Image"})(br||(br={}));var yr;(function(t){t.info="Information",t.tools="Tools",t.stats="Stats",t.settings="Settings"})(yr||(yr={}));const vr={_load:{audio:!0,imageCover:!0,imageContributor:!0},_sorting:!0,_beatNumbering:"beattime",_rounding:3,_theme:"Dark",_onLoad:{stats:!1},_show:{info:!1,tools:!1,stats:!1,settings:!1}};class xl{constructor(){this._property=JSON.parse(JSON.stringify(vr)),this.stringify=()=>JSON.stringify({_property:this._property}),this.init=()=>{var n;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const o=JSON.parse(e);this._property=(n=o._property)!=null?n:this._property,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this._property=JSON.parse(JSON.stringify(vr))},this.init()}get load(){return this._property._load}get sorting(){return this._property._sorting}set sorting(e){this._property._sorting=e}get beatNumbering(){return this._property._beatNumbering}set beatNumbering(e){this._property._beatNumbering=e}get rounding(){return this._property._rounding}set rounding(e){this._property._rounding=e}get theme(){return this._property._theme}set theme(e){this._property._theme=e}get onLoad(){return this._property._onLoad}get show(){return this._property._show}}var E=new xl;const Cl=t=>(E.sorting&&(t._difficultyBeatmapSets.sort((e,n)=>ze[e._beatmapCharacteristicName]-ze[n._beatmapCharacteristicName]),t._difficultyBeatmapSets.forEach(e=>{let n=0;e._difficultyBeatmaps.forEach(o=>{o._difficultyRank-n<=0&&console.error(o._difficulty+" may be unordered"),Wn[o._difficulty]!==o._difficultyRank&&console.error(o._difficulty+" has invalid rank"),n=o._difficultyRank}),e._difficultyBeatmaps.sort((o,i)=>i._difficultyRank-o._difficultyRank)})),t),kl=t=>{const{_notes:e,_obstacles:n,_events:o,_waypoints:i}=t;return e.forEach(r=>{for(const a in r)if(r[a]===null)throw new Error("contain null value in _notes object")}),n.forEach(r=>{for(const a in r)if(r[a]===null)throw new Error("contain null value in _obstacles object")}),o.forEach(r=>{for(const a in r)if(r[a]===null)throw new Error("contain null value in _events object")}),i==null||i.forEach(r=>{for(const a in r)if(r[a]===null)throw new Error("contain null value in _waypoints object")}),E.sorting&&(e.sort((r,a)=>r._time-a._time),n.sort((r,a)=>r._time-a._time),o.sort((r,a)=>r._time-a._time),i==null||i.sort((r,a)=>r._time-a._time)),t},rt=[180,0,270,90,225,135,315,45,0],ao=[1,0,3,2,7,6,5,4,8],Z={0:[0,1],1:[0,-1],2:[-1,0],3:[1,0],4:[-1,1],5:[1,1],6:[-1,-1],7:[1,-1],8:[0,0]},I=t=>t._type===0||t._type===1,Ml=t=>t._type===3,A=t=>{var e;return((e=t._customData)==null?void 0:e._position)?[t._customData._position[0],t._customData._position[1]]:[(t._lineIndex<=-1e3||t._lineIndex>=1e3?t._lineIndex/1e3:t._lineIndex)-2,t._lineLayer<=-1e3||t._lineLayer>=1e3?t._lineLayer/1e3:t._lineLayer]},V=t=>{var e;return((e=t._customData)==null?void 0:e._cutDirection)?t._customData._cutDirection>0?t._customData._cutDirection%360:360+t._customData._cutDirection%360:t._cutDirection>=1e3?Math.abs(t._cutDirection%1e3%360-360):rt[t._cutDirection]||0},St=(t,e)=>{const[n,o]=A(t),[i,r]=A(e);return Math.sqrt(Math.pow(i-n,2)+Math.pow(r-o,2))},ue=(t,e)=>{const[n]=A(t),[o]=A(e),i=n-o;return i>-.001&&i<.001},me=(t,e)=>{const[n,o]=A(t),[i,r]=A(e),a=o-r;return a>-.001&&a<.001},Ke=(t,e)=>{const[n,o]=A(t),[i,r]=A(e),a=Math.abs(n-i),l=Math.abs(o-r);return a===l},lo=(t,e)=>{const[n,o]=A(t),[i,r]=A(e),a=n-i,l=o-r;return a>-.5&&a<.5&&l>-.5&&l<.5},Sl=(t,e,n)=>{for(let o=n,i=e.length;o<i;o++){if(e[o]._time<t._time+.01&&e[o]._type!==t._type)return!0;if(e[o]._time>t._time+.01)return!1}return!1},$r=(t,e)=>St(t,e)>1.8,so=(t,e)=>$r(t,e)&&!Ke(t,e)&&!me(t,e)&&!ue(t,e),Er=(t,e,n)=>{const[o,i]=A(t),[r,a]=A(e),l=V(t),s=V(e);let u=!1;if(t._cutDirection!==8){const d=(On(Math.atan2(i-a,o-r))+450)%360,c=(l+315)%360,h=(l+405)%360,m=(l+345)%360,g=(l+375)%360;u=1>=Math.sqrt(Math.pow(o-r,2)+Math.pow(i-a,2))&&(c<h&&c<=d&&d<=h||c>=h&&(d<=h||d>=c))||n>=Math.sqrt(Math.pow(o-r,2)+Math.pow(i-a,2))&&(m<g&&m<=d&&d<=g||m>=g&&(d<=g||d>=m))||u}if(e._cutDirection!==8&&!u){const d=(On(Math.atan2(a-i,r-o))+450)%360,c=(s+315)%360,h=(s+405)%360,m=(s+345)%360,g=(s+375)%360;u=1>=Math.sqrt(Math.pow(o-r,2)+Math.pow(i-a,2))&&(c<h&&c<=d&&d<=h||c>=h&&(d<=h||d>=c))||n>=Math.sqrt(Math.pow(o-r,2)+Math.pow(i-a,2))&&(m<g&&m<=d&&d<=g||m>=g&&(d<=g||d>=m))||u}return u},Tr=(t,e,n)=>t._cutDirection===8&&e._cutDirection===8&&n!==8&&(t._lineIndex>e._lineIndex&&(n===5||n===3||n===7)||t._lineIndex<e._lineIndex&&(n===6||n===2||n===4)||t._lineLayer>e._lineLayer&&(n===4||n===0||n===5)||t._lineLayer<e._lineLayer&&(n===6||n===1||n===7))||t._lineIndex>e._lineIndex&&(t._cutDirection===5||t._cutDirection===3||t._cutDirection===7||(e._cutDirection===5||e._cutDirection===3||e._cutDirection===7)&&t._cutDirection===8)||t._lineIndex<e._lineIndex&&(t._cutDirection===6||t._cutDirection===2||t._cutDirection===4||(e._cutDirection===6||e._cutDirection===2||e._cutDirection===4)&&t._cutDirection===8)||t._lineLayer>e._lineLayer&&(t._cutDirection===4||t._cutDirection===0||t._cutDirection===5||(e._cutDirection===4||e._cutDirection===0||e._cutDirection===5)&&t._cutDirection===8)||t._lineLayer<e._lineLayer&&(t._cutDirection===6||t._cutDirection===1||t._cutDirection===7||(e._cutDirection===6||e._cutDirection===1||e._cutDirection===7)&&t._cutDirection===8),Lr=(t,e)=>{if(Tr(t,e,8))return t._cutDirection===8?e._cutDirection:t._cutDirection;if(t._cutDirection!==8)return t._cutDirection;if(t._time>e._time){if(t._lineIndex>e._lineIndex&&me(t,e))return 3;if(t._lineIndex<e._lineIndex&&me(t,e))return 2;if(t._lineLayer>e._lineLayer){if(ue(t,e))return 0;if(t._lineIndex>e._lineIndex)return 5;if(t._lineIndex<e._lineIndex)return 4}if(t._lineLayer<e._lineLayer){if(ue(t,e))return 1;if(t._lineIndex>e._lineIndex)return 7;if(t._lineIndex<e._lineIndex)return 6}}return 8},Il=t=>{var e,n,o,i,r,a,l,s,u,d,c,h,m;return Array.isArray((e=t._customData)==null?void 0:e._animation)||typeof((n=t._customData)==null?void 0:n._cutDirection)=="number"||typeof((o=t._customData)==null?void 0:o._disableNoteGravity)=="boolean"||typeof((i=t._customData)==null?void 0:i._disableNoteLook)=="boolean"||typeof((r=t._customData)==null?void 0:r._fake)=="boolean"||Array.isArray((a=t._customData)==null?void 0:a._flip)||typeof((l=t._customData)==null?void 0:l._interactable)=="boolean"||Array.isArray((s=t._customData)==null?void 0:s._localRotation)||typeof((u=t._customData)==null?void 0:u._noteJumpMovementSpeed)=="number"||typeof((d=t._customData)==null?void 0:d._noteJumpStartBeatOffset)=="number"||Array.isArray((c=t._customData)==null?void 0:c._position)||Array.isArray((h=t._customData)==null?void 0:h._rotation)||typeof((m=t._customData)==null?void 0:m._track)=="string"},wr=t=>t._cutDirection>=1e3||t._lineIndex>3||t._lineIndex<0||t._lineLayer>2||t._lineLayer<0,Dl=t=>t._cutDirection>=0&&t._cutDirection<=8,Rl=t=>!wr(t)&&Dl(t),xr=t=>{var n,o,i,r,a,l;const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},bomb:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let s=t.length-1;s>=0;s--)t[s]._type===0?(e.red.total++,(((n=t[s]._customData)==null?void 0:n._color)||((o=t[s]._customData)==null?void 0:o._disableSpawnEffect))&&e.red.chroma++):t[s]._type===1?(e.blue.total++,(((i=t[s]._customData)==null?void 0:i._color)||((r=t[s]._customData)==null?void 0:r._disableSpawnEffect))&&e.blue.chroma++):t[s]._type===3&&(e.bomb.total++,(((a=t[s]._customData)==null?void 0:a._color)||((l=t[s]._customData)==null?void 0:l._disableSpawnEffect))&&e.bomb.chroma++);return e},We=(t,e)=>t.filter(n=>n._lineIndex===e).length,Bl=(t,e)=>t.filter(n=>n._lineLayer===e).length,Pl=(t,e,n)=>t.filter(o=>o._lineIndex===e&&o._lineLayer===n).length,Hl=(t,e)=>t.filter(n=>n._cutDirection===e).length,Cr=(t,e)=>e?t.filter(n=>I(n)).length/e:0,co=(t,e,n)=>{const o=t.filter(a=>a._type===0||a._type===1);let i=0,r=0;for(let a=0;a<o.length;a++){for(;o[a]._time-o[r]._time>e;)r++;i=Math.max(i,(a-r+1)/(e/n*60))}return i},we=(t,e,n,o)=>{let i,r;if(t===null||e===null)return!1;if(typeof t=="number")i=t;else{if(t._cutDirection===8)return!1;i=V(t)}if(typeof e=="number")r=e;else{if(e._cutDirection===8)return!1;r=V(e)}return o?mr(i,r,360)<=n:mr(i,r,360)>=n};var uo;(function(t){t[t["Back Lasers"]=0]="Back Lasers",t[t["Ring Lights"]=1]="Ring Lights",t[t["Left Lasers"]=2]="Left Lasers",t[t["Right Lasers"]=3]="Right Lasers",t[t["Center Lights"]=4]="Center Lights",t[t["Light Boost"]=5]="Light Boost",t[t["Extra Left Lights"]=6]="Extra Left Lights",t[t["Extra Right Lights"]=7]="Extra Right Lights",t[t["Ring Rotation"]=8]="Ring Rotation",t[t["Ring Zoom"]=9]="Ring Zoom",t[t["Extra Left Lasers"]=10]="Extra Left Lasers",t[t["Extra Right Lasers"]=11]="Extra Right Lasers",t[t["Left Laser Rotation"]=12]="Left Laser Rotation",t[t["Right Laser Rotation"]=13]="Right Laser Rotation",t[t["Early Lane Rotation"]=14]="Early Lane Rotation",t[t["Late Lane Rotation"]=15]="Late Lane Rotation",t[t["Lower Hydraulic"]=16]="Lower Hydraulic",t[t["Raise Hydraulic"]=17]="Raise Hydraulic",t[t["BPM Change"]=100]="BPM Change"})(uo||(uo={}));const Nl=t=>t._value===0,jl=t=>t._value===1||t._value===5,Fl=t=>t._value===2||t._value===6,Al=t=>t._value===3||t._value===7,kr=t=>t._type>=0&&t._type<=17||t._type===100,Ze=t=>t._type>=0&&t._type<=11&&!ql(t)&&!Ol(t),Ol=t=>t._type===5,ql=t=>t._type===8||t._type===9,Mr=t=>t._type===12||t._type===13,Jl=t=>{var e,n,o,i,r,a,l,s,u,d,c,h,m,g,p,w,y,L,x,j,ot;return Ze(t)?Array.isArray((e=t._customData)==null?void 0:e._color)||typeof((n=t._customData)==null?void 0:n._lightID)=="number"||Array.isArray((o=t._customData)==null?void 0:o._lightID)||typeof((i=t._customData)==null?void 0:i._propID)=="number"||typeof((r=t._customData)==null?void 0:r._lightGradient)=="object":t._type===8?typeof((a=t._customData)==null?void 0:a._nameFilter)=="string"||typeof((l=t._customData)==null?void 0:l._reset)=="boolean"||typeof((s=t._customData)==null?void 0:s._rotation)=="number"||typeof((u=t._customData)==null?void 0:u._step)=="number"||typeof((d=t._customData)==null?void 0:d._prop)=="number"||typeof((c=t._customData)==null?void 0:c._speed)=="number"||typeof((h=t._customData)==null?void 0:h._direction)=="number"||typeof((m=t._customData)==null?void 0:m._counterSpin)=="boolean"||typeof((g=t._customData)==null?void 0:g._stepMult)=="number"||typeof((p=t._customData)==null?void 0:p._propMult)=="number"||typeof((w=t._customData)==null?void 0:w._speedMult)=="number":t._type===9?typeof((y=t._customData)==null?void 0:y._step)=="number":Mr(t)?typeof((L=t._customData)==null?void 0:L._lockPosition)=="boolean"||typeof((x=t._customData)==null?void 0:x._speed)=="number"||typeof((j=t._customData)==null?void 0:j._preciseSpeed)=="number"||typeof((ot=t._customData)==null?void 0:ot._direction)=="number":!1},Sr=t=>t._value>=2e9,Ul=t=>{var e;return(t._type===14||t._type===15)&&typeof((e=t._customData)==null?void 0:e._rotation)=="number"},Gl=t=>(t._type===14||t._type===15)&&t._value>=1e3&&t._value<=1720,Xl=t=>kr(t)&&t._value>=0&&!(!Mr(t)&&t._value>8&&!Sr(t)),Ir=[0,1,2,3,4,8,9,12,13],Vl=t=>{const e={};for(let n=Ir.length-1;n>=0;n--)e[Ir[n]]={total:0,chroma:0,chromaOld:0,noodleExtensions:0,mappingExtensions:0};for(let n=t.length-1;n>=0;n--)kr(t[n])&&(e[t[n]._type]||(e[t[n]._type]={total:0,chroma:0,chromaOld:0,noodleExtensions:0,mappingExtensions:0}),e[t[n]._type].total++,Jl(t[n])&&e[t[n]._type].chroma++,Sr(t[n])&&e[t[n]._type].chromaOld++,Ul(t[n])&&e[t[n]._type].noodleExtensions++,Gl(t[n])&&e[t[n]._type].mappingExtensions++);return e},zl=115,Yl=t=>{let e=0,n=1;for(let o=0;o<t;o++)n<8&&o===-3+n*4&&(n*=2),e+=zl*n;return e},Dr={info:[2,0,0],difficulty:[2,5,0]},Kl=(t,e)=>{const n=Wl(t);for(const o in n){if(n[o]<Dr[e][o])return"old";if(n[o]>Dr[e][o])return"new"}return"current"},Wl=t=>t.replace("v","").split(".").map(e=>parseInt(e)),Qe=t=>[t.r,t.g,t.b],tn=t=>{let e=t.toString(16);return e.length===1?"0"+e:e},Zl=t=>t>1&&!(t<0)?255:_(t*255),k=t=>{if(!t)return null;let e={r:0,g:0,b:0};for(const n in t){let o=t[n];o!==void 0&&(e[n]=Zl(o))}return`#${tn(e.r)}${tn(e.g)}${tn(e.b)}${e.a?tn(e.a):""}`},Rr=t=>{let e=t[0],n=t[1],o=t[2],i,r,a;return e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,i=(e*.4124+n*.3576+o*.1805)/.95047,r=(e*.2126+n*.7152+o*.0722)/1,a=(e*.0193+n*.1192+o*.9505)/1.08883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,[116*r-16,500*(i-r),200*(r-a)]},Br=(t,e)=>{let n=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(n=0),t<0&&(n=180),t>0&&e<0&&(n=360),On(Math.atan(e/t))+n)},mo=(t,e)=>{const[n,o,i]=Rr(t),[r,a,l]=Rr(e),s=1,u=1,d=1;let c,h,m,g,p,w,y,L,x,j,ot,nr,or,ir,rr,ar,lr,Ee,le,X;return c=Math.sqrt(o*o+i*i),h=Math.sqrt(a*a+l*l),m=(c+h)/2,p=.5*(1-Math.sqrt((m^7)/((m^7)+(25^7)))),x=(1+p)*o,c=Math.sqrt(x*x+i*i),w=Br(x,i),x=(1+p)*a,h=Math.sqrt(x*x+l*l),y=Br(x,l),Ee=r-n,le=h-c,c*h==0?X=0:(x=_(y-w,12),Math.abs(x)<=180?X=y-w:x>180?X=y-w-360:X=y-w+360),X=2*Math.sqrt(c*h)*Math.sin(se(X/2)),j=(n+r)/2,g=(c+h)/2,c*h==0?L=w+y:(x=Math.abs(_(w-y,12)),x>180?y+w<360?L=w+y+360:L=w+y-360:L=w+y,L/=2),ot=1-.17*Math.cos(se(L-30))+.24*Math.cos(se(2*L))+.32*Math.cos(se(3*L+6))-.2*Math.cos(se(4*L-63)),rr=30*Math.exp(-((L-275)/25)*((L-275)/25)),ar=2*Math.sqrt((g^7)/((g^7)+(25^7))),nr=1+.015*((j-50)*(j-50))/Math.sqrt(20+(j-50)*(j-50)),or=1+.045*g,ir=1+.015*g*ot,lr=-Math.sin(se(2*rr))*ar,Ee=Ee/(s*nr),le=le/(u*or),X=X/(d*ir),Math.sqrt(Ee*Ee+le*le+X*X+lr*le*X)};var po;(function(t){t.tiny="panel--tiny",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t.max="panel--max"})(po||(po={}));var ho;(function(t){t.none="",t.normal="panel--offset",t.half="panel--offset-half"})(ho||(ho={}));const en=(t,e,n,o)=>{const i=document.createElement("div");return i.className=`panel ${po[t]}`,e&&e!=="none"&&i.classList.add(ho[e]),n&&i.classList.add("panel--flex"+o?"-column":""),i},b={},Pr=()=>{for(const t in b)delete b[t]},C="UI Info: ",nn=document.querySelector(".info__level-author"),on=document.querySelector(".info__environment"),xe=document.querySelector(".info__editors"),Ce=document.querySelector(".info__contributors"),ke=document.querySelector(".info__contributors-select"),Hr=document.querySelector(".info__contributors-image"),_o=document.querySelector(".info__contributors-name"),fo=document.querySelector(".info__contributors-role"),rn=document.querySelector(".info__version"),an=document.querySelector(".info__time-spend"),ln=document.querySelector(".info__custom-color"),sn=document.querySelector(".info__requirements"),cn=document.querySelector(".info__suggestions"),un=document.querySelector(".info__information"),mn=document.querySelector(".info__warnings"),dn=document.querySelector(".info__bookmarks"),pn=document.querySelector(".info__bpm-changes"),hn=document.querySelector(".info__environment-enhancement"),_n=document.querySelector(".info__point-definitions"),fn=document.querySelector(".info__custom-events");(!nn||!on||!xe)&&console.error(C+"info component is missing part");(!Ce||!_o||!fo)&&console.error(C+"contributors component is missing part");ke?ke.addEventListener("change",os):console.error(C+"contributors select is missing");(!rn||!an||!ln||!sn||!cn||!un||!mn||!dn||!pn||!hn||!_n||!fn)&&console.error(C+"table info component is missing part");const Nr=t=>{if(!nn){console.error(C+"missing HTML element for level author");return}if(!t){nn.textContent="";return}nn.textContent="Mapped by "+t},jr=t=>{if(!on){console.error(C+"missing HTML element for environment");return}if(!t){on.textContent="";return}on.textContent=(Qn[t]||"Unknown")+" Environment"},Fr=t=>{if(!xe){console.error(C+"missing HTML element for editor");return}if(!t||!t._lastEditedBy){xe.classList.add("hidden");return}xe.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let n="Last edited on "+e;if(t[e]){const o=t[e];n+=" v"+o.version}xe.textContent=n},Ql=t=>{if(!Hr){console.error(C+"missing HTML element for contributor image");return}Hr.src=t||"./img/unknown.jpg"},ts=t=>{if(!_o){console.error(C+"missing HTML element for contributor name");return}_o.textContent=t},es=t=>{if(!fo){console.error(C+"missing HTML element for contributor role");return}fo.textContent=t},Ar=t=>{Ql(t._base64?"data:image;base64,"+t._base64:null),ts(t._name),es(t._role)},Or=t=>{if(!Ce||!ke){console.error(C+"missing HTML element for contributor");return}if(Ce&&(!t||!t.length)){Ce.classList.add("hidden"),Jn(ke);return}if(t){Ce.classList.remove("hidden");let e=!0;t.forEach((n,o)=>{e&&(e=!1,Ar(n));const i=document.createElement("option");i.value=o.toString(),i.text=n._name+" -- "+n._role,ke.add(i)})}},O=t=>{const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")},q=(t,e)=>{const n=t.querySelector(".info__table-element");if(n){for(;n.firstChild;)n.removeChild(n.firstChild);typeof e=="string"?n.textContent=e:(e.forEach(o=>{if(typeof o=="string"){let i=document.createElement("span");i.textContent=o,n.appendChild(i),n.appendChild(document.createElement("br"))}else n.appendChild(o),n.appendChild(document.createElement("br"))}),n.lastChild&&n.removeChild(n.lastChild))}t.classList.remove("hidden")},qr=t=>{if(!rn){console.error(C+"missing table row for time spend");return}if(t==null){O(rn);return}q(rn,t)},Jr=t=>{if(!an){console.error(C+"missing table row for time spend");return}if(t==null){O(an);return}q(an,F(t))},Ur=(t,e)=>{var s,u,d,c,h,m,g,p,w;if(!ln){console.error(C+"missing table row for custom colors");return}if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._obstacleColor){O(ln);return}e||(e="DefaultEnvironment");let n={_colorLeft:k((s=B[S[e]])==null?void 0:s._colorLeft)||null,_colorRight:k((u=B[S[e]])==null?void 0:u._colorRight)||null,_envColorLeft:k((d=B[S[e]])==null?void 0:d._envColorLeft)||null,_envColorRight:k((c=B[S[e]])==null?void 0:c._envColorRight)||null,_envColorLeftBoost:k((h=B[S[e]])==null?void 0:h._envColorLeftBoost)||null,_envColorRightBoost:k((m=B[S[e]])==null?void 0:m._envColorRightBoost)||null,_obstacleColor:k((g=B[S[e]])==null?void 0:g._obstacleColor)||null};t._colorLeft&&(n._colorLeft=k(t._colorLeft)),t._colorRight&&(n._colorRight=k(t._colorRight)),t._envColorLeft?n._envColorLeft=k(t._envColorLeft):t._colorLeft&&(n._envColorLeft=k(t._colorLeft)),t._envColorRight?n._envColorRight=k(t._envColorRight):t._colorRight&&(n._envColorRight=k(t._colorRight));let o,i,r=!1;t._envColorLeftBoost?(o=k(t._envColorLeftBoost),r=!0):o=k((p=B[S[e]])==null?void 0:p._envColorLeftBoost)||n._envColorLeft,t._envColorRightBoost?(i=k(t._envColorRightBoost),r=!0):i=k((w=B[S[e]])==null?void 0:w._envColorRightBoost)||n._envColorRight,r&&(n._envColorLeftBoost=o,n._envColorRightBoost=i),t._obstacleColor&&(n._obstacleColor=k(t._obstacleColor));const a=en("max","none",!0);for(const y in n){if(!n[y])continue;const L=document.createElement("div"),x=document.createElement("div"),j=document.createElement("div"),ot=document.createElement("div");x.className="info__color-dot",x.style.backgroundColor=n[y]||"#000000",j.className="info__color-text info__color-text--monospace",j.textContent=`${n[y]}`,ot.className="info__color-text",ot.textContent=` -- ${Zn[y]}`,L.appendChild(x),L.appendChild(j),L.appendChild(ot),a.appendChild(L)}q(ln,[a])},Gr=t=>{if(!sn){console.error(C+"missing table row for requirements");return}if(t==null||!t.length){O(sn);return}q(sn,t.join(", "))},Xr=t=>{if(!cn){console.error(C+"missing table row for suggestions");return}if(t==null||!t.length){O(cn);return}q(cn,t.join(", "))},Vr=t=>{if(!un){console.error(C+"missing table row for information");return}if(t==null||!t.length){O(un);return}q(un,t)},zr=t=>{if(!mn){console.error(C+"missing table row for warnings");return}if(t==null||!t.length){O(mn);return}q(mn,t)},Yr=(t,e)=>{if(!dn){console.error(C+"missing table row for bookmarks");return}if(t==null||!t.length){O(dn);return}const n=t.map(o=>{let i=o._time,r;return e&&(i=e.adjustTime(i),r=e.toRealTime(i)),`${_(o._time,3)}${r?" | "+F(r):""} -- ${o._name!==""?o._name:"**EMPTY NAME**"}`});q(dn,n)},Kr=t=>{if(!pn){console.error(C+"missing table row for bookmarks");return}if(!t||!t.change.length){O(pn);return}const e=t.change.map(n=>{let o=_(n._newTime,3),i=t.toRealTime(n._time);return`${o} | ${F(i)} -- ${n._BPM}`});q(pn,e)},Wr=t=>{if(!hn){console.error(C+"missing table row for environment enhancement");return}if(t==null||!t.length){O(hn);return}const e=t.map(n=>{let o=[];for(const i in n){if(i=="_lookupMethod"||i=="_id")continue;let r=Kn[i];n[i]!=null&&o.push(r)}return`${n._lookupMethod} [${o.join("")}]${n._track?`(${n._track})`:""} -> ${n._id}`});q(hn,e)},Zr=t=>{if(!_n){console.error(C+"missing table row for point definitions");return}if(t==null||!t.length){O(_n);return}const e=t.map(n=>`${n._name} -- ${n._points.length} point${n._points.length>1?"s":""}`);q(_n,e)},Qr=(t,e)=>{if(!fn){console.error(C+"missing table row for custom events");return}if(t==null||!t.length){O(fn);return}const n=t.map(o=>{let i=o._time,r;e&&(i=e.adjustTime(i),r=e.toRealTime(i));let a=[];for(const l in o._data){if(l=="_duration"||l=="_easing"||l=="_track")continue;let s=ro[l];o._data[l]!=null&&a.push(s)}return`${_(o._time,3)}${r?" | "+F(r):""} -- ${o._type} -> [${a.join("")}]${o._data._track?`(${o._data._track})`:""}`});q(fn,n)},ns=t=>{var e;ml(t._songName),dl(t._songSubName),pl(t._songAuthorName),hl(t._beatsPerMinute),Nr(t._levelAuthorName),jr(t._environmentName),Fr((e=t._customData)==null?void 0:e._editors)},ta=t=>{var e,n,o;if(qr(t._data._version),((e=t._info)==null?void 0:e._customData)&&(Ur(t._info._customData),Gr(t._info._customData._requirements),Xr(t._info._customData._suggestions),Vr(t._info._customData._information),zr(t._info._customData._warnings)),(n=t._data)==null?void 0:n._customData){const i=((o=b._mapInfo)==null?void 0:o._beatsPerMinute)?it(b._mapInfo._beatsPerMinute,t._data._customData._bpmChanges||t._data._customData._BPMChanges):null;Jr(t._data._customData._time),Yr(t._data._customData._bookmarks,i),Kr(i),Wr(t._data._customData._environment),Zr(t._data._customData._pointDefinitions),Qr(t._data._customData._customEvents,i)}};function os(t){if(!b._contributors){console.error(C+"no saved data for contributors");return}const e=t.target;Ar(b._contributors[parseInt(e.value)])}const is=()=>{Nr(),jr(),Fr(),Or(),qr(),Jr(),Ur(),Gr(),Xr(),Vr(),zr(),Yr(),Kr(),Wr(),Zr(),Qr()},rs="UI Input: ",at=t=>{const e=document.querySelectorAll(".input-toggle");if(!e.length){console.error(rs+"empty list, intentional or typo error?");return}e.forEach(n=>{n.disabled=t})},ea="UI Loading: ",It=document.querySelector(".loading__bar"),na="loading__bar--error",oa="loading__bar--download",go=document.querySelector(".loading__text");(!It||!go)&&console.error(ea+"loading component is missing part");const $=(t,e,n=100)=>{if(!It||!go){console.error(ea+"could not process, missing HTML element");return}go.textContent=e,It.style.width=`${n}%`,t==="error"?It.classList.add(na):It.classList.remove(na),t==="download"?It.classList.add(oa):It.classList.remove(oa)},as=()=>{$("info","No map loaded",0)};var gn={loading:!1,map:{load:{image:!1,audio:!1}}};const bo={name:"Cover Image",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:ls};function ls(){const t=new Image,e=ul(),n=[];if(gn.map.load.image&&e!==null?(t.src=e,t.width!==t.height&&n.push("<b>Cover image is not square:</b> resize to fit square"),(t.width<256||t.height<256)&&n.push("<b>Cover image is too small:</b> require at least 256x256")):n.push("<b>No cover image:</b> "+(E.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),n.length){const o=document.createElement("div");o.innerHTML=n.join("<br>"),bo.output.html=o}else bo.output.html=null}const bn={name:"Preview Time",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:ss};function ss(t){const{_audioDuration:e}=t,n=document.createElement("div");e&&e<20?(n.innerHTML=`<b>Unrankable audio length:</b> too short (${F(e)}s)`,bn.output.html=n):gn.map.load.audio?bn.output.html=null:(n.innerHTML=`<b>No audio:</b> ${E.load.audio?"could not be loaded or not found":"no audio mode is enabled"}`,bn.output.html=n)}const yo={name:"Preview Time",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:cs};function cs(t,e,n){if(!n)throw new Error("something went wrong!");const{_previewStartTime:o,_previewDuration:i}=n;if(o===12&&i===10){const r=document.createElement("div");r.innerHTML="<b>Default preview time:</b> strongly recommended to set for audience's 1st impression",yo.output.html=r}else yo.output.html=null}const R=(t,e,n,o)=>{if(o&&o.length>0&&n.toRealTime(e._time)+.005<n.toRealTime(t._time)&&t._cutDirection!==8){for(const i of o)if(i._cutDirection!==8&&we(t,i,90,!1))return!0}if(o&&o.length>0){for(const i of o)if(Math.max(Math.abs(i._lineIndex-t._lineIndex),Math.abs(i._lineLayer-t._lineLayer))<1)return!0}return $r(t,e)&&n.toRealTime(t._time-e._time)>.08||n.toRealTime(t._time-e._time)>.07},ia=(t,e,n)=>n/((t._time-e._time)*2),ra=(t,e)=>{let n=[];const o={},i={0:[],1:[]};for(let r=0,a=t.length;r<a;r++){if(!I(t[r]))continue;const l=JSON.parse(JSON.stringify(t[r]));o[l._type]&&R(l,o[l._type],e,i[l._type])&&(l._ebpm=ia(l,o[l._type],e.value),n.push(l),i[l._type]=[]),o[l._type]=l,i[l._type].push(l)}return n},vo=(t,e)=>{let n=[];const o={},i={0:[],1:[]};for(let r=0,a=t.length;r<a;r++){if(!I(t[r]))continue;const l=JSON.parse(JSON.stringify(t[r]));o[l._type]?R(l,o[l._type],e,i[l._type])&&(l._ebpm=ia(l,o[l._type],e.value),n.push(l),o[l._type]=l,i[l._type]=[]):o[l._type]=l,i[l._type].push(l)}return n},us=(t,e)=>Math.max(...ra(t,e).map(n=>n._ebpm),0),ms=(t,e)=>Math.max(...vo(t,e).map(n=>n._ebpm),0),aa=(t,e)=>{let n=!1,o=!1,i=0,r=e.toRealTime(Math.max(...t.map((a,l)=>l===0?0:((me(t[l],t[l-1])||ue(t[l],t[l-1]))&&!n&&(n=!0,i=(t[l]._time-t[l-1]._time)/(St(t[l],t[l-1])||1)),o=Ke(t[l],t[l-1])||so(t[l],t[l-1])||o,(t[l]._time-t[l-1]._time)/(St(t[l],t[l-1])||1)))));return n&&o?e.toRealTime(i):r},la=(t,e)=>{let n=!1,o=!1,i=Number.MAX_SAFE_INTEGER,r=e.toRealTime(Math.min(...t.map((a,l)=>l===0?Number.MAX_SAFE_INTEGER:((me(t[l],t[l-1])||ue(t[l],t[l-1]))&&!n&&(n=!0,i=(t[l]._time-t[l-1]._time)/(St(t[l],t[l-1])||1)),o=Ke(t[l],t[l-1])||so(t[l],t[l-1])||o,(t[l]._time-t[l-1]._time)/(St(t[l],t[l-1])||1)))));return n&&o?e.toRealTime(i):r},yn=(t,e)=>{let n=[];const o={},i={0:[],1:[]};for(let r=0,a=t.length;r<a;r++){if(!I(t[r]))continue;const l=JSON.parse(JSON.stringify(t[r]));if(l._minSpeed=0,l._maxSpeed=Number.MAX_SAFE_INTEGER,o[l._type]){if(R(l,o[l._type],e,i[l._type])){let s=aa(i[l._type],e),u=la(i[l._type],e);s>0&&u!==1/0&&(o[l._type]._minSpeed=s,o[l._type]._maxSpeed=u,n.push(o[l._type])),o[l._type]=l,i[l._type]=[]}}else o[l._type]=l;i[l._type].push(l)}for(let r=0;r<2;r++)if(o[r]){let a=aa(i[r],e),l=la(i[r],e);a>0&&l!==1/0&&(o[r]._minSpeed=a,o[r]._maxSpeed=l,n.push(o[r]))}return n},ds=(t,e)=>Math.max(...yn(t,e).map(n=>n._minSpeed),0),ps=(t,e)=>{const n=yn(t,e).map(o=>o._maxSpeed);return n.length?Math.min(...n):0},hs=(t,e,n)=>{const o={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let i,r;for(let a=0,l=t.length;a<l;a++){const s=t[a],u=n.toRealTime(s._time);s._type===0&&(i?R(s,i,n)&&o.left[Math.floor(u)]++:o.left[Math.floor(u)]++,i=s),s._type===1&&(r?R(s,r,n)&&o.right[Math.floor(u)]++:o.right[Math.floor(u)]++,r=s)}return o},$o=(t,e)=>{if(!t.length)return 0;if(t.length<e)return t.reduce((i,r)=>i+r)/t.length;let n=t.slice(0,e).reduce((i,r)=>i+r),o=n;for(let i=0;i<t.length-e;i++)n=n-t[i]+t[i+e],o=Math.max(o,n);return o/e},sa=(t,e)=>{const n=10,o={red:{overall:0,peak:0,median:0,total:0},blue:{overall:0,peak:0,median:0,total:0},total:{overall:0,peak:0,median:0,total:0}},i=Math.max(e.toRealTime(Ye(t._data)-gr(t._data)),0),r=Math.max(e.toRealTime(Ye(t._data)),0),a=hs(t._data._notes,r,e),l=a.left.map((c,h)=>c+a.right[h]);if(l.reduce((c,h)=>c+h)===0)return o;const s=[],u=[],d=[];for(let c=0,h=Math.ceil(l.length/n);c<h;c++){const m=c*n;let g=n;g+m>l.length&&(g=l.length-m);const p=a.left.slice(m,m+g),w=a.right.slice(m,m+g),y=l.slice(m,m+g);s.push(p.reduce((L,x)=>L+x)/g),u.push(w.reduce((L,x)=>L+x)/g),d.push(y.reduce((L,x)=>L+x)/g)}return o.red.total=a.left.reduce((c,h)=>c+h),o.red.overall=a.left.reduce((c,h)=>c+h)/i,o.red.peak=$o(a.left,n),o.red.median=qn(s),o.blue.total=a.right.reduce((c,h)=>c+h),o.blue.overall=a.right.reduce((c,h)=>c+h)/i,o.blue.peak=$o(a.right,n),o.blue.median=qn(u),o.total.total=o.red.total+o.blue.total,o.total.overall=l.reduce((c,h)=>c+h)/i,o.total.peak=$o(l,n),o.total.median=qn(d),o},_s=(t,e)=>{let n=0,o=0;for(const i of t){const r=i.sps.total.overall;if(o>0&&r>0&&(n=(1-o/r)*100),o=r>0?r:o,o>e&&n>40)return i}return null},fs=(t,e)=>{let n=Number.MAX_SAFE_INTEGER,o=0;for(const i of t){const r=i.sps.total.overall;if(o>0&&r>0&&(n=(1-o/r)*100),o=r>0?r:o,o>e&&n<10)return i}return null},gs=t=>{let e=0,n=Number.MAX_SAFE_INTEGER;return t.forEach(o=>{const i=o.sps.total.overall;i>0&&(e=Math.max(e,i),n=Math.min(n,i))}),e||e&&n?(1-n/e)*100:0},ca=t=>{let e=Number.MAX_SAFE_INTEGER;return t.forEach(n=>{const o=n.sps.total.overall;o>0&&(e=Math.min(e,o))}),e},Me={name:"Progression",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:bs};function bs(t,e,n,o){const{_audioDuration:i}=t;if(!i){Me.output.html=null;return}if(!o)throw new Error("no sps");const r=o.filter(d=>d.mode==="Standard").sort((d,c)=>d.sps.total.overall-c.sps.total.overall);if(!r.length){Me.output.html=null;return}const a=i<120?3.2:i<240?4.2:5.2,l=[];i<240&&ca(r)>a&&gs(r)<60&&l.push(`<b>Minimum SPS not met (<${a}):</b> lowest is ${_(ca(r),2)}`);const s=_s(r,a),u=fs(r,a);if(s&&i<360&&l.push(`<b>Violates progression:</b> ${s.difficulty} exceeded 40% SPS drop`),u&&i<360&&l.push(`<b>Violates progression:</b> ${u.difficulty} has less than 10% SPS drop`),l.length){const d=document.createElement("div");d.innerHTML=l.join("<br>"),Me.output.html=d}else Me.output.html=null}var ua=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",coverImage:bo,audio:bn,previewTime:yo,progression:Me});const Eo=450,To=350,Se=document.createElement("div"),dt=document.createElement("input"),Lo=document.createElement("label"),pt=document.createElement("input"),wo=document.createElement("label");Lo.textContent="Effective BPM threshold: ";Lo.htmlFor="input__tools-ebpm";dt.id="input__tools-ebpm";dt.className="input-toggle input--small";dt.type="number";dt.min="0";dt.value=Eo.toString();dt.addEventListener("change",vs);wo.textContent=" (swing): ";wo.htmlFor="input__tools-ebpms";pt.id="input__tools-ebpms";pt.className="input-toggle input--small";pt.type="number";pt.min="0";pt.value=To.toString();pt.addEventListener("change",$s);Se.appendChild(Lo);Se.appendChild(dt);Se.appendChild(wo);Se.appendChild(pt);const P={name:"Effective BPM",description:"Placeholder",type:"note",order:{input:0,output:100},input:{enabled:!0,params:{ebpmThres:Eo,ebpmsThres:To},html:Se,adjustTime:ys},output:{html:null},run:Ts};function ys(t){P.input.params.ebpmThres=_(Math.min(Eo,t.value*2*1.285714),1),P.input.params.ebpmsThres=_(Math.min(To,t.value*2),1),dt.value=P.input.params.ebpmThres.toString(),pt.value=P.input.params.ebpmsThres.toString()}function vs(){P.input.params.ebpmThres=_(Math.abs(parseFloat(this.value)),1),this.value=P.input.params.ebpmThres.toString()}function $s(){P.input.params.ebpmsThres=_(Math.abs(parseFloat(this.value)),1),this.value=P.input.params.ebpmsThres.toString()}function Es(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{ebpmThres:i,ebpmsThres:r}=P.input.params,a=ra(o,n).filter(s=>s._ebpm>i).map(s=>s._time),l=vo(o,n).filter(s=>s._ebpm>r).map(s=>s._time);return{base:a,swing:l}}function Ts(t,e){if(!e)throw new Error("something went wrong!");const n=Es(t,e),{ebpmThres:o,ebpmsThres:i}=P.input.params,r=[];if(n.base.length&&r.push(`<b>>${o}EBPM warning [${n.base.length}]:</b> ${n.base.map(a=>_(t._bpm.adjustTime(a),3)).join(", ")}`),n.swing.length&&r.push(`<b>>${i}EBPM (swing) warning [${n.swing.length}]:</b> ${n.swing.map(a=>_(t._bpm.adjustTime(a),3)).join(", ")}`),r.length){const a=document.createElement("div");a.innerHTML=r.join("<br>"),P.output.html=a}else P.output.html=null}const ma=[4,3],xo=document.createElement("div"),de=document.createElement("input"),Co=document.createElement("label");Co.textContent="Acceptable beat precision: ";Co.htmlFor="input__tools-prec";de.id="input__tools-prec";de.className="input-toggle input--small";de.type="text";de.value=ma.join(" ");de.addEventListener("change",Ls);xo.appendChild(Co);xo.appendChild(de);const pe={name:"Acceptable Beat Precision",description:"Placeholder",type:"note",order:{input:10,output:110},input:{enabled:!0,params:{prec:[...ma]},html:xo},output:{html:null},run:xs};function Ls(){pe.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=pe.input.params.prec.join(" ")}function ws(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{prec:i}=pe.input.params;return vo(o,n).map(r=>r._time).filter((r,a,l)=>!a||r!==l[a-1]).filter(r=>{if(!i.length)return!1;for(let a=0;a<i.length;a++)if((n.adjustTime(r)+.001)%(1/i[a])<.01)return!1;return!0})}function xs(t,e){if(!e)throw new Error("something went wrong!");const n=ws(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Off-beat precision [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,pe.output.html=o}else pe.output.html=null}const ko=document.createElement("div"),Dt=document.createElement("input"),Mo=document.createElement("label");Mo.textContent=" Varying swing speed";Mo.htmlFor="input__tools-vary-swing-check";Dt.id="input__tools-vary-swing-check";Dt.className="input-toggle";Dt.type="checkbox";Dt.checked=!0;Dt.addEventListener("change",Cs);ko.appendChild(Dt);ko.appendChild(Mo);const vn={name:"Varying Swing Speed",description:"Placeholder",type:"note",order:{input:20,output:130},input:{enabled:Dt.checked,params:{},html:ko},output:{html:null},run:Ms};function Cs(){vn.input.enabled=this.checked}function ks(t,e){const{_bpm:n}=t,{_notes:o}=e._data;return yn(o,n).filter(i=>Math.abs(i._minSpeed-i._maxSpeed)>.002).map(i=>i._time).filter((i,r,a)=>!r||i!==a[r-1])}function Ms(t,e){if(!e)throw new Error("something went wrong!");const n=ks(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Varying swing speed [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,vn.output.html=o}else vn.output.html=null}const da=.025,ht=document.createElement("div"),Rt=document.createElement("input"),So=document.createElement("label"),_t=document.createElement("input"),Io=document.createElement("label"),ft=document.createElement("input"),Do=document.createElement("label");let he;So.textContent=" Slow slider";So.htmlFor="input__tools-slow-slider-check";Rt.id="input__tools-slow-slider-check";Rt.className="input-toggle";Rt.type="checkbox";Rt.checked=!0;Rt.addEventListener("change",Is);Io.textContent="min speed (ms): ";Io.htmlFor="input__tools-slow-slider-time";_t.id="input__tools-slow-slider-time";_t.className="input-toggle input--small";_t.type="number";_t.min="0";_t.value=_(da*1e3,1).toString();_t.addEventListener("change",Ds);Do.textContent=" (prec): ";Do.htmlFor="input__tools-slow-slider-prec";ft.id="input__tools-slow-slider-prec";ft.className="input-toggle input--small";ft.type="number";ft.min="0";ft.addEventListener("change",Rs);ht.appendChild(Rt);ht.appendChild(So);ht.appendChild(document.createElement("br"));ht.appendChild(Io);ht.appendChild(_t);ht.appendChild(Do);ht.appendChild(ft);const J={name:"Slow Slider",description:"Placeholder",type:"note",order:{input:21,output:120},input:{enabled:Rt.checked,params:{minSpeed:da},html:ht,adjustTime:Ss},output:{html:null},run:Ps};function Ss(t){he=t,ft.value=_(1/he.toBeatTime(J.input.params.minSpeed),2).toString()}function Is(){J.input.enabled=this.checked}function Ds(){J.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=_(J.input.params.minSpeed*1e3,1).toString(),he&&(ft.value=_(1/he.toBeatTime(J.input.params.minSpeed),2).toString())}function Rs(){if(!he){this.value="0";return}let t=_(Math.abs(parseFloat(this.value)),2)||1;J.input.params.minSpeed=he.toRealTime(1/t),_t.value=_(J.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}function Bs(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{minSpeed:i}=J.input.params;return yn(o,n).filter(r=>r._maxSpeed>i||r._minSpeed>i).map(r=>r._time).filter((r,a,l)=>!a||r!==l[a-1])}function Ps(t,e){if(!e)throw new Error("something went wrong!");const{minSpeed:n}=J.input.params,o=Bs(t,e);if(o.length){const i=document.createElement("div");i.innerHTML=`<b>Slow slider (>${_(n*1e3,1)}ms) [${o.length}]:</b> ${o.map(r=>_(t._bpm.adjustTime(r),3)).join(", ")}`,J.output.html=i}else J.output.html=null}const pa=.15;let _e;const gt=document.createElement("div"),Bt=document.createElement("input"),Ro=document.createElement("label"),bt=document.createElement("input"),Bo=document.createElement("label"),lt=document.createElement("input"),Po=document.createElement("label");Ro.textContent=" Inline sharp angle";Ro.htmlFor="input__tools-inline-angle-check";Bt.id="input__tools-inline-angle-check";Bt.className="input-toggle";Bt.type="checkbox";Bt.checked=!0;Bt.addEventListener("change",Ns);Bo.textContent="max time (ms): ";Bo.htmlFor="input__tools-inline-angle-time";bt.id="input__tools-inline-angle-time";bt.className="input-toggle input--small";bt.type="number";bt.min="0";bt.value=_(pa*1e3,1).toString();bt.addEventListener("change",js);Po.textContent=" (beat): ";Po.htmlFor="input__tools-inline-angle-beat";lt.id="input__tools-inline-angle-beat";lt.className="input-toggle input--small";lt.type="number";lt.min="0";lt.step="0.1";lt.addEventListener("change",Fs);gt.appendChild(Bt);gt.appendChild(Ro);gt.appendChild(document.createElement("br"));gt.appendChild(Bo);gt.appendChild(bt);gt.appendChild(Po);gt.appendChild(lt);const z={name:"Inline Sharp Angle",description:"Placeholder",type:"note",order:{input:30,output:160},input:{enabled:Bt.checked,params:{maxTime:pa},html:gt,adjustTime:Hs},output:{html:null},run:Os};function Hs(t){_e=t,lt.value=_(_e.toBeatTime(z.input.params.maxTime),2).toString()}function Ns(){z.input.enabled=this.checked}function js(){z.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=_(z.input.params.maxTime*1e3,1).toString(),_e&&(lt.value=_(_e.toBeatTime(z.input.params.maxTime),2).toString())}function Fs(){if(!_e){this.value="0";return}let t=_(Math.abs(parseFloat(this.value)),2)||1;z.input.params.maxTime=_e.toRealTime(t),bt.value=_(z.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function As(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:i}=z.input.params,r=n.toBeatTime(i)+.001,a={},l={},s={},u={0:[],1:[],3:[]},d=[];let c=0,h=0;for(let m=0,g=o.length;m<g;m++){const p=o[m];I(p)&&a[p._type]?R(p,a[p._type],n,u[p._type])?(s[p._type]&&(s[p._type]=null,l[p._type]=(l[p._type]+180)%360),ha(p,o,h,r)&&we(p,l[p._type],90,!0)&&d.push(p),p._cutDirection===8?s[p._type]=p:l[p._type]=V(p),u[p._type]=[]):(s[p._type]&&ha(p,o,h,r)&&we(p,l[p._type],90,!0)&&(d.push(s[p._type]),s[p._type]=null),p._cutDirection!==8&&(l[p._type]=V(p))):l[p._type]=V(p),c<p._time-r&&(c=p._time-r,h=m),a[p._type]=p,u[p._type].push(p),p._type===3&&(p._lineLayer===0&&(p._lineIndex===1&&(l[0]=rt[0],s[0]=null),p._lineIndex===2&&(l[1]=rt[0],s[1]=null)),p._lineLayer===2&&(p._lineIndex===1&&(l[0]=rt[1],s[0]=null),p._lineIndex===2&&(l[1]=rt[1],s[1]=null)))}return d.map(m=>m._time).filter(function(m,g,p){return!g||m!==p[g-1]})}function ha(t,e,n,o){for(let i=n;e[i]._time<t._time;i++)if(lo(t,e[i])&&t._time-e[i]._time<=o)return!0;return!1}function Os(t,e){if(!e)throw new Error("something went wrong!");const n=As(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Inline sharp angle [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,z.output.html=o}else z.output.html=null}const _a=.15,fa=1;let fe;const Y=document.createElement("div"),Pt=document.createElement("input"),Ho=document.createElement("label"),Ht=document.createElement("input"),No=document.createElement("label"),yt=document.createElement("input"),jo=document.createElement("label"),st=document.createElement("input"),Fo=document.createElement("label");Ho.textContent=" shrado angle";Ho.htmlFor="input__tools-shrado-angle-check";Pt.id="input__tools-shrado-angle-check";Pt.className="input-toggle";Pt.type="checkbox";Pt.checked=!1;Pt.addEventListener("change",Js);No.textContent="min distance: ";No.htmlFor="input__tools-shrado-angle-distance";Ht.id="input__tools-shrado-angle-distance";Ht.className="input-toggle input--small";Ht.type="number";Ht.min="0";Ht.value=fa.toString();Ht.addEventListener("change",Us);jo.textContent="max time (ms): ";jo.htmlFor="input__tools-shrado-angle-time";yt.id="input__tools-shrado-angle-time";yt.className="input-toggle input--small";yt.type="number";yt.min="0";yt.value=_(_a*1e3,1).toString();yt.addEventListener("change",Gs);Fo.textContent=" (beat): ";Fo.htmlFor="input__tools-shrado-angle-beat";st.id="input__tools-shrado-angle-beat";st.className="input-toggle input--small";st.type="number";st.min="0";st.step="0.1";st.addEventListener("change",Xs);Y.appendChild(Pt);Y.appendChild(Ho);Y.appendChild(document.createElement("br"));Y.appendChild(No);Y.appendChild(Ht);Y.appendChild(document.createElement("br"));Y.appendChild(jo);Y.appendChild(yt);Y.appendChild(Fo);Y.appendChild(st);const H={name:"shrado Angle",description:"Placeholder",type:"note",order:{input:40,output:170},input:{enabled:Pt.checked,params:{distance:fa,maxTime:_a},html:Y,adjustTime:qs},output:{html:null},run:zs};function qs(t){fe=t,st.value=_(fe.toBeatTime(H.input.params.maxTime),2).toString()}function Js(){H.input.enabled=this.checked}function Us(){H.input.params.distance=Math.max(parseInt(this.value),0),this.value=H.input.params.distance.toString()}function Gs(){H.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=_(H.input.params.maxTime*1e3,1).toString(),fe&&(st.value=_(fe.toBeatTime(H.input.params.maxTime),2).toString())}function Xs(){if(!fe){this.value="0";return}let t=_(Math.abs(parseFloat(this.value)),2)||1;H.input.params.maxTime=fe.toRealTime(t),yt.value=_(H.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Vs(t,e){var h;const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:i,distance:r}=H.input.params,a=n.toBeatTime(i)+.001,l={},s={},u={},d={0:[],1:[],3:[]},c=[];for(let m=0,g=o.length;m<g;m++){const p=o[m];I(p)&&l[p._type]?R(p,l[p._type],n,d[p._type])?(u[p._type]&&(u[p._type]=null,s[p._type]=(h=ao[s[p._type]])!=null?h:8),St(p,l[p._type])>=r&&ga(p._cutDirection,s[p._type],p._type)&&p._time-l[p._type]._time<=a&&c.push(p),p._cutDirection===8?u[p._type]=p:s[p._type]=p._cutDirection,d[p._type]=[]):(u[p._type]&&St(p,l[p._type])>=r&&ga(p._cutDirection,s[p._type],p._type)&&p._time-l[p._type]._time<=a&&(c.push(u[p._type]),u[p._type]=null),p._cutDirection!==8&&(s[p._type]=p._cutDirection)):s[p._type]=p._cutDirection,l[p._type]=p,d[p._type].push(p)}return c.map(m=>m._time).filter(function(m,g,p){return!g||m!==p[g-1]})}function ga(t,e,n){return t===8||e===8?!1:(n===0?e===7:e===6)&&t===0}function zs(t,e){if(!e)throw new Error("something went wrong!");const n=Vs(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>shrado angle [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,H.output.html=o}else H.output.html=null}const ba=.075,vt=document.createElement("div"),Nt=document.createElement("input"),Ao=document.createElement("label"),$t=document.createElement("input"),Oo=document.createElement("label"),Et=document.createElement("input"),qo=document.createElement("label");let ge;Ao.textContent=" Speed pause (EXPERIMENTAL)";Ao.htmlFor="input__tools-speed-pause-check";Nt.id="input__tools-speed-pause-check";Nt.className="input-toggle";Nt.type="checkbox";Nt.checked=!1;Nt.addEventListener("change",Ks);Oo.textContent="stream speed (ms): ";Oo.htmlFor="input__tools-speed-pause-time";$t.id="input__tools-speed-pause-time";$t.className="input-toggle input--small";$t.type="number";$t.min="0";$t.value=_(ba*1e3,1).toString();$t.addEventListener("change",Ws);qo.textContent=" (prec): ";qo.htmlFor="input__tools-speed-pause-prec";Et.id="input__tools-speed-pause-prec";Et.className="input-toggle input--small";Et.type="number";Et.min="0";Et.addEventListener("change",Zs);vt.appendChild(Nt);vt.appendChild(Ao);vt.appendChild(document.createElement("br"));vt.appendChild(Oo);vt.appendChild($t);vt.appendChild(qo);vt.appendChild(Et);const K={name:"Speed Pause",description:"Placeholder",type:"note",order:{input:50,output:180},input:{enabled:Nt.checked,params:{maxTime:ba},html:vt,adjustTime:Ys},output:{html:null},run:tc};function Ys(t){ge=t,Et.value=_(1/ge.toBeatTime(K.input.params.maxTime),2).toString()}function Ks(){K.input.enabled=this.checked}function Ws(){K.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=_(K.input.params.maxTime*1e3,1).toString(),ge&&(Et.value=_(1/ge.toBeatTime(K.input.params.maxTime),2).toString())}function Zs(){if(!ge){this.value="0";return}let t=_(Math.abs(parseFloat(this.value)),2)||1;K.input.params.maxTime=ge.toRealTime(1/t),$t.value=_(K.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Qs(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:i}=K.input.params,r=n.toBeatTime(i)+.001,a={},l={},s={0:!1,1:!1,3:!1},u={0:[],1:[],3:[]},d=[];for(let c=0,h=o.length;c<h;c++){const m=o[c];I(m)&&a[m._type]?R(m,a[m._type],n,u[m._type])&&(m._time-a[m._type]._time<=r*2?(s[0]&&s[1]&&a[m._type]._time-l[m._type]._time<=r*3&&d.push(a[m._type]),s[m._type]=!1):s[m._type]||(s[m._type]=!0,l[m._type]=a[m._type]),u[m._type]=[],a[m._type]=m):a[m._type]=m,u[m._type].push(m)}return d.map(c=>c._time).filter(function(c,h,m){return!h||c!==m[h-1]})}function tc(t,e){if(!e)throw new Error("something went wrong!");const n=Qs(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Speed pause [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,K.output.html=o}else K.output.html=null}const Jo=document.createElement("div"),jt=document.createElement("input"),Uo=document.createElement("label");Uo.textContent=" Hitbox staircase";Uo.htmlFor="input__tools-hitbox-stair-check";jt.id="input__tools-hitbox-stair-check";jt.className="input-toggle";jt.type="checkbox";jt.checked=!0;jt.addEventListener("change",ec);Jo.appendChild(jt);Jo.appendChild(Uo);const $n={name:"Hitbox Staircase",description:"Placeholder",type:"note",order:{input:70,output:190},input:{enabled:jt.checked,params:{},html:Jo},output:{html:null},run:oc};function ec(){$n.input.enabled=this.checked}function nc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,i=n.toBeatTime(.15),r={},a={},l={},s={0:[],1:[],3:[]},u={0:{_time:0,_type:0,_cutDirection:0,_lineIndex:0,_lineLayer:0},1:{_time:0,_type:1,_cutDirection:0,_lineIndex:0,_lineLayer:0},3:{_time:0,_type:3,_cutDirection:0,_lineIndex:0,_lineLayer:0}},d=[];for(let c=0,h=o.length;c<h;c++){const m=o[c];I(m)&&r[m._type]?(R(m,r[m._type],n,s[m._type])?(l[m._type]=m._time-r[m._type]._time,m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+Z[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+Z[m._cutDirection][1]):(u[m._type]._lineIndex=-1,u[m._type]._lineLayer=-1),s[m._type]=[],a[m._type]=m._cutDirection):Tr(m,r[m._type],a[m._type])&&(m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+Z[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+Z[m._cutDirection][1],a[m._type]=m._cutDirection):(u[m._type]._lineIndex=m._lineIndex+Z[a[m._type]][0],u[m._type]._lineLayer=m._lineLayer+Z[a[m._type]][1])),r[(m._type+1)%2]&&m._time-r[(m._type+1)%2]._time!=0&&m._time-r[(m._type+1)%2]._time<Math.min(i,l[(m._type+1)%2])&&m._lineIndex===u[(m._type+1)%2]._lineIndex&&m._lineLayer===u[(m._type+1)%2]._lineLayer&&!Sl(m,o,c)&&d.push(m)):(m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+Z[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+Z[m._cutDirection][1]):(u[m._type]._lineIndex=-1,u[m._type]._lineLayer=-1),a[m._type]=m._cutDirection),r[m._type]=m,s[m._type].push(m)}return d.map(c=>c._time).filter(function(c,h,m){return!h||c!==m[h-1]})}function oc(t,e){if(!e)throw new Error("something went wrong!");const n=nc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox staircase [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,$n.output.html=o}else $n.output.html=null}const Go=document.createElement("div"),Ft=document.createElement("input"),Xo=document.createElement("label");Xo.textContent=" Hitbox reverse staircase";Xo.htmlFor="input__tools-hitbox-rstair-check";Ft.id="input__tools-hitbox-rstair-check";Ft.className="input-toggle";Ft.type="checkbox";Ft.checked=!0;Ft.addEventListener("change",ic);Go.appendChild(Ft);Go.appendChild(Xo);const En={name:"Hitbox Reverse Staircase",description:"Placeholder",type:"note",order:{input:71,output:191},input:{enabled:Ft.checked,params:{},html:Go},output:{html:null},run:ac};function ic(){En.input.enabled=this.checked}function rc(t,e){var s,u;const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,r={},a={0:[],1:[],3:[]},l=[];for(let d=0,c=i.length;d<c;d++){const h=i[d];I(h)&&r[h._type]&&R(h,r[h._type],n,a[h._type])&&(a[h._type]=[]);for(const m of a[(h._type+1)%2])if(m._cutDirection!==8){let g=m._lineIndex+Z[(s=ao[m._cutDirection])!=null?s:8][0],p=m._lineLayer+Z[(u=ao[m._cutDirection])!=null?u:8][1];if(!(o.value>n.value/(60*(h._time-m._time)))&&h._lineIndex===g&&h._lineLayer===p){l.push(m);break}}r[h._type]=h,a[h._type].push(h)}return l.map(d=>d._time).filter(function(d,c,h){return!c||d!==h[c-1]})}function ac(t,e){if(!e)throw new Error("something went wrong!");const n=rc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox reverse staircase [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,En.output.html=o}else En.output.html=null}const Vo=document.createElement("div"),At=document.createElement("input"),zo=document.createElement("label");zo.textContent=" Hitbox inline";zo.htmlFor="input__tools-hitbox-inline-check";At.id="input__tools-hitbox-inline-check";At.className="input-toggle";At.type="checkbox";At.checked=!0;At.addEventListener("change",lc);Vo.appendChild(At);Vo.appendChild(zo);const Tn={name:"Hitbox Inline",description:"Placeholder",type:"note",order:{input:72,output:192},input:{enabled:At.checked,params:{},html:Vo},output:{html:null},run:cc};function lc(){Tn.input.enabled=this.checked}function sc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,r={},a={0:[],1:[],3:[]},l=[];for(let s=0,u=i.length;s<u;s++){const d=i[s];I(d)&&r[d._type]&&R(d,r[d._type],n,a[d._type])&&(a[d._type]=[]);for(const c of a[(d._type+1)%2])if(!(o.value>1.425*n.value/(60*(d._time-c._time)))&&d._lineIndex===c._lineIndex&&d._lineLayer===c._lineLayer){l.push(d);break}r[d._type]=d,a[d._type].push(d)}return l.map(s=>s._time).filter(function(s,u,d){return!u||s!==d[u-1]})}function cc(t,e){if(!e)throw new Error("something went wrong!");const n=sc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox inline [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,Tn.output.html=o}else Tn.output.html=null}const Yo=document.createElement("div"),Ot=document.createElement("input"),Ko=document.createElement("label");Ko.textContent=" Hitbox path";Ko.htmlFor="input__tools-hitbox-path-check";Ot.id="input__tools-hitbox-path-check";Ot.className="input-toggle";Ot.type="checkbox";Ot.checked=!0;Ot.addEventListener("change",uc);Yo.appendChild(Ot);Yo.appendChild(Ko);const Ln={name:"Hitbox Path",description:"Placeholder",type:"note",order:{input:74,output:190},input:{enabled:Ot.checked,params:{},html:Yo},output:{html:null},run:dc};function uc(){Ln.input.enabled=this.checked}function mc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,r=[];let a=0;for(let l=0,s=i.length;l<s;l++)if(!(n.toRealTime(i[l]._time)<a+.01||i[l]._type===3))for(let u=l+1;u<s&&!(n.toRealTime(i[u]._time)>n.toRealTime(i[l]._time)+.01);u++)i[l]._type===i[u]._type||i[u]._type===3||((me(i[l],i[u])||ue(i[l],i[u]))&&Er(i[l],i[u],2)||Ke(i[l],i[u])&&Er(i[l],i[u],1))&&(r.push(i[l]),a=n.toRealTime(i[l]._time));return r.map(l=>l._time).filter(function(l,s,u){return!s||l!==u[s-1]})}function dc(t,e){if(!e)throw new Error("something went wrong!");const n=mc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox path [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,Ln.output.html=o}else Ln.output.html=null}const Wo=document.createElement("div"),qt=document.createElement("input"),Zo=document.createElement("label");Zo.textContent=" Improper window snap";Zo.htmlFor="input__tools-window-snap-check";qt.id="input__tools-window-snap-check";qt.className="input-toggle";qt.type="checkbox";qt.checked=!0;qt.addEventListener("change",pc);Wo.appendChild(qt);Wo.appendChild(Zo);const wn={name:"Improper Window Snap",description:"Placeholder",type:"note",order:{input:60,output:185},input:{enabled:qt.checked,params:{},html:Wo},output:{html:null},run:_c};function pc(){wn.input.enabled=this.checked}function hc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,i={},r={0:[],1:[],3:[]},a=[];for(let l=0,s=o.length;l<s;l++){const u=o[l];I(u)&&i[u._type]?R(u,i[u._type],n,r[u._type])?(i[u._type]=u,r[u._type]=[]):so(u,i[u._type])&&u._time-i[u._type]._time>=.001&&u._cutDirection===i[u._type]._cutDirection&&u._cutDirection!==8&&i[u._type]._cutDirection!==8&&a.push(i[u._type]):i[u._type]=u,r[u._type].push(u)}return a.map(l=>l._time).filter(function(l,s,u){return!s||l!==u[s-1]})}function _c(t,e){if(!e)throw new Error("something went wrong!");const n=hc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Improper window snap [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,wn.output.html=o}else wn.output.html=null}var Qo;(function(t){t.forehand="backhand",t.backhand="forehand"})(Qo||(Qo={}));const xn={0:{forehand:[1,3,6,7],backhand:[0,2,4,5]},1:{forehand:[1,2,6,7],backhand:[0,3,4,5]}},Jt={0:[0,0,90,90,45,-45,45,-45],1:[0,0,-90,-90,-45,45,-45,45]},ya={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},Ie=class{constructor(t,e,n,o,i,r){this._type=e,this._warningThreshold=n,this._errorThreshold=o,this._allowedRotation=i,r&&r!=="neutral"?(this._state=r,this._rotation=0):(this._state=this.predictStartState(t,e),this._rotation=this.predictStartRotation(t,e)),this._position=this.predictStartPosition(t,e)}get state(){return this._state}get rotation(){return this._rotation}check(t,e){if(this._state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const n=t[0]._time,o=this._type;let i=this._state,r=this._rotation;e.forEach(u=>{u._time-.001>n||(u._lineLayer===0&&u._lineIndex===(o?2:1)&&(i="backhand",r=0),u._lineLayer===2&&u._lineIndex===(o?2:1)&&(i="forehand",r=0))});let a,l=8;for(const u of t)u._cutDirection!==8&&(l=u._cutDirection),a&&l===8&&(l=Lr(u,a)),a=u;if(l===8)return"none";const s=ya[o][Qo[i]][l];return(r>s?r-s:s-r)>180||s<Ie.CONSTRAINT_ROTATION[o][0]+this._errorThreshold||s>Ie.CONSTRAINT_ROTATION[o][1]-this._errorThreshold?"error":s<Ie.CONSTRAINT_ROTATION[o][0]+this._warningThreshold||s>Ie.CONSTRAINT_ROTATION[o][1]-this._warningThreshold||(r>s?r-s:s-r)>this._allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this._state){case"forehand":{this._state="backhand";break}case"backhand":{this._state="forehand";break}case"neutral":{for(let a=0;a<t.length;a++){const l=t[a];if(xn[l._type].forehand.includes(l._cutDirection)){this._state="backhand";break}if(xn[l._type].backhand.includes(l._cutDirection)){this._state="forehand";break}this._state==="neutral"&&l._cutDirection===8&&(l._lineLayer===0&&(this._state="backhand"),l._lineLayer>0&&(this._state="forehand"))}break}}if(this._state==="neutral")throw new Error("parity unexpected input");const n=t[0]._time,o=this._type;e.forEach(a=>{a._time-.001>n||(a._lineLayer===0&&a._lineIndex===(o?2:1)&&(this._state="forehand",this._rotation=0),a._lineLayer===2&&a._lineIndex===(o?2:1)&&(this._state="backhand",this._rotation=0))});let i,r=8;for(const a of t)a._cutDirection!==8&&(r=a._cutDirection),i&&r===8&&(r=Lr(a,i)),i=a;r!==8&&(this._rotation=ya[this._type][this._state][r])}predictStartState(t,e){let n="neutral";for(let o=0,i=t.length;o<i;o++){let r=t[o];if(r._type!==Math.abs(e-1)&&(r._type===3&&(r._lineLayer===0&&(r._lineIndex===e?1:2)&&(n="backhand"),r._lineLayer===2&&(r._lineIndex===e?1:2)&&(n="forehand")),r._type===e)){if(n!=="neutral")break;const a=r._time;for(let l=o;l<t.length&&!(t[l]._time>r._time+.001&&a<r._time+.001);l++){if(r=t[l],xn[r._type].forehand.includes(r._cutDirection))return"backhand";if(xn[r._type].backhand.includes(r._cutDirection))return"forehand";n==="neutral"&&r._cutDirection===8&&(r._lineLayer===0&&(n="backhand"),r._lineLayer>0&&(n="forehand"))}break}}return n}predictStartRotation(t,e){let n=0;for(let o=0,i=t.length;o<i;o++){let r=t[o];if(r._type===e&&r._type===e){const a=r._time;for(let l=o;l<t.length&&!(t[l]._time>r._time+.001&&a<r._time+.001);l++){if(r=t[l],r._cutDirection!==8)return Jt[r._type][r._cutDirection];r._cutDirection===8&&(r._lineLayer===0&&(r._lineIndex===0&&(n=Jt[r._type][6]),r._lineIndex===3&&(n=Jt[r._type][7])),r._lineLayer===1&&(r._lineIndex===0&&(n=Jt[r._type][2]),r._lineIndex===3&&(n=Jt[r._type][3])),r._lineLayer===2&&(r._lineIndex===0&&(n=Jt[r._type][4]),r._lineIndex===3&&(n=Jt[r._type][5])))}break}}return n}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let ti=Ie;ti.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];const De=(t,e,n,o,...i)=>{const r=document.createElement(n);r.className=o;const a=document.createElement("select");a.className="input-toggle",a.id=t,i.forEach(s=>{const u=document.createElement("option");u.textContent=s.text,u.value=s.value,a.append(u)});const l=document.createElement("label");return l.htmlFor=t,l.innerHTML=`<span>${e}</span>`,r.append(l),r.append(a),r},Cn=document.createElement("div"),Ut=document.createElement("input"),ei=document.createElement("label");De("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});De("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});De("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});ei.textContent=" Parity (EXPERIMENTAL)";ei.htmlFor="input__tools-parity-check";Ut.id="input__tools-parity-check";Ut.className="input-toggle";Ut.type="checkbox";Ut.checked=!1;Ut.addEventListener("change",fc);Cn.appendChild(Ut);Cn.appendChild(ei);Cn.appendChild(document.createElement("br"));const Re={name:"Parity check",description:"Placeholder",type:"note",order:{input:15,output:135},input:{enabled:Ut.checked,params:{warningThres:90,errorThres:45,allowedRot:90},html:Cn},output:{html:null},run:bc};function fc(){Re.input.enabled=this.checked}function gc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{warningThres:i,errorThres:r,allowedRot:a}=Re.input.params,l={},s={0:[],1:[],3:[]},u={0:[],1:[]},d={0:[],1:[]},c={0:new ti(o,0,i,r,a),1:new ti(o,1,i,r,a)},h={warning:[],error:[]};for(let m=0,g=o.length;m<g;m++){const p=o[m];if(I(p)&&l[p._type]&&R(p,l[p._type],n,s[p._type])){switch(c[p._type].check(s[p._type],d[p._type])){case"warning":{h.warning.push(s[p._type][0]._time);break}case"error":{h.error.push(s[p._type][0]._time);break}}c[p._type].next(s[p._type],d[p._type]),d[p._type]=u[p._type],u[p._type]=[],s[p._type]=[]}p._type===3&&(u[0].push(p),u[1].push(p)),l[p._type]=p,s[p._type].push(p)}for(let m=0;m<2;m++)if(l[m])switch(c[m].check(s[m],u[m])){case"warning":{h.warning.push(s[m][0]._time);break}case"error":{h.error.push(s[m][0]._time);break}}return h}function bc(t,e){if(!e)throw new Error("something went wrong!");const n=gc(t,e),o=[];if(n.warning.length&&o.push(`<b>Parity warning [${n.warning.length}]:</b> ${n.warning.filter(function(i,r,a){return!r||i!==a[r-1]}).sort((i,r)=>i-r).map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`),n.error.length&&o.push(`<b>Parity error [${n.error.length}]:</b> ${n.error.filter(function(i,r,a){return!r||i!==a[r-1]}).sort((i,r)=>i-r).map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`),o.length){const i=document.createElement("div");i.innerHTML=o.join("<br>"),Re.output.html=i}else Re.output.html=null}const ni=document.createElement("div"),Gt=document.createElement("input"),oi=document.createElement("label");oi.textContent=" Double-directional";oi.htmlFor="input__tools-dd-check";Gt.id="input__tools-dd-check";Gt.className="input-toggle";Gt.type="checkbox";Gt.checked=!0;Gt.addEventListener("change",yc);ni.appendChild(Gt);ni.appendChild(oi);const kn={name:"Double-directional",description:"Placeholder",type:"note",order:{input:99,output:140},input:{enabled:Gt.checked,params:{},html:ni},output:{html:null},run:$c};function yc(){kn.input.enabled=this.checked}function vc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,i={},r={},a={},l={0:[],1:[],3:[]},s=[];for(let u=0,d=o.length;u<d;u++){const c=o[u];I(c)&&i[c._type]?R(c,i[c._type],n,l[c._type])?(a[c._type]&&(a[c._type]=null,r[c._type]=(r[c._type]+180)%360),we(c,r[c._type],45,!0)&&s.push(c),c._cutDirection===8?a[c._type]=c:r[c._type]=V(c),l[c._type]=[]):(a[c._type]&&we(c,r[c._type],45,!0)&&(s.push(c),a[c._type]=null,r[c._type]=V(c)),c._cutDirection!==8&&(a[c._type]=null,r[c._type]=V(c))):r[c._type]=V(c),i[c._type]=c,l[c._type].push(c),c._type===3&&(c._lineLayer===0&&(c._lineIndex===1&&(r[0]=rt[0],a[0]=null),c._lineIndex===2&&(r[1]=rt[0],a[1]=null)),c._lineLayer===2&&(c._lineIndex===1&&(r[0]=rt[1],a[0]=null),c._lineIndex===2&&(r[1]=rt[1],a[1]=null)))}return s.map(u=>u._time).filter(function(u,d,c){return!d||u!==c[d-1]})}function $c(t,e){if(!e)throw new Error("something went wrong!");const n=vc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Double-directional [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,kn.output.html=o}else kn.output.html=null}const va=.1,$a=.5,Ea={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}};let N;const M=document.createElement("div"),Xt=document.createElement("input"),ii=document.createElement("label"),Vt=document.createElement("input"),ri=document.createElement("label"),Tt=document.createElement("input"),ai=document.createElement("label"),Lt=document.createElement("input"),li=document.createElement("label"),ct=document.createElement("input"),si=document.createElement("label"),Q=document.createElement("input"),ci=document.createElement("label"),W=document.createElement("input"),ui=document.createElement("label");ii.textContent=" Vision block";ii.htmlFor="input__tools-vb-check";Xt.id="input__tools-vb-check";Xt.className="input-toggle";Xt.type="checkbox";Xt.checked=!0;Xt.addEventListener("change",Tc);ri.textContent=" VB time specific ";ri.htmlFor="input__tools-vb-time-check";Vt.id="input__tools-vb-time-check";Vt.className="input-toggle";Vt.type="radio";Vt.name="input__tools-vb-spec";Vt.value="time";Vt.addEventListener("change",Ta);ai.textContent=" VB difficulty specific ";ai.htmlFor="input__tools-vb-diff-check";Tt.id="input__tools-vb-diff-check";Tt.className="input-toggle";Tt.type="radio";Tt.checked=!0;Tt.name="input__tools-vb-spec";Tt.value="difficulty";Tt.addEventListener("change",Ta);li.textContent="min time (ms): ";li.htmlFor="input__tools-vb-min-time";Lt.id="input__tools-vb-min-time";Lt.className="input-toggle input--small";Lt.type="number";Lt.min="0";Lt.value=_(va*1e3,1).toString();Lt.addEventListener("change",Lc);si.textContent=" (beat): ";si.htmlFor="input__tools-vb-min-beat";ct.id="input__tools-vb-min-beat";ct.className="input-toggle input--small";ct.type="number";ct.min="0";ct.step="0.1";ct.addEventListener("change",wc);ci.textContent="max time (ms): ";ci.htmlFor="input__tools-vb-max-time";Q.id="input__tools-vb-max-time";Q.className="input-toggle input--small";Q.type="number";Q.min="0";Q.value=_($a*1e3,1).toString();Q.addEventListener("change",xc);ui.textContent=" (beat): ";ui.htmlFor="input__tools-vb-max-beat";W.id="input__tools-vb-max-beat";W.className="input-toggle input--small";W.type="number";W.min="0";W.step="0.1";W.addEventListener("change",Cc);M.appendChild(Xt);M.appendChild(ii);M.appendChild(document.createElement("br"));M.appendChild(Vt);M.appendChild(ri);M.appendChild(Tt);M.appendChild(ai);M.appendChild(document.createElement("br"));M.appendChild(li);M.appendChild(Lt);M.appendChild(si);M.appendChild(ct);M.appendChild(document.createElement("br"));M.appendChild(ci);M.appendChild(Q);M.appendChild(ui);M.appendChild(W);const T={name:"Slow Slider",description:"Placeholder",type:"note",order:{input:100,output:120},input:{enabled:Xt.checked,params:{specific:"difficulty",minTime:va,maxTime:$a},html:M,adjustTime:Ec},output:{html:null},run:Mc};function Ec(t){N=t,ct.value=_(N.toBeatTime(T.input.params.minTime),2).toString(),W.value=_(N.toBeatTime(T.input.params.maxTime),2).toString()}function Tc(){T.input.enabled=this.checked}function Ta(){T.input.params.specific=this.value}function Lc(){T.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=_(T.input.params.minTime*1e3,1).toString(),N&&(ct.value=_(N.toBeatTime(T.input.params.minTime),2).toString(),T.input.params.minTime>T.input.params.maxTime&&(T.input.params.maxTime=T.input.params.minTime,Q.value=_(T.input.params.maxTime*1e3,1).toString(),W.value=_(N.toBeatTime(T.input.params.maxTime),2).toString()))}function wc(){if(!N){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;T.input.params.minTime=N.toRealTime(t),Lt.value=_(T.input.params.minTime*1e3,1).toString(),this.value=_(t,2).toString(),T.input.params.minTime>T.input.params.maxTime&&(T.input.params.maxTime=T.input.params.minTime,Q.value=_(T.input.params.maxTime*1e3,1).toString(),W.value=_(N.toBeatTime(T.input.params.maxTime),2).toString())}function xc(){T.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=_(T.input.params.maxTime*1e3,1).toString(),N&&(W.value=_(N.toBeatTime(T.input.params.maxTime),2).toString())}function Cc(){if(!N){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;T.input.params.maxTime=N.toRealTime(t),Q.value=_(T.input.params.maxTime*1e3,1).toString(),this.value=_(t,2).toString()}function kc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,{minTime:r,maxTime:a,specific:l}=T.input.params,s=l==="time"?n.toBeatTime(r):n.toBeatTime(Ea[e._difficulty].min),u=l==="time"?n.toBeatTime(a):Math.min(o.hjd,n.toBeatTime(Ea[e._difficulty].max));let d,c;const h=[];for(let m=0,g=i.length;m<g;m++){const p=i[m];d&&(p._time-d._time>=s&&p._time-d._time<=u?p._lineIndex<2&&h.push(p):p._time-d._time>u&&(d=null)),c&&(p._time-c._time>=s&&p._time-c._time<=u?p._lineIndex>1&&h.push(p):p._time-c._time>u&&(c=null)),p._lineLayer===1&&p._lineIndex===1&&(d=p),p._lineLayer===1&&p._lineIndex===2&&(c=p)}return h.map(m=>m._time).filter(function(m,g,p){return!g||m!==p[g-1]})}function Mc(t,e){if(!e)throw new Error("something went wrong!");const n=kc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Vision block [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,T.output.html=o}else T.output.html=null}const mi=document.createElement("div"),zt=document.createElement("input"),di=document.createElement("label");di.textContent=" Stacked note";di.htmlFor="input__tools-stack-note-check";zt.id="input__tools-stack-note-check";zt.className="input-toggle";zt.type="checkbox";zt.checked=!0;zt.addEventListener("change",Sc);mi.appendChild(zt);mi.appendChild(di);const Mn={name:"Stacked Note",description:"Placeholder",type:"note",order:{input:98,output:198},input:{enabled:zt.checked,params:{},html:mi},output:{html:null},run:Rc};function Sc(){Mn.input.enabled=this.checked}function Ic(t,e){const{_bpm:n}=t,{_notes:o}=e._data,i=[];let r=0;for(let a=0,l=o.length;a<l;a++)if(!(n.toRealTime(o[a]._time)<r+.01||o[a]._type===3))for(let s=a+1;s<l&&!(n.toRealTime(o[s]._time)>n.toRealTime(o[a]._time)+.01);s++)lo(o[a],o[s])&&(i.push(o[a]),r=n.toRealTime(o[a]._time));return i.map(a=>a._time).filter(function(a,l,s){return!l||a!==s[l-1]})}function Dc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,r=[];for(let a=0,l=i.length;a<l;a++)if(i[a]._type===3)for(let s=a+1;s<l&&!(n.toRealTime(i[s]._time)>n.toRealTime(i[a]._time)+1);s++)lo(i[a],i[s])&&(o.value<n.value/(120*(i[s]._time-i[a]._time))||n.toRealTime(i[s]._time)<n.toRealTime(i[a]._time)+.02)&&r.push(i[a]);return r.map(a=>a._time).filter(function(a,l,s){return!l||a!==s[l-1]})}function Rc(t,e){if(!e)throw new Error("something went wrong!");const n=Ic(t,e),o=Dc(t,e),i=[];if(n.length&&i.push(`<b>Stacked note [${n.length}]:</b> ${n.map(r=>_(t._bpm.adjustTime(r),3)).join(", ")}`),o.length&&i.push(`<b>Stacked bomb [${o.length}]:</b> ${o.map(r=>_(t._bpm.adjustTime(r),3)).join(", ")}`),i.length){const r=document.createElement("div");r.innerHTML=i.join("<br>"),Mn.output.html=r}else Mn.output.html=null}const La=[1,1,1],wa={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"},xa=(t,e)=>{var i;let n=(i=Object.keys(t).find(r=>parseFloat(r)>=e))!=null?i:"100",o=parseFloat(n);return t[o]},pi=document.createElement("div"),Yt=document.createElement("input"),hi=document.createElement("label");hi.textContent=" Color check (EXPERIMENTAL)";hi.htmlFor="input__tools-note-color-check";Yt.id="input__tools-note-color-check";Yt.className="input-toggle";Yt.type="checkbox";Yt.checked=!0;Yt.addEventListener("change",Bc);pi.appendChild(Yt);pi.appendChild(hi);const Sn={name:"Color Check",description:"Placeholder",type:"note",order:{input:97,output:45},input:{enabled:Yt.checked,params:{},html:pi},output:{html:null},run:Nc};function Bc(){Sn.input.enabled=this.checked}function Pc(t,e){var i,r,a,l;const n=(r=(i=e._info._customData)==null?void 0:i._colorLeft)!=null?r:B[S[e._environment]]._colorLeft,o=(l=(a=e._info._customData)==null?void 0:a._colorRight)!=null?l:B[S[e._environment]]._colorRight;return n&&o?mo(Qe(n),Qe(o)):100}function Hc(t,e){var a,l,s,u;let n=100,o=100;const i=(l=(a=e._info._customData)==null?void 0:a._colorLeft)!=null?l:B[S[e._environment]]._colorLeft,r=(u=(s=e._info._customData)==null?void 0:s._colorRight)!=null?u:B[S[e._environment]]._colorRight;return i&&(n=mo(La,Qe(i))),r&&(o=mo(La,Qe(r))),Math.min(n,o)}function Nc(t,e){var r,a;if(!e)throw new Error("something went wrong!");if(!((r=e._info._customData)==null?void 0:r._colorLeft)&&!((a=e._info._customData)==null?void 0:a._colorRight))return;const n=Pc(t,e),o=Hc(t,e),i=[];if(n<=20&&i.push(`<b>${xa(wa,n)} note color (dE${_(n,1)}):</b> suggest change to better differentiate between 2 note colour`),o<=20&&i.push(`<b>${xa(wa,o)} arrow note color (dE${_(o,1)}):</b> may be difficult to see the arrow`),i.length){const l=document.createElement("div");l.innerHTML=i.join("<br>"),Sn.output.html=l}else Sn.output.html=null}var Ca=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",effectiveBPM:P,acceptablePrec:pe,varySwing:vn,slowSlider:J,inlineAngle:z,shradoAngle:H,speedPause:K,hitboxStair:$n,hitboxReverseStair:En,hitboxInline:Tn,hitboxPath:Ln,improperWindow:wn,parity:Re,doubleDirectional:kn,visionBlock:T,stackedNote:Mn,colorCheck:Sn});const _i=document.createElement("div"),Kt=document.createElement("input"),fi=document.createElement("label");fi.textContent=" <15ms obstacle";fi.htmlFor="input__tools-short-obstacle-check";Kt.id="input__tools-short-obstacle-check";Kt.className="input-toggle";Kt.type="checkbox";Kt.checked=!0;Kt.addEventListener("change",jc);_i.appendChild(Kt);_i.appendChild(fi);const Be={name:"Short Obstacle",description:"Placeholder",type:"obstacle",order:{input:0,output:50},input:{enabled:Kt.checked,params:{minDur:.015},html:_i},output:{html:null},run:Ac};function jc(){Be.input.enabled=this.checked}function Fc(t,e){const{_obstacles:n}=e._data,{_bpm:o}=t,{minDur:i}=Be.input.params,r=o.toBeatTime(i),a=[];let l={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0},s={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0},u={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0},d={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0};return n.forEach(c=>{c._type===0&&c._duration>0?c._width>2||c._width>1&&c._lineIndex===1?(v(c,l)&&(c._duration<r&&a.push(c),l=c),v(c,s)&&(c._duration<r&&a.push(c),s=c)):c._width===2?c._lineIndex===0?v(c,l)&&(c._duration<r&&a.push(c),l=c):c._lineIndex===2&&v(c,s)&&(c._duration<r&&a.push(c),s=c):c._width===1&&(c._lineIndex===1?v(c,l)&&(c._duration<r&&a.push(c),l=c):c._lineIndex===2&&v(c,s)&&(c._duration<r&&a.push(c),s=c)):c._type===1&&c._duration>0&&(c._width>2||c._width>1&&c._lineIndex===1?(v(c,u)&&(c._duration<r&&v(c,l,r)&&v(c,u,r)&&a.push(c),u=c),v(c,d)&&(c._duration<r&&v(c,s,r)&&v(c,d,r)&&a.push(c),d=c)):c._width===2?c._lineIndex===0?v(c,u)&&(c._duration<r&&v(c,l,r)&&v(c,u,r)&&a.push(c),u=c):c._lineIndex===2&&v(c,d)&&(c._duration<r&&v(c,s,r)&&v(c,d,r)&&a.push(c),d=c):c._width===1&&(c._lineIndex===1?v(c,u)&&(c._duration<r&&v(c,l,r)&&v(c,u,r)&&a.push(c),u=c):c._lineIndex===2&&v(c,d)&&(c._duration<r&&v(c,s,r)&&v(c,d,r)&&a.push(c),d=c)))}),a.map(c=>c._time).filter(function(c,h,m){return!h||c!==m[h-1]})}function Ac(t,e){if(!e)throw new Error("something went wrong!");const n=Fc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b><15ms obstacle [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,Be.output.html=o}else Be.output.html=null}const ka=.25;let be;const wt=document.createElement("div"),Wt=document.createElement("input"),gi=document.createElement("label"),xt=document.createElement("input"),bi=document.createElement("label"),ut=document.createElement("input"),yi=document.createElement("label");gi.textContent=" 2-wide center obstacle";gi.htmlFor="input__tools-center-obstacle-check";Wt.id="input__tools-center-obstacle-check";Wt.className="input-toggle";Wt.type="checkbox";Wt.checked=!0;Wt.addEventListener("change",qc);bi.textContent="recovery time (ms): ";bi.htmlFor="input__tools-2wide-wall-time";xt.id="input__tools-2wide-wall-time";xt.className="input-toggle input--small";xt.type="number";xt.min="0";xt.value=_(ka*1e3,1).toString();xt.addEventListener("change",Jc);yi.textContent=" (beat): ";yi.htmlFor="input__tools-2wide-wall-beat";ut.id="input__tools-2wide-wall-beat";ut.className="input-toggle input--small";ut.type="number";ut.min="0";ut.step="0.1";ut.addEventListener("change",Uc);wt.appendChild(Wt);wt.appendChild(gi);wt.appendChild(document.createElement("br"));wt.appendChild(bi);wt.appendChild(xt);wt.appendChild(yi);wt.appendChild(ut);const U={name:"2-wide Center Obstacle",description:"Placeholder",type:"obstacle",order:{input:10,output:60},input:{enabled:Wt.checked,params:{recovery:ka},html:wt,adjustTime:Oc},output:{html:null},run:Xc};function Oc(t){be=t,ut.value=_(be.toBeatTime(U.input.params.recovery),2).toString()}function qc(){U.input.enabled=this.checked}function Jc(){U.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=_(U.input.params.recovery*1e3,1).toString(),be&&(ut.value=_(be.toBeatTime(U.input.params.recovery),2).toString())}function Uc(){if(!be){this.value="0";return}let t=_(Math.abs(parseFloat(this.value)),2)||1;U.input.params.recovery=be.toRealTime(t),xt.value=_(U.input.params.recovery*1e3,1).toString(),this.value=t.toString()}function Gc(t,e){const{_obstacles:n}=e._data,{_bpm:o}=t,{recovery:i}=U.input.params,r=[];let a={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0},l={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0};return n.forEach(s=>{s._type===0&&(s._width>2&&(r.push(s),v(s,a)&&(a=s),v(s,l)&&(l=s)),s._width===2&&(s._lineIndex===0&&v(s,a)&&(o.toRealTime(s._time)>o.toRealTime(l._time)-i&&o.toRealTime(s._time)<o.toRealTime(l._time+l._duration)+i&&r.push(s),a=s),s._lineIndex===1&&(r.push(s),v(s,a)&&(a=s),v(s,l)&&(l=s)),s._lineIndex===2&&v(s,l)&&(o.toRealTime(s._time)>o.toRealTime(a._time)-i&&o.toRealTime(s._time)<o.toRealTime(a._time+a._duration)+i&&r.push(s),l=s)),s._width===1&&(s._lineIndex===1&&v(s,a)&&(o.toRealTime(s._time)>o.toRealTime(l._time)-i&&o.toRealTime(s._time)<o.toRealTime(l._time+l._duration)+i&&r.push(s),a=s),s._lineIndex===2&&v(s,l)&&(o.toRealTime(s._time)>o.toRealTime(a._time)-i&&o.toRealTime(s._time)<o.toRealTime(a._time+a._duration)+i&&r.push(s),l=s)))}),r.map(s=>s._time).filter(function(s,u,d){return!u||s!==d[u-1]})}function Xc(t,e){if(!e)throw new Error("something went wrong!");const n=Gc(t,e),{recovery:o}=U.input.params;if(n.length){const i=document.createElement("div");i.innerHTML=`<b>2-wide center obstacle (<${_(o*1e3)}ms) [${n.length}]:</b> ${n.map(r=>_(t._bpm.adjustTime(r),3)).join(", ")}`,U.output.html=i}else U.output.html=null}const vi=document.createElement("div"),Zt=document.createElement("input"),$i=document.createElement("label");$i.textContent=" Zero width/duration obstacle";$i.htmlFor="input__tools-zero-obstacle-check";Zt.id="input__tools-zero-obstacle-check";Zt.className="input-toggle";Zt.type="checkbox";Zt.checked=!0;Zt.addEventListener("change",Vc);vi.appendChild(Zt);vi.appendChild($i);const In={name:"Negative Obstacle",description:"Placeholder",type:"obstacle",order:{input:20,output:70},input:{enabled:Zt.checked,params:{},html:vi},output:{html:null},run:Yc};function Vc(){In.input.enabled=this.checked}function zc(t,e){const{_obstacles:n}=e._data;return n.filter(o=>o._width===0||o._duration===0).map(o=>o._time)}function Yc(t,e){if(!e)throw new Error("something went wrong!");const n=zc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Zero width/duration obstacle [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,In.output.html=o}else In.output.html=null}const Ei=document.createElement("div"),Qt=document.createElement("input"),Ti=document.createElement("label");Ti.textContent=" Negative obstacle";Ti.htmlFor="input__tools-negative-obstacle-check";Qt.id="input__tools-negative-obstacle-check";Qt.className="input-toggle";Qt.type="checkbox";Qt.checked=!0;Qt.addEventListener("change",Kc);Ei.appendChild(Qt);Ei.appendChild(Ti);const Dn={name:"Negative Obstacle",description:"Placeholder",type:"obstacle",order:{input:30,output:80},input:{enabled:Qt.checked,params:{},html:Ei},output:{html:null},run:Zc};function Kc(){Dn.input.enabled=this.checked}function Wc(t,e){var o,i,r,a;const{_obstacles:n}=e._data;return((i=(o=e._info._customData)==null?void 0:o._requirements)==null?void 0:i.includes("Mapping Extensions"))||((a=(r=e._info._customData)==null?void 0:r._requirements)==null?void 0:a.includes("Noodle Extensions"))?[]:n.filter(l=>l._width<0||l._duration<0).map(l=>l._time)}function Zc(t,e){if(!e)throw new Error("something went wrong!");const n=Wc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Negative obstacle [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,Dn.output.html=o}else Dn.output.html=null}var Ma=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",shortObstacle:Be,centerObstacle:U,zeroObstacle:In,negativeObstacle:Dn});const Li=document.createElement("div"),te=document.createElement("input"),wi=document.createElement("label");wi.textContent=" Insufficient lighting event";wi.htmlFor="input__tools-insufficient-light-check";te.id="input__tools-insufficient-light-check";te.className="input-toggle";te.type="checkbox";te.checked=!0;te.addEventListener("change",Qc);Li.appendChild(te);Li.appendChild(wi);const Rn={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:0,output:0},input:{enabled:te.checked,params:{},html:Li},output:{html:null},run:eu};function Qc(){Rn.input.enabled=this.checked}const tu=t=>{let e=0;for(let n=t.length-1;n>=0;n--)if(Ze(t[n])&&t[n]._value!==0&&t[n]._value!==4&&(e++,e>10))return!0;return!1};function eu(t,e){if(!e)throw new Error("something went wrong!");if(tu(e._data._events))Rn.output.html=null;else{const o=document.createElement("div");o.innerHTML="<b>Insufficient lighting event</b>",Rn.output.html=o}}const xi=document.createElement("div"),ee=document.createElement("input"),Ci=document.createElement("label");Ci.textContent=" Old value 4 event";Ci.htmlFor="input__tools-light-4";ee.id="input__tools-light-4";ee.className="input-toggle";ee.type="checkbox";ee.checked=!0;ee.addEventListener("change",nu);xi.appendChild(ee);xi.appendChild(Ci);const Bn={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:1,output:1},input:{enabled:ee.checked,params:{},html:xi},output:{html:null},run:iu};function nu(){Bn.input.enabled=this.checked}function ou(t,e){const{_events:n}=e._data,o=[];if(Kl(e._data._version,"difficulty")==="old")for(let i=n.length-1;i>=0;i--)Ze(n[i])&&n[i]._value===4&&o.push(n[i]);else return[];return o.map(i=>i._time).filter(function(i,r,a){return!r||i!==a[r-1]})}function iu(t,e){if(!e)throw new Error("something went wrong!");const n=ou(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Event with value 4 [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,Bn.output.html=o}else Bn.output.html=null}const ki=document.createElement("div"),ne=document.createElement("input"),Mi=document.createElement("label");Mi.textContent=" Unlit bomb";Mi.htmlFor="input__tools-unlit-bomb";ne.id="input__tools-unlit-bomb";ne.className="input-toggle";ne.type="checkbox";ne.checked=!0;ne.addEventListener("change",ru);ki.appendChild(ne);ki.appendChild(Mi);const Pn={name:"Unlit Bomb",description:"Placeholder",type:"event",order:{input:3,output:203},input:{enabled:ne.checked,params:{},html:ki},output:{html:null},run:lu};function ru(){Pn.input.enabled=this.checked}const au=(t,e,n)=>{var u;if(!e.length)return[];const o=[],i=e.filter(d=>Ze(d)).sort((d,c)=>d._type-c._type),r={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},a={0:[[0,!1]],1:[[0,!1]],2:[[0,!1]],3:[[0,!1]],4:[[0,!1]],6:[[0,!1]],7:[[0,!1]],10:[[0,!1]],11:[[0,!1]]},l=n.toBeatTime(1),s=n.toBeatTime(.25);for(let d=0,c=i.length;d<c;d++){const h=i[d];if((jl(h)||Fl(h))&&r[h._type].state!=="on"){r[h._type]={state:"on",time:h._time,fadeTime:0};let m=a[h._type].find(g=>g[0]>=h._time&&!h[1]);m?(m[0]=h._time,m[1]=!0):a[h._type].push([h._time,!0])}if(Al(h)){r[h._type]={state:"off",time:h._time,fadeTime:l};let m=a[h._type].find(g=>g[0]>=h._time&&!h[1]);m?(m[0]=h._time,m[1]=!0):a[h._type].push([h._time,!0]),a[h._type].push([h._time+l,!1])}(((u=h==null?void 0:h._floatValue)!=null?u:1)<.25||Nl(h))&&r[h._type].state!=="off"&&(r[h._type]={state:"off",time:h._time,fadeTime:r[h._type].state==="on"?s:Math.min(s,r[h._type].fadeTime)},a[h._type].push([h._time+(r[h._type].state==="on"?s:Math.min(s,r[h._type].fadeTime)),!1]))}for(const d in a)a[d].reverse();for(let d=0,c=t.length,h=!1;d<c;d++){const m=t[d];if(!!Ml(m)){h=!1;for(const g in a){const p=a[g].find(w=>w[0]<=m._time);p&&(h=h||p[1])}h||o.push(m)}}return o.map(d=>d._time).filter(function(d,c,h){return!c||d!==h[c-1]})};function lu(t,e){if(!e)throw new Error("something went wrong!");const n=au(e._data._notes,e._data._events,t._bpm);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Unlit bomb [${n.length}]:</b> ${n.map(i=>_(t._bpm.adjustTime(i),3)).join(", ")}`,Pn.output.html=o}else Pn.output.html=null}const Si=document.createElement("div"),oe=document.createElement("input"),Ii=document.createElement("label");Ii.textContent=" Event peak (1 second) and per second";Ii.htmlFor="input__tools-light-stats";oe.id="input__tools-light-stats";oe.className="input-toggle";oe.type="checkbox";oe.checked=!1;oe.addEventListener("change",su);Si.appendChild(oe);Si.appendChild(Ii);const Hn={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:2,output:2},input:{enabled:oe.checked,params:{},html:Si},output:{html:null},run:uu};function su(){Hn.input.enabled=this.checked}function cu(t,e){const{_bpm:n,_audioDuration:o}=t,{_events:i}=e._data;let r=n.toBeatTime(1),a=0,l=0;for(let s=0;s<i.length;s++){for(;i[s]._time-i[l]._time>r;)l++;a=Math.max(a,(s-l+r)/(1/n.value*60))}return{EPS:o?_(i.length/o,3):0,peakEPS:_(a,3)}}function uu(t,e){if(!e)throw new Error("something went wrong!");const n=cu(t,e);if(n){const o=document.createElement("div");o.innerHTML=`<b>Events per second:</b> ${n.EPS}<br><b>Peak Event (1s):</b> ${n.peakEPS}`,Hn.output.html=o}else Hn.output.html=null}var Sa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",insufficientLight:Rn,oldEventValue:Bn,unlitBomb:Pn,testEvent:Hn});const Ia=1.5,Di=document.createElement("div"),Ct=document.createElement("input"),Ri=document.createElement("label");Ri.textContent="Hot start (s): ";Ri.htmlFor="input__tools-hot-start";Ct.id="input__tools-hot-start";Ct.className="input-toggle input--small";Ct.type="number";Ct.min="0";Ct.step="0.1";Ct.value=Ia.toString();Ct.addEventListener("change",mu);Di.appendChild(Ri);Di.appendChild(Ct);const ye={name:"Hot Start",description:"Placeholder",type:"other",order:{input:0,output:0},input:{enabled:!0,params:{time:Ia},html:Di},output:{html:null},run:du};function mu(){ye.input.params.time=_(Math.abs(parseFloat(this.value)),3),this.value=ye.input.params.time.toString()}function du(t,e){if(!e)throw new Error("something went wrong!");const{time:n}=ye.input.params,o=t._bpm.toRealTime(gr(e._data));if(o<n){const i=document.createElement("div");i.innerHTML=`<b>Hot start:</b> ${_(o,2)}s`,ye.output.html=i}else ye.output.html=null}const Bi={name:"Difficulty Label",description:"Placeholder",type:"other",order:{input:30,output:30},input:{enabled:!0,params:{}},output:{html:null},run:pu};function pu(t,e){var o;if(!e)throw new Error("something went wrong!");const n=(o=e._info._customData)==null?void 0:o._difficultyLabel;if(n&&n.length>30){const i=document.createElement("div");i.innerHTML=`<b>Difficulty label is too long (${n.length} characters):</b> exceeded 30 max characters by ranking criteria`,Bi.output.html=i}else Bi.output.html=null}const Pi={name:"Note Jump Speed",description:"Placeholder",type:"other",order:{input:40,output:40},input:{enabled:!0,params:{}},output:{html:null},run:hu};function hu(t,e){if(!e)throw new Error("something went wrong!");const{_njs:n,_bpm:o}=t,i=[];if(e._info._noteJumpMovementSpeed===0&&i.push("<b>Unset NJS</b>: fallback NJS is used"),n.value>23&&i.push(`<b>NJS is too high (${_(n.value,2)}):</b> use lower whenever necessary`),n.jd<18&&i.push(`<b>Very low jump distance:</b> ${_(n.jd,2)}`),n.jd>36&&i.push(`<b>Very high jump distance:</b> ${_(n.jd,2)}`),n.jd>n.calcJumpDistanceOptimalHigh()&&i.push(`<b>High jump distance warning (>${_(n.calcJumpDistanceOptimalHigh(),2)}):</b> ${_(n.jd,2)} at ${_(n.value,2)} NJS may be uncomfortable to play`),o.toRealTime(n.hjd)<.45&&i.push(`<b>Very quick reaction time (${_(o.toRealTime(n.hjd)*1e3)}ms):</b> may lead to suboptimal gameplay`),n.calcHalfJumpDurationRaw()+n.offset<n.hjdMin&&i.push(`<b>Unnecessary negative offset:</b> will not drop below ${n.hjdMin}`),i.length){const r=document.createElement("div");r.innerHTML=i.join("<br>"),Pi.output.html=r}else Pi.output.html=null}const Hi=document.createElement("div"),ie=document.createElement("input"),Ni=document.createElement("label");Ni.textContent=" Outside playable object";Ni.htmlFor="input__tools-outside-object-check";ie.id="input__tools-outside-object-check";ie.className="input-toggle";ie.type="checkbox";ie.checked=!0;ie.addEventListener("change",_u);Hi.appendChild(ie);Hi.appendChild(Ni);const Nn={name:"Difficulty Label",description:"Placeholder",type:"other",order:{input:10,output:10},input:{enabled:ie.checked,params:{},html:Hi},output:{html:null},run:fu};function _u(){Nn.input.enabled=this.checked}function fu(t,e){if(!e)throw new Error("something went wrong!");const{_bpm:n,_audioDuration:o}=t,{_notes:i,_obstacles:r,_events:a}=e._data,l=[];if(o){let s=n.toBeatTime(o);i.length&&i[0]._time<0&&l.push(`<b>Note(s) before start time:</b> ${_(i[0]._time,3)} (${F(n.toRealTime(i[0]._time))})`),r.length&&r[0]._time<0&&l.push(`<b>Obstacle(s) before start time:</b> ${_(r[0]._time,3)} (${F(n.toRealTime(r[0]._time))})`),a.length&&a[0]._time<0&&l.push(`<b>Event(s) before start time:</b> ${_(a[0]._time,3)} (${F(n.toRealTime(a[0]._time))})`),i.length&&i[i.length-1]._time>s&&l.push(`<b>Note(s) after end time:</b> ${_(i[i.length-1]._time,3)} (${F(n.toRealTime(i[i.length-1]._time))})`),r.length&&r[r.length-1]._time>s&&l.push(`<b>Obstacle(s) after end time:</b> ${_(r[r.length-1]._time,3)} (${F(n.toRealTime(r[r.length-1]._time))})`),a.length&&a[a.length-1]._time>s&&l.push(`<b>Event(s) after end time:</b> ${_(a[a.length-1]._time,3)} (${F(n.toRealTime(a[a.length-1]._time))})`)}if(l.length){const s=document.createElement("div");s.innerHTML=l.join("<br>"),Nn.output.html=s}else Nn.output.html=null}const ji=document.createElement("div"),re=document.createElement("input"),Fi=document.createElement("label");Fi.textContent=" Invalid object";Fi.htmlFor="input__tools-invalid-object-check";re.id="input__tools-invalid-object-check";re.className="input-toggle";re.type="checkbox";re.checked=!0;re.addEventListener("change",gu);ji.appendChild(re);ji.appendChild(Fi);const jn={name:"Invalid Object",description:"Placeholder",type:"other",order:{input:20,output:20},input:{enabled:re.checked,params:{},html:ji},output:{html:null},run:bu};function gu(){jn.input.enabled=this.checked}function bu(t,e){var d,c,h,m;if(!e)throw new Error("something went wrong!");const{_bpm:n}=t,{_notes:o,_obstacles:i,_events:r}=e._data;let a=[],l=[];((c=(d=e._info._customData)==null?void 0:d._requirements)==null?void 0:c.includes("Mapping Extensions"))||(((m=(h=e._info._customData)==null?void 0:h._requirements)==null?void 0:m.includes("Noodle Extensions"))?(a=o.filter(g=>wr(g)&&!Il(g)).map(g=>g._time),l=i.filter(g=>eo(g)&&!fr(g)).map(g=>g._time)):(a=o.filter(g=>!Rl(g)).map(g=>g._time),l=i.filter(g=>!El(g)).map(g=>g._time)));const s=r.filter(g=>!Xl(g)).map(g=>g._time),u=[];if(a.length&&u.push(`<b>Invalid note [${a.length}]:</b> ${a.map(g=>_(n.adjustTime(g),3)).join(", ")}`),l.length&&u.push(`<b>Invalid obstacle [${l.length}]:</b> ${l.map(g=>_(n.adjustTime(g),3)).join(", ")}`),s.length&&u.push(`<b>Invalid event [${s.length}]:</b> ${s.map(g=>_(n.adjustTime(g),3)).join(", ")}`),u.length){const g=document.createElement("div");g.innerHTML=u.join("<br>"),jn.output.html=g}else jn.output.html=null}var Da=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",hotStart:ye,difficultyLabel:Bi,njs:Pi,outsidePlayable:Nn,invalidObject:jn});const Ra=()=>Object.keys(Ca).map(t=>Ca[t]),Ba=()=>Object.keys(Ma).map(t=>Ma[t]),Pa=()=>Object.keys(Sa).map(t=>Sa[t]),Ha=()=>Object.keys(Da).map(t=>Da[t]),Na=()=>Object.keys(ua).map(t=>ua[t]),ja=()=>[...Ra(),...Ba(),...Pa(),...Ha()],yu=()=>[...Ra(),...Ba(),...Pa(),...Ha(),...Na()],Ai=()=>{b._analysis={general:{html:null},mapSet:[],missing:[],sps:[]}},vu=()=>{var s,u,d;const t=b._mapInfo;if(!t){console.error("could not analyse, missing map info");return}b._analysis||Ai();const e=(s=b._analysis)==null?void 0:s.general,n=(u=b._analysis)==null?void 0:u.sps,o=it(t._beatsPerMinute),i=oo(o),r={_bpm:o,_njs:i,_audioDuration:(d=b._duration)!=null?d:null,_mapDuration:0},a=Na().sort((c,h)=>c.order.output-h.order.output);console.log("analysing general");const l=[];a.forEach(c=>{if(c.input.enabled)try{c.run(r,void 0,t,n),c.output.html&&l.push(c.output.html)}catch(h){console.error(h)}}),e&&(e.html=l)},Fa=(t,e)=>{var d,c,h,m,g,p,w;const n=b._mapInfo;if(!n){console.error("could not analyse, missing map info");return}const o=(d=b._mapSet)==null?void 0:d.find(y=>y._mode===t&&y._difficulty===e);if(!o){console.error("could not analyse, missing map data");return}b._analysis||Ai();const i=(c=b._analysis)==null?void 0:c.mapSet.find(y=>y.difficulty===e&&y.mode===t),r=it(n._beatsPerMinute,((h=o._data._customData)==null?void 0:h._BPMChanges)||((m=o._data._customData)==null?void 0:m._bpmChanges),(g=o._info._customData)==null?void 0:g._editorOffset),a=oo(r,o._info._noteJumpMovementSpeed,o._info._noteJumpStartBeatOffset),l={_bpm:r,_njs:a,_audioDuration:(p=b._duration)!=null?p:null,_mapDuration:r.toRealTime(Ye(o._data))},s=ja().sort((y,L)=>y.order.output-L.order.output);console.log(`analysing ${t} ${e}`);const u=[];s.forEach(y=>{if(y.input.enabled)try{y.run(l,o,n),y.output.html&&u.push(y.output.html)}catch(L){console.error(L)}}),i?i.html=u:(w=b._analysis)==null||w.mapSet.push({mode:t,difficulty:e,html:u})},$u=t=>{ja().sort((n,o)=>n.order.output-o.order.output).forEach(n=>{n.input.adjustTime&&n.input.adjustTime(t)})},Eu=()=>{var n;let t=b._mapInfo;if(!t){console.error("could not analyse, missing map info");return}let e=it(t._beatsPerMinute);b._analysis||Ai(),(n=b._mapSet)==null||n.forEach(o=>{var i;return(i=b._analysis)==null?void 0:i.sps.push({mode:o._mode,difficulty:o._difficulty,sps:sa(o,e)})})},Aa=()=>{var t;(t=b._mapSet)==null||t.forEach(e=>Fa(e._mode,e._difficulty))},G="UI Tools: ",kt=document.querySelectorAll(".tools__select-mode"),Mt=document.querySelectorAll(".tools__select-difficulty"),Tu=document.querySelectorAll(".difficulty__label"),Oi=document.querySelector(".tools__note-content"),qi=document.querySelector(".tools__obstacle-content"),Ji=document.querySelector(".tools__event-content"),Ui=document.querySelector(".tools__other-content"),tt=document.querySelector(".tools__output-diff"),et=document.querySelector(".tools__output-general"),Oa=document.querySelector(".tools__apply-this"),qa=document.querySelector(".tools__apply-all");(!Oi||!qi||!Ji||!Ui)&&console.error(G+"missing content element");(!tt||!et)&&console.error(G+"missing output element");Oa&&qa?(Oa.addEventListener("click",ku),qa.addEventListener("click",Mu)):console.error(G+"missing apply element");kt.forEach(t=>t.addEventListener("change",xu));Mt.forEach(t=>t.addEventListener("change",Cu));const Lu=()=>{var e;if(!et)throw new Error(G+"output general is missing");const t=(e=b._analysis)==null?void 0:e.general;if(!t){et.textContent="ERROR: could not find analysis for general";return}if(!t.html){et.textContent="ERROR: could not find HTML for general";return}et.innerHTML="",t.html.forEach(n=>et.appendChild(n)),et.firstChild||(et.textContent="No issues found.")},Pe=(t,e)=>{var o;if(!t&&!e&&(t=kt[0].value,e=Mt[0].value),!t||!e)throw new Error(G+"something went wrong!");if(!tt)throw new Error(G+"output difficulty is missing");tt.innerHTML="";const n=(o=b._analysis)==null?void 0:o.mapSet.find(i=>i.difficulty===e&&i.mode===t);if(!n){tt.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!n.html){tt.textContent="ERROR: could not find HTML for "+t+" "+e;return}n.html.forEach(i=>tt.appendChild(i)),tt.firstChild||(tt.textContent="No issues found.")},Gi=t=>{Tu.forEach(e=>e.textContent=t)},Ja=t=>{if(!t)return;Mt.forEach(n=>{for(let o=n.options.length-1;o>=0;o--)n.remove(o)});let e=!0;t._difficultyBeatmaps.forEach(n=>{Mt.forEach(o=>{var r,a,l,s;const i=document.createElement("option");if(i.value=n._difficulty,i.textContent=ce[n._difficulty]+(((r=n._customData)==null?void 0:r._difficultyLabel)?" -- "+((a=n._customData)==null?void 0:a._difficultyLabel):""),e){const u=(l=b._mapSet)==null?void 0:l.find(d=>d._difficulty===n._difficulty&&d._mode===t._beatmapCharacteristicName);if(!u)throw new Error("missing _mapSetData");ta(u),Gi(((s=n._customData)==null?void 0:s._difficultyLabel)||ce[n._difficulty]),Pe(t._beatmapCharacteristicName,n._difficulty)}e=!1,o.add(i)})})},Ua=t=>{if(!t){kt.forEach(n=>Jn(n)),Mt.forEach(n=>Jn(n));return}let e=!0;t._difficultyBeatmapSets.forEach(n=>{kt.forEach(o=>{const i=document.createElement("option");i.value=n._beatmapCharacteristicName,i.textContent=Ve[n._beatmapCharacteristicName],o.add(i)}),e&&Ja(n),e=!1})},wu=()=>{const t=b._mapInfo;if(!t)throw new Error(G+"could not find map info");const e=it(t._beatsPerMinute);$u(e)};function xu(t){var o;const e=t.target;kt.forEach(i=>{i!==e&&(i.value=e.value)});const n=(o=b._mapInfo)==null?void 0:o._difficultyBeatmapSets.find(i=>i._beatmapCharacteristicName===e.value);Ja(n)}function Cu(t){var i,r,a,l;const e=t.target;Mt.forEach(s=>{s!==e&&(s.value=e.value)});const n=(i=b._mapInfo)==null?void 0:i._difficultyBeatmapSets.find(s=>s._beatmapCharacteristicName===kt.item(0).value);if(!n)throw new Error("aaaaaaaaaaaaaaaaaaa");const o=(r=b._mapSet)==null?void 0:r.find(s=>s._difficulty===e.value&&s._mode===n._beatmapCharacteristicName);o&&(ta(o),Gi(((l=(a=o._info)==null?void 0:a._customData)==null?void 0:l._difficultyLabel)||ce[e.value]),Pe(o._mode,o._difficulty))}function ku(){const t=kt[0].value,e=Mt[0].value;if(!t||!e)throw new Error(G+"mode/difficulty does not exist");$("info",`Re-analysing ${t} ${e}`,100),Fa(t,e),$("info",`Re-analysed ${t} ${e}`,100),Pe(t,e)}function Mu(){const t=kt[0].value,e=Mt[0].value;if(!t||!e)throw new Error(G+"mode/difficulty does not exist");$("info","Re-analysing all difficulties",100),Aa(),$("info","Re-analysed all difficulties",100),Pe(t,e)}const Su=()=>{if(!Oi||!qi||!Ji||!Ui){console.error(G+"could not find tools content");return}yu().sort((e,n)=>e.order.input-n.order.input).forEach(e=>{if(e.input.html)switch(e.type){case"note":{Oi.appendChild(e.input.html);break}case"obstacle":{qi.appendChild(e.input.html);break}case"event":{Ji.appendChild(e.input.html);break}case"other":{Ui.appendChild(e.input.html);break}case"general":{console.log(G+"ignoring general tool for "+e.name);break}default:console.error(G+"could not recognise type "+e.type+" for "+e.name)}})},Iu=()=>{et&&(et.innerHTML="No output."),tt&&(tt.innerHTML="No output.")},Du=()=>{Iu(),Gi("Difficulty Label"),Ua()},nt="UI Stats: ",f="stats__",ve=document.querySelector("#stats .accordion__collapsible"),Ru=(t,e)=>{const n=it(t._beatsPerMinute),o=oo(n,e._info._noteJumpMovementSpeed||io[e._difficulty],e._info._noteJumpStartBeatOffset),i=document.createElement("table");return i.className=f+"table",i.innerHTML=`<caption class="${f}table-caption">Map Settings:</caption>
    <tr>
    <th class="${f}table-header" colspan="2">Note Jump Speed</th>
    <td class="${f}table-element">${_(o.value,3)}</td>
    </tr>
    <tr>
    <th class="${f}table-header" colspan="2">Spawn Distance Modifier</th>
    <td class="${f}table-element">${_(o.offset,3)}</td>
    </tr>
    <tr>
    <th class="${f}table-header" colspan="2">Half Jump Duration</th>
    <td class="${f}table-element">${_(o.hjd,3)}</td>
    </tr>
    <tr>
    <th class="${f}table-header" colspan="2">Jump Distance</th>
    <td class="${f}table-element">${_(o.jd,3)}</td>
    </tr>
    <tr>
    <th class="${f}table-header" colspan="2">Reaction Time</th>
    <td class="${f}table-element">${_(o.reactTime*1e3)}ms</td>
    </tr>`,i},Bu=(t,e)=>{const n=it(t._beatsPerMinute),o=b._duration||0,i=n.toRealTime(Ye(e._data)),r=document.createElement("table");return r.className=f+"table",r.innerHTML=`<caption class="${f}table-caption">Note Per Seconds (NPS):</caption>
    <tr>
    <th class="${f}table-header" colspan="2">Overall</th>
    <td class="${f}table-element">${_(Cr(e._data._notes,o),2)}</td>
    </tr>
    <tr>
    <th class="${f}table-header" colspan="2">Mapped</th>
    <td class="${f}table-element">${_(Cr(e._data._notes,i),2)}</td>
    </tr>
    <tr>
    <th class="${f}table-header" rowspan="3">Peak</th>
    <th class="${f}table-header">16-beat</th>
    <td class="${f}table-element">${_(co(e._data._notes,16,n.value),2)}</td>
    </tr>
    <tr>
    <th class="${f}table-header">8-beat</th>
    <td class="${f}table-element">${_(co(e._data._notes,8,n.value),2)}</td>
    </tr>
    <tr>
    <th class="${f}table-header">4-beat</th>
    <td class="${f}table-element">${_(co(e._data._notes,4,n.value),2)}</td>
    </tr>`,r},Pu=(t,e)=>{const n=it(t._beatsPerMinute),o=sa(e,n),i=document.createElement("table");return i.className=f+"table",i.innerHTML=`<caption class="${f}table-caption">Swing Per Seconds (SPS):</caption>
    <tr>
    <th class="${f}table-header"></th>
    <th class="${f}table-header">Total</th>
    <th class="${f}table-header">Red</th>
    <th class="${f}table-header">Blue</th>
    </tr>
    <tr>
    <th class="${f}table-header">Overall</th>
    <td class="${f}table-element">${_(o.total.overall,2)}</td>
    <td class="${f}table-element">${_(o.red.overall,2)}</td>
    <td class="${f}table-element">${_(o.blue.overall,2)}</td>
    </tr>
    <tr>
    <th class="${f}table-header">Median</th>
    <td class="${f}table-element">${_(o.total.median,2)}</td>
    <td class="${f}table-element">${_(o.red.median,2)}</td>
    <td class="${f}table-element">${_(o.blue.median,2)}</td>
    </tr>
    <tr>
    <th class="${f}table-header">Peak</th>
    <td class="${f}table-element">${_(o.total.peak,2)}</td>
    <td class="${f}table-element">${_(o.red.peak,2)}</td>
    <td class="${f}table-element">${_(o.blue.peak,2)}</td>
    </tr>
    <tr>
    <th class="${f}table-header">Total</th>
    <td class="${f}table-element">${o.total.total}</td>
    <td class="${f}table-element">${o.red.total}</td>
    <td class="${f}table-element">${o.blue.total}</td>
    </tr>`,i},Hu=(t,e)=>{const n=xr(e._data._notes);let o=`<caption class="${f}table-caption">Notes: ${n.red.total+n.blue.total}<br>R/B Ratio: ${_(n.red.total/n.blue.total,2)}</caption>
    <tr>
    <th class="${f}table-header"></th>
    <th class="${f}table-header">Red</th>
    <th class="${f}table-header">Blue</th>
    <th class="${f}table-header">Bomb</th>
    </tr>
    <tr>
    <th class="${f}table-header">Total</th>
    <td class="${f}table-element">${n.red.total}</td>
    <td class="${f}table-element">${n.blue.total}</td>
    <td class="${f}table-element">${n.bomb.total}</td>
    </tr>`;(n.red.chroma||n.blue.chroma||n.bomb.chroma)&&(o+=`<tr>
        <th class="${f}table-header">Chroma</th>
        <td class="${f}table-element">${n.red.chroma}</td>
        <td class="${f}table-element">${n.blue.chroma}</td>
        <td class="${f}table-element">${n.bomb.chroma}</td>
        </tr>`),(n.red.noodleExtensions||n.blue.noodleExtensions||n.bomb.noodleExtensions)&&(o+=`<tr>
        <th class="${f}table-header">NE</th>
        <td class="${f}table-element">${n.red.noodleExtensions}</td>
        <td class="${f}table-element">${n.blue.noodleExtensions}</td>
        <td class="${f}table-element">${n.bomb.noodleExtensions}</td>
        </tr>`),(n.red.mappingExtensions||n.blue.mappingExtensions||n.bomb.mappingExtensions)&&(o+=`<tr>
        <th class="${f}table-header">ME</th>
        <td class="${f}table-element">${n.red.mappingExtensions}</td>
        <td class="${f}table-element">${n.blue.mappingExtensions}</td>
        <td class="${f}table-element">${n.bomb.mappingExtensions}</td>
        </tr>`);const i=document.createElement("table");return i.className=f+"table",i.innerHTML=o,i};function Nu(t){var s,u;const e=t.target,n=e.id.replace(`${f}table-select-placement-`,"").split("-"),o=n[0],i=n[1],r=(u=(s=b._mapSet)==null?void 0:s.find(d=>d._mode===o&&d._difficulty===i))==null?void 0:u._data._notes;if(!r){console.error(nt+"note could not be found");return}let a;switch(e.value){case"note":{a=r.filter(d=>I(d));break}case"red":{a=r.filter(d=>d._type===0);break}case"blue":{a=r.filter(d=>d._type===1);break}case"bomb":{a=r.filter(d=>d._type===3);break}default:a=r}const l=document.querySelector(`#${f}table-placement-${o}-${i}`);if(!l){console.error(nt+"table could not be found");return}l.innerHTML=Ga(a)}function Ga(t){const e=t.length||1;let n="";for(let o=2;o>=0;o--){n+="<tr>";for(let i=0;i<=3;i++)n+=`<td class="${f}table-element">${Pl(t,i,o)}</td>`;n+=`<td class="${f}table-element ${f}table--no-border">${_(Bl(t,o)/e*100,1)}%</td>
        </tr>`}return n+=`<tr>
    <td class="${f}table-element ${f}table--no-border">${_(We(t,0)/e*100,1)}%</td>
    <td class="${f}table-element ${f}table--no-border">${_(We(t,1)/e*100,1)}%</td>
    <td class="${f}table-element ${f}table--no-border">${_(We(t,2)/e*100,1)}%</td>
    <td class="${f}table-element ${f}table--no-border">${_(We(t,3)/e*100,1)}%</td>
    </tr>`,n}const ju=(t,e)=>{var r;const n=De(`${f}table-select-placement-${e._mode}-${e._difficulty}`,"Note Placement: ","caption",`${f}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Bomb",value:"bomb"});(r=n.querySelector("select"))==null||r.addEventListener("change",Nu);let o=`<tbody id="${f}table-placement-${e._mode}-${e._difficulty}">${Ga(e._data._notes)}</tbody>`;const i=document.createElement("table");return i.className=f+"table",i.innerHTML=o,i.prepend(n),i};function Fu(t){var s,u;const e=t.target,n=e.id.replace(`${f}table-select-angle-`,"").split("-"),o=n[0],i=n[1],r=(u=(s=b._mapSet)==null?void 0:s.find(d=>d._mode===o&&d._difficulty===i))==null?void 0:u._data._notes;if(!r){console.error(nt+"note could not be found");return}let a;switch(e.value){case"note":{a=r.filter(d=>I(d));break}case"red":{a=r.filter(d=>d._type===0);break}case"blue":{a=r.filter(d=>d._type===1);break}case"bomb":{a=r.filter(d=>d._type===3);break}default:a=r}const l=document.querySelector(`#${f}table-angle-${o}-${i}`);if(!l){console.error(nt+"table could not be found");return}l.innerHTML=Xa(a)}function Xa(t){const e=t.length||1,n=[4,0,5,2,8,3,6,1,7];let o="";for(let i=0;i<3;i++){o+="<tr>";for(let r=0;r<3;r++){let a=Hl(t,n[i*3+r]);o+=`<td class="${f}table-element">${a}<br>(${_(a/e*100,1)}%)</td>`}o+="</tr>"}return o}const Au=(t,e)=>{var r;const n=De(`${f}table-select-angle-${e._mode}-${e._difficulty}`,"Note Angle: ","caption",`${f}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Bomb",value:"bomb"});(r=n.querySelector("select"))==null||r.addEventListener("change",Fu);let o=`<tbody id="${f}table-angle-${e._mode}-${e._difficulty}">${Xa(e._data._notes)}</tbody>`;const i=document.createElement("table");return i.className=f+"table",i.innerHTML=o,i.prepend(n),i},Ou=(t,e)=>{const n=it(t._beatsPerMinute),o=xr(e._data._notes);let i=`<caption class="${f}table-caption">Note Information:</caption>
    <tr>
    <th class="${f}table-header" colspan="2">Max Score</th>
    <td class="${f}table-element">${cl(Yl(o.red.total+o.blue.total))}</td>
    </tr>
    <tr>
    <th class="${f}table-header" colspan="2">Effective BPM</th>
    <td class="${f}table-element">${_(us(e._data._notes,n),2)}</td>
    </tr>
    <tr>
    <th class="${f}table-header" colspan="2">Effective BPM (swing)</th>
    <td class="${f}table-element">${_(ms(e._data._notes,n),2)}</td>
    </tr>`,r=_(ds(e._data._notes,n)*1e3,1),a=_(ps(e._data._notes,n)*1e3,1);r&&a&&(i+=`
        <tr>
        <th class="${f}table-header" colspan="2">Min. Slider Speed</th>
        <td class="${f}table-element">${r}ms</td>
        </tr>
        <tr>
        <th class="${f}table-header" colspan="2">Max. Slider Speed</th>
        <td class="${f}table-element">${a}ms</td>
        </tr>`);const l=document.createElement("table");return l.className=f+"table",l.innerHTML=i,l},qu=(t,e)=>{const n=Vl(e._data._events);let o=0,i=0,r=0,a=0,l=`<caption class="${f}table-caption">Events: ${Object.values(n).reduce((u,{total:d})=>u+d,0)}</caption>`;for(const u in n)o+=n[u].chroma,i+=n[u].chromaOld,r+=n[u].noodleExtensions,a+=n[u].mappingExtensions,l+=`<tr>
        <th class="${f}table-header" colspan="2">${uo[u]}</th>
        <td class="${f}table-element">${n[u].total}</td>
        </tr>`;o&&(l+=`<tr>
        <th class="${f}table-header" colspan="2">Chroma</th>
        <td class="${f}table-element">${o}</td>
        </tr>`),i&&(l+=`<tr>
        <th class="${f}table-header" colspan="2">OG Chroma</th>
        <td class="${f}table-element">${i}</td>
        </tr>`),r&&(l+=`<tr>
        <th class="${f}table-header" colspan="2">Noodle Extensions</th>
        <td class="${f}table-element">${r}</td>
        </tr>`),a&&(l+=`<tr>
        <th class="${f}table-header" colspan="2">Mapping Extensions</th>
        <td class="${f}table-element">${a}</td>
        </tr>`);const s=document.createElement("table");return s.className=f+"table",s.innerHTML=l,s},Ju=(t,e)=>{const n=Tl(e._data._obstacles);let o=`<caption class="${f}table-caption">Obstacles: ${n.total}</caption>`;n.interactive&&(o+=`<tr>
        <th class="${f}table-header" colspan="2">Interactive</th>
        <td class="${f}table-element">${n.interactive}</td>
        </tr>`),n.crouch&&(o+=`<tr>
        <th class="${f}table-header" colspan="2">Crouch</th>
        <td class="${f}table-element">${n.crouch}</td>
        </tr>`),n.chroma&&(o+=`<tr>
        <th class="${f}table-header" colspan="2">Chroma</th>
        <td class="${f}table-element">${n.chroma}</td>
        </tr>`),n.noodleExtensions&&(o+=`<tr>
        <th class="${f}table-header" colspan="2">Noodle Extensions</th>
        <td class="${f}table-element">${n.noodleExtensions}</td>
        </tr>`),n.mappingExtensions&&(o+=`<tr>
        <th class="${f}table-header" colspan="2">Mapping Extensions</th>
        <td class="${f}table-element">${n.mappingExtensions}</td>
        </tr>`);const i=document.createElement("table");return i.className=f+"table",i.innerHTML=o,i},Uu=()=>{if(!ve){console.error(nt+"HTML stats does not exist");return}if(!b._mapInfo)throw new Error(nt+"map info could not be found in savedData");if(!b._mapSet)throw new Error(nt+"map data could not be found in savedData");const t=b._mapInfo;t._difficultyBeatmapSets.forEach(e=>{const n=document.createElement("div");n.className=f+"mode-"+e._beatmapCharacteristicName;const o=document.createElement("div");o.className=f+"title",o.textContent=Ve[e._beatmapCharacteristicName],n.appendChild(o),e._difficultyBeatmaps.forEach(i=>{var h,m,g;const r=(h=b._mapSet)==null?void 0:h.find(p=>p._mode===e._beatmapCharacteristicName&&p._difficulty===i._difficulty);if(!r)throw new Error(nt+"Could not find map data");const a=al(`${f}${e._beatmapCharacteristicName}-${i._difficulty}`,ce[i._difficulty]+(((m=i._customData)==null?void 0:m._difficultyLabel)?" -- "+((g=i._customData)==null?void 0:g._difficultyLabel):""),i._difficulty,!0),l=a.querySelector(".accordion__collapsible-flex"),s=a.querySelector(".accordion__button");if(!l||!s)throw new Error(nt+"something went wrong!");s.checked=E.onLoad.stats;const u=en("small","half"),d=en("small","half"),c=en("small","half");u.append(Ru(t,r)),u.append(document.createElement("br")),u.append(Bu(t,r)),u.append(document.createElement("br")),u.append(Pu(t,r)),d.append(Ou(t,r)),d.append(document.createElement("br")),d.append(ju(t,r)),d.append(document.createElement("br")),d.append(Au(t,r)),c.append(Hu(t,r)),c.append(document.createElement("br")),c.append(qu(t,r)),c.append(document.createElement("br")),c.append(Ju(t,r)),l.appendChild(u),l.appendChild(d),l.appendChild(c),n.appendChild(a)}),ve.appendChild(n)})},Gu=()=>{if(!ve){console.error(nt+"HTML stats does not exist");return}for(;ve.firstChild;)ve.removeChild(ve.firstChild)},Va=async t=>new Promise(function(e,n){const o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="json",o.timeout=5e3;let i=Date.now();o.onprogress=()=>{o.timeout+=Date.now()-i},o.onload=()=>{o.status===200&&e(o.response),o.status===404&&n("Error 404: Map does not exist"),o.status===403&&n("Error 403: Forbidden"),n(`Error ${o.status}`)},o.onerror=()=>{n("Error downloading")},o.ontimeout=()=>{n("Connection timeout")},o.send()}),Xu=async t=>{const e=`https://api.beatsaver.com/maps/id/${t}`,n=await Va(e);if(n==null?void 0:n.versions.length)return n.versions[n.versions.length-1].downloadURL;throw new Error("could not find map download link")},Vu=async t=>{const e=`https://api.beatsaver.com/maps/hash/${t}`,n=await Va(e);if(n==null?void 0:n.versions.length)return n.versions[n.versions.length-1].downloadURL;throw new Error("could not find map download link")},Xi=async t=>{let e;try{e=dr(t)}catch(n){$("info",n,0),console.error(n);return}try{at(!0),$("info","Requesting download from link",0),console.log(`downloading from ${e}`);let n=await zi("https://cors-anywhere.herokuapp.com/"+e);Yn(e),He(n)}catch(n){at(!1),$("error",n,100)}},Vi=async t=>{let e;try{e=pr(t)}catch(n){throw $("info",n,0),console.error(n),new Error(n)}try{at(!0),console.log(`fetching download URL from BeatSaver for map ID ${e}`),$("info","Fetching download URL from BeatSaver",0);const n=await Xu(e);console.log(`downloading from BeatSaver for map ID ${e}`),$("info","Requesting download from BeatSaver",0);const o=await zi(n);Yn("https://beatsaver.com/maps/"+e,e),He(o)}catch(n){at(!1),$("error",n,100),console.error(n)}},za=async t=>{let e;try{if(hr(t.trim()))e=t.trim();else throw new Error("invalid hash")}catch(n){throw $("info",n,0),console.error(n),new Error(n)}try{at(!0),console.log(`fetching download URL from BeatSaver for map hash ${e}`),$("info","Fetching download URL from BeatSaver",0);const n=await Vu(e);console.log(`downloading from BeatSaver for map hash ${e}`),$("info","Requesting download from BeatSaver",0);const o=await zi(n);He(o)}catch(n){at(!1),$("error",n,100),console.error(n)}},zi=async t=>new Promise(function(e,n){const o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.timeout=5e3;let i=Date.now();o.onprogress=r=>{o.timeout+=Date.now()-i,$("download",`Downloading map: ${_(r.loaded/1024/1024,1)}MB / ${_(r.total/1024/1024,1)}MB`,r.loaded/r.total*100)},o.onload=()=>{o.status===200&&e(o.response),o.status===404&&n("Error 404: Map/link does not exist"),o.status===403&&n("Error 403: Forbidden"),n(`Error ${o.status}`)},o.onerror=()=>{n("Error downloading")},o.ontimeout=()=>{n("Connection timeout")},o.send()}),He=async t=>{$("info","Extracting zip",0);let e=new sr;console.time("loading time");try{zn(!0),e=await sr.loadAsync(t),await zu(e)}catch(n){Pr(),at(!1),zn(!1),$("error",n,100),console.error(n)}console.timeEnd("loading time")},zu=async t=>{var n,o,i;$("info","Parsing map info...",0),console.log("parsing map info");const e=t.file("Info.dat")||t.file("info.dat");if(e){at(!0);let r=await e.async("string");b._mapInfo=await JSON.parse(r),Cl(b._mapInfo),ns(b._mapInfo),$("info","Loading image...",10.4375),console.log("loading cover image");let a=t.file(b._mapInfo._coverImageFilename);if(E.load.imageCover&&a){let u=await a.async("base64");_r("data:image;base64,"+u),gn.map.load.image=!0}else console.error(`${b._mapInfo._coverImageFilename} does not exists.`);if(b._contributors=[],(o=(n=b._mapInfo)==null?void 0:n._customData)==null?void 0:o._contributors)for(const u of b._mapInfo._customData._contributors)console.log("loading contributor image "+u._name),a=t.file(u._iconPath),E.load.imageContributor&&a?u._base64=await a.async("base64"):console.error(`${u._iconPath} does not exists.`),b._contributors.push(u);$("info","Loading audio...",20.875),console.log("loading audio");let l=t.file(b._mapInfo._songFilename);if(E.load.audio&&l){let u=!1;setTimeout(()=>{u||$("info","Loading audio... (this may take a while)",20.875)},1e4);let d=await l.async("arraybuffer");fl(d),await new AudioContext().decodeAudioData(d).then(h=>{u=!0;let m=h.duration;b._duration=m,Xe(m),gn.map.load.audio=!0}).catch(function(h){Xe(),console.error(h)})}else Xe(),console.error(`${b._mapInfo._songFilename} does not exist.`);$("info","Parsing difficulty...",70),b._mapSet=[];const s=b._mapInfo._difficultyBeatmapSets;for(let u=s.length-1;u>=0;u--){const d=s[u]._difficultyBeatmaps;if(d.length===0||!d){console.error("Empty difficulty set, removing..."),s.splice(u,1);continue}for(let c=0;c<d.length;c++){const h=d[c],m=t.file(h._beatmapFilename);if(m){console.log(`parsing ${s[u]._beatmapCharacteristicName} ${h._difficulty}`);let g=JSON.parse(await m.async("string")),p;try{p=kl(g)}catch(w){throw new Error(`${s[u]._beatmapCharacteristicName} ${h._difficulty} ${w}`)}(i=b._mapSet)==null||i.push({_mode:s[u]._beatmapCharacteristicName,_difficulty:h._difficulty,_info:h,_data:p,_environment:b._mapInfo._environmentName})}else if(console.error(`Missing ${h._beatmapFilename} file for ${s[u]._beatmapCharacteristicName} ${h._difficulty}, ignoring.`),s[u]._difficultyBeatmaps.splice(c,1),c--,s[u]._difficultyBeatmaps.length<1){console.error(`${s[u]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),s.splice(u,1);continue}}}wu(),$("info","Adding map difficulty stats...",80),console.log("adding map stats"),Uu(),Or(b._contributors),$("info","Analysing map...",85),console.log("analysing map"),Eu(),vu(),Lu(),$("info","Analysing difficulty...",90),Aa(),Ua(b._mapInfo),Pe(),at(!1),$("info","Map successfully loaded!")}else throw new Error("Couldn't find Info.dat")},$e="UI Intro: ",Ne=document.querySelector(".input__intro-url"),je=document.querySelector(".input__intro-id"),Fe=document.querySelector(".input__intro-hash"),Ya=document.querySelector(".input__search-button"),Ka=document.querySelector(".input__file"),Yi=document.querySelector(".input__file-zone");Ne?Ne.addEventListener("keydown",Ki):console.error($e+"URL input is missing");je?je.addEventListener("keydown",Ki):console.error($e+"ID input is missing");Fe?Fe.addEventListener("keydown",Ki):console.error($e+"Hash input is missing");Ya?Ya.addEventListener("click",Yu):console.error($e+"search button is missing");Ka?Ka.addEventListener("change",Ku):console.error($e+"file input is missing");Yi?(Yi.addEventListener("drop",Wu),Yi.addEventListener("dragover",Zu)):console.error($e+"file drop zone is missing");function Ki(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&Xi(e.value),e.classList.contains("input__intro-id")&&Vi(e.value))}function Yu(t){if(Ne&&Ne.value!==""){Xi(Ne.value);return}if(je&&je.value!==""){Vi(je.value);return}if(Fe&&Fe.value!==""){za(Fe.value);return}}function Ku(t){const e=t.target;$("info","Reading file input",0);const n=e.files?e.files[0]:null;try{if(n==null)throw $("info","No file input",0),new Error("No file input");if(n&&(n.name.substr(-4)===".zip"||n.name.substr(-4)===".bsl")){const o=new FileReader;o.readAsArrayBuffer(n),o.addEventListener("load",()=>{He(n)})}else throw new Error("Unsupported file format, please enter zip file")}catch(o){$("error",o,0),console.error(o)}}function Wu(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items&&t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(e),n.addEventListener("load",()=>{He(e)})}else throw new Error("Unsupported file format, please enter zip file")}}catch(e){$("error",e,0),console.error(e)}}function Zu(t){t.preventDefault(),t.stopPropagation()}const Qu=["Dark","Light","Monochrome"],tm=document.querySelector("body"),Wa=t=>{tm.className="theme-"+t.toLowerCase().replace(" ","")},ae="UI Settings: ",Ae=document.querySelector(".settings__theme"),Wi=document.querySelectorAll(".settings__load"),Fn=document.querySelector(".settings__sort"),Zi=document.querySelectorAll(".settings__show"),Qi=document.querySelectorAll(".settings__onload"),Za=document.querySelector(".settings__clear-button");Ae?(Ae.addEventListener("change",em),Qu.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,Ae.add(e)})):console.error(ae+"theme select is missing");Wi.length||console.error(ae+"empty load list, intentional or typo error?");Wi.forEach(t=>t.addEventListener("change",am));Fn?Fn.addEventListener("change",im):console.error(ae+"sort check is missing");Qi.length||console.error(ae+"empty onload list, intentional or typo error?");Qi.forEach(t=>t.addEventListener("change",sm));Zi.length||console.error(ae+"empty show list, intentional or typo error?");Zi.forEach(t=>t.addEventListener("change",nm));Za?Za.addEventListener("click",mm):console.error(ae+"clear button is missing");function em(t){const e=t.target;E.theme=e.options[e.options.selectedIndex].value,Wa(E.theme),E.save()}function nm(t){const e=t.target,n=e.id.replace("settings__show-","");E.show[n]=e.checked,E.save()}const om=(t,e)=>{Zi.forEach(n=>{n.id.endsWith(t)&&(n.checked=e)})};function im(t){const e=t.target;E.sorting=e.checked,E.save()}const rm=t=>{Fn&&(Fn.checked=t)};function am(t){const e=t.target,n=e.name;E.load[n]=e.checked,E.save()}const lm=(t,e)=>{Wi.forEach(n=>{n.name===t&&(n.checked=e)})};function sm(t){const e=t.target,n=e.name;E.onLoad[n]=e.checked,E.save()}const cm=(t,e)=>{Qi.forEach(n=>{n.name===t&&(n.checked=e)})},um=t=>{if(!Ae){console.error(ae+"input element is missing");return}Ae.value=t};function mm(){E.clear(),E.reset(),location.reload()}const dm=document.querySelectorAll(".input__reset-button");dm.forEach(t=>t.addEventListener("click",pm));function pm(){as(),bl(),is(),Du(),Gu(),Pr()}const hm=2,_m=3,fm=0,gm="Kival Evan#5480";class bm{constructor(){this._version=`v${hm}.${_m}.${fm}`,this._wm=gm}get value(){return this._version}get watermark(){return this._wm}}var Qa=new bm;const ym="UI Footer: ",tl=document.querySelectorAll(".link__watermark"),el=document.querySelectorAll(".link__version");(!tl.length||!el.length)&&console.error(ym+"missing part");const vm=t=>{tl.forEach(e=>e.textContent=t)},$m=t=>{el.forEach(e=>e.textContent=t)};var Em=function(){let t=!1;return function(){if(!t){t=!0,um(E.theme),vm(Qa.watermark),$m(Qa.value),Su();for(const e in E.load)lm(e,E.load[e]);rm(E.sorting);for(const e in E.show)ll(e,E.show[e]),om(e,E.show[e]);for(const e in E.onLoad)cm(e,E.onLoad[e]);Wa(E.theme),console.log("user interface initialised")}}}();const tr=new URL(location.href),nl=tr.searchParams.get("url"),ol=tr.searchParams.get("id"),er=tr.searchParams.get("hash");Em();nl?Xi(dr(decodeURI(nl))):ol?Vi(pr(decodeURI(ol))):er&&hr(decodeURI(er).trim())&&za(decodeURI(er).trim());
