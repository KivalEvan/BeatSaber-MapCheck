import{J as ar}from"./vendor.6089e67f.js";const nl=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}};nl();const ol="UI Accordion: ",Oe="accordion__";var An;(function(t){t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy"})(An||(An={}));const lr=document.querySelectorAll(".accordion__button");lr.length||console.error(ol+"empty accordion list, intentional or typo error?");const il=(t,e,n,o=!1)=>{const i=document.createElement("div");i.className="accordion";const r=document.createElement("input");r.className=Oe+"button",r.id=t,r.setAttribute("type","checkbox");const a=document.createElement("label");a.className=Oe+"label unselectable",a.htmlFor=t,a.textContent=e,n&&a.classList.add(An[n]);const l=document.createElement("div");return l.className=o?Oe+"collapsible-flex":Oe+"collapsible",l.id=t+"-content",i.appendChild(r),i.appendChild(a),i.appendChild(l),i},rl=(t,e)=>{lr.forEach(n=>{n.id.endsWith(t)&&(n.checked=e)})},A=t=>{if(!t)return"0:00";const e=Math.floor(t),n=e/60,o=n<0?`-${Math.ceil(n).toString()}`:Math.floor(n).toString(),i=Math.abs(e%60).toString().padStart(2,"0");return`${o}:${i}`},al=t=>{var n;if(!t)return"0:00.000";const e=((n=(t%1).toString().split(".")[1])==null?void 0:n.padEnd(3,"0").slice(0,3))||"000";return`${A(t)}.${e}`},ll=t=>t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),h=(t,e=0)=>Math.round(t*Math.pow(10,e))/Math.pow(10,e),On=t=>t*(180/Math.PI),se=t=>t*(Math.PI/180),sr=(t,e)=>{e<0&&(e=-e);let n=t%e;return n<0?n+e:n},cr=(t,e,n)=>Math.min(sr(t-e,n),sr(e-t,n)),qn=t=>{if(t.length===0)return 0;t.sort((n,o)=>n-o);const e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2},ur=t=>{let e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")},mr=t=>{let e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")},dr=t=>/[a-fA-F0-9]*/g.test(t),Jn=t=>{for(let e=t.options.length-1;e>=0;e--)t.remove(e)},D="UI Header: ",qe=document.querySelector(".intro"),Je=document.querySelector(".metadata"),ut=document.querySelector(".cover__link"),we=document.querySelector(".cover__image"),Un=document.querySelector(".metadata__song-name"),Gn=document.querySelector(".metadata__song-subname"),Vn=document.querySelector(".metadata__song-author"),Xn=document.querySelector(".metadata__song-bpm"),Ue=document.querySelector(".metadata__song-duration"),Ge=document.querySelector(".audio");(!qe||!Je)&&console.error(D+"header component is missing one of the two section");(!ut||!we)&&console.error(D+"cover component is missing");(!Un||!Gn||!Vn||!Xn||!Ue)&&console.error(D+"metadata component is missing one of the part");const zn=t=>{if(!qe||!Je){console.error(D+"could not switch header, one of the section is missing");return}t?qe.classList.add("hidden"):qe.classList.remove("hidden"),t?Je.classList.remove("hidden"):Je.classList.add("hidden")},pr=t=>{if(!we){console.error(D+"missing HTML element for cover image");return}we.src=t||"./img/unknown.jpg"},sl=()=>we?we.src:(console.error(D+"missing HTML element for cover image"),null),Kn=(t,e)=>{if(!ut){console.error(D+"missing HTML element for cover link");return}if(t==null&&e==null){ut.textContent="",ut.href="",ut.classList.add("disabled");return}t!=null&&(ut.textContent=e!=null?e:"Download Link",ut.href=t,ut.classList.remove("disabled"))},cl=t=>{if(!Un){console.error(D+"missing HTML element for song name");return}Un.textContent=t},ul=t=>{if(!Gn){console.error(D+"missing HTML element for song subname");return}Gn.textContent=t},ml=t=>{if(!Vn){console.error(D+"missing HTML element for song author");return}Vn.textContent=t},dl=(t,e,n)=>{if(!Xn){console.error(D+"missing HTML element for song bpm");return}let o=h(t,2).toString()+"BPM";Xn.textContent=o},Ve=t=>{if(!Ue){console.error(D+"missing HTML element for song duration");return}t?Ue.textContent=al(t):Ue.textContent="No audio"};let pl;const hl=async t=>{if(!Ge){console.error(D+"missing HTML element for audio");return}const e=new Blob([t],{type:"audio/ogg"});Ge.src=window.URL.createObjectURL(e)},_l=()=>{if(!Ge){console.error(D+"missing HTML element for audio");return}Ge.src="",window.URL.revokeObjectURL(pl)},fl=()=>{zn(!1),pr(null),Kn(),Ve(0),_l()};class gl{constructor(e,n=[],o=0){this._bpm=e,this._offset=o/1e3,this._bpmChange=this.getBPMChangeTime([...n])}get value(){return this._bpm}set value(e){this._bpm=e}get change(){return this._bpmChange}set change(e){this._bpmChange=this.getBPMChangeTime([...e])}get offset(){return this._offset*1e3}set offset(e){this._offset=e/1e3}getBPMChangeTime(e=[]){var i;let n;const o=[];for(let r=0;r<e.length;r++){const a={_BPM:(i=e[r]._BPM)!=null?i:e[r]._bpm,_time:e[r]._time,_beatsPerBar:e[r]._beatsPerBar,_metronomeOffset:e[r]._metronomeOffset,_newTime:0};n?a._newTime=Math.ceil((a._time-n._time)/this._bpm*n._BPM+n._newTime-.01):a._newTime=Math.ceil(a._time-this._offset*this._bpm/60-.01),o.push(a),n=a}return o}offsetBegone(e){return(this.toRealTime(e)-this._offset)*this._bpm/60}toRealTime(e){return e/this._bpm*60}toBeatTime(e){return e*this._bpm/60}adjustTime(e){for(let n=this._bpmChange.length-1;n>=0;n--)if(e>this._bpmChange[n]._time)return(e-this._bpmChange[n]._time)/this._bpm*this._bpmChange[n]._BPM+this._bpmChange[n]._newTime;return this.offsetBegone(e)}}const ot=(t,e,n)=>new gl(t,e,n),hr={Standard:"Standard",NoArrows:"No Arrows",OneSaber:"One Saber","360Degree":"360 Degree","90Degree":"90 Degree",Lightshow:"Lightshow",Lawless:"Lawless"};var Xe;(function(t){t[t.Standard=0]="Standard",t[t.NoArrows=1]="NoArrows",t[t.OneSaber=2]="OneSaber",t[t["360Degree"]=3]="360Degree",t[t["90Degree"]=4]="90Degree",t[t.Lightshow=5]="Lightshow",t[t.Lawless=6]="Lawless"})(Xe||(Xe={}));var Wn;(function(t){t._id="Ct",t._lookupMethod="Lm",t._duplicate="D",t._active="A",t._scale="S",t._position="P",t._localPosition="Lp",t._rotation="R",t._localRotation="Lr",t._lightID="Li",t._track="T"})(Wn||(Wn={}));var ce;(function(t){t.Easy="Easy",t.Normal="Normal",t.Hard="Hard",t.Expert="Expert",t.ExpertPlus="Expert+"})(ce||(ce={}));var Yn;(function(t){t[t.Easy=1]="Easy",t[t.Normal=3]="Normal",t[t.Hard=5]="Hard",t[t.Expert=7]="Expert",t[t.ExpertPlus=9]="ExpertPlus"})(Yn||(Yn={}));const bl={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_obstacleColor:"Obstacle Color"},yl={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",Origins:"Origins (Triangle)",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",GlassDesertEnvironment:"Glass Desert"},R={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",Origins:"The First",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",GlassDesertEnvironment:"Glass Desert"},B={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}},Zn={DefaultEnvironment:[0,1,2,3,4,5,8,9,12,13],OriginsEnvironment:[0,1,2,3,4,5,8,9,12,13],Origins:[0,1,2,3,4,5,8,9,12,13],TriangleEnvironment:[0,1,2,3,4,5,8,9,12,13],NiceEnvironment:[0,1,2,3,4,5,8,9,12,13],BigMirrorEnvironment:[0,1,2,3,4,5,8,9,12,13],DragonsEnvironment:[0,1,2,3,4,5,8,9,12,13],KDAEnvironment:[0,1,2,3,4,5,8,9,12,13],MonstercatEnvironment:[0,1,2,3,4,5,8,9,12,13],CrabRaveEnvironment:[0,1,2,3,4,5,8,9,12,13],PanicEnvironment:[0,1,2,3,4,5,8,9,12,13],RocketEnvironment:[0,1,2,3,4,5,8,9,12,13],GreenDayEnvironment:[0,1,2,3,4,5,8,9,12,13],GreenDayGrenadeEnvironment:[0,1,2,3,4,5,8,9,12,13],TimbalandEnvironment:[0,1,2,3,4,5,8,9,12,13],FitBeatEnvironment:[0,1,2,3,4,5,8,9,12,13],LinkinParkEnvironment:[0,1,2,3,4,5,8,9,12,13],BTSEnvironment:[0,1,2,3,4,5,8,9,12,13],KaleidoscopeEnvironment:[0,1,2,3,4,5,8,9,12,13],InterscopeEnvironment:[0,1,2,3,4,5,6,7,8,9,12,13,16,17],SkrillexEnvironment:[0,1,2,3,4,5,6,7,8,9,12,13],BillieEnvironment:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,17],HalloweenEnvironment:[0,1,2,3,4,5,8,9,12,13],GagaEnvironment:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,17],GlassDesertEnvironment:[0,1,2,3,4,5,8,9,12,13]},Qn=t=>t._width>=2||t._lineIndex===1||t._lineIndex===2,vl=t=>t._type===1&&(t._width>2||t._width===2&&t._lineIndex===1),w=(t,e,n=0)=>t._time+t._duration>e._time+e._duration+n,El=t=>{var e;return Array.isArray((e=t._customData)==null?void 0:e._color)},_r=t=>{var e,n,o,i,r,a,l,s,u,p;return Array.isArray((e=t._customData)==null?void 0:e._animation)||typeof((n=t._customData)==null?void 0:n._fake)=="boolean"||typeof((o=t._customData)==null?void 0:o._interactable)=="boolean"||Array.isArray((i=t._customData)==null?void 0:i._localRotation)||typeof((r=t._customData)==null?void 0:r._noteJumpMovementSpeed)=="number"||typeof((a=t._customData)==null?void 0:a._noteJumpStartBeatOffset)=="number"||Array.isArray((l=t._customData)==null?void 0:l._position)||Array.isArray((s=t._customData)==null?void 0:s._rotation)||Array.isArray((u=t._customData)==null?void 0:u._scale)||typeof((p=t._customData)==null?void 0:p._track)=="string"},to=t=>t._width>=1e3||t._type>=1e3||t._lineIndex>3||t._lineIndex<0,$l=t=>!to(t)&&t._width>0&&t._width<=4,wl=t=>{const e={total:0,interactive:0,crouch:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let n=t.length-1;n>=0;n--)e.total++,Qn(t[n])&&e.interactive++,vl(t[n])&&e.crouch++,El(t[n])&&e.chroma++,_r(t[n])&&e.noodleExtensions++,to(t[n])&&e.mappingExtensions++;return e},Tl=t=>{for(let e=0,n=t.length;e<n;e++)if(Qn(t[e]))return t[e]._time;return Number.MAX_VALUE},Cl=t=>{let e=0;for(let n=t.length-1;n>=0;n--)Qn(t[n])&&(e=Math.max(e,t[n]._time+t[n]._duration));return e},fr=t=>{const{_notes:e,_obstacles:n}=t;let o=Number.MAX_VALUE;e.length>0&&(o=e[0]._time);const i=Tl(n);return Math.min(o,i)},ze=t=>{const{_notes:e,_obstacles:n}=t;let o=0;e.length>0&&(o=e[e.length-1]._time);const i=Cl(n);return Math.max(o,i)},Te=class{constructor(t,e=10,n=0){this._bpm=t,this._njs=e,this._sdm=n,this.update()}set value(t){this._njs=t,this.update()}get value(){return this._njs}set offset(t){this._sdm=t,this.update()}get offset(){return this._sdm}get hjd(){return this._hjd}get hjdMin(){return Te.HJD_MIN}get reactTime(){return this._reactionTime}get jd(){return this._jd}get jdMin(){return this._jdMin}update(){this._hjd=this.calcHalfJumpDuration(),this._jd=this.calcJumpDistance(),this._jdMin=this.calcJumpDistance(Te.HJD_MIN),this._reactionTime=this.calcReactionTimeFromHJD()}calcHalfJumpDurationRaw(){const t=18,e=this._njs*this._njs/this._njs,n=60/this._bpm.value;let o=Te.HJD_START;for(;e*n*o>t;)o/=2;return o<1&&(o=1),o}calcHalfJumpDuration(t=this.offset){return Math.max(this.calcHalfJumpDurationRaw()+t,Te.HJD_MIN)}calcHalfJumpDurationFromJD(t=this.calcJumpDistance()){return t/(60/this._bpm.value*this._njs*2)}calcHalfJumpDurationFromRT(t=this.calcReactionTimeFromHJD()){return t/(60/this._bpm.value)}calcJumpDistance(t=this.calcHalfJumpDuration()){return this._njs*(60/this._bpm.value)*t*2}calcJumpDistanceOptimalHigh(){return 18*(1/1.07)**this._njs+18}calcJumpDistanceOptimalLow(){return-(18/(this._njs+1))+18}calcReactionTimeFromJD(t=this.calcJumpDistance()){return t/(2*this._njs)}calcReactionTimeFromHJD(t=this.calcHalfJumpDuration()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let eo=Te;eo.HJD_START=4;eo.HJD_MIN=.25;const no=(t,e=10,n=0)=>new eo(t,e,n);var oo;(function(t){t[t.ExpertPlus=16]="ExpertPlus",t[t.Expert=12]="Expert",t[t.Hard=10]="Hard",t[t.Normal=10]="Normal",t[t.Easy=10]="Easy"})(oo||(oo={}));var io;(function(t){t._childrenTracks="Ct",t._color="C",t._definitePosition="Dp",t._dissolve="D",t._dissolveArrow="Da",t._duration="Dur",t._easing="E",t._interactable="I",t._localRotation="Lr",t._parentTrack="Pt",t._position="P",t._rotation="R",t._scale="S",t._time="T",t._track="Tr"})(io||(io={}));const gr={info:[2,0,0],difficulty:[2,5,0]},br=(t,e)=>{const n=Ll(t);for(const o in n){if(n[o]<gr[e][o])return"old";if(n[o]>gr[e][o])return"new"}return"current"},Ll=t=>t.replace("v","").split(".").map(e=>parseInt(e));var yr;(function(t){t.audio="Audio",t.imageCover="Cover Image",t.imageContributor="Contributor Image"})(yr||(yr={}));var vr;(function(t){t.info="Information",t.tools="Tools",t.stats="Stats",t.settings="Settings"})(vr||(vr={}));const Er={_load:{audio:!0,imageCover:!0,imageContributor:!0},_sorting:!0,_beatNumbering:"beattime",_rounding:3,_theme:"Dark",_onLoad:{stats:!1},_show:{info:!1,tools:!1,stats:!1,settings:!1}};class xl{constructor(){this._property=JSON.parse(JSON.stringify(Er)),this.stringify=()=>JSON.stringify({_property:this._property}),this.init=()=>{var n;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const o=JSON.parse(e);this._property=(n=o._property)!=null?n:this._property,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this._property=JSON.parse(JSON.stringify(Er))},this.init()}get load(){return this._property._load}get sorting(){return this._property._sorting}set sorting(e){this._property._sorting=e}get beatNumbering(){return this._property._beatNumbering}set beatNumbering(e){this._property._beatNumbering=e}get rounding(){return this._property._rounding}set rounding(e){this._property._rounding=e}get theme(){return this._property._theme}set theme(e){this._property._theme=e}get onLoad(){return this._property._onLoad}get show(){return this._property._show}}var C=new xl;const kl=t=>(C.sorting&&(t._difficultyBeatmapSets.sort((e,n)=>Xe[e._beatmapCharacteristicName]-Xe[n._beatmapCharacteristicName]),t._difficultyBeatmapSets.forEach(e=>{let n=0;e._difficultyBeatmaps.forEach(o=>{o._difficultyRank-n<=0&&console.error(o._difficulty+" may be unordered"),Yn[o._difficulty]!==o._difficultyRank&&console.error(o._difficulty+" has invalid rank"),n=o._difficultyRank}),e._difficultyBeatmaps.sort((o,i)=>i._difficultyRank-o._difficultyRank)})),t),Ml=t=>{const{_version:e,_notes:n,_obstacles:o,_events:i,_waypoints:r}=t;return e||(console.error("missing version, applying 2.0.0"),t._version="2.0.0"),n.forEach(a=>{for(const l in a)if(a[l]===null)throw new Error("contain null value in _notes object");if(typeof a._time=="undefined")throw new Error("missing _time in _notes object");if(typeof a._time!="number")throw new Error("invalid type _time in _notes object");if(typeof a._type=="undefined")throw new Error(`missing _type at ${a._time} in _notes object`);if(typeof a._type!="number")throw new Error(`invalid type _type at ${a._time} in _notes object`);if(typeof a._cutDirection=="undefined")throw new Error(`missing _cutDirection at ${a._time} in _notes object`);if(typeof a._cutDirection!="number")throw new Error(`invalid type _cutDirection at ${a._time} in _notes object`);if(typeof a._lineIndex=="undefined")throw new Error(`missing _lineIndex at ${a._time} in _notes object`);if(typeof a._lineIndex!="number")throw new Error(`invalid type _lineIndex at ${a._time} in _notes object`);if(typeof a._lineLayer=="undefined")throw new Error(`missing _lineLayer at ${a._time} in _notes object`);if(typeof a._lineLayer!="number")throw new Error(`invalid type _lineLayer at ${a._time} in _notes object`)}),o.forEach(a=>{for(const l in a)if(a[l]===null)throw new Error("contain null value in _obstacles object");if(typeof a._time=="undefined")throw new Error("missing _time in _obstacles object");if(typeof a._time!="number")throw new Error("invalid type _time in _obstacles object");if(typeof a._type=="undefined")throw new Error(`missing _type at ${a._time} in _obstacles object`);if(typeof a._type!="number")throw new Error(`invalid type _type at ${a._time} in _obstacles object`);if(typeof a._duration=="undefined")throw new Error(`missing _duration at ${a._time} in _obstacles object`);if(typeof a._duration!="number")throw new Error(`invalid type _duration at ${a._time} in _obstacles object`);if(typeof a._lineIndex=="undefined")throw new Error(`missing _lineIndex at ${a._time} in _obstacles object`);if(typeof a._lineIndex!="number")throw new Error(`invalid type _lineIndex at ${a._time} in _obstacles object`);if(typeof a._width=="undefined")throw new Error(`missing _width at ${a._time} in _obstacles object`);if(typeof a._width!="number")throw new Error(`invalid type _width at ${a._time} in _obstacles object`)}),i.forEach(a=>{for(const l in a)if(a[l]===null)throw new Error("contain null value in _events object");if(typeof a._time=="undefined")throw new Error("missing _time in _events object");if(typeof a._time!="number")throw new Error("invalid type _time in _events object");if(typeof a._type=="undefined")throw new Error(`missing _type at ${a._time} in _events object`);if(typeof a._type!="number")throw new Error(`invalid type _type at ${a._time} in _events object`);if(typeof a._value=="undefined")throw new Error(`missing _value at ${a._time} in _events object`);if(typeof a._value!="number")throw new Error(`invalid type _value at ${a._time} in _events object`);if(br(e,"difficulty")==="old")a._floatValue=1;else{if(typeof a._floatValue=="undefined")throw new Error(`missing _floatValue at ${a._time} in _events object`);if(typeof a._floatValue!="number")throw new Error(`invalid type _floatValue at ${a._time} in _events object`)}}),r==null||r.forEach(a=>{for(const l in a)if(a[l]===null)throw new Error("contain null value in _waypoints object")}),C.sorting&&(n.sort((a,l)=>a._time-l._time),o.sort((a,l)=>a._time-l._time),i.sort((a,l)=>a._time-l._time),r==null||r.sort((a,l)=>a._time-l._time)),t},it=[180,0,270,90,225,135,315,45,0],Sl=[1,0,3,2,7,6,5,4,8],mt={0:[0,1],1:[0,-1],2:[-1,0],3:[1,0],4:[-1,1],5:[1,1],6:[-1,-1],7:[1,-1],8:[0,0]},S=t=>t._type===0||t._type===1,Dl=t=>t._type===3,Y=t=>{var e;return((e=t._customData)==null?void 0:e._position)?[t._customData._position[0],t._customData._position[1]]:[(t._lineIndex<=-1e3||t._lineIndex>=1e3?t._lineIndex/1e3:t._lineIndex)-2,t._lineLayer<=-1e3||t._lineLayer>=1e3?t._lineLayer/1e3:t._lineLayer]},P=t=>{var e;return((e=t._customData)==null?void 0:e._cutDirection)?t._customData._cutDirection>0?t._customData._cutDirection%360:360+t._customData._cutDirection%360:t._cutDirection>=1e3?Math.abs(t._cutDirection%1e3%360-360):it[t._cutDirection]||0},dt=(t,e)=>{const[n,o]=Y(t),[i,r]=Y(e);return Math.sqrt(Math.pow(i-n,2)+Math.pow(r-o,2))},ue=(t,e)=>{const[n]=Y(t),[o]=Y(e),i=n-o;return i>-.001&&i<.001},me=(t,e)=>{const[n,o]=Y(t),[i,r]=Y(e),a=o-r;return a>-.001&&a<.001},Ke=(t,e)=>{const[n,o]=Y(t),[i,r]=Y(e),a=Math.abs(n-i),l=Math.abs(o-r);return a===l},We=(t,e,n=.5)=>dt(t,e)<=n,Il=(t,e,n)=>{for(let o=n,i=e.length;o<i;o++){if(e[o]._time<t._time+.01&&e[o]._type!==t._type)return!0;if(e[o]._time>t._time+.01)return!1}return!1},$r=(t,e)=>dt(t,e)>1.8,ro=(t,e)=>$r(t,e)&&!Ke(t,e)&&!me(t,e)&&!ue(t,e),ao=(t,e,n,o=!1)=>{const[i,r]=Y(t),[a,l]=Y(e),s=P(t),u=P(e),p=o?540:360;let c=!1;if(t._cutDirection!==8){const m=(On(Math.atan2(r-l,i-a))+450)%360;for(const[f,d,E]of n){const y=E!=null?E:0,v=(s+p-f+y)%360,$=(s+p+f+y)%360;if(c=d>=Math.sqrt(Math.pow(i-a,2)+Math.pow(r-l,2))&&(v<$&&v<=m&&m<=$||v>=$&&(m<=$||m>=v))||c,c)break}}let g=!1;if(e._cutDirection!==8){const m=(On(Math.atan2(l-r,a-i))+450)%360;for(const[f,d,E]of n){const y=E!=null?E:0,v=(u+p-f+y)%360,$=(u+p+f+y)%360;if(g=d>=Math.sqrt(Math.pow(i-a,2)+Math.pow(r-l,2))&&(v<$&&v<=m&&m<=$||v>=$&&(m<=$||m>=v))||g,g)break}}return[c,g]},wr=(t,e,n)=>t._cutDirection===8&&e._cutDirection===8&&n!==8&&(t._lineIndex>e._lineIndex&&(n===5||n===3||n===7)||t._lineIndex<e._lineIndex&&(n===6||n===2||n===4)||t._lineLayer>e._lineLayer&&(n===4||n===0||n===5)||t._lineLayer<e._lineLayer&&(n===6||n===1||n===7))||t._lineIndex>e._lineIndex&&(t._cutDirection===5||t._cutDirection===3||t._cutDirection===7||(e._cutDirection===5||e._cutDirection===3||e._cutDirection===7)&&t._cutDirection===8)||t._lineIndex<e._lineIndex&&(t._cutDirection===6||t._cutDirection===2||t._cutDirection===4||(e._cutDirection===6||e._cutDirection===2||e._cutDirection===4)&&t._cutDirection===8)||t._lineLayer>e._lineLayer&&(t._cutDirection===4||t._cutDirection===0||t._cutDirection===5||(e._cutDirection===4||e._cutDirection===0||e._cutDirection===5)&&t._cutDirection===8)||t._lineLayer<e._lineLayer&&(t._cutDirection===6||t._cutDirection===1||t._cutDirection===7||(e._cutDirection===6||e._cutDirection===1||e._cutDirection===7)&&t._cutDirection===8),Tr=(t,e)=>{if(wr(t,e,8))return t._cutDirection===8?e._cutDirection:t._cutDirection;if(t._cutDirection!==8)return t._cutDirection;if(t._time>e._time){if(t._lineIndex>e._lineIndex&&me(t,e))return 3;if(t._lineIndex<e._lineIndex&&me(t,e))return 2;if(t._lineLayer>e._lineLayer){if(ue(t,e))return 0;if(t._lineIndex>e._lineIndex)return 5;if(t._lineIndex<e._lineIndex)return 4}if(t._lineLayer<e._lineLayer){if(ue(t,e))return 1;if(t._lineIndex>e._lineIndex)return 7;if(t._lineIndex<e._lineIndex)return 6}}return 8},Rl=t=>{var e,n,o,i,r,a,l,s,u,p,c,g,m;return Array.isArray((e=t._customData)==null?void 0:e._animation)||typeof((n=t._customData)==null?void 0:n._cutDirection)=="number"||typeof((o=t._customData)==null?void 0:o._disableNoteGravity)=="boolean"||typeof((i=t._customData)==null?void 0:i._disableNoteLook)=="boolean"||typeof((r=t._customData)==null?void 0:r._fake)=="boolean"||Array.isArray((a=t._customData)==null?void 0:a._flip)||typeof((l=t._customData)==null?void 0:l._interactable)=="boolean"||Array.isArray((s=t._customData)==null?void 0:s._localRotation)||typeof((u=t._customData)==null?void 0:u._noteJumpMovementSpeed)=="number"||typeof((p=t._customData)==null?void 0:p._noteJumpStartBeatOffset)=="number"||Array.isArray((c=t._customData)==null?void 0:c._position)||Array.isArray((g=t._customData)==null?void 0:g._rotation)||typeof((m=t._customData)==null?void 0:m._track)=="string"},Cr=t=>t._cutDirection>=1e3||t._lineIndex>3||t._lineIndex<0||t._lineLayer>2||t._lineLayer<0,Bl=t=>t._cutDirection>=0&&t._cutDirection<=8,Pl=t=>!Cr(t)&&Bl(t),Lr=t=>{var n,o,i,r,a,l;const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},bomb:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let s=t.length-1;s>=0;s--)t[s]._type===0?(e.red.total++,(((n=t[s]._customData)==null?void 0:n._color)||((o=t[s]._customData)==null?void 0:o._disableSpawnEffect))&&e.red.chroma++):t[s]._type===1?(e.blue.total++,(((i=t[s]._customData)==null?void 0:i._color)||((r=t[s]._customData)==null?void 0:r._disableSpawnEffect))&&e.blue.chroma++):t[s]._type===3&&(e.bomb.total++,(((a=t[s]._customData)==null?void 0:a._color)||((l=t[s]._customData)==null?void 0:l._disableSpawnEffect))&&e.bomb.chroma++);return e},Ye=(t,e)=>t.filter(n=>n._lineIndex===e).length,Hl=(t,e)=>t.filter(n=>n._lineLayer===e).length,Nl=(t,e,n)=>t.filter(o=>o._lineIndex===e&&o._lineLayer===n).length,jl=(t,e)=>t.filter(n=>n._cutDirection===e).length,xr=(t,e)=>e?t.filter(n=>S(n)).length/e:0,lo=(t,e,n)=>{const o=t.filter(a=>a._type===0||a._type===1);let i=0,r=0;for(let a=0;a<o.length;a++){for(;o[a]._time-o[r]._time>e;)r++;i=Math.max(i,(a-r+1)/(e/n*60))}return i},Ce=(t,e,n,o)=>{let i,r;if(t===null||e===null)return!1;if(typeof t=="number")i=t;else{if(t._cutDirection===8)return!1;i=P(t)}if(typeof e=="number")r=e;else{if(e._cutDirection===8)return!1;r=P(e)}return o?cr(i,r,360)<=n:cr(i,r,360)>=n};var so;(function(t){t[t["Back Lasers"]=0]="Back Lasers",t[t["Ring Lights"]=1]="Ring Lights",t[t["Left Lasers"]=2]="Left Lasers",t[t["Right Lasers"]=3]="Right Lasers",t[t["Center Lights"]=4]="Center Lights",t[t["Light Boost"]=5]="Light Boost",t[t["Extra Left Lights"]=6]="Extra Left Lights",t[t["Extra Right Lights"]=7]="Extra Right Lights",t[t["Ring Rotation"]=8]="Ring Rotation",t[t["Ring Zoom"]=9]="Ring Zoom",t[t["Extra Left Lasers"]=10]="Extra Left Lasers",t[t["Extra Right Lasers"]=11]="Extra Right Lasers",t[t["Left Laser Rotation"]=12]="Left Laser Rotation",t[t["Right Laser Rotation"]=13]="Right Laser Rotation",t[t["Early Lane Rotation"]=14]="Early Lane Rotation",t[t["Late Lane Rotation"]=15]="Late Lane Rotation",t[t["Lower Hydraulic"]=16]="Lower Hydraulic",t[t["Raise Hydraulic"]=17]="Raise Hydraulic",t[t["BPM Change"]=100]="BPM Change"})(so||(so={}));const Fl=t=>t._value===0,Al=t=>t._value===1||t._value===5,Ol=t=>t._value===2||t._value===6,ql=t=>t._value===3||t._value===7,kr=t=>t._type>=0&&t._type<=17||t._type===100,Ze=t=>t._type>=0&&t._type<=11&&!Ul(t)&&!Jl(t),Jl=t=>t._type===5,Ul=t=>t._type===8||t._type===9,Mr=t=>t._type===12||t._type===13,Gl=t=>{var e,n,o,i,r,a,l,s,u,p,c,g,m,f,d,E,y,v,$,F,nt;return Ze(t)?Array.isArray((e=t._customData)==null?void 0:e._color)||typeof((n=t._customData)==null?void 0:n._lightID)=="number"||Array.isArray((o=t._customData)==null?void 0:o._lightID)||typeof((i=t._customData)==null?void 0:i._propID)=="number"||typeof((r=t._customData)==null?void 0:r._lightGradient)=="object":t._type===8?typeof((a=t._customData)==null?void 0:a._nameFilter)=="string"||typeof((l=t._customData)==null?void 0:l._reset)=="boolean"||typeof((s=t._customData)==null?void 0:s._rotation)=="number"||typeof((u=t._customData)==null?void 0:u._step)=="number"||typeof((p=t._customData)==null?void 0:p._prop)=="number"||typeof((c=t._customData)==null?void 0:c._speed)=="number"||typeof((g=t._customData)==null?void 0:g._direction)=="number"||typeof((m=t._customData)==null?void 0:m._counterSpin)=="boolean"||typeof((f=t._customData)==null?void 0:f._stepMult)=="number"||typeof((d=t._customData)==null?void 0:d._propMult)=="number"||typeof((E=t._customData)==null?void 0:E._speedMult)=="number":t._type===9?typeof((y=t._customData)==null?void 0:y._step)=="number":Mr(t)?typeof((v=t._customData)==null?void 0:v._lockPosition)=="boolean"||typeof(($=t._customData)==null?void 0:$._speed)=="number"||typeof((F=t._customData)==null?void 0:F._preciseSpeed)=="number"||typeof((nt=t._customData)==null?void 0:nt._direction)=="number":!1},Sr=t=>t._value>=2e9,Vl=t=>{var e;return(t._type===14||t._type===15)&&typeof((e=t._customData)==null?void 0:e._rotation)=="number"},Xl=t=>(t._type===14||t._type===15)&&t._value>=1e3&&t._value<=1720,zl=t=>kr(t)&&t._value>=0&&!(!Mr(t)&&t._value>8&&!Sr(t)),Kl=(t,e="DefaultEnvironment")=>{var i;const n=(i=Zn[e])!=null?i:[0,1,2,3,4,8,9,12,13],o={};for(let r=n.length-1;r>=0;r--)o[n[r]]={total:0,chroma:0,chromaOld:0,noodleExtensions:0,mappingExtensions:0};for(let r=t.length-1;r>=0;r--)kr(t[r])&&(o[t[r]._type]||(o[t[r]._type]={total:0,chroma:0,chromaOld:0,noodleExtensions:0,mappingExtensions:0}),o[t[r]._type].total++,Gl(t[r])&&o[t[r]._type].chroma++,Sr(t[r])&&o[t[r]._type].chromaOld++,Vl(t[r])&&o[t[r]._type].noodleExtensions++,Xl(t[r])&&o[t[r]._type].mappingExtensions++);return o},Wl=115,Yl=t=>{let e=0,n=1;for(let o=0;o<t;o++)n<8&&o===-3+n*4&&(n*=2),e+=Wl*n;return e},Qe=t=>[t.r,t.g,t.b],tn=t=>{const e=t.toString(16);return e.length===1?"0"+e:e},Zl=t=>t>1&&!(t<0)?255:h(t*255),k=t=>{if(!t)return null;const e={r:0,g:0,b:0};for(const n in t){const o=t[n];o!==void 0&&(e[n]=Zl(o))}return`#${tn(e.r)}${tn(e.g)}${tn(e.b)}${e.a?tn(e.a):""}`},Dr=t=>{let e=t[0],n=t[1],o=t[2],i,r,a;return e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,i=(e*.4124+n*.3576+o*.1805)/.95047,r=(e*.2126+n*.7152+o*.0722)/1,a=(e*.0193+n*.1192+o*.9505)/1.08883,i=i>.008856?Math.pow(i,1/3):7.787*i+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,[116*r-16,500*(i-r),200*(r-a)]},Ir=(t,e)=>{let n=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(n=0),t<0&&(n=180),t>0&&e<0&&(n=360),On(Math.atan(e/t))+n)},co=(t,e)=>{const[n,o,i]=Dr(t),[r,a,l]=Dr(e),s=1,u=1,p=1;let c,g,m,f,d,E,y,v,$,F,nt,tr,er,nr,or,ir,rr,$e,le,V;return c=Math.sqrt(o*o+i*i),g=Math.sqrt(a*a+l*l),m=(c+g)/2,d=.5*(1-Math.sqrt((m^7)/((m^7)+(25^7)))),$=(1+d)*o,c=Math.sqrt($*$+i*i),E=Ir($,i),$=(1+d)*a,g=Math.sqrt($*$+l*l),y=Ir($,l),$e=r-n,le=g-c,c*g==0?V=0:($=h(y-E,12),Math.abs($)<=180?V=y-E:$>180?V=y-E-360:V=y-E+360),V=2*Math.sqrt(c*g)*Math.sin(se(V/2)),F=(n+r)/2,f=(c+g)/2,c*g==0?v=E+y:($=Math.abs(h(E-y,12)),$>180?y+E<360?v=E+y+360:v=E+y-360:v=E+y,v/=2),nt=1-.17*Math.cos(se(v-30))+.24*Math.cos(se(2*v))+.32*Math.cos(se(3*v+6))-.2*Math.cos(se(4*v-63)),or=30*Math.exp(-((v-275)/25)*((v-275)/25)),ir=2*Math.sqrt((f^7)/((f^7)+(25^7))),tr=1+.015*((F-50)*(F-50))/Math.sqrt(20+(F-50)*(F-50)),er=1+.045*f,nr=1+.015*f*nt,rr=-Math.sin(se(2*or))*ir,$e=$e/(s*tr),le=le/(u*er),V=V/(p*nr),Math.sqrt($e*$e+le*le+V*V+rr*le*V)};var uo;(function(t){t.tiny="panel--tiny",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t.max="panel--max"})(uo||(uo={}));var mo;(function(t){t.none="",t.normal="panel--offset",t.half="panel--offset-half"})(mo||(mo={}));const en=(t,e,n,o)=>{const i=document.createElement("div");return i.className=`panel ${uo[t]}`,e&&e!=="none"&&i.classList.add(mo[e]),n&&i.classList.add("panel--flex"+o?"-column":""),i},b={},Rr=()=>{for(const t in b)delete b[t]},x="UI Info: ",nn=document.querySelector(".info__level-author"),on=document.querySelector(".info__environment"),Le=document.querySelector(".info__editors"),xe=document.querySelector(".info__contributors"),ke=document.querySelector(".info__contributors-select"),Br=document.querySelector(".info__contributors-image"),po=document.querySelector(".info__contributors-name"),ho=document.querySelector(".info__contributors-role"),rn=document.querySelector(".info__version"),an=document.querySelector(".info__time-spend"),ln=document.querySelector(".info__custom-color"),sn=document.querySelector(".info__requirements"),cn=document.querySelector(".info__suggestions"),un=document.querySelector(".info__information"),mn=document.querySelector(".info__warnings"),dn=document.querySelector(".info__bookmarks"),pn=document.querySelector(".info__bpm-changes"),hn=document.querySelector(".info__environment-enhancement"),_n=document.querySelector(".info__point-definitions"),fn=document.querySelector(".info__custom-events");(!nn||!on||!Le)&&console.error(x+"info component is missing part");(!xe||!po||!ho)&&console.error(x+"contributors component is missing part");ke?ke.addEventListener("change",os):console.error(x+"contributors select is missing");(!rn||!an||!ln||!sn||!cn||!un||!mn||!dn||!pn||!hn||!_n||!fn)&&console.error(x+"table info component is missing part");const Pr=t=>{if(!nn){console.error(x+"missing HTML element for level author");return}if(!t){nn.textContent="";return}nn.textContent="Mapped by "+t},Hr=t=>{if(!on){console.error(x+"missing HTML element for environment");return}if(!t){on.textContent="";return}on.textContent=(yl[t]||"Unknown")+" Environment"},Nr=t=>{if(!Le){console.error(x+"missing HTML element for editor");return}if(!t||!t._lastEditedBy){Le.classList.add("hidden");return}Le.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let n="Last edited on "+e;if(t[e]){const o=t[e];n+=" v"+o.version}Le.textContent=n},Ql=t=>{if(!Br){console.error(x+"missing HTML element for contributor image");return}Br.src=t||"./img/unknown.jpg"},ts=t=>{if(!po){console.error(x+"missing HTML element for contributor name");return}po.textContent=t},es=t=>{if(!ho){console.error(x+"missing HTML element for contributor role");return}ho.textContent=t},jr=t=>{Ql(t._base64?"data:image;base64,"+t._base64:null),ts(t._name),es(t._role)},Fr=t=>{if(!xe||!ke){console.error(x+"missing HTML element for contributor");return}if(xe&&(!t||!t.length)){xe.classList.add("hidden"),Jn(ke);return}if(t){xe.classList.remove("hidden");let e=!0;t.forEach((n,o)=>{e&&(e=!1,jr(n));const i=document.createElement("option");i.value=o.toString(),i.text=n._name+" -- "+n._role,ke.add(i)})}},O=t=>{const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")},q=(t,e)=>{const n=t.querySelector(".info__table-element");if(n){for(;n.firstChild;)n.removeChild(n.firstChild);typeof e=="string"?n.textContent=e:(e.forEach(o=>{if(typeof o=="string"){let i=document.createElement("span");i.textContent=o,n.appendChild(i),n.appendChild(document.createElement("br"))}else n.appendChild(o),n.appendChild(document.createElement("br"))}),n.lastChild&&n.removeChild(n.lastChild))}t.classList.remove("hidden")},Ar=t=>{if(!rn){console.error(x+"missing table row for time spend");return}if(t==null){O(rn);return}q(rn,t)},Or=t=>{if(!an){console.error(x+"missing table row for time spend");return}if(t==null){O(an);return}q(an,A(t))},qr=(t,e)=>{var s,u,p,c,g,m,f,d,E;if(!ln){console.error(x+"missing table row for custom colors");return}if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._obstacleColor){O(ln);return}e||(e="DefaultEnvironment");let n={_colorLeft:k((s=B[R[e]])==null?void 0:s._colorLeft)||null,_colorRight:k((u=B[R[e]])==null?void 0:u._colorRight)||null,_envColorLeft:k((p=B[R[e]])==null?void 0:p._envColorLeft)||null,_envColorRight:k((c=B[R[e]])==null?void 0:c._envColorRight)||null,_envColorLeftBoost:k((g=B[R[e]])==null?void 0:g._envColorLeftBoost)||null,_envColorRightBoost:k((m=B[R[e]])==null?void 0:m._envColorRightBoost)||null,_obstacleColor:k((f=B[R[e]])==null?void 0:f._obstacleColor)||null};t._colorLeft&&(n._colorLeft=k(t._colorLeft)),t._colorRight&&(n._colorRight=k(t._colorRight)),t._envColorLeft?n._envColorLeft=k(t._envColorLeft):t._colorLeft&&(n._envColorLeft=k(t._colorLeft)),t._envColorRight?n._envColorRight=k(t._envColorRight):t._colorRight&&(n._envColorRight=k(t._colorRight));let o,i,r=!1;t._envColorLeftBoost?(o=k(t._envColorLeftBoost),r=!0):o=k((d=B[R[e]])==null?void 0:d._envColorLeftBoost)||n._envColorLeft,t._envColorRightBoost?(i=k(t._envColorRightBoost),r=!0):i=k((E=B[R[e]])==null?void 0:E._envColorRightBoost)||n._envColorRight,r&&(n._envColorLeftBoost=o,n._envColorRightBoost=i),t._obstacleColor&&(n._obstacleColor=k(t._obstacleColor));const a=en("max","none",!0);for(const y in n){if(!n[y])continue;const v=document.createElement("div"),$=document.createElement("div"),F=document.createElement("div"),nt=document.createElement("div");$.className="info__color-dot",$.style.backgroundColor=n[y]||"#000000",F.className="info__color-text info__color-text--monospace",F.textContent=`${n[y]}`,nt.className="info__color-text",nt.textContent=` -- ${bl[y]}`,v.appendChild($),v.appendChild(F),v.appendChild(nt),a.appendChild(v)}q(ln,[a])},Jr=t=>{if(!sn){console.error(x+"missing table row for requirements");return}if(t==null||!t.length){O(sn);return}q(sn,t.join(", "))},Ur=t=>{if(!cn){console.error(x+"missing table row for suggestions");return}if(t==null||!t.length){O(cn);return}q(cn,t.join(", "))},Gr=t=>{if(!un){console.error(x+"missing table row for information");return}if(t==null||!t.length){O(un);return}q(un,t)},Vr=t=>{if(!mn){console.error(x+"missing table row for warnings");return}if(t==null||!t.length){O(mn);return}q(mn,t)},Xr=(t,e)=>{if(!dn){console.error(x+"missing table row for bookmarks");return}if(t==null||!t.length){O(dn);return}const n=t.map(o=>{let i=o._time,r;return e&&(i=e.adjustTime(i),r=e.toRealTime(i)),`${h(o._time,3)}${r?" | "+A(r):""} -- ${o._name!==""?o._name:"**EMPTY NAME**"}`});q(dn,n)},zr=t=>{if(!pn){console.error(x+"missing table row for bookmarks");return}if(!t||!t.change.length){O(pn);return}const e=t.change.map(n=>{let o=h(n._newTime,3),i=t.toRealTime(n._time);return`${o} | ${A(i)} -- ${n._BPM}`});q(pn,e)},Kr=t=>{if(!hn){console.error(x+"missing table row for environment enhancement");return}if(t==null||!t.length){O(hn);return}const e=t.map(n=>{let o=[];for(const i in n){if(i=="_lookupMethod"||i=="_id")continue;let r=Wn[i];n[i]!=null&&o.push(r)}return`${n._lookupMethod} [${o.join("")}]${n._track?`(${n._track})`:""} -> ${n._id}`});q(hn,e)},Wr=t=>{if(!_n){console.error(x+"missing table row for point definitions");return}if(t==null||!t.length){O(_n);return}const e=t.map(n=>`${n._name} -- ${n._points.length} point${n._points.length>1?"s":""}`);q(_n,e)},Yr=(t,e)=>{if(!fn){console.error(x+"missing table row for custom events");return}if(t==null||!t.length){O(fn);return}const n=t.map(o=>{let i=o._time,r;e&&(i=e.adjustTime(i),r=e.toRealTime(i));let a=[];for(const l in o._data){if(l=="_duration"||l=="_easing"||l=="_track")continue;const s=io[l];o._data[l]!=null&&a.push(s)}return`${h(o._time,3)}${r?" | "+A(r):""} -- ${o._type} -> [${a.join("")}]${o._type!=="AssignTrackParent"?`(${o._data._track})`:""}`});q(fn,n)},ns=t=>{var e;cl(t._songName),ul(t._songSubName),ml(t._songAuthorName),dl(t._beatsPerMinute),Pr(t._levelAuthorName),Hr(t._environmentName),Nr((e=t._customData)==null?void 0:e._editors)},Zr=t=>{var e,n,o;if(Ar(t._data._version),((e=t._info)==null?void 0:e._customData)&&(qr(t._info._customData),Jr(t._info._customData._requirements),Ur(t._info._customData._suggestions),Gr(t._info._customData._information),Vr(t._info._customData._warnings)),(n=t._data)==null?void 0:n._customData){const i=((o=b._mapInfo)==null?void 0:o._beatsPerMinute)?ot(b._mapInfo._beatsPerMinute,t._data._customData._bpmChanges||t._data._customData._BPMChanges):null;Or(t._data._customData._time),Xr(t._data._customData._bookmarks,i),zr(i),Kr(t._data._customData._environment),Wr(t._data._customData._pointDefinitions),Yr(t._data._customData._customEvents,i)}};function os(t){if(!b._contributors){console.error(x+"no saved data for contributors");return}const e=t.target;jr(b._contributors[parseInt(e.value)])}const is=()=>{Pr(),Hr(),Nr(),Fr(),Ar(),Or(),qr(),Jr(),Ur(),Gr(),Vr(),Xr(),zr(),Kr(),Wr(),Yr()},rs="UI Input: ",rt=t=>{const e=document.querySelectorAll(".input-toggle");if(!e.length){console.error(rs+"empty list, intentional or typo error?");return}e.forEach(n=>{n.disabled=t})},Qr="UI Loading: ",Dt=document.querySelector(".loading__bar"),ta="loading__bar--error",ea="loading__bar--download",_o=document.querySelector(".loading__text");(!Dt||!_o)&&console.error(Qr+"loading component is missing part");const T=(t,e,n=100)=>{if(!Dt||!_o){console.error(Qr+"could not process, missing HTML element");return}_o.textContent=e,Dt.style.width=`${n}%`,t==="error"?Dt.classList.add(ta):Dt.classList.remove(ta),t==="download"?Dt.classList.add(ea):Dt.classList.remove(ea)},as=()=>{T("info","No map loaded",0)};var gn={loading:!1,map:{load:{image:!1,audio:!1}}};const fo={name:"Cover Image",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:ls};function ls(){const t=new Image,e=sl(),n=[];if(gn.map.load.image&&e!==null?(t.src=e,t.width!==t.height&&n.push("<b>Cover image is not square:</b> resize to fit square"),(t.width<256||t.height<256)&&n.push("<b>Cover image is too small:</b> require at least 256x256")):n.push("<b>No cover image:</b> "+(C.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),n.length){const o=document.createElement("div");o.innerHTML=n.join("<br>"),fo.output.html=o}else fo.output.html=null}const bn={name:"Preview Time",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:ss};function ss(t){const{_audioDuration:e}=t,n=document.createElement("div");e&&e<20?(n.innerHTML=`<b>Unrankable audio length:</b> too short (${A(e)}s)`,bn.output.html=n):gn.map.load.audio?bn.output.html=null:(n.innerHTML=`<b>No audio:</b> ${C.load.audio?"could not be loaded or not found":"no audio mode is enabled"}`,bn.output.html=n)}const go={name:"Preview Time",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:cs};function cs(t,e,n){if(!n)throw new Error("something went wrong!");const{_previewStartTime:o,_previewDuration:i}=n;if(o===12&&i===10){const r=document.createElement("div");r.innerHTML="<b>Default preview time:</b> strongly recommended to set for audience's 1st impression",go.output.html=r}else go.output.html=null}const I=(t,e,n,o)=>{if(o&&o.length>0&&n.toRealTime(e._time)+.005<n.toRealTime(t._time)&&t._cutDirection!==8){for(const i of o)if(i._cutDirection!==8&&Ce(t,i,90,!1))return!0}if(o&&o.length>0){for(const i of o)if(Math.max(Math.abs(i._lineIndex-t._lineIndex),Math.abs(i._lineLayer-t._lineLayer))<1)return!0}return $r(t,e)&&n.toRealTime(t._time-e._time)>.08||n.toRealTime(t._time-e._time)>.07},na=(t,e,n)=>n/((t._time-e._time)*2),oa=(t,e)=>{const n=[],o={},i={0:[],1:[]};for(let r=0,a=t.length;r<a;r++){if(!S(t[r]))continue;const l=JSON.parse(JSON.stringify(t[r]));o[l._type]&&I(l,o[l._type],e,i[l._type])&&(l._ebpm=na(l,o[l._type],e.value),n.push(l),i[l._type]=[]),o[l._type]=l,i[l._type].push(l)}return n},bo=(t,e)=>{const n=[],o={},i={0:[],1:[]};for(let r=0,a=t.length;r<a;r++){if(!S(t[r]))continue;const l=JSON.parse(JSON.stringify(t[r]));o[l._type]?I(l,o[l._type],e,i[l._type])&&(l._ebpm=na(l,o[l._type],e.value),n.push(l),o[l._type]=l,i[l._type]=[]):o[l._type]=l,i[l._type].push(l)}return n},us=(t,e)=>Math.max(...oa(t,e).map(n=>n._ebpm),0),ms=(t,e)=>Math.max(...bo(t,e).map(n=>n._ebpm),0),ia=(t,e)=>{let n=!1,o=!1,i=0;const r=e.toRealTime(Math.max(...t.map((a,l)=>l===0?0:((me(t[l],t[l-1])||ue(t[l],t[l-1]))&&!n&&(n=!0,i=(t[l]._time-t[l-1]._time)/(dt(t[l],t[l-1])||1)),o=Ke(t[l],t[l-1])||ro(t[l],t[l-1])||o,(t[l]._time-t[l-1]._time)/(dt(t[l],t[l-1])||1)))));return n&&o?e.toRealTime(i):r},ra=(t,e)=>{let n=!1,o=!1,i=Number.MAX_SAFE_INTEGER;const r=e.toRealTime(Math.min(...t.map((a,l)=>l===0?Number.MAX_SAFE_INTEGER:((me(t[l],t[l-1])||ue(t[l],t[l-1]))&&!n&&(n=!0,i=(t[l]._time-t[l-1]._time)/(dt(t[l],t[l-1])||1)),o=Ke(t[l],t[l-1])||ro(t[l],t[l-1])||o,(t[l]._time-t[l-1]._time)/(dt(t[l],t[l-1])||1)))));return n&&o?e.toRealTime(i):r},yn=(t,e)=>{const n=[],o={},i={0:[],1:[]};for(let r=0,a=t.length;r<a;r++){if(!S(t[r]))continue;const l=JSON.parse(JSON.stringify(t[r]));if(l._minSpeed=0,l._maxSpeed=Number.MAX_SAFE_INTEGER,o[l._type]){if(I(l,o[l._type],e,i[l._type])){const s=ia(i[l._type],e),u=ra(i[l._type],e);s>0&&u!==1/0&&(o[l._type]._minSpeed=s,o[l._type]._maxSpeed=u,n.push(o[l._type])),o[l._type]=l,i[l._type]=[]}}else o[l._type]=l;i[l._type].push(l)}for(let r=0;r<2;r++)if(o[r]){const a=ia(i[r],e),l=ra(i[r],e);a>0&&l!==1/0&&(o[r]._minSpeed=a,o[r]._maxSpeed=l,n.push(o[r]))}return n},ds=(t,e)=>Math.max(...yn(t,e).map(n=>n._minSpeed),0),ps=(t,e)=>{const n=yn(t,e).map(o=>o._maxSpeed);return n.length?Math.min(...n):0},hs=(t,e,n)=>{const o={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let i,r;for(let a=0,l=t.length;a<l;a++){const s=t[a],u=n.toRealTime(s._time);s._type===0&&(i?I(s,i,n)&&o.left[Math.floor(u)]++:o.left[Math.floor(u)]++,i=s),s._type===1&&(r?I(s,r,n)&&o.right[Math.floor(u)]++:o.right[Math.floor(u)]++,r=s)}return o},yo=(t,e)=>{if(!t.length)return 0;if(t.length<e)return t.reduce((i,r)=>i+r)/t.length;let n=t.slice(0,e).reduce((i,r)=>i+r),o=n;for(let i=0;i<t.length-e;i++)n=n-t[i]+t[i+e],o=Math.max(o,n);return o/e},aa=(t,e)=>{const n=10,o={red:{overall:0,peak:0,median:0,total:0},blue:{overall:0,peak:0,median:0,total:0},total:{overall:0,peak:0,median:0,total:0}},i=Math.max(e.toRealTime(ze(t._data)-fr(t._data)),0),r=Math.max(e.toRealTime(ze(t._data)),0),a=hs(t._data._notes,r,e),l=a.left.map((c,g)=>c+a.right[g]);if(l.reduce((c,g)=>c+g)===0)return o;const s=[],u=[],p=[];for(let c=0,g=Math.ceil(l.length/n);c<g;c++){const m=c*n;let f=n;f+m>l.length&&(f=l.length-m);const d=a.left.slice(m,m+f),E=a.right.slice(m,m+f),y=l.slice(m,m+f);s.push(d.reduce((v,$)=>v+$)/f),u.push(E.reduce((v,$)=>v+$)/f),p.push(y.reduce((v,$)=>v+$)/f)}return o.red.total=a.left.reduce((c,g)=>c+g),o.red.overall=a.left.reduce((c,g)=>c+g)/i,o.red.peak=yo(a.left,n),o.red.median=qn(s),o.blue.total=a.right.reduce((c,g)=>c+g),o.blue.overall=a.right.reduce((c,g)=>c+g)/i,o.blue.peak=yo(a.right,n),o.blue.median=qn(u),o.total.total=o.red.total+o.blue.total,o.total.overall=l.reduce((c,g)=>c+g)/i,o.total.peak=yo(l,n),o.total.median=qn(p),o},_s=(t,e)=>{let n=0,o=0;for(const i of t){const r=i.sps.total.overall;if(o>0&&r>0&&(n=(1-o/r)*100),o=r>0?r:o,o>e&&n>40)return i}return null},fs=(t,e)=>{let n=Number.MAX_SAFE_INTEGER,o=0;for(const i of t){const r=i.sps.total.overall;if(o>0&&r>0&&(n=(1-o/r)*100),o=r>0?r:o,o>e&&n<10)return i}return null},gs=t=>{let e=0,n=Number.MAX_SAFE_INTEGER;return t.forEach(o=>{const i=o.sps.total.overall;i>0&&(e=Math.max(e,i),n=Math.min(n,i))}),e||e&&n?(1-n/e)*100:0},la=t=>{let e=Number.MAX_SAFE_INTEGER;return t.forEach(n=>{const o=n.sps.total.overall;o>0&&(e=Math.min(e,o))}),e},Me={name:"Progression",description:"Placeholder",type:"general",order:{input:0,output:0},input:{enabled:!0,params:{}},output:{html:null},run:bs};function bs(t,e,n,o){const{_audioDuration:i}=t;if(!i){Me.output.html=null;return}if(!o)throw new Error("no sps");const r=o.filter(p=>p.mode==="Standard").sort((p,c)=>p.sps.total.overall-c.sps.total.overall);if(!r.length){Me.output.html=null;return}const a=i<120?3.2:i<240?4.2:5.2,l=[];i<240&&la(r)>a&&gs(r)<60&&l.push(`<b>Minimum SPS not met (<${a}):</b> lowest is ${h(la(r),2)}`);const s=_s(r,a),u=fs(r,a);if(s&&i<360&&l.push(`<b>Violates progression:</b> ${s.difficulty} exceeded 40% SPS drop`),u&&i<360&&l.push(`<b>Violates progression:</b> ${u.difficulty} has less than 10% SPS drop`),l.length){const p=document.createElement("div");p.innerHTML=l.join("<br>"),Me.output.html=p}else Me.output.html=null}var sa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",coverImage:fo,audio:bn,previewTime:go,progression:Me});const vo=450,Eo=350,Se=document.createElement("div"),pt=document.createElement("input"),$o=document.createElement("label"),ht=document.createElement("input"),wo=document.createElement("label");$o.textContent="Effective BPM threshold: ";$o.htmlFor="input__tools-ebpm";pt.id="input__tools-ebpm";pt.className="input-toggle input--small";pt.type="number";pt.min="0";pt.value=vo.toString();pt.addEventListener("change",vs);wo.textContent=" (swing): ";wo.htmlFor="input__tools-ebpms";ht.id="input__tools-ebpms";ht.className="input-toggle input--small";ht.type="number";ht.min="0";ht.value=Eo.toString();ht.addEventListener("change",Es);Se.appendChild($o);Se.appendChild(pt);Se.appendChild(wo);Se.appendChild(ht);const H={name:"Effective BPM",description:"Placeholder",type:"note",order:{input:0,output:100},input:{enabled:!0,params:{ebpmThres:vo,ebpmsThres:Eo},html:Se,adjustTime:ys},output:{html:null},run:ws};function ys(t){H.input.params.ebpmThres=h(Math.min(vo,t.value*2*1.285714),1),H.input.params.ebpmsThres=h(Math.min(Eo,t.value*2),1),pt.value=H.input.params.ebpmThres.toString(),ht.value=H.input.params.ebpmsThres.toString()}function vs(){H.input.params.ebpmThres=h(Math.abs(parseFloat(this.value)),1),this.value=H.input.params.ebpmThres.toString()}function Es(){H.input.params.ebpmsThres=h(Math.abs(parseFloat(this.value)),1),this.value=H.input.params.ebpmsThres.toString()}function $s(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{ebpmThres:i,ebpmsThres:r}=H.input.params,a=oa(o,n).filter(s=>s._ebpm>i).map(s=>s._time),l=bo(o,n).filter(s=>s._ebpm>r).map(s=>s._time);return{base:a,swing:l}}function ws(t,e){if(!e)throw new Error("something went wrong!");const n=$s(t,e),{ebpmThres:o,ebpmsThres:i}=H.input.params,r=[];if(n.base.length&&r.push(`<b>>${o}EBPM warning [${n.base.length}]:</b> ${n.base.map(a=>h(t._bpm.adjustTime(a),3)).join(", ")}`),n.swing.length&&r.push(`<b>>${i}EBPM (swing) warning [${n.swing.length}]:</b> ${n.swing.map(a=>h(t._bpm.adjustTime(a),3)).join(", ")}`),r.length){const a=document.createElement("div");a.innerHTML=r.join("<br>"),H.output.html=a}else H.output.html=null}const ca=[4,3],To=document.createElement("div"),de=document.createElement("input"),Co=document.createElement("label");Co.textContent="Acceptable beat precision: ";Co.htmlFor="input__tools-prec";de.id="input__tools-prec";de.className="input-toggle input--small";de.type="text";de.value=ca.join(" ");de.addEventListener("change",Ts);To.appendChild(Co);To.appendChild(de);const pe={name:"Acceptable Beat Precision",description:"Placeholder",type:"note",order:{input:10,output:110},input:{enabled:!0,params:{prec:[...ca]},html:To},output:{html:null},run:Ls};function Ts(){pe.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=pe.input.params.prec.join(" ")}function Cs(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{prec:i}=pe.input.params;return bo(o,n).map(r=>r._time).filter((r,a,l)=>!a||r!==l[a-1]).filter(r=>{if(!i.length)return!1;for(let a=0;a<i.length;a++)if((n.adjustTime(r)+.001)%(1/i[a])<.01)return!1;return!0})}function Ls(t,e){if(!e)throw new Error("something went wrong!");const n=Cs(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Off-beat precision [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,pe.output.html=o}else pe.output.html=null}const Lo=document.createElement("div"),It=document.createElement("input"),xo=document.createElement("label");xo.textContent=" Varying swing speed";xo.htmlFor="input__tools-vary-swing-check";It.id="input__tools-vary-swing-check";It.className="input-toggle";It.type="checkbox";It.checked=!0;It.addEventListener("change",xs);Lo.appendChild(It);Lo.appendChild(xo);const vn={name:"Varying Swing Speed",description:"Placeholder",type:"note",order:{input:20,output:130},input:{enabled:It.checked,params:{},html:Lo},output:{html:null},run:Ms};function xs(){vn.input.enabled=this.checked}function ks(t,e){const{_bpm:n}=t,{_notes:o}=e._data;return yn(o,n).filter(i=>Math.abs(i._minSpeed-i._maxSpeed)>.002).map(i=>i._time).filter((i,r,a)=>!r||i!==a[r-1])}function Ms(t,e){if(!e)throw new Error("something went wrong!");const n=ks(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Varying swing speed [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,vn.output.html=o}else vn.output.html=null}const ua=.025,_t=document.createElement("div"),Rt=document.createElement("input"),ko=document.createElement("label"),ft=document.createElement("input"),Mo=document.createElement("label"),gt=document.createElement("input"),So=document.createElement("label");let he;ko.textContent=" Slow slider";ko.htmlFor="input__tools-slow-slider-check";Rt.id="input__tools-slow-slider-check";Rt.className="input-toggle";Rt.type="checkbox";Rt.checked=!0;Rt.addEventListener("change",Ds);Mo.textContent="min speed (ms): ";Mo.htmlFor="input__tools-slow-slider-time";ft.id="input__tools-slow-slider-time";ft.className="input-toggle input--small";ft.type="number";ft.min="0";ft.value=h(ua*1e3,1).toString();ft.addEventListener("change",Is);So.textContent=" (prec): ";So.htmlFor="input__tools-slow-slider-prec";gt.id="input__tools-slow-slider-prec";gt.className="input-toggle input--small";gt.type="number";gt.min="0";gt.addEventListener("change",Rs);_t.appendChild(Rt);_t.appendChild(ko);_t.appendChild(document.createElement("br"));_t.appendChild(Mo);_t.appendChild(ft);_t.appendChild(So);_t.appendChild(gt);const J={name:"Slow Slider",description:"Placeholder",type:"note",order:{input:21,output:120},input:{enabled:Rt.checked,params:{minSpeed:ua},html:_t,adjustTime:Ss},output:{html:null},run:Ps};function Ss(t){he=t,gt.value=h(1/he.toBeatTime(J.input.params.minSpeed),2).toString()}function Ds(){J.input.enabled=this.checked}function Is(){J.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=h(J.input.params.minSpeed*1e3,1).toString(),he&&(gt.value=h(1/he.toBeatTime(J.input.params.minSpeed),2).toString())}function Rs(){if(!he){this.value="0";return}let t=h(Math.abs(parseFloat(this.value)),2)||1;J.input.params.minSpeed=he.toRealTime(1/t),ft.value=h(J.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}function Bs(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{minSpeed:i}=J.input.params;return yn(o,n).filter(r=>r._maxSpeed>i||r._minSpeed>i).map(r=>r._time).filter((r,a,l)=>!a||r!==l[a-1])}function Ps(t,e){if(!e)throw new Error("something went wrong!");const{minSpeed:n}=J.input.params,o=Bs(t,e);if(o.length){const i=document.createElement("div");i.innerHTML=`<b>Slow slider (>${h(n*1e3,1)}ms) [${o.length}]:</b> ${o.map(r=>h(t._bpm.adjustTime(r),3)).join(", ")}`,J.output.html=i}else J.output.html=null}const ma=.15;let _e;const bt=document.createElement("div"),Bt=document.createElement("input"),Do=document.createElement("label"),yt=document.createElement("input"),Io=document.createElement("label"),at=document.createElement("input"),Ro=document.createElement("label");Do.textContent=" Inline sharp angle";Do.htmlFor="input__tools-inline-angle-check";Bt.id="input__tools-inline-angle-check";Bt.className="input-toggle";Bt.type="checkbox";Bt.checked=!0;Bt.addEventListener("change",Ns);Io.textContent="max time (ms): ";Io.htmlFor="input__tools-inline-angle-time";yt.id="input__tools-inline-angle-time";yt.className="input-toggle input--small";yt.type="number";yt.min="0";yt.value=h(ma*1e3,1).toString();yt.addEventListener("change",js);Ro.textContent=" (beat): ";Ro.htmlFor="input__tools-inline-angle-beat";at.id="input__tools-inline-angle-beat";at.className="input-toggle input--small";at.type="number";at.min="0";at.step="0.1";at.addEventListener("change",Fs);bt.appendChild(Bt);bt.appendChild(Do);bt.appendChild(document.createElement("br"));bt.appendChild(Io);bt.appendChild(yt);bt.appendChild(Ro);bt.appendChild(at);const X={name:"Inline Sharp Angle",description:"Placeholder",type:"note",order:{input:30,output:160},input:{enabled:Bt.checked,params:{maxTime:ma},html:bt,adjustTime:Hs},output:{html:null},run:Os};function Hs(t){_e=t,at.value=h(_e.toBeatTime(X.input.params.maxTime),2).toString()}function Ns(){X.input.enabled=this.checked}function js(){X.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=h(X.input.params.maxTime*1e3,1).toString(),_e&&(at.value=h(_e.toBeatTime(X.input.params.maxTime),2).toString())}function Fs(){if(!_e){this.value="0";return}let t=h(Math.abs(parseFloat(this.value)),2)||1;X.input.params.maxTime=_e.toRealTime(t),yt.value=h(X.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function As(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:i}=X.input.params,r=n.toBeatTime(i)+.001,a={},l={},s={},u={0:[],1:[],3:[]},p=[];let c=0,g=0;for(let m=0,f=o.length;m<f;m++){const d=o[m];S(d)&&a[d._type]?I(d,a[d._type],n,u[d._type])?(s[d._type]&&(s[d._type]=null,l[d._type]=(l[d._type]+180)%360),da(d,o,g,r)&&Ce(d,l[d._type],90,!0)&&p.push(d),d._cutDirection===8?s[d._type]=d:l[d._type]=P(d),u[d._type]=[]):(s[d._type]&&da(d,o,g,r)&&Ce(d,l[d._type],90,!0)&&(p.push(s[d._type]),s[d._type]=null),d._cutDirection!==8&&(l[d._type]=P(d))):l[d._type]=P(d),c<d._time-r&&(c=d._time-r,g=m),a[d._type]=d,u[d._type].push(d),d._type===3&&(d._lineLayer===0&&(d._lineIndex===1&&(l[0]=it[0],s[0]=null),d._lineIndex===2&&(l[1]=it[0],s[1]=null)),d._lineLayer===2&&(d._lineIndex===1&&(l[0]=it[1],s[0]=null),d._lineIndex===2&&(l[1]=it[1],s[1]=null)))}return p.map(m=>m._time).filter(function(m,f,d){return!f||m!==d[f-1]})}function da(t,e,n,o){for(let i=n;e[i]._time<t._time;i++)if(We(t,e[i])&&t._time-e[i]._time<=o)return!0;return!1}function Os(t,e){if(!e)throw new Error("something went wrong!");const n=As(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Inline sharp angle [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,X.output.html=o}else X.output.html=null}const pa=.15,ha=1;let fe;const z=document.createElement("div"),Pt=document.createElement("input"),Bo=document.createElement("label"),Ht=document.createElement("input"),Po=document.createElement("label"),vt=document.createElement("input"),Ho=document.createElement("label"),lt=document.createElement("input"),No=document.createElement("label");Bo.textContent=" shrado angle";Bo.htmlFor="input__tools-shrado-angle-check";Pt.id="input__tools-shrado-angle-check";Pt.className="input-toggle";Pt.type="checkbox";Pt.checked=!1;Pt.addEventListener("change",Js);Po.textContent="min distance: ";Po.htmlFor="input__tools-shrado-angle-distance";Ht.id="input__tools-shrado-angle-distance";Ht.className="input-toggle input--small";Ht.type="number";Ht.min="0";Ht.value=ha.toString();Ht.addEventListener("change",Us);Ho.textContent="max time (ms): ";Ho.htmlFor="input__tools-shrado-angle-time";vt.id="input__tools-shrado-angle-time";vt.className="input-toggle input--small";vt.type="number";vt.min="0";vt.value=h(pa*1e3,1).toString();vt.addEventListener("change",Gs);No.textContent=" (beat): ";No.htmlFor="input__tools-shrado-angle-beat";lt.id="input__tools-shrado-angle-beat";lt.className="input-toggle input--small";lt.type="number";lt.min="0";lt.step="0.1";lt.addEventListener("change",Vs);z.appendChild(Pt);z.appendChild(Bo);z.appendChild(document.createElement("br"));z.appendChild(Po);z.appendChild(Ht);z.appendChild(document.createElement("br"));z.appendChild(Ho);z.appendChild(vt);z.appendChild(No);z.appendChild(lt);const N={name:"shrado Angle",description:"Placeholder",type:"note",order:{input:40,output:170},input:{enabled:Pt.checked,params:{distance:ha,maxTime:pa},html:z,adjustTime:qs},output:{html:null},run:zs};function qs(t){fe=t,lt.value=h(fe.toBeatTime(N.input.params.maxTime),2).toString()}function Js(){N.input.enabled=this.checked}function Us(){N.input.params.distance=Math.max(parseInt(this.value),0),this.value=N.input.params.distance.toString()}function Gs(){N.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=h(N.input.params.maxTime*1e3,1).toString(),fe&&(lt.value=h(fe.toBeatTime(N.input.params.maxTime),2).toString())}function Vs(){if(!fe){this.value="0";return}let t=h(Math.abs(parseFloat(this.value)),2)||1;N.input.params.maxTime=fe.toRealTime(t),vt.value=h(N.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Xs(t,e){var g;const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:i,distance:r}=N.input.params,a=n.toBeatTime(i)+.001,l={},s={},u={},p={0:[],1:[],3:[]},c=[];for(let m=0,f=o.length;m<f;m++){const d=o[m];S(d)&&l[d._type]?I(d,l[d._type],n,p[d._type])?(u[d._type]&&(u[d._type]=null,s[d._type]=(g=Sl[s[d._type]])!=null?g:8),dt(d,l[d._type])>=r&&_a(d._cutDirection,s[d._type],d._type)&&d._time-l[d._type]._time<=a&&c.push(d),d._cutDirection===8?u[d._type]=d:s[d._type]=d._cutDirection,p[d._type]=[]):(u[d._type]&&dt(d,l[d._type])>=r&&_a(d._cutDirection,s[d._type],d._type)&&d._time-l[d._type]._time<=a&&(c.push(u[d._type]),u[d._type]=null),d._cutDirection!==8&&(s[d._type]=d._cutDirection)):s[d._type]=d._cutDirection,l[d._type]=d,p[d._type].push(d)}return c.map(m=>m._time).filter(function(m,f,d){return!f||m!==d[f-1]})}function _a(t,e,n){return t===8||e===8?!1:(n===0?e===7:e===6)&&t===0}function zs(t,e){if(!e)throw new Error("something went wrong!");const n=Xs(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>shrado angle [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,N.output.html=o}else N.output.html=null}const fa=.075,Et=document.createElement("div"),Nt=document.createElement("input"),jo=document.createElement("label"),$t=document.createElement("input"),Fo=document.createElement("label"),wt=document.createElement("input"),Ao=document.createElement("label");let ge;jo.textContent=" Speed pause (EXPERIMENTAL)";jo.htmlFor="input__tools-speed-pause-check";Nt.id="input__tools-speed-pause-check";Nt.className="input-toggle";Nt.type="checkbox";Nt.checked=!1;Nt.addEventListener("change",Ws);Fo.textContent="stream speed (ms): ";Fo.htmlFor="input__tools-speed-pause-time";$t.id="input__tools-speed-pause-time";$t.className="input-toggle input--small";$t.type="number";$t.min="0";$t.value=h(fa*1e3,1).toString();$t.addEventListener("change",Ys);Ao.textContent=" (prec): ";Ao.htmlFor="input__tools-speed-pause-prec";wt.id="input__tools-speed-pause-prec";wt.className="input-toggle input--small";wt.type="number";wt.min="0";wt.addEventListener("change",Zs);Et.appendChild(Nt);Et.appendChild(jo);Et.appendChild(document.createElement("br"));Et.appendChild(Fo);Et.appendChild($t);Et.appendChild(Ao);Et.appendChild(wt);const K={name:"Speed Pause",description:"Placeholder",type:"note",order:{input:50,output:180},input:{enabled:Nt.checked,params:{maxTime:fa},html:Et,adjustTime:Ks},output:{html:null},run:tc};function Ks(t){ge=t,wt.value=h(1/ge.toBeatTime(K.input.params.maxTime),2).toString()}function Ws(){K.input.enabled=this.checked}function Ys(){K.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=h(K.input.params.maxTime*1e3,1).toString(),ge&&(wt.value=h(1/ge.toBeatTime(K.input.params.maxTime),2).toString())}function Zs(){if(!ge){this.value="0";return}let t=h(Math.abs(parseFloat(this.value)),2)||1;K.input.params.maxTime=ge.toRealTime(1/t),$t.value=h(K.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Qs(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{maxTime:i}=K.input.params,r=n.toBeatTime(i)+.001,a={},l={},s={0:!1,1:!1,3:!1},u={0:[],1:[],3:[]},p=[];for(let c=0,g=o.length;c<g;c++){const m=o[c];S(m)&&a[m._type]?I(m,a[m._type],n,u[m._type])&&(m._time-a[m._type]._time<=r*2?(s[0]&&s[1]&&a[m._type]._time-l[m._type]._time<=r*3&&p.push(a[m._type]),s[m._type]=!1):s[m._type]||(s[m._type]=!0,l[m._type]=a[m._type]),u[m._type]=[],a[m._type]=m):a[m._type]=m,u[m._type].push(m)}return p.map(c=>c._time).filter(function(c,g,m){return!g||c!==m[g-1]})}function tc(t,e){if(!e)throw new Error("something went wrong!");const n=Qs(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Speed pause [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,K.output.html=o}else K.output.html=null}const Oo=document.createElement("div"),jt=document.createElement("input"),qo=document.createElement("label");qo.textContent=" Hitbox staircase";qo.htmlFor="input__tools-hitbox-stair-check";jt.id="input__tools-hitbox-stair-check";jt.className="input-toggle";jt.type="checkbox";jt.checked=!0;jt.addEventListener("change",ec);Oo.appendChild(jt);Oo.appendChild(qo);const En={name:"Hitbox Staircase",description:"Placeholder",type:"note",order:{input:70,output:190},input:{enabled:jt.checked,params:{},html:Oo},output:{html:null},run:oc};function ec(){En.input.enabled=this.checked}function nc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,i=n.toBeatTime(.15),r={},a={},l={},s={0:[],1:[],3:[]},u={0:{_time:0,_type:0,_cutDirection:0,_lineIndex:0,_lineLayer:0},1:{_time:0,_type:1,_cutDirection:0,_lineIndex:0,_lineLayer:0},3:{_time:0,_type:3,_cutDirection:0,_lineIndex:0,_lineLayer:0}},p=[];for(let c=0,g=o.length;c<g;c++){const m=o[c];S(m)&&r[m._type]?(I(m,r[m._type],n,s[m._type])?(l[m._type]=m._time-r[m._type]._time,m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+mt[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+mt[m._cutDirection][1]):(u[m._type]._lineIndex=-1,u[m._type]._lineLayer=-1),s[m._type]=[],a[m._type]=m._cutDirection):wr(m,r[m._type],a[m._type])&&(m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+mt[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+mt[m._cutDirection][1],a[m._type]=m._cutDirection):(u[m._type]._lineIndex=m._lineIndex+mt[a[m._type]][0],u[m._type]._lineLayer=m._lineLayer+mt[a[m._type]][1])),r[(m._type+1)%2]&&m._time-r[(m._type+1)%2]._time!=0&&m._time-r[(m._type+1)%2]._time<Math.min(i,l[(m._type+1)%2])&&m._lineIndex===u[(m._type+1)%2]._lineIndex&&m._lineLayer===u[(m._type+1)%2]._lineLayer&&!Il(m,o,c)&&p.push(m)):(m._cutDirection!==8?(u[m._type]._lineIndex=m._lineIndex+mt[m._cutDirection][0],u[m._type]._lineLayer=m._lineLayer+mt[m._cutDirection][1]):(u[m._type]._lineIndex=-1,u[m._type]._lineLayer=-1),a[m._type]=m._cutDirection),r[m._type]=m,s[m._type].push(m)}return p.map(c=>c._time).filter(function(c,g,m){return!g||c!==m[g-1]})}function oc(t,e){if(!e)throw new Error("something went wrong!");const n=nc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox staircase [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,En.output.html=o}else En.output.html=null}const Jo=document.createElement("div"),Ft=document.createElement("input"),Uo=document.createElement("label");Uo.textContent=" Hitbox reverse staircase";Uo.htmlFor="input__tools-hitbox-rstair-check";Ft.id="input__tools-hitbox-rstair-check";Ft.className="input-toggle";Ft.type="checkbox";Ft.checked=!0;Ft.addEventListener("change",ic);Jo.appendChild(Ft);Jo.appendChild(Uo);const $n={name:"Hitbox Reverse Staircase",description:"Placeholder",type:"note",order:{input:71,output:191},input:{enabled:Ft.checked,params:{},html:Jo},output:{html:null},run:sc};function ic(){$n.input.enabled=this.checked}const rc=.03414823529,ac=.03414823529;function lc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,r={},a={0:[],1:[],3:[]},l=[];for(let s=0,u=i.length;s<u;s++){const p=i[s];S(p)&&r[p._type]&&I(p,r[p._type],n,a[p._type])&&(a[p._type]=[]);for(const c of a[(p._type+1)%2])if(c._cutDirection!==8){if(!(n.toRealTime(p._time)>n.toRealTime(c._time)+.01))continue;const g=P(c)%90>15&&P(c)%90<75;if(o.value<1.425/(60*(p._time-c._time)/n.value+(g?ac:rc))&&ao(p,c,[[15,1.5]])[1]){l.push(c);break}}r[p._type]=p,a[p._type].push(p)}return l.map(s=>s._time).filter(function(s,u,p){return!u||s!==p[u-1]})}function sc(t,e){if(!e)throw new Error("something went wrong!");const n=lc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox reverse staircase [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,$n.output.html=o}else $n.output.html=null}const Go=document.createElement("div"),At=document.createElement("input"),Vo=document.createElement("label");Vo.textContent=" Hitbox inline";Vo.htmlFor="input__tools-hitbox-inline-check";At.id="input__tools-hitbox-inline-check";At.className="input-toggle";At.type="checkbox";At.checked=!0;At.addEventListener("change",cc);Go.appendChild(At);Go.appendChild(Vo);const wn={name:"Hitbox Inline",description:"Placeholder",type:"note",order:{input:72,output:192},input:{enabled:At.checked,params:{},html:Go},output:{html:null},run:dc};function cc(){wn.input.enabled=this.checked}const uc=0;function mc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,r={},a={0:[],1:[],3:[]},l=[];for(let s=0,u=i.length;s<u;s++){const p=i[s];S(p)&&r[p._type]&&I(p,r[p._type],n,a[p._type])&&(a[p._type]=[]);for(const c of a[(p._type+1)%2])if(o.value<1.425/(60*(p._time-c._time)/n.value+uc)&&We(p,c)){l.push(p);break}r[p._type]=p,a[p._type].push(p)}return l.map(s=>s._time).filter(function(s,u,p){return!u||s!==p[u-1]})}function dc(t,e){if(!e)throw new Error("something went wrong!");const n=mc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox inline [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,wn.output.html=o}else wn.output.html=null}const Xo=document.createElement("div"),Ot=document.createElement("input"),zo=document.createElement("label");zo.textContent=" Hitbox path";zo.htmlFor="input__tools-hitbox-path-check";Ot.id="input__tools-hitbox-path-check";Ot.className="input-toggle";Ot.type="checkbox";Ot.checked=!0;Ot.addEventListener("change",pc);Xo.appendChild(Ot);Xo.appendChild(zo);const Tn={name:"Hitbox Path",description:"Placeholder",type:"note",order:{input:74,output:190},input:{enabled:Ot.checked,params:{},html:Xo},output:{html:null},run:_c};function pc(){Tn.input.enabled=this.checked}function hc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,r=[];let a=0;for(let l=0,s=i.length;l<s;l++)if(!(n.toRealTime(i[l]._time)<a+.01||i[l]._type===3))for(let u=l+1;u<s&&!(n.toRealTime(i[u]._time)>n.toRealTime(i[l]._time)+.01);u++)i[l]._type===i[u]._type||i[u]._type===3||((me(i[l],i[u])||ue(i[l],i[u]))&&ao(i[l],i[u],[[45,1],[15,2]]).some(p=>p)||Ke(i[l],i[u])&&ao(i[l],i[u],[[45,1],[15,1.5]]).some(p=>p))&&(r.push(i[l]),a=n.toRealTime(i[l]._time));return r.map(l=>l._time).filter(function(l,s,u){return!s||l!==u[s-1]})}function _c(t,e){if(!e)throw new Error("something went wrong!");const n=hc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Hitbox path [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,Tn.output.html=o}else Tn.output.html=null}const Ko=document.createElement("div"),qt=document.createElement("input"),Wo=document.createElement("label");Wo.textContent=" Improper window snap";Wo.htmlFor="input__tools-window-snap-check";qt.id="input__tools-window-snap-check";qt.className="input-toggle";qt.type="checkbox";qt.checked=!0;qt.addEventListener("change",fc);Ko.appendChild(qt);Ko.appendChild(Wo);const Cn={name:"Improper Window Snap",description:"Placeholder",type:"note",order:{input:60,output:185},input:{enabled:qt.checked,params:{},html:Ko},output:{html:null},run:bc};function fc(){Cn.input.enabled=this.checked}function gc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,i={},r={0:[],1:[],3:[]},a=[];for(let l=0,s=o.length;l<s;l++){const u=o[l];S(u)&&i[u._type]?I(u,i[u._type],n,r[u._type])?(i[u._type]=u,r[u._type]=[]):ro(u,i[u._type])&&u._time-i[u._type]._time>=.001&&u._cutDirection===i[u._type]._cutDirection&&u._cutDirection!==8&&i[u._type]._cutDirection!==8&&a.push(i[u._type]):i[u._type]=u,r[u._type].push(u)}return a.map(l=>l._time).filter(function(l,s,u){return!s||l!==u[s-1]})}function bc(t,e){if(!e)throw new Error("something went wrong!");const n=gc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Improper window snap [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,Cn.output.html=o}else Cn.output.html=null}var Yo;(function(t){t.forehand="backhand",t.backhand="forehand"})(Yo||(Yo={}));const Ln={0:{forehand:[1,3,6,7],backhand:[0,2,4,5]},1:{forehand:[1,2,6,7],backhand:[0,3,4,5]}},Jt={0:[0,0,90,90,45,-45,45,-45],1:[0,0,-90,-90,-45,45,-45,45]},ga={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},De=class{constructor(t,e,n,o,i,r){this._type=e,this._warningThreshold=n,this._errorThreshold=o,this._allowedRotation=i,r&&r!=="neutral"?(this._state=r,this._rotation=0):(this._state=this.predictStartState(t,e),this._rotation=this.predictStartRotation(t,e)),this._position=this.predictStartPosition(t,e)}get state(){return this._state}get rotation(){return this._rotation}check(t,e){if(this._state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const n=t[0]._time,o=this._type;let i=this._state,r=this._rotation;e.forEach(u=>{u._time-.001>n||(u._lineLayer===0&&u._lineIndex===(o?2:1)&&(i="backhand",r=0),u._lineLayer===2&&u._lineIndex===(o?2:1)&&(i="forehand",r=0))});let a,l=8;for(const u of t)u._cutDirection!==8&&(l=u._cutDirection),a&&l===8&&(l=Tr(u,a)),a=u;if(l===8)return"none";const s=ga[o][Yo[i]][l];return(r>s?r-s:s-r)>180||s<De.CONSTRAINT_ROTATION[o][0]+this._errorThreshold||s>De.CONSTRAINT_ROTATION[o][1]-this._errorThreshold?"error":s<De.CONSTRAINT_ROTATION[o][0]+this._warningThreshold||s>De.CONSTRAINT_ROTATION[o][1]-this._warningThreshold||(r>s?r-s:s-r)>this._allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this._state){case"forehand":{this._state="backhand";break}case"backhand":{this._state="forehand";break}case"neutral":{for(let a=0;a<t.length;a++){const l=t[a];if(Ln[l._type].forehand.includes(l._cutDirection)){this._state="backhand";break}if(Ln[l._type].backhand.includes(l._cutDirection)){this._state="forehand";break}this._state==="neutral"&&l._cutDirection===8&&(l._lineLayer===0&&(this._state="backhand"),l._lineLayer>0&&(this._state="forehand"))}break}}if(this._state==="neutral")throw new Error("parity unexpected input");const n=t[0]._time,o=this._type;e.forEach(a=>{a._time-.001>n||(a._lineLayer===0&&a._lineIndex===(o?2:1)&&(this._state="forehand",this._rotation=0),a._lineLayer===2&&a._lineIndex===(o?2:1)&&(this._state="backhand",this._rotation=0))});let i,r=8;for(const a of t)a._cutDirection!==8&&(r=a._cutDirection),i&&r===8&&(r=Tr(a,i)),i=a;r!==8&&(this._rotation=ga[this._type][this._state][r])}predictStartState(t,e){let n="neutral";for(let o=0,i=t.length;o<i;o++){let r=t[o];if(r._type!==Math.abs(e-1)&&(r._type===3&&(r._lineLayer===0&&(r._lineIndex===e?1:2)&&(n="backhand"),r._lineLayer===2&&(r._lineIndex===e?1:2)&&(n="forehand")),r._type===e)){if(n!=="neutral")break;const a=r._time;for(let l=o;l<t.length&&!(t[l]._time>r._time+.001&&a<r._time+.001);l++){if(r=t[l],Ln[r._type].forehand.includes(r._cutDirection))return"backhand";if(Ln[r._type].backhand.includes(r._cutDirection))return"forehand";n==="neutral"&&r._cutDirection===8&&(r._lineLayer===0&&(n="backhand"),r._lineLayer>0&&(n="forehand"))}break}}return n}predictStartRotation(t,e){let n=0;for(let o=0,i=t.length;o<i;o++){let r=t[o];if(r._type===e&&r._type===e){const a=r._time;for(let l=o;l<t.length&&!(t[l]._time>r._time+.001&&a<r._time+.001);l++){if(r=t[l],r._cutDirection!==8)return Jt[r._type][r._cutDirection];r._cutDirection===8&&(r._lineLayer===0&&(r._lineIndex===0&&(n=Jt[r._type][6]),r._lineIndex===3&&(n=Jt[r._type][7])),r._lineLayer===1&&(r._lineIndex===0&&(n=Jt[r._type][2]),r._lineIndex===3&&(n=Jt[r._type][3])),r._lineLayer===2&&(r._lineIndex===0&&(n=Jt[r._type][4]),r._lineIndex===3&&(n=Jt[r._type][5])))}break}}return n}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let Zo=De;Zo.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];const Ie=(t,e,n,o,...i)=>{const r=document.createElement(n);r.className=o;const a=document.createElement("select");a.className="input-toggle",a.id=t,i.forEach(s=>{const u=document.createElement("option");u.textContent=s.text,u.value=s.value,a.append(u)});const l=document.createElement("label");return l.htmlFor=t,l.innerHTML=`<span>${e}</span>`,r.append(l),r.append(a),r},xn=document.createElement("div"),Ut=document.createElement("input"),Qo=document.createElement("label");Ie("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});Ie("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Ie("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Qo.textContent=" Parity (EXPERIMENTAL)";Qo.htmlFor="input__tools-parity-check";Ut.id="input__tools-parity-check";Ut.className="input-toggle";Ut.type="checkbox";Ut.checked=!1;Ut.addEventListener("change",yc);xn.appendChild(Ut);xn.appendChild(Qo);xn.appendChild(document.createElement("br"));const Re={name:"Parity check",description:"Placeholder",type:"note",order:{input:15,output:135},input:{enabled:Ut.checked,params:{warningThres:90,errorThres:45,allowedRot:90},html:xn},output:{html:null},run:Ec};function yc(){Re.input.enabled=this.checked}function vc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,{warningThres:i,errorThres:r,allowedRot:a}=Re.input.params,l={},s={0:[],1:[],3:[]},u={0:[],1:[]},p={0:[],1:[]},c={0:new Zo(o,0,i,r,a),1:new Zo(o,1,i,r,a)},g={warning:[],error:[]};for(let m=0,f=o.length;m<f;m++){const d=o[m];if(S(d)&&l[d._type]&&I(d,l[d._type],n,s[d._type])){switch(c[d._type].check(s[d._type],p[d._type])){case"warning":{g.warning.push(s[d._type][0]._time);break}case"error":{g.error.push(s[d._type][0]._time);break}}c[d._type].next(s[d._type],p[d._type]),p[d._type]=u[d._type],u[d._type]=[],s[d._type]=[]}d._type===3&&(u[0].push(d),u[1].push(d)),l[d._type]=d,s[d._type].push(d)}for(let m=0;m<2;m++)if(l[m])switch(c[m].check(s[m],u[m])){case"warning":{g.warning.push(s[m][0]._time);break}case"error":{g.error.push(s[m][0]._time);break}}return g}function Ec(t,e){if(!e)throw new Error("something went wrong!");const n=vc(t,e),o=[];if(n.warning.length&&o.push(`<b>Parity warning [${n.warning.length}]:</b> ${n.warning.filter(function(i,r,a){return!r||i!==a[r-1]}).sort((i,r)=>i-r).map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`),n.error.length&&o.push(`<b>Parity error [${n.error.length}]:</b> ${n.error.filter(function(i,r,a){return!r||i!==a[r-1]}).sort((i,r)=>i-r).map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`),o.length){const i=document.createElement("div");i.innerHTML=o.join("<br>"),Re.output.html=i}else Re.output.html=null}const ti=document.createElement("div"),Gt=document.createElement("input"),ei=document.createElement("label");ei.textContent=" Double-directional";ei.htmlFor="input__tools-dd-check";Gt.id="input__tools-dd-check";Gt.className="input-toggle";Gt.type="checkbox";Gt.checked=!0;Gt.addEventListener("change",$c);ti.appendChild(Gt);ti.appendChild(ei);const kn={name:"Double-directional",description:"Placeholder",type:"note",order:{input:99,output:140},input:{enabled:Gt.checked,params:{},html:ti},output:{html:null},run:Tc};function $c(){kn.input.enabled=this.checked}function wc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,i={},r={},a={},l={0:[],1:[],3:[]},s=[];for(let u=0,p=o.length;u<p;u++){const c=o[u];S(c)&&i[c._type]?I(c,i[c._type],n,l[c._type])?(a[c._type]&&(a[c._type]=null,r[c._type]=(r[c._type]+180)%360),Ce(c,r[c._type],45,!0)&&s.push(c),c._cutDirection===8?a[c._type]=c:r[c._type]=P(c),l[c._type]=[]):(a[c._type]&&Ce(c,r[c._type],45,!0)&&(s.push(c),a[c._type]=null,r[c._type]=P(c)),c._cutDirection!==8&&(a[c._type]=null,r[c._type]=P(c))):r[c._type]=P(c),i[c._type]=c,l[c._type].push(c),c._type===3&&(c._lineLayer===0&&(c._lineIndex===1&&(r[0]=it[0],a[0]=null),c._lineIndex===2&&(r[1]=it[0],a[1]=null)),c._lineLayer===2&&(c._lineIndex===1&&(r[0]=it[1],a[0]=null),c._lineIndex===2&&(r[1]=it[1],a[1]=null)))}return s.map(u=>u._time).filter(function(u,p,c){return!p||u!==c[p-1]})}function Tc(t,e){if(!e)throw new Error("something went wrong!");const n=wc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Double-directional [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,kn.output.html=o}else kn.output.html=null}const ba=.1,ya=.5,va={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}};let j;const M=document.createElement("div"),Vt=document.createElement("input"),ni=document.createElement("label"),Xt=document.createElement("input"),oi=document.createElement("label"),Tt=document.createElement("input"),ii=document.createElement("label"),Ct=document.createElement("input"),ri=document.createElement("label"),st=document.createElement("input"),ai=document.createElement("label"),Z=document.createElement("input"),li=document.createElement("label"),W=document.createElement("input"),si=document.createElement("label");ni.textContent=" Vision block";ni.htmlFor="input__tools-vb-check";Vt.id="input__tools-vb-check";Vt.className="input-toggle";Vt.type="checkbox";Vt.checked=!0;Vt.addEventListener("change",Lc);oi.textContent=" VB time specific ";oi.htmlFor="input__tools-vb-time-check";Xt.id="input__tools-vb-time-check";Xt.className="input-toggle";Xt.type="radio";Xt.name="input__tools-vb-spec";Xt.value="time";Xt.addEventListener("change",Ea);ii.textContent=" VB difficulty specific ";ii.htmlFor="input__tools-vb-diff-check";Tt.id="input__tools-vb-diff-check";Tt.className="input-toggle";Tt.type="radio";Tt.checked=!0;Tt.name="input__tools-vb-spec";Tt.value="difficulty";Tt.addEventListener("change",Ea);ri.textContent="min time (ms): ";ri.htmlFor="input__tools-vb-min-time";Ct.id="input__tools-vb-min-time";Ct.className="input-toggle input--small";Ct.type="number";Ct.min="0";Ct.value=h(ba*1e3,1).toString();Ct.addEventListener("change",xc);ai.textContent=" (beat): ";ai.htmlFor="input__tools-vb-min-beat";st.id="input__tools-vb-min-beat";st.className="input-toggle input--small";st.type="number";st.min="0";st.step="0.1";st.addEventListener("change",kc);li.textContent="max time (ms): ";li.htmlFor="input__tools-vb-max-time";Z.id="input__tools-vb-max-time";Z.className="input-toggle input--small";Z.type="number";Z.min="0";Z.value=h(ya*1e3,1).toString();Z.addEventListener("change",Mc);si.textContent=" (beat): ";si.htmlFor="input__tools-vb-max-beat";W.id="input__tools-vb-max-beat";W.className="input-toggle input--small";W.type="number";W.min="0";W.step="0.1";W.addEventListener("change",Sc);M.appendChild(Vt);M.appendChild(ni);M.appendChild(document.createElement("br"));M.appendChild(Xt);M.appendChild(oi);M.appendChild(Tt);M.appendChild(ii);M.appendChild(document.createElement("br"));M.appendChild(ri);M.appendChild(Ct);M.appendChild(ai);M.appendChild(st);M.appendChild(document.createElement("br"));M.appendChild(li);M.appendChild(Z);M.appendChild(si);M.appendChild(W);const L={name:"Slow Slider",description:"Placeholder",type:"note",order:{input:100,output:120},input:{enabled:Vt.checked,params:{specific:"difficulty",minTime:ba,maxTime:ya},html:M,adjustTime:Cc},output:{html:null},run:Ic};function Cc(t){j=t,st.value=h(j.toBeatTime(L.input.params.minTime),2).toString(),W.value=h(j.toBeatTime(L.input.params.maxTime),2).toString()}function Lc(){L.input.enabled=this.checked}function Ea(){L.input.params.specific=this.value}function xc(){L.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=h(L.input.params.minTime*1e3,1).toString(),j&&(st.value=h(j.toBeatTime(L.input.params.minTime),2).toString(),L.input.params.minTime>L.input.params.maxTime&&(L.input.params.maxTime=L.input.params.minTime,Z.value=h(L.input.params.maxTime*1e3,1).toString(),W.value=h(j.toBeatTime(L.input.params.maxTime),2).toString()))}function kc(){if(!j){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;L.input.params.minTime=j.toRealTime(t),Ct.value=h(L.input.params.minTime*1e3,1).toString(),this.value=h(t,2).toString(),L.input.params.minTime>L.input.params.maxTime&&(L.input.params.maxTime=L.input.params.minTime,Z.value=h(L.input.params.maxTime*1e3,1).toString(),W.value=h(j.toBeatTime(L.input.params.maxTime),2).toString())}function Mc(){L.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=h(L.input.params.maxTime*1e3,1).toString(),j&&(W.value=h(j.toBeatTime(L.input.params.maxTime),2).toString())}function Sc(){if(!j){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;L.input.params.maxTime=j.toRealTime(t),Z.value=h(L.input.params.maxTime*1e3,1).toString(),this.value=h(t,2).toString()}function Dc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,{minTime:r,maxTime:a,specific:l}=L.input.params,s=l==="time"?n.toBeatTime(r):n.toBeatTime(va[e._difficulty].min),u=l==="time"?n.toBeatTime(a):Math.min(o.hjd,n.toBeatTime(va[e._difficulty].max));let p,c;const g=[];for(let m=0,f=i.length;m<f;m++){const d=i[m];p&&(d._time-p._time>=s&&d._time-p._time<=u?d._lineIndex<2&&g.push(d):d._time-p._time>u&&(p=null)),c&&(d._time-c._time>=s&&d._time-c._time<=u?d._lineIndex>1&&g.push(d):d._time-c._time>u&&(c=null)),d._lineLayer===1&&d._lineIndex===1&&(p=d),d._lineLayer===1&&d._lineIndex===2&&(c=d)}return g.map(m=>m._time).filter(function(m,f,d){return!f||m!==d[f-1]})}function Ic(t,e){if(!e)throw new Error("something went wrong!");const n=Dc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Vision block [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,L.output.html=o}else L.output.html=null}const ci=document.createElement("div"),zt=document.createElement("input"),ui=document.createElement("label");ui.textContent=" Stacked note";ui.htmlFor="input__tools-stack-note-check";zt.id="input__tools-stack-note-check";zt.className="input-toggle";zt.type="checkbox";zt.checked=!0;zt.addEventListener("change",Rc);ci.appendChild(zt);ci.appendChild(ui);const Mn={name:"Stacked Note",description:"Placeholder",type:"note",order:{input:98,output:198},input:{enabled:zt.checked,params:{},html:ci},output:{html:null},run:Hc};function Rc(){Mn.input.enabled=this.checked}function Bc(t,e){const{_bpm:n}=t,{_notes:o}=e._data,i=[];let r=0;for(let a=0,l=o.length;a<l;a++)if(!(n.toRealTime(o[a]._time)<r+.01||o[a]._type===3))for(let s=a+1;s<l&&!(n.toRealTime(o[s]._time)>n.toRealTime(o[a]._time)+.01);s++)We(o[a],o[s])&&(i.push(o[a]),r=n.toRealTime(o[a]._time));return i.map(a=>a._time).filter(function(a,l,s){return!l||a!==s[l-1]})}function Pc(t,e){const{_bpm:n,_njs:o}=t,{_notes:i}=e._data,r=[];for(let a=0,l=i.length;a<l;a++)if(i[a]._type===3)for(let s=a+1;s<l&&!(n.toRealTime(i[s]._time)>n.toRealTime(i[a]._time)+1);s++)We(i[a],i[s])&&(o.value<n.value/(120*(i[s]._time-i[a]._time))||n.toRealTime(i[s]._time)<n.toRealTime(i[a]._time)+.02)&&r.push(i[a]);return r.map(a=>a._time).filter(function(a,l,s){return!l||a!==s[l-1]})}function Hc(t,e){if(!e)throw new Error("something went wrong!");const n=Bc(t,e),o=Pc(t,e),i=[];if(n.length&&i.push(`<b>Stacked note [${n.length}]:</b> ${n.map(r=>h(t._bpm.adjustTime(r),3)).join(", ")}`),o.length&&i.push(`<b>Stacked bomb [${o.length}]:</b> ${o.map(r=>h(t._bpm.adjustTime(r),3)).join(", ")}`),i.length){const r=document.createElement("div");r.innerHTML=i.join("<br>"),Mn.output.html=r}else Mn.output.html=null}const $a=[1,1,1],wa={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"},Ta=(t,e)=>{var i;let n=(i=Object.keys(t).find(r=>parseFloat(r)>=e))!=null?i:"100",o=parseFloat(n);return t[o]},mi=document.createElement("div"),Kt=document.createElement("input"),di=document.createElement("label");di.textContent=" Color check (EXPERIMENTAL)";di.htmlFor="input__tools-note-color-check";Kt.id="input__tools-note-color-check";Kt.className="input-toggle";Kt.type="checkbox";Kt.checked=!0;Kt.addEventListener("change",Nc);mi.appendChild(Kt);mi.appendChild(di);const Sn={name:"Color Check",description:"Placeholder",type:"note",order:{input:97,output:45},input:{enabled:Kt.checked,params:{},html:mi},output:{html:null},run:Ac};function Nc(){Sn.input.enabled=this.checked}function jc(t,e){var i,r,a,l;const n=(r=(i=e._info._customData)==null?void 0:i._colorLeft)!=null?r:B[R[e._environment]]._colorLeft,o=(l=(a=e._info._customData)==null?void 0:a._colorRight)!=null?l:B[R[e._environment]]._colorRight;return n&&o?co(Qe(n),Qe(o)):100}function Fc(t,e){var a,l,s,u;let n=100,o=100;const i=(l=(a=e._info._customData)==null?void 0:a._colorLeft)!=null?l:B[R[e._environment]]._colorLeft,r=(u=(s=e._info._customData)==null?void 0:s._colorRight)!=null?u:B[R[e._environment]]._colorRight;return i&&(n=co($a,Qe(i))),r&&(o=co($a,Qe(r))),Math.min(n,o)}function Ac(t,e){var r,a;if(!e)throw new Error("something went wrong!");if(!((r=e._info._customData)==null?void 0:r._colorLeft)&&!((a=e._info._customData)==null?void 0:a._colorRight))return;const n=jc(t,e),o=Fc(t,e),i=[];if(n<=20&&i.push(`<b>${Ta(wa,n)} note color (dE${h(n,1)}):</b> suggest change to better differentiate between 2 note colour`),o<=20&&i.push(`<b>${Ta(wa,o)} arrow note color (dE${h(o,1)}):</b> may be difficult to see the arrow`),i.length){const l=document.createElement("div");l.innerHTML=i.join("<br>"),Sn.output.html=l}else Sn.output.html=null}var Ca=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",effectiveBPM:H,acceptablePrec:pe,varySwing:vn,slowSlider:J,inlineAngle:X,shradoAngle:N,speedPause:K,hitboxStair:En,hitboxReverseStair:$n,hitboxInline:wn,hitboxPath:Tn,improperWindow:Cn,parity:Re,doubleDirectional:kn,visionBlock:L,stackedNote:Mn,colorCheck:Sn});const pi=document.createElement("div"),Wt=document.createElement("input"),hi=document.createElement("label");hi.textContent=" <15ms obstacle";hi.htmlFor="input__tools-short-obstacle-check";Wt.id="input__tools-short-obstacle-check";Wt.className="input-toggle";Wt.type="checkbox";Wt.checked=!0;Wt.addEventListener("change",Oc);pi.appendChild(Wt);pi.appendChild(hi);const Be={name:"Short Obstacle",description:"Placeholder",type:"obstacle",order:{input:0,output:50},input:{enabled:Wt.checked,params:{minDur:.015},html:pi},output:{html:null},run:Jc};function Oc(){Be.input.enabled=this.checked}function qc(t,e){const{_obstacles:n}=e._data,{_bpm:o}=t,{minDur:i}=Be.input.params,r=o.toBeatTime(i),a=[];let l={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0},s={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0},u={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0},p={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0};return n.forEach(c=>{c._type===0&&c._duration>0?c._width>2||c._width>1&&c._lineIndex===1?(w(c,l)&&(c._duration<r&&a.push(c),l=c),w(c,s)&&(c._duration<r&&a.push(c),s=c)):c._width===2?c._lineIndex===0?w(c,l)&&(c._duration<r&&a.push(c),l=c):c._lineIndex===2&&w(c,s)&&(c._duration<r&&a.push(c),s=c):c._width===1&&(c._lineIndex===1?w(c,l)&&(c._duration<r&&a.push(c),l=c):c._lineIndex===2&&w(c,s)&&(c._duration<r&&a.push(c),s=c)):c._type===1&&c._duration>0&&(c._width>2||c._width>1&&c._lineIndex===1?(w(c,u)&&(c._duration<r&&w(c,l,r)&&w(c,u,r)&&a.push(c),u=c),w(c,p)&&(c._duration<r&&w(c,s,r)&&w(c,p,r)&&a.push(c),p=c)):c._width===2?c._lineIndex===0?w(c,u)&&(c._duration<r&&w(c,l,r)&&w(c,u,r)&&a.push(c),u=c):c._lineIndex===2&&w(c,p)&&(c._duration<r&&w(c,s,r)&&w(c,p,r)&&a.push(c),p=c):c._width===1&&(c._lineIndex===1?w(c,u)&&(c._duration<r&&w(c,l,r)&&w(c,u,r)&&a.push(c),u=c):c._lineIndex===2&&w(c,p)&&(c._duration<r&&w(c,s,r)&&w(c,p,r)&&a.push(c),p=c)))}),a.map(c=>c._time).filter(function(c,g,m){return!g||c!==m[g-1]})}function Jc(t,e){if(!e)throw new Error("something went wrong!");const n=qc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b><15ms obstacle [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,Be.output.html=o}else Be.output.html=null}const La=.25;let be;const Lt=document.createElement("div"),Yt=document.createElement("input"),_i=document.createElement("label"),xt=document.createElement("input"),fi=document.createElement("label"),ct=document.createElement("input"),gi=document.createElement("label");_i.textContent=" 2-wide center obstacle";_i.htmlFor="input__tools-center-obstacle-check";Yt.id="input__tools-center-obstacle-check";Yt.className="input-toggle";Yt.type="checkbox";Yt.checked=!0;Yt.addEventListener("change",Gc);fi.textContent="recovery time (ms): ";fi.htmlFor="input__tools-2wide-wall-time";xt.id="input__tools-2wide-wall-time";xt.className="input-toggle input--small";xt.type="number";xt.min="0";xt.value=h(La*1e3,1).toString();xt.addEventListener("change",Vc);gi.textContent=" (beat): ";gi.htmlFor="input__tools-2wide-wall-beat";ct.id="input__tools-2wide-wall-beat";ct.className="input-toggle input--small";ct.type="number";ct.min="0";ct.step="0.1";ct.addEventListener("change",Xc);Lt.appendChild(Yt);Lt.appendChild(_i);Lt.appendChild(document.createElement("br"));Lt.appendChild(fi);Lt.appendChild(xt);Lt.appendChild(gi);Lt.appendChild(ct);const U={name:"2-wide Center Obstacle",description:"Placeholder",type:"obstacle",order:{input:10,output:60},input:{enabled:Yt.checked,params:{recovery:La},html:Lt,adjustTime:Uc},output:{html:null},run:Kc};function Uc(t){be=t,ct.value=h(be.toBeatTime(U.input.params.recovery),2).toString()}function Gc(){U.input.enabled=this.checked}function Vc(){U.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=h(U.input.params.recovery*1e3,1).toString(),be&&(ct.value=h(be.toBeatTime(U.input.params.recovery),2).toString())}function Xc(){if(!be){this.value="0";return}let t=h(Math.abs(parseFloat(this.value)),2)||1;U.input.params.recovery=be.toRealTime(t),xt.value=h(U.input.params.recovery*1e3,1).toString(),this.value=t.toString()}function zc(t,e){const{_obstacles:n}=e._data,{_bpm:o}=t,{recovery:i}=U.input.params,r=[];let a={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0},l={_time:0,_duration:0,_lineIndex:0,_type:0,_width:0};return n.forEach(s=>{s._type===0&&(s._width>2&&(r.push(s),w(s,a)&&(a=s),w(s,l)&&(l=s)),s._width===2&&(s._lineIndex===0&&w(s,a)&&(o.toRealTime(s._time)>o.toRealTime(l._time)-i&&o.toRealTime(s._time)<o.toRealTime(l._time+l._duration)+i&&r.push(s),a=s),s._lineIndex===1&&(r.push(s),w(s,a)&&(a=s),w(s,l)&&(l=s)),s._lineIndex===2&&w(s,l)&&(o.toRealTime(s._time)>o.toRealTime(a._time)-i&&o.toRealTime(s._time)<o.toRealTime(a._time+a._duration)+i&&r.push(s),l=s)),s._width===1&&(s._lineIndex===1&&w(s,a)&&(o.toRealTime(s._time)>o.toRealTime(l._time)-i&&o.toRealTime(s._time)<o.toRealTime(l._time+l._duration)+i&&r.push(s),a=s),s._lineIndex===2&&w(s,l)&&(o.toRealTime(s._time)>o.toRealTime(a._time)-i&&o.toRealTime(s._time)<o.toRealTime(a._time+a._duration)+i&&r.push(s),l=s)))}),r.map(s=>s._time).filter(function(s,u,p){return!u||s!==p[u-1]})}function Kc(t,e){if(!e)throw new Error("something went wrong!");const n=zc(t,e),{recovery:o}=U.input.params;if(n.length){const i=document.createElement("div");i.innerHTML=`<b>2-wide center obstacle (<${h(o*1e3)}ms) [${n.length}]:</b> ${n.map(r=>h(t._bpm.adjustTime(r),3)).join(", ")}`,U.output.html=i}else U.output.html=null}const bi=document.createElement("div"),Zt=document.createElement("input"),yi=document.createElement("label");yi.textContent=" Zero width/duration obstacle";yi.htmlFor="input__tools-zero-obstacle-check";Zt.id="input__tools-zero-obstacle-check";Zt.className="input-toggle";Zt.type="checkbox";Zt.checked=!0;Zt.addEventListener("change",Wc);bi.appendChild(Zt);bi.appendChild(yi);const Dn={name:"Negative Obstacle",description:"Placeholder",type:"obstacle",order:{input:20,output:70},input:{enabled:Zt.checked,params:{},html:bi},output:{html:null},run:Zc};function Wc(){Dn.input.enabled=this.checked}function Yc(t,e){const{_obstacles:n}=e._data;return n.filter(o=>o._width===0||o._duration===0).map(o=>o._time)}function Zc(t,e){if(!e)throw new Error("something went wrong!");const n=Yc(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Zero width/duration obstacle [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,Dn.output.html=o}else Dn.output.html=null}const vi=document.createElement("div"),Qt=document.createElement("input"),Ei=document.createElement("label");Ei.textContent=" Negative obstacle";Ei.htmlFor="input__tools-negative-obstacle-check";Qt.id="input__tools-negative-obstacle-check";Qt.className="input-toggle";Qt.type="checkbox";Qt.checked=!0;Qt.addEventListener("change",Qc);vi.appendChild(Qt);vi.appendChild(Ei);const In={name:"Negative Obstacle",description:"Placeholder",type:"obstacle",order:{input:30,output:80},input:{enabled:Qt.checked,params:{},html:vi},output:{html:null},run:eu};function Qc(){In.input.enabled=this.checked}function tu(t,e){var o,i,r,a;const{_obstacles:n}=e._data;return((i=(o=e._info._customData)==null?void 0:o._requirements)==null?void 0:i.includes("Mapping Extensions"))||((a=(r=e._info._customData)==null?void 0:r._requirements)==null?void 0:a.includes("Noodle Extensions"))?[]:n.filter(l=>l._width<0||l._duration<0).map(l=>l._time)}function eu(t,e){if(!e)throw new Error("something went wrong!");const n=tu(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Negative obstacle [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,In.output.html=o}else In.output.html=null}var xa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",shortObstacle:Be,centerObstacle:U,zeroObstacle:Dn,negativeObstacle:In});const $i=document.createElement("div"),te=document.createElement("input"),wi=document.createElement("label");wi.textContent=" Insufficient lighting event";wi.htmlFor="input__tools-insufficient-light-check";te.id="input__tools-insufficient-light-check";te.className="input-toggle";te.type="checkbox";te.checked=!0;te.addEventListener("change",nu);$i.appendChild(te);$i.appendChild(wi);const Rn={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:0,output:0},input:{enabled:te.checked,params:{},html:$i},output:{html:null},run:iu};function nu(){Rn.input.enabled=this.checked}const ou=t=>{let e=0;for(let n=t.length-1;n>=0;n--)if(Ze(t[n])&&t[n]._value!==0&&t[n]._value!==4&&(e++,e>10))return!0;return!1};function iu(t,e){if(!e)throw new Error("something went wrong!");if(ou(e._data._events))Rn.output.html=null;else{const o=document.createElement("div");o.innerHTML="<b>Insufficient lighting event</b>",Rn.output.html=o}}const Ti=document.createElement("div"),ee=document.createElement("input"),Ci=document.createElement("label");Ci.textContent=" Old value 4 event";Ci.htmlFor="input__tools-light-4";ee.id="input__tools-light-4";ee.className="input-toggle";ee.type="checkbox";ee.checked=!0;ee.addEventListener("change",ru);Ti.appendChild(ee);Ti.appendChild(Ci);const Bn={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:1,output:1},input:{enabled:ee.checked,params:{},html:Ti},output:{html:null},run:lu};function ru(){Bn.input.enabled=this.checked}function au(t,e){const{_events:n}=e._data,o=[];if(br(e._data._version,"difficulty")==="old")for(let i=n.length-1;i>=0;i--)Ze(n[i])&&n[i]._value===4&&o.push(n[i]);else return[];return o.map(i=>i._time).filter(function(i,r,a){return!r||i!==a[r-1]})}function lu(t,e){if(!e)throw new Error("something went wrong!");const n=au(t,e);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Event with value 4 [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,Bn.output.html=o}else Bn.output.html=null}const Li=document.createElement("div"),ne=document.createElement("input"),xi=document.createElement("label");xi.textContent=" Unlit bomb";xi.htmlFor="input__tools-unlit-bomb";ne.id="input__tools-unlit-bomb";ne.className="input-toggle";ne.type="checkbox";ne.checked=!0;ne.addEventListener("change",su);Li.appendChild(ne);Li.appendChild(xi);const Pn={name:"Unlit Bomb",description:"Placeholder",type:"event",order:{input:3,output:203},input:{enabled:ne.checked,params:{},html:Li},output:{html:null},run:uu};function su(){Pn.input.enabled=this.checked}const cu=(t,e,n,o)=>{var p,c;if(!e.length)return[];const i=[],r=e.filter(g=>Ze(g)&&Zn[o].includes(g._type)).sort((g,m)=>g._type-m._type),a={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},l={};Zn[o].forEach(g=>l[g]=[[0,!1]]);const s=n.toBeatTime(1),u=n.toBeatTime(.25);for(let g=0,m=r.length;g<m;g++){const f=r[g];if((Al(f)||Ol(f))&&a[f._type].state!=="on"){a[f._type]={state:"on",time:f._time,fadeTime:0};const d=l[f._type].find(E=>E[0]>=f._time);d?(d[0]=f._time,d[1]=!0):l[f._type].push([f._time,!0])}if(ql(f)){a[f._type]={state:"off",time:f._time,fadeTime:s};const d=l[f._type].find(E=>E[0]>=f._time);d?(d[0]=f._time,d[1]=!0):l[f._type].push([f._time,!0]),l[f._type].push([f._time+s,!1])}(((p=f==null?void 0:f._floatValue)!=null?p:1)<.25||Fl(f)||((c=f._customData)==null?void 0:c._color)&&(typeof f._customData._color[3]=="number"&&f._customData._color[3]<.25||Math.max(...f._customData._color)<.25))&&a[f._type].state!=="off"&&(a[f._type]={state:"off",time:f._time,fadeTime:a[f._type].state==="on"?u:Math.min(u,a[f._type].fadeTime)},l[f._type].push([f._time+(a[f._type].state==="on"?u:Math.min(u,a[f._type].fadeTime)),!1]))}for(const g in l)l[g].reverse();for(let g=0,m=t.length,f=!1;g<m;g++){const d=t[g];if(!!Dl(d)){f=!1;for(const E in l){const y=l[E].find(v=>v[0]<=d._time);y&&(f=f||y[1])}f||i.push(d)}}return i.map(g=>g._time).filter(function(g,m,f){return!m||g!==f[m-1]})};function uu(t,e){if(!e)throw new Error("something went wrong!");const n=cu(e._data._notes,e._data._events,t._bpm,e._environment);if(n.length){const o=document.createElement("div");o.innerHTML=`<b>Unlit bomb [${n.length}]:</b> ${n.map(i=>h(t._bpm.adjustTime(i),3)).join(", ")}`,Pn.output.html=o}else Pn.output.html=null}const ki=document.createElement("div"),oe=document.createElement("input"),Mi=document.createElement("label");Mi.textContent=" Event peak (1 second) and per second";Mi.htmlFor="input__tools-light-stats";oe.id="input__tools-light-stats";oe.className="input-toggle";oe.type="checkbox";oe.checked=!1;oe.addEventListener("change",mu);ki.appendChild(oe);ki.appendChild(Mi);const Hn={name:"Insufficient Light",description:"Placeholder",type:"event",order:{input:2,output:2},input:{enabled:oe.checked,params:{},html:ki},output:{html:null},run:pu};function mu(){Hn.input.enabled=this.checked}function du(t,e){const{_bpm:n,_audioDuration:o}=t,{_events:i}=e._data;let r=n.toBeatTime(1),a=0,l=0;for(let s=0;s<i.length;s++){for(;i[s]._time-i[l]._time>r;)l++;a=Math.max(a,(s-l+r)/(1/n.value*60))}return{EPS:o?h(i.length/o,3):0,peakEPS:h(a,3)}}function pu(t,e){if(!e)throw new Error("something went wrong!");const n=du(t,e);if(n){const o=document.createElement("div");o.innerHTML=`<b>Events per second:</b> ${n.EPS}<br><b>Peak Event (1s):</b> ${n.peakEPS}`,Hn.output.html=o}else Hn.output.html=null}var ka=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",insufficientLight:Rn,oldEventValue:Bn,unlitBomb:Pn,testEvent:Hn});const Ma=1.5,Si=document.createElement("div"),kt=document.createElement("input"),Di=document.createElement("label");Di.textContent="Hot start (s): ";Di.htmlFor="input__tools-hot-start";kt.id="input__tools-hot-start";kt.className="input-toggle input--small";kt.type="number";kt.min="0";kt.step="0.1";kt.value=Ma.toString();kt.addEventListener("change",hu);Si.appendChild(Di);Si.appendChild(kt);const ye={name:"Hot Start",description:"Placeholder",type:"other",order:{input:0,output:0},input:{enabled:!0,params:{time:Ma},html:Si},output:{html:null},run:_u};function hu(){ye.input.params.time=h(Math.abs(parseFloat(this.value)),3),this.value=ye.input.params.time.toString()}function _u(t,e){if(!e)throw new Error("something went wrong!");const{time:n}=ye.input.params,o=t._bpm.toRealTime(fr(e._data));if(o<n){const i=document.createElement("div");i.innerHTML=`<b>Hot start:</b> ${h(o,2)}s`,ye.output.html=i}else ye.output.html=null}const Ii={name:"Difficulty Label",description:"Placeholder",type:"other",order:{input:30,output:30},input:{enabled:!0,params:{}},output:{html:null},run:fu};function fu(t,e){var o;if(!e)throw new Error("something went wrong!");const n=(o=e._info._customData)==null?void 0:o._difficultyLabel;if(n&&n.length>30){const i=document.createElement("div");i.innerHTML=`<b>Difficulty label is too long (${n.length} characters):</b> exceeded 30 max characters by ranking criteria`,Ii.output.html=i}else Ii.output.html=null}const Ri={name:"Note Jump Speed",description:"Placeholder",type:"other",order:{input:40,output:40},input:{enabled:!0,params:{}},output:{html:null},run:gu};function gu(t,e){if(!e)throw new Error("something went wrong!");const{_njs:n,_bpm:o}=t,i=[];if(e._info._noteJumpMovementSpeed===0&&i.push("<b>Unset NJS</b>: fallback NJS is used"),n.value>23&&i.push(`<b>NJS is too high (${h(n.value,2)}):</b> use lower whenever necessary`),n.jd<18&&i.push(`<b>Very low jump distance:</b> ${h(n.jd,2)}`),n.jd>36&&i.push(`<b>Very high jump distance:</b> ${h(n.jd,2)}`),n.jd>n.calcJumpDistanceOptimalHigh()&&i.push(`<b>High jump distance warning (>${h(n.calcJumpDistanceOptimalHigh(),2)}):</b> ${h(n.jd,2)} at ${h(n.value,2)} NJS may be uncomfortable to play`),o.toRealTime(n.hjd)<.45&&i.push(`<b>Very quick reaction time (${h(o.toRealTime(n.hjd)*1e3)}ms):</b> may lead to suboptimal gameplay`),n.calcHalfJumpDurationRaw()+n.offset<n.hjdMin&&i.push(`<b>Unnecessary negative offset:</b> will not drop below ${n.hjdMin}`),i.length){const r=document.createElement("div");r.innerHTML=i.join("<br>"),Ri.output.html=r}else Ri.output.html=null}const Bi=document.createElement("div"),ie=document.createElement("input"),Pi=document.createElement("label");Pi.textContent=" Outside playable object";Pi.htmlFor="input__tools-outside-object-check";ie.id="input__tools-outside-object-check";ie.className="input-toggle";ie.type="checkbox";ie.checked=!0;ie.addEventListener("change",bu);Bi.appendChild(ie);Bi.appendChild(Pi);const Nn={name:"Difficulty Label",description:"Placeholder",type:"other",order:{input:10,output:10},input:{enabled:ie.checked,params:{},html:Bi},output:{html:null},run:yu};function bu(){Nn.input.enabled=this.checked}function yu(t,e){if(!e)throw new Error("something went wrong!");const{_bpm:n,_audioDuration:o}=t,{_notes:i,_obstacles:r,_events:a}=e._data,l=[];if(o){let s=n.toBeatTime(o);i.length&&i[0]._time<0&&l.push(`<b>Note(s) before start time:</b> ${h(i[0]._time,3)} (${A(n.toRealTime(i[0]._time))})`),r.length&&r[0]._time<0&&l.push(`<b>Obstacle(s) before start time:</b> ${h(r[0]._time,3)} (${A(n.toRealTime(r[0]._time))})`),a.length&&a[0]._time<0&&l.push(`<b>Event(s) before start time:</b> ${h(a[0]._time,3)} (${A(n.toRealTime(a[0]._time))})`),i.length&&i[i.length-1]._time>s&&l.push(`<b>Note(s) after end time:</b> ${h(i[i.length-1]._time,3)} (${A(n.toRealTime(i[i.length-1]._time))})`),r.length&&r[r.length-1]._time>s&&l.push(`<b>Obstacle(s) after end time:</b> ${h(r[r.length-1]._time,3)} (${A(n.toRealTime(r[r.length-1]._time))})`),a.length&&a[a.length-1]._time>s&&l.push(`<b>Event(s) after end time:</b> ${h(a[a.length-1]._time,3)} (${A(n.toRealTime(a[a.length-1]._time))})`)}if(l.length){const s=document.createElement("div");s.innerHTML=l.join("<br>"),Nn.output.html=s}else Nn.output.html=null}const Hi=document.createElement("div"),re=document.createElement("input"),Ni=document.createElement("label");Ni.textContent=" Invalid object";Ni.htmlFor="input__tools-invalid-object-check";re.id="input__tools-invalid-object-check";re.className="input-toggle";re.type="checkbox";re.checked=!0;re.addEventListener("change",vu);Hi.appendChild(re);Hi.appendChild(Ni);const jn={name:"Invalid Object",description:"Placeholder",type:"other",order:{input:20,output:20},input:{enabled:re.checked,params:{},html:Hi},output:{html:null},run:Eu};function vu(){jn.input.enabled=this.checked}function Eu(t,e){var p,c,g,m;if(!e)throw new Error("something went wrong!");const{_bpm:n}=t,{_notes:o,_obstacles:i,_events:r}=e._data;let a=[],l=[];((c=(p=e._info._customData)==null?void 0:p._requirements)==null?void 0:c.includes("Mapping Extensions"))||(((m=(g=e._info._customData)==null?void 0:g._requirements)==null?void 0:m.includes("Noodle Extensions"))?(a=o.filter(f=>Cr(f)&&!Rl(f)).map(f=>f._time),l=i.filter(f=>to(f)&&!_r(f)).map(f=>f._time)):(a=o.filter(f=>!Pl(f)).map(f=>f._time),l=i.filter(f=>!$l(f)).map(f=>f._time)));const s=r.filter(f=>!zl(f)).map(f=>f._time),u=[];if(a.length&&u.push(`<b>Invalid note [${a.length}]:</b> ${a.map(f=>h(n.adjustTime(f),3)).join(", ")}`),l.length&&u.push(`<b>Invalid obstacle [${l.length}]:</b> ${l.map(f=>h(n.adjustTime(f),3)).join(", ")}`),s.length&&u.push(`<b>Invalid event [${s.length}]:</b> ${s.map(f=>h(n.adjustTime(f),3)).join(", ")}`),u.length){const f=document.createElement("div");f.innerHTML=u.join("<br>"),jn.output.html=f}else jn.output.html=null}var Sa=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",hotStart:ye,difficultyLabel:Ii,njs:Ri,outsidePlayable:Nn,invalidObject:jn});const Da=()=>Object.keys(Ca).map(t=>Ca[t]),Ia=()=>Object.keys(xa).map(t=>xa[t]),Ra=()=>Object.keys(ka).map(t=>ka[t]),Ba=()=>Object.keys(Sa).map(t=>Sa[t]),Pa=()=>Object.keys(sa).map(t=>sa[t]),Ha=()=>[...Da(),...Ia(),...Ra(),...Ba()],$u=()=>[...Da(),...Ia(),...Ra(),...Ba(),...Pa()],ji=()=>{b._analysis={general:{html:null},mapSet:[],missing:[],sps:[]}},wu=()=>{var s,u,p;const t=b._mapInfo;if(!t){console.error("could not analyse, missing map info");return}b._analysis||ji();const e=(s=b._analysis)==null?void 0:s.general,n=(u=b._analysis)==null?void 0:u.sps,o=ot(t._beatsPerMinute),i=no(o),r={_bpm:o,_njs:i,_audioDuration:(p=b._duration)!=null?p:null,_mapDuration:0},a=Pa().sort((c,g)=>c.order.output-g.order.output);console.log("analysing general");const l=[];a.forEach(c=>{if(c.input.enabled)try{c.run(r,void 0,t,n),c.output.html&&l.push(c.output.html)}catch(g){console.error(g)}}),e&&(e.html=l)},Na=(t,e)=>{var p,c,g,m,f,d,E;const n=b._mapInfo;if(!n){console.error("could not analyse, missing map info");return}const o=(p=b._mapSet)==null?void 0:p.find(y=>y._mode===t&&y._difficulty===e);if(!o){console.error("could not analyse, missing map data");return}b._analysis||ji();const i=(c=b._analysis)==null?void 0:c.mapSet.find(y=>y.difficulty===e&&y.mode===t),r=ot(n._beatsPerMinute,((g=o._data._customData)==null?void 0:g._BPMChanges)||((m=o._data._customData)==null?void 0:m._bpmChanges),(f=o._info._customData)==null?void 0:f._editorOffset),a=no(r,o._info._noteJumpMovementSpeed,o._info._noteJumpStartBeatOffset),l={_bpm:r,_njs:a,_audioDuration:(d=b._duration)!=null?d:null,_mapDuration:r.toRealTime(ze(o._data))},s=Ha().sort((y,v)=>y.order.output-v.order.output);console.log(`analysing ${t} ${e}`);const u=[];s.forEach(y=>{if(y.input.enabled)try{y.run(l,o,n),y.output.html&&u.push(y.output.html)}catch(v){console.error(v)}}),i?i.html=u:(E=b._analysis)==null||E.mapSet.push({mode:t,difficulty:e,html:u})},Tu=t=>{Ha().sort((n,o)=>n.order.output-o.order.output).forEach(n=>{n.input.adjustTime&&n.input.adjustTime(t)})},Cu=()=>{var n;let t=b._mapInfo;if(!t){console.error("could not analyse, missing map info");return}let e=ot(t._beatsPerMinute);b._analysis||ji(),(n=b._mapSet)==null||n.forEach(o=>{var i;return(i=b._analysis)==null?void 0:i.sps.push({mode:o._mode,difficulty:o._difficulty,sps:aa(o,e)})})},ja=()=>{var t;(t=b._mapSet)==null||t.forEach(e=>Na(e._mode,e._difficulty))},G="UI Tools: ",Mt=document.querySelectorAll(".tools__select-mode"),St=document.querySelectorAll(".tools__select-difficulty"),Lu=document.querySelectorAll(".difficulty__label"),Fi=document.querySelector(".tools__note-content"),Ai=document.querySelector(".tools__obstacle-content"),Oi=document.querySelector(".tools__event-content"),qi=document.querySelector(".tools__other-content"),Q=document.querySelector(".tools__output-diff"),tt=document.querySelector(".tools__output-general"),Fa=document.querySelector(".tools__apply-this"),Aa=document.querySelector(".tools__apply-all");(!Fi||!Ai||!Oi||!qi)&&console.error(G+"missing content element");(!Q||!tt)&&console.error(G+"missing output element");Fa&&Aa?(Fa.addEventListener("click",Du),Aa.addEventListener("click",Iu)):console.error(G+"missing apply element");Mt.forEach(t=>t.addEventListener("change",Mu));St.forEach(t=>t.addEventListener("change",Su));const xu=()=>{var e;if(!tt)throw new Error(G+"output general is missing");const t=(e=b._analysis)==null?void 0:e.general;if(!t){tt.textContent="ERROR: could not find analysis for general";return}if(!t.html){tt.textContent="ERROR: could not find HTML for general";return}tt.innerHTML="",t.html.forEach(n=>tt.appendChild(n)),tt.firstChild||(tt.textContent="No issues found.")},Pe=(t,e)=>{var o;if(!t&&!e&&(t=Mt[0].value,e=St[0].value),!t||!e)throw new Error(G+"something went wrong!");if(!Q)throw new Error(G+"output difficulty is missing");Q.innerHTML="";const n=(o=b._analysis)==null?void 0:o.mapSet.find(i=>i.difficulty===e&&i.mode===t);if(!n){Q.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!n.html){Q.textContent="ERROR: could not find HTML for "+t+" "+e;return}n.html.forEach(i=>Q.appendChild(i)),Q.firstChild||(Q.textContent="No issues found.")},Ji=t=>{Lu.forEach(e=>e.textContent=t)},Oa=t=>{if(!t)return;St.forEach(n=>{for(let o=n.options.length-1;o>=0;o--)n.remove(o)});let e=!0;t._difficultyBeatmaps.forEach(n=>{St.forEach(o=>{var r,a,l,s;const i=document.createElement("option");if(i.value=n._difficulty,i.textContent=ce[n._difficulty]+(((r=n._customData)==null?void 0:r._difficultyLabel)?" -- "+((a=n._customData)==null?void 0:a._difficultyLabel):""),e){const u=(l=b._mapSet)==null?void 0:l.find(p=>p._difficulty===n._difficulty&&p._mode===t._beatmapCharacteristicName);if(!u)throw new Error("missing _mapSetData");Zr(u),Ji(((s=n._customData)==null?void 0:s._difficultyLabel)||ce[n._difficulty]),Pe(t._beatmapCharacteristicName,n._difficulty)}e=!1,o.add(i)})})},qa=t=>{if(!t){Mt.forEach(n=>Jn(n)),St.forEach(n=>Jn(n));return}let e=!0;t._difficultyBeatmapSets.forEach(n=>{Mt.forEach(o=>{const i=document.createElement("option");i.value=n._beatmapCharacteristicName,i.textContent=hr[n._beatmapCharacteristicName],o.add(i)}),e&&Oa(n),e=!1})},ku=()=>{const t=b._mapInfo;if(!t)throw new Error(G+"could not find map info");const e=ot(t._beatsPerMinute);Tu(e)};function Mu(t){var o;const e=t.target;Mt.forEach(i=>{i!==e&&(i.value=e.value)});const n=(o=b._mapInfo)==null?void 0:o._difficultyBeatmapSets.find(i=>i._beatmapCharacteristicName===e.value);Oa(n)}function Su(t){var i,r,a,l;const e=t.target;St.forEach(s=>{s!==e&&(s.value=e.value)});const n=(i=b._mapInfo)==null?void 0:i._difficultyBeatmapSets.find(s=>s._beatmapCharacteristicName===Mt.item(0).value);if(!n)throw new Error("aaaaaaaaaaaaaaaaaaa");const o=(r=b._mapSet)==null?void 0:r.find(s=>s._difficulty===e.value&&s._mode===n._beatmapCharacteristicName);o&&(Zr(o),Ji(((l=(a=o._info)==null?void 0:a._customData)==null?void 0:l._difficultyLabel)||ce[e.value]),Pe(o._mode,o._difficulty))}function Du(){const t=Mt[0].value,e=St[0].value;if(!t||!e)throw new Error(G+"mode/difficulty does not exist");T("info",`Re-analysing ${t} ${e}`,100),Na(t,e),T("info",`Re-analysed ${t} ${e}`,100),Pe(t,e)}function Iu(){const t=Mt[0].value,e=St[0].value;if(!t||!e)throw new Error(G+"mode/difficulty does not exist");T("info","Re-analysing all difficulties",100),ja(),T("info","Re-analysed all difficulties",100),Pe(t,e)}const Ru=()=>{if(!Fi||!Ai||!Oi||!qi){console.error(G+"could not find tools content");return}$u().sort((e,n)=>e.order.input-n.order.input).forEach(e=>{if(e.input.html)switch(e.type){case"note":{Fi.appendChild(e.input.html);break}case"obstacle":{Ai.appendChild(e.input.html);break}case"event":{Oi.appendChild(e.input.html);break}case"other":{qi.appendChild(e.input.html);break}case"general":{console.log(G+"ignoring general tool for "+e.name);break}default:console.error(G+"could not recognise type "+e.type+" for "+e.name)}})},Bu=()=>{tt&&(tt.innerHTML="No output."),Q&&(Q.innerHTML="No output.")},Pu=()=>{Bu(),Ji("Difficulty Label"),qa()},et="UI Stats: ",_="stats__",ve=document.querySelector("#stats .accordion__collapsible"),Hu=(t,e)=>{const n=ot(t._beatsPerMinute),o=no(n,e._info._noteJumpMovementSpeed||oo[e._difficulty],e._info._noteJumpStartBeatOffset),i=document.createElement("table");return i.className=_+"table",i.innerHTML=`<caption class="${_}table-caption">Map Settings:</caption>
    <tr>
    <th class="${_}table-header" colspan="2">Note Jump Speed</th>
    <td class="${_}table-element">${h(o.value,3)}</td>
    </tr>
    <tr>
    <th class="${_}table-header" colspan="2">Spawn Distance Modifier</th>
    <td class="${_}table-element">${h(o.offset,3)}</td>
    </tr>
    <tr>
    <th class="${_}table-header" colspan="2">Half Jump Duration</th>
    <td class="${_}table-element">${h(o.hjd,3)}</td>
    </tr>
    <tr>
    <th class="${_}table-header" colspan="2">Jump Distance</th>
    <td class="${_}table-element">${h(o.jd,3)}</td>
    </tr>
    <tr>
    <th class="${_}table-header" colspan="2">Reaction Time</th>
    <td class="${_}table-element">${h(o.reactTime*1e3)}ms</td>
    </tr>`,i},Nu=(t,e)=>{const n=ot(t._beatsPerMinute),o=b._duration||0,i=n.toRealTime(ze(e._data)),r=document.createElement("table");return r.className=_+"table",r.innerHTML=`<caption class="${_}table-caption">Note Per Seconds (NPS):</caption>
    <tr>
    <th class="${_}table-header" colspan="2">Overall</th>
    <td class="${_}table-element">${h(xr(e._data._notes,o),2)}</td>
    </tr>
    <tr>
    <th class="${_}table-header" colspan="2">Mapped</th>
    <td class="${_}table-element">${h(xr(e._data._notes,i),2)}</td>
    </tr>
    <tr>
    <th class="${_}table-header" rowspan="3">Peak</th>
    <th class="${_}table-header">16-beat</th>
    <td class="${_}table-element">${h(lo(e._data._notes,16,n.value),2)}</td>
    </tr>
    <tr>
    <th class="${_}table-header">8-beat</th>
    <td class="${_}table-element">${h(lo(e._data._notes,8,n.value),2)}</td>
    </tr>
    <tr>
    <th class="${_}table-header">4-beat</th>
    <td class="${_}table-element">${h(lo(e._data._notes,4,n.value),2)}</td>
    </tr>`,r},ju=(t,e)=>{const n=ot(t._beatsPerMinute),o=aa(e,n),i=document.createElement("table");return i.className=_+"table",i.innerHTML=`<caption class="${_}table-caption">Swing Per Seconds (SPS):</caption>
    <tr>
    <th class="${_}table-header"></th>
    <th class="${_}table-header">Total</th>
    <th class="${_}table-header">Red</th>
    <th class="${_}table-header">Blue</th>
    </tr>
    <tr>
    <th class="${_}table-header">Overall</th>
    <td class="${_}table-element">${h(o.total.overall,2)}</td>
    <td class="${_}table-element">${h(o.red.overall,2)}</td>
    <td class="${_}table-element">${h(o.blue.overall,2)}</td>
    </tr>
    <tr>
    <th class="${_}table-header">Median</th>
    <td class="${_}table-element">${h(o.total.median,2)}</td>
    <td class="${_}table-element">${h(o.red.median,2)}</td>
    <td class="${_}table-element">${h(o.blue.median,2)}</td>
    </tr>
    <tr>
    <th class="${_}table-header">Peak</th>
    <td class="${_}table-element">${h(o.total.peak,2)}</td>
    <td class="${_}table-element">${h(o.red.peak,2)}</td>
    <td class="${_}table-element">${h(o.blue.peak,2)}</td>
    </tr>
    <tr>
    <th class="${_}table-header">Total</th>
    <td class="${_}table-element">${o.total.total}</td>
    <td class="${_}table-element">${o.red.total}</td>
    <td class="${_}table-element">${o.blue.total}</td>
    </tr>`,i},Fu=(t,e)=>{const n=Lr(e._data._notes);let o=`<caption class="${_}table-caption">Notes: ${n.red.total+n.blue.total}<br>R/B Ratio: ${h(n.red.total/n.blue.total,2)}</caption>
    <tr>
    <th class="${_}table-header"></th>
    <th class="${_}table-header">Red</th>
    <th class="${_}table-header">Blue</th>
    <th class="${_}table-header">Bomb</th>
    </tr>
    <tr>
    <th class="${_}table-header">Total</th>
    <td class="${_}table-element">${n.red.total}</td>
    <td class="${_}table-element">${n.blue.total}</td>
    <td class="${_}table-element">${n.bomb.total}</td>
    </tr>`;(n.red.chroma||n.blue.chroma||n.bomb.chroma)&&(o+=`<tr>
        <th class="${_}table-header">Chroma</th>
        <td class="${_}table-element">${n.red.chroma}</td>
        <td class="${_}table-element">${n.blue.chroma}</td>
        <td class="${_}table-element">${n.bomb.chroma}</td>
        </tr>`),(n.red.noodleExtensions||n.blue.noodleExtensions||n.bomb.noodleExtensions)&&(o+=`<tr>
        <th class="${_}table-header">NE</th>
        <td class="${_}table-element">${n.red.noodleExtensions}</td>
        <td class="${_}table-element">${n.blue.noodleExtensions}</td>
        <td class="${_}table-element">${n.bomb.noodleExtensions}</td>
        </tr>`),(n.red.mappingExtensions||n.blue.mappingExtensions||n.bomb.mappingExtensions)&&(o+=`<tr>
        <th class="${_}table-header">ME</th>
        <td class="${_}table-element">${n.red.mappingExtensions}</td>
        <td class="${_}table-element">${n.blue.mappingExtensions}</td>
        <td class="${_}table-element">${n.bomb.mappingExtensions}</td>
        </tr>`);const i=document.createElement("table");return i.className=_+"table",i.innerHTML=o,i};function Au(t){var s,u;const e=t.target,n=e.id.replace(`${_}table-select-placement-`,"").split("-"),o=n[0],i=n[1],r=(u=(s=b._mapSet)==null?void 0:s.find(p=>p._mode===o&&p._difficulty===i))==null?void 0:u._data._notes;if(!r){console.error(et+"note could not be found");return}let a;switch(e.value){case"note":{a=r.filter(p=>S(p));break}case"red":{a=r.filter(p=>p._type===0);break}case"blue":{a=r.filter(p=>p._type===1);break}case"bomb":{a=r.filter(p=>p._type===3);break}default:a=r}const l=document.querySelector(`#${_}table-placement-${o}-${i}`);if(!l){console.error(et+"table could not be found");return}l.innerHTML=Ja(a)}function Ja(t){const e=t.length||1;let n="";for(let o=2;o>=0;o--){n+="<tr>";for(let i=0;i<=3;i++)n+=`<td class="${_}table-element">${Nl(t,i,o)}</td>`;n+=`<td class="${_}table-element ${_}table--no-border">${h(Hl(t,o)/e*100,1)}%</td>
        </tr>`}return n+=`<tr>
    <td class="${_}table-element ${_}table--no-border">${h(Ye(t,0)/e*100,1)}%</td>
    <td class="${_}table-element ${_}table--no-border">${h(Ye(t,1)/e*100,1)}%</td>
    <td class="${_}table-element ${_}table--no-border">${h(Ye(t,2)/e*100,1)}%</td>
    <td class="${_}table-element ${_}table--no-border">${h(Ye(t,3)/e*100,1)}%</td>
    </tr>`,n}const Ou=(t,e)=>{var r;const n=Ie(`${_}table-select-placement-${e._mode}-${e._difficulty}`,"Note Placement: ","caption",`${_}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Bomb",value:"bomb"});(r=n.querySelector("select"))==null||r.addEventListener("change",Au);let o=`<tbody id="${_}table-placement-${e._mode}-${e._difficulty}">${Ja(e._data._notes)}</tbody>`;const i=document.createElement("table");return i.className=_+"table",i.innerHTML=o,i.prepend(n),i};function qu(t){var s,u;const e=t.target,n=e.id.replace(`${_}table-select-angle-`,"").split("-"),o=n[0],i=n[1],r=(u=(s=b._mapSet)==null?void 0:s.find(p=>p._mode===o&&p._difficulty===i))==null?void 0:u._data._notes;if(!r){console.error(et+"note could not be found");return}let a;switch(e.value){case"note":{a=r.filter(p=>S(p));break}case"red":{a=r.filter(p=>p._type===0);break}case"blue":{a=r.filter(p=>p._type===1);break}case"bomb":{a=r.filter(p=>p._type===3);break}default:a=r}const l=document.querySelector(`#${_}table-angle-${o}-${i}`);if(!l){console.error(et+"table could not be found");return}l.innerHTML=Ua(a)}function Ua(t){const e=t.length||1,n=[4,0,5,2,8,3,6,1,7];let o="";for(let i=0;i<3;i++){o+="<tr>";for(let r=0;r<3;r++){let a=jl(t,n[i*3+r]);o+=`<td class="${_}table-element">${a}<br>(${h(a/e*100,1)}%)</td>`}o+="</tr>"}return o}const Ju=(t,e)=>{var r;const n=Ie(`${_}table-select-angle-${e._mode}-${e._difficulty}`,"Note Angle: ","caption",`${_}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Bomb",value:"bomb"});(r=n.querySelector("select"))==null||r.addEventListener("change",qu);let o=`<tbody id="${_}table-angle-${e._mode}-${e._difficulty}">${Ua(e._data._notes)}</tbody>`;const i=document.createElement("table");return i.className=_+"table",i.innerHTML=o,i.prepend(n),i},Uu=(t,e)=>{const n=ot(t._beatsPerMinute),o=Lr(e._data._notes);let i=`<caption class="${_}table-caption">Note Information:</caption>
    <tr>
    <th class="${_}table-header" colspan="2">Max Score</th>
    <td class="${_}table-element">${ll(Yl(o.red.total+o.blue.total))}</td>
    </tr>
    <tr>
    <th class="${_}table-header" colspan="2">Effective BPM</th>
    <td class="${_}table-element">${h(us(e._data._notes,n),2)}</td>
    </tr>
    <tr>
    <th class="${_}table-header" colspan="2">Effective BPM (swing)</th>
    <td class="${_}table-element">${h(ms(e._data._notes,n),2)}</td>
    </tr>`,r=h(ds(e._data._notes,n)*1e3,1),a=h(ps(e._data._notes,n)*1e3,1);r&&a&&(i+=`
        <tr>
        <th class="${_}table-header" colspan="2">Min. Slider Speed</th>
        <td class="${_}table-element">${r}ms</td>
        </tr>
        <tr>
        <th class="${_}table-header" colspan="2">Max. Slider Speed</th>
        <td class="${_}table-element">${a}ms</td>
        </tr>`);const l=document.createElement("table");return l.className=_+"table",l.innerHTML=i,l},Gu=(t,e)=>{const n=Kl(e._data._events,e._environment);let o=0,i=0,r=0,a=0,l=`<caption class="${_}table-caption">Events: ${Object.values(n).reduce((u,{total:p})=>u+p,0)}</caption>`;for(const u in n)o+=n[u].chroma,i+=n[u].chromaOld,r+=n[u].noodleExtensions,a+=n[u].mappingExtensions,l+=`<tr>
        <th class="${_}table-header" colspan="2">${so[u]}</th>
        <td class="${_}table-element">${n[u].total}</td>
        </tr>`;o&&(l+=`<tr>
        <th class="${_}table-header" colspan="2">Chroma</th>
        <td class="${_}table-element">${o}</td>
        </tr>`),i&&(l+=`<tr>
        <th class="${_}table-header" colspan="2">OG Chroma</th>
        <td class="${_}table-element">${i}</td>
        </tr>`),r&&(l+=`<tr>
        <th class="${_}table-header" colspan="2">Noodle Extensions</th>
        <td class="${_}table-element">${r}</td>
        </tr>`),a&&(l+=`<tr>
        <th class="${_}table-header" colspan="2">Mapping Extensions</th>
        <td class="${_}table-element">${a}</td>
        </tr>`);const s=document.createElement("table");return s.className=_+"table",s.innerHTML=l,s},Vu=(t,e)=>{const n=wl(e._data._obstacles);let o=`<caption class="${_}table-caption">Obstacles: ${n.total}</caption>`;n.interactive&&(o+=`<tr>
        <th class="${_}table-header" colspan="2">Interactive</th>
        <td class="${_}table-element">${n.interactive}</td>
        </tr>`),n.crouch&&(o+=`<tr>
        <th class="${_}table-header" colspan="2">Crouch</th>
        <td class="${_}table-element">${n.crouch}</td>
        </tr>`),n.chroma&&(o+=`<tr>
        <th class="${_}table-header" colspan="2">Chroma</th>
        <td class="${_}table-element">${n.chroma}</td>
        </tr>`),n.noodleExtensions&&(o+=`<tr>
        <th class="${_}table-header" colspan="2">Noodle Extensions</th>
        <td class="${_}table-element">${n.noodleExtensions}</td>
        </tr>`),n.mappingExtensions&&(o+=`<tr>
        <th class="${_}table-header" colspan="2">Mapping Extensions</th>
        <td class="${_}table-element">${n.mappingExtensions}</td>
        </tr>`);const i=document.createElement("table");return i.className=_+"table",i.innerHTML=o,i},Xu=()=>{if(!ve){console.error(et+"HTML stats does not exist");return}if(!b._mapInfo)throw new Error(et+"map info could not be found in savedData");if(!b._mapSet)throw new Error(et+"map data could not be found in savedData");const t=b._mapInfo;t._difficultyBeatmapSets.forEach(e=>{const n=document.createElement("div");n.className=_+"mode-"+e._beatmapCharacteristicName;const o=document.createElement("div");o.className=_+"title",o.textContent=hr[e._beatmapCharacteristicName],n.appendChild(o),e._difficultyBeatmaps.forEach(i=>{var g,m,f;const r=(g=b._mapSet)==null?void 0:g.find(d=>d._mode===e._beatmapCharacteristicName&&d._difficulty===i._difficulty);if(!r)throw new Error(et+"Could not find map data");const a=il(`${_}${e._beatmapCharacteristicName}-${i._difficulty}`,ce[i._difficulty]+(((m=i._customData)==null?void 0:m._difficultyLabel)?" -- "+((f=i._customData)==null?void 0:f._difficultyLabel):""),i._difficulty,!0),l=a.querySelector(".accordion__collapsible-flex"),s=a.querySelector(".accordion__button");if(!l||!s)throw new Error(et+"something went wrong!");s.checked=C.onLoad.stats;const u=en("small","half"),p=en("small","half"),c=en("small","half");u.append(Hu(t,r)),u.append(document.createElement("br")),u.append(Nu(t,r)),u.append(document.createElement("br")),u.append(ju(t,r)),p.append(Uu(t,r)),p.append(document.createElement("br")),p.append(Ou(t,r)),p.append(document.createElement("br")),p.append(Ju(t,r)),c.append(Fu(t,r)),c.append(document.createElement("br")),c.append(Gu(t,r)),c.append(document.createElement("br")),c.append(Vu(t,r)),l.appendChild(u),l.appendChild(p),l.appendChild(c),n.appendChild(a)}),ve.appendChild(n)})},zu=()=>{if(!ve){console.error(et+"HTML stats does not exist");return}for(;ve.firstChild;)ve.removeChild(ve.firstChild)},Ga=async t=>new Promise(function(e,n){const o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="json",o.timeout=5e3;let i=Date.now();o.onprogress=()=>{o.timeout+=Date.now()-i},o.onload=()=>{o.status===200&&e(o.response),o.status===404&&n("Error 404: Map does not exist"),o.status===403&&n("Error 403: Forbidden"),n(`Error ${o.status}`)},o.onerror=()=>{n("Error downloading")},o.ontimeout=()=>{n("Connection timeout")},o.send()}),Ku=async t=>{const e=`https://api.beatsaver.com/maps/id/${t}`,n=await Ga(e);if(n==null?void 0:n.versions.length)return n.versions[n.versions.length-1].downloadURL;throw new Error("could not find map download link")},Wu=async t=>{const e=`https://api.beatsaver.com/maps/hash/${t}`,n=await Ga(e);if(n==null?void 0:n.versions.length)return n.versions[n.versions.length-1].downloadURL;throw new Error("could not find map download link")},Ui=async t=>{let e;try{e=ur(t)}catch(n){T("info",n,0),console.error(n);return}try{rt(!0),T("info","Requesting download from link",0),console.log(`downloading from ${e}`);let n=await Vi("https://cors-anywhere.herokuapp.com/"+e);Kn(e),He(n)}catch(n){rt(!1),T("error",n,100)}},Gi=async t=>{let e;try{e=mr(t)}catch(n){throw T("info",n,0),console.error(n),new Error(n)}try{rt(!0),console.log(`fetching download URL from BeatSaver for map ID ${e}`),T("info","Fetching download URL from BeatSaver",0);const n=await Ku(e);console.log(`downloading from BeatSaver for map ID ${e}`),T("info","Requesting download from BeatSaver",0);const o=await Vi(n);Kn("https://beatsaver.com/maps/"+e,e),He(o)}catch(n){rt(!1),T("error",n,100),console.error(n)}},Va=async t=>{let e;try{if(dr(t.trim()))e=t.trim();else throw new Error("invalid hash")}catch(n){throw T("info",n,0),console.error(n),new Error(n)}try{rt(!0),console.log(`fetching download URL from BeatSaver for map hash ${e}`),T("info","Fetching download URL from BeatSaver",0);const n=await Wu(e);console.log(`downloading from BeatSaver for map hash ${e}`),T("info","Requesting download from BeatSaver",0);const o=await Vi(n);He(o)}catch(n){rt(!1),T("error",n,100),console.error(n)}},Vi=async t=>new Promise(function(e,n){const o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.timeout=5e3;let i=Date.now();o.onprogress=r=>{o.timeout+=Date.now()-i,T("download",`Downloading map: ${h(r.loaded/1024/1024,1)}MB / ${h(r.total/1024/1024,1)}MB`,r.loaded/r.total*100)},o.onload=()=>{o.status===200&&e(o.response),o.status===404&&n("Error 404: Map/link does not exist"),o.status===403&&n("Error 403: Forbidden"),n(`Error ${o.status}`)},o.onerror=()=>{n("Error downloading")},o.ontimeout=()=>{n("Connection timeout")},o.send()}),He=async t=>{T("info","Extracting zip",0);let e=new ar;console.time("loading time");try{zn(!0),e=await ar.loadAsync(t),await Yu(e)}catch(n){Rr(),rt(!1),zn(!1),T("error",n,100),console.error(n)}console.timeEnd("loading time")},Yu=async t=>{var n,o,i;T("info","Parsing map info...",0),console.log("parsing map info");const e=t.file("Info.dat")||t.file("info.dat");if(e){rt(!0);let r=await e.async("string");b._mapInfo=await JSON.parse(r),kl(b._mapInfo),ns(b._mapInfo),T("info","Loading image...",10.4375),console.log("loading cover image");let a=t.file(b._mapInfo._coverImageFilename);if(C.load.imageCover&&a){let u=await a.async("base64");pr("data:image;base64,"+u),gn.map.load.image=!0}else console.error(`${b._mapInfo._coverImageFilename} does not exists.`);if(b._contributors=[],(o=(n=b._mapInfo)==null?void 0:n._customData)==null?void 0:o._contributors)for(const u of b._mapInfo._customData._contributors)console.log("loading contributor image "+u._name),a=t.file(u._iconPath),C.load.imageContributor&&a?u._base64=await a.async("base64"):console.error(`${u._iconPath} does not exists.`),b._contributors.push(u);T("info","Loading audio...",20.875),console.log("loading audio");let l=t.file(b._mapInfo._songFilename);if(C.load.audio&&l){let u=!1;setTimeout(()=>{u||T("info","Loading audio... (this may take a while)",20.875)},1e4);let p=await l.async("arraybuffer");hl(p),await new AudioContext().decodeAudioData(p).then(g=>{u=!0;let m=g.duration;b._duration=m,Ve(m),gn.map.load.audio=!0}).catch(function(g){Ve(),console.error(g)})}else Ve(),console.error(`${b._mapInfo._songFilename} does not exist.`);T("info","Parsing difficulty...",70),b._mapSet=[];const s=b._mapInfo._difficultyBeatmapSets;for(let u=s.length-1;u>=0;u--){const p=s[u]._difficultyBeatmaps;if(p.length===0||!p){console.error("Empty difficulty set, removing..."),s.splice(u,1);continue}for(let c=0;c<p.length;c++){const g=p[c],m=t.file(g._beatmapFilename);if(m){console.log(`parsing ${s[u]._beatmapCharacteristicName} ${g._difficulty}`);let f=JSON.parse(await m.async("string")),d;try{d=Ml(f)}catch(E){throw new Error(`${s[u]._beatmapCharacteristicName} ${g._difficulty} ${E}`)}(i=b._mapSet)==null||i.push({_mode:s[u]._beatmapCharacteristicName,_difficulty:g._difficulty,_info:g,_data:d,_environment:b._mapInfo._environmentName})}else if(console.error(`Missing ${g._beatmapFilename} file for ${s[u]._beatmapCharacteristicName} ${g._difficulty}, ignoring.`),s[u]._difficultyBeatmaps.splice(c,1),c--,s[u]._difficultyBeatmaps.length<1){console.error(`${s[u]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),s.splice(u,1);continue}}}ku(),T("info","Adding map difficulty stats...",80),console.log("adding map stats"),Xu(),Fr(b._contributors),T("info","Analysing map...",85),console.log("analysing map"),Cu(),wu(),xu(),T("info","Analysing difficulty...",90),ja(),qa(b._mapInfo),Pe(),rt(!1),T("info","Map successfully loaded!")}else throw new Error("Couldn't find Info.dat")},Ee="UI Intro: ",Ne=document.querySelector(".input__intro-url"),je=document.querySelector(".input__intro-id"),Fe=document.querySelector(".input__intro-hash"),Xa=document.querySelector(".input__search-button"),za=document.querySelector(".input__file"),Xi=document.querySelector(".input__file-zone");Ne?Ne.addEventListener("keydown",zi):console.error(Ee+"URL input is missing");je?je.addEventListener("keydown",zi):console.error(Ee+"ID input is missing");Fe?Fe.addEventListener("keydown",zi):console.error(Ee+"Hash input is missing");Xa?Xa.addEventListener("click",Zu):console.error(Ee+"search button is missing");za?za.addEventListener("change",Qu):console.error(Ee+"file input is missing");Xi?(Xi.addEventListener("drop",tm),Xi.addEventListener("dragover",em)):console.error(Ee+"file drop zone is missing");function zi(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&Ui(e.value),e.classList.contains("input__intro-id")&&Gi(e.value))}function Zu(t){if(Ne&&Ne.value!==""){Ui(Ne.value);return}if(je&&je.value!==""){Gi(je.value);return}if(Fe&&Fe.value!==""){Va(Fe.value);return}}function Qu(t){const e=t.target;T("info","Reading file input",0);const n=e.files?e.files[0]:null;try{if(n==null)throw T("info","No file input",0),new Error("No file input");if(n&&(n.name.substr(-4)===".zip"||n.name.substr(-4)===".bsl")){const o=new FileReader;o.readAsArrayBuffer(n),o.addEventListener("load",()=>{He(n)})}else throw new Error("Unsupported file format, please enter zip file")}catch(o){T("error",o,0),console.error(o)}}function tm(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items&&t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(e),n.addEventListener("load",()=>{He(e)})}else throw new Error("Unsupported file format, please enter zip file")}}catch(e){T("error",e,0),console.error(e)}}function em(t){t.preventDefault(),t.stopPropagation()}const nm=["Dark","Light","Monochrome"],om=document.querySelector("body"),Ka=t=>{om.className="theme-"+t.toLowerCase().replace(" ","")},ae="UI Settings: ",Ae=document.querySelector(".settings__theme"),Ki=document.querySelectorAll(".settings__load"),Fn=document.querySelector(".settings__sort"),Wi=document.querySelectorAll(".settings__show"),Yi=document.querySelectorAll(".settings__onload"),Wa=document.querySelector(".settings__clear-button");Ae?(Ae.addEventListener("change",im),nm.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,Ae.add(e)})):console.error(ae+"theme select is missing");Ki.length||console.error(ae+"empty load list, intentional or typo error?");Ki.forEach(t=>t.addEventListener("change",cm));Fn?Fn.addEventListener("change",lm):console.error(ae+"sort check is missing");Yi.length||console.error(ae+"empty onload list, intentional or typo error?");Yi.forEach(t=>t.addEventListener("change",mm));Wi.length||console.error(ae+"empty show list, intentional or typo error?");Wi.forEach(t=>t.addEventListener("change",rm));Wa?Wa.addEventListener("click",hm):console.error(ae+"clear button is missing");function im(t){const e=t.target;C.theme=e.options[e.options.selectedIndex].value,Ka(C.theme),C.save()}function rm(t){const e=t.target,n=e.id.replace("settings__show-","");C.show[n]=e.checked,C.save()}const am=(t,e)=>{Wi.forEach(n=>{n.id.endsWith(t)&&(n.checked=e)})};function lm(t){const e=t.target;C.sorting=e.checked,C.save()}const sm=t=>{Fn&&(Fn.checked=t)};function cm(t){const e=t.target,n=e.name;C.load[n]=e.checked,C.save()}const um=(t,e)=>{Ki.forEach(n=>{n.name===t&&(n.checked=e)})};function mm(t){const e=t.target,n=e.name;C.onLoad[n]=e.checked,C.save()}const dm=(t,e)=>{Yi.forEach(n=>{n.name===t&&(n.checked=e)})},pm=t=>{if(!Ae){console.error(ae+"input element is missing");return}Ae.value=t};function hm(){C.clear(),C.reset(),location.reload()}const _m=document.querySelectorAll(".input__reset-button");_m.forEach(t=>t.addEventListener("click",fm));function fm(){as(),fl(),is(),Pu(),zu(),Rr()}const gm=2,bm=3,ym=1,vm="Kival Evan#5480";class Em{constructor(){this._version=`v${gm}.${bm}.${ym}`,this._wm=vm}get value(){return this._version}get watermark(){return this._wm}}var Ya=new Em;const $m="UI Footer: ",Za=document.querySelectorAll(".link__watermark"),Qa=document.querySelectorAll(".link__version");(!Za.length||!Qa.length)&&console.error($m+"missing part");const wm=t=>{Za.forEach(e=>e.textContent=t)},Tm=t=>{Qa.forEach(e=>e.textContent=t)};var Cm=function(){let t=!1;return function(){if(!t){t=!0,pm(C.theme),wm(Ya.watermark),Tm(Ya.value),Ru();for(const e in C.load)um(e,C.load[e]);sm(C.sorting);for(const e in C.show)rl(e,C.show[e]),am(e,C.show[e]);for(const e in C.onLoad)dm(e,C.onLoad[e]);Ka(C.theme),console.log("user interface initialised")}}}();const Zi=new URL(location.href),tl=Zi.searchParams.get("url"),el=Zi.searchParams.get("id"),Qi=Zi.searchParams.get("hash");Cm();tl?Ui(ur(decodeURI(tl))):el?Gi(mr(decodeURI(el))):Qi&&dr(decodeURI(Qi).trim())&&Va(decodeURI(Qi).trim());
