(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();var Is=(t=>(t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy",t))(Is||{});const _u="UI Accordion: ",pn="accordion__",$s=document.querySelectorAll(".accordion__button");$s.length||console.error(_u+"empty accordion list, intentional or typo error?");const Os={create:(t,e,i,n=!1)=>{const o=document.createElement("div");o.className="accordion";const r=document.createElement("input");r.className=pn+"button",r.id=t,r.setAttribute("type","checkbox");const l=document.createElement("label");l.className=pn+"label unselectable",l.htmlFor=t,l.textContent=e,i&&l.classList.add(Is[i]);const a=document.createElement("div");return a.className=n?pn+"collapsible-flex":pn+"collapsible",a.id=t+"-content",o.appendChild(r),o.appendChild(l),o.appendChild(a),o},show:(t,e)=>{$s.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}},Ir=new Map([[0,"VERBOSE"],[1,"DEBUG"],[2,"INFO"],[3,"WARN"],[4,"!!ERROR!!"],[5,"NONE"]]);class bu{constructor(){this.logLevel=2}log(e,...i){if(e<this.logLevel)return;const n=[Ir.get(e),">",...i];switch(e){case 1:return console.debug(...n);case 2:return console.info(...n);case 3:return console.warn(...n);case 4:return console.error(...n);default:return console.log(...n)}}setLevel(e){e=Math.min(e,5),this.logLevel=e,this.info("[logger::setLevel]",`Log level set to ${Ir.get(e)}`)}verbose(...e){this.log(0,...e)}debug(...e){this.log(1,...e)}info(...e){this.log(2,...e)}warn(...e){this.log(3,...e)}error(...e){this.log(4,...e)}}const K=new bu;function yu(t){return t.toString().split(".").map((e,i)=>i?e:e.replace(/\B(?=(\d{3})+(?!\d))/g,",")).join(".")}vu(Math.random());function vu(t){t=t.toString();let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function I(t,e=0){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function _a(t){return t*(180/Math.PI)}function vi(t){return t*(Math.PI/180)}function $r(t,e){e<0&&(e=-e);const i=t%e;return i<0?i+e:i}function Or(t,e,i){return Math.min($r(t-e,i),$r(e-t,i))}function da(t){if(t.length===0)return 0;t.sort((i,n)=>i-n);const e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2}function Mr(t,e,i){return Math.min(Math.max(e,t),i)}function _t(t){if(typeof t!="object")throw new Error("Received non-object type");return JSON.parse(JSON.stringify(t))}function Ms(t){return/^[a-fA-F0-9]+$/g.test(t)}function On(t){const e=[t.r,t.g,t.b];return typeof t.a=="number"&&e.push(t.a),e}function gn(t){const e=t.toString(16);return e.length===1?"0"+e:e}function Eu(t){return t>1&&!(t<0)?255:I(t*255)}function Nt(t){const e={r:0,g:0,b:0};for(const i in t){const n=t[i];n!==void 0&&(e[i]=Eu(n))}return`#${gn(e.r)}${gn(e.g)}${gn(e.b)}${typeof e.a=="number"?gn(e.a):""}`}function Pr(t){let e=t[0],i=t[1],n=t[2],o,r,l;return e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,o=(e*.4124+i*.3576+n*.1805)/.95047,r=(e*.2126+i*.7152+n*.0722)/1,l=(e*.0193+i*.1192+n*.9505)/1.08883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,[116*r-16,500*(o-r),200*(r-l)]}function Fr(t,e){let i=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(i=0),t<0&&(i=180),t>0&&e<0&&(i=360),_a(Math.atan(e/t))+i)}function ba(t,e){const[i,n,o]=Pr(t),[r,l,a]=Pr(e),s=1,c=1,d=1;let u,m,h,p,g,y,b,E,w,L,R,F,M,k,$,j,et,S,O,_;return u=Math.sqrt(n*n+o*o),m=Math.sqrt(l*l+a*a),h=(u+m)/2,g=.5*(1-Math.sqrt((h^7)/((h^7)+30))),w=(1+g)*n,u=Math.sqrt(w*w+o*o),y=Fr(w,o),w=(1+g)*l,m=Math.sqrt(w*w+a*a),b=Fr(w,a),S=r-i,O=m-u,u*m==0?_=0:(w=I(b-y,12),Math.abs(w)<=180?_=b-y:w>180?_=b-y-360:_=b-y+360),_=2*Math.sqrt(u*m)*Math.sin(vi(_/2)),L=(i+r)/2,p=(u+m)/2,u*m==0?E=y+b:(w=Math.abs(I(y-b,12)),w>180?b+y<360?E=y+b+360:E=y+b-360:E=y+b,E/=2),R=1-.17*Math.cos(vi(E-30))+.24*Math.cos(vi(2*E))+.32*Math.cos(vi(3*E+6))-.2*Math.cos(vi(4*E-63)),$=30*Math.exp(-((E-275)/25)*((E-275)/25)),j=2*Math.sqrt((p^7)/((p^7)+30)),F=1+.015*((L-50)*(L-50))/Math.sqrt(20+(L-50)*(L-50)),M=1+.045*p,k=1+.015*p*R,et=-Math.sin(vi(2*$))*j,S=S/(s*F),O=O/(c*M),_=_/(d*k),Math.sqrt(S*S+O*O+_*_+et*O*_)}function Ct(t){if(!t)return"0:00";const e=Math.floor(t),i=e/60,n=i<0?`-${Math.ceil(i).toString()}`:Math.floor(i).toString(),o=Math.abs(e%60).toString().padStart(2,"0");return`${n}:${o}`}function Du(t){if(!t)return"0:00:00";const e=Math.abs(Math.round(t*60%60)).toString().padStart(2,"0");return`${Ct(t>0?Math.floor(t):Math.ceil(t))}:${e}`}function wn(t){var i;if(!t)return"0:00.000";const e=((i=(t%1).toString().split(".")[1])==null?void 0:i.padEnd(3,"0").slice(0,3))||"000";return`${Ct(t>0?Math.floor(t):Math.ceil(t))}.${e}`}function Ps(t){const e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")}function Fs(t){const e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")}function ya(t){for(let e=t.options.length-1;e>=0;e--)t.remove(e)}const Ja="UI Header: ",va=document.querySelector(".intro"),Ea=document.querySelector(".metadata"),ci=document.querySelector(".cover__link"),qa=document.querySelector(".cover__image"),Hs=document.querySelector(".metadata__song-name"),zs=document.querySelector(".metadata__song-subname"),Xs=document.querySelector(".metadata__song-author"),Us=document.querySelector(".metadata__song-bpm"),Da=document.querySelector(".metadata__song-duration"),Gs=document.querySelector(".audio");if(!va||!Ea)throw new Error(Ja+"header component is missing one of the two section");if(!ci||!qa)throw new Error(Ja+"cover component is missing");if(!Hs||!zs||!Xs||!Us||!Da)throw new Error(Ja+"metadata component is missing one of the part");function Ys(t){t?(va.classList.remove("hidden"),Ea.classList.add("hidden")):(va.classList.add("hidden"),Ea.classList.remove("hidden"))}function js(t){qa.src=t||"./img/unknown.jpg"}function wu(){return qa.src}function Ws(t,e){if(t==null&&e==null){ci.textContent="",ci.href="",ci.classList.add("disabled");return}t!=null&&(ci.textContent=e??"Download Link",ci.href=t,ci.classList.remove("disabled"))}function Su(t){Hs.textContent=t}function Tu(t){zs.textContent=t}function Lu(t){Xs.textContent=t}function Cu(t,e,i){e==null&&typeof i=="number"&&(e=Math.min(t,i)),i==null&&typeof e=="number"&&(i=Math.max(t,e));let n=I(t,2).toString()+"BPM";e&&i&&(n+=` (${I(e,2)}-${I(i,2)})`),Us.textContent=n}function Vs(t){t?Da.textContent=wn(t):Da.textContent="No audio"}async function Ru(t){const e=new Blob([t],{type:"audio/ogg"});Gs.src=window.URL.createObjectURL(e)}function Js(){Gs.src="",window.URL.revokeObjectURL("")}function ku(){Ys(!0),js(null),Ws(),Vs(0),Js()}const Mt={switchHeader:Ys,setCoverImage:js,getCoverImage:wu,setCoverLink:Ws,setSongName:Su,setSongSubname:Tu,setSongAuthor:Lu,setSongBPM:Cu,setSongDuration:Vs,setAudio:Ru,unloadAudio:Js,reset:ku},Li=new class{constructor(){this.loading={info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1}}resetLoad(){this.loading.info=!1,this.loading.difficulty=!1,this.loading.analysis=!1,this.loading.audio=!1,this.loading.coverImage=!1,this.loading.contributorImage=!1,this.loading.finished=!1}},st=new class{constructor(){this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}retrieveSafe(){if(!this.beatmapInfo)throw new Error("Beatmap info is not loaded.");if(!this.analysis)throw new Error("Beatmap analysis is not loaded.");if(this.duration===null)throw new Error("Audio is not loaded.");if(Li.loading.finished)return{beatmapInfo:this.beatmapInfo,beatmapDifficulty:this.beatmapDifficulty,contributors:this.contributors,analysis:this.analysis,duration:this.duration};throw new Error("Could not retrieve saved data, loading process is not finished.")}clear(){Li.loading.finished=!1,this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}},qs=class{constructor(t,e=[],i=0){this._bpm=t,this._offset=i/1e3,this._timeScale=this.getTimeScale(e.filter(n=>{if(n.m===0)throw new Error("v3 BPM Change of value 0 detected.");return n.m!=null&&n.o==null})),this._bpmChange=this.getBPMChangeTime(e.filter(n=>n._time!=null||n.o!=null))}get value(){return this._bpm}set value(t){this._bpm=t}get change(){return this._bpmChange}set change(t){this._bpmChange=t}set timescale(t){this._timeScale=this.getTimeScale(t)}get offset(){return this._offset*1e3}set offset(t){this._offset=t/1e3}getBPMChangeTime(t=[]){let e;const i=[];for(let n=0;n<t.length;n++){const o={time:t[n]._time??t[n].b,BPM:t[n]._BPM??t[n]._bpm??t[n].m,beatsPerBar:t[n]._beatsPerBar??t[n].p,metronomeOffset:t[n]._metronomeOffset??t[n].o,newTime:0};e?o.newTime=Math.ceil((o.time-e.time)/this._bpm*e.BPM+e.newTime-.01):o.newTime=Math.ceil(o.time-this._offset*this._bpm/60-.01),i.push(o),e=o}return i}getTimeScale(t=[]){return t.map(e=>({time:e.b,scale:this._bpm/e.m}))}offsetBegone(t){return this.toBeatTime(this.toRealTime(t,!1)-this._offset)}toRealTime(t,e=!0){if(!e)return t/this._bpm*60;let i=0;for(let n=this._timeScale.length-1;n>=0;n--)t>this._timeScale[n].time&&(i+=(t-this._timeScale[n].time)*this._timeScale[n].scale,t=this._timeScale[n].time);return(t+i)/this._bpm*60}toBeatTime(t,e=!1){if(!e)return t*this._bpm/60;let i=0;for(let n=this._timeScale.length-1;n>=0;n--){const o=this.toRealTime(this._timeScale[n].time);t>o&&(i+=(t-o)/this._timeScale[n].scale,t=o)}return this.toBeatTime(t+i)}toJSONTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e].newTime)return(t-this._bpmChange[e].newTime)/this._bpmChange[e].BPM*this._bpm+this._bpmChange[e].time;return this.toBeatTime(this.toRealTime(t,!1)+this._offset)}adjustTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e].time)return(t-this._bpmChange[e].time)/this._bpm*this._bpmChange[e].BPM+this._bpmChange[e].newTime;return this.offsetBegone(t)}};let Oe=qs;Oe.create=(t,e,i)=>new qs(t,e,i);const xu={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",GlassDesertEnvironment:"Glass Desert"},pi={DefaultEnvironment:[[0,1,2,3,4,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,8,9,12,13],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],TheSecondEnvironment:[[0,1,2,3,4,9],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],LizzoEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,16,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]],TheWeekndEnvironment:[[0,1,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,29,30,31,32,33,34,35,36,37,38,40]],RockMixtapeEnvironment:[[3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]],Dragons2Environment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12]],Panic2Environment:[[3],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]]},oa="UI Info: ",wa=document.querySelector(".info__version"),Sa=document.querySelector(".info__play-time"),Ta=document.querySelector(".info__time-spend"),La=document.querySelector(".info__custom-color"),Ca=document.querySelector(".info__requirements"),Ra=document.querySelector(".info__suggestions"),ka=document.querySelector(".info__information"),xa=document.querySelector(".info__warnings"),Ba=document.querySelector(".info__bookmarks"),Na=document.querySelector(".info__bpm-changes"),Aa=document.querySelector(".info__environment-enhancement"),Ia=document.querySelector(".info__point-definitions"),$a=document.querySelector(".info__custom-events"),Zs=document.querySelectorAll(".info__table-element");if(!wa||!Sa||!Ta||!La||!Ca||!Ra||!ka||!xa||!Ba||!Na||!Aa||!Ia||!$a||!Zs)throw new Error(oa+"table info component is missing part");const Oa=document.querySelector(".info__level-author"),Ma=document.querySelector(".info__environment"),Sn=document.querySelector(".info__editors"),Tn=document.querySelector(".info__contributors"),Mn=document.querySelector(".info__contributors-select"),Bu=document.querySelector(".info__contributors-image"),Ks=document.querySelector(".info__contributors-name"),Qs=document.querySelector(".info__contributors-role");if(!Oa||!Ma||!Sn)throw new Error(oa+"info component is missing part");if(!Tn||!Ks||!Qs)throw new Error(oa+"contributors component is missing part");if(Mn)Mn.addEventListener("change",$u);else throw new Error(oa+"contributors select is missing");function tl(t){if(!t){Oa.textContent="";return}Oa.textContent="Mapped by "+t}function el(t){if(!t){Ma.textContent="";return}Ma.textContent=(xu[t]||"Unknown")+" Environment"}function il(t){if(!t||!t._lastEditedBy){Sn.classList.add("hidden");return}Sn.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let i="Last edited on "+e;if(t[e]){const n=t[e];i+=" v"+n.version}Sn.textContent=i}function Nu(t){Bu.src=t||"./img/unknown.jpg"}function Au(t){Ks.textContent=t}function Iu(t){Qs.textContent=t}function nl(t){Nu(t._base64?"data:image;base64,"+t._base64:null),Au(t._name),Iu(t._role)}function al(t){if(Tn&&(!t||!t.length)){Tn.classList.add("hidden"),ya(Mn);return}if(t){Tn.classList.remove("hidden");let e=!0;t.forEach((i,n)=>{e&&(e=!1,nl(i));const o=document.createElement("option");o.value=n.toString(),o.text=i._name+" -- "+i._role,Mn.add(o)})}}function $u(t){const e=t.target;nl(st.contributors[parseInt(e.value)])}const zi={version:3,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",infoRowHeight:4,rounding:3,dataCheck:!0,dataError:!0,theme:"Dark",onLoad:{stats:!1},show:{info:!1,tools:!1,stats:!1,settings:!1}},Q=new class{constructor(){this.property=_t(zi),this.stringify=()=>JSON.stringify({settings:this.property}),this.init=()=>{var i;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const n=JSON.parse(e);if(!((i=n.settings)!=null&&i.version)){this.clear();return}this.property=n.settings??this.property;for(const o in zi)typeof this.property[o]>"u"&&(this.property[o]=zi[o]);this.property.version=zi.version,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this.property=_t(zi)},this.init()}get version(){return this.property.version}get load(){return this.property.load}get sorting(){return this.property.sorting}set sorting(e){this.property.sorting=e}get beatNumbering(){return this.property.beatNumbering}set beatNumbering(e){this.property.beatNumbering=e}get infoRowHeight(){return this.property.infoRowHeight}set infoRowHeight(e){this.property.infoRowHeight=e}get rounding(){return this.property.rounding}set rounding(e){this.property.rounding=e}get dataCheck(){return this.property.dataCheck}set dataCheck(e){this.property.dataCheck=e}get dataError(){return this.property.dataError}set dataError(e){this.property.dataError=e}get theme(){return this.property.theme}set theme(e){this.property.theme=e}get onLoad(){return this.property.onLoad}get show(){return this.property.show}};var rl=(t=>(t.tiny="panel--tiny",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t.max="panel--max",t))(rl||{}),ol=(t=>(t.normal="panel--offset",t.half="panel--offset-half",t.none="",t))(ol||{});const Wi={create:(t,e,i,n)=>{const o=document.createElement("div");return o.className=`panel ${rl[t]}`,e&&e!=="none"&&o.classList.add(ol[e]),i&&o.classList.add("panel--flex"+n?"-column":""),o}};function Jt(t){const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")}function qt(t,e){const i=t.querySelector(".info__table-element");if(i){for(;i.firstChild;)i.removeChild(i.firstChild);typeof e=="string"?i.textContent=e:(e.forEach(n=>{if(typeof n=="string"){const o=document.createElement("span");o.textContent=n,i.appendChild(o),i.appendChild(document.createElement("br"))}else i.appendChild(n),i.appendChild(document.createElement("br"))}),i.lastChild&&i.removeChild(i.lastChild))}t.classList.remove("hidden")}function sl(t){Zs.forEach(e=>e.style.maxHeight=`${t}rem`)}function ll(t,e){if(t==null||!t.length){Jt(Ba);return}const i=Wi.create("max","none",!0);t.forEach((n,o)=>{let r=n.b,l;const a=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div");a.appendChild(s),a.appendChild(c),s.className="info__color-dot",s.style.backgroundColor="#000000",c.className="info__color-text",typeof n.n!="string"&&(c.textContent=`Error parsing bookmarks[${o}]`,i.appendChild(a)),e&&(r=e.adjustTime(r),l=e.toRealTime(r)),s.style.backgroundColor=n.c?Nt({r:n.c[0],g:n.c[1],b:n.c[2]}):"#333333",c.textContent=`${I(n.b,Q.rounding)}${l?" | "+Ct(l):""} -- ${n.n!=""?n.n:"**EMPTY NAME**"}`,i.appendChild(a)}),qt(Ba,[i])}function cl(t){if(!t||!t.change.length){Jt(Na);return}const e=t.change.map(i=>{const n=I(i.newTime,Q.rounding),o=t.toRealTime(i.time);return`${n} | ${Ct(o)} -- ${i.BPM}`});qt(Na,e)}const he={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",GlassDesertEnvironment:"Glass Desert"},Ou={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},de={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.5320754,g:.5320754,b:.5320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"The Second":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8235294,g:.08627451,b:.8509804},_envColorRightBoost:{r:0,g:1,b:.6478302},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Lizzo:{_colorLeft:{r:1,g:.8132076,b:.3773585},_colorRight:{r:.6705883,g:.254902,b:.8980392},_envColorLeft:{r:.8392157,g:.6470588,b:.2156863},_envColorRight:{r:.8196079,g:.2392157,b:.8784314},_envColorLeftBoost:{r:1,g:.4,b:.5529412},_envColorRightBoost:{r:.3686275,g:.7960784,b:1},_obstacleColor:{r:1,g:.5020987,b:.1882353}},"The Weeknd":{_colorLeft:{r:.5843138,g:.1294118,b:.1294118},_colorRight:{r:.2235294,g:.2901961,b:.3294118},_envColorLeft:{r:1,g:.2979701,b:.1411765},_envColorRight:{r:.1668743,g:.3753689,b:.7075472},_envColorLeftBoost:{r:.9568628,g:.6039216,b:.1215686},_envColorRightBoost:{r:.5254902,g:.8274511,b:.9921569},_obstacleColor:{r:.9176471,g:.2980392,b:.007843138}},"Rock Mixtape":{_colorLeft:{r:.6,g:.4233,b:.042},_colorRight:{r:.6006,g:.7441199,b:.78},_envColorLeft:{r:.75,g:.12,b:.162},_envColorRight:{r:.95,g:.5820333,b:.1615},_envColorLeftBoost:{r:.96,g:.1344,b:.9187202},_envColorRightBoost:{r:.378,g:.813,b:.9},_obstacleColor:{r:1,g:1,b:1}},"Dragons 2.0":{_colorLeft:{r:.7264151,g:.6587077,b:.2809719},_colorRight:{r:.2509804,g:.7647059,b:.405098},_envColorLeft:{r:.01960784,g:.9960785,b:.06666667},_envColorRight:{r:0,g:.05490196,b:1},_envColorLeftBoost:{r:.9764706,g:.03137255,b:.01960784},_envColorRightBoost:{r:1,g:.8292086,b:.2264151},_obstacleColor:{r:.5548979,g:.2470588,b:1}},"Panic 2.0":{_colorLeft:{r:.9019608,g:.3333333,b:.5686275},_colorRight:{r:.1529412,g:.5568628,b:.4862745},_envColorLeft:{r:.6980392,g:.1137255,b:.372549},_envColorRight:{r:.1882353,g:.6196079,b:.6235294},_envColorLeftBoost:{r:.9019608,g:.4470589,b:.06666667},_envColorRightBoost:{r:.6365692,g:.4373443,b:.8584906},_obstacleColor:{r:.9686275,g:.3803922,b:.2745098}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}};function ul(t,e){var c,d,u,m,h,p,g;if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._envColorWhite&&!t._envColorWhiteBoost&&!t._obstacleColor){Jt(La);return}e||(e="DefaultEnvironment");const i={_colorLeft:((c=de[he[e]])==null?void 0:c._colorLeft)||null,_colorRight:((d=de[he[e]])==null?void 0:d._colorRight)||null,_envColorLeft:((u=de[he[e]])==null?void 0:u._envColorLeft)||null,_envColorRight:((m=de[he[e]])==null?void 0:m._envColorRight)||null,_envColorWhite:null,_envColorLeftBoost:((h=de[he[e]])==null?void 0:h._envColorLeftBoost)||null,_envColorRightBoost:((p=de[he[e]])==null?void 0:p._envColorRightBoost)||null,_envColorWhiteBoost:null,_obstacleColor:((g=de[he[e]])==null?void 0:g._obstacleColor)||null},n={_colorLeft:i._colorLeft?Nt(i._colorLeft):null,_colorRight:i._colorRight?Nt(i._colorRight):null,_envColorLeft:i._envColorLeft?Nt(i._envColorLeft):null,_envColorRight:i._envColorRight?Nt(i._envColorRight):null,_envColorWhite:null,_envColorLeftBoost:i._envColorLeftBoost?Nt(i._envColorLeftBoost):null,_envColorRightBoost:i._envColorRightBoost?Nt(i._envColorRightBoost):null,_envColorWhiteBoost:null,_obstacleColor:i._obstacleColor?Nt(i._obstacleColor):null},o={noteColor:!!(t._colorLeft||t._colorRight),eventColor:!!(t._envColorLeft||t._envColorRight),eventBoostColor:!!(t._envColorLeftBoost||t._envColorRightBoost),obstacleColor:!!t._obstacleColor};t._colorLeft&&(n._colorLeft=Nt(t._colorLeft)),t._colorRight&&(n._colorRight=Nt(t._colorRight)),t._envColorLeft?n._envColorLeft=Nt(t._envColorLeft):t._colorLeft&&(n._envColorLeft=Nt(t._colorLeft)),t._envColorRight?n._envColorRight=Nt(t._envColorRight):t._colorRight&&(n._envColorRight=Nt(t._colorRight));let r,l,a=!1;t._envColorLeftBoost?(r=Nt(t._envColorLeftBoost),a=!0):r=i._envColorLeftBoost?Nt(i._envColorLeftBoost):n._envColorLeft,t._envColorRightBoost?(l=Nt(t._envColorRightBoost),a=!0):l=i._envColorRightBoost?Nt(i._envColorRightBoost):n._envColorRight,t._envColorWhite&&(n._envColorWhite=Nt(t._envColorWhite)),t._envColorWhiteBoost&&(n._envColorWhiteBoost=Nt(t._envColorWhiteBoost)),a&&(n._envColorLeftBoost=r,n._envColorRightBoost=l),t._obstacleColor&&(n._obstacleColor=Nt(t._obstacleColor)),o.noteColor||(n._colorLeft=null,n._colorRight=null),o.eventColor||(n._envColorLeft=null,n._envColorRight=null),o.noteColor&&!o.eventColor&&(n._envColorLeft=n._colorLeft,n._envColorRight=n._colorRight),o.obstacleColor||(n._obstacleColor=null);const s=Wi.create("max","none",!0);for(const y in n){if(!n[y])continue;const b=document.createElement("div"),E=document.createElement("div"),w=document.createElement("div"),L=document.createElement("div");E.className="info__color-dot",E.style.backgroundColor=n[y]||"#000000",w.className="info__color-text info__color-text--monospace",w.textContent=`${n[y]}`,L.className="info__color-text",L.textContent=` -- ${Ou[y]}`,b.appendChild(E),b.appendChild(w),b.appendChild(L),s.appendChild(b)}qt(La,[s])}var hl=(t=>(t.duplicate="D",t.active="A",t.scale="S",t.position="P",t.localPosition="Lp",t.rotation="R",t.localRotation="Lr",t.lightID="Li",t.track="T",t))(hl||{}),dl=(t=>(t.childrenTracks="Ct",t.color="C",t.definitePosition="Dp",t.dissolve="D",t.dissolveArrow="Da",t.duration="Dur",t.easing="E",t.interactable="I",t.localRotation="Lr",t.parentTrack="Pt",t.position="P",t.rotation="R",t.scale="S",t.time="T",t.track="Tr",t.worldPositionStays="Wps",t))(dl||{});function fl(t,e){if(t==null||!t.length){Jt($a);return}const i=t.map((n,o)=>{let r=n.b,l;e&&(r=e.adjustTime(r),l=e.toRealTime(r));const a=[];if(!n.d)return`Error parsing customEvents[${o}]`;for(const s in n.d){if(s=="_duration"||s=="_easing"||s=="_track"||s=="duration"||s=="easing"||s=="track")continue;const c=dl[s];n.d[s]!=null&&a.push(c)}return`${I(n.b,Q.rounding)}${l?" | "+Ct(l):""} -- ${n.t} -> [${a.join("")}]${n.t!=="AssignTrackParent"?`(${n.d.track})`:""}`});qt($a,i)}function ml(t){if(t==null||!t.length){Jt(Aa);return}const e=t.map((i,n)=>{const o=[];if(!i.id&&!i.geometry)return`Error parsing environment[${n}]`;for(const r in i){if(r=="lookupMethod"||r=="id"||r=="geometry")continue;const l=hl[r];i[r]!=null&&o.push(l)}return`${i.lookupMethod} [${o.join("")}]${i.track?`(${i.track})`:""} -> ${i.geometry?i.geometry.type:i.id}`});qt(Aa,e)}function Pa(t){if(t==null){Jt(wa);return}qt(wa,t)}function pl(t){if(t==null){Jt(Ta);return}qt(Ta,Du(t))}function gl(t){if(t==null||!t.length){Jt(Ca);return}qt(Ca,t.join(", "))}function _l(t){if(t==null||!t.length){Jt(Ra);return}qt(Ra,t.join(", "))}function bl(t){if(t==null||!t.length){Jt(ka);return}qt(ka,t)}function yl(t){if(t==null||!t.length){Jt(xa);return}qt(xa,t)}function vl(t){if(t==null){Jt(Ia);return}const e=[];for(const i in t){t[i]||e.push(`Error parsing pointDefinitions[${i}]`);const n=t[i];Array.isArray(n)||e.push(`Error parsing pointDefinitions[${i}]`),e.push(`${i} -- ${n.length} point${n.length>1?"s":""}`)}qt(Ia,e)}function El(t,e){if(t==null||e==null){Jt(Sa);return}qt(Sa,`${Ct(t)} to ${Ct(e)}${st.duration?` -- [ ${Ct(e-t)} / ${Ct(st.duration)} ]`:""}`)}function Mu(t){var e;Mt.setSongName(t._songName),Mt.setSongSubname(t._songSubName),Mt.setSongAuthor(t._songAuthorName),Mt.setSongBPM(t._beatsPerMinute),tl(t._levelAuthorName),el(t._environmentName),il((e=t._customData)==null?void 0:e._editors)}function Dl(t){var e,i,n;if(t.rawVersion===2&&Pa(t.rawData._version),t.rawVersion===3&&Pa(t.rawData.version),(e=t.info)!=null&&e._customData&&(ul(t.info._customData),gl(t.info._customData._requirements),_l(t.info._customData._suggestions),bl(t.info._customData._information),yl(t.info._customData._warnings)),(i=t.data)!=null&&i.customData){const o=(n=st.beatmapInfo)!=null&&n._beatsPerMinute?Oe.create(st.beatmapInfo._beatsPerMinute,t.data.customData._bpmChanges||t.data.customData._BPMChanges||t.data.customData.BPMChanges):null;pl(t.data.customData._time??t.data.customData.time),ll(t.data.customData._bookmarks??t.data.customData._bookmarks,o),cl(o),ml(t.data.customData.environment),vl(t.data.customData.pointDefinitions),fl(t.data.customData.customEvents,o)}El(t.bpm.toRealTime(t.data.getFirstInteractiveTime()),t.bpm.toRealTime(t.data.getLastInteractiveTime()))}function Pu(){tl(),el(),il(),al(),Pa(),El(),pl(),ul(),gl(),_l(),bl(),yl(),ll(),cl(),ml(),vl(),fl()}const Fu="UI Input: ",_n={enable:t=>{const e=document.querySelectorAll(".input-toggle");if(!e.length){console.error(Fu+"empty list, intentional or typo error?");return}e.forEach(i=>{i.disabled=!t})}},Hu="UI Loading: ",Ei=document.querySelector(".loading__bar"),Hr="loading__bar--error",zr="loading__bar--download",wl=document.querySelector(".loading__text");if(!Ei||!wl)throw new Error(Hu+"loading component is missing part");function Sl(t,e,i=100){wl.textContent=e,Ei.style.width=`${i}%`,t==="error"?Ei.classList.add(Hr):Ei.classList.remove(Hr),t==="download"?Ei.classList.add(zr):Ei.classList.remove(zr)}function zu(){Sl("info","No map loaded",0)}const vt={status:Sl,reset:zu};var ht=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_INVALID_EVENT_BOX=10]="EVENTS_INVALID_EVENT_BOX",t[t.EVENTS_UNLIT_BOMB=11]="EVENTS_UNLIT_BOMB",t[t.NOTES_EFFECTIVE_BPM=12]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=13]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=14]="NOTES_PARITY",t[t.NOTES_VARY_SWING=15]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=16]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=17]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=18]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=19]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=20]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=21]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=22]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=23]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=24]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=25]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=26]="NOTES_HITBOX_PATH",t[t.NOTES_COLOR_CHECK=27]="NOTES_COLOR_CHECK",t[t.NOTES_STACKED_NOTE=28]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=29]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=30]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=31]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=32]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=33]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=34]="OBSTACLES_NEGATIVE",t))(ht||{}),dt=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_INVALID_EVENT_BOX=10]="EVENTS_INVALID_EVENT_BOX",t[t.EVENTS_UNLIT_BOMB=11]="EVENTS_UNLIT_BOMB",t[t.NOTES_COLOR_CHECK=12]="NOTES_COLOR_CHECK",t[t.NOTES_EFFECTIVE_BPM=13]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=14]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=15]="NOTES_PARITY",t[t.NOTES_VARY_SWING=16]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=17]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=18]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=19]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=20]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=21]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=22]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=23]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=24]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=25]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=26]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=27]="NOTES_HITBOX_PATH",t[t.NOTES_STACKED_NOTE=28]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=29]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=30]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=31]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=32]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=33]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=34]="OBSTACLES_NEGATIVE",t))(dt||{});function Tl(t,e){switch(e){case"rank":t='<span title="Ranking: for rankability reason."> 🚧 </span>'+t;break;case"error":t='<span title="Error: should be fixed unless you know what you are doing."> ❌ </span>'+t;break;case"warning":t='<span title="Warning: not necessarily needed to be fixed but worth considering."> ❗ </span>'+t;break;case"info":t='<span title="Info: no action necessary and worth noting."> ⚠️ </span>'+t;break}return t}function pt(t,e,i){const n=document.createElement("div");return t=Tl(t,i),e?n.innerHTML=`<b>${t}:</b> ${e}`:n.innerHTML=`<b>${t}</b>`,n}function ut(t,e,i,n){const o=document.createElement("div");return t=Tl(t,n),o.innerHTML=`<b>${t} [${e.length}]:</b> ${e.map(r=>{switch(Q.beatNumbering){case"realtime":return`<span title="Beat ${I(i.adjustTime(r),Q.rounding)}">${Ct(i.toRealTime(r))}</span>`;case"realtimems":return`<span title="Beat ${I(i.adjustTime(r),Q.rounding)}">${wn(i.toRealTime(r))}</span>`;case"jsontime":return`<span title="Time ${wn(i.toRealTime(r))}">${I(r,Q.rounding)}</span>`;case"beattime":default:return`<span title="Time ${wn(i.toRealTime(r))}">${I(i.adjustTime(r),Q.rounding)}</span>`}}).join(", ")}`,o}const Fa=class{constructor(){}};let ct=Fa;ct.list=[];ct.create=(t,e,i,n)=>{const o=t.trim().toLowerCase().replace(" ","-");if(Fa.list.includes(o))throw new Error(o+" is already being used.");Fa.list.push(o);const r=document.createElement("div"),l=document.createElement("input"),a=document.createElement("label");return a.textContent=" "+t,a.title=e,a.htmlFor="input__tools-"+o,l.id="input__tools-"+o,l.className="input-toggle",l.type="checkbox",l.checked=i,l.addEventListener("change",n),r.appendChild(l),r.appendChild(a),r};const Xr="Validate Cover Image",Ur="Validate cover image.",Gr=!0,Pn={name:Xr,description:Ur,type:"general",order:{input:ht.GENERAL_COVER_IMAGE,output:dt.GENERAL_COVER_IMAGE},input:{enabled:Gr,params:{},html:ct.create(Xr,Ur,Gr,function(){Pn.input.enabled=this.checked})},output:{html:null},run:Xu};function Xu(){const t=new Image,e=Mt.getCoverImage(),i=[];if(Li.loading.coverImage&&e!==null?(t.src=e,t.width!==t.height&&i.push(pt("Cover image is not square","resize to fit square","error")),(t.width<256||t.height<256)&&i.push(pt("Cover image is too small","require at least 256x256","error"))):i.push(pt("No cover image",Q.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),i.length){const n=document.createElement("div");i.forEach(o=>n.append(o)),Pn.output.html=n}else Pn.output.html=null}const Yr="Audio Duration",jr="For ranking purpose, check for audio duration.",Wr=!0,Vi={name:Yr,description:jr,type:"general",order:{input:ht.GENERAL_AUDIO,output:dt.GENERAL_AUDIO},input:{enabled:Wr,params:{},html:ct.create(Yr,jr,Wr,function(){Vi.input.enabled=this.checked})},output:{html:null},run:Uu};function Uu(t){const{audioDuration:e}=t.settings;e&&e<20?Vi.output.html=pt("Unrankable audio length",`too short (${Ct(e)}s)`,"rank"):Li.loading.audio?Vi.output.html=null:Vi.output.html=pt("No audio",Q.load.audio?"could not be loaded or not found":"no audio mode is enabled")}const Vr="Preview Time",Jr="Warn default editor preview time.",qr=!0,Fn={name:Vr,description:Jr,type:"general",order:{input:ht.GENERAL_PREVIEW_TIME,output:dt.GENERAL_PREVIEW_TIME},input:{enabled:qr,params:{},html:ct.create(Vr,Jr,qr,function(){Fn.input.enabled=this.checked})},output:{html:null},run:Gu};function Gu(t){const{_previewStartTime:e,_previewDuration:i}=t.info;e===12&&i===10?Fn.output.html=pt("Default preview time","strongly recommended to set for audience's 1st impression","info"):Fn.output.html=null}function Yu(t){return Math.max(...t.map(e=>e.ebpm),0)}function ju(t){return Math.max(...t.map(e=>e.ebpmSwing),0)}const sa=4;var tt=(t=>(t[t.RED=0]="RED",t[t.BLUE=1]="BLUE",t))(tt||{}),H=(t=>(t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.UP_LEFT=4]="UP_LEFT",t[t.UP_RIGHT=5]="UP_RIGHT",t[t.DOWN_LEFT=6]="DOWN_LEFT",t[t.DOWN_RIGHT=7]="DOWN_RIGHT",t[t.ANY=8]="ANY",t))(H||{}),rt=(t=>(t[t.LEFT=0]="LEFT",t[t.MIDDLE_LEFT=1]="MIDDLE_LEFT",t[t.MIDDLE_RIGHT=2]="MIDDLE_RIGHT",t[t.RIGHT=3]="RIGHT",t))(rt||{}),At=(t=>(t[t.BOTTOM=0]="BOTTOM",t[t.MIDDLE=1]="MIDDLE",t[t.TOP=2]="TOP",t))(At||{});const Rt={[0]:180,[1]:0,[2]:270,[3]:90,[4]:225,[5]:135,[6]:315,[7]:45,[8]:0},Wu={[0]:1,[1]:0,[2]:3,[3]:2,[4]:7,[5]:6,[6]:5,[7]:4,[8]:8},Ge={[0]:[0,1],[1]:[0,-1],[2]:[-1,0],[3]:[1,0],[4]:[-1,1],[5]:[1,1],[6]:[-1,-1],[7]:[1,-1],[8]:[0,0]},Vu={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60};var Ll=(t=>(t[t.DIVISION=1]="DIVISION",t[t.STEP_AND_OFFSET=2]="STEP_AND_OFFSET",t))(Ll||{}),Cl=(t=>(t[t.NONE=0]="NONE",t[t.DURATION=1]="DURATION",t[t.DISTRIBUTION=2]="DISTRIBUTION",t[t.ALL=3]="ALL",t))(Cl||{}),Rl=(t=>(t[t.NO_RANDOM=0]="NO_RANDOM",t[t.KEEP_ORDER=1]="KEEP_ORDER",t[t.RANDOM_ELEMENTS=2]="RANDOM_ELEMENTS",t[t.ALL=3]="ALL",t))(Rl||{});class Za{constructor(e){this.data=e}serialize(){return JSON.stringify(this.toJSON())}clone(){return new this.constructor(this.toJSON())}}class la extends Za{setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return typeof e=="string"?delete this.customData[e]:e.forEach(i=>delete this.customData[i]),this}addCustomData(e){return this.customData={...this.customData,object:e},this}func(e){return e(this),this}isChroma(){return!1}isNoodleExtensions(){return!1}isMappingExtensions(){return!1}}class Me extends la{setTime(e){return this.time=e,this}}class ca extends Me{setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}mirror(e=!0){return this.posX=sa-1-this.posX,this}swapPosition(e){const i=e.posX;e.posX=this.posX,this.posX=i;const n=e.posY;return e.posY=this.posY,this.posY=n,this}getPosition(e){switch(e){case"vanilla":return[this.posX-2,this.posY];case"me":return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY];case"ne":return[this.posX-2,this.posY];default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getDistance(e){const[i,n]=this.getPosition(),[o,r]=e.getPosition();return Math.sqrt(Math.pow(o-i,2)+Math.pow(r-n,2))}isVertical(e){const[i]=this.getPosition(),[n]=e.getPosition(),o=i-n;return o>-.001&&o<.001}isHorizontal(e){const[i,n]=this.getPosition(),[o,r]=e.getPosition(),l=n-r;return l>-.001&&l<.001}isDiagonal(e){const[i,n]=this.getPosition(),[o,r]=e.getPosition(),l=Math.abs(i-o),a=Math.abs(n-r);return l===a}isInline(e,i=.5){return this.getDistance(e)<=i}isAdjacent(e){const i=this.getDistance(e);return i>.499&&i<1.001}isWindow(e,i=1.8){return this.getDistance(e)>i}isSlantedWindow(e){return this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e)}}class kl extends ca{setColor(e){return this.color=e,this}setDirection(e){return this.direction=e,this}isRed(){return this.color===0}isBlue(){return this.color===1}mirror(e=!0){switch(e&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return super.mirror(e)}swapRotation(e,i=!0){const n=e.direction;return e.direction=this.direction,this.direction=n,this}getAngle(e){switch(e){case"vanilla":return Rt[this.direction]||0;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return Rt[this.direction]||0;default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):Rt[this.direction]||0}}isDouble(e,i=.01){return e.time>this.time-i&&e.time<this.time+i&&this.color!==e.color}isValidDirection(){return this.direction>=0&&this.direction<=8}isValid(){return!this.isMappingExtensions()&&this.isValidDirection()}}class Ka extends kl{setType(e){return this.type=e,this}setAngleOffset(e){return this.angleOffset=e,this}isNote(){return this.type===0||this.type===1}isBomb(){return this.type===3}mirror(e=!0){return super.mirror(e)}swapRotation(e,i=!0){const n=e.angleOffset;return e.angleOffset=this.angleOffset,this.angleOffset=n,i&&(e.angleOffset=0-e.angleOffset,this.angleOffset=0-this.angleOffset),this}getAngle(e){switch(e){case"vanilla":return(Rt[this.direction]||0)+this.angleOffset;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return(Rt[this.direction]||0)+this.angleOffset;default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):(Rt[this.direction]||0)+this.angleOffset}}isMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0||this.direction>=1e3&&this.direction<=1360||this.direction>=2e3&&this.direction<=2360}}function xl(t,e,i){return t.direction===H.ANY&&e.direction===H.ANY&&i!==H.ANY&&(t.posX>e.posX&&(i===H.UP_RIGHT||i===H.RIGHT||i===H.DOWN_RIGHT)||t.posX<e.posX&&(i===H.DOWN_LEFT||i===H.LEFT||i===H.UP_LEFT)||t.posY>e.posY&&(i===H.UP_LEFT||i===H.UP||i===H.UP_RIGHT)||t.posY<e.posY&&(i===H.DOWN_LEFT||i===H.DOWN||i===H.DOWN_RIGHT))||t.posX>e.posX&&(t.direction===H.UP_RIGHT||t.direction===H.RIGHT||t.direction===H.DOWN_RIGHT||(e.direction===H.UP_RIGHT||e.direction===H.RIGHT||e.direction===H.DOWN_RIGHT)&&t.direction===H.ANY)||t.posX<e.posX&&(t.direction===H.DOWN_LEFT||t.direction===H.LEFT||t.direction===H.UP_LEFT||(e.direction===H.DOWN_LEFT||e.direction===H.LEFT||e.direction===H.UP_LEFT)&&t.direction===H.ANY)||t.posY>e.posY&&(t.direction===H.UP_LEFT||t.direction===H.UP||t.direction===H.UP_RIGHT||(e.direction===H.UP_LEFT||e.direction===H.UP||e.direction===H.UP_RIGHT)&&t.direction===H.ANY)||t.posY<e.posY&&(t.direction===H.DOWN_LEFT||t.direction===H.DOWN||t.direction===H.DOWN_RIGHT||(e.direction===H.DOWN_LEFT||e.direction===H.DOWN||e.direction===H.DOWN_RIGHT)&&t.direction===H.ANY)}function Ha(t,e,i,n=!1){const[o,r]=t.getPosition(),[l,a]=e.getPosition(),s=n?540:360;let c=!1;if(t.direction!==8){const u=t.getAngle(),m=(_a(Math.atan2(r-a,o-l))+450)%360;for(const[h,p,g]of i){const y=g??0,b=(u+s-h+y)%360,E=(u+s+h+y)%360;if(c=p>=Math.sqrt(Math.pow(o-l,2)+Math.pow(r-a,2))&&(b<E&&b<=m&&m<=E||b>=E&&(m<=E||m>=b))||c,c)break}}let d=!1;if(e instanceof Ka&&e.direction!==8){const u=e.getAngle(),m=(_a(Math.atan2(a-r,l-o))+450)%360;for(const[h,p,g]of i){const y=g??0,b=(u+s-h+y)%360,E=(u+s+h+y)%360;if(d=p>=Math.sqrt(Math.pow(o-l,2)+Math.pow(r-a,2))&&(b<E&&b<=m&&m<=E||b>=E&&(m<=E||m>=b))||d,d)break}}return[c,d]}function Zr(t,e){if(xl(t,e,H.ANY))return t.direction===H.ANY?e.direction:t.direction;if(t.direction!==H.ANY)return t.direction;if(t.time>e.time){if(t.posX>e.posX&&t.isHorizontal(e))return H.RIGHT;if(t.posX<e.posX&&t.isHorizontal(e))return H.LEFT;if(t.posY>e.posY){if(t.isVertical(e))return H.UP;if(t.posX>e.posX)return H.UP_RIGHT;if(t.posX<e.posX)return H.UP_LEFT}if(t.posY<e.posY){if(t.isVertical(e))return H.DOWN;if(t.posX>e.posX)return H.DOWN_RIGHT;if(t.posX<e.posX)return H.DOWN_LEFT}}return H.ANY}function on(t,e,i,n){let o,r;if(t===null||e===null)return!1;if(typeof t=="number")o=t;else{if(t.direction===H.ANY)return!1;o=t.getAngle()}if(typeof e=="number")r=e;else{if(e.direction===H.ANY)return!1;r=e.getAngle()}return n?Or(o,r,360)<=i:Or(o,r,360)>=i}class Pt{constructor(e){this.time=e.time,this.duration=e.duration,this.minSpeed=e.minSpeed,this.maxSpeed=e.maxSpeed,this.ebpm=e.ebpm,this.ebpmSwing=e.ebpmSwing,this.data=e.data}static generate(e,i){const n=[];let o=0,r=0,l,a;const s={},c={},d={0:[],1:[]};for(const u of e)u.type==="note"&&(l=0,a=Number.MAX_SAFE_INTEGER,c[u.data.color]?this.next(u,c[u.data.color],i,d[u.data.color])&&(l=this.calcMinSliderSpeed(d[u.data.color],i),a=this.calcMaxSliderSpeed(d[u.data.color],i),l>0&&a!==1/0||(l=0,a=0),n.push({time:s[u.data.color].data.time,duration:c[u.data.color].data.time-s[u.data.color].data.time,data:d[u.data.color],ebpm:o,ebpmSwing:r,maxSpeed:a,minSpeed:l}),r=this.calcEBPMBetweenObject(u.data,s[u.data.color].data,i.value),o=this.calcEBPMBetweenObject(u.data,c[u.data.color].data,i.value),s[u.data.color]=u,d[u.data.color]=[]):s[u.data.color]=u,c[u.data.color]=u,d[u.data.color].push(u));for(let u=0;u<2;u++)c[u]&&(l=this.calcMinSliderSpeed(d[u],i),a=this.calcMaxSliderSpeed(d[u],i),l>0&&a!==1/0||(l=0,a=0),n.push({time:s[u].data.time,duration:c[u].data.time-s[u].data.time,data:d[u],ebpm:o,ebpmSwing:r,maxSpeed:a,minSpeed:l}));return n}}Pt.next=(t,e,i,n)=>{if(t.type==="bomb"||e.type==="bomb")throw new Error("Invalid type");if(n&&n.length>0&&i.toRealTime(e.data.time)+.005<i.toRealTime(t.data.time)&&t.data.direction!==H.ANY){for(const o of n)if(o.type==="note"&&o.data.direction!==H.ANY&&on(t.data,o.data,90,!1))return!0}if(n&&n.length>0){for(const o of n)if(o.type==="note"&&t.data.isInline(o.data))return!0}return t.data.isWindow(e.data)&&i.toRealTime(t.data.time-e.data.time)>.08||i.toRealTime(t.data.time-e.data.time)>.07};Pt.calcEBPMBetweenObject=(t,e,i)=>i/((t.time-e.time)*2);Pt.calcMinSliderSpeed=(t,e)=>{let i=!1,n=!1,o=0;const r=e.toRealTime(Math.max(...t.map((l,a)=>a===0?0:((t[a].data.isHorizontal(t[a-1].data)||t[a].data.isVertical(t[a-1].data))&&!i&&(i=!0,o=(t[a].data.time-t[a-1].data.time)/(t[a].data.getDistance(t[a-1].data)||1)),n=t[a].data.isDiagonal(t[a-1].data)||t[a].data.isSlantedWindow(t[a-1].data)||n,(t[a].data.time-t[a-1].data.time)/(t[a].data.getDistance(t[a-1].data)||1)))));return i&&n?e.toRealTime(o):r};Pt.calcMaxSliderSpeed=(t,e)=>{let i=!1,n=!1,o=Number.MAX_SAFE_INTEGER;const r=e.toRealTime(Math.min(...t.map((l,a)=>a===0?Number.MAX_SAFE_INTEGER:((t[a].data.isHorizontal(t[a-1].data)||t[a].data.isVertical(t[a-1].data))&&!i&&(i=!0,o=(t[a].data.time-t[a-1].data.time)/(t[a].data.getDistance(t[a-1].data)||1)),n=t[a].data.isDiagonal(t[a-1].data)||t[a].data.isSlantedWindow(t[a-1].data)||n,(t[a].data.time-t[a-1].data.time)/(t[a].data.getDistance(t[a-1].data)||1)))));return i&&n?e.toRealTime(o):r};function Ju(t,e,i){const n={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let o,r;for(const l of t){if(l.type!=="note")continue;const a=i.toRealTime(l.data.time);l.data.color===0&&(o?Pt.next(l,o,i)&&n.left[Math.floor(a)]++:n.left[Math.floor(a)]++,o=l),l.data.color===1&&(r?Pt.next(l,r,i)&&n.right[Math.floor(a)]++:n.right[Math.floor(a)]++,r=l)}return n}function fa(t,e){if(!t.length)return 0;if(t.length<e)return t.reduce((o,r)=>o+r)/t.length;let i=t.slice(0,e).reduce((o,r)=>o+r),n=i;for(let o=0;o<t.length-e;o++)i=i-t[o]+t[o+e],n=Math.max(n,i);return n/e}function Kr(t,e,i,n){const r={characteristic:i,difficulty:n,red:{average:0,peak:0,median:0,total:0},blue:{average:0,peak:0,median:0,total:0},total:{average:0,peak:0,median:0,total:0},container:Pt.generate(t.getNoteContainer(),e)},l=Math.max(e.toRealTime(t.getLastInteractiveTime()-t.getFirstInteractiveTime()),0),a=Math.max(e.toRealTime(t.getLastInteractiveTime()),0),s=Ju(t.getNoteContainer(),a,e),c=s.left.map((h,p)=>h+s.right[p]);if(c.reduce((h,p)=>h+p)===0)return r;const d=[],u=[],m=[];for(let h=0,p=Math.ceil(c.length/10);h<p;h++){const g=h*10;let y=10;y+g>c.length&&(y=c.length-g);const b=s.left.slice(g,g+y),E=s.right.slice(g,g+y),w=c.slice(g,g+y);d.push(b.reduce((L,R)=>L+R)/y),u.push(E.reduce((L,R)=>L+R)/y),m.push(w.reduce((L,R)=>L+R)/y)}return r.red.total=s.left.reduce((h,p)=>h+p),r.red.average=s.left.reduce((h,p)=>h+p)/l,r.red.peak=fa(s.left,10),r.red.median=da(d),r.blue.total=s.right.reduce((h,p)=>h+p),r.blue.average=s.right.reduce((h,p)=>h+p)/l,r.blue.peak=fa(s.right,10),r.blue.median=da(u),r.total.total=r.red.total+r.blue.total,r.total.average=c.reduce((h,p)=>h+p)/l,r.total.peak=fa(c,10),r.total.median=da(m),r}function qu(t,e){let i=0,n=0,o;for(const r of t){const l=r.total.average;if(n>0&&l>0&&(i=(1-l/n)*100),n>e&&i>40)return{result:r,comparedTo:o};n=l,o=r}return null}function Zu(t,e){let i=Number.MAX_SAFE_INTEGER,n=0,o;for(const r of t){const l=r.total.average;if(n>0&&l>0&&(i=(1-l/n)*100),n=l>0?l:n,n>e&&i<10)return{result:r,comparedTo:o};o=r}return null}function Ku(t){let e=0,i=Number.MAX_SAFE_INTEGER;return t.forEach(n=>{const o=n.total.average;o>0&&(e=Math.max(e,o),i=Math.min(i,o))}),e||e&&i?(1-i/e)*100:0}function Qr(t){let e=Number.MAX_SAFE_INTEGER;return t.forEach(i=>{const n=i.total.average;n>0&&(e=Math.min(e,n))}),e}function to(t){let e=0;return t.forEach(i=>{const n=i.total.average;n>0&&(e=Math.max(e,n))}),e}function Qu(t){return Math.max(...t.map(e=>e.minSpeed),0)}function th(t){const e=t.map(i=>i.maxSpeed).filter(i=>i!==0);return e.length?Math.min(...e):0}var Bl=(t=>(t[t.Easy=1]="Easy",t[t.Normal=3]="Normal",t[t.Hard=5]="Hard",t[t.Expert=7]="Expert",t[t.ExpertPlus=9]="ExpertPlus",t))(Bl||{}),fe=(t=>(t.Easy="Easy",t.Normal="Normal",t.Hard="Hard",t.Expert="Expert",t.ExpertPlus="Expert+",t))(fe||{});const Nl="Difficulty Progression",Al="For ranking purpose, check difficuly progression to fit rankability criteria.",Il=!0,Qa=document.createElement("div"),$l=document.createElement("ul"),eh=["ExpertPlus","Expert","Hard","Normal","Easy"];for(const t of eh)$l.appendChild(ct.create(fe[t],`Toggle check progression for Standard ${fe[t]}`,!0,function(){Ye.input.params[t]=this.checked}));Qa.appendChild(ct.create(Nl,Al,Il,function(){Ye.input.enabled=this.checked}));Qa.appendChild($l);const Ye={name:Nl,description:Al,type:"general",order:{input:ht.GENERAL_PROGRESSION,output:dt.GENERAL_PROGRESSION},input:{enabled:Il,params:{ExpertPlus:!0,Expert:!0,Hard:!0,Normal:!0,Easy:!0},html:Qa},output:{html:null},run:ih};function ih(t){var a,s,c,d,u,m,h,p;const{audioDuration:e}=t.settings;if(!e){Ye.output.html=null;return}const i=st.beatmapDifficulty.map(g=>g.swingAnalysis).filter(g=>g.characteristic==="Standard"&&Ye.input.params[g.difficulty]&&g.total.total>0).sort((g,y)=>g.total.average-y.total.average).reverse();if(!i.length){Ye.output.html=null;return}const n=Math.max(e<120?3.2:e<240?4.2:5.2,I(to(i)*.4,2)),o=[];e<360&&Qr(i)>n&&o.push(pt(`Minimum SPS not met (<${n})`,`lowest SPS is ${I(Qr(i),2)}, ${I(Ku(i),2)}% drop from highest SPS (${I(to(i),2)})`,"rank"));const r=qu(i,n),l=Zu(i,n);if(r&&e<360&&o.push(pt("Violates progression",`${fe[r.result.difficulty]} exceeded 40% SPS drop, ${I(r.result.total.average,2)} from ${I(((s=(a=r.comparedTo)==null?void 0:a.total)==null?void 0:s.average)||0,2)} ${fe[r.comparedTo.difficulty]}, acceptable range (${I((((d=(c=r.comparedTo)==null?void 0:c.total)==null?void 0:d.average)||0)*.6,2)}-${I((((u=r.comparedTo)==null?void 0:u.total.average)||0)*.9,2)})`,"rank")),l&&e<360&&o.push(pt("Violates progression",`${fe[l.result.difficulty]} has less than 10% SPS drop, ${I(l.result.total.average,2)} from ${I(((m=l.comparedTo)==null?void 0:m.total.average)||0,2)} ${fe[l.comparedTo.difficulty]}, acceptable range (${I((((h=l.comparedTo)==null?void 0:h.total.average)||0)*.6,2)}-${I((((p=l.comparedTo)==null?void 0:p.total.average)||0)*.9,2)})`,"rank")),o.length){const g=document.createElement("div");o.forEach(y=>g.append(y)),Ye.output.html=g}else Ye.output.html=null}const eo=Object.freeze(Object.defineProperty({__proto__:null,audio:Vi,coverImage:Pn,previewTime:Fn,progression:Ye},Symbol.toStringTag,{value:"Module"})),Ol="Effective BPM",Ml=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,Pl=!0,tr=450,er=350,un=ct.create(Ol+" threshold",Ml,Pl,function(){Ut.input.enabled=this.checked}),Je=document.createElement("input"),ir=document.createElement("label"),qe=document.createElement("input"),nr=document.createElement("label");ir.textContent=": ";ir.htmlFor="input__tools-ebpm";Je.id="input__tools-ebpm";Je.className="input-toggle input--small";Je.type="number";Je.min="0";Je.value=tr.toString();Je.addEventListener("change",ah);nr.textContent=" (swing): ";nr.htmlFor="input__tools-ebpms";qe.id="input__tools-ebpms";qe.className="input-toggle input--small";qe.type="number";qe.min="0";qe.value=er.toString();qe.addEventListener("change",rh);un.appendChild(ir);un.appendChild(Je);un.appendChild(nr);un.appendChild(qe);const Ut={name:Ol,description:Ml,type:"note",order:{input:ht.NOTES_EFFECTIVE_BPM,output:dt.NOTES_EFFECTIVE_BPM},input:{enabled:Pl,params:{ebpmThres:tr,ebpmsThres:er},html:un,adjustTime:nh},output:{html:null},run:sh};function nh(t){Ut.input.params.ebpmThres=I(Math.min(tr,t.value*2*1.285714),1),Ut.input.params.ebpmsThres=I(Math.min(er,t.value*2),1),Je.value=Ut.input.params.ebpmThres.toString(),qe.value=Ut.input.params.ebpmsThres.toString()}function ah(){Ut.input.params.ebpmThres=I(Math.abs(parseFloat(this.value)),1),this.value=Ut.input.params.ebpmThres.toString()}function rh(){Ut.input.params.ebpmsThres=I(Math.abs(parseFloat(this.value)),1),this.value=Ut.input.params.ebpmsThres.toString()}function oh(t){const{swingAnalysis:e}=t.difficulty,{ebpmThres:i,ebpmsThres:n}=Ut.input.params,o=e.container.filter(l=>l.ebpm>i).map(l=>l.time),r=e.container.filter(l=>l.ebpmSwing>n).map(l=>l.time);return{base:o,swing:r}}function sh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=oh(t),{ebpmThres:i,ebpmsThres:n}=Ut.input.params,o=[];if(e.base.length&&o.push(ut(`>${i}EBPM warning`,e.base,t.settings.bpm,"warning")),e.swing.length&&o.push(ut(`>${n}EBPM (swing) warning`,e.swing,t.settings.bpm,"warning")),o.length){const r=document.createElement("div");o.forEach(l=>r.append(l)),Ut.output.html=r}else Ut.output.html=null}const Fl="Acceptable Beat Precision",Hl=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,zl=!0,Xl=[8,6],Ul=ct.create(Fl+": ",Hl,zl,function(){gi.input.enabled=this.checked}),Ni=document.createElement("input");Ni.id="input__tools-prec";Ni.className="input-toggle input--small";Ni.type="text";Ni.value=Xl.join(" ");Ni.addEventListener("change",lh);Ul.appendChild(Ni);const gi={name:Fl,description:Hl,type:"note",order:{input:ht.NOTES_ACCEPTABLE_PRECISION,output:dt.NOTES_ACCEPTABLE_PRECISION},input:{enabled:zl,params:{prec:[...Xl]},html:Ul},output:{html:null},run:uh};function lh(){gi.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=gi.input.params.prec.join(" ")}function ch(t,e){const{bpm:i}=t,n=e.swingAnalysis.container,{prec:o}=gi.input.params;return n.map(r=>r.time).filter((r,l,a)=>!l||r!==a[l-1]).filter(r=>{if(!o.length)return!1;for(let l=0;l<o.length;l++)if((i.adjustTime(r)+.001)%(1/o[l])<.01)return!1;return!0})}function uh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=ch(t.settings,t.difficulty);e.length?gi.output.html=ut("Off-beat precision",e,t.settings.bpm,"warning"):gi.output.html=null}const io="Varying Swing Speed",no="Check for varying swing speed due to changes in slider distance.",ao=!0,Hn={name:io,description:no,type:"note",order:{input:ht.NOTES_VARY_SWING,output:dt.NOTES_VARY_SWING},input:{enabled:ao,params:{},html:ct.create(io,no,ao,function(){Hn.input.enabled=this.checked})},output:{html:null},run:dh};function hh(t){const{swingAnalysis:e}=t;return e.container.filter(i=>Math.abs(i.minSpeed-i.maxSpeed)>.002).map(i=>i.time).filter((i,n,o)=>!n||i!==o[n-1])}function dh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=hh(t.difficulty);e.length?Hn.output.html=ut("Varying swing speed",e,t.settings.bpm,"error"):Hn.output.html=null}const Gl="Slow Slider",Yl="Look for slider that require slow swing.",jl=!0,Wl=.025,Ai=document.createElement("div"),Ze=document.createElement("input"),ar=document.createElement("label"),Ke=document.createElement("input"),rr=document.createElement("label");let Ci;ar.textContent="min speed (ms): ";ar.htmlFor="input__tools-slow-slider-time";Ze.id="input__tools-slow-slider-time";Ze.className="input-toggle input--small";Ze.type="number";Ze.min="0";Ze.value=I(Wl*1e3,1).toString();Ze.addEventListener("change",mh);rr.textContent=" (prec): ";rr.htmlFor="input__tools-slow-slider-prec";Ke.id="input__tools-slow-slider-prec";Ke.className="input-toggle input--small";Ke.type="number";Ke.min="0";Ke.addEventListener("change",ph);Ai.appendChild(ct.create(Gl,Yl,jl,function(){ee.input.enabled=this.checked}));Ai.appendChild(ar);Ai.appendChild(Ze);Ai.appendChild(rr);Ai.appendChild(Ke);const ee={name:Gl,description:Yl,type:"note",order:{input:ht.NOTES_SLOW_SLIDER,output:dt.NOTES_SLOW_SLIDER},input:{enabled:jl,params:{minSpeed:Wl},html:Ai,adjustTime:fh},output:{html:null},run:_h};function fh(t){Ci=t,Ke.value=I(1/Ci.toBeatTime(ee.input.params.minSpeed),2).toString()}function mh(){ee.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=I(ee.input.params.minSpeed*1e3,1).toString(),Ci&&(Ke.value=I(1/Ci.toBeatTime(ee.input.params.minSpeed),2).toString())}function ph(){if(!Ci){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;ee.input.params.minSpeed=Ci.toRealTime(1/t),Ze.value=I(ee.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}function gh(t){const{swingAnalysis:e}=t.difficulty,{minSpeed:i}=ee.input.params;return e.container.filter(n=>n.maxSpeed>i||n.minSpeed>i).map(n=>n.time).filter((n,o,r)=>!o||n!==r[o-1])}function _h(t){if(!t.difficulty){console.error("Something went wrong!");return}const{minSpeed:e}=ee.input.params,i=gh(t);i.length?ee.output.html=ut(`Slow slider (>${I(e*1e3,1)}ms)`,i,t.settings.bpm,"warning"):ee.output.html=null}const Vl="Inline Sharp Angle",Jl="Check for angle changes within inline note.",ql=!0,Zl=.15;let Ri;const Ii=document.createElement("div"),Qe=document.createElement("input"),or=document.createElement("label"),Pe=document.createElement("input"),sr=document.createElement("label");or.textContent="max time (ms): ";or.htmlFor="input__tools-inline-angle-time";Qe.id="input__tools-inline-angle-time";Qe.className="input-toggle input--small";Qe.type="number";Qe.min="0";Qe.value=I(Zl*1e3,1).toString();Qe.addEventListener("change",yh);sr.textContent=" (beat): ";sr.htmlFor="input__tools-inline-angle-beat";Pe.id="input__tools-inline-angle-beat";Pe.className="input-toggle input--small";Pe.type="number";Pe.min="0";Pe.step="0.1";Pe.addEventListener("change",vh);Ii.appendChild(ct.create(Vl,Jl,ql,function(){me.input.enabled=this.checked}));Ii.appendChild(or);Ii.appendChild(Qe);Ii.appendChild(sr);Ii.appendChild(Pe);const me={name:Vl,description:Jl,type:"note",order:{input:ht.NOTES_INLINE_ANGLE,output:dt.NOTES_INLINE_ANGLE},input:{enabled:ql,params:{maxTime:Zl},html:Ii,adjustTime:bh},output:{html:null},run:Dh};function bh(t){Ri=t,Pe.value=I(Ri.toBeatTime(me.input.params.maxTime),2).toString()}function yh(){me.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(me.input.params.maxTime*1e3,1).toString(),Ri&&(Pe.value=I(Ri.toBeatTime(me.input.params.maxTime),2).toString())}function vh(){if(!Ri){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;me.input.params.maxTime=Ri.toRealTime(t),Qe.value=I(me.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Eh(t){const{bpm:e}=t.settings,i=t.difficulty.noteContainer,{maxTime:n}=me.input.params,o=e.toBeatTime(n)+.001,r={},l={},a={},s={[tt.RED]:[],[tt.BLUE]:[]},c=[];let d=0;for(let u=0,m=i.length;u<m;u++){const h=i[u];h.type==="note"&&r[h.data.color]?Pt.next(h,r[h.data.color],e,s[h.data.color])?(a[h.data.color]&&(a[h.data.color]=null,l[h.data.color]=(l[h.data.color]+180)%360),ro(h.data,i,d,o)&&on(h.data,l[h.data.color],90,!0)&&c.push(h.data),h.data.direction===H.ANY?a[h.data.color]=h.data:l[h.data.color]=h.data.getAngle(),s[h.data.color]=[]):(a[h.data.color]&&ro(h.data,i,d,o)&&on(h.data,l[h.data.color],90,!0)&&(c.push(a[h.data.color]),a[h.data.color]=null),h.data.direction!==H.ANY&&(l[h.data.color]=h.data.getAngle())):h.type==="note"&&(l[h.data.color]=h.data.getAngle()),h.type==="note"&&(r[h.data.color]=h,s[h.data.color].push(h)),h.type==="bomb"&&(h.data.posY===At.BOTTOM&&(h.data.posX===rt.MIDDLE_LEFT&&(l[tt.RED]=Rt[H.UP],a[tt.RED]=null),h.data.posX===rt.MIDDLE_RIGHT&&(l[tt.BLUE]=Rt[H.UP],a[tt.BLUE]=null)),h.data.posY===At.TOP&&(h.data.posX===rt.MIDDLE_LEFT&&(l[tt.RED]=Rt[H.DOWN],a[tt.RED]=null),h.data.posX===rt.MIDDLE_RIGHT&&(l[tt.BLUE]=Rt[H.DOWN],a[tt.BLUE]=null)))}return c.map(u=>u.time).filter(function(u,m,h){return!m||u!==h[m-1]})}function ro(t,e,i,n){for(let o=i;e[o].data.time<t.time;o++){const r=e[o];if(r.type==="note"&&t.isInline(r.data)&&t.time-e[o].data.time<=n)return!0}return!1}function Dh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Eh(t);e.length?me.output.html=ut("Inline sharp angle",e,t.settings.bpm,"warning"):me.output.html=null}const Kl="shrado Angle",Ql="Look for common negative curvature pattern.",tc=!1,ec=.15,ic=1;let ki;const Fe=document.createElement("div"),bi=document.createElement("input"),lr=document.createElement("label"),ti=document.createElement("input"),cr=document.createElement("label"),He=document.createElement("input"),ur=document.createElement("label");lr.textContent="min distance: ";lr.htmlFor="input__tools-shrado-angle-distance";bi.id="input__tools-shrado-angle-distance";bi.className="input-toggle input--small";bi.type="number";bi.min="0";bi.value=ic.toString();bi.addEventListener("change",Sh);cr.textContent="max time (ms): ";cr.htmlFor="input__tools-shrado-angle-time";ti.id="input__tools-shrado-angle-time";ti.className="input-toggle input--small";ti.type="number";ti.min="0";ti.value=I(ec*1e3,1).toString();ti.addEventListener("change",Th);ur.textContent=" (beat): ";ur.htmlFor="input__tools-shrado-angle-beat";He.id="input__tools-shrado-angle-beat";He.className="input-toggle input--small";He.type="number";He.min="0";He.step="0.1";He.addEventListener("change",Lh);Fe.appendChild(ct.create(Kl,Ql,tc,function(){Wt.input.enabled=this.checked}));Fe.appendChild(lr);Fe.appendChild(bi);Fe.appendChild(document.createElement("br"));Fe.appendChild(cr);Fe.appendChild(ti);Fe.appendChild(ur);Fe.appendChild(He);const Wt={name:Kl,description:Ql,type:"note",order:{input:ht.NOTES_SHRADO_ANGLE,output:dt.NOTES_SHRADO_ANGLE},input:{enabled:tc,params:{distance:ic,maxTime:ec},html:Fe,adjustTime:wh},output:{html:null},run:Rh};function wh(t){ki=t,He.value=I(ki.toBeatTime(Wt.input.params.maxTime),2).toString()}function Sh(){Wt.input.params.distance=Math.max(parseInt(this.value),0),this.value=Wt.input.params.distance.toString()}function Th(){Wt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(Wt.input.params.maxTime*1e3,1).toString(),ki&&(He.value=I(ki.toBeatTime(Wt.input.params.maxTime),2).toString())}function Lh(){if(!ki){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;Wt.input.params.maxTime=ki.toRealTime(t),ti.value=I(Wt.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Ch(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,{maxTime:n,distance:o}=Wt.input.params,r=e.toBeatTime(n)+.001,l={},a={},s={},c={[tt.RED]:[],[tt.BLUE]:[]},d=[];for(let u=0,m=i.length;u<m;u++){if(i[u].type!=="note")continue;const h=i[u];l[h.data.color]?Pt.next(h,l[h.data.color],e,c[h.data.color])?(s[h.data.color]&&(s[h.data.color]=null,a[h.data.color]=Wu[a[h.data.color]]??8),h.data.getDistance(l[h.data.color].data)>=o&&oo(h.data.direction,a[h.data.color],h.data.color)&&h.data.time-l[h.data.color].data.time<=r&&d.push(h),h.data.direction===H.ANY?s[h.data.color]=h:a[h.data.color]=h.data.direction,c[h.data.color]=[]):(s[h.data.color]&&h.data.getDistance(l[h.data.color].data)>=o&&oo(h.data.direction,a[h.data.color],h.data.color)&&h.data.time-l[h.data.color].data.time<=r&&(d.push(s[h.data.color]),s[h.data.color]=null),h.data.direction!==H.ANY&&(a[h.data.color]=h.data.direction)):a[h.data.color]=h.data.direction,l[h.data.color]=h,c[h.data.color].push(h)}return d.map(u=>u.data.time).filter(function(u,m,h){return!m||u!==h[m-1]})}function oo(t,e,i){return t===8||e===8?!1:(i===0?e===7:e===6)&&t===0}function Rh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Ch(t);e.length?Wt.output.html=ut("Shrado angle",e,t.settings.bpm,"warning"):Wt.output.html=null}const nc="Speed Pause",ac="Look for stream/burst containing timing gap causing sudden change of pace.",rc=!1,oc=.075;let xi;const $i=document.createElement("div"),ei=document.createElement("input"),hr=document.createElement("label"),ii=document.createElement("input"),dr=document.createElement("label");hr.textContent="stream speed (ms): ";hr.htmlFor="input__tools-speed-pause-time";ei.id="input__tools-speed-pause-time";ei.className="input-toggle input--small";ei.type="number";ei.min="0";ei.value=I(oc*1e3,1).toString();ei.addEventListener("change",xh);dr.textContent=" (prec): ";dr.htmlFor="input__tools-speed-pause-prec";ii.id="input__tools-speed-pause-prec";ii.className="input-toggle input--small";ii.type="number";ii.min="0";ii.addEventListener("change",Bh);$i.appendChild(ct.create(nc,ac,rc,function(){pe.input.enabled=this.checked}));$i.appendChild(hr);$i.appendChild(ei);$i.appendChild(dr);$i.appendChild(ii);const pe={name:nc,description:ac,type:"note",order:{input:ht.NOTES_SPEED_PAUSE,output:dt.NOTES_SPEED_PAUSE},input:{enabled:rc,params:{maxTime:oc},html:$i,adjustTime:kh},output:{html:null},run:Ah};function kh(t){xi=t,ii.value=I(1/xi.toBeatTime(pe.input.params.maxTime),2).toString()}function xh(){pe.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(pe.input.params.maxTime*1e3,1).toString(),xi&&(ii.value=I(1/xi.toBeatTime(pe.input.params.maxTime),2).toString())}function Bh(){if(!xi){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;pe.input.params.maxTime=xi.toRealTime(1/t),ei.value=I(pe.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function Nh(t,e){const{bpm:i}=t,{noteContainer:n}=e,{maxTime:o}=pe.input.params,r=i.toBeatTime(o)+.001,l={},a={},s={[tt.RED]:!1,[tt.BLUE]:!1},c={[tt.RED]:[],[tt.BLUE]:[]},d=[];for(let u=0,m=n.length;u<m;u++){if(n[u].type!=="note")continue;const h=n[u];l[h.data.color]?Pt.next(h,l[h.data.color],i,c[h.data.color])&&(h.data.time-l[h.data.color].data.time<=r*2?(s[tt.RED]&&s[tt.BLUE]&&l[h.data.color].data.time-a[h.data.color].data.time<=r*3&&d.push(l[h.data.color]),s[h.data.color]=!1):s[h.data.color]||(s[h.data.color]=!0,a[h.data.color]=l[h.data.color]),c[h.data.color]=[],l[h.data.color]=h):l[h.data.color]=h,c[h.data.color].push(h)}return d.map(u=>u.data.time).filter(function(u,m,h){return!m||u!==h[m-1]})}function Ah(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Nh(t.settings,t.difficulty);e.length?pe.output.html=ut("Speed pause",e,t.settings.bpm,"warning"):pe.output.html=null}function ge(t){return Array.isArray(t)&&t.every(e=>typeof e=="number")&&t.length===3}function Xi(t,e){if(!t)return t;if(typeof e=="number")return t.map(i=>i*e);if(e)if(Array.isArray(e))for(let i=0;i<t.length;i++)typeof e[i]=="number"&&(t[i]*=e[i]);else switch(t.length){case 2:t[0]=t[0]*(e.x??1),t[1]=t[1]*(e.y??1);case 3:t[2]=t[2]*(e.z??1);case 4:t[3]=t[3]*(e.w??1)}return t}const Ht=class extends Ka{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??Ht.default.b,x:i.posX??i.x??Ht.default.x,y:i.posY??i.y??Ht.default.y,c:i.color??i.c??Ht.default.c,d:i.direction??i.d??Ht.default.d,a:i.angleOffset??i.a??Ht.default.a,customData:i.customData??Ht.default.customData()}))),e.length?e:[new this({b:Ht.default.b,x:Ht.default.x,y:Ht.default.y,c:Ht.default.c,d:Ht.default.d,a:Ht.default.a,customData:Ht.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,a:this.angleOffset,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get color(){return this.data.c}set color(t){this.data.c=t}get type(){return this.data.c}set type(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get angleOffset(){return this.data.a}set angleOffset(t){this.data.a=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ge(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(ge(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]}))),super.mirror(t)}getAngle(t){switch(t){case"vanilla":return(Rt[this.direction]||0)+this.angleOffset;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return(Rt[this.direction]||0)+this.angleOffset;default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):(Rt[this.direction]||0)+this.angleOffset}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"}};let je=Ht;je.default={b:0,c:0,x:0,y:0,d:0,a:0,customData:()=>({})};const so="Hitbox Staircase",lo="Check for overlapping post-swing hitbox with note hitbox during swing.",co=!0,zn={name:so,description:lo,type:"note",order:{input:ht.NOTES_HITBOX_STAIR,output:dt.NOTES_HITBOX_STAIR},input:{enabled:co,params:{},html:ct.create(so,lo,co,function(){zn.input.enabled=this.checked})},output:{html:null},run:Oh};function Ih(t,e,i){for(let n=i,o=e.length;n<o;n++)if(e[n].type==="note"){if(e[n].data.time<t.data.time+.01&&e[n].data.color!==t.data.color)return!0;if(e[n].data.time>t.data.time+.01)return!1}return!1}function $h(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,n=e.toBeatTime(.15),o={},r={},l={},a={[tt.RED]:[],[tt.BLUE]:[]},s={[tt.RED]:je.create()[0],[tt.BLUE]:je.create({c:1})[0]},c=[];for(let d=0,u=i.length;d<u;d++){if(i[d].type!=="note")continue;const m=i[d];o[m.data.color]?(Pt.next(m,o[m.data.color],e,a[m.data.color])?(l[m.data.color]=m.data.time-o[m.data.color].data.time,m.data.direction!==H.ANY?(s[m.data.color].posX=m.data.posX+Ge[m.data.direction][0],s[m.data.color].posY=m.data.posY+Ge[m.data.direction][1]):(s[m.data.color].posX=-1,s[m.data.color].posY=-1),a[m.data.color]=[],r[m.data.color]=m.data.direction):xl(m.data,o[m.data.color].data,r[m.data.color])&&(m.data.direction!==H.ANY?(s[m.data.color].posX=m.data.posX+Ge[m.data.direction][0],s[m.data.color].posY=m.data.posY+Ge[m.data.direction][1],r[m.data.color]=m.data.direction):(s[m.data.color].posX=m.data.posX+Ge[r[m.data.color]][0],s[m.data.color].posY=m.data.posY+Ge[r[m.data.color]][1])),o[(m.data.color+1)%2]&&m.data.time-o[(m.data.color+1)%2].data.time!==0&&m.data.time-o[(m.data.color+1)%2].data.time<Math.min(n,l[(m.data.color+1)%2])&&m.data.posX===s[(m.data.color+1)%2].posX&&m.data.posY===s[(m.data.color+1)%2].posY&&!Ih(m,i,d)&&c.push(m)):(m.data.direction!==H.ANY?(s[m.data.color].posX=m.data.posX+Ge[m.data.direction][0],s[m.data.color].posY=m.data.posY+Ge[m.data.direction][1]):(s[m.data.color].posX=-1,s[m.data.color].posY=-1),r[m.data.color]=m.data.direction),o[m.data.color]=m,a[m.data.color].push(m)}return c.map(d=>d.data.time).filter(function(d,u,m){return!u||d!==m[u-1]})}function Oh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=$h(t);e.length?zn.output.html=ut("Hitbox staircase",e,t.settings.bpm,"rank"):zn.output.html=null}const uo="Hitbox Reverse Staircase",ho="Check for overlapping pre-swing hitbox with note hitbox during swing.",fo=!0,Xn={name:uo,description:ho,type:"note",order:{input:ht.NOTES_HITBOX_REVERSE_STAIR,output:dt.NOTES_HITBOX_REVERSE_STAIR},input:{enabled:fo,params:{},html:ct.create(uo,ho,fo,function(){Xn.input.enabled=this.checked})},output:{html:null},run:Hh},Mh=.03414823529,Ph=.03414823529;function Fh(t){const{bpm:e,njs:i}=t.settings,{noteContainer:n}=t.difficulty,o={},r={[tt.RED]:[],[tt.BLUE]:[]},l=[];for(let a=0,s=n.length;a<s;a++){if(n[a].type!=="note")continue;const c=n[a];o[c.data.color]&&Pt.next(c,o[c.data.color],e,r[c.data.color])&&(r[c.data.color]=[]);for(const d of r[(c.data.color+1)%2])if(d.type==="note"&&d.data.direction!==H.ANY){if(!(e.toRealTime(c.data.time)>e.toRealTime(d.data.time)+.01))continue;const u=d.data.getAngle()%90>15&&d.data.getAngle()%90<75;if(i.value<1.425/(60*(c.data.time-d.data.time)/e.value+(u?Ph:Mh))&&Ha(c.data,d.data,[[15,1.5]])[1]){l.push(d);break}}o[c.data.color]=c,r[c.data.color].push(c)}return l.map(a=>a.data.time).filter(function(a,s,c){return!s||a!==c[s-1]})}function Hh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Fh(t);e.length?Xn.output.html=ut("Hitbox reverse Staircase",e,t.settings.bpm,"rank"):Xn.output.html=null}const mo="Hitbox Inline",po="Check for overlapping note hitbox for inline note.",go=!0,Un={name:mo,description:po,type:"note",order:{input:ht.NOTES_HITBOX_INLINE,output:dt.NOTES_HITBOX_INLINE},input:{enabled:go,params:{},html:ct.create(mo,po,go,function(){Un.input.enabled=this.checked})},output:{html:null},run:Uh},zh=0;function Xh(t){const{bpm:e,njs:i}=t.settings,{noteContainer:n}=t.difficulty,o={},r={[tt.RED]:[],[tt.BLUE]:[]},l=[];for(let a=0,s=n.length;a<s;a++){if(n[a].type!=="note")continue;const c=n[a];o[c.data.color]&&Pt.next(c,o[c.data.color],e,r[c.data.color])&&(r[c.data.color]=[]);for(const d of r[(c.data.color+1)%2])if(d.type==="note"&&i.value<1.425/(60*(c.data.time-d.data.time)/e.value+zh)&&c.data.isInline(d.data)){l.push(c);break}o[c.data.color]=c,r[c.data.color].push(c)}return l.map(a=>a.data.time).filter(function(a,s,c){return!s||a!==c[s-1]})}function Uh(t){const e=Xh(t);e.length?Un.output.html=ut("Hitbox inline",e,t.settings.bpm,"rank"):Un.output.html=null}const _o="Hitbox Path",bo="Check for overlapping pre-swing note hitbox at same time.",yo=!0,Gn={name:_o,description:bo,type:"note",order:{input:ht.NOTES_HITBOX_PATH,output:dt.NOTES_HITBOX_PATH},input:{enabled:yo,params:{},html:ct.create(_o,bo,yo,function(){Gn.input.enabled=this.checked})},output:{html:null},run:Yh};function Gh(t){const{bpm:e}=t.settings,i=t.difficulty.noteContainer.filter(r=>r.type==="bomb"||r.type==="note"),n=[];let o=0;for(let r=0,l=i.length;r<l;r++){const a=i[r];if(!(a.type==="bomb"||a.type==="slider"||a.type==="burstSlider"||e.toRealTime(a.data.time)<o+.01))for(let s=r+1;s<l;s++){const c=i[s];if(e.toRealTime(c.data.time)>e.toRealTime(a.data.time)+.01)break;c.type==="note"&&a.data.color===c.data.color||((a.data.isHorizontal(c.data)||a.data.isVertical(c.data))&&Ha(a.data,c.data,[[45,1],[15,2]]).some(d=>d)||a.data.isDiagonal(c.data)&&Ha(a.data,c.data,[[45,1],[15,1.5]]).some(d=>d))&&(n.push(a.data),o=e.toRealTime(a.data.time))}}return n.map(r=>r.time).filter(function(r,l,a){return!l||r!==a[l-1]})}function Yh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Gh(t);e.length?Gn.output.html=ut("Hitbox path",e,t.settings.bpm,"error"):Gn.output.html=null}const vo="Improper Arc",Eo="Check for correct use of arc.",Do=!0,Yn={name:vo,description:Eo,type:"note",order:{input:ht.NOTES_IMPROPER_ARC,output:dt.NOTES_IMPROPER_ARC},input:{enabled:Do,params:{},html:ct.create(vo,Eo,Do,function(){Yn.input.enabled=this.checked})},output:{html:null},run:Wh};function jh(t){const e=[...t.difficulty.noteContainer].sort((n,o)=>n.type!=="slider"?1:o.type!=="slider"?-1:0).sort((n,o)=>n.data.time-o.data.time),i=[];for(let n=0,o=!0,r=e.length;n<r;n++){const l=e[n],a=e.at(-1).data.time;if(l.type==="slider"){o=!0;for(let s=n,c=!1;s<r;s++){const d=e[s];if(d.type==="note"&&l.data.posX===d.data.posX&&l.data.posY===d.data.posY&&d.data.time<=l.data.time+.001&&l.data.color===d.data.color&&(d.data.direction===H.ANY||l.data.direction===d.data.direction)){for(let u=s;u<r;u++){const m=e[s];if(m.type==="bomb"&&l.data.posX===m.data.posX&&l.data.posY===m.data.posY&&m.data.time<=l.data.time+.001){c=!0;break}if(!(m.type!=="note"||m.data.time<l.data.tailTime)){if(l.data.posX===d.data.posX&&l.data.posY===d.data.posY&&d.data.time<=l.data.time+.001&&(l.data.color!==d.data.color||(d.data.direction===H.ANY||l.data.direction!==d.data.direction))){c=!0;break}if(d.data.time>l.data.tailTime+.001)break}}o=c||!1;break}if(d.type==="bomb"&&l.data.posX===d.data.posX&&l.data.posY===d.data.posY&&d.data.time<=l.data.time+.001)break;if(d.data.time>l.data.time+.001){o=!1;break}(d.type==="slider"||d.type==="burstSlider")&&d.data.time+.001>a&&(o=!1)}o&&i.push(l)}}return i.map(n=>n.data.time).filter(function(n,o,r){return!o||n!==r[o-1]})}function Wh(t){const e=jh(t);e.length?Yn.output.html=ut("Improper arc",e,t.settings.bpm,"error"):Yn.output.html=null}const wo="Improper Chain",So="Check for correct use of chain.",To=!0,jn={name:wo,description:So,type:"note",order:{input:ht.NOTES_IMPROPER_CHAIN,output:dt.NOTES_IMPROPER_CHAIN},input:{enabled:To,params:{},html:ct.create(wo,So,To,function(){jn.input.enabled=this.checked})},output:{html:null},run:Jh};function Vh(t){const e=[...t.difficulty.noteContainer].sort((n,o)=>n.type!=="burstSlider"?1:o.type!=="burstSlider"?-1:0).sort((n,o)=>n.data.time-o.data.time),i=[];for(let n=0,o=!0,r=e.length;n<r;n++){const l=e[n];if(l.type==="burstSlider"){o=!0;for(let a=n;a<r;a++){const s=e[a];if(s.type==="note"&&l.data.posX===s.data.posX&&l.data.posY===s.data.posY&&s.data.time<=l.data.time+.001&&l.data.color===s.data.color&&(s.data.direction===H.ANY||l.data.direction===s.data.direction)){o=!1;break}if(s.type==="bomb"&&l.data.posX===s.data.posX&&l.data.posY===s.data.posY&&s.data.time<=l.data.time+.001||s.data.time>l.data.time+.001)break}o&&i.push(l)}}return i.map(n=>n.data.time).filter(function(n,o,r){return!o||n!==r[o-1]})}function Jh(t){const e=Vh(t);e.length?jn.output.html=ut("Improper chain",e,t.settings.bpm,"error"):jn.output.html=null}const Lo="Improper Window Snap",Co="Check for slanted window snap timing.",Ro=!0,Wn={name:Lo,description:Co,type:"note",order:{input:ht.NOTES_IMPROPER_WINDOW,output:dt.NOTES_IMPROPER_WINDOW},input:{enabled:Ro,params:{},html:ct.create(Lo,Co,Ro,function(){Wn.input.enabled=this.checked})},output:{html:null},run:Zh};function qh(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,n={},o={[tt.RED]:[],[tt.BLUE]:[]},r=[];for(let l=0,a=i.length;l<a;l++){if(i[l].type!=="note")continue;const s=i[l];n[s.data.color]?Pt.next(s,n[s.data.color],e,o[s.data.color])?(n[s.data.color]=s,o[s.data.color]=[]):s.data.isSlantedWindow(n[s.data.color].data)&&s.data.time-n[s.data.color].data.time>=.001&&s.data.direction===n[s.data.color].data.direction&&s.data.direction!==H.ANY&&n[s.data.color].data.direction!==H.ANY&&r.push(n[s.data.color]):n[s.data.color]=s,o[s.data.color].push(s)}return r.map(l=>l.data.time).filter(function(l,a,s){return!a||l!==s[a-1]})}function Zh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=qh(t);e.length?Wn.output.html=ut("Improper window snap",e,t.settings.bpm,"error"):Wn.output.html=null}const hn={create:(t,e,i,n,...o)=>{const r=document.createElement(i);r.className=n;const l=document.createElement("select");l.className="input-toggle",l.id=t,o.forEach(s=>{const c=document.createElement("option");c.textContent=s.text,c.value=s.value,l.append(c)});const a=document.createElement("label");return a.htmlFor=t,a.innerHTML=`<span>${e}</span>`,r.append(a),r.append(l),r}};var sc=(t=>(t.forehand="backhand",t.backhand="forehand",t))(sc||{});const bn={[tt.RED]:{forehand:[H.DOWN,H.RIGHT,H.DOWN_LEFT,H.DOWN_RIGHT],backhand:[H.UP,H.LEFT,H.UP_LEFT,H.UP_RIGHT]},[tt.BLUE]:{forehand:[H.DOWN,H.LEFT,H.DOWN_LEFT,H.DOWN_RIGHT],backhand:[H.UP,H.RIGHT,H.UP_LEFT,H.UP_RIGHT]}},li={[tt.RED]:[0,0,90,90,45,-45,45,-45],[tt.BLUE]:[0,0,-90,-90,-45,45,-45,45]},ko={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},Ui=class{constructor(t,e,i,n,o,r){this.color=e,this.warningThreshold=i,this.errorThreshold=n,this.allowedRotation=o,r&&r!=="neutral"?(this.state=r,this.rotation=0):(this.state=this.predictStartState(t,e),this.rotation=this.predictStartRotation(t,e)),this.position=this.predictStartPosition(t,e)}check(t,e){if(this.state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const i=t[0].data.time,n=this.color;let o=this.state,r=this.rotation;e.forEach(c=>{c.data.time-.001>i||(c.data.posY===At.BOTTOM&&c.data.posX===(n?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(o="backhand",r=0),c.data.posY===At.TOP&&c.data.posX===(n?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(o="forehand",r=0))});let l,a=H.ANY;for(const c of t)c.type==="note"&&(c.data.direction!==H.ANY&&(a=c.data.direction),l&&a===H.ANY&&(a=Zr(c.data,l.data)),l=c);if(a===H.ANY)return"none";const s=ko[n][sc[o]][a];return(r>s?r-s:s-r)>180||s<Ui.CONSTRAINT_ROTATION[n][0]+this.errorThreshold||s>Ui.CONSTRAINT_ROTATION[n][1]-this.errorThreshold?"error":s<Ui.CONSTRAINT_ROTATION[n][0]+this.warningThreshold||s>Ui.CONSTRAINT_ROTATION[n][1]-this.warningThreshold||(r>s?r-s:s-r)>this.allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let l=0;l<t.length;l++){if(t[l].type!=="note")continue;const a=t[l];if(bn[a.data.color].forehand.includes(a.data.direction)){this.state="backhand";break}if(bn[a.data.color].backhand.includes(a.data.direction)){this.state="forehand";break}this.state==="neutral"&&a.data.direction===H.ANY&&(a.data.posY===0&&(this.state="backhand"),a.data.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const i=t[0].data.time,n=this.color;e.forEach(l=>{l.data.time-.001>i||(l.data.posY===At.BOTTOM&&l.data.posX===(n?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(this.state="forehand",this.rotation=0),l.data.posY===At.TOP&&l.data.posX===(n?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(this.state="backhand",this.rotation=0))});let o,r=H.ANY;for(const l of t)l.type==="note"&&(l.data.direction!==H.ANY&&(r=l.data.direction),o&&r===H.ANY&&(r=Zr(l.data,o.data)),o=l);r!==H.ANY&&(this.rotation=ko[this.color][this.state][r])}predictStartState(t,e){let i="neutral";for(let n=0,o=t.length;n<o;n++){if(t[n].type==="bomb"&&(t[n].data.posY===At.BOTTOM&&(t[n].data.posX===e?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(i="backhand"),t[n].data.posY===At.TOP&&(t[n].data.posX===e?rt.MIDDLE_RIGHT:rt.MIDDLE_LEFT)&&(i="forehand")),t[n].type!=="note")continue;let r=t[n];if(r.data.color!==Math.abs(e-1)&&r.data.color===e){if(i!=="neutral")break;const l=r.data.time;for(let a=n;a<t.length&&!(t[a].data.time>r.data.time+.001&&l<r.data.time+.001);a++){if(r=t[a],bn[r.data.color].forehand.includes(r.data.direction))return"backhand";if(bn[r.data.color].backhand.includes(r.data.direction))return"forehand";i==="neutral"&&r.data.direction===H.ANY&&(r.data.posY===At.BOTTOM&&(i="backhand"),r.data.posY>At.BOTTOM&&(i="forehand"))}break}}return i}predictStartRotation(t,e){let i=0;for(let n=0,o=t.length;n<o;n++){if(t[n].type!=="note")continue;let r=t[n];if(r.data.color===e&&r.data.color===e){const l=r.data.time;for(let a=n;a<t.length&&!(t[a].data.time>r.data.time+.001&&l<r.data.time+.001);a++){if(r=t[a],r.data.direction!==H.ANY)return li[r.data.color][r.data.direction];r.data.direction===H.ANY&&(r.data.posY===At.BOTTOM&&(r.data.posX===rt.LEFT&&(i=li[r.data.color][6]),r.data.posX===rt.RIGHT&&(i=li[r.data.color][7])),r.data.posY===At.MIDDLE&&(r.data.posX===rt.LEFT&&(i=li[r.data.color][2]),r.data.posX===rt.RIGHT&&(i=li[r.data.color][3])),r.data.posY===At.BOTTOM&&(r.data.posX===rt.LEFT&&(i=li[r.data.color][4]),r.data.posX===rt.RIGHT&&(i=li[r.data.color][5])))}break}}return i}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let za=Ui;za.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];const lc="Parity Check",cc="Perform parity check.",uc=!1,hc=document.createElement("div");hn.create("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});hn.create("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});hn.create("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});hc.appendChild(ct.create(lc+" (EXPERIMENTAL)",cc,uc,function(){sn.input.enabled=this.checked}));const sn={name:lc,description:cc,type:"note",order:{input:ht.NOTES_PARITY,output:dt.NOTES_PARITY},input:{enabled:uc,params:{warningThres:90,errorThres:45,allowedRot:90},html:hc},output:{html:null},run:Qh};function Kh(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,{warningThres:n,errorThres:o,allowedRot:r}=sn.input.params,l={},a={[tt.RED]:[],[tt.BLUE]:[]},s={[tt.RED]:[],[tt.BLUE]:[]},c={[tt.RED]:[],[tt.BLUE]:[]},d={[tt.RED]:new za(i,0,n,o,r),[tt.BLUE]:new za(i,1,n,o,r)},u={warning:[],error:[]};for(let m=0,h=i.length;m<h;m++){const p=i[m];if(p.type==="note"&&l[p.data.color]&&Pt.next(p,l[p.data.color],e,a[p.data.color])){switch(d[p.data.color].check(a[p.data.color],c[p.data.color])){case"warning":{u.warning.push(a[p.data.color][0].data.time);break}case"error":{u.error.push(a[p.data.color][0].data.time);break}}d[p.data.color].next(a[p.data.color],c[p.data.color]),c[p.data.color]=s[p.data.color],s[p.data.color]=[],a[p.data.color]=[]}p.type==="bomb"&&(s[tt.RED].push(p),s[tt.BLUE].push(p)),p.type==="note"&&(l[p.data.color]=p,a[p.data.color].push(p))}for(let m=0;m<2;m++)if(l[m])switch(d[m].check(a[m],s[m])){case"warning":{u.warning.push(a[m][0].data.time);break}case"error":{u.error.push(a[m][0].data.time);break}}return u}function Qh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Kh(t);e.warning=e.warning.filter(function(n,o,r){return!o||n!==r[o-1]}).sort((n,o)=>n-o),e.error=e.error.filter(function(n,o,r){return!o||n!==r[o-1]}).sort((n,o)=>n-o);const i=[];if(e.warning.length&&i.push(ut("Parity warning",e.warning,t.settings.bpm,"warning")),e.error.length&&i.push(ut("Parity error",e.error,t.settings.bpm,"error")),i.length){const n=document.createElement("div");i.forEach(o=>n.append(o)),sn.output.html=n}else sn.output.html=null}const xo="Double-directional",Bo="Check double-directional note swing (this may not mean parity break).",No=!0,Vn={name:xo,description:Bo,type:"note",order:{input:ht.NOTES_DOUBLE_DIRECTIONAL,output:dt.NOTES_DOUBLE_DIRECTIONAL},input:{enabled:No,params:{},html:ct.create(xo,Bo,No,function(){Vn.input.enabled=this.checked})},output:{html:null},run:ed};function td(t,e){const{bpm:i}=t,n=e.noteContainer,o={},r={},l={},a={[tt.RED]:[],[tt.BLUE]:[]},s=[];for(let c=0,d=n.length;c<d;c++){const u=n[c];u.type==="note"&&o[u.data.color]?Pt.next(u,o[u.data.color],i,a[u.data.color])?(l[u.data.color]&&(l[u.data.color]=null,r[u.data.color]=(r[u.data.color]+180)%360),on(u.data,r[u.data.color],45,!0)&&s.push(u.data),u.data.direction===H.ANY?l[u.data.color]=u.data:r[u.data.color]=u.data.getAngle(),a[u.data.color]=[]):(l[u.data.color]&&on(u.data,r[u.data.color],45,!0)&&(s.push(u.data),l[u.data.color]=null,r[u.data.color]=u.data.getAngle()),u.data.direction!==H.ANY&&(l[u.data.color]=null,r[u.data.color]=u.data.getAngle())):u.type==="note"&&(r[u.data.color]=u.data.getAngle()),u.type==="note"&&(o[u.data.color]=u,a[u.data.color].push(u)),u.type==="bomb"&&(u.data.posY===At.BOTTOM&&(u.data.posX===rt.MIDDLE_LEFT&&(r[tt.RED]=Rt[H.UP],l[tt.RED]=null),u.data.posX===rt.MIDDLE_RIGHT&&(r[tt.BLUE]=Rt[H.UP],l[tt.BLUE]=null)),u.data.posY===At.TOP&&(u.data.posX===rt.MIDDLE_LEFT&&(r[tt.RED]=Rt[H.DOWN],l[tt.RED]=null),u.data.posX===rt.MIDDLE_RIGHT&&(r[tt.BLUE]=Rt[H.DOWN],l[tt.BLUE]=null)))}return s.map(c=>c.time).filter(function(c,d,u){return!d||c!==u[d-1]})}function ed(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=td(t.settings,t.difficulty);e.length?Vn.output.html=ut("Double-directional",e,t.settings.bpm,"warning"):Vn.output.html=null}const dc="Vision Block",fc="Check for vision block caused by center note.",mc=!0,pc=.1,gc=.5;let Vt;const Ao={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},Ft=document.createElement("div"),yi=document.createElement("input"),fr=document.createElement("label"),ni=document.createElement("input"),mr=document.createElement("label"),ai=document.createElement("input"),pr=document.createElement("label"),ze=document.createElement("input"),gr=document.createElement("label"),Te=document.createElement("input"),_r=document.createElement("label"),_e=document.createElement("input"),br=document.createElement("label");fr.textContent=" VB time specific ";fr.htmlFor="input__tools-vb-time-check";yi.id="input__tools-vb-time-check";yi.className="input-toggle";yi.type="radio";yi.name="input__tools-vb-spec";yi.value="time";yi.addEventListener("change",_c);mr.textContent=" VB difficulty specific ";mr.htmlFor="input__tools-vb-diff-check";ni.id="input__tools-vb-diff-check";ni.className="input-toggle";ni.type="radio";ni.checked=!0;ni.name="input__tools-vb-spec";ni.value="difficulty";ni.addEventListener("change",_c);pr.textContent="min time (ms): ";pr.htmlFor="input__tools-vb-min-time";ai.id="input__tools-vb-min-time";ai.className="input-toggle input--small";ai.type="number";ai.min="0";ai.value=I(pc*1e3,1).toString();ai.addEventListener("change",nd);gr.textContent=" (beat): ";gr.htmlFor="input__tools-vb-min-beat";ze.id="input__tools-vb-min-beat";ze.className="input-toggle input--small";ze.type="number";ze.min="0";ze.step="0.1";ze.addEventListener("change",ad);_r.textContent="max time (ms): ";_r.htmlFor="input__tools-vb-max-time";Te.id="input__tools-vb-max-time";Te.className="input-toggle input--small";Te.type="number";Te.min="0";Te.value=I(gc*1e3,1).toString();Te.addEventListener("change",rd);br.textContent=" (beat): ";br.htmlFor="input__tools-vb-max-beat";_e.id="input__tools-vb-max-beat";_e.className="input-toggle input--small";_e.type="number";_e.min="0";_e.step="0.1";_e.addEventListener("change",od);Ft.appendChild(ct.create(dc,fc,mc,function(){yt.input.enabled=this.checked}));Ft.appendChild(yi);Ft.appendChild(fr);Ft.appendChild(ni);Ft.appendChild(mr);Ft.appendChild(document.createElement("br"));Ft.appendChild(pr);Ft.appendChild(ai);Ft.appendChild(gr);Ft.appendChild(ze);Ft.appendChild(document.createElement("br"));Ft.appendChild(_r);Ft.appendChild(Te);Ft.appendChild(br);Ft.appendChild(_e);const yt={name:dc,description:fc,type:"note",order:{input:ht.NOTES_VISION_BLOCK,output:dt.NOTES_VISION_BLOCK},input:{enabled:mc,params:{specific:"difficulty",minTime:pc,maxTime:gc},html:Ft,adjustTime:id},output:{html:null},run:ld};function id(t){Vt=t,ze.value=I(Vt.toBeatTime(yt.input.params.minTime),2).toString(),_e.value=I(Vt.toBeatTime(yt.input.params.maxTime),2).toString()}function _c(){yt.input.params.specific=this.value}function nd(){yt.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(yt.input.params.minTime*1e3,1).toString(),Vt&&(ze.value=I(Vt.toBeatTime(yt.input.params.minTime),2).toString(),yt.input.params.minTime>yt.input.params.maxTime&&(yt.input.params.maxTime=yt.input.params.minTime,Te.value=I(yt.input.params.maxTime*1e3,1).toString(),_e.value=I(Vt.toBeatTime(yt.input.params.maxTime),2).toString()))}function ad(){if(!Vt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;yt.input.params.minTime=Vt.toRealTime(t),ai.value=I(yt.input.params.minTime*1e3,1).toString(),this.value=I(t,2).toString(),yt.input.params.minTime>yt.input.params.maxTime&&(yt.input.params.maxTime=yt.input.params.minTime,Te.value=I(yt.input.params.maxTime*1e3,1).toString(),_e.value=I(Vt.toBeatTime(yt.input.params.maxTime),2).toString())}function rd(){yt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(yt.input.params.maxTime*1e3,1).toString(),Vt&&(_e.value=I(Vt.toBeatTime(yt.input.params.maxTime),2).toString())}function od(){if(!Vt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;yt.input.params.maxTime=Vt.toRealTime(t),Te.value=I(yt.input.params.maxTime*1e3,1).toString(),this.value=I(t,2).toString()}function sd(t){const{bpm:e,njs:i}=t.settings,n=t.difficulty.data.getNoteContainer().filter(m=>m.type!=="slider"),{minTime:o,maxTime:r,specific:l}=yt.input.params,a=l==="time"?e.toBeatTime(o):e.toBeatTime(Ao[t.difficulty.difficulty].min),s=l==="time"?e.toBeatTime(r):Math.min(i.hjd,e.toBeatTime(Ao[t.difficulty.difficulty].max));let c=null,d=null;const u=[];for(let m=0,h=n.length;m<h;m++){const p=n[m];c&&(p.data.time-c.data.time>=a&&p.data.time-c.data.time<=s?p.data.posX<rt.MIDDLE_RIGHT&&u.push(p):p.data.time-c.data.time>s&&(c=null)),d&&(p.data.time-d.data.time>=a&&p.data.time-d.data.time<=s?p.data.posX>rt.MIDDLE_LEFT&&u.push(p):p.data.time-d.data.time>s&&(d=null)),p.data.posY===At.MIDDLE&&p.data.posX===rt.MIDDLE_LEFT&&(c=p),p.data.posY===At.MIDDLE&&p.data.posX===rt.MIDDLE_RIGHT&&(d=p)}return u.map(m=>m.data.time).filter(function(m,h,p){return!h||m!==p[h-1]})}function ld(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=sd(t);e.length?yt.output.html=ut("Vision block",e,t.settings.bpm,"warning"):yt.output.html=null}const Io="Stacked Note",$o="Look for stacked note.",Oo=!0,Jn={name:Io,description:$o,type:"note",order:{input:ht.NOTES_STACKED_NOTE,output:dt.NOTES_STACKED_NOTE},input:{enabled:Oo,params:{},html:ct.create(Io,$o,Oo,function(){Jn.input.enabled=this.checked})},output:{html:null},run:hd};function cd(t,e){const{bpm:i}=t,{colorNotes:n}=e.data,o=[];let r=0;for(let l=0,a=n.length;l<a;l++)if(!(i.toRealTime(n[l].time)<r+.01))for(let s=l+1;s<a&&!(i.toRealTime(n[s].time)>i.toRealTime(n[l].time)+.01);s++)n[s].isInline(n[l])&&(o.push(n[l]),r=i.toRealTime(n[l].time));return o.map(l=>l.time).filter(function(l,a,s){return!a||l!==s[a-1]})}function ud(t,e){const{bpm:i,njs:n}=t,{bombNotes:o}=e.data,r=[];for(let l=0,a=o.length;l<a;l++)for(let s=l+1;s<a&&!(i.toRealTime(o[s].time)>i.toRealTime(o[l].time)+1);s++)o[l].isInline(o[s])&&(n.value<i.value/(120*(o[s].time-o[l].time))||i.toRealTime(o[s].time)<i.toRealTime(o[l].time)+.02)&&r.push(o[l]);return r.map(l=>l.time).filter(function(l,a,s){return!a||l!==s[a-1]})}function hd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=cd(t.settings,t.difficulty),i=ud(t.settings,t.difficulty),n=[];if(e.length&&n.push(ut("Stacked note",e,t.settings.bpm,"error")),i.length&&n.push(ut("Stacked bomb",i,t.settings.bpm,"error")),n.length){const o=document.createElement("div");n.forEach(r=>o.append(r)),Jn.output.html=o}else Jn.output.html=null}const Mo="Color Check",Po="Compare note color with other colored note and the arrow on itself.",Fo=!0,Ho=[1,1,1],zo={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"};function Xo(t,e){let i=Object.keys(t).find(o=>parseFloat(o)>=e)??"100",n=parseFloat(i);return t[n]}const qn={name:Mo,description:Po,type:"note",order:{input:ht.NOTES_COLOR_CHECK,output:dt.NOTES_COLOR_CHECK},input:{enabled:Fo,params:{},html:ct.create(Mo+" (EXPERIMENTAL)",Po,Fo,function(){qn.input.enabled=this.checked})},output:{html:null},run:md};function dd(t){var n,o,r,l;const e=((o=(n=t.difficulty)==null?void 0:n.info._customData)==null?void 0:o._colorLeft)??de[he[t.info._environmentName]??"The First"]._colorLeft,i=((l=(r=t.difficulty)==null?void 0:r.info._customData)==null?void 0:l._colorRight)??de[he[t.info._environmentName]??"The First"]._colorRight;return e&&i?ba(On(e),On(i)):100}function fd(t){var r,l,a,s;let e=100,i=100;const n=((l=(r=t.difficulty)==null?void 0:r.info._customData)==null?void 0:l._colorLeft)??de[he[t.info._environmentName]??"The First"]._colorLeft,o=((s=(a=t.difficulty)==null?void 0:a.info._customData)==null?void 0:s._colorRight)??de[he[t.info._environmentName]??"The First"]._colorRight;return n&&(e=ba(Ho,On(n))),o&&(i=ba(Ho,On(o))),Math.min(e,i)}function md(t){var o,r,l,a;if(!((r=(o=t.difficulty)==null?void 0:o.info._customData)!=null&&r._colorLeft)&&!((a=(l=t.difficulty)==null?void 0:l.info._customData)!=null&&a._colorRight))return;const e=dd(t),i=fd(t),n=[];if(e<=20&&n.push(pt(`${Xo(zo,e)} note color (dE${I(e,1)})`,"suggest change to better differentiate between 2 note colour","warning")),i<=20&&n.push(pt(`${Xo(zo,i)} arrow note color (dE${I(i,1)})`,"may be difficult to see the arrow","warning")),n.length){const s=document.createElement("div");n.forEach(c=>s.append(c)),qn.output.html=s}else qn.output.html=null}const Uo=Object.freeze(Object.defineProperty({__proto__:null,acceptablePrec:gi,colorCheck:qn,doubleDirectional:Vn,effectiveBPM:Ut,hitboxInline:Un,hitboxPath:Gn,hitboxReverseStair:Xn,hitboxStair:zn,improperArc:Yn,improperChain:jn,improperWindow:Wn,inlineAngle:me,parity:sn,shradoAngle:Wt,slowSlider:ee,speedPause:pe,stackedNote:Jn,varySwing:Hn,visionBlock:yt},Symbol.toStringTag,{value:"Module"}));class bc extends ca{setDuration(e){return this.duration=e,this}setWidth(e){return this.width=e,this}setHeight(e){return this.height=e,this}mirror(){return this.posX=sa-1-(this.posX+this.width-1),this}getPosition(){return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}isInteractive(){return this.posX<0&&this.width>1-this.posX||this.posX===0&&this.width>1||this.posX===1||this.posX===2}isLonger(e,i=0){return this.time+this.duration>e.time+e.duration+i}hasZero(){return this.duration===0||this.width===0||this.height===0}hasNegative(){return this.posY<0||this.duration<0||this.width<0||this.height<0}isMappingExtensions(){return this.posY>2||this.posX<=-1e3||this.posX>=1e3}isValid(){return!this.isMappingExtensions()&&!this.hasZero()&&!this.hasNegative()}}const zt=class extends bc{constructor(e){super(e)}static create(...e){const i=[];return e==null||e.forEach(n=>i.push(new this({b:n.time??n.b??zt.default.b,x:n.posX??n.x??zt.default.x,y:n.posY??n.y??zt.default.y,d:n.duration??n.d??zt.default.d,w:n.width??n.w??zt.default.w,h:n.height??n.h??zt.default.h,customData:n.customData??zt.default.customData()}))),i.length?i:[new this({b:zt.default.b,x:zt.default.x,y:zt.default.y,d:zt.default.d,w:zt.default.w,h:zt.default.h,customData:zt.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.duration,w:this.width,h:this.height,customData:_t(this.customData)}}get time(){return this.data.b}set time(e){this.data.b=e}get posX(){return this.data.x}set posX(e){this.data.x=e}get posY(){return this.data.y}set posY(e){this.data.y=e}get duration(){return this.data.d}set duration(e){this.data.d=e}get width(){return this.data.w}set width(e){this.data.w=e}get height(){return this.data.h}set height(e){this.data.h=e}get customData(){return this.data.customData}set customData(e){this.data.customData=e}mirror(){var i;const e=((i=this.customData.size)==null?void 0:i[0])??this.width;return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ge(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]-(this.posX+e-1):this.customData.animation.definitePosition.forEach(n=>{n[0]=-n[0]-(this.posX+e-1)})),Array.isArray(this.customData.animation.offsetPosition)&&(ge(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]-(this.posX+e-1):this.customData.animation.offsetPosition.forEach(n=>{n[0]=-n[0]-(this.posX+e-1)}))),super.mirror()}getPosition(){return this.customData.coordinates?[this.customData.coordinates[0],this.customData.coordinates[1]]:super.getPosition()}isChroma(){return Array.isArray(this.customData.color)}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||Array.isArray(this.customData.size)}};let te=zt;te.default={b:0,x:0,y:0,d:1,w:1,h:1,customData:()=>({})};const Go="<15ms Obstacle",Yo=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,jo=!0,ln={name:Go,description:Yo,type:"obstacle",order:{input:ht.OBSTACLES_SHORT,output:dt.OBSTACLES_SHORT},input:{enabled:jo,params:{minDur:.015},html:ct.create(Go,Yo,jo,function(){ln.input.enabled=this.checked})},output:{html:null},run:gd};function pd(t){const{obstacles:e}=t.difficulty.data,{bpm:i}=t.settings,{minDur:n}=ln.input.params,o=i.toBeatTime(n),r=[];let l=te.create()[0],a=te.create()[0],s=te.create()[0],c=te.create()[0];return e.forEach(d=>{d.posY===At.BOTTOM&&d.height>2&&d.duration>0?d.width>2||d.width>1&&d.posX===1?(d.isLonger(l)&&(d.duration<o&&r.push(d),l=d),d.isLonger(a)&&(d.duration<o&&r.push(d),a=d)):d.width===2?d.posX===rt.LEFT?d.isLonger(l)&&(d.duration<o&&r.push(d),l=d):d.posX===rt.MIDDLE_RIGHT&&d.isLonger(a)&&(d.duration<o&&r.push(d),a=d):d.width===1&&(d.posX===rt.MIDDLE_LEFT?d.isLonger(l)&&(d.duration<o&&r.push(d),l=d):d.posX===rt.MIDDLE_RIGHT&&d.isLonger(a)&&(d.duration<o&&r.push(d),a=d)):d.posY===At.TOP&&d.height>2&&d.duration>0&&(d.width>2||d.width>1&&d.posX===rt.MIDDLE_LEFT?(d.isLonger(s)&&(d.duration<o&&d.isLonger(l,o)&&d.isLonger(s,o)&&r.push(d),s=d),d.isLonger(c)&&(d.duration<o&&d.isLonger(a,o)&&d.isLonger(c,o)&&r.push(d),c=d)):d.width===2?d.posX===rt.LEFT?d.isLonger(s)&&(d.duration<o&&d.isLonger(l,o)&&d.isLonger(s,o)&&r.push(d),s=d):d.posX===rt.MIDDLE_RIGHT&&d.isLonger(c)&&(d.duration<o&&d.isLonger(a,o)&&d.isLonger(c,o)&&r.push(d),c=d):d.width===1&&(d.posX===rt.MIDDLE_LEFT?d.isLonger(s)&&(d.duration<o&&d.isLonger(l,o)&&d.isLonger(s,o)&&r.push(d),s=d):d.posX===rt.MIDDLE_RIGHT&&d.isLonger(c)&&(d.duration<o&&d.isLonger(a,o)&&d.isLonger(c,o)&&r.push(d),c=d)))}),r.map(d=>d.time).filter(function(d,u,m){return!u||d!==m[u-1]})}function gd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=pd(t);e.length?ln.output.html=ut("<15ms obstacle",e,t.settings.bpm,"warning"):ln.output.html=null}const yc="2-wide Center Obstacle",vc="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",Ec=!0,Dc=.25;let Bi;const Oi=document.createElement("div"),ri=document.createElement("input"),yr=document.createElement("label"),Xe=document.createElement("input"),vr=document.createElement("label");yr.textContent="recovery time (ms): ";yr.htmlFor="input__tools-2wide-wall-time";ri.id="input__tools-2wide-wall-time";ri.className="input-toggle input--small";ri.type="number";ri.min="0";ri.value=I(Dc*1e3,1).toString();ri.addEventListener("change",bd);vr.textContent=" (beat): ";vr.htmlFor="input__tools-2wide-wall-beat";Xe.id="input__tools-2wide-wall-beat";Xe.className="input-toggle input--small";Xe.type="number";Xe.min="0";Xe.step="0.1";Xe.addEventListener("change",yd);Oi.appendChild(ct.create(yc,vc,Ec,function(){ie.input.enabled=this.checked}));Oi.appendChild(yr);Oi.appendChild(ri);Oi.appendChild(vr);Oi.appendChild(Xe);const ie={name:yc,description:vc,type:"obstacle",order:{input:ht.OBSTACLES_CENTER,output:dt.OBSTACLES_CENTER},input:{enabled:Ec,params:{recovery:Dc},html:Oi,adjustTime:_d},output:{html:null},run:Ed};function _d(t){Bi=t,Xe.value=I(Bi.toBeatTime(ie.input.params.recovery),2).toString()}function bd(){ie.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=I(ie.input.params.recovery*1e3,1).toString(),Bi&&(Xe.value=I(Bi.toBeatTime(ie.input.params.recovery),2).toString())}function yd(){if(!Bi){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;ie.input.params.recovery=Bi.toRealTime(t),ri.value=I(ie.input.params.recovery*1e3,1).toString(),this.value=t.toString()}function vd(t){const{obstacles:e}=t.difficulty.data,{bpm:i}=t.settings,{recovery:n}=ie.input.params,o=[];let r=te.create()[0],l=te.create()[0];return e.forEach(a=>{a.posY<At.TOP&&a.height>1&&(a.width>2&&(o.push(a),a.isLonger(r)&&(r=a),a.isLonger(l)&&(l=a)),a.width===2&&(a.posX===rt.LEFT&&a.isLonger(r)&&(i.toRealTime(a.time)>i.toRealTime(l.time)-n&&i.toRealTime(a.time)<i.toRealTime(l.time+l.duration)+n&&o.push(a),r=a),a.posX===rt.MIDDLE_LEFT&&(o.push(a),a.isLonger(r)&&(r=a),a.isLonger(l)&&(l=a)),a.posX===rt.MIDDLE_RIGHT&&a.isLonger(l)&&(i.toRealTime(a.time)>i.toRealTime(r.time)-n&&i.toRealTime(a.time)<i.toRealTime(r.time+r.duration)+n&&o.push(a),l=a)),a.width===1&&(a.posX===rt.MIDDLE_LEFT&&a.isLonger(r)&&(i.toRealTime(a.time)>i.toRealTime(l.time)-n&&i.toRealTime(a.time)<i.toRealTime(l.time+l.duration)+n&&o.push(a),r=a),a.posX===rt.MIDDLE_RIGHT&&a.isLonger(l)&&(i.toRealTime(a.time)>i.toRealTime(r.time)-n&&i.toRealTime(a.time)<i.toRealTime(r.time+r.duration)+n&&o.push(a),l=a)))}),o.map(a=>a.time).filter(function(a,s,c){return!s||a!==c[s-1]})}function Ed(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=vd(t),{recovery:i}=ie.input.params;e.length?ie.output.html=ut(`2-wide center obstacle (<${I(i*1e3)}ms)`,e,t.settings.bpm,"error"):ie.output.html=null}const Wo="Zero Obstacle",Vo="Look for obstacle with zero value.",Jo=!0,Zn={name:Wo,description:Vo,type:"obstacle",order:{input:ht.OBSTACLES_ZERO,output:dt.OBSTACLES_ZERO},input:{enabled:Jo,params:{},html:ct.create(Wo,Vo,Jo,function(){Zn.input.enabled=this.checked})},output:{html:null},run:wd};function Dd(t){const{obstacles:e}=t.difficulty.data;return e.filter(i=>i.hasZero()).map(i=>i.time)}function wd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Dd(t);e.length?Zn.output.html=ut("Zero value obstacle",e,t.settings.bpm,"error"):Zn.output.html=null}const qo=Object.freeze(Object.defineProperty({__proto__:null,centerObstacle:ie,shortObstacle:ln,zeroObstacle:Zn},Symbol.toStringTag,{value:"Module"})),Zo="Insufficient Lighting Event",Ko="Check if there is enough light event.",Qo=!0,Kn={name:Zo,description:Ko,type:"event",order:{input:ht.EVENTS_INSUFFICIENT_LIGHT,output:dt.EVENTS_INSUFFICIENT_LIGHT},input:{enabled:Qo,params:{},html:ct.create(Zo,Ko,Qo,function(){Kn.input.enabled=this.checked})},output:{html:null},run:Td};function Sd(t,e){let i=0;for(let n=t.length-1;n>=0;n--)if(t[n].isLightEvent(e)&&!t[n].isOff()&&(i++,i>10))return!0;return!1}function Td(t){if(!t.difficulty){console.error("Something went wrong!");return}Sd(t.difficulty.data.basicEvents,t.difficulty.characteristic==="360Degree"||t.difficulty.characteristic==="90Degree"?t.info._allDirectionsEnvironmentName:t.info._environmentName)?Kn.output.html=null:Kn.output.html=pt("Insufficient light event","","rank")}var Er=(t=>(t.Standard="Standard",t.NoArrows="No Arrows",t.OneSaber="One Saber",t["360Degree"]="360 Degree",t["90Degree"]="90 Degree",t.Lightshow="Lightshow",t.Lawless="Lawless",t))(Er||{}),Xa=(t=>(t[t.Standard=0]="Standard",t[t.NoArrows=1]="NoArrows",t[t.OneSaber=2]="OneSaber",t[t["360Degree"]=3]="360Degree",t[t["90Degree"]=4]="90Degree",t[t.Lightshow=5]="Lightshow",t[t.Lawless=6]="Lawless",t))(Xa||{});const Di=class{constructor(t,e=10,i=0){this._bpm=t,this._njs=e,this._sdm=i,this.update()}static create(t,e=10,i=0){return new Di(typeof t=="number"?Oe.create(t):t,e,i)}get value(){return this._njs}set value(t){this._njs=t,this.update()}get offset(){return this._sdm}set offset(t){this._sdm=t,this.update()}get hjd(){return this._hjd}get hjdMin(){return Di.HJD_MIN}get reactTime(){return this._reactionTime}get jd(){return this._jd}get jdMin(){return this._jdMin}update(){this._hjd=this.calcHJD(),this._jd=this.calcJD(),this._jdMin=this.calcJD(Di.HJD_MIN),this._reactionTime=this.calcRTFromHJD()}calcHJDRaw(){const e=this._njs*this._njs/this._njs,i=60/this._bpm.value;let n=Di.HJD_START;for(;e*i*n>17.999;)n/=2;return n<1&&(n=1),n}calcHJD(t=this.offset){return Math.max(this.calcHJDRaw()+t,Di.HJD_MIN)}calcHJDFromJD(t=this.calcJD()){return t/(60/this._bpm.value*this._njs*2)}calcHJDFromRT(t=this.calcRTFromHJD()){return t/(60/this._bpm.value)}calcJD(t=this.calcHJD()){return this._njs*(60/this._bpm.value)*t*2}calcJDOptimalHigh(){return 18*(1/1.07)**this._njs+18}calcJDOptimalLow(){return-(18/(this._njs+1))+18}calcRTFromJD(t=this.calcJD()){return t/(2*this._njs)}calcRTFromHJD(t=this.calcHJD()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let Se=Di;Se.HJD_START=4;Se.HJD_MIN=.25;Se.FallbackNJS={ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10};function Ld(t,e){const i=ts(t),n=ts(e);for(const o in i){if(i[o]<n[o])return"old";if(i[o]>n[o])return"new"}return"current"}function ts(t){return t.replace("v","").split(".").map(e=>parseInt(e))}class Cd extends ca{isMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0}isValid(){return!this.isMappingExtensions()}}class Rd extends Me{setBPM(e){return this.bpm=e,this}isValid(){return this.bpm>0}}class wc extends kl{setTailTime(e){return this.tailTime=e,this}setTailPosX(e){return this.tailPosX=e,this}setTailPosY(e){return this.tailPosY=e,this}mirror(e=!0){return this.tailPosX=sa-1-this.tailPosX,super.mirror(e)}getTailPosition(e){switch(e){case"vanilla":return[this.tailPosX,this.tailPosY];case"me":return[(this.tailPosX<=-1e3?this.tailPosX/1e3:this.tailPosX>=1e3?this.tailPosX/1e3:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY];case"ne":return[this.tailPosX,this.tailPosY];default:return[(this.tailPosX<=-1e3?this.tailPosX/1e3:this.tailPosX>=1e3?this.tailPosX/1e3:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY]}}getAngle(e){switch(e){case"vanilla":return Rt[this.direction]||0;case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"ne":return Rt[this.direction]||0}return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):Rt[this.direction]||0}getDistance(e){const[i,n]=this.getPosition(),[o,r]=e.getPosition();return Math.sqrt(Math.pow(o-i,2)+Math.pow(r-n,2))}isVertical(e){const[i]=this.getPosition(),[n]=e.getPosition(),o=i-n;return o>-.001&&o<.001}isHorizontal(e){const[i,n]=this.getPosition(),[o,r]=e.getPosition(),l=n-r;return l>-.001&&l<.001}isDiagonal(e){const[i,n]=this.getPosition(),[o,r]=e.getPosition(),l=Math.abs(i-o),a=Math.abs(n-r);return l===a}isInline(e,i=.5){return this.getDistance(e)<=i}isAdjacent(e){const i=this.getDistance(e);return i>.499&&i<1.001}isWindow(e,i=1.8){return this.getDistance(e)>i}isSlantedWindow(e){return this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e)}isInverse(){return this.time>this.tailTime}}class kd extends wc{setSliceCount(e){return this.sliceCount=e,this}setSquish(e){return this.squish=e,this}isMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360}isValid(){return!(this.isMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)&&!(this.posX===this.tailPosX&&this.posY===this.tailPosY)}}class xd extends Me{setToggle(e){return this.toggle=e,this}isValid(){return!0}}class Sc extends la{constructor(){super(...arguments),this._fileName="UnnamedDifficulty.dat"}clone(){return super.clone().setFileName(this.fileName)}set fileName(e){this._fileName=e.trim()}get fileName(){return this._fileName}setFileName(e){return this.fileName=e,this}nps(e){const i=this.getNoteContainer().filter(n=>n.type!=="bomb");return e?i.length/e:0}peak(e,i){let n=0,o=0;i=typeof i=="number"?Oe.create(i):i;const r=this.getNoteContainer().filter(l=>l.type!=="bomb");for(let l=0;l<r.length;l++){for(;r[l].data.time-r[o].data.time>e;)o++;n=Math.max(n,(l-o+1)/i.toRealTime(e))}return n}getFirstInteractiveTime(){const e=this.getNoteContainer().filter(o=>o.type!=="slider");let i=Number.MAX_VALUE;e.length>0&&(i=e[0].data.time);const n=this.findFirstInteractiveObstacleTime();return Math.min(i,n)}getLastInteractiveTime(){const e=this.getNoteContainer().filter(o=>o.type!=="slider");let i=0;e.length>0&&(i=e[e.length-1].data.time);const n=this.findLastInteractiveObstacleTime();return Math.max(i,n)}findFirstInteractiveObstacleTime(){for(let e=0,i=this.obstacles.length;e<i;e++)if(this.obstacles[e].isInteractive())return this.obstacles[e].time;return Number.MAX_VALUE}findLastInteractiveObstacleTime(){let e=0;for(let i=this.obstacles.length-1;i>=0;i--)this.obstacles[i].isInteractive()&&(e=Math.max(e,this.obstacles[i].time+this.obstacles[i].duration));return e}getNoteContainer(){const e=[];return this.colorNotes.forEach(i=>e.push({type:"note",data:i})),this.sliders.forEach(i=>e.push({type:"slider",data:i})),this.burstSliders.forEach(i=>e.push({type:"burstSlider",data:i})),this.bombNotes.forEach(i=>e.push({type:"bomb",data:i})),e.sort((i,n)=>i.data.time-n.data.time)}getEventContainer(){const e=[];return this.basicEvents.forEach(i=>e.push({type:"basicEvent",data:i})),this.colorBoostEvents.forEach(i=>e.push({type:"boost",data:i})),e.sort((i,n)=>i.data.time-n.data.time)}}class Tc extends Me{setType(e){return this.type=e,this}setValue(e){return this.value=e,this}setFloatValue(e){return this.floatValue=e,this}isOff(){return this.value===0}isOn(){return this.value===1||this.value===5||this.value===9}isFlash(){return this.value===2||this.value===6||this.value===10}isFade(){return this.value===3||this.value===7||this.value===11}isTransition(){return this.value===4||this.value===8||this.value===12}isBlue(){return this.value===1||this.value===2||this.value===3||this.value===4}isRed(){return this.value===5||this.value===6||this.value===7||this.value===8}isWhite(){return this.value===9||this.value===10||this.value===11||this.value===12}isLightEvent(e){switch(e){case"LizzoEnvironment":return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===8||this.type===9||this.type===10||this.type===11||this.type===12;default:return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}}isColorBoost(){return this.type===5}isRingEvent(e){switch(e){case"LizzoEnvironment":return!1;default:return this.type===8||this.type===9}}isLaserRotationEvent(e){switch(e){case"LizzoEnvironment":return!1;default:return this.type===12||this.type===13}}isLaneRotationEvent(e){return this.type===14||this.type===15}isExtraEvent(e){return this.type===16||this.type===17||this.type===18||this.type===19}isSpecialEvent(e){return this.type===40||this.type===41||this.type===42||this.type===43}isBPMChangeEvent(){return this.type===100}isLightingEvent(e){return this.isLightEvent(e)||this.isRingEvent(e)||this.isLaserRotationEvent(e)||this.isExtraEvent(e)}isOldChroma(){return this.value>=2e9}isValidType(){return this.type>=0&&this.type<=19||this.type>=40&&this.type<=43||this.type===100}isValid(){return this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.isOldChroma())}}class Lc extends Za{setKeyword(e){return this.keyword=e,this}setEvents(e){return this.events=e,this}addEvent(e){return this.events.push(e),this}removeEvent(e){const i=this.events.indexOf(e,0);return i>-1&&this.events.splice(i,1),this}}class Cc extends Za{setData(e){return this.list=e,this}removeData(e){return this.list=this.list.filter(i=>i.keyword!==e),this}}class Bd extends la{setType(e){return this.type=e,this}setP0(e){return this.p0=e,this}setP1(e){return this.p1=e,this}setReverse(e){return this.reverse=e,this}setChunks(e){return this.chunks=e,this}setRandom(e){return this.random=e,this}setSeed(e){return this.seed=e,this}setLimit(e){return this.limit=e,this}setLimitAffectsType(e){return this.limitAffectsType=e,this}isValid(){return(this.type===1||this.type===2)&&this.p0>=0&&this.p1>=0&&(this.reverse===0||this.reverse===1)&&this.chunks>=0&&this.random>=0&&this.random<=Rl.ALL&&this.limit>=0&&this.limit<=0&&this.limitAffectsType>=0&&this.limitAffectsType<=Cl.ALL}}class Nd extends Me{setTransition(e){return this.transition=e,this}setColor(e){return this.color=e,this}setBrightness(e){return this.brightness=e,this}setFrequency(e){return this.frequency=e,this}isValid(){return this.transition>=0&&this.transition<=2&&this.color>=-1&&this.color<=2&&this.brightness>=0&&this.frequency>=0}}class Dr extends la{setFilter(e){return this.filter=e,this}setBeatDistribution(e){return this.beatDistribution=e,this}setBeatDistributionType(e){return this.beatDistributionType=e,this}setEasing(e){return this.easing=e,this}isValid(){return(this.beatDistributionType===1||this.beatDistributionType===2)&&this.easing>=0&&this.easing<=3&&this.events.every(e=>e.isValid())&&this.filter.isValid()}}class Ad extends Dr{setBrightnessDistribution(e){return this.brightnessDistribution=e,this}setBrightnessDistributionType(e){return this.brightnessDistributionType=e,this}setAffectFirst(e){return this.affectFirst=e,this}isValid(){return super.isValid()&&(this.brightnessDistributionType===1||this.brightnessDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}}class wr extends Me{isValid(){return this.id>=0&&this.boxes.every(e=>e.isValid())}}class Id extends wr{}class $d extends Me{setPrevious(e){return this.previous=e,this}setEasing(e){return this.easing=e,this}setLoop(e){return this.loop=e,this}setRotation(e){return this.rotation=e,this}setDirection(e){return this.direction=e,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3&&(this.loop===0||this.loop===1)&&this.direction>=0&&this.direction<=2}}class Od extends Dr{setRotationDistribution(e){return this.rotationDistribution=e,this}setRotationDistributionType(e){return this.rotationDistributionType=e,this}setAxis(e){return this.axis=e,this}setFlip(e){return this.flip=e,this}setAffectFirst(e){return this.affectFirst=e,this}isValid(){return super.isValid()&&(this.rotationDistributionType===1||this.rotationDistributionType===2)&&(this.axis===0||this.axis===1)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}class Md extends wr{}class Pd extends Me{setExecutionTime(e){return this.executionTime=e,this}setRotation(e){return this.rotation=e,this}isValid(){return this.executionTime===0||this.executionTime===1}}class Rc extends wc{setLengthMultiplier(e){return this.lengthMultiplier=e,this}setTailLengthMultiplier(e){return this.tailLengthMultiplier=e,this}setTailDirection(e){return this.tailDirection=e,this}setMidAnchor(e){return this.midAnchor=e,this}mirror(e=!0){switch(this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),super.mirror(e)}getTailAngle(e){switch(e){case"vanilla":return Rt[this.tailDirection]||0;case"me":if(this.tailDirection>=1e3)return Math.abs(this.tailDirection%1e3%360-360);case"ne":return Rt[this.tailDirection]||0;default:return this.tailDirection>=1e3?Math.abs(this.tailDirection%1e3%360-360):Rt[this.tailDirection]||0}}isMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360||this.tailDirection>=1e3&&this.tailDirection<=1360}isValid(){return!(this.isMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3||this.posX===this.tailPosX&&this.posY===this.tailPosY&&this.time===this.tailTime)}}class kc extends ca{setDirection(e){return this.direction=e,this}mirror(){switch(this.posX=sa-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}isValid(){return this.direction>=0&&this.direction<=9&&this.direction!==8}}const Gt=class extends Ka{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({_time:i.time??i._time??Gt.default._time,_lineIndex:i.posX??i._lineIndex??Gt.default._lineIndex,_lineLayer:i.posY??i._lineLayer??Gt.default._lineLayer,_type:i.type??i._type??Gt.default._type,_cutDirection:i.direction??i._cutDirection??Gt.default._cutDirection,_customData:i.customData??i._customData??Gt.default._customData()}))),e.length?e:[new this({_time:Gt.default._time,_lineIndex:Gt.default._lineIndex,_lineLayer:Gt.default._lineLayer,_type:Gt.default._type,_cutDirection:Gt.default._cutDirection,_customData:Gt.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_cutDirection:this.direction,_customData:_t(this.customData)}}get time(){return this.data._time}set time(t){this.data._time=t}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get posY(){return this.data._lineLayer}set posY(t){this.data._lineLayer=t}get type(){return this.data._type}set type(t){this.data._type=t}get color(){return this.data._type}set color(t){this.data._type=t}get direction(){return this.data._cutDirection}set direction(t){this.data._cutDirection=t}get angleOffset(){return 0}set angleOffset(t){}get customData(){return this.data._customData}set customData(t){this.data._customData=t}getPosition(t){return this.customData._position?[this.customData._position[0],this.customData._position[1]]:super.getPosition(t)}getAngle(t){return this.customData._cutDirection?this.customData._cutDirection>0?this.customData._cutDirection%360:360+this.customData._cutDirection%360:super.getAngle(t)}isChroma(){return Array.isArray(this.customData._color)||typeof this.customData._disableSpawnEffect=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._cutDirection=="number"||typeof this.customData._disableNoteGravity=="boolean"||typeof this.customData._disableNoteLook=="boolean"||typeof this.customData._fake=="boolean"||Array.isArray(this.customData._flip)||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)}};let wi=Gt;wi.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0,_customData:()=>({})};const Et=class extends Rc{constructor(e){super(e)}static create(...e){const i=[];return e==null||e.forEach(n=>i.push(new this({_colorType:n.color??n._colorType??Et.default._colorType,_headTime:n.time??n._headTime??n._tailTime??Et.default._headTime,_headLineIndex:n.posX??n._headLineIndex??Et.default._headLineIndex,_headLineLayer:n.posY??n._headLineLayer??Et.default._headLineLayer,_headCutDirection:n.direction??n._headCutDirection??Et.default._headCutDirection,_headControlPointLengthMultiplier:n.lengthMultiplier??n._headControlPointLengthMultiplier??Et.default._headControlPointLengthMultiplier,_tailTime:n.tailTime??n._tailTime??n._headTime??Et.default._tailTime,_tailLineIndex:n.tailPosX??n._tailLineIndex??Et.default._tailLineIndex,_tailLineLayer:n.tailPosY??n._tailLineLayer??Et.default._tailLineLayer,_tailCutDirection:n.tailDirection??n._tailCutDirection??Et.default._tailCutDirection,_tailControlPointLengthMultiplier:n.tailLengthMultiplier??n._tailControlPointLengthMultiplier??Et.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:n.midAnchor??n._sliderMidAnchorMode??Et.default._sliderMidAnchorMode,_customData:n.customData??n._customData??Et.default._customData()}))),i.length?i:[new this({_colorType:Et.default._colorType,_headTime:Et.default._headTime,_headLineIndex:Et.default._headLineIndex,_headLineLayer:Et.default._headLineLayer,_headCutDirection:Et.default._headCutDirection,_headControlPointLengthMultiplier:Et.default._headControlPointLengthMultiplier,_tailTime:Et.default._tailTime,_tailLineIndex:Et.default._tailLineIndex,_tailLineLayer:Et.default._tailLineLayer,_tailCutDirection:Et.default._tailCutDirection,_tailControlPointLengthMultiplier:Et.default._tailControlPointLengthMultiplier,_sliderMidAnchorMode:Et.default._sliderMidAnchorMode,_customData:Et.default._customData()})]}toJSON(){return{_colorType:this.color,_headTime:this.time,_headLineIndex:this.posX,_headLineLayer:this.posY,_headCutDirection:this.direction,_headControlPointLengthMultiplier:this.lengthMultiplier,_tailTime:this.tailTime,_tailLineIndex:this.tailPosX,_tailLineLayer:this.tailPosY,_tailCutDirection:this.tailDirection,_tailControlPointLengthMultiplier:this.tailLengthMultiplier,_sliderMidAnchorMode:this.midAnchor,_customData:_t(this.customData)}}get color(){return this.data._colorType}set color(e){this.data._colorType=e}get time(){return this.data._headTime}set time(e){this.data._headTime=e}get posX(){return this.data._headLineIndex}set posX(e){this.data._headLineIndex=e}get posY(){return this.data._headLineLayer}set posY(e){this.data._headLineLayer=e}get direction(){return this.data._headCutDirection}set direction(e){this.data._headCutDirection=e}get lengthMultiplier(){return this.data._headControlPointLengthMultiplier}set lengthMultiplier(e){this.data._headControlPointLengthMultiplier=e}get tailTime(){return this.data._tailTime}set tailTime(e){this.data._tailTime=e}get tailPosX(){return this.data._tailLineIndex}set tailPosX(e){this.data._tailLineIndex=e}get tailPosY(){return this.data._tailLineLayer}set tailPosY(e){this.data._tailLineLayer=e}get tailDirection(){return this.data._tailCutDirection}set tailDirection(e){this.data._tailCutDirection=e}get tailLengthMultiplier(){return this.data._tailControlPointLengthMultiplier}set tailLengthMultiplier(e){this.data._tailControlPointLengthMultiplier=e}get midAnchor(){return this.data._sliderMidAnchorMode}set midAnchor(e){this.data._sliderMidAnchorMode=e}get customData(){return this.data._customData}set customData(e){this.data._customData=e}};let Ln=Et;Ln.default={_colorType:0,_headTime:0,_headLineIndex:0,_headLineLayer:0,_headCutDirection:0,_headControlPointLengthMultiplier:1,_tailTime:0,_tailLineIndex:0,_tailLineLayer:0,_tailCutDirection:0,_tailControlPointLengthMultiplier:1,_sliderMidAnchorMode:0,_customData:()=>({})};const Yt=class extends bc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({_time:i.time??i._time??Yt.default._time,_type:i._type??Yt.default._type,_lineIndex:i.posX??i._lineIndex??Yt.default._lineIndex,_duration:i.duration??i._duration??Yt.default._duration,_width:i.width??i._width??Yt.default._width,_customData:i.customData??i._customData??Yt.default._customData()}))),e.length?e:[new this({_time:Yt.default._time,_type:Yt.default._type,_lineIndex:Yt.default._lineIndex,_duration:Yt.default._duration,_width:Yt.default._width,_customData:Yt.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_duration:this.duration,_width:this.width,_customData:_t(this.customData)}}get time(){return this.data._time}set time(t){this.data._time=t}get posX(){return this.data._lineIndex}set posX(t){this.data._lineIndex=t}get type(){return this.data._type}set type(t){this.data._type=t}get posY(){return this.type==1?0:2}set posY(t){if(t!=0&&t!=2){this.type=0;return}}get duration(){return this.data._duration}set duration(t){this.data._duration=t}get width(){return this.data._width}set width(t){this.data._width=t}get height(){return this.type==1?3:5}set height(t){if(t!=3&&t!=5){this.type=0;return}}get customData(){return this.data._customData}set customData(t){this.data._customData=t}getPosition(){return this.customData._position?[this.customData._position[0],this.customData._position[1]]:super.getPosition()}isChroma(){return Array.isArray(this.customData._color)}isNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._fake=="boolean"||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||Array.isArray(this.customData._scale)}};let Cn=Yt;Cn.default={_time:0,_lineIndex:0,_type:0,_duration:1,_width:1,_customData:()=>({})};const oe=class extends Tc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({_time:i.time??i._time??oe.default._time,_type:i.type??i._type??oe.default._type,_value:i.value??i._value??oe.default._value,_floatValue:i.floatValue??i._floatValue??oe.default._floatValue,_customData:i.customData??i._customData??oe.default._customData()}))),e.length?e:[new this({_time:oe.default._time,_type:oe.default._type,_value:oe.default._value,_floatValue:oe.default._floatValue,_customData:oe.default._customData()})]}toJSON(){return{_time:this.time,_type:this.type,_value:this.value,_floatValue:this.floatValue,_customData:_t(this.customData)}}get time(){return this.data._time}set time(t){this.data._time=t}get type(){return this.data._type}set type(t){this.data._type=t}get value(){return this.data._value}set value(t){this.data._value=t}get floatValue(){return this.data._floatValue}set floatValue(t){this.data._floatValue=t}get customData(){return this.data._customData}set customData(t){this.data._customData=t}isLightEvent(t){return super.isLightEvent(t)}isRingEvent(t){return super.isRingEvent(t)}isLaserRotationEvent(t){return super.isLaserRotationEvent(t)}isLaneRotationEvent(t){return super.isLaneRotationEvent(t)}isChroma(){const t=this;return t.isLightEvent()?Array.isArray(this.customData._color)||typeof this.customData._lightID=="number"||Array.isArray(this.customData._lightID)||typeof this.customData._propID=="number"||typeof this.customData._lightGradient=="object"||typeof this.customData._easing=="string"||typeof this.customData._lerpType=="string":t.isRingEvent()?typeof this.customData._nameFilter=="string"||typeof this.customData._reset=="boolean"||typeof this.customData._rotation=="number"||typeof this.customData._step=="number"||typeof this.customData._prop=="number"||typeof this.customData._speed=="number"||typeof this.customData._direction=="number"||typeof this.customData._counterSpin=="boolean"||typeof this.customData._stepMult=="number"||typeof this.customData._propMult=="number"||typeof this.customData._speedMult=="number":t.isLaserRotationEvent()?typeof this.customData._lockPosition=="boolean"||typeof this.customData._speed=="number"||typeof this.customData._preciseSpeed=="number"||typeof this.customData._direction=="number":!1}isNoodleExtensions(){return this.isLaneRotationEvent()&&typeof this.customData._rotation=="number"}isMappingExtensions(){return this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720}};let De=oe;De.default={_time:0,_type:0,_value:0,_floatValue:1,_customData:()=>({})};const se=class extends kc{constructor(e){super(e)}static create(...e){const i=[];return e==null||e.forEach(n=>i.push(new this({_time:n.time??n._time??se.default._time,_lineIndex:n.posX??n._lineIndex??se.default._lineIndex,_lineLayer:n.posY??n._lineLayer??se.default._lineLayer,_offsetDirection:n.direction??n._offsetDirection??se.default._offsetDirection,_customData:n.customData??n._customData??se.default._customData()}))),i.length?i:[new this({_time:se.default._time,_lineIndex:se.default._lineIndex,_lineLayer:se.default._lineLayer,_offsetDirection:se.default._offsetDirection,_customData:se.default._customData()})]}toJSON(){return{_time:this.time,_lineIndex:this.posX,_lineLayer:this.posY,_offsetDirection:this.direction,_customData:_t(this.customData)}}get time(){return this.data._time}set time(e){this.data._time=e}get posX(){return this.data._lineIndex}set posX(e){this.data._lineIndex=e}get posY(){return this.data._lineLayer}set posY(e){this.data._lineLayer=e}get direction(){return this.data._offsetDirection}set direction(e){this.data._offsetDirection=e}get customData(){return this.data._customData}set customData(e){this.data._customData=e}};let Rn=se;Rn.default={_time:0,_lineIndex:0,_lineLayer:0,_offsetDirection:1,_customData:()=>({})};const Gi=class extends Lc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({_keyword:i.keyword??i._keyword??Gi.default._keyword,_specialEvents:i.events??i._specialEvents??Gi.default._specialEvents()}))),e.length?e:[new this({_keyword:Gi.default._keyword,_specialEvents:Gi.default._specialEvents()})]}toJSON(){return{_keyword:this.keyword,_specialEvents:this.events}}get keyword(){return this.data._keyword}set keyword(t){this.data._keyword=t}get events(){return this.data._specialEvents}set events(t){this.data._specialEvents=t}};let xc=Gi;xc.default={_keyword:"",_specialEvents:()=>[]};const Bc=class extends Cc{constructor(t){super(t),this._d=t._keywords.map(e=>xc.create({_keyword:e._keyword,_specialEvents:e._specialEvents})[0])}static create(t={}){var e;return new this({_keywords:((e=t.list)==null?void 0:e.map(i=>({_keyword:i==null?void 0:i.keyword,_specialEvents:i==null?void 0:i.events})))??t._keywords??Bc.default._keywords()})}toJSON(){return{_keywords:this._d.map(t=>t.toJSON())}}get list(){return this._d}set list(t){this._d=t}addData(t){return this._d.push(t),this}};let Nc=Bc;Nc.default={_keywords:()=>[]};let Fd=class extends Sc{constructor(e){super(e),this.bpmEvents=[],this.rotationEvents=[],this.bombNotes=[],this.burstSliders=[],this.colorBoostEvents=[],this.lightColorEventBoxGroups=[],this.lightRotationEventBoxGroups=[],this.lightTranslationEventBoxGroups=[],this.useNormalEventsAsCompatibleEvents=!0,this.version="2.6.0",this.colorNotes=e._notes.map(i=>wi.create(i)[0]),this.sliders=e._sliders.map(i=>Ln.create(i)[0]),this.obstacles=e._obstacles.map(i=>Cn.create(i)[0]),this.basicEvents=e._events.map(i=>De.create(i)[0]),this.waypoints=e._waypoints.map(i=>Rn.create(i)[0]),this.eventTypesWithKeywords=Nc.create(e._specialEventsKeywordFilters),this.customData=e._customData}static create(e={}){return new this({_version:"2.6.0",_notes:e._notes??[],_sliders:e._sliders??[],_obstacles:e._obstacles??[],_events:e._events??[],_waypoints:e._waypoints??[],_specialEventsKeywordFilters:e._specialEventsKeywordFilters??{_keywords:[]},_customData:e._customData??{}})}toJSON(){return{_version:"2.6.0",_notes:this.colorNotes.map(e=>e.toJSON()),_sliders:this.sliders.map(e=>e.toJSON()),_obstacles:this.obstacles.map(e=>e.toJSON()),_events:this.basicEvents.map(e=>e.toJSON()),_waypoints:this.waypoints.map(e=>e.toJSON()),_specialEventsKeywordFilters:this.eventTypesWithKeywords.toJSON(),_customData:_t(this.customData)}}get customData(){return this.data._customData}set customData(e){this.data._customData=e}addBPMEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof De?i:De.create({...i,type:100,value:i.bpm})[0]))}addRotationEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof De?i:De.create({...i,type:typeof i.executionTime=="number"?i.executionTime===0?14:15:i._type})[0])),K.warn("This may not work correctly")}addColorNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof wi?i:wi.create(i)[0]))}addBombNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof wi?i:wi.create({...i,type:3})[0]))}addObstacles(...e){this.obstacles.push(...e.map(i=>i instanceof Cn?i:Cn.create(i)[0]))}addSliders(...e){this.sliders.push(...e.map(i=>i instanceof Ln?i:Ln.create(i)[0]))}addBurstSliders(...e){K.warn("Burst Slider does not exist in beatmap V2")}addWaypoints(...e){this.waypoints.push(...e.map(i=>i instanceof Rn?i:Rn.create(i)[0]))}addBasicEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof De?i:De.create(i)[0]))}addColorBoostEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof De?i:De.create({...i,value:i.toggle?1:i._value})[0]))}addLightColorEventBoxGroups(...e){K.warn("Light Color Event Box Group does not exist in beatmap V2")}addLightRotationEventBoxGroups(...e){K.warn("Light Rotation Event Box Group does not exist in beatmap V2")}addLightTranslationEventBoxGroups(...e){K.warn("Light Translation Event Box Group does not exist in beatmap V2")}isValid(){throw new Error("Method not implemented.")}};const le=class extends Tc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??le.default.b,et:i.type??i.et??le.default.et,i:i.value??i.i??le.default.i,f:i.floatValue??i.f??le.default.f,customData:i.customData??le.default.customData()}))),e.length?e:[new this({b:le.default.b,et:le.default.et,i:le.default.i,f:le.default.f,customData:le.default.customData()})]}toJSON(){return{b:this.time,et:this.type,i:this.value,f:this.floatValue,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get type(){return this.data.et}set type(t){this.data.et=t}get value(){return this.data.i}set value(t){this.data.i=t}get floatValue(){return this.data.f}set floatValue(t){this.data.f=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}isLightEvent(t){return super.isLightEvent(t)}isRingEvent(t){return super.isRingEvent(t)}isLaserRotationEvent(t){return super.isLaserRotationEvent(t)}isLaneRotationEvent(t){return super.isLaneRotationEvent(t)}isChroma(){const t=this;return t.isLightEvent()?Array.isArray(this.customData.color)||typeof this.customData.lightID=="number"||Array.isArray(this.customData.lightID)||typeof this.customData.easing=="string"||typeof this.customData.lerpType=="string":t.isRingEvent()?typeof this.customData.nameFilter=="string"||typeof this.customData.rotation=="number"||typeof this.customData.step=="number"||typeof this.customData.prop=="number"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":t.isLaserRotationEvent()?typeof this.customData.lockRotation=="boolean"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":!1}};let Ji=le;Ji.default={b:0,et:0,i:0,f:1,customData:()=>({})};const Yi=class extends Lc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({k:i.keyword??i.k??Yi.default.k,e:i.events??i.e??Yi.default.e()}))),e.length?e:[new this({k:Yi.default.k,e:Yi.default.e()})]}toJSON(){return{k:this.keyword,e:this.events}}get keyword(){return this.data.k}set keyword(t){this.data.k=t}get events(){return this.data.e}set events(t){this.data.e=t}};let Ac=Yi;Ac.default={k:"",e:()=>[]};const Ic=class extends Cc{constructor(t){super(t),this.d=t.d.map(e=>Ac.create({e:e.e,k:e.k})[0])}static create(t={}){var e;return new this({d:((e=t.list)==null?void 0:e.map(i=>({k:i==null?void 0:i.keyword,e:i==null?void 0:i.events})))??t.d??Ic.default.d()})}toJSON(){return{d:this.list.map(t=>t.toJSON())}}get list(){return this.d}set list(t){this.d=t}addData(t){return this.list.push(t),this}};let Sr=Ic;Sr.default={d:()=>[]};const Re=class extends Cd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??Re.default.b,x:i.posX??i.x??Re.default.x,y:i.posY??i.y??Re.default.y,customData:i.customData??Re.default.customData()}))),e.length?e:[new this({b:Re.default.b,x:Re.default.x,y:Re.default.y,customData:Re.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ge(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(t=>{t[0]=-t[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(ge(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(t=>{t[0]=-t[0]}))),super.mirror()}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"}};let Ti=Re;Ti.default={b:0,x:0,y:0,customData:()=>({})};const ui=class extends Rd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??ui.default.b,m:i.bpm??i.m??ui.default.m,customData:i.customData??ui.default.customData()}))),e.length?e:[new this({b:ui.default.b,m:ui.default.m,customData:ui.default.customData()})]}toJSON(){return{b:this.time,m:this.bpm,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get bpm(){return this.data.m}set bpm(t){this.data.m=t}setBPM(t){return this.bpm=t,this}get customData(){return this.data.customData}set customData(t){this.data.customData=t}isValid(){return this.bpm>0}};let qi=ui;qi.default={b:0,m:0,customData:()=>({})};const St=class extends kd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??i.tb??St.default.b,c:i.color??i.c??St.default.c,x:i.posX??i.x??St.default.x,y:i.posY??i.y??St.default.y,d:i.direction??i.d??St.default.d,tb:i.tailTime??i.tb??i.b??St.default.tb,tx:i.tailPosX??i.tx??St.default.tx,ty:i.tailPosY??i.ty??St.default.ty,sc:i.sliceCount??i.sc??St.default.sc,s:i.squish??i.s??St.default.s,customData:i.customData??St.default.customData()}))),e.length?e:[new this({b:St.default.b,c:St.default.c,x:St.default.x,y:St.default.y,d:St.default.d,tb:St.default.tb,tx:St.default.tx,ty:St.default.ty,sc:St.default.sc,s:St.default.s,customData:St.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,sc:this.sliceCount,s:this.squish,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get color(){return this.data.c}set color(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get tailTime(){return this.data.tb}set tailTime(t){this.data.tb=t}get tailPosX(){return this.data.tx}set tailPosX(t){this.data.tx=t}get tailPosY(){return this.data.ty}set tailPosY(t){this.data.ty=t}get sliceCount(){return this.data.sc}set sliceCount(t){this.data.sc=t}get squish(){return this.data.s}set squish(t){this.data.s=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ge(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(ge(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]}))),super.mirror(t)}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.tailCoordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"}};let kn=St;kn.default={b:0,c:0,x:0,y:0,d:0,tb:0,tx:0,ty:0,sc:1,s:1,customData:()=>({})};const hi=class extends xd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??hi.default.b,o:i.toggle??i.o??hi.default.o,customData:i.customData??hi.default.customData()}))),e.length?e:[new this({b:hi.default.b,o:hi.default.o,customData:hi.default.customData()})]}toJSON(){return{b:this.time,o:this.toggle,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get toggle(){return this.data.o}set toggle(t){this.data.o=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}isValid(){return!0}};let Zi=hi;Zi.default={b:0,o:!1,customData:()=>({})};const Qt=class extends Bd{constructor(t){super(t),this.data.f===1&&(this.p0=this.p0?this.p0:1)}static create(t={}){return new Qt({f:t.type??t.f??Qt.default.f,p:t.p0??t.p??Qt.default.p,t:t.p1??t.t??Qt.default.t,r:t.reverse??t.r??Qt.default.r,c:t.chunks??t.c??Qt.default.c,n:t.random??t.n??Qt.default.n,s:t.seed??t.s??Qt.default.s,l:t.limit??t.l??Qt.default.l,d:t.limitAffectsType??t.d??Qt.default.d,customData:t.customData??Qt.default.customData()})}toJSON(){return{f:this.type,p:this.p0,t:this.p1,r:this.reverse,c:this.chunks,n:this.random,s:this.seed,l:this.limit,d:this.limitAffectsType,customData:_t(this.customData)}}get type(){return this.data.f}set type(t){this.data.f=t}get p0(){return this.data.p}set p0(t){this.data.p=t}get p1(){return this.data.t}set p1(t){this.data.t=t}get reverse(){return this.data.r}set reverse(t){this.data.r=t}get chunks(){return this.data.c}set chunks(t){this.data.c=t}get random(){return this.data.n}set random(t){this.data.n=t}get seed(){return this.data.s}set seed(t){this.data.s=t}get limit(){return this.data.l}set limit(t){this.data.l=t}get limitAffectsType(){return this.data.d}set limitAffectsType(t){this.data.d=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let gt=Qt;gt.default={f:1,p:0,t:0,r:0,c:0,n:0,s:0,l:0,d:0,customData:()=>({})};const jt=class extends Nd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??jt.default.b,i:i.transition??i.i??jt.default.i,c:i.color??i.c??jt.default.c,s:i.brightness??i.s??jt.default.s,f:i.frequency??i.f??jt.default.f,customData:i.customData??jt.default.customData()}))),e.length?e:[new this({b:jt.default.b,i:jt.default.i,c:jt.default.c,s:jt.default.s,f:jt.default.f,customData:jt.default.customData()})]}toJSON(){return{b:this.time,i:this.transition,c:this.color,s:this.brightness,f:this.frequency,customData:_t(this.data.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get transition(){return this.data.i}set transition(t){this.data.i=t}get color(){return this.data.c}set color(t){this.data.c=t}get brightness(){return this.data.s}set brightness(t){this.data.s=t}get frequency(){return this.data.f}set frequency(t){this.data.f=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let $c=jt;$c.default={b:0,i:0,c:0,s:1,f:0,customData:()=>({})};const It=class extends Ad{constructor(t){super(t),this._f=gt.create(t.f),this._e=t.e.map(e=>$c.create(e)[0])}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({f:i.filter??i.f??It.default.f(),w:i.beatDistribution??i.w??It.default.w,d:i.beatDistributionType??i.d??It.default.d,r:i.brightnessDistribution??i.r??It.default.r,t:i.brightnessDistributionType??i.t??It.default.t,b:i.affectFirst??i.b??It.default.b,i:i.easing??i.i??It.default.i,e:i.events??i.e??It.default.e(),customData:i.customData??It.default.customData()}))),e.length?e:[new this({f:It.default.f(),w:It.default.w,d:It.default.d,r:It.default.r,t:It.default.t,b:It.default.b,i:It.default.i,e:It.default.e(),customData:It.default.customData()})]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,r:this.brightnessDistribution,t:this.brightnessDistributionType,b:this.affectFirst,i:this.easing,e:this.events.map(t=>t.toJSON()),customData:_t(this.customData)}}get filter(){return this._f}set filter(t){this._f=t}get beatDistribution(){return this.data.w}set beatDistribution(t){this.data.w=t}get beatDistributionType(){return this.data.d}set beatDistributionType(t){this.data.d=t}get brightnessDistribution(){return this.data.r}set brightnessDistribution(t){this.data.r=t}get brightnessDistributionType(){return this.data.t}set brightnessDistributionType(t){this.data.t=t}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get easing(){return this.data.i}set easing(t){this.data.i=t}get events(){return this._e}set events(t){this._e=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}setEvents(t){return this.events=t,this}};let Oc=It;Oc.default={f:()=>({f:gt.default.f,p:gt.default.p,t:gt.default.t,r:gt.default.r,c:gt.default.c,n:gt.default.n,s:gt.default.s,l:gt.default.l,d:gt.default.d}),w:0,d:1,r:0,t:1,b:0,i:0,e:()=>[],customData:()=>({})};const ke=class extends Id{constructor(t){super(t),this._e=t.e.map(e=>Oc.create(e)[0])}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??ke.default.b,g:i.id??i.g??ke.default.g,e:i.boxes??i.e??ke.default.e(),customData:i.customData??ke.default.customData()}))),e.length?e:[new this({b:ke.default.b,g:ke.default.g,e:ke.default.e(),customData:ke.default.customData()})]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get id(){return this.data.g}set id(t){this.data.g=t}get boxes(){return this._e}set boxes(t){this._e=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}isValid(){return this.id>=0}};let xn=ke;xn.default={b:0,g:0,e:()=>[],customData:()=>({})};const Xt=class extends $d{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??Xt.default.b,p:i.previous??i.p??Xt.default.p,e:i.easing??i.e??Xt.default.e,l:i.loop??i.l??Xt.default.l,r:i.rotation??i.r??Xt.default.r,o:i.direction??i.o??Xt.default.o,customData:i.customData??Xt.default.customData()}))),e.length?e:[new this({b:Xt.default.b,p:Xt.default.p,e:Xt.default.e,l:Xt.default.l,r:Xt.default.r,o:Xt.default.o,customData:Xt.default.customData()})]}toJSON(){return{b:this.time,p:this.previous,e:this.easing,l:this.loop,r:this.rotation,o:this.direction,customData:_t(this.data.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get previous(){return this.data.p}set previous(t){this.data.p=t}get easing(){return this.data.e}set easing(t){this.data.e=t}get loop(){return this.data.l}set loop(t){this.data.l=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}get direction(){return this.data.o}set direction(t){this.data.o=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let Mc=Xt;Mc.default={b:0,p:0,e:0,l:0,r:0,o:0,customData:()=>({})};const Tt=class extends Od{constructor(t){super(t),this._f=gt.create(t.f),this._l=t.l.map(e=>Mc.create(e)[0])}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({f:i.filter??i.f??Tt.default.f(),w:i.beatDistribution??i.w??Tt.default.w,d:i.beatDistributionType??i.d??Tt.default.d,s:i.rotationDistribution??i.s??Tt.default.s,t:i.rotationDistributionType??i.t??Tt.default.t,a:i.axis??i.a??Tt.default.a,r:i.flip??i.r??Tt.default.r,b:i.affectFirst??i.b??Tt.default.b,i:i.easing??i.i??Tt.default.i,l:i.events??i.l??Tt.default.l(),customData:i.customData??Tt.default.customData()}))),e.length?e:[new this({f:Tt.default.f(),w:Tt.default.w,d:Tt.default.d,s:Tt.default.s,t:Tt.default.t,a:Tt.default.a,r:Tt.default.r,b:Tt.default.b,i:Tt.default.i,l:Tt.default.l(),customData:Tt.default.customData()})]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.rotationDistribution,t:this.rotationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,i:this.easing,l:this.events.map(t=>t.toJSON()),customData:_t(this.customData)}}get filter(){return this._f}set filter(t){this._f=t}get beatDistribution(){return this.data.w}set beatDistribution(t){this.data.w=t}get beatDistributionType(){return this.data.d}set beatDistributionType(t){this.data.d=t}get rotationDistribution(){return this.data.s}set rotationDistribution(t){this.data.s=t}get rotationDistributionType(){return this.data.t}set rotationDistributionType(t){this.data.t=t}get axis(){return this.data.a}set axis(t){this.data.a=t}get flip(){return this.data.r}set flip(t){this.data.r=t?1:0}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get easing(){return this.data.i}set easing(t){this.data.i=t}get events(){return this._l}set events(t){this._l=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}setEvents(t){return this.events=t,this}};let Pc=Tt;Pc.default={f:()=>({f:gt.default.f,p:gt.default.p,t:gt.default.t,r:gt.default.r,c:gt.default.c,n:gt.default.n,s:gt.default.s,l:gt.default.l,d:gt.default.d}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,i:0,l:()=>[],customData:()=>({})};const xe=class extends Md{constructor(t){super(t),this._e=t.e.map(e=>Pc.create(e)[0])}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??xe.default.b,g:i.id??i.g??xe.default.g,e:i.boxes??i.e??xe.default.e(),customData:i.customData??xe.default.customData()}))),e.length?e:[new this({b:xe.default.b,g:xe.default.g,e:xe.default.e(),customData:xe.default.customData()})]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get id(){return this.data.g}set id(t){this.data.g=t}get boxes(){return this._e}set boxes(t){this._e=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}isValid(){return this.id>=0}};let Bn=xe;Bn.default={b:0,g:0,e:()=>[],customData:()=>({})};class Hd extends Dr{setTranslationDistribution(e){return this.translationDistribution=e,this}setTranslationDistributionType(e){return this.translationDistributionType=e,this}setAxis(e){return this.axis=e,this}setFlip(e){return this.flip=e,this}setAffectFirst(e){return this.affectFirst=e,this}isValid(){return super.isValid()&&(this.translationDistributionType===1||this.translationDistributionType===2)&&(this.axis===0||this.axis===1)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}class zd extends Me{setPrevious(e){return this.previous=e,this}setEasing(e){return this.easing=e,this}setTranslation(e){return this.translation=e,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3}}const ce=class extends zd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??ce.default.b,p:i.previous??i.p??ce.default.p,e:i.easing??i.e??ce.default.e,t:i.translation??i.t??ce.default.t,customData:i.customData??ce.default.customData()}))),e.length?e:[new this({b:ce.default.b,p:ce.default.p,e:ce.default.e,t:ce.default.t,customData:ce.default.customData()})]}toJSON(){return{b:this.time,p:this.previous,e:this.easing,t:this.translation,customData:_t(this.data.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get previous(){return this.data.p}set previous(t){this.data.p=t}get easing(){return this.data.e}set easing(t){this.data.e=t}get translation(){return this.data.t}set translation(t){this.data.t=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let Fc=ce;Fc.default={b:0,p:0,e:0,t:0,customData:()=>({})};const Lt=class extends Hd{constructor(t){super(t),this._f=gt.create(t.f),this._l=t.l.map(e=>Fc.create(e)[0])}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({f:i.filter??i.f??Lt.default.f(),w:i.beatDistribution??i.w??Lt.default.w,d:i.beatDistributionType??i.d??Lt.default.d,s:i.translationDistribution??i.s??Lt.default.s,t:i.translationDistributionType??i.t??Lt.default.t,a:i.axis??i.a??Lt.default.a,r:i.flip??i.r??Lt.default.r,b:i.affectFirst??i.b??Lt.default.b,i:i.easing??i.i??Lt.default.i,l:i.events??i.l??Lt.default.l(),customData:i.customData??Lt.default.customData()}))),e.length?e:[new this({f:Lt.default.f(),w:Lt.default.w,d:Lt.default.d,s:Lt.default.s,t:Lt.default.t,a:Lt.default.a,r:Lt.default.r,b:Lt.default.b,i:Lt.default.i,l:Lt.default.l(),customData:Lt.default.customData()})]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.translationDistribution,t:this.translationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,i:this.easing,l:this.events.map(t=>t.toJSON()),customData:_t(this.customData)}}get filter(){return this._f}set filter(t){this._f=t}get beatDistribution(){return this.data.w}set beatDistribution(t){this.data.w=t}get beatDistributionType(){return this.data.d}set beatDistributionType(t){this.data.d=t}get translationDistribution(){return this.data.s}set translationDistribution(t){this.data.s=t}get translationDistributionType(){return this.data.t}set translationDistributionType(t){this.data.t=t}get axis(){return this.data.a}set axis(t){this.data.a=t}get flip(){return this.data.r}set flip(t){this.data.r=t?1:0}get affectFirst(){return this.data.b}set affectFirst(t){this.data.b=t?1:0}get easing(){return this.data.i}set easing(t){this.data.i=t}get events(){return this._l}set events(t){this._l=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}setEvents(t){return this.events=t,this}};let Hc=Lt;Hc.default={f:()=>({f:gt.default.f,p:gt.default.p,t:gt.default.t,r:gt.default.r,c:gt.default.c,n:gt.default.n,s:gt.default.s,l:gt.default.l,d:gt.default.d}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,i:0,l:()=>[],customData:()=>({})};class Xd extends wr{}const Be=class extends Xd{constructor(t){super(t),this._e=t.e.map(e=>Hc.create(e)[0])}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??Be.default.b,g:i.id??i.g??Be.default.g,e:i.boxes??i.e??Be.default.e(),customData:i.customData??Be.default.customData()}))),e.length?e:[new this({b:Be.default.b,g:Be.default.g,e:Be.default.e(),customData:Be.default.customData()})]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get id(){return this.data.g}set id(t){this.data.g=t}get boxes(){return this._e}set boxes(t){this._e=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}setCustomData(t){return this.customData=t,this}addCustomData(t){return this.customData={...this.customData,object:t},this}isValid(){return this.id>=0}};let Nn=Be;Nn.default={b:0,g:0,e:()=>[],customData:()=>({})};const Ne=class extends Pd{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??Ne.default.b,e:i.executionTime??i.e??Ne.default.e,r:i.rotation??i.r??Ne.default.r,customData:i.customData??Ne.default.customData()}))),e.length?e:[new this({b:Ne.default.b,e:Ne.default.e,r:Ne.default.r,customData:Ne.default.customData()})]}toJSON(){return{b:this.time,e:this.executionTime,r:this.rotation,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get executionTime(){return this.data.e}set executionTime(t){this.data.e=t}get rotation(){return this.data.r}set rotation(t){this.data.r=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let Ki=Ne;Ki.default={b:0,e:0,r:0,customData:()=>({})};const Dt=class extends Rc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??Dt.default.b,c:i.color??i.c??Dt.default.c,x:i.posX??i.x??Dt.default.x,y:i.posY??i.y??Dt.default.y,d:i.direction??i.d??Dt.default.d,mu:i.lengthMultiplier??i.mu??Dt.default.mu,tb:i.tailTime??i.tb??Dt.default.tb,tx:i.tailPosX??i.tx??Dt.default.tx,ty:i.tailPosY??i.ty??Dt.default.ty,tc:i.tailDirection??i.tc??Dt.default.tc,tmu:i.tailLengthMultiplier??i.tmu??Dt.default.tmu,m:i.midAnchor??i.m??Dt.default.m,customData:i.customData??Dt.default.customData()}))),e.length?e:[new this({b:Dt.default.b,c:Dt.default.c,x:Dt.default.x,y:Dt.default.y,d:Dt.default.d,mu:Dt.default.mu,tb:Dt.default.tb,tx:Dt.default.tx,ty:Dt.default.ty,tc:Dt.default.tc,tmu:Dt.default.tmu,m:Dt.default.m,customData:Dt.default.customData()})]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,mu:this.lengthMultiplier,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,tc:this.tailDirection,tmu:this.tailLengthMultiplier,m:this.midAnchor,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get color(){return this.data.c}set color(t){this.data.c=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get lengthMultiplier(){return this.data.mu}set lengthMultiplier(t){this.data.mu=t}get tailTime(){return this.data.tb}set tailTime(t){this.data.tb=t}get tailPosX(){return this.data.tx}set tailPosX(t){this.data.tx=t}get tailPosY(){return this.data.ty}set tailPosY(t){this.data.ty=t}get tailDirection(){return this.data.tc}set tailDirection(t){this.data.tc=t}get tailLengthMultiplier(){return this.data.tmu}set tailLengthMultiplier(t){this.data.tmu=t}get midAnchor(){return this.data.m}set midAnchor(t){this.data.m=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ge(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(ge(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]}))),super.mirror(t)}getTailPosition(t){switch(t){case"ne":return this.customData.tailCoordinates?[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]]:[this.tailPosX,this.tailPosY];default:return this.customData.tailCoordinates?[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]]:super.getTailPosition(t)}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.tailCoordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"}};let Qi=Dt;Qi.default={b:0,c:0,x:0,y:0,d:0,mu:1,tb:0,tx:0,ty:0,tc:0,tmu:1,m:0,customData:()=>({})};const ue=class extends kc{constructor(t){super(t)}static create(...t){const e=[];return t==null||t.forEach(i=>e.push(new this({b:i.time??i.b??ue.default.b,x:i.posX??i.x??ue.default.x,y:i.posY??i.y??ue.default.y,d:i.direction??i.d??ue.default.d,customData:i.customData??ue.default.customData()}))),e.length?e:[new this({b:ue.default.b,x:ue.default.x,y:ue.default.y,d:ue.default.d,customData:ue.default.customData()})]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.direction,customData:_t(this.customData)}}get time(){return this.data.b}set time(t){this.data.b=t}get posX(){return this.data.x}set posX(t){this.data.x=t}get posY(){return this.data.y}set posY(t){this.data.y=t}get direction(){return this.data.d}set direction(t){this.data.d=t}get customData(){return this.data.customData}set customData(t){this.data.customData=t}};let tn=ue;tn.default={b:0,x:0,y:0,d:1,customData:()=>({})};class zc extends Sc{constructor(e){var i,n,o,r,l,a,s,c,d,u,m,h,p;super(e),this.version="3.2.0",this.bpmEvents=((i=e.bpmEvents)==null?void 0:i.map(g=>qi.create(g)[0]))??[],this.rotationEvents=((n=e.rotationEvents)==null?void 0:n.map(g=>Ki.create(g)[0]))??[],this.colorNotes=((o=e.colorNotes)==null?void 0:o.map(g=>je.create(g)[0]))??[],this.bombNotes=((r=e.bombNotes)==null?void 0:r.map(g=>Ti.create(g)[0]))??[],this.obstacles=((l=e.obstacles)==null?void 0:l.map(g=>te.create(g)[0]))??[],this.sliders=((a=e.sliders)==null?void 0:a.map(g=>Qi.create(g)[0]))??[],this.burstSliders=((s=e.burstSliders)==null?void 0:s.map(g=>kn.create(g)[0]))??[],this.waypoints=((c=e.waypoints)==null?void 0:c.map(g=>tn.create(g)[0]))??[],this.basicEvents=((d=e.basicBeatmapEvents)==null?void 0:d.map(g=>Ji.create(g)[0]))??[],this.colorBoostEvents=((u=e.colorBoostBeatmapEvents)==null?void 0:u.map(g=>Zi.create(g)[0]))??[],this.lightColorEventBoxGroups=((m=e.lightColorEventBoxGroups)==null?void 0:m.map(g=>xn.create(g)[0]))??[],this.lightRotationEventBoxGroups=((h=e.lightRotationEventBoxGroups)==null?void 0:h.map(g=>Bn.create(g)[0]))??[],this.lightTranslationEventBoxGroups=((p=e.lightTranslationEventBoxGroups)==null?void 0:p.map(g=>Nn.create(g)[0]))??[],this.eventTypesWithKeywords=Sr.create(e.basicEventTypesWithKeywords)??{d:[]},this.useNormalEventsAsCompatibleEvents=e.useNormalEventsAsCompatibleEvents??!1,this.customData=e.customData??{}}static create(e={}){return new this({version:"3.2.0",bpmEvents:e.bpmEvents??[],rotationEvents:e.rotationEvents??[],colorNotes:e.colorNotes??[],bombNotes:e.bombNotes??[],obstacles:e.obstacles??[],sliders:e.sliders??[],burstSliders:e.burstSliders??[],waypoints:e.waypoints??[],basicBeatmapEvents:e.basicBeatmapEvents??[],colorBoostBeatmapEvents:e.colorBoostBeatmapEvents??[],lightColorEventBoxGroups:e.lightColorEventBoxGroups??[],lightRotationEventBoxGroups:e.lightRotationEventBoxGroups??[],lightTranslationEventBoxGroups:e.lightTranslationEventBoxGroups??[],basicEventTypesWithKeywords:e.basicEventTypesWithKeywords??{d:[]},useNormalEventsAsCompatibleEvents:e.useNormalEventsAsCompatibleEvents??!1,customData:e.customData??{}})}toJSON(){return{version:"3.2.0",bpmEvents:this.bpmEvents.map(e=>e.toJSON()),rotationEvents:this.rotationEvents.map(e=>e.toJSON()),colorNotes:this.colorNotes.map(e=>e.toJSON()),bombNotes:this.bombNotes.map(e=>e.toJSON()),obstacles:this.obstacles.map(e=>e.toJSON()),sliders:this.sliders.map(e=>e.toJSON()),burstSliders:this.burstSliders.map(e=>e.toJSON()),waypoints:this.waypoints.map(e=>e.toJSON()),basicBeatmapEvents:this.basicEvents.map(e=>e.toJSON()),colorBoostBeatmapEvents:this.colorBoostEvents.map(e=>e.toJSON()),lightColorEventBoxGroups:this.lightColorEventBoxGroups.map(e=>e.toJSON()),lightRotationEventBoxGroups:this.lightRotationEventBoxGroups.map(e=>e.toJSON()),lightTranslationEventBoxGroups:this.lightTranslationEventBoxGroups.map(e=>e.toJSON()),basicEventTypesWithKeywords:this.eventTypesWithKeywords.toJSON(),useNormalEventsAsCompatibleEvents:this.useNormalEventsAsCompatibleEvents,customData:_t(this.customData)}}get customData(){return this.data.customData}set customData(e){this.data.customData=e}addBPMEvents(...e){this.bpmEvents.push(...e.map(i=>i instanceof qi?i:qi.create(i)[0]))}addRotationEvents(...e){this.rotationEvents.push(...e.map(i=>i instanceof Ki?i:Ki.create(i)[0]))}addColorNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof je?i:je.create(i)[0]))}addBombNotes(...e){this.bombNotes.push(...e.map(i=>i instanceof Ti?i:Ti.create(i)[0]))}addObstacles(...e){this.obstacles.push(...e.map(i=>i instanceof te?i:te.create(i)[0]))}addSliders(...e){this.sliders.push(...e.map(i=>i instanceof Qi?i:Qi.create(i)[0]))}addBurstSliders(...e){this.burstSliders.push(...e.map(i=>i instanceof kn?i:kn.create(i)[0]))}addWaypoints(...e){this.waypoints.push(...e.map(i=>i instanceof tn?i:tn.create(i)[0]))}addBasicEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof Ji?i:Ji.create(i)[0]))}addColorBoostEvents(...e){this.colorBoostEvents.push(...e.map(i=>i instanceof Zi?i:Zi.create(i)[0]))}addLightColorEventBoxGroups(...e){this.lightColorEventBoxGroups.push(...e.map(i=>i instanceof xn?i:xn.create(i)[0]))}addLightRotationEventBoxGroups(...e){this.lightRotationEventBoxGroups.push(...e.map(i=>i instanceof Bn?i:Bn.create(i)[0]))}addLightTranslationEventBoxGroups(...e){this.lightTranslationEventBoxGroups.push(...e.map(i=>i instanceof Nn?i:Nn.create(i)[0]))}isValid(){throw new Error("Method not implemented.")}}const ma=t=>`[shared::parse::${t}]`;function Ud(t){return K.info(ma("info"),"Parsing beatmap info v2.x.x"),t._difficultyBeatmapSets.sort((e,i)=>Xa[e._beatmapCharacteristicName]-Xa[i._beatmapCharacteristicName]),t._difficultyBeatmapSets.forEach(e=>{let i=0;e._difficultyBeatmaps.forEach(n=>{var o,r;n._difficultyRank-i<=0&&K.warn(ma("info"),n._difficulty+" is unordered"),Bl[n._difficulty]!==n._difficultyRank&&K.error(ma("info"),n._difficulty+" has invalid rank"),i=n._difficultyRank,typeof((o=n._customData)==null?void 0:o._editorOffset)=="number"&&n._customData._editorOffset===0&&delete n._customData._editorOffset,typeof((r=n._customData)==null?void 0:r._editorOldOffset)=="number"&&n._customData._editorOldOffset===0&&delete n._customData._editorOldOffset}),e._difficultyBeatmaps.sort((n,o)=>n._difficultyRank-o._difficultyRank)}),t}const Xc=t=>`[shared::dataCheck::${t}]`;function Ce(t,e,i){if(e)throw Error(t);K.warn(Xc("deepCheck"),t),i.push(t)}function en(t,e,i,n,o=!0,r=[]){if(K.verbose(Xc("deepCheck"),`Looking up ${i}`),Array.isArray(t)){t.forEach((a,s)=>en(a,e,`${i}[${s}]`,n));return}const l=Object.keys(e);for(const a in t){if(!l.length)break;l.includes(a)||Ce(`Unused key ${a} found in ${i}`,!1,r)}for(const a in e){if(typeof t[a]>"u"){if(e[a].optional||Ld(n,e[a].version)==="old")continue;Ce(`Missing ${a} in object ${i}!`,o,r)}t[a]==null&&Ce(`${a} contain null value in object ${i}!`,o,r),e[a].type==="array"&&(Array.isArray(t[a])||Ce(`${a} is not an array in object ${i}!`,o,r),en(t[a],e[a].check,`${i} ${a}`,n)),e[a].type==="object"&&(!Array.isArray(t[a])&&typeof t[a]!="object"?Ce(`${a} is not an object in object ${i}!`,o,r):en(t[a],e[a].check,`${i} ${a}`,n)),e[a].array&&Array.isArray(t[a])&&!t[a].every(s=>typeof s===e[a].type||e[a].type==="number"&&typeof s=="number"&&(e[a].int?s%1!==0:!0)&&(e[a].unsigned?t[a]<0:!0))&&(console.log(1,e[a]),Ce(`${a} is not ${e[a].type} in object ${i}!`,o,r)),!e[a].array&&e[a].type!=="array"&&typeof t[a]!==e[a].type&&Ce(`${a} is not ${e[a].type} in object ${i}!`,o,r),e[a].type==="number"&&typeof t[a]=="number"&&(e[a].int&&t[a]%1!==0&&Ce(`${i} ${a} cannot be float!`,!1,r),e[a].unsigned&&t[a]<0&&Ce(`${i} ${a} cannot be negative!`,!1,r))}}const Gd={_time:{type:"number",version:"2.0.0"},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_lineIndex:{type:"number",int:!0,version:"2.0.0"},_lineLayer:{type:"number",int:!0,version:"2.0.0"},_cutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Yd={_colorType:{type:"number",version:"2.0.0"},_headTime:{type:"number",version:"2.0.0"},_headLineIndex:{type:"number",int:!0,version:"2.0.0"},_headLineLayer:{type:"number",int:!0,version:"2.0.0"},_headCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_headControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_tailTime:{type:"number",version:"2.0.0"},_tailLineIndex:{type:"number",int:!0,version:"2.0.0"},_tailLineLayer:{type:"number",int:!0,version:"2.0.0"},_tailCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_tailControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_sliderMidAnchorMode:{type:"number",version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},jd={_time:{type:"number",version:"2.0.0"},_lineIndex:{type:"number",int:!0,version:"2.0.0"},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_duration:{type:"number",version:"2.0.0"},_width:{type:"number",int:!0,version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Wd={_time:{type:"number",version:"2.0.0"},_type:{type:"number",int:!0,version:"2.0.0"},_value:{type:"number",int:!0,version:"2.0.0"},_floatValue:{type:"number",version:"2.5.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Vd={_time:{type:"number",version:"2.2.0"},_lineIndex:{type:"number",int:!0,version:"2.2.0"},_lineLayer:{type:"number",int:!0,version:"2.2.0"},_offsetDirection:{type:"number",int:!0,version:"2.2.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Jd={_keyword:{type:"string",version:"2.4.0"},_specialEvents:{type:"number",int:!0,array:!0,version:"2.4.0"}},qd={_keywords:{type:"array",version:"2.4.0",check:Jd}},Zd={_version:{type:"string",version:"2.0.0"},_notes:{type:"array",version:"2.0.0",check:Gd},_sliders:{type:"array",version:"2.6.0",check:Yd},_obstacles:{type:"array",version:"2.0.0",check:jd},_events:{type:"array",version:"2.0.0",check:Wd},_waypoints:{type:"array",version:"2.2.0",check:Vd,optional:!0},_specialEventsKeywordFilters:{type:"object",version:"2.4.0",check:qd,optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},es=t=>`[v2::parse::${t}]`,yn=(t,e)=>t._time-e._time;function Kd(t,e={enable:!0,throwError:!0}){var i;return K.info(es("difficulty"),"Parsing beatmap difficulty v2.x.x"),(i=t._version)!=null&&i.startsWith("2")||(K.warn(es("difficulty"),"Unidentified beatmap version"),t._version="2.0.0"),e.enable&&en(t,Zd,"difficulty",t._version,e.throwError),t._notes=t._notes??[],t._sliders=t._sliders??[],t._obstacles=t._obstacles??[],t._events=t._events??[],t._waypoints=t._waypoints??[],t._notes.sort(yn),t._sliders.sort((n,o)=>n._headTime-o._headTime),t._obstacles.sort(yn),t._events.sort(yn),t._waypoints.sort(yn),Fd.create(t)}const Qd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},a:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},tf={b:{type:"number",version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ef={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},mu:{type:"number",version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",int:!0,version:"3.0.0"},ty:{type:"number",int:!0,version:"3.0.0"},tc:{type:"number",int:!0,version:"3.0.0"},tmu:{type:"number",version:"3.0.0"},m:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},nf={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",int:!0,version:"3.0.0"},ty:{type:"number",int:!0,version:"3.0.0"},sc:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},af={b:{type:"number",version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",version:"3.0.0"},w:{type:"number",int:!0,version:"3.0.0"},h:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},rf={b:{type:"number",version:"3.0.0"},et:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},of={b:{type:"number",version:"3.0.0"},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},sf={b:{type:"number",version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"},r:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},lf={b:{type:"number",version:"3.0.0"},o:{type:"boolean",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Tr={f:{type:"number",int:!0,version:"3.0.0"},p:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},r:{type:"number",int:!0,version:"3.0.0"},c:{type:"number",int:!0,version:"3.1.0"},l:{type:"number",version:"3.1.0"},d:{type:"number",int:!0,version:"3.1.0"},n:{type:"number",int:!0,version:"3.1.0"},s:{type:"number",int:!0,version:"3.1.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},cf={b:{type:"number",version:"3.0.0"},i:{type:"number",int:!0,version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},uf={f:{type:"object",version:"3.0.0",check:Tr},w:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},r:{type:"number",version:"3.0.0"},t:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:cf},b:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},hf={b:{type:"number",version:"3.0.0"},g:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:uf},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},df={b:{type:"number",version:"3.0.0"},p:{type:"number",int:!0,version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"},l:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},o:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ff={f:{type:"object",version:"3.0.0",check:Tr},w:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},t:{type:"number",int:!0,version:"3.0.0"},a:{type:"number",int:!0,version:"3.0.0"},l:{type:"array",version:"3.0.0",check:df},r:{type:"number",int:!0,version:"3.0.0"},b:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},mf={b:{type:"number",version:"3.0.0"},g:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:ff},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},pf={b:{type:"number",version:"3.2.0"},p:{type:"number",int:!0,version:"3.2.0"},e:{type:"number",int:!0,version:"3.2.0"},t:{type:"number",version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},gf={f:{type:"object",version:"3.2.0",check:Tr},w:{type:"number",version:"3.2.0"},d:{type:"number",int:!0,version:"3.2.0"},s:{type:"number",version:"3.2.0"},t:{type:"number",int:!0,version:"3.2.0"},a:{type:"number",int:!0,version:"3.2.0"},l:{type:"array",version:"3.2.0",check:pf},r:{type:"number",int:!0,version:"3.2.0"},b:{type:"number",int:!0,version:"3.2.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},_f={b:{type:"number",version:"3.2.0"},g:{type:"number",int:!0,version:"3.2.0"},e:{type:"array",version:"3.2.0",check:gf},customData:{type:"object",version:"3.2.0",check:{},optional:!0}},bf={k:{type:"string",version:"3.0.0"},e:{type:"number",int:!0,array:!0,version:"3.0.0"}},yf={d:{type:"array",version:"3.0.0",check:bf,optional:!0}},vf={b:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ef={version:{type:"string",version:"3.0.0"},bpmEvents:{type:"array",version:"3.0.0",check:of,optional:!0},rotationEvents:{type:"array",version:"3.0.0",check:sf,optional:!0},colorNotes:{type:"array",version:"3.0.0",check:Qd,optional:!0},bombNotes:{type:"array",version:"3.0.0",check:tf,optional:!0},obstacles:{type:"array",version:"3.0.0",check:af,optional:!0},sliders:{type:"array",version:"3.0.0",check:ef,optional:!0},burstSliders:{type:"array",version:"3.0.0",check:nf,optional:!0},waypoints:{type:"array",version:"3.0.0",check:vf,optional:!0},basicBeatmapEvents:{type:"array",version:"3.0.0",check:rf,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:lf,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:hf,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:mf,optional:!0},lightTranslationEventBoxGroups:{type:"array",version:"3.2.0",check:_f,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"3.0.0",check:yf},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},is=t=>`[v3::parse::${t}]`,Kt=(t,e)=>t.b-e.b;function Df(t){t.basicBeatmapEvents&&(t.basicBeatmapEvents=t.basicBeatmapEvents.map(e=>{if("_time"in e){const i=e;return{b:i._time,et:i._type,i:i._value,f:i._floatValue??1,customData:i._customData}}return e}))}function wf(t,e={enable:!0,throwError:!0}){return K.info(is("difficulty"),"Parsing beatmap difficulty v3.x.x"),t.version==="3.0.0"||t.version==="3.1.0"||t.version==="3.2.0"||(K.warn(is("difficulty"),"Unidentified beatmap version"),t.version="3.0.0"),Df(t),e.enable&&en(t,Ef,"difficulty",t.version,e.throwError),t.bpmEvents=t.bpmEvents??[],t.rotationEvents=t.rotationEvents??[],t.colorNotes=t.colorNotes??[],t.bombNotes=t.bombNotes??[],t.obstacles=t.obstacles??[],t.sliders=t.sliders??[],t.burstSliders=t.burstSliders??[],t.waypoints=t.waypoints??[],t.basicBeatmapEvents=t.basicBeatmapEvents??[],t.colorBoostBeatmapEvents=t.colorBoostBeatmapEvents??[],t.lightColorEventBoxGroups=t.lightColorEventBoxGroups??[],t.lightRotationEventBoxGroups=t.lightRotationEventBoxGroups??[],t.lightTranslationEventBoxGroups=t.lightTranslationEventBoxGroups??[],t.bpmEvents.sort(Kt),t.rotationEvents.sort(Kt),t.colorNotes.sort(Kt),t.bombNotes.sort(Kt),t.obstacles.sort(Kt),t.sliders.sort(Kt),t.burstSliders.sort(Kt),t.waypoints.sort(Kt),t.basicBeatmapEvents.sort(Kt),t.colorBoostBeatmapEvents.sort(Kt),t.lightColorEventBoxGroups.sort(Kt),t.lightRotationEventBoxGroups.sort(Kt),zc.create(t)}const ns="Invalid Event Box",as="Check for valid event box group usage.",rs=!0,Qn={name:ns,description:as,type:"event",order:{input:ht.EVENTS_INVALID_EVENT_BOX,output:dt.EVENTS_INVALID_EVENT_BOX},input:{enabled:rs,params:{},html:ct.create(ns,as,rs,function(){Qn.input.enabled=this.checked})},output:{html:null},run:Tf},os={EDMEnvironment:{0:24,1:24,2:24,3:24,4:24,5:24,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:1,15:1,16:1,17:1},LizzoEnvironment:{0:40,1:16,2:16,3:16,4:16,5:16,6:1,7:1,8:12,9:12,10:12,11:6,12:6,13:14,14:14,15:4,16:4,17:3,18:3,19:14},PyroEnvironment:{0:3,1:3,2:5,3:5,4:3,5:12,6:48,7:48,8:4,9:4,10:3,11:3,12:10,13:10},TheSecondEnvironment:{0:15,1:24,2:12,3:12,4:12,5:12,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4},TheWeekndEnvironment:{0:4,1:4,2:4,3:4,4:8,5:4,6:4,7:12,8:1,9:6,10:25,11:25,12:25,13:25,14:25,15:25,16:25,17:25,18:25,19:25,20:3,21:3,22:8,23:8,29:3,30:3,31:3,32:3,33:3,34:3,35:3,36:3,37:6,38:6,40:2},RockMixtapeEnvironment:{0:5,1:5,2:10,3:10,4:10,5:10,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:3,15:10,16:5,17:5,18:24,19:24,20:12,21:12,22:8,23:8,24:36,25:3,26:36,27:3,28:5,29:2,30:16,31:4,32:4,33:4,34:4,35:2,36:2,37:2},WeaveEnvironment:{0:8,1:8,2:8,3:8,4:8,5:8,6:8,7:8,8:8,9:8,10:8,11:8,12:12,13:12,14:8,15:8},Dragons2Environment:{0:24,1:96,2:35,3:15,4:8,5:12,6:12,7:5,8:5,9:5,10:5,11:5,12:5},Panic2Environment:{0:7,1:7,2:7,3:7,4:8,5:8,6:24,7:24,8:24,9:6,10:6,11:6,12:6,13:14,14:14,15:2,16:28,17:28,18:1,19:1,20:12,21:1,22:12,23:1}};function Sf(t,e){const i=[],n=[];if(!os[e])return{defectID:[],defectFilter:[]};const o=e,r=pi[o][1],l=[...t.lightColorEventBoxGroups,...t.lightRotationEventBoxGroups,...t.lightTranslationEventBoxGroups];for(const a of l){r.includes(a.id)||i.push(a);for(const s of a.boxes){const c=s.filter;c.type===Ll.STEP_AND_OFFSET&&c.p0>os[o][a.id]&&n.push(a)}}return{defectID:i.map(a=>a.time).filter(function(a,s,c){return!s||a!==c[s-1]}),defectFilter:n.map(a=>a.time).filter(function(a,s,c){return!s||a!==c[s-1]})}}function Tf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Sf(t.difficulty.data,t.difficulty.characteristic==="360Degree"||t.difficulty.characteristic==="90Degree"?t.info._allDirectionsEnvironmentName:t.info._environmentName),i=[];if(e.defectID.length&&i.push(ut("Invalid event box group ID",e.defectID,t.settings.bpm,"error")),e.defectFilter.length&&i.push(ut("Invalid event box filter",e.defectFilter,t.settings.bpm,"error")),i.length){const n=document.createElement("div");i.forEach(o=>n.append(o)),Qn.output.html=n}else Qn.output.html=null}const ss="Unlit Bomb",ls="Check for lighting around bomb.",cs=!0,ta={name:ss,description:ls,type:"event",order:{input:ht.EVENTS_UNLIT_BOMB,output:dt.EVENTS_UNLIT_BOMB},input:{enabled:cs,params:{},html:ct.create(ss,ls,cs,function(){ta.input.enabled=this.checked})},output:{html:null},run:Cf},Lf=(t,e,i,n)=>{var u;if(!e.length)return[];const o=[],r=((u=pi[n])==null?void 0:u[0])??pi.DefaultEnvironment[0],l=e.filter(m=>m.isLightEvent(n)&&r.includes(m.type)).sort((m,h)=>m.type-h.type),a={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},s={};r.forEach(m=>s[m]=[[0,!1]]);const c=i.toBeatTime(1),d=i.toBeatTime(.25);for(let m=0,h=l.length;m<h;m++){const p=l[m];if((p.isOn()||p.isFlash())&&a[p.type].state!=="on"){a[p.type]={state:"on",time:p.time,fadeTime:0};const g=s[p.type].find(y=>y[0]>=p.time);g?(g[0]=p.time,g[1]=!0):s[p.type].push([p.time,!0])}if(p.isFade()){a[p.type]={state:"off",time:p.time,fadeTime:c};const g=s[p.type].find(y=>y[0]>=p.time);g?(g[0]=p.time,g[1]=!0):s[p.type].push([p.time,!0]),s[p.type].push([p.time+c,!1])}(((p==null?void 0:p.floatValue)??1)<.25||p.isOff()||p.customData._color&&(typeof p.customData._color[3]=="number"&&p.customData._color[3]<.25||Math.max(p.customData._color[0],p.customData._color[1],p.customData._color[2])<.25))&&a[p.type].state!=="off"&&(a[p.type]={state:"off",time:p.time,fadeTime:a[p.type].state==="on"?d:Math.min(d,a[p.type].fadeTime)},s[p.type].push([p.time+(a[p.type].state==="on"?d:Math.min(d,a[p.type].fadeTime)),!1]))}for(const m in s)s[m].reverse();for(let m=0,h=t.length,p=!1;m<h;m++){const g=t[m];p=!1;for(const y in s){const b=s[y].find(E=>E[0]<=g.time);b&&(p=p||b[1])}p||o.push(g)}return o.map(m=>m.time).filter(function(m,h,p){return!h||m!==p[h-1]})};function Cf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Lf(t.difficulty.data.bombNotes,t.difficulty.data.basicEvents,t.settings.bpm,t.info._environmentName);e.length?ta.output.html=ut("Unlit bomb",e,t.settings.bpm,"warning"):ta.output.html=null}const us=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:Kn,invalidEventBox:Qn,unlitBomb:ta},Symbol.toStringTag,{value:"Module"})),Uc="Hot Start",Gc="Check for first interactive object starting from start time.",Yc=!0,jc=1.5,oi=document.createElement("input");oi.id="input__tools-hot-start";oi.className="input-toggle input--small";oi.type="number";oi.min="0";oi.step="0.1";oi.value=jc.toString();oi.addEventListener("change",Rf);const Wc=ct.create(Uc+" (s): ",Gc,Yc,function(){fi.input.enabled=this.checked});Wc.appendChild(oi);const fi={name:Uc,description:Gc,type:"other",order:{input:ht.OTHERS_HOT_START,output:dt.OTHERS_HOT_START},input:{enabled:Yc,params:{time:jc},html:Wc},output:{html:null},run:kf};function Rf(){fi.input.params.time=I(Math.abs(parseFloat(this.value)),3),this.value=fi.input.params.time.toString()}function kf(t){if(!t.difficulty){console.error("Something went wrong!");return}const{time:e}=fi.input.params,i=t.settings.bpm.toRealTime(t.difficulty.data.getFirstInteractiveTime());i<e?fi.output.html=pt("Hot start",`${I(i,2)}s`,"warning"):fi.output.html=null}const hs="Difficulty Label Check",ds="For ranking purpose, check difficulty label to fit rankability criteria.",fs=!0,ea={name:hs,description:ds,type:"other",order:{input:ht.OTHERS_DIFFICULTY_LABEL,output:dt.OTHERS_DIFFICULTY_LABEL},input:{enabled:fs,params:{},html:ct.create(hs,ds,fs,function(){ea.input.enabled=this.checked})},output:{html:null},run:xf};function xf(t){var i;if(!t.difficulty){console.error("Something went wrong!");return}const e=(i=t.difficulty.info._customData)==null?void 0:i._difficultyLabel;e&&e.length>30?ea.output.html=pt(`Difficulty label is too long (${e.length} characters)`,"exceeded 30 max characters by ranking criteria","rank"):ea.output.html=null}const ms="NJS Check",ps="Check note jump speed for suitable value.",gs=!0,ia={name:ms,description:ps,type:"other",order:{input:ht.OTHERS_NJS,output:dt.OTHERS_NJS},input:{enabled:gs,params:{},html:ct.create(ms,ps,gs,function(){ia.input.enabled=this.checked})},output:{html:null},run:Bf};function Bf(t){if(!t.difficulty){console.error("Something went wrong!");return}const{njs:e,bpm:i}=t.settings,n=[];if(t.difficulty.info._noteJumpMovementSpeed===0&&n.push(pt("Unset NJS","fallback NJS is used","error")),e.value>23&&n.push(pt(`NJS is too high (${I(e.value,2)})`,"use lower whenever necessary","warning")),e.value<3&&n.push(pt(`NJS is too low (${I(e.value,2)})`,"timing is less significant below this","warning")),e.jd>36&&n.push(pt("Very high jump distance",`${I(e.jd,2)}`,"warning")),e.jd<18&&n.push(pt("Very low jump distance",`${I(e.jd,2)}`,"warning")),e.jd>e.calcJDOptimalHigh()&&n.push(pt(`High jump distance warning (>${I(e.calcJDOptimalHigh(),2)})`,"NJS & offset may be uncomfortable to play","warning")),i.toRealTime(e.hjd)<.42&&n.push(pt(`Very quick reaction time (${I(i.toRealTime(e.hjd)*1e3)}ms)`,"may lead to suboptimal gameplay","warning")),e.calcHJDRaw()+e.offset<Se.HJD_MIN&&n.push(pt("Unnecessary negative offset",`will not drop below ${Se.HJD_MIN}`,"warning")),n.length){const o=document.createElement("div");n.forEach(r=>o.append(r)),ia.output.html=o}else ia.output.html=null}const _s="Outside Playable Object",bs="Look for any object starting before and after song timer.",ys=!0,na={name:_s,description:bs,type:"other",order:{input:ht.OTHERS_OUTSIDE_PLAYABLE,output:dt.OTHERS_OUTSIDE_PLAYABLE},input:{enabled:ys,params:{},html:ct.create(_s,bs,ys,function(){na.input.enabled=this.checked})},output:{html:null},run:Nf};function Nf(t){if(!t.difficulty){console.error("Something went wrong!");return}const{bpm:e,audioDuration:i}=t.settings,{colorNotes:n,bombNotes:o,obstacles:r,basicEvents:l,sliders:a,burstSliders:s}=t.difficulty.data,c=[];if(i){let d=e.toBeatTime(i,!0);n.length&&n[0].time<0&&c.push(pt("Note(s) before start time",`${I(n[0].time,3)} (${Ct(e.toRealTime(n[0].time))}`,"error")),o.length&&o[0].time<0&&c.push(pt("Bomb(s) before start time",`${I(o[0].time,3)} (${Ct(e.toRealTime(o[0].time))}`,"error")),a.length&&a[0].time<0&&c.push(pt("Arc(s) before start time",`${I(a[0].time,3)} (${Ct(e.toRealTime(a[0].time))}`,"error")),s.length&&s[0].time<0&&c.push(pt("Chain(s) before start time",`${I(s[0].time,3)} (${Ct(e.toRealTime(s[0].time))}`,"error")),r.length&&r[0].time<0&&c.push(pt("Obstacle(s) before start time",`${I(r[0].time,3)} (${Ct(e.toRealTime(r[0].time))}`,"error")),l.length&&l[0].time<0&&c.push(pt("Event(s) before start time",`${I(l[0].time,3)} (${Ct(e.toRealTime(l[0].time))}`,"error")),n.length&&n[n.length-1].time>d&&c.push(pt("Note(s) after end time",`${I(n[n.length-1].time,3)} (${Ct(e.toRealTime(n[n.length-1].time))})`,"error")),o.length&&o[o.length-1].time>d&&c.push(pt("Bomb(s) after end time",`${I(o[o.length-1].time,3)} (${Ct(e.toRealTime(o[o.length-1].time))})`,"error")),a.length&&a[a.length-1].time>d&&c.push(pt("Arc(s) after end time",`${I(a[a.length-1].time,3)} (${Ct(e.toRealTime(a[a.length-1].time))})`,"error")),s.length&&s[s.length-1].time>d&&c.push(pt("Chain(s) after end time",`${I(s[s.length-1].time,3)} (${Ct(e.toRealTime(s[s.length-1].time))})`,"error")),r.length&&r[r.length-1].time>d&&c.push(pt("Obstacle(s) after end time",`${I(r[r.length-1].time,3)} (${Ct(e.toRealTime(r[r.length-1].time))})`,"error")),l.length&&l[l.length-1].time>d&&c.push(pt("Event(s) after end time",`${I(l[l.length-1].time,3)} (${Ct(e.toRealTime(l[l.length-1].time))})`,"error"))}if(c.length){const d=document.createElement("div");c.forEach(u=>d.append(u)),na.output.html=d}else na.output.html=null}const vs="Invalid Object",Es="Validate beatmap object to be compatible with vanilla (ignores for modded).",Ds=!0,aa={name:vs,description:Es,type:"other",order:{input:ht.OTHERS_INVALID_OBJECT,output:dt.OTHERS_INVALID_OBJECT},input:{enabled:Ds,params:{},html:ct.create(vs,Es,Ds,function(){aa.input.enabled=this.checked})},output:{html:null},run:Af};function Af(t){var L,R,F,M;if(!t.difficulty){console.error("Something went wrong!");return}const{colorNotes:e,bombNotes:i,obstacles:n,basicEvents:o,sliders:r,burstSliders:l,lightColorEventBoxGroups:a,lightRotationEventBoxGroups:s,lightTranslationEventBoxGroups:c}=t.difficulty.data;let d=[],u=[],m=[],h=[],p=[];(R=(L=t.difficulty.info._customData)==null?void 0:L._requirements)!=null&&R.includes("Mapping Extensions")||((M=(F=t.difficulty.info._customData)==null?void 0:F._requirements)!=null&&M.includes("Noodle Extensions")?(d=e.filter(k=>k.isMappingExtensions()).map(k=>k.time),u=n.filter(k=>k.isMappingExtensions()).map(k=>k.time),m=i.filter(k=>k.isMappingExtensions()).map(k=>k.time),h=r.filter(k=>k.isMappingExtensions()).map(k=>k.time),p=l.filter(k=>k.isMappingExtensions()).map(k=>k.time)):(d=e.filter(k=>!k.isValid()).map(k=>k.time),u=n.filter(k=>!k.isValid()).map(k=>k.time),m=i.filter(k=>!k.isValid()).map(k=>k.time),h=r.filter(k=>!k.isValid()).map(k=>k.time),p=l.filter(k=>!k.isValid()).map(k=>k.time)));const g=o.filter(k=>!k.isValid()).map(k=>k.time),y=a.filter(k=>!k.isValid()).map(k=>k.time),b=s.filter(k=>!k.isValid()).map(k=>k.time),E=c.filter(k=>!k.isValid()).map(k=>k.time),w=[];if(d.length&&w.push(ut("Invalid note",d,t.settings.bpm,"error")),m.length&&w.push(ut("Invalid bomb",m,t.settings.bpm,"error")),h.length&&w.push(ut("Invalid arc",h,t.settings.bpm,"error")),p.length&&w.push(ut("Invalid chain",p,t.settings.bpm,"error")),u.length&&w.push(ut("Invalid obstacle",u,t.settings.bpm,"error")),g.length&&w.push(ut("Invalid event",g,t.settings.bpm,"error")),y.length&&w.push(ut("Invalid light color event",y,t.settings.bpm,"error")),b.length&&w.push(ut("Invalid light rotation event",b,t.settings.bpm,"error")),E.length&&w.push(ut("Invalid light translation event",E,t.settings.bpm,"error")),w.length){const k=document.createElement("div");w.forEach($=>k.append($)),aa.output.html=k}else aa.output.html=null}const ws=Object.freeze(Object.defineProperty({__proto__:null,difficultyLabel:ea,hotStart:fi,invalidObject:aa,njs:ia,outsidePlayable:na},Symbol.toStringTag,{value:"Module"})),we=class{constructor(){}};let Ue=we;Ue.getNote=()=>Object.keys(Uo).map(t=>Uo[t]);Ue.getObstacle=()=>Object.keys(qo).map(t=>qo[t]);Ue.getEvent=()=>Object.keys(us).map(t=>us[t]);Ue.getOther=()=>Object.keys(ws).map(t=>ws[t]);Ue.getGeneral=()=>Object.keys(eo).map(t=>eo[t]);Ue.getDifficulty=()=>[...we.getNote(),...we.getObstacle(),...we.getEvent(),...we.getOther()];Ue.getAll=()=>[...we.getNote(),...we.getObstacle(),...we.getEvent(),...we.getOther(),...we.getGeneral()];const di=t=>`[analyzer::${t}]`,Vc=Ue.getAll().sort((t,e)=>t.order.input-e.order.input),Jc=[...Vc].sort((t,e)=>t.order.output-e.order.output);function qc(){st.analysis={general:{html:null},map:[]}}function If(){var l;const t=st.beatmapInfo;if(!t){K.error(di("runGeneral"),"Could not analyse, missing map info");return}st.analysis||qc();const e=(l=st.analysis)==null?void 0:l.general,i=Oe.create(t._beatsPerMinute),n=Se.create(i),o={bpm:i,njs:n,audioDuration:st.duration??null,mapDuration:0};K.info(di("runGeneral"),"Analysing general");const r=[];Jc.filter(a=>a.type==="general").forEach(a=>{if(a.input.enabled)try{a.run({settings:o,info:t}),a.output.html&&r.push(a.output.html)}catch(s){K.error(di("runGeneral"),s)}}),e&&(e.html=r)}function Zc(t,e){var s,c,d;const i=st.beatmapInfo;if(!i){K.error(di("runDifficulty"),"Could not analyse, missing map info");return}st.analysis||qc();const n=(s=st.beatmapDifficulty)==null?void 0:s.find(u=>u.characteristic===t&&u.difficulty===e);if(!n){K.error(di("runDifficulty"),"Could not analyse, missing map data");return}const o=(c=st.analysis)==null?void 0:c.map.find(u=>u.difficulty===e&&u.mode===t),r=Se.create(n.bpm,n.info._noteJumpMovementSpeed||Se.FallbackNJS[n.difficulty],n.info._noteJumpStartBeatOffset),l={bpm:n.bpm,njs:r,audioDuration:st.duration??null,mapDuration:n.bpm.toRealTime(n.data.getLastInteractiveTime())};K.info(di("runDifficulty"),`Analysing ${t} ${e}`);const a=[];Jc.filter(u=>u.type!=="general").forEach(u=>{if(u.input.enabled)try{u.run({settings:l,difficulty:n,info:i}),u.output.html&&a.push(u.output.html)}catch(m){K.error(di("runDifficulty"),m)}}),o?o.html=a:(d=st.analysis)==null||d.map.push({mode:t,difficulty:e,html:a})}function $f(t){Ue.getDifficulty().sort((i,n)=>i.order.output-n.order.output).forEach(i=>{i.input.adjustTime&&i.input.adjustTime(t)})}function Of(){var t;(t=st.beatmapDifficulty)==null||t.forEach(e=>Zc(e.characteristic,e.difficulty))}const _i={toolListInput:Vc,runGeneral:If,runDifficulty:Zc,adjustTime:$f,applyAll:Of},si="UI Tools: ",We=document.querySelectorAll(".tools__select-mode"),Ve=document.querySelectorAll(".tools__select-difficulty"),Mf=document.querySelectorAll(".difficulty__label"),Kc=document.querySelector(".tools__note-content"),Qc=document.querySelector(".tools__obstacle-content"),tu=document.querySelector(".tools__event-content"),eu=document.querySelector(".tools__other-content"),iu=document.querySelector(".tools__general-content"),Ae=document.querySelector(".tools__output-diff"),Ie=document.querySelector(".tools__output-general"),Ss=document.querySelector(".tools__apply-this"),Ts=document.querySelector(".tools__apply-all"),Ls=document.querySelector(".tools__apply-general");if(!Kc||!Qc||!tu||!eu||!iu)throw new Error(si+"missing content element");if(!Ae||!Ie)throw new Error(si+"missing output element");if(Ss&&Ts&&Ls)Ss.addEventListener("click",Gf),Ts.addEventListener("click",Yf),Ls.addEventListener("click",jf);else throw new Error(si+"missing apply element");We.forEach(t=>t.addEventListener("change",Xf));Ve.forEach(t=>t.addEventListener("change",Uf));function nu(){var e;const t=(e=st.analysis)==null?void 0:e.general;if(!t){Ie.textContent="ERROR: could not find analysis for general";return}if(!t.html){Ie.textContent="ERROR: could not find HTML for general";return}Ie.innerHTML="",t.html.forEach(i=>Ie.appendChild(i)),Ie.firstChild||(Ie.textContent="No issues found.")}function dn(t,e){var n;if(!t&&!e&&(t=We[0].value,e=Ve[0].value),!t||!e)throw new Error(si+"something went wrong!");Ae.innerHTML="";const i=(n=st.analysis)==null?void 0:n.map.find(o=>o.difficulty===e&&o.mode===t);if(!i){Ae.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!i.html){Ae.textContent="ERROR: could not find HTML for "+t+" "+e;return}i.html.forEach(o=>Ae.appendChild(o)),Ae.firstChild||(Ae.textContent="No issues found.")}function ua(t){Mf.forEach(e=>e.textContent=t)}function au(t){if(!t)return;Ve.forEach(i=>{for(let n=i.options.length-1;n>=0;n--)i.remove(n)});let e=!0;for(let i=t._difficultyBeatmaps.length-1;i>=0;i--){const n=t._difficultyBeatmaps[i];Ve.forEach(o=>{var l,a,s,c;const r=document.createElement("option");if(r.value=n._difficulty,r.textContent=fe[n._difficulty]+((l=n._customData)!=null&&l._difficultyLabel?" -- "+((a=n._customData)==null?void 0:a._difficultyLabel):""),e){const d=(s=st.beatmapDifficulty)==null?void 0:s.find(u=>u.difficulty===n._difficulty&&u.characteristic===t._beatmapCharacteristicName);if(!d)throw new Error("missing _mapSetData");Dl(d),ua(((c=n._customData)==null?void 0:c._difficultyLabel)||fe[n._difficulty]),dn(t._beatmapCharacteristicName,n._difficulty)}e=!1,o.add(r)})}}function ru(t){if(!t){We.forEach(i=>ya(i)),Ve.forEach(i=>ya(i));return}let e=!0;t._difficultyBeatmapSets.forEach(i=>{We.forEach(n=>{const o=document.createElement("option");o.value=i._beatmapCharacteristicName,o.textContent=Er[i._beatmapCharacteristicName],n.add(o)}),e&&au(i),e=!1})}function Pf(){const t=st.beatmapInfo;if(!t)throw new Error(si+"could not find map info");const e=Oe.create(t._beatsPerMinute);_i.adjustTime(e)}function Ff(){_i.toolListInput.forEach(t=>{if(t.input.html)switch(t.type){case"note":{Kc.appendChild(t.input.html);break}case"obstacle":{Qc.appendChild(t.input.html);break}case"event":{tu.appendChild(t.input.html);break}case"other":{eu.appendChild(t.input.html);break}case"general":{iu.appendChild(t.input.html);break}default:console.error(si+"could not recognise type "+t.type+" for "+t.name)}})}function Hf(){Ie&&(Ie.innerHTML="No output."),Ae&&(Ae.innerHTML="No output.")}function zf(){Hf(),ua("Difficulty Label"),ru()}function Xf(t){var n;const e=t.target;We.forEach(o=>{o!==e&&(o.value=e.value)});const i=(n=st.beatmapInfo)==null?void 0:n._difficultyBeatmapSets.find(o=>o._beatmapCharacteristicName===e.value);au(i)}function Uf(t){var o,r,l,a;const e=t.target;Ve.forEach(s=>{s!==e&&(s.value=e.value)});const i=(o=st.beatmapInfo)==null?void 0:o._difficultyBeatmapSets.find(s=>s._beatmapCharacteristicName===We.item(0).value);if(!i)throw new Error("aaaaaaaaaaaaaaaaaaa");const n=(r=st.beatmapDifficulty)==null?void 0:r.find(s=>s.difficulty===e.value&&s.characteristic===i._beatmapCharacteristicName);n&&(Dl(n),ua(((a=(l=n.info)==null?void 0:l._customData)==null?void 0:a._difficultyLabel)||fe[e.value]),dn(n.characteristic,n.difficulty))}function Gf(){const t=We[0].value,e=Ve[0].value;if(!t||!e)throw new Error(si+"mode/difficulty does not exist");vt.status("info",`Re-analysing ${t} ${e}`,100),_i.runDifficulty(t,e),vt.status("info",`Re-analysed ${t} ${e}`,100),dn(t,e)}function Yf(){const t=We[0].value,e=Ve[0].value;if(!t||!e)throw new Error(si+"mode/difficulty does not exist");vt.status("info","Re-analysing all difficulties",100),_i.applyAll(),vt.status("info","Re-analysed all difficulties",100),dn(t,e)}function jf(){vt.status("info","Re-analysing all difficulties",100),_i.runGeneral(),vt.status("info","Re-analysed all difficulties",100),nu()}const Si={displayOutputGeneral:nu,displayOutputDifficulty:dn,setDifficultyLabel:ua,adjustTime:Pf,populateSelect:ru,populateTool:Ff,reset:zf},mi="UI Stats: ",C="stats__";function Wf(t,e){const i=e.bpm,n=st.duration||0,o=i.toRealTime(e.data.getLastInteractiveTime()),r=document.createElement("table");return r.className=C+"table",r.innerHTML=`<caption class="${C}table-caption">Note Per Seconds (NPS):</caption><tr><th class="${C}table-header" colspan="2">Overall</th><td class="${C}table-element">${I(e.data.nps(n),2)}</td></tr><tr><th class="${C}table-header" colspan="2">Mapped</th><td class="${C}table-element">${I(e.data.nps(o),2)}</td></tr><tr><th class="${C}table-header" rowspan="3">Peak</th><th class="${C}table-header">16-beat</th><td class="${C}table-element">${I(e.data.peak(16,i.value),2)}</td></tr><tr><th class="${C}table-header">8-beat</th><td class="${C}table-element">${I(e.data.peak(8,i.value),2)}</td></tr><tr><th class="${C}table-header">4-beat</th><td class="${C}table-element">${I(e.data.peak(4,i.value),2)}</td></tr>`,r}function Vf(t,e){const i=Oe.create(t._beatsPerMinute),n=Se.create(i,e.info._noteJumpMovementSpeed||Se.FallbackNJS[e.difficulty],e.info._noteJumpStartBeatOffset),o=document.createElement("table");return o.className=C+"table",o.innerHTML=`<caption class="${C}table-caption">Map Settings:</caption><tr><th class="${C}table-header" colspan="2">Note Jump Speed</th><td class="${C}table-element">${I(n.value,3)}</td></tr><tr><th class="${C}table-header" colspan="2">Spawn Distance Modifier</th><td class="${C}table-element">${I(n.offset,3)}</td></tr><tr><th class="${C}table-header" colspan="2">Half Jump Duration</th><td class="${C}table-element">${I(n.hjd,3)}</td></tr><tr><th class="${C}table-header" colspan="2">Jump Distance</th><td class="${C}table-element">${I(n.jd,3)}</td></tr><tr><th class="${C}table-header" colspan="2">Reaction Time</th><td class="${C}table-element">${I(n.reactTime*1e3)}ms</td></tr>`,o}function Jf(t,e){const i=e.swingAnalysis,n=document.createElement("table");return n.className=C+"table",n.innerHTML=`<caption class="${C}table-caption">Swing Per Seconds (SPS):</caption><tr><th class="${C}table-header"></th><th class="${C}table-header">Total</th><th class="${C}table-header">Red</th><th class="${C}table-header">Blue</th></tr><tr><th class="${C}table-header">Average</th><td class="${C}table-element">${I(i.total.average,2)}</td><td class="${C}table-element">${I(i.red.average,2)}</td><td class="${C}table-element">${I(i.blue.average,2)}</td></tr><tr><th class="${C}table-header">Median</th><td class="${C}table-element">${I(i.total.median,2)}</td><td class="${C}table-element">${I(i.red.median,2)}</td><td class="${C}table-element">${I(i.blue.median,2)}</td></tr><tr><th class="${C}table-header">Peak</th><td class="${C}table-element">${I(i.total.peak,2)}</td><td class="${C}table-element">${I(i.red.peak,2)}</td><td class="${C}table-element">${I(i.blue.peak,2)}</td></tr><tr><th class="${C}table-header">Total</th><td class="${C}table-element">${i.total.total}</td><td class="${C}table-element">${i.red.total}</td><td class="${C}table-element">${i.blue.total}</td></tr>`,n}function An(t){const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let i=t.length-1;i>=0;i--)t[i].color===0?(e.red.total++,t[i].isChroma()&&e.red.chroma++,t[i].isNoodleExtensions()&&e.red.noodleExtensions++,t[i].isMappingExtensions()&&e.red.mappingExtensions++):t[i].color===1&&(e.blue.total++,t[i].isChroma()&&e.blue.chroma++,t[i].isNoodleExtensions()&&e.blue.noodleExtensions++,t[i].isMappingExtensions()&&e.blue.mappingExtensions++);return e}function qf(t){const e={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>=0;i--)e.total++,t[i].isChroma()&&e.chroma++,t[i].isNoodleExtensions()&&e.noodleExtensions++,t[i].isMappingExtensions()&&e.mappingExtensions++;return e}function vn(t,e){return t.filter(i=>i.data.posX===e).length}function Zf(t,e){return t.filter(i=>i.data.posY===e).length}function Kf(t,e,i){return t.filter(n=>n.data.posX===e&&n.data.posY===i).length}function Qf(t,e){return t.filter(i=>i.type!=="bomb"&&i.data.direction===e).length}function ou(t,e){switch(e){case"note":return t.filter(i=>i.type==="note");case"red":return t.filter(i=>i.type==="note"&&i.data.color===0);case"blue":return t.filter(i=>i.type==="note"&&i.data.color===1);case"arc":return t.filter(i=>i.type==="slider");case"redArc":return t.filter(i=>i.type==="slider"&&i.data.color===0);case"blueArc":return t.filter(i=>i.type==="slider"&&i.data.color===1);case"chain":return t.filter(i=>i.type==="burstSlider");case"redChain":return t.filter(i=>i.type==="burstSlider"&&i.data.color===0);case"blueChain":return t.filter(i=>i.type==="burstSlider"&&i.data.color===1);case"bomb":return t.filter(i=>i.type==="bomb");default:return t}}function tm(t){var s;const e=t.target,i=e.id.replace(`${C}table-select-angle-`,"").split("-"),n=i[0],o=i[1],r=(s=st.beatmapDifficulty.find(c=>c.characteristic===n&&c.difficulty===o))==null?void 0:s.noteContainer;if(!r){console.error(mi+"note could not be found");return}const l=ou(r,e.value),a=document.querySelector(`#${C}table-angle-${n}-${o}`);if(!a){console.error(mi+"table could not be found");return}a.innerHTML=su(l)}function su(t){const e=t.length||1,i=[4,0,5,2,8,3,6,1,7];let n="";for(let o=0;o<3;o++){n+="<tr>";for(let r=0;r<3;r++){let l=Qf(t,i[o*3+r]);n+=`<td class="${C}table-element">${l}<br>(${I(l/e*100,1)}%)</td>`}n+="</tr>"}return n}function em(t,e){var r;const i=hn.create(`${C}table-select-angle-${e.characteristic}-${e.difficulty}`,"Note Angle: ","caption",`${C}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"});(r=i.querySelector("select"))==null||r.addEventListener("change",tm);let n=`<tbody id="${C}table-angle-${e.characteristic}-${e.difficulty}">${su(e.noteContainer)}</tbody>`;const o=document.createElement("table");return o.className=C+"table",o.innerHTML=n,o.prepend(i),o}function im(t,e,i="DefaultEnvironment"){var r;const n=((r=pi[i])==null?void 0:r[0])??pi.DefaultEnvironment[0],o={};for(let l=n.length-1;l>=0;l--)o[n[l]]={total:0,chroma:0,chromaOld:0};o[5]={total:e.length,chroma:0,chromaOld:0};for(let l=t.length-1;l>=0;l--)t[l].isValidType()&&(o[t[l].type]||(o[t[l].type]={total:0,chroma:0,chromaOld:0}),o[t[l].type].total++,t[l].isChroma()&&o[t[l].type].chroma++,t[l].isOldChroma()&&o[t[l].type].chromaOld++);return o}function pa(t,e="DefaultEnvironment"){var o;const i=((o=pi[e])==null?void 0:o[1])??pi.DefaultEnvironment[1],n={};for(let r=i.length-1;r>=0;r--)n[i[r]]={total:0,eventBox:0,base:0};for(let r=t.length-1;r>=0;r--)n[t[r].id]||(n[t[r].id]={total:0,eventBox:0,base:0}),n[t[r].id].total++,n[t[r].id].eventBox+=t[r].boxes.length,n[t[r].id].base+=t[r].boxes.reduce((l,a)=>l+a.events.length,0);return n}function nm(t){const e={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>-1;i--)e.total++,t[i].isInteractive()&&e.interactive++,t[i].isChroma()&&e.chroma++,t[i].isNoodleExtensions()&&e.noodleExtensions++,t[i].isMappingExtensions()&&e.mappingExtensions++;return e}const am={0:"Back Lasers",1:"Ring Lights",2:"Left Lasers",3:"Right Lasers",4:"Center Lights",5:"Boost Colors",6:"Extra Left Lights",7:"Extra Right Lights",8:"Ring Rotation",9:"Ring Zoom",10:"Extra Left Lasers",11:"Extra Right Lasers",12:"Left Laser Speed",13:"Right Laser Speed",14:"Early Lane Rotation",15:"Late Lane Rotation",16:"Utility Event 1",17:"Utility Event 2",18:"Utility Event 3",19:"Utility Event 4",40:"Special Event 1",41:"Special Event 2",42:"Special Event 3",43:"Special Event 4"},rm={LinkinParkEnvironment:{0:"Lane Light",1:"Ceiling Lights",8:"Laser Mode"},BTSEnvironment:{0:"Door Light",1:"Vertical Pillar Lights",8:"Distant Tower Spin",9:"Raise/Lower Pillars",40:"BTS Event 1",41:"BTS Event 2",42:"BTS Event 3",43:"BTS Event 4"},KaleidoscopeEnvironment:{0:"Spike Tip Lights",1:"Spike Mid Lights",2:"Spike Left Lights",3:"Spike Right Lights",4:"Distant Lasers and Spike Top Lights"},InterscopeEnvironment:{0:"Gate 1",1:"Gate 2",2:"Gate 3",3:"Gate 4",4:"Gate 5",6:"Extra 1",7:"Extra 2"},SkrillexEnvironment:{0:"Logo",1:"Top Lanes and 1st Ring Set",4:"Bottom Lanes and 2nd Ring Set",6:"Left Panel",7:"Right Panel",12:"Left Laser & Panel Speed",13:"Right Laser & Panel Speed"},BillieEnvironment:{0:"Water 4",1:"Water 1",2:"Left Sun Beams",3:"Right Sun Beams",4:"Sun",6:"Water 2",7:"Water 3",8:"Toggle Rain",9:"Sunbeam Mode",10:"Left Bottom Lasers",11:"Right Bottom Lasers",12:"Left Sun Beams Speed",13:"Right Sun Beams Speed"},HalloweenEnvironment:{0:"Sky Lasers",1:"Moon",4:"Lane + Castle Interior"},GagaEnvironment:{0:"Aurora 1",1:"Aurora 2",2:"Tower 1",3:"Tower 2",4:"Logo",6:"Tower 3",7:"Tower 4",10:"Tower 5",11:"Tower 6",14:"Tower 1 Height",15:"Tower 2 Height",16:"Tower 3 Height",17:"Tower 4 Height",18:"Tower 5 Height",19:"Tower 6 Height"},WeaveEnvironment:{4:"Player Space"},PyroEnvironment:{0:"Video Alpha",1:"Logo",2:"Left Projectors",3:"Right Projectors",4:"Platform",6:"Ambient",40:"Video Projection"},EDMEnvironment:{0:"Lane Lights Bottom",1:"Lane Lights Top",4:"Player Space & Spectrogram"},TheSecondEnvironment:{0:"Logo",1:"Runway",2:"Left Flags",3:"Right Flags",4:"Buildings"},LizzoEnvironment:{0:"Runway Left",1:"Runway Right",2:"Left Ring",3:"Right Ring",4:"Top Square",6:"Ambient",7:"Cherry Left",8:"Cherry Right",9:"LI Sign",10:"Z Left Sign",11:"Z Right Sign",12:"O Sign",16:"Left Balloon Particles",17:"Right Balloon Particles"},TheWeekndEnvironment:{0:"Runway Left",1:"Runway Right",6:"Ambient"},RockMixtapeEnvironment:{3:"BG Bloom",4:"Aurora",6:"Ambient"},Dragons2Environment:{0:"Inner Laser Left",1:"Inner Laser Right",2:"Outer Laser Left",3:"Outer Laser Right",4:"Logo",6:"Ambient"},Panic2Environment:{3:"Ambient"}};function om(t,e){var i;return((i=rm[e])==null?void 0:i[t])||am[t]||"Unknown"}const sm={WeaveEnvironment:{0:"Outer Square Bottom Left Laser",1:"Outer Square Bottom Right Laser",2:"Outer Square Top Left Laser",3:"Outer Square Top Right Laser",4:"Inner Square Bottom Left Laser",5:"Inner Square Bottom Right Laser",6:"Inner Square Top Left Laser",7:"Inner Square Top Right Laser",8:"Side Square Bottom Left Laser",9:"Side Square Bottom Right Laser",10:"Side Square Top Left Laser",11:"Side Square Top Right Laser",12:"Distant Square Top Laser",13:"Distant Square Bottom Laser",14:"Distant Square Left Laser",15:"Distant Square Right Laser"},PyroEnvironment:{0:"Stage Left Platform",1:"Stage Right Platform",2:"Top Stage Left Laser",3:"Top Stage Right Laser",4:"Top Stage Middle Laser",5:"Top Stage Light",6:"Side Panels Left Tower",7:"Side Panels Right Tower",8:"Stage Left Laser",9:"Stage Right Laser",10:"Side Panels Left Laser",11:"Side Panels Right Laser",12:"Fire Left",13:"Fire Right"},EDMEnvironment:{0:"Circles Top",1:"Circles Close",2:"Circles Distant",3:"Circles Distant 2",4:"Single Source Circles Left",5:"Single Source Circles Right",6:"Single Source Lasers Left (Up)",7:"Single Source Lasers Left (Out)",8:"Single Source Lasers Right (Up)",9:"Single Source Lasers Right (Out)",10:"Single Source Lasers Left (Down)",11:"Single Source Lasers Right (Down)",12:"Single Source Lasers Left (Down) / Circle Rotations Top",13:"Single Source Lasers Right (Up) / Circle Rotations Close",14:"Circle Rotations Distant",15:"Circle Rotations Distant 2",16:"Circle Rotations Single Source Left",17:"Circle Rotations Single Source Right"},TheSecondEnvironment:{0:"Rings Big",1:"Rings Small",2:"Runway Left",3:"Runway Right",4:"Spotlight Left",5:"Spotlight Right",6:"Top Lasers Left Bottom",7:"Top Lasers Right Bottom",8:"Top Lasers Left Top",9:"Top Lasers Right Top",10:"Bottom Lasers Left Bottom",11:"Bottom Lasers Right Bottom",12:"Bottom Lasers Left Top",13:"Bottom Lasers Right Top"},LizzoEnvironment:{0:"Main Floor",1:"Rainbow Arcs Inner",2:"Rainbow Arcs 2",3:"Rainbow Arcs 3",4:"Rainbow Arcs 4",5:"Rainbow Arcs Outer",6:"Rainbow Rings Left",7:"Rainbow Rings Right",8:"Rainbow Rings Lasers Left",9:"Rainbow Rings Lasers Right",10:"Main Top Lasers",11:"Environment Stands Left",12:"Environment Stands Right",13:"Environment Clouds Left",14:"Environment Clouds Right",15:"Main Left Lasers",16:"Main Right Lasers",17:"Environment Stand Lasers Left",18:"Environment Stand Lasers Right",19:"Rainbow Arcs Laser"},TheWeekndEnvironment:{0:"Lamps Poles Left",1:"Lamps Poles Right",2:"Lamps Rings Left",3:"Lamps Rings Right",4:"Environment Arrows",5:"Environment Side Lasers Left",6:"Environment Side Lasers Right",7:"Environment Runway Lane",8:"Environment Center Ring",9:"Environment Center Ring Lasers",10:"Windows Left 1 Front",11:"Windows Left 1 Side",12:"Windows Left 2 Side",13:"Windows Left 3 Front",14:"Windows Left 3 Side",15:"Windows Right 1 Front",16:"Windows Right 1 Side",17:"Windows Right 2 Side",18:"Windows Right 3 Front",19:"Windows Right 3 Side",20:"Buildings Left",21:"Buildings Right",22:"Buildings Roof Left",23:"Buildings Roof Right",29:"Lamp Rings Left 1",30:"Lamp Rings Left 2",31:"Lamp Rings Left 3",32:"Lamp Rings Left 4",33:"Lamp Rings Right 1",34:"Lamp Rings Right 2",35:"Lamp Rings Right 3",36:"Lamp Rings Right 4",37:"Buildings Background Left",38:"Buildings Background Right",40:"Buildings Side Buildings"},RockMixtapeEnvironment:{0:"Lasers Far Left",1:"Lasers Far Right",2:"Mountain 1",3:"Mountain 2",4:"Mountain 3",5:"Mountain 4",6:"Mountain 5",7:"Mountain 6",8:"Mountain 7",9:"Mountain 8",10:"Mountain 9",11:"Mountain 10",12:"Mountain 11",13:"Mountain 12",14:"Face Eyes",15:"Runway Frets",16:"Runway Strings",17:"Runway Tunnel",18:"Lasers Side Left",19:"Lasers Side Right",20:"Lasers Side Left Rotation",21:"Lasers Side Right Rotation",22:"Face Left",23:"Face Right",24:"Spikes Left",25:"Spikes Left Movement",26:"Spikes Right",27:"Spikes Right Movement",28:"Runway Dots",29:"Face Movement",30:"Runway Equilizer",31:"Screens Left 1",32:"Screens Left 2",33:"Screens Right 1",34:"Screens Right 2",35:"Screens Left Movement",36:"Screens Right Movement",37:"Lasers Side Z Translation"},Dragons2Environment:{0:"Small Rings (R/T)",1:"Small Rings (Colors)",2:"Underground",3:"Big Rings",4:"Top Spotlights",5:"Runway Left",6:"Runway Right",7:"Particles Left",8:"Particles Right",9:"Main Lasers Bottom Left",10:"Main Lasers Top Left",11:"Main Lasers Top Right",12:"Main Lasers Bottom Right"},Panic2Environment:{0:"Left Cones Local",1:"Right Cones Local",2:"Left Cones Global",3:"Right Cones Global",4:"Center Cones Local",5:"Center Cones Global",6:"Diamond Rings Local Left",7:"Diamond Rings Local Right",8:"Diamond Rings Global",9:"Lasers Bottom Left",10:"Lasers Bottom Right",11:"Lasers Top Left",12:"Lasers Top Right",13:"Runway Lasers Left",14:"Runway Lasers Right",15:"Runway Inner Laser",16:"Spectrogram Left",17:"Spectrogram Right",18:"Runway Lasers Left Transform Z",19:"Runway Lasers Right Transform Z",20:"Window Left Pirces",21:"Window Left Aura",22:"Window Right Pieces",23:"Window Right Aura"}};function lm(t,e){var i;return((i=sm[e])==null?void 0:i[t])||"Unknown"}function cm(t,e){const i=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,n=im(e.data.basicEvents,e.data.colorBoostEvents,i);let o=0,r=0,l=`<caption class="${C}table-caption">Events: ${Object.values(n).reduce((s,{total:c})=>s+c,0)}</caption>`;for(const s in n)o+=n[s].chroma,r+=n[s].chromaOld,l+=`<tr><th class="${C}table-header">${s}</th><th class="${C}table-header" colspan="4">${om(parseInt(s),i)}</th><td class="${C}table-element">${n[s].total}</td></tr>`;o&&(l+=`<tr><th class="${C}table-header" colspan="5">Chroma</th><td class="${C}table-element">${o}</td></tr>`),r&&(l+=`<tr><th class="${C}table-header" colspan="5">OG Chroma</th><td class="${C}table-element">${r}</td></tr>`);const a=document.createElement("table");return a.className=C+"table",a.innerHTML=l,a}function um(t,e){const i=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,n=pa(e.data.lightColorEventBoxGroups,i),o=pa(e.data.lightRotationEventBoxGroups,i),r=pa(e.data.lightTranslationEventBoxGroups,i);for(const u in n)o[u]||(o[u]={total:0,eventBox:0,base:0}),r[u]||(r[u]={total:0,eventBox:0,base:0});for(const u in o)n[u]||(n[u]={total:0,eventBox:0,base:0}),r[u]||(r[u]={total:0,eventBox:0,base:0});for(const u in r)o[u]||(o[u]={total:0,eventBox:0,base:0}),n[u]||(n[u]={total:0,eventBox:0,base:0});let l=`<caption class="${C}table-caption">Event Box Group:</caption><tr><th class="${C}table-header"></th><th class="${C}table-header">Group</th><th class="${C}table-header">Box</th><th class="${C}table-header">Base</th><tr><th class="${C}table-header">Color</th><td class="${C}table-element">${Object.values(n).reduce((u,{total:m})=>u+m,0)}</td><td class="${C}table-element">${Object.values(n).reduce((u,{eventBox:m})=>u+m,0)}</td><td class="${C}table-element">${Object.values(n).reduce((u,{base:m})=>u+m,0)}</td></tr><tr><th class="${C}table-header">Rotate</th><td class="${C}table-element">${Object.values(o).reduce((u,{total:m})=>u+m,0)}</td><td class="${C}table-element">${Object.values(o).reduce((u,{eventBox:m})=>u+m,0)}</td><td class="${C}table-element">${Object.values(o).reduce((u,{base:m})=>u+m,0)}</td></tr><tr><th class="${C}table-header">Translate</th><td class="${C}table-element">${Object.values(r).reduce((u,{total:m})=>u+m,0)}</td><td class="${C}table-element">${Object.values(r).reduce((u,{eventBox:m})=>u+m,0)}</td><td class="${C}table-element">${Object.values(r).reduce((u,{base:m})=>u+m,0)}</td></tr><tr><th class="${C}table-header">Total</th><td class="${C}table-element">${Object.values(n).reduce((u,{total:m})=>u+m,0)+Object.values(o).reduce((u,{total:m})=>u+m,0)+Object.values(r).reduce((u,{total:m})=>u+m,0)}</td><td class="${C}table-element">${Object.values(n).reduce((u,{eventBox:m})=>u+m,0)+Object.values(o).reduce((u,{eventBox:m})=>u+m,0)+Object.values(r).reduce((u,{eventBox:m})=>u+m,0)}</td><td class="${C}table-element">${Object.values(n).reduce((u,{base:m})=>u+m,0)+Object.values(o).reduce((u,{base:m})=>u+m,0)+Object.values(r).reduce((u,{base:m})=>u+m,0)}</td></tr>`,a=`<caption class="${C}table-caption">Event Box Group ID:</caption>`;for(const u in n)a+=`<tr><th class="${C}table-header">${u}</th><th class="${C}table-header" colspan="5">${lm(parseInt(u),i)}</th><td class="${C}table-element" title="${n[u].eventBox} Box (${n[u].base} Base)">${n[u].total}</td><td class="${C}table-element" title="${o[u].eventBox} Box (${o[u].base} Base)">${o[u].total}</td><td class="${C}table-element" title="${r[u].eventBox} Box (${r[u].base} Base)">${r[u].total}</td></tr>`;const s=document.createElement("table");s.className=C+"table",s.innerHTML=l;const c=document.createElement("table");c.className=C+"table",c.innerHTML=a;const d=document.createElement("div");return d.appendChild(s),d.appendChild(document.createElement("br")),d.appendChild(c),d}const hm=115;function dm(t){let e=0,i=1;for(let n=0,o=t.filter(r=>r.type==="note"&&!(typeof r.data.customData.uninteractable<"u"||!r.data.customData.uninteractable)).length;n<o;n++)i<8&&n===-3+i*4&&(i*=2),e+=hm*i;return e}function fm(t,e){const i=An(e.data.colorNotes);let n=`<caption class="${C}table-caption">Note Information:</caption><tr><th class="${C}table-header" colspan="2">R/B Ratio</th><td class="${C}table-element">${I(i.red.total/i.blue.total,2)}</td></tr><tr><th class="${C}table-header" colspan="2">Max Score</th><td class="${C}table-element">${yu(dm(e.noteContainer))}</td></tr><tr><th class="${C}table-header" colspan="2">Effective BPM</th><td class="${C}table-element">${I(Yu(e.swingAnalysis.container),2)}</td></tr><tr><th class="${C}table-header" colspan="2">Effective BPM (swing)</th><td class="${C}table-element">${I(ju(e.swingAnalysis.container),2)}</td></tr>`,o=I(Qu(e.swingAnalysis.container)*1e3,1),r=I(th(e.swingAnalysis.container)*1e3,1);o&&r&&(n+=`<tr><th class="${C}table-header" colspan="2">Min. Slider Speed</th><td class="${C}table-element">${o}ms</td></tr><tr><th class="${C}table-header" colspan="2">Max. Slider Speed</th><td class="${C}table-element">${r}ms</td></tr>`);const l=document.createElement("table");return l.className=C+"table",l.innerHTML=n,l}function mm(t,e){const i=An(e.data.colorNotes),n=An(e.data.sliders),o=An(e.data.burstSliders),r=qf(e.data.bombNotes);let l=`<caption class="${C}table-caption">Note Count:</caption><tr><th class="${C}table-header"></th><th class="${C}table-header">Note</th><th class="${C}table-header">Arc</th><th class="${C}table-header">Chain</th><th class="${C}table-header">Bomb</th></tr><tr><th class="${C}table-header">Total</th><td class="${C}table-element">${i.red.total+i.blue.total}</td><td class="${C}table-element">${n.red.total+n.blue.total}</td><td class="${C}table-element">${o.red.total+o.blue.total}</td><td class="${C}table-element">${r.total}</td></tr><tr><th class="${C}table-header">Red</th><td class="${C}table-element">${i.red.total}</td><td class="${C}table-element">${n.red.total}</td><td class="${C}table-element">${o.red.total}</td><td class="${C}table-element">0</td></tr><tr><th class="${C}table-header">Blue</th><td class="${C}table-element">${i.blue.total}</td><td class="${C}table-element">${n.blue.total}</td><td class="${C}table-element">${o.blue.total}</td><td class="${C}table-element">0</td></tr>`;(i.red.chroma||i.blue.chroma||n.red.chroma||n.blue.chroma||o.red.chroma||o.blue.chroma||r.chroma)&&(l+=`<tr><th class="${C}table-header">Chroma</th><td class="${C}table-element">${i.red.chroma+i.blue.chroma}</td><td class="${C}table-element">${n.red.chroma+n.blue.chroma}</td><td class="${C}table-element">${o.red.chroma+o.blue.chroma}</td><td class="${C}table-element">${r.chroma}</td></tr>`),(i.red.noodleExtensions||i.blue.noodleExtensions||n.red.noodleExtensions||n.blue.noodleExtensions||o.red.noodleExtensions||o.blue.noodleExtensions||r.noodleExtensions)&&(l+=`<tr><th class="${C}table-header">NE</th><td class="${C}table-element">${i.red.noodleExtensions+i.blue.noodleExtensions}</td><td class="${C}table-element">${n.red.noodleExtensions+n.blue.noodleExtensions}</td><td class="${C}table-element">${o.red.noodleExtensions+o.blue.noodleExtensions}</td><td class="${C}table-element">${r.noodleExtensions}</td></tr></tr>`),(i.red.mappingExtensions||i.blue.mappingExtensions||n.red.mappingExtensions||n.blue.mappingExtensions||o.red.mappingExtensions||o.blue.mappingExtensions||r.mappingExtensions)&&(l+=`<tr><th class="${C}table-header">ME</th><td class="${C}table-element">${i.red.mappingExtensions+i.blue.mappingExtensions}</td><td class="${C}table-element">${n.red.mappingExtensions+n.blue.mappingExtensions}</td><td class="${C}table-element">${o.red.mappingExtensions+o.blue.mappingExtensions}</td><td class="${C}table-element">${r.mappingExtensions}</td></tr></tr>`);const a=document.createElement("table");return a.className=C+"table",a.innerHTML=l,a}function pm(t){var s;const e=t.target,i=e.id.replace(`${C}table-select-placement-`,"").split("-"),n=i[0],o=i[1],r=(s=st.beatmapDifficulty.find(c=>c.characteristic===n&&c.difficulty===o))==null?void 0:s.noteContainer;if(!r){console.error(mi+"note could not be found");return}const l=ou(r,e.value),a=document.querySelector(`#${C}table-placement-${n}-${o}`);if(!a){console.error(mi+"table could not be found");return}a.innerHTML=lu(l)}function lu(t){const e=t.length||1;let i="";for(let n=2;n>=0;n--){i+="<tr>";for(let o=0;o<=3;o++)i+=`<td class="${C}table-element">${Kf(t,o,n)}</td>`;i+=`<td class="${C}table-element ${C}table--no-border">${I(Zf(t,n)/e*100,1)}%</td>
        </tr>`}return i+=`<tr><td class="${C}table-element ${C}table--no-border">${I(vn(t,0)/e*100,1)}%</td><td class="${C}table-element ${C}table--no-border">${I(vn(t,1)/e*100,1)}%</td><td class="${C}table-element ${C}table--no-border">${I(vn(t,2)/e*100,1)}%</td><td class="${C}table-element ${C}table--no-border">${I(vn(t,3)/e*100,1)}%</td></tr>`,i}function gm(t,e){var r;const i=hn.create(`${C}table-select-placement-${e.characteristic}-${e.difficulty}`,"Note Placement: ","caption",`${C}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"},{text:"Bomb",value:"bomb"});(r=i.querySelector("select"))==null||r.addEventListener("change",pm);let n=`<tbody id="${C}table-placement-${e.characteristic}-${e.difficulty}">${lu(e.noteContainer)}</tbody>`;const o=document.createElement("table");return o.className=C+"table",o.innerHTML=n,o.prepend(i),o}function _m(t,e){const i=nm(e.data.obstacles);let n=`<caption class="${C}table-caption">Obstacles: ${i.total}</caption>`;i.interactive&&(n+=`<tr><th class="${C}table-header" colspan="2">Interactive</th><td class="${C}table-element">${i.interactive}</td></tr>`),i.chroma&&(n+=`<tr><th class="${C}table-header" colspan="2">Chroma</th><td class="${C}table-element">${i.chroma}</td></tr>`),i.noodleExtensions&&(n+=`<tr><th class="${C}table-header" colspan="2">Noodle Extensions</th><td class="${C}table-element">${i.noodleExtensions}</td></tr>`),i.mappingExtensions&&(n+=`<tr><th class="${C}table-header" colspan="2">Mapping Extensions</th><td class="${C}table-element">${i.mappingExtensions}</td></tr>`);const o=document.createElement("table");return o.className=C+"table",o.innerHTML=n,o}const In=document.querySelector("#stats .accordion__collapsible");function bm(){if(!st.beatmapInfo)throw new Error(mi+"map info could not be found in savedData");const t=st.beatmapInfo;t._difficultyBeatmapSets.forEach(e=>{var o,r;const i=document.createElement("div");i.className=C+"mode-"+e._beatmapCharacteristicName;const n=document.createElement("div");n.className=C+"title",n.textContent=Er[e._beatmapCharacteristicName],i.appendChild(n);for(let l=e._difficultyBeatmaps.length-1;l>=0;l--){const a=e._difficultyBeatmaps[l],s=st.beatmapDifficulty.find(g=>g.characteristic===e._beatmapCharacteristicName&&g.difficulty===a._difficulty);if(!s)throw new Error(mi+"Could not find map data");const c=Os.create(`${C}${e._beatmapCharacteristicName}-${a._difficulty}`,fe[a._difficulty]+((o=a._customData)!=null&&o._difficultyLabel?" -- "+((r=a._customData)==null?void 0:r._difficultyLabel):""),a._difficulty,!0),d=c.querySelector(".accordion__collapsible-flex"),u=c.querySelector(".accordion__button");if(!d||!u)throw new Error(mi+"something went wrong!");u.checked=Q.onLoad.stats;const m=Wi.create("small","half"),h=Wi.create("small","half"),p=Wi.create("small","half");m.append(Vf(t,s)),m.append(document.createElement("br")),m.append(Wf(t,s)),m.append(document.createElement("br")),m.append(Jf(t,s)),h.append(fm(t,s)),h.append(document.createElement("br")),h.append(mm(t,s)),h.append(document.createElement("br")),h.append(gm(t,s)),h.append(document.createElement("br")),h.append(em(t,s)),p.append(cm(t,s)),p.append(document.createElement("br")),p.append(um(t,s)),p.append(document.createElement("br")),p.append(_m(t,s)),d.appendChild(m),d.appendChild(h),d.appendChild(p),i.appendChild(c)}In.appendChild(i)})}function ym(){for(;In.firstChild;)In.removeChild(In.firstChild)}function Cs(t){if(!t)return{};const e=_t(t);return Object.keys(e).length?(e.color??(e.color=e._color),e.coordinates??(e.coordinates=e._position),e.disableNoteGravity??(e.disableNoteGravity=e._disableNoteGravity),e.disableNoteLook??(e.disableNoteLook=e._disableNoteLook),e.flip??(e.flip=e._flip),e.localRotation??(e.localRotation=e._localRotation),e.noteJumpMovementSpeed??(e.noteJumpMovementSpeed=e._noteJumpMovementSpeed),e.noteJumpStartBeatOffset??(e.noteJumpStartBeatOffset=e._noteJumpStartBeatOffset),e.spawnEffect??(e.spawnEffect=typeof e._disableSpawnEffect=="boolean"?!e._disableSpawnEffect:void 0),e.size??(e.size=e._scale),e.track??(e.track=e._track),e.uninteractable??(e.uninteractable=typeof e._interactable=="boolean"?!e._interactable:void 0),e.worldRotation??(e.worldRotation=e._rotation),e._animation&&(e.animation??(e.animation={color:e._animation._color,definitePosition:e._animation._definitePosition,dissolve:e._animation._dissolve,dissolveArrow:e._animation._dissolveArrow,interactable:e._animation._interactable,localRotation:e._animation._localRotation,offsetPosition:e._animation._position,offsetRotation:e._animation._rotation,scale:e._animation._scale,time:e._animation._time})),delete e._color,delete e._position,delete e._disableNoteGravity,delete e._disableNoteLook,delete e._flip,delete e._cutDirection,delete e._localRotation,delete e._noteJumpMovementSpeed,delete e._noteJumpStartBeatOffset,delete e._disableSpawnEffect,delete e._scale,delete e._track,delete e._interactable,delete e._rotation,delete e._animation,e):{}}function vm(t){if(!t)return{};const e=_t(t);if(!Object.keys(e).length)return{};const i=e._preciseSpeed??e._speed;return e.color??(e.color=e._color),e.lightID??(e.lightID=e._lightID),e.easing??(e.easing=e._easing),e.lerpType??(e.lerpType=e._lerpType),e.nameFilter??(e.nameFilter=e._nameFilter),e.rotation??(e.rotation=e._rotation),e.step??(e.step=e._step),e.prop??(e.prop=e._prop),e.speed??(e.speed=i),e.direction??(e.direction=e._direction),e.lockRotation??(e.lockRotation=e._lockPosition),delete e._color,delete e._lightID,delete e._easing,delete e._lerpType,delete e._propID,delete e._lightGradient,delete e._nameFilter,delete e._rotation,delete e._step,delete e._prop,delete e._speed,delete e._preciseSpeed,delete e._direction,delete e._reset,delete e._counterSpin,delete e._stepMult,delete e._propMult,delete e._speedMult,delete e._lockPosition,e}const ae=t=>`[convert::${t}]`;function Em(t,e){var n,o,r,l,a;if(e)K.warn(ae("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!");else{if(K.warn(ae("V2toV3"),"Converting beatmap v2 to v3 may lose certain data!"),prompt("Proceed with conversion? (y/N):","n")[0].toLowerCase()!=="y")throw Error("Conversion to beatmap v3 denied.");K.info(ae("V2toV3"),"Converting beatmap v2 to v3")}const i=zc.create();if(i.fileName=t.fileName,i.customData.fakeBombNotes=[],i.customData.fakeColorNotes=[],i.customData.fakeObstacles=[],t.colorNotes.forEach((s,c)=>{const d=Cs(s.customData);if(typeof s.customData._cutDirection=="number"&&K.debug(ae("V2toV3"),`notes[${c}] at time ${s.time} NE _cutDirection will be converted.`),s.isBomb()&&(s.customData._fake?i.customData.fakeBombNotes.push(Ti.create({b:s.time,x:s.posX,y:s.posY,customData:d})[0].toJSON()):i.bombNotes.push(Ti.create({b:s.time,x:s.posX,y:s.posY,customData:d})[0])),s.isNote()){let u=0;typeof s.customData._cutDirection=="number"?u=s.customData._cutDirection>0?s.customData._cutDirection%360:360+s.customData._cutDirection%360:s.direction>=1e3&&(u=Math.abs(s.direction%1e3%360-360)),s.customData._fake?i.customData.fakeColorNotes.push(je.create({b:s.time,c:s.type,x:s.posX,y:s.posY,d:s.direction>=1e3||typeof s.customData._cutDirection=="number"?s.direction===8?8:1:Mr(s.direction,0,8),a:u,customData:d})[0].toJSON()):i.colorNotes.push(je.create({b:s.time,c:s.type,x:s.posX,y:s.posY,d:s.direction>=1e3||typeof s.customData._cutDirection=="number"?s.direction===8?8:1:Mr(s.direction,0,8),a:u,customData:d})[0])}}),t.obstacles.forEach(s=>{const c=Cs(s.customData);s.customData._fake?i.customData.fakeObstacles.push(te.create({b:s.time,x:s.posX,y:s.type?2:0,d:s.duration,w:s.width,h:s.type?3:5,customData:c})[0].toJSON()):i.obstacles.push(te.create({b:s.time,x:s.posX,y:s.type?2:0,d:s.duration,w:s.width,h:s.type?3:5,customData:c})[0])}),t.basicEvents.forEach((s,c)=>{if(s.isColorBoost())i.colorBoostEvents.push(Zi.create({b:s.time,o:!!s.value})[0]);else if(s.isLaneRotationEvent())i.rotationEvents.push(Ki.create({b:s.time,e:s.type===14?0:1,r:typeof s.customData._rotation=="number"?s.customData._rotation:s.value>=1e3?(s.value-1360)%360:Vu[s.value]??0})[0]);else if(s.isBPMChangeEvent())i.bpmEvents.push(qi.create({b:s.time,m:s.floatValue})[0]);else{const d=vm(s.customData);s.isLightEvent()&&(s.customData._propID&&K.warn(ae("V2toV3"),`events[${c}] at time ${s.time} Chroma _propID will be removed.`),s.customData._lightGradient&&K.warn(ae("V2toV3"),`events[${c}] at time ${s.time} Chroma _lightGradient will be removed.`)),s.isRingEvent()&&(s.customData._reset&&K.warn(ae("V2toV3"),`events[${c}] at time ${s.time} Chroma _reset will be removed.`),s.customData._counterSpin&&K.warn(ae("V2toV3"),`events[${c}] at time ${s.time} Chroma _counterSpin will be removed.`),(s.customData._stepMult||s.customData._propMult||s.customData._speedMult)&&K.warn(ae("V2toV3"),`events[${c}] at time ${s.time} Chroma _mult will be removed.`)),i.basicEvents.push(Ji.create({b:s.time,et:s.type,i:s.value,f:s.floatValue,customData:d})[0])}}),t.waypoints.forEach(s=>{i.waypoints.push(tn.create({b:s.time,x:s.posX,y:s.posY,d:s.direction})[0])}),t.sliders.forEach(s=>i.sliders.push(Qi.create({c:s.color,b:s.time,x:s.posX,y:s.posY,d:s.direction,mu:s.lengthMultiplier,tb:s.tailTime,tx:s.tailPosX,ty:s.tailPosY,tc:s.tailDirection,tmu:s.tailLengthMultiplier,m:s.midAnchor})[0])),i.eventTypesWithKeywords=Sr.create({d:((o=(n=t.eventTypesWithKeywords)==null?void 0:n.list)==null?void 0:o.map(s=>({k:s.keyword,e:s.events})))??[]}),t.customData)for(const s in t.customData){if(s==="_customEvents"){i.customData.customEvents=[],t.customData._customEvents.forEach(c=>{var d,u,m,h,p;c._type==="AnimateTrack"&&((d=i.customData.customEvents)==null||d.push({b:c._time,t:"AnimateTrack",d:{track:c._data._track,duration:c._data._duration,easing:c._data._easing,position:c._data._position,rotation:c._data._rotation,localRotation:c._data._localRotation,scale:c._data._scale,dissolve:c._data._dissolve,dissolveArrow:c._data._dissolveArrow,color:c._data._color,interactable:c._data._interactable,time:c._data._time}})),c._type==="AssignPathAnimation"&&((u=i.customData.customEvents)==null||u.push({b:c._time,t:"AssignPathAnimation",d:{track:c._data._track,easing:c._data._easing,position:c._data._position,rotation:c._data._rotation,localRotation:c._data._localRotation,scale:c._data._scale,dissolve:c._data._dissolve,dissolveArrow:c._data._dissolveArrow,color:c._data._color,interactable:c._data._interactable,definitePosition:c._data._definitePosition}})),c._type==="AssignTrackParent"&&((m=i.customData.customEvents)==null||m.push({b:c._time,t:"AssignTrackParent",d:{childrenTracks:c._data._childrenTracks,parentTrack:c._data._parentTrack,worldPositionStays:c._data._worldPositionStays}})),c._type==="AssignPlayerToTrack"&&((h=i.customData.customEvents)==null||h.push({b:c._time,t:"AssignPlayerToTrack",d:{track:c._data._track,target:c._data._target}})),c._type==="AssignFogTrack"&&((p=i.customData.customEvents)==null||p.push({b:c._time,t:"AnimateComponent",d:{track:c._data._track,duration:c._data._duration||0,BloomFogEnvironment:{attenuation:typeof c._data._attenuation=="number"?[[c._data._attenuation,0]]:c._data._attenuation,height:typeof c._data._height=="number"?[[c._data._height,0]]:c._data._height,offset:typeof c._data._offset=="number"?[[c._data._offset,0]]:c._data._offset,startY:typeof c._data._startY=="number"?[[c._data._startY,0]]:c._data._startY}}}))});continue}if(s==="_environment"){i.customData.environment=t.customData._environment.map(c=>{let d={};if(c._lightID&&(d={ILightWithId:{lightID:c._lightID}}),c._id&&c._lookupMethod)return{id:c._id,lookupMethod:c._lookupMethod,track:c._track,duplicate:c._duplicate,active:c._active,scale:c._scale,position:Xi(c._position,.6),rotation:c._rotation,localPosition:Xi(c._localPosition,.6),localRotation:c._localRotation,components:d};if(c._geometry)return c._lightID&&d.ILightWithId&&(d.ILightWithId.type=0),{geometry:c._geometry._type==="CUSTOM"?{type:c._geometry._type,mesh:{vertices:c._geometry._mesh._vertices,uv:c._geometry._mesh._uv,triangles:c._geometry._mesh._triangles},material:typeof c._geometry._material=="string"?c._geometry._material:{shader:c._geometry._material._shader,shaderKeywords:c._geometry._material._shaderKeywords,collision:c._geometry._material._collision,track:c._geometry._material._track,color:c._geometry._material._color},collision:c._geometry._collision}:{type:c._geometry._type,material:typeof c._geometry._material=="string"?c._geometry._material:{shader:c._geometry._material._shader,shaderKeywords:c._geometry._material._shaderKeywords,collision:c._geometry._material._collision,track:c._geometry._material._track,color:c._geometry._material._color},collision:c._geometry._collision},track:c._track,duplicate:c._duplicate,active:c._active,scale:c._scale,position:Xi(c._position,.6),rotation:c._rotation,localPosition:Xi(c._localPosition,.6),localRotation:c._localRotation,components:d};throw new Error("Error converting environment v2 to v3")});continue}if(s==="_materials"){i.customData.materials={};for(const c in t.customData._materials)i.customData.materials[c]={shader:t.customData._materials[c]._shader,shaderKeywords:t.customData._materials[c]._shaderKeywords,collision:t.customData._materials[c]._collision,track:t.customData._materials[c]._track,color:t.customData._materials[c]._color};continue}if(s==="_pointDefinitions"){i.customData.pointDefinitions={},t.customData._pointDefinitions.forEach(c=>{i.customData.pointDefinitions[c._name]=c._points});continue}if(s==="_time"){i.customData.time=t.customData[s];continue}if(s==="_BPMChanges"){i.customData.BPMChanges=(r=t.customData[s])==null?void 0:r.map(c=>({b:c._time,m:c._BPM,p:c._beatsPerBar,o:c._metronomeOffset}));continue}if(s==="_bpmChanges"){i.customData.BPMChanges=(l=t.customData[s])==null?void 0:l.map(c=>({b:c._time,m:c._bpm,p:c._beatsPerBar,o:c._metronomeOffset}));continue}if(s==="_bookmarks"){i.customData.bookmarks=(a=t.customData._bookmarks)==null?void 0:a.map(c=>({b:c._time,n:c._name,c:c._color}));continue}i.customData[s]=t.customData[s]}if(i.customData.environment){const s=[];for(const d of i.customData.environment)d.track&&s.push(d.track);const c=[];if(i.customData.customEvents){for(const d of i.customData.customEvents)if(d.t==="AnimateTrack"){if(typeof d.d.track=="string"&&s.includes(d.d.track))c.push(d);else if(Array.isArray(d.d.track)){for(const u of d.d.track)if(s.includes(u)){c.push(d);break}}}}for(const d of c)typeof d.d.track=="string"?typeof d.d.position=="string"?K.warn(ae("V2toV3"),"Cannot convert point definitions, unknown use."):Array.isArray(d.d.position)&&(ge(d.d.position)?Xi(d.d.position,.6):d.d.position.forEach(u=>{u[0]*=.6,u[1]*=.6,u[2]*=.6})):K.warn(ae("V2toV3"),"Environment animate track array conversion not yet implemented.")}return i.useNormalEventsAsCompatibleEvents=!0,i}const ji=t=>`[load::${t}]`;async function Dm(t){const e=t.file("Info.dat")||t.file("info.dat");if(!e)throw new Error("Couldn't find Info.dat");return K.info(ji("loadInfo"),"loading info"),Ud(JSON.parse(await e.async("string")))}async function wm(t,e){var o,r,l,a;const i=[],n=t._difficultyBeatmapSets;for(let s=n.length-1;s>=0;s--){const c=n[s]._difficultyBeatmaps;if(c.length===0||!c){K.error(ji("loadDifficulty"),"Empty difficulty set, removing..."),n.splice(s,1);continue}for(let d=0;d<c.length;d++){const u=c[d],m=e.file(u._beatmapFilename);if(m){K.info(ji("loadDifficulty"),`Loading ${n[s]._beatmapCharacteristicName} ${u._difficulty}`);let h;try{h=JSON.parse(await m.async("string"))}catch(p){throw new Error(`${n[s]._beatmapCharacteristicName} ${u._difficulty} ${p}`)}try{if(h._notes&&h.version&&K.error(ji("loadDifficulty"),`${n[s]._beatmapCharacteristicName} ${u._difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`),h.version){const p=wf(h),g=Oe.create(t._beatsPerMinute,[...p.customData.BPMChanges??[],...p.bpmEvents.map(y=>y.toJSON())],(o=u._customData)==null?void 0:o._editorOffset);i.push({info:u,characteristic:n[s]._beatmapCharacteristicName,difficulty:u._difficulty,bpm:g,data:p,noteContainer:p.getNoteContainer(),eventContainer:p.getEventContainer(),swingAnalysis:Kr(p,g,n[s]._beatmapCharacteristicName,u._difficulty),rawVersion:3,rawData:h})}else{const p=Em(Kd(h),!0),g=Oe.create(t._beatsPerMinute,((r=h._customData)==null?void 0:r._BPMChanges)??((l=h._customData)==null?void 0:l._bpmChanges),(a=u._customData)==null?void 0:a._editorOffset);i.push({info:u,characteristic:n[s]._beatmapCharacteristicName,difficulty:u._difficulty,bpm:g,data:p,noteContainer:p.getNoteContainer(),eventContainer:p.getEventContainer(),swingAnalysis:Kr(p,g,n[s]._beatmapCharacteristicName,u._difficulty),rawVersion:2,rawData:h})}}catch(p){throw new Error(`${n[s]._beatmapCharacteristicName} ${u._difficulty} ${p}`)}}else if(K.error(ji("loadDifficulty"),`Missing ${u._beatmapFilename} file for ${n[s]._beatmapCharacteristicName} ${u._difficulty}, ignoring.`),n[s]._difficultyBeatmaps.splice(d,1),d--,n[s]._difficultyBeatmaps.length<1){K.error(`${n[s]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),n.splice(s,1);continue}}}return i}async function cu(t){return new Promise(function(e,i){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="json",n.timeout=5e3;let o=Date.now();n.onprogress=()=>{n.timeout+=Date.now()-o},n.onload=()=>{n.status===200&&e(n.response),n.status===404&&i("Error 404: Map does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function Sm(t){const e=`https://api.beatsaver.com/maps/id/${t}`,i=await cu(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}async function Tm(t){const e=`https://api.beatsaver.com/maps/hash/${t}`,i=await cu(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}const cn=t=>`[download::${t}]`;async function Lr(t){return new Promise(function(e,i){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.timeout=5e3;let o=Date.now();n.onprogress=r=>{n.timeout+=Date.now()-o,vt.status("download",`Downloading map: ${I(r.loaded/1024/1024,1)}MB / ${I(r.total/1024/1024,1)}MB`,r.loaded/r.total*100)},n.onload=()=>{n.status===200&&e(n.response),n.status===404&&i("Error 404: Map/link does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function uu(t){const e=Fs(t);K.info(cn("downloadFromID"),`fetching download URL from BeatSaver for map ID ${e}`),vt.status("info","Fetching download URL from BeatSaver",0);const i=await Sm(e);K.info(cn("downloadFromID"),`downloading from BeatSaver for map ID ${e}`),vt.status("info","Requesting download from BeatSaver",0);const n=await Lr(i);return Mt.setCoverLink("https://beatsaver.com/maps/"+e,e),n}async function Lm(t){const e=Ps(t);if(e.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return uu(e.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);vt.status("info","Requesting download from link",0),K.info(cn("downloadFromURL"),`downloading from ${e}`);let i=await Lr("https://cors.bsmg.dev/"+e);return Mt.setCoverLink(e),i}async function Cm(t){let e;if(Ms(t.trim()))e=t.trim();else throw new Error("invalid hash");K.info(cn("downloadFromHash"),`fetching download URL from BeatSaver for map hash ${e}`),vt.status("info","Fetching download URL from BeatSaver",0);const i=await Tm(e);return K.info(cn("downloadFromHash"),`downloading from BeatSaver for map hash ${e}`),vt.status("info","Requesting download from BeatSaver",0),await Lr(i)}var En=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Dn(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ua={},Rm={get exports(){return Ua},set exports(t){Ua=t}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(i){t.exports=i()})(function(){return function i(n,o,r){function l(c,d){if(!o[c]){if(!n[c]){var u=typeof Dn=="function"&&Dn;if(!d&&u)return u(c,!0);if(a)return a(c,!0);var m=new Error("Cannot find module '"+c+"'");throw m.code="MODULE_NOT_FOUND",m}var h=o[c]={exports:{}};n[c][0].call(h.exports,function(p){var g=n[c][1][p];return l(g||p)},h,h.exports,i,n,o,r)}return o[c].exports}for(var a=typeof Dn=="function"&&Dn,s=0;s<r.length;s++)l(r[s]);return l}({1:[function(i,n,o){var r=i("./utils"),l=i("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(s){for(var c,d,u,m,h,p,g,y=[],b=0,E=s.length,w=E,L=r.getTypeOf(s)!=="string";b<s.length;)w=E-b,u=L?(c=s[b++],d=b<E?s[b++]:0,b<E?s[b++]:0):(c=s.charCodeAt(b++),d=b<E?s.charCodeAt(b++):0,b<E?s.charCodeAt(b++):0),m=c>>2,h=(3&c)<<4|d>>4,p=1<w?(15&d)<<2|u>>6:64,g=2<w?63&u:64,y.push(a.charAt(m)+a.charAt(h)+a.charAt(p)+a.charAt(g));return y.join("")},o.decode=function(s){var c,d,u,m,h,p,g=0,y=0,b="data:";if(s.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var E,w=3*(s=s.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(s.charAt(s.length-1)===a.charAt(64)&&w--,s.charAt(s.length-2)===a.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(E=l.uint8array?new Uint8Array(0|w):new Array(0|w);g<s.length;)c=a.indexOf(s.charAt(g++))<<2|(m=a.indexOf(s.charAt(g++)))>>4,d=(15&m)<<4|(h=a.indexOf(s.charAt(g++)))>>2,u=(3&h)<<6|(p=a.indexOf(s.charAt(g++))),E[y++]=c,h!==64&&(E[y++]=d),p!==64&&(E[y++]=u);return E}},{"./support":30,"./utils":32}],2:[function(i,n,o){var r=i("./external"),l=i("./stream/DataWorker"),a=i("./stream/Crc32Probe"),s=i("./stream/DataLengthProbe");function c(d,u,m,h,p){this.compressedSize=d,this.uncompressedSize=u,this.crc32=m,this.compression=h,this.compressedContent=p}c.prototype={getContentWorker:function(){var d=new l(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),u=this;return d.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),d},getCompressedWorker:function(){return new l(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(d,u,m){return d.pipe(new a).pipe(new s("uncompressedSize")).pipe(u.compressWorker(m)).pipe(new s("compressedSize")).withStreamInfo("compression",u)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,n,o){var r=i("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},o.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,n,o){var r=i("./utils"),l=function(){for(var a,s=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;s[c]=a}return s}();n.exports=function(a,s){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(c,d,u,m){var h=l,p=m+u;c^=-1;for(var g=m;g<p;g++)c=c>>>8^h[255&(c^d[g])];return-1^c}(0|s,a,a.length,0):function(c,d,u,m){var h=l,p=m+u;c^=-1;for(var g=m;g<p;g++)c=c>>>8^h[255&(c^d.charCodeAt(g))];return-1^c}(0|s,a,a.length,0):0}},{"./utils":32}],5:[function(i,n,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(i,n,o){var r=null;r=typeof Promise<"u"?Promise:i("lie"),n.exports={Promise:r}},{lie:37}],7:[function(i,n,o){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=i("pako"),a=i("./utils"),s=i("./stream/GenericWorker"),c=r?"uint8array":"array";function d(u,m){s.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=m,this.meta={}}o.magic="\b\0",a.inherits(d,s),d.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,u.data),!1)},d.prototype.flush=function(){s.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(m){u.push({data:m,meta:u.meta})}},o.compressWorker=function(u){return new d("Deflate",u)},o.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,n,o){function r(h,p){var g,y="";for(g=0;g<p;g++)y+=String.fromCharCode(255&h),h>>>=8;return y}function l(h,p,g,y,b,E){var w,L,R=h.file,F=h.compression,M=E!==c.utf8encode,k=a.transformTo("string",E(R.name)),$=a.transformTo("string",c.utf8encode(R.name)),j=R.comment,et=a.transformTo("string",E(j)),S=a.transformTo("string",c.utf8encode(j)),O=$.length!==R.name.length,_=S.length!==j.length,z="",ot="",G="",lt=R.dir,Y=R.date,at={crc32:0,compressedSize:0,uncompressedSize:0};p&&!g||(at.crc32=h.crc32,at.compressedSize=h.compressedSize,at.uncompressedSize=h.uncompressedSize);var N=0;p&&(N|=8),M||!O&&!_||(N|=2048);var B=0,nt=0;lt&&(B|=16),b==="UNIX"?(nt=798,B|=function(J,kt){var Ot=J;return J||(Ot=kt?16893:33204),(65535&Ot)<<16}(R.unixPermissions,lt)):(nt=20,B|=function(J){return 63&(J||0)}(R.dosPermissions)),w=Y.getUTCHours(),w<<=6,w|=Y.getUTCMinutes(),w<<=5,w|=Y.getUTCSeconds()/2,L=Y.getUTCFullYear()-1980,L<<=4,L|=Y.getUTCMonth()+1,L<<=5,L|=Y.getUTCDate(),O&&(ot=r(1,1)+r(d(k),4)+$,z+="up"+r(ot.length,2)+ot),_&&(G=r(1,1)+r(d(et),4)+S,z+="uc"+r(G.length,2)+G);var q="";return q+=`
\0`,q+=r(N,2),q+=F.magic,q+=r(w,2),q+=r(L,2),q+=r(at.crc32,4),q+=r(at.compressedSize,4),q+=r(at.uncompressedSize,4),q+=r(k.length,2),q+=r(z.length,2),{fileRecord:u.LOCAL_FILE_HEADER+q+k+z,dirRecord:u.CENTRAL_FILE_HEADER+r(nt,2)+q+r(et.length,2)+"\0\0\0\0"+r(B,4)+r(y,4)+k+z+et}}var a=i("../utils"),s=i("../stream/GenericWorker"),c=i("../utf8"),d=i("../crc32"),u=i("../signature");function m(h,p,g,y){s.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=g,this.encodeFileName=y,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(m,s),m.prototype.push=function(h){var p=h.meta.percent||0,g=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,s.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:g?(p+100*(g-y-1))/g:100}}))},m.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var p=this.streamFiles&&!h.file.dir;if(p){var g=l(h,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(h){this.accumulate=!1;var p=this.streamFiles&&!h.file.dir,g=l(h,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),p)this.push({data:function(y){return u.DATA_DESCRIPTOR+r(y.crc32,4)+r(y.compressedSize,4)+r(y.uncompressedSize,4)}(h),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var h=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var g=this.bytesWritten-h,y=function(b,E,w,L,R){var F=a.transformTo("string",R(L));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(b,2)+r(b,2)+r(E,4)+r(w,4)+r(F.length,2)+F}(this.dirRecords.length,g,h,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(h){this._sources.push(h);var p=this;return h.on("data",function(g){p.processChunk(g)}),h.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),h.on("error",function(g){p.error(g)}),this},m.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(h){var p=this._sources;if(!s.prototype.error.call(this,h))return!1;for(var g=0;g<p.length;g++)try{p[g].error(h)}catch{}return!0},m.prototype.lock=function(){s.prototype.lock.call(this);for(var h=this._sources,p=0;p<h.length;p++)h[p].lock()},n.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,n,o){var r=i("../compressions"),l=i("./ZipFileWorker");o.generateWorker=function(a,s,c){var d=new l(s.streamFiles,c,s.platform,s.encodeFileName),u=0;try{a.forEach(function(m,h){u++;var p=function(E,w){var L=E||w,R=r[L];if(!R)throw new Error(L+" is not a valid compression method !");return R}(h.options.compression,s.compression),g=h.options.compressionOptions||s.compressionOptions||{},y=h.dir,b=h.date;h._compressWorker(p,g).withStreamInfo("file",{name:m,dir:y,date:b,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(d)}),d.entriesCount=u}catch(m){d.error(m)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,n,o){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new r;for(var a in this)typeof this[a]!="function"&&(l[a]=this[a]);return l}}(r.prototype=i("./object")).loadAsync=i("./load"),r.support=i("./support"),r.defaults=i("./defaults"),r.version="3.10.1",r.loadAsync=function(l,a){return new r().loadAsync(l,a)},r.external=i("./external"),n.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,n,o){var r=i("./utils"),l=i("./external"),a=i("./utf8"),s=i("./zipEntries"),c=i("./stream/Crc32Probe"),d=i("./nodejsUtils");function u(m){return new l.Promise(function(h,p){var g=m.decompressed.getContentWorker().pipe(new c);g.on("error",function(y){p(y)}).on("end",function(){g.streamInfo.crc32!==m.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}n.exports=function(m,h){var p=this;return h=r.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),d.isNode&&d.isStream(m)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",m,!0,h.optimizedBinaryString,h.base64).then(function(g){var y=new s(h);return y.load(g),y}).then(function(g){var y=[l.Promise.resolve(g)],b=g.files;if(h.checkCRC32)for(var E=0;E<b.length;E++)y.push(u(b[E]));return l.Promise.all(y)}).then(function(g){for(var y=g.shift(),b=y.files,E=0;E<b.length;E++){var w=b[E],L=w.fileNameStr,R=r.resolve(w.fileNameStr);p.file(R,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:h.createFolders}),w.dir||(p.file(R).unsafeOriginalName=L)}return y.zipComment.length&&(p.comment=y.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,n,o){var r=i("../utils"),l=i("../stream/GenericWorker");function a(s,c){l.call(this,"Nodejs stream input adapter for "+s),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(a,l),a.prototype._bindStream=function(s){var c=this;(this._stream=s).pause(),s.on("data",function(d){c.push({data:d,meta:{percent:0}})}).on("error",function(d){c.isPaused?this.generatedError=d:c.error(d)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,n,o){var r=i("readable-stream").Readable;function l(a,s,c){r.call(this,s),this._helper=a;var d=this;a.on("data",function(u,m){d.push(u)||d._helper.pause(),c&&c(m)}).on("error",function(u){d.emit("error",u)}).on("end",function(){d.push(null)})}i("../utils").inherits(l,r),l.prototype._read=function(){this._helper.resume()},n.exports=l},{"../utils":32,"readable-stream":16}],14:[function(i,n,o){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,l);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,l)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var l=new Buffer(r);return l.fill(0),l},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(i,n,o){function r(R,F,M){var k,$=a.getTypeOf(F),j=a.extend(M||{},d);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(R=b(R)),j.createFolders&&(k=y(R))&&E.call(this,k,!0);var et=$==="string"&&j.binary===!1&&j.base64===!1;M&&M.binary!==void 0||(j.binary=!et),(F instanceof u&&F.uncompressedSize===0||j.dir||!F||F.length===0)&&(j.base64=!1,j.binary=!0,F="",j.compression="STORE",$="string");var S=null;S=F instanceof u||F instanceof s?F:p.isNode&&p.isStream(F)?new g(R,F):a.prepareContent(R,F,j.binary,j.optimizedBinaryString,j.base64);var O=new m(R,S,j);this.files[R]=O}var l=i("./utf8"),a=i("./utils"),s=i("./stream/GenericWorker"),c=i("./stream/StreamHelper"),d=i("./defaults"),u=i("./compressedObject"),m=i("./zipObject"),h=i("./generate"),p=i("./nodejsUtils"),g=i("./nodejs/NodejsStreamInputAdapter"),y=function(R){R.slice(-1)==="/"&&(R=R.substring(0,R.length-1));var F=R.lastIndexOf("/");return 0<F?R.substring(0,F):""},b=function(R){return R.slice(-1)!=="/"&&(R+="/"),R},E=function(R,F){return F=F!==void 0?F:d.createFolders,R=b(R),this.files[R]||r.call(this,R,null,{dir:!0,createFolders:F}),this.files[R]};function w(R){return Object.prototype.toString.call(R)==="[object RegExp]"}var L={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(R){var F,M,k;for(F in this.files)k=this.files[F],(M=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&R(M,k)},filter:function(R){var F=[];return this.forEach(function(M,k){R(M,k)&&F.push(k)}),F},file:function(R,F,M){if(arguments.length!==1)return R=this.root+R,r.call(this,R,F,M),this;if(w(R)){var k=R;return this.filter(function(j,et){return!et.dir&&k.test(j)})}var $=this.files[this.root+R];return $&&!$.dir?$:null},folder:function(R){if(!R)return this;if(w(R))return this.filter(function($,j){return j.dir&&R.test($)});var F=this.root+R,M=E.call(this,F),k=this.clone();return k.root=M.name,k},remove:function(R){R=this.root+R;var F=this.files[R];if(F||(R.slice(-1)!=="/"&&(R+="/"),F=this.files[R]),F&&!F.dir)delete this.files[R];else for(var M=this.filter(function($,j){return j.name.slice(0,R.length)===R}),k=0;k<M.length;k++)delete this.files[M[k].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(R){var F,M={};try{if((M=a.extend(R||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=M.type.toLowerCase(),M.compression=M.compression.toUpperCase(),M.type==="binarystring"&&(M.type="string"),!M.type)throw new Error("No output type specified.");a.checkSupport(M.type),M.platform!=="darwin"&&M.platform!=="freebsd"&&M.platform!=="linux"&&M.platform!=="sunos"||(M.platform="UNIX"),M.platform==="win32"&&(M.platform="DOS");var k=M.comment||this.comment||"";F=h.generateWorker(this,M,k)}catch($){(F=new s("error")).error($)}return new c(F,M.type||"string",M.mimeType)},generateAsync:function(R,F){return this.generateInternalStream(R).accumulate(F)},generateNodeStream:function(R,F){return(R=R||{}).type||(R.type="nodebuffer"),this.generateInternalStream(R).toNodejsStream(F)}};n.exports=L},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,n,o){n.exports=i("stream")},{stream:void 0}],17:[function(i,n,o){var r=i("./DataReader");function l(a){r.call(this,a);for(var s=0;s<this.data.length;s++)a[s]=255&a[s]}i("../utils").inherits(l,r),l.prototype.byteAt=function(a){return this.data[this.zero+a]},l.prototype.lastIndexOfSignature=function(a){for(var s=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),u=a.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===s&&this.data[m+1]===c&&this.data[m+2]===d&&this.data[m+3]===u)return m-this.zero;return-1},l.prototype.readAndCheckSignature=function(a){var s=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),u=a.charCodeAt(3),m=this.readData(4);return s===m[0]&&c===m[1]&&d===m[2]&&u===m[3]},l.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var s=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,s},n.exports=l},{"../utils":32,"./DataReader":18}],18:[function(i,n,o){var r=i("../utils");function l(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var s,c=0;for(this.checkOffset(a),s=this.index+a-1;s>=this.index;s--)c=(c<<8)+this.byteAt(s);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=l},{"../utils":32}],19:[function(i,n,o){var r=i("./Uint8ArrayReader");function l(a){r.call(this,a)}i("../utils").inherits(l,r),l.prototype.readData=function(a){this.checkOffset(a);var s=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,s},n.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,n,o){var r=i("./DataReader");function l(a){r.call(this,a)}i("../utils").inherits(l,r),l.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},l.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},l.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},l.prototype.readData=function(a){this.checkOffset(a);var s=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,s},n.exports=l},{"../utils":32,"./DataReader":18}],21:[function(i,n,o){var r=i("./ArrayReader");function l(a){r.call(this,a)}i("../utils").inherits(l,r),l.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var s=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,s},n.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(i,n,o){var r=i("../utils"),l=i("../support"),a=i("./ArrayReader"),s=i("./StringReader"),c=i("./NodeBufferReader"),d=i("./Uint8ArrayReader");n.exports=function(u){var m=r.getTypeOf(u);return r.checkSupport(m),m!=="string"||l.uint8array?m==="nodebuffer"?new c(u):l.uint8array?new d(r.transformTo("uint8array",u)):new a(r.transformTo("array",u)):new s(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,n,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,n,o){var r=i("./GenericWorker"),l=i("../utils");function a(s){r.call(this,"ConvertWorker to "+s),this.destType=s}l.inherits(a,r),a.prototype.processChunk=function(s){this.push({data:l.transformTo(this.destType,s.data),meta:s.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(i,n,o){var r=i("./GenericWorker"),l=i("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}i("../utils").inherits(a,r),a.prototype.processChunk=function(s){this.streamInfo.crc32=l(s.data,this.streamInfo.crc32||0),this.push(s)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,n,o){var r=i("../utils"),l=i("./GenericWorker");function a(s){l.call(this,"DataLengthProbe for "+s),this.propName=s,this.withStreamInfo(s,0)}r.inherits(a,l),a.prototype.processChunk=function(s){if(s){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+s.data.length}l.prototype.processChunk.call(this,s)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(i,n,o){var r=i("../utils"),l=i("./GenericWorker");function a(s){l.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,s.then(function(d){c.dataIsReady=!0,c.data=d,c.max=d&&d.length||0,c.type=r.getTypeOf(d),c.isPaused||c._tickAndRepeat()},function(d){c.error(d)})}r.inherits(a,l),a.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var s=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":s=this.data.substring(this.index,c);break;case"uint8array":s=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":s=this.data.slice(this.index,c)}return this.index=c,this.push({data:s,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(i,n,o){function r(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,a){return this._listeners[l].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,a){if(this._listeners[l])for(var s=0;s<this._listeners[l].length;s++)this._listeners[l][s].call(this,a)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var a=this;return l.on("data",function(s){a.processChunk(s)}),l.on("end",function(){a.end()}),l.on("error",function(s){a.error(s)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,a){return this.extraStreamInfo[l]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},n.exports=r},{}],29:[function(i,n,o){var r=i("../utils"),l=i("./ConvertWorker"),a=i("./GenericWorker"),s=i("../base64"),c=i("../support"),d=i("../external"),u=null;if(c.nodestream)try{u=i("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(p,g){return new d.Promise(function(y,b){var E=[],w=p._internalType,L=p._outputType,R=p._mimeType;p.on("data",function(F,M){E.push(F),g&&g(M)}).on("error",function(F){E=[],b(F)}).on("end",function(){try{var F=function(M,k,$){switch(M){case"blob":return r.newBlob(r.transformTo("arraybuffer",k),$);case"base64":return s.encode(k);default:return r.transformTo(M,k)}}(L,function(M,k){var $,j=0,et=null,S=0;for($=0;$<k.length;$++)S+=k[$].length;switch(M){case"string":return k.join("");case"array":return Array.prototype.concat.apply([],k);case"uint8array":for(et=new Uint8Array(S),$=0;$<k.length;$++)et.set(k[$],j),j+=k[$].length;return et;case"nodebuffer":return Buffer.concat(k);default:throw new Error("concat : unsupported type '"+M+"'")}}(w,E),R);y(F)}catch(M){b(M)}E=[]}).resume()})}function h(p,g,y){var b=g;switch(g){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=g,this._mimeType=y,r.checkSupport(b),this._worker=p.pipe(new l(b)),p.lock()}catch(E){this._worker=new a("error"),this._worker.error(E)}}h.prototype={accumulate:function(p){return m(this,p)},on:function(p,g){var y=this;return p==="data"?this._worker.on(p,function(b){g.call(y,b.data,b.meta)}):this._worker.on(p,function(){r.delay(g,arguments,y)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},p)}},n.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,n,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var r=new ArrayBuffer(0);try{o.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(r),o.blob=l.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!i("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(i,n,o){for(var r=i("./utils"),l=i("./support"),a=i("./nodejsUtils"),s=i("./stream/GenericWorker"),c=new Array(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;c[254]=c[254]=1;function u(){s.call(this,"utf-8 decode"),this.leftOver=null}function m(){s.call(this,"utf-8 encode")}o.utf8encode=function(h){return l.nodebuffer?a.newBufferFrom(h,"utf-8"):function(p){var g,y,b,E,w,L=p.length,R=0;for(E=0;E<L;E++)(64512&(y=p.charCodeAt(E)))==55296&&E+1<L&&(64512&(b=p.charCodeAt(E+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),E++),R+=y<128?1:y<2048?2:y<65536?3:4;for(g=l.uint8array?new Uint8Array(R):new Array(R),E=w=0;w<R;E++)(64512&(y=p.charCodeAt(E)))==55296&&E+1<L&&(64512&(b=p.charCodeAt(E+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),E++),y<128?g[w++]=y:(y<2048?g[w++]=192|y>>>6:(y<65536?g[w++]=224|y>>>12:(g[w++]=240|y>>>18,g[w++]=128|y>>>12&63),g[w++]=128|y>>>6&63),g[w++]=128|63&y);return g}(h)},o.utf8decode=function(h){return l.nodebuffer?r.transformTo("nodebuffer",h).toString("utf-8"):function(p){var g,y,b,E,w=p.length,L=new Array(2*w);for(g=y=0;g<w;)if((b=p[g++])<128)L[y++]=b;else if(4<(E=c[b]))L[y++]=65533,g+=E-1;else{for(b&=E===2?31:E===3?15:7;1<E&&g<w;)b=b<<6|63&p[g++],E--;1<E?L[y++]=65533:b<65536?L[y++]=b:(b-=65536,L[y++]=55296|b>>10&1023,L[y++]=56320|1023&b)}return L.length!==y&&(L.subarray?L=L.subarray(0,y):L.length=y),r.applyFromCharCode(L)}(h=r.transformTo(l.uint8array?"uint8array":"array",h))},r.inherits(u,s),u.prototype.processChunk=function(h){var p=r.transformTo(l.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var g=p;(p=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),p.set(g,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var y=function(E,w){var L;for((w=w||E.length)>E.length&&(w=E.length),L=w-1;0<=L&&(192&E[L])==128;)L--;return L<0||L===0?w:L+c[E[L]]>w?L:w}(p),b=p;y!==p.length&&(l.uint8array?(b=p.subarray(0,y),this.leftOver=p.subarray(y,p.length)):(b=p.slice(0,y),this.leftOver=p.slice(y,p.length))),this.push({data:o.utf8decode(b),meta:h.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=u,r.inherits(m,s),m.prototype.processChunk=function(h){this.push({data:o.utf8encode(h.data),meta:h.meta})},o.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,n,o){var r=i("./support"),l=i("./base64"),a=i("./nodejsUtils"),s=i("./external");function c(g){return g}function d(g,y){for(var b=0;b<g.length;++b)y[b]=255&g.charCodeAt(b);return y}i("setimmediate"),o.newBlob=function(g,y){o.checkSupport("blob");try{return new Blob([g],{type:y})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(g),b.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(g,y,b){var E=[],w=0,L=g.length;if(L<=b)return String.fromCharCode.apply(null,g);for(;w<L;)y==="array"||y==="nodebuffer"?E.push(String.fromCharCode.apply(null,g.slice(w,Math.min(w+b,L)))):E.push(String.fromCharCode.apply(null,g.subarray(w,Math.min(w+b,L)))),w+=b;return E.join("")},stringifyByChar:function(g){for(var y="",b=0;b<g.length;b++)y+=String.fromCharCode(g[b]);return y},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function m(g){var y=65536,b=o.getTypeOf(g),E=!0;if(b==="uint8array"?E=u.applyCanBeUsed.uint8array:b==="nodebuffer"&&(E=u.applyCanBeUsed.nodebuffer),E)for(;1<y;)try{return u.stringifyByChunk(g,b,y)}catch{y=Math.floor(y/2)}return u.stringifyByChar(g)}function h(g,y){for(var b=0;b<g.length;b++)y[b]=g[b];return y}o.applyFromCharCode=m;var p={};p.string={string:c,array:function(g){return d(g,new Array(g.length))},arraybuffer:function(g){return p.string.uint8array(g).buffer},uint8array:function(g){return d(g,new Uint8Array(g.length))},nodebuffer:function(g){return d(g,a.allocBuffer(g.length))}},p.array={string:m,array:c,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(g)}},p.arraybuffer={string:function(g){return m(new Uint8Array(g))},array:function(g){return h(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:c,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return a.newBufferFrom(new Uint8Array(g))}},p.uint8array={string:m,array:function(g){return h(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:c,nodebuffer:function(g){return a.newBufferFrom(g)}},p.nodebuffer={string:m,array:function(g){return h(g,new Array(g.length))},arraybuffer:function(g){return p.nodebuffer.uint8array(g).buffer},uint8array:function(g){return h(g,new Uint8Array(g.length))},nodebuffer:c},o.transformTo=function(g,y){if(y=y||"",!g)return y;o.checkSupport(g);var b=o.getTypeOf(y);return p[b][g](y)},o.resolve=function(g){for(var y=g.split("/"),b=[],E=0;E<y.length;E++){var w=y[E];w==="."||w===""&&E!==0&&E!==y.length-1||(w===".."?b.pop():b.push(w))}return b.join("/")},o.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(g)?"nodebuffer":r.uint8array&&g instanceof Uint8Array?"uint8array":r.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(g){if(!r[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(g){var y,b,E="";for(b=0;b<(g||"").length;b++)E+="\\x"+((y=g.charCodeAt(b))<16?"0":"")+y.toString(16).toUpperCase();return E},o.delay=function(g,y,b){setImmediate(function(){g.apply(b||null,y||[])})},o.inherits=function(g,y){function b(){}b.prototype=y.prototype,g.prototype=new b},o.extend=function(){var g,y,b={};for(g=0;g<arguments.length;g++)for(y in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],y)&&b[y]===void 0&&(b[y]=arguments[g][y]);return b},o.prepareContent=function(g,y,b,E,w){return s.Promise.resolve(y).then(function(L){return r.blob&&(L instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(L))!==-1)&&typeof FileReader<"u"?new s.Promise(function(R,F){var M=new FileReader;M.onload=function(k){R(k.target.result)},M.onerror=function(k){F(k.target.error)},M.readAsArrayBuffer(L)}):L}).then(function(L){var R=o.getTypeOf(L);return R?(R==="arraybuffer"?L=o.transformTo("uint8array",L):R==="string"&&(w?L=l.decode(L):b&&E!==!0&&(L=function(F){return d(F,r.uint8array?new Uint8Array(F.length):new Array(F.length))}(L))),L):s.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,n,o){var r=i("./reader/readerFor"),l=i("./utils"),a=i("./signature"),s=i("./zipEntry"),c=i("./support");function d(u){this.files=[],this.loadOptions=u}d.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(m)+", expected "+l.pretty(u)+")")}},isSignature:function(u,m){var h=this.reader.index;this.reader.setIndex(u);var p=this.reader.readString(4)===m;return this.reader.setIndex(h),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),m=c.uint8array?"uint8array":"array",h=l.transformTo(m,u);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,m,h,p=this.zip64EndOfCentralSize-44;0<p;)u=this.reader.readInt(2),m=this.reader.readInt(4),h=this.reader.readData(m),this.zip64ExtensibleData[u]={id:u,length:m,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,m;for(u=0;u<this.files.length;u++)m=this.files[u],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(u=new s({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var m=u;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var p=m-h;if(0<p)this.isSignature(m,a.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(u){this.reader=r(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(i,n,o){var r=i("./reader/readerFor"),l=i("./utils"),a=i("./compressedObject"),s=i("./crc32"),c=i("./utf8"),d=i("./compressions"),u=i("./support");function m(h,p){this.options=h,this.loadOptions=p}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var p,g;if(h.skip(22),this.fileNameLength=h.readInt(2),g=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(y){for(var b in d)if(Object.prototype.hasOwnProperty.call(d,b)&&d[b].magic===y)return d[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,p,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var p=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(p),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=r(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var p,g,y,b=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<b;)p=h.readInt(2),g=h.readInt(2),y=h.readData(g),this.extraFields[p]={id:p,length:g,value:y};h.setIndex(b)},handleUTF8:function(){var h=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var g=l.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var b=l.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var p=r(h.value);return p.readInt(1)!==1||s(this.fileName)!==p.readInt(4)?null:c.utf8decode(p.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var p=r(h.value);return p.readInt(1)!==1||s(this.fileComment)!==p.readInt(4)?null:c.utf8decode(p.readData(h.length-5))}return null}},n.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,n,o){function r(p,g,y){this.name=p,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=g,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var l=i("./stream/StreamHelper"),a=i("./stream/DataWorker"),s=i("./utf8"),c=i("./compressedObject"),d=i("./stream/GenericWorker");r.prototype={internalStream:function(p){var g=null,y="string";try{if(!p)throw new Error("No output type specified.");var b=(y=p.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),g=this._decompressWorker();var E=!this._dataBinary;E&&!b&&(g=g.pipe(new s.Utf8EncodeWorker)),!E&&b&&(g=g.pipe(new s.Utf8DecodeWorker))}catch(w){(g=new d("error")).error(w)}return new l(g,y,"")},async:function(p,g){return this.internalStream(p).accumulate(g)},nodeStream:function(p,g){return this.internalStream(p||"nodebuffer").toNodejsStream(g)},_compressWorker:function(p,g){if(this._data instanceof c&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new s.Utf8EncodeWorker)),c.createWorkerFrom(y,p,g)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof d?this._data:new a(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<u.length;h++)r.prototype[u[h]]=m;n.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,n,o){(function(r){var l,a,s=r.MutationObserver||r.WebKitMutationObserver;if(s){var c=0,d=new s(p),u=r.document.createTextNode("");d.observe(u,{characterData:!0}),l=function(){u.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)l="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var g=r.document.createElement("script");g.onreadystatechange=function(){p(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},r.document.documentElement.appendChild(g)}:function(){setTimeout(p,0)};else{var m=new r.MessageChannel;m.port1.onmessage=p,l=function(){m.port2.postMessage(0)}}var h=[];function p(){var g,y;a=!0;for(var b=h.length;b;){for(y=h,h=[],g=-1;++g<b;)y[g]();b=h.length}a=!1}n.exports=function(g){h.push(g)!==1||a||l()}}).call(this,typeof En<"u"?En:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(i,n,o){var r=i("immediate");function l(){}var a={},s=["REJECTED"],c=["FULFILLED"],d=["PENDING"];function u(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,b!==l&&g(this,b)}function m(b,E,w){this.promise=b,typeof E=="function"&&(this.onFulfilled=E,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function h(b,E,w){r(function(){var L;try{L=E(w)}catch(R){return a.reject(b,R)}L===b?a.reject(b,new TypeError("Cannot resolve promise with itself")):a.resolve(b,L)})}function p(b){var E=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof E=="function")return function(){E.apply(b,arguments)}}function g(b,E){var w=!1;function L(M){w||(w=!0,a.reject(b,M))}function R(M){w||(w=!0,a.resolve(b,M))}var F=y(function(){E(R,L)});F.status==="error"&&L(F.value)}function y(b,E){var w={};try{w.value=b(E),w.status="success"}catch(L){w.status="error",w.value=L}return w}(n.exports=u).prototype.finally=function(b){if(typeof b!="function")return this;var E=this.constructor;return this.then(function(w){return E.resolve(b()).then(function(){return w})},function(w){return E.resolve(b()).then(function(){throw w})})},u.prototype.catch=function(b){return this.then(null,b)},u.prototype.then=function(b,E){if(typeof b!="function"&&this.state===c||typeof E!="function"&&this.state===s)return this;var w=new this.constructor(l);return this.state!==d?h(w,this.state===c?b:E,this.outcome):this.queue.push(new m(w,b,E)),w},m.prototype.callFulfilled=function(b){a.resolve(this.promise,b)},m.prototype.otherCallFulfilled=function(b){h(this.promise,this.onFulfilled,b)},m.prototype.callRejected=function(b){a.reject(this.promise,b)},m.prototype.otherCallRejected=function(b){h(this.promise,this.onRejected,b)},a.resolve=function(b,E){var w=y(p,E);if(w.status==="error")return a.reject(b,w.value);var L=w.value;if(L)g(b,L);else{b.state=c,b.outcome=E;for(var R=-1,F=b.queue.length;++R<F;)b.queue[R].callFulfilled(E)}return b},a.reject=function(b,E){b.state=s,b.outcome=E;for(var w=-1,L=b.queue.length;++w<L;)b.queue[w].callRejected(E);return b},u.resolve=function(b){return b instanceof this?b:a.resolve(new this(l),b)},u.reject=function(b){var E=new this(l);return a.reject(E,b)},u.all=function(b){var E=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=b.length,L=!1;if(!w)return this.resolve([]);for(var R=new Array(w),F=0,M=-1,k=new this(l);++M<w;)$(b[M],M);return k;function $(j,et){E.resolve(j).then(function(S){R[et]=S,++F!==w||L||(L=!0,a.resolve(k,R))},function(S){L||(L=!0,a.reject(k,S))})}},u.race=function(b){var E=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=b.length,L=!1;if(!w)return this.resolve([]);for(var R=-1,F=new this(l);++R<w;)M=b[R],E.resolve(M).then(function(k){L||(L=!0,a.resolve(F,k))},function(k){L||(L=!0,a.reject(F,k))});var M;return F}},{immediate:36}],38:[function(i,n,o){var r={};(0,i("./lib/utils/common").assign)(r,i("./lib/deflate"),i("./lib/inflate"),i("./lib/zlib/constants")),n.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,n,o){var r=i("./zlib/deflate"),l=i("./utils/common"),a=i("./utils/strings"),s=i("./zlib/messages"),c=i("./zlib/zstream"),d=Object.prototype.toString,u=0,m=-1,h=0,p=8;function g(b){if(!(this instanceof g))return new g(b);this.options=l.assign({level:m,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},b||{});var E=this.options;E.raw&&0<E.windowBits?E.windowBits=-E.windowBits:E.gzip&&0<E.windowBits&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var w=r.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(w!==u)throw new Error(s[w]);if(E.header&&r.deflateSetHeader(this.strm,E.header),E.dictionary){var L;if(L=typeof E.dictionary=="string"?a.string2buf(E.dictionary):d.call(E.dictionary)==="[object ArrayBuffer]"?new Uint8Array(E.dictionary):E.dictionary,(w=r.deflateSetDictionary(this.strm,L))!==u)throw new Error(s[w]);this._dict_set=!0}}function y(b,E){var w=new g(E);if(w.push(b,!0),w.err)throw w.msg||s[w.err];return w.result}g.prototype.push=function(b,E){var w,L,R=this.strm,F=this.options.chunkSize;if(this.ended)return!1;L=E===~~E?E:E===!0?4:0,typeof b=="string"?R.input=a.string2buf(b):d.call(b)==="[object ArrayBuffer]"?R.input=new Uint8Array(b):R.input=b,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new l.Buf8(F),R.next_out=0,R.avail_out=F),(w=r.deflate(R,L))!==1&&w!==u)return this.onEnd(w),!(this.ended=!0);R.avail_out!==0&&(R.avail_in!==0||L!==4&&L!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(l.shrinkBuf(R.output,R.next_out))):this.onData(l.shrinkBuf(R.output,R.next_out)))}while((0<R.avail_in||R.avail_out===0)&&w!==1);return L===4?(w=r.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===u):L!==2||(this.onEnd(u),!(R.avail_out=0))},g.prototype.onData=function(b){this.chunks.push(b)},g.prototype.onEnd=function(b){b===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},o.Deflate=g,o.deflate=y,o.deflateRaw=function(b,E){return(E=E||{}).raw=!0,y(b,E)},o.gzip=function(b,E){return(E=E||{}).gzip=!0,y(b,E)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,n,o){var r=i("./zlib/inflate"),l=i("./utils/common"),a=i("./utils/strings"),s=i("./zlib/constants"),c=i("./zlib/messages"),d=i("./zlib/zstream"),u=i("./zlib/gzheader"),m=Object.prototype.toString;function h(g){if(!(this instanceof h))return new h(g);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},g||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||g&&g.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var b=r.inflateInit2(this.strm,y.windowBits);if(b!==s.Z_OK)throw new Error(c[b]);this.header=new u,r.inflateGetHeader(this.strm,this.header)}function p(g,y){var b=new h(y);if(b.push(g,!0),b.err)throw b.msg||c[b.err];return b.result}h.prototype.push=function(g,y){var b,E,w,L,R,F,M=this.strm,k=this.options.chunkSize,$=this.options.dictionary,j=!1;if(this.ended)return!1;E=y===~~y?y:y===!0?s.Z_FINISH:s.Z_NO_FLUSH,typeof g=="string"?M.input=a.binstring2buf(g):m.call(g)==="[object ArrayBuffer]"?M.input=new Uint8Array(g):M.input=g,M.next_in=0,M.avail_in=M.input.length;do{if(M.avail_out===0&&(M.output=new l.Buf8(k),M.next_out=0,M.avail_out=k),(b=r.inflate(M,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&$&&(F=typeof $=="string"?a.string2buf($):m.call($)==="[object ArrayBuffer]"?new Uint8Array($):$,b=r.inflateSetDictionary(this.strm,F)),b===s.Z_BUF_ERROR&&j===!0&&(b=s.Z_OK,j=!1),b!==s.Z_STREAM_END&&b!==s.Z_OK)return this.onEnd(b),!(this.ended=!0);M.next_out&&(M.avail_out!==0&&b!==s.Z_STREAM_END&&(M.avail_in!==0||E!==s.Z_FINISH&&E!==s.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=a.utf8border(M.output,M.next_out),L=M.next_out-w,R=a.buf2string(M.output,w),M.next_out=L,M.avail_out=k-L,L&&l.arraySet(M.output,M.output,w,L,0),this.onData(R)):this.onData(l.shrinkBuf(M.output,M.next_out)))),M.avail_in===0&&M.avail_out===0&&(j=!0)}while((0<M.avail_in||M.avail_out===0)&&b!==s.Z_STREAM_END);return b===s.Z_STREAM_END&&(E=s.Z_FINISH),E===s.Z_FINISH?(b=r.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===s.Z_OK):E!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),!(M.avail_out=0))},h.prototype.onData=function(g){this.chunks.push(g)},h.prototype.onEnd=function(g){g===s.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},o.Inflate=h,o.inflate=p,o.inflateRaw=function(g,y){return(y=y||{}).raw=!0,p(g,y)},o.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,n,o){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(s){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var d=c.shift();if(d){if(typeof d!="object")throw new TypeError(d+"must be non-object");for(var u in d)d.hasOwnProperty(u)&&(s[u]=d[u])}}return s},o.shrinkBuf=function(s,c){return s.length===c?s:s.subarray?s.subarray(0,c):(s.length=c,s)};var l={arraySet:function(s,c,d,u,m){if(c.subarray&&s.subarray)s.set(c.subarray(d,d+u),m);else for(var h=0;h<u;h++)s[m+h]=c[d+h]},flattenChunks:function(s){var c,d,u,m,h,p;for(c=u=0,d=s.length;c<d;c++)u+=s[c].length;for(p=new Uint8Array(u),c=m=0,d=s.length;c<d;c++)h=s[c],p.set(h,m),m+=h.length;return p}},a={arraySet:function(s,c,d,u,m){for(var h=0;h<u;h++)s[m+h]=c[d+h]},flattenChunks:function(s){return[].concat.apply([],s)}};o.setTyped=function(s){s?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,l)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(r)},{}],42:[function(i,n,o){var r=i("./common"),l=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var s=new r.Buf8(256),c=0;c<256;c++)s[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function d(u,m){if(m<65537&&(u.subarray&&a||!u.subarray&&l))return String.fromCharCode.apply(null,r.shrinkBuf(u,m));for(var h="",p=0;p<m;p++)h+=String.fromCharCode(u[p]);return h}s[254]=s[254]=1,o.string2buf=function(u){var m,h,p,g,y,b=u.length,E=0;for(g=0;g<b;g++)(64512&(h=u.charCodeAt(g)))==55296&&g+1<b&&(64512&(p=u.charCodeAt(g+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),g++),E+=h<128?1:h<2048?2:h<65536?3:4;for(m=new r.Buf8(E),g=y=0;y<E;g++)(64512&(h=u.charCodeAt(g)))==55296&&g+1<b&&(64512&(p=u.charCodeAt(g+1)))==56320&&(h=65536+(h-55296<<10)+(p-56320),g++),h<128?m[y++]=h:(h<2048?m[y++]=192|h>>>6:(h<65536?m[y++]=224|h>>>12:(m[y++]=240|h>>>18,m[y++]=128|h>>>12&63),m[y++]=128|h>>>6&63),m[y++]=128|63&h);return m},o.buf2binstring=function(u){return d(u,u.length)},o.binstring2buf=function(u){for(var m=new r.Buf8(u.length),h=0,p=m.length;h<p;h++)m[h]=u.charCodeAt(h);return m},o.buf2string=function(u,m){var h,p,g,y,b=m||u.length,E=new Array(2*b);for(h=p=0;h<b;)if((g=u[h++])<128)E[p++]=g;else if(4<(y=s[g]))E[p++]=65533,h+=y-1;else{for(g&=y===2?31:y===3?15:7;1<y&&h<b;)g=g<<6|63&u[h++],y--;1<y?E[p++]=65533:g<65536?E[p++]=g:(g-=65536,E[p++]=55296|g>>10&1023,E[p++]=56320|1023&g)}return d(E,p)},o.utf8border=function(u,m){var h;for((m=m||u.length)>u.length&&(m=u.length),h=m-1;0<=h&&(192&u[h])==128;)h--;return h<0||h===0?m:h+s[u[h]]>m?h:m}},{"./common":41}],43:[function(i,n,o){n.exports=function(r,l,a,s){for(var c=65535&r|0,d=r>>>16&65535|0,u=0;a!==0;){for(a-=u=2e3<a?2e3:a;d=d+(c=c+l[s++]|0)|0,--u;);c%=65521,d%=65521}return c|d<<16|0}},{}],44:[function(i,n,o){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,n,o){var r=function(){for(var l,a=[],s=0;s<256;s++){l=s;for(var c=0;c<8;c++)l=1&l?3988292384^l>>>1:l>>>1;a[s]=l}return a}();n.exports=function(l,a,s,c){var d=r,u=c+s;l^=-1;for(var m=c;m<u;m++)l=l>>>8^d[255&(l^a[m])];return-1^l}},{}],46:[function(i,n,o){var r,l=i("../utils/common"),a=i("./trees"),s=i("./adler32"),c=i("./crc32"),d=i("./messages"),u=0,m=4,h=0,p=-2,g=-1,y=4,b=2,E=8,w=9,L=286,R=30,F=19,M=2*L+1,k=15,$=3,j=258,et=j+$+1,S=42,O=113,_=1,z=2,ot=3,G=4;function lt(f,P){return f.msg=d[P],P}function Y(f){return(f<<1)-(4<f?9:0)}function at(f){for(var P=f.length;0<=--P;)f[P]=0}function N(f){var P=f.state,A=P.pending;A>f.avail_out&&(A=f.avail_out),A!==0&&(l.arraySet(f.output,P.pending_buf,P.pending_out,A,f.next_out),f.next_out+=A,P.pending_out+=A,f.total_out+=A,f.avail_out-=A,P.pending-=A,P.pending===0&&(P.pending_out=0))}function B(f,P){a._tr_flush_block(f,0<=f.block_start?f.block_start:-1,f.strstart-f.block_start,P),f.block_start=f.strstart,N(f.strm)}function nt(f,P){f.pending_buf[f.pending++]=P}function q(f,P){f.pending_buf[f.pending++]=P>>>8&255,f.pending_buf[f.pending++]=255&P}function J(f,P){var A,D,v=f.max_chain_length,T=f.strstart,X=f.prev_length,U=f.nice_match,x=f.strstart>f.w_size-et?f.strstart-(f.w_size-et):0,W=f.window,Z=f.w_mask,V=f.prev,it=f.strstart+j,wt=W[T+X-1],mt=W[T+X];f.prev_length>=f.good_match&&(v>>=2),U>f.lookahead&&(U=f.lookahead);do if(W[(A=P)+X]===mt&&W[A+X-1]===wt&&W[A]===W[T]&&W[++A]===W[T+1]){T+=2,A++;do;while(W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&W[++T]===W[++A]&&T<it);if(D=j-(it-T),T=it-j,X<D){if(f.match_start=P,U<=(X=D))break;wt=W[T+X-1],mt=W[T+X]}}while((P=V[P&Z])>x&&--v!=0);return X<=f.lookahead?X:f.lookahead}function kt(f){var P,A,D,v,T,X,U,x,W,Z,V=f.w_size;do{if(v=f.window_size-f.lookahead-f.strstart,f.strstart>=V+(V-et)){for(l.arraySet(f.window,f.window,V,V,0),f.match_start-=V,f.strstart-=V,f.block_start-=V,P=A=f.hash_size;D=f.head[--P],f.head[P]=V<=D?D-V:0,--A;);for(P=A=V;D=f.prev[--P],f.prev[P]=V<=D?D-V:0,--A;);v+=V}if(f.strm.avail_in===0)break;if(X=f.strm,U=f.window,x=f.strstart+f.lookahead,W=v,Z=void 0,Z=X.avail_in,W<Z&&(Z=W),A=Z===0?0:(X.avail_in-=Z,l.arraySet(U,X.input,X.next_in,Z,x),X.state.wrap===1?X.adler=s(X.adler,U,Z,x):X.state.wrap===2&&(X.adler=c(X.adler,U,Z,x)),X.next_in+=Z,X.total_in+=Z,Z),f.lookahead+=A,f.lookahead+f.insert>=$)for(T=f.strstart-f.insert,f.ins_h=f.window[T],f.ins_h=(f.ins_h<<f.hash_shift^f.window[T+1])&f.hash_mask;f.insert&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[T+$-1])&f.hash_mask,f.prev[T&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=T,T++,f.insert--,!(f.lookahead+f.insert<$)););}while(f.lookahead<et&&f.strm.avail_in!==0)}function Ot(f,P){for(var A,D;;){if(f.lookahead<et){if(kt(f),f.lookahead<et&&P===u)return _;if(f.lookahead===0)break}if(A=0,f.lookahead>=$&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,A=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),A!==0&&f.strstart-A<=f.w_size-et&&(f.match_length=J(f,A)),f.match_length>=$)if(D=a._tr_tally(f,f.strstart-f.match_start,f.match_length-$),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=$){for(f.match_length--;f.strstart++,f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,A=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart,--f.match_length!=0;);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+1])&f.hash_mask;else D=a._tr_tally(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(D&&(B(f,!1),f.strm.avail_out===0))return _}return f.insert=f.strstart<$-1?f.strstart:$-1,P===m?(B(f,!0),f.strm.avail_out===0?ot:G):f.last_lit&&(B(f,!1),f.strm.avail_out===0)?_:z}function ft(f,P){for(var A,D,v;;){if(f.lookahead<et){if(kt(f),f.lookahead<et&&P===u)return _;if(f.lookahead===0)break}if(A=0,f.lookahead>=$&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,A=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=$-1,A!==0&&f.prev_length<f.max_lazy_match&&f.strstart-A<=f.w_size-et&&(f.match_length=J(f,A),f.match_length<=5&&(f.strategy===1||f.match_length===$&&4096<f.strstart-f.match_start)&&(f.match_length=$-1)),f.prev_length>=$&&f.match_length<=f.prev_length){for(v=f.strstart+f.lookahead-$,D=a._tr_tally(f,f.strstart-1-f.prev_match,f.prev_length-$),f.lookahead-=f.prev_length-1,f.prev_length-=2;++f.strstart<=v&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+$-1])&f.hash_mask,A=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),--f.prev_length!=0;);if(f.match_available=0,f.match_length=$-1,f.strstart++,D&&(B(f,!1),f.strm.avail_out===0))return _}else if(f.match_available){if((D=a._tr_tally(f,0,f.window[f.strstart-1]))&&B(f,!1),f.strstart++,f.lookahead--,f.strm.avail_out===0)return _}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(D=a._tr_tally(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<$-1?f.strstart:$-1,P===m?(B(f,!0),f.strm.avail_out===0?ot:G):f.last_lit&&(B(f,!1),f.strm.avail_out===0)?_:z}function bt(f,P,A,D,v){this.good_length=f,this.max_lazy=P,this.nice_length=A,this.max_chain=D,this.func=v}function $t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*M),this.dyn_dtree=new l.Buf16(2*(2*R+1)),this.bl_tree=new l.Buf16(2*(2*F+1)),at(this.dyn_ltree),at(this.dyn_dtree),at(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(k+1),this.heap=new l.Buf16(2*L+1),at(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*L+1),at(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function xt(f){var P;return f&&f.state?(f.total_in=f.total_out=0,f.data_type=b,(P=f.state).pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?S:O,f.adler=P.wrap===2?0:1,P.last_flush=u,a._tr_init(P),h):lt(f,p)}function ye(f){var P=xt(f);return P===h&&function(A){A.window_size=2*A.w_size,at(A.head),A.max_lazy_match=r[A.level].max_lazy,A.good_match=r[A.level].good_length,A.nice_match=r[A.level].nice_length,A.max_chain_length=r[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=$-1,A.match_available=0,A.ins_h=0}(f.state),P}function ne(f,P,A,D,v,T){if(!f)return p;var X=1;if(P===g&&(P=6),D<0?(X=0,D=-D):15<D&&(X=2,D-=16),v<1||w<v||A!==E||D<8||15<D||P<0||9<P||T<0||y<T)return lt(f,p);D===8&&(D=9);var U=new $t;return(f.state=U).strm=f,U.wrap=X,U.gzhead=null,U.w_bits=D,U.w_size=1<<U.w_bits,U.w_mask=U.w_size-1,U.hash_bits=v+7,U.hash_size=1<<U.hash_bits,U.hash_mask=U.hash_size-1,U.hash_shift=~~((U.hash_bits+$-1)/$),U.window=new l.Buf8(2*U.w_size),U.head=new l.Buf16(U.hash_size),U.prev=new l.Buf16(U.w_size),U.lit_bufsize=1<<v+6,U.pending_buf_size=4*U.lit_bufsize,U.pending_buf=new l.Buf8(U.pending_buf_size),U.d_buf=1*U.lit_bufsize,U.l_buf=3*U.lit_bufsize,U.level=P,U.strategy=T,U.method=A,ye(f)}r=[new bt(0,0,0,0,function(f,P){var A=65535;for(A>f.pending_buf_size-5&&(A=f.pending_buf_size-5);;){if(f.lookahead<=1){if(kt(f),f.lookahead===0&&P===u)return _;if(f.lookahead===0)break}f.strstart+=f.lookahead,f.lookahead=0;var D=f.block_start+A;if((f.strstart===0||f.strstart>=D)&&(f.lookahead=f.strstart-D,f.strstart=D,B(f,!1),f.strm.avail_out===0)||f.strstart-f.block_start>=f.w_size-et&&(B(f,!1),f.strm.avail_out===0))return _}return f.insert=0,P===m?(B(f,!0),f.strm.avail_out===0?ot:G):(f.strstart>f.block_start&&(B(f,!1),f.strm.avail_out),_)}),new bt(4,4,8,4,Ot),new bt(4,5,16,8,Ot),new bt(4,6,32,32,Ot),new bt(4,4,16,16,ft),new bt(8,16,32,32,ft),new bt(8,16,128,128,ft),new bt(8,32,128,256,ft),new bt(32,128,258,1024,ft),new bt(32,258,258,4096,ft)],o.deflateInit=function(f,P){return ne(f,P,E,15,8,0)},o.deflateInit2=ne,o.deflateReset=ye,o.deflateResetKeep=xt,o.deflateSetHeader=function(f,P){return f&&f.state?f.state.wrap!==2?p:(f.state.gzhead=P,h):p},o.deflate=function(f,P){var A,D,v,T;if(!f||!f.state||5<P||P<0)return f?lt(f,p):p;if(D=f.state,!f.output||!f.input&&f.avail_in!==0||D.status===666&&P!==m)return lt(f,f.avail_out===0?-5:p);if(D.strm=f,A=D.last_flush,D.last_flush=P,D.status===S)if(D.wrap===2)f.adler=0,nt(D,31),nt(D,139),nt(D,8),D.gzhead?(nt(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),nt(D,255&D.gzhead.time),nt(D,D.gzhead.time>>8&255),nt(D,D.gzhead.time>>16&255),nt(D,D.gzhead.time>>24&255),nt(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),nt(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(nt(D,255&D.gzhead.extra.length),nt(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(f.adler=c(f.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(nt(D,0),nt(D,0),nt(D,0),nt(D,0),nt(D,0),nt(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),nt(D,3),D.status=O);else{var X=E+(D.w_bits-8<<4)<<8;X|=(2<=D.strategy||D.level<2?0:D.level<6?1:D.level===6?2:3)<<6,D.strstart!==0&&(X|=32),X+=31-X%31,D.status=O,q(D,X),D.strstart!==0&&(q(D,f.adler>>>16),q(D,65535&f.adler)),f.adler=1}if(D.status===69)if(D.gzhead.extra){for(v=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>v&&(f.adler=c(f.adler,D.pending_buf,D.pending-v,v)),N(f),v=D.pending,D.pending!==D.pending_buf_size));)nt(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>v&&(f.adler=c(f.adler,D.pending_buf,D.pending-v,v)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(D.status===73)if(D.gzhead.name){v=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>v&&(f.adler=c(f.adler,D.pending_buf,D.pending-v,v)),N(f),v=D.pending,D.pending===D.pending_buf_size)){T=1;break}T=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,nt(D,T)}while(T!==0);D.gzhead.hcrc&&D.pending>v&&(f.adler=c(f.adler,D.pending_buf,D.pending-v,v)),T===0&&(D.gzindex=0,D.status=91)}else D.status=91;if(D.status===91)if(D.gzhead.comment){v=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>v&&(f.adler=c(f.adler,D.pending_buf,D.pending-v,v)),N(f),v=D.pending,D.pending===D.pending_buf_size)){T=1;break}T=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,nt(D,T)}while(T!==0);D.gzhead.hcrc&&D.pending>v&&(f.adler=c(f.adler,D.pending_buf,D.pending-v,v)),T===0&&(D.status=103)}else D.status=103;if(D.status===103&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&N(f),D.pending+2<=D.pending_buf_size&&(nt(D,255&f.adler),nt(D,f.adler>>8&255),f.adler=0,D.status=O)):D.status=O),D.pending!==0){if(N(f),f.avail_out===0)return D.last_flush=-1,h}else if(f.avail_in===0&&Y(P)<=Y(A)&&P!==m)return lt(f,-5);if(D.status===666&&f.avail_in!==0)return lt(f,-5);if(f.avail_in!==0||D.lookahead!==0||P!==u&&D.status!==666){var U=D.strategy===2?function(x,W){for(var Z;;){if(x.lookahead===0&&(kt(x),x.lookahead===0)){if(W===u)return _;break}if(x.match_length=0,Z=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++,Z&&(B(x,!1),x.strm.avail_out===0))return _}return x.insert=0,W===m?(B(x,!0),x.strm.avail_out===0?ot:G):x.last_lit&&(B(x,!1),x.strm.avail_out===0)?_:z}(D,P):D.strategy===3?function(x,W){for(var Z,V,it,wt,mt=x.window;;){if(x.lookahead<=j){if(kt(x),x.lookahead<=j&&W===u)return _;if(x.lookahead===0)break}if(x.match_length=0,x.lookahead>=$&&0<x.strstart&&(V=mt[it=x.strstart-1])===mt[++it]&&V===mt[++it]&&V===mt[++it]){wt=x.strstart+j;do;while(V===mt[++it]&&V===mt[++it]&&V===mt[++it]&&V===mt[++it]&&V===mt[++it]&&V===mt[++it]&&V===mt[++it]&&V===mt[++it]&&it<wt);x.match_length=j-(wt-it),x.match_length>x.lookahead&&(x.match_length=x.lookahead)}if(x.match_length>=$?(Z=a._tr_tally(x,1,x.match_length-$),x.lookahead-=x.match_length,x.strstart+=x.match_length,x.match_length=0):(Z=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++),Z&&(B(x,!1),x.strm.avail_out===0))return _}return x.insert=0,W===m?(B(x,!0),x.strm.avail_out===0?ot:G):x.last_lit&&(B(x,!1),x.strm.avail_out===0)?_:z}(D,P):r[D.level].func(D,P);if(U!==ot&&U!==G||(D.status=666),U===_||U===ot)return f.avail_out===0&&(D.last_flush=-1),h;if(U===z&&(P===1?a._tr_align(D):P!==5&&(a._tr_stored_block(D,0,0,!1),P===3&&(at(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),N(f),f.avail_out===0))return D.last_flush=-1,h}return P!==m?h:D.wrap<=0?1:(D.wrap===2?(nt(D,255&f.adler),nt(D,f.adler>>8&255),nt(D,f.adler>>16&255),nt(D,f.adler>>24&255),nt(D,255&f.total_in),nt(D,f.total_in>>8&255),nt(D,f.total_in>>16&255),nt(D,f.total_in>>24&255)):(q(D,f.adler>>>16),q(D,65535&f.adler)),N(f),0<D.wrap&&(D.wrap=-D.wrap),D.pending!==0?h:1)},o.deflateEnd=function(f){var P;return f&&f.state?(P=f.state.status)!==S&&P!==69&&P!==73&&P!==91&&P!==103&&P!==O&&P!==666?lt(f,p):(f.state=null,P===O?lt(f,-3):h):p},o.deflateSetDictionary=function(f,P){var A,D,v,T,X,U,x,W,Z=P.length;if(!f||!f.state||(T=(A=f.state).wrap)===2||T===1&&A.status!==S||A.lookahead)return p;for(T===1&&(f.adler=s(f.adler,P,Z,0)),A.wrap=0,Z>=A.w_size&&(T===0&&(at(A.head),A.strstart=0,A.block_start=0,A.insert=0),W=new l.Buf8(A.w_size),l.arraySet(W,P,Z-A.w_size,A.w_size,0),P=W,Z=A.w_size),X=f.avail_in,U=f.next_in,x=f.input,f.avail_in=Z,f.next_in=0,f.input=P,kt(A);A.lookahead>=$;){for(D=A.strstart,v=A.lookahead-($-1);A.ins_h=(A.ins_h<<A.hash_shift^A.window[D+$-1])&A.hash_mask,A.prev[D&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=D,D++,--v;);A.strstart=D,A.lookahead=$-1,kt(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=$-1,A.match_available=0,f.next_in=U,f.input=x,f.avail_in=X,A.wrap=T,h},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,n,o){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,n,o){n.exports=function(r,l){var a,s,c,d,u,m,h,p,g,y,b,E,w,L,R,F,M,k,$,j,et,S,O,_,z;a=r.state,s=r.next_in,_=r.input,c=s+(r.avail_in-5),d=r.next_out,z=r.output,u=d-(l-r.avail_out),m=d+(r.avail_out-257),h=a.dmax,p=a.wsize,g=a.whave,y=a.wnext,b=a.window,E=a.hold,w=a.bits,L=a.lencode,R=a.distcode,F=(1<<a.lenbits)-1,M=(1<<a.distbits)-1;t:do{w<15&&(E+=_[s++]<<w,w+=8,E+=_[s++]<<w,w+=8),k=L[E&F];e:for(;;){if(E>>>=$=k>>>24,w-=$,($=k>>>16&255)===0)z[d++]=65535&k;else{if(!(16&$)){if(!(64&$)){k=L[(65535&k)+(E&(1<<$)-1)];continue e}if(32&$){a.mode=12;break t}r.msg="invalid literal/length code",a.mode=30;break t}j=65535&k,($&=15)&&(w<$&&(E+=_[s++]<<w,w+=8),j+=E&(1<<$)-1,E>>>=$,w-=$),w<15&&(E+=_[s++]<<w,w+=8,E+=_[s++]<<w,w+=8),k=R[E&M];i:for(;;){if(E>>>=$=k>>>24,w-=$,!(16&($=k>>>16&255))){if(!(64&$)){k=R[(65535&k)+(E&(1<<$)-1)];continue i}r.msg="invalid distance code",a.mode=30;break t}if(et=65535&k,w<($&=15)&&(E+=_[s++]<<w,(w+=8)<$&&(E+=_[s++]<<w,w+=8)),h<(et+=E&(1<<$)-1)){r.msg="invalid distance too far back",a.mode=30;break t}if(E>>>=$,w-=$,($=d-u)<et){if(g<($=et-$)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break t}if(O=b,(S=0)===y){if(S+=p-$,$<j){for(j-=$;z[d++]=b[S++],--$;);S=d-et,O=z}}else if(y<$){if(S+=p+y-$,($-=y)<j){for(j-=$;z[d++]=b[S++],--$;);if(S=0,y<j){for(j-=$=y;z[d++]=b[S++],--$;);S=d-et,O=z}}}else if(S+=y-$,$<j){for(j-=$;z[d++]=b[S++],--$;);S=d-et,O=z}for(;2<j;)z[d++]=O[S++],z[d++]=O[S++],z[d++]=O[S++],j-=3;j&&(z[d++]=O[S++],1<j&&(z[d++]=O[S++]))}else{for(S=d-et;z[d++]=z[S++],z[d++]=z[S++],z[d++]=z[S++],2<(j-=3););j&&(z[d++]=z[S++],1<j&&(z[d++]=z[S++]))}break}}break}}while(s<c&&d<m);s-=j=w>>3,E&=(1<<(w-=j<<3))-1,r.next_in=s,r.next_out=d,r.avail_in=s<c?c-s+5:5-(s-c),r.avail_out=d<m?m-d+257:257-(d-m),a.hold=E,a.bits=w}},{}],49:[function(i,n,o){var r=i("../utils/common"),l=i("./adler32"),a=i("./crc32"),s=i("./inffast"),c=i("./inftrees"),d=1,u=2,m=0,h=-2,p=1,g=852,y=592;function b(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function E(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(S){var O;return S&&S.state?(O=S.state,S.total_in=S.total_out=O.total=0,S.msg="",O.wrap&&(S.adler=1&O.wrap),O.mode=p,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new r.Buf32(g),O.distcode=O.distdyn=new r.Buf32(y),O.sane=1,O.back=-1,m):h}function L(S){var O;return S&&S.state?((O=S.state).wsize=0,O.whave=0,O.wnext=0,w(S)):h}function R(S,O){var _,z;return S&&S.state?(z=S.state,O<0?(_=0,O=-O):(_=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:(z.window!==null&&z.wbits!==O&&(z.window=null),z.wrap=_,z.wbits=O,L(S))):h}function F(S,O){var _,z;return S?(z=new E,(S.state=z).window=null,(_=R(S,O))!==m&&(S.state=null),_):h}var M,k,$=!0;function j(S){if($){var O;for(M=new r.Buf32(512),k=new r.Buf32(32),O=0;O<144;)S.lens[O++]=8;for(;O<256;)S.lens[O++]=9;for(;O<280;)S.lens[O++]=7;for(;O<288;)S.lens[O++]=8;for(c(d,S.lens,0,288,M,0,S.work,{bits:9}),O=0;O<32;)S.lens[O++]=5;c(u,S.lens,0,32,k,0,S.work,{bits:5}),$=!1}S.lencode=M,S.lenbits=9,S.distcode=k,S.distbits=5}function et(S,O,_,z){var ot,G=S.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new r.Buf8(G.wsize)),z>=G.wsize?(r.arraySet(G.window,O,_-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(z<(ot=G.wsize-G.wnext)&&(ot=z),r.arraySet(G.window,O,_-z,ot,G.wnext),(z-=ot)?(r.arraySet(G.window,O,_-z,z,0),G.wnext=z,G.whave=G.wsize):(G.wnext+=ot,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=ot))),0}o.inflateReset=L,o.inflateReset2=R,o.inflateResetKeep=w,o.inflateInit=function(S){return F(S,15)},o.inflateInit2=F,o.inflate=function(S,O){var _,z,ot,G,lt,Y,at,N,B,nt,q,J,kt,Ot,ft,bt,$t,xt,ye,ne,f,P,A,D,v=0,T=new r.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return h;(_=S.state).mode===12&&(_.mode=13),lt=S.next_out,ot=S.output,at=S.avail_out,G=S.next_in,z=S.input,Y=S.avail_in,N=_.hold,B=_.bits,nt=Y,q=at,P=m;t:for(;;)switch(_.mode){case p:if(_.wrap===0){_.mode=13;break}for(;B<16;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if(2&_.wrap&&N===35615){T[_.check=0]=255&N,T[1]=N>>>8&255,_.check=a(_.check,T,2,0),B=N=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&N)<<8)+(N>>8))%31){S.msg="incorrect header check",_.mode=30;break}if((15&N)!=8){S.msg="unknown compression method",_.mode=30;break}if(B-=4,f=8+(15&(N>>>=4)),_.wbits===0)_.wbits=f;else if(f>_.wbits){S.msg="invalid window size",_.mode=30;break}_.dmax=1<<f,S.adler=_.check=1,_.mode=512&N?10:12,B=N=0;break;case 2:for(;B<16;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if(_.flags=N,(255&_.flags)!=8){S.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){S.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=N>>8&1),512&_.flags&&(T[0]=255&N,T[1]=N>>>8&255,_.check=a(_.check,T,2,0)),B=N=0,_.mode=3;case 3:for(;B<32;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}_.head&&(_.head.time=N),512&_.flags&&(T[0]=255&N,T[1]=N>>>8&255,T[2]=N>>>16&255,T[3]=N>>>24&255,_.check=a(_.check,T,4,0)),B=N=0,_.mode=4;case 4:for(;B<16;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}_.head&&(_.head.xflags=255&N,_.head.os=N>>8),512&_.flags&&(T[0]=255&N,T[1]=N>>>8&255,_.check=a(_.check,T,2,0)),B=N=0,_.mode=5;case 5:if(1024&_.flags){for(;B<16;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}_.length=N,_.head&&(_.head.extra_len=N),512&_.flags&&(T[0]=255&N,T[1]=N>>>8&255,_.check=a(_.check,T,2,0)),B=N=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(Y<(J=_.length)&&(J=Y),J&&(_.head&&(f=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),r.arraySet(_.head.extra,z,G,J,f)),512&_.flags&&(_.check=a(_.check,z,J,G)),Y-=J,G+=J,_.length-=J),_.length))break t;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(Y===0)break t;for(J=0;f=z[G+J++],_.head&&f&&_.length<65536&&(_.head.name+=String.fromCharCode(f)),f&&J<Y;);if(512&_.flags&&(_.check=a(_.check,z,J,G)),Y-=J,G+=J,f)break t}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(Y===0)break t;for(J=0;f=z[G+J++],_.head&&f&&_.length<65536&&(_.head.comment+=String.fromCharCode(f)),f&&J<Y;);if(512&_.flags&&(_.check=a(_.check,z,J,G)),Y-=J,G+=J,f)break t}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;B<16;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if(N!==(65535&_.check)){S.msg="header crc mismatch",_.mode=30;break}B=N=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),S.adler=_.check=0,_.mode=12;break;case 10:for(;B<32;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}S.adler=_.check=b(N),B=N=0,_.mode=11;case 11:if(_.havedict===0)return S.next_out=lt,S.avail_out=at,S.next_in=G,S.avail_in=Y,_.hold=N,_.bits=B,2;S.adler=_.check=1,_.mode=12;case 12:if(O===5||O===6)break t;case 13:if(_.last){N>>>=7&B,B-=7&B,_.mode=27;break}for(;B<3;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}switch(_.last=1&N,B-=1,3&(N>>>=1)){case 0:_.mode=14;break;case 1:if(j(_),_.mode=20,O!==6)break;N>>>=2,B-=2;break t;case 2:_.mode=17;break;case 3:S.msg="invalid block type",_.mode=30}N>>>=2,B-=2;break;case 14:for(N>>>=7&B,B-=7&B;B<32;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if((65535&N)!=(N>>>16^65535)){S.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&N,B=N=0,_.mode=15,O===6)break t;case 15:_.mode=16;case 16:if(J=_.length){if(Y<J&&(J=Y),at<J&&(J=at),J===0)break t;r.arraySet(ot,z,G,J,lt),Y-=J,G+=J,at-=J,lt+=J,_.length-=J;break}_.mode=12;break;case 17:for(;B<14;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if(_.nlen=257+(31&N),N>>>=5,B-=5,_.ndist=1+(31&N),N>>>=5,B-=5,_.ncode=4+(15&N),N>>>=4,B-=4,286<_.nlen||30<_.ndist){S.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;B<3;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}_.lens[X[_.have++]]=7&N,N>>>=3,B-=3}for(;_.have<19;)_.lens[X[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,A={bits:_.lenbits},P=c(0,_.lens,0,19,_.lencode,0,_.work,A),_.lenbits=A.bits,P){S.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;bt=(v=_.lencode[N&(1<<_.lenbits)-1])>>>16&255,$t=65535&v,!((ft=v>>>24)<=B);){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if($t<16)N>>>=ft,B-=ft,_.lens[_.have++]=$t;else{if($t===16){for(D=ft+2;B<D;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if(N>>>=ft,B-=ft,_.have===0){S.msg="invalid bit length repeat",_.mode=30;break}f=_.lens[_.have-1],J=3+(3&N),N>>>=2,B-=2}else if($t===17){for(D=ft+3;B<D;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}B-=ft,f=0,J=3+(7&(N>>>=ft)),N>>>=3,B-=3}else{for(D=ft+7;B<D;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}B-=ft,f=0,J=11+(127&(N>>>=ft)),N>>>=7,B-=7}if(_.have+J>_.nlen+_.ndist){S.msg="invalid bit length repeat",_.mode=30;break}for(;J--;)_.lens[_.have++]=f}}if(_.mode===30)break;if(_.lens[256]===0){S.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,A={bits:_.lenbits},P=c(d,_.lens,0,_.nlen,_.lencode,0,_.work,A),_.lenbits=A.bits,P){S.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,A={bits:_.distbits},P=c(u,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,A),_.distbits=A.bits,P){S.msg="invalid distances set",_.mode=30;break}if(_.mode=20,O===6)break t;case 20:_.mode=21;case 21:if(6<=Y&&258<=at){S.next_out=lt,S.avail_out=at,S.next_in=G,S.avail_in=Y,_.hold=N,_.bits=B,s(S,q),lt=S.next_out,ot=S.output,at=S.avail_out,G=S.next_in,z=S.input,Y=S.avail_in,N=_.hold,B=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;bt=(v=_.lencode[N&(1<<_.lenbits)-1])>>>16&255,$t=65535&v,!((ft=v>>>24)<=B);){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if(bt&&!(240&bt)){for(xt=ft,ye=bt,ne=$t;bt=(v=_.lencode[ne+((N&(1<<xt+ye)-1)>>xt)])>>>16&255,$t=65535&v,!(xt+(ft=v>>>24)<=B);){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}N>>>=xt,B-=xt,_.back+=xt}if(N>>>=ft,B-=ft,_.back+=ft,_.length=$t,bt===0){_.mode=26;break}if(32&bt){_.back=-1,_.mode=12;break}if(64&bt){S.msg="invalid literal/length code",_.mode=30;break}_.extra=15&bt,_.mode=22;case 22:if(_.extra){for(D=_.extra;B<D;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}_.length+=N&(1<<_.extra)-1,N>>>=_.extra,B-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;bt=(v=_.distcode[N&(1<<_.distbits)-1])>>>16&255,$t=65535&v,!((ft=v>>>24)<=B);){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if(!(240&bt)){for(xt=ft,ye=bt,ne=$t;bt=(v=_.distcode[ne+((N&(1<<xt+ye)-1)>>xt)])>>>16&255,$t=65535&v,!(xt+(ft=v>>>24)<=B);){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}N>>>=xt,B-=xt,_.back+=xt}if(N>>>=ft,B-=ft,_.back+=ft,64&bt){S.msg="invalid distance code",_.mode=30;break}_.offset=$t,_.extra=15&bt,_.mode=24;case 24:if(_.extra){for(D=_.extra;B<D;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}_.offset+=N&(1<<_.extra)-1,N>>>=_.extra,B-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){S.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(at===0)break t;if(J=q-at,_.offset>J){if((J=_.offset-J)>_.whave&&_.sane){S.msg="invalid distance too far back",_.mode=30;break}kt=J>_.wnext?(J-=_.wnext,_.wsize-J):_.wnext-J,J>_.length&&(J=_.length),Ot=_.window}else Ot=ot,kt=lt-_.offset,J=_.length;for(at<J&&(J=at),at-=J,_.length-=J;ot[lt++]=Ot[kt++],--J;);_.length===0&&(_.mode=21);break;case 26:if(at===0)break t;ot[lt++]=_.length,at--,_.mode=21;break;case 27:if(_.wrap){for(;B<32;){if(Y===0)break t;Y--,N|=z[G++]<<B,B+=8}if(q-=at,S.total_out+=q,_.total+=q,q&&(S.adler=_.check=_.flags?a(_.check,ot,q,lt-q):l(_.check,ot,q,lt-q)),q=at,(_.flags?N:b(N))!==_.check){S.msg="incorrect data check",_.mode=30;break}B=N=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;B<32;){if(Y===0)break t;Y--,N+=z[G++]<<B,B+=8}if(N!==(4294967295&_.total)){S.msg="incorrect length check",_.mode=30;break}B=N=0}_.mode=29;case 29:P=1;break t;case 30:P=-3;break t;case 31:return-4;case 32:default:return h}return S.next_out=lt,S.avail_out=at,S.next_in=G,S.avail_in=Y,_.hold=N,_.bits=B,(_.wsize||q!==S.avail_out&&_.mode<30&&(_.mode<27||O!==4))&&et(S,S.output,S.next_out,q-S.avail_out)?(_.mode=31,-4):(nt-=S.avail_in,q-=S.avail_out,S.total_in+=nt,S.total_out+=q,_.total+=q,_.wrap&&q&&(S.adler=_.check=_.flags?a(_.check,ot,q,S.next_out-q):l(_.check,ot,q,S.next_out-q)),S.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(nt==0&&q===0||O===4)&&P===m&&(P=-5),P)},o.inflateEnd=function(S){if(!S||!S.state)return h;var O=S.state;return O.window&&(O.window=null),S.state=null,m},o.inflateGetHeader=function(S,O){var _;return S&&S.state&&2&(_=S.state).wrap?((_.head=O).done=!1,m):h},o.inflateSetDictionary=function(S,O){var _,z=O.length;return S&&S.state?(_=S.state).wrap!==0&&_.mode!==11?h:_.mode===11&&l(1,O,z,0)!==_.check?-3:et(S,O,z,z)?(_.mode=31,-4):(_.havedict=1,m):h},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,n,o){var r=i("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(d,u,m,h,p,g,y,b){var E,w,L,R,F,M,k,$,j,et=b.bits,S=0,O=0,_=0,z=0,ot=0,G=0,lt=0,Y=0,at=0,N=0,B=null,nt=0,q=new r.Buf16(16),J=new r.Buf16(16),kt=null,Ot=0;for(S=0;S<=15;S++)q[S]=0;for(O=0;O<h;O++)q[u[m+O]]++;for(ot=et,z=15;1<=z&&q[z]===0;z--);if(z<ot&&(ot=z),z===0)return p[g++]=20971520,p[g++]=20971520,b.bits=1,0;for(_=1;_<z&&q[_]===0;_++);for(ot<_&&(ot=_),S=Y=1;S<=15;S++)if(Y<<=1,(Y-=q[S])<0)return-1;if(0<Y&&(d===0||z!==1))return-1;for(J[1]=0,S=1;S<15;S++)J[S+1]=J[S]+q[S];for(O=0;O<h;O++)u[m+O]!==0&&(y[J[u[m+O]]++]=O);if(M=d===0?(B=kt=y,19):d===1?(B=l,nt-=257,kt=a,Ot-=257,256):(B=s,kt=c,-1),S=_,F=g,lt=O=N=0,L=-1,R=(at=1<<(G=ot))-1,d===1&&852<at||d===2&&592<at)return 1;for(;;){for(k=S-lt,j=y[O]<M?($=0,y[O]):y[O]>M?($=kt[Ot+y[O]],B[nt+y[O]]):($=96,0),E=1<<S-lt,_=w=1<<G;p[F+(N>>lt)+(w-=E)]=k<<24|$<<16|j|0,w!==0;);for(E=1<<S-1;N&E;)E>>=1;if(E!==0?(N&=E-1,N+=E):N=0,O++,--q[S]==0){if(S===z)break;S=u[m+y[O]]}if(ot<S&&(N&R)!==L){for(lt===0&&(lt=ot),F+=_,Y=1<<(G=S-lt);G+lt<z&&!((Y-=q[G+lt])<=0);)G++,Y<<=1;if(at+=1<<G,d===1&&852<at||d===2&&592<at)return 1;p[L=N&R]=ot<<24|G<<16|F-g|0}}return N!==0&&(p[F+N]=S-lt<<24|64<<16|0),b.bits=ot,0}},{"../utils/common":41}],51:[function(i,n,o){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,n,o){var r=i("../utils/common"),l=0,a=1;function s(v){for(var T=v.length;0<=--T;)v[T]=0}var c=0,d=29,u=256,m=u+1+d,h=30,p=19,g=2*m+1,y=15,b=16,E=7,w=256,L=16,R=17,F=18,M=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],et=new Array(2*(m+2));s(et);var S=new Array(2*h);s(S);var O=new Array(512);s(O);var _=new Array(256);s(_);var z=new Array(d);s(z);var ot,G,lt,Y=new Array(h);function at(v,T,X,U,x){this.static_tree=v,this.extra_bits=T,this.extra_base=X,this.elems=U,this.max_length=x,this.has_stree=v&&v.length}function N(v,T){this.dyn_tree=v,this.max_code=0,this.stat_desc=T}function B(v){return v<256?O[v]:O[256+(v>>>7)]}function nt(v,T){v.pending_buf[v.pending++]=255&T,v.pending_buf[v.pending++]=T>>>8&255}function q(v,T,X){v.bi_valid>b-X?(v.bi_buf|=T<<v.bi_valid&65535,nt(v,v.bi_buf),v.bi_buf=T>>b-v.bi_valid,v.bi_valid+=X-b):(v.bi_buf|=T<<v.bi_valid&65535,v.bi_valid+=X)}function J(v,T,X){q(v,X[2*T],X[2*T+1])}function kt(v,T){for(var X=0;X|=1&v,v>>>=1,X<<=1,0<--T;);return X>>>1}function Ot(v,T,X){var U,x,W=new Array(y+1),Z=0;for(U=1;U<=y;U++)W[U]=Z=Z+X[U-1]<<1;for(x=0;x<=T;x++){var V=v[2*x+1];V!==0&&(v[2*x]=kt(W[V]++,V))}}function ft(v){var T;for(T=0;T<m;T++)v.dyn_ltree[2*T]=0;for(T=0;T<h;T++)v.dyn_dtree[2*T]=0;for(T=0;T<p;T++)v.bl_tree[2*T]=0;v.dyn_ltree[2*w]=1,v.opt_len=v.static_len=0,v.last_lit=v.matches=0}function bt(v){8<v.bi_valid?nt(v,v.bi_buf):0<v.bi_valid&&(v.pending_buf[v.pending++]=v.bi_buf),v.bi_buf=0,v.bi_valid=0}function $t(v,T,X,U){var x=2*T,W=2*X;return v[x]<v[W]||v[x]===v[W]&&U[T]<=U[X]}function xt(v,T,X){for(var U=v.heap[X],x=X<<1;x<=v.heap_len&&(x<v.heap_len&&$t(T,v.heap[x+1],v.heap[x],v.depth)&&x++,!$t(T,U,v.heap[x],v.depth));)v.heap[X]=v.heap[x],X=x,x<<=1;v.heap[X]=U}function ye(v,T,X){var U,x,W,Z,V=0;if(v.last_lit!==0)for(;U=v.pending_buf[v.d_buf+2*V]<<8|v.pending_buf[v.d_buf+2*V+1],x=v.pending_buf[v.l_buf+V],V++,U===0?J(v,x,T):(J(v,(W=_[x])+u+1,T),(Z=M[W])!==0&&q(v,x-=z[W],Z),J(v,W=B(--U),X),(Z=k[W])!==0&&q(v,U-=Y[W],Z)),V<v.last_lit;);J(v,w,T)}function ne(v,T){var X,U,x,W=T.dyn_tree,Z=T.stat_desc.static_tree,V=T.stat_desc.has_stree,it=T.stat_desc.elems,wt=-1;for(v.heap_len=0,v.heap_max=g,X=0;X<it;X++)W[2*X]!==0?(v.heap[++v.heap_len]=wt=X,v.depth[X]=0):W[2*X+1]=0;for(;v.heap_len<2;)W[2*(x=v.heap[++v.heap_len]=wt<2?++wt:0)]=1,v.depth[x]=0,v.opt_len--,V&&(v.static_len-=Z[2*x+1]);for(T.max_code=wt,X=v.heap_len>>1;1<=X;X--)xt(v,W,X);for(x=it;X=v.heap[1],v.heap[1]=v.heap[v.heap_len--],xt(v,W,1),U=v.heap[1],v.heap[--v.heap_max]=X,v.heap[--v.heap_max]=U,W[2*x]=W[2*X]+W[2*U],v.depth[x]=(v.depth[X]>=v.depth[U]?v.depth[X]:v.depth[U])+1,W[2*X+1]=W[2*U+1]=x,v.heap[1]=x++,xt(v,W,1),2<=v.heap_len;);v.heap[--v.heap_max]=v.heap[1],function(mt,Zt){var Pi,ve,Fi,Bt,fn,ha,Le=Zt.dyn_tree,Nr=Zt.max_code,mu=Zt.stat_desc.static_tree,pu=Zt.stat_desc.has_stree,gu=Zt.stat_desc.extra_bits,Ar=Zt.stat_desc.extra_base,Hi=Zt.stat_desc.max_length,mn=0;for(Bt=0;Bt<=y;Bt++)mt.bl_count[Bt]=0;for(Le[2*mt.heap[mt.heap_max]+1]=0,Pi=mt.heap_max+1;Pi<g;Pi++)Hi<(Bt=Le[2*Le[2*(ve=mt.heap[Pi])+1]+1]+1)&&(Bt=Hi,mn++),Le[2*ve+1]=Bt,Nr<ve||(mt.bl_count[Bt]++,fn=0,Ar<=ve&&(fn=gu[ve-Ar]),ha=Le[2*ve],mt.opt_len+=ha*(Bt+fn),pu&&(mt.static_len+=ha*(mu[2*ve+1]+fn)));if(mn!==0){do{for(Bt=Hi-1;mt.bl_count[Bt]===0;)Bt--;mt.bl_count[Bt]--,mt.bl_count[Bt+1]+=2,mt.bl_count[Hi]--,mn-=2}while(0<mn);for(Bt=Hi;Bt!==0;Bt--)for(ve=mt.bl_count[Bt];ve!==0;)Nr<(Fi=mt.heap[--Pi])||(Le[2*Fi+1]!==Bt&&(mt.opt_len+=(Bt-Le[2*Fi+1])*Le[2*Fi],Le[2*Fi+1]=Bt),ve--)}}(v,T),Ot(W,wt,v.bl_count)}function f(v,T,X){var U,x,W=-1,Z=T[1],V=0,it=7,wt=4;for(Z===0&&(it=138,wt=3),T[2*(X+1)+1]=65535,U=0;U<=X;U++)x=Z,Z=T[2*(U+1)+1],++V<it&&x===Z||(V<wt?v.bl_tree[2*x]+=V:x!==0?(x!==W&&v.bl_tree[2*x]++,v.bl_tree[2*L]++):V<=10?v.bl_tree[2*R]++:v.bl_tree[2*F]++,W=x,wt=(V=0)===Z?(it=138,3):x===Z?(it=6,3):(it=7,4))}function P(v,T,X){var U,x,W=-1,Z=T[1],V=0,it=7,wt=4;for(Z===0&&(it=138,wt=3),U=0;U<=X;U++)if(x=Z,Z=T[2*(U+1)+1],!(++V<it&&x===Z)){if(V<wt)for(;J(v,x,v.bl_tree),--V!=0;);else x!==0?(x!==W&&(J(v,x,v.bl_tree),V--),J(v,L,v.bl_tree),q(v,V-3,2)):V<=10?(J(v,R,v.bl_tree),q(v,V-3,3)):(J(v,F,v.bl_tree),q(v,V-11,7));W=x,wt=(V=0)===Z?(it=138,3):x===Z?(it=6,3):(it=7,4)}}s(Y);var A=!1;function D(v,T,X,U){q(v,(c<<1)+(U?1:0),3),function(x,W,Z,V){bt(x),V&&(nt(x,Z),nt(x,~Z)),r.arraySet(x.pending_buf,x.window,W,Z,x.pending),x.pending+=Z}(v,T,X,!0)}o._tr_init=function(v){A||(function(){var T,X,U,x,W,Z=new Array(y+1);for(x=U=0;x<d-1;x++)for(z[x]=U,T=0;T<1<<M[x];T++)_[U++]=x;for(_[U-1]=x,x=W=0;x<16;x++)for(Y[x]=W,T=0;T<1<<k[x];T++)O[W++]=x;for(W>>=7;x<h;x++)for(Y[x]=W<<7,T=0;T<1<<k[x]-7;T++)O[256+W++]=x;for(X=0;X<=y;X++)Z[X]=0;for(T=0;T<=143;)et[2*T+1]=8,T++,Z[8]++;for(;T<=255;)et[2*T+1]=9,T++,Z[9]++;for(;T<=279;)et[2*T+1]=7,T++,Z[7]++;for(;T<=287;)et[2*T+1]=8,T++,Z[8]++;for(Ot(et,m+1,Z),T=0;T<h;T++)S[2*T+1]=5,S[2*T]=kt(T,5);ot=new at(et,M,u+1,m,y),G=new at(S,k,0,h,y),lt=new at(new Array(0),$,0,p,E)}(),A=!0),v.l_desc=new N(v.dyn_ltree,ot),v.d_desc=new N(v.dyn_dtree,G),v.bl_desc=new N(v.bl_tree,lt),v.bi_buf=0,v.bi_valid=0,ft(v)},o._tr_stored_block=D,o._tr_flush_block=function(v,T,X,U){var x,W,Z=0;0<v.level?(v.strm.data_type===2&&(v.strm.data_type=function(V){var it,wt=4093624447;for(it=0;it<=31;it++,wt>>>=1)if(1&wt&&V.dyn_ltree[2*it]!==0)return l;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return a;for(it=32;it<u;it++)if(V.dyn_ltree[2*it]!==0)return a;return l}(v)),ne(v,v.l_desc),ne(v,v.d_desc),Z=function(V){var it;for(f(V,V.dyn_ltree,V.l_desc.max_code),f(V,V.dyn_dtree,V.d_desc.max_code),ne(V,V.bl_desc),it=p-1;3<=it&&V.bl_tree[2*j[it]+1]===0;it--);return V.opt_len+=3*(it+1)+5+5+4,it}(v),x=v.opt_len+3+7>>>3,(W=v.static_len+3+7>>>3)<=x&&(x=W)):x=W=X+5,X+4<=x&&T!==-1?D(v,T,X,U):v.strategy===4||W===x?(q(v,2+(U?1:0),3),ye(v,et,S)):(q(v,4+(U?1:0),3),function(V,it,wt,mt){var Zt;for(q(V,it-257,5),q(V,wt-1,5),q(V,mt-4,4),Zt=0;Zt<mt;Zt++)q(V,V.bl_tree[2*j[Zt]+1],3);P(V,V.dyn_ltree,it-1),P(V,V.dyn_dtree,wt-1)}(v,v.l_desc.max_code+1,v.d_desc.max_code+1,Z+1),ye(v,v.dyn_ltree,v.dyn_dtree)),ft(v),U&&bt(v)},o._tr_tally=function(v,T,X){return v.pending_buf[v.d_buf+2*v.last_lit]=T>>>8&255,v.pending_buf[v.d_buf+2*v.last_lit+1]=255&T,v.pending_buf[v.l_buf+v.last_lit]=255&X,v.last_lit++,T===0?v.dyn_ltree[2*X]++:(v.matches++,T--,v.dyn_ltree[2*(_[X]+u+1)]++,v.dyn_dtree[2*B(T)]++),v.last_lit===v.lit_bufsize-1},o._tr_align=function(v){q(v,2,3),J(v,w,et),function(T){T.bi_valid===16?(nt(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(v)}},{"../utils/common":41}],53:[function(i,n,o){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,n,o){(function(r){(function(l,a){if(!l.setImmediate){var s,c,d,u,m=1,h={},p=!1,g=l.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(l);y=y&&y.setTimeout?y:l,s={}.toString.call(l.process)==="[object process]"?function(L){process.nextTick(function(){E(L)})}:function(){if(l.postMessage&&!l.importScripts){var L=!0,R=l.onmessage;return l.onmessage=function(){L=!1},l.postMessage("","*"),l.onmessage=R,L}}()?(u="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",w,!1):l.attachEvent("onmessage",w),function(L){l.postMessage(u+L,"*")}):l.MessageChannel?((d=new MessageChannel).port1.onmessage=function(L){E(L.data)},function(L){d.port2.postMessage(L)}):g&&"onreadystatechange"in g.createElement("script")?(c=g.documentElement,function(L){var R=g.createElement("script");R.onreadystatechange=function(){E(L),R.onreadystatechange=null,c.removeChild(R),R=null},c.appendChild(R)}):function(L){setTimeout(E,0,L)},y.setImmediate=function(L){typeof L!="function"&&(L=new Function(""+L));for(var R=new Array(arguments.length-1),F=0;F<R.length;F++)R[F]=arguments[F+1];var M={callback:L,args:R};return h[m]=M,s(m),m++},y.clearImmediate=b}function b(L){delete h[L]}function E(L){if(p)setTimeout(E,0,L);else{var R=h[L];if(R){p=!0;try{(function(F){var M=F.callback,k=F.args;switch(k.length){case 0:M();break;case 1:M(k[0]);break;case 2:M(k[0],k[1]);break;case 3:M(k[0],k[1],k[2]);break;default:M.apply(a,k)}})(R)}finally{b(L),p=!1}}}}function w(L){L.source===l&&typeof L.data=="string"&&L.data.indexOf(u)===0&&E(+L.data.slice(u.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof En<"u"?En:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Rm);const km=Ua;async function xm(t){return km.loadAsync(t)}const re=()=>"[main]";async function Bm(t){if(t.file)return t.file;if(t.link)return Lm(Ps(decodeURI(t.link)));if(t.id)return uu(Fs(decodeURI(t.id)));if(t.hash&&Ms(decodeURI(t.hash).trim()))return Cm(decodeURI(t.hash).trim());throw new Error("Could not search for file.")}const $e=async t=>{var e;try{console.time("loading time"),_n.enable(!1);let i=await Bm(t);vt.status("info","Extracting zip",0),Mt.switchHeader(!1);const n=await xm(i);_n.enable(!1),vt.status("info","Parsing map info...",0),K.info(re(),"Parsing map info");const o=await Dm(n);st.beatmapInfo=o,Mu(o),vt.status("info","Loading image...",10.4375),K.info(re(),"Loading cover image");let r=n.file(o._coverImageFilename);if(Q.load.imageCover&&r){let c=await r.async("base64");Mt.setCoverImage("data:image;base64,"+c),Li.loading.coverImage=!0}else K.error(re(),`${o._coverImageFilename} does not exists.`);if(st.contributors=[],(e=o==null?void 0:o._customData)!=null&&e._contributors)for(const c of o._customData._contributors){K.info(re(),"Loading contributor image "+c._name),r=n.file(c._iconPath);let d=null;Q.load.imageContributor&&r?d=await r.async("base64"):K.error(re(),`${c._iconPath} does not exists.`),st.contributors.push({...c,_base64:d})}vt.status("info","Loading audio...",20.875),K.info(re(),"Loading audio");let l=n.file(o._songFilename);if(Q.load.audio&&l){let c=!1;setTimeout(()=>{c||vt.status("info","Loading audio... (this may take a while)",20.875)},1e4);let d=await l.async("arraybuffer");Mt.setAudio(d),await new AudioContext().decodeAudioData(d).then(m=>{c=!0;let h=m.duration;st.duration=h,Mt.setSongDuration(h),Li.loading.audio=!0}).catch(function(m){Mt.setSongDuration(),K.error(re(),m)})}else Mt.setSongDuration(),K.error(re(),`${o._songFilename} does not exist.`);vt.status("info","Parsing difficulty...",70),st.beatmapDifficulty=await wm(o,n),Si.adjustTime(),vt.status("info","Adding map difficulty stats...",80),K.info(re(),"Adding map stats"),bm(),al(st.contributors);let a=o._beatsPerMinute,s=o._beatsPerMinute;st.beatmapDifficulty.forEach(c=>{const d=c.bpm.change.map(m=>m.BPM),u=c.data.bpmEvents.map(m=>m.bpm);a=Math.min(a,...d,...u),s=Math.max(s,...d,...u)}),a!==s&&Mt.setSongBPM(o._beatsPerMinute,a,s),vt.status("info","Analysing general...",85),K.info(re(),"Analysing map"),_i.runGeneral(),Si.displayOutputGeneral(),vt.status("info","Analysing difficulty...",90),_i.applyAll(),Si.populateSelect(o),Si.displayOutputDifficulty(),_n.enable(!0),vt.status("info","Map successfully loaded!"),console.timeEnd("loading time")}catch(i){vt.status("error",i,100),K.error(re(),i),st.clear(),_n.enable(!0),Mt.switchHeader(!0)}},Mi="UI Intro: ",nn=document.querySelector(".input__intro-url"),an=document.querySelector(".input__intro-id"),rn=document.querySelector(".input__intro-hash"),Rs=document.querySelector(".input__search-button"),ks=document.querySelector(".input__file"),ga=document.querySelector(".input__file-zone");if(nn)nn.addEventListener("keydown",Cr);else throw new Error(Mi+"URL input is missing");if(an)an.addEventListener("keydown",Cr);else throw new Error(Mi+"ID input is missing");if(rn)rn.addEventListener("keydown",Cr);else throw new Error(Mi+"Hash input is missing");if(Rs)Rs.addEventListener("click",Nm);else throw new Error(Mi+"search button is missing");if(ks)ks.addEventListener("change",Am);else throw new Error(Mi+"file input is missing");if(ga)ga.addEventListener("drop",Im),ga.addEventListener("dragover",$m);else throw new Error(Mi+"file drop zone is missing");function Cr(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&$e({link:e.value}),e.classList.contains("input__intro-id")&&$e({id:e.value}),e.classList.contains("input__intro-hash")&&$e({hash:e.value}))}function Nm(t){if(nn&&nn.value!==""){$e({link:nn.value});return}if(an&&an.value!==""){$e({id:an.value});return}if(rn&&rn.value!==""){$e({hash:rn.value});return}}function Am(t){const e=t.target;vt.status("info","Reading file input",0);const i=e.files?e.files[0]:null;try{if(i==null)throw vt.status("info","No file input",0),new Error("No file input");if(i&&(i.name.substr(-4)===".zip"||i.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(i),n.addEventListener("load",()=>{$e({file:i})})}else throw new Error("Unsupported file format, please enter zip file")}catch(n){vt.status("error",n,0),console.error(n)}}function Im(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items&&t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const i=new FileReader;i.readAsArrayBuffer(e),i.addEventListener("load",()=>{$e({file:e})})}else throw new Error("Unsupported file format, please enter zip file")}}catch(e){vt.status("error",e,0),console.error(e)}}function $m(t){t.preventDefault(),t.stopPropagation()}const Om=document.querySelector("body"),Mm=["Dark","Light","Monochrome"],Rr={list:Mm,set:t=>{Om.className="theme-"+t.toLowerCase().replace(" ","")}},be="UI Settings: ",$n=document.querySelector(".settings__theme"),Ga=document.querySelector(".settings__beat-numbering"),Ya=document.querySelector(".settings__rounding"),ja=document.querySelector(".settings__info-height"),Wa=document.querySelector(".settings__data-check"),Va=document.querySelector(".settings__data-error"),kr=document.querySelectorAll(".settings__load"),ra=document.querySelector(".settings__sort"),xr=document.querySelectorAll(".settings__show"),Br=document.querySelectorAll(".settings__onload"),xs=document.querySelector(".settings__clear-button");if($n)$n.addEventListener("change",Pm),Rr.list.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,$n.add(e)});else throw new Error(be+"theme select is missing");if(Ga)Ga.addEventListener("change",Fm);else throw new Error(be+"missing settings");if(Ya)Ya.addEventListener("change",Hm);else throw new Error(be+"missing settings");if(ja)ja.addEventListener("change",zm);else throw new Error(be+"missing settings");if(Wa)Wa.addEventListener("change",Xm);else throw new Error(be+"missing settings");if(Va)Va.addEventListener("change",Um);else throw new Error(be+"missing settings");kr.length||console.error(be+"empty load list, intentional or typo error?");kr.forEach(t=>t.addEventListener("change",Vm));if(ra)ra.addEventListener("change",jm);else throw new Error(be+"sort check is missing");Br.length||console.error(be+"empty onload list, intentional or typo error?");Br.forEach(t=>t.addEventListener("change",qm));xr.length||console.error(be+"empty show list, intentional or typo error?");xr.forEach(t=>t.addEventListener("change",Gm));if(xs)xs.addEventListener("click",hu);else throw new Error(be+"clear button is missing");function Pm(t){const e=t.target;Q.theme=e.options[e.options.selectedIndex].value,Rr.set(Q.theme),Q.save()}function Fm(t){const e=t.target;Q.beatNumbering=e.options[e.options.selectedIndex].value,Q.save()}function Hm(t){const e=t.target;Q.rounding=parseInt(e.value),Q.save()}function zm(t){const e=t.target;Q.infoRowHeight=parseInt(e.value),sl(Q.infoRowHeight),Q.save()}function Xm(t){const e=t.target;Q.dataCheck=e.checked,Q.save()}function Um(t){const e=t.target;Q.dataError=e.checked,Q.save()}function Gm(t){const e=t.target,i=e.id.replace("settings__show-","");Q.show[i]=e.checked,Q.save()}function Ym(t,e){xr.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}function jm(t){const e=t.target;Q.sorting=e.checked,Q.save()}function Wm(t){ra&&(ra.checked=t)}function Vm(t){const e=t.target,i=e.name;Q.load[i]=e.checked,Q.save()}function Jm(t,e){kr.forEach(i=>{i.name===t&&(i.checked=e)})}function qm(t){const e=t.target,i=e.name;Q.onLoad[i]=e.checked,Q.save()}function Zm(t,e){Br.forEach(i=>{i.name===t&&(i.checked=e)})}function Km(t){$n.value=t}function Qm(t){Ga.value=t}function tp(t){Ya.value=t.toString()}function ep(t){ja.value=t.toString(),sl(Q.infoRowHeight)}function ip(t){Wa.checked=t}function np(t){Va.checked=t}function hu(){Q.clear(),Q.reset(),location.reload()}const Ee={setShowCheck:Ym,setSortCheck:Wm,setLoadCheck:Jm,setOnLoadCheck:Zm,setTheme:Km,setBeatNumbering:Qm,setRounding:tp,setInfoHeight:ep,setDataCheck:ip,setDataError:np,clear:hu},ap=document.querySelectorAll(".input__reset-button");ap.forEach(t=>t.addEventListener("click",rp));function rp(){vt.reset(),Mt.reset(),Pu(),Si.reset(),ym(),st.clear()}const op=2,sp=5,lp=11,cp="Kival Evan#5480",Bs=new class{constructor(){this._version=`${op}.${sp}.${lp}`,this._wm=cp}get value(){return this._version}get watermark(){return this._wm}},up="UI Footer: ",du=document.querySelectorAll(".link__watermark"),fu=document.querySelectorAll(".link__version");(!du.length||!fu.length)&&console.error(up+"missing part");function Ns(){const t=new Date;return t.getMonth()==5&&t.getDate()==10}const As={setWatermark:t=>{du.forEach(e=>{e.textContent=(Ns()?"Happy Birthday, ":"")+t,Ns()&&(e.title=`Happy ${new Date().getFullYear()-new Date("1999-06-10").getFullYear()} Birthday, 10th June`)})},setVersion:t=>{fu.forEach(e=>e.textContent=t)}},hp=function(){let t=!1;return function(){if(!t){t=!0,As.setWatermark(Bs.watermark),As.setVersion(Bs.value),Si.populateTool(),Ee.setTheme(Q.theme),Ee.setBeatNumbering(Q.beatNumbering),Ee.setRounding(Q.rounding),Ee.setInfoHeight(Q.infoRowHeight),Ee.setDataCheck(Q.dataCheck),Ee.setDataError(Q.dataError);for(const e in Q.load)Ee.setLoadCheck(e,Q.load[e]);Ee.setSortCheck(Q.sorting);for(const e in Q.show)Os.show(e,Q.show[e]),Ee.setShowCheck(e,Q.show[e]);for(const e in Q.onLoad)Ee.setOnLoadCheck(e,Q.onLoad[e]);Rr.set(Q.theme),K.info("User interface initialised")}}}();(function(){hp();const t=new URL(location.href),e=t.searchParams.get("url"),i=t.searchParams.get("id"),n=t.searchParams.get("hash");(i||e||n)&&$e({link:e,id:i,hash:n})})();
