(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function i(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=i(r);fetch(r.href,s)}})();var ll=(e=>(e.none="",e.ExpertPlus="accordion__label--bg-expertplus",e.Expert="accordion__label--bg-expert",e.Hard="accordion__label--bg-hard",e.Normal="accordion__label--bg-normal",e.Easy="accordion__label--bg-easy",e))(ll||{});const An="accordion__",Dh=document.querySelectorAll(".accordion__button"),cl={create:(e,t,i,n=!1)=>{const r=document.createElement("div");r.className="accordion";const s=document.createElement("input");s.className=An+"button",s.id=e,s.setAttribute("type","checkbox");const l=document.createElement("label");l.className=An+"label unselectable",l.htmlFor=e,l.textContent=t,i&&l.classList.add(ll[i]);const o=document.createElement("div");return o.className=n?An+"collapsible-flex":An+"collapsible",o.id=e+"-content",r.appendChild(s),r.appendChild(l),r.appendChild(o),r},show:(e,t)=>{Dh.forEach(i=>{i.id.endsWith(e)&&(i.checked=t)})}};function wh(e){return e.toString().split(".").map((t,i)=>i?t:t.replace(/\B(?=(\d{3})+(?!\d))/g,",")).join(".")}Sh(Math.random());function Sh(e){e=e.toString();let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function I(e,t=0){const i=Math.pow(10,t);return Math.round(e*i)/i}function Zo(e){return e*(180/Math.PI)}function Si(e){return e*(Math.PI/180)}function Vr(e,t){t<0&&(t=-t);const i=e%t;return i<0?i+t:i}function Jr(e,t,i){return Math.min(Vr(e-t,i),Vr(t-e,i))}function Fo(e){if(e.length===0)return 0;e.sort((i,n)=>i-n);const t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}function Wo(e,t,i){return Math.min(Math.max(t,e),i)}function Ht(e){return e==null||typeof e!="object"?e:Array.isArray(e)?[...e]:{...e}}function K(e){if(e==null||typeof e!="object")return e;const t=Array.isArray(e)?Array(e.length):{};for(const i in e)t[i]=K(e[i]);return t}function mr(e){return/^[a-fA-F0-9]+$/g.test(e)}function Ie(e){return parseInt(e,16)}function In(e,t,i,n){Array.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),e=e,t=t,i=i;let r=0;const s=Math.max(e,t,i),l=Math.min(e,t,i),o=s-l,a=s===0?0:o/s,h=s;switch(s){case l:break;case e:r=t-i+o*(t<i?6:0),r/=6*o;break;case t:r=i-e+o*2,r/=6*o;break;case i:r=e-t+o*4,r/=6*o;break}const u=[r*360,a,h];return typeof n=="number"&&u.push(n),u}function Ch(e,t,i,n){Array.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),e=e/360,t=t,i=i,e<0&&(e+=Math.abs(Math.floor(e)));let r=0,s=0,l=0;const o=Math.floor(e*6),a=e*6-o,h=i*(1-t),u=i*(1-a*t),d=i*(1-(1-a)*t);switch(o%6){case 0:r=i,s=d,l=h;break;case 1:r=u,s=i,l=h;break;case 2:r=h,s=i,l=d;break;case 3:r=h,s=u,l=i;break;case 4:r=d,s=h,l=i;break;case 5:r=i,s=h,l=u;break}const f=[r,s,l];return typeof n=="number"&&f.push(n),f}function On(e){const t=e.toString(16);return t.length===1?"0"+t:t}function Th(e){return Math.round(e*255)}function we(e){return e/255}function Qo(e,t){if(Array.isArray(e)){const n={r:e[0],g:e[1],b:e[2]};return typeof e[3]=="number"&&(n.a=e[3]),t&&(n.a??(n.a=1)),n}if(typeof e=="string"||"type"in e)return Qo(Qt(e),t);const i={r:e.r,g:e.g,b:e.b};return typeof e.a=="number"&&(i.a=e.a),t&&(i.a??(i.a=1)),i}function vt(e){const t=Qo(e);let i=1;for(const n in t)i=Math.max(Math.abs(t[n]),i);for(const n in t)t[n]=Th(t[n]/i);return`#${On(t.r)}${On(t.g)}${On(t.b)}${typeof t.a=="number"?On(t.a):""}`}function ul(e){if(e=e.trim(),e.startsWith("#")&&(e=e.substring(1)),!mr(e))throw new Error("Not valid hexadecimal");let t=[0,0,0];if(e.length===3||e.length===4)t=[we(Ie(e.slice(0,1)+e.slice(0,1))),we(Ie(e.slice(1,2)+e.slice(1,2))),we(Ie(e.slice(2,3)+e.slice(2,3)))],e.length===4&&t.push(we(Ie(e.slice(3,4)+e.slice(3,4))));else if(e.length===6||e.length===8)t=[we(Ie(e.slice(0,2))),we(Ie(e.slice(2,4))),we(Ie(e.slice(4,6)))],e.length===8&&t.push(we(Ie(e.slice(6,8))));else throw new Error("Not valid colour hexadecimal");return t}function Ci(e,t="rgba",i="rgba"){if(typeof e=="string"){const n=ul(e);return i==="hsva"?In(n):n}else if(Array.isArray(e)){if(t==="hsva")return i==="hsva"?[...e]:Ch(e);const n=t==="rgba255"?e.map(r=>we(r)):[...e];return i==="hsva"?In(n):n}else if("type"in e){let n;switch(e.type){case"hsva":n=Qt(e.value,"hsva");break;case"rgba":n=Qt(e.value,"rgba");break;case"rgba255":n=Qt(e.value,"rgba255")}return i==="hsva"?In(n):n}else{const n=[e.r,e.g,e.b];return typeof e.a=="number"&&n.push(e.a),i==="hsva"?In(n):n}}function qr(e){let t=e[0],i=e[1],n=e[2],r,s,l;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=(t*.4124+i*.3576+n*.1805)/.95047,s=(t*.2126+i*.7152+n*.0722)/1,l=(t*.0193+i*.1192+n*.9505)/1.08883,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116;const o=[116*s-16,500*(r-s),200*(s-l)];return typeof e[3]=="number"&&o.push(e[3]),o}function Kr(e,t){let i=0;return e>=0&&t===0?0:e<0&&t===0?180:e===0&&t>0?90:e===0&&t<0?270:(e>0&&t>0&&(i=0),e<0&&(i=180),e>0&&t<0&&(i=360),Zo(Math.atan(t/e))+i)}function tr(e,t){const[i,n,r]=qr(e),[s,l,o]=qr(t),a=1,h=1,u=1;let d,f,c,g,_,v,b,E,w,L,x,k,P,j,O,Y,tt,S,$,p;return d=Math.sqrt(n*n+r*r),f=Math.sqrt(l*l+o*o),c=(d+f)/2,_=.5*(1-Math.sqrt((c^7)/((c^7)+30))),w=(1+_)*n,d=Math.sqrt(w*w+r*r),v=Kr(w,r),w=(1+_)*l,f=Math.sqrt(w*w+o*o),b=Kr(w,o),S=s-i,$=f-d,d*f==0?p=0:(w=I(b-v,12),Math.abs(w)<=180?p=b-v:w>180?p=b-v-360:p=b-v+360),p=2*Math.sqrt(d*f)*Math.sin(Si(p/2)),L=(i+s)/2,g=(d+f)/2,d*f==0?E=v+b:(w=Math.abs(I(v-b,12)),w>180?b+v<360?E=v+b+360:E=v+b-360:E=v+b,E/=2),x=1-.17*Math.cos(Si(E-30))+.24*Math.cos(Si(2*E))+.32*Math.cos(Si(3*E+6))-.2*Math.cos(Si(4*E-63)),O=30*Math.exp(-((E-275)/25)*((E-275)/25)),Y=2*Math.sqrt((g^7)/((g^7)+30)),k=1+.015*((L-50)*(L-50))/Math.sqrt(20+(L-50)*(L-50)),P=1+.045*g,j=1+.015*g*x,tt=-Math.sin(Si(2*O))*Y,S=S/(a*k),$=$/(h*P),p=p/(u*j),Math.sqrt(S*S+$*$+p*p+tt*$*p)}function Qt(){const e=arguments;if(typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="number"){let t=[e[0],e[1],e[2]];return typeof e[3]=="number"&&t.push(e[3]),typeof e[3]=="string"&&(e[3]==="hsva"&&(t=Ci(t,"hsva")),e[3]==="rgba255"&&(t=Ci(t,"rgba255"))),typeof e[4]=="string"&&(e[4]==="hsva"&&(t=Ci(t,"hsva")),e[4]==="rgba255"&&(t=Ci(t,"rgba255"))),t}if(typeof e[0]=="number")return typeof e[1]=="boolean"&&e[1]?[e[0]/255,e[0]/255,e[0]/255]:typeof e[1]=="number"?[e[0],e[0],e[0],e[1]]:[e[0],e[0],e[0]];if(typeof e[0]=="string")return ul(e[0]);if(Array.isArray(e[0])){const t=e[0];let i=[t[0],t[1],t[2]];if(!i.every(n=>typeof n=="number"))throw new Error("Unable to parse color; array contain undefined or non-numeric value");return typeof t[3]=="number"&&i.push(t[3]),typeof e[1]=="string"&&(e[1]==="hsva"&&(i=Ci(i,"hsva")),e[1]==="rgba255"&&(i=Ci(i,"rgba255"))),i}if(typeof e[0]=="object"){const t=e[0];if("type"in t)switch(t.type){case"hsva":return Qt(t.value,"hsva");case"rgba":return Qt(t.value,"rgba");case"rgba255":return Qt(t.value,"rgba255")}if("r"in t&&"g"in t&&"b"in t){const i=[t.r,t.g,t.b];if(!i.every(n=>typeof n=="number"))throw new Error("Unable to parse color; array contain undefined or non-numeric value");return typeof t.a=="number"&&i.push(t.a),i}}throw new Error("Unable to parse color; input is invalid")}function Tt(e){if(!e)return"0:00";const t=Math.floor(e),i=t/60,n=i<0?`-${Math.ceil(i).toString()}`:Math.floor(i).toString(),r=Math.abs(t%60).toString().padStart(2,"0");return`${n}:${r}`}function Lh(e){if(!e)return"0:00:00";const t=Math.abs(Math.round(e*60%60)).toString().padStart(2,"0");return`${Tt(e>0?Math.floor(e):Math.ceil(e))}:${t}`}function Jn(e){var i;if(!e)return"0:00.000";const t=((i=(e%1).toString().split(".")[1])==null?void 0:i.padEnd(3,"0").slice(0,3))||"000";return`${Tt(e>0?Math.floor(e):Math.ceil(e))}.${t}`}function hl(e){const t=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(e=e.trim(),/^http:\/\//.test(e)&&(e=e.replace("http://","https://")),t.test(e))return e;throw new Error("Invalid URL")}function fl(e){const t=/^[0-9a-fA-F]{1,6}$/;if(e=e.trim(),/^!bsr /.test(e)&&(e=e.replace("!bsr ","")),t.test(e))return e;throw new Error("Invalid ID")}function er(e){for(let t=e.options.length-1;t>=0;t--)e.remove(t)}const Zr=document.querySelector(".intro"),Qr=document.querySelector(".metadata"),Ti=document.querySelector(".cover__link"),ml=document.querySelector(".cover__image"),xh=document.querySelector(".metadata__song-name"),kh=document.querySelector(".metadata__song-subname"),Rh=document.querySelector(".metadata__song-author"),Bh=document.querySelector(".metadata__song-bpm"),ts=document.querySelector(".metadata__song-duration"),dl=document.querySelector(".audio");function pl(e){e?(Zr.classList.remove("hidden"),Qr.classList.add("hidden")):(Zr.classList.add("hidden"),Qr.classList.remove("hidden"))}function gl(e){ml.src=e||"./img/unknown.jpg"}function Nh(){return ml.src}function _l(e,t){if(e==null&&t==null){Ti.textContent="",Ti.href="",Ti.classList.add("disabled");return}e!=null&&(Ti.textContent=t??"Download Link",Ti.href=e,Ti.classList.remove("disabled"))}function Ah(e){xh.textContent=e}function Ih(e){kh.textContent=e}function Oh(e){Rh.textContent=e}function $h(e,t,i){t==null&&typeof i=="number"&&(t=Math.min(e,i)),i==null&&typeof t=="number"&&(i=Math.max(e,t));let n=I(e,2).toString()+"BPM";t&&i&&(n+=` (${I(t,2)}-${I(i,2)})`),Bh.textContent=n}function bl(e){e?ts.textContent=Jn(e):ts.textContent="No audio"}async function Ph(e){const t=new Blob([e],{type:"audio/ogg"});dl.src=window.URL.createObjectURL(t)}function vl(){dl.src="",window.URL.revokeObjectURL("")}function Mh(){pl(!0),gl(null),_l(),bl(0),vl()}const Nt={switchHeader:pl,setCoverImage:gl,getCoverImage:Nh,setCoverLink:_l,setSongName:Ah,setSongSubname:Ih,setSongAuthor:Oh,setSongBPM:$h,setSongDuration:bl,setAudio:Ph,unloadAudio:vl,reset:Mh},Gi=new class{constructor(){this.loading={info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1}}resetLoad(){this.loading.info=!1,this.loading.difficulty=!1,this.loading.analysis=!1,this.loading.audio=!1,this.loading.coverImage=!1,this.loading.contributorImage=!1,this.loading.finished=!1}},lt=new class{constructor(){this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}retrieveSafe(){if(!this.beatmapInfo)throw new Error("Beatmap info is not loaded.");if(!this.analysis)throw new Error("Beatmap analysis is not loaded.");if(this.duration===null)throw new Error("Audio is not loaded.");if(Gi.loading.finished)return{beatmapInfo:this.beatmapInfo,beatmapDifficulty:this.beatmapDifficulty,contributors:this.contributors,analysis:this.analysis,duration:this.duration};throw new Error("Could not retrieve saved data, loading process is not finished.")}clear(){Gi.loading.finished=!1,this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}};var yl=(e,t,i)=>{if(!t.has(e))throw TypeError("Cannot "+i)},me=(e,t,i)=>(yl(e,t,"read from private field"),i?i.call(e):t.get(e)),Ho=(e,t,i)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,i)},$n=(e,t,i,n)=>(yl(e,t,"write to private field"),n?n.call(e,i):t.set(e,i),i),ki,qn,_e,El=(e=>(e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.NONE=5]="NONE",e))(El||{});const dr=class Kn{constructor(){Ho(this,ki,2),Ho(this,qn,(t,i)=>`${Kn.LogPrefixes.get(i)} > [${t.join("::")}]`),Ho(this,_e,"script")}set logLevel(t){$n(this,ki,t),this.tInfo(["logger","logLevel"],`Log level set to ${Kn.LogPrefixes.get(t)}`)}get logLevel(){return me(this,ki)}set tagPrint(t){$n(this,qn,t),this.tInfo(["logger","tagPrint"],"Update tag print function")}get tagPrint(){return me(this,qn)}set untagged(t){$n(this,_e,t.trim()),this.tInfo(["logger","untagged"],`Update untagged string to ${me(this,_e)}`)}get untagged(){return me(this,_e)}log(t,i,...n){if(t<me(this,ki))return;const r=[this.tagPrint(i,t),...n];switch(t){case 1:return console.debug(...r);case 2:return console.info(...r);case 3:return console.warn(...r);case 4:return console.error(...r);default:return console.log(...r)}}setLevel(t){t=Math.min(Math.max(t,0),5),$n(this,ki,t),this.tInfo(["logger","setLevel"],`Log level set to ${Kn.LogPrefixes.get(t)}`)}tVerbose(t,...i){this.log(0,t,...i)}tDebug(t,...i){this.log(1,t,...i)}tInfo(t,...i){this.log(2,t,...i)}tWarn(t,...i){this.log(3,t,...i)}tError(t,...i){this.log(4,t,...i)}verbose(...t){this.tVerbose([me(this,_e)],...t)}debug(...t){this.tDebug([me(this,_e)],...t)}info(...t){this.tInfo([me(this,_e)],...t)}warn(...t){this.tWarn([me(this,_e)],...t)}error(...t){this.tError([me(this,_e)],...t)}};ki=new WeakMap;qn=new WeakMap;_e=new WeakMap;dr.LogLevels=El;dr.LogPrefixes=new Map([[0,"VERBOSE"],[1,"DEBUG"],[2,"INFO"],[3,"WARN"],[4,"!!ERROR!!"],[5,"NONE"]]);let Fh=dr;const J=new Fh;function Wh(e){return["beatmap","shared","bpm",e]}const ir=class{constructor(t,i=[],n=0){this._bpm=t,this._offset=n/1e3,this._timeScale=this.getTimeScale(i.filter(r=>("m"in r||"bpm"in r||"timescale"in r)&&!("o"in r))),this._bpmChange=this.getBpmChangeTime(i.filter(r=>"BPM"in r&&"metronomeOffset"in r||("_bpm"in r||"_BPM"in r)&&"_metronomeOffset"in r||"m"in r&&"o"in r)),this._timeScale.length&&this._bpmChange.length&&J.tWarn(Wh("constructor"),"BPM change and BPM event should not be used along side together to avoid confusion between editors and in-game behaviour")}get value(){return this._bpm}set value(t){this._bpm=t}get change(){return this._bpmChange}set change(t){this._bpmChange=this.getBpmChangeTime(t)}get timescale(){return this._timeScale}set timescale(t){this._timeScale=this.getTimeScale(t)}get offset(){return this._offset*1e3}set offset(t){this._offset=t/1e3}getBpmChangeTime(t=[]){let i;const n=[];t=[...t].sort((r,s)=>(r.time??r._time??r.b)-(s.time??s._time??s.b));for(let r=0;r<t.length;r++){const s={time:t[r].time??t[r]._time??t[r].b,BPM:t[r].BPM??t[r]._BPM??t[r]._bpm??t[r].m,beatsPerBar:t[r].beatsPerBar??t[r]._beatsPerBar??t[r].p,metronomeOffset:t[r].metronomeOffset??t[r]._metronomeOffset??t[r].o,newTime:0};i?s.newTime=Math.ceil((s.time-i.time)/this._bpm*i.BPM+i.newTime-.01):s.newTime=Math.ceil(s.time-this._offset*this._bpm/60-.01),n.push(s),i=s}return n}getTimeScale(t=[]){return[...t].sort((i,n)=>(i.time??i.b)-(n.time??n.b)).map(i=>"scale"in i?i:"bpm"in i?{time:i.time,scale:this._bpm/i.bpm}:{time:i.b||0,scale:this._bpm/i.m})}offsetBegone(t){return this.toBeatTime(this.toRealTime(t,!1)-this._offset)}toRealTime(t,i=!0){if(!i)return t/this._bpm*60;let n=0;for(let r=this._timeScale.length-1;r>=0;r--)t>this._timeScale[r].time&&(n+=(t-this._timeScale[r].time)*this._timeScale[r].scale,t=this._timeScale[r].time);return(t+n)/this._bpm*60}toBeatTime(t,i=!1){if(!i)return t*this._bpm/60;let n=0;for(let r=this._timeScale.length-1;r>=0;r--){const s=this.toRealTime(this._timeScale[r].time);t>s&&(n+=(t-s)/this._timeScale[r].scale,t=s)}return this.toBeatTime(t+n)}toJsonTime(t){for(let i=this._bpmChange.length-1;i>=0;i--)if(t>this._bpmChange[i].newTime)return(t-this._bpmChange[i].newTime)/this._bpmChange[i].BPM*this._bpm+this._bpmChange[i].time;return this.toBeatTime(this.toRealTime(t,!1)+this._offset)}adjustTime(t){for(let i=this._bpmChange.length-1;i>=0;i--)if(t>this._bpmChange[i].time)return(t-this._bpmChange[i].time)/this._bpm*this._bpmChange[i].BPM+this._bpmChange[i].newTime;return this.offsetBegone(t)}};ir.create=(e,t,i)=>new ir(e,t,i);let yi=ir;const lo={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",QueenEnvironment:"Queen",LinkinPark2Environment:"Linkin Park 2.0",TheRollingStonesEnvironment:"The Rolling Stones",GlassDesertEnvironment:"Glass Desert",MultiplayerEnvironment:"Origins"},gi={DefaultEnvironment:[[0,1,2,3,4,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MultiplayerEnvironment:[[4],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],TheSecondEnvironment:[[0,1,2,3,4,9],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],LizzoEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,16,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]],TheWeekndEnvironment:[[0,1,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,29,30,31,32,33,34,35,36,37,38,40]],RockMixtapeEnvironment:[[3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]],Dragons2Environment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12]],Panic2Environment:[[3],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]],QueenEnvironment:[[6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],LinkinPark2Environment:[[3,40,41],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]],TheRollingStonesEnvironment:[[6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]]},es=document.querySelector(".info__level-author"),Go=document.querySelector(".info__environment"),jo=document.querySelector(".info__editors"),Xo=document.querySelector(".info__contributors"),nr=document.querySelector(".info__contributors-select"),Hh=document.querySelector(".info__contributors-image"),Gh=document.querySelector(".info__contributors-name"),jh=document.querySelector(".info__contributors-role");nr.addEventListener("change",Uh);function Dl(e){if(!e){es.textContent="";return}es.textContent="Mapped by "+e}function wl(e){if(!e){Go.textContent="";return}Go.textContent=(lo[e]||"Unknown")+" Environment",lo[e]||(Go.textContent+=` (${e})`)}function Sl(e){if(!e||!e._lastEditedBy){jo.classList.add("hidden");return}jo.classList.remove("hidden");const t=e._lastEditedBy||"Undefined";let i="Last edited on "+t;if(e[t]){const n=e[t];i+=" v"+n.version}jo.textContent=i}function Xh(e){Hh.src=e||"./img/unknown.jpg"}function zh(e){Gh.textContent=e}function Yh(e){jh.textContent=e}function Cl(e){Xh(e._base64?"data:image;base64,"+e._base64:null),zh(e._name),Yh(e._role)}function Tl(e){if(Xo&&(!e||!e.length)){Xo.classList.add("hidden"),er(nr);return}if(e){Xo.classList.remove("hidden");let t=!0;e.forEach((i,n)=>{t&&(t=!1,Cl(i));const r=document.createElement("option");r.value=n.toString(),r.text=i._name+" -- "+i._role,nr.add(r)})}}function Uh(e){const t=e.target;Cl(lt.contributors[parseInt(t.value)])}const en={version:3,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",infoRowHeight:4,rounding:3,dataCheck:!0,dataError:!0,theme:"Dark",onLoad:{stats:!1},show:{info:!1,tools:!1,stats:!1,settings:!1}},it=new class{constructor(){this.property=K(en),this.stringify=()=>JSON.stringify({settings:this.property}),this.init=()=>{var i;if(localStorage==null)return;const t=localStorage.getItem("settings");if(t){const n=JSON.parse(t);if(!((i=n.settings)!=null&&i.version)){this.clear();return}this.property=n.settings??this.property;for(const r in en)typeof this.property[r]>"u"&&(this.property[r]=en[r]);this.property.version=en.version,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this.property=K(en)},this.init()}get version(){return this.property.version}get load(){return this.property.load}get sorting(){return this.property.sorting}set sorting(t){this.property.sorting=t}get beatNumbering(){return this.property.beatNumbering}set beatNumbering(t){this.property.beatNumbering=t}get infoRowHeight(){return this.property.infoRowHeight}set infoRowHeight(t){this.property.infoRowHeight=t}get rounding(){return this.property.rounding}set rounding(t){this.property.rounding=t}get dataCheck(){return this.property.dataCheck}set dataCheck(t){this.property.dataCheck=t}get dataError(){return this.property.dataError}set dataError(t){this.property.dataError=t}get theme(){return this.property.theme}set theme(t){this.property.theme=t}get onLoad(){return this.property.onLoad}get show(){return this.property.show}};var Ll=(e=>(e.tiny="panel--tiny",e.small="panel--small",e.medium="panel--medium",e.large="panel--large",e.max="panel--max",e))(Ll||{}),xl=(e=>(e.normal="panel--offset",e.half="panel--offset-half",e.none="",e))(xl||{});const Hi={create:(e,t,i,n)=>{const r=document.createElement("div");return r.className=`panel ${Ll[e]}`,t&&t!=="none"&&r.classList.add(xl[t]),i&&r.classList.add("panel--flex"+n?"-column":""),r}},is=document.querySelector(".info__version"),ns=document.querySelector(".info__environmentId"),os=document.querySelector(".info__play-time"),rs=document.querySelector(".info__time-spend"),ss=document.querySelector(".info__color-scheme"),as=document.querySelector(".info__custom-color"),ls=document.querySelector(".info__requirements"),cs=document.querySelector(".info__suggestions"),us=document.querySelector(".info__information"),hs=document.querySelector(".info__warnings"),fs=document.querySelector(".info__bookmarks"),ms=document.querySelector(".info__bpm-changes"),ds=document.querySelector(".info__environment-enhancement"),ps=document.querySelector(".info__point-definitions"),gs=document.querySelector(".info__custom-events"),Vh=document.querySelectorAll(".info__table-element");function $t(e){const t=e.querySelector(".info__table-element");t&&(t.innerHTML=""),e.classList.add("hidden")}function Pt(e,t){const i=e.querySelector(".info__table-element");if(i){for(;i.firstChild;)i.removeChild(i.firstChild);typeof t=="string"?i.textContent=t:(t.forEach(n=>{if(typeof n=="string"){const r=document.createElement("span");r.textContent=n,i.appendChild(r),i.appendChild(document.createElement("br"))}else i.appendChild(n),i.appendChild(document.createElement("br"))}),i.lastChild&&i.removeChild(i.lastChild))}e.classList.remove("hidden")}function kl(e){Vh.forEach(t=>t.style.maxHeight=`${e}rem`)}function Rl(e,t){if(e==null||!e.length){$t(fs);return}const i=Hi.create("max","none",!0);e.forEach((n,r)=>{let s=n.b,l;const o=document.createElement("div"),a=document.createElement("div"),h=document.createElement("div");o.appendChild(a),o.appendChild(h),a.className="info__color-dot",a.style.backgroundColor="#000000",h.className="info__color-text",typeof n.n!="string"&&(h.textContent=`Error parsing bookmarks[${r}]`,i.appendChild(o)),t&&(s=t.adjustTime(s),l=t.toRealTime(s)),a.style.backgroundColor=n.c?vt({r:n.c[0],g:n.c[1],b:n.c[2]}):"#333333",h.textContent=`${I(n.b,it.rounding)}${l?" | "+Tt(l):""} -- ${n.n!=""?n.n:"**EMPTY NAME**"}`,i.appendChild(o)}),Pt(fs,[i])}function Bl(e){if(!e||!e.change.length){$t(ms);return}const t=e.change.map(i=>{const n=I(i.newTime,it.rounding),r=e.toRealTime(i.time);return`${n} | ${Tt(r)} -- ${i.BPM}`});Pt(ms,t)}const re={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",QueenEnvironment:"Queen",LinkinPark2Environment:"Linkin Park 2.0",TheRollingStonesEnvironment:"The Rolling Stones",GlassDesertEnvironment:"Glass Desert",MultiplayerEnvironment:"Origins"},Nl={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},se={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.5320754,g:.5320754,b:.5320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"The Second":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8235294,g:.08627451,b:.8509804},_envColorRightBoost:{r:0,g:1,b:.6478302},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Lizzo:{_colorLeft:{r:1,g:.8132076,b:.3773585},_colorRight:{r:.6705883,g:.254902,b:.8980392},_envColorLeft:{r:.8392157,g:.6470588,b:.2156863},_envColorRight:{r:.8196079,g:.2392157,b:.8784314},_envColorLeftBoost:{r:1,g:.4,b:.5529412},_envColorRightBoost:{r:.3686275,g:.7960784,b:1},_obstacleColor:{r:1,g:.5020987,b:.1882353}},"The Weeknd":{_colorLeft:{r:.5843138,g:.1294118,b:.1294118},_colorRight:{r:.2235294,g:.2901961,b:.3294118},_envColorLeft:{r:1,g:.2979701,b:.1411765},_envColorRight:{r:.1668743,g:.3753689,b:.7075472},_envColorWhite:{r:.8773585,g:.8773585,b:.8773585},_envColorLeftBoost:{r:.9568628,g:.6039216,b:.1215686},_envColorRightBoost:{r:.5254902,g:.8274511,b:.9921569},_envColorWhiteBoost:{r:.9811321,g:.9308866,b:.8608046},_obstacleColor:{r:.9176471,g:.2980392,b:.007843138}},"Rock Mixtape":{_colorLeft:{r:.6,g:.4233,b:.042},_colorRight:{r:.6006,g:.7441199,b:.78},_envColorLeft:{r:.75,g:.12,b:.162},_envColorRight:{r:.95,g:.5820333,b:.1615},_envColorLeftBoost:{r:.96,g:.1344,b:.9187202},_envColorRightBoost:{r:.378,g:.813,b:.9},_obstacleColor:{r:1,g:1,b:1}},"Dragons 2.0":{_colorLeft:{r:.7264151,g:.6587077,b:.2809719},_colorRight:{r:.2509804,g:.7647059,b:.405098},_envColorLeft:{r:.01960784,g:.9960785,b:.06666667},_envColorRight:{r:0,g:.05490196,b:1},_envColorLeftBoost:{r:.9764706,g:.03137255,b:.01960784},_envColorRightBoost:{r:1,g:.8292086,b:.2264151},_obstacleColor:{r:.5548979,g:.2470588,b:1}},"Panic 2.0":{_colorLeft:{r:.9019608,g:.3333333,b:.5686275},_colorRight:{r:.1529412,g:.5568628,b:.4862745},_envColorLeft:{r:.6980392,g:.1137255,b:.372549},_envColorRight:{r:.1882353,g:.6196079,b:.6235294},_envColorWhite:{r:.8329412,g:.9008105,b:.9254902},_envColorLeftBoost:{r:.9019608,g:.4470589,b:.06666667},_envColorRightBoost:{r:.6365692,g:.4373443,b:.8584906},_envColorWhiteBoost:{r:.8803849,g:.8313726,b:.9254902},_obstacleColor:{r:.9686275,g:.3803922,b:.2745098}},Queen:{_colorLeft:{r:.58,g:.5675714,b:.5551428},_colorRight:{r:.5236231,g:.1345675,b:.6792453},_envColorLeft:{r:.9333334,g:.6392157,b:.1215686},_envColorRight:{r:.04313726,g:.7176471,b:.8980393},_envColorLeftBoost:{r:.7686275,g:.145098,b:.07450981},_envColorRightBoost:{r:.4,g:.007843138,b:.7254902},_obstacleColor:{r:.9333334,g:.6392157,b:.1215686}},"Linkin Park 2.0":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.6627451,g:.1647059,b:.172549},_envColorRight:{r:.6235294,g:.6901961,b:.7098039},_envColorWhite:{r:.7529413,g:.6745098,b:.5921569},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},"The Rolling Stones":{_colorLeft:{r:.8980392,g:0,b:.1150319},_colorRight:{r:.5254902,g:.1333333,b:.6784314},_envColorLeft:{r:.9529412,g:.01176471,b:.4039216},_envColorRight:{r:.4784314,g:.4039216,b:1},_envColorLeftBoost:{r:.5647059,g:.4622677,b:0},_envColorRightBoost:{r:.003921554,g:.6383545,b:.6705883},_obstacleColor:{r:.9529412,g:.01176471,b:.4039216}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}};function Al(e,t){var h,u,d,f,c,g,_;if(!e||!e._colorLeft&&!e._colorRight&&!e._envColorLeft&&!e._envColorLeftBoost&&!e._envColorRight&&!e._envColorRightBoost&&!e._envColorWhite&&!e._envColorWhiteBoost&&!e._obstacleColor){$t(as);return}t||(t="DefaultEnvironment");const i={_colorLeft:((h=se[re[t]])==null?void 0:h._colorLeft)||null,_colorRight:((u=se[re[t]])==null?void 0:u._colorRight)||null,_envColorLeft:((d=se[re[t]])==null?void 0:d._envColorLeft)||null,_envColorRight:((f=se[re[t]])==null?void 0:f._envColorRight)||null,_envColorWhite:null,_envColorLeftBoost:((c=se[re[t]])==null?void 0:c._envColorLeftBoost)||null,_envColorRightBoost:((g=se[re[t]])==null?void 0:g._envColorRightBoost)||null,_envColorWhiteBoost:null,_obstacleColor:((_=se[re[t]])==null?void 0:_._obstacleColor)||null},n={_colorLeft:i._colorLeft?vt(i._colorLeft):null,_colorRight:i._colorRight?vt(i._colorRight):null,_envColorLeft:i._envColorLeft?vt(i._envColorLeft):null,_envColorRight:i._envColorRight?vt(i._envColorRight):null,_envColorWhite:null,_envColorLeftBoost:i._envColorLeftBoost?vt(i._envColorLeftBoost):null,_envColorRightBoost:i._envColorRightBoost?vt(i._envColorRightBoost):null,_envColorWhiteBoost:null,_obstacleColor:i._obstacleColor?vt(i._obstacleColor):null},r={noteColor:!!(e._colorLeft||e._colorRight),eventColor:!!(e._envColorLeft||e._envColorRight),eventBoostColor:!!(e._envColorLeftBoost||e._envColorRightBoost),obstacleColor:!!e._obstacleColor};e._colorLeft&&(n._colorLeft=vt(e._colorLeft)),e._colorRight&&(n._colorRight=vt(e._colorRight)),e._envColorLeft?n._envColorLeft=vt(e._envColorLeft):e._colorLeft&&(n._envColorLeft=vt(e._colorLeft)),e._envColorRight?n._envColorRight=vt(e._envColorRight):e._colorRight&&(n._envColorRight=vt(e._colorRight));let s,l,o=!1;e._envColorLeftBoost?(s=vt(e._envColorLeftBoost),o=!0):s=i._envColorLeftBoost?vt(i._envColorLeftBoost):n._envColorLeft,e._envColorRightBoost?(l=vt(e._envColorRightBoost),o=!0):l=i._envColorRightBoost?vt(i._envColorRightBoost):n._envColorRight,e._envColorWhite&&(n._envColorWhite=vt(e._envColorWhite)),e._envColorWhiteBoost&&(n._envColorWhiteBoost=vt(e._envColorWhiteBoost)),o&&(n._envColorLeftBoost=s,n._envColorRightBoost=l),e._obstacleColor&&(n._obstacleColor=vt(e._obstacleColor)),r.noteColor||(n._colorLeft=null,n._colorRight=null),r.eventColor||(n._envColorLeft=null,n._envColorRight=null),r.noteColor&&!r.eventColor&&(n._envColorLeft=n._colorLeft,n._envColorRight=n._colorRight),r.obstacleColor||(n._obstacleColor=null);const a=Hi.create("max","none",!0);for(const v in n){if(!n[v])continue;const b=document.createElement("div"),E=document.createElement("div"),w=document.createElement("div"),L=document.createElement("div");E.className="info__color-dot",E.style.backgroundColor=n[v]||"#000000",w.className="info__color-text info__color-text--monospace",w.textContent=`${n[v]}`,L.className="info__color-text",L.textContent=` -- ${Nl[v]}`,b.appendChild(E),b.appendChild(w),b.appendChild(L),a.appendChild(b)}Pt(as,[a])}var Il=(e=>(e.duplicate="D",e.active="A",e.scale="S",e.position="P",e.localPosition="Lp",e.rotation="R",e.localRotation="Lr",e.lightID="Li",e.track="T",e))(Il||{}),Ol=(e=>(e.childrenTracks="Ct",e.color="C",e.definitePosition="Dp",e.dissolve="D",e.dissolveArrow="Da",e.duration="Dur",e.easing="E",e.interactable="I",e.localRotation="Lr",e.parentTrack="Pt",e.position="P",e.rotation="R",e.scale="S",e.time="T",e.track="Tr",e.worldPositionStays="Wps",e))(Ol||{});function $l(e,t){if(e==null||!e.length){$t(gs);return}const i=e.map((n,r)=>{let s=n.b,l;t&&(s=t.adjustTime(s),l=t.toRealTime(s));const o=[];if(!n.d)return`Error parsing customEvents[${r}]`;for(const a in n.d){if(a=="_duration"||a=="_easing"||a=="_track"||a=="duration"||a=="easing"||a=="track")continue;const h=Ol[a];n.d[a]!=null&&o.push(h)}return`${I(n.b,it.rounding)}${l?" | "+Tt(l):""} -- ${n.t} -> [${o.join("")}]${n.t!=="AssignTrackParent"?`(${n.d.track})`:""}`});Pt(gs,i)}function Pl(e){if(e==null||!e.length){$t(ds);return}const t=e.map((i,n)=>{const r=[];if(!i.id&&!i.geometry)return`Error parsing environment[${n}]`;for(const s in i){if(s=="lookupMethod"||s=="id"||s=="geometry")continue;const l=Il[s];i[s]!=null&&r.push(l)}return`${i.geometry?"Geometry":i.lookupMethod} [${r.join("")}]${i.track?`(${i.track})`:""} -> ${i.geometry?i.geometry.type:i.id}`});Pt(ds,t)}function Ml(e){if(e==null){$t(is);return}Pt(is,e)}function Fl(e){if(e==null){$t(ns);return}let t=(lo[e]||"Unknown")+" Environment";lo[e]||(t+=` (${e})`),Pt(ns,t)}function Wl(e){if(e==null){$t(rs);return}Pt(rs,Lh(e))}function Hl(e){if(e==null||!e.length){$t(ls);return}Pt(ls,e.join(", "))}function Gl(e){if(e==null||!e.length){$t(cs);return}Pt(cs,e.join(", "))}function jl(e){if(e==null||!e.length){$t(us);return}Pt(us,e)}function Xl(e){if(e==null||!e.length){$t(hs);return}Pt(hs,e)}function zl(e){if(e==null){$t(ps);return}const t=[];for(const i in e){e[i]||t.push(`Error parsing pointDefinitions[${i}]`);const n=e[i];Array.isArray(n)||t.push(`Error parsing pointDefinitions[${i}]`),t.push(`${i} -- ${n.length} point${n.length>1?"s":""}`)}Pt(ps,t)}function Yl(e,t){if(e==null||t==null){$t(os);return}Pt(os,`${Tt(e)} to ${Tt(t)}${lt.duration?` -- [ ${Tt(t-e)} / ${Tt(lt.duration)} ]`:""}`)}function Ul(e){if(!e||!e.saberLeftColor&&!e.saberRightColor&&!e.environment0Color&&!e.environment0ColorBoost&&!e.environment1Color&&!e.environment1ColorBoost&&!e.environmentWColor&&!e.environmentWColorBoost&&!e.obstaclesColor){$t(ss);return}const t={};t.saberLeftColor=vt(e.saberLeftColor),t.saberRightColor=vt(e.saberRightColor),t.environment0Color=vt(e.environment0Color),t.environment1Color=vt(e.environment1Color),t.environment0ColorBoost=vt(e.environment0ColorBoost),t.environment1ColorBoost=vt(e.environment1ColorBoost),t.obstaclesColor=vt(e.obstaclesColor),e.environmentWColor&&(t.environmentWColor=vt(e.environmentWColor)),e.environmentWColorBoost&&(t.environmentWColorBoost=vt(e.environmentWColorBoost));const i=Hi.create("max","none",!0);for(const n in t){if(!t[n])continue;const r=document.createElement("div"),s=document.createElement("div"),l=document.createElement("div"),o=document.createElement("div");s.className="info__color-dot",s.style.backgroundColor=t[n]||"#000000",l.className="info__color-text info__color-text--monospace",l.textContent=`${t[n]}`,o.className="info__color-text",o.textContent=` -- ${Nl[n]}`,r.appendChild(s),r.appendChild(l),r.appendChild(o),i.appendChild(r)}Pt(ss,[i])}function Jh(e){Nt.setSongName(e.songName),Nt.setSongSubname(e.songSubName),Nt.setSongAuthor(e.songAuthorName),Nt.setSongBPM(e.beatsPerMinute),Dl(e.levelAuthorName),wl(e.environmentName),Sl(e.customData._editors)}function Vl(e,t){var i,n,r;if(Ml(t.rawData._version||t.rawData.version||"Unknown"),Fl(e.environmentNames.at(t.info.environmentId)),Ul((i=e.colorSchemes.at(t.info.colorSchemeId))==null?void 0:i.colorScheme),t.info.customData&&(Al(t.info.customData),Hl(t.info.customData._requirements),Gl(t.info.customData._suggestions),jl(t.info.customData._information),Xl(t.info.customData._warnings)),(n=t.data)!=null&&n.customData){const s=(r=lt.beatmapInfo)!=null&&r.beatsPerMinute?yi.create(lt.beatmapInfo.beatsPerMinute,t.data.customData._bpmChanges||t.data.customData._BPMChanges||t.data.customData.BPMChanges):null;Wl(t.data.customData._time??t.data.customData.time),Rl(t.data.customData._bookmarks??t.data.customData._bookmarks,s),Bl(s),Pl(t.data.customData.environment),zl(t.data.customData.pointDefinitions),$l(t.data.customData.customEvents,s)}Yl(t.bpm.toRealTime(t.data.getFirstInteractiveTime()),t.bpm.toRealTime(t.data.getLastInteractiveTime()))}function qh(){Dl(),wl(),Sl(),Tl(),Ml(),Fl(),Yl(),Wl(),Ul(),Al(),Hl(),Gl(),jl(),Xl(),Rl(),Bl(),Pl(),zl(),$l()}const Pn={enable:e=>{document.querySelectorAll(".input-toggle").forEach(i=>{i.disabled=!e})}},nn=document.querySelector(".loading__bar"),_s="loading__bar--error",bs="loading__bar--download",Kh=document.querySelector(".loading__text");function Jl(e,t,i=100){Kh.textContent=t,nn.style.width=`${i}%`,e==="error"?nn.classList.add(_s):nn.classList.remove(_s),e==="download"?nn.classList.add(bs):nn.classList.remove(bs)}function Zh(){Jl("info","No map loaded",0)}const Dt={status:Jl,reset:Zh};var pt=(e=>(e[e.GENERAL_AUDIO=0]="GENERAL_AUDIO",e[e.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",e[e.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",e[e.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",e[e.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",e[e.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",e[e.OTHERS_HOT_START=6]="OTHERS_HOT_START",e[e.OTHERS_NJS=7]="OTHERS_NJS",e[e.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",e[e.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",e[e.EVENTS_INVALID_EVENT_BOX=10]="EVENTS_INVALID_EVENT_BOX",e[e.EVENTS_UNLIT_BOMB=11]="EVENTS_UNLIT_BOMB",e[e.NOTES_EFFECTIVE_BPM=12]="NOTES_EFFECTIVE_BPM",e[e.NOTES_ACCEPTABLE_PRECISION=13]="NOTES_ACCEPTABLE_PRECISION",e[e.NOTES_PARITY=14]="NOTES_PARITY",e[e.NOTES_VARY_SWING=15]="NOTES_VARY_SWING",e[e.NOTES_SLOW_SLIDER=16]="NOTES_SLOW_SLIDER",e[e.NOTES_INLINE_ANGLE=17]="NOTES_INLINE_ANGLE",e[e.NOTES_SHRADO_ANGLE=18]="NOTES_SHRADO_ANGLE",e[e.NOTES_SPEED_PAUSE=19]="NOTES_SPEED_PAUSE",e[e.NOTES_IMPROPER_ARC=20]="NOTES_IMPROPER_ARC",e[e.NOTES_IMPROPER_CHAIN=21]="NOTES_IMPROPER_CHAIN",e[e.NOTES_IMPROPER_WINDOW=22]="NOTES_IMPROPER_WINDOW",e[e.NOTES_HITBOX_STAIR=23]="NOTES_HITBOX_STAIR",e[e.NOTES_HITBOX_REVERSE_STAIR=24]="NOTES_HITBOX_REVERSE_STAIR",e[e.NOTES_HITBOX_INLINE=25]="NOTES_HITBOX_INLINE",e[e.NOTES_HITBOX_PATH=26]="NOTES_HITBOX_PATH",e[e.NOTES_COLOR_CHECK=27]="NOTES_COLOR_CHECK",e[e.NOTES_STACKED_NOTE=28]="NOTES_STACKED_NOTE",e[e.NOTES_DOUBLE_DIRECTIONAL=29]="NOTES_DOUBLE_DIRECTIONAL",e[e.NOTES_VISION_BLOCK=30]="NOTES_VISION_BLOCK",e[e.OBSTACLES_SHORT=31]="OBSTACLES_SHORT",e[e.OBSTACLES_CENTER=32]="OBSTACLES_CENTER",e[e.OBSTACLES_ZERO=33]="OBSTACLES_ZERO",e[e.OBSTACLES_NEGATIVE=34]="OBSTACLES_NEGATIVE",e))(pt||{}),gt=(e=>(e[e.GENERAL_AUDIO=0]="GENERAL_AUDIO",e[e.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",e[e.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",e[e.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",e[e.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",e[e.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",e[e.OTHERS_HOT_START=6]="OTHERS_HOT_START",e[e.OTHERS_NJS=7]="OTHERS_NJS",e[e.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",e[e.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",e[e.EVENTS_INVALID_EVENT_BOX=10]="EVENTS_INVALID_EVENT_BOX",e[e.EVENTS_UNLIT_BOMB=11]="EVENTS_UNLIT_BOMB",e[e.NOTES_COLOR_CHECK=12]="NOTES_COLOR_CHECK",e[e.NOTES_EFFECTIVE_BPM=13]="NOTES_EFFECTIVE_BPM",e[e.NOTES_ACCEPTABLE_PRECISION=14]="NOTES_ACCEPTABLE_PRECISION",e[e.NOTES_PARITY=15]="NOTES_PARITY",e[e.NOTES_VARY_SWING=16]="NOTES_VARY_SWING",e[e.NOTES_SLOW_SLIDER=17]="NOTES_SLOW_SLIDER",e[e.NOTES_INLINE_ANGLE=18]="NOTES_INLINE_ANGLE",e[e.NOTES_SHRADO_ANGLE=19]="NOTES_SHRADO_ANGLE",e[e.NOTES_SPEED_PAUSE=20]="NOTES_SPEED_PAUSE",e[e.NOTES_IMPROPER_ARC=21]="NOTES_IMPROPER_ARC",e[e.NOTES_IMPROPER_CHAIN=22]="NOTES_IMPROPER_CHAIN",e[e.NOTES_IMPROPER_WINDOW=23]="NOTES_IMPROPER_WINDOW",e[e.NOTES_HITBOX_STAIR=24]="NOTES_HITBOX_STAIR",e[e.NOTES_HITBOX_REVERSE_STAIR=25]="NOTES_HITBOX_REVERSE_STAIR",e[e.NOTES_HITBOX_INLINE=26]="NOTES_HITBOX_INLINE",e[e.NOTES_HITBOX_PATH=27]="NOTES_HITBOX_PATH",e[e.NOTES_STACKED_NOTE=28]="NOTES_STACKED_NOTE",e[e.NOTES_DOUBLE_DIRECTIONAL=29]="NOTES_DOUBLE_DIRECTIONAL",e[e.NOTES_VISION_BLOCK=30]="NOTES_VISION_BLOCK",e[e.OBSTACLES_SHORT=31]="OBSTACLES_SHORT",e[e.OBSTACLES_CENTER=32]="OBSTACLES_CENTER",e[e.OBSTACLES_ZERO=33]="OBSTACLES_ZERO",e[e.OBSTACLES_NEGATIVE=34]="OBSTACLES_NEGATIVE",e))(gt||{});function ql(e,t){switch(t){case"rank":e='<span title="Ranking: for rankability reason."> üöß </span>'+e;break;case"error":e='<span title="Error: should be fixed unless you know what you are doing."> ‚ùå </span>'+e;break;case"warning":e='<span title="Warning: not necessarily needed to be fixed, worth considering."> ‚ùó </span>'+e;break;case"info":e='<span title="Info: no action necessary, take note."> ‚ö†Ô∏è </span>'+e;break}return e}function dt(e,t,i){const n=document.createElement("div");return e=ql(e,i),t?n.innerHTML=`<b>${e}:</b> ${t}`:n.innerHTML=`<b>${e}</b>`,n}function mt(e,t,i,n){const r=document.createElement("div");return e=ql(e,n),r.innerHTML=`<b>${e} [${t.length}]:</b> ${t.map(s=>{switch(it.beatNumbering){case"realtime":return`<span title="Beat ${I(i.adjustTime(s),it.rounding)}">${Tt(i.toRealTime(s))}</span>`;case"realtimems":return`<span title="Beat ${I(i.adjustTime(s),it.rounding)}">${Jn(i.toRealTime(s))}</span>`;case"jsontime":return`<span title="Time ${Jn(i.toRealTime(s))}">${I(s,it.rounding)}</span>`;case"beattime":default:return`<span title="Time ${Jn(i.toRealTime(s))}">${I(i.adjustTime(s),it.rounding)}</span>`}}).join(", ")}`,r}const vn=class{constructor(){}};vn.list=[];vn.create=(e,t,i,n)=>{const r=e.trim().toLowerCase().replace(" ","-");if(vn.list.includes(r))throw new Error(r+" is already being used.");vn.list.push(r);const s=document.createElement("div"),l=document.createElement("input"),o=document.createElement("label");return o.textContent=" "+e,o.title=t,o.htmlFor="input__tools-"+r,l.id="input__tools-"+r,l.className="input-toggle",l.type="checkbox",l.checked=i,l.addEventListener("change",n),s.appendChild(l),s.appendChild(o),s};let _t=vn;const vs="Validate Cover Image",ys="Validate cover image.",Es=!0,co={name:vs,description:ys,type:"general",order:{input:pt.GENERAL_COVER_IMAGE,output:gt.GENERAL_COVER_IMAGE},input:{enabled:Es,params:{},html:_t.create(vs,ys,Es,function(){co.input.enabled=this.checked})},output:{html:null},run:Qh};function Qh(){const e=new Image,t=Nt.getCoverImage(),i=[];if(Gi.loading.coverImage&&t!==null?(e.src=t,e.width!==e.height&&i.push(dt("Cover image is not square","resize to fit square","error")),(e.width<256||e.height<256)&&i.push(dt("Cover image is too small","require at least 256x256","error"))):i.push(dt("No cover image",it.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),i.length){const n=document.createElement("div");i.forEach(r=>n.append(r)),co.output.html=n}else co.output.html=null}const Ds="Audio Duration",ws="For ranking purpose, check for audio duration.",Ss=!0,yn={name:Ds,description:ws,type:"general",order:{input:pt.GENERAL_AUDIO,output:gt.GENERAL_AUDIO},input:{enabled:Ss,params:{},html:_t.create(Ds,ws,Ss,function(){yn.input.enabled=this.checked})},output:{html:null},run:tf};function tf(e){const{audioDuration:t}=e.settings;t&&t<20?yn.output.html=dt("Unrankable audio length",`too short (${Tt(t)}s)`,"rank"):Gi.loading.audio?yn.output.html=null:yn.output.html=dt("No audio",it.load.audio?"could not be loaded or not found":"no audio mode is enabled")}const Cs="Preview Time",Ts="Warn default editor preview time.",Ls=!0,uo={name:Cs,description:Ts,type:"general",order:{input:pt.GENERAL_PREVIEW_TIME,output:gt.GENERAL_PREVIEW_TIME},input:{enabled:Ls,params:{},html:_t.create(Cs,Ts,Ls,function(){uo.input.enabled=this.checked})},output:{html:null},run:ef};function ef(e){const{previewStartTime:t,previewDuration:i}=e.info;t===12&&i===10?uo.output.html=dt("Default preview time","strongly recommended to set for audience's 1st impression","info"):uo.output.html=null}function nf(e){return Math.max(...e.map(t=>t.ebpm),0)}function of(e){return Math.max(...e.map(t=>t.ebpmSwing),0)}const Bo=4;var ot=(e=>(e[e.RED=0]="RED",e[e.BLUE=1]="BLUE",e))(ot||{}),W=(e=>(e[e.UP=0]="UP",e[e.DOWN=1]="DOWN",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT",e[e.UP_LEFT=4]="UP_LEFT",e[e.UP_RIGHT=5]="UP_RIGHT",e[e.DOWN_LEFT=6]="DOWN_LEFT",e[e.DOWN_RIGHT=7]="DOWN_RIGHT",e[e.ANY=8]="ANY",e))(W||{}),at=(e=>(e[e.LEFT=0]="LEFT",e[e.MIDDLE_LEFT=1]="MIDDLE_LEFT",e[e.MIDDLE_RIGHT=2]="MIDDLE_RIGHT",e[e.RIGHT=3]="RIGHT",e))(at||{}),xt=(e=>(e[e.BOTTOM=0]="BOTTOM",e[e.MIDDLE=1]="MIDDLE",e[e.TOP=2]="TOP",e))(xt||{});const ae={0:180,1:0,2:270,3:90,4:225,5:135,6:315,7:45,8:0},rf={0:1,1:0,2:3,3:2,4:7,5:6,6:5,7:4,8:8},Oe={0:[0,1],1:[0,-1],2:[-1,0],3:[1,0],4:[-1,1],5:[1,1],6:[-1,-1],7:[1,-1],8:[0,0]},sf={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60};var Kl=(e=>(e[e.DIVISION=1]="DIVISION",e[e.STEP_AND_OFFSET=2]="STEP_AND_OFFSET",e))(Kl||{}),Zl=(e=>(e[e.NONE=0]="NONE",e[e.DURATION=1]="DURATION",e[e.DISTRIBUTION=2]="DISTRIBUTION",e[e.ALL=3]="ALL",e))(Zl||{}),Ql=(e=>(e[e.NO_RANDOM=0]="NO_RANDOM",e[e.KEEP_ORDER=1]="KEEP_ORDER",e[e.RANDOM_ELEMENTS=2]="RANDOM_ELEMENTS",e[e.ALL=3]="ALL",e))(Ql||{});class pr{serialize(){return JSON.stringify(this.toJSON())}clone(){return new this.constructor(this.toJSON())}}class Ue extends pr{get customData(){return this._customData}set customData(t){this._customData=t}setCustomData(t){return this.customData=t,this}resetCustomData(){return this.customData={},this}removeCustomData(t){return typeof t=="string"?delete this.customData[t]:t.forEach(i=>delete this.customData[i]),this}addCustomData(t){for(const i in t)this.customData[i]=t[i];return this}func(t,...i){return t(this,...i),this}isChroma(){return!1}isNoodleExtensions(){return!1}isMappingExtensions(){return!1}}class he extends Ue{get time(){return this._time}set time(t){this._time=t}setTime(t){return this.time=t,this}}class No extends he{get posX(){return this._posX}set posX(t){this._posX=t}get posY(){return this._posY}set posY(t){this._posY=t}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}mirror(t,i){return this.posX=Bo-1-this.posX,this}getPosition(t){return[this.posX-2,this.posY]}getDistance(t,i){const[n,r]=this.getPosition(i),[s,l]=t.getPosition(i);return Math.sqrt(Math.pow(s-n,2)+Math.pow(l-r,2))}isVertical(t,i){const[n]=this.getPosition(i),[r]=t.getPosition(i),s=n-r;return s>-.001&&s<.001}isHorizontal(t,i){const[n,r]=this.getPosition(i),[s,l]=t.getPosition(i),o=r-l;return o>-.001&&o<.001}isDiagonal(t,i){const[n,r]=this.getPosition(i),[s,l]=t.getPosition(i),o=Math.abs(n-s),a=Math.abs(r-l);return o===a}isInline(t,i,n){return i??(i=.5),this.getDistance(t,n)<=i}isAdjacent(t,i){const n=this.getDistance(t,i);return n>.499&&n<1.001}isWindow(t,i,n){return i??(i=1.8),this.getDistance(t,n)>i}isSlantedWindow(t,i){return this.isWindow(t,null,i)&&!this.isDiagonal(t,i)&&!this.isHorizontal(t,i)&&!this.isVertical(t,i)}}class tc extends No{get color(){return this._color}set color(t){this._color=t}get direction(){return this._direction}set direction(t){this._direction=t}setColor(t){return this.color=t,this}setDirection(t){return this.direction=t,this}mirror(t=!0,i){switch(t&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return super.mirror(t)}isRed(){return this.color===0}isBlue(){return this.color===1}getAngle(t){return ae[this.direction]||0}isDouble(t,i=.01){return t.time>this.time-i&&t.time<this.time+i&&this.color!==t.color}isValidDirection(){return this.direction>=0&&this.direction<=8}isValid(){return!this.isMappingExtensions()&&this.isValidDirection()}}class Ao extends tc{get type(){return this._type}set type(t){this._type=t}get angleOffset(){return this._angleOffset}set angleOffset(t){this._angleOffset=t}setType(t){return this.type=t,this}setAngleOffset(t){return this.angleOffset=t,this}mirror(t=!0,i){return super.mirror(t)}isNote(){return this.type===0||this.type===1}isBomb(){return this.type===3}getAngle(t){return(ae[this.direction]||0)+this.angleOffset}isMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0||this.direction>=1e3&&this.direction<=1360||this.direction>=2e3&&this.direction<=2360}}function ec(e,t,i){return e.direction===W.ANY&&t.direction===W.ANY&&i!==W.ANY&&(e.posX>t.posX&&(i===W.UP_RIGHT||i===W.RIGHT||i===W.DOWN_RIGHT)||e.posX<t.posX&&(i===W.DOWN_LEFT||i===W.LEFT||i===W.UP_LEFT)||e.posY>t.posY&&(i===W.UP_LEFT||i===W.UP||i===W.UP_RIGHT)||e.posY<t.posY&&(i===W.DOWN_LEFT||i===W.DOWN||i===W.DOWN_RIGHT))||e.posX>t.posX&&(e.direction===W.UP_RIGHT||e.direction===W.RIGHT||e.direction===W.DOWN_RIGHT||(t.direction===W.UP_RIGHT||t.direction===W.RIGHT||t.direction===W.DOWN_RIGHT)&&e.direction===W.ANY)||e.posX<t.posX&&(e.direction===W.DOWN_LEFT||e.direction===W.LEFT||e.direction===W.UP_LEFT||(t.direction===W.DOWN_LEFT||t.direction===W.LEFT||t.direction===W.UP_LEFT)&&e.direction===W.ANY)||e.posY>t.posY&&(e.direction===W.UP_LEFT||e.direction===W.UP||e.direction===W.UP_RIGHT||(t.direction===W.UP_LEFT||t.direction===W.UP||t.direction===W.UP_RIGHT)&&e.direction===W.ANY)||e.posY<t.posY&&(e.direction===W.DOWN_LEFT||e.direction===W.DOWN||e.direction===W.DOWN_RIGHT||(t.direction===W.DOWN_LEFT||t.direction===W.DOWN||t.direction===W.DOWN_RIGHT)&&e.direction===W.ANY)}function or(e,t,i,n=!1){const[r,s]=e.getPosition(),[l,o]=t.getPosition(),a=n?540:360;let h=!1;if(e.direction!==8){const d=e.getAngle(),f=(Zo(Math.atan2(s-o,r-l))+450)%360;for(const[c,g,_]of i){const v=_??0,b=(d+a-c+v)%360,E=(d+a+c+v)%360;if(h=g>=Math.sqrt(Math.pow(r-l,2)+Math.pow(s-o,2))&&(b<E&&b<=f&&f<=E||b>=E&&(f<=E||f>=b))||h,h)break}}let u=!1;if(t instanceof Ao&&t.direction!==8){const d=t.getAngle(),f=(Zo(Math.atan2(o-s,l-r))+450)%360;for(const[c,g,_]of i){const v=_??0,b=(d+a-c+v)%360,E=(d+a+c+v)%360;if(u=g>=Math.sqrt(Math.pow(r-l,2)+Math.pow(s-o,2))&&(b<E&&b<=f&&f<=E||b>=E&&(f<=E||f>=b))||u,u)break}}return[h,u]}function xs(e,t){if(ec(e,t,W.ANY))return e.direction===W.ANY?t.direction:e.direction;if(e.direction!==W.ANY)return e.direction;if(e.time>t.time){if(e.posX>t.posX&&e.isHorizontal(t))return W.RIGHT;if(e.posX<t.posX&&e.isHorizontal(t))return W.LEFT;if(e.posY>t.posY){if(e.isVertical(t))return W.UP;if(e.posX>t.posX)return W.UP_RIGHT;if(e.posX<t.posX)return W.UP_LEFT}if(e.posY<t.posY){if(e.isVertical(t))return W.DOWN;if(e.posX>t.posX)return W.DOWN_RIGHT;if(e.posX<t.posX)return W.DOWN_LEFT}}return W.ANY}function Dn(e,t,i,n){let r,s;if(e===null||t===null)return!1;if(typeof e=="number")r=e;else{if(e.direction===W.ANY)return!1;r=e.getAngle()}if(typeof t=="number")s=t;else{if(t.direction===W.ANY)return!1;s=t.getAngle()}return n?Jr(r,s,360)<=i:Jr(r,s,360)>=i}class ie{constructor(t){this.time=t.time,this.duration=t.duration,this.minSpeed=t.minSpeed,this.maxSpeed=t.maxSpeed,this.ebpm=t.ebpm,this.ebpmSwing=t.ebpmSwing,this.data=t.data}static generate(t,i){const n=[];let r=0,s=0,l,o;const a={},h={},u={0:[],1:[]};for(const d of t)d.type==="note"&&(l=0,o=Number.MAX_SAFE_INTEGER,h[d.data.color]?this.next(d,h[d.data.color],i,u[d.data.color])&&(l=this.calcMinSliderSpeed(u[d.data.color],i),o=this.calcMaxSliderSpeed(u[d.data.color],i),l>0&&o!==1/0||(l=0,o=0),s=this.calcEBPMBetweenObject(d.data,a[d.data.color].data,i),r=this.calcEBPMBetweenObject(d.data,h[d.data.color].data,i),n.push({time:a[d.data.color].data.time,duration:h[d.data.color].data.time-a[d.data.color].data.time,data:u[d.data.color],ebpm:r,ebpmSwing:s,maxSpeed:o,minSpeed:l}),a[d.data.color]=d,u[d.data.color]=[]):a[d.data.color]=d,h[d.data.color]=d,u[d.data.color].push(d));for(let d=0;d<2;d++)h[d]&&(l=this.calcMinSliderSpeed(u[d],i),o=this.calcMaxSliderSpeed(u[d],i),l>0&&o!==1/0||(l=0,o=0),n.push({time:a[d].data.time,duration:h[d].data.time-a[d].data.time,data:u[d],ebpm:r,ebpmSwing:s,maxSpeed:o,minSpeed:l}));return n}static next(t,i,n,r){if(t.type==="bomb"||i.type==="bomb")throw new Error("Invalid type");if(r&&r.length>0&&n.toRealTime(i.data.time)+.005<n.toRealTime(t.data.time)&&t.data.direction!==W.ANY){for(const s of r)if(s.type==="note"&&s.data.direction!==W.ANY&&Dn(t.data,s.data,90,!1))return!0}if(r&&r.length>0){for(const s of r)if(s.type==="note"&&t.data.isInline(s.data))return!0}return t.data.isWindow(i.data)&&n.toRealTime(t.data.time-i.data.time)>.08||n.toRealTime(t.data.time-i.data.time)>.07}static calcEBPMBetweenObject(t,i,n){return n.value/(n.toBeatTime(n.toRealTime(t.time)-n.toRealTime(i.time))*2)}static calcMinSliderSpeed(t,i){let n=!1,r=!1,s=0;const l=i.toRealTime(Math.max(...t.map((o,a)=>a===0?0:((t[a].data.isHorizontal(t[a-1].data)||t[a].data.isVertical(t[a-1].data))&&!n&&(n=!0,s=(t[a].data.time-t[a-1].data.time)/(t[a].data.getDistance(t[a-1].data)||1)),r=t[a].data.isDiagonal(t[a-1].data)||t[a].data.isSlantedWindow(t[a-1].data)||r,(t[a].data.time-t[a-1].data.time)/(t[a].data.getDistance(t[a-1].data)||1)))));return n&&r?i.toRealTime(s):l}static calcMaxSliderSpeed(t,i){let n=!1,r=!1,s=Number.MAX_SAFE_INTEGER;const l=i.toRealTime(Math.min(...t.map((o,a)=>a===0?Number.MAX_SAFE_INTEGER:((t[a].data.isHorizontal(t[a-1].data)||t[a].data.isVertical(t[a-1].data))&&!n&&(n=!0,s=(t[a].data.time-t[a-1].data.time)/(t[a].data.getDistance(t[a-1].data)||1)),r=t[a].data.isDiagonal(t[a-1].data)||t[a].data.isSlantedWindow(t[a-1].data)||r,(t[a].data.time-t[a-1].data.time)/(t[a].data.getDistance(t[a-1].data)||1)))));return n&&r?i.toRealTime(s):l}}function af(e,t,i){const n={left:new Array(Math.floor(t+1)).fill(0),right:new Array(Math.floor(t+1)).fill(0)};let r,s;for(const l of e){if(l.type!=="note")continue;const o=i.toRealTime(l.data.time);l.data.color===0&&(r?ie.next(l,r,i)&&n.left[Math.floor(o)]++:n.left[Math.floor(o)]++,r=l),l.data.color===1&&(s?ie.next(l,s,i)&&n.right[Math.floor(o)]++:n.right[Math.floor(o)]++,s=l)}return n}function zo(e,t){if(!e.length)return 0;if(e.length<t)return e.reduce((r,s)=>r+s)/e.length;let i=e.slice(0,t).reduce((r,s)=>r+s),n=i;for(let r=0;r<e.length-t;r++)i=i-e[r]+e[r+t],n=Math.max(n,i);return n/t}function lf(e,t,i,n){const s={characteristic:i,difficulty:n,red:{average:0,peak:0,median:0,total:0},blue:{average:0,peak:0,median:0,total:0},total:{average:0,peak:0,median:0,total:0},container:ie.generate(e.getNoteContainer(),t)},l=Math.max(t.toRealTime(e.getLastInteractiveTime()-e.getFirstInteractiveTime()),0),o=Math.max(t.toRealTime(e.getLastInteractiveTime()),0),a=af(e.getNoteContainer(),o,t),h=a.left.map((c,g)=>c+a.right[g]);if(h.reduce((c,g)=>c+g)===0)return s;const u=[],d=[],f=[];for(let c=0,g=Math.ceil(h.length/10);c<g;c++){const _=c*10;let v=10;v+_>h.length&&(v=h.length-_);const b=a.left.slice(_,_+v),E=a.right.slice(_,_+v),w=h.slice(_,_+v);u.push(b.reduce((L,x)=>L+x)/v),d.push(E.reduce((L,x)=>L+x)/v),f.push(w.reduce((L,x)=>L+x)/v)}return s.red.total=a.left.reduce((c,g)=>c+g),s.red.average=a.left.reduce((c,g)=>c+g)/l,s.red.peak=zo(a.left,10),s.red.median=Fo(u),s.blue.total=a.right.reduce((c,g)=>c+g),s.blue.average=a.right.reduce((c,g)=>c+g)/l,s.blue.peak=zo(a.right,10),s.blue.median=Fo(d),s.total.total=s.red.total+s.blue.total,s.total.average=h.reduce((c,g)=>c+g)/l,s.total.peak=zo(h,10),s.total.median=Fo(f),s}function cf(e,t){let i=0,n=0,r;for(const s of e){const l=s.total.average;if(n>0&&l>0&&(i=Math.abs(1-n/l)*100),n=l>0?l:n,n>t&&i>40)return{result:s,comparedTo:r};r=s}return null}function uf(e,t){let i=Number.MAX_SAFE_INTEGER,n=0,r;for(const s of e){const l=s.total.average;if(n>0&&l>0&&(i=Math.abs(1-n/l)*100),n=l>0?l:n,n>t&&i<10)return{result:s,comparedTo:r};r=s}return null}function hf(e){let t=0,i=Number.MAX_SAFE_INTEGER;return e.forEach(n=>{const r=n.total.average;r>0&&(t=Math.max(t,r),i=Math.min(i,r))}),t||t&&i?(1-i/t)*100:0}function ks(e){return Math.min(...e.map(t=>t.total.average),Number.MAX_SAFE_INTEGER)}function Rs(e){return Math.max(...e.map(t=>t.total.average),0)}function ff(e){return Math.max(...e.map(t=>t.minSpeed),0)}function mf(e){const t=e.map(i=>i.maxSpeed).filter(i=>i!==0);return t.length?Math.min(...t):0}const Bs={Easy:1,Normal:3,Hard:5,Expert:7,ExpertPlus:9},ye={Easy:"Easy",Normal:"Normal",Hard:"Hard",Expert:"Expert",ExpertPlus:"Expert+"},ic="Difficulty Progression",nc="For ranking purpose, check difficuly progression to fit rankability criteria.",oc=!0,gr=document.createElement("div"),rc=document.createElement("ul"),df=["ExpertPlus","Expert","Hard","Normal","Easy"];for(const e of df)rc.appendChild(_t.create(ye[e],`Toggle check progression for Standard ${ye[e]}`,!0,function(){He.input.params[e]=this.checked}));gr.appendChild(_t.create(ic,nc,oc,function(){He.input.enabled=this.checked}));gr.appendChild(rc);const He={name:ic,description:nc,type:"general",order:{input:pt.GENERAL_PROGRESSION,output:gt.GENERAL_PROGRESSION},input:{enabled:oc,params:{ExpertPlus:!0,Expert:!0,Hard:!0,Normal:!0,Easy:!0},html:gr},output:{html:null},run:pf};function pf(e){var o,a,h,u,d,f,c,g;const{audioDuration:t}=e.settings;if(!t){He.output.html=null;return}const i=lt.beatmapDifficulty.filter(_=>_.characteristic==="Standard").map(_=>_.swingAnalysis).filter(_=>He.input.params[_.difficulty]&&_.total.total>0).sort((_,v)=>v.total.average-_.total.average);if(!i.length){He.output.html=null;return}const n=Math.max(t<120?3.2:t<240?4.2:5.2,I(Rs(i)*.4,2)),r=[];t<360&&ks(i)>n&&(i.forEach(_=>_.total.average),r.push(dt(`Minimum SPS not met (<${n})`,`lowest SPS is ${I(ks(i),2)}, ${I(hf(i),2)}% drop from highest SPS (${I(Rs(i),2)})`,"rank")));const s=cf(i,n),l=uf(i,n);if(s&&t<360&&r.push(dt("Violates progression",`${ye[s.result.difficulty]} exceeded 40% SPS drop, ${I(s.result.total.average,2)} from ${I(((a=(o=s.comparedTo)==null?void 0:o.total)==null?void 0:a.average)||0,2)} ${ye[s.comparedTo.difficulty]}, acceptable range (${I((((u=(h=s.comparedTo)==null?void 0:h.total)==null?void 0:u.average)||0)*.6,2)}-${I((((d=s.comparedTo)==null?void 0:d.total.average)||0)*.9,2)})`,"rank")),l&&t<360&&r.push(dt("Violates progression",`${ye[l.result.difficulty]} has less than 10% SPS drop, ${I(l.result.total.average,2)} from ${I(((f=l.comparedTo)==null?void 0:f.total.average)||0,2)} ${ye[l.comparedTo.difficulty]}, acceptable range (${I((((c=l.comparedTo)==null?void 0:c.total.average)||0)*.6,2)}-${I((((g=l.comparedTo)==null?void 0:g.total.average)||0)*.9,2)})`,"rank")),r.length){const _=document.createElement("div");r.forEach(v=>_.append(v)),He.output.html=_}else He.output.html=null}const Ns=Object.freeze(Object.defineProperty({__proto__:null,audio:yn,coverImage:co,previewTime:uo,progression:He},Symbol.toStringTag,{value:"Module"})),sc="Effective BPM",ac=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,lc=!0,_r=450,br=350,Tn=_t.create(sc+" threshold",ac,lc,function(){Gt.input.enabled=this.checked}),Ve=document.createElement("input"),vr=document.createElement("label"),Je=document.createElement("input"),yr=document.createElement("label");vr.textContent=": ";vr.htmlFor="input__tools-ebpm";Ve.id="input__tools-ebpm";Ve.className="input-toggle input--small";Ve.type="number";Ve.min="0";Ve.value=_r.toString();Ve.addEventListener("change",_f);yr.textContent=" (swing): ";yr.htmlFor="input__tools-ebpms";Je.id="input__tools-ebpms";Je.className="input-toggle input--small";Je.type="number";Je.min="0";Je.value=br.toString();Je.addEventListener("change",bf);Tn.appendChild(vr);Tn.appendChild(Ve);Tn.appendChild(yr);Tn.appendChild(Je);const Gt={name:sc,description:ac,type:"note",order:{input:pt.NOTES_EFFECTIVE_BPM,output:gt.NOTES_EFFECTIVE_BPM},input:{enabled:lc,params:{ebpmThres:_r,ebpmsThres:br},html:Tn,adjustTime:gf},output:{html:null},run:yf};function gf(e){Gt.input.params.ebpmThres=I(Math.min(_r,e.value*2*1.285714),1),Gt.input.params.ebpmsThres=I(Math.min(br,e.value*2),1),Ve.value=Gt.input.params.ebpmThres.toString(),Je.value=Gt.input.params.ebpmsThres.toString()}function _f(){Gt.input.params.ebpmThres=I(Math.abs(parseFloat(this.value)),1),this.value=Gt.input.params.ebpmThres.toString()}function bf(){Gt.input.params.ebpmsThres=I(Math.abs(parseFloat(this.value)),1),this.value=Gt.input.params.ebpmsThres.toString()}function vf(e){const{swingAnalysis:t}=e.difficulty;let{ebpmThres:i,ebpmsThres:n}=Gt.input.params;i+=.001,n+=.001;const r=t.container.filter(l=>l.ebpm>i).map(l=>l.time),s=t.container.filter(l=>l.ebpmSwing>n).map(l=>l.time);return{base:r,swing:s}}function yf(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=vf(e),{ebpmThres:i,ebpmsThres:n}=Gt.input.params,r=[];if(t.base.length&&r.push(mt(`>${i}EBPM warning`,t.base,e.settings.bpm,"warning")),t.swing.length&&r.push(mt(`>${n}EBPM (swing) warning`,t.swing,e.settings.bpm,"warning")),r.length){const s=document.createElement("div");r.forEach(l=>s.append(l)),Gt.output.html=s}else Gt.output.html=null}const cc="Acceptable Beat Precision",uc=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,hc=!0,fc=[8,6],mc=_t.create(cc+": ",uc,hc,function(){_i.input.enabled=this.checked}),Vi=document.createElement("input");Vi.id="input__tools-prec";Vi.className="input-toggle input--small";Vi.type="text";Vi.value=fc.join(" ");Vi.addEventListener("change",Ef);mc.appendChild(Vi);const _i={name:cc,description:uc,type:"note",order:{input:pt.NOTES_ACCEPTABLE_PRECISION,output:gt.NOTES_ACCEPTABLE_PRECISION},input:{enabled:hc,params:{prec:[...fc]},html:mc},output:{html:null},run:wf};function Ef(){_i.input.params.prec=this.value.trim().split(" ").map(e=>parseInt(e)).filter(e=>e>0?!Number.isNaN(e):!1),this.value=_i.input.params.prec.join(" ")}function Df(e,t){const{bpm:i}=e,n=t.swingAnalysis.container,{prec:r}=_i.input.params;return n.map(s=>s.time).filter((s,l,o)=>!l||s!==o[l-1]).filter(s=>{if(!r.length)return!1;for(let l=0;l<r.length;l++)if((i.adjustTime(s)+.001)%(1/r[l])<.01)return!1;return!0})}function wf(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=Df(e.settings,e.difficulty);t.length?_i.output.html=mt("Off-beat precision",t,e.settings.bpm,"warning"):_i.output.html=null}const As="Varying Swing Speed",Is="Check for varying swing speed due to changes in slider distance.",Os=!0,ho={name:As,description:Is,type:"note",order:{input:pt.NOTES_VARY_SWING,output:gt.NOTES_VARY_SWING},input:{enabled:Os,params:{},html:_t.create(As,Is,Os,function(){ho.input.enabled=this.checked})},output:{html:null},run:Cf};function Sf(e){const{swingAnalysis:t}=e;return t.container.filter(i=>Math.abs(i.minSpeed-i.maxSpeed)>.002).map(i=>i.time).filter((i,n,r)=>!n||i!==r[n-1])}function Cf(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=Sf(e.difficulty);t.length?ho.output.html=mt("Varying swing speed",t,e.settings.bpm,"error"):ho.output.html=null}const dc="Slow Slider",pc="Look for slider that require slow swing.",gc=!0,_c=.025,Ji=document.createElement("div"),qe=document.createElement("input"),Er=document.createElement("label"),Ke=document.createElement("input"),Dr=document.createElement("label");let ji;Er.textContent="min speed (ms): ";Er.htmlFor="input__tools-slow-slider-time";qe.id="input__tools-slow-slider-time";qe.className="input-toggle input--small";qe.type="number";qe.min="0";qe.value=I(_c*1e3,1).toString();qe.addEventListener("change",Lf);Dr.textContent=" (prec): ";Dr.htmlFor="input__tools-slow-slider-prec";Ke.id="input__tools-slow-slider-prec";Ke.className="input-toggle input--small";Ke.type="number";Ke.min="0";Ke.addEventListener("change",xf);Ji.appendChild(_t.create(dc,pc,gc,function(){te.input.enabled=this.checked}));Ji.appendChild(Er);Ji.appendChild(qe);Ji.appendChild(Dr);Ji.appendChild(Ke);const te={name:dc,description:pc,type:"note",order:{input:pt.NOTES_SLOW_SLIDER,output:gt.NOTES_SLOW_SLIDER},input:{enabled:gc,params:{minSpeed:_c},html:Ji,adjustTime:Tf},output:{html:null},run:Rf};function Tf(e){ji=e,Ke.value=I(1/ji.toBeatTime(te.input.params.minSpeed),2).toString()}function Lf(){te.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=I(te.input.params.minSpeed*1e3,1).toString(),ji&&(Ke.value=I(1/ji.toBeatTime(te.input.params.minSpeed),2).toString())}function xf(){if(!ji){this.value="0";return}let e=I(Math.abs(parseFloat(this.value)),2)||1;te.input.params.minSpeed=ji.toRealTime(1/e),qe.value=I(te.input.params.minSpeed*1e3,1).toString(),this.value=e.toString()}function kf(e){const{swingAnalysis:t}=e.difficulty,{minSpeed:i}=te.input.params;return t.container.filter(n=>n.maxSpeed>i||n.minSpeed>i).map(n=>n.time).filter((n,r,s)=>!r||n!==s[r-1])}function Rf(e){if(!e.difficulty){console.error("Something went wrong!");return}const{minSpeed:t}=te.input.params,i=kf(e);i.length?te.output.html=mt(`Slow slider (>${I(t*1e3,1)}ms)`,i,e.settings.bpm,"warning"):te.output.html=null}const bc="Inline Sharp Angle",vc="Check for angle changes within inline note.",yc=!0,Ec=.15;let Xi;const qi=document.createElement("div"),Ze=document.createElement("input"),wr=document.createElement("label"),Te=document.createElement("input"),Sr=document.createElement("label");wr.textContent="max time (ms): ";wr.htmlFor="input__tools-inline-angle-time";Ze.id="input__tools-inline-angle-time";Ze.className="input-toggle input--small";Ze.type="number";Ze.min="0";Ze.value=I(Ec*1e3,1).toString();Ze.addEventListener("change",Nf);Sr.textContent=" (beat): ";Sr.htmlFor="input__tools-inline-angle-beat";Te.id="input__tools-inline-angle-beat";Te.className="input-toggle input--small";Te.type="number";Te.min="0";Te.step="0.1";Te.addEventListener("change",Af);qi.appendChild(_t.create(bc,vc,yc,function(){le.input.enabled=this.checked}));qi.appendChild(wr);qi.appendChild(Ze);qi.appendChild(Sr);qi.appendChild(Te);const le={name:bc,description:vc,type:"note",order:{input:pt.NOTES_INLINE_ANGLE,output:gt.NOTES_INLINE_ANGLE},input:{enabled:yc,params:{maxTime:Ec},html:qi,adjustTime:Bf},output:{html:null},run:Of};function Bf(e){Xi=e,Te.value=I(Xi.toBeatTime(le.input.params.maxTime),2).toString()}function Nf(){le.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(le.input.params.maxTime*1e3,1).toString(),Xi&&(Te.value=I(Xi.toBeatTime(le.input.params.maxTime),2).toString())}function Af(){if(!Xi){this.value="0";return}let e=I(Math.abs(parseFloat(this.value)),2)||1;le.input.params.maxTime=Xi.toRealTime(e),Ze.value=I(le.input.params.maxTime*1e3,1).toString(),this.value=e.toString()}function If(e){const{bpm:t}=e.settings,i=e.difficulty.noteContainer,{maxTime:n}=le.input.params,r=t.toBeatTime(n)+.001,s={},l={},o={},a={[ot.RED]:[],[ot.BLUE]:[]},h=[];let u=0;for(let d=0,f=i.length;d<f;d++){const c=i[d];c.type==="note"&&s[c.data.color]?ie.next(c,s[c.data.color],t,a[c.data.color])?(o[c.data.color]&&(o[c.data.color]=null,l[c.data.color]=(l[c.data.color]+180)%360),$s(c.data,i,u,r)&&Dn(c.data,l[c.data.color],90,!0)&&h.push(c.data),c.data.direction===W.ANY?o[c.data.color]=c.data:l[c.data.color]=c.data.getAngle(),a[c.data.color]=[]):(o[c.data.color]&&$s(c.data,i,u,r)&&Dn(c.data,l[c.data.color],90,!0)&&(h.push(o[c.data.color]),o[c.data.color]=null),c.data.direction!==W.ANY&&(l[c.data.color]=c.data.getAngle())):c.type==="note"&&(l[c.data.color]=c.data.getAngle()),c.type==="note"&&(s[c.data.color]=c,a[c.data.color].push(c)),c.type==="bomb"&&(c.data.posY===xt.BOTTOM&&(c.data.posX===at.MIDDLE_LEFT&&(l[ot.RED]=ae[W.UP],o[ot.RED]=null),c.data.posX===at.MIDDLE_RIGHT&&(l[ot.BLUE]=ae[W.UP],o[ot.BLUE]=null)),c.data.posY===xt.TOP&&(c.data.posX===at.MIDDLE_LEFT&&(l[ot.RED]=ae[W.DOWN],o[ot.RED]=null),c.data.posX===at.MIDDLE_RIGHT&&(l[ot.BLUE]=ae[W.DOWN],o[ot.BLUE]=null)))}return h.map(d=>d.time).filter(function(d,f,c){return!f||d!==c[f-1]})}function $s(e,t,i,n){for(let r=i;t[r].data.time<e.time;r++){const s=t[r];if(s.type==="note"&&e.isInline(s.data)&&e.time-t[r].data.time<=n)return!0}return!1}function Of(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=If(e);t.length?le.output.html=mt("Inline sharp angle",t,e.settings.bpm,"warning"):le.output.html=null}const Dc="shrado Angle",wc="Look for common negative curvature pattern.",Sc=!1,Cc=.15,Tc=1;let zi;const Le=document.createElement("div"),Ei=document.createElement("input"),Cr=document.createElement("label"),Qe=document.createElement("input"),Tr=document.createElement("label"),xe=document.createElement("input"),Lr=document.createElement("label");Cr.textContent="min distance: ";Cr.htmlFor="input__tools-shrado-angle-distance";Ei.id="input__tools-shrado-angle-distance";Ei.className="input-toggle input--small";Ei.type="number";Ei.min="0";Ei.value=Tc.toString();Ei.addEventListener("change",Pf);Tr.textContent="max time (ms): ";Tr.htmlFor="input__tools-shrado-angle-time";Qe.id="input__tools-shrado-angle-time";Qe.className="input-toggle input--small";Qe.type="number";Qe.min="0";Qe.value=I(Cc*1e3,1).toString();Qe.addEventListener("change",Mf);Lr.textContent=" (beat): ";Lr.htmlFor="input__tools-shrado-angle-beat";xe.id="input__tools-shrado-angle-beat";xe.className="input-toggle input--small";xe.type="number";xe.min="0";xe.step="0.1";xe.addEventListener("change",Ff);Le.appendChild(_t.create(Dc,wc,Sc,function(){Yt.input.enabled=this.checked}));Le.appendChild(Cr);Le.appendChild(Ei);Le.appendChild(document.createElement("br"));Le.appendChild(Tr);Le.appendChild(Qe);Le.appendChild(Lr);Le.appendChild(xe);const Yt={name:Dc,description:wc,type:"note",order:{input:pt.NOTES_SHRADO_ANGLE,output:gt.NOTES_SHRADO_ANGLE},input:{enabled:Sc,params:{distance:Tc,maxTime:Cc},html:Le,adjustTime:$f},output:{html:null},run:Hf};function $f(e){zi=e,xe.value=I(zi.toBeatTime(Yt.input.params.maxTime),2).toString()}function Pf(){Yt.input.params.distance=Math.max(parseInt(this.value),0),this.value=Yt.input.params.distance.toString()}function Mf(){Yt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(Yt.input.params.maxTime*1e3,1).toString(),zi&&(xe.value=I(zi.toBeatTime(Yt.input.params.maxTime),2).toString())}function Ff(){if(!zi){this.value="0";return}let e=I(Math.abs(parseFloat(this.value)),2)||1;Yt.input.params.maxTime=zi.toRealTime(e),Qe.value=I(Yt.input.params.maxTime*1e3,1).toString(),this.value=e.toString()}function Wf(e){const{bpm:t}=e.settings,{noteContainer:i}=e.difficulty,{maxTime:n,distance:r}=Yt.input.params,s=t.toBeatTime(n)+.001,l={},o={},a={},h={[ot.RED]:[],[ot.BLUE]:[]},u=[];for(let d=0,f=i.length;d<f;d++){if(i[d].type!=="note")continue;const c=i[d];l[c.data.color]?ie.next(c,l[c.data.color],t,h[c.data.color])?(a[c.data.color]&&(a[c.data.color]=null,o[c.data.color]=rf[o[c.data.color]]??8),c.data.getDistance(l[c.data.color].data)>=r&&Ps(c.data.direction,o[c.data.color],c.data.color)&&c.data.time-l[c.data.color].data.time<=s&&u.push(c),c.data.direction===W.ANY?a[c.data.color]=c:o[c.data.color]=c.data.direction,h[c.data.color]=[]):(a[c.data.color]&&c.data.getDistance(l[c.data.color].data)>=r&&Ps(c.data.direction,o[c.data.color],c.data.color)&&c.data.time-l[c.data.color].data.time<=s&&(u.push(a[c.data.color]),a[c.data.color]=null),c.data.direction!==W.ANY&&(o[c.data.color]=c.data.direction)):o[c.data.color]=c.data.direction,l[c.data.color]=c,h[c.data.color].push(c)}return u.map(d=>d.data.time).filter(function(d,f,c){return!f||d!==c[f-1]})}function Ps(e,t,i){return e===8||t===8?!1:(i===0?t===7:t===6)&&e===0}function Hf(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=Wf(e);t.length?Yt.output.html=mt("Shrado angle",t,e.settings.bpm,"warning"):Yt.output.html=null}const Lc="Speed Pause",xc="Look for stream/burst containing timing gap causing sudden change of pace.",kc=!1,Rc=.075;let Yi;const Ki=document.createElement("div"),ti=document.createElement("input"),xr=document.createElement("label"),ei=document.createElement("input"),kr=document.createElement("label");xr.textContent="stream speed (ms): ";xr.htmlFor="input__tools-speed-pause-time";ti.id="input__tools-speed-pause-time";ti.className="input-toggle input--small";ti.type="number";ti.min="0";ti.value=I(Rc*1e3,1).toString();ti.addEventListener("change",jf);kr.textContent=" (prec): ";kr.htmlFor="input__tools-speed-pause-prec";ei.id="input__tools-speed-pause-prec";ei.className="input-toggle input--small";ei.type="number";ei.min="0";ei.addEventListener("change",Xf);Ki.appendChild(_t.create(Lc,xc,kc,function(){ce.input.enabled=this.checked}));Ki.appendChild(xr);Ki.appendChild(ti);Ki.appendChild(kr);Ki.appendChild(ei);const ce={name:Lc,description:xc,type:"note",order:{input:pt.NOTES_SPEED_PAUSE,output:gt.NOTES_SPEED_PAUSE},input:{enabled:kc,params:{maxTime:Rc},html:Ki,adjustTime:Gf},output:{html:null},run:Yf};function Gf(e){Yi=e,ei.value=I(1/Yi.toBeatTime(ce.input.params.maxTime),2).toString()}function jf(){ce.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(ce.input.params.maxTime*1e3,1).toString(),Yi&&(ei.value=I(1/Yi.toBeatTime(ce.input.params.maxTime),2).toString())}function Xf(){if(!Yi){this.value="0";return}let e=I(Math.abs(parseFloat(this.value)),2)||1;ce.input.params.maxTime=Yi.toRealTime(1/e),ti.value=I(ce.input.params.maxTime*1e3,1).toString(),this.value=e.toString()}function zf(e,t){const{bpm:i}=e,{noteContainer:n}=t,{maxTime:r}=ce.input.params,s=i.toBeatTime(r)+.001,l={},o={},a={[ot.RED]:!1,[ot.BLUE]:!1},h={[ot.RED]:[],[ot.BLUE]:[]},u=[];for(let d=0,f=n.length;d<f;d++){if(n[d].type!=="note")continue;const c=n[d];l[c.data.color]?ie.next(c,l[c.data.color],i,h[c.data.color])&&(c.data.time-l[c.data.color].data.time<=s*2?(a[ot.RED]&&a[ot.BLUE]&&l[c.data.color].data.time-o[c.data.color].data.time<=s*3&&u.push(l[c.data.color]),a[c.data.color]=!1):a[c.data.color]||(a[c.data.color]=!0,o[c.data.color]=l[c.data.color]),h[c.data.color]=[],l[c.data.color]=c):l[c.data.color]=c,h[c.data.color].push(c)}return u.map(d=>d.data.time).filter(function(d,f,c){return!f||d!==c[f-1]})}function Yf(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=zf(e.settings,e.difficulty);t.length?ce.output.html=mt("Speed pause",t,e.settings.bpm,"warning"):ce.output.html=null}function ue(e){return Array.isArray(e)&&e.length===3&&e.every(t=>typeof t=="number")}function on(e,t){if(!e)return e;if(typeof t=="number")return e.map(i=>i*t);if(e=[...e],t)if(Array.isArray(t))for(let i=0;i<e.length;i++)typeof t[i]=="number"&&(e[i]*=t[i]);else switch(e.length){case 4:e[3]=e[3]*(t.w??1);case 3:e[2]=e[2]*(t.z??1);case 2:e[1]=e[1]*(t.y??1),e[0]=e[0]*(t.x??1)}return e}const Bc=class $e extends Ao{constructor(t={}){super(),this._time=t.b??t.time??$e.default.b,this._posX=t.x??t.posX??$e.default.x,this._posY=t.y??t.posY??$e.default.y,this._color=t.c??t.color??(t.type===0||t.type===1?t.type:$e.default.c),this._direction=t.d??t.direction??$e.default.d,this._angleOffset=t.a??t.angleOffset??$e.default.a,this._customData=K(t.customData??$e.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,a:this.angleOffset,customData:K(this.customData)}}get type(){return this._color}set type(t){this._color=t}get customData(){return this._customData}set customData(t){this._customData=t}mirror(t=!0,i){return i&&(this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ue(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(n=>{n[0]=-n[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(ue(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(n=>{n[0]=-n[0]})))),super.mirror(t)}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData.coordinates)return[this.customData.coordinates[0],this.customData.coordinates[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3+1:this.posX>=1e3?this.posX/1e3-1:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"vanilla":case"ne":return super.getAngle();case"me":default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):super.getAngle()}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.link=="string"}};Bc.default={b:0,c:0,x:0,y:0,d:0,a:0,customData:{}};let Se=Bc;const Ms="Hitbox Staircase",Fs="Check for overlapping post-swing hitbox with note hitbox during swing.",Ws=!0,fo={name:Ms,description:Fs,type:"note",order:{input:pt.NOTES_HITBOX_STAIR,output:gt.NOTES_HITBOX_STAIR},input:{enabled:Ws,params:{},html:_t.create(Ms,Fs,Ws,function(){fo.input.enabled=this.checked})},output:{html:null},run:Jf};function Uf(e,t,i){for(let n=i,r=t.length;n<r;n++)if(t[n].type==="note"){if(t[n].data.time<e.data.time+.01&&t[n].data.color!==e.data.color)return!0;if(t[n].data.time>e.data.time+.01)return!1}return!1}function Vf(e){const{bpm:t}=e.settings,{noteContainer:i}=e.difficulty,n=t.toBeatTime(.15),r={},s={},l={},o={[ot.RED]:[],[ot.BLUE]:[]},a={[ot.RED]:Se.create()[0],[ot.BLUE]:Se.create({c:1})[0]},h=[];for(let u=0,d=i.length;u<d;u++){if(i[u].type!=="note")continue;const f=i[u];r[f.data.color]?(ie.next(f,r[f.data.color],t,o[f.data.color])?(l[f.data.color]=f.data.time-r[f.data.color].data.time,f.data.direction!==W.ANY?(a[f.data.color].posX=f.data.posX+Oe[f.data.direction][0],a[f.data.color].posY=f.data.posY+Oe[f.data.direction][1]):(a[f.data.color].posX=-1,a[f.data.color].posY=-1),o[f.data.color]=[],s[f.data.color]=f.data.direction):ec(f.data,r[f.data.color].data,s[f.data.color])&&(f.data.direction!==W.ANY?(a[f.data.color].posX=f.data.posX+Oe[f.data.direction][0],a[f.data.color].posY=f.data.posY+Oe[f.data.direction][1],s[f.data.color]=f.data.direction):(a[f.data.color].posX=f.data.posX+Oe[s[f.data.color]][0],a[f.data.color].posY=f.data.posY+Oe[s[f.data.color]][1])),r[(f.data.color+1)%2]&&f.data.time-r[(f.data.color+1)%2].data.time!==0&&f.data.time-r[(f.data.color+1)%2].data.time<Math.min(n,l[(f.data.color+1)%2])&&f.data.posX===a[(f.data.color+1)%2].posX&&f.data.posY===a[(f.data.color+1)%2].posY&&!Uf(f,i,u)&&h.push(f)):(f.data.direction!==W.ANY?(a[f.data.color].posX=f.data.posX+Oe[f.data.direction][0],a[f.data.color].posY=f.data.posY+Oe[f.data.direction][1]):(a[f.data.color].posX=-1,a[f.data.color].posY=-1),s[f.data.color]=f.data.direction),r[f.data.color]=f,o[f.data.color].push(f)}return h.map(u=>u.data.time).filter(function(u,d,f){return!d||u!==f[d-1]})}function Jf(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=Vf(e);t.length?fo.output.html=mt("Hitbox staircase",t,e.settings.bpm,"rank"):fo.output.html=null}const Hs="Hitbox Reverse Staircase",Gs="Check for overlapping pre-swing hitbox with note hitbox during swing.",js=!0,mo={name:Hs,description:Gs,type:"note",order:{input:pt.NOTES_HITBOX_REVERSE_STAIR,output:gt.NOTES_HITBOX_REVERSE_STAIR},input:{enabled:js,params:{},html:_t.create(Hs,Gs,js,function(){mo.input.enabled=this.checked})},output:{html:null},run:Qf},qf=.03414823529,Kf=.03414823529;function Zf(e){const{bpm:t,njs:i}=e.settings,{noteContainer:n}=e.difficulty,r={},s={[ot.RED]:[],[ot.BLUE]:[]},l=[];for(let o=0,a=n.length;o<a;o++){if(n[o].type!=="note")continue;const h=n[o];r[h.data.color]&&ie.next(h,r[h.data.color],t,s[h.data.color])&&(s[h.data.color]=[]);for(const u of s[(h.data.color+1)%2])if(u.type==="note"&&u.data.direction!==W.ANY){if(!(t.toRealTime(h.data.time)>t.toRealTime(u.data.time)+.01))continue;const d=u.data.getAngle()%90>15&&u.data.getAngle()%90<75;if(i.value<1.425/(60*(h.data.time-u.data.time)/t.value+(d?Kf:qf))&&or(h.data,u.data,[[15,1.5]])[1]){l.push(u);break}}r[h.data.color]=h,s[h.data.color].push(h)}return l.map(o=>o.data.time).filter(function(o,a,h){return!a||o!==h[a-1]})}function Qf(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=Zf(e);t.length?mo.output.html=mt("Hitbox reverse Staircase",t,e.settings.bpm,"rank"):mo.output.html=null}const Xs="Hitbox Inline",zs="Check for overlapping note hitbox for inline note.",Ys=!0,po={name:Xs,description:zs,type:"note",order:{input:pt.NOTES_HITBOX_INLINE,output:gt.NOTES_HITBOX_INLINE},input:{enabled:Ys,params:{},html:_t.create(Xs,zs,Ys,function(){po.input.enabled=this.checked})},output:{html:null},run:im},tm=0;function em(e){const{bpm:t,njs:i}=e.settings,{noteContainer:n}=e.difficulty,r={},s={[ot.RED]:[],[ot.BLUE]:[]},l=[];for(let o=0,a=n.length;o<a;o++){if(n[o].type!=="note")continue;const h=n[o];r[h.data.color]&&ie.next(h,r[h.data.color],t,s[h.data.color])&&(s[h.data.color]=[]);for(const u of s[(h.data.color+1)%2])if(u.type==="note"&&i.value<1.425/(60*(h.data.time-u.data.time)/t.value+tm)&&h.data.isInline(u.data)){l.push(h);break}r[h.data.color]=h,s[h.data.color].push(h)}return l.map(o=>o.data.time).filter(function(o,a,h){return!a||o!==h[a-1]})}function im(e){const t=em(e);t.length?po.output.html=mt("Hitbox inline",t,e.settings.bpm,"rank"):po.output.html=null}const Us="Hitbox Path",Vs="Check for overlapping pre-swing note hitbox at same time.",Js=!0,go={name:Us,description:Vs,type:"note",order:{input:pt.NOTES_HITBOX_PATH,output:gt.NOTES_HITBOX_PATH},input:{enabled:Js,params:{},html:_t.create(Us,Vs,Js,function(){go.input.enabled=this.checked})},output:{html:null},run:om};function nm(e){const{bpm:t}=e.settings,i=e.difficulty.noteContainer.filter(s=>s.type==="bomb"||s.type==="note"),n=[];let r=0;for(let s=0,l=i.length;s<l;s++){const o=i[s];if(!(o.type==="bomb"||o.type==="arc"||o.type==="chain"||t.toRealTime(o.data.time)<r+.01))for(let a=s+1;a<l;a++){const h=i[a];if(t.toRealTime(h.data.time)>t.toRealTime(o.data.time)+.01)break;h.type==="note"&&o.data.color===h.data.color||((o.data.isHorizontal(h.data)||o.data.isVertical(h.data))&&or(o.data,h.data,[[45,1],[15,2]]).some(u=>u)||o.data.isDiagonal(h.data)&&or(o.data,h.data,[[45,1],[15,1.5]]).some(u=>u))&&(n.push(o.data),r=t.toRealTime(o.data.time))}}return n.map(s=>s.time).filter(function(s,l,o){return!l||s!==o[l-1]})}function om(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=nm(e);t.length?go.output.html=mt("Hitbox path",t,e.settings.bpm,"error"):go.output.html=null}const qs="Improper Arc",Ks="Check for correct use of arc.",Zs=!0,_o={name:qs,description:Ks,type:"note",order:{input:pt.NOTES_IMPROPER_ARC,output:gt.NOTES_IMPROPER_ARC},input:{enabled:Zs,params:{},html:_t.create(qs,Ks,Zs,function(){_o.input.enabled=this.checked})},output:{html:null},run:sm};function rm(e){const t=[...e.difficulty.noteContainer].sort((n,r)=>n.type!=="arc"?1:r.type!=="arc"?-1:0).sort((n,r)=>n.data.time-r.data.time),i=[];for(let n=0,r=!0,s=t.length;n<s;n++){const l=t[n],o=t.at(-1).data.time;if(l.type==="arc"){r=!0;for(let a=n,h=!1;a<s;a++){const u=t[a];if(u.type==="note"&&l.data.posX===u.data.posX&&l.data.posY===u.data.posY&&u.data.time<=l.data.time+.001&&l.data.color===u.data.color&&(u.data.direction===W.ANY||l.data.direction===u.data.direction)){for(let d=a;d<s;d++){const f=t[a];if(f.type==="bomb"&&l.data.posX===f.data.posX&&l.data.posY===f.data.posY&&f.data.time<=l.data.time+.001){h=!0;break}if(!(f.type!=="note"||f.data.time<l.data.tailTime)){if(l.data.posX===u.data.posX&&l.data.posY===u.data.posY&&u.data.time<=l.data.time+.001&&(l.data.color!==u.data.color||(u.data.direction===W.ANY||l.data.direction!==u.data.direction))){h=!0;break}if(u.data.time>l.data.tailTime+.001)break}}r=h||!1;break}if(u.type==="bomb"&&l.data.posX===u.data.posX&&l.data.posY===u.data.posY&&u.data.time<=l.data.time+.001)break;if(u.data.time>l.data.time+.001){r=!1;break}(u.type==="arc"||u.type==="chain")&&u.data.time+.001>o&&(r=!1)}r&&i.push(l)}}return i.map(n=>n.data.time).filter(function(n,r,s){return!r||n!==s[r-1]})}function sm(e){const t=rm(e);t.length?_o.output.html=mt("Improper arc",t,e.settings.bpm,"error"):_o.output.html=null}const Qs="Improper Chain",ta="Check for correct use of chain.",ea=!0,bo={name:Qs,description:ta,type:"note",order:{input:pt.NOTES_IMPROPER_CHAIN,output:gt.NOTES_IMPROPER_CHAIN},input:{enabled:ea,params:{},html:_t.create(Qs,ta,ea,function(){bo.input.enabled=this.checked})},output:{html:null},run:lm};function am(e){const t=[...e.difficulty.noteContainer].sort((n,r)=>n.type!=="chain"?1:r.type!=="chain"?-1:0).sort((n,r)=>n.data.time-r.data.time),i=[];for(let n=0,r=!0,s=t.length;n<s;n++){const l=t[n];if(l.type==="chain"){r=!0;for(let o=n;o<s;o++){const a=t[o];if(a.type==="note"&&l.data.posX===a.data.posX&&l.data.posY===a.data.posY&&a.data.time<=l.data.time+.001&&l.data.color===a.data.color&&(a.data.direction===W.ANY||l.data.direction===a.data.direction)){r=!1;break}if(a.type==="bomb"&&l.data.posX===a.data.posX&&l.data.posY===a.data.posY&&a.data.time<=l.data.time+.001||a.data.time>l.data.time+.001)break}r&&i.push(l)}}return i.map(n=>n.data.time).filter(function(n,r,s){return!r||n!==s[r-1]})}function lm(e){const t=am(e);t.length?bo.output.html=mt("Improper chain",t,e.settings.bpm,"error"):bo.output.html=null}const ia="Improper Window Snap",na="Check for slanted window snap timing.",oa=!0,vo={name:ia,description:na,type:"note",order:{input:pt.NOTES_IMPROPER_WINDOW,output:gt.NOTES_IMPROPER_WINDOW},input:{enabled:oa,params:{},html:_t.create(ia,na,oa,function(){vo.input.enabled=this.checked})},output:{html:null},run:um};function cm(e){const{bpm:t}=e.settings,{noteContainer:i}=e.difficulty,n={},r={[ot.RED]:[],[ot.BLUE]:[]},s=[];for(let l=0,o=i.length;l<o;l++){if(i[l].type!=="note")continue;const a=i[l];n[a.data.color]?ie.next(a,n[a.data.color],t,r[a.data.color])?(n[a.data.color]=a,r[a.data.color]=[]):a.data.isSlantedWindow(n[a.data.color].data)&&a.data.time-n[a.data.color].data.time>=.001&&a.data.direction===n[a.data.color].data.direction&&a.data.direction!==W.ANY&&n[a.data.color].data.direction!==W.ANY&&s.push(n[a.data.color]):n[a.data.color]=a,r[a.data.color].push(a)}return s.map(l=>l.data.time).filter(function(l,o,a){return!o||l!==a[o-1]})}function um(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=cm(e);t.length?vo.output.html=mt("Improper window snap",t,e.settings.bpm,"error"):vo.output.html=null}const Ln={create:(e,t,i,n,...r)=>{const s=document.createElement(i);s.className=n;const l=document.createElement("select");l.className="input-toggle",l.id=e,r.forEach(a=>{const h=document.createElement("option");h.textContent=a.text,h.value=a.value,l.append(h)});const o=document.createElement("label");return o.htmlFor=e,o.innerHTML=`<span>${t}</span>`,s.append(o),s.append(l),s}};var Nc=(e=>(e.forehand="backhand",e.backhand="forehand",e))(Nc||{});const Mn={[ot.RED]:{forehand:[W.DOWN,W.RIGHT,W.DOWN_LEFT,W.DOWN_RIGHT],backhand:[W.UP,W.LEFT,W.UP_LEFT,W.UP_RIGHT]},[ot.BLUE]:{forehand:[W.DOWN,W.LEFT,W.DOWN_LEFT,W.DOWN_RIGHT],backhand:[W.UP,W.RIGHT,W.UP_LEFT,W.UP_RIGHT]}},li={[ot.RED]:[0,0,90,90,45,-45,45,-45],[ot.BLUE]:[0,0,-90,-90,-45,45,-45,45]},ra={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},Ac=class an{constructor(t,i,n,r,s,l){this.color=i,this.warningThreshold=n,this.errorThreshold=r,this.allowedRotation=s,l&&l!=="neutral"?(this.state=l,this.rotation=0):(this.state=this.predictStartState(t,i),this.rotation=this.predictStartRotation(t,i)),this.position=this.predictStartPosition(t,i)}check(t,i){if(this.state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const n=t[0].data.time,r=this.color;let s=this.state,l=this.rotation;i.forEach(u=>{u.data.time-.001>n||(u.data.posY===xt.BOTTOM&&u.data.posX===(r?at.MIDDLE_RIGHT:at.MIDDLE_LEFT)&&(s="backhand",l=0),u.data.posY===xt.TOP&&u.data.posX===(r?at.MIDDLE_RIGHT:at.MIDDLE_LEFT)&&(s="forehand",l=0))});let o,a=W.ANY;for(const u of t)u.type==="note"&&(u.data.direction!==W.ANY&&(a=u.data.direction),o&&a===W.ANY&&(a=xs(u.data,o.data)),o=u);if(a===W.ANY)return"none";const h=ra[r][Nc[s]][a];return(l>h?l-h:h-l)>180||h<an.CONSTRAINT_ROTATION[r][0]+this.errorThreshold||h>an.CONSTRAINT_ROTATION[r][1]-this.errorThreshold?"error":h<an.CONSTRAINT_ROTATION[r][0]+this.warningThreshold||h>an.CONSTRAINT_ROTATION[r][1]-this.warningThreshold||(l>h?l-h:h-l)>this.allowedRotation?"warning":"none"}next(t,i){if(this.check(t,i)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let o=0;o<t.length;o++){if(t[o].type!=="note")continue;const a=t[o];if(Mn[a.data.color].forehand.includes(a.data.direction)){this.state="backhand";break}if(Mn[a.data.color].backhand.includes(a.data.direction)){this.state="forehand";break}this.state==="neutral"&&a.data.direction===W.ANY&&(a.data.posY===0&&(this.state="backhand"),a.data.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const n=t[0].data.time,r=this.color;i.forEach(o=>{o.data.time-.001>n||(o.data.posY===xt.BOTTOM&&o.data.posX===(r?at.MIDDLE_RIGHT:at.MIDDLE_LEFT)&&(this.state="forehand",this.rotation=0),o.data.posY===xt.TOP&&o.data.posX===(r?at.MIDDLE_RIGHT:at.MIDDLE_LEFT)&&(this.state="backhand",this.rotation=0))});let s,l=W.ANY;for(const o of t)o.type==="note"&&(o.data.direction!==W.ANY&&(l=o.data.direction),s&&l===W.ANY&&(l=xs(o.data,s.data)),s=o);l!==W.ANY&&(this.rotation=ra[this.color][this.state][l])}predictStartState(t,i){let n="neutral";for(let r=0,s=t.length;r<s;r++){if(t[r].type==="bomb"&&(t[r].data.posY===xt.BOTTOM&&(t[r].data.posX===i?at.MIDDLE_RIGHT:at.MIDDLE_LEFT)&&(n="backhand"),t[r].data.posY===xt.TOP&&(t[r].data.posX===i?at.MIDDLE_RIGHT:at.MIDDLE_LEFT)&&(n="forehand")),t[r].type!=="note")continue;let l=t[r];if(l.data.color!==Math.abs(i-1)&&l.data.color===i){if(n!=="neutral")break;const o=l.data.time;for(let a=r;a<t.length&&!(t[a].data.time>l.data.time+.001&&o<l.data.time+.001);a++){if(l=t[a],Mn[l.data.color].forehand.includes(l.data.direction))return"backhand";if(Mn[l.data.color].backhand.includes(l.data.direction))return"forehand";n==="neutral"&&l.data.direction===W.ANY&&(l.data.posY===xt.BOTTOM&&(n="backhand"),l.data.posY>xt.BOTTOM&&(n="forehand"))}break}}return n}predictStartRotation(t,i){let n=0;for(let r=0,s=t.length;r<s;r++){if(t[r].type!=="note")continue;let l=t[r];if(l.data.color===i&&l.data.color===i){const o=l.data.time;for(let a=r;a<t.length&&!(t[a].data.time>l.data.time+.001&&o<l.data.time+.001);a++){if(l=t[a],l.data.direction!==W.ANY)return li[l.data.color][l.data.direction];l.data.direction===W.ANY&&(l.data.posY===xt.BOTTOM&&(l.data.posX===at.LEFT&&(n=li[l.data.color][6]),l.data.posX===at.RIGHT&&(n=li[l.data.color][7])),l.data.posY===xt.MIDDLE&&(l.data.posX===at.LEFT&&(n=li[l.data.color][2]),l.data.posX===at.RIGHT&&(n=li[l.data.color][3])),l.data.posY===xt.BOTTOM&&(l.data.posX===at.LEFT&&(n=li[l.data.color][4]),l.data.posX===at.RIGHT&&(n=li[l.data.color][5])))}break}}return n}predictStartPosition(t,i){return i?[-.5,1]:[.5,1]}};Ac.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];let sa=Ac;const Ic="Parity Check",Oc="Perform parity check.",$c=!1,Pc=document.createElement("div");Ln.create("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});Ln.create("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Ln.create("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Pc.appendChild(_t.create(Ic+" (EXPERIMENTAL)",Oc,$c,function(){wn.input.enabled=this.checked}));const wn={name:Ic,description:Oc,type:"note",order:{input:pt.NOTES_PARITY,output:gt.NOTES_PARITY},input:{enabled:$c,params:{warningThres:90,errorThres:45,allowedRot:90},html:Pc},output:{html:null},run:fm};function hm(e){const{bpm:t}=e.settings,{noteContainer:i}=e.difficulty,{warningThres:n,errorThres:r,allowedRot:s}=wn.input.params,l={},o={[ot.RED]:[],[ot.BLUE]:[]},a={[ot.RED]:[],[ot.BLUE]:[]},h={[ot.RED]:[],[ot.BLUE]:[]},u={[ot.RED]:new sa(i,0,n,r,s),[ot.BLUE]:new sa(i,1,n,r,s)},d={warning:[],error:[]};for(let f=0,c=i.length;f<c;f++){const g=i[f];if(g.type==="note"&&l[g.data.color]&&ie.next(g,l[g.data.color],t,o[g.data.color])){switch(u[g.data.color].check(o[g.data.color],h[g.data.color])){case"warning":{d.warning.push(o[g.data.color][0].data.time);break}case"error":{d.error.push(o[g.data.color][0].data.time);break}}u[g.data.color].next(o[g.data.color],h[g.data.color]),h[g.data.color]=a[g.data.color],a[g.data.color]=[],o[g.data.color]=[]}g.type==="bomb"&&(a[ot.RED].push(g),a[ot.BLUE].push(g)),g.type==="note"&&(l[g.data.color]=g,o[g.data.color].push(g))}for(let f=0;f<2;f++)if(l[f])switch(u[f].check(o[f],a[f])){case"warning":{d.warning.push(o[f][0].data.time);break}case"error":{d.error.push(o[f][0].data.time);break}}return d}function fm(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=hm(e);t.warning=t.warning.filter(function(n,r,s){return!r||n!==s[r-1]}).sort((n,r)=>n-r),t.error=t.error.filter(function(n,r,s){return!r||n!==s[r-1]}).sort((n,r)=>n-r);const i=[];if(t.warning.length&&i.push(mt("Parity warning",t.warning,e.settings.bpm,"warning")),t.error.length&&i.push(mt("Parity error",t.error,e.settings.bpm,"error")),i.length){const n=document.createElement("div");i.forEach(r=>n.append(r)),wn.output.html=n}else wn.output.html=null}const aa="Double-directional",la="Check double-directional note swing (this may not mean parity break).",ca=!0,yo={name:aa,description:la,type:"note",order:{input:pt.NOTES_DOUBLE_DIRECTIONAL,output:gt.NOTES_DOUBLE_DIRECTIONAL},input:{enabled:ca,params:{},html:_t.create(aa,la,ca,function(){yo.input.enabled=this.checked})},output:{html:null},run:dm};function mm(e,t){const{bpm:i}=e,n=t.noteContainer,r={},s={},l={},o={[ot.RED]:[],[ot.BLUE]:[]},a=[];for(let h=0,u=n.length;h<u;h++){const d=n[h];d.type==="note"&&r[d.data.color]?ie.next(d,r[d.data.color],i,o[d.data.color])?(l[d.data.color]&&(l[d.data.color]=null,s[d.data.color]=(s[d.data.color]+180)%360),Dn(d.data,s[d.data.color],45,!0)&&a.push(d.data),d.data.direction===W.ANY?l[d.data.color]=d.data:s[d.data.color]=d.data.getAngle(),o[d.data.color]=[]):(l[d.data.color]&&Dn(d.data,s[d.data.color],45,!0)&&(a.push(d.data),l[d.data.color]=null,s[d.data.color]=d.data.getAngle()),d.data.direction!==W.ANY&&(l[d.data.color]=null,s[d.data.color]=d.data.getAngle())):d.type==="note"&&(s[d.data.color]=d.data.getAngle()),d.type==="note"&&(r[d.data.color]=d,o[d.data.color].push(d)),d.type==="bomb"&&(d.data.posY===xt.BOTTOM&&(d.data.posX===at.MIDDLE_LEFT&&(s[ot.RED]=ae[W.UP],l[ot.RED]=null),d.data.posX===at.MIDDLE_RIGHT&&(s[ot.BLUE]=ae[W.UP],l[ot.BLUE]=null)),d.data.posY===xt.TOP&&(d.data.posX===at.MIDDLE_LEFT&&(s[ot.RED]=ae[W.DOWN],l[ot.RED]=null),d.data.posX===at.MIDDLE_RIGHT&&(s[ot.BLUE]=ae[W.DOWN],l[ot.BLUE]=null)))}return a.map(h=>h.time).filter(function(h,u,d){return!u||h!==d[u-1]})}function dm(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=mm(e.settings,e.difficulty);t.length?yo.output.html=mt("Double-directional",t,e.settings.bpm,"warning"):yo.output.html=null}const Mc="Vision Block",Fc="Check for vision block caused by center note.",Wc=!0,Hc=.1,Gc=.5;let Ut;const ua={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},At=document.createElement("div"),Di=document.createElement("input"),Rr=document.createElement("label"),ii=document.createElement("input"),Br=document.createElement("label"),ni=document.createElement("input"),Nr=document.createElement("label"),ke=document.createElement("input"),Ar=document.createElement("label"),Ee=document.createElement("input"),Ir=document.createElement("label"),fe=document.createElement("input"),Or=document.createElement("label");Rr.textContent=" VB time specific ";Rr.htmlFor="input__tools-vb-time-check";Di.id="input__tools-vb-time-check";Di.className="input-toggle";Di.type="radio";Di.name="input__tools-vb-spec";Di.value="time";Di.addEventListener("change",jc);Br.textContent=" VB difficulty specific ";Br.htmlFor="input__tools-vb-diff-check";ii.id="input__tools-vb-diff-check";ii.className="input-toggle";ii.type="radio";ii.checked=!0;ii.name="input__tools-vb-spec";ii.value="difficulty";ii.addEventListener("change",jc);Nr.textContent="min time (ms): ";Nr.htmlFor="input__tools-vb-min-time";ni.id="input__tools-vb-min-time";ni.className="input-toggle input--small";ni.type="number";ni.min="0";ni.value=I(Hc*1e3,1).toString();ni.addEventListener("change",gm);Ar.textContent=" (beat): ";Ar.htmlFor="input__tools-vb-min-beat";ke.id="input__tools-vb-min-beat";ke.className="input-toggle input--small";ke.type="number";ke.min="0";ke.step="0.1";ke.addEventListener("change",_m);Ir.textContent="max time (ms): ";Ir.htmlFor="input__tools-vb-max-time";Ee.id="input__tools-vb-max-time";Ee.className="input-toggle input--small";Ee.type="number";Ee.min="0";Ee.value=I(Gc*1e3,1).toString();Ee.addEventListener("change",bm);Or.textContent=" (beat): ";Or.htmlFor="input__tools-vb-max-beat";fe.id="input__tools-vb-max-beat";fe.className="input-toggle input--small";fe.type="number";fe.min="0";fe.step="0.1";fe.addEventListener("change",vm);At.appendChild(_t.create(Mc,Fc,Wc,function(){yt.input.enabled=this.checked}));At.appendChild(Di);At.appendChild(Rr);At.appendChild(ii);At.appendChild(Br);At.appendChild(document.createElement("br"));At.appendChild(Nr);At.appendChild(ni);At.appendChild(Ar);At.appendChild(ke);At.appendChild(document.createElement("br"));At.appendChild(Ir);At.appendChild(Ee);At.appendChild(Or);At.appendChild(fe);const yt={name:Mc,description:Fc,type:"note",order:{input:pt.NOTES_VISION_BLOCK,output:gt.NOTES_VISION_BLOCK},input:{enabled:Wc,params:{specific:"difficulty",minTime:Hc,maxTime:Gc},html:At,adjustTime:pm},output:{html:null},run:Em};function pm(e){Ut=e,ke.value=I(Ut.toBeatTime(yt.input.params.minTime),2).toString(),fe.value=I(Ut.toBeatTime(yt.input.params.maxTime),2).toString()}function jc(){yt.input.params.specific=this.value}function gm(){yt.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(yt.input.params.minTime*1e3,1).toString(),Ut&&(ke.value=I(Ut.toBeatTime(yt.input.params.minTime),2).toString(),yt.input.params.minTime>yt.input.params.maxTime&&(yt.input.params.maxTime=yt.input.params.minTime,Ee.value=I(yt.input.params.maxTime*1e3,1).toString(),fe.value=I(Ut.toBeatTime(yt.input.params.maxTime),2).toString()))}function _m(){if(!Ut){this.value="0";return}const e=Math.abs(parseFloat(this.value))||1;yt.input.params.minTime=Ut.toRealTime(e),ni.value=I(yt.input.params.minTime*1e3,1).toString(),this.value=I(e,2).toString(),yt.input.params.minTime>yt.input.params.maxTime&&(yt.input.params.maxTime=yt.input.params.minTime,Ee.value=I(yt.input.params.maxTime*1e3,1).toString(),fe.value=I(Ut.toBeatTime(yt.input.params.maxTime),2).toString())}function bm(){yt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(yt.input.params.maxTime*1e3,1).toString(),Ut&&(fe.value=I(Ut.toBeatTime(yt.input.params.maxTime),2).toString())}function vm(){if(!Ut){this.value="0";return}const e=Math.abs(parseFloat(this.value))||1;yt.input.params.maxTime=Ut.toRealTime(e),Ee.value=I(yt.input.params.maxTime*1e3,1).toString(),this.value=I(e,2).toString()}function ym(e){const{bpm:t,njs:i}=e.settings,n=e.difficulty.data.getNoteContainer().filter(f=>f.type!=="arc"),{minTime:r,maxTime:s,specific:l}=yt.input.params,o=l==="time"?t.toBeatTime(r):t.toBeatTime(ua[e.difficulty.difficulty].min),a=l==="time"?t.toBeatTime(s):Math.min(i.hjd,t.toBeatTime(ua[e.difficulty.difficulty].max));let h=null,u=null;const d=[];for(let f=0,c=n.length;f<c;f++){const g=n[f];h&&(g.data.time-h.data.time>=o&&g.data.time-h.data.time<=a?g.data.posX<at.MIDDLE_RIGHT&&d.push(g):g.data.time-h.data.time>a&&(h=null)),u&&(g.data.time-u.data.time>=o&&g.data.time-u.data.time<=a?g.data.posX>at.MIDDLE_LEFT&&d.push(g):g.data.time-u.data.time>a&&(u=null)),g.data.posY===xt.MIDDLE&&g.data.posX===at.MIDDLE_LEFT&&(h=g),g.data.posY===xt.MIDDLE&&g.data.posX===at.MIDDLE_RIGHT&&(u=g)}return d.map(f=>f.data.time).filter(function(f,c,g){return!c||f!==g[c-1]})}function Em(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=ym(e);t.length?yt.output.html=mt("Vision block",t,e.settings.bpm,"warning"):yt.output.html=null}const ha="Stacked Note",fa="Look for stacked note.",ma=!0,Eo={name:ha,description:fa,type:"note",order:{input:pt.NOTES_STACKED_NOTE,output:gt.NOTES_STACKED_NOTE},input:{enabled:ma,params:{},html:_t.create(ha,fa,ma,function(){Eo.input.enabled=this.checked})},output:{html:null},run:Sm};function Dm(e,t){const{bpm:i}=e,{colorNotes:n}=t.data,r=[];let s=0;for(let l=0,o=n.length;l<o;l++)if(!(i.toRealTime(n[l].time)<s+.01))for(let a=l+1;a<o&&!(i.toRealTime(n[a].time)>i.toRealTime(n[l].time)+.01);a++)n[a].isInline(n[l])&&(r.push(n[l]),s=i.toRealTime(n[l].time));return r.map(l=>l.time).filter(function(l,o,a){return!o||l!==a[o-1]})}function wm(e,t){const{bpm:i,njs:n}=e,{bombNotes:r}=t.data,s=[];for(let l=0,o=r.length;l<o;l++)for(let a=l+1;a<o&&!(i.toRealTime(r[a].time)>i.toRealTime(r[l].time)+1);a++)r[l].isInline(r[a])&&(n.value<i.value/(120*(r[a].time-r[l].time))||i.toRealTime(r[a].time)<i.toRealTime(r[l].time)+.02)&&s.push(r[l]);return s.map(l=>l.time).filter(function(l,o,a){return!o||l!==a[o-1]})}function Sm(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=Dm(e.settings,e.difficulty),i=wm(e.settings,e.difficulty),n=[];if(t.length&&n.push(mt("Stacked note",t,e.settings.bpm,"error")),i.length&&n.push(mt("Stacked bomb",i,e.settings.bpm,"error")),n.length){const r=document.createElement("div");n.forEach(s=>r.append(s)),Eo.output.html=r}else Eo.output.html=null}const da="Color Check",pa="Compare note color with other colored note and the arrow on itself.",ga=!0,_a=[1,1,1],ba={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"};function va(e,t){let i=Object.keys(e).find(r=>parseFloat(r)>=t)??"100",n=parseFloat(i);return e[n]}const Do={name:da,description:pa,type:"note",order:{input:pt.NOTES_COLOR_CHECK,output:gt.NOTES_COLOR_CHECK},input:{enabled:ga,params:{},html:_t.create(da+" (EXPERIMENTAL)",pa,ga,function(){Do.input.enabled=this.checked})},output:{html:null},run:Lm};function Cm(e){var n,r,s,l;const t=((r=(n=e.difficulty)==null?void 0:n.info.customData)==null?void 0:r._colorLeft)??se[re[e.info.environmentName]??"The First"]._colorLeft,i=((l=(s=e.difficulty)==null?void 0:s.info.customData)==null?void 0:l._colorRight)??se[re[e.info.environmentName]??"The First"]._colorRight;return t&&i?tr(Qt(t),Qt(i)):100}function Tm(e){var s,l,o,a;let t=100,i=100;const n=((l=(s=e.difficulty)==null?void 0:s.info.customData)==null?void 0:l._colorLeft)??se[re[e.info.environmentName]??"The First"]._colorLeft,r=((a=(o=e.difficulty)==null?void 0:o.info.customData)==null?void 0:a._colorRight)??se[re[e.info.environmentName]??"The First"]._colorRight;return n&&(t=tr(_a,Qt(n))),r&&(i=tr(_a,Qt(r))),Math.min(t,i)}function Lm(e){var r,s,l,o;if(!((s=(r=e.difficulty)==null?void 0:r.info.customData)!=null&&s._colorLeft)&&!((o=(l=e.difficulty)==null?void 0:l.info.customData)!=null&&o._colorRight))return;const t=Cm(e),i=Tm(e),n=[];if(t<=20&&n.push(dt(`${va(ba,t)} note color (dE${I(t,1)})`,"suggest change to better differentiate between 2 note colour","warning")),i<=20&&n.push(dt(`${va(ba,i)} arrow note color (dE${I(i,1)})`,"may be difficult to see the arrow","warning")),n.length){const a=document.createElement("div");n.forEach(h=>a.append(h)),Do.output.html=a}else Do.output.html=null}const ya=Object.freeze(Object.defineProperty({__proto__:null,acceptablePrec:_i,colorCheck:Do,doubleDirectional:yo,effectiveBPM:Gt,hitboxInline:po,hitboxPath:go,hitboxReverseStair:mo,hitboxStair:fo,improperArc:_o,improperChain:bo,improperWindow:vo,inlineAngle:le,parity:wn,shradoAngle:Yt,slowSlider:te,speedPause:ce,stackedNote:Eo,varySwing:ho,visionBlock:yt},Symbol.toStringTag,{value:"Module"}));class $r extends No{get duration(){return this._duration}set duration(t){this._duration=t}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}mirror(t,i){return this.posX=Bo-1-(this.posX+this.width-1),this}getPosition(t){return[this.posX-2,this.posY-.5]}isInteractive(t){return this.posX<0&&this.width>1-this.posX||this.posX===0&&this.width>1||this.posX===1||this.posX===2}isLonger(t,i=0,n){return this.time+this.duration>t.time+t.duration+i}hasZero(){return this.duration===0||this.width===0||this.height===0}hasNegative(){return this.posY<0||this.duration<0||this.width<0||this.height<0}isValid(){return!this.isMappingExtensions()&&!this.hasZero()&&!this.hasNegative()}}const Xc=class Pe extends $r{constructor(t={}){super(),this._time=t.b??t.time??Pe.default.b,this._posX=t.x??t.posX??Pe.default.x,this._posY=t.y??t.posY??Pe.default.y,this._duration=t.d??t.duration??Pe.default.d,this._width=t.w??t.width??Pe.default.w,this._height=t.h??t.height??Pe.default.h,this._customData=K(t.customData??Pe.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.duration,w:this.width,h:this.height,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}mirror(t,i){var n;if(i){const r=((n=this.customData.size)==null?void 0:n[0])??this.width;this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ue(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]-(this.posX+r-1):this.customData.animation.definitePosition.forEach(s=>{s[0]=-s[0]-(this.posX+r-1)})),Array.isArray(this.customData.animation.offsetPosition)&&(ue(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]-(this.posX+r-1):this.customData.animation.offsetPosition.forEach(s=>{s[0]=-s[0]-(this.posX+r-1)})))}return super.mirror()}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData.coordinates)return[this.customData.coordinates[0],this.customData.coordinates[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3+1:this.posX>=1e3?this.posX/1e3-1:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}}isChroma(){return Array.isArray(this.customData.color)}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||Array.isArray(this.customData.size)}isMappingExtensions(){return this.posY<0||this.posY>2||this.posX<=-1e3||this.posX>=1e3||this.width<=-1e3||this.width>=1e3||this.height<=-1e3||this.height>=1e3}};Xc.default={b:0,x:0,y:0,d:0,w:0,h:0,customData:{}};let zt=Xc;const Ea="<15ms Obstacle",Da=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,wa=!0,Sn={name:Ea,description:Da,type:"obstacle",order:{input:pt.OBSTACLES_SHORT,output:gt.OBSTACLES_SHORT},input:{enabled:wa,params:{minDur:.015},html:_t.create(Ea,Da,wa,function(){Sn.input.enabled=this.checked})},output:{html:null},run:km};function xm(e){const{obstacles:t}=e.difficulty.data,{bpm:i}=e.settings,{minDur:n}=Sn.input.params,r=i.toBeatTime(n),s=[];let l=zt.create()[0],o=zt.create()[0],a=zt.create()[0],h=zt.create()[0];return t.forEach(u=>{u.posY===xt.BOTTOM&&u.height>2&&u.duration>0?u.width>2||u.width>1&&u.posX===1?(u.isLonger(l)&&(u.duration<r&&s.push(u),l=u),u.isLonger(o)&&(u.duration<r&&s.push(u),o=u)):u.width===2?u.posX===at.LEFT?u.isLonger(l)&&(u.duration<r&&s.push(u),l=u):u.posX===at.MIDDLE_RIGHT&&u.isLonger(o)&&(u.duration<r&&s.push(u),o=u):u.width===1&&(u.posX===at.MIDDLE_LEFT?u.isLonger(l)&&(u.duration<r&&s.push(u),l=u):u.posX===at.MIDDLE_RIGHT&&u.isLonger(o)&&(u.duration<r&&s.push(u),o=u)):u.posY===xt.TOP&&u.height>2&&u.duration>0&&(u.width>2||u.width>1&&u.posX===at.MIDDLE_LEFT?(u.isLonger(a)&&(u.duration<r&&u.isLonger(l,r)&&u.isLonger(a,r)&&s.push(u),a=u),u.isLonger(h)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(h,r)&&s.push(u),h=u)):u.width===2?u.posX===at.LEFT?u.isLonger(a)&&(u.duration<r&&u.isLonger(l,r)&&u.isLonger(a,r)&&s.push(u),a=u):u.posX===at.MIDDLE_RIGHT&&u.isLonger(h)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(h,r)&&s.push(u),h=u):u.width===1&&(u.posX===at.MIDDLE_LEFT?u.isLonger(a)&&(u.duration<r&&u.isLonger(l,r)&&u.isLonger(a,r)&&s.push(u),a=u):u.posX===at.MIDDLE_RIGHT&&u.isLonger(h)&&(u.duration<r&&u.isLonger(o,r)&&u.isLonger(h,r)&&s.push(u),h=u)))}),s.map(u=>u.time).filter(function(u,d,f){return!d||u!==f[d-1]})}function km(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=xm(e);t.length?Sn.output.html=mt("<15ms obstacle",t,e.settings.bpm,"warning"):Sn.output.html=null}const zc="2-wide Center Obstacle",Yc="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",Uc=!0,Vc=.25;let Ui;const Zi=document.createElement("div"),oi=document.createElement("input"),Pr=document.createElement("label"),Re=document.createElement("input"),Mr=document.createElement("label");Pr.textContent="recovery time (ms): ";Pr.htmlFor="input__tools-2wide-wall-time";oi.id="input__tools-2wide-wall-time";oi.className="input-toggle input--small";oi.type="number";oi.min="0";oi.value=I(Vc*1e3,1).toString();oi.addEventListener("change",Bm);Mr.textContent=" (beat): ";Mr.htmlFor="input__tools-2wide-wall-beat";Re.id="input__tools-2wide-wall-beat";Re.className="input-toggle input--small";Re.type="number";Re.min="0";Re.step="0.1";Re.addEventListener("change",Nm);Zi.appendChild(_t.create(zc,Yc,Uc,function(){ee.input.enabled=this.checked}));Zi.appendChild(Pr);Zi.appendChild(oi);Zi.appendChild(Mr);Zi.appendChild(Re);const ee={name:zc,description:Yc,type:"obstacle",order:{input:pt.OBSTACLES_CENTER,output:gt.OBSTACLES_CENTER},input:{enabled:Uc,params:{recovery:Vc},html:Zi,adjustTime:Rm},output:{html:null},run:Im};function Rm(e){Ui=e,Re.value=I(Ui.toBeatTime(ee.input.params.recovery),2).toString()}function Bm(){ee.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=I(ee.input.params.recovery*1e3,1).toString(),Ui&&(Re.value=I(Ui.toBeatTime(ee.input.params.recovery),2).toString())}function Nm(){if(!Ui){this.value="0";return}let e=I(Math.abs(parseFloat(this.value)),2)||1;ee.input.params.recovery=Ui.toRealTime(e),oi.value=I(ee.input.params.recovery*1e3,1).toString(),this.value=e.toString()}function Am(e){const{obstacles:t}=e.difficulty.data,{bpm:i}=e.settings,{recovery:n}=ee.input.params,r=[];let s=zt.create()[0],l=zt.create()[0];return t.forEach(o=>{o.posY<xt.TOP&&o.height>1&&(o.width>2&&(r.push(o),o.isLonger(s)&&(s=o),o.isLonger(l)&&(l=o)),o.width===2&&(o.posX===at.LEFT&&o.isLonger(s)&&(i.toRealTime(o.time)>i.toRealTime(l.time)-n&&i.toRealTime(o.time)<i.toRealTime(l.time+l.duration)+n&&r.push(o),s=o),o.posX===at.MIDDLE_LEFT&&(r.push(o),o.isLonger(s)&&(s=o),o.isLonger(l)&&(l=o)),o.posX===at.MIDDLE_RIGHT&&o.isLonger(l)&&(i.toRealTime(o.time)>i.toRealTime(s.time)-n&&i.toRealTime(o.time)<i.toRealTime(s.time+s.duration)+n&&r.push(o),l=o)),o.width===1&&(o.posX===at.MIDDLE_LEFT&&o.isLonger(s)&&(i.toRealTime(o.time)>i.toRealTime(l.time)-n&&i.toRealTime(o.time)<i.toRealTime(l.time+l.duration)+n&&r.push(o),s=o),o.posX===at.MIDDLE_RIGHT&&o.isLonger(l)&&(i.toRealTime(o.time)>i.toRealTime(s.time)-n&&i.toRealTime(o.time)<i.toRealTime(s.time+s.duration)+n&&r.push(o),l=o)))}),r.map(o=>o.time).filter(function(o,a,h){return!a||o!==h[a-1]})}function Im(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=Am(e),{recovery:i}=ee.input.params;t.length?ee.output.html=mt(`2-wide center obstacle (<${I(i*1e3)}ms)`,t,e.settings.bpm,"error"):ee.output.html=null}const Sa="Zero Obstacle",Ca="Look for obstacle with zero value.",Ta=!0,wo={name:Sa,description:Ca,type:"obstacle",order:{input:pt.OBSTACLES_ZERO,output:gt.OBSTACLES_ZERO},input:{enabled:Ta,params:{},html:_t.create(Sa,Ca,Ta,function(){wo.input.enabled=this.checked})},output:{html:null},run:$m};function Om(e){const{obstacles:t}=e.difficulty.data;return t.filter(i=>i.hasZero()).map(i=>i.time)}function $m(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=Om(e);t.length?wo.output.html=mt("Zero value obstacle",t,e.settings.bpm,"error"):wo.output.html=null}const La=Object.freeze(Object.defineProperty({__proto__:null,centerObstacle:ee,shortObstacle:Sn,zeroObstacle:wo},Symbol.toStringTag,{value:"Module"})),xa="Insufficient Lighting Event",ka="Check if there is enough light event.",Ra=!0,En={name:xa,description:ka,type:"event",order:{input:pt.EVENTS_INSUFFICIENT_LIGHT,output:gt.EVENTS_INSUFFICIENT_LIGHT},input:{enabled:Ra,params:{},html:_t.create(xa,ka,Ra,function(){En.input.enabled=this.checked})},output:{html:null},run:Mm};function Pm(e,t){let i=0;for(let n=e.length-1;n>=0;n--)if(e[n].isLightEvent(t)&&!e[n].isOff()&&(i++,i>10))return!0;return!1}function Mm(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=e.difficulty.characteristic==="360Degree"||e.difficulty.characteristic==="90Degree"?e.info.allDirectionsEnvironmentName:e.info.environmentName;Pm(e.difficulty.data.basicEvents,t)?En.output.html=null:t==="DefaultEnvironment"||t==="OriginsEnvironment"||t==="TriangleEnvironment"||t==="NiceEnvironment"||t==="BigMirrorEnvironment"||t==="DragonsEnvironment"||t==="KDAEnvironment"||t==="MonstercatEnvironment"||t==="CrabRaveEnvironment"||t==="PanicEnvironment"||t==="RocketEnvironment"||t==="GreenDayEnvironment"||t==="GreenDayGrenadeEnvironment"||t==="TimbalandEnvironment"||t==="FitBeatEnvironment"||t==="LinkinParkEnvironment"||t==="BTSEnvironment"||t==="KaleidoscopeEnvironment"||t==="InterscopeEnvironment"||t==="SkrillexEnvironment"||t==="BillieEnvironment"||t==="HalloweenEnvironment"||t==="GagaEnvironment"||t==="GlassDesertEnvironment"?En.output.html=dt("Insufficient light event","","rank"):En.output.html=dt("Unknown light event","v3 environment light should be manually checked","rank")}const Jc={Standard:"Standard",NoArrows:"No Arrows",OneSaber:"One Saber",Legacy:"Legacy","360Degree":"360 Degree","90Degree":"90 Degree",Lightshow:"Lightshow",Lawless:"Lawless"},Ba={Standard:0,NoArrows:1,OneSaber:2,Legacy:3,"360Degree":4,"90Degree":5,Lightshow:6,Lawless:7};function Ot(e,t){return e.time-t.time}function Fn(e,t){return Array.isArray(e.customData.coordinates)&&Array.isArray(t.customData.coordinates)?e.time-t.time||e.customData.coordinates[0]-t.customData.coordinates[0]||e.customData.coordinates[1]-t.customData.coordinates[1]:Array.isArray(e.customData._position)&&Array.isArray(t.customData._position)?e.time-t.time||e.customData._position[0]-t.customData._position[0]||e.customData._position[1]-t.customData._position[1]:e.time-t.time||e.posX-t.posX||e.posY-t.posY}const Io=class Zn{constructor(t,i=10,n=0){this._bpm=typeof t=="number"?new yi(t):t,this._njs=i,this._sdm=n}static create(t,i,n){return new Zn(t,i,n)}get value(){return this._njs}set value(t){this._njs=t}get offset(){return this._sdm}set offset(t){this._sdm=t}get hjd(){return this.calcHjd()}get jd(){return this.calcJd()}get reactionTime(){return this.calcRtFromHjd()}get bpm(){return this._bpm}calcHjd(t=this.offset){const n=60/this._bpm.value;let r=Zn.HJD_START;for(;this._njs*n*r>17.999;)r/=2;return r<1&&(r=1),Math.max(r+t,Zn.HJD_MIN)}calcHjdFromJd(t=this.calcJd()){return t/(60/this._bpm.value*this._njs*2)}calcHjdFromRt(t=this.calcRtFromHjd()){return t/(60/this._bpm.value)}calcJd(t=this.calcHjd()){return this._njs*(60/this._bpm.value)*t*2}calcJdOptimal(){return[-(18/(this._njs+1))+18,18*(1/1.07)**this._njs+18]}calcRtFromJd(t=this.calcJd()){return t/(2*this._njs)}calcRtFromHjd(t=this.calcHjd()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};Io.HJD_START=4;Io.HJD_MIN=.25;Io.FallbackNJS={ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10};let bi=Io;function qc(e,t){const i=Na(e),n=Na(t);for(const r in i){if(i[r]<n[r])return"old";if(i[r]>n[r])return"new"}return"current"}function Na(e){return e.replace("v","").split(".").map(t=>parseInt(t))}class Kc extends tc{get tailTime(){return this._tailTime}set tailTime(t){this._tailTime=t}get tailPosX(){return this._tailPosX}set tailPosX(t){this._tailPosX=t}get tailPosY(){return this._tailPosY}set tailPosY(t){this._tailPosY=t}setTailTime(t){return this.tailTime=t,this}setTailPosX(t){return this.tailPosX=t,this}setTailPosY(t){return this.tailPosY=t,this}mirror(t=!0,i){return this.tailPosX=Bo-1-this.tailPosX,super.mirror(t)}getTailPosition(t){return[this.tailPosX-2,this.tailPosY]}isInverse(){return this.time>this.tailTime}}class Zc extends Kc{get lengthMultiplier(){return this._lengthMultiplier}set lengthMultiplier(t){this._lengthMultiplier=t}get tailLengthMultiplier(){return this._tailLengthMultiplier}set tailLengthMultiplier(t){this._tailLengthMultiplier=t}get tailDirection(){return this._tailDirection}set tailDirection(t){this._tailDirection=t}get midAnchor(){return this._midAnchor}set midAnchor(t){this._midAnchor=t}setLengthMultiplier(t){return this.lengthMultiplier=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setTailDirection(t){return this.tailDirection=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0,i){switch(this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),super.mirror(t)}getTailAngle(t){return ae[this.tailDirection]||0}isMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360||this.tailDirection>=1e3&&this.tailDirection<=1360}isValid(){return!(this.isMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3||this.posX===this.tailPosX&&this.posY===this.tailPosY&&this.time===this.tailTime)}}class Fm extends No{isMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0}isValid(){return!this.isMappingExtensions()}}class Wm extends he{get bpm(){return this._bpm}set bpm(t){this._bpm=t}setBPM(t){return this.bpm=t,this}isValid(){return this.bpm>0}}class Hm extends Kc{get sliceCount(){return this._sliceCount}set sliceCount(t){this._sliceCount=t}get squish(){return this._squish}set squish(t){this._squish=t}setSliceCount(t){return this.sliceCount=t,this}setSquish(t){return this.squish=t,this}isMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360}isValid(){return!(this.isMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)&&!(this.posX===this.tailPosX&&this.posY===this.tailPosY)}}class Gm extends he{get toggle(){return this._toggle}set toggle(t){this._toggle=t}setToggle(t){return this.toggle=t,this}isValid(){return!0}}class Fr extends Ue{constructor(){super(...arguments),this._filename="UnnamedDifficulty.dat"}clone(){return super.clone().setFileName(this.filename)}set filename(t){this._filename=t.trim()}get filename(){return this._filename}setFileName(t){return this.filename=t,this}sort(){return this.bpmEvents.sort(Ot),this.rotationEvents.sort(Ot),this.colorNotes.sort(Fn),this.bombNotes.sort(Fn),this.obstacles.sort(Ot),this.arcs.sort(Fn),this.chains.sort(Fn),this.waypoints.sort(Ot),this.basicEvents.sort(Ot),this.colorBoostEvents.sort(Ot),this.lightColorEventBoxGroups.sort(Ot),this.lightRotationEventBoxGroups.sort(Ot),this.lightTranslationEventBoxGroups.sort(Ot),this.fxEventBoxGroups.sort(Ot),this.fxEventsCollection.intList.sort(Ot),this.fxEventsCollection.floatList.sort(Ot),this.lightColorEventBoxGroups.forEach(t=>t.boxes.forEach(i=>i.events.sort(Ot))),this.lightRotationEventBoxGroups.forEach(t=>t.boxes.forEach(i=>i.events.sort(Ot))),this.lightTranslationEventBoxGroups.forEach(t=>t.boxes.forEach(i=>i.events.sort(Ot))),this}createOrKeep(t,i,n){return n&&i instanceof t?i:new t(i)}checkClass(t,i){return i instanceof t}nps(t){const i=this.getNoteContainer().filter(n=>n.type!=="bomb");return t?i.length/t:0}peak(t,i){let n=0,r=0;i=typeof i=="number"?new yi(i):i;const s=this.getNoteContainer().filter(l=>l.type!=="bomb");for(let l=0;l<s.length;l++){for(;s[l].data.time-s[r].data.time>t;)r++;n=Math.max(n,(l-r+1)/i.toRealTime(t))}return n}getFirstInteractiveTime(){const t=this.getNoteContainer().filter(r=>r.type!=="arc");let i=Number.MAX_VALUE;t.length>0&&(i=t[0].data.time);const n=this.findFirstInteractiveObstacleTime();return Math.min(i,n)}getLastInteractiveTime(){const t=this.getNoteContainer().filter(r=>r.type!=="arc");let i=0;t.length>0&&(i=t[t.length-1].data.time);const n=this.findLastInteractiveObstacleTime();return Math.max(i,n)}findFirstInteractiveObstacleTime(){for(let t=0,i=this.obstacles.length;t<i;t++)if(this.obstacles[t].isInteractive())return this.obstacles[t].time;return Number.MAX_VALUE}findLastInteractiveObstacleTime(){let t=0;for(let i=this.obstacles.length-1;i>=0;i--)this.obstacles[i].isInteractive()&&(t=Math.max(t,this.obstacles[i].time+this.obstacles[i].duration));return t}getNoteContainer(){const t=[];return this.colorNotes.forEach(i=>t.push({type:"note",data:i})),this.arcs.forEach(i=>t.push({type:"arc",data:i})),this.chains.forEach(i=>t.push({type:"chain",data:i})),this.bombNotes.forEach(i=>t.push({type:"bomb",data:i})),t.sort((i,n)=>i.data.time-n.data.time)}getEventContainer(){const t=[];return this.basicEvents.forEach(i=>t.push({type:"basicEvent",data:i})),this.colorBoostEvents.forEach(i=>t.push({type:"boost",data:i})),t.sort((i,n)=>i.data.time-n.data.time)}}class Wr extends he{get type(){return this._type}set type(t){this._type=t}get value(){return this._value}set value(t){this._value=t}get floatValue(){return this._floatValue}set floatValue(t){this._floatValue=t}setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}isOff(){return this.value===0}isOn(){return this.value===1||this.value===5||this.value===9}isFlash(){return this.value===2||this.value===6||this.value===10}isFade(){return this.value===3||this.value===7||this.value===11}isTransition(){return this.value===4||this.value===8||this.value===12}isBlue(){return this.value===1||this.value===2||this.value===3||this.value===4}isRed(){return this.value===5||this.value===6||this.value===7||this.value===8}isWhite(){return this.value===9||this.value===10||this.value===11||this.value===12}isLightEvent(t){switch(t){case"LizzoEnvironment":return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===8||this.type===9||this.type===10||this.type===11||this.type===12;default:return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}}isColorBoost(){return this.type===5}isRingEvent(t){switch(t){case"LizzoEnvironment":return!1;default:return this.type===8||this.type===9}}isLaserRotationEvent(t){switch(t){case"LizzoEnvironment":return!1;default:return this.type===12||this.type===13}}isLaneRotationEvent(t){return this.type===14||this.type===15}isExtraEvent(t){return this.type===16||this.type===17||this.type===18||this.type===19}isSpecialEvent(t){return this.type===40||this.type===41||this.type===42||this.type===43}isBpmEvent(){return this.type===100}isLightingEvent(t){return this.isLightEvent(t)||this.isRingEvent(t)||this.isLaserRotationEvent(t)||this.isExtraEvent(t)}isOldChroma(){return this.value>=2e9}isValidType(){return this.type>=0&&this.type<=19||this.type>=40&&this.type<=43||this.type===100}isValid(){return this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.isOldChroma())}}class Oo extends Ue{get filter(){return this._filter}set filter(t){this._filter=t}get beatDistribution(){return this._beatDistribution}set beatDistribution(t){this._beatDistribution=t}get beatDistributionType(){return this._beatDistributionType}set beatDistributionType(t){this._beatDistributionType=t}get easing(){return this._easing}set easing(t){this._easing=t}get affectFirst(){return this._affectFirst}set affectFirst(t){this._affectFirst=t}get events(){return this._events}set events(t){this._events=t}setFilter(t){return this.filter=t,this}setBeatDistribution(t){return this.beatDistribution=t,this}setBeatDistributionType(t){return this.beatDistributionType=t,this}setEasing(t){return this.easing=t,this}setAffectFirst(t){return this.affectFirst=t,this}isValid(){return(this.beatDistributionType===1||this.beatDistributionType===2)&&this.easing>=0&&this.easing<=3&&this.events.every(t=>typeof t=="number"||t.isValid())&&this.filter.isValid()}}class $o extends he{get id(){return this._id}set id(t){this._id=t}get boxes(){return this._boxes}set boxes(t){this._boxes=t}isValid(){return this.id>=0&&this.boxes.every(t=>t.isValid())}}class Qc extends pr{get keyword(){return this._keyword}set keyword(t){this._keyword=t}get events(){return this._events}set events(t){this._events=t}setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const i=this.events.indexOf(t,0);return i>-1&&this.events.splice(i,1),this}}class tu extends pr{get list(){return this._list}set list(t){this._list=t}setList(t){return this.list=t,this}removeData(t){return this.list=this.list.filter(i=>i.keyword!==t),this}}class jm extends Oo{get fxDistribution(){return this._fxDistribution}set fxDistribution(t){this._fxDistribution=t}get fxDistributionType(){return this._fxDistributionType}set fxDistributionType(t){this._fxDistributionType=t}get events(){return this._events}set events(t){this._events=t}setFxDistribution(t){return this.fxDistribution=t,this}setFxDistributionType(t){return this.fxDistributionType=t,this}isValid(){return super.isValid()&&(this.fxDistributionType===1||this.fxDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}}class Xm extends $o{get boxes(){return this._boxes}set boxes(t){this._boxes=t}get type(){return this._type}set type(t){this._type=t}}class zm extends he{get easing(){return this._easing}set easing(t){this._easing=t}get previous(){return this._previous}set previous(t){this._previous=t}get value(){return this._value}set value(t){this._value=t}setEasing(t){return this.easing=t,this}setPrevious(t){return this.previous=t,this}setValue(t){return this.value=t,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3}}class Ym extends he{get previous(){return this._previous}set previous(t){this._previous=t}get value(){return this._value}set value(t){this._value=t}setPrevious(t){return this.previous=t,this}setValue(t){return this.value=t,this}isValid(){return this.previous===0||this.previous===1}}class Um extends Ue{get floatList(){return this._floatList}set floatList(t){this._floatList=t}get intList(){return this._intList}set intList(t){this._intList=t}}class Vm extends Ue{get type(){return this._type}set type(t){this._type=t}get p0(){return this._p0}set p0(t){this._p0=t}get p1(){return this._p1}set p1(t){this._p1=t}get reverse(){return this._reverse}set reverse(t){this._reverse=t}get chunks(){return this._chunks}set chunks(t){this._chunks=t}get limit(){return this._limit}set limit(t){this._limit=t}get limitAffectsType(){return this._limitAffectsType}set limitAffectsType(t){this._limitAffectsType=t}get random(){return this._random}set random(t){this._random=t}get seed(){return this._seed}set seed(t){this._seed=t}setType(t){return this.type=t,this}setP0(t){return this.p0=t,this}setP1(t){return this.p1=t,this}setReverse(t){return this.reverse=t,this}setChunks(t){return this.chunks=t,this}setRandom(t){return this.random=t,this}setSeed(t){return this.seed=t,this}setLimit(t){return this.limit=t,this}setLimitAffectsType(t){return this.limitAffectsType=t,this}isValid(){return(this.type===1||this.type===2)&&this.p0>=0&&this.p1>=0&&(this.reverse===0||this.reverse===1)&&this.chunks>=0&&this.random>=0&&this.random<=Ql.ALL&&this.limit>=0&&this.limit<=0&&this.limitAffectsType>=0&&this.limitAffectsType<=Zl.ALL}}class eu extends Ue{constructor(){super(...arguments),this._filename="Info.dat"}clone(){return super.clone().setFileName(this.filename)}set filename(t){this._filename=t.trim()}get filename(){return this._filename}setFileName(t){return this.filename=t,this}sort(){var t;return(t=this.difficultySets)==null||t.sort((i,n)=>(Ba[i.characteristic]||0)-(Ba[n.characteristic]||0)),this.difficultySets.forEach(i=>i.difficulties.sort((n,r)=>n.rank-r.rank)),this}listMap(){return this.difficultySets.reduce((t,i)=>t.concat(i.difficulties.map(n=>[i.characteristic,n])),[])}}class iu extends Ue{}class nu extends Ue{}class Jm extends he{get transition(){return this._transition}set transition(t){this._transition=t}get color(){return this._color}set color(t){this._color=t}get brightness(){return this._brightness}set brightness(t){this._brightness=t}get frequency(){return this._frequency}set frequency(t){this._frequency=t}setTransition(t){return this.transition=t,this}setColor(t){return this.color=t,this}setBrightness(t){return this.brightness=t,this}setFrequency(t){return this.frequency=t,this}isValid(){return this.transition>=0&&this.transition<=2&&this.color>=-1&&this.color<=2&&this.brightness>=0&&this.frequency>=0}}class qm extends Oo{get brightnessDistribution(){return this._brightnessDistribution}set brightnessDistribution(t){this._brightnessDistribution=t}get brightnessDistributionType(){return this._brightnessDistributionType}set brightnessDistributionType(t){this._brightnessDistributionType=t}get events(){return this._events}set events(t){this._events=t}setBrightnessDistribution(t){return this.brightnessDistribution=t,this}setBrightnessDistributionType(t){return this.brightnessDistributionType=t,this}isValid(){return super.isValid()&&(this.brightnessDistributionType===1||this.brightnessDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}}class Km extends $o{get boxes(){return this._boxes}set boxes(t){this._boxes=t}}class Zm extends he{get previous(){return this._previous}set previous(t){this._previous=t}get easing(){return this._easing}set easing(t){this._easing=t}get loop(){return this._loop}set loop(t){this._loop=t}get rotation(){return this._rotation}set rotation(t){this._rotation=t}get direction(){return this._direction}set direction(t){this._direction=t}setPrevious(t){return this.previous=t,this}setEasing(t){return this.easing=t,this}setLoop(t){return this.loop=t,this}setRotation(t){return this.rotation=t,this}setDirection(t){return this.direction=t,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3&&(this.loop===0||this.loop===1)&&this.direction>=0&&this.direction<=2}}class Qm extends Oo{get rotationDistribution(){return this._rotationDistribution}set rotationDistribution(t){this._rotationDistribution=t}get rotationDistributionType(){return this._rotationDistributionType}set rotationDistributionType(t){this._rotationDistributionType=t}get axis(){return this._axis}set axis(t){this._axis=t}get flip(){return this._flip}set flip(t){this._flip=t}get events(){return this._events}set events(t){this._events=t}setRotationDistribution(t){return this.rotationDistribution=t,this}setRotationDistributionType(t){return this.rotationDistributionType=t,this}setAxis(t){return this.axis=t,this}setFlip(t){return this.flip=t,this}isValid(){return super.isValid()&&(this.rotationDistributionType===1||this.rotationDistributionType===2)&&(this.axis===0||this.axis===1)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}class td extends $o{get boxes(){return this._boxes}set boxes(t){this._boxes=t}}class ed extends he{get previous(){return this._previous}set previous(t){this._previous=t}get easing(){return this._easing}set easing(t){this._easing=t}get translation(){return this._translation}set translation(t){this._translation=t}setPrevious(t){return this.previous=t,this}setEasing(t){return this.easing=t,this}setTranslation(t){return this.translation=t,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3}}class id extends Oo{get gapDistribution(){return this._translationDistribution}set gapDistribution(t){this._translationDistribution=t}get gapDistributionType(){return this._translationDistributionType}set gapDistributionType(t){this._translationDistributionType=t}get axis(){return this._axis}set axis(t){this._axis=t}get flip(){return this._flip}set flip(t){this._flip=t}get events(){return this._events}set events(t){this._events=t}setGapDistribution(t){return this.gapDistribution=t,this}setGapDistributionType(t){return this.gapDistributionType=t,this}setAxis(t){return this.axis=t,this}setFlip(t){return this.flip=t,this}isValid(){return super.isValid()&&(this.gapDistributionType===1||this.gapDistributionType===2)&&(this.axis===0||this.axis===1)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}class nd extends $o{get boxes(){return this._boxes}set boxes(t){this._boxes=t}}class od extends he{get executionTime(){return this._executionTime}set executionTime(t){this._executionTime=t}get rotation(){return this._rotation}set rotation(t){this._rotation=t}setExecutionTime(t){return this.executionTime=t,this}setRotation(t){return this.rotation=t,this}isValid(){return this.executionTime===0||this.executionTime===1}}class ou extends No{get direction(){return this._direction}set direction(t){this._direction=t}setDirection(t){return this.direction=t,this}mirror(t,i){switch(this.posX=Bo-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}isValid(){return this.direction>=0&&this.direction<=9&&this.direction!==8}}function Aa(e){return["beatmap","v1","note",e]}const ru=class Ri extends Ao{constructor(t={}){super(),this._time=t._time??t.time??Ri.default._time,this._posX=t._lineIndex??t.posX??Ri.default._lineIndex,this._posY=t._lineLayer??t.posY??Ri.default._lineLayer,this._type=t.color??t.type??t._type??Ri.default._type,this._direction=t._cutDirection??t.direction??Ri.default._cutDirection}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_cutDirection:this.direction}}get color(){return this._type}set color(t){this._type=t}get angleOffset(){return 0}set angleOffset(t){J.tWarn(Aa("customData"),"Note angle offset does not exist in beatmap V1")}get customData(){return{}}set customData(t){J.tWarn(Aa("customData"),"Note custom data does not exist in beatmap V1")}getPosition(t){switch(t){case"vanilla":case"ne":return super.getPosition();case"me":default:return[(this.posX<=-1e3?this.posX/1e3+1:this.posX>=1e3?this.posX/1e3-1:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"vanilla":case"ne":return super.getAngle(t);case"me":default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):super.getAngle()}}};ru.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0};let rn=ru;function rd(e){return["beatmap","v1","obstacle",e]}const su=class Bi extends $r{constructor(t={}){super(),this._time=t._time??t.time??Bi.default._time,this._type=t._type??(t.posY===2&&t.height===3?1:t.posY===0&&t.height===5?0:Bi.default._type),this._posX=t._lineIndex??t.posX??Bi.default._lineIndex,this._duration=t._duration??t.duration??Bi.default._duration,this._width=t._width??t.width??Bi.default._width}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_duration:this.duration,_width:this.width}}get type(){return this._type}set type(t){this._type=t}get posY(){return this.type==1?2:0}set posY(t){switch(t){case 2:this.type=1;break;default:this.type=0}}get height(){return this.type==1?3:5}set height(t){switch(t){case 3:this.type=1;break;default:this.type=0}}get customData(){return{}}set customData(t){J.tWarn(rd("customData"),"Obstacle custom data does not exist in beatmap V1")}getPosition(t){switch(t){case"vanilla":case"ne":return super.getPosition();case"me":default:return[(this.posX<=-1e3?this.posX/1e3+1:this.posX>=1e3?this.posX/1e3-1:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}}isMappingExtensions(){return this.type>1||this.posX<0||this.posX>3||this.width<0||this.width>3}};su.default={_time:0,_lineIndex:0,_type:0,_duration:0,_width:0};let Wn=su;function Ia(e){return["beatmap","v1","event",e]}const au=class Qn extends Wr{constructor(t={}){super(),this._time=t._time??t.time??Qn.default._time,this._type=t._type??t.type??Qn.default._type,this._value=t._value??t.value??Qn.default._value}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_value:this.value}}get floatValue(){return 1}set floatValue(t){J.tWarn(Ia("floatValue"),"Event float value does not exist in beatmap V1")}get customData(){return{}}set customData(t){J.tWarn(Ia("customData"),"Event custom data does not exist in beatmap V1")}isMappingExtensions(){return this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720}};au.default={_time:0,_type:0,_value:0};let Li=au;function de(e){return["beatmap","v1","difficulty",e]}let lu=class extends Fr{constructor(t={}){super(),this.bpmEvents=[],this.rotationEvents=[],this.bombNotes=[],this.arcs=[],this.chains=[],this.waypoints=[],this.colorBoostEvents=[],this.lightColorEventBoxGroups=[],this.lightRotationEventBoxGroups=[],this.lightTranslationEventBoxGroups=[],this.fxEventBoxGroups=[],this.useNormalEventsAsCompatibleEvents=!0,this.version="1.5.0",this.beatsPerMinute=t._beatsPerMinute??120,this.beatsPerBar=t._beatsPerBar??4,this.shuffle=t._shuffle??0,this.shufflePeriod=t._shufflePeriod??0,this.noteJumpSpeed=t._noteJumpSpeed??0,this.noteJumpStartBeatOffset=t._noteJumpStartBeatOffset??0,this.colorNotes=(t._notes??[]).map(i=>new rn(i)),this.obstacles=(t._obstacles??[]).map(i=>new Wn(i)),this.basicEvents=(t._events??[]).map(i=>new Li(i)),this.time=t._time??0,this.BPMChanges=t._BPMChanges??[],this.bookmarks=t._bookmarks??[]}static create(t={}){return new this(t)}toJSON(){return{_version:"1.5.0",_beatsPerMinute:this.beatsPerMinute,_beatsPerBar:this.beatsPerBar,_shuffle:this.shuffle,_shufflePeriod:this.shufflePeriod,_noteJumpSpeed:this.noteJumpSpeed,_noteJumpStartBeatOffset:this.noteJumpStartBeatOffset,_notes:this.colorNotes.map(t=>t.toJSON()),_obstacles:this.obstacles.map(t=>t.toJSON()),_events:this.basicEvents.map(t=>t.toJSON()),_time:this.time,_BPMChanges:this.BPMChanges,_bookmarks:this.bookmarks}}get customData(){return{}}set customData(t){J.tWarn(de("customData"),"Custom data does not exist in beatmap V1")}reparse(t){return this.colorNotes=this.colorNotes.map(i=>this.createOrKeep(rn,i,t)),this.obstacles=this.obstacles.map(i=>this.createOrKeep(Wn,i,t)),this.basicEvents=this.basicEvents.map(i=>this.createOrKeep(Li,i,t)),this}addBpmEvents(...t){J.tWarn(de("addBpmEvents"),"BPM Event does not exist in beatmap V1")}addRotationEvents(...t){for(const i of t)this.basicEvents.push(new Li({...i,type:typeof i.executionTime=="number"?i.executionTime===0?14:15:i._type}));J.tWarn(de("addRotationEvents"),"This may not work correctly")}addColorNotes(...t){for(const i of t)this.colorNotes.push(new rn(i))}addBombNotes(...t){for(const i of t)this.colorNotes.push(new rn({...i,type:3}))}addObstacles(...t){for(const i of t)this.obstacles.push(new Wn(i))}addArcs(...t){J.tWarn(de("addArcs"),"Arc does not exist in beatmap V1")}addChains(...t){J.tWarn(de("addChains"),"Chain does not exist in beatmap V1")}addWaypoints(...t){J.tWarn(de("addWaypoints"),"Waypoint does not exist in beatmap V1")}addBasicEvents(...t){for(const i of t)this.basicEvents.push(new Li(i))}addColorBoostEvents(...t){for(const i of t)this.basicEvents.push(new Li({...i,value:i.toggle?1:i._value}))}addLightColorEventBoxGroups(...t){J.tWarn(de("addLightColorEventBoxGroups"),"Light Color Event Box Group does not exist in beatmap V1")}addLightRotationEventBoxGroups(...t){J.tWarn(de("addLightRotationEventBoxGroups"),"Light Rotation Event Box Group does not exist in beatmap V1")}addLightTranslationEventBoxGroups(...t){J.tWarn(de("addLightTranslationEventBoxGroups"),"Light Translation Event Box Group does not exist in beatmap V1")}addFxEventBoxGroups(...t){J.tWarn(de("addFxEventBoxGroups"),"FX Event Box Group does not exist in beatmap V1")}isValid(){return this.colorNotes.every(t=>this.checkClass(rn,t))||this.obstacles.every(t=>this.checkClass(Wn,t))||this.basicEvents.every(t=>this.checkClass(Li,t))}};function Hr(e){return["beatmap","v1","info",e]}let rr=class extends eu{constructor(t={}){var i,n;super(),this.version="1.0.0",this.environmentNames=[],this.colorSchemes=[],this.songName=t.songName??"SongName",this.songSubName=t.songSubName??"",this.songAuthorName=t.authorName??"SongAuthor",this.beatsPerMinute=t.beatsPerMinute??120,this.previewStartTime=t.previewStartTime??12,this.previewDuration=t.previewDuration??10,this.coverImageFilename=t.coverImagePath??"cover.jpg",this.environmentName=t.environmentName??"DefaultEnvironment",this.difficultySets=[],(i=t.difficultyLevels)==null||i.forEach(r=>{this.addMap(r)}),this.songFilename||(this.songFilename="song.ogg"),this.oneSaber=!!((n=this.difficultySets.find(r=>r.characteristic==="OneSaber"))!=null&&n.difficulties.length),this.contributors=K(t.contributors??[]),this.customEnvironment=t.customEnvironment,this.customEnvironmentHash=t.customEnvironmentHash}static create(t={}){return new this(t)}toJSON(){var t;return{songName:this.songName,songSubName:this.songSubName,authorName:this.songAuthorName,beatsPerMinute:this.beatsPerMinute,previewStartTime:this.previewStartTime,previewDuration:this.previewDuration,coverImagePath:this.coverImageFilename,environmentName:this.environmentName,difficultyLevels:this.listMap().reduce((i,[n,r])=>(i.push(r.toJSON()),i),[]),oneSaber:!!((t=this.difficultySets.find(i=>i.characteristic==="OneSaber"))!=null&&t.difficulties.length),contributors:this.contributors,customEnvironment:this.customEnvironment,customEnvironmentHash:this.customEnvironmentHash}}get customData(){return{}}set customData(t){J.tWarn(Hr("customData"),"Custom data does not exist in beatmap V1")}addMap(t,i){const n=i||t.characteristic||"Standard";t.audioPath||(t.audioPath=this.songFilename);let r=this.difficultySets.find(s=>s.characteristic===n);return r?r.difficulties.push(new cu(t)):(r=new sd({mode:n,difficulties:[t]}),this.difficultySets.push(r)),this}listMap(){return super.listMap()}isValid(){throw new Error("Method not implemented.")}},sd=class extends iu{constructor(t){var i;super(),this.difficulties=[],this.characteristic=t.mode||"Standard",this.difficulties=((i=t.difficulties)==null?void 0:i.map(n=>new cu(n,this.characteristic)))??[],this.customData={}}static create(t){return new this(t)}toJSON(){return{mode:this.characteristic,difficulties:this.difficulties.map(t=>t.toJSON())}}get customData(){return{}}set customData(t){J.tWarn(Hr("customData"),"Custom data does not exist in beatmap V1")}isValid(){throw new Error("Method not implemented.")}},cu=class extends nu{constructor(t={},i,n){super(),this.difficulty=t.difficulty??"Easy",this.rank=t.difficultyRank??1,this.filename=t.jsonPath??"UnnamedFile.dat",this.njs=0,this.njsOffset=0,this.audioPath=i??"song.ogg",this.characteristic=n||"Standard",this.offset=t.offset,this.oldOffset=t.oldOffset,this.chromaToggle=t.chromaToggle,this.customColors=t.customColors,this.difficultyLabel=t.difficultyLabel,this.colorLeft=t.colorLeft,this.colorRight=t.colorRight,this.envColorLeft=t.envColorLeft,this.envColorRight=t.envColorRight,this.obstacleColor=t.obstacleColor}static create(t={},i,n){return new this(t,i,n)}toJSON(){return{difficulty:this.difficulty,difficultyRank:this.rank,audioPath:this.audioPath,jsonPath:this.filename,characteristic:this.characteristic,offset:this.offset,oldOffset:this.oldOffset,chromaToggle:this.chromaToggle,customColors:this.customColors,difficultyLabel:this.difficultyLabel,colorLeft:this.colorLeft,colorRight:this.colorRight,envColorLeft:this.envColorLeft,envColorRight:this.envColorRight,obstacleColor:this.obstacleColor}}get customData(){return{}}set customData(t){J.tWarn(Hr("customData"),"Custom data does not exist in beatmap V1")}copyColorScheme(t,i){if(typeof t=="number"){if(i.colorSchemes.length<t)return this;const n=i.colorSchemes[t].colorScheme;return this.copyColorScheme(n)}return this.colorLeft=Object.entries(t.saberLeftColor).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.colorRight=Object.entries(t.saberRightColor).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.envColorLeft=Object.entries(t.environment0Color).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.envColorRight=Object.entries(t.environment1Color).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.obstacleColor=Object.entries(t.obstaclesColor).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this}isValid(){throw new Error("Method not implemented.")}};function uu(e){return["shared","dataCheck",e]}function pe(e,t,i){if(t)throw Error(e);J.tWarn(uu("deepCheck"),e),i.push(e)}function Xe(e,t,i,n,r=!0,s=[]){if(J.tVerbose(uu("deepCheck"),`Looking up ${i}`),Array.isArray(e))return e.forEach((o,a)=>Xe(o,t,`${i}[${a}]`,n,r,s)),s;const l=Object.keys(t);if(l.length){for(const o in e)if(!l.includes(o)){pe(`Unused key ${o} found in ${i}`,!1,s);continue}}for(const o in t){const a=t[o],h=e[o];if(h===void 0){if(t[o].optional||qc(n,a.version)==="old")continue;pe(`Missing ${o} in object ${i}!`,r,s);continue}if(h===null){pe(`${o} contain null value in object ${i}!`,r,s);continue}if(a.type==="array"){Array.isArray(h)||pe(`${o} is not an array in object ${i}!`,r,s),Xe(h,a.check,`${i}.${o}`,n,r,s);continue}if(a.type==="object"){!Array.isArray(h)&&typeof h!="object"?pe(`${o} is not an object in object ${i}!`,r,s):Xe(h,a.check,`${i}.${o}`,n,r,s);continue}if(a.array&&Array.isArray(h)&&!h.every(u=>typeof u===a.type||a.type==="number"&&typeof u=="number"&&(isNaN(u)||(a.int?u%1!==0:!0)&&(a.unsigned?u<0:!0)))){pe(`${o} is not ${a.type} in object ${i}!`,r,s);continue}if(!a.array&&typeof h!==a.type){pe(`${o} is not ${a.type} in object ${i}!`,r,s);continue}if(a.type==="number"){if(isNaN(h)){pe(`${i}.${o} is NaN!`,r,s);continue}if(a.int&&h%1!==0){pe(`${i}.${o} cannot be float!`,!1,s);continue}if(a.unsigned&&h<0){pe(`${i}.${o} cannot be negative!`,!1,s);continue}}}return s}const ad={_time:{type:"number",version:"1.5.0"},_type:{type:"number",int:!0,unsigned:!0,version:"1.5.0"},_lineIndex:{type:"number",int:!0,version:"1.5.0"},_lineLayer:{type:"number",int:!0,version:"1.5.0"},_cutDirection:{type:"number",int:!0,unsigned:!0,version:"1.5.0"}},ld={_time:{type:"number",version:"1.5.0"},_lineIndex:{type:"number",int:!0,version:"1.5.0"},_type:{type:"number",int:!0,unsigned:!0,version:"1.5.0"},_duration:{type:"number",version:"1.5.0"},_width:{type:"number",int:!0,version:"1.5.0"}},cd={_time:{type:"number",version:"1.5.0"},_type:{type:"number",int:!0,version:"1.5.0"},_value:{type:"number",int:!0,version:"1.5.0"}},ud={_version:{type:"string",version:"1.5.0"},_beatsPerMinute:{type:"number",version:"1.5.0"},_beatsPerBar:{type:"number",version:"1.5.0"},_shuffle:{type:"number",version:"1.5.0"},_shufflePeriod:{type:"number",version:"1.5.0"},_noteJumpSpeed:{type:"number",version:"1.5.0",optional:!0},_noteJumpStartBeatOffset:{type:"number",version:"1.5.0",optional:!0},_notes:{type:"array",version:"1.5.0",check:ad},_obstacles:{type:"array",version:"1.5.0",check:ld},_events:{type:"array",version:"1.5.0",check:cd},_time:{type:"number",version:"1.5.0",optional:!0},_BPMChanges:{type:"array",version:"1.5.0",optional:!0,check:{}},_bookmarks:{type:"array",version:"1.5.0",optional:!0,check:{}}},hd={difficulty:{type:"string",version:"1.0.0"},difficultyRank:{type:"number",version:"1.0.0"},audioPath:{type:"string",version:"1.0.0"},jsonPath:{type:"string",version:"1.0.0"},characteristic:{type:"string",version:"1.0.0"},offset:{type:"number",version:"1.0.0",optional:!0},oldOffset:{type:"number",version:"1.0.0",optional:!0},chromaToggle:{type:"string",version:"1.0.0",optional:!0},customColors:{type:"boolean",version:"1.0.0",optional:!0},difficultyLabel:{type:"string",version:"1.0.0",optional:!0},colorLeft:{type:"object",version:"1.0.0",check:{},optional:!0},colorRight:{type:"object",version:"1.0.0",check:{},optional:!0},envColorLeft:{type:"object",version:"1.0.0",check:{},optional:!0},envColorRight:{type:"object",version:"1.0.0",check:{},optional:!0},obstacleColor:{type:"object",version:"1.0.0",check:{},optional:!0}},fd={songName:{type:"string",version:"1.0.0"},songSubName:{type:"string",version:"1.0.0"},authorName:{type:"string",version:"1.0.0"},beatsPerMinute:{type:"number",version:"1.0.0"},previewStartTime:{type:"number",version:"1.0.0"},previewDuration:{type:"number",version:"1.0.0"},coverImagePath:{type:"string",version:"1.0.0"},environmentName:{type:"string",version:"1.0.0"},difficultyLevels:{type:"array",version:"1.0.0",check:hd},oneSaber:{type:"boolean",version:"1.0.0",optional:!0},contributors:{type:"array",version:"1.0.0",optional:!0,check:{}},customEnvironment:{type:"string",version:"1.0.0",optional:!0},customEnvironmentHash:{type:"string",version:"1.0.0",optional:!0}};function sr(e){return["v1","parse",e]}function md(e,t={enabled:!0,throwError:!0}){var i;return J.tInfo(sr("difficulty"),"Parsing beatmap difficulty v1.x.x"),(i=e._version)!=null&&i.startsWith("1")||(J.tWarn(sr("difficulty"),"Unidentified beatmap version"),e._version="1.5.0"),t.enabled&&Xe(e,ud,"difficulty",e._version,t.throwError),new lu(e)}function dd(e,t={enabled:!0,throwError:!0}){return J.tInfo(sr("info"),"Parsing beatmap info v1.x.x"),t.enabled&&Xe(e,fd,"info","1.0.0",t.throwError),new rr(e)}const hu=class Ft extends Zc{constructor(t={}){super(),this._color=t._colorType??t.color??Ft.default._colorType,this._time=t._headTime??t.time??t._tailTime??Ft.default._headTime,this._posX=t._headLineIndex??t.posX??Ft.default._headLineIndex,this._posY=t._headLineLayer??t.posY??Ft.default._headLineLayer,this._direction=t._headCutDirection??t.direction??Ft.default._headCutDirection,this._lengthMultiplier=t._headControlPointLengthMultiplier??t.lengthMultiplier??Ft.default._headControlPointLengthMultiplier,this._tailTime=t._tailTime??t.tailTime??t._headTime??Ft.default._tailTime,this._tailPosX=t._tailLineIndex??t.tailPosX??Ft.default._tailLineIndex,this._tailPosY=t._tailLineLayer??t.tailPosY??Ft.default._tailLineLayer,this._tailDirection=t._tailCutDirection??t.tailDirection??Ft.default._tailCutDirection,this._tailLengthMultiplier=t._tailControlPointLengthMultiplier??t.tailLengthMultiplier??Ft.default._tailControlPointLengthMultiplier,this._midAnchor=t._sliderMidAnchorMode??t.midAnchor??Ft.default._sliderMidAnchorMode,this._customData=K(t._customData??t.customData??Ft.default._customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_colorType:this.color,_headTime:this.time,_headLineIndex:this.posX,_headLineLayer:this.posY,_headCutDirection:this.direction,_headControlPointLengthMultiplier:this.lengthMultiplier,_tailTime:this.tailTime,_tailLineIndex:this.tailPosX,_tailLineLayer:this.tailPosY,_tailCutDirection:this.tailDirection,_tailControlPointLengthMultiplier:this.tailLengthMultiplier,_sliderMidAnchorMode:this.midAnchor,_customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};hu.default={_colorType:0,_headTime:0,_headLineIndex:0,_headLineLayer:0,_headCutDirection:0,_headControlPointLengthMultiplier:0,_tailTime:0,_tailLineIndex:0,_tailLineLayer:0,_tailCutDirection:0,_tailControlPointLengthMultiplier:0,_sliderMidAnchorMode:0,_customData:{}};let Hn=hu;function pd(e){return["beatmap","v2","note",e]}const fu=class hi extends Ao{constructor(t={}){super(),this._time=t._time??t.time??hi.default._time,this._posX=t._lineIndex??t.posX??hi.default._lineIndex,this._posY=t._lineLayer??t.posY??hi.default._lineLayer,this._type=t._type??t.type??t.color??hi.default._type,this._direction=t._cutDirection??t.direction??hi.default._cutDirection,this._customData=K(t._customData??t.customData??hi.default._customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_cutDirection:this.direction,_customData:K(this.customData)}}get color(){return this._type}set color(t){this._type=t}get angleOffset(){return 0}set angleOffset(t){J.tWarn(pd("customData"),"Note angle offset does not exist in beatmap V2")}get customData(){return this._customData}set customData(t){this._customData=t}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData._position)return[this.customData._position[0],this.customData._position[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3+1:this.posX>=1e3?this.posX/1e3-1:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"vanilla":return super.getAngle(t);case"ne":if(this.customData._cutDirection)return this.customData._cutDirection>0?this.customData._cutDirection%360:360+this.customData._cutDirection%360;case"me":default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):super.getAngle()}}isChroma(){return Array.isArray(this.customData._color)||typeof this.customData._disableSpawnEffect=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._cutDirection=="number"||typeof this.customData._disableNoteGravity=="boolean"||typeof this.customData._disableNoteLook=="boolean"||typeof this.customData._fake=="boolean"||Array.isArray(this.customData._flip)||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)}};fu.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0,_customData:{}};let sn=fu;const mu=class fi extends $r{constructor(t={}){super(),this._time=t._time??t.time??fi.default._time,this._type=t._type??(t.posY===2&&t.height===3?1:t.posY===0&&t.height===5?0:fi.default._type),this._posX=t._lineIndex??t.posX??fi.default._lineIndex,this._duration=t._duration??t.duration??fi.default._duration,this._width=t._width??t.width??fi.default._width,this._customData=K(t._customData??t.customData??fi.default._customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_duration:this.duration,_width:this.width,_customData:K(this.customData)}}get type(){return this._type}set type(t){this._type=t}get posY(){return this.type==1?2:0}set posY(t){switch(t){case 2:this.type=1;break;default:this.type=0}}get height(){return this.type==1?3:5}set height(t){switch(t){case 3:this.type=1;break;default:this.type=0}}get customData(){return this._customData}set customData(t){this._customData=t}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData._position)return[this.customData._position[0],this.customData._position[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3+1:this.posX>=1e3?this.posX/1e3-1:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}}isChroma(){return Array.isArray(this.customData._color)}isNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._fake=="boolean"||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||Array.isArray(this.customData._scale)}isMappingExtensions(){return this.type>1||this.posX<0||this.posX>3||this.width<0||this.width>3}};mu.default={_time:0,_lineIndex:0,_type:0,_duration:0,_width:0,_customData:{}};let Gn=mu;const du=class Ni extends Wr{constructor(t={}){super(),this._time=t._time??t.time??Ni.default._time,this._type=t._type??t.type??Ni.default._type,this._value=t._value??t.value??Ni.default._value,this._floatValue=t._floatValue??t.floatValue??Ni.default._floatValue,this._customData=K(t._customData??t.customData??Ni.default._customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_value:this.value,_floatValue:this.floatValue,_customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}isLightEvent(t){return super.isLightEvent(t)}isRingEvent(t){return super.isRingEvent(t)}isLaserRotationEvent(t){return super.isLaserRotationEvent(t)}isLaneRotationEvent(t){return super.isLaneRotationEvent(t)}isChroma(){const t=this;return t.isLightEvent()?Array.isArray(this.customData._color)||typeof this.customData._lightID=="number"||Array.isArray(this.customData._lightID)||typeof this.customData._propID=="number"||typeof this.customData._lightGradient=="object"||typeof this.customData._easing=="string"||typeof this.customData._lerpType=="string":t.isRingEvent()?typeof this.customData._nameFilter=="string"||typeof this.customData._reset=="boolean"||typeof this.customData._rotation=="number"||typeof this.customData._step=="number"||typeof this.customData._prop=="number"||typeof this.customData._speed=="number"||typeof this.customData._direction=="number"||typeof this.customData._counterSpin=="boolean"||typeof this.customData._stepMult=="number"||typeof this.customData._propMult=="number"||typeof this.customData._speedMult=="number":t.isLaserRotationEvent()?typeof this.customData._lockPosition=="boolean"||typeof this.customData._speed=="number"||typeof this.customData._preciseSpeed=="number"||typeof this.customData._direction=="number":!1}isNoodleExtensions(){return this.isLaneRotationEvent()&&typeof this.customData._rotation=="number"}isMappingExtensions(){return this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720}};du.default={_time:0,_type:0,_value:0,_floatValue:0,_customData:{}};let ci=du;const pu=class Ai extends ou{constructor(t={}){super(),this._time=t._time??t.time??Ai.default._time,this._posX=t._lineIndex??t.posX??Ai.default._lineIndex,this._posY=t._lineLayer??t.posY??Ai.default._lineLayer,this._direction=t._offsetDirection??t.direction??Ai.default._offsetDirection,this._customData=K(t._customData??t.customData??Ai.default._customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_lineIndex:this.posX,_lineLayer:this.posY,_offsetDirection:this.direction,_customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};pu.default={_time:0,_lineIndex:0,_lineLayer:0,_offsetDirection:0,_customData:{}};let jn=pu;const gu=class ar extends Qc{constructor(t={}){super(),this._keyword=t._keyword??t.keyword??ar.default._keyword,this._events=(t._specialEvents??t.events??ar.default._specialEvents).filter(i=>typeof i=="number")}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_keyword:this.keyword,_specialEvents:this.events}}};gu.default={_keyword:"",_specialEvents:[]};let gd=gu;const _u=class bu extends tu{constructor(t={}){super(),this._list=(t._keywords??t.list??bu.default._keywords).map(i=>{if(i)return new gd(i)}).filter(i=>i)}static create(t={}){return new this(t)}toJSON(){return{_keywords:this.list.map(t=>t.toJSON())}}get list(){return this._list}set list(t){this._list=t}addList(t){return this._list.push(t),this}};_u.default={_keywords:[]};let Yo=_u;function xi(e){return["beatmap","v2","difficulty",e]}let vu=class extends Fr{constructor(t={}){super(),this.bpmEvents=[],this.rotationEvents=[],this.bombNotes=[],this.chains=[],this.colorBoostEvents=[],this.lightColorEventBoxGroups=[],this.lightRotationEventBoxGroups=[],this.lightTranslationEventBoxGroups=[],this.fxEventBoxGroups=[],this.useNormalEventsAsCompatibleEvents=!0,this.version="2.6.0",this.colorNotes=(t._notes??[]).map(i=>new sn(i)),this.arcs=(t._sliders??[]).map(i=>new Hn(i)),this.obstacles=(t._obstacles??[]).map(i=>new Gn(i)),this.basicEvents=(t._events??[]).map(i=>new ci(i)),this.waypoints=(t._waypoints??[]).map(i=>new jn(i)),this.eventTypesWithKeywords=new Yo(t._specialEventsKeywordFilters??{_keywords:[]}),this.customData=K(t._customData??{})}static create(t={}){return new this(t)}toJSON(){return{_version:"2.6.0",_notes:this.colorNotes.map(t=>t.toJSON()),_sliders:this.arcs.map(t=>t.toJSON()),_obstacles:this.obstacles.map(t=>t.toJSON()),_events:this.basicEvents.map(t=>t.toJSON()),_waypoints:this.waypoints.map(t=>t.toJSON()),_specialEventsKeywordFilters:this.eventTypesWithKeywords.toJSON(),_customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}reparse(t){return this.colorNotes=this.colorNotes.map(i=>this.createOrKeep(sn,i,t)),this.obstacles=this.obstacles.map(i=>this.createOrKeep(Gn,i,t)),this.basicEvents=this.basicEvents.map(i=>this.createOrKeep(ci,i,t)),this.waypoints=this.waypoints.map(i=>this.createOrKeep(jn,i,t)),this.arcs=this.arcs.map(i=>this.createOrKeep(Hn,i,t)),this.eventTypesWithKeywords=new Yo(this.eventTypesWithKeywords),this}addBpmEvents(...t){for(const i of t)this.basicEvents.push(new ci({...i,type:100,value:i.bpm}))}addRotationEvents(...t){for(const i of t)this.basicEvents.push(new ci({...i,type:typeof i.executionTime=="number"?i.executionTime===0?14:15:i._type}));J.tWarn(xi("addRotationEvents"),"This may not work correctly")}addColorNotes(...t){for(const i of t)this.colorNotes.push(new sn(i))}addBombNotes(...t){for(const i of t)this.colorNotes.push(new sn({...i,type:3}))}addObstacles(...t){for(const i of t)this.obstacles.push(new Gn(i))}addArcs(...t){for(const i of t)this.arcs.push(new Hn(i))}addChains(...t){J.tWarn(xi("addChains"),"Chain does not exist in beatmap V2")}addWaypoints(...t){for(const i of t)this.waypoints.push(new jn(i))}addBasicEvents(...t){for(const i of t)this.basicEvents.push(new ci(i))}addColorBoostEvents(...t){for(const i of t)this.basicEvents.push(new ci({...i,value:i.toggle?1:i._value}))}addLightColorEventBoxGroups(...t){J.tWarn(xi("addLightColorEventBoxGroups"),"Light Color Event Box Group does not exist in beatmap V2")}addLightRotationEventBoxGroups(...t){J.tWarn(xi("addLightRotationEventBoxGroups"),"Light Rotation Event Box Group does not exist in beatmap V2")}addLightTranslationEventBoxGroups(...t){J.tWarn(xi("addLightTranslationEventBoxGroups"),"Light Translation Event Box Group does not exist in beatmap V2")}addFxEventBoxGroups(...t){J.tWarn(xi("addFxEventBoxGroups"),"FX Event Box Group does not exist in beatmap V2")}isValid(){return this.colorNotes.every(t=>this.checkClass(sn,t))||this.obstacles.every(t=>this.checkClass(Gn,t))||this.basicEvents.every(t=>this.checkClass(ci,t))||this.waypoints.every(t=>this.checkClass(jn,t))||this.arcs.every(t=>this.checkClass(Hn,t))||this.eventTypesWithKeywords instanceof Yo}};class lr extends eu{constructor(t={}){var i,n,r;super(),this.version="2.1.0",this.difficultySets=[],this.songName=t._songName??"SongName",this.songSubName=t._songSubName??"",this.songAuthorName=t._songAuthorName??"SongAuthor",this.levelAuthorName=t._levelAuthorName??"",this.beatsPerMinute=t._beatsPerMinute??120,this.songTimeOffset=t._songTimeOffset??0,this.shuffle=t._shuffle??0,this.shufflePeriod=t._shufflePeriod??.5,this.previewStartTime=t._previewStartTime??12,this.previewDuration=t._previewDuration??10,this.songFilename=t._songFilename??"song.ogg",this.coverImageFilename=t._coverImageFilename??"",this.environmentName=t._environmentName??"DefaultEnvironment",this.allDirectionsEnvironmentName=t._allDirectionsEnvironmentName??"GlassDesertEnvironment",this.environmentNames=((i=t._environmentNames)==null?void 0:i.map(s=>s))??[],this.colorSchemes=((n=t._colorSchemes)==null?void 0:n.map(s=>{var o,a,h,u,d,f,c,g,_,v,b,E,w,L,x,k,P,j,O,Y,tt,S,$,p,F,st,X,ct,z,rt,N,B,nt,Z,q,wt,Rt,ht,bt,Lt,St,jt,Mt,m,M,A,D,y,C,H,G,R,U,Q,V,et,Et,ft,It,Be,Xt,Ne,Ct,si,wi,Vt,Qi,Rn,Bn,Nn,tn,Ae,ai,Yr,Ur;const l={useOverride:!!s.useOverride,colorScheme:{name:((o=s.colorScheme)==null?void 0:o.colorSchemeId)||"",saberLeftColor:{r:((h=(a=s.colorScheme)==null?void 0:a.saberAColor)==null?void 0:h.r)||0,g:((d=(u=s.colorScheme)==null?void 0:u.saberAColor)==null?void 0:d.g)||0,b:((c=(f=s.colorScheme)==null?void 0:f.saberAColor)==null?void 0:c.b)||0,a:((_=(g=s.colorScheme)==null?void 0:g.saberAColor)==null?void 0:_.a)||0},saberRightColor:{r:((b=(v=s.colorScheme)==null?void 0:v.saberBColor)==null?void 0:b.r)||0,g:((w=(E=s.colorScheme)==null?void 0:E.saberBColor)==null?void 0:w.g)||0,b:((x=(L=s.colorScheme)==null?void 0:L.saberBColor)==null?void 0:x.b)||0,a:((P=(k=s.colorScheme)==null?void 0:k.saberBColor)==null?void 0:P.a)||0},environment0Color:{r:((O=(j=s.colorScheme)==null?void 0:j.environmentColor0)==null?void 0:O.r)||0,g:((tt=(Y=s.colorScheme)==null?void 0:Y.environmentColor0)==null?void 0:tt.g)||0,b:(($=(S=s.colorScheme)==null?void 0:S.environmentColor0)==null?void 0:$.b)||0,a:((F=(p=s.colorScheme)==null?void 0:p.environmentColor0)==null?void 0:F.a)||0},environment1Color:{r:((X=(st=s.colorScheme)==null?void 0:st.environmentColor1)==null?void 0:X.r)||0,g:((z=(ct=s.colorScheme)==null?void 0:ct.environmentColor1)==null?void 0:z.g)||0,b:((N=(rt=s.colorScheme)==null?void 0:rt.environmentColor1)==null?void 0:N.b)||0,a:((nt=(B=s.colorScheme)==null?void 0:B.environmentColor1)==null?void 0:nt.a)||0},obstaclesColor:{r:((q=(Z=s.colorScheme)==null?void 0:Z.obstaclesColor)==null?void 0:q.r)||0,g:((Rt=(wt=s.colorScheme)==null?void 0:wt.obstaclesColor)==null?void 0:Rt.g)||0,b:((bt=(ht=s.colorScheme)==null?void 0:ht.obstaclesColor)==null?void 0:bt.b)||0,a:((St=(Lt=s.colorScheme)==null?void 0:Lt.obstaclesColor)==null?void 0:St.a)||0},environment0ColorBoost:{r:((Mt=(jt=s.colorScheme)==null?void 0:jt.environmentColor0Boost)==null?void 0:Mt.r)||0,g:((M=(m=s.colorScheme)==null?void 0:m.environmentColor0Boost)==null?void 0:M.g)||0,b:((D=(A=s.colorScheme)==null?void 0:A.environmentColor0Boost)==null?void 0:D.b)||0,a:((C=(y=s.colorScheme)==null?void 0:y.environmentColor0Boost)==null?void 0:C.a)||0},environment1ColorBoost:{r:((G=(H=s.colorScheme)==null?void 0:H.environmentColor1Boost)==null?void 0:G.r)||0,g:((U=(R=s.colorScheme)==null?void 0:R.environmentColor1Boost)==null?void 0:U.g)||0,b:((V=(Q=s.colorScheme)==null?void 0:Q.environmentColor1Boost)==null?void 0:V.b)||0,a:((Et=(et=s.colorScheme)==null?void 0:et.environmentColor1Boost)==null?void 0:Et.a)||0}}};return(ft=s.colorScheme)!=null&&ft.environmentColorW&&(l.colorScheme.environmentWColor={r:((Be=(It=s.colorScheme)==null?void 0:It.environmentColorW)==null?void 0:Be.r)||0,g:((Ne=(Xt=s.colorScheme)==null?void 0:Xt.environmentColorW)==null?void 0:Ne.g)||0,b:((si=(Ct=s.colorScheme)==null?void 0:Ct.environmentColorW)==null?void 0:si.b)||0,a:((Vt=(wi=s.colorScheme)==null?void 0:wi.environmentColorW)==null?void 0:Vt.a)||0}),(Qi=s.colorScheme)!=null&&Qi.environmentColorWBoost&&(l.colorScheme.environmentWColorBoost={r:((Bn=(Rn=s.colorScheme)==null?void 0:Rn.environmentColorWBoost)==null?void 0:Bn.r)||0,g:((tn=(Nn=s.colorScheme)==null?void 0:Nn.environmentColorWBoost)==null?void 0:tn.g)||0,b:((ai=(Ae=s.colorScheme)==null?void 0:Ae.environmentColorWBoost)==null?void 0:ai.b)||0,a:((Ur=(Yr=s.colorScheme)==null?void 0:Yr.environmentColorWBoost)==null?void 0:Ur.a)||0}),l}))??[],this.customData=K(t._customData??{}),(r=t._difficultyBeatmapSets)==null||r.forEach(s=>{this.difficultySets.push(new Oa(s))})}static create(t={}){return new this(t)}toJSON(){return{_version:this.version,_songName:this.songName,_songSubName:this.songSubName,_songAuthorName:this.songAuthorName,_levelAuthorName:this.levelAuthorName,_beatsPerMinute:this.beatsPerMinute,_songTimeOffset:this.songTimeOffset,_shuffle:this.shuffle,_shufflePeriod:this.shufflePeriod,_previewStartTime:this.previewStartTime,_previewDuration:this.previewDuration,_songFilename:this.songFilename,_coverImageFilename:this.coverImageFilename,_environmentName:this.environmentName,_allDirectionsEnvironmentName:this.allDirectionsEnvironmentName,_environmentNames:this.environmentNames.map(t=>t),_colorSchemes:this.colorSchemes.map(t=>{const i={useOverride:t.useOverride,colorScheme:{colorSchemeId:t.colorScheme.name,saberAColor:Ht(t.colorScheme.saberLeftColor),saberBColor:Ht(t.colorScheme.saberRightColor),environmentColor0:Ht(t.colorScheme.environment0Color),environmentColor1:Ht(t.colorScheme.environment1Color),obstaclesColor:Ht(t.colorScheme.obstaclesColor),environmentColor0Boost:Ht(t.colorScheme.environment0ColorBoost),environmentColor1Boost:Ht(t.colorScheme.environment1ColorBoost)}};return t.colorScheme.environmentWColor&&(i.colorScheme.environmentColorW=Ht(t.colorScheme.environmentWColor)),t.colorScheme.environmentWColorBoost&&(i.colorScheme.environmentColorWBoost=Ht(t.colorScheme.environmentWColorBoost)),i}),_customData:K(this.customData),_difficultyBeatmapSets:this.difficultySets.map(t=>t.toJSON())}}get customData(){return this._customData}set customData(t){this._customData=t}addMap(t,i){const n=i||t.characteristic||"Standard";let r=this.difficultySets.find(s=>s.characteristic===n);return r||(r=new Oa({_beatmapCharacteristicName:n}),this.difficultySets.push(r)),r.difficulties.push(new yu(t)),this}listMap(){return super.listMap()}isValid(){throw new Error("Method not implemented.")}}class Oa extends iu{constructor(t){var i;super(),this.difficulties=[],this.characteristic=t._beatmapCharacteristicName||"Standard",this.difficulties=((i=t._difficultyBeatmaps)==null?void 0:i.map(n=>new yu(n,this.characteristic)))??[],this.customData=K(t._customData??{})}static create(t){return new this(t)}toJSON(){return{_beatmapCharacteristicName:this.characteristic,_difficultyBeatmaps:this.difficulties.map(t=>t.toJSON()),_customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}isValid(){throw new Error("Method not implemented.")}}class yu extends nu{constructor(t,i){super(),this.characteristic=i,this.difficulty=t._difficulty??"Easy",this.rank=t._difficultyRank??1,this.filename=t._beatmapFilename??"UnnamedFile.dat",this.njs=t._noteJumpMovementSpeed??0,this.njsOffset=t._noteJumpStartBeatOffset??0,this.colorSchemeId=t._beatmapColorSchemeIdx??0,this.environmentId=t._environmentNameIdx??0,this.customData=K(t._customData??{})}static create(t){return new this(t)}toJSON(){return{_difficulty:this.difficulty,_difficultyRank:this.rank,_beatmapFilename:this.filename,_noteJumpMovementSpeed:this.njs,_noteJumpStartBeatOffset:this.njsOffset,_beatmapColorSchemeIdx:this.colorSchemeId,_environmentNameIdx:this.environmentId,_customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}copyColorScheme(t,i){if(typeof t=="number"){if(i.colorSchemes.length<t)return this;const n=i.colorSchemes[t].colorScheme;return this.copyColorScheme(n)}return this.customData._colorLeft=Object.entries(t.saberLeftColor).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.customData._colorRight=Object.entries(t.saberRightColor).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.customData._envColorLeft=Object.entries(t.environment0Color).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.customData._envColorRight=Object.entries(t.environment1Color).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.customData._envColorLeftBoost=Object.entries(t.environment0ColorBoost).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.customData._envColorRightBoost=Object.entries(t.environment1ColorBoost).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this.customData._obstacleColor=Object.entries(t.obstaclesColor).reduce((n,r)=>(r[0]!=="a"&&(n[r[0]]=r[1]),n),{r:0,g:0,b:0}),this}isValid(){throw new Error("Method not implemented.")}}const _d={_time:{type:"number",version:"2.0.0",optional:!0},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_lineIndex:{type:"number",int:!0,version:"2.0.0",optional:!0},_lineLayer:{type:"number",int:!0,version:"2.0.0",optional:!0},_cutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},bd={_colorType:{type:"number",version:"2.0.0",optional:!0},_headTime:{type:"number",version:"2.0.0",optional:!0},_headLineIndex:{type:"number",int:!0,version:"2.0.0",optional:!0},_headLineLayer:{type:"number",int:!0,version:"2.0.0",optional:!0},_headCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_headControlPointLengthMultiplier:{type:"number",version:"2.0.0",optional:!0},_tailTime:{type:"number",version:"2.0.0",optional:!0},_tailLineIndex:{type:"number",int:!0,version:"2.0.0",optional:!0},_tailLineLayer:{type:"number",int:!0,version:"2.0.0",optional:!0},_tailCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_tailControlPointLengthMultiplier:{type:"number",version:"2.0.0",optional:!0},_sliderMidAnchorMode:{type:"number",version:"2.0.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},vd={_time:{type:"number",version:"2.0.0",optional:!0},_lineIndex:{type:"number",int:!0,version:"2.0.0",optional:!0},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_duration:{type:"number",version:"2.0.0",optional:!0},_width:{type:"number",int:!0,version:"2.0.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},yd={_time:{type:"number",version:"2.0.0",optional:!0},_type:{type:"number",int:!0,version:"2.0.0",optional:!0},_value:{type:"number",int:!0,version:"2.0.0",optional:!0},_floatValue:{type:"number",version:"2.5.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Ed={_time:{type:"number",version:"2.2.0",optional:!0},_lineIndex:{type:"number",int:!0,version:"2.2.0",optional:!0},_lineLayer:{type:"number",int:!0,version:"2.2.0",optional:!0},_offsetDirection:{type:"number",int:!0,version:"2.2.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Dd={_keyword:{type:"string",version:"2.4.0",optional:!0},_specialEvents:{type:"number",int:!0,array:!0,version:"2.4.0",optional:!0}},wd={_keywords:{type:"array",version:"2.4.0",check:Dd,optional:!0}},Sd={_version:{type:"string",version:"2.0.0",optional:!0},_notes:{type:"array",version:"2.0.0",check:_d,optional:!0},_sliders:{type:"array",version:"2.6.0",check:bd,optional:!0},_obstacles:{type:"array",version:"2.0.0",check:vd,optional:!0},_events:{type:"array",version:"2.0.0",check:yd,optional:!0},_waypoints:{type:"array",version:"2.2.0",check:Ed,optional:!0},_specialEventsKeywordFilters:{type:"object",version:"2.4.0",check:wd,optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Cd={_difficulty:{type:"string",version:"2.0.0"},_difficultyRank:{type:"number",version:"2.0.0"},_beatmapFilename:{type:"string",version:"2.0.0"},_noteJumpMovementSpeed:{type:"number",version:"2.0.0"},_noteJumpStartBeatOffset:{type:"number",version:"2.0.0"},_beatmapColorSchemeIdx:{type:"number",version:"2.1.0"},_environmentNameIdx:{type:"number",version:"2.1.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Td={_beatmapCharacteristicName:{type:"string",version:"2.0.0"},_difficultyBeatmaps:{type:"array",version:"2.0.0",check:Cd}},ui={r:{type:"number",version:"2.1.0"},g:{type:"number",version:"2.1.0"},b:{type:"number",version:"2.1.0"},a:{type:"number",version:"2.1.0"}},Ld={colorSchemeId:{type:"string",version:"2.1.0"},saberAColor:{type:"object",version:"2.1.0",check:ui},saberBColor:{type:"object",version:"2.1.0",check:ui},environmentColor0:{type:"object",version:"2.1.0",check:ui},environmentColor1:{type:"object",version:"2.1.0",check:ui},obstaclesColor:{type:"object",version:"2.1.0",check:ui},environmentColor0Boost:{type:"object",version:"2.1.0",check:ui},environmentColor1Boost:{type:"object",version:"2.1.0",check:ui}},xd={useOverride:{type:"boolean",version:"2.1.0"},colorScheme:{type:"object",version:"2.1.0",check:Ld}},kd={_version:{type:"string",version:"2.0.0",optional:!0},_songName:{type:"string",version:"2.0.0"},_songSubName:{type:"string",version:"2.0.0"},_songAuthorName:{type:"string",version:"2.0.0"},_levelAuthorName:{type:"string",version:"2.0.0"},_beatsPerMinute:{type:"number",version:"2.0.0"},_songTimeOffset:{type:"number",version:"2.0.0"},_shuffle:{type:"number",version:"2.0.0"},_shufflePeriod:{type:"number",version:"2.0.0"},_previewStartTime:{type:"number",version:"2.0.0"},_previewDuration:{type:"number",version:"2.0.0"},_songFilename:{type:"string",version:"2.0.0"},_coverImageFilename:{type:"string",version:"2.0.0"},_environmentName:{type:"string",version:"2.0.0"},_allDirectionsEnvironmentName:{type:"string",version:"2.0.0",optional:!0},_environmentNames:{type:"string",version:"2.1.0",array:!0},_colorSchemes:{type:"array",version:"2.1.0",check:xd},_customData:{type:"object",version:"2.0.0",check:{},optional:!0},_difficultyBeatmapSets:{type:"array",version:"2.0.0",check:Td}};function Mi(e){return["v2","parse",e]}function Rd(e,t={enabled:!0,throwError:!0}){var i,n;return J.tInfo(Mi("difficulty"),"Parsing beatmap difficulty v2.x.x"),(i=e._version)!=null&&i.startsWith("2")||(J.tWarn(Mi("difficulty"),"Unidentified beatmap version"),e._version="2.0.0"),t.enabled&&Xe(e,Sd,"difficulty",e._version,t.throwError),qc(e._version,"2.5.0")==="old"&&((n=e._events)==null||n.forEach(r=>r._floatValue=1)),new vu(e)}function Bd(e,t={enabled:!0,throwError:!0}){var i,n;return J.tInfo(Mi("info"),"Parsing beatmap info v2.x.x"),(i=e._version)!=null&&i.startsWith("2")||J.tWarn(Mi("info"),"Unidentified beatmap version"),e._version="2.0.0",t.enabled&&Xe(e,kd,"info",e._version,t.throwError),(n=e._difficultyBeatmapSets)==null||n.forEach(r=>{var l;let s=0;(l=r._difficultyBeatmaps)==null||l.forEach(o=>{var a,h;typeof o._difficultyRank=="number"?o._difficultyRank-s<=0&&J.tWarn(Mi("info"),o._difficulty+" is unordered"):typeof o._difficulty=="string"?(o._difficultyRank=Bs[o._difficulty],o._difficultyRank||(o._difficulty="Easy",o._difficultyRank=1)):(o._difficulty="Easy",o._difficultyRank=1),Bs[o._difficulty]!==o._difficultyRank&&J.tError(Mi("info"),o._difficulty+" has invalid rank"),s=o._difficultyRank,typeof((a=o._customData)==null?void 0:a._editorOffset)=="number"&&o._customData._editorOffset===0&&delete o._customData._editorOffset,typeof((h=o._customData)==null?void 0:h._editorOldOffset)=="number"&&o._customData._editorOldOffset===0&&delete o._customData._editorOldOffset})}),new lr(e)}const Eu=class Wt extends Zc{constructor(t={}){super(),this._time=t.b??t.time??Wt.default.b,this._color=t.c??t.color??Wt.default.c,this._posX=t.x??t.posX??Wt.default.x,this._posY=t.y??t.posY??Wt.default.y,this._direction=t.d??t.direction??Wt.default.d,this._lengthMultiplier=t.mu??t.lengthMultiplier??Wt.default.mu,this._tailTime=t.tb??t.tailTime??Wt.default.tb,this._tailPosX=t.tx??t.tailPosX??Wt.default.tx,this._tailPosY=t.ty??t.tailPosY??Wt.default.ty,this._tailDirection=t.tc??t.tailDirection??Wt.default.tc,this._tailLengthMultiplier=t.tmu??t.tailLengthMultiplier??Wt.default.tmu,this._midAnchor=t.m??t.midAnchor??Wt.default.m,this._customData=K(t.customData??Wt.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,mu:this.lengthMultiplier,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,tc:this.tailDirection,tmu:this.tailLengthMultiplier,m:this.midAnchor,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}mirror(t=!0,i){return i&&(this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ue(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(n=>{n[0]=-n[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(ue(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(n=>{n[0]=-n[0]})))),super.mirror(t)}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData.coordinates)return[this.customData.coordinates[0],this.customData.coordinates[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3+1:this.posX>=1e3?this.posX/1e3-1:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"vanilla":case"ne":return super.getAngle();case"me":default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):super.getAngle()}}getTailPosition(t){switch(t){case"vanilla":return super.getTailPosition();case"ne":if(this.customData.tailCoordinates)return[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]];case"me":default:return[(this.tailPosX<=-1e3?this.tailPosX/1e3+1:this.tailPosX>=1e3?this.tailPosX/1e3-1:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY]}}getTailAngle(t){switch(t){case"vanilla":case"ne":return super.getTailAngle();case"me":if(this.tailDirection>=1e3)return Math.abs(this.tailDirection%1e3%360-360);default:return super.getTailAngle()}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.tailCoordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.link=="string"}};Eu.default={b:0,c:0,x:0,y:0,d:0,mu:0,tb:0,tx:0,ty:0,tc:0,tmu:0,m:0,customData:{}};let ln=Eu;const Du=class oe extends Wr{constructor(t={}){super(),this._time=t.b??t.time??oe.default.b,this._type=t.et??t.type??oe.default.et,this._value=t.i??t.value??oe.default.i,this._floatValue=t.f??t.floatValue??oe.default.f,this._customData=K(t.customData??oe.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this({b:oe.default.b,et:oe.default.et,i:oe.default.i,f:oe.default.f,customData:oe.default.customData})]}toJSON(){return{b:this.time,et:this.type,i:this.value,f:this.floatValue,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}isLightEvent(t){return super.isLightEvent(t)}isRingEvent(t){return super.isRingEvent(t)}isLaserRotationEvent(t){return super.isLaserRotationEvent(t)}isLaneRotationEvent(t){return super.isLaneRotationEvent(t)}isChroma(){const t=this;return t.isLightEvent()?Array.isArray(this.customData.color)||typeof this.customData.lightID=="number"||Array.isArray(this.customData.lightID)||typeof this.customData.easing=="string"||typeof this.customData.lerpType=="string":t.isRingEvent()?typeof this.customData.nameFilter=="string"||typeof this.customData.rotation=="number"||typeof this.customData.step=="number"||typeof this.customData.prop=="number"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":t.isLaserRotationEvent()?typeof this.customData.lockRotation=="boolean"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":!1}};Du.default={b:0,et:0,i:0,f:0,customData:{}};let Fi=Du;const wu=class cr extends Qc{constructor(t={}){super(),this._keyword=t.k??t.keyword??cr.default.k,this._events=(t.e??t.events??cr.default.e).filter(i=>typeof i=="number")}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{k:this.keyword,e:this.events}}};wu.default={k:"",e:[]};let Nd=wu;const Su=class Cu extends tu{constructor(t={}){super(),this._list=(t.d??t.list??Cu.default.d).map(i=>{if(i)return new Nd(i)}).filter(i=>i)}static create(t={}){return new this(t)}toJSON(){return{d:this.list.map(t=>t.toJSON())}}get list(){return this._list}set list(t){this._list=t}addList(t){return this.list.push(t),this}};Su.default={d:[]};let to=Su;const Tu=class cn extends Fm{constructor(t={}){super(),this._time=t.b??t.time??cn.default.b,this._posX=t.x??t.posX??cn.default.x,this._posY=t.y??t.posY??cn.default.y,this._customData=K(t.customData??cn.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}mirror(t,i){return i&&(this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ue(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(n=>{n[0]=-n[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(ue(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(n=>{n[0]=-n[0]})))),super.mirror()}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.link=="string"}};Tu.default={b:0,x:0,y:0,customData:{}};let je=Tu;const Lu=class eo extends Wm{constructor(t={}){super(),this._time=t.b??t.time??eo.default.b,this._bpm=t.m??t.bpm??eo.default.m,this._customData=K(t.customData??eo.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,m:this.bpm,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}setBPM(t){return this.bpm=t,this}isValid(){return this.bpm>0}};Lu.default={b:0,m:0,customData:{}};let un=Lu;const xu=class Jt extends Hm{constructor(t={}){super(),this._time=t.b??t.time??t.tb??Jt.default.b,this._color=t.c??t.color??Jt.default.c,this._posX=t.x??t.posX??Jt.default.x,this._posY=t.y??t.posY??Jt.default.y,this._direction=t.d??t.direction??Jt.default.d,this._tailTime=t.tb??t.tailTime??t.b??Jt.default.tb,this._tailPosX=t.tx??t.tailPosX??Jt.default.tx,this._tailPosY=t.ty??t.tailPosY??Jt.default.ty,this._sliceCount=t.sc??t.sliceCount??Jt.default.sc,this._squish=t.s??t.squish??Jt.default.s,this._customData=K(t.customData??Jt.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,sc:this.sliceCount,s:this.squish,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}mirror(t=!0,i){return i&&(this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(ue(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(n=>{n[0]=-n[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(ue(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(n=>{n[0]=-n[0]})))),super.mirror(t)}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData.coordinates)return[this.customData.coordinates[0],this.customData.coordinates[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3+1:this.posX>=1e3?this.posX/1e3-1:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"vanilla":case"ne":default:return super.getAngle()}}getTailPosition(t){switch(t){case"vanilla":return super.getTailPosition();case"ne":if(this.customData.tailCoordinates)return[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]];case"me":default:return[(this.tailPosX<=-1e3?this.tailPosX/1e3+1:this.tailPosX>=1e3?this.tailPosX/1e3-1:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY]}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.tailCoordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.link=="string"}};xu.default={b:0,c:0,x:0,y:0,d:0,tb:0,tx:0,ty:0,sc:0,s:0,customData:{}};let Xn=xu;const ku=class io extends Gm{constructor(t={}){super(),this._time=t.b??t.time??io.default.b,this._toggle=t.o??t.toggle??io.default.o,this._customData=K(t.customData??io.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,o:this.toggle,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}isValid(){return!0}};ku.default={b:0,o:!1,customData:{}};let hn=ku;const Ru=class qt extends Vm{constructor(t={}){super(),this._type=t.f??t.type??qt.default.f,this._p0=t.p??t.p0??qt.default.p,this._p1=t.t??t.p1??qt.default.t,this._reverse=t.r??t.reverse??qt.default.r,this._chunks=t.c??t.chunks??qt.default.c,this._random=t.n??t.random??qt.default.n,this._seed=t.s??t.seed??qt.default.s,this._limit=t.l??t.limit??qt.default.l,this._limitAffectsType=t.d??t.limitAffectsType??qt.default.d,this._customData=K(t.customData??qt.default.customData)}static create(t={}){return new qt(t)}toJSON(){return{f:this.type,p:this.p0,t:this.p1,r:this.reverse,c:this.chunks,n:this.random,s:this.seed,l:this.limit,d:this.limitAffectsType,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};Ru.default={f:1,p:0,t:0,r:0,c:0,n:0,s:0,l:0,d:0,customData:{}};let ut=Ru;const Bu=class mi extends Jm{constructor(t={}){super(),this._time=t.b??t.time??mi.default.b,this._color=t.c??t.color??mi.default.c,this._frequency=t.f??t.frequency??mi.default.f,this._transition=t.i??t.transition??mi.default.i,this._brightness=t.s??t.brightness??mi.default.s,this._customData=K(t.customData??mi.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,c:this.color,f:this.frequency,i:this.transition,s:this.brightness,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};Bu.default={b:0,i:0,c:0,s:1,f:0,customData:{}};let Ad=Bu;const Nu=class be extends qm{constructor(t={}){super(),this._filter=new ut(t.f??t.filter??be.default.f),this._beatDistribution=t.w??t.beatDistribution??be.default.w,this._beatDistributionType=t.d??t.beatDistributionType??be.default.d,this._brightnessDistribution=t.r??t.brightnessDistribution??be.default.r,this._brightnessDistributionType=t.t??t.brightnessDistributionType??be.default.t,this._affectFirst=t.b??t.affectFirst??be.default.b,this._easing=t.i??t.easing??be.default.i,this._events=(t.e??t.events??be.default.e).map(i=>new Ad(i)),this._customData=K(t.customData??be.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,r:this.brightnessDistribution,t:this.brightnessDistributionType,b:this.affectFirst,i:this.easing,e:this.events.map(t=>t.toJSON()),customData:K(this.customData)}}get filter(){return this._filter}set filter(t){this._filter=t}get events(){return this._events}set events(t){this._events=t}get customData(){return this._customData}set customData(t){this._customData=t}setEvents(t){return this.events=t,this}};Nu.default={f:{f:ut.default.f,p:ut.default.p,t:ut.default.t,r:ut.default.r,c:ut.default.c,n:ut.default.n,s:ut.default.s,l:ut.default.l,d:ut.default.d},w:0,d:1,r:0,t:1,b:0,i:0,e:[],customData:{}};let Id=Nu;const Au=class fn extends Km{constructor(t={}){super(),this._time=t.b??t.time??fn.default.b,this._id=t.g??t.id??fn.default.g,this._boxes=(t.e??t.boxes??fn.default.e).map(i=>new Id(i)),this._customData=K(t.customData??fn.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:K(this.customData)}}get boxes(){return this._boxes}set boxes(t){this._boxes=t}get customData(){return this._customData}set customData(t){this._customData=t}isValid(){return this.id>=0}};Au.default={b:0,g:0,e:[],customData:{}};let Uo=Au;const Iu=class Me extends Zm{constructor(t={}){super(),this._time=t.b??t.time??Me.default.b,this._easing=t.e??t.easing??Me.default.e,this._loop=t.l??t.loop??Me.default.l,this._direction=t.o??t.direction??Me.default.o,this._previous=t.p??t.previous??Me.default.p,this._rotation=t.r??t.rotation??Me.default.r,this._customData=K(t.customData??Me.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,e:this.easing,l:this.loop,o:this.direction,p:this.previous,r:this.rotation,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};Iu.default={b:0,p:0,e:0,l:0,r:0,o:0,customData:{}};let Od=Iu;const Ou=class Kt extends Qm{constructor(t={}){super(),this._filter=new ut(t.f??t.filter??Kt.default.f),this._beatDistribution=t.w??t.beatDistribution??Kt.default.w,this._beatDistributionType=t.d??t.beatDistributionType??Kt.default.d,this._rotationDistribution=t.s??t.rotationDistribution??Kt.default.s,this._rotationDistributionType=t.t??t.rotationDistributionType??Kt.default.t,this._axis=t.a??t.axis??Kt.default.a,this._flip=t.r??t.flip??Kt.default.r,this._affectFirst=t.b??t.affectFirst??Kt.default.b,this._easing=t.i??t.easing??Kt.default.i,this._events=(t.l??t.events??Kt.default.l).map(i=>new Od(i)),this._customData=K(t.customData??Kt.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.rotationDistribution,t:this.rotationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,i:this.easing,l:this.events.map(t=>t.toJSON()),customData:K(this.customData)}}get filter(){return this._filter}set filter(t){this._filter=t}get events(){return this._events}set events(t){this._events=t}get customData(){return this._customData}set customData(t){this._customData=t}setEvents(t){return this.events=t,this}};Ou.default={f:{f:ut.default.f,p:ut.default.p,t:ut.default.t,r:ut.default.r,c:ut.default.c,n:ut.default.n,s:ut.default.s,l:ut.default.l,d:ut.default.d},w:0,d:1,s:0,t:1,a:0,r:0,b:0,i:0,l:[],customData:{}};let $d=Ou;const $u=class mn extends td{constructor(t={}){super(),this._time=t.b??t.time??mn.default.b,this._id=t.g??t.id??mn.default.g,this._boxes=(t.e??t.boxes??mn.default.e).map(i=>new $d(i)),this._customData=K(t.customData??mn.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:K(this.customData)}}get boxes(){return this._boxes}set boxes(t){this._boxes=t}get customData(){return this._customData}set customData(t){this._customData=t}isValid(){return this.id>=0}};$u.default={b:0,g:0,e:[],customData:{}};let Vo=$u;const Pu=class Ii extends ed{constructor(t={}){super(),this._time=t.b??t.time??Ii.default.b,this._easing=t.e??t.easing??Ii.default.e,this._previous=t.p??t.previous??Ii.default.p,this._translation=t.t??t.translation??Ii.default.t,this._customData=K(t.customData??Ii.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,e:this.easing,p:this.previous,t:this.translation,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};Pu.default={b:0,p:0,e:0,t:0,customData:{}};let Pd=Pu;const Mu=class Zt extends id{constructor(t={}){super(),this._filter=new ut(t.f??t.filter??Zt.default.f),this._beatDistribution=t.w??t.beatDistribution??Zt.default.w,this._beatDistributionType=t.d??t.beatDistributionType??Zt.default.d,this._translationDistribution=t.s??t.gapDistribution??Zt.default.s,this._translationDistributionType=t.t??t.gapDistributionType??Zt.default.t,this._axis=t.a??t.axis??Zt.default.a,this._flip=t.r??t.flip??Zt.default.r,this._affectFirst=t.b??t.affectFirst??Zt.default.b,this._easing=t.i??t.easing??Zt.default.i,this._events=(t.l??t.events??Zt.default.l).map(i=>new Pd(i)),this._customData=K(t.customData??Zt.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.gapDistribution,t:this.gapDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,i:this.easing,l:this.events.map(t=>t.toJSON()),customData:K(this.customData)}}get filter(){return this._filter}set filter(t){this._filter=t}get events(){return this._events}set events(t){this._events=t}get customData(){return this._customData}set customData(t){this._customData=t}setEvents(t){return this.events=t,this}};Mu.default={f:{f:ut.default.f,p:ut.default.p,t:ut.default.t,r:ut.default.r,c:ut.default.c,n:ut.default.n,s:ut.default.s,l:ut.default.l,d:ut.default.d},w:0,d:1,s:0,t:1,a:0,r:0,b:0,i:0,l:[],customData:{}};let Md=Mu;const Fu=class dn extends nd{constructor(t={}){super(),this._time=t.b??t.time??dn.default.b,this._id=t.g??t.id??dn.default.g,this._boxes=(t.e??t.boxes??dn.default.e).map(i=>new Md(i)),this._customData=K(t.customData??dn.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:K(this.customData)}}get boxes(){return this._boxes}set boxes(t){this._boxes=t}get customData(){return this._customData}set customData(t){this._customData=t}setCustomData(t){return this.customData=t,this}addCustomData(t){return this.customData={...this.customData,object:t},this}isValid(){return this.id>=0}};Fu.default={b:0,g:0,e:[],customData:{}};let Jo=Fu;const Wu=class pn extends od{constructor(t={}){super(),this._time=t.b??t.time??pn.default.b,this._executionTime=t.e??t.executionTime??pn.default.e,this._rotation=t.r??t.rotation??pn.default.r,this._customData=K(t.customData??pn.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,e:this.executionTime,r:this.rotation,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};Wu.default={b:0,e:0,r:0,customData:{}};let gn=Wu;const Hu=class Oi extends ou{constructor(t={}){super(),this._time=t.b??t.time??Oi.default.b,this._posX=t.x??t.posX??Oi.default.x,this._posY=t.y??t.posY??Oi.default.y,this._direction=t.d??t.direction??Oi.default.d,this._customData=K(t.customData??Oi.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.direction,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};Hu.default={b:0,x:0,y:0,d:0,customData:{}};let _n=Hu;const Gu=class ve extends jm{constructor(t={}){super(),this._filter=new ut(t.f??t.filter??ve.default.f),this._beatDistribution=t.w??t.beatDistribution??ve.default.w,this._beatDistributionType=t.d??t.beatDistributionType??ve.default.d,this._fxDistribution=t.s??t.fxDistribution??ve.default.s,this._fxDistributionType=t.t??t.fxDistributionType??ve.default.t,this._affectFirst=t.b??t.affectFirst??ve.default.b,this._easing=t.i??t.easing??ve.default.i,this._events=(t.l??t.events??ve.default.l).map(i=>i),this._customData=K(t.customData??ve.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.fxDistribution,t:this.fxDistributionType,b:this.affectFirst,i:this.easing,l:this.events.map(t=>t),customData:K(this.customData)}}get filter(){return this._filter}set filter(t){this._filter=t}get events(){return this._events}set events(t){this._events=t}get customData(){return this._customData}set customData(t){this._customData=t}setEvents(t){return this.events=t,this}};Gu.default={f:{f:ut.default.f,p:ut.default.p,t:ut.default.t,r:ut.default.r,c:ut.default.c,n:ut.default.n,s:ut.default.s,l:ut.default.l,d:ut.default.d},w:0,d:1,s:0,t:1,b:0,i:0,l:[],customData:{}};let Fd=Gu;const ju=class $i extends Xm{constructor(t={}){super(),this._time=t.b??t.time??$i.default.b,this._id=t.g??t.id??$i.default.g,this._boxes=(t.e??t.boxes??$i.default.e).map(i=>new Fd(i)),this._type=t.t??t.type??$i.default.t,this._customData=K(t.customData??$i.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),t:this.type,customData:K(this.customData)}}get boxes(){return this._boxes}set boxes(t){this._boxes=t}get customData(){return this._customData}set customData(t){this._customData=t}setCustomData(t){return this.customData=t,this}addCustomData(t){return this.customData={...this.customData,object:t},this}isValid(){return this.id>=0}};ju.default={b:0,g:0,e:[],t:0,customData:{}};let qo=ju;const Xu=class Pi extends zm{constructor(t={}){super(),this._time=t.b??t.time??Pi.default.b,this._easing=t.i??t.easing??Pi.default.i,this._previous=t.p??t.previous??Pi.default.p,this._value=t.v??t.value??Pi.default.v,this._customData=K(t.customData??Pi.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,i:this.easing,p:this.previous,v:this.value,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};Xu.default={b:0,i:0,p:0,v:0,customData:{}};let Wd=Xu;const zu=class bn extends Ym{constructor(t={}){super(),this._time=t.b??t.time??bn.default.b,this._previous=t.p??t.previous??bn.default.p,this._value=t.v??t.value??bn.default.v,this._customData=K(t.customData??bn.default.customData)}static create(...t){const i=[];return t.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,p:this.previous,v:this.value,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};zu.default={b:0,p:0,v:0,customData:{}};let Hd=zu;const Yu=class ur extends Um{constructor(t={}){super(),this.floatList=(t.floatList??t._fl??ur.default._fl).map(i=>{if(i)return new Wd(i)}).filter(i=>i),this.intList=(t.intList??t._il??ur.default._il).map(i=>{if(i)return new Hd(i)}).filter(i=>i)}static create(t={}){return new this(t)}toJSON(){return{_fl:this.floatList.map(t=>t.toJSON()),_il:this.intList.map(t=>t.toJSON())}}get floatList(){return this._floatList}set floatList(t){this._floatList=t}get intList(){return this._intList}set intList(t){this._intList=t}isValid(){throw new Error("Method not implemented.")}};Yu.default={_fl:[],_il:[]};let Ko=Yu;class hr extends Fr{constructor(t={}){super(),this.version="3.3.0",this.bpmEvents=(t.bpmEvents??[]).map(i=>new un(i)),this.rotationEvents=(t.rotationEvents??[]).map(i=>new gn(i)),this.colorNotes=(t.colorNotes??[]).map(i=>new Se(i)),this.bombNotes=(t.bombNotes??[]).map(i=>new je(i)),this.obstacles=(t.obstacles??[]).map(i=>new zt(i)),this.arcs=(t.sliders??[]).map(i=>new ln(i)),this.chains=(t.burstSliders??[]).map(i=>new Xn(i)),this.waypoints=(t.waypoints??[]).map(i=>new _n(i)),this.basicEvents=(t.basicBeatmapEvents??[]).map(i=>new Fi(i)),this.colorBoostEvents=(t.colorBoostBeatmapEvents??[]).map(i=>new hn(i)),this.lightColorEventBoxGroups=(t.lightColorEventBoxGroups??[]).map(i=>new Uo(i)),this.lightRotationEventBoxGroups=(t.lightRotationEventBoxGroups??[]).map(i=>new Vo(i)),this.lightTranslationEventBoxGroups=(t.lightTranslationEventBoxGroups??[]).map(i=>new Jo(i)),this.fxEventBoxGroups=(t.vfxEventBoxGroups??[]).map(i=>new qo(i)),this.eventTypesWithKeywords=new to(t.basicEventTypesWithKeywords??{d:[]}),this.fxEventsCollection=new Ko(t._fxEventsCollection??{_fl:[],_il:[]}),this.useNormalEventsAsCompatibleEvents=t.useNormalEventsAsCompatibleEvents??!1,this.customData=K(t.customData??{})}static create(t={}){return new this(t)}toJSON(){return{version:"3.3.0",bpmEvents:this.bpmEvents.map(t=>t.toJSON()),rotationEvents:this.rotationEvents.map(t=>t.toJSON()),colorNotes:this.colorNotes.map(t=>t.toJSON()),bombNotes:this.bombNotes.map(t=>t.toJSON()),obstacles:this.obstacles.map(t=>t.toJSON()),sliders:this.arcs.map(t=>t.toJSON()),burstSliders:this.chains.map(t=>t.toJSON()),waypoints:this.waypoints.map(t=>t.toJSON()),basicBeatmapEvents:this.basicEvents.map(t=>t.toJSON()),colorBoostBeatmapEvents:this.colorBoostEvents.map(t=>t.toJSON()),lightColorEventBoxGroups:this.lightColorEventBoxGroups.map(t=>t.toJSON()),lightRotationEventBoxGroups:this.lightRotationEventBoxGroups.map(t=>t.toJSON()),lightTranslationEventBoxGroups:this.lightTranslationEventBoxGroups.map(t=>t.toJSON()),vfxEventBoxGroups:this.fxEventBoxGroups.map(t=>t.toJSON()),basicEventTypesWithKeywords:this.eventTypesWithKeywords.toJSON(),_fxEventsCollection:this.fxEventsCollection.toJSON(),useNormalEventsAsCompatibleEvents:this.useNormalEventsAsCompatibleEvents,customData:K(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}reparse(t){return this.colorNotes=this.colorNotes.map(i=>this.createOrKeep(Se,i,t)),this.bombNotes=this.bombNotes.map(i=>this.createOrKeep(je,i,t)),this.arcs=this.arcs.map(i=>this.createOrKeep(ln,i,t)),this.chains=this.chains.map(i=>this.createOrKeep(Xn,i,t)),this.obstacles=this.obstacles.map(i=>this.createOrKeep(zt,i,t)),this.basicEvents=this.basicEvents.map(i=>this.createOrKeep(Fi,i,t)),this.colorBoostEvents=this.colorBoostEvents.map(i=>this.createOrKeep(hn,i,t)),this.rotationEvents=this.rotationEvents.map(i=>this.createOrKeep(gn,i,t)),this.bpmEvents=this.bpmEvents.map(i=>this.createOrKeep(un,i,t)),this.waypoints=this.waypoints.map(i=>this.createOrKeep(_n,i,t)),this.eventTypesWithKeywords=new to(this.eventTypesWithKeywords),this.fxEventsCollection=new Ko(this.fxEventsCollection),this}addBpmEvents(...t){for(const i of t)this.bpmEvents.push(new un(i))}addRotationEvents(...t){for(const i of t)this.rotationEvents.push(new gn(i))}addColorNotes(...t){for(const i of t)this.colorNotes.push(new Se(i))}addBombNotes(...t){for(const i of t)this.bombNotes.push(new je(i))}addObstacles(...t){for(const i of t)this.obstacles.push(new zt(i))}addArcs(...t){for(const i of t)this.arcs.push(new ln(i))}addChains(...t){for(const i of t)this.chains.push(new Xn(i))}addWaypoints(...t){for(const i of t)this.waypoints.push(new _n(i))}addBasicEvents(...t){for(const i of t)this.basicEvents.push(new Fi(i))}addColorBoostEvents(...t){for(const i of t)this.colorBoostEvents.push(new hn(i))}addLightColorEventBoxGroups(...t){for(const i of t)this.lightColorEventBoxGroups.push(new Uo(i))}addLightRotationEventBoxGroups(...t){for(const i of t)this.lightRotationEventBoxGroups.push(new Vo(i))}addLightTranslationEventBoxGroups(...t){for(const i of t)this.lightTranslationEventBoxGroups.push(new Jo(i))}addFxEventBoxGroups(...t){for(const i of t)this.fxEventBoxGroups.push(new qo(i))}isValid(){return this.colorNotes.every(t=>this.checkClass(Se,t))||this.bombNotes.every(t=>this.checkClass(je,t))||this.arcs.every(t=>this.checkClass(ln,t))||this.chains.every(t=>this.checkClass(Xn,t))||this.obstacles.every(t=>this.checkClass(zt,t))||this.basicEvents.every(t=>this.checkClass(Fi,t))||this.colorBoostEvents.every(t=>this.checkClass(hn,t))||this.rotationEvents.every(t=>this.checkClass(gn,t))||this.bpmEvents.every(t=>this.checkClass(un,t))||this.waypoints.every(t=>this.checkClass(_n,t))||this.lightColorEventBoxGroups.every(t=>this.checkClass(Uo,t))||this.lightRotationEventBoxGroups.every(t=>this.checkClass(Vo,t))||this.lightTranslationEventBoxGroups.every(t=>this.checkClass(Jo,t))||this.fxEventBoxGroups.every(t=>this.checkClass(qo,t))||this.eventTypesWithKeywords instanceof to,this.fxEventsCollection instanceof Ko}}const Gd={b:{type:"number",version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},a:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},jd={b:{type:"number",version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Xd={b:{type:"number",version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},mu:{type:"number",version:"3.0.0",optional:!0},tb:{type:"number",version:"3.0.0",optional:!0},tx:{type:"number",int:!0,version:"3.0.0",optional:!0},ty:{type:"number",int:!0,version:"3.0.0",optional:!0},tc:{type:"number",int:!0,version:"3.0.0",optional:!0},tmu:{type:"number",version:"3.0.0",optional:!0},m:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},zd={b:{type:"number",version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},tb:{type:"number",version:"3.0.0",optional:!0},tx:{type:"number",int:!0,version:"3.0.0",optional:!0},ty:{type:"number",int:!0,version:"3.0.0",optional:!0},sc:{type:"number",int:!0,version:"3.0.0",optional:!0},s:{type:"number",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Yd={b:{type:"number",version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},d:{type:"number",version:"3.0.0",optional:!0},w:{type:"number",int:!0,version:"3.0.0",optional:!0},h:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ud={b:{type:"number",version:"3.0.0",optional:!0},et:{type:"number",int:!0,version:"3.0.0",optional:!0},i:{type:"number",int:!0,version:"3.0.0",optional:!0},f:{type:"number",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Vd={b:{type:"number",version:"3.0.0",optional:!0},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Jd={b:{type:"number",version:"3.0.0",optional:!0},e:{type:"number",int:!0,version:"3.0.0",optional:!0},r:{type:"number",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},qd={b:{type:"number",version:"3.0.0",optional:!0},o:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Po={f:{type:"number",int:!0,version:"3.0.0",optional:!0},p:{type:"number",version:"3.0.0",optional:!0},t:{type:"number",version:"3.0.0",optional:!0},r:{type:"number",int:!0,version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.1.0",optional:!0},l:{type:"number",version:"3.1.0",optional:!0},d:{type:"number",int:!0,version:"3.1.0",optional:!0},n:{type:"number",int:!0,version:"3.1.0",optional:!0},s:{type:"number",int:!0,version:"3.1.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Kd={b:{type:"number",version:"3.0.0",optional:!0},i:{type:"number",int:!0,version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.0.0",optional:!0},s:{type:"number",version:"3.0.0",optional:!0},f:{type:"number",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Zd={f:{type:"object",version:"3.0.0",check:Po,optional:!0},w:{type:"number",version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},r:{type:"number",version:"3.0.0",optional:!0},t:{type:"number",int:!0,version:"3.0.0",optional:!0},e:{type:"array",version:"3.0.0",check:Kd,optional:!0},b:{type:"number",int:!0,version:"3.0.0",optional:!0},i:{type:"number",int:!0,version:"3.2.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Qd={b:{type:"number",version:"3.0.0",optional:!0},g:{type:"number",int:!0,version:"3.0.0",optional:!0},e:{type:"array",version:"3.0.0",check:Zd,optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},tp={b:{type:"number",version:"3.0.0",optional:!0},p:{type:"number",int:!0,version:"3.0.0",optional:!0},e:{type:"number",int:!0,version:"3.0.0",optional:!0},l:{type:"number",version:"3.0.0",optional:!0},r:{type:"number",version:"3.0.0",optional:!0},o:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ep={f:{type:"object",version:"3.0.0",check:Po,optional:!0},w:{type:"number",version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},s:{type:"number",version:"3.0.0",optional:!0},t:{type:"number",int:!0,version:"3.0.0",optional:!0},a:{type:"number",int:!0,version:"3.0.0",optional:!0},l:{type:"array",version:"3.0.0",check:tp,optional:!0},r:{type:"number",int:!0,version:"3.0.0",optional:!0},b:{type:"number",int:!0,version:"3.0.0",optional:!0},i:{type:"number",int:!0,version:"3.2.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ip={b:{type:"number",version:"3.0.0",optional:!0},g:{type:"number",int:!0,version:"3.0.0",optional:!0},e:{type:"array",version:"3.0.0",check:ep,optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},np={b:{type:"number",version:"3.2.0",optional:!0},p:{type:"number",int:!0,version:"3.2.0",optional:!0},e:{type:"number",int:!0,version:"3.2.0",optional:!0},t:{type:"number",version:"3.2.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},op={f:{type:"object",version:"3.2.0",check:Po,optional:!0},w:{type:"number",version:"3.2.0",optional:!0},d:{type:"number",int:!0,version:"3.2.0",optional:!0},s:{type:"number",version:"3.2.0",optional:!0},t:{type:"number",int:!0,version:"3.2.0",optional:!0},a:{type:"number",int:!0,version:"3.2.0",optional:!0},l:{type:"array",version:"3.2.0",check:np,optional:!0},r:{type:"number",int:!0,version:"3.2.0",optional:!0},b:{type:"number",int:!0,version:"3.2.0",optional:!0},i:{type:"number",int:!0,version:"3.2.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},rp={b:{type:"number",version:"3.2.0",optional:!0},g:{type:"number",int:!0,version:"3.2.0",optional:!0},e:{type:"array",version:"3.2.0",check:op,optional:!0},customData:{type:"object",version:"3.2.0",check:{},optional:!0}},sp={f:{type:"object",version:"3.3.0",check:Po,optional:!0},w:{type:"number",version:"3.3.0",optional:!0},d:{type:"number",int:!0,version:"3.3.0",optional:!0},s:{type:"number",version:"3.3.0",optional:!0},t:{type:"number",int:!0,version:"3.3.0",optional:!0},l:{type:"number",int:!0,array:!0,version:"3.3.0",optional:!0},b:{type:"number",int:!0,version:"3.3.0",optional:!0},i:{type:"number",int:!0,version:"3.3.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ap={b:{type:"number",version:"3.3.0",optional:!0},g:{type:"number",int:!0,version:"3.3.0",optional:!0},e:{type:"array",version:"3.3.0",check:sp,optional:!0},t:{type:"number",int:!0,version:"3.3.0",optional:!0},customData:{type:"object",version:"3.3.0",check:{},optional:!0}},lp={k:{type:"string",version:"3.0.0",optional:!0},e:{type:"number",int:!0,array:!0,version:"3.0.0",optional:!0}},cp={d:{type:"array",version:"3.0.0",check:lp,optional:!0}},up={b:{type:"number",version:"3.3.0",optional:!0},i:{type:"number",int:!0,version:"3.3.0",optional:!0},p:{type:"number",int:!0,version:"3.3.0",optional:!0},v:{type:"number",version:"3.3.0",optional:!0},customData:{type:"object",version:"3.3.0",check:{},optional:!0}},hp={b:{type:"number",version:"3.3.0",optional:!0},p:{type:"number",int:!0,version:"3.3.0",optional:!0},v:{type:"number",int:!0,version:"3.3.0",optional:!0},customData:{type:"object",version:"3.3.0",check:{},optional:!0}},fp={_fl:{type:"array",version:"3.3.0",check:up,optional:!0},_il:{type:"array",version:"3.3.0",check:hp,optional:!0}},mp={b:{type:"number",version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},dp={version:{type:"string",version:"3.0.0",optional:!0},bpmEvents:{type:"array",version:"3.0.0",check:Vd,optional:!0},rotationEvents:{type:"array",version:"3.0.0",check:Jd,optional:!0},colorNotes:{type:"array",version:"3.0.0",check:Gd,optional:!0},bombNotes:{type:"array",version:"3.0.0",check:jd,optional:!0},obstacles:{type:"array",version:"3.0.0",check:Yd,optional:!0},sliders:{type:"array",version:"3.0.0",check:Xd,optional:!0},burstSliders:{type:"array",version:"3.0.0",check:zd,optional:!0},waypoints:{type:"array",version:"3.0.0",check:mp,optional:!0},basicBeatmapEvents:{type:"array",version:"3.0.0",check:Ud,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:qd,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:Qd,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:ip,optional:!0},lightTranslationEventBoxGroups:{type:"array",version:"3.2.0",check:rp,optional:!0},vfxEventBoxGroups:{type:"array",version:"3.3.0",check:ap,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"3.0.0",check:cp,optional:!0},_fxEventsCollection:{type:"object",version:"3.3.0",check:fp,optional:!0},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}};function $a(e){return["v3","parse",e]}function pp(e,t={enabled:!0,throwError:!0}){return J.tInfo($a("difficulty"),"Parsing beatmap difficulty v3.x.x"),e.version==="3.0.0"||e.version==="3.1.0"||e.version==="3.2.0"||e.version==="3.3.0"||(J.tWarn($a("difficulty"),"Unidentified beatmap version"),e.version="3.0.0"),t.enabled&&Xe(e,dp,"difficulty",e.version,t.throwError),new hr(e)}const Pa="Invalid Event Box",Ma="Check for valid event box group usage.",Fa=!0,So={name:Pa,description:Ma,type:"event",order:{input:pt.EVENTS_INVALID_EVENT_BOX,output:gt.EVENTS_INVALID_EVENT_BOX},input:{enabled:Fa,params:{},html:_t.create(Pa,Ma,Fa,function(){So.input.enabled=this.checked})},output:{html:null},run:_p},Wa={EDMEnvironment:{0:24,1:24,2:24,3:24,4:24,5:24,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:1,15:1,16:1,17:1},LizzoEnvironment:{0:40,1:16,2:16,3:16,4:16,5:16,6:1,7:1,8:12,9:12,10:12,11:6,12:6,13:14,14:14,15:4,16:4,17:3,18:3,19:14},PyroEnvironment:{0:3,1:3,2:5,3:5,4:3,5:12,6:48,7:48,8:4,9:4,10:3,11:3,12:10,13:10},TheSecondEnvironment:{0:15,1:24,2:12,3:12,4:12,5:12,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4},TheWeekndEnvironment:{0:4,1:4,2:4,3:4,4:8,5:4,6:4,7:12,8:1,9:6,10:25,11:25,12:25,13:25,14:25,15:25,16:25,17:25,18:25,19:25,20:3,21:3,22:8,23:8,29:3,30:3,31:3,32:3,33:3,34:3,35:3,36:3,37:6,38:6,40:2},RockMixtapeEnvironment:{0:5,1:5,2:10,3:10,4:10,5:10,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:3,15:10,16:5,17:5,18:24,19:24,20:12,21:12,22:8,23:8,24:36,25:3,26:36,27:3,28:5,29:2,30:16,31:4,32:4,33:4,34:4,35:2,36:2,37:2},WeaveEnvironment:{0:8,1:8,2:8,3:8,4:8,5:8,6:8,7:8,8:8,9:8,10:8,11:8,12:12,13:12,14:8,15:8},Dragons2Environment:{0:24,1:96,2:35,3:15,4:8,5:12,6:12,7:5,8:5,9:5,10:5,11:5,12:5},Panic2Environment:{0:7,1:7,2:7,3:7,4:8,5:8,6:24,7:24,8:24,9:6,10:6,11:6,12:6,13:14,14:14,15:2,16:28,17:28,18:1,19:1,20:12,21:1,22:12,23:1}};function gp(e,t){const i=[],n=[];if(!Wa[t])return{defectID:[],defectFilter:[]};const r=t,s=gi[r][1],l=[...e.lightColorEventBoxGroups,...e.lightRotationEventBoxGroups,...e.lightTranslationEventBoxGroups];for(const o of l){s.includes(o.id)||i.push(o);for(const a of o.boxes){const h=a.filter;h.type===Kl.STEP_AND_OFFSET&&h.p0>Wa[r][o.id]&&n.push(o)}}return{defectID:i.map(o=>o.time).filter(function(o,a,h){return!a||o!==h[a-1]}),defectFilter:n.map(o=>o.time).filter(function(o,a,h){return!a||o!==h[a-1]})}}function _p(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=gp(e.difficulty.data,e.difficulty.characteristic==="360Degree"||e.difficulty.characteristic==="90Degree"?e.info.allDirectionsEnvironmentName:e.info.environmentName),i=[];if(t.defectID.length&&i.push(mt("Invalid event box group ID",t.defectID,e.settings.bpm,"error")),t.defectFilter.length&&i.push(mt("Invalid event box filter",t.defectFilter,e.settings.bpm,"error")),i.length){const n=document.createElement("div");i.forEach(r=>n.append(r)),So.output.html=n}else So.output.html=null}const Ha="Unlit Bomb",Ga="Check for lighting around bomb.",ja=!0,Co={name:Ha,description:Ga,type:"event",order:{input:pt.EVENTS_UNLIT_BOMB,output:gt.EVENTS_UNLIT_BOMB},input:{enabled:ja,params:{},html:_t.create(Ha,Ga,ja,function(){Co.input.enabled=this.checked})},output:{html:null},run:vp},bp=(e,t,i,n)=>{var d;if(!t.length)return[];const r=[],s=((d=gi[n])==null?void 0:d[0])??gi.DefaultEnvironment[0],l=t.filter(f=>f.isLightEvent(n)&&s.includes(f.type)).sort((f,c)=>f.type-c.type),o={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},a={};s.forEach(f=>a[f]=[[0,!1]]);const h=i.toBeatTime(1),u=i.toBeatTime(.25);for(let f=0,c=l.length;f<c;f++){const g=l[f];if((g.isOn()||g.isFlash())&&o[g.type].state!=="on"){o[g.type]={state:"on",time:g.time,fadeTime:0};const _=a[g.type].find(v=>v[0]>=g.time);_?(_[0]=g.time,_[1]=!0):a[g.type].push([g.time,!0])}if(g.isFade()){o[g.type]={state:"off",time:g.time,fadeTime:h};const _=a[g.type].find(v=>v[0]>=g.time);_?(_[0]=g.time,_[1]=!0):a[g.type].push([g.time,!0]),a[g.type].push([g.time+h,!1])}(((g==null?void 0:g.floatValue)??1)<.25||g.isOff()||g.customData._color&&(typeof g.customData._color[3]=="number"&&g.customData._color[3]<.25||Math.max(g.customData._color[0],g.customData._color[1],g.customData._color[2])<.25))&&o[g.type].state!=="off"&&(o[g.type]={state:"off",time:g.time,fadeTime:o[g.type].state==="on"?u:Math.min(u,o[g.type].fadeTime)},a[g.type].push([g.time+(o[g.type].state==="on"?u:Math.min(u,o[g.type].fadeTime)),!1]))}for(const f in a)a[f].reverse();for(let f=0,c=e.length,g=!1;f<c;f++){const _=e[f];g=!1;for(const v in a){const b=a[v].find(E=>E[0]<=_.time);b&&(g=g||b[1])}g||r.push(_)}return r.map(f=>f.time).filter(function(f,c,g){return!c||f!==g[c-1]})};function vp(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=bp(e.difficulty.data.bombNotes,e.difficulty.data.basicEvents,e.settings.bpm,e.info.environmentName);t.length?Co.output.html=mt("Unlit bomb",t,e.settings.bpm,"warning"):Co.output.html=null}const Xa=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:En,invalidEventBox:So,unlitBomb:Co},Symbol.toStringTag,{value:"Module"})),Uu="Hot Start",Vu="Check for first interactive object starting from start time.",Ju=!0,qu=1.5,ri=document.createElement("input");ri.id="input__tools-hot-start";ri.className="input-toggle input--small";ri.type="number";ri.min="0";ri.step="0.1";ri.value=qu.toString();ri.addEventListener("change",yp);const Ku=_t.create(Uu+" (s): ",Vu,Ju,function(){pi.input.enabled=this.checked});Ku.appendChild(ri);const pi={name:Uu,description:Vu,type:"other",order:{input:pt.OTHERS_HOT_START,output:gt.OTHERS_HOT_START},input:{enabled:Ju,params:{time:qu},html:Ku},output:{html:null},run:Ep};function yp(){pi.input.params.time=I(Math.abs(parseFloat(this.value)),3),this.value=pi.input.params.time.toString()}function Ep(e){if(!e.difficulty){console.error("Something went wrong!");return}const{time:t}=pi.input.params,i=e.settings.bpm.toRealTime(e.difficulty.data.getFirstInteractiveTime());i<t?pi.output.html=dt("Hot start",`${I(i,2)}s`,"warning"):pi.output.html=null}const za="Difficulty Label Check",Ya="For ranking purpose, check difficulty label to fit rankability criteria.",Ua=!0,To={name:za,description:Ya,type:"other",order:{input:pt.OTHERS_DIFFICULTY_LABEL,output:gt.OTHERS_DIFFICULTY_LABEL},input:{enabled:Ua,params:{},html:_t.create(za,Ya,Ua,function(){To.input.enabled=this.checked})},output:{html:null},run:Dp};function Dp(e){if(!e.difficulty){console.error("Something went wrong!");return}const t=e.difficulty.info.customData._difficultyLabel;t&&t.length>30?To.output.html=dt(`Difficulty label is too long (${t.length} characters)`,"exceeded 30 max characters by ranking criteria","rank"):To.output.html=null}const Va="NJS Check",Ja="Check note jump speed for suitable value.",qa=!0,Lo={name:Va,description:Ja,type:"other",order:{input:pt.OTHERS_NJS,output:gt.OTHERS_NJS},input:{enabled:qa,params:{},html:_t.create(Va,Ja,qa,function(){Lo.input.enabled=this.checked})},output:{html:null},run:wp};function wp(e){if(!e.difficulty){console.error("Something went wrong!");return}const{njs:t,bpm:i}=e.settings,n=[];if(e.difficulty.info.njs===0&&n.push(dt("Unset NJS","fallback NJS is used","error")),t.value>23&&n.push(dt(`NJS is too high (${I(t.value,2)})`,"use lower whenever necessary","warning")),t.value<3&&n.push(dt(`NJS is too low (${I(t.value,2)})`,"timing is less significant below this","warning")),t.jd>36&&n.push(dt("Very high jump distance",`${I(t.jd,2)}`,"warning")),t.jd<18&&n.push(dt("Very low jump distance",`${I(t.jd,2)}`,"warning")),t.jd>t.calcJdOptimal()[1]&&n.push(dt(`High jump distance warning (>${I(t.calcJdOptimal()[1],2)})`,"NJS & offset may be uncomfortable to play","warning")),i.toRealTime(t.hjd)<.42&&n.push(dt(`Very quick reaction time (${I(i.toRealTime(t.hjd)*1e3)}ms)`,"may lead to suboptimal gameplay","warning")),t.calcHjd(0)+t.offset<bi.HJD_MIN&&n.push(dt("Unnecessary negative offset",`will not drop below ${bi.HJD_MIN}`,"warning")),n.length){const r=document.createElement("div");n.forEach(s=>r.append(s)),Lo.output.html=r}else Lo.output.html=null}const Ka="Outside Playable Object",Za="Look for any object starting before and after song timer.",Qa=!0,xo={name:Ka,description:Za,type:"other",order:{input:pt.OTHERS_OUTSIDE_PLAYABLE,output:gt.OTHERS_OUTSIDE_PLAYABLE},input:{enabled:Qa,params:{},html:_t.create(Ka,Za,Qa,function(){xo.input.enabled=this.checked})},output:{html:null},run:Sp};function Sp(e){if(!e.difficulty){console.error("Something went wrong!");return}const{bpm:t,audioDuration:i}=e.settings,{colorNotes:n,bombNotes:r,obstacles:s,basicEvents:l,arcs:o,chains:a}=e.difficulty.data,h=[];if(i){let u=t.toBeatTime(i,!0);n.length&&n[0].time<0&&h.push(dt("Note(s) before start time",`${I(n[0].time,3)} (${Tt(t.toRealTime(n[0].time))}`,"error")),r.length&&r[0].time<0&&h.push(dt("Bomb(s) before start time",`${I(r[0].time,3)} (${Tt(t.toRealTime(r[0].time))}`,"error")),o.length&&o[0].time<0&&h.push(dt("Arc(s) before start time",`${I(o[0].time,3)} (${Tt(t.toRealTime(o[0].time))}`,"error")),a.length&&a[0].time<0&&h.push(dt("Chain(s) before start time",`${I(a[0].time,3)} (${Tt(t.toRealTime(a[0].time))}`,"error")),s.length&&s[0].time<0&&h.push(dt("Obstacle(s) before start time",`${I(s[0].time,3)} (${Tt(t.toRealTime(s[0].time))}`,"error")),l.length&&l[0].time<0&&h.push(dt("Event(s) before start time",`${I(l[0].time,3)} (${Tt(t.toRealTime(l[0].time))}`,"error")),n.length&&n[n.length-1].time>u&&h.push(dt("Note(s) after end time",`${I(n[n.length-1].time,3)} (${Tt(t.toRealTime(n[n.length-1].time))})`,"error")),r.length&&r[r.length-1].time>u&&h.push(dt("Bomb(s) after end time",`${I(r[r.length-1].time,3)} (${Tt(t.toRealTime(r[r.length-1].time))})`,"error")),o.length&&o[o.length-1].time>u&&h.push(dt("Arc(s) after end time",`${I(o[o.length-1].time,3)} (${Tt(t.toRealTime(o[o.length-1].time))})`,"error")),a.length&&a[a.length-1].time>u&&h.push(dt("Chain(s) after end time",`${I(a[a.length-1].time,3)} (${Tt(t.toRealTime(a[a.length-1].time))})`,"error")),s.length&&s[s.length-1].time>u&&h.push(dt("Obstacle(s) after end time",`${I(s[s.length-1].time,3)} (${Tt(t.toRealTime(s[s.length-1].time))})`,"error")),l.length&&l[l.length-1].time>u&&h.push(dt("Event(s) after end time",`${I(l[l.length-1].time,3)} (${Tt(t.toRealTime(l[l.length-1].time))})`,"error"))}if(h.length){const u=document.createElement("div");h.forEach(d=>u.append(d)),xo.output.html=u}else xo.output.html=null}const tl="Invalid Object",el="Validate beatmap object to be compatible with vanilla (ignores for modded).",il=!0,ko={name:tl,description:el,type:"other",order:{input:pt.OTHERS_INVALID_OBJECT,output:gt.OTHERS_INVALID_OBJECT},input:{enabled:il,params:{},html:_t.create(tl,el,il,function(){ko.input.enabled=this.checked})},output:{html:null},run:Cp};function Cp(e){var L,x;if(!e.difficulty){console.error("Something went wrong!");return}const{colorNotes:t,bombNotes:i,obstacles:n,basicEvents:r,arcs:s,chains:l,lightColorEventBoxGroups:o,lightRotationEventBoxGroups:a,lightTranslationEventBoxGroups:h}=e.difficulty.data;let u=[],d=[],f=[],c=[],g=[];(L=e.difficulty.info.customData._requirements)!=null&&L.includes("Mapping Extensions")||((x=e.difficulty.info.customData._requirements)!=null&&x.includes("Noodle Extensions")?(u=t.filter(k=>k.isMappingExtensions()).map(k=>k.time),d=n.filter(k=>k.isMappingExtensions()).map(k=>k.time),f=i.filter(k=>k.isMappingExtensions()).map(k=>k.time),c=s.filter(k=>k.isMappingExtensions()).map(k=>k.time),g=l.filter(k=>k.isMappingExtensions()).map(k=>k.time)):(u=t.filter(k=>!k.isValid()).map(k=>k.time),d=n.filter(k=>!k.isValid()).map(k=>k.time),f=i.filter(k=>!k.isValid()).map(k=>k.time),c=s.filter(k=>!k.isValid()).map(k=>k.time),g=l.filter(k=>!k.isValid()).map(k=>k.time)));const _=r.filter(k=>!k.isValid()).map(k=>k.time),v=o.filter(k=>!k.isValid()).map(k=>k.time),b=a.filter(k=>!k.isValid()).map(k=>k.time),E=h.filter(k=>!k.isValid()).map(k=>k.time),w=[];if(u.length&&w.push(mt("Invalid note",u,e.settings.bpm,"error")),f.length&&w.push(mt("Invalid bomb",f,e.settings.bpm,"error")),c.length&&w.push(mt("Invalid arc",c,e.settings.bpm,"error")),g.length&&w.push(mt("Invalid chain",g,e.settings.bpm,"error")),d.length&&w.push(mt("Invalid obstacle",d,e.settings.bpm,"error")),_.length&&w.push(mt("Invalid event",_,e.settings.bpm,"error")),v.length&&w.push(mt("Invalid light color event",v,e.settings.bpm,"error")),b.length&&w.push(mt("Invalid light rotation event",b,e.settings.bpm,"error")),E.length&&w.push(mt("Invalid light translation event",E,e.settings.bpm,"error")),w.length){const k=document.createElement("div");w.forEach(P=>k.append(P)),ko.output.html=k}else ko.output.html=null}const nl=Object.freeze(Object.defineProperty({__proto__:null,difficultyLabel:To,hotStart:pi,invalidObject:ko,njs:Lo,outsidePlayable:xo},Symbol.toStringTag,{value:"Module"})),Bt=class{constructor(){}};Bt.getNote=()=>Object.keys(ya).map(e=>ya[e]);Bt.getObstacle=()=>Object.keys(La).map(e=>La[e]);Bt.getEvent=()=>Object.keys(Xa).map(e=>Xa[e]);Bt.getOther=()=>Object.keys(nl).map(e=>nl[e]);Bt.getGeneral=()=>Object.keys(Ns).map(e=>Ns[e]);Bt.getDifficulty=()=>[...Bt.getNote(),...Bt.getObstacle(),...Bt.getEvent(),...Bt.getOther()];Bt.getAll=()=>[...Bt.getNote(),...Bt.getObstacle(),...Bt.getEvent(),...Bt.getOther(),...Bt.getGeneral()];let Zu=Bt;function di(e){return["analyzer",e]}const Qu=Zu.getAll().sort((e,t)=>e.order.input-t.order.input),th=[...Qu].sort((e,t)=>e.order.output-t.order.output);function eh(){lt.analysis={general:{html:null},map:[]}}function Tp(){var l;const e=lt.beatmapInfo;if(!e){J.tError(di("runGeneral"),"Could not analyse, missing map info");return}lt.analysis||eh();const t=(l=lt.analysis)==null?void 0:l.general,i=yi.create(e.beatsPerMinute),n=bi.create(i),r={bpm:i,njs:n,audioDuration:lt.duration??null,mapDuration:0};J.tInfo(di("runGeneral"),"Analysing general");const s=[];th.filter(o=>o.type==="general").forEach(o=>{if(o.input.enabled)try{o.run({settings:r,info:e}),o.output.html&&s.push(o.output.html)}catch(a){J.tError(di("runGeneral"),a)}}),t&&(t.html=s)}function ih(e,t){var a,h,u;const i=lt.beatmapInfo;if(!i){J.tError(di("runDifficulty"),"Could not analyse, missing map info");return}lt.analysis||eh();const n=(a=lt.beatmapDifficulty)==null?void 0:a.find(d=>d.characteristic===e&&d.difficulty===t);if(!n){J.tError(di("runDifficulty"),"Could not analyse, missing map data");return}const r=(h=lt.analysis)==null?void 0:h.map.find(d=>d.difficulty===t&&d.mode===e),s=bi.create(n.bpm,n.info.njs||bi.FallbackNJS[n.difficulty],n.info.njsOffset),l={bpm:n.bpm,njs:s,audioDuration:lt.duration??null,mapDuration:n.bpm.toRealTime(n.data.getLastInteractiveTime())};J.tInfo(di("runDifficulty"),`Analysing ${e} ${t}`);const o=[];th.filter(d=>d.type!=="general").forEach(d=>{if(d.input.enabled)try{d.run({settings:l,difficulty:n,info:i}),d.output.html&&o.push(d.output.html)}catch(f){J.tError(di("runDifficulty"),f)}}),r?r.html=o:(u=lt.analysis)==null||u.map.push({mode:e,difficulty:t,html:o})}function Lp(e){Zu.getDifficulty().sort((i,n)=>i.order.output-n.order.output).forEach(i=>{i.input.adjustTime&&i.input.adjustTime(e)})}function xp(){var e;(e=lt.beatmapDifficulty)==null||e.forEach(t=>ih(t.characteristic,t.difficulty))}const vi={toolListInput:Qu,runGeneral:Tp,runDifficulty:ih,adjustTime:Lp,applyAll:xp},xn="UI Tools: ",ze=document.querySelectorAll(".tools__select-mode"),Ye=document.querySelectorAll(".tools__select-difficulty"),kp=document.querySelectorAll(".difficulty__label"),Rp=document.querySelector(".tools__note-content"),Bp=document.querySelector(".tools__obstacle-content"),Np=document.querySelector(".tools__event-content"),Ap=document.querySelector(".tools__other-content"),Ip=document.querySelector(".tools__general-content"),Fe=document.querySelector(".tools__output-diff"),We=document.querySelector(".tools__output-general"),Op=document.querySelector(".tools__apply-this"),$p=document.querySelector(".tools__apply-all"),Pp=document.querySelector(".tools__apply-general");Op.addEventListener("click",Xp);$p.addEventListener("click",zp);Pp.addEventListener("click",Yp);ze.forEach(e=>e.addEventListener("change",Gp));Ye.forEach(e=>e.addEventListener("change",jp));function nh(){var t;const e=(t=lt.analysis)==null?void 0:t.general;if(!e){We.textContent="ERROR: could not find analysis for general";return}if(!e.html){We.textContent="ERROR: could not find HTML for general";return}We.innerHTML="",e.html.forEach(i=>We.appendChild(i)),We.firstChild||(We.textContent="No issues found.")}function kn(e,t){var n;if(!e&&!t&&(e=ze[0].value,t=Ye[0].value),!e||!t)throw new Error(xn+"something went wrong!");Fe.innerHTML="";const i=(n=lt.analysis)==null?void 0:n.map.find(r=>r.difficulty===t&&r.mode===e);if(!i){Fe.textContent="ERROR: could not find analysis for "+e+" "+t;return}if(!i.html){Fe.textContent="ERROR: could not find HTML for "+e+" "+t;return}i.html.forEach(r=>Fe.appendChild(r)),Fe.firstChild||(Fe.textContent="No issues found.")}function Mo(e){kp.forEach(t=>t.textContent=e)}function oh(e){if(!e)return;Ye.forEach(i=>{for(let n=i.options.length-1;n>=0;n--)i.remove(n)});let t=!0;for(let i=e.difficulties.length-1;i>=0;i--){const n=e.difficulties[i];Ye.forEach(r=>{const s=document.createElement("option");if(s.value=n.difficulty,s.textContent=ye[n.difficulty]+(n.customData._difficultyLabel?" -- "+n.customData._difficultyLabel:""),t){const l=lt.beatmapDifficulty.find(o=>o.difficulty===n.difficulty&&o.characteristic===e.characteristic);if(!l)throw new Error("missing _mapSetData");Vl(lt.beatmapInfo,l),Mo(n.customData._difficultyLabel||ye[n.difficulty]),kn(e.characteristic,n.difficulty)}t=!1,r.add(s)})}}function rh(e){if(!e){ze.forEach(i=>er(i)),Ye.forEach(i=>er(i));return}let t=!0;e.difficultySets.forEach(i=>{ze.forEach(n=>{const r=document.createElement("option");r.value=i.characteristic,r.textContent=Jc[i.characteristic],i.customData._characteristicLabel&&(r.textContent+=` -- ${i.customData._characteristicLabel}`),n.add(r)}),t&&oh(i),t=!1})}function Mp(){const e=lt.beatmapInfo;if(!e)throw new Error(xn+"could not find map info");const t=yi.create(e.beatsPerMinute);vi.adjustTime(t)}function Fp(){vi.toolListInput.forEach(e=>{if(e.input.html)switch(e.type){case"note":{Rp.appendChild(e.input.html);break}case"obstacle":{Bp.appendChild(e.input.html);break}case"event":{Np.appendChild(e.input.html);break}case"other":{Ap.appendChild(e.input.html);break}case"general":{Ip.appendChild(e.input.html);break}default:console.error(xn+"could not recognise type "+e.type+" for "+e.name)}})}function Wp(){We&&(We.innerHTML="No output."),Fe&&(Fe.innerHTML="No output.")}function Hp(){Wp(),Mo("Difficulty Label"),rh()}function Gp(e){var n;const t=e.target;ze.forEach(r=>{r!==t&&(r.value=t.value)});const i=(n=lt.beatmapInfo)==null?void 0:n.difficultySets.find(r=>r.characteristic===t.value);oh(i)}function jp(e){var r,s;const t=e.target;Ye.forEach(l=>{l!==t&&(l.value=t.value)});const i=(r=lt.beatmapInfo)==null?void 0:r.difficultySets.find(l=>l.characteristic===ze.item(0).value);if(!i)throw new Error("aaaaaaaaaaaaaaaaaaa");const n=(s=lt.beatmapDifficulty)==null?void 0:s.find(l=>l.difficulty===t.value&&l.characteristic===i.characteristic);n&&(Vl(lt.beatmapInfo,n),Mo(n.info.customData._difficultyLabel||ye[t.value]),kn(n.characteristic,n.difficulty))}function Xp(){const e=ze[0].value,t=Ye[0].value;if(!e||!t)throw new Error(xn+"mode/difficulty does not exist");Dt.status("info",`Re-analysing ${e} ${t}`,100),vi.runDifficulty(e,t),Dt.status("info",`Re-analysed ${e} ${t}`,100),kn(e,t)}function zp(){const e=ze[0].value,t=Ye[0].value;if(!e||!t)throw new Error(xn+"mode/difficulty does not exist");Dt.status("info","Re-analysing all difficulties",100),vi.applyAll(),Dt.status("info","Re-analysed all difficulties",100),kn(e,t)}function Yp(){Dt.status("info","Re-analysing all difficulties",100),vi.runGeneral(),Dt.status("info","Re-analysed all difficulties",100),nh()}const Wi={displayOutputGeneral:nh,displayOutputDifficulty:kn,setDifficultyLabel:Mo,adjustTime:Mp,populateSelect:rh,populateTool:Fp,reset:Hp},Ro="UI Stats: ",T="stats__";function Up(e,t){const i=t.bpm,n=lt.duration||0,r=i.toRealTime(t.data.getLastInteractiveTime()),s=document.createElement("table");return s.className=T+"table",s.innerHTML=`<caption class="${T}table-caption">Note Per Seconds (NPS):</caption><tr><th class="${T}table-header" colspan="2">Overall</th><td class="${T}table-element">${I(t.data.nps(n),2)}</td></tr><tr><th class="${T}table-header" colspan="2">Mapped</th><td class="${T}table-element">${I(t.data.nps(r),2)}</td></tr><tr><th class="${T}table-header" rowspan="3">Peak</th><th class="${T}table-header">16-beat</th><td class="${T}table-element">${I(t.data.peak(16,i.value),2)}</td></tr><tr><th class="${T}table-header">8-beat</th><td class="${T}table-element">${I(t.data.peak(8,i.value),2)}</td></tr><tr><th class="${T}table-header">4-beat</th><td class="${T}table-element">${I(t.data.peak(4,i.value),2)}</td></tr>`,s}function Vp(e,t){const i=yi.create(e.beatsPerMinute),n=bi.create(i,t.info.njs||bi.FallbackNJS[t.difficulty],t.info.njsOffset),r=document.createElement("table");return r.className=T+"table",r.innerHTML=`<caption class="${T}table-caption">Map Settings:</caption><tr><th class="${T}table-header" colspan="2">Note Jump Speed</th><td class="${T}table-element">${I(n.value,3)}</td></tr><tr><th class="${T}table-header" colspan="2">Spawn Distance Modifier</th><td class="${T}table-element">${I(n.offset,3)}</td></tr><tr><th class="${T}table-header" colspan="2">Half Jump Duration</th><td class="${T}table-element">${I(n.hjd,3)}</td></tr><tr><th class="${T}table-header" colspan="2">Jump Distance</th><td class="${T}table-element">${I(n.jd,3)}</td></tr><tr><th class="${T}table-header" colspan="2">Reaction Time</th><td class="${T}table-element">${I(n.reactionTime*1e3)}ms</td></tr>`,r}function Jp(e,t){const i=t.swingAnalysis,n=document.createElement("table");return n.className=T+"table",n.innerHTML=`<caption class="${T}table-caption">Swing Per Seconds (SPS):</caption><tr><th class="${T}table-header"></th><th class="${T}table-header">Total</th><th class="${T}table-header">Red</th><th class="${T}table-header">Blue</th></tr><tr><th class="${T}table-header">Average</th><td class="${T}table-element">${I(i.total.average,2)}</td><td class="${T}table-element">${I(i.red.average,2)}</td><td class="${T}table-element">${I(i.blue.average,2)}</td></tr><tr><th class="${T}table-header">Median</th><td class="${T}table-element">${I(i.total.median,2)}</td><td class="${T}table-element">${I(i.red.median,2)}</td><td class="${T}table-element">${I(i.blue.median,2)}</td></tr><tr><th class="${T}table-header">Peak</th><td class="${T}table-element">${I(i.total.peak,2)}</td><td class="${T}table-element">${I(i.red.peak,2)}</td><td class="${T}table-element">${I(i.blue.peak,2)}</td></tr><tr><th class="${T}table-header">Total</th><td class="${T}table-element">${i.total.total}</td><td class="${T}table-element">${i.red.total}</td><td class="${T}table-element">${i.blue.total}</td></tr>`,n}function no(e){const t={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let i=e.length-1;i>=0;i--)e[i].color===0?(t.red.total++,e[i].isChroma()&&t.red.chroma++,e[i].isNoodleExtensions()&&t.red.noodleExtensions++,e[i].isMappingExtensions()&&t.red.mappingExtensions++):e[i].color===1&&(t.blue.total++,e[i].isChroma()&&t.blue.chroma++,e[i].isNoodleExtensions()&&t.blue.noodleExtensions++,e[i].isMappingExtensions()&&t.blue.mappingExtensions++);return t}function qp(e){const t={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=e.length-1;i>=0;i--)t.total++,e[i].isChroma()&&t.chroma++,e[i].isNoodleExtensions()&&t.noodleExtensions++,e[i].isMappingExtensions()&&t.mappingExtensions++;return t}function zn(e,t){return e.filter(i=>i.data.posX===t).length}function Kp(e,t){return e.filter(i=>i.data.posY===t).length}function Zp(e,t,i){return e.filter(n=>n.data.posX===t&&n.data.posY===i).length}function Qp(e,t){return e.filter(i=>i.type!=="bomb"&&i.data.direction===t).length}function sh(e,t){switch(t){case"note":return e.filter(i=>i.type==="note");case"red":return e.filter(i=>i.type==="note"&&i.data.color===0);case"blue":return e.filter(i=>i.type==="note"&&i.data.color===1);case"arc":return e.filter(i=>i.type==="arc");case"redArc":return e.filter(i=>i.type==="arc"&&i.data.color===0);case"blueArc":return e.filter(i=>i.type==="arc"&&i.data.color===1);case"chain":return e.filter(i=>i.type==="chain");case"redChain":return e.filter(i=>i.type==="chain"&&i.data.color===0);case"blueChain":return e.filter(i=>i.type==="chain"&&i.data.color===1);case"bomb":return e.filter(i=>i.type==="bomb");default:return e}}function t0(e){var a;const t=e.target,i=t.id.replace(`${T}table-select-angle-`,"").split("-"),n=i[0],r=i[1],s=(a=lt.beatmapDifficulty.find(h=>h.characteristic===n&&h.difficulty===r))==null?void 0:a.noteContainer;if(!s){console.error(Ro+"note could not be found");return}const l=sh(s,t.value),o=document.querySelector(`#${T}table-angle-${n}-${r}`);o.innerHTML=ah(l)}function ah(e){const t=e.length||1,i=[4,0,5,2,8,3,6,1,7];let n="";for(let r=0;r<3;r++){n+="<tr>";for(let s=0;s<3;s++){let l=Qp(e,i[r*3+s]);n+=`<td class="${T}table-element">${l}<br>(${I(l/t*100,1)}%)</td>`}n+="</tr>"}return n}function e0(e,t){var s;const i=Ln.create(`${T}table-select-angle-${t.characteristic}-${t.difficulty}`,"Note Angle: ","caption",`${T}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"});(s=i.querySelector("select"))==null||s.addEventListener("change",t0);let n=`<tbody id="${T}table-angle-${t.characteristic}-${t.difficulty}">${ah(t.noteContainer)}</tbody>`;const r=document.createElement("table");return r.className=T+"table",r.innerHTML=n,r.prepend(i),r}function i0(e,t,i="DefaultEnvironment"){var s;const n=((s=gi[i])==null?void 0:s[0])??gi.DefaultEnvironment[0],r={};for(let l=n.length-1;l>=0;l--)r[n[l]]={total:0,chroma:0,chromaOld:0};r[5]={total:t.length,chroma:0,chromaOld:0};for(let l=e.length-1;l>=0;l--)e[l].isValidType()&&(r[e[l].type]||(r[e[l].type]={total:0,chroma:0,chromaOld:0}),r[e[l].type].total++,e[l].isChroma()&&r[e[l].type].chroma++,e[l].isOldChroma()&&r[e[l].type].chromaOld++);return r}function Yn(e,t="DefaultEnvironment"){var r;const i=((r=gi[t])==null?void 0:r[1])??gi.DefaultEnvironment[1],n={};for(let s=i.length-1;s>=0;s--)n[i[s]]={groups:0,boxes:0,bases:0};for(let s=e.length-1;s>=0;s--)n[e[s].id]||(n[e[s].id]={groups:0,boxes:0,bases:0}),n[e[s].id].groups++,n[e[s].id].boxes+=e[s].boxes.length,n[e[s].id].bases+=e[s].boxes.reduce((l,o)=>l+o.events.length,0);return n}function n0(e){const t={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=e.length-1;i>-1;i--)t.total++,e[i].isInteractive()&&t.interactive++,e[i].isChroma()&&t.chroma++,e[i].isNoodleExtensions()&&t.noodleExtensions++,e[i].isMappingExtensions()&&t.mappingExtensions++;return t}const o0={0:"Back Lasers",1:"Ring Lights",2:"Left Lasers",3:"Right Lasers",4:"Center Lights",5:"Boost Colors",6:"Extra Left Lights",7:"Extra Right Lights",8:"Ring Rotation",9:"Ring Zoom",10:"Extra Left Lasers",11:"Extra Right Lasers",12:"Left Laser Speed",13:"Right Laser Speed",14:"Early Lane Rotation",15:"Late Lane Rotation",16:"Utility Event 1",17:"Utility Event 2",18:"Utility Event 3",19:"Utility Event 4",40:"Special Event 1",41:"Special Event 2",42:"Special Event 3",43:"Special Event 4"},r0={LinkinParkEnvironment:{0:"Lane Light",1:"Ceiling Lights",8:"Laser Mode"},BTSEnvironment:{0:"Door Light",1:"Vertical Pillar Lights",8:"Distant Tower Spin",9:"Raise/Lower Pillars",40:"BTS Event 1",41:"BTS Event 2",42:"BTS Event 3",43:"BTS Event 4"},KaleidoscopeEnvironment:{0:"Spike Tip Lights",1:"Spike Mid Lights",2:"Spike Left Lights",3:"Spike Right Lights",4:"Distant Lasers and Spike Top Lights"},InterscopeEnvironment:{0:"Gate 1",1:"Gate 2",2:"Gate 3",3:"Gate 4",4:"Gate 5",6:"Extra 1",7:"Extra 2"},SkrillexEnvironment:{0:"Logo",1:"Top Lanes and 1st Ring Set",4:"Bottom Lanes and 2nd Ring Set",6:"Left Panel",7:"Right Panel",12:"Left Laser & Panel Speed",13:"Right Laser & Panel Speed"},BillieEnvironment:{0:"Water 4",1:"Water 1",2:"Left Sun Beams",3:"Right Sun Beams",4:"Sun",6:"Water 2",7:"Water 3",8:"Toggle Rain",9:"Sunbeam Mode",10:"Left Bottom Lasers",11:"Right Bottom Lasers",12:"Left Sun Beams Speed",13:"Right Sun Beams Speed"},HalloweenEnvironment:{0:"Sky Lasers",1:"Moon",4:"Lane + Castle Interior"},GagaEnvironment:{0:"Aurora 1",1:"Aurora 2",2:"Tower 1",3:"Tower 2",4:"Logo",6:"Tower 3",7:"Tower 4",10:"Tower 5",11:"Tower 6",14:"Tower 1 Height",15:"Tower 2 Height",16:"Tower 3 Height",17:"Tower 4 Height",18:"Tower 5 Height",19:"Tower 6 Height"},WeaveEnvironment:{4:"Player Space"},PyroEnvironment:{0:"Video Alpha",1:"Logo",2:"Left Projectors",3:"Right Projectors",4:"Platform",6:"Ambient",40:"Video Projection"},EDMEnvironment:{0:"Lane Lights Bottom",1:"Lane Lights Top",4:"Player Space & Spectrogram"},TheSecondEnvironment:{0:"Logo",1:"Runway",2:"Left Flags",3:"Right Flags",4:"Buildings"},LizzoEnvironment:{0:"Runway Left",1:"Runway Right",2:"Left Ring",3:"Right Ring",4:"Top Square",6:"Ambient",7:"Cherry Left",8:"Cherry Right",9:"LI Sign",10:"Z Left Sign",11:"Z Right Sign",12:"O Sign",16:"Left Balloon Particles",17:"Right Balloon Particles"},TheWeekndEnvironment:{0:"Runway Left",1:"Runway Right",6:"Ambient"},RockMixtapeEnvironment:{3:"BG Bloom",4:"Aurora",6:"Ambient"},Dragons2Environment:{0:"Inner Laser Left",1:"Inner Laser Right",2:"Outer Laser Left",3:"Outer Laser Right",4:"Logo",6:"Ambient"},Panic2Environment:{3:"Ambient"},QueenEnvironment:{6:"Ambient",40:"Silhouettes"},LinkinPark2Environment:{3:"Ambient",40:"Logos",41:"Floor Logos"},TheRollingStonesEnvironment:{6:"Ambient",40:"Logo"}};function s0(e,t){var i;return((i=r0[t])==null?void 0:i[e])||o0[e]||"Unknown"}const a0={WeaveEnvironment:{0:"Outer Square Bottom Left Laser",1:"Outer Square Bottom Right Laser",2:"Outer Square Top Left Laser",3:"Outer Square Top Right Laser",4:"Inner Square Bottom Left Laser",5:"Inner Square Bottom Right Laser",6:"Inner Square Top Left Laser",7:"Inner Square Top Right Laser",8:"Side Square Bottom Left Laser",9:"Side Square Bottom Right Laser",10:"Side Square Top Left Laser",11:"Side Square Top Right Laser",12:"Distant Square Top Laser",13:"Distant Square Bottom Laser",14:"Distant Square Left Laser",15:"Distant Square Right Laser"},PyroEnvironment:{0:"Stage Left Platform",1:"Stage Right Platform",2:"Top Stage Left Laser",3:"Top Stage Right Laser",4:"Top Stage Middle Laser",5:"Top Stage Light",6:"Side Panels Left Tower",7:"Side Panels Right Tower",8:"Stage Left Laser",9:"Stage Right Laser",10:"Side Panels Left Laser",11:"Side Panels Right Laser",12:"Fire Left",13:"Fire Right"},EDMEnvironment:{0:"Circles Top",1:"Circles Close",2:"Circles Distant",3:"Circles Distant 2",4:"Single Source Circles Left",5:"Single Source Circles Right",6:"Single Source Lasers Left (Up)",7:"Single Source Lasers Left (Out)",8:"Single Source Lasers Right (Up)",9:"Single Source Lasers Right (Out)",10:"Single Source Lasers Left (Down)",11:"Single Source Lasers Right (Down)",12:"Single Source Lasers Left (Down) / Circle Rotations Top",13:"Single Source Lasers Right (Up) / Circle Rotations Close",14:"Circle Rotations Distant",15:"Circle Rotations Distant 2",16:"Circle Rotations Single Source Left",17:"Circle Rotations Single Source Right"},TheSecondEnvironment:{0:"Rings Big",1:"Rings Small",2:"Runway Left",3:"Runway Right",4:"Spotlight Left",5:"Spotlight Right",6:"Top Lasers Left Bottom",7:"Top Lasers Right Bottom",8:"Top Lasers Left Top",9:"Top Lasers Right Top",10:"Bottom Lasers Left Bottom",11:"Bottom Lasers Right Bottom",12:"Bottom Lasers Left Top",13:"Bottom Lasers Right Top"},LizzoEnvironment:{0:"Main Floor",1:"Rainbow Arcs Inner",2:"Rainbow Arcs 2",3:"Rainbow Arcs 3",4:"Rainbow Arcs 4",5:"Rainbow Arcs Outer",6:"Rainbow Rings Left",7:"Rainbow Rings Right",8:"Rainbow Rings Lasers Left",9:"Rainbow Rings Lasers Right",10:"Main Top Lasers",11:"Environment Stands Left",12:"Environment Stands Right",13:"Environment Clouds Left",14:"Environment Clouds Right",15:"Main Left Lasers",16:"Main Right Lasers",17:"Environment Stand Lasers Left",18:"Environment Stand Lasers Right",19:"Rainbow Arcs Laser"},TheWeekndEnvironment:{0:"Lamps Poles Left",1:"Lamps Poles Right",2:"Lamps Rings Left",3:"Lamps Rings Right",4:"Environment Arrows",5:"Environment Side Lasers Left",6:"Environment Side Lasers Right",7:"Environment Runway Lane",8:"Environment Center Ring",9:"Environment Center Ring Lasers",10:"Windows Left 1 Front",11:"Windows Left 1 Side",12:"Windows Left 2 Side",13:"Windows Left 3 Front",14:"Windows Left 3 Side",15:"Windows Right 1 Front",16:"Windows Right 1 Side",17:"Windows Right 2 Side",18:"Windows Right 3 Front",19:"Windows Right 3 Side",20:"Buildings Left",21:"Buildings Right",22:"Buildings Roof Left",23:"Buildings Roof Right",29:"Lamp Rings Left 1",30:"Lamp Rings Left 2",31:"Lamp Rings Left 3",32:"Lamp Rings Left 4",33:"Lamp Rings Right 1",34:"Lamp Rings Right 2",35:"Lamp Rings Right 3",36:"Lamp Rings Right 4",37:"Buildings Background Left",38:"Buildings Background Right",40:"Buildings Side Buildings"},RockMixtapeEnvironment:{0:"Lasers Far Left",1:"Lasers Far Right",2:"Mountain 1",3:"Mountain 2",4:"Mountain 3",5:"Mountain 4",6:"Mountain 5",7:"Mountain 6",8:"Mountain 7",9:"Mountain 8",10:"Mountain 9",11:"Mountain 10",12:"Mountain 11",13:"Mountain 12",14:"Face Eyes",15:"Runway Frets",16:"Runway Strings",17:"Runway Tunnel",18:"Lasers Side Left",19:"Lasers Side Right",20:"Lasers Side Left Rotation",21:"Lasers Side Right Rotation",22:"Face Left",23:"Face Right",24:"Spikes Left",25:"Spikes Left Movement",26:"Spikes Right",27:"Spikes Right Movement",28:"Runway Dots",29:"Face Movement",30:"Runway Equilizer",31:"Screens Left 1",32:"Screens Left 2",33:"Screens Right 1",34:"Screens Right 2",35:"Screens Left Movement",36:"Screens Right Movement",37:"Lasers Side Z Translation"},Dragons2Environment:{0:"Small Rings (R/T)",1:"Small Rings (Colors)",2:"Underground",3:"Big Rings",4:"Top Spotlights",5:"Runway Left",6:"Runway Right",7:"Particles Left",8:"Particles Right",9:"Main Lasers Bottom Left",10:"Main Lasers Top Left",11:"Main Lasers Top Right",12:"Main Lasers Bottom Right"},Panic2Environment:{0:"Left Cones Local",1:"Right Cones Local",2:"Left Cones Global",3:"Right Cones Global",4:"Center Cones Local",5:"Center Cones Global",6:"Diamond Rings Local Left",7:"Diamond Rings Local Right",8:"Diamond Rings Global",9:"Lasers Bottom Left",10:"Lasers Bottom Right",11:"Lasers Top Left",12:"Lasers Top Right",13:"Runway Lasers Left",14:"Runway Lasers Right",15:"Runway Inner Laser",16:"Spectrogram Left",17:"Spectrogram Right",18:"Runway Lasers Left Transform Z",19:"Runway Lasers Right Transform Z",20:"Window Left Pirces",21:"Window Left Aura",22:"Window Right Pieces",23:"Window Right Aura"},QueenEnvironment:{0:"Vinyls Left",1:"Vinyl Left 1",2:"Vinyl Left 2",3:"Vinyl Left 3",4:"Vinyl Left 4",5:"Vinyls Right",6:"Vinyl Right 1",7:"Vinyl Right 2",8:"Vinyl Right 3",9:"Vinyl Right 4",10:"Tunnel Rings Wrapper",11:"Distant Circular Lasers Z",12:"Distant Circular Lasers",13:"Top Circular Lasers Rot Y",14:"Top Circular Lasers",15:"Platform Lane Left",16:"Platform Lane Right",17:"Silhouette Contour"},LinkinPark2Environment:{0:"Circular Lasers Global Distant",1:"Circular Lasers Local Distant",2:"Circular Lasers Global Close",3:"Circular Lasers Local Close",4:"Tunnels Rings",5:"Big Arcs Local",6:"Laser Beams Local Left",7:"Laser Beams Local Right",8:"Floor Lasers Left",9:"Floor Lasers Right",10:"Tunnels Lights",11:"Logo",12:"Big Arcs Global",13:"Spectrograms Floor Left",14:"Spectrograms Floor Right",15:"Spectrograms Tunnel Left",16:"Spectrograms Tunnel Right",17:"Laser Beams Global Left",18:"Laser Beams Global Right"},TheRollingStonesEnvironment:{0:"Cube Local Left",1:"Cube Local Right",2:"Columns Left 01",3:"Columns Left 02",4:"Columns Left 03",5:"Columns Left 04",6:"Columns Right 01",7:"Columns Right 02",8:"Columns Right 03",9:"Columns Right 04",10:"Floor Blocks Left",11:"Floor Blocks Right",12:"Heart Local Left",13:"Heart Local Right",14:"Lasers Left 01",15:"Lasers Left 02",16:"Lasers Left 03",17:"Lasers Left 04",18:"Lasers Right 01",19:"Lasers Right 02",20:"Lasers Right 03",21:"Lasers Right 04",22:"Columns Lasers 01",23:"Columns Lasers 02",24:"Lasers Left Sphere",25:"Lasers Right Sphere",26:"Cube Global",27:"Heart Global",28:"Logo Local",29:"Logo Global",30:"Splinters",31:"Cube Rot Z Left",32:"Cube Rot Z Right",33:"Heart Rot Z Left",34:"Heart Rot Z Right",35:"Floor Side Laser Left",36:"Floor Side Laser Right",37:"Cube Lasers",38:"Splinters Global Translation",39:"Floor Below Block",40:"Floor Inner Light Left",41:"Floor Inner Light Right",42:"Logo Iridescence",43:"Logo Color",44:"Floor Side Laser Bottom Left",45:"Floor Side Laser Bottom Right"}};function l0(e,t){var i;return((i=a0[t])==null?void 0:i[e])||"Unknown"}function c0(e,t){const i=t.characteristic==="360Degree"||t.characteristic==="90Degree"?e.allDirectionsEnvironmentName:e.environmentName,n=i0(t.data.basicEvents,t.data.colorBoostEvents,i);let r=0,s=0,l=`<caption class="${T}table-caption">Events: ${Object.values(n).reduce((a,{total:h})=>a+h,0)}</caption>`;for(const a in n)r+=n[a].chroma,s+=n[a].chromaOld,l+=`<tr><th class="${T}table-header">${a}</th><th class="${T}table-header" colspan="4">${s0(parseInt(a),i)}</th><td class="${T}table-element">${n[a].total}</td></tr>`;r&&(l+=`<tr><th class="${T}table-header" colspan="5">Chroma</th><td class="${T}table-element">${r}</td></tr>`),s&&(l+=`<tr><th class="${T}table-header" colspan="5">OG Chroma</th><td class="${T}table-element">${s}</td></tr>`);const o=document.createElement("table");return o.className=T+"table",o.innerHTML=l,o}function u0(...e){for(const t of e)for(const i in t)for(const n of e)n[i]||(n[i]={groups:0,boxes:0,bases:0})}function h0(e,t){const i=t.characteristic==="360Degree"||t.characteristic==="90Degree"?e.allDirectionsEnvironmentName:e.environmentName,n=Yn(t.data.lightColorEventBoxGroups,i),r=Yn(t.data.lightRotationEventBoxGroups,i),s=Yn(t.data.lightTranslationEventBoxGroups,i),l=Yn(t.data.fxEventBoxGroups,i);u0(n,r,s,l);let o=`<caption class="${T}table-caption">Event Box Group:</caption><tr><th class="${T}table-header"></th><th class="${T}table-header">Group</th><th class="${T}table-header">Box</th><th class="${T}table-header">Base</th><tr><th class="${T}table-header">Color</th><td class="${T}table-element">${Object.values(n).reduce((f,{groups:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(n).reduce((f,{boxes:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(n).reduce((f,{bases:c})=>f+c,0)}</td></tr><tr><th class="${T}table-header">Rotate</th><td class="${T}table-element">${Object.values(r).reduce((f,{groups:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(r).reduce((f,{boxes:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(r).reduce((f,{bases:c})=>f+c,0)}</td></tr><tr><th class="${T}table-header">Translate</th><td class="${T}table-element">${Object.values(s).reduce((f,{groups:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(s).reduce((f,{boxes:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(s).reduce((f,{bases:c})=>f+c,0)}</td></tr><tr><th class="${T}table-header">FX</th><td class="${T}table-element">${Object.values(l).reduce((f,{groups:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(l).reduce((f,{boxes:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(l).reduce((f,{bases:c})=>f+c,0)}</td></tr><tr><th class="${T}table-header">Total</th><td class="${T}table-element">${Object.values(n).reduce((f,{groups:c})=>f+c,0)+Object.values(r).reduce((f,{groups:c})=>f+c,0)+Object.values(s).reduce((f,{groups:c})=>f+c,0)+Object.values(l).reduce((f,{groups:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(n).reduce((f,{boxes:c})=>f+c,0)+Object.values(r).reduce((f,{boxes:c})=>f+c,0)+Object.values(s).reduce((f,{boxes:c})=>f+c,0)+Object.values(l).reduce((f,{boxes:c})=>f+c,0)}</td><td class="${T}table-element">${Object.values(n).reduce((f,{bases:c})=>f+c,0)+Object.values(r).reduce((f,{bases:c})=>f+c,0)+Object.values(s).reduce((f,{bases:c})=>f+c,0)+Object.values(l).reduce((f,{bases:c})=>f+c,0)}</td></tr>`,a=`<caption class="${T}table-caption">Event Box Group ID:</caption>`;for(const f in n)a+=`<tr><th class="${T}table-header">${f}</th><th class="${T}table-header" colspan="5">${l0(parseInt(f),i)}</th><td class="${T}table-element" title="${n[f].groups} Box (${n[f].bases} Base)">${n[f].groups}</td><td class="${T}table-element" title="${r[f].boxes} Box (${r[f].bases} Base)">${r[f].groups}</td><td class="${T}table-element" title="${s[f].boxes} Box (${s[f].bases} Base)">${s[f].groups}</td><td class="${T}table-element" title="${l[f].groups} Box (${l[f].bases} Base)">${l[f].groups}</td></tr>`;const h=document.createElement("table");h.className=T+"table",h.innerHTML=o;const u=document.createElement("table");u.className=T+"table",u.innerHTML=a;const d=document.createElement("div");return d.appendChild(h),d.appendChild(document.createElement("br")),d.appendChild(u),d}const f0=115;function m0(e){let t=0,i=1;for(let n=0,r=e.filter(s=>s.type==="note"&&!(typeof s.data.customData.uninteractable<"u"||!s.data.customData.uninteractable)).length;n<r;n++)i<8&&n===-3+i*4&&(i*=2),t+=f0*i;return t}function d0(e,t){const i=no(t.data.colorNotes);let n=`<caption class="${T}table-caption">Note Information:</caption><tr><th class="${T}table-header" colspan="2">R/B Ratio</th><td class="${T}table-element">${I(i.red.total/i.blue.total,2)}</td></tr><tr><th class="${T}table-header" colspan="2">Max Score</th><td class="${T}table-element">${wh(m0(t.noteContainer))}</td></tr><tr><th class="${T}table-header" colspan="2">Effective BPM</th><td class="${T}table-element">${I(nf(t.swingAnalysis.container),2)}</td></tr><tr><th class="${T}table-header" colspan="2">Effective BPM (swing)</th><td class="${T}table-element">${I(of(t.swingAnalysis.container),2)}</td></tr>`,r=I(ff(t.swingAnalysis.container)*1e3,1),s=I(mf(t.swingAnalysis.container)*1e3,1);r&&s&&(n+=`<tr><th class="${T}table-header" colspan="2">Min. Slider Speed</th><td class="${T}table-element">${r}ms</td></tr><tr><th class="${T}table-header" colspan="2">Max. Slider Speed</th><td class="${T}table-element">${s}ms</td></tr>`);const l=document.createElement("table");return l.className=T+"table",l.innerHTML=n,l}function p0(e,t){const i=no(t.data.colorNotes),n=no(t.data.arcs),r=no(t.data.chains),s=qp(t.data.bombNotes);let l=`<caption class="${T}table-caption">Note Count:</caption><tr><th class="${T}table-header"></th><th class="${T}table-header">Note</th><th class="${T}table-header">Arc</th><th class="${T}table-header">Chain</th><th class="${T}table-header">Bomb</th></tr><tr><th class="${T}table-header">Total</th><td class="${T}table-element">${i.red.total+i.blue.total}</td><td class="${T}table-element">${n.red.total+n.blue.total}</td><td class="${T}table-element">${r.red.total+r.blue.total}</td><td class="${T}table-element">${s.total}</td></tr><tr><th class="${T}table-header">Red</th><td class="${T}table-element">${i.red.total}</td><td class="${T}table-element">${n.red.total}</td><td class="${T}table-element">${r.red.total}</td><td class="${T}table-element">0</td></tr><tr><th class="${T}table-header">Blue</th><td class="${T}table-element">${i.blue.total}</td><td class="${T}table-element">${n.blue.total}</td><td class="${T}table-element">${r.blue.total}</td><td class="${T}table-element">0</td></tr>`;(i.red.chroma||i.blue.chroma||n.red.chroma||n.blue.chroma||r.red.chroma||r.blue.chroma||s.chroma)&&(l+=`<tr><th class="${T}table-header">Chroma</th><td class="${T}table-element">${i.red.chroma+i.blue.chroma}</td><td class="${T}table-element">${n.red.chroma+n.blue.chroma}</td><td class="${T}table-element">${r.red.chroma+r.blue.chroma}</td><td class="${T}table-element">${s.chroma}</td></tr>`),(i.red.noodleExtensions||i.blue.noodleExtensions||n.red.noodleExtensions||n.blue.noodleExtensions||r.red.noodleExtensions||r.blue.noodleExtensions||s.noodleExtensions)&&(l+=`<tr><th class="${T}table-header">NE</th><td class="${T}table-element">${i.red.noodleExtensions+i.blue.noodleExtensions}</td><td class="${T}table-element">${n.red.noodleExtensions+n.blue.noodleExtensions}</td><td class="${T}table-element">${r.red.noodleExtensions+r.blue.noodleExtensions}</td><td class="${T}table-element">${s.noodleExtensions}</td></tr></tr>`),(i.red.mappingExtensions||i.blue.mappingExtensions||n.red.mappingExtensions||n.blue.mappingExtensions||r.red.mappingExtensions||r.blue.mappingExtensions||s.mappingExtensions)&&(l+=`<tr><th class="${T}table-header">ME</th><td class="${T}table-element">${i.red.mappingExtensions+i.blue.mappingExtensions}</td><td class="${T}table-element">${n.red.mappingExtensions+n.blue.mappingExtensions}</td><td class="${T}table-element">${r.red.mappingExtensions+r.blue.mappingExtensions}</td><td class="${T}table-element">${s.mappingExtensions}</td></tr></tr>`);const o=document.createElement("table");return o.className=T+"table",o.innerHTML=l,o}function g0(e){var a;const t=e.target,i=t.id.replace(`${T}table-select-placement-`,"").split("-"),n=i[0],r=i[1],s=(a=lt.beatmapDifficulty.find(h=>h.characteristic===n&&h.difficulty===r))==null?void 0:a.noteContainer;if(!s){console.error(Ro+"note could not be found");return}const l=sh(s,t.value),o=document.querySelector(`#${T}table-placement-${n}-${r}`);o.innerHTML=lh(l)}function lh(e){const t=e.length||1;let i="";for(let n=2;n>=0;n--){i+="<tr>";for(let r=0;r<=3;r++)i+=`<td class="${T}table-element">${Zp(e,r,n)}</td>`;i+=`<td class="${T}table-element ${T}table--no-border">${I(Kp(e,n)/t*100,1)}%</td>
        </tr>`}return i+=`<tr><td class="${T}table-element ${T}table--no-border">${I(zn(e,0)/t*100,1)}%</td><td class="${T}table-element ${T}table--no-border">${I(zn(e,1)/t*100,1)}%</td><td class="${T}table-element ${T}table--no-border">${I(zn(e,2)/t*100,1)}%</td><td class="${T}table-element ${T}table--no-border">${I(zn(e,3)/t*100,1)}%</td></tr>`,i}function _0(e,t){var s;const i=Ln.create(`${T}table-select-placement-${t.characteristic}-${t.difficulty}`,"Note Placement: ","caption",`${T}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"},{text:"Bomb",value:"bomb"});(s=i.querySelector("select"))==null||s.addEventListener("change",g0);let n=`<tbody id="${T}table-placement-${t.characteristic}-${t.difficulty}">${lh(t.noteContainer)}</tbody>`;const r=document.createElement("table");return r.className=T+"table",r.innerHTML=n,r.prepend(i),r}function b0(e,t){const i=n0(t.data.obstacles);let n=`<caption class="${T}table-caption">Obstacles: ${i.total}</caption>`;i.interactive&&(n+=`<tr><th class="${T}table-header" colspan="2">Interactive</th><td class="${T}table-element">${i.interactive}</td></tr>`),i.chroma&&(n+=`<tr><th class="${T}table-header" colspan="2">Chroma</th><td class="${T}table-element">${i.chroma}</td></tr>`),i.noodleExtensions&&(n+=`<tr><th class="${T}table-header" colspan="2">Noodle Extensions</th><td class="${T}table-element">${i.noodleExtensions}</td></tr>`),i.mappingExtensions&&(n+=`<tr><th class="${T}table-header" colspan="2">Mapping Extensions</th><td class="${T}table-element">${i.mappingExtensions}</td></tr>`);const r=document.createElement("table");return r.className=T+"table",r.innerHTML=n,r}const oo=document.querySelector("#stats .accordion__collapsible");function v0(){if(!lt.beatmapInfo)throw new Error(Ro+"map info could not be found in savedData");const e=lt.beatmapInfo;e.difficultySets.forEach(t=>{const i=document.createElement("div");i.className=T+"mode-"+t.characteristic;const n=document.createElement("div");n.className=T+"title",n.textContent=Jc[t.characteristic]||t.characteristic,t.customData._characteristicLabel&&(n.textContent+=` -- ${t.customData._characteristicLabel}`),i.appendChild(n);for(let r=t.difficulties.length-1;r>=0;r--){const s=t.difficulties[r],l=lt.beatmapDifficulty.find(c=>c.characteristic===t.characteristic&&c.difficulty===s.difficulty);if(!l)throw new Error(Ro+"Could not find map data");const o=cl.create(`${T}${t.characteristic}-${s.difficulty}`,ye[s.difficulty]+(s.customData._difficultyLabel?" -- "+s.customData._difficultyLabel:""),s.difficulty,!0),a=o.querySelector(".accordion__collapsible-flex"),h=o.querySelector(".accordion__button");h.checked=it.onLoad.stats;const u=Hi.create("small","half"),d=Hi.create("small","half"),f=Hi.create("small","half");u.append(Vp(e,l)),u.append(document.createElement("br")),u.append(Up(e,l)),u.append(document.createElement("br")),u.append(Jp(e,l)),d.append(d0(e,l)),d.append(document.createElement("br")),d.append(p0(e,l)),d.append(document.createElement("br")),d.append(_0(e,l)),d.append(document.createElement("br")),d.append(e0(e,l)),f.append(c0(e,l)),f.append(document.createElement("br")),f.append(h0(e,l)),f.append(document.createElement("br")),f.append(b0(e,l)),a.appendChild(u),a.appendChild(d),a.appendChild(f),i.appendChild(o)}oo.appendChild(i)})}function y0(){for(;oo.firstChild;)oo.removeChild(oo.firstChild)}function kt(e,t,i){e[i]??(e[i]=e[t]),delete e[t]}function E0(e){if(!e)return{};const t={...e};if(!Object.keys(t).length)return{};kt(t,"_color","color"),kt(t,"_lightID","lightID"),kt(t,"_easing","easing"),kt(t,"_lerpType","lerpType"),kt(t,"_nameFilter","nameFilter"),kt(t,"_rotation","rotation"),kt(t,"_step","step"),kt(t,"_prop","prop"),kt(t,"_direction","direction"),kt(t,"_lockPosition","lockRotation");const i=t._preciseSpeed??t._speed;return t.speed??(t.speed=i),delete t._speed,delete t._preciseSpeed,delete t._propID,delete t._lightGradient,delete t._reset,delete t._counterSpin,delete t._stepMult,delete t._propMult,delete t._speedMult,t}function D0(e){if(e instanceof lr)return e;const t=new lr;return t.songName=e.songName,t.songSubName=e.songSubName,t.songAuthorName=e.songAuthorName,t.levelAuthorName=e.levelAuthorName,t.beatsPerMinute=e.beatsPerMinute,t.shuffle=e.shuffle,t.shufflePeriod=e.shufflePeriod,t.previewStartTime=e.previewStartTime,t.previewDuration=e.previewDuration,t.songFilename=e.songFilename,t.coverImageFilename=e.coverImageFilename,t.environmentName=e.environmentName,t.allDirectionsEnvironmentName=e.allDirectionsEnvironmentName,t.songTimeOffset=e.songTimeOffset,e instanceof rr?(t.customData.contributors=e.contributors,t.customData.customEnvironment=e.customEnvironment,t.customData.customEnvironmentHash=e.customEnvironmentHash):t.customData=K(e.customData),e instanceof rr&&e.listMap().forEach(([i,n])=>{t.addMap({_difficulty:n.difficulty,_difficultyRank:n.rank,_beatmapFilename:n.filename,_noteJumpMovementSpeed:n.njs,_noteJumpStartBeatOffset:n.njsOffset,_customData:{_editorOffset:n.offset,_editorOldOffset:n.oldOffset,_difficultyLabel:n.difficultyLabel,_colorLeft:Ht(n.colorLeft),_colorRight:Ht(n.colorRight),_envColorLeft:Ht(n.envColorLeft),_envColorRight:Ht(n.envColorRight),_obstacleColor:Ht(n.obstacleColor)}},i)}),t}function ol(e){if(!e)return{};const t={...e};return Object.keys(t).length?(kt(t,"_color","color"),kt(t,"_position","coordinates"),kt(t,"_disableNoteGravity","disableNoteGravity"),kt(t,"_disableNoteLook","disableNoteLook"),kt(t,"_flip","flip"),kt(t,"_localRotation","localRotation"),kt(t,"_noteJumpMovementSpeed","noteJumpMovementSpeed"),kt(t,"_noteJumpStartBeatOffset","noteJumpStartBeatOffset"),kt(t,"_scale","size"),kt(t,"_track","track"),kt(t,"_rotation","worldRotation"),t.spawnEffect??(t.spawnEffect=typeof t._disableSpawnEffect=="boolean"?!t._disableSpawnEffect:void 0),delete t._disableSpawnEffect,t.uninteractable??(t.uninteractable=typeof t._interactable=="boolean"?!t._interactable:void 0),delete t._interactable,t._animation&&(t.animation??(t.animation={color:t._animation._color,definitePosition:t._animation._definitePosition,dissolve:t._animation._dissolve,dissolveArrow:t._animation._dissolveArrow,interactable:t._animation._interactable,localRotation:t._animation._localRotation,offsetPosition:t._animation._position,offsetRotation:t._animation._rotation,scale:t._animation._scale,time:t._animation._time})),delete t._animation,t):{}}function De(e){return["convert",e]}function w0(e){var i,n,r,s,l;if(e instanceof hr)return e;J.tWarn(De("toV3Difficulty"),"Converting beatmap to v3 may lose certain data!");const t=new hr;if(t.filename=e.filename,e instanceof lu&&(e.colorNotes.forEach(o=>{if(o.isBomb()&&(o.customData._fake?t.customData.fakeBombNotes.push(new je({b:o.time,x:o.posX,y:o.posY}).toJSON()):t.bombNotes.push(new je({b:o.time,x:o.posX,y:o.posY}))),o.isNote()){let a=0;o.direction>=1e3&&(a=Math.abs(o.direction%1e3%360-360)),t.colorNotes.push(new Se({b:o.time,c:o.type,x:o.posX,y:o.posY,d:o.direction>=1e3||typeof o.customData._cutDirection=="number"?o.direction===8?8:1:Wo(o.direction,0,8),a}))}}),t.obstacles=e.obstacles.map(o=>new zt(o)),t.basicEvents=e.basicEvents.map(o=>new Fi(o)),t.customData.time=e.time,t.customData.BPMChanges=e.BPMChanges.map(o=>({b:o._time,m:o._bpm,p:o._beatsPerBar,o:o._metronomeOffset})),t.customData.bookmarks=e.bookmarks.map(o=>({b:o._time,n:o._name}))),e instanceof vu){if(t.customData.fakeBombNotes=[],t.customData.fakeColorNotes=[],t.customData.fakeObstacles=[],e.colorNotes.forEach((o,a)=>{const h=ol(o.customData);if(typeof o.customData._cutDirection=="number"&&J.tDebug(De("toV3Difficulty"),`notes[${a}] at time ${o.time} NE _cutDirection will be converted.`),o.isBomb()&&(o.customData._fake?t.customData.fakeBombNotes.push(new je({b:o.time,x:o.posX,y:o.posY,customData:h}).toJSON()):t.bombNotes.push(new je({b:o.time,x:o.posX,y:o.posY,customData:h}))),o.isNote()){let u=0;typeof o.customData._cutDirection=="number"?u=o.customData._cutDirection>0?o.customData._cutDirection%360:360+o.customData._cutDirection%360:o.direction>=1e3&&(u=Math.abs(o.direction%1e3%360-360)),o.customData._fake?t.customData.fakeColorNotes.push(new Se({b:o.time,c:o.type,x:o.posX,y:o.posY,d:o.direction>=1e3||typeof o.customData._cutDirection=="number"?o.direction===8?8:1:Wo(o.direction,0,8),a:u,customData:h}).toJSON()):t.colorNotes.push(new Se({b:o.time,c:o.type,x:o.posX,y:o.posY,d:o.direction>=1e3||typeof o.customData._cutDirection=="number"?o.direction===8?8:1:Wo(o.direction,0,8),a:u,customData:h}))}}),e.obstacles.forEach(o=>{const a=ol(o.customData);o.customData._fake?t.customData.fakeObstacles.push(new zt({b:o.time,x:o.posX,y:o.type?2:0,d:o.duration,w:o.width,h:o.type?3:5,customData:a}).toJSON()):t.obstacles.push(new zt({b:o.time,x:o.posX,y:o.type?2:0,d:o.duration,w:o.width,h:o.type?3:5,customData:a}))}),e.basicEvents.forEach((o,a)=>{if(o.isColorBoost())t.colorBoostEvents.push(new hn({b:o.time,o:!!o.value}));else if(o.isLaneRotationEvent())t.rotationEvents.push(new gn({b:o.time,e:o.type===14?0:1,r:typeof o.customData._rotation=="number"?o.customData._rotation:o.value>=1e3?(o.value-1360)%360:sf[o.value]??0}));else if(o.isBpmEvent())t.bpmEvents.push(new un({b:o.time,m:o.floatValue}));else{const h=E0(o.customData);o.isLightEvent()&&(o.customData._propID&&J.tWarn(De("toV3Difficulty"),`events[${a}] at time ${o.time} Chroma _propID will be removed.`),o.customData._lightGradient&&J.tWarn(De("toV3Difficulty"),`events[${a}] at time ${o.time} Chroma _lightGradient will be removed.`)),o.isRingEvent()&&(o.customData._reset&&J.tWarn(De("toV3Difficulty"),`events[${a}] at time ${o.time} Chroma _reset will be removed.`),o.customData._counterSpin&&J.tWarn(De("toV3Difficulty"),`events[${a}] at time ${o.time} Chroma _counterSpin will be removed.`),(o.customData._stepMult||o.customData._propMult||o.customData._speedMult)&&J.tWarn(De("toV3Difficulty"),`events[${a}] at time ${o.time} Chroma _mult will be removed.`)),t.basicEvents.push(new Fi({b:o.time,et:o.type,i:o.value,f:o.floatValue,customData:h}))}}),e.waypoints.forEach(o=>{t.waypoints.push(new _n({b:o.time,x:o.posX,y:o.posY,d:o.direction}))}),e.arcs.forEach(o=>t.arcs.push(new ln({c:o.color,b:o.time,x:o.posX,y:o.posY,d:o.direction,mu:o.lengthMultiplier,tb:o.tailTime,tx:o.tailPosX,ty:o.tailPosY,tc:o.tailDirection,tmu:o.tailLengthMultiplier,m:o.midAnchor}))),t.eventTypesWithKeywords=new to({d:((n=(i=e.eventTypesWithKeywords)==null?void 0:i.list)==null?void 0:n.map(o=>({k:o.keyword,e:o.events})))??[]}),e.customData)for(const o in e.customData){if(o==="_customEvents"){t.customData.customEvents=[],e.customData._customEvents.forEach(a=>{var h,u,d,f,c;a._type==="AnimateTrack"&&((h=t.customData.customEvents)==null||h.push({b:a._time,t:"AnimateTrack",d:{track:a._data._track,duration:a._data._duration,easing:a._data._easing,position:a._data._position,rotation:a._data._rotation,localRotation:a._data._localRotation,scale:a._data._scale,dissolve:a._data._dissolve,dissolveArrow:a._data._dissolveArrow,color:a._data._color,interactable:a._data._interactable,time:a._data._time}})),a._type==="AssignPathAnimation"&&((u=t.customData.customEvents)==null||u.push({b:a._time,t:"AssignPathAnimation",d:{track:a._data._track,easing:a._data._easing,position:a._data._position,rotation:a._data._rotation,localRotation:a._data._localRotation,scale:a._data._scale,dissolve:a._data._dissolve,dissolveArrow:a._data._dissolveArrow,color:a._data._color,interactable:a._data._interactable,definitePosition:a._data._definitePosition}})),a._type==="AssignTrackParent"&&((d=t.customData.customEvents)==null||d.push({b:a._time,t:"AssignTrackParent",d:{childrenTracks:a._data._childrenTracks,parentTrack:a._data._parentTrack,worldPositionStays:a._data._worldPositionStays}})),a._type==="AssignPlayerToTrack"&&((f=t.customData.customEvents)==null||f.push({b:a._time,t:"AssignPlayerToTrack",d:{track:a._data._track,target:a._data._target}})),a._type==="AssignFogTrack"&&((c=t.customData.customEvents)==null||c.push({b:a._time,t:"AnimateComponent",d:{track:a._data._track,duration:a._data._duration||0,BloomFogEnvironment:{attenuation:typeof a._data._attenuation=="number"?[[a._data._attenuation,0]]:a._data._attenuation,height:typeof a._data._height=="number"?[[a._data._height,0]]:a._data._height,offset:typeof a._data._offset=="number"?[[a._data._offset,0]]:a._data._offset,startY:typeof a._data._startY=="number"?[[a._data._startY,0]]:a._data._startY}}}))});continue}if(o==="_environment"){t.customData.environment=e.customData._environment.map(a=>{let h={};if(a._lightID&&(h={ILightWithId:{lightID:a._lightID}}),a._id&&a._lookupMethod)return{id:a._id,lookupMethod:a._lookupMethod,track:a._track,duplicate:a._duplicate,active:a._active,scale:a._scale,position:on(a._position,.6),rotation:a._rotation,localPosition:on(a._localPosition,.6),localRotation:a._localRotation,components:h};if(a._geometry)return a._lightID&&h.ILightWithId&&(h.ILightWithId.type=0),{geometry:a._geometry._type==="CUSTOM"?{type:a._geometry._type,mesh:{vertices:a._geometry._mesh._vertices,uv:a._geometry._mesh._uv,triangles:a._geometry._mesh._triangles},material:typeof a._geometry._material=="string"?a._geometry._material:{shader:a._geometry._material._shader,shaderKeywords:a._geometry._material._shaderKeywords,collision:a._geometry._material._collision,track:a._geometry._material._track,color:a._geometry._material._color},collision:a._geometry._collision}:{type:a._geometry._type,material:typeof a._geometry._material=="string"?a._geometry._material:{shader:a._geometry._material._shader,shaderKeywords:a._geometry._material._shaderKeywords,collision:a._geometry._material._collision,track:a._geometry._material._track,color:a._geometry._material._color},collision:a._geometry._collision},track:a._track,duplicate:a._duplicate,active:a._active,scale:a._scale,position:on(a._position,.6),rotation:a._rotation,localPosition:on(a._localPosition,.6),localRotation:a._localRotation,components:h};throw new Error("Error converting environment v2 to v3")});continue}if(o==="_materials"){t.customData.materials={};for(const a in e.customData._materials)t.customData.materials[a]={shader:e.customData._materials[a]._shader,shaderKeywords:e.customData._materials[a]._shaderKeywords,collision:e.customData._materials[a]._collision,track:e.customData._materials[a]._track,color:e.customData._materials[a]._color};continue}if(o==="_pointDefinitions"){t.customData.pointDefinitions={},e.customData._pointDefinitions.forEach(a=>{t.customData.pointDefinitions[a._name]=a._points});continue}if(o==="_time"){t.customData.time=e.customData[o];continue}if(o==="_BPMChanges"){t.customData.BPMChanges=(r=e.customData[o])==null?void 0:r.map(a=>({b:a._time,m:a._BPM,p:a._beatsPerBar,o:a._metronomeOffset}));continue}if(o==="_bpmChanges"){t.customData.BPMChanges=(s=e.customData[o])==null?void 0:s.map(a=>({b:a._time,m:a._bpm,p:a._beatsPerBar,o:a._metronomeOffset}));continue}if(o==="_bookmarks"){t.customData.bookmarks=(l=e.customData._bookmarks)==null?void 0:l.map(a=>({b:a._time,n:a._name,c:a._color}));continue}t.customData[o]=e.customData[o]}if(t.customData.environment){const o=[];for(const h of t.customData.environment)h.track&&o.push(h.track);const a=[];if(t.customData.customEvents){for(const h of t.customData.customEvents)if(h.t==="AnimateTrack"){if(typeof h.d.track=="string"&&o.includes(h.d.track))a.push(h);else if(Array.isArray(h.d.track)){for(const u of h.d.track)if(o.includes(u)){a.push(h);break}}}}for(const h of a)typeof h.d.track=="string"?typeof h.d.position=="string"?J.tWarn(De("toV3Difficulty"),"Cannot convert point definitions, unknown use."):Array.isArray(h.d.position)&&(ue(h.d.position)?on(h.d.position,.6):h.d.position.forEach(u=>{u[0]*=.6,u[1]*=.6,u[2]*=.6})):J.tWarn(De("toV3Difficulty"),"Environment animate track array conversion not yet implemented.")}t.useNormalEventsAsCompatibleEvents=!0}return t}function Ge(e){return["load",e]}function S0(e){const t=typeof e._version=="string"?e._version.at(0):typeof e.version=="string"?e.version.at(0):null;let i;t?i=parseInt(t):(J.tWarn(Ge("_info"),"Could not identify info version from JSON, assume implicit version",1),i=1);let n;switch(i){case 1:{n=dd(e);break}case 2:{n=Bd(e);break}default:throw new Error(`Info version ${i} is not supported, this may be an error in JSON or is newer than currently supported.`)}return D0(n)}function C0(e){const t=typeof e._version=="string"?e._version.at(0):typeof e.version=="string"?e.version.at(0):null;let i;t?i=parseInt(t):(i=e.songName?1:2,J.tWarn(Ge("_difficulty"),"Could not identify beatmap version from JSON, assume implicit version",i));let n;switch(i){case 1:{n=md(e);break}case 2:{n=Rd(e);break}case 3:{n=pp(e);break}default:throw new Error(`Beatmap version ${i} is not supported, this may be an error in JSON or is newer than currently supported.`)}return w0(n).sort()}async function T0(e){const t=e.file("Info.dat")||e.file("info.dat")||e.file("Info.json")||e.file("info.json");if(!t)throw new Error("Couldn't find Info.dat");return J.tInfo(Ge("loadInfo"),"loading info"),t.async("string").then(JSON.parse).then(S0)}async function L0(e,t){var r;const i=[],n=e.difficultySets;for(let s=n.length-1;s>=0;s--){const l=n[s].difficulties;if(l.length===0||!l){J.tError(Ge("loadDifficulty"),"Empty difficulty set, removing..."),n.splice(s,1);continue}for(let o=0;o<l.length;o++){const a=l[o],h=t.file(a.filename);if(h){J.tInfo(Ge("loadDifficulty"),`Loading ${n[s].characteristic} ${a.difficulty}`);let u;try{u=await h.async("string").then(JSON.parse)}catch(c){throw new Error(`${n[s].characteristic} ${a.difficulty} ${c}`)}const d=typeof u._version=="string"?u._version.at(0):typeof u.version=="string"?u.version.at(0):null;let f;d?f=parseInt(d):(J.tWarn(Ge("_difficulty"),"Could not identify beatmap version from JSON, assume implicit version",2),f=2),u._notes&&u.version&&J.tError(Ge("loadDifficulty"),`${n[s].characteristic} ${a.difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`);try{const c=C0(u),g=yi.create(e.beatsPerMinute,f===3?[...c.customData.BPMChanges??[],...c.bpmEvents.map(_=>_.toJSON())]:f===2?c.customData._BPMChanges??c.customData._bpmChanges:f===1?u._BPMChanges:[],(r=a.customData)==null?void 0:r._editorOffset);i.push({info:a,characteristic:n[s].characteristic,difficulty:a.difficulty,bpm:g,data:c,noteContainer:c.getNoteContainer(),eventContainer:c.getEventContainer(),swingAnalysis:lf(c,g,n[s].characteristic,a.difficulty),rawVersion:f,rawData:u})}catch(c){throw c}}else if(J.tError(Ge("loadDifficulty"),`Missing ${a.filename} file for ${n[s].characteristic} ${a.difficulty}, ignoring.`),n[s].difficulties.splice(o,1),o--,n[s].difficulties.length<1){J.tError(["load"],`${n[s].characteristic} difficulty set now empty, ignoring.`),n.splice(s,1);continue}}}return i}async function ch(e){return new Promise(function(t,i){const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="json",n.timeout=5e3;let r=Date.now();n.onprogress=()=>{n.timeout+=Date.now()-r},n.onload=()=>{n.status===200&&t(n.response),n.status===404&&i("Error 404: Map does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function x0(e){const t=`https://api.beatsaver.com/maps/id/${e}`,i=await ch(t);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}async function k0(e){const t=`https://api.beatsaver.com/maps/hash/${e}`,i=await ch(t);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}function Cn(e){return["download",e]}async function Gr(e){return new Promise(function(t,i){const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.timeout=5e3;let r=Date.now();n.onprogress=s=>{n.timeout+=Date.now()-r,Dt.status("download",`Downloading map: ${I(s.loaded/1024/1024,1)}MB / ${I(s.total/1024/1024,1)}MB`,s.loaded/s.total*100)},n.onload=()=>{n.status===200&&t(n.response),n.status===404&&i("Error 404: Map/link does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function uh(e){const t=fl(e);J.tInfo(Cn("downloadFromID"),`fetching download URL from BeatSaver for map ID ${t}`),Dt.status("info","Fetching download URL from BeatSaver",0);const i=await x0(t);J.tInfo(Cn("downloadFromID"),`downloading from BeatSaver for map ID ${t}`),Dt.status("info","Requesting download from BeatSaver",0);const n=await Gr(i);return Nt.setCoverLink("https://beatsaver.com/maps/"+t,t),n}async function R0(e){const t=hl(e);if(t.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return uh(t.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);Dt.status("info","Requesting download from link",0),J.tInfo(Cn("downloadFromURL"),`downloading from ${t}`);let i=await Gr("https://cors.bsmg.dev/"+t);return Nt.setCoverLink(t),i}async function B0(e){let t;if(mr(e.trim()))t=e.trim();else throw new Error("invalid hash");J.tInfo(Cn("downloadFromHash"),`fetching download URL from BeatSaver for map hash ${t}`),Dt.status("info","Fetching download URL from BeatSaver",0);const i=await k0(t);return J.tInfo(Cn("downloadFromHash"),`downloading from BeatSaver for map hash ${t}`),Dt.status("info","Requesting download from BeatSaver",0),await Gr(i)}var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function N0(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Vn(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var hh={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(i){e.exports=i()})(function(){return function i(n,r,s){function l(h,u){if(!r[h]){if(!n[h]){var d=typeof Vn=="function"&&Vn;if(!u&&d)return d(h,!0);if(o)return o(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var c=r[h]={exports:{}};n[h][0].call(c.exports,function(g){var _=n[h][1][g];return l(_||g)},c,c.exports,i,n,r,s)}return r[h].exports}for(var o=typeof Vn=="function"&&Vn,a=0;a<s.length;a++)l(s[a]);return l}({1:[function(i,n,r){var s=i("./utils"),l=i("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(a){for(var h,u,d,f,c,g,_,v=[],b=0,E=a.length,w=E,L=s.getTypeOf(a)!=="string";b<a.length;)w=E-b,d=L?(h=a[b++],u=b<E?a[b++]:0,b<E?a[b++]:0):(h=a.charCodeAt(b++),u=b<E?a.charCodeAt(b++):0,b<E?a.charCodeAt(b++):0),f=h>>2,c=(3&h)<<4|u>>4,g=1<w?(15&u)<<2|d>>6:64,_=2<w?63&d:64,v.push(o.charAt(f)+o.charAt(c)+o.charAt(g)+o.charAt(_));return v.join("")},r.decode=function(a){var h,u,d,f,c,g,_=0,v=0,b="data:";if(a.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var E,w=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&w--,a.charAt(a.length-2)===o.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(E=l.uint8array?new Uint8Array(0|w):new Array(0|w);_<a.length;)h=o.indexOf(a.charAt(_++))<<2|(f=o.indexOf(a.charAt(_++)))>>4,u=(15&f)<<4|(c=o.indexOf(a.charAt(_++)))>>2,d=(3&c)<<6|(g=o.indexOf(a.charAt(_++))),E[v++]=h,c!==64&&(E[v++]=u),g!==64&&(E[v++]=d);return E}},{"./support":30,"./utils":32}],2:[function(i,n,r){var s=i("./external"),l=i("./stream/DataWorker"),o=i("./stream/Crc32Probe"),a=i("./stream/DataLengthProbe");function h(u,d,f,c,g){this.compressedSize=u,this.uncompressedSize=d,this.crc32=f,this.compression=c,this.compressedContent=g}h.prototype={getContentWorker:function(){var u=new l(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),d=this;return u.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new l(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(u,d,f){return u.pipe(new o).pipe(new a("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new a("compressedSize")).withStreamInfo("compression",d)},n.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,n,r){var s=i("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},r.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,n,r){var s=i("./utils"),l=function(){for(var o,a=[],h=0;h<256;h++){o=h;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[h]=o}return a}();n.exports=function(o,a){return o!==void 0&&o.length?s.getTypeOf(o)!=="string"?function(h,u,d,f){var c=l,g=f+d;h^=-1;for(var _=f;_<g;_++)h=h>>>8^c[255&(h^u[_])];return-1^h}(0|a,o,o.length,0):function(h,u,d,f){var c=l,g=f+d;h^=-1;for(var _=f;_<g;_++)h=h>>>8^c[255&(h^u.charCodeAt(_))];return-1^h}(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(i,n,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(i,n,r){var s=null;s=typeof Promise<"u"?Promise:i("lie"),n.exports={Promise:s}},{lie:37}],7:[function(i,n,r){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=i("pako"),o=i("./utils"),a=i("./stream/GenericWorker"),h=s?"uint8array":"array";function u(d,f){a.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}r.magic="\b\0",o.inherits(u,a),u.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,d.data),!1)},u.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},r.compressWorker=function(d){return new u("Deflate",d)},r.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,n,r){function s(c,g){var _,v="";for(_=0;_<g;_++)v+=String.fromCharCode(255&c),c>>>=8;return v}function l(c,g,_,v,b,E){var w,L,x=c.file,k=c.compression,P=E!==h.utf8encode,j=o.transformTo("string",E(x.name)),O=o.transformTo("string",h.utf8encode(x.name)),Y=x.comment,tt=o.transformTo("string",E(Y)),S=o.transformTo("string",h.utf8encode(Y)),$=O.length!==x.name.length,p=S.length!==Y.length,F="",st="",X="",ct=x.dir,z=x.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};g&&!_||(rt.crc32=c.crc32,rt.compressedSize=c.compressedSize,rt.uncompressedSize=c.uncompressedSize);var N=0;g&&(N|=8),P||!$&&!p||(N|=2048);var B=0,nt=0;ct&&(B|=16),b==="UNIX"?(nt=798,B|=function(q,wt){var Rt=q;return q||(Rt=wt?16893:33204),(65535&Rt)<<16}(x.unixPermissions,ct)):(nt=20,B|=function(q){return 63&(q||0)}(x.dosPermissions)),w=z.getUTCHours(),w<<=6,w|=z.getUTCMinutes(),w<<=5,w|=z.getUTCSeconds()/2,L=z.getUTCFullYear()-1980,L<<=4,L|=z.getUTCMonth()+1,L<<=5,L|=z.getUTCDate(),$&&(st=s(1,1)+s(u(j),4)+O,F+="up"+s(st.length,2)+st),p&&(X=s(1,1)+s(u(tt),4)+S,F+="uc"+s(X.length,2)+X);var Z="";return Z+=`
\0`,Z+=s(N,2),Z+=k.magic,Z+=s(w,2),Z+=s(L,2),Z+=s(rt.crc32,4),Z+=s(rt.compressedSize,4),Z+=s(rt.uncompressedSize,4),Z+=s(j.length,2),Z+=s(F.length,2),{fileRecord:d.LOCAL_FILE_HEADER+Z+j+F,dirRecord:d.CENTRAL_FILE_HEADER+s(nt,2)+Z+s(tt.length,2)+"\0\0\0\0"+s(B,4)+s(v,4)+j+F+tt}}var o=i("../utils"),a=i("../stream/GenericWorker"),h=i("../utf8"),u=i("../crc32"),d=i("../signature");function f(c,g,_,v){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=_,this.encodeFileName=v,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(f,a),f.prototype.push=function(c){var g=c.meta.percent||0,_=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,a.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:_?(g+100*(_-v-1))/_:100}}))},f.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var g=this.streamFiles&&!c.file.dir;if(g){var _=l(c,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(c){this.accumulate=!1;var g=this.streamFiles&&!c.file.dir,_=l(c,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),g)this.push({data:function(v){return d.DATA_DESCRIPTOR+s(v.crc32,4)+s(v.compressedSize,4)+s(v.uncompressedSize,4)}(c),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var c=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var _=this.bytesWritten-c,v=function(b,E,w,L,x){var k=o.transformTo("string",x(L));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(b,2)+s(b,2)+s(E,4)+s(w,4)+s(k.length,2)+k}(this.dirRecords.length,_,c,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(c){this._sources.push(c);var g=this;return c.on("data",function(_){g.processChunk(_)}),c.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),c.on("error",function(_){g.error(_)}),this},f.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(c){var g=this._sources;if(!a.prototype.error.call(this,c))return!1;for(var _=0;_<g.length;_++)try{g[_].error(c)}catch{}return!0},f.prototype.lock=function(){a.prototype.lock.call(this);for(var c=this._sources,g=0;g<c.length;g++)c[g].lock()},n.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,n,r){var s=i("../compressions"),l=i("./ZipFileWorker");r.generateWorker=function(o,a,h){var u=new l(a.streamFiles,h,a.platform,a.encodeFileName),d=0;try{o.forEach(function(f,c){d++;var g=function(E,w){var L=E||w,x=s[L];if(!x)throw new Error(L+" is not a valid compression method !");return x}(c.options.compression,a.compression),_=c.options.compressionOptions||a.compressionOptions||{},v=c.dir,b=c.date;c._compressWorker(g,_).withStreamInfo("file",{name:f,dir:v,date:b,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(u)}),u.entriesCount=d}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,n,r){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new s;for(var o in this)typeof this[o]!="function"&&(l[o]=this[o]);return l}}(s.prototype=i("./object")).loadAsync=i("./load"),s.support=i("./support"),s.defaults=i("./defaults"),s.version="3.10.1",s.loadAsync=function(l,o){return new s().loadAsync(l,o)},s.external=i("./external"),n.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,n,r){var s=i("./utils"),l=i("./external"),o=i("./utf8"),a=i("./zipEntries"),h=i("./stream/Crc32Probe"),u=i("./nodejsUtils");function d(f){return new l.Promise(function(c,g){var _=f.decompressed.getContentWorker().pipe(new h);_.on("error",function(v){g(v)}).on("end",function(){_.streamInfo.crc32!==f.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}n.exports=function(f,c){var g=this;return c=s.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(f)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",f,!0,c.optimizedBinaryString,c.base64).then(function(_){var v=new a(c);return v.load(_),v}).then(function(_){var v=[l.Promise.resolve(_)],b=_.files;if(c.checkCRC32)for(var E=0;E<b.length;E++)v.push(d(b[E]));return l.Promise.all(v)}).then(function(_){for(var v=_.shift(),b=v.files,E=0;E<b.length;E++){var w=b[E],L=w.fileNameStr,x=s.resolve(w.fileNameStr);g.file(x,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:c.createFolders}),w.dir||(g.file(x).unsafeOriginalName=L)}return v.zipComment.length&&(g.comment=v.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,n,r){var s=i("../utils"),l=i("../stream/GenericWorker");function o(a,h){l.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(h)}s.inherits(o,l),o.prototype._bindStream=function(a){var h=this;(this._stream=a).pause(),a.on("data",function(u){h.push({data:u,meta:{percent:0}})}).on("error",function(u){h.isPaused?this.generatedError=u:h.error(u)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,n,r){var s=i("readable-stream").Readable;function l(o,a,h){s.call(this,a),this._helper=o;var u=this;o.on("data",function(d,f){u.push(d)||u._helper.pause(),h&&h(f)}).on("error",function(d){u.emit("error",d)}).on("end",function(){u.push(null)})}i("../utils").inherits(l,s),l.prototype._read=function(){this._helper.resume()},n.exports=l},{"../utils":32,"readable-stream":16}],14:[function(i,n,r){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,l);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,l)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var l=new Buffer(s);return l.fill(0),l},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(i,n,r){function s(x,k,P){var j,O=o.getTypeOf(k),Y=o.extend(P||{},u);Y.date=Y.date||new Date,Y.compression!==null&&(Y.compression=Y.compression.toUpperCase()),typeof Y.unixPermissions=="string"&&(Y.unixPermissions=parseInt(Y.unixPermissions,8)),Y.unixPermissions&&16384&Y.unixPermissions&&(Y.dir=!0),Y.dosPermissions&&16&Y.dosPermissions&&(Y.dir=!0),Y.dir&&(x=b(x)),Y.createFolders&&(j=v(x))&&E.call(this,j,!0);var tt=O==="string"&&Y.binary===!1&&Y.base64===!1;P&&P.binary!==void 0||(Y.binary=!tt),(k instanceof d&&k.uncompressedSize===0||Y.dir||!k||k.length===0)&&(Y.base64=!1,Y.binary=!0,k="",Y.compression="STORE",O="string");var S=null;S=k instanceof d||k instanceof a?k:g.isNode&&g.isStream(k)?new _(x,k):o.prepareContent(x,k,Y.binary,Y.optimizedBinaryString,Y.base64);var $=new f(x,S,Y);this.files[x]=$}var l=i("./utf8"),o=i("./utils"),a=i("./stream/GenericWorker"),h=i("./stream/StreamHelper"),u=i("./defaults"),d=i("./compressedObject"),f=i("./zipObject"),c=i("./generate"),g=i("./nodejsUtils"),_=i("./nodejs/NodejsStreamInputAdapter"),v=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var k=x.lastIndexOf("/");return 0<k?x.substring(0,k):""},b=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},E=function(x,k){return k=k!==void 0?k:u.createFolders,x=b(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:k}),this.files[x]};function w(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var L={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var k,P,j;for(k in this.files)j=this.files[k],(P=k.slice(this.root.length,k.length))&&k.slice(0,this.root.length)===this.root&&x(P,j)},filter:function(x){var k=[];return this.forEach(function(P,j){x(P,j)&&k.push(j)}),k},file:function(x,k,P){if(arguments.length!==1)return x=this.root+x,s.call(this,x,k,P),this;if(w(x)){var j=x;return this.filter(function(Y,tt){return!tt.dir&&j.test(Y)})}var O=this.files[this.root+x];return O&&!O.dir?O:null},folder:function(x){if(!x)return this;if(w(x))return this.filter(function(O,Y){return Y.dir&&x.test(O)});var k=this.root+x,P=E.call(this,k),j=this.clone();return j.root=P.name,j},remove:function(x){x=this.root+x;var k=this.files[x];if(k||(x.slice(-1)!=="/"&&(x+="/"),k=this.files[x]),k&&!k.dir)delete this.files[x];else for(var P=this.filter(function(O,Y){return Y.name.slice(0,x.length)===x}),j=0;j<P.length;j++)delete this.files[P[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var k,P={};try{if((P=o.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");o.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var j=P.comment||this.comment||"";k=c.generateWorker(this,P,j)}catch(O){(k=new a("error")).error(O)}return new h(k,P.type||"string",P.mimeType)},generateAsync:function(x,k){return this.generateInternalStream(x).accumulate(k)},generateNodeStream:function(x,k){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(k)}};n.exports=L},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,n,r){n.exports=i("stream")},{stream:void 0}],17:[function(i,n,r){var s=i("./DataReader");function l(o){s.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}i("../utils").inherits(l,s),l.prototype.byteAt=function(o){return this.data[this.zero+o]},l.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),h=o.charCodeAt(1),u=o.charCodeAt(2),d=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===a&&this.data[f+1]===h&&this.data[f+2]===u&&this.data[f+3]===d)return f-this.zero;return-1},l.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),h=o.charCodeAt(1),u=o.charCodeAt(2),d=o.charCodeAt(3),f=this.readData(4);return a===f[0]&&h===f[1]&&u===f[2]&&d===f[3]},l.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},n.exports=l},{"../utils":32,"./DataReader":18}],18:[function(i,n,r){var s=i("../utils");function l(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,h=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)h=(h<<8)+this.byteAt(a);return this.index+=o,h},readString:function(o){return s.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},n.exports=l},{"../utils":32}],19:[function(i,n,r){var s=i("./Uint8ArrayReader");function l(o){s.call(this,o)}i("../utils").inherits(l,s),l.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},n.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,n,r){var s=i("./DataReader");function l(o){s.call(this,o)}i("../utils").inherits(l,s),l.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},l.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},l.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},l.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},n.exports=l},{"../utils":32,"./DataReader":18}],21:[function(i,n,r){var s=i("./ArrayReader");function l(o){s.call(this,o)}i("../utils").inherits(l,s),l.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},n.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(i,n,r){var s=i("../utils"),l=i("../support"),o=i("./ArrayReader"),a=i("./StringReader"),h=i("./NodeBufferReader"),u=i("./Uint8ArrayReader");n.exports=function(d){var f=s.getTypeOf(d);return s.checkSupport(f),f!=="string"||l.uint8array?f==="nodebuffer"?new h(d):l.uint8array?new u(s.transformTo("uint8array",d)):new o(s.transformTo("array",d)):new a(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,n,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,n,r){var s=i("./GenericWorker"),l=i("../utils");function o(a){s.call(this,"ConvertWorker to "+a),this.destType=a}l.inherits(o,s),o.prototype.processChunk=function(a){this.push({data:l.transformTo(this.destType,a.data),meta:a.meta})},n.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(i,n,r){var s=i("./GenericWorker"),l=i("../crc32");function o(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}i("../utils").inherits(o,s),o.prototype.processChunk=function(a){this.streamInfo.crc32=l(a.data,this.streamInfo.crc32||0),this.push(a)},n.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,n,r){var s=i("../utils"),l=i("./GenericWorker");function o(a){l.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}s.inherits(o,l),o.prototype.processChunk=function(a){if(a){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+a.data.length}l.prototype.processChunk.call(this,a)},n.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(i,n,r){var s=i("../utils"),l=i("./GenericWorker");function o(a){l.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(u){h.dataIsReady=!0,h.data=u,h.max=u&&u.length||0,h.type=s.getTypeOf(u),h.isPaused||h._tickAndRepeat()},function(u){h.error(u)})}s.inherits(o,l),o.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,h);break;case"uint8array":a=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":a=this.data.slice(this.index,h)}return this.index=h,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(i,n,r){function s(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,o){return this._listeners[l].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,o){if(this._listeners[l])for(var a=0;a<this._listeners[l].length;a++)this._listeners[l][a].call(this,o)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var o=this;return l.on("data",function(a){o.processChunk(a)}),l.on("end",function(){o.end()}),l.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,o){return this.extraStreamInfo[l]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},n.exports=s},{}],29:[function(i,n,r){var s=i("../utils"),l=i("./ConvertWorker"),o=i("./GenericWorker"),a=i("../base64"),h=i("../support"),u=i("../external"),d=null;if(h.nodestream)try{d=i("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(g,_){return new u.Promise(function(v,b){var E=[],w=g._internalType,L=g._outputType,x=g._mimeType;g.on("data",function(k,P){E.push(k),_&&_(P)}).on("error",function(k){E=[],b(k)}).on("end",function(){try{var k=function(P,j,O){switch(P){case"blob":return s.newBlob(s.transformTo("arraybuffer",j),O);case"base64":return a.encode(j);default:return s.transformTo(P,j)}}(L,function(P,j){var O,Y=0,tt=null,S=0;for(O=0;O<j.length;O++)S+=j[O].length;switch(P){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(tt=new Uint8Array(S),O=0;O<j.length;O++)tt.set(j[O],Y),Y+=j[O].length;return tt;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+P+"'")}}(w,E),x);v(k)}catch(P){b(P)}E=[]}).resume()})}function c(g,_,v){var b=_;switch(_){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=_,this._mimeType=v,s.checkSupport(b),this._worker=g.pipe(new l(b)),g.lock()}catch(E){this._worker=new o("error"),this._worker.error(E)}}c.prototype={accumulate:function(g){return f(this,g)},on:function(g,_){var v=this;return g==="data"?this._worker.on(g,function(b){_.call(v,b.data,b.meta)}):this._worker.on(g,function(){s.delay(_,arguments,v)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},g)}},n.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,n,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var s=new ArrayBuffer(0);try{r.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(s),r.blob=l.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!i("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(i,n,r){for(var s=i("./utils"),l=i("./support"),o=i("./nodejsUtils"),a=i("./stream/GenericWorker"),h=new Array(256),u=0;u<256;u++)h[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;h[254]=h[254]=1;function d(){a.call(this,"utf-8 decode"),this.leftOver=null}function f(){a.call(this,"utf-8 encode")}r.utf8encode=function(c){return l.nodebuffer?o.newBufferFrom(c,"utf-8"):function(g){var _,v,b,E,w,L=g.length,x=0;for(E=0;E<L;E++)(64512&(v=g.charCodeAt(E)))==55296&&E+1<L&&(64512&(b=g.charCodeAt(E+1)))==56320&&(v=65536+(v-55296<<10)+(b-56320),E++),x+=v<128?1:v<2048?2:v<65536?3:4;for(_=l.uint8array?new Uint8Array(x):new Array(x),E=w=0;w<x;E++)(64512&(v=g.charCodeAt(E)))==55296&&E+1<L&&(64512&(b=g.charCodeAt(E+1)))==56320&&(v=65536+(v-55296<<10)+(b-56320),E++),v<128?_[w++]=v:(v<2048?_[w++]=192|v>>>6:(v<65536?_[w++]=224|v>>>12:(_[w++]=240|v>>>18,_[w++]=128|v>>>12&63),_[w++]=128|v>>>6&63),_[w++]=128|63&v);return _}(c)},r.utf8decode=function(c){return l.nodebuffer?s.transformTo("nodebuffer",c).toString("utf-8"):function(g){var _,v,b,E,w=g.length,L=new Array(2*w);for(_=v=0;_<w;)if((b=g[_++])<128)L[v++]=b;else if(4<(E=h[b]))L[v++]=65533,_+=E-1;else{for(b&=E===2?31:E===3?15:7;1<E&&_<w;)b=b<<6|63&g[_++],E--;1<E?L[v++]=65533:b<65536?L[v++]=b:(b-=65536,L[v++]=55296|b>>10&1023,L[v++]=56320|1023&b)}return L.length!==v&&(L.subarray?L=L.subarray(0,v):L.length=v),s.applyFromCharCode(L)}(c=s.transformTo(l.uint8array?"uint8array":"array",c))},s.inherits(d,a),d.prototype.processChunk=function(c){var g=s.transformTo(l.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var _=g;(g=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),g.set(_,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var v=function(E,w){var L;for((w=w||E.length)>E.length&&(w=E.length),L=w-1;0<=L&&(192&E[L])==128;)L--;return L<0||L===0?w:L+h[E[L]]>w?L:w}(g),b=g;v!==g.length&&(l.uint8array?(b=g.subarray(0,v),this.leftOver=g.subarray(v,g.length)):(b=g.slice(0,v),this.leftOver=g.slice(v,g.length))),this.push({data:r.utf8decode(b),meta:c.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=d,s.inherits(f,a),f.prototype.processChunk=function(c){this.push({data:r.utf8encode(c.data),meta:c.meta})},r.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,n,r){var s=i("./support"),l=i("./base64"),o=i("./nodejsUtils"),a=i("./external");function h(_){return _}function u(_,v){for(var b=0;b<_.length;++b)v[b]=255&_.charCodeAt(b);return v}i("setimmediate"),r.newBlob=function(_,v){r.checkSupport("blob");try{return new Blob([_],{type:v})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(_),b.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(_,v,b){var E=[],w=0,L=_.length;if(L<=b)return String.fromCharCode.apply(null,_);for(;w<L;)v==="array"||v==="nodebuffer"?E.push(String.fromCharCode.apply(null,_.slice(w,Math.min(w+b,L)))):E.push(String.fromCharCode.apply(null,_.subarray(w,Math.min(w+b,L)))),w+=b;return E.join("")},stringifyByChar:function(_){for(var v="",b=0;b<_.length;b++)v+=String.fromCharCode(_[b]);return v},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function f(_){var v=65536,b=r.getTypeOf(_),E=!0;if(b==="uint8array"?E=d.applyCanBeUsed.uint8array:b==="nodebuffer"&&(E=d.applyCanBeUsed.nodebuffer),E)for(;1<v;)try{return d.stringifyByChunk(_,b,v)}catch{v=Math.floor(v/2)}return d.stringifyByChar(_)}function c(_,v){for(var b=0;b<_.length;b++)v[b]=_[b];return v}r.applyFromCharCode=f;var g={};g.string={string:h,array:function(_){return u(_,new Array(_.length))},arraybuffer:function(_){return g.string.uint8array(_).buffer},uint8array:function(_){return u(_,new Uint8Array(_.length))},nodebuffer:function(_){return u(_,o.allocBuffer(_.length))}},g.array={string:f,array:h,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return o.newBufferFrom(_)}},g.arraybuffer={string:function(_){return f(new Uint8Array(_))},array:function(_){return c(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:h,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return o.newBufferFrom(new Uint8Array(_))}},g.uint8array={string:f,array:function(_){return c(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:h,nodebuffer:function(_){return o.newBufferFrom(_)}},g.nodebuffer={string:f,array:function(_){return c(_,new Array(_.length))},arraybuffer:function(_){return g.nodebuffer.uint8array(_).buffer},uint8array:function(_){return c(_,new Uint8Array(_.length))},nodebuffer:h},r.transformTo=function(_,v){if(v=v||"",!_)return v;r.checkSupport(_);var b=r.getTypeOf(v);return g[b][_](v)},r.resolve=function(_){for(var v=_.split("/"),b=[],E=0;E<v.length;E++){var w=v[E];w==="."||w===""&&E!==0&&E!==v.length-1||(w===".."?b.pop():b.push(w))}return b.join("/")},r.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":s.nodebuffer&&o.isBuffer(_)?"nodebuffer":s.uint8array&&_ instanceof Uint8Array?"uint8array":s.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(_){if(!s[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(_){var v,b,E="";for(b=0;b<(_||"").length;b++)E+="\\x"+((v=_.charCodeAt(b))<16?"0":"")+v.toString(16).toUpperCase();return E},r.delay=function(_,v,b){setImmediate(function(){_.apply(b||null,v||[])})},r.inherits=function(_,v){function b(){}b.prototype=v.prototype,_.prototype=new b},r.extend=function(){var _,v,b={};for(_=0;_<arguments.length;_++)for(v in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],v)&&b[v]===void 0&&(b[v]=arguments[_][v]);return b},r.prepareContent=function(_,v,b,E,w){return a.Promise.resolve(v).then(function(L){return s.blob&&(L instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(L))!==-1)&&typeof FileReader<"u"?new a.Promise(function(x,k){var P=new FileReader;P.onload=function(j){x(j.target.result)},P.onerror=function(j){k(j.target.error)},P.readAsArrayBuffer(L)}):L}).then(function(L){var x=r.getTypeOf(L);return x?(x==="arraybuffer"?L=r.transformTo("uint8array",L):x==="string"&&(w?L=l.decode(L):b&&E!==!0&&(L=function(k){return u(k,s.uint8array?new Uint8Array(k.length):new Array(k.length))}(L))),L):a.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,n,r){var s=i("./reader/readerFor"),l=i("./utils"),o=i("./signature"),a=i("./zipEntry"),h=i("./support");function u(d){this.files=[],this.loadOptions=d}u.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(f)+", expected "+l.pretty(d)+")")}},isSignature:function(d,f){var c=this.reader.index;this.reader.setIndex(d);var g=this.reader.readString(4)===f;return this.reader.setIndex(c),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=h.uint8array?"uint8array":"array",c=l.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,c,g=this.zip64EndOfCentralSize-44;0<g;)d=this.reader.readInt(2),f=this.reader.readInt(4),c=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var g=f-c;if(0<g)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(d){this.reader=s(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(i,n,r){var s=i("./reader/readerFor"),l=i("./utils"),o=i("./compressedObject"),a=i("./crc32"),h=i("./utf8"),u=i("./compressions"),d=i("./support");function f(c,g){this.options=c,this.loadOptions=g}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var g,_;if(c.skip(22),this.fileNameLength=c.readInt(2),_=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(v){for(var b in u)if(Object.prototype.hasOwnProperty.call(u,b)&&u[b].magic===v)return u[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,g,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var g=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(g),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=s(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var g,_,v,b=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<b;)g=c.readInt(2),_=c.readInt(2),v=c.readData(_),this.extraFields[g]={id:g,length:_,value:v};c.setIndex(b)},handleUTF8:function(){var c=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var _=l.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var b=l.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var g=s(c.value);return g.readInt(1)!==1||a(this.fileName)!==g.readInt(4)?null:h.utf8decode(g.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var g=s(c.value);return g.readInt(1)!==1||a(this.fileComment)!==g.readInt(4)?null:h.utf8decode(g.readData(c.length-5))}return null}},n.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,n,r){function s(g,_,v){this.name=g,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=_,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var l=i("./stream/StreamHelper"),o=i("./stream/DataWorker"),a=i("./utf8"),h=i("./compressedObject"),u=i("./stream/GenericWorker");s.prototype={internalStream:function(g){var _=null,v="string";try{if(!g)throw new Error("No output type specified.");var b=(v=g.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),_=this._decompressWorker();var E=!this._dataBinary;E&&!b&&(_=_.pipe(new a.Utf8EncodeWorker)),!E&&b&&(_=_.pipe(new a.Utf8DecodeWorker))}catch(w){(_=new u("error")).error(w)}return new l(_,v,"")},async:function(g,_){return this.internalStream(g).accumulate(_)},nodeStream:function(g,_){return this.internalStream(g||"nodebuffer").toNodejsStream(_)},_compressWorker:function(g,_){if(this._data instanceof h&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new a.Utf8EncodeWorker)),h.createWorkerFrom(v,g,_)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<d.length;c++)s.prototype[d[c]]=f;n.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,n,r){(function(s){var l,o,a=s.MutationObserver||s.WebKitMutationObserver;if(a){var h=0,u=new a(g),d=s.document.createTextNode("");u.observe(d,{characterData:!0}),l=function(){d.data=h=++h%2}}else if(s.setImmediate||s.MessageChannel===void 0)l="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var _=s.document.createElement("script");_.onreadystatechange=function(){g(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},s.document.documentElement.appendChild(_)}:function(){setTimeout(g,0)};else{var f=new s.MessageChannel;f.port1.onmessage=g,l=function(){f.port2.postMessage(0)}}var c=[];function g(){var _,v;o=!0;for(var b=c.length;b;){for(v=c,c=[],_=-1;++_<b;)v[_]();b=c.length}o=!1}n.exports=function(_){c.push(_)!==1||o||l()}}).call(this,typeof Un<"u"?Un:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(i,n,r){var s=i("immediate");function l(){}var o={},a=["REJECTED"],h=["FULFILLED"],u=["PENDING"];function d(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,b!==l&&_(this,b)}function f(b,E,w){this.promise=b,typeof E=="function"&&(this.onFulfilled=E,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function c(b,E,w){s(function(){var L;try{L=E(w)}catch(x){return o.reject(b,x)}L===b?o.reject(b,new TypeError("Cannot resolve promise with itself")):o.resolve(b,L)})}function g(b){var E=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof E=="function")return function(){E.apply(b,arguments)}}function _(b,E){var w=!1;function L(P){w||(w=!0,o.reject(b,P))}function x(P){w||(w=!0,o.resolve(b,P))}var k=v(function(){E(x,L)});k.status==="error"&&L(k.value)}function v(b,E){var w={};try{w.value=b(E),w.status="success"}catch(L){w.status="error",w.value=L}return w}(n.exports=d).prototype.finally=function(b){if(typeof b!="function")return this;var E=this.constructor;return this.then(function(w){return E.resolve(b()).then(function(){return w})},function(w){return E.resolve(b()).then(function(){throw w})})},d.prototype.catch=function(b){return this.then(null,b)},d.prototype.then=function(b,E){if(typeof b!="function"&&this.state===h||typeof E!="function"&&this.state===a)return this;var w=new this.constructor(l);return this.state!==u?c(w,this.state===h?b:E,this.outcome):this.queue.push(new f(w,b,E)),w},f.prototype.callFulfilled=function(b){o.resolve(this.promise,b)},f.prototype.otherCallFulfilled=function(b){c(this.promise,this.onFulfilled,b)},f.prototype.callRejected=function(b){o.reject(this.promise,b)},f.prototype.otherCallRejected=function(b){c(this.promise,this.onRejected,b)},o.resolve=function(b,E){var w=v(g,E);if(w.status==="error")return o.reject(b,w.value);var L=w.value;if(L)_(b,L);else{b.state=h,b.outcome=E;for(var x=-1,k=b.queue.length;++x<k;)b.queue[x].callFulfilled(E)}return b},o.reject=function(b,E){b.state=a,b.outcome=E;for(var w=-1,L=b.queue.length;++w<L;)b.queue[w].callRejected(E);return b},d.resolve=function(b){return b instanceof this?b:o.resolve(new this(l),b)},d.reject=function(b){var E=new this(l);return o.reject(E,b)},d.all=function(b){var E=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=b.length,L=!1;if(!w)return this.resolve([]);for(var x=new Array(w),k=0,P=-1,j=new this(l);++P<w;)O(b[P],P);return j;function O(Y,tt){E.resolve(Y).then(function(S){x[tt]=S,++k!==w||L||(L=!0,o.resolve(j,x))},function(S){L||(L=!0,o.reject(j,S))})}},d.race=function(b){var E=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=b.length,L=!1;if(!w)return this.resolve([]);for(var x=-1,k=new this(l);++x<w;)P=b[x],E.resolve(P).then(function(j){L||(L=!0,o.resolve(k,j))},function(j){L||(L=!0,o.reject(k,j))});var P;return k}},{immediate:36}],38:[function(i,n,r){var s={};(0,i("./lib/utils/common").assign)(s,i("./lib/deflate"),i("./lib/inflate"),i("./lib/zlib/constants")),n.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,n,r){var s=i("./zlib/deflate"),l=i("./utils/common"),o=i("./utils/strings"),a=i("./zlib/messages"),h=i("./zlib/zstream"),u=Object.prototype.toString,d=0,f=-1,c=0,g=8;function _(b){if(!(this instanceof _))return new _(b);this.options=l.assign({level:f,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},b||{});var E=this.options;E.raw&&0<E.windowBits?E.windowBits=-E.windowBits:E.gzip&&0<E.windowBits&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var w=s.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(w!==d)throw new Error(a[w]);if(E.header&&s.deflateSetHeader(this.strm,E.header),E.dictionary){var L;if(L=typeof E.dictionary=="string"?o.string2buf(E.dictionary):u.call(E.dictionary)==="[object ArrayBuffer]"?new Uint8Array(E.dictionary):E.dictionary,(w=s.deflateSetDictionary(this.strm,L))!==d)throw new Error(a[w]);this._dict_set=!0}}function v(b,E){var w=new _(E);if(w.push(b,!0),w.err)throw w.msg||a[w.err];return w.result}_.prototype.push=function(b,E){var w,L,x=this.strm,k=this.options.chunkSize;if(this.ended)return!1;L=E===~~E?E:E===!0?4:0,typeof b=="string"?x.input=o.string2buf(b):u.call(b)==="[object ArrayBuffer]"?x.input=new Uint8Array(b):x.input=b,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new l.Buf8(k),x.next_out=0,x.avail_out=k),(w=s.deflate(x,L))!==1&&w!==d)return this.onEnd(w),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||L!==4&&L!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(l.shrinkBuf(x.output,x.next_out))):this.onData(l.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&w!==1);return L===4?(w=s.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===d):L!==2||(this.onEnd(d),!(x.avail_out=0))},_.prototype.onData=function(b){this.chunks.push(b)},_.prototype.onEnd=function(b){b===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},r.Deflate=_,r.deflate=v,r.deflateRaw=function(b,E){return(E=E||{}).raw=!0,v(b,E)},r.gzip=function(b,E){return(E=E||{}).gzip=!0,v(b,E)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,n,r){var s=i("./zlib/inflate"),l=i("./utils/common"),o=i("./utils/strings"),a=i("./zlib/constants"),h=i("./zlib/messages"),u=i("./zlib/zstream"),d=i("./zlib/gzheader"),f=Object.prototype.toString;function c(_){if(!(this instanceof c))return new c(_);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},_||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||_&&_.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var b=s.inflateInit2(this.strm,v.windowBits);if(b!==a.Z_OK)throw new Error(h[b]);this.header=new d,s.inflateGetHeader(this.strm,this.header)}function g(_,v){var b=new c(v);if(b.push(_,!0),b.err)throw b.msg||h[b.err];return b.result}c.prototype.push=function(_,v){var b,E,w,L,x,k,P=this.strm,j=this.options.chunkSize,O=this.options.dictionary,Y=!1;if(this.ended)return!1;E=v===~~v?v:v===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof _=="string"?P.input=o.binstring2buf(_):f.call(_)==="[object ArrayBuffer]"?P.input=new Uint8Array(_):P.input=_,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new l.Buf8(j),P.next_out=0,P.avail_out=j),(b=s.inflate(P,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&O&&(k=typeof O=="string"?o.string2buf(O):f.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,b=s.inflateSetDictionary(this.strm,k)),b===a.Z_BUF_ERROR&&Y===!0&&(b=a.Z_OK,Y=!1),b!==a.Z_STREAM_END&&b!==a.Z_OK)return this.onEnd(b),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&b!==a.Z_STREAM_END&&(P.avail_in!==0||E!==a.Z_FINISH&&E!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=o.utf8border(P.output,P.next_out),L=P.next_out-w,x=o.buf2string(P.output,w),P.next_out=L,P.avail_out=j-L,L&&l.arraySet(P.output,P.output,w,L,0),this.onData(x)):this.onData(l.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(Y=!0)}while((0<P.avail_in||P.avail_out===0)&&b!==a.Z_STREAM_END);return b===a.Z_STREAM_END&&(E=a.Z_FINISH),E===a.Z_FINISH?(b=s.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===a.Z_OK):E!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(P.avail_out=0))},c.prototype.onData=function(_){this.chunks.push(_)},c.prototype.onEnd=function(_){_===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},r.Inflate=c,r.inflate=g,r.inflateRaw=function(_,v){return(v=v||{}).raw=!0,g(_,v)},r.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,n,r){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(a){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var u=h.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])}}return a},r.shrinkBuf=function(a,h){return a.length===h?a:a.subarray?a.subarray(0,h):(a.length=h,a)};var l={arraySet:function(a,h,u,d,f){if(h.subarray&&a.subarray)a.set(h.subarray(u,u+d),f);else for(var c=0;c<d;c++)a[f+c]=h[u+c]},flattenChunks:function(a){var h,u,d,f,c,g;for(h=d=0,u=a.length;h<u;h++)d+=a[h].length;for(g=new Uint8Array(d),h=f=0,u=a.length;h<u;h++)c=a[h],g.set(c,f),f+=c.length;return g}},o={arraySet:function(a,h,u,d,f){for(var c=0;c<d;c++)a[f+c]=h[u+c]},flattenChunks:function(a){return[].concat.apply([],a)}};r.setTyped=function(a){a?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,l)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(s)},{}],42:[function(i,n,r){var s=i("./common"),l=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new s.Buf8(256),h=0;h<256;h++)a[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function u(d,f){if(f<65537&&(d.subarray&&o||!d.subarray&&l))return String.fromCharCode.apply(null,s.shrinkBuf(d,f));for(var c="",g=0;g<f;g++)c+=String.fromCharCode(d[g]);return c}a[254]=a[254]=1,r.string2buf=function(d){var f,c,g,_,v,b=d.length,E=0;for(_=0;_<b;_++)(64512&(c=d.charCodeAt(_)))==55296&&_+1<b&&(64512&(g=d.charCodeAt(_+1)))==56320&&(c=65536+(c-55296<<10)+(g-56320),_++),E+=c<128?1:c<2048?2:c<65536?3:4;for(f=new s.Buf8(E),_=v=0;v<E;_++)(64512&(c=d.charCodeAt(_)))==55296&&_+1<b&&(64512&(g=d.charCodeAt(_+1)))==56320&&(c=65536+(c-55296<<10)+(g-56320),_++),c<128?f[v++]=c:(c<2048?f[v++]=192|c>>>6:(c<65536?f[v++]=224|c>>>12:(f[v++]=240|c>>>18,f[v++]=128|c>>>12&63),f[v++]=128|c>>>6&63),f[v++]=128|63&c);return f},r.buf2binstring=function(d){return u(d,d.length)},r.binstring2buf=function(d){for(var f=new s.Buf8(d.length),c=0,g=f.length;c<g;c++)f[c]=d.charCodeAt(c);return f},r.buf2string=function(d,f){var c,g,_,v,b=f||d.length,E=new Array(2*b);for(c=g=0;c<b;)if((_=d[c++])<128)E[g++]=_;else if(4<(v=a[_]))E[g++]=65533,c+=v-1;else{for(_&=v===2?31:v===3?15:7;1<v&&c<b;)_=_<<6|63&d[c++],v--;1<v?E[g++]=65533:_<65536?E[g++]=_:(_-=65536,E[g++]=55296|_>>10&1023,E[g++]=56320|1023&_)}return u(E,g)},r.utf8border=function(d,f){var c;for((f=f||d.length)>d.length&&(f=d.length),c=f-1;0<=c&&(192&d[c])==128;)c--;return c<0||c===0?f:c+a[d[c]]>f?c:f}},{"./common":41}],43:[function(i,n,r){n.exports=function(s,l,o,a){for(var h=65535&s|0,u=s>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;u=u+(h=h+l[a++]|0)|0,--d;);h%=65521,u%=65521}return h|u<<16|0}},{}],44:[function(i,n,r){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,n,r){var s=function(){for(var l,o=[],a=0;a<256;a++){l=a;for(var h=0;h<8;h++)l=1&l?3988292384^l>>>1:l>>>1;o[a]=l}return o}();n.exports=function(l,o,a,h){var u=s,d=h+a;l^=-1;for(var f=h;f<d;f++)l=l>>>8^u[255&(l^o[f])];return-1^l}},{}],46:[function(i,n,r){var s,l=i("../utils/common"),o=i("./trees"),a=i("./adler32"),h=i("./crc32"),u=i("./messages"),d=0,f=4,c=0,g=-2,_=-1,v=4,b=2,E=8,w=9,L=286,x=30,k=19,P=2*L+1,j=15,O=3,Y=258,tt=Y+O+1,S=42,$=113,p=1,F=2,st=3,X=4;function ct(m,M){return m.msg=u[M],M}function z(m){return(m<<1)-(4<m?9:0)}function rt(m){for(var M=m.length;0<=--M;)m[M]=0}function N(m){var M=m.state,A=M.pending;A>m.avail_out&&(A=m.avail_out),A!==0&&(l.arraySet(m.output,M.pending_buf,M.pending_out,A,m.next_out),m.next_out+=A,M.pending_out+=A,m.total_out+=A,m.avail_out-=A,M.pending-=A,M.pending===0&&(M.pending_out=0))}function B(m,M){o._tr_flush_block(m,0<=m.block_start?m.block_start:-1,m.strstart-m.block_start,M),m.block_start=m.strstart,N(m.strm)}function nt(m,M){m.pending_buf[m.pending++]=M}function Z(m,M){m.pending_buf[m.pending++]=M>>>8&255,m.pending_buf[m.pending++]=255&M}function q(m,M){var A,D,y=m.max_chain_length,C=m.strstart,H=m.prev_length,G=m.nice_match,R=m.strstart>m.w_size-tt?m.strstart-(m.w_size-tt):0,U=m.window,Q=m.w_mask,V=m.prev,et=m.strstart+Y,Et=U[C+H-1],ft=U[C+H];m.prev_length>=m.good_match&&(y>>=2),G>m.lookahead&&(G=m.lookahead);do if(U[(A=M)+H]===ft&&U[A+H-1]===Et&&U[A]===U[C]&&U[++A]===U[C+1]){C+=2,A++;do;while(U[++C]===U[++A]&&U[++C]===U[++A]&&U[++C]===U[++A]&&U[++C]===U[++A]&&U[++C]===U[++A]&&U[++C]===U[++A]&&U[++C]===U[++A]&&U[++C]===U[++A]&&C<et);if(D=Y-(et-C),C=et-Y,H<D){if(m.match_start=M,G<=(H=D))break;Et=U[C+H-1],ft=U[C+H]}}while((M=V[M&Q])>R&&--y!=0);return H<=m.lookahead?H:m.lookahead}function wt(m){var M,A,D,y,C,H,G,R,U,Q,V=m.w_size;do{if(y=m.window_size-m.lookahead-m.strstart,m.strstart>=V+(V-tt)){for(l.arraySet(m.window,m.window,V,V,0),m.match_start-=V,m.strstart-=V,m.block_start-=V,M=A=m.hash_size;D=m.head[--M],m.head[M]=V<=D?D-V:0,--A;);for(M=A=V;D=m.prev[--M],m.prev[M]=V<=D?D-V:0,--A;);y+=V}if(m.strm.avail_in===0)break;if(H=m.strm,G=m.window,R=m.strstart+m.lookahead,U=y,Q=void 0,Q=H.avail_in,U<Q&&(Q=U),A=Q===0?0:(H.avail_in-=Q,l.arraySet(G,H.input,H.next_in,Q,R),H.state.wrap===1?H.adler=a(H.adler,G,Q,R):H.state.wrap===2&&(H.adler=h(H.adler,G,Q,R)),H.next_in+=Q,H.total_in+=Q,Q),m.lookahead+=A,m.lookahead+m.insert>=O)for(C=m.strstart-m.insert,m.ins_h=m.window[C],m.ins_h=(m.ins_h<<m.hash_shift^m.window[C+1])&m.hash_mask;m.insert&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[C+O-1])&m.hash_mask,m.prev[C&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=C,C++,m.insert--,!(m.lookahead+m.insert<O)););}while(m.lookahead<tt&&m.strm.avail_in!==0)}function Rt(m,M){for(var A,D;;){if(m.lookahead<tt){if(wt(m),m.lookahead<tt&&M===d)return p;if(m.lookahead===0)break}if(A=0,m.lookahead>=O&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+O-1])&m.hash_mask,A=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),A!==0&&m.strstart-A<=m.w_size-tt&&(m.match_length=q(m,A)),m.match_length>=O)if(D=o._tr_tally(m,m.strstart-m.match_start,m.match_length-O),m.lookahead-=m.match_length,m.match_length<=m.max_lazy_match&&m.lookahead>=O){for(m.match_length--;m.strstart++,m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+O-1])&m.hash_mask,A=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart,--m.match_length!=0;);m.strstart++}else m.strstart+=m.match_length,m.match_length=0,m.ins_h=m.window[m.strstart],m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+1])&m.hash_mask;else D=o._tr_tally(m,0,m.window[m.strstart]),m.lookahead--,m.strstart++;if(D&&(B(m,!1),m.strm.avail_out===0))return p}return m.insert=m.strstart<O-1?m.strstart:O-1,M===f?(B(m,!0),m.strm.avail_out===0?st:X):m.last_lit&&(B(m,!1),m.strm.avail_out===0)?p:F}function ht(m,M){for(var A,D,y;;){if(m.lookahead<tt){if(wt(m),m.lookahead<tt&&M===d)return p;if(m.lookahead===0)break}if(A=0,m.lookahead>=O&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+O-1])&m.hash_mask,A=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),m.prev_length=m.match_length,m.prev_match=m.match_start,m.match_length=O-1,A!==0&&m.prev_length<m.max_lazy_match&&m.strstart-A<=m.w_size-tt&&(m.match_length=q(m,A),m.match_length<=5&&(m.strategy===1||m.match_length===O&&4096<m.strstart-m.match_start)&&(m.match_length=O-1)),m.prev_length>=O&&m.match_length<=m.prev_length){for(y=m.strstart+m.lookahead-O,D=o._tr_tally(m,m.strstart-1-m.prev_match,m.prev_length-O),m.lookahead-=m.prev_length-1,m.prev_length-=2;++m.strstart<=y&&(m.ins_h=(m.ins_h<<m.hash_shift^m.window[m.strstart+O-1])&m.hash_mask,A=m.prev[m.strstart&m.w_mask]=m.head[m.ins_h],m.head[m.ins_h]=m.strstart),--m.prev_length!=0;);if(m.match_available=0,m.match_length=O-1,m.strstart++,D&&(B(m,!1),m.strm.avail_out===0))return p}else if(m.match_available){if((D=o._tr_tally(m,0,m.window[m.strstart-1]))&&B(m,!1),m.strstart++,m.lookahead--,m.strm.avail_out===0)return p}else m.match_available=1,m.strstart++,m.lookahead--}return m.match_available&&(D=o._tr_tally(m,0,m.window[m.strstart-1]),m.match_available=0),m.insert=m.strstart<O-1?m.strstart:O-1,M===f?(B(m,!0),m.strm.avail_out===0?st:X):m.last_lit&&(B(m,!1),m.strm.avail_out===0)?p:F}function bt(m,M,A,D,y){this.good_length=m,this.max_lazy=M,this.nice_length=A,this.max_chain=D,this.func=y}function Lt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*P),this.dyn_dtree=new l.Buf16(2*(2*x+1)),this.bl_tree=new l.Buf16(2*(2*k+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(j+1),this.heap=new l.Buf16(2*L+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*L+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function St(m){var M;return m&&m.state?(m.total_in=m.total_out=0,m.data_type=b,(M=m.state).pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?S:$,m.adler=M.wrap===2?0:1,M.last_flush=d,o._tr_init(M),c):ct(m,g)}function jt(m){var M=St(m);return M===c&&function(A){A.window_size=2*A.w_size,rt(A.head),A.max_lazy_match=s[A.level].max_lazy,A.good_match=s[A.level].good_length,A.nice_match=s[A.level].nice_length,A.max_chain_length=s[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=O-1,A.match_available=0,A.ins_h=0}(m.state),M}function Mt(m,M,A,D,y,C){if(!m)return g;var H=1;if(M===_&&(M=6),D<0?(H=0,D=-D):15<D&&(H=2,D-=16),y<1||w<y||A!==E||D<8||15<D||M<0||9<M||C<0||v<C)return ct(m,g);D===8&&(D=9);var G=new Lt;return(m.state=G).strm=m,G.wrap=H,G.gzhead=null,G.w_bits=D,G.w_size=1<<G.w_bits,G.w_mask=G.w_size-1,G.hash_bits=y+7,G.hash_size=1<<G.hash_bits,G.hash_mask=G.hash_size-1,G.hash_shift=~~((G.hash_bits+O-1)/O),G.window=new l.Buf8(2*G.w_size),G.head=new l.Buf16(G.hash_size),G.prev=new l.Buf16(G.w_size),G.lit_bufsize=1<<y+6,G.pending_buf_size=4*G.lit_bufsize,G.pending_buf=new l.Buf8(G.pending_buf_size),G.d_buf=1*G.lit_bufsize,G.l_buf=3*G.lit_bufsize,G.level=M,G.strategy=C,G.method=A,jt(m)}s=[new bt(0,0,0,0,function(m,M){var A=65535;for(A>m.pending_buf_size-5&&(A=m.pending_buf_size-5);;){if(m.lookahead<=1){if(wt(m),m.lookahead===0&&M===d)return p;if(m.lookahead===0)break}m.strstart+=m.lookahead,m.lookahead=0;var D=m.block_start+A;if((m.strstart===0||m.strstart>=D)&&(m.lookahead=m.strstart-D,m.strstart=D,B(m,!1),m.strm.avail_out===0)||m.strstart-m.block_start>=m.w_size-tt&&(B(m,!1),m.strm.avail_out===0))return p}return m.insert=0,M===f?(B(m,!0),m.strm.avail_out===0?st:X):(m.strstart>m.block_start&&(B(m,!1),m.strm.avail_out),p)}),new bt(4,4,8,4,Rt),new bt(4,5,16,8,Rt),new bt(4,6,32,32,Rt),new bt(4,4,16,16,ht),new bt(8,16,32,32,ht),new bt(8,16,128,128,ht),new bt(8,32,128,256,ht),new bt(32,128,258,1024,ht),new bt(32,258,258,4096,ht)],r.deflateInit=function(m,M){return Mt(m,M,E,15,8,0)},r.deflateInit2=Mt,r.deflateReset=jt,r.deflateResetKeep=St,r.deflateSetHeader=function(m,M){return m&&m.state?m.state.wrap!==2?g:(m.state.gzhead=M,c):g},r.deflate=function(m,M){var A,D,y,C;if(!m||!m.state||5<M||M<0)return m?ct(m,g):g;if(D=m.state,!m.output||!m.input&&m.avail_in!==0||D.status===666&&M!==f)return ct(m,m.avail_out===0?-5:g);if(D.strm=m,A=D.last_flush,D.last_flush=M,D.status===S)if(D.wrap===2)m.adler=0,nt(D,31),nt(D,139),nt(D,8),D.gzhead?(nt(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),nt(D,255&D.gzhead.time),nt(D,D.gzhead.time>>8&255),nt(D,D.gzhead.time>>16&255),nt(D,D.gzhead.time>>24&255),nt(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),nt(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(nt(D,255&D.gzhead.extra.length),nt(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(m.adler=h(m.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(nt(D,0),nt(D,0),nt(D,0),nt(D,0),nt(D,0),nt(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),nt(D,3),D.status=$);else{var H=E+(D.w_bits-8<<4)<<8;H|=(2<=D.strategy||D.level<2?0:D.level<6?1:D.level===6?2:3)<<6,D.strstart!==0&&(H|=32),H+=31-H%31,D.status=$,Z(D,H),D.strstart!==0&&(Z(D,m.adler>>>16),Z(D,65535&m.adler)),m.adler=1}if(D.status===69)if(D.gzhead.extra){for(y=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>y&&(m.adler=h(m.adler,D.pending_buf,D.pending-y,y)),N(m),y=D.pending,D.pending!==D.pending_buf_size));)nt(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>y&&(m.adler=h(m.adler,D.pending_buf,D.pending-y,y)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(D.status===73)if(D.gzhead.name){y=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>y&&(m.adler=h(m.adler,D.pending_buf,D.pending-y,y)),N(m),y=D.pending,D.pending===D.pending_buf_size)){C=1;break}C=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,nt(D,C)}while(C!==0);D.gzhead.hcrc&&D.pending>y&&(m.adler=h(m.adler,D.pending_buf,D.pending-y,y)),C===0&&(D.gzindex=0,D.status=91)}else D.status=91;if(D.status===91)if(D.gzhead.comment){y=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>y&&(m.adler=h(m.adler,D.pending_buf,D.pending-y,y)),N(m),y=D.pending,D.pending===D.pending_buf_size)){C=1;break}C=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,nt(D,C)}while(C!==0);D.gzhead.hcrc&&D.pending>y&&(m.adler=h(m.adler,D.pending_buf,D.pending-y,y)),C===0&&(D.status=103)}else D.status=103;if(D.status===103&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&N(m),D.pending+2<=D.pending_buf_size&&(nt(D,255&m.adler),nt(D,m.adler>>8&255),m.adler=0,D.status=$)):D.status=$),D.pending!==0){if(N(m),m.avail_out===0)return D.last_flush=-1,c}else if(m.avail_in===0&&z(M)<=z(A)&&M!==f)return ct(m,-5);if(D.status===666&&m.avail_in!==0)return ct(m,-5);if(m.avail_in!==0||D.lookahead!==0||M!==d&&D.status!==666){var G=D.strategy===2?function(R,U){for(var Q;;){if(R.lookahead===0&&(wt(R),R.lookahead===0)){if(U===d)return p;break}if(R.match_length=0,Q=o._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,Q&&(B(R,!1),R.strm.avail_out===0))return p}return R.insert=0,U===f?(B(R,!0),R.strm.avail_out===0?st:X):R.last_lit&&(B(R,!1),R.strm.avail_out===0)?p:F}(D,M):D.strategy===3?function(R,U){for(var Q,V,et,Et,ft=R.window;;){if(R.lookahead<=Y){if(wt(R),R.lookahead<=Y&&U===d)return p;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=O&&0<R.strstart&&(V=ft[et=R.strstart-1])===ft[++et]&&V===ft[++et]&&V===ft[++et]){Et=R.strstart+Y;do;while(V===ft[++et]&&V===ft[++et]&&V===ft[++et]&&V===ft[++et]&&V===ft[++et]&&V===ft[++et]&&V===ft[++et]&&V===ft[++et]&&et<Et);R.match_length=Y-(Et-et),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=O?(Q=o._tr_tally(R,1,R.match_length-O),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(Q=o._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),Q&&(B(R,!1),R.strm.avail_out===0))return p}return R.insert=0,U===f?(B(R,!0),R.strm.avail_out===0?st:X):R.last_lit&&(B(R,!1),R.strm.avail_out===0)?p:F}(D,M):s[D.level].func(D,M);if(G!==st&&G!==X||(D.status=666),G===p||G===st)return m.avail_out===0&&(D.last_flush=-1),c;if(G===F&&(M===1?o._tr_align(D):M!==5&&(o._tr_stored_block(D,0,0,!1),M===3&&(rt(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),N(m),m.avail_out===0))return D.last_flush=-1,c}return M!==f?c:D.wrap<=0?1:(D.wrap===2?(nt(D,255&m.adler),nt(D,m.adler>>8&255),nt(D,m.adler>>16&255),nt(D,m.adler>>24&255),nt(D,255&m.total_in),nt(D,m.total_in>>8&255),nt(D,m.total_in>>16&255),nt(D,m.total_in>>24&255)):(Z(D,m.adler>>>16),Z(D,65535&m.adler)),N(m),0<D.wrap&&(D.wrap=-D.wrap),D.pending!==0?c:1)},r.deflateEnd=function(m){var M;return m&&m.state?(M=m.state.status)!==S&&M!==69&&M!==73&&M!==91&&M!==103&&M!==$&&M!==666?ct(m,g):(m.state=null,M===$?ct(m,-3):c):g},r.deflateSetDictionary=function(m,M){var A,D,y,C,H,G,R,U,Q=M.length;if(!m||!m.state||(C=(A=m.state).wrap)===2||C===1&&A.status!==S||A.lookahead)return g;for(C===1&&(m.adler=a(m.adler,M,Q,0)),A.wrap=0,Q>=A.w_size&&(C===0&&(rt(A.head),A.strstart=0,A.block_start=0,A.insert=0),U=new l.Buf8(A.w_size),l.arraySet(U,M,Q-A.w_size,A.w_size,0),M=U,Q=A.w_size),H=m.avail_in,G=m.next_in,R=m.input,m.avail_in=Q,m.next_in=0,m.input=M,wt(A);A.lookahead>=O;){for(D=A.strstart,y=A.lookahead-(O-1);A.ins_h=(A.ins_h<<A.hash_shift^A.window[D+O-1])&A.hash_mask,A.prev[D&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=D,D++,--y;);A.strstart=D,A.lookahead=O-1,wt(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=O-1,A.match_available=0,m.next_in=G,m.input=R,m.avail_in=H,A.wrap=C,c},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,n,r){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,n,r){n.exports=function(s,l){var o,a,h,u,d,f,c,g,_,v,b,E,w,L,x,k,P,j,O,Y,tt,S,$,p,F;o=s.state,a=s.next_in,p=s.input,h=a+(s.avail_in-5),u=s.next_out,F=s.output,d=u-(l-s.avail_out),f=u+(s.avail_out-257),c=o.dmax,g=o.wsize,_=o.whave,v=o.wnext,b=o.window,E=o.hold,w=o.bits,L=o.lencode,x=o.distcode,k=(1<<o.lenbits)-1,P=(1<<o.distbits)-1;t:do{w<15&&(E+=p[a++]<<w,w+=8,E+=p[a++]<<w,w+=8),j=L[E&k];e:for(;;){if(E>>>=O=j>>>24,w-=O,(O=j>>>16&255)===0)F[u++]=65535&j;else{if(!(16&O)){if(!(64&O)){j=L[(65535&j)+(E&(1<<O)-1)];continue e}if(32&O){o.mode=12;break t}s.msg="invalid literal/length code",o.mode=30;break t}Y=65535&j,(O&=15)&&(w<O&&(E+=p[a++]<<w,w+=8),Y+=E&(1<<O)-1,E>>>=O,w-=O),w<15&&(E+=p[a++]<<w,w+=8,E+=p[a++]<<w,w+=8),j=x[E&P];i:for(;;){if(E>>>=O=j>>>24,w-=O,!(16&(O=j>>>16&255))){if(!(64&O)){j=x[(65535&j)+(E&(1<<O)-1)];continue i}s.msg="invalid distance code",o.mode=30;break t}if(tt=65535&j,w<(O&=15)&&(E+=p[a++]<<w,(w+=8)<O&&(E+=p[a++]<<w,w+=8)),c<(tt+=E&(1<<O)-1)){s.msg="invalid distance too far back",o.mode=30;break t}if(E>>>=O,w-=O,(O=u-d)<tt){if(_<(O=tt-O)&&o.sane){s.msg="invalid distance too far back",o.mode=30;break t}if($=b,(S=0)===v){if(S+=g-O,O<Y){for(Y-=O;F[u++]=b[S++],--O;);S=u-tt,$=F}}else if(v<O){if(S+=g+v-O,(O-=v)<Y){for(Y-=O;F[u++]=b[S++],--O;);if(S=0,v<Y){for(Y-=O=v;F[u++]=b[S++],--O;);S=u-tt,$=F}}}else if(S+=v-O,O<Y){for(Y-=O;F[u++]=b[S++],--O;);S=u-tt,$=F}for(;2<Y;)F[u++]=$[S++],F[u++]=$[S++],F[u++]=$[S++],Y-=3;Y&&(F[u++]=$[S++],1<Y&&(F[u++]=$[S++]))}else{for(S=u-tt;F[u++]=F[S++],F[u++]=F[S++],F[u++]=F[S++],2<(Y-=3););Y&&(F[u++]=F[S++],1<Y&&(F[u++]=F[S++]))}break}}break}}while(a<h&&u<f);a-=Y=w>>3,E&=(1<<(w-=Y<<3))-1,s.next_in=a,s.next_out=u,s.avail_in=a<h?h-a+5:5-(a-h),s.avail_out=u<f?f-u+257:257-(u-f),o.hold=E,o.bits=w}},{}],49:[function(i,n,r){var s=i("../utils/common"),l=i("./adler32"),o=i("./crc32"),a=i("./inffast"),h=i("./inftrees"),u=1,d=2,f=0,c=-2,g=1,_=852,v=592;function b(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function E(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(S){var $;return S&&S.state?($=S.state,S.total_in=S.total_out=$.total=0,S.msg="",$.wrap&&(S.adler=1&$.wrap),$.mode=g,$.last=0,$.havedict=0,$.dmax=32768,$.head=null,$.hold=0,$.bits=0,$.lencode=$.lendyn=new s.Buf32(_),$.distcode=$.distdyn=new s.Buf32(v),$.sane=1,$.back=-1,f):c}function L(S){var $;return S&&S.state?(($=S.state).wsize=0,$.whave=0,$.wnext=0,w(S)):c}function x(S,$){var p,F;return S&&S.state?(F=S.state,$<0?(p=0,$=-$):(p=1+($>>4),$<48&&($&=15)),$&&($<8||15<$)?c:(F.window!==null&&F.wbits!==$&&(F.window=null),F.wrap=p,F.wbits=$,L(S))):c}function k(S,$){var p,F;return S?(F=new E,(S.state=F).window=null,(p=x(S,$))!==f&&(S.state=null),p):c}var P,j,O=!0;function Y(S){if(O){var $;for(P=new s.Buf32(512),j=new s.Buf32(32),$=0;$<144;)S.lens[$++]=8;for(;$<256;)S.lens[$++]=9;for(;$<280;)S.lens[$++]=7;for(;$<288;)S.lens[$++]=8;for(h(u,S.lens,0,288,P,0,S.work,{bits:9}),$=0;$<32;)S.lens[$++]=5;h(d,S.lens,0,32,j,0,S.work,{bits:5}),O=!1}S.lencode=P,S.lenbits=9,S.distcode=j,S.distbits=5}function tt(S,$,p,F){var st,X=S.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new s.Buf8(X.wsize)),F>=X.wsize?(s.arraySet(X.window,$,p-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(F<(st=X.wsize-X.wnext)&&(st=F),s.arraySet(X.window,$,p-F,st,X.wnext),(F-=st)?(s.arraySet(X.window,$,p-F,F,0),X.wnext=F,X.whave=X.wsize):(X.wnext+=st,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=st))),0}r.inflateReset=L,r.inflateReset2=x,r.inflateResetKeep=w,r.inflateInit=function(S){return k(S,15)},r.inflateInit2=k,r.inflate=function(S,$){var p,F,st,X,ct,z,rt,N,B,nt,Z,q,wt,Rt,ht,bt,Lt,St,jt,Mt,m,M,A,D,y=0,C=new s.Buf8(4),H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return c;(p=S.state).mode===12&&(p.mode=13),ct=S.next_out,st=S.output,rt=S.avail_out,X=S.next_in,F=S.input,z=S.avail_in,N=p.hold,B=p.bits,nt=z,Z=rt,M=f;t:for(;;)switch(p.mode){case g:if(p.wrap===0){p.mode=13;break}for(;B<16;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(2&p.wrap&&N===35615){C[p.check=0]=255&N,C[1]=N>>>8&255,p.check=o(p.check,C,2,0),B=N=0,p.mode=2;break}if(p.flags=0,p.head&&(p.head.done=!1),!(1&p.wrap)||(((255&N)<<8)+(N>>8))%31){S.msg="incorrect header check",p.mode=30;break}if((15&N)!=8){S.msg="unknown compression method",p.mode=30;break}if(B-=4,m=8+(15&(N>>>=4)),p.wbits===0)p.wbits=m;else if(m>p.wbits){S.msg="invalid window size",p.mode=30;break}p.dmax=1<<m,S.adler=p.check=1,p.mode=512&N?10:12,B=N=0;break;case 2:for(;B<16;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(p.flags=N,(255&p.flags)!=8){S.msg="unknown compression method",p.mode=30;break}if(57344&p.flags){S.msg="unknown header flags set",p.mode=30;break}p.head&&(p.head.text=N>>8&1),512&p.flags&&(C[0]=255&N,C[1]=N>>>8&255,p.check=o(p.check,C,2,0)),B=N=0,p.mode=3;case 3:for(;B<32;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}p.head&&(p.head.time=N),512&p.flags&&(C[0]=255&N,C[1]=N>>>8&255,C[2]=N>>>16&255,C[3]=N>>>24&255,p.check=o(p.check,C,4,0)),B=N=0,p.mode=4;case 4:for(;B<16;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}p.head&&(p.head.xflags=255&N,p.head.os=N>>8),512&p.flags&&(C[0]=255&N,C[1]=N>>>8&255,p.check=o(p.check,C,2,0)),B=N=0,p.mode=5;case 5:if(1024&p.flags){for(;B<16;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}p.length=N,p.head&&(p.head.extra_len=N),512&p.flags&&(C[0]=255&N,C[1]=N>>>8&255,p.check=o(p.check,C,2,0)),B=N=0}else p.head&&(p.head.extra=null);p.mode=6;case 6:if(1024&p.flags&&(z<(q=p.length)&&(q=z),q&&(p.head&&(m=p.head.extra_len-p.length,p.head.extra||(p.head.extra=new Array(p.head.extra_len)),s.arraySet(p.head.extra,F,X,q,m)),512&p.flags&&(p.check=o(p.check,F,q,X)),z-=q,X+=q,p.length-=q),p.length))break t;p.length=0,p.mode=7;case 7:if(2048&p.flags){if(z===0)break t;for(q=0;m=F[X+q++],p.head&&m&&p.length<65536&&(p.head.name+=String.fromCharCode(m)),m&&q<z;);if(512&p.flags&&(p.check=o(p.check,F,q,X)),z-=q,X+=q,m)break t}else p.head&&(p.head.name=null);p.length=0,p.mode=8;case 8:if(4096&p.flags){if(z===0)break t;for(q=0;m=F[X+q++],p.head&&m&&p.length<65536&&(p.head.comment+=String.fromCharCode(m)),m&&q<z;);if(512&p.flags&&(p.check=o(p.check,F,q,X)),z-=q,X+=q,m)break t}else p.head&&(p.head.comment=null);p.mode=9;case 9:if(512&p.flags){for(;B<16;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(N!==(65535&p.check)){S.msg="header crc mismatch",p.mode=30;break}B=N=0}p.head&&(p.head.hcrc=p.flags>>9&1,p.head.done=!0),S.adler=p.check=0,p.mode=12;break;case 10:for(;B<32;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}S.adler=p.check=b(N),B=N=0,p.mode=11;case 11:if(p.havedict===0)return S.next_out=ct,S.avail_out=rt,S.next_in=X,S.avail_in=z,p.hold=N,p.bits=B,2;S.adler=p.check=1,p.mode=12;case 12:if($===5||$===6)break t;case 13:if(p.last){N>>>=7&B,B-=7&B,p.mode=27;break}for(;B<3;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}switch(p.last=1&N,B-=1,3&(N>>>=1)){case 0:p.mode=14;break;case 1:if(Y(p),p.mode=20,$!==6)break;N>>>=2,B-=2;break t;case 2:p.mode=17;break;case 3:S.msg="invalid block type",p.mode=30}N>>>=2,B-=2;break;case 14:for(N>>>=7&B,B-=7&B;B<32;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if((65535&N)!=(N>>>16^65535)){S.msg="invalid stored block lengths",p.mode=30;break}if(p.length=65535&N,B=N=0,p.mode=15,$===6)break t;case 15:p.mode=16;case 16:if(q=p.length){if(z<q&&(q=z),rt<q&&(q=rt),q===0)break t;s.arraySet(st,F,X,q,ct),z-=q,X+=q,rt-=q,ct+=q,p.length-=q;break}p.mode=12;break;case 17:for(;B<14;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(p.nlen=257+(31&N),N>>>=5,B-=5,p.ndist=1+(31&N),N>>>=5,B-=5,p.ncode=4+(15&N),N>>>=4,B-=4,286<p.nlen||30<p.ndist){S.msg="too many length or distance symbols",p.mode=30;break}p.have=0,p.mode=18;case 18:for(;p.have<p.ncode;){for(;B<3;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}p.lens[H[p.have++]]=7&N,N>>>=3,B-=3}for(;p.have<19;)p.lens[H[p.have++]]=0;if(p.lencode=p.lendyn,p.lenbits=7,A={bits:p.lenbits},M=h(0,p.lens,0,19,p.lencode,0,p.work,A),p.lenbits=A.bits,M){S.msg="invalid code lengths set",p.mode=30;break}p.have=0,p.mode=19;case 19:for(;p.have<p.nlen+p.ndist;){for(;bt=(y=p.lencode[N&(1<<p.lenbits)-1])>>>16&255,Lt=65535&y,!((ht=y>>>24)<=B);){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(Lt<16)N>>>=ht,B-=ht,p.lens[p.have++]=Lt;else{if(Lt===16){for(D=ht+2;B<D;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(N>>>=ht,B-=ht,p.have===0){S.msg="invalid bit length repeat",p.mode=30;break}m=p.lens[p.have-1],q=3+(3&N),N>>>=2,B-=2}else if(Lt===17){for(D=ht+3;B<D;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}B-=ht,m=0,q=3+(7&(N>>>=ht)),N>>>=3,B-=3}else{for(D=ht+7;B<D;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}B-=ht,m=0,q=11+(127&(N>>>=ht)),N>>>=7,B-=7}if(p.have+q>p.nlen+p.ndist){S.msg="invalid bit length repeat",p.mode=30;break}for(;q--;)p.lens[p.have++]=m}}if(p.mode===30)break;if(p.lens[256]===0){S.msg="invalid code -- missing end-of-block",p.mode=30;break}if(p.lenbits=9,A={bits:p.lenbits},M=h(u,p.lens,0,p.nlen,p.lencode,0,p.work,A),p.lenbits=A.bits,M){S.msg="invalid literal/lengths set",p.mode=30;break}if(p.distbits=6,p.distcode=p.distdyn,A={bits:p.distbits},M=h(d,p.lens,p.nlen,p.ndist,p.distcode,0,p.work,A),p.distbits=A.bits,M){S.msg="invalid distances set",p.mode=30;break}if(p.mode=20,$===6)break t;case 20:p.mode=21;case 21:if(6<=z&&258<=rt){S.next_out=ct,S.avail_out=rt,S.next_in=X,S.avail_in=z,p.hold=N,p.bits=B,a(S,Z),ct=S.next_out,st=S.output,rt=S.avail_out,X=S.next_in,F=S.input,z=S.avail_in,N=p.hold,B=p.bits,p.mode===12&&(p.back=-1);break}for(p.back=0;bt=(y=p.lencode[N&(1<<p.lenbits)-1])>>>16&255,Lt=65535&y,!((ht=y>>>24)<=B);){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(bt&&!(240&bt)){for(St=ht,jt=bt,Mt=Lt;bt=(y=p.lencode[Mt+((N&(1<<St+jt)-1)>>St)])>>>16&255,Lt=65535&y,!(St+(ht=y>>>24)<=B);){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}N>>>=St,B-=St,p.back+=St}if(N>>>=ht,B-=ht,p.back+=ht,p.length=Lt,bt===0){p.mode=26;break}if(32&bt){p.back=-1,p.mode=12;break}if(64&bt){S.msg="invalid literal/length code",p.mode=30;break}p.extra=15&bt,p.mode=22;case 22:if(p.extra){for(D=p.extra;B<D;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}p.length+=N&(1<<p.extra)-1,N>>>=p.extra,B-=p.extra,p.back+=p.extra}p.was=p.length,p.mode=23;case 23:for(;bt=(y=p.distcode[N&(1<<p.distbits)-1])>>>16&255,Lt=65535&y,!((ht=y>>>24)<=B);){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(!(240&bt)){for(St=ht,jt=bt,Mt=Lt;bt=(y=p.distcode[Mt+((N&(1<<St+jt)-1)>>St)])>>>16&255,Lt=65535&y,!(St+(ht=y>>>24)<=B);){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}N>>>=St,B-=St,p.back+=St}if(N>>>=ht,B-=ht,p.back+=ht,64&bt){S.msg="invalid distance code",p.mode=30;break}p.offset=Lt,p.extra=15&bt,p.mode=24;case 24:if(p.extra){for(D=p.extra;B<D;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}p.offset+=N&(1<<p.extra)-1,N>>>=p.extra,B-=p.extra,p.back+=p.extra}if(p.offset>p.dmax){S.msg="invalid distance too far back",p.mode=30;break}p.mode=25;case 25:if(rt===0)break t;if(q=Z-rt,p.offset>q){if((q=p.offset-q)>p.whave&&p.sane){S.msg="invalid distance too far back",p.mode=30;break}wt=q>p.wnext?(q-=p.wnext,p.wsize-q):p.wnext-q,q>p.length&&(q=p.length),Rt=p.window}else Rt=st,wt=ct-p.offset,q=p.length;for(rt<q&&(q=rt),rt-=q,p.length-=q;st[ct++]=Rt[wt++],--q;);p.length===0&&(p.mode=21);break;case 26:if(rt===0)break t;st[ct++]=p.length,rt--,p.mode=21;break;case 27:if(p.wrap){for(;B<32;){if(z===0)break t;z--,N|=F[X++]<<B,B+=8}if(Z-=rt,S.total_out+=Z,p.total+=Z,Z&&(S.adler=p.check=p.flags?o(p.check,st,Z,ct-Z):l(p.check,st,Z,ct-Z)),Z=rt,(p.flags?N:b(N))!==p.check){S.msg="incorrect data check",p.mode=30;break}B=N=0}p.mode=28;case 28:if(p.wrap&&p.flags){for(;B<32;){if(z===0)break t;z--,N+=F[X++]<<B,B+=8}if(N!==(4294967295&p.total)){S.msg="incorrect length check",p.mode=30;break}B=N=0}p.mode=29;case 29:M=1;break t;case 30:M=-3;break t;case 31:return-4;case 32:default:return c}return S.next_out=ct,S.avail_out=rt,S.next_in=X,S.avail_in=z,p.hold=N,p.bits=B,(p.wsize||Z!==S.avail_out&&p.mode<30&&(p.mode<27||$!==4))&&tt(S,S.output,S.next_out,Z-S.avail_out)?(p.mode=31,-4):(nt-=S.avail_in,Z-=S.avail_out,S.total_in+=nt,S.total_out+=Z,p.total+=Z,p.wrap&&Z&&(S.adler=p.check=p.flags?o(p.check,st,Z,S.next_out-Z):l(p.check,st,Z,S.next_out-Z)),S.data_type=p.bits+(p.last?64:0)+(p.mode===12?128:0)+(p.mode===20||p.mode===15?256:0),(nt==0&&Z===0||$===4)&&M===f&&(M=-5),M)},r.inflateEnd=function(S){if(!S||!S.state)return c;var $=S.state;return $.window&&($.window=null),S.state=null,f},r.inflateGetHeader=function(S,$){var p;return S&&S.state&&2&(p=S.state).wrap?((p.head=$).done=!1,f):c},r.inflateSetDictionary=function(S,$){var p,F=$.length;return S&&S.state?(p=S.state).wrap!==0&&p.mode!==11?c:p.mode===11&&l(1,$,F,0)!==p.check?-3:tt(S,$,F,F)?(p.mode=31,-4):(p.havedict=1,f):c},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,n,r){var s=i("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,d,f,c,g,_,v,b){var E,w,L,x,k,P,j,O,Y,tt=b.bits,S=0,$=0,p=0,F=0,st=0,X=0,ct=0,z=0,rt=0,N=0,B=null,nt=0,Z=new s.Buf16(16),q=new s.Buf16(16),wt=null,Rt=0;for(S=0;S<=15;S++)Z[S]=0;for($=0;$<c;$++)Z[d[f+$]]++;for(st=tt,F=15;1<=F&&Z[F]===0;F--);if(F<st&&(st=F),F===0)return g[_++]=20971520,g[_++]=20971520,b.bits=1,0;for(p=1;p<F&&Z[p]===0;p++);for(st<p&&(st=p),S=z=1;S<=15;S++)if(z<<=1,(z-=Z[S])<0)return-1;if(0<z&&(u===0||F!==1))return-1;for(q[1]=0,S=1;S<15;S++)q[S+1]=q[S]+Z[S];for($=0;$<c;$++)d[f+$]!==0&&(v[q[d[f+$]]++]=$);if(P=u===0?(B=wt=v,19):u===1?(B=l,nt-=257,wt=o,Rt-=257,256):(B=a,wt=h,-1),S=p,k=_,ct=$=N=0,L=-1,x=(rt=1<<(X=st))-1,u===1&&852<rt||u===2&&592<rt)return 1;for(;;){for(j=S-ct,Y=v[$]<P?(O=0,v[$]):v[$]>P?(O=wt[Rt+v[$]],B[nt+v[$]]):(O=96,0),E=1<<S-ct,p=w=1<<X;g[k+(N>>ct)+(w-=E)]=j<<24|O<<16|Y|0,w!==0;);for(E=1<<S-1;N&E;)E>>=1;if(E!==0?(N&=E-1,N+=E):N=0,$++,--Z[S]==0){if(S===F)break;S=d[f+v[$]]}if(st<S&&(N&x)!==L){for(ct===0&&(ct=st),k+=p,z=1<<(X=S-ct);X+ct<F&&!((z-=Z[X+ct])<=0);)X++,z<<=1;if(rt+=1<<X,u===1&&852<rt||u===2&&592<rt)return 1;g[L=N&x]=st<<24|X<<16|k-_|0}}return N!==0&&(g[k+N]=S-ct<<24|64<<16|0),b.bits=st,0}},{"../utils/common":41}],51:[function(i,n,r){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,n,r){var s=i("../utils/common"),l=0,o=1;function a(y){for(var C=y.length;0<=--C;)y[C]=0}var h=0,u=29,d=256,f=d+1+u,c=30,g=19,_=2*f+1,v=15,b=16,E=7,w=256,L=16,x=17,k=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],tt=new Array(2*(f+2));a(tt);var S=new Array(2*c);a(S);var $=new Array(512);a($);var p=new Array(256);a(p);var F=new Array(u);a(F);var st,X,ct,z=new Array(c);function rt(y,C,H,G,R){this.static_tree=y,this.extra_bits=C,this.extra_base=H,this.elems=G,this.max_length=R,this.has_stree=y&&y.length}function N(y,C){this.dyn_tree=y,this.max_code=0,this.stat_desc=C}function B(y){return y<256?$[y]:$[256+(y>>>7)]}function nt(y,C){y.pending_buf[y.pending++]=255&C,y.pending_buf[y.pending++]=C>>>8&255}function Z(y,C,H){y.bi_valid>b-H?(y.bi_buf|=C<<y.bi_valid&65535,nt(y,y.bi_buf),y.bi_buf=C>>b-y.bi_valid,y.bi_valid+=H-b):(y.bi_buf|=C<<y.bi_valid&65535,y.bi_valid+=H)}function q(y,C,H){Z(y,H[2*C],H[2*C+1])}function wt(y,C){for(var H=0;H|=1&y,y>>>=1,H<<=1,0<--C;);return H>>>1}function Rt(y,C,H){var G,R,U=new Array(v+1),Q=0;for(G=1;G<=v;G++)U[G]=Q=Q+H[G-1]<<1;for(R=0;R<=C;R++){var V=y[2*R+1];V!==0&&(y[2*R]=wt(U[V]++,V))}}function ht(y){var C;for(C=0;C<f;C++)y.dyn_ltree[2*C]=0;for(C=0;C<c;C++)y.dyn_dtree[2*C]=0;for(C=0;C<g;C++)y.bl_tree[2*C]=0;y.dyn_ltree[2*w]=1,y.opt_len=y.static_len=0,y.last_lit=y.matches=0}function bt(y){8<y.bi_valid?nt(y,y.bi_buf):0<y.bi_valid&&(y.pending_buf[y.pending++]=y.bi_buf),y.bi_buf=0,y.bi_valid=0}function Lt(y,C,H,G){var R=2*C,U=2*H;return y[R]<y[U]||y[R]===y[U]&&G[C]<=G[H]}function St(y,C,H){for(var G=y.heap[H],R=H<<1;R<=y.heap_len&&(R<y.heap_len&&Lt(C,y.heap[R+1],y.heap[R],y.depth)&&R++,!Lt(C,G,y.heap[R],y.depth));)y.heap[H]=y.heap[R],H=R,R<<=1;y.heap[H]=G}function jt(y,C,H){var G,R,U,Q,V=0;if(y.last_lit!==0)for(;G=y.pending_buf[y.d_buf+2*V]<<8|y.pending_buf[y.d_buf+2*V+1],R=y.pending_buf[y.l_buf+V],V++,G===0?q(y,R,C):(q(y,(U=p[R])+d+1,C),(Q=P[U])!==0&&Z(y,R-=F[U],Q),q(y,U=B(--G),H),(Q=j[U])!==0&&Z(y,G-=z[U],Q)),V<y.last_lit;);q(y,w,C)}function Mt(y,C){var H,G,R,U=C.dyn_tree,Q=C.stat_desc.static_tree,V=C.stat_desc.has_stree,et=C.stat_desc.elems,Et=-1;for(y.heap_len=0,y.heap_max=_,H=0;H<et;H++)U[2*H]!==0?(y.heap[++y.heap_len]=Et=H,y.depth[H]=0):U[2*H+1]=0;for(;y.heap_len<2;)U[2*(R=y.heap[++y.heap_len]=Et<2?++Et:0)]=1,y.depth[R]=0,y.opt_len--,V&&(y.static_len-=Q[2*R+1]);for(C.max_code=Et,H=y.heap_len>>1;1<=H;H--)St(y,U,H);for(R=et;H=y.heap[1],y.heap[1]=y.heap[y.heap_len--],St(y,U,1),G=y.heap[1],y.heap[--y.heap_max]=H,y.heap[--y.heap_max]=G,U[2*R]=U[2*H]+U[2*G],y.depth[R]=(y.depth[H]>=y.depth[G]?y.depth[H]:y.depth[G])+1,U[2*H+1]=U[2*G+1]=R,y.heap[1]=R++,St(y,U,1),2<=y.heap_len;);y.heap[--y.heap_max]=y.heap[1],function(ft,It){var Be,Xt,Ne,Ct,si,wi,Vt=It.dyn_tree,Qi=It.max_code,Rn=It.stat_desc.static_tree,Bn=It.stat_desc.has_stree,Nn=It.stat_desc.extra_bits,tn=It.stat_desc.extra_base,Ae=It.stat_desc.max_length,ai=0;for(Ct=0;Ct<=v;Ct++)ft.bl_count[Ct]=0;for(Vt[2*ft.heap[ft.heap_max]+1]=0,Be=ft.heap_max+1;Be<_;Be++)Ae<(Ct=Vt[2*Vt[2*(Xt=ft.heap[Be])+1]+1]+1)&&(Ct=Ae,ai++),Vt[2*Xt+1]=Ct,Qi<Xt||(ft.bl_count[Ct]++,si=0,tn<=Xt&&(si=Nn[Xt-tn]),wi=Vt[2*Xt],ft.opt_len+=wi*(Ct+si),Bn&&(ft.static_len+=wi*(Rn[2*Xt+1]+si)));if(ai!==0){do{for(Ct=Ae-1;ft.bl_count[Ct]===0;)Ct--;ft.bl_count[Ct]--,ft.bl_count[Ct+1]+=2,ft.bl_count[Ae]--,ai-=2}while(0<ai);for(Ct=Ae;Ct!==0;Ct--)for(Xt=ft.bl_count[Ct];Xt!==0;)Qi<(Ne=ft.heap[--Be])||(Vt[2*Ne+1]!==Ct&&(ft.opt_len+=(Ct-Vt[2*Ne+1])*Vt[2*Ne],Vt[2*Ne+1]=Ct),Xt--)}}(y,C),Rt(U,Et,y.bl_count)}function m(y,C,H){var G,R,U=-1,Q=C[1],V=0,et=7,Et=4;for(Q===0&&(et=138,Et=3),C[2*(H+1)+1]=65535,G=0;G<=H;G++)R=Q,Q=C[2*(G+1)+1],++V<et&&R===Q||(V<Et?y.bl_tree[2*R]+=V:R!==0?(R!==U&&y.bl_tree[2*R]++,y.bl_tree[2*L]++):V<=10?y.bl_tree[2*x]++:y.bl_tree[2*k]++,U=R,Et=(V=0)===Q?(et=138,3):R===Q?(et=6,3):(et=7,4))}function M(y,C,H){var G,R,U=-1,Q=C[1],V=0,et=7,Et=4;for(Q===0&&(et=138,Et=3),G=0;G<=H;G++)if(R=Q,Q=C[2*(G+1)+1],!(++V<et&&R===Q)){if(V<Et)for(;q(y,R,y.bl_tree),--V!=0;);else R!==0?(R!==U&&(q(y,R,y.bl_tree),V--),q(y,L,y.bl_tree),Z(y,V-3,2)):V<=10?(q(y,x,y.bl_tree),Z(y,V-3,3)):(q(y,k,y.bl_tree),Z(y,V-11,7));U=R,Et=(V=0)===Q?(et=138,3):R===Q?(et=6,3):(et=7,4)}}a(z);var A=!1;function D(y,C,H,G){Z(y,(h<<1)+(G?1:0),3),function(R,U,Q,V){bt(R),V&&(nt(R,Q),nt(R,~Q)),s.arraySet(R.pending_buf,R.window,U,Q,R.pending),R.pending+=Q}(y,C,H,!0)}r._tr_init=function(y){A||(function(){var C,H,G,R,U,Q=new Array(v+1);for(R=G=0;R<u-1;R++)for(F[R]=G,C=0;C<1<<P[R];C++)p[G++]=R;for(p[G-1]=R,R=U=0;R<16;R++)for(z[R]=U,C=0;C<1<<j[R];C++)$[U++]=R;for(U>>=7;R<c;R++)for(z[R]=U<<7,C=0;C<1<<j[R]-7;C++)$[256+U++]=R;for(H=0;H<=v;H++)Q[H]=0;for(C=0;C<=143;)tt[2*C+1]=8,C++,Q[8]++;for(;C<=255;)tt[2*C+1]=9,C++,Q[9]++;for(;C<=279;)tt[2*C+1]=7,C++,Q[7]++;for(;C<=287;)tt[2*C+1]=8,C++,Q[8]++;for(Rt(tt,f+1,Q),C=0;C<c;C++)S[2*C+1]=5,S[2*C]=wt(C,5);st=new rt(tt,P,d+1,f,v),X=new rt(S,j,0,c,v),ct=new rt(new Array(0),O,0,g,E)}(),A=!0),y.l_desc=new N(y.dyn_ltree,st),y.d_desc=new N(y.dyn_dtree,X),y.bl_desc=new N(y.bl_tree,ct),y.bi_buf=0,y.bi_valid=0,ht(y)},r._tr_stored_block=D,r._tr_flush_block=function(y,C,H,G){var R,U,Q=0;0<y.level?(y.strm.data_type===2&&(y.strm.data_type=function(V){var et,Et=4093624447;for(et=0;et<=31;et++,Et>>>=1)if(1&Et&&V.dyn_ltree[2*et]!==0)return l;if(V.dyn_ltree[18]!==0||V.dyn_ltree[20]!==0||V.dyn_ltree[26]!==0)return o;for(et=32;et<d;et++)if(V.dyn_ltree[2*et]!==0)return o;return l}(y)),Mt(y,y.l_desc),Mt(y,y.d_desc),Q=function(V){var et;for(m(V,V.dyn_ltree,V.l_desc.max_code),m(V,V.dyn_dtree,V.d_desc.max_code),Mt(V,V.bl_desc),et=g-1;3<=et&&V.bl_tree[2*Y[et]+1]===0;et--);return V.opt_len+=3*(et+1)+5+5+4,et}(y),R=y.opt_len+3+7>>>3,(U=y.static_len+3+7>>>3)<=R&&(R=U)):R=U=H+5,H+4<=R&&C!==-1?D(y,C,H,G):y.strategy===4||U===R?(Z(y,2+(G?1:0),3),jt(y,tt,S)):(Z(y,4+(G?1:0),3),function(V,et,Et,ft){var It;for(Z(V,et-257,5),Z(V,Et-1,5),Z(V,ft-4,4),It=0;It<ft;It++)Z(V,V.bl_tree[2*Y[It]+1],3);M(V,V.dyn_ltree,et-1),M(V,V.dyn_dtree,Et-1)}(y,y.l_desc.max_code+1,y.d_desc.max_code+1,Q+1),jt(y,y.dyn_ltree,y.dyn_dtree)),ht(y),G&&bt(y)},r._tr_tally=function(y,C,H){return y.pending_buf[y.d_buf+2*y.last_lit]=C>>>8&255,y.pending_buf[y.d_buf+2*y.last_lit+1]=255&C,y.pending_buf[y.l_buf+y.last_lit]=255&H,y.last_lit++,C===0?y.dyn_ltree[2*H]++:(y.matches++,C--,y.dyn_ltree[2*(p[H]+d+1)]++,y.dyn_dtree[2*B(C)]++),y.last_lit===y.lit_bufsize-1},r._tr_align=function(y){Z(y,2,3),q(y,w,tt),function(C){C.bi_valid===16?(nt(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):8<=C.bi_valid&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)}(y)}},{"../utils/common":41}],53:[function(i,n,r){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,n,r){(function(s){(function(l,o){if(!l.setImmediate){var a,h,u,d,f=1,c={},g=!1,_=l.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(l);v=v&&v.setTimeout?v:l,a={}.toString.call(l.process)==="[object process]"?function(L){process.nextTick(function(){E(L)})}:function(){if(l.postMessage&&!l.importScripts){var L=!0,x=l.onmessage;return l.onmessage=function(){L=!1},l.postMessage("","*"),l.onmessage=x,L}}()?(d="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",w,!1):l.attachEvent("onmessage",w),function(L){l.postMessage(d+L,"*")}):l.MessageChannel?((u=new MessageChannel).port1.onmessage=function(L){E(L.data)},function(L){u.port2.postMessage(L)}):_&&"onreadystatechange"in _.createElement("script")?(h=_.documentElement,function(L){var x=_.createElement("script");x.onreadystatechange=function(){E(L),x.onreadystatechange=null,h.removeChild(x),x=null},h.appendChild(x)}):function(L){setTimeout(E,0,L)},v.setImmediate=function(L){typeof L!="function"&&(L=new Function(""+L));for(var x=new Array(arguments.length-1),k=0;k<x.length;k++)x[k]=arguments[k+1];var P={callback:L,args:x};return c[f]=P,a(f),f++},v.clearImmediate=b}function b(L){delete c[L]}function E(L){if(g)setTimeout(E,0,L);else{var x=c[L];if(x){g=!0;try{(function(k){var P=k.callback,j=k.args;switch(j.length){case 0:P();break;case 1:P(j[0]);break;case 2:P(j[0],j[1]);break;case 3:P(j[0],j[1],j[2]);break;default:P.apply(o,j)}})(x)}finally{b(L),g=!1}}}}function w(L){L.source===l&&typeof L.data=="string"&&L.data.indexOf(d)===0&&E(+L.data.slice(d.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Un<"u"?Un:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(hh);var A0=hh.exports;const I0=N0(A0);async function O0(e){return I0.loadAsync(e)}function ne(){return["main"]}async function $0(e){if(e.file)return e.file;if(e.link)return R0(hl(decodeURI(e.link)));if(e.id)return uh(fl(decodeURI(e.id)));if(e.hash&&mr(decodeURI(e.hash).trim()))return B0(decodeURI(e.hash).trim());throw new Error("Could not search for file.")}const Ce=async e=>{try{console.time("loading time"),Pn.enable(!1);let t=await $0(e);Dt.status("info","Extracting zip",0),Nt.switchHeader(!1);const i=await O0(t);Pn.enable(!1),Dt.status("info","Parsing map info...",0),J.tInfo(ne(),"Parsing map info");const n=await T0(i);lt.beatmapInfo=n,Jh(n),Dt.status("info","Loading image...",10.4375),J.tInfo(ne(),"Loading cover image");let r=i.file(n.coverImageFilename);if(it.load.imageCover&&r){let a=await r.async("base64");Nt.setCoverImage("data:image;base64,"+a),Gi.loading.coverImage=!0}else J.tError(ne(),`${n.coverImageFilename} does not exists.`);if(lt.contributors=[],n.customData._contributors)for(const a of n.customData._contributors){J.tInfo(ne(),"Loading contributor image "+a._name),r=i.file(a._iconPath);let h=null;it.load.imageContributor&&r?h=await r.async("base64"):J.tError(ne(),`${a._iconPath} does not exists.`),lt.contributors.push({...a,_base64:h})}Dt.status("info","Loading audio...",20.875),J.tInfo(ne(),"Loading audio");let s=i.file(n.songFilename);if(it.load.audio&&s){let a=!1;setTimeout(()=>{a||Dt.status("info","Loading audio... (this may take a while)",20.875)},1e4);let h=await s.async("arraybuffer");Nt.setAudio(h),await new AudioContext().decodeAudioData(h).then(d=>{a=!0;let f=d.duration;lt.duration=f,Nt.setSongDuration(f),Gi.loading.audio=!0}).catch(function(d){Nt.setSongDuration(),J.tError(ne(),d)})}else Nt.setSongDuration(),J.tError(ne(),`${n.songFilename} does not exist.`);Dt.status("info","Parsing difficulty...",70),lt.beatmapDifficulty=await L0(n,i),Wi.adjustTime(),Dt.status("info","Adding map difficulty stats...",80),J.tInfo(ne(),"Adding map stats"),v0(),Tl(lt.contributors);let l=n.beatsPerMinute,o=n.beatsPerMinute;lt.beatmapDifficulty.forEach(a=>{const h=a.bpm.change.map(d=>d.BPM),u=a.data.bpmEvents.map(d=>d.bpm);l=Math.min(l,...h,...u),o=Math.max(o,...h,...u)}),l!==o&&Nt.setSongBPM(n.beatsPerMinute,l,o),Dt.status("info","Analysing general...",85),J.tInfo(ne(),"Analysing map"),vi.runGeneral(),Wi.displayOutputGeneral(),Dt.status("info","Analysing difficulty...",90),vi.applyAll(),Wi.populateSelect(n),Wi.displayOutputDifficulty(),Pn.enable(!0),Dt.status("info","Map successfully loaded!")}catch(t){Dt.status("error",t,100),J.tError(ne(),t),lt.clear(),Pn.enable(!0),Nt.switchHeader(!0)}finally{console.timeEnd("loading time")}},ro=document.querySelector(".input__intro-url"),so=document.querySelector(".input__intro-id"),ao=document.querySelector(".input__intro-hash"),P0=document.querySelector(".input__search-button"),M0=document.querySelector(".input__file"),fh=document.querySelector(".input__file-zone");ro.addEventListener("keydown",jr);so.addEventListener("keydown",jr);ao.addEventListener("keydown",jr);P0.addEventListener("click",F0);M0.addEventListener("change",W0);fh.addEventListener("drop",H0);fh.addEventListener("dragover",G0);function jr(e){const t=e.target;e.key==="Enter"&&t.value!==""&&(t.classList.contains("input__intro-url")&&Ce({link:t.value}),t.classList.contains("input__intro-id")&&Ce({id:t.value}),t.classList.contains("input__intro-hash")&&Ce({hash:t.value}))}function F0(e){if(ro&&ro.value!==""){Ce({link:ro.value});return}if(so&&so.value!==""){Ce({id:so.value});return}if(ao&&ao.value!==""){Ce({hash:ao.value});return}}function W0(e){const t=e.target;Dt.status("info","Reading file input",0);const i=t.files?t.files[0]:null;try{if(i==null)throw Dt.status("info","No file input",0),new Error("No file input");if(i&&(i.name.substr(-4)===".zip"||i.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(i),n.addEventListener("load",()=>{Ce({file:i})})}else throw new Error("Unsupported file format, please enter zip file")}catch(n){Dt.status("error",n,0),console.error(n)}}function H0(e){e.preventDefault(),e.stopPropagation();try{if(e.dataTransfer==null)throw new Error("No file input");if(e.dataTransfer.items&&e.dataTransfer.items[0].kind==="file"){let t=e.dataTransfer.items[0].getAsFile();if(t&&(t.name.substr(-4)===".zip"||t.name.substr(-4)===".bsl")){const i=new FileReader;i.readAsArrayBuffer(t),i.addEventListener("load",()=>{Ce({file:t})})}else throw new Error("Unsupported file format, please enter zip file")}}catch(t){Dt.status("error",t,0),console.error(t)}}function G0(e){e.preventDefault(),e.stopPropagation()}const j0=document.querySelector("body"),X0=["Dark","Light","Monochrome"],Xr={list:X0,set:e=>{j0.className="theme-"+e.toLowerCase().replace(" ","")}},zr=document.querySelector(".settings__theme"),mh=document.querySelector(".settings__beat-numbering"),dh=document.querySelector(".settings__rounding"),ph=document.querySelector(".settings__info-height"),gh=document.querySelector(".settings__data-check"),_h=document.querySelector(".settings__data-error"),bh=document.querySelectorAll(".settings__load"),fr=document.querySelector(".settings__sort"),vh=document.querySelectorAll(".settings__show"),yh=document.querySelectorAll(".settings__onload"),z0=document.querySelector(".settings__clear-button");zr.addEventListener("change",Y0);Xr.list.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,zr.add(t)});mh.addEventListener("change",U0);dh.addEventListener("change",V0);ph.addEventListener("change",J0);gh.addEventListener("change",q0);_h.addEventListener("change",K0);bh.forEach(e=>e.addEventListener("change",ig));fr.addEventListener("change",tg);yh.forEach(e=>e.addEventListener("change",og));vh.forEach(e=>e.addEventListener("change",Z0));z0.addEventListener("click",Eh);function Y0(e){const t=e.target;it.theme=t.options[t.options.selectedIndex].value,Xr.set(it.theme),it.save()}function U0(e){const t=e.target;it.beatNumbering=t.options[t.options.selectedIndex].value,it.save()}function V0(e){const t=e.target;it.rounding=parseInt(t.value),it.save()}function J0(e){const t=e.target;it.infoRowHeight=parseInt(t.value),kl(it.infoRowHeight),it.save()}function q0(e){const t=e.target;it.dataCheck=t.checked,it.save()}function K0(e){const t=e.target;it.dataError=t.checked,it.save()}function Z0(e){const t=e.target,i=t.id.replace("settings__show-","");it.show[i]=t.checked,it.save()}function Q0(e,t){vh.forEach(i=>{i.id.endsWith(e)&&(i.checked=t)})}function tg(e){const t=e.target;it.sorting=t.checked,it.save()}function eg(e){fr&&(fr.checked=e)}function ig(e){const t=e.target,i=t.name;it.load[i]=t.checked,it.save()}function ng(e,t){bh.forEach(i=>{i.name===e&&(i.checked=t)})}function og(e){const t=e.target,i=t.name;it.onLoad[i]=t.checked,it.save()}function rg(e,t){yh.forEach(i=>{i.name===e&&(i.checked=t)})}function sg(e){zr.value=e}function ag(e){mh.value=e}function lg(e){dh.value=e.toString()}function cg(e){ph.value=e.toString(),kl(it.infoRowHeight)}function ug(e){gh.checked=e}function hg(e){_h.checked=e}function Eh(){it.clear(),it.reset(),location.reload()}const ge={setShowCheck:Q0,setSortCheck:eg,setLoadCheck:ng,setOnLoadCheck:rg,setTheme:sg,setBeatNumbering:ag,setRounding:lg,setInfoHeight:cg,setDataCheck:ug,setDataError:hg,clear:Eh},fg=document.querySelectorAll(".input__reset-button");fg.forEach(e=>e.addEventListener("click",mg));function mg(){Dt.reset(),Nt.reset(),qh(),Wi.reset(),y0(),lt.clear()}const dg=2,pg=5,gg=15,_g="Kival Evan#5480",rl=new class{constructor(){this._version=`${dg}.${pg}.${gg}`,this._wm=_g}get value(){return this._version}get watermark(){return this._wm}},bg=document.querySelectorAll(".link__watermark"),vg=document.querySelectorAll(".link__version");function sl(){const e=new Date;return e.getMonth()==5&&e.getDate()==10}const al={setWatermark:e=>{bg.forEach(t=>{t.textContent=(sl()?"Happy Birthday, ":"")+e,sl()&&(t.title=`Happy ${new Date().getFullYear()-new Date("1999-06-10").getFullYear()} Birthday, 10th June`)})},setVersion:e=>{vg.forEach(t=>t.textContent=e)}},yg=function(){let e=!1;return function(){if(!e){e=!0,al.setWatermark(rl.watermark),al.setVersion(rl.value),Wi.populateTool(),ge.setTheme(it.theme),ge.setBeatNumbering(it.beatNumbering),ge.setRounding(it.rounding),ge.setInfoHeight(it.infoRowHeight),ge.setDataCheck(it.dataCheck),ge.setDataError(it.dataError);for(const t in it.load)ge.setLoadCheck(t,it.load[t]);ge.setSortCheck(it.sorting);for(const t in it.show)cl.show(t,it.show[t]),ge.setShowCheck(t,it.show[t]);for(const t in it.onLoad)ge.setOnLoadCheck(t,it.onLoad[t]);Xr.set(it.theme),J.tInfo(["init"],"User interface initialised")}}}();(function(){yg();const e=new URL(location.href),t=e.searchParams.get("url"),i=e.searchParams.get("id"),n=e.searchParams.get("hash");(i||t||n)&&Ce({link:t,id:i,hash:n})})();
