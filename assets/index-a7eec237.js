(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function i(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=i(a);fetch(a.href,o)}})();var al=(t=>(t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy",t))(al||{});const Wu="UI Accordion: ",Nn="accordion__",ll=document.querySelectorAll(".accordion__button");ll.length||console.error(Wu+"empty accordion list, intentional or typo error?");const cl={create:(t,e,i,n=!1)=>{const a=document.createElement("div");a.className="accordion";const o=document.createElement("input");o.className=Nn+"button",o.id=t,o.setAttribute("type","checkbox");const l=document.createElement("label");l.className=Nn+"label unselectable",l.htmlFor=t,l.textContent=e,i&&l.classList.add(al[i]);const s=document.createElement("div");return s.className=n?Nn+"collapsible-flex":Nn+"collapsible",s.id=t+"-content",a.appendChild(o),a.appendChild(l),a.appendChild(s),a},show:(t,e)=>{ll.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}};var ul=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},he=(t,e,i)=>(ul(t,e,"read from private field"),i?i.call(t):e.get(t)),xs=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},An=(t,e,i,n)=>(ul(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),Li,Wn,de,hl=(t=>(t[t.VERBOSE=0]="VERBOSE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.NONE=5]="NONE",t))(hl||{});const Xn=class{constructor(){xs(this,Li,2),xs(this,Wn,(t,e)=>`${Xn.LogPrefixes.get(e)} > [${t.join("::")}]`),xs(this,de,"script")}set logLevel(t){An(this,Li,t),this.tInfo(["logger","logLevel"],`Log level set to ${Xn.LogPrefixes.get(t)}`)}get logLevel(){return he(this,Li)}set tagPrint(t){An(this,Wn,t),this.tInfo(["logger","tagPrint"],"Update tag print function")}get tagPrint(){return he(this,Wn)}set untagged(t){An(this,de,t.trim()),this.tInfo(["logger","untagged"],`Update untagged string to ${he(this,de)}`)}get untagged(){return he(this,de)}log(t,e,...i){if(t<he(this,Li))return;const n=[this.tagPrint(e,t),...i];switch(t){case 1:return console.debug(...n);case 2:return console.info(...n);case 3:return console.warn(...n);case 4:return console.error(...n);default:return console.log(...n)}}setLevel(t){t=Math.min(Math.max(t,0),5),An(this,Li,t),this.tInfo(["logger","setLevel"],`Log level set to ${Xn.LogPrefixes.get(t)}`)}tVerbose(t,...e){this.log(0,t,...e)}tDebug(t,...e){this.log(1,t,...e)}tInfo(t,...e){this.log(2,t,...e)}tWarn(t,...e){this.log(3,t,...e)}tError(t,...e){this.log(4,t,...e)}verbose(...t){this.tVerbose([he(this,de)],...t)}debug(...t){this.tDebug([he(this,de)],...t)}info(...t){this.tInfo([he(this,de)],...t)}warn(...t){this.tWarn([he(this,de)],...t)}error(...t){this.tError([he(this,de)],...t)}};let yo=Xn;Li=new WeakMap;Wn=new WeakMap;de=new WeakMap;yo.LogLevels=hl;yo.LogPrefixes=new Map([[0,"VERBOSE"],[1,"DEBUG"],[2,"INFO"],[3,"WARN"],[4,"!!ERROR!!"],[5,"NONE"]]);const q=new yo;function Xu(t){return t.toString().split(".").map((e,i)=>i?e:e.replace(/\B(?=(\d{3})+(?!\d))/g,",")).join(".")}zu(Math.random());function zu(t){t=t.toString();let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function I(t,e=0){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}function Ps(t){return t*(180/Math.PI)}function Ci(t){return t*(Math.PI/180)}function rr(t,e){e<0&&(e=-e);const i=t%e;return i<0?i+e:i}function ar(t,e,i){return Math.min(rr(t-e,i),rr(e-t,i))}function Bs(t){if(t.length===0)return 0;t.sort((i,n)=>i-n);const e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2}function lr(t,e,i){return Math.min(Math.max(e,t),i)}function _t(t){if(typeof t!="object")throw new Error("Received non-object type");return JSON.parse(JSON.stringify(t))}function vo(t){return/^[a-fA-F0-9]+$/g.test(t)}function Oe(t){return parseInt(t,16)}function Gu(t){return["utils","colors",t]}function Ns(t,e,i,n){t=t/360,t<0&&(t+=Math.abs(Math.floor(t)));let a=0,o=0,l=0;const s=Math.floor(t*6),r=t*6-s,h=i*(1-e),f=i*(1-r*e),u=i*(1-(1-r)*e);switch(s%6){case 0:a=i,o=u,l=h;break;case 1:a=f,o=i,l=h;break;case 2:a=h,o=i,l=u;break;case 3:a=h,o=f,l=i;break;case 4:a=u,o=h,l=i;break;case 5:a=i,o=h,l=f;break}const m=[a,o,l];return typeof n=="number"&&m.push(n),m}function In(t){const e=t.toString(16);return e.length===1?"0"+e:e}function Yu(t){return t>1&&t>=0?t:I(t*255)}function Pe(t){return t/255}function Ms(t){if(Array.isArray(t)){const e={r:t[0],g:t[1],b:t[2]};return typeof t[3]=="number"&&(e.a=t[3]),e}return typeof t=="string"||"type"in t?Ms(Ce(t)):t}function Ct(t){const e=Ms(t);for(const i in e){const n=e[i];n!==void 0&&(e[i]=Yu(n))}return`#${In(e.r)}${In(e.g)}${In(e.b)}${typeof e.a=="number"?In(e.a):""}`}function Uu(t){if(t=t.trim(),t.startsWith("#")&&(t=t.substring(1)),!vo(t))throw new Error("Not valid hexadecimal");let e=[0,0,0];return t.length===3||t.length===4?(e=[Pe(Oe(t.slice(0,1)+t.slice(0,1))),Pe(Oe(t.slice(1,2)+t.slice(1,2))),Pe(Oe(t.slice(2,3)+t.slice(2,3)))],t.length===4&&e.push(Pe(Oe(t.slice(3,4)+t.slice(3,4))))):t.length===6||t.length===8?(e=[Pe(Oe(t.slice(0,2))),Pe(Oe(t.slice(2,4))),Pe(Oe(t.slice(4,6)))],t.length===8&&e.push(Pe(Oe(t.slice(6,8))))):q.tWarn(Gu("hexToRgba"),`Unknown color hex #${t}`),e}function cr(t){let e=t[0],i=t[1],n=t[2],a,o,l;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,a=(e*.4124+i*.3576+n*.1805)/.95047,o=(e*.2126+i*.7152+n*.0722)/1,l=(e*.0193+i*.1192+n*.9505)/1.08883,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116;const s=[116*o-16,500*(a-o),200*(o-l)];return typeof t[3]=="number"&&s.push(t[3]),s}function ur(t,e){let i=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(i=0),t<0&&(i=180),t>0&&e<0&&(i=360),Ps(Math.atan(e/t))+i)}function Fs(t,e){const[i,n,a]=cr(t),[o,l,s]=cr(e),r=1,h=1,f=1;let u,m,c,p,_,y,b,E,D,C,R,F,P,k,$,U,et,S,O,g;return u=Math.sqrt(n*n+a*a),m=Math.sqrt(l*l+s*s),c=(u+m)/2,_=.5*(1-Math.sqrt((c^7)/((c^7)+30))),D=(1+_)*n,u=Math.sqrt(D*D+a*a),y=ur(D,a),D=(1+_)*l,m=Math.sqrt(D*D+s*s),b=ur(D,s),S=o-i,O=m-u,u*m==0?g=0:(D=I(b-y,12),Math.abs(D)<=180?g=b-y:D>180?g=b-y-360:g=b-y+360),g=2*Math.sqrt(u*m)*Math.sin(Ci(g/2)),C=(i+o)/2,p=(u+m)/2,u*m==0?E=y+b:(D=Math.abs(I(y-b,12)),D>180?b+y<360?E=y+b+360:E=y+b-360:E=y+b,E/=2),R=1-.17*Math.cos(Ci(E-30))+.24*Math.cos(Ci(2*E))+.32*Math.cos(Ci(3*E+6))-.2*Math.cos(Ci(4*E-63)),$=30*Math.exp(-((E-275)/25)*((E-275)/25)),U=2*Math.sqrt((p^7)/((p^7)+30)),F=1+.015*((C-50)*(C-50))/Math.sqrt(20+(C-50)*(C-50)),P=1+.045*p,k=1+.015*p*R,et=-Math.sin(Ci(2*$))*U,S=S/(r*F),O=O/(h*P),g=g/(f*k),Math.sqrt(S*S+O*O+g*g+et*O*g)}function Ce(){const t=arguments;if(typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[2]=="number"){let e=[t[0],t[1],t[2]];return typeof t[3]=="number"&&e.push(t[3]),typeof t[3]=="string"&&(t[3]==="hsva"&&(e=Ns(...e)),t[3]==="rgba255"&&(e=e.map(i=>i/255))),typeof t[4]=="string"&&(t[4]==="hsva"&&(e=Ns(...e)),t[4]==="rgba255"&&(e=e.map(i=>i/255))),e}if(typeof t[0]=="number")return typeof t[1]=="boolean"&&t[1]?[t[0]/255,t[0]/255,t[0]/255]:typeof t[1]=="number"?[t[0],t[0],t[0],t[1]]:[t[0],t[0],t[0]];if(typeof t[0]=="string")return Uu(t[0]);if(Array.isArray(t[0])){let e=[t[0][0],t[0][1],t[0][2]];if(!e.every(i=>typeof i=="number"))throw new Error("Unable to parse color; array contain undefined or non-numeric");return typeof t[0][3]=="number"&&e.push(t[0][3]),typeof t[1]=="string"&&(t[1]==="hsva"&&(e=Ns(...e)),t[1]==="rgba255"&&(e=e.filter(i=>typeof i=="number").map(i=>i/255))),e}if(typeof t[0]=="object"){const e=t[0];if("type"in e)switch(e.type){case"hsva":return Ce(e.value,"hsva");case"rgba":return Ce(e.value,"rgba");case"rgba255":return Ce(e.value,"rgba255")}if("r"in e){const i=[e.r,e.g,e.b];return typeof e.a=="number"&&i.push(e.a),i}}throw new Error("Unable to parse color; input is invalid")}function wt(t){if(!t)return"0:00";const e=Math.floor(t),i=e/60,n=i<0?`-${Math.ceil(i).toString()}`:Math.floor(i).toString(),a=Math.abs(e%60).toString().padStart(2,"0");return`${n}:${a}`}function Vu(t){if(!t)return"0:00:00";const e=Math.abs(Math.round(t*60%60)).toString().padStart(2,"0");return`${wt(t>0?Math.floor(t):Math.ceil(t))}:${e}`}function zn(t){var i;if(!t)return"0:00.000";const e=((i=(t%1).toString().split(".")[1])==null?void 0:i.padEnd(3,"0").slice(0,3))||"000";return`${wt(t>0?Math.floor(t):Math.ceil(t))}.${e}`}function fl(t){const e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")}function dl(t){const e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")}function Hs(t){for(let e=t.options.length-1;e>=0;e--)t.remove(e)}const Eo="UI Header: ",Ws=document.querySelector(".intro"),Xs=document.querySelector(".metadata"),ci=document.querySelector(".cover__link"),wo=document.querySelector(".cover__image"),ml=document.querySelector(".metadata__song-name"),pl=document.querySelector(".metadata__song-subname"),gl=document.querySelector(".metadata__song-author"),_l=document.querySelector(".metadata__song-bpm"),zs=document.querySelector(".metadata__song-duration"),bl=document.querySelector(".audio");if(!Ws||!Xs)throw new Error(Eo+"header component is missing one of the two section");if(!ci||!wo)throw new Error(Eo+"cover component is missing");if(!ml||!pl||!gl||!_l||!zs)throw new Error(Eo+"metadata component is missing one of the part");function yl(t){t?(Ws.classList.remove("hidden"),Xs.classList.add("hidden")):(Ws.classList.add("hidden"),Xs.classList.remove("hidden"))}function vl(t){wo.src=t||"./img/unknown.jpg"}function ju(){return wo.src}function El(t,e){if(t==null&&e==null){ci.textContent="",ci.href="",ci.classList.add("disabled");return}t!=null&&(ci.textContent=e??"Download Link",ci.href=t,ci.classList.remove("disabled"))}function Ju(t){ml.textContent=t}function qu(t){pl.textContent=t}function Ku(t){gl.textContent=t}function Zu(t,e,i){e==null&&typeof i=="number"&&(e=Math.min(t,i)),i==null&&typeof e=="number"&&(i=Math.max(t,e));let n=I(t,2).toString()+"BPM";e&&i&&(n+=` (${I(e,2)}-${I(i,2)})`),_l.textContent=n}function wl(t){t?zs.textContent=zn(t):zs.textContent="No audio"}async function Qu(t){const e=new Blob([t],{type:"audio/ogg"});bl.src=window.URL.createObjectURL(e)}function Dl(){bl.src="",window.URL.revokeObjectURL("")}function th(){yl(!0),vl(null),El(),wl(0),Dl()}const Bt={switchHeader:yl,setCoverImage:vl,getCoverImage:ju,setCoverLink:El,setSongName:Ju,setSongSubname:qu,setSongAuthor:Ku,setSongBPM:Zu,setSongDuration:wl,setAudio:Qu,unloadAudio:Dl,reset:th},Wi=new class{constructor(){this.loading={info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1}}resetLoad(){this.loading.info=!1,this.loading.difficulty=!1,this.loading.analysis=!1,this.loading.audio=!1,this.loading.coverImage=!1,this.loading.contributorImage=!1,this.loading.finished=!1}},at=new class{constructor(){this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}retrieveSafe(){if(!this.beatmapInfo)throw new Error("Beatmap info is not loaded.");if(!this.analysis)throw new Error("Beatmap analysis is not loaded.");if(this.duration===null)throw new Error("Audio is not loaded.");if(Wi.loading.finished)return{beatmapInfo:this.beatmapInfo,beatmapDifficulty:this.beatmapDifficulty,contributors:this.contributors,analysis:this.analysis,duration:this.duration};throw new Error("Could not retrieve saved data, loading process is not finished.")}clear(){Wi.loading.finished=!1,this.beatmapInfo=null,this.beatmapDifficulty=[],this.contributors=[],this.analysis=null,this.duration=null}};function eh(t){return["beatmap","shared","bpm",t]}const Sl=class{constructor(t,e=[],i=0){this._bpm=t,this._offset=i/1e3,this._timeScale=this.getTimeScale(e.filter(n=>("m"in n||"bpm"in n)&&!("o"in n))),this._bpmChange=this.getBpmChangeTime(e.filter(n=>n._time!=null||n.o!=null)),this._timeScale.length&&this._bpmChange.length&&q.tWarn(eh("constructor"),"BPM change and BPM event should not be used along side together to avoid confusion between editors and in-game behaviour")}get value(){return this._bpm}set value(t){this._bpm=t}get change(){return this._bpmChange}set change(t){this._bpmChange=this.getBpmChangeTime(t)}get timescale(){return this._timeScale}set timescale(t){this._timeScale=this.getTimeScale(t)}get offset(){return this._offset*1e3}set offset(t){this._offset=t/1e3}getBpmChangeTime(t=[]){let e;const i=[];t=[...t].sort((n,a)=>(n.time??n._time??n.b)-(a.time??a._time??a.b));for(let n=0;n<t.length;n++){const a={time:t[n].time??t[n]._time??t[n].b,BPM:t[n].BPM??t[n]._BPM??t[n]._bpm??t[n].m,beatsPerBar:t[n].beatsPerBar??t[n]._beatsPerBar??t[n].p,metronomeOffset:t[n].metronomeOffset??t[n]._metronomeOffset??t[n].o,newTime:0};e?a.newTime=Math.ceil((a.time-e.time)/this._bpm*e.BPM+e.newTime-.01):a.newTime=Math.ceil(a.time-this._offset*this._bpm/60-.01),i.push(a),e=a}return i}getTimeScale(t=[]){return[...t].sort((e,i)=>(e.time??e.b)-(i.time??i.b)).map(e=>"scale"in e?e:"bpm"in e?{time:e.time,scale:this._bpm/e.bpm}:{time:e.b,scale:this._bpm/e.m})}offsetBegone(t){return this.toBeatTime(this.toRealTime(t,!1)-this._offset)}toRealTime(t,e=!0){if(!e)return t/this._bpm*60;let i=0;for(let n=this._timeScale.length-1;n>=0;n--)t>this._timeScale[n].time&&(i+=(t-this._timeScale[n].time)*this._timeScale[n].scale,t=this._timeScale[n].time);return(t+i)/this._bpm*60}toBeatTime(t,e=!1){if(!e)return t*this._bpm/60;let i=0;for(let n=this._timeScale.length-1;n>=0;n--){const a=this.toRealTime(this._timeScale[n].time);t>a&&(i+=(t-a)/this._timeScale[n].scale,t=a)}return this.toBeatTime(t+i)}toJsonTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e].newTime)return(t-this._bpmChange[e].newTime)/this._bpmChange[e].BPM*this._bpm+this._bpmChange[e].time;return this.toBeatTime(this.toRealTime(t,!1)+this._offset)}adjustTime(t){for(let e=this._bpmChange.length-1;e>=0;e--)if(t>this._bpmChange[e].time)return(t-this._bpmChange[e].time)/this._bpm*this._bpmChange[e].BPM+this._bpmChange[e].newTime;return this.offsetBegone(t)}};let Re=Sl;Re.create=(t,e,i)=>new Sl(t,e,i);const ih={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",QueenEnvironment:"Queen",GlassDesertEnvironment:"Glass Desert"},Ei={DefaultEnvironment:[[0,1,2,3,4,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,8,9,12,13],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],TheSecondEnvironment:[[0,1,2,3,4,9],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],LizzoEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,16,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]],TheWeekndEnvironment:[[0,1,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,29,30,31,32,33,34,35,36,37,38,40]],RockMixtapeEnvironment:[[3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]],Dragons2Environment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12]],Panic2Environment:[[3],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]],QueenEnvironment:[[6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]]},Ds="UI Info: ",Gs=document.querySelector(".info__version"),Ys=document.querySelector(".info__play-time"),Us=document.querySelector(".info__time-spend"),Vs=document.querySelector(".info__custom-color"),js=document.querySelector(".info__requirements"),Js=document.querySelector(".info__suggestions"),qs=document.querySelector(".info__information"),Ks=document.querySelector(".info__warnings"),Zs=document.querySelector(".info__bookmarks"),Qs=document.querySelector(".info__bpm-changes"),to=document.querySelector(".info__environment-enhancement"),eo=document.querySelector(".info__point-definitions"),io=document.querySelector(".info__custom-events"),Tl=document.querySelectorAll(".info__table-element");if(!Gs||!Ys||!Us||!Vs||!js||!Js||!qs||!Ks||!Zs||!Qs||!to||!eo||!io||!Tl)throw new Error(Ds+"table info component is missing part");const no=document.querySelector(".info__level-author"),so=document.querySelector(".info__environment"),Gn=document.querySelector(".info__editors"),Yn=document.querySelector(".info__contributors"),ts=document.querySelector(".info__contributors-select"),nh=document.querySelector(".info__contributors-image"),Cl=document.querySelector(".info__contributors-name"),Ll=document.querySelector(".info__contributors-role");if(!no||!so||!Gn)throw new Error(Ds+"info component is missing part");if(!Yn||!Cl||!Ll)throw new Error(Ds+"contributors component is missing part");if(ts)ts.addEventListener("change",ah);else throw new Error(Ds+"contributors select is missing");function Rl(t){if(!t){no.textContent="";return}no.textContent="Mapped by "+t}function kl(t){if(!t){so.textContent="";return}so.textContent=(ih[t]||"Unknown")+" Environment"}function xl(t){if(!t||!t._lastEditedBy){Gn.classList.add("hidden");return}Gn.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let i="Last edited on "+e;if(t[e]){const n=t[e];i+=" v"+n.version}Gn.textContent=i}function sh(t){nh.src=t||"./img/unknown.jpg"}function oh(t){Cl.textContent=t}function rh(t){Ll.textContent=t}function Bl(t){sh(t._base64?"data:image;base64,"+t._base64:null),oh(t._name),rh(t._role)}function Nl(t){if(Yn&&(!t||!t.length)){Yn.classList.add("hidden"),Hs(ts);return}if(t){Yn.classList.remove("hidden");let e=!0;t.forEach((i,n)=>{e&&(e=!1,Bl(i));const a=document.createElement("option");a.value=n.toString(),a.text=i._name+" -- "+i._role,ts.add(a)})}}function ah(t){const e=t.target;Bl(at.contributors[parseInt(e.value)])}const nn={version:3,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",infoRowHeight:4,rounding:3,dataCheck:!0,dataError:!0,theme:"Dark",onLoad:{stats:!1},show:{info:!1,tools:!1,stats:!1,settings:!1}},Q=new class{constructor(){this.property=_t(nn),this.stringify=()=>JSON.stringify({settings:this.property}),this.init=()=>{var i;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const n=JSON.parse(e);if(!((i=n.settings)!=null&&i.version)){this.clear();return}this.property=n.settings??this.property;for(const a in nn)typeof this.property[a]>"u"&&(this.property[a]=nn[a]);this.property.version=nn.version,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this.property=_t(nn)},this.init()}get version(){return this.property.version}get load(){return this.property.load}get sorting(){return this.property.sorting}set sorting(e){this.property.sorting=e}get beatNumbering(){return this.property.beatNumbering}set beatNumbering(e){this.property.beatNumbering=e}get infoRowHeight(){return this.property.infoRowHeight}set infoRowHeight(e){this.property.infoRowHeight=e}get rounding(){return this.property.rounding}set rounding(e){this.property.rounding=e}get dataCheck(){return this.property.dataCheck}set dataCheck(e){this.property.dataCheck=e}get dataError(){return this.property.dataError}set dataError(e){this.property.dataError=e}get theme(){return this.property.theme}set theme(e){this.property.theme=e}get onLoad(){return this.property.onLoad}get show(){return this.property.show}};var Al=(t=>(t.tiny="panel--tiny",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t.max="panel--max",t))(Al||{}),Il=(t=>(t.normal="panel--offset",t.half="panel--offset-half",t.none="",t))(Il||{});const gn={create:(t,e,i,n)=>{const a=document.createElement("div");return a.className=`panel ${Al[t]}`,e&&e!=="none"&&a.classList.add(Il[e]),i&&a.classList.add("panel--flex"+n?"-column":""),a}};function Ft(t){const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")}function Ht(t,e){const i=t.querySelector(".info__table-element");if(i){for(;i.firstChild;)i.removeChild(i.firstChild);typeof e=="string"?i.textContent=e:(e.forEach(n=>{if(typeof n=="string"){const a=document.createElement("span");a.textContent=n,i.appendChild(a),i.appendChild(document.createElement("br"))}else i.appendChild(n),i.appendChild(document.createElement("br"))}),i.lastChild&&i.removeChild(i.lastChild))}t.classList.remove("hidden")}function $l(t){Tl.forEach(e=>e.style.maxHeight=`${t}rem`)}function Ol(t,e){if(t==null||!t.length){Ft(Zs);return}const i=gn.create("max","none",!0);t.forEach((n,a)=>{let o=n.b,l;const s=document.createElement("div"),r=document.createElement("div"),h=document.createElement("div");s.appendChild(r),s.appendChild(h),r.className="info__color-dot",r.style.backgroundColor="#000000",h.className="info__color-text",typeof n.n!="string"&&(h.textContent=`Error parsing bookmarks[${a}]`,i.appendChild(s)),e&&(o=e.adjustTime(o),l=e.toRealTime(o)),r.style.backgroundColor=n.c?Ct({r:n.c[0],g:n.c[1],b:n.c[2]}):"#333333",h.textContent=`${I(n.b,Q.rounding)}${l?" | "+wt(l):""} -- ${n.n!=""?n.n:"**EMPTY NAME**"}`,i.appendChild(s)}),Ht(Zs,[i])}function Pl(t){if(!t||!t.change.length){Ft(Qs);return}const e=t.change.map(i=>{const n=I(i.newTime,Q.rounding),a=t.toRealTime(i.time);return`${n} | ${wt(a)} -- ${i.BPM}`});Ht(Qs,e)}const ee={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",QueenEnvironment:"Queen",GlassDesertEnvironment:"Glass Desert"},lh={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},ie={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.5320754,g:.5320754,b:.5320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"The Second":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8235294,g:.08627451,b:.8509804},_envColorRightBoost:{r:0,g:1,b:.6478302},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Lizzo:{_colorLeft:{r:1,g:.8132076,b:.3773585},_colorRight:{r:.6705883,g:.254902,b:.8980392},_envColorLeft:{r:.8392157,g:.6470588,b:.2156863},_envColorRight:{r:.8196079,g:.2392157,b:.8784314},_envColorLeftBoost:{r:1,g:.4,b:.5529412},_envColorRightBoost:{r:.3686275,g:.7960784,b:1},_obstacleColor:{r:1,g:.5020987,b:.1882353}},"The Weeknd":{_colorLeft:{r:.5843138,g:.1294118,b:.1294118},_colorRight:{r:.2235294,g:.2901961,b:.3294118},_envColorLeft:{r:1,g:.2979701,b:.1411765},_envColorRight:{r:.1668743,g:.3753689,b:.7075472},_envColorLeftBoost:{r:.9568628,g:.6039216,b:.1215686},_envColorRightBoost:{r:.5254902,g:.8274511,b:.9921569},_obstacleColor:{r:.9176471,g:.2980392,b:.007843138}},"Rock Mixtape":{_colorLeft:{r:.6,g:.4233,b:.042},_colorRight:{r:.6006,g:.7441199,b:.78},_envColorLeft:{r:.75,g:.12,b:.162},_envColorRight:{r:.95,g:.5820333,b:.1615},_envColorLeftBoost:{r:.96,g:.1344,b:.9187202},_envColorRightBoost:{r:.378,g:.813,b:.9},_obstacleColor:{r:1,g:1,b:1}},"Dragons 2.0":{_colorLeft:{r:.7264151,g:.6587077,b:.2809719},_colorRight:{r:.2509804,g:.7647059,b:.405098},_envColorLeft:{r:.01960784,g:.9960785,b:.06666667},_envColorRight:{r:0,g:.05490196,b:1},_envColorLeftBoost:{r:.9764706,g:.03137255,b:.01960784},_envColorRightBoost:{r:1,g:.8292086,b:.2264151},_obstacleColor:{r:.5548979,g:.2470588,b:1}},"Panic 2.0":{_colorLeft:{r:.9019608,g:.3333333,b:.5686275},_colorRight:{r:.1529412,g:.5568628,b:.4862745},_envColorLeft:{r:.6980392,g:.1137255,b:.372549},_envColorRight:{r:.1882353,g:.6196079,b:.6235294},_envColorLeftBoost:{r:.9019608,g:.4470589,b:.06666667},_envColorRightBoost:{r:.6365692,g:.4373443,b:.8584906},_obstacleColor:{r:.9686275,g:.3803922,b:.2745098}},Queen:{_colorLeft:{r:.58,g:.5675714,b:.5551428},_colorRight:{r:.5236231,g:.1345675,b:.6792453},_envColorLeft:{r:.9333334,g:.6392157,b:.1215686},_envColorRight:{r:.04313726,g:.7176471,b:.8980393},_envColorLeftBoost:{r:.7686275,g:.145098,b:.07450981},_envColorRightBoost:{r:.4,g:.007843138,b:.7254902},_obstacleColor:{r:.9333334,g:.6392157,b:.1215686}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}};function Ml(t,e){var h,f,u,m,c,p,_;if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._envColorWhite&&!t._envColorWhiteBoost&&!t._obstacleColor){Ft(Vs);return}e||(e="DefaultEnvironment");const i={_colorLeft:((h=ie[ee[e]])==null?void 0:h._colorLeft)||null,_colorRight:((f=ie[ee[e]])==null?void 0:f._colorRight)||null,_envColorLeft:((u=ie[ee[e]])==null?void 0:u._envColorLeft)||null,_envColorRight:((m=ie[ee[e]])==null?void 0:m._envColorRight)||null,_envColorWhite:null,_envColorLeftBoost:((c=ie[ee[e]])==null?void 0:c._envColorLeftBoost)||null,_envColorRightBoost:((p=ie[ee[e]])==null?void 0:p._envColorRightBoost)||null,_envColorWhiteBoost:null,_obstacleColor:((_=ie[ee[e]])==null?void 0:_._obstacleColor)||null},n={_colorLeft:i._colorLeft?Ct(i._colorLeft):null,_colorRight:i._colorRight?Ct(i._colorRight):null,_envColorLeft:i._envColorLeft?Ct(i._envColorLeft):null,_envColorRight:i._envColorRight?Ct(i._envColorRight):null,_envColorWhite:null,_envColorLeftBoost:i._envColorLeftBoost?Ct(i._envColorLeftBoost):null,_envColorRightBoost:i._envColorRightBoost?Ct(i._envColorRightBoost):null,_envColorWhiteBoost:null,_obstacleColor:i._obstacleColor?Ct(i._obstacleColor):null},a={noteColor:!!(t._colorLeft||t._colorRight),eventColor:!!(t._envColorLeft||t._envColorRight),eventBoostColor:!!(t._envColorLeftBoost||t._envColorRightBoost),obstacleColor:!!t._obstacleColor};t._colorLeft&&(n._colorLeft=Ct(t._colorLeft)),t._colorRight&&(n._colorRight=Ct(t._colorRight)),t._envColorLeft?n._envColorLeft=Ct(t._envColorLeft):t._colorLeft&&(n._envColorLeft=Ct(t._colorLeft)),t._envColorRight?n._envColorRight=Ct(t._envColorRight):t._colorRight&&(n._envColorRight=Ct(t._colorRight));let o,l,s=!1;t._envColorLeftBoost?(o=Ct(t._envColorLeftBoost),s=!0):o=i._envColorLeftBoost?Ct(i._envColorLeftBoost):n._envColorLeft,t._envColorRightBoost?(l=Ct(t._envColorRightBoost),s=!0):l=i._envColorRightBoost?Ct(i._envColorRightBoost):n._envColorRight,t._envColorWhite&&(n._envColorWhite=Ct(t._envColorWhite)),t._envColorWhiteBoost&&(n._envColorWhiteBoost=Ct(t._envColorWhiteBoost)),s&&(n._envColorLeftBoost=o,n._envColorRightBoost=l),t._obstacleColor&&(n._obstacleColor=Ct(t._obstacleColor)),a.noteColor||(n._colorLeft=null,n._colorRight=null),a.eventColor||(n._envColorLeft=null,n._envColorRight=null),a.noteColor&&!a.eventColor&&(n._envColorLeft=n._colorLeft,n._envColorRight=n._colorRight),a.obstacleColor||(n._obstacleColor=null);const r=gn.create("max","none",!0);for(const y in n){if(!n[y])continue;const b=document.createElement("div"),E=document.createElement("div"),D=document.createElement("div"),C=document.createElement("div");E.className="info__color-dot",E.style.backgroundColor=n[y]||"#000000",D.className="info__color-text info__color-text--monospace",D.textContent=`${n[y]}`,C.className="info__color-text",C.textContent=` -- ${lh[y]}`,b.appendChild(E),b.appendChild(D),b.appendChild(C),r.appendChild(b)}Ht(Vs,[r])}var Fl=(t=>(t.duplicate="D",t.active="A",t.scale="S",t.position="P",t.localPosition="Lp",t.rotation="R",t.localRotation="Lr",t.lightID="Li",t.track="T",t))(Fl||{}),Hl=(t=>(t.childrenTracks="Ct",t.color="C",t.definitePosition="Dp",t.dissolve="D",t.dissolveArrow="Da",t.duration="Dur",t.easing="E",t.interactable="I",t.localRotation="Lr",t.parentTrack="Pt",t.position="P",t.rotation="R",t.scale="S",t.time="T",t.track="Tr",t.worldPositionStays="Wps",t))(Hl||{});function Wl(t,e){if(t==null||!t.length){Ft(io);return}const i=t.map((n,a)=>{let o=n.b,l;e&&(o=e.adjustTime(o),l=e.toRealTime(o));const s=[];if(!n.d)return`Error parsing customEvents[${a}]`;for(const r in n.d){if(r=="_duration"||r=="_easing"||r=="_track"||r=="duration"||r=="easing"||r=="track")continue;const h=Hl[r];n.d[r]!=null&&s.push(h)}return`${I(n.b,Q.rounding)}${l?" | "+wt(l):""} -- ${n.t} -> [${s.join("")}]${n.t!=="AssignTrackParent"?`(${n.d.track})`:""}`});Ht(io,i)}function Xl(t){if(t==null||!t.length){Ft(to);return}const e=t.map((i,n)=>{const a=[];if(!i.id&&!i.geometry)return`Error parsing environment[${n}]`;for(const o in i){if(o=="lookupMethod"||o=="id"||o=="geometry")continue;const l=Fl[o];i[o]!=null&&a.push(l)}return`${i.lookupMethod} [${a.join("")}]${i.track?`(${i.track})`:""} -> ${i.geometry?i.geometry.type:i.id}`});Ht(to,e)}function oo(t){if(t==null){Ft(Gs);return}Ht(Gs,t)}function zl(t){if(t==null){Ft(Us);return}Ht(Us,Vu(t))}function Gl(t){if(t==null||!t.length){Ft(js);return}Ht(js,t.join(", "))}function Yl(t){if(t==null||!t.length){Ft(Js);return}Ht(Js,t.join(", "))}function Ul(t){if(t==null||!t.length){Ft(qs);return}Ht(qs,t)}function Vl(t){if(t==null||!t.length){Ft(Ks);return}Ht(Ks,t)}function jl(t){if(t==null){Ft(eo);return}const e=[];for(const i in t){t[i]||e.push(`Error parsing pointDefinitions[${i}]`);const n=t[i];Array.isArray(n)||e.push(`Error parsing pointDefinitions[${i}]`),e.push(`${i} -- ${n.length} point${n.length>1?"s":""}`)}Ht(eo,e)}function Jl(t,e){if(t==null||e==null){Ft(Ys);return}Ht(Ys,`${wt(t)} to ${wt(e)}${at.duration?` -- [ ${wt(e-t)} / ${wt(at.duration)} ]`:""}`)}function ch(t){var e;Bt.setSongName(t._songName),Bt.setSongSubname(t._songSubName),Bt.setSongAuthor(t._songAuthorName),Bt.setSongBPM(t._beatsPerMinute),Rl(t._levelAuthorName),kl(t._environmentName),xl((e=t._customData)==null?void 0:e._editors)}function ql(t){var e,i,n;if(t.rawVersion===2&&oo(t.rawData._version),t.rawVersion===3&&oo(t.rawData.version),(e=t.info)!=null&&e._customData&&(Ml(t.info._customData),Gl(t.info._customData._requirements),Yl(t.info._customData._suggestions),Ul(t.info._customData._information),Vl(t.info._customData._warnings)),(i=t.data)!=null&&i.customData){const a=(n=at.beatmapInfo)!=null&&n._beatsPerMinute?Re.create(at.beatmapInfo._beatsPerMinute,t.data.customData._bpmChanges||t.data.customData._BPMChanges||t.data.customData.BPMChanges):null;zl(t.data.customData._time??t.data.customData.time),Ol(t.data.customData._bookmarks??t.data.customData._bookmarks,a),Pl(a),Xl(t.data.customData.environment),jl(t.data.customData.pointDefinitions),Wl(t.data.customData.customEvents,a)}Jl(t.bpm.toRealTime(t.data.getFirstInteractiveTime()),t.bpm.toRealTime(t.data.getLastInteractiveTime()))}function uh(){Rl(),kl(),xl(),Nl(),oo(),Jl(),zl(),Ml(),Gl(),Yl(),Ul(),Vl(),Ol(),Pl(),Xl(),jl(),Wl()}const hh="UI Input: ",$n={enable:t=>{const e=document.querySelectorAll(".input-toggle");if(!e.length){console.error(hh+"empty list, intentional or typo error?");return}e.forEach(i=>{i.disabled=!t})}},fh="UI Loading: ",Ri=document.querySelector(".loading__bar"),hr="loading__bar--error",fr="loading__bar--download",Kl=document.querySelector(".loading__text");if(!Ri||!Kl)throw new Error(fh+"loading component is missing part");function Zl(t,e,i=100){Kl.textContent=e,Ri.style.width=`${i}%`,t==="error"?Ri.classList.add(hr):Ri.classList.remove(hr),t==="download"?Ri.classList.add(fr):Ri.classList.remove(fr)}function dh(){Zl("info","No map loaded",0)}const vt={status:Zl,reset:dh};var ht=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_INVALID_EVENT_BOX=10]="EVENTS_INVALID_EVENT_BOX",t[t.EVENTS_UNLIT_BOMB=11]="EVENTS_UNLIT_BOMB",t[t.NOTES_EFFECTIVE_BPM=12]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=13]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=14]="NOTES_PARITY",t[t.NOTES_VARY_SWING=15]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=16]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=17]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=18]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=19]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=20]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=21]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=22]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=23]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=24]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=25]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=26]="NOTES_HITBOX_PATH",t[t.NOTES_COLOR_CHECK=27]="NOTES_COLOR_CHECK",t[t.NOTES_STACKED_NOTE=28]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=29]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=30]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=31]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=32]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=33]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=34]="OBSTACLES_NEGATIVE",t))(ht||{}),ft=(t=>(t[t.GENERAL_AUDIO=0]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=1]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=2]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=3]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=4]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=5]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=6]="OTHERS_HOT_START",t[t.OTHERS_NJS=7]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=8]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=9]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_INVALID_EVENT_BOX=10]="EVENTS_INVALID_EVENT_BOX",t[t.EVENTS_UNLIT_BOMB=11]="EVENTS_UNLIT_BOMB",t[t.NOTES_COLOR_CHECK=12]="NOTES_COLOR_CHECK",t[t.NOTES_EFFECTIVE_BPM=13]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=14]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=15]="NOTES_PARITY",t[t.NOTES_VARY_SWING=16]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=17]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=18]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=19]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=20]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=21]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=22]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=23]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=24]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=25]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=26]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=27]="NOTES_HITBOX_PATH",t[t.NOTES_STACKED_NOTE=28]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=29]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=30]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=31]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=32]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=33]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=34]="OBSTACLES_NEGATIVE",t))(ft||{});function Ql(t,e){switch(e){case"rank":t='<span title="Ranking: for rankability reason."> 🚧 </span>'+t;break;case"error":t='<span title="Error: should be fixed unless you know what you are doing."> ❌ </span>'+t;break;case"warning":t='<span title="Warning: not necessarily needed to be fixed but worth considering."> ❗ </span>'+t;break;case"info":t='<span title="Info: no action necessary and worth noting."> ⚠️ </span>'+t;break}return t}function pt(t,e,i){const n=document.createElement("div");return t=Ql(t,i),e?n.innerHTML=`<b>${t}:</b> ${e}`:n.innerHTML=`<b>${t}</b>`,n}function ut(t,e,i,n){const a=document.createElement("div");return t=Ql(t,n),a.innerHTML=`<b>${t} [${e.length}]:</b> ${e.map(o=>{switch(Q.beatNumbering){case"realtime":return`<span title="Beat ${I(i.adjustTime(o),Q.rounding)}">${wt(i.toRealTime(o))}</span>`;case"realtimems":return`<span title="Beat ${I(i.adjustTime(o),Q.rounding)}">${zn(i.toRealTime(o))}</span>`;case"jsontime":return`<span title="Time ${zn(i.toRealTime(o))}">${I(o,Q.rounding)}</span>`;case"beattime":default:return`<span title="Time ${zn(i.toRealTime(o))}">${I(i.adjustTime(o),Q.rounding)}</span>`}}).join(", ")}`,a}const ro=class{constructor(){}};let ct=ro;ct.list=[];ct.create=(t,e,i,n)=>{const a=t.trim().toLowerCase().replace(" ","-");if(ro.list.includes(a))throw new Error(a+" is already being used.");ro.list.push(a);const o=document.createElement("div"),l=document.createElement("input"),s=document.createElement("label");return s.textContent=" "+t,s.title=e,s.htmlFor="input__tools-"+a,l.id="input__tools-"+a,l.className="input-toggle",l.type="checkbox",l.checked=i,l.addEventListener("change",n),o.appendChild(l),o.appendChild(s),o};const dr="Validate Cover Image",mr="Validate cover image.",pr=!0,es={name:dr,description:mr,type:"general",order:{input:ht.GENERAL_COVER_IMAGE,output:ft.GENERAL_COVER_IMAGE},input:{enabled:pr,params:{},html:ct.create(dr,mr,pr,function(){es.input.enabled=this.checked})},output:{html:null},run:mh};function mh(){const t=new Image,e=Bt.getCoverImage(),i=[];if(Wi.loading.coverImage&&e!==null?(t.src=e,t.width!==t.height&&i.push(pt("Cover image is not square","resize to fit square","error")),(t.width<256||t.height<256)&&i.push(pt("Cover image is too small","require at least 256x256","error"))):i.push(pt("No cover image",Q.load.imageCover?"could not be loaded or found":"no cover image option is enabled")),i.length){const n=document.createElement("div");i.forEach(a=>n.append(a)),es.output.html=n}else es.output.html=null}const gr="Audio Duration",_r="For ranking purpose, check for audio duration.",br=!0,_n={name:gr,description:_r,type:"general",order:{input:ht.GENERAL_AUDIO,output:ft.GENERAL_AUDIO},input:{enabled:br,params:{},html:ct.create(gr,_r,br,function(){_n.input.enabled=this.checked})},output:{html:null},run:ph};function ph(t){const{audioDuration:e}=t.settings;e&&e<20?_n.output.html=pt("Unrankable audio length",`too short (${wt(e)}s)`,"rank"):Wi.loading.audio?_n.output.html=null:_n.output.html=pt("No audio",Q.load.audio?"could not be loaded or not found":"no audio mode is enabled")}const yr="Preview Time",vr="Warn default editor preview time.",Er=!0,is={name:yr,description:vr,type:"general",order:{input:ht.GENERAL_PREVIEW_TIME,output:ft.GENERAL_PREVIEW_TIME},input:{enabled:Er,params:{},html:ct.create(yr,vr,Er,function(){is.input.enabled=this.checked})},output:{html:null},run:gh};function gh(t){const{_previewStartTime:e,_previewDuration:i}=t.info;e===12&&i===10?is.output.html=pt("Default preview time","strongly recommended to set for audience's 1st impression","info"):is.output.html=null}function _h(t){return Math.max(...t.map(e=>e.ebpm),0)}function bh(t){return Math.max(...t.map(e=>e.ebpmSwing),0)}const Ss=4;var tt=(t=>(t[t.RED=0]="RED",t[t.BLUE=1]="BLUE",t))(tt||{}),H=(t=>(t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.UP_LEFT=4]="UP_LEFT",t[t.UP_RIGHT=5]="UP_RIGHT",t[t.DOWN_LEFT=6]="DOWN_LEFT",t[t.DOWN_RIGHT=7]="DOWN_RIGHT",t[t.ANY=8]="ANY",t))(H||{}),ot=(t=>(t[t.LEFT=0]="LEFT",t[t.MIDDLE_LEFT=1]="MIDDLE_LEFT",t[t.MIDDLE_RIGHT=2]="MIDDLE_RIGHT",t[t.RIGHT=3]="RIGHT",t))(ot||{}),Lt=(t=>(t[t.BOTTOM=0]="BOTTOM",t[t.MIDDLE=1]="MIDDLE",t[t.TOP=2]="TOP",t))(Lt||{});const jt={[0]:180,[1]:0,[2]:270,[3]:90,[4]:225,[5]:135,[6]:315,[7]:45,[8]:0},yh={[0]:1,[1]:0,[2]:3,[3]:2,[4]:7,[5]:6,[6]:5,[7]:4,[8]:8},Me={[0]:[0,1],[1]:[0,-1],[2]:[-1,0],[3]:[1,0],[4]:[-1,1],[5]:[1,1],[6]:[-1,-1],[7]:[1,-1],[8]:[0,0]},vh={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60};var tc=(t=>(t[t.DIVISION=1]="DIVISION",t[t.STEP_AND_OFFSET=2]="STEP_AND_OFFSET",t))(tc||{}),ec=(t=>(t[t.NONE=0]="NONE",t[t.DURATION=1]="DURATION",t[t.DISTRIBUTION=2]="DISTRIBUTION",t[t.ALL=3]="ALL",t))(ec||{}),ic=(t=>(t[t.NO_RANDOM=0]="NO_RANDOM",t[t.KEEP_ORDER=1]="KEEP_ORDER",t[t.RANDOM_ELEMENTS=2]="RANDOM_ELEMENTS",t[t.ALL=3]="ALL",t))(ic||{});class Do{serialize(){return JSON.stringify(this.toJSON())}clone(){return new this.constructor(this.toJSON())}}class Ts extends Do{get customData(){return this._customData}set customData(e){this._customData=e}setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return typeof e=="string"?delete this.customData[e]:e.forEach(i=>delete this.customData[i]),this}addCustomData(e){return this.customData={...this.customData,object:e},this}func(e){return e(this),this}isChroma(){return!1}isNoodleExtensions(){return!1}isMappingExtensions(){return!1}}class ke extends Ts{get time(){return this._time}set time(e){this._time=e}setTime(e){return this.time=e,this}}class Cs extends ke{get posX(){return this._posX}set posX(e){this._posX=e}get posY(){return this._posY}set posY(e){this._posY=e}setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}mirror(e=!0){return this.posX=Ss-1-this.posX,this}swapPosition(e){const i=e.posX;e.posX=this.posX,this.posX=i;const n=e.posY;return e.posY=this.posY,this.posY=n,this}getPosition(e){return[this.posX-2,this.posY]}getDistance(e){const[i,n]=this.getPosition(),[a,o]=e.getPosition();return Math.sqrt(Math.pow(a-i,2)+Math.pow(o-n,2))}isVertical(e){const[i]=this.getPosition(),[n]=e.getPosition(),a=i-n;return a>-.001&&a<.001}isHorizontal(e){const[i,n]=this.getPosition(),[a,o]=e.getPosition(),l=n-o;return l>-.001&&l<.001}isDiagonal(e){const[i,n]=this.getPosition(),[a,o]=e.getPosition(),l=Math.abs(i-a),s=Math.abs(n-o);return l===s}isInline(e,i=.5){return this.getDistance(e)<=i}isAdjacent(e){const i=this.getDistance(e);return i>.499&&i<1.001}isWindow(e,i=1.8){return this.getDistance(e)>i}isSlantedWindow(e){return this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e)}}class nc extends Cs{get color(){return this._color}set color(e){this._color=e}get direction(){return this._direction}set direction(e){this._direction=e}setColor(e){return this.color=e,this}setDirection(e){return this.direction=e,this}isRed(){return this.color===0}isBlue(){return this.color===1}mirror(e=!0){switch(e&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return super.mirror(e)}swapRotation(e,i=!0){const n=e.direction;return e.direction=this.direction,this.direction=n,this}getAngle(e){return jt[this.direction]||0}isDouble(e,i=.01){return e.time>this.time-i&&e.time<this.time+i&&this.color!==e.color}isValidDirection(){return this.direction>=0&&this.direction<=8}isValid(){return!this.isMappingExtensions()&&this.isValidDirection()}}class Ls extends nc{get type(){return this._type}set type(e){this._type=e}get angleOffset(){return this._angleOffset}set angleOffset(e){this._angleOffset=e}setType(e){return this.type=e,this}setAngleOffset(e){return this.angleOffset=e,this}isNote(){return this.type===0||this.type===1}isBomb(){return this.type===3}mirror(e=!0){return super.mirror(e)}swapRotation(e,i=!0){const n=e.angleOffset;return e.angleOffset=this.angleOffset,this.angleOffset=n,i&&(e.angleOffset=0-e.angleOffset,this.angleOffset=0-this.angleOffset),this}getAngle(e){return(jt[this.direction]||0)+this.angleOffset}isMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0||this.direction>=1e3&&this.direction<=1360||this.direction>=2e3&&this.direction<=2360}}function sc(t,e,i){return t.direction===H.ANY&&e.direction===H.ANY&&i!==H.ANY&&(t.posX>e.posX&&(i===H.UP_RIGHT||i===H.RIGHT||i===H.DOWN_RIGHT)||t.posX<e.posX&&(i===H.DOWN_LEFT||i===H.LEFT||i===H.UP_LEFT)||t.posY>e.posY&&(i===H.UP_LEFT||i===H.UP||i===H.UP_RIGHT)||t.posY<e.posY&&(i===H.DOWN_LEFT||i===H.DOWN||i===H.DOWN_RIGHT))||t.posX>e.posX&&(t.direction===H.UP_RIGHT||t.direction===H.RIGHT||t.direction===H.DOWN_RIGHT||(e.direction===H.UP_RIGHT||e.direction===H.RIGHT||e.direction===H.DOWN_RIGHT)&&t.direction===H.ANY)||t.posX<e.posX&&(t.direction===H.DOWN_LEFT||t.direction===H.LEFT||t.direction===H.UP_LEFT||(e.direction===H.DOWN_LEFT||e.direction===H.LEFT||e.direction===H.UP_LEFT)&&t.direction===H.ANY)||t.posY>e.posY&&(t.direction===H.UP_LEFT||t.direction===H.UP||t.direction===H.UP_RIGHT||(e.direction===H.UP_LEFT||e.direction===H.UP||e.direction===H.UP_RIGHT)&&t.direction===H.ANY)||t.posY<e.posY&&(t.direction===H.DOWN_LEFT||t.direction===H.DOWN||t.direction===H.DOWN_RIGHT||(e.direction===H.DOWN_LEFT||e.direction===H.DOWN||e.direction===H.DOWN_RIGHT)&&t.direction===H.ANY)}function ao(t,e,i,n=!1){const[a,o]=t.getPosition(),[l,s]=e.getPosition(),r=n?540:360;let h=!1;if(t.direction!==8){const u=t.getAngle(),m=(Ps(Math.atan2(o-s,a-l))+450)%360;for(const[c,p,_]of i){const y=_??0,b=(u+r-c+y)%360,E=(u+r+c+y)%360;if(h=p>=Math.sqrt(Math.pow(a-l,2)+Math.pow(o-s,2))&&(b<E&&b<=m&&m<=E||b>=E&&(m<=E||m>=b))||h,h)break}}let f=!1;if(e instanceof Ls&&e.direction!==8){const u=e.getAngle(),m=(Ps(Math.atan2(s-o,l-a))+450)%360;for(const[c,p,_]of i){const y=_??0,b=(u+r-c+y)%360,E=(u+r+c+y)%360;if(f=p>=Math.sqrt(Math.pow(a-l,2)+Math.pow(o-s,2))&&(b<E&&b<=m&&m<=E||b>=E&&(m<=E||m>=b))||f,f)break}}return[h,f]}function wr(t,e){if(sc(t,e,H.ANY))return t.direction===H.ANY?e.direction:t.direction;if(t.direction!==H.ANY)return t.direction;if(t.time>e.time){if(t.posX>e.posX&&t.isHorizontal(e))return H.RIGHT;if(t.posX<e.posX&&t.isHorizontal(e))return H.LEFT;if(t.posY>e.posY){if(t.isVertical(e))return H.UP;if(t.posX>e.posX)return H.UP_RIGHT;if(t.posX<e.posX)return H.UP_LEFT}if(t.posY<e.posY){if(t.isVertical(e))return H.DOWN;if(t.posX>e.posX)return H.DOWN_RIGHT;if(t.posX<e.posX)return H.DOWN_LEFT}}return H.ANY}function Dn(t,e,i,n){let a,o;if(t===null||e===null)return!1;if(typeof t=="number")a=t;else{if(t.direction===H.ANY)return!1;a=t.getAngle()}if(typeof e=="number")o=e;else{if(e.direction===H.ANY)return!1;o=e.getAngle()}return n?ar(a,o,360)<=i:ar(a,o,360)>=i}class Kt{constructor(e){this.time=e.time,this.duration=e.duration,this.minSpeed=e.minSpeed,this.maxSpeed=e.maxSpeed,this.ebpm=e.ebpm,this.ebpmSwing=e.ebpmSwing,this.data=e.data}static generate(e,i){const n=[];let a=0,o=0,l,s;const r={},h={},f={0:[],1:[]};for(const u of e)u.type==="note"&&(l=0,s=Number.MAX_SAFE_INTEGER,h[u.data.color]?this.next(u,h[u.data.color],i,f[u.data.color])&&(l=this.calcMinSliderSpeed(f[u.data.color],i),s=this.calcMaxSliderSpeed(f[u.data.color],i),l>0&&s!==1/0||(l=0,s=0),o=this.calcEBPMBetweenObject(u.data,r[u.data.color].data,i),a=this.calcEBPMBetweenObject(u.data,h[u.data.color].data,i),n.push({time:r[u.data.color].data.time,duration:h[u.data.color].data.time-r[u.data.color].data.time,data:f[u.data.color],ebpm:a,ebpmSwing:o,maxSpeed:s,minSpeed:l}),r[u.data.color]=u,f[u.data.color]=[]):r[u.data.color]=u,h[u.data.color]=u,f[u.data.color].push(u));for(let u=0;u<2;u++)h[u]&&(l=this.calcMinSliderSpeed(f[u],i),s=this.calcMaxSliderSpeed(f[u],i),l>0&&s!==1/0||(l=0,s=0),n.push({time:r[u].data.time,duration:h[u].data.time-r[u].data.time,data:f[u],ebpm:a,ebpmSwing:o,maxSpeed:s,minSpeed:l}));return n}static next(e,i,n,a){if(e.type==="bomb"||i.type==="bomb")throw new Error("Invalid type");if(a&&a.length>0&&n.toRealTime(i.data.time)+.005<n.toRealTime(e.data.time)&&e.data.direction!==H.ANY){for(const o of a)if(o.type==="note"&&o.data.direction!==H.ANY&&Dn(e.data,o.data,90,!1))return!0}if(a&&a.length>0){for(const o of a)if(o.type==="note"&&e.data.isInline(o.data))return!0}return e.data.isWindow(i.data)&&n.toRealTime(e.data.time-i.data.time)>.08||n.toRealTime(e.data.time-i.data.time)>.07}static calcEBPMBetweenObject(e,i,n){return n.value/(n.toBeatTime(n.toRealTime(e.time)-n.toRealTime(i.time))*2)}static calcMinSliderSpeed(e,i){let n=!1,a=!1,o=0;const l=i.toRealTime(Math.max(...e.map((s,r)=>r===0?0:((e[r].data.isHorizontal(e[r-1].data)||e[r].data.isVertical(e[r-1].data))&&!n&&(n=!0,o=(e[r].data.time-e[r-1].data.time)/(e[r].data.getDistance(e[r-1].data)||1)),a=e[r].data.isDiagonal(e[r-1].data)||e[r].data.isSlantedWindow(e[r-1].data)||a,(e[r].data.time-e[r-1].data.time)/(e[r].data.getDistance(e[r-1].data)||1)))));return n&&a?i.toRealTime(o):l}static calcMaxSliderSpeed(e,i){let n=!1,a=!1,o=Number.MAX_SAFE_INTEGER;const l=i.toRealTime(Math.min(...e.map((s,r)=>r===0?Number.MAX_SAFE_INTEGER:((e[r].data.isHorizontal(e[r-1].data)||e[r].data.isVertical(e[r-1].data))&&!n&&(n=!0,o=(e[r].data.time-e[r-1].data.time)/(e[r].data.getDistance(e[r-1].data)||1)),a=e[r].data.isDiagonal(e[r-1].data)||e[r].data.isSlantedWindow(e[r-1].data)||a,(e[r].data.time-e[r-1].data.time)/(e[r].data.getDistance(e[r-1].data)||1)))));return n&&a?i.toRealTime(o):l}}function Eh(t,e,i){const n={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let a,o;for(const l of t){if(l.type!=="note")continue;const s=i.toRealTime(l.data.time);l.data.color===0&&(a?Kt.next(l,a,i)&&n.left[Math.floor(s)]++:n.left[Math.floor(s)]++,a=l),l.data.color===1&&(o?Kt.next(l,o,i)&&n.right[Math.floor(s)]++:n.right[Math.floor(s)]++,o=l)}return n}function As(t,e){if(!t.length)return 0;if(t.length<e)return t.reduce((a,o)=>a+o)/t.length;let i=t.slice(0,e).reduce((a,o)=>a+o),n=i;for(let a=0;a<t.length-e;a++)i=i-t[a]+t[a+e],n=Math.max(n,i);return n/e}function Dr(t,e,i,n){const o={characteristic:i,difficulty:n,red:{average:0,peak:0,median:0,total:0},blue:{average:0,peak:0,median:0,total:0},total:{average:0,peak:0,median:0,total:0},container:Kt.generate(t.getNoteContainer(),e)},l=Math.max(e.toRealTime(t.getLastInteractiveTime()-t.getFirstInteractiveTime()),0),s=Math.max(e.toRealTime(t.getLastInteractiveTime()),0),r=Eh(t.getNoteContainer(),s,e),h=r.left.map((c,p)=>c+r.right[p]);if(h.reduce((c,p)=>c+p)===0)return o;const f=[],u=[],m=[];for(let c=0,p=Math.ceil(h.length/10);c<p;c++){const _=c*10;let y=10;y+_>h.length&&(y=h.length-_);const b=r.left.slice(_,_+y),E=r.right.slice(_,_+y),D=h.slice(_,_+y);f.push(b.reduce((C,R)=>C+R)/y),u.push(E.reduce((C,R)=>C+R)/y),m.push(D.reduce((C,R)=>C+R)/y)}return o.red.total=r.left.reduce((c,p)=>c+p),o.red.average=r.left.reduce((c,p)=>c+p)/l,o.red.peak=As(r.left,10),o.red.median=Bs(f),o.blue.total=r.right.reduce((c,p)=>c+p),o.blue.average=r.right.reduce((c,p)=>c+p)/l,o.blue.peak=As(r.right,10),o.blue.median=Bs(u),o.total.total=o.red.total+o.blue.total,o.total.average=h.reduce((c,p)=>c+p)/l,o.total.peak=As(h,10),o.total.median=Bs(m),o}function wh(t,e){let i=0,n=0,a;for(const o of t){const l=o.total.average;if(n>0&&l>0&&(i=Math.abs(1-n/l)*100),n=l>0?l:n,n>e&&i>40)return{result:o,comparedTo:a};a=o}return null}function Dh(t,e){let i=Number.MAX_SAFE_INTEGER,n=0,a;for(const o of t){const l=o.total.average;if(n>0&&l>0&&(i=Math.abs(1-n/l)*100),n=l>0?l:n,n>e&&i<10)return{result:o,comparedTo:a};a=o}return null}function Sh(t){let e=0,i=Number.MAX_SAFE_INTEGER;return t.forEach(n=>{const a=n.total.average;a>0&&(e=Math.max(e,a),i=Math.min(i,a))}),e||e&&i?(1-i/e)*100:0}function Sr(t){let e=Number.MAX_SAFE_INTEGER;return t.forEach(i=>{const n=i.total.average;n>0&&(e=Math.min(e,n))}),e}function Tr(t){let e=0;return t.forEach(i=>{const n=i.total.average;n>0&&(e=Math.max(e,n))}),e}function Th(t){return Math.max(...t.map(e=>e.minSpeed),0)}function Ch(t){const e=t.map(i=>i.maxSpeed).filter(i=>i!==0);return e.length?Math.min(...e):0}const Lh={Easy:1,Normal:3,Hard:5,Expert:7,ExpertPlus:9},_e={Easy:"Easy",Normal:"Normal",Hard:"Hard",Expert:"Expert",ExpertPlus:"Expert+"},oc="Difficulty Progression",rc="For ranking purpose, check difficuly progression to fit rankability criteria.",ac=!0,So=document.createElement("div"),lc=document.createElement("ul"),Rh=["ExpertPlus","Expert","Hard","Normal","Easy"];for(const t of Rh)lc.appendChild(ct.create(_e[t],`Toggle check progression for Standard ${_e[t]}`,!0,function(){Ge.input.params[t]=this.checked}));So.appendChild(ct.create(oc,rc,ac,function(){Ge.input.enabled=this.checked}));So.appendChild(lc);const Ge={name:oc,description:rc,type:"general",order:{input:ht.GENERAL_PROGRESSION,output:ft.GENERAL_PROGRESSION},input:{enabled:ac,params:{ExpertPlus:!0,Expert:!0,Hard:!0,Normal:!0,Easy:!0},html:So},output:{html:null},run:kh};function kh(t){var s,r,h,f,u,m,c,p;const{audioDuration:e}=t.settings;if(!e){Ge.output.html=null;return}const i=at.beatmapDifficulty.map(_=>_.swingAnalysis).filter(_=>_.characteristic==="Standard"&&Ge.input.params[_.difficulty]&&_.total.total>0).sort((_,y)=>_.total.average-y.total.average).reverse();if(!i.length){Ge.output.html=null;return}const n=Math.max(e<120?3.2:e<240?4.2:5.2,I(Tr(i)*.4,2)),a=[];e<360&&Sr(i)>n&&a.push(pt(`Minimum Sps not met (<${n})`,`lowest Sps is ${I(Sr(i),2)}, ${I(Sh(i),2)}% drop from highest Sps (${I(Tr(i),2)})`,"rank"));const o=wh(i,n),l=Dh(i,n);if(o&&e<360&&a.push(pt("Violates progression",`${_e[o.result.difficulty]} exceeded 40% SPS drop, ${I(o.result.total.average,2)} from ${I(((r=(s=o.comparedTo)==null?void 0:s.total)==null?void 0:r.average)||0,2)} ${_e[o.comparedTo.difficulty]}, acceptable range (${I((((f=(h=o.comparedTo)==null?void 0:h.total)==null?void 0:f.average)||0)*.6,2)}-${I((((u=o.comparedTo)==null?void 0:u.total.average)||0)*.9,2)})`,"rank")),l&&e<360&&a.push(pt("Violates progression",`${_e[l.result.difficulty]} has less than 10% SPS drop, ${I(l.result.total.average,2)} from ${I(((m=l.comparedTo)==null?void 0:m.total.average)||0,2)} ${_e[l.comparedTo.difficulty]}, acceptable range (${I((((c=l.comparedTo)==null?void 0:c.total.average)||0)*.6,2)}-${I((((p=l.comparedTo)==null?void 0:p.total.average)||0)*.9,2)})`,"rank")),a.length){const _=document.createElement("div");a.forEach(y=>_.append(y)),Ge.output.html=_}else Ge.output.html=null}const Cr=Object.freeze(Object.defineProperty({__proto__:null,audio:_n,coverImage:es,previewTime:is,progression:Ge},Symbol.toStringTag,{value:"Module"})),cc="Effective BPM",uc=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,hc=!0,To=450,Co=350,Ln=ct.create(cc+" threshold",uc,hc,function(){Ot.input.enabled=this.checked}),Je=document.createElement("input"),Lo=document.createElement("label"),qe=document.createElement("input"),Ro=document.createElement("label");Lo.textContent=": ";Lo.htmlFor="input__tools-ebpm";Je.id="input__tools-ebpm";Je.className="input-toggle input--small";Je.type="number";Je.min="0";Je.value=To.toString();Je.addEventListener("change",Bh);Ro.textContent=" (swing): ";Ro.htmlFor="input__tools-ebpms";qe.id="input__tools-ebpms";qe.className="input-toggle input--small";qe.type="number";qe.min="0";qe.value=Co.toString();qe.addEventListener("change",Nh);Ln.appendChild(Lo);Ln.appendChild(Je);Ln.appendChild(Ro);Ln.appendChild(qe);const Ot={name:cc,description:uc,type:"note",order:{input:ht.NOTES_EFFECTIVE_BPM,output:ft.NOTES_EFFECTIVE_BPM},input:{enabled:hc,params:{ebpmThres:To,ebpmsThres:Co},html:Ln,adjustTime:xh},output:{html:null},run:Ih};function xh(t){Ot.input.params.ebpmThres=I(Math.min(To,t.value*2*1.285714),1),Ot.input.params.ebpmsThres=I(Math.min(Co,t.value*2),1),Je.value=Ot.input.params.ebpmThres.toString(),qe.value=Ot.input.params.ebpmsThres.toString()}function Bh(){Ot.input.params.ebpmThres=I(Math.abs(parseFloat(this.value)),1),this.value=Ot.input.params.ebpmThres.toString()}function Nh(){Ot.input.params.ebpmsThres=I(Math.abs(parseFloat(this.value)),1),this.value=Ot.input.params.ebpmsThres.toString()}function Ah(t){const{swingAnalysis:e}=t.difficulty;let{ebpmThres:i,ebpmsThres:n}=Ot.input.params;i+=.001,n+=.001;const a=e.container.filter(l=>l.ebpm>i).map(l=>l.time),o=e.container.filter(l=>l.ebpmSwing>n).map(l=>l.time);return{base:a,swing:o}}function Ih(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Ah(t),{ebpmThres:i,ebpmsThres:n}=Ot.input.params,a=[];if(e.base.length&&a.push(ut(`>${i}EBPM warning`,e.base,t.settings.bpm,"warning")),e.swing.length&&a.push(ut(`>${n}EBPM (swing) warning`,e.swing,t.settings.bpm,"warning")),a.length){const o=document.createElement("div");a.forEach(l=>o.append(l)),Ot.output.html=o}else Ot.output.html=null}const fc="Acceptable Beat Precision",dc=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,mc=!0,pc=[8,6],gc=ct.create(fc+": ",dc,mc,function(){wi.input.enabled=this.checked}),Vi=document.createElement("input");Vi.id="input__tools-prec";Vi.className="input-toggle input--small";Vi.type="text";Vi.value=pc.join(" ");Vi.addEventListener("change",$h);gc.appendChild(Vi);const wi={name:fc,description:dc,type:"note",order:{input:ht.NOTES_ACCEPTABLE_PRECISION,output:ft.NOTES_ACCEPTABLE_PRECISION},input:{enabled:mc,params:{prec:[...pc]},html:gc},output:{html:null},run:Ph};function $h(){wi.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=wi.input.params.prec.join(" ")}function Oh(t,e){const{bpm:i}=t,n=e.swingAnalysis.container,{prec:a}=wi.input.params;return n.map(o=>o.time).filter((o,l,s)=>!l||o!==s[l-1]).filter(o=>{if(!a.length)return!1;for(let l=0;l<a.length;l++)if((i.adjustTime(o)+.001)%(1/a[l])<.01)return!1;return!0})}function Ph(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Oh(t.settings,t.difficulty);e.length?wi.output.html=ut("Off-beat precision",e,t.settings.bpm,"warning"):wi.output.html=null}const Lr="Varying Swing Speed",Rr="Check for varying swing speed due to changes in slider distance.",kr=!0,ns={name:Lr,description:Rr,type:"note",order:{input:ht.NOTES_VARY_SWING,output:ft.NOTES_VARY_SWING},input:{enabled:kr,params:{},html:ct.create(Lr,Rr,kr,function(){ns.input.enabled=this.checked})},output:{html:null},run:Fh};function Mh(t){const{swingAnalysis:e}=t;return e.container.filter(i=>Math.abs(i.minSpeed-i.maxSpeed)>.002).map(i=>i.time).filter((i,n,a)=>!n||i!==a[n-1])}function Fh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Mh(t.difficulty);e.length?ns.output.html=ut("Varying swing speed",e,t.settings.bpm,"error"):ns.output.html=null}const _c="Slow Slider",bc="Look for slider that require slow swing.",yc=!0,vc=.025,ji=document.createElement("div"),Ke=document.createElement("input"),ko=document.createElement("label"),Ze=document.createElement("input"),xo=document.createElement("label");let Xi;ko.textContent="min speed (ms): ";ko.htmlFor="input__tools-slow-slider-time";Ke.id="input__tools-slow-slider-time";Ke.className="input-toggle input--small";Ke.type="number";Ke.min="0";Ke.value=I(vc*1e3,1).toString();Ke.addEventListener("change",Wh);xo.textContent=" (prec): ";xo.htmlFor="input__tools-slow-slider-prec";Ze.id="input__tools-slow-slider-prec";Ze.className="input-toggle input--small";Ze.type="number";Ze.min="0";Ze.addEventListener("change",Xh);ji.appendChild(ct.create(_c,bc,yc,function(){Jt.input.enabled=this.checked}));ji.appendChild(ko);ji.appendChild(Ke);ji.appendChild(xo);ji.appendChild(Ze);const Jt={name:_c,description:bc,type:"note",order:{input:ht.NOTES_SLOW_SLIDER,output:ft.NOTES_SLOW_SLIDER},input:{enabled:yc,params:{minSpeed:vc},html:ji,adjustTime:Hh},output:{html:null},run:Gh};function Hh(t){Xi=t,Ze.value=I(1/Xi.toBeatTime(Jt.input.params.minSpeed),2).toString()}function Wh(){Jt.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=I(Jt.input.params.minSpeed*1e3,1).toString(),Xi&&(Ze.value=I(1/Xi.toBeatTime(Jt.input.params.minSpeed),2).toString())}function Xh(){if(!Xi){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;Jt.input.params.minSpeed=Xi.toRealTime(1/t),Ke.value=I(Jt.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}function zh(t){const{swingAnalysis:e}=t.difficulty,{minSpeed:i}=Jt.input.params;return e.container.filter(n=>n.maxSpeed>i||n.minSpeed>i).map(n=>n.time).filter((n,a,o)=>!a||n!==o[a-1])}function Gh(t){if(!t.difficulty){console.error("Something went wrong!");return}const{minSpeed:e}=Jt.input.params,i=zh(t);i.length?Jt.output.html=ut(`Slow slider (>${I(e*1e3,1)}ms)`,i,t.settings.bpm,"warning"):Jt.output.html=null}const Ec="Inline Sharp Angle",wc="Check for angle changes within inline note.",Dc=!0,Sc=.15;let zi;const Ji=document.createElement("div"),Qe=document.createElement("input"),Bo=document.createElement("label"),xe=document.createElement("input"),No=document.createElement("label");Bo.textContent="max time (ms): ";Bo.htmlFor="input__tools-inline-angle-time";Qe.id="input__tools-inline-angle-time";Qe.className="input-toggle input--small";Qe.type="number";Qe.min="0";Qe.value=I(Sc*1e3,1).toString();Qe.addEventListener("change",Uh);No.textContent=" (beat): ";No.htmlFor="input__tools-inline-angle-beat";xe.id="input__tools-inline-angle-beat";xe.className="input-toggle input--small";xe.type="number";xe.min="0";xe.step="0.1";xe.addEventListener("change",Vh);Ji.appendChild(ct.create(Ec,wc,Dc,function(){se.input.enabled=this.checked}));Ji.appendChild(Bo);Ji.appendChild(Qe);Ji.appendChild(No);Ji.appendChild(xe);const se={name:Ec,description:wc,type:"note",order:{input:ht.NOTES_INLINE_ANGLE,output:ft.NOTES_INLINE_ANGLE},input:{enabled:Dc,params:{maxTime:Sc},html:Ji,adjustTime:Yh},output:{html:null},run:Jh};function Yh(t){zi=t,xe.value=I(zi.toBeatTime(se.input.params.maxTime),2).toString()}function Uh(){se.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(se.input.params.maxTime*1e3,1).toString(),zi&&(xe.value=I(zi.toBeatTime(se.input.params.maxTime),2).toString())}function Vh(){if(!zi){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;se.input.params.maxTime=zi.toRealTime(t),Qe.value=I(se.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function jh(t){const{bpm:e}=t.settings,i=t.difficulty.noteContainer,{maxTime:n}=se.input.params,a=e.toBeatTime(n)+.001,o={},l={},s={},r={[tt.RED]:[],[tt.BLUE]:[]},h=[];let f=0;for(let u=0,m=i.length;u<m;u++){const c=i[u];c.type==="note"&&o[c.data.color]?Kt.next(c,o[c.data.color],e,r[c.data.color])?(s[c.data.color]&&(s[c.data.color]=null,l[c.data.color]=(l[c.data.color]+180)%360),xr(c.data,i,f,a)&&Dn(c.data,l[c.data.color],90,!0)&&h.push(c.data),c.data.direction===H.ANY?s[c.data.color]=c.data:l[c.data.color]=c.data.getAngle(),r[c.data.color]=[]):(s[c.data.color]&&xr(c.data,i,f,a)&&Dn(c.data,l[c.data.color],90,!0)&&(h.push(s[c.data.color]),s[c.data.color]=null),c.data.direction!==H.ANY&&(l[c.data.color]=c.data.getAngle())):c.type==="note"&&(l[c.data.color]=c.data.getAngle()),c.type==="note"&&(o[c.data.color]=c,r[c.data.color].push(c)),c.type==="bomb"&&(c.data.posY===Lt.BOTTOM&&(c.data.posX===ot.MIDDLE_LEFT&&(l[tt.RED]=jt[H.UP],s[tt.RED]=null),c.data.posX===ot.MIDDLE_RIGHT&&(l[tt.BLUE]=jt[H.UP],s[tt.BLUE]=null)),c.data.posY===Lt.TOP&&(c.data.posX===ot.MIDDLE_LEFT&&(l[tt.RED]=jt[H.DOWN],s[tt.RED]=null),c.data.posX===ot.MIDDLE_RIGHT&&(l[tt.BLUE]=jt[H.DOWN],s[tt.BLUE]=null)))}return h.map(u=>u.time).filter(function(u,m,c){return!m||u!==c[m-1]})}function xr(t,e,i,n){for(let a=i;e[a].data.time<t.time;a++){const o=e[a];if(o.type==="note"&&t.isInline(o.data)&&t.time-e[a].data.time<=n)return!0}return!1}function Jh(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=jh(t);e.length?se.output.html=ut("Inline sharp angle",e,t.settings.bpm,"warning"):se.output.html=null}const Tc="shrado Angle",Cc="Look for common negative curvature pattern.",Lc=!1,Rc=.15,kc=1;let Gi;const Be=document.createElement("div"),Si=document.createElement("input"),Ao=document.createElement("label"),ti=document.createElement("input"),Io=document.createElement("label"),Ne=document.createElement("input"),$o=document.createElement("label");Ao.textContent="min distance: ";Ao.htmlFor="input__tools-shrado-angle-distance";Si.id="input__tools-shrado-angle-distance";Si.className="input-toggle input--small";Si.type="number";Si.min="0";Si.value=kc.toString();Si.addEventListener("change",Kh);Io.textContent="max time (ms): ";Io.htmlFor="input__tools-shrado-angle-time";ti.id="input__tools-shrado-angle-time";ti.className="input-toggle input--small";ti.type="number";ti.min="0";ti.value=I(Rc*1e3,1).toString();ti.addEventListener("change",Zh);$o.textContent=" (beat): ";$o.htmlFor="input__tools-shrado-angle-beat";Ne.id="input__tools-shrado-angle-beat";Ne.className="input-toggle input--small";Ne.type="number";Ne.min="0";Ne.step="0.1";Ne.addEventListener("change",Qh);Be.appendChild(ct.create(Tc,Cc,Lc,function(){Pt.input.enabled=this.checked}));Be.appendChild(Ao);Be.appendChild(Si);Be.appendChild(document.createElement("br"));Be.appendChild(Io);Be.appendChild(ti);Be.appendChild($o);Be.appendChild(Ne);const Pt={name:Tc,description:Cc,type:"note",order:{input:ht.NOTES_SHRADO_ANGLE,output:ft.NOTES_SHRADO_ANGLE},input:{enabled:Lc,params:{distance:kc,maxTime:Rc},html:Be,adjustTime:qh},output:{html:null},run:ef};function qh(t){Gi=t,Ne.value=I(Gi.toBeatTime(Pt.input.params.maxTime),2).toString()}function Kh(){Pt.input.params.distance=Math.max(parseInt(this.value),0),this.value=Pt.input.params.distance.toString()}function Zh(){Pt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(Pt.input.params.maxTime*1e3,1).toString(),Gi&&(Ne.value=I(Gi.toBeatTime(Pt.input.params.maxTime),2).toString())}function Qh(){if(!Gi){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;Pt.input.params.maxTime=Gi.toRealTime(t),ti.value=I(Pt.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function tf(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,{maxTime:n,distance:a}=Pt.input.params,o=e.toBeatTime(n)+.001,l={},s={},r={},h={[tt.RED]:[],[tt.BLUE]:[]},f=[];for(let u=0,m=i.length;u<m;u++){if(i[u].type!=="note")continue;const c=i[u];l[c.data.color]?Kt.next(c,l[c.data.color],e,h[c.data.color])?(r[c.data.color]&&(r[c.data.color]=null,s[c.data.color]=yh[s[c.data.color]]??8),c.data.getDistance(l[c.data.color].data)>=a&&Br(c.data.direction,s[c.data.color],c.data.color)&&c.data.time-l[c.data.color].data.time<=o&&f.push(c),c.data.direction===H.ANY?r[c.data.color]=c:s[c.data.color]=c.data.direction,h[c.data.color]=[]):(r[c.data.color]&&c.data.getDistance(l[c.data.color].data)>=a&&Br(c.data.direction,s[c.data.color],c.data.color)&&c.data.time-l[c.data.color].data.time<=o&&(f.push(r[c.data.color]),r[c.data.color]=null),c.data.direction!==H.ANY&&(s[c.data.color]=c.data.direction)):s[c.data.color]=c.data.direction,l[c.data.color]=c,h[c.data.color].push(c)}return f.map(u=>u.data.time).filter(function(u,m,c){return!m||u!==c[m-1]})}function Br(t,e,i){return t===8||e===8?!1:(i===0?e===7:e===6)&&t===0}function ef(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=tf(t);e.length?Pt.output.html=ut("Shrado angle",e,t.settings.bpm,"warning"):Pt.output.html=null}const xc="Speed Pause",Bc="Look for stream/burst containing timing gap causing sudden change of pace.",Nc=!1,Ac=.075;let Yi;const qi=document.createElement("div"),ei=document.createElement("input"),Oo=document.createElement("label"),ii=document.createElement("input"),Po=document.createElement("label");Oo.textContent="stream speed (ms): ";Oo.htmlFor="input__tools-speed-pause-time";ei.id="input__tools-speed-pause-time";ei.className="input-toggle input--small";ei.type="number";ei.min="0";ei.value=I(Ac*1e3,1).toString();ei.addEventListener("change",sf);Po.textContent=" (prec): ";Po.htmlFor="input__tools-speed-pause-prec";ii.id="input__tools-speed-pause-prec";ii.className="input-toggle input--small";ii.type="number";ii.min="0";ii.addEventListener("change",of);qi.appendChild(ct.create(xc,Bc,Nc,function(){oe.input.enabled=this.checked}));qi.appendChild(Oo);qi.appendChild(ei);qi.appendChild(Po);qi.appendChild(ii);const oe={name:xc,description:Bc,type:"note",order:{input:ht.NOTES_SPEED_PAUSE,output:ft.NOTES_SPEED_PAUSE},input:{enabled:Nc,params:{maxTime:Ac},html:qi,adjustTime:nf},output:{html:null},run:af};function nf(t){Yi=t,ii.value=I(1/Yi.toBeatTime(oe.input.params.maxTime),2).toString()}function sf(){oe.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(oe.input.params.maxTime*1e3,1).toString(),Yi&&(ii.value=I(1/Yi.toBeatTime(oe.input.params.maxTime),2).toString())}function of(){if(!Yi){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;oe.input.params.maxTime=Yi.toRealTime(1/t),ei.value=I(oe.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}function rf(t,e){const{bpm:i}=t,{noteContainer:n}=e,{maxTime:a}=oe.input.params,o=i.toBeatTime(a)+.001,l={},s={},r={[tt.RED]:!1,[tt.BLUE]:!1},h={[tt.RED]:[],[tt.BLUE]:[]},f=[];for(let u=0,m=n.length;u<m;u++){if(n[u].type!=="note")continue;const c=n[u];l[c.data.color]?Kt.next(c,l[c.data.color],i,h[c.data.color])&&(c.data.time-l[c.data.color].data.time<=o*2?(r[tt.RED]&&r[tt.BLUE]&&l[c.data.color].data.time-s[c.data.color].data.time<=o*3&&f.push(l[c.data.color]),r[c.data.color]=!1):r[c.data.color]||(r[c.data.color]=!0,s[c.data.color]=l[c.data.color]),h[c.data.color]=[],l[c.data.color]=c):l[c.data.color]=c,h[c.data.color].push(c)}return f.map(u=>u.data.time).filter(function(u,m,c){return!m||u!==c[m-1]})}function af(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=rf(t.settings,t.difficulty);e.length?oe.output.html=ut("Speed pause",e,t.settings.bpm,"warning"):oe.output.html=null}function re(t){return Array.isArray(t)&&t.every(e=>typeof e=="number")&&t.length===3}function sn(t,e){if(!t)return t;if(typeof e=="number")return t.map(i=>i*e);if(e)if(Array.isArray(e))for(let i=0;i<t.length;i++)typeof e[i]=="number"&&(t[i]*=e[i]);else switch(t.length){case 4:t[3]=t[3]*(e.w??1);case 3:t[2]=t[2]*(e.z??1);case 2:t[1]=t[1]*(e.y??1),t[0]=t[0]*(e.x??1)}return t}const Fe=class extends Ls{constructor(t={}){super(),this._time=t.time??t.b??Fe.default.b,this._posX=t.posX??t.x??Fe.default.x,this._posY=t.posY??t.y??Fe.default.y,this._color=t.color??(t.type===0||t.type===1?t.type:t.c??Fe.default.c),this._direction=t.direction??t.d??Fe.default.d,this._angleOffset=t.angleOffset??t.a??Fe.default.a,this._customData=t.customData??Fe.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,a:this.angleOffset,customData:_t(this.customData)}}get type(){return this._color}set type(t){this._color=t}get customData(){return this._customData}set customData(t){this._customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(re(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(re(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]}))),super.mirror(t)}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData.coordinates)return[this.customData.coordinates[0],this.customData.coordinates[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"vanilla":case"ne":return super.getAngle();case"me":default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):super.getAngle()}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.link=="string"}};let ne=Fe;ne.default={b:0,c:0,x:0,y:0,d:0,a:0,customData:()=>({})};const Nr="Hitbox Staircase",Ar="Check for overlapping post-swing hitbox with note hitbox during swing.",Ir=!0,ss={name:Nr,description:Ar,type:"note",order:{input:ht.NOTES_HITBOX_STAIR,output:ft.NOTES_HITBOX_STAIR},input:{enabled:Ir,params:{},html:ct.create(Nr,Ar,Ir,function(){ss.input.enabled=this.checked})},output:{html:null},run:uf};function lf(t,e,i){for(let n=i,a=e.length;n<a;n++)if(e[n].type==="note"){if(e[n].data.time<t.data.time+.01&&e[n].data.color!==t.data.color)return!0;if(e[n].data.time>t.data.time+.01)return!1}return!1}function cf(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,n=e.toBeatTime(.15),a={},o={},l={},s={[tt.RED]:[],[tt.BLUE]:[]},r={[tt.RED]:ne.create()[0],[tt.BLUE]:ne.create({c:1})[0]},h=[];for(let f=0,u=i.length;f<u;f++){if(i[f].type!=="note")continue;const m=i[f];a[m.data.color]?(Kt.next(m,a[m.data.color],e,s[m.data.color])?(l[m.data.color]=m.data.time-a[m.data.color].data.time,m.data.direction!==H.ANY?(r[m.data.color].posX=m.data.posX+Me[m.data.direction][0],r[m.data.color].posY=m.data.posY+Me[m.data.direction][1]):(r[m.data.color].posX=-1,r[m.data.color].posY=-1),s[m.data.color]=[],o[m.data.color]=m.data.direction):sc(m.data,a[m.data.color].data,o[m.data.color])&&(m.data.direction!==H.ANY?(r[m.data.color].posX=m.data.posX+Me[m.data.direction][0],r[m.data.color].posY=m.data.posY+Me[m.data.direction][1],o[m.data.color]=m.data.direction):(r[m.data.color].posX=m.data.posX+Me[o[m.data.color]][0],r[m.data.color].posY=m.data.posY+Me[o[m.data.color]][1])),a[(m.data.color+1)%2]&&m.data.time-a[(m.data.color+1)%2].data.time!==0&&m.data.time-a[(m.data.color+1)%2].data.time<Math.min(n,l[(m.data.color+1)%2])&&m.data.posX===r[(m.data.color+1)%2].posX&&m.data.posY===r[(m.data.color+1)%2].posY&&!lf(m,i,f)&&h.push(m)):(m.data.direction!==H.ANY?(r[m.data.color].posX=m.data.posX+Me[m.data.direction][0],r[m.data.color].posY=m.data.posY+Me[m.data.direction][1]):(r[m.data.color].posX=-1,r[m.data.color].posY=-1),o[m.data.color]=m.data.direction),a[m.data.color]=m,s[m.data.color].push(m)}return h.map(f=>f.data.time).filter(function(f,u,m){return!u||f!==m[u-1]})}function uf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=cf(t);e.length?ss.output.html=ut("Hitbox staircase",e,t.settings.bpm,"rank"):ss.output.html=null}const $r="Hitbox Reverse Staircase",Or="Check for overlapping pre-swing hitbox with note hitbox during swing.",Pr=!0,os={name:$r,description:Or,type:"note",order:{input:ht.NOTES_HITBOX_REVERSE_STAIR,output:ft.NOTES_HITBOX_REVERSE_STAIR},input:{enabled:Pr,params:{},html:ct.create($r,Or,Pr,function(){os.input.enabled=this.checked})},output:{html:null},run:mf},hf=.03414823529,ff=.03414823529;function df(t){const{bpm:e,njs:i}=t.settings,{noteContainer:n}=t.difficulty,a={},o={[tt.RED]:[],[tt.BLUE]:[]},l=[];for(let s=0,r=n.length;s<r;s++){if(n[s].type!=="note")continue;const h=n[s];a[h.data.color]&&Kt.next(h,a[h.data.color],e,o[h.data.color])&&(o[h.data.color]=[]);for(const f of o[(h.data.color+1)%2])if(f.type==="note"&&f.data.direction!==H.ANY){if(!(e.toRealTime(h.data.time)>e.toRealTime(f.data.time)+.01))continue;const u=f.data.getAngle()%90>15&&f.data.getAngle()%90<75;if(i.value<1.425/(60*(h.data.time-f.data.time)/e.value+(u?ff:hf))&&ao(h.data,f.data,[[15,1.5]])[1]){l.push(f);break}}a[h.data.color]=h,o[h.data.color].push(h)}return l.map(s=>s.data.time).filter(function(s,r,h){return!r||s!==h[r-1]})}function mf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=df(t);e.length?os.output.html=ut("Hitbox reverse Staircase",e,t.settings.bpm,"rank"):os.output.html=null}const Mr="Hitbox Inline",Fr="Check for overlapping note hitbox for inline note.",Hr=!0,rs={name:Mr,description:Fr,type:"note",order:{input:ht.NOTES_HITBOX_INLINE,output:ft.NOTES_HITBOX_INLINE},input:{enabled:Hr,params:{},html:ct.create(Mr,Fr,Hr,function(){rs.input.enabled=this.checked})},output:{html:null},run:_f},pf=0;function gf(t){const{bpm:e,njs:i}=t.settings,{noteContainer:n}=t.difficulty,a={},o={[tt.RED]:[],[tt.BLUE]:[]},l=[];for(let s=0,r=n.length;s<r;s++){if(n[s].type!=="note")continue;const h=n[s];a[h.data.color]&&Kt.next(h,a[h.data.color],e,o[h.data.color])&&(o[h.data.color]=[]);for(const f of o[(h.data.color+1)%2])if(f.type==="note"&&i.value<1.425/(60*(h.data.time-f.data.time)/e.value+pf)&&h.data.isInline(f.data)){l.push(h);break}a[h.data.color]=h,o[h.data.color].push(h)}return l.map(s=>s.data.time).filter(function(s,r,h){return!r||s!==h[r-1]})}function _f(t){const e=gf(t);e.length?rs.output.html=ut("Hitbox inline",e,t.settings.bpm,"rank"):rs.output.html=null}const Wr="Hitbox Path",Xr="Check for overlapping pre-swing note hitbox at same time.",zr=!0,as={name:Wr,description:Xr,type:"note",order:{input:ht.NOTES_HITBOX_PATH,output:ft.NOTES_HITBOX_PATH},input:{enabled:zr,params:{},html:ct.create(Wr,Xr,zr,function(){as.input.enabled=this.checked})},output:{html:null},run:yf};function bf(t){const{bpm:e}=t.settings,i=t.difficulty.noteContainer.filter(o=>o.type==="bomb"||o.type==="note"),n=[];let a=0;for(let o=0,l=i.length;o<l;o++){const s=i[o];if(!(s.type==="bomb"||s.type==="arc"||s.type==="chain"||e.toRealTime(s.data.time)<a+.01))for(let r=o+1;r<l;r++){const h=i[r];if(e.toRealTime(h.data.time)>e.toRealTime(s.data.time)+.01)break;h.type==="note"&&s.data.color===h.data.color||((s.data.isHorizontal(h.data)||s.data.isVertical(h.data))&&ao(s.data,h.data,[[45,1],[15,2]]).some(f=>f)||s.data.isDiagonal(h.data)&&ao(s.data,h.data,[[45,1],[15,1.5]]).some(f=>f))&&(n.push(s.data),a=e.toRealTime(s.data.time))}}return n.map(o=>o.time).filter(function(o,l,s){return!l||o!==s[l-1]})}function yf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=bf(t);e.length?as.output.html=ut("Hitbox path",e,t.settings.bpm,"error"):as.output.html=null}const Gr="Improper Arc",Yr="Check for correct use of arc.",Ur=!0,ls={name:Gr,description:Yr,type:"note",order:{input:ht.NOTES_IMPROPER_ARC,output:ft.NOTES_IMPROPER_ARC},input:{enabled:Ur,params:{},html:ct.create(Gr,Yr,Ur,function(){ls.input.enabled=this.checked})},output:{html:null},run:Ef};function vf(t){const e=[...t.difficulty.noteContainer].sort((n,a)=>n.type!=="arc"?1:a.type!=="arc"?-1:0).sort((n,a)=>n.data.time-a.data.time),i=[];for(let n=0,a=!0,o=e.length;n<o;n++){const l=e[n],s=e.at(-1).data.time;if(l.type==="arc"){a=!0;for(let r=n,h=!1;r<o;r++){const f=e[r];if(f.type==="note"&&l.data.posX===f.data.posX&&l.data.posY===f.data.posY&&f.data.time<=l.data.time+.001&&l.data.color===f.data.color&&(f.data.direction===H.ANY||l.data.direction===f.data.direction)){for(let u=r;u<o;u++){const m=e[r];if(m.type==="bomb"&&l.data.posX===m.data.posX&&l.data.posY===m.data.posY&&m.data.time<=l.data.time+.001){h=!0;break}if(!(m.type!=="note"||m.data.time<l.data.tailTime)){if(l.data.posX===f.data.posX&&l.data.posY===f.data.posY&&f.data.time<=l.data.time+.001&&(l.data.color!==f.data.color||(f.data.direction===H.ANY||l.data.direction!==f.data.direction))){h=!0;break}if(f.data.time>l.data.tailTime+.001)break}}a=h||!1;break}if(f.type==="bomb"&&l.data.posX===f.data.posX&&l.data.posY===f.data.posY&&f.data.time<=l.data.time+.001)break;if(f.data.time>l.data.time+.001){a=!1;break}(f.type==="arc"||f.type==="chain")&&f.data.time+.001>s&&(a=!1)}a&&i.push(l)}}return i.map(n=>n.data.time).filter(function(n,a,o){return!a||n!==o[a-1]})}function Ef(t){const e=vf(t);e.length?ls.output.html=ut("Improper arc",e,t.settings.bpm,"error"):ls.output.html=null}const Vr="Improper Chain",jr="Check for correct use of chain.",Jr=!0,cs={name:Vr,description:jr,type:"note",order:{input:ht.NOTES_IMPROPER_CHAIN,output:ft.NOTES_IMPROPER_CHAIN},input:{enabled:Jr,params:{},html:ct.create(Vr,jr,Jr,function(){cs.input.enabled=this.checked})},output:{html:null},run:Df};function wf(t){const e=[...t.difficulty.noteContainer].sort((n,a)=>n.type!=="chain"?1:a.type!=="chain"?-1:0).sort((n,a)=>n.data.time-a.data.time),i=[];for(let n=0,a=!0,o=e.length;n<o;n++){const l=e[n];if(l.type==="chain"){a=!0;for(let s=n;s<o;s++){const r=e[s];if(r.type==="note"&&l.data.posX===r.data.posX&&l.data.posY===r.data.posY&&r.data.time<=l.data.time+.001&&l.data.color===r.data.color&&(r.data.direction===H.ANY||l.data.direction===r.data.direction)){a=!1;break}if(r.type==="bomb"&&l.data.posX===r.data.posX&&l.data.posY===r.data.posY&&r.data.time<=l.data.time+.001||r.data.time>l.data.time+.001)break}a&&i.push(l)}}return i.map(n=>n.data.time).filter(function(n,a,o){return!a||n!==o[a-1]})}function Df(t){const e=wf(t);e.length?cs.output.html=ut("Improper chain",e,t.settings.bpm,"error"):cs.output.html=null}const qr="Improper Window Snap",Kr="Check for slanted window snap timing.",Zr=!0,us={name:qr,description:Kr,type:"note",order:{input:ht.NOTES_IMPROPER_WINDOW,output:ft.NOTES_IMPROPER_WINDOW},input:{enabled:Zr,params:{},html:ct.create(qr,Kr,Zr,function(){us.input.enabled=this.checked})},output:{html:null},run:Tf};function Sf(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,n={},a={[tt.RED]:[],[tt.BLUE]:[]},o=[];for(let l=0,s=i.length;l<s;l++){if(i[l].type!=="note")continue;const r=i[l];n[r.data.color]?Kt.next(r,n[r.data.color],e,a[r.data.color])?(n[r.data.color]=r,a[r.data.color]=[]):r.data.isSlantedWindow(n[r.data.color].data)&&r.data.time-n[r.data.color].data.time>=.001&&r.data.direction===n[r.data.color].data.direction&&r.data.direction!==H.ANY&&n[r.data.color].data.direction!==H.ANY&&o.push(n[r.data.color]):n[r.data.color]=r,a[r.data.color].push(r)}return o.map(l=>l.data.time).filter(function(l,s,r){return!s||l!==r[s-1]})}function Tf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Sf(t);e.length?us.output.html=ut("Improper window snap",e,t.settings.bpm,"error"):us.output.html=null}const Rn={create:(t,e,i,n,...a)=>{const o=document.createElement(i);o.className=n;const l=document.createElement("select");l.className="input-toggle",l.id=t,a.forEach(r=>{const h=document.createElement("option");h.textContent=r.text,h.value=r.value,l.append(h)});const s=document.createElement("label");return s.htmlFor=t,s.innerHTML=`<span>${e}</span>`,o.append(s),o.append(l),o}};var Ic=(t=>(t.forehand="backhand",t.backhand="forehand",t))(Ic||{});const On={[tt.RED]:{forehand:[H.DOWN,H.RIGHT,H.DOWN_LEFT,H.DOWN_RIGHT],backhand:[H.UP,H.LEFT,H.UP_LEFT,H.UP_RIGHT]},[tt.BLUE]:{forehand:[H.DOWN,H.LEFT,H.DOWN_LEFT,H.DOWN_RIGHT],backhand:[H.UP,H.RIGHT,H.UP_LEFT,H.UP_RIGHT]}},li={[tt.RED]:[0,0,90,90,45,-45,45,-45],[tt.BLUE]:[0,0,-90,-90,-45,45,-45,45]},Qr={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},rn=class{constructor(t,e,i,n,a,o){this.color=e,this.warningThreshold=i,this.errorThreshold=n,this.allowedRotation=a,o&&o!=="neutral"?(this.state=o,this.rotation=0):(this.state=this.predictStartState(t,e),this.rotation=this.predictStartRotation(t,e)),this.position=this.predictStartPosition(t,e)}check(t,e){if(this.state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const i=t[0].data.time,n=this.color;let a=this.state,o=this.rotation;e.forEach(h=>{h.data.time-.001>i||(h.data.posY===Lt.BOTTOM&&h.data.posX===(n?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(a="backhand",o=0),h.data.posY===Lt.TOP&&h.data.posX===(n?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(a="forehand",o=0))});let l,s=H.ANY;for(const h of t)h.type==="note"&&(h.data.direction!==H.ANY&&(s=h.data.direction),l&&s===H.ANY&&(s=wr(h.data,l.data)),l=h);if(s===H.ANY)return"none";const r=Qr[n][Ic[a]][s];return(o>r?o-r:r-o)>180||r<rn.CONSTRAINT_ROTATION[n][0]+this.errorThreshold||r>rn.CONSTRAINT_ROTATION[n][1]-this.errorThreshold?"error":r<rn.CONSTRAINT_ROTATION[n][0]+this.warningThreshold||r>rn.CONSTRAINT_ROTATION[n][1]-this.warningThreshold||(o>r?o-r:r-o)>this.allowedRotation?"warning":"none"}next(t,e){if(this.check(t,e)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let l=0;l<t.length;l++){if(t[l].type!=="note")continue;const s=t[l];if(On[s.data.color].forehand.includes(s.data.direction)){this.state="backhand";break}if(On[s.data.color].backhand.includes(s.data.direction)){this.state="forehand";break}this.state==="neutral"&&s.data.direction===H.ANY&&(s.data.posY===0&&(this.state="backhand"),s.data.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const i=t[0].data.time,n=this.color;e.forEach(l=>{l.data.time-.001>i||(l.data.posY===Lt.BOTTOM&&l.data.posX===(n?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(this.state="forehand",this.rotation=0),l.data.posY===Lt.TOP&&l.data.posX===(n?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(this.state="backhand",this.rotation=0))});let a,o=H.ANY;for(const l of t)l.type==="note"&&(l.data.direction!==H.ANY&&(o=l.data.direction),a&&o===H.ANY&&(o=wr(l.data,a.data)),a=l);o!==H.ANY&&(this.rotation=Qr[this.color][this.state][o])}predictStartState(t,e){let i="neutral";for(let n=0,a=t.length;n<a;n++){if(t[n].type==="bomb"&&(t[n].data.posY===Lt.BOTTOM&&(t[n].data.posX===e?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(i="backhand"),t[n].data.posY===Lt.TOP&&(t[n].data.posX===e?ot.MIDDLE_RIGHT:ot.MIDDLE_LEFT)&&(i="forehand")),t[n].type!=="note")continue;let o=t[n];if(o.data.color!==Math.abs(e-1)&&o.data.color===e){if(i!=="neutral")break;const l=o.data.time;for(let s=n;s<t.length&&!(t[s].data.time>o.data.time+.001&&l<o.data.time+.001);s++){if(o=t[s],On[o.data.color].forehand.includes(o.data.direction))return"backhand";if(On[o.data.color].backhand.includes(o.data.direction))return"forehand";i==="neutral"&&o.data.direction===H.ANY&&(o.data.posY===Lt.BOTTOM&&(i="backhand"),o.data.posY>Lt.BOTTOM&&(i="forehand"))}break}}return i}predictStartRotation(t,e){let i=0;for(let n=0,a=t.length;n<a;n++){if(t[n].type!=="note")continue;let o=t[n];if(o.data.color===e&&o.data.color===e){const l=o.data.time;for(let s=n;s<t.length&&!(t[s].data.time>o.data.time+.001&&l<o.data.time+.001);s++){if(o=t[s],o.data.direction!==H.ANY)return li[o.data.color][o.data.direction];o.data.direction===H.ANY&&(o.data.posY===Lt.BOTTOM&&(o.data.posX===ot.LEFT&&(i=li[o.data.color][6]),o.data.posX===ot.RIGHT&&(i=li[o.data.color][7])),o.data.posY===Lt.MIDDLE&&(o.data.posX===ot.LEFT&&(i=li[o.data.color][2]),o.data.posX===ot.RIGHT&&(i=li[o.data.color][3])),o.data.posY===Lt.BOTTOM&&(o.data.posX===ot.LEFT&&(i=li[o.data.color][4]),o.data.posX===ot.RIGHT&&(i=li[o.data.color][5])))}break}}return i}predictStartPosition(t,e){return e?[-.5,1]:[.5,1]}};let lo=rn;lo.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];const $c="Parity Check",Oc="Perform parity check.",Pc=!1,Mc=document.createElement("div");Rn.create("input__tools-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});Rn.create("input__tools-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Rn.create("input__tools-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Mc.appendChild(ct.create($c+" (EXPERIMENTAL)",Oc,Pc,function(){Sn.input.enabled=this.checked}));const Sn={name:$c,description:Oc,type:"note",order:{input:ht.NOTES_PARITY,output:ft.NOTES_PARITY},input:{enabled:Pc,params:{warningThres:90,errorThres:45,allowedRot:90},html:Mc},output:{html:null},run:Lf};function Cf(t){const{bpm:e}=t.settings,{noteContainer:i}=t.difficulty,{warningThres:n,errorThres:a,allowedRot:o}=Sn.input.params,l={},s={[tt.RED]:[],[tt.BLUE]:[]},r={[tt.RED]:[],[tt.BLUE]:[]},h={[tt.RED]:[],[tt.BLUE]:[]},f={[tt.RED]:new lo(i,0,n,a,o),[tt.BLUE]:new lo(i,1,n,a,o)},u={warning:[],error:[]};for(let m=0,c=i.length;m<c;m++){const p=i[m];if(p.type==="note"&&l[p.data.color]&&Kt.next(p,l[p.data.color],e,s[p.data.color])){switch(f[p.data.color].check(s[p.data.color],h[p.data.color])){case"warning":{u.warning.push(s[p.data.color][0].data.time);break}case"error":{u.error.push(s[p.data.color][0].data.time);break}}f[p.data.color].next(s[p.data.color],h[p.data.color]),h[p.data.color]=r[p.data.color],r[p.data.color]=[],s[p.data.color]=[]}p.type==="bomb"&&(r[tt.RED].push(p),r[tt.BLUE].push(p)),p.type==="note"&&(l[p.data.color]=p,s[p.data.color].push(p))}for(let m=0;m<2;m++)if(l[m])switch(f[m].check(s[m],r[m])){case"warning":{u.warning.push(s[m][0].data.time);break}case"error":{u.error.push(s[m][0].data.time);break}}return u}function Lf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Cf(t);e.warning=e.warning.filter(function(n,a,o){return!a||n!==o[a-1]}).sort((n,a)=>n-a),e.error=e.error.filter(function(n,a,o){return!a||n!==o[a-1]}).sort((n,a)=>n-a);const i=[];if(e.warning.length&&i.push(ut("Parity warning",e.warning,t.settings.bpm,"warning")),e.error.length&&i.push(ut("Parity error",e.error,t.settings.bpm,"error")),i.length){const n=document.createElement("div");i.forEach(a=>n.append(a)),Sn.output.html=n}else Sn.output.html=null}const ta="Double-directional",ea="Check double-directional note swing (this may not mean parity break).",ia=!0,hs={name:ta,description:ea,type:"note",order:{input:ht.NOTES_DOUBLE_DIRECTIONAL,output:ft.NOTES_DOUBLE_DIRECTIONAL},input:{enabled:ia,params:{},html:ct.create(ta,ea,ia,function(){hs.input.enabled=this.checked})},output:{html:null},run:kf};function Rf(t,e){const{bpm:i}=t,n=e.noteContainer,a={},o={},l={},s={[tt.RED]:[],[tt.BLUE]:[]},r=[];for(let h=0,f=n.length;h<f;h++){const u=n[h];u.type==="note"&&a[u.data.color]?Kt.next(u,a[u.data.color],i,s[u.data.color])?(l[u.data.color]&&(l[u.data.color]=null,o[u.data.color]=(o[u.data.color]+180)%360),Dn(u.data,o[u.data.color],45,!0)&&r.push(u.data),u.data.direction===H.ANY?l[u.data.color]=u.data:o[u.data.color]=u.data.getAngle(),s[u.data.color]=[]):(l[u.data.color]&&Dn(u.data,o[u.data.color],45,!0)&&(r.push(u.data),l[u.data.color]=null,o[u.data.color]=u.data.getAngle()),u.data.direction!==H.ANY&&(l[u.data.color]=null,o[u.data.color]=u.data.getAngle())):u.type==="note"&&(o[u.data.color]=u.data.getAngle()),u.type==="note"&&(a[u.data.color]=u,s[u.data.color].push(u)),u.type==="bomb"&&(u.data.posY===Lt.BOTTOM&&(u.data.posX===ot.MIDDLE_LEFT&&(o[tt.RED]=jt[H.UP],l[tt.RED]=null),u.data.posX===ot.MIDDLE_RIGHT&&(o[tt.BLUE]=jt[H.UP],l[tt.BLUE]=null)),u.data.posY===Lt.TOP&&(u.data.posX===ot.MIDDLE_LEFT&&(o[tt.RED]=jt[H.DOWN],l[tt.RED]=null),u.data.posX===ot.MIDDLE_RIGHT&&(o[tt.BLUE]=jt[H.DOWN],l[tt.BLUE]=null)))}return r.map(h=>h.time).filter(function(h,f,u){return!f||h!==u[f-1]})}function kf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Rf(t.settings,t.difficulty);e.length?hs.output.html=ut("Double-directional",e,t.settings.bpm,"warning"):hs.output.html=null}const Fc="Vision Block",Hc="Check for vision block caused by center note.",Wc=!0,Xc=.1,zc=.5;let Mt;const na={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},Nt=document.createElement("div"),Ti=document.createElement("input"),Mo=document.createElement("label"),ni=document.createElement("input"),Fo=document.createElement("label"),si=document.createElement("input"),Ho=document.createElement("label"),Ae=document.createElement("input"),Wo=document.createElement("label"),ye=document.createElement("input"),Xo=document.createElement("label"),ae=document.createElement("input"),zo=document.createElement("label");Mo.textContent=" VB time specific ";Mo.htmlFor="input__tools-vb-time-check";Ti.id="input__tools-vb-time-check";Ti.className="input-toggle";Ti.type="radio";Ti.name="input__tools-vb-spec";Ti.value="time";Ti.addEventListener("change",Gc);Fo.textContent=" VB difficulty specific ";Fo.htmlFor="input__tools-vb-diff-check";ni.id="input__tools-vb-diff-check";ni.className="input-toggle";ni.type="radio";ni.checked=!0;ni.name="input__tools-vb-spec";ni.value="difficulty";ni.addEventListener("change",Gc);Ho.textContent="min time (ms): ";Ho.htmlFor="input__tools-vb-min-time";si.id="input__tools-vb-min-time";si.className="input-toggle input--small";si.type="number";si.min="0";si.value=I(Xc*1e3,1).toString();si.addEventListener("change",Bf);Wo.textContent=" (beat): ";Wo.htmlFor="input__tools-vb-min-beat";Ae.id="input__tools-vb-min-beat";Ae.className="input-toggle input--small";Ae.type="number";Ae.min="0";Ae.step="0.1";Ae.addEventListener("change",Nf);Xo.textContent="max time (ms): ";Xo.htmlFor="input__tools-vb-max-time";ye.id="input__tools-vb-max-time";ye.className="input-toggle input--small";ye.type="number";ye.min="0";ye.value=I(zc*1e3,1).toString();ye.addEventListener("change",Af);zo.textContent=" (beat): ";zo.htmlFor="input__tools-vb-max-beat";ae.id="input__tools-vb-max-beat";ae.className="input-toggle input--small";ae.type="number";ae.min="0";ae.step="0.1";ae.addEventListener("change",If);Nt.appendChild(ct.create(Fc,Hc,Wc,function(){yt.input.enabled=this.checked}));Nt.appendChild(Ti);Nt.appendChild(Mo);Nt.appendChild(ni);Nt.appendChild(Fo);Nt.appendChild(document.createElement("br"));Nt.appendChild(Ho);Nt.appendChild(si);Nt.appendChild(Wo);Nt.appendChild(Ae);Nt.appendChild(document.createElement("br"));Nt.appendChild(Xo);Nt.appendChild(ye);Nt.appendChild(zo);Nt.appendChild(ae);const yt={name:Fc,description:Hc,type:"note",order:{input:ht.NOTES_VISION_BLOCK,output:ft.NOTES_VISION_BLOCK},input:{enabled:Wc,params:{specific:"difficulty",minTime:Xc,maxTime:zc},html:Nt,adjustTime:xf},output:{html:null},run:Of};function xf(t){Mt=t,Ae.value=I(Mt.toBeatTime(yt.input.params.minTime),2).toString(),ae.value=I(Mt.toBeatTime(yt.input.params.maxTime),2).toString()}function Gc(){yt.input.params.specific=this.value}function Bf(){yt.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(yt.input.params.minTime*1e3,1).toString(),Mt&&(Ae.value=I(Mt.toBeatTime(yt.input.params.minTime),2).toString(),yt.input.params.minTime>yt.input.params.maxTime&&(yt.input.params.maxTime=yt.input.params.minTime,ye.value=I(yt.input.params.maxTime*1e3,1).toString(),ae.value=I(Mt.toBeatTime(yt.input.params.maxTime),2).toString()))}function Nf(){if(!Mt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;yt.input.params.minTime=Mt.toRealTime(t),si.value=I(yt.input.params.minTime*1e3,1).toString(),this.value=I(t,2).toString(),yt.input.params.minTime>yt.input.params.maxTime&&(yt.input.params.maxTime=yt.input.params.minTime,ye.value=I(yt.input.params.maxTime*1e3,1).toString(),ae.value=I(Mt.toBeatTime(yt.input.params.maxTime),2).toString())}function Af(){yt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=I(yt.input.params.maxTime*1e3,1).toString(),Mt&&(ae.value=I(Mt.toBeatTime(yt.input.params.maxTime),2).toString())}function If(){if(!Mt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;yt.input.params.maxTime=Mt.toRealTime(t),ye.value=I(yt.input.params.maxTime*1e3,1).toString(),this.value=I(t,2).toString()}function $f(t){const{bpm:e,njs:i}=t.settings,n=t.difficulty.data.getNoteContainer().filter(m=>m.type!=="arc"),{minTime:a,maxTime:o,specific:l}=yt.input.params,s=l==="time"?e.toBeatTime(a):e.toBeatTime(na[t.difficulty.difficulty].min),r=l==="time"?e.toBeatTime(o):Math.min(i.hjd,e.toBeatTime(na[t.difficulty.difficulty].max));let h=null,f=null;const u=[];for(let m=0,c=n.length;m<c;m++){const p=n[m];h&&(p.data.time-h.data.time>=s&&p.data.time-h.data.time<=r?p.data.posX<ot.MIDDLE_RIGHT&&u.push(p):p.data.time-h.data.time>r&&(h=null)),f&&(p.data.time-f.data.time>=s&&p.data.time-f.data.time<=r?p.data.posX>ot.MIDDLE_LEFT&&u.push(p):p.data.time-f.data.time>r&&(f=null)),p.data.posY===Lt.MIDDLE&&p.data.posX===ot.MIDDLE_LEFT&&(h=p),p.data.posY===Lt.MIDDLE&&p.data.posX===ot.MIDDLE_RIGHT&&(f=p)}return u.map(m=>m.data.time).filter(function(m,c,p){return!c||m!==p[c-1]})}function Of(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=$f(t);e.length?yt.output.html=ut("Vision block",e,t.settings.bpm,"warning"):yt.output.html=null}const sa="Stacked Note",oa="Look for stacked note.",ra=!0,fs={name:sa,description:oa,type:"note",order:{input:ht.NOTES_STACKED_NOTE,output:ft.NOTES_STACKED_NOTE},input:{enabled:ra,params:{},html:ct.create(sa,oa,ra,function(){fs.input.enabled=this.checked})},output:{html:null},run:Ff};function Pf(t,e){const{bpm:i}=t,{colorNotes:n}=e.data,a=[];let o=0;for(let l=0,s=n.length;l<s;l++)if(!(i.toRealTime(n[l].time)<o+.01))for(let r=l+1;r<s&&!(i.toRealTime(n[r].time)>i.toRealTime(n[l].time)+.01);r++)n[r].isInline(n[l])&&(a.push(n[l]),o=i.toRealTime(n[l].time));return a.map(l=>l.time).filter(function(l,s,r){return!s||l!==r[s-1]})}function Mf(t,e){const{bpm:i,njs:n}=t,{bombNotes:a}=e.data,o=[];for(let l=0,s=a.length;l<s;l++)for(let r=l+1;r<s&&!(i.toRealTime(a[r].time)>i.toRealTime(a[l].time)+1);r++)a[l].isInline(a[r])&&(n.value<i.value/(120*(a[r].time-a[l].time))||i.toRealTime(a[r].time)<i.toRealTime(a[l].time)+.02)&&o.push(a[l]);return o.map(l=>l.time).filter(function(l,s,r){return!s||l!==r[s-1]})}function Ff(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Pf(t.settings,t.difficulty),i=Mf(t.settings,t.difficulty),n=[];if(e.length&&n.push(ut("Stacked note",e,t.settings.bpm,"error")),i.length&&n.push(ut("Stacked bomb",i,t.settings.bpm,"error")),n.length){const a=document.createElement("div");n.forEach(o=>a.append(o)),fs.output.html=a}else fs.output.html=null}const aa="Color Check",la="Compare note color with other colored note and the arrow on itself.",ca=!0,ua=[1,1,1],ha={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"};function fa(t,e){let i=Object.keys(t).find(a=>parseFloat(a)>=e)??"100",n=parseFloat(i);return t[n]}const ds={name:aa,description:la,type:"note",order:{input:ht.NOTES_COLOR_CHECK,output:ft.NOTES_COLOR_CHECK},input:{enabled:ca,params:{},html:ct.create(aa+" (EXPERIMENTAL)",la,ca,function(){ds.input.enabled=this.checked})},output:{html:null},run:Xf};function Hf(t){var n,a,o,l;const e=((a=(n=t.difficulty)==null?void 0:n.info._customData)==null?void 0:a._colorLeft)??ie[ee[t.info._environmentName]??"The First"]._colorLeft,i=((l=(o=t.difficulty)==null?void 0:o.info._customData)==null?void 0:l._colorRight)??ie[ee[t.info._environmentName]??"The First"]._colorRight;return e&&i?Fs(Ce(e),Ce(i)):100}function Wf(t){var o,l,s,r;let e=100,i=100;const n=((l=(o=t.difficulty)==null?void 0:o.info._customData)==null?void 0:l._colorLeft)??ie[ee[t.info._environmentName]??"The First"]._colorLeft,a=((r=(s=t.difficulty)==null?void 0:s.info._customData)==null?void 0:r._colorRight)??ie[ee[t.info._environmentName]??"The First"]._colorRight;return n&&(e=Fs(ua,Ce(n))),a&&(i=Fs(ua,Ce(a))),Math.min(e,i)}function Xf(t){var a,o,l,s;if(!((o=(a=t.difficulty)==null?void 0:a.info._customData)!=null&&o._colorLeft)&&!((s=(l=t.difficulty)==null?void 0:l.info._customData)!=null&&s._colorRight))return;const e=Hf(t),i=Wf(t),n=[];if(e<=20&&n.push(pt(`${fa(ha,e)} note color (dE${I(e,1)})`,"suggest change to better differentiate between 2 note colour","warning")),i<=20&&n.push(pt(`${fa(ha,i)} arrow note color (dE${I(i,1)})`,"may be difficult to see the arrow","warning")),n.length){const r=document.createElement("div");n.forEach(h=>r.append(h)),ds.output.html=r}else ds.output.html=null}const da=Object.freeze(Object.defineProperty({__proto__:null,acceptablePrec:wi,colorCheck:ds,doubleDirectional:hs,effectiveBPM:Ot,hitboxInline:rs,hitboxPath:as,hitboxReverseStair:os,hitboxStair:ss,improperArc:ls,improperChain:cs,improperWindow:us,inlineAngle:se,parity:Sn,shradoAngle:Pt,slowSlider:Jt,speedPause:oe,stackedNote:fs,varySwing:ns,visionBlock:yt},Symbol.toStringTag,{value:"Module"}));class Go extends Cs{get duration(){return this._duration}set duration(e){this._duration=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}setDuration(e){return this.duration=e,this}setWidth(e){return this.width=e,this}setHeight(e){return this.height=e,this}mirror(){return this.posX=Ss-1-(this.posX+this.width-1),this}getPosition(e){return[this.posX-2,this.posY-.5]}isInteractive(){return this.posX<0&&this.width>1-this.posX||this.posX===0&&this.width>1||this.posX===1||this.posX===2}isLonger(e,i=0){return this.time+this.duration>e.time+e.duration+i}hasZero(){return this.duration===0||this.width===0||this.height===0}hasNegative(){return this.posY<0||this.duration<0||this.width<0||this.height<0}isValid(){return!this.isMappingExtensions()&&!this.hasZero()&&!this.hasNegative()}}const He=class extends Go{constructor(e={}){super(),this._time=e.time??e.b??He.default.b,this._posX=e.posX??e.x??He.default.x,this._posY=e.posY??e.y??He.default.y,this._duration=e.duration??e.d??He.default.d,this._width=e.width??e.w??He.default.w,this._height=e.height??e.h??He.default.h,this._customData=e.customData??He.default.customData()}static create(...e){const i=[];return e.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.duration,w:this.width,h:this.height,customData:_t(this.customData)}}get customData(){return this._customData}set customData(e){this._customData=e}mirror(){var i;const e=((i=this.customData.size)==null?void 0:i[0])??this.width;return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(re(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]-(this.posX+e-1):this.customData.animation.definitePosition.forEach(n=>{n[0]=-n[0]-(this.posX+e-1)})),Array.isArray(this.customData.animation.offsetPosition)&&(re(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]-(this.posX+e-1):this.customData.animation.offsetPosition.forEach(n=>{n[0]=-n[0]-(this.posX+e-1)}))),super.mirror()}getPosition(e){switch(e){case"vanilla":return super.getPosition();case"ne":if(this.customData.coordinates)return[this.customData.coordinates[0],this.customData.coordinates[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}}isChroma(){return Array.isArray(this.customData.color)}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||Array.isArray(this.customData.size)}isMappingExtensions(){return this.posY>2||this.posX<=-1e3||this.posX>=1e3}};let At=He;At.default={b:0,x:0,y:0,d:1,w:1,h:1,customData:()=>({})};const ma="<15ms Obstacle",pa=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,ga=!0,Tn={name:ma,description:pa,type:"obstacle",order:{input:ht.OBSTACLES_SHORT,output:ft.OBSTACLES_SHORT},input:{enabled:ga,params:{minDur:.015},html:ct.create(ma,pa,ga,function(){Tn.input.enabled=this.checked})},output:{html:null},run:Gf};function zf(t){const{obstacles:e}=t.difficulty.data,{bpm:i}=t.settings,{minDur:n}=Tn.input.params,a=i.toBeatTime(n),o=[];let l=At.create()[0],s=At.create()[0],r=At.create()[0],h=At.create()[0];return e.forEach(f=>{f.posY===Lt.BOTTOM&&f.height>2&&f.duration>0?f.width>2||f.width>1&&f.posX===1?(f.isLonger(l)&&(f.duration<a&&o.push(f),l=f),f.isLonger(s)&&(f.duration<a&&o.push(f),s=f)):f.width===2?f.posX===ot.LEFT?f.isLonger(l)&&(f.duration<a&&o.push(f),l=f):f.posX===ot.MIDDLE_RIGHT&&f.isLonger(s)&&(f.duration<a&&o.push(f),s=f):f.width===1&&(f.posX===ot.MIDDLE_LEFT?f.isLonger(l)&&(f.duration<a&&o.push(f),l=f):f.posX===ot.MIDDLE_RIGHT&&f.isLonger(s)&&(f.duration<a&&o.push(f),s=f)):f.posY===Lt.TOP&&f.height>2&&f.duration>0&&(f.width>2||f.width>1&&f.posX===ot.MIDDLE_LEFT?(f.isLonger(r)&&(f.duration<a&&f.isLonger(l,a)&&f.isLonger(r,a)&&o.push(f),r=f),f.isLonger(h)&&(f.duration<a&&f.isLonger(s,a)&&f.isLonger(h,a)&&o.push(f),h=f)):f.width===2?f.posX===ot.LEFT?f.isLonger(r)&&(f.duration<a&&f.isLonger(l,a)&&f.isLonger(r,a)&&o.push(f),r=f):f.posX===ot.MIDDLE_RIGHT&&f.isLonger(h)&&(f.duration<a&&f.isLonger(s,a)&&f.isLonger(h,a)&&o.push(f),h=f):f.width===1&&(f.posX===ot.MIDDLE_LEFT?f.isLonger(r)&&(f.duration<a&&f.isLonger(l,a)&&f.isLonger(r,a)&&o.push(f),r=f):f.posX===ot.MIDDLE_RIGHT&&f.isLonger(h)&&(f.duration<a&&f.isLonger(s,a)&&f.isLonger(h,a)&&o.push(f),h=f)))}),o.map(f=>f.time).filter(function(f,u,m){return!u||f!==m[u-1]})}function Gf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=zf(t);e.length?Tn.output.html=ut("<15ms obstacle",e,t.settings.bpm,"warning"):Tn.output.html=null}const Yc="2-wide Center Obstacle",Uc="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",Vc=!0,jc=.25;let Ui;const Ki=document.createElement("div"),oi=document.createElement("input"),Yo=document.createElement("label"),Ie=document.createElement("input"),Uo=document.createElement("label");Yo.textContent="recovery time (ms): ";Yo.htmlFor="input__tools-2wide-wall-time";oi.id="input__tools-2wide-wall-time";oi.className="input-toggle input--small";oi.type="number";oi.min="0";oi.value=I(jc*1e3,1).toString();oi.addEventListener("change",Uf);Uo.textContent=" (beat): ";Uo.htmlFor="input__tools-2wide-wall-beat";Ie.id="input__tools-2wide-wall-beat";Ie.className="input-toggle input--small";Ie.type="number";Ie.min="0";Ie.step="0.1";Ie.addEventListener("change",Vf);Ki.appendChild(ct.create(Yc,Uc,Vc,function(){qt.input.enabled=this.checked}));Ki.appendChild(Yo);Ki.appendChild(oi);Ki.appendChild(Uo);Ki.appendChild(Ie);const qt={name:Yc,description:Uc,type:"obstacle",order:{input:ht.OBSTACLES_CENTER,output:ft.OBSTACLES_CENTER},input:{enabled:Vc,params:{recovery:jc},html:Ki,adjustTime:Yf},output:{html:null},run:Jf};function Yf(t){Ui=t,Ie.value=I(Ui.toBeatTime(qt.input.params.recovery),2).toString()}function Uf(){qt.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=I(qt.input.params.recovery*1e3,1).toString(),Ui&&(Ie.value=I(Ui.toBeatTime(qt.input.params.recovery),2).toString())}function Vf(){if(!Ui){this.value="0";return}let t=I(Math.abs(parseFloat(this.value)),2)||1;qt.input.params.recovery=Ui.toRealTime(t),oi.value=I(qt.input.params.recovery*1e3,1).toString(),this.value=t.toString()}function jf(t){const{obstacles:e}=t.difficulty.data,{bpm:i}=t.settings,{recovery:n}=qt.input.params,a=[];let o=At.create()[0],l=At.create()[0];return e.forEach(s=>{s.posY<Lt.TOP&&s.height>1&&(s.width>2&&(a.push(s),s.isLonger(o)&&(o=s),s.isLonger(l)&&(l=s)),s.width===2&&(s.posX===ot.LEFT&&s.isLonger(o)&&(i.toRealTime(s.time)>i.toRealTime(l.time)-n&&i.toRealTime(s.time)<i.toRealTime(l.time+l.duration)+n&&a.push(s),o=s),s.posX===ot.MIDDLE_LEFT&&(a.push(s),s.isLonger(o)&&(o=s),s.isLonger(l)&&(l=s)),s.posX===ot.MIDDLE_RIGHT&&s.isLonger(l)&&(i.toRealTime(s.time)>i.toRealTime(o.time)-n&&i.toRealTime(s.time)<i.toRealTime(o.time+o.duration)+n&&a.push(s),l=s)),s.width===1&&(s.posX===ot.MIDDLE_LEFT&&s.isLonger(o)&&(i.toRealTime(s.time)>i.toRealTime(l.time)-n&&i.toRealTime(s.time)<i.toRealTime(l.time+l.duration)+n&&a.push(s),o=s),s.posX===ot.MIDDLE_RIGHT&&s.isLonger(l)&&(i.toRealTime(s.time)>i.toRealTime(o.time)-n&&i.toRealTime(s.time)<i.toRealTime(o.time+o.duration)+n&&a.push(s),l=s)))}),a.map(s=>s.time).filter(function(s,r,h){return!r||s!==h[r-1]})}function Jf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=jf(t),{recovery:i}=qt.input.params;e.length?qt.output.html=ut(`2-wide center obstacle (<${I(i*1e3)}ms)`,e,t.settings.bpm,"error"):qt.output.html=null}const _a="Zero Obstacle",ba="Look for obstacle with zero value.",ya=!0,ms={name:_a,description:ba,type:"obstacle",order:{input:ht.OBSTACLES_ZERO,output:ft.OBSTACLES_ZERO},input:{enabled:ya,params:{},html:ct.create(_a,ba,ya,function(){ms.input.enabled=this.checked})},output:{html:null},run:Kf};function qf(t){const{obstacles:e}=t.difficulty.data;return e.filter(i=>i.hasZero()).map(i=>i.time)}function Kf(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=qf(t);e.length?ms.output.html=ut("Zero value obstacle",e,t.settings.bpm,"error"):ms.output.html=null}const va=Object.freeze(Object.defineProperty({__proto__:null,centerObstacle:qt,shortObstacle:Tn,zeroObstacle:ms},Symbol.toStringTag,{value:"Module"})),Ea="Insufficient Lighting Event",wa="Check if there is enough light event.",Da=!0,ps={name:Ea,description:wa,type:"event",order:{input:ht.EVENTS_INSUFFICIENT_LIGHT,output:ft.EVENTS_INSUFFICIENT_LIGHT},input:{enabled:Da,params:{},html:ct.create(Ea,wa,Da,function(){ps.input.enabled=this.checked})},output:{html:null},run:Qf};function Zf(t,e){let i=0;for(let n=t.length-1;n>=0;n--)if(t[n].isLightEvent(e)&&!t[n].isOff()&&(i++,i>10))return!0;return!1}function Qf(t){if(!t.difficulty){console.error("Something went wrong!");return}Zf(t.difficulty.data.basicEvents,t.difficulty.characteristic==="360Degree"||t.difficulty.characteristic==="90Degree"?t.info._allDirectionsEnvironmentName:t.info._environmentName)?ps.output.html=null:ps.output.html=pt("Insufficient light event","","rank")}const Jc={Standard:"Standard",NoArrows:"No Arrows",OneSaber:"One Saber","360Degree":"360 Degree","90Degree":"90 Degree",Lightshow:"Lightshow",Lawless:"Lawless"},Sa={Standard:0,NoArrows:1,OneSaber:2,"360Degree":3,"90Degree":4,Lightshow:5,Lawless:6},Un=class{constructor(t,e=10,i=0){this._bpm=typeof t=="number"?new Re(t):t,this._njs=e,this._sdm=i}static create(t,e,i){return new Un(t,e,i)}get value(){return this._njs}set value(t){this._njs=t}get offset(){return this._sdm}set offset(t){this._sdm=t}get hjd(){return this.calcHjd()}get jd(){return this.calcJd()}get reactionTime(){return this.calcRtFromHjd()}get bpm(){return this._bpm}calcHjd(t=this.offset){const i=60/this._bpm.value;let n=Un.HJD_START;for(;this._njs*i*n>17.999;)n/=2;return n<1&&(n=1),Math.max(n+t,Un.HJD_MIN)}calcHjdFromJd(t=this.calcJd()){return t/(60/this._bpm.value*this._njs*2)}calcHjdFromRt(t=this.calcRtFromHjd()){return t/(60/this._bpm.value)}calcJd(t=this.calcHjd()){return this._njs*(60/this._bpm.value)*t*2}calcJdOptimal(){return[-(18/(this._njs+1))+18,18*(1/1.07)**this._njs+18]}calcRtFromJd(t=this.calcJd()){return t/(2*this._njs)}calcRtFromHjd(t=this.calcHjd()){return 60/this._bpm.value*t}calcDistance(t){return this._njs*60/this._bpm.value*t*2}};let be=Un;be.HJD_START=4;be.HJD_MIN=.25;be.FallbackNJS={ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10};function td(t,e){const i=Ta(t),n=Ta(e);for(const a in i){if(i[a]<n[a])return"old";if(i[a]>n[a])return"new"}return"current"}function Ta(t){return t.replace("v","").split(".").map(e=>parseInt(e))}class qc extends nc{get tailTime(){return this._tailTime}set tailTime(e){this._tailTime=e}get tailPosX(){return this._tailPosX}set tailPosX(e){this._tailPosX=e}get tailPosY(){return this._tailPosY}set tailPosY(e){this._tailPosY=e}setTailTime(e){return this.tailTime=e,this}setTailPosX(e){return this.tailPosX=e,this}setTailPosY(e){return this.tailPosY=e,this}mirror(e=!0){return this.tailPosX=Ss-1-this.tailPosX,super.mirror(e)}getTailPosition(e){return[this.tailPosX-2,this.tailPosY]}getAngle(e){return jt[this.direction]||0}getDistance(e){const[i,n]=this.getPosition(),[a,o]=e.getPosition();return Math.sqrt(Math.pow(a-i,2)+Math.pow(o-n,2))}isVertical(e){const[i]=this.getPosition(),[n]=e.getPosition(),a=i-n;return a>-.001&&a<.001}isHorizontal(e){const[i,n]=this.getPosition(),[a,o]=e.getPosition(),l=n-o;return l>-.001&&l<.001}isDiagonal(e){const[i,n]=this.getPosition(),[a,o]=e.getPosition(),l=Math.abs(i-a),s=Math.abs(n-o);return l===s}isInline(e,i=.5){return this.getDistance(e)<=i}isAdjacent(e){const i=this.getDistance(e);return i>.499&&i<1.001}isWindow(e,i=1.8){return this.getDistance(e)>i}isSlantedWindow(e){return this.isWindow(e)&&!this.isDiagonal(e)&&!this.isHorizontal(e)&&!this.isVertical(e)}isInverse(){return this.time>this.tailTime}}class Kc extends qc{get lengthMultiplier(){return this._lengthMultiplier}set lengthMultiplier(e){this._lengthMultiplier=e}get tailLengthMultiplier(){return this._tailLengthMultiplier}set tailLengthMultiplier(e){this._tailLengthMultiplier=e}get tailDirection(){return this._tailDirection}set tailDirection(e){this._tailDirection=e}get midAnchor(){return this._midAnchor}set midAnchor(e){this._midAnchor=e}setLengthMultiplier(e){return this.lengthMultiplier=e,this}setTailLengthMultiplier(e){return this.tailLengthMultiplier=e,this}setTailDirection(e){return this.tailDirection=e,this}setMidAnchor(e){return this.midAnchor=e,this}mirror(e=!0){switch(this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),super.mirror(e)}getTailAngle(e){return jt[this.tailDirection]||0}isMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360||this.tailDirection>=1e3&&this.tailDirection<=1360}isValid(){return!(this.isMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3||this.posX===this.tailPosX&&this.posY===this.tailPosY&&this.time===this.tailTime)}}class ed extends Cs{isMappingExtensions(){return this.posX>3||this.posX<0||this.posY>2||this.posY<0}isValid(){return!this.isMappingExtensions()}}class id extends ke{get bpm(){return this._bpm}set bpm(e){this._bpm=e}setBPM(e){return this.bpm=e,this}isValid(){return this.bpm>0}}class nd extends qc{get sliceCount(){return this._sliceCount}set sliceCount(e){this._sliceCount=e}get squish(){return this._squish}set squish(e){this._squish=e}setSliceCount(e){return this.sliceCount=e,this}setSquish(e){return this.squish=e,this}isMappingExtensions(){return this.posY>2||this.posY<0||this.posX<=-1e3||this.posX>=1e3||this.direction>=1e3&&this.direction<=1360}isValid(){return!(this.isMappingExtensions()||this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3)&&!(this.posX===this.tailPosX&&this.posY===this.tailPosY)}}class sd extends ke{get toggle(){return this._toggle}set toggle(e){this._toggle=e}setToggle(e){return this.toggle=e,this}isValid(){return!0}}class Vo extends Ts{constructor(){super(...arguments),this._fileName="UnnamedDifficulty.dat"}clone(){return super.clone().setFileName(this.fileName)}set fileName(e){this._fileName=e.trim()}get fileName(){return this._fileName}setFileName(e){return this.fileName=e,this}createOrKeep(e,i,n){return n&&i instanceof e?i:new e(i)}checkClass(e,i){return i instanceof e}nps(e){const i=this.getNoteContainer().filter(n=>n.type!=="bomb");return e?i.length/e:0}peak(e,i){let n=0,a=0;i=typeof i=="number"?new Re(i):i;const o=this.getNoteContainer().filter(l=>l.type!=="bomb");for(let l=0;l<o.length;l++){for(;o[l].data.time-o[a].data.time>e;)a++;n=Math.max(n,(l-a+1)/i.toRealTime(e))}return n}getFirstInteractiveTime(){const e=this.getNoteContainer().filter(a=>a.type!=="arc");let i=Number.MAX_VALUE;e.length>0&&(i=e[0].data.time);const n=this.findFirstInteractiveObstacleTime();return Math.min(i,n)}getLastInteractiveTime(){const e=this.getNoteContainer().filter(a=>a.type!=="arc");let i=0;e.length>0&&(i=e[e.length-1].data.time);const n=this.findLastInteractiveObstacleTime();return Math.max(i,n)}findFirstInteractiveObstacleTime(){for(let e=0,i=this.obstacles.length;e<i;e++)if(this.obstacles[e].isInteractive())return this.obstacles[e].time;return Number.MAX_VALUE}findLastInteractiveObstacleTime(){let e=0;for(let i=this.obstacles.length-1;i>=0;i--)this.obstacles[i].isInteractive()&&(e=Math.max(e,this.obstacles[i].time+this.obstacles[i].duration));return e}getNoteContainer(){const e=[];return this.colorNotes.forEach(i=>e.push({type:"note",data:i})),this.arcs.forEach(i=>e.push({type:"arc",data:i})),this.chains.forEach(i=>e.push({type:"chain",data:i})),this.bombNotes.forEach(i=>e.push({type:"bomb",data:i})),e.sort((i,n)=>i.data.time-n.data.time)}getEventContainer(){const e=[];return this.basicEvents.forEach(i=>e.push({type:"basicEvent",data:i})),this.colorBoostEvents.forEach(i=>e.push({type:"boost",data:i})),e.sort((i,n)=>i.data.time-n.data.time)}}class jo extends ke{get type(){return this._type}set type(e){this._type=e}get value(){return this._value}set value(e){this._value=e}get floatValue(){return this._floatValue}set floatValue(e){this._floatValue=e}setType(e){return this.type=e,this}setValue(e){return this.value=e,this}setFloatValue(e){return this.floatValue=e,this}isOff(){return this.value===0}isOn(){return this.value===1||this.value===5||this.value===9}isFlash(){return this.value===2||this.value===6||this.value===10}isFade(){return this.value===3||this.value===7||this.value===11}isTransition(){return this.value===4||this.value===8||this.value===12}isBlue(){return this.value===1||this.value===2||this.value===3||this.value===4}isRed(){return this.value===5||this.value===6||this.value===7||this.value===8}isWhite(){return this.value===9||this.value===10||this.value===11||this.value===12}isLightEvent(e){switch(e){case"LizzoEnvironment":return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===8||this.type===9||this.type===10||this.type===11||this.type===12;default:return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}}isColorBoost(){return this.type===5}isRingEvent(e){switch(e){case"LizzoEnvironment":return!1;default:return this.type===8||this.type===9}}isLaserRotationEvent(e){switch(e){case"LizzoEnvironment":return!1;default:return this.type===12||this.type===13}}isLaneRotationEvent(e){return this.type===14||this.type===15}isExtraEvent(e){return this.type===16||this.type===17||this.type===18||this.type===19}isSpecialEvent(e){return this.type===40||this.type===41||this.type===42||this.type===43}isBpmEvent(){return this.type===100}isLightingEvent(e){return this.isLightEvent(e)||this.isRingEvent(e)||this.isLaserRotationEvent(e)||this.isExtraEvent(e)}isOldChroma(){return this.value>=2e9}isValidType(){return this.type>=0&&this.type<=19||this.type>=40&&this.type<=43||this.type===100}isValid(){return this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.isOldChroma())}}class Jo extends Ts{get filter(){return this._filter}set filter(e){this._filter=e}get beatDistribution(){return this._beatDistribution}set beatDistribution(e){this._beatDistribution=e}get beatDistributionType(){return this._beatDistributionType}set beatDistributionType(e){this._beatDistributionType=e}get easing(){return this._easing}set easing(e){this._easing=e}get events(){return this._events}set events(e){this._events=e}setFilter(e){return this.filter=e,this}setBeatDistribution(e){return this.beatDistribution=e,this}setBeatDistributionType(e){return this.beatDistributionType=e,this}setEasing(e){return this.easing=e,this}isValid(){return(this.beatDistributionType===1||this.beatDistributionType===2)&&this.easing>=0&&this.easing<=3&&this.events.every(e=>e.isValid())&&this.filter.isValid()}}class qo extends ke{get id(){return this._id}set id(e){this._id=e}get boxes(){return this._boxes}set boxes(e){this._boxes=e}isValid(){return this.id>=0&&this.boxes.every(e=>e.isValid())}}class Zc extends Do{get keyword(){return this._keyword}set keyword(e){this._keyword=e}get events(){return this._events}set events(e){this._events=e}setKeyword(e){return this.keyword=e,this}setEvents(e){return this.events=e,this}addEvent(e){return this.events.push(e),this}removeEvent(e){const i=this.events.indexOf(e,0);return i>-1&&this.events.splice(i,1),this}}class Qc extends Do{get list(){return this._list}set list(e){this._list=e}setData(e){return this.list=e,this}removeData(e){return this.list=this.list.filter(i=>i.keyword!==e),this}}class od extends Ts{get type(){return this._type}set type(e){this._type=e}get p0(){return this._p0}set p0(e){this._p0=e}get p1(){return this._p1}set p1(e){this._p1=e}get reverse(){return this._reverse}set reverse(e){this._reverse=e}get chunks(){return this._chunks}set chunks(e){this._chunks=e}get limit(){return this._limit}set limit(e){this._limit=e}get limitAffectsType(){return this._limitAffectsType}set limitAffectsType(e){this._limitAffectsType=e}get random(){return this._random}set random(e){this._random=e}get seed(){return this._seed}set seed(e){this._seed=e}setType(e){return this.type=e,this}setP0(e){return this.p0=e,this}setP1(e){return this.p1=e,this}setReverse(e){return this.reverse=e,this}setChunks(e){return this.chunks=e,this}setRandom(e){return this.random=e,this}setSeed(e){return this.seed=e,this}setLimit(e){return this.limit=e,this}setLimitAffectsType(e){return this.limitAffectsType=e,this}isValid(){return(this.type===1||this.type===2)&&this.p0>=0&&this.p1>=0&&(this.reverse===0||this.reverse===1)&&this.chunks>=0&&this.random>=0&&this.random<=ic.ALL&&this.limit>=0&&this.limit<=0&&this.limitAffectsType>=0&&this.limitAffectsType<=ec.ALL}}class rd extends ke{get transition(){return this._transition}set transition(e){this._transition=e}get color(){return this._color}set color(e){this._color=e}get brightness(){return this._brightness}set brightness(e){this._brightness=e}get frequency(){return this._frequency}set frequency(e){this._frequency=e}setTransition(e){return this.transition=e,this}setColor(e){return this.color=e,this}setBrightness(e){return this.brightness=e,this}setFrequency(e){return this.frequency=e,this}isValid(){return this.transition>=0&&this.transition<=2&&this.color>=-1&&this.color<=2&&this.brightness>=0&&this.frequency>=0}}class ad extends Jo{get brightnessDistribution(){return this._brightnessDistribution}set brightnessDistribution(e){this._brightnessDistribution=e}get brightnessDistributionType(){return this._brightnessDistributionType}set brightnessDistributionType(e){this._brightnessDistributionType=e}get affectFirst(){return this._affectFirst}set affectFirst(e){this._affectFirst=e}get events(){return this._events}set events(e){this._events=e}setBrightnessDistribution(e){return this.brightnessDistribution=e,this}setBrightnessDistributionType(e){return this.brightnessDistributionType=e,this}setAffectFirst(e){return this.affectFirst=e,this}isValid(){return super.isValid()&&(this.brightnessDistributionType===1||this.brightnessDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}}class ld extends qo{get boxes(){return this._boxes}set boxes(e){this._boxes=e}}class cd extends ke{get previous(){return this._previous}set previous(e){this._previous=e}get easing(){return this._easing}set easing(e){this._easing=e}get loop(){return this._loop}set loop(e){this._loop=e}get rotation(){return this._rotation}set rotation(e){this._rotation=e}get direction(){return this._direction}set direction(e){this._direction=e}setPrevious(e){return this.previous=e,this}setEasing(e){return this.easing=e,this}setLoop(e){return this.loop=e,this}setRotation(e){return this.rotation=e,this}setDirection(e){return this.direction=e,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3&&(this.loop===0||this.loop===1)&&this.direction>=0&&this.direction<=2}}class ud extends Jo{get rotationDistribution(){return this._rotationDistribution}set rotationDistribution(e){this._rotationDistribution=e}get rotationDistributionType(){return this._rotationDistributionType}set rotationDistributionType(e){this._rotationDistributionType=e}get axis(){return this._axis}set axis(e){this._axis=e}get flip(){return this._flip}set flip(e){this._flip=e}get affectFirst(){return this._affectFirst}set affectFirst(e){this._affectFirst=e}get events(){return this._events}set events(e){this._events=e}setRotationDistribution(e){return this.rotationDistribution=e,this}setRotationDistributionType(e){return this.rotationDistributionType=e,this}setAxis(e){return this.axis=e,this}setFlip(e){return this.flip=e,this}setAffectFirst(e){return this.affectFirst=e,this}isValid(){return super.isValid()&&(this.rotationDistributionType===1||this.rotationDistributionType===2)&&(this.axis===0||this.axis===1)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}class hd extends qo{get boxes(){return this._boxes}set boxes(e){this._boxes=e}}class fd extends ke{get previous(){return this._previous}set previous(e){this._previous=e}get easing(){return this._easing}set easing(e){this._easing=e}get translation(){return this._translation}set translation(e){this._translation=e}setPrevious(e){return this.previous=e,this}setEasing(e){return this.easing=e,this}setTranslation(e){return this.translation=e,this}isValid(){return(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=3}}class dd extends Jo{get translationDistribution(){return this._translationDistribution}set translationDistribution(e){this._translationDistribution=e}get translationDistributionType(){return this._translationDistributionType}set translationDistributionType(e){this._translationDistributionType=e}get axis(){return this._axis}set axis(e){this._axis=e}get flip(){return this._flip}set flip(e){this._flip=e}get affectFirst(){return this._affectFirst}set affectFirst(e){this._affectFirst=e}get events(){return this._events}set events(e){this._events=e}setTranslationDistribution(e){return this.translationDistribution=e,this}setTranslationDistributionType(e){return this.translationDistributionType=e,this}setAxis(e){return this.axis=e,this}setFlip(e){return this.flip=e,this}setAffectFirst(e){return this.affectFirst=e,this}isValid(){return super.isValid()&&(this.translationDistributionType===1||this.translationDistributionType===2)&&(this.axis===0||this.axis===1)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}class md extends qo{get boxes(){return this._boxes}set boxes(e){this._boxes=e}}class pd extends ke{get executionTime(){return this._executionTime}set executionTime(e){this._executionTime=e}get rotation(){return this._rotation}set rotation(e){this._rotation=e}setExecutionTime(e){return this.executionTime=e,this}setRotation(e){return this.rotation=e,this}isValid(){return this.executionTime===0||this.executionTime===1}}class tu extends Cs{get direction(){return this._direction}set direction(e){this._direction=e}setDirection(e){return this.direction=e,this}mirror(){switch(this.posX=Ss-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}isValid(){return this.direction>=0&&this.direction<=9&&this.direction!==8}}function Ca(t){return["beatmap","v1","note",t]}const ki=class extends Ls{constructor(e={}){super(),this._time=e.time??e._time??ki.default._time,this._posX=e.posX??e._lineIndex??ki.default._lineIndex,this._posY=e.posY??e._lineLayer??ki.default._lineLayer,this._type=e.type??e.color??e._type??ki.default._type,this._direction=e.direction??e._cutDirection??ki.default._cutDirection}static create(...e){const i=[];return e.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_cutDirection:this.direction}}get color(){return this._type}set color(e){this._type=e}get angleOffset(){return 0}set angleOffset(e){q.tWarn(Ca("customData"),"Note angle offset does not exist in beatmap V1")}get customData(){return{}}set customData(e){q.tWarn(Ca("customData"),"Note custom data does not exist in beatmap V1")}getPosition(e){switch(e){case"vanilla":case"ne":return super.getPosition();case"me":default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(e){switch(e){case"vanilla":case"ne":return super.getAngle(e);case"me":default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):super.getAngle()}}};let We=ki;We.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0};function gd(t){return["beatmap","v1","obstacle",t]}const xi=class extends Go{constructor(e={}){super(),this._time=e.time??e._time??xi.default._time,this._type=e._type??xi.default._type,this._posX=e.posX??e._lineIndex??xi.default._lineIndex,this._duration=e.duration??e._duration??xi.default._duration,this._width=e.width??e._width??xi.default._width}static create(...e){const i=[];return e.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_duration:this.duration,_width:this.width}}get type(){return this._type}set type(e){this._type=e}get posY(){return this.type==1?2:0}set posY(e){switch(e){case 2:this.type=1;break;default:this.type=0}}get height(){return this.type==1?3:5}set height(e){switch(e){case 3:this.type=1;break;default:this.type=0}}get customData(){return{}}set customData(e){q.tWarn(gd("customData"),"Obstacle custom data does not exist in beatmap V1")}getPosition(e){switch(e){case"vanilla":case"ne":return super.getPosition();case"me":default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}}isMappingExtensions(){return this.type>2||this.posX<=-1e3||this.posX>=1e3}};let Bi=xi;Bi.default={_time:0,_lineIndex:0,_type:0,_duration:1,_width:1};function La(t){return["beatmap","v1","event",t]}const Vn=class extends jo{constructor(e={}){super(),this._time=e.time??e._time??Vn.default._time,this._type=e.type??e._type??Vn.default._type,this._value=e.value??e._value??Vn.default._value}static create(...e){const i=[];return e.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_type:this.type,_value:this.value}}get floatValue(){return 1}set floatValue(e){q.tWarn(La("floatValue"),"Event float value does not exist in beatmap V1")}get customData(){return{}}set customData(e){q.tWarn(La("customData"),"Event custom data does not exist in beatmap V1")}isMappingExtensions(){return this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720}};let me=Vn;me.default={_time:0,_type:0,_value:0};function Ee(t){return["beatmap","v1","difficulty",t]}let _d=class extends Vo{constructor(e={}){super(),this.bpmEvents=[],this.rotationEvents=[],this.bombNotes=[],this.arcs=[],this.chains=[],this.waypoints=[],this.colorBoostEvents=[],this.lightColorEventBoxGroups=[],this.lightRotationEventBoxGroups=[],this.lightTranslationEventBoxGroups=[],this.useNormalEventsAsCompatibleEvents=!0,this.version="1.5.0",this.beatsPerMinute=e._beatsPerMinute??120,this.beatsPerBar=e._beatsPerBar??4,this.shuffle=e._shuffle??0,this.shufflePeriod=e._shufflePeriod??0,this.noteJumpSpeed=e._noteJumpSpeed??0,this.noteJumpStartBeatOffset=e._noteJumpStartBeatOffset??0,this.colorNotes=(e._notes??[]).map(i=>new We(i)),this.obstacles=(e._obstacles??[]).map(i=>new Bi(i)),this.basicEvents=(e._events??[]).map(i=>new me(i)),this.time=e._time??0,this.BPMChanges=e._BPMChanges??[],this.bookmarks=e._bookmarks??[]}static create(e={}){return new this(e)}toJSON(){return{_version:"1.5.0",_beatsPerMinute:this.beatsPerMinute,_beatsPerBar:this.beatsPerBar,_shuffle:this.shuffle,_shufflePeriod:this.shufflePeriod,_noteJumpSpeed:this.noteJumpSpeed,_noteJumpStartBeatOffset:this.noteJumpStartBeatOffset,_notes:this.colorNotes.map(e=>e.toJSON()),_obstacles:this.obstacles.map(e=>e.toJSON()),_events:this.basicEvents.map(e=>e.toJSON()),_time:this.time,_BPMChanges:this.BPMChanges,_bookmarks:this.bookmarks}}get customData(){return{}}set customData(e){q.tWarn(Ee("customData"),"Custom data does not exist in beatmap V1")}reparse(e){this.colorNotes=this.colorNotes.map(i=>this.createOrKeep(We,i,e)),this.obstacles=this.obstacles.map(i=>this.createOrKeep(Bi,i,e)),this.basicEvents=this.basicEvents.map(i=>this.createOrKeep(me,i,e))}addBpmEvents(...e){q.tWarn(Ee("addBpmEvents"),"BPM Event does not exist in beatmap V1")}addRotationEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof me?i:new me({...i,type:typeof i.executionTime=="number"?i.executionTime===0?14:15:i._type}))),q.tWarn(Ee("addRotationEvents"),"This may not work correctly")}addColorNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof We?i:new We(i)))}addBombNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof We?i:new We({...i,type:3})))}addObstacles(...e){this.obstacles.push(...e.map(i=>i instanceof Bi?i:new Bi(i)))}addArcs(...e){q.tWarn(Ee("addArcs"),"Arc does not exist in beatmap V1")}addChains(...e){q.tWarn(Ee("addChains"),"Chain does not exist in beatmap V1")}addWaypoints(...e){q.tWarn(Ee("addWaypoints"),"Waypoint does not exist in beatmap V1")}addBasicEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof me?i:new me(i)))}addColorBoostEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof me?i:new me({...i,value:i.toggle?1:i._value})))}addLightColorEventBoxGroups(...e){q.tWarn(Ee("addLightColorEventBoxGroups"),"Light Color Event Box Group does not exist in beatmap V1")}addLightRotationEventBoxGroups(...e){q.tWarn(Ee("addLightRotationEventBoxGroups"),"Light Rotation Event Box Group does not exist in beatmap V1")}addLightTranslationEventBoxGroups(...e){q.tWarn(Ee("addLightTranslationEventBoxGroups"),"Light Translation Event Box Group does not exist in beatmap V1")}isValid(){return this.colorNotes.every(e=>this.checkClass(We,e))||this.obstacles.every(e=>this.checkClass(Bi,e))||this.basicEvents.every(e=>this.checkClass(me,e))}};const It=class extends Kc{constructor(e={}){super(),this._color=e.color??e._colorType??It.default._colorType,this._time=e.time??e._headTime??e._tailTime??It.default._headTime,this._posX=e.posX??e._headLineIndex??It.default._headLineIndex,this._posY=e.posY??e._headLineLayer??It.default._headLineLayer,this._direction=e.direction??e._headCutDirection??It.default._headCutDirection,this._lengthMultiplier=e.lengthMultiplier??e._headControlPointLengthMultiplier??It.default._headControlPointLengthMultiplier,this._tailTime=e.tailTime??e._tailTime??e._headTime??It.default._tailTime,this._tailPosX=e.tailPosX??e._tailLineIndex??It.default._tailLineIndex,this._tailPosY=e.tailPosY??e._tailLineLayer??It.default._tailLineLayer,this._tailDirection=e.tailDirection??e._tailCutDirection??It.default._tailCutDirection,this._tailLengthMultiplier=e.tailLengthMultiplier??e._tailControlPointLengthMultiplier??It.default._tailControlPointLengthMultiplier,this._midAnchor=e.midAnchor??e._sliderMidAnchorMode??It.default._sliderMidAnchorMode,this._customData=e.customData??e._customData??It.default._customData()}static create(...e){const i=[];return e.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_colorType:this.color,_headTime:this.time,_headLineIndex:this.posX,_headLineLayer:this.posY,_headCutDirection:this.direction,_headControlPointLengthMultiplier:this.lengthMultiplier,_tailTime:this.tailTime,_tailLineIndex:this.tailPosX,_tailLineLayer:this.tailPosY,_tailCutDirection:this.tailDirection,_tailControlPointLengthMultiplier:this.tailLengthMultiplier,_sliderMidAnchorMode:this.midAnchor,_customData:_t(this.customData)}}get customData(){return this._customData}set customData(e){this._customData=e}};let Ni=It;Ni.default={_colorType:0,_headTime:0,_headLineIndex:0,_headLineLayer:0,_headCutDirection:0,_headControlPointLengthMultiplier:1,_tailTime:0,_tailLineIndex:0,_tailLineLayer:0,_tailCutDirection:0,_tailControlPointLengthMultiplier:1,_sliderMidAnchorMode:0,_customData:()=>({})};function bd(t){return["beatmap","v2","note",t]}const ui=class extends Ls{constructor(t={}){super(),this._time=t.time??t._time??ui.default._time,this._posX=t.posX??t._lineIndex??ui.default._lineIndex,this._posY=t.posY??t._lineLayer??ui.default._lineLayer,this._type=t.type??t.color??t._type??ui.default._type,this._direction=t.direction??t._cutDirection??ui.default._cutDirection,this._customData=t.customData??t._customData??ui.default._customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_lineLayer:this.posY,_cutDirection:this.direction,_customData:_t(this.customData)}}get color(){return this._type}set color(t){this._type=t}get angleOffset(){return 0}set angleOffset(t){q.tWarn(bd("customData"),"Note angle offset does not exist in beatmap V2")}get customData(){return this._customData}set customData(t){this._customData=t}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData._position)return[this.customData._position[0],this.customData._position[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"vanilla":return super.getAngle(t);case"ne":if(this.customData._cutDirection)return this.customData._cutDirection>0?this.customData._cutDirection%360:360+this.customData._cutDirection%360;case"me":default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):super.getAngle()}}isChroma(){return Array.isArray(this.customData._color)||typeof this.customData._disableSpawnEffect=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._cutDirection=="number"||typeof this.customData._disableNoteGravity=="boolean"||typeof this.customData._disableNoteLook=="boolean"||typeof this.customData._fake=="boolean"||Array.isArray(this.customData._flip)||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)}};let Xe=ui;Xe.default={_time:0,_lineIndex:0,_lineLayer:0,_type:0,_cutDirection:0,_customData:()=>({})};const hi=class extends Go{constructor(t={}){super(),this._time=t.time??t._time??hi.default._time,this._type=t._type??hi.default._type,this._posX=t.posX??t._lineIndex??hi.default._lineIndex,this._duration=t.duration??t._duration??hi.default._duration,this._width=t.width??t._width??hi.default._width,this._customData=t.customData??t._customData??hi.default._customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{_time:this.time,_type:this.type,_lineIndex:this.posX,_duration:this.duration,_width:this.width,_customData:_t(this.customData)}}get type(){return this._type}set type(t){this._type=t}get posY(){return this.type==1?2:0}set posY(t){switch(t){case 2:this.type=1;break;default:this.type=0}}get height(){return this.type==1?3:5}set height(t){switch(t){case 3:this.type=1;break;default:this.type=0}}get customData(){return this._customData}set customData(t){this._customData=t}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData._position)return[this.customData._position[0],this.customData._position[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,(this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY)-.5]}}isChroma(){return Array.isArray(this.customData._color)}isNoodleExtensions(){return Array.isArray(this.customData._animation)||typeof this.customData._fake=="boolean"||typeof this.customData._interactable=="boolean"||Array.isArray(this.customData._localRotation)||typeof this.customData._noteJumpMovementSpeed=="number"||typeof this.customData._noteJumpStartBeatOffset=="number"||Array.isArray(this.customData._position)||Array.isArray(this.customData._rotation)||Array.isArray(this.customData._scale)}isMappingExtensions(){return this.type>2||this.posX<=-1e3||this.posX>=1e3}};let Ai=hi;Ai.default={_time:0,_lineIndex:0,_type:0,_duration:1,_width:1,_customData:()=>({})};const Ii=class extends jo{constructor(t={}){super(),this._time=t.time??t._time??Ii.default._time,this._type=t.type??t._type??Ii.default._type,this._value=t.value??t._value??Ii.default._value,this._floatValue=t.floatValue??t._floatValue??Ii.default._floatValue,this._customData=t.customData??t._customData??Ii.default._customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{_time:this.time,_type:this.type,_value:this.value,_floatValue:this.floatValue,_customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}isLightEvent(t){return super.isLightEvent(t)}isRingEvent(t){return super.isRingEvent(t)}isLaserRotationEvent(t){return super.isLaserRotationEvent(t)}isLaneRotationEvent(t){return super.isLaneRotationEvent(t)}isChroma(){const t=this;return t.isLightEvent()?Array.isArray(this.customData._color)||typeof this.customData._lightID=="number"||Array.isArray(this.customData._lightID)||typeof this.customData._propID=="number"||typeof this.customData._lightGradient=="object"||typeof this.customData._easing=="string"||typeof this.customData._lerpType=="string":t.isRingEvent()?typeof this.customData._nameFilter=="string"||typeof this.customData._reset=="boolean"||typeof this.customData._rotation=="number"||typeof this.customData._step=="number"||typeof this.customData._prop=="number"||typeof this.customData._speed=="number"||typeof this.customData._direction=="number"||typeof this.customData._counterSpin=="boolean"||typeof this.customData._stepMult=="number"||typeof this.customData._propMult=="number"||typeof this.customData._speedMult=="number":t.isLaserRotationEvent()?typeof this.customData._lockPosition=="boolean"||typeof this.customData._speed=="number"||typeof this.customData._preciseSpeed=="number"||typeof this.customData._direction=="number":!1}isNoodleExtensions(){return this.isLaneRotationEvent()&&typeof this.customData._rotation=="number"}isMappingExtensions(){return this.isLaneRotationEvent()&&this.value>=1e3&&this.value<=1720}};let zt=Ii;zt.default={_time:0,_type:0,_value:0,_floatValue:1,_customData:()=>({})};const $i=class extends tu{constructor(e={}){super(),this._time=e.time??e._time??$i.default._time,this._posX=e.posX??e._lineIndex??$i.default._lineIndex,this._posY=e.posY??e._lineLayer??$i.default._lineLayer,this._direction=e.direction??e._offsetDirection??$i.default._offsetDirection,this._customData=e.customData??e._customData??$i.default._customData()}static create(...e){const i=[];return e.forEach(n=>i.push(new this(n))),i.length?i:[new this]}toJSON(){return{_time:this.time,_lineIndex:this.posX,_lineLayer:this.posY,_offsetDirection:this.direction,_customData:_t(this.customData)}}get customData(){return this._customData}set customData(e){this._customData=e}};let Oi=$i;Oi.default={_time:0,_lineIndex:0,_lineLayer:0,_offsetDirection:0,_customData:()=>({})};const co=class extends Zc{constructor(t={}){super(),this._keyword=t.keyword??t._keyword??co.default._keyword,this._events=t.events??t._specialEvents??co.default._specialEvents()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{_keyword:this.keyword,_specialEvents:this.events}}};let eu=co;eu.default={_keyword:"",_specialEvents:()=>[]};const iu=class extends Qc{constructor(t={}){var e;super(),this._list=(((e=t.list)==null?void 0:e.map(i=>({_keyword:i==null?void 0:i.keyword,_specialEvents:i==null?void 0:i.events})))??t._keywords??iu.default._keywords()).map(i=>new eu({_keyword:i._keyword,_specialEvents:i._specialEvents}))}static create(t={}){return new this(t)}toJSON(){return{_keywords:this.list.map(t=>t.toJSON())}}get list(){return this._list}set list(t){this._list=t}addData(t){return this._list.push(t),this}};let jn=iu;jn.default={_keywords:()=>[]};function on(t){return["beatmap","v2","difficulty",t]}let nu=class extends Vo{constructor(e={}){super(),this.bpmEvents=[],this.rotationEvents=[],this.bombNotes=[],this.chains=[],this.colorBoostEvents=[],this.lightColorEventBoxGroups=[],this.lightRotationEventBoxGroups=[],this.lightTranslationEventBoxGroups=[],this.useNormalEventsAsCompatibleEvents=!0,this.version="2.6.0",this.colorNotes=(e._notes??[]).map(i=>new Xe(i)),this.arcs=(e._sliders??[]).map(i=>new Ni(i)),this.obstacles=(e._obstacles??[]).map(i=>new Ai(i)),this.basicEvents=(e._events??[]).map(i=>new zt(i)),this.waypoints=(e._waypoints??[]).map(i=>new Oi(i)),this.eventTypesWithKeywords=new jn(e._specialEventsKeywordFilters??{_keywords:[]}),this.customData=this._customData??{}}static create(e={}){return new this(e)}toJSON(){return{_version:"2.6.0",_notes:this.colorNotes.map(e=>e.toJSON()),_sliders:this.arcs.map(e=>e.toJSON()),_obstacles:this.obstacles.map(e=>e.toJSON()),_events:this.basicEvents.map(e=>e.toJSON()),_waypoints:this.waypoints.map(e=>e.toJSON()),_specialEventsKeywordFilters:this.eventTypesWithKeywords.toJSON(),_customData:_t(this.customData)}}get customData(){return this._customData}set customData(e){this._customData=e}reparse(e){this.colorNotes=this.colorNotes.map(i=>this.createOrKeep(Xe,i,e)),this.obstacles=this.obstacles.map(i=>this.createOrKeep(Ai,i,e)),this.basicEvents=this.basicEvents.map(i=>this.createOrKeep(zt,i,e)),this.waypoints=this.waypoints.map(i=>this.createOrKeep(Oi,i,e)),this.arcs=this.arcs.map(i=>this.createOrKeep(Ni,i,e)),this.eventTypesWithKeywords=new jn(this.eventTypesWithKeywords)}addBpmEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof zt?i:new zt({...i,type:100,value:i.bpm})))}addRotationEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof zt?i:new zt({...i,type:typeof i.executionTime=="number"?i.executionTime===0?14:15:i._type}))),q.tWarn(on("addRotationEvents"),"This may not work correctly")}addColorNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof Xe?i:new Xe(i)))}addBombNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof Xe?i:new Xe({...i,type:3})))}addObstacles(...e){this.obstacles.push(...e.map(i=>i instanceof Ai?i:new Ai(i)))}addArcs(...e){this.arcs.push(...e.map(i=>i instanceof Ni?i:new Ni(i)))}addChains(...e){q.tWarn(on("addChains"),"Chain does not exist in beatmap V2")}addWaypoints(...e){this.waypoints.push(...e.map(i=>i instanceof Oi?i:new Oi(i)))}addBasicEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof zt?i:new zt(i)))}addColorBoostEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof zt?i:new zt({...i,value:i.toggle?1:i._value})))}addLightColorEventBoxGroups(...e){q.tWarn(on("addLightColorEventBoxGroups"),"Light Color Event Box Group does not exist in beatmap V2")}addLightRotationEventBoxGroups(...e){q.tWarn(on("addLightRotationEventBoxGroups"),"Light Rotation Event Box Group does not exist in beatmap V2")}addLightTranslationEventBoxGroups(...e){q.tWarn(on("addLightTranslationEventBoxGroups"),"Light Translation Event Box Group does not exist in beatmap V2")}isValid(){return this.colorNotes.every(e=>this.checkClass(Xe,e))||this.obstacles.every(e=>this.checkClass(Ai,e))||this.basicEvents.every(e=>this.checkClass(zt,e))||this.waypoints.every(e=>this.checkClass(Oi,e))||this.arcs.every(e=>this.checkClass(Ni,e))||this.eventTypesWithKeywords instanceof jn}};const $t=class extends Kc{constructor(t={}){super(),this._time=t.time??t.b??$t.default.b,this._color=t.color??t.c??$t.default.c,this._posX=t.posX??t.x??$t.default.x,this._posY=t.posY??t.y??$t.default.y,this._direction=t.direction??t.d??$t.default.d,this._lengthMultiplier=t.lengthMultiplier??t.mu??$t.default.mu,this._tailTime=t.tailTime??t.tb??$t.default.tb,this._tailPosX=t.tailPosX??t.tx??$t.default.tx,this._tailPosY=t.tailPosY??t.ty??$t.default.ty,this._tailDirection=t.tailDirection??t.tc??$t.default.tc,this._tailLengthMultiplier=t.tailLengthMultiplier??t.tmu??$t.default.tmu,this._midAnchor=t.midAnchor??t.m??$t.default.m,this._customData=t.customData??$t.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,mu:this.lengthMultiplier,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,tc:this.tailDirection,tmu:this.tailLengthMultiplier,m:this.midAnchor,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(re(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(re(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]}))),super.mirror(t)}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData.coordinates)return[this.customData.coordinates[0],this.customData.coordinates[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"vanilla":case"ne":return super.getAngle();case"me":default:return this.direction>=1e3?Math.abs(this.direction%1e3%360-360):super.getAngle()}}getTailPosition(t){switch(t){case"vanilla":return super.getTailPosition();case"ne":if(this.customData.tailCoordinates)return[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]];case"me":default:return[(this.tailPosX<=-1e3?this.tailPosX/1e3:this.tailPosX>=1e3?this.tailPosX/1e3:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY]}}getTailAngle(t){switch(t){case"vanilla":case"ne":return super.getTailAngle();case"me":if(this.tailDirection>=1e3)return Math.abs(this.tailDirection%1e3%360-360);default:return super.getTailAngle()}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.tailCoordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.link=="string"}};let di=$t;di.default={b:0,c:0,x:0,y:0,d:0,mu:1,tb:0,tx:0,ty:0,tc:0,tmu:1,m:0,customData:()=>({})};const te=class extends jo{constructor(t={}){super(),this._time=t.time??t.b??te.default.b,this._type=t.type??t.et??te.default.et,this._value=t.value??t.i??te.default.i,this._floatValue=t.floatValue??t.f??te.default.f,this._customData=t.customData??te.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this({b:te.default.b,et:te.default.et,i:te.default.i,f:te.default.f,customData:te.default.customData()})]}toJSON(){return{b:this.time,et:this.type,i:this.value,f:this.floatValue,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}isLightEvent(t){return super.isLightEvent(t)}isRingEvent(t){return super.isRingEvent(t)}isLaserRotationEvent(t){return super.isLaserRotationEvent(t)}isLaneRotationEvent(t){return super.isLaneRotationEvent(t)}isChroma(){const t=this;return t.isLightEvent()?Array.isArray(this.customData.color)||typeof this.customData.lightID=="number"||Array.isArray(this.customData.lightID)||typeof this.customData.easing=="string"||typeof this.customData.lerpType=="string":t.isRingEvent()?typeof this.customData.nameFilter=="string"||typeof this.customData.rotation=="number"||typeof this.customData.step=="number"||typeof this.customData.prop=="number"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":t.isLaserRotationEvent()?typeof this.customData.lockRotation=="boolean"||typeof this.customData.speed=="number"||typeof this.customData.direction=="number":!1}};let Ye=te;Ye.default={b:0,et:0,i:0,f:1,customData:()=>({})};const uo=class extends Zc{constructor(t={}){super(),this._keyword=t.keyword??t.k??uo.default.k,this._events=t.events??t.e??uo.default.e()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{k:this.keyword,e:this.events}}};let su=uo;su.default={k:"",e:()=>[]};const ou=class extends Qc{constructor(t={}){var e;super(),this._list=(((e=t.list)==null?void 0:e.map(i=>({k:i==null?void 0:i.keyword,e:i==null?void 0:i.events})))??t.d??ou.default.d()).map(i=>new su({e:i.e,k:i.k}))}static create(t={}){return new this(t)}toJSON(){return{d:this.list.map(t=>t.toJSON())}}get list(){return this._list}set list(t){this._list=t}addData(t){return this.list.push(t),this}};let bn=ou;bn.default={d:()=>[]};const an=class extends ed{constructor(t={}){super(),this._time=t.time??t.b??an.default.b,this._posX=t.posX??t.x??an.default.x,this._posY=t.posY??t.y??an.default.y,this._customData=t.customData??an.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}mirror(){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(re(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(t=>{t[0]=-t[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(re(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(t=>{t[0]=-t[0]}))),super.mirror()}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.link=="string"}};let Ue=an;Ue.default={b:0,x:0,y:0,customData:()=>({})};const Jn=class extends id{constructor(t={}){super(),this._time=t.time??t.b??Jn.default.b,this._bpm=t.bpm??t.m??Jn.default.m,this._customData=t.customData??Jn.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,m:this.bpm,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}setBPM(t){return this.bpm=t,this}isValid(){return this.bpm>0}};let mi=Jn;mi.default={b:0,m:0,customData:()=>({})};const Gt=class extends nd{constructor(t={}){super(),this._time=t.time??t.b??t.tb??Gt.default.b,this._color=t.color??t.c??Gt.default.c,this._posX=t.posX??t.x??Gt.default.x,this._posY=t.posY??t.y??Gt.default.y,this._direction=t.direction??t.d??Gt.default.d,this._tailTime=t.tailTime??t.tb??t.b??Gt.default.tb,this._tailPosX=t.tailPosX??t.tx??Gt.default.tx,this._tailPosY=t.tailPosY??t.ty??Gt.default.ty,this._sliceCount=t.sliceCount??t.sc??Gt.default.sc,this._squish=t.squish??t.s??Gt.default.s,this._customData=t.customData??Gt.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,c:this.color,x:this.posX,y:this.posY,d:this.direction,tb:this.tailTime,tx:this.tailPosX,ty:this.tailPosY,sc:this.sliceCount,s:this.squish,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}mirror(t=!0){return this.customData.coordinates&&(this.customData.coordinates[0]=-1-this.customData.coordinates[0]),this.customData.flip&&(this.customData.flip[0]=-1-this.customData.flip[0]),this.customData.animation&&(Array.isArray(this.customData.animation.definitePosition)&&(re(this.customData.animation.definitePosition)?this.customData.animation.definitePosition[0]=-this.customData.animation.definitePosition[0]:this.customData.animation.definitePosition.forEach(e=>{e[0]=-e[0]})),Array.isArray(this.customData.animation.offsetPosition)&&(re(this.customData.animation.offsetPosition)?this.customData.animation.offsetPosition[0]=-this.customData.animation.offsetPosition[0]:this.customData.animation.offsetPosition.forEach(e=>{e[0]=-e[0]}))),super.mirror(t)}getPosition(t){switch(t){case"vanilla":return super.getPosition();case"ne":if(this.customData.coordinates)return[this.customData.coordinates[0],this.customData.coordinates[1]];case"me":default:return[(this.posX<=-1e3?this.posX/1e3:this.posX>=1e3?this.posX/1e3:this.posX)-2,this.posY<=-1e3?this.posY/1e3:this.posY>=1e3?this.posY/1e3:this.posY]}}getAngle(t){switch(t){case"me":if(this.direction>=1e3)return Math.abs(this.direction%1e3%360-360);case"vanilla":case"ne":default:return super.getAngle()}}getTailPosition(t){switch(t){case"vanilla":return super.getTailPosition();case"ne":if(this.customData.tailCoordinates)return[this.customData.tailCoordinates[0],this.customData.tailCoordinates[1]];case"me":default:return[(this.tailPosX<=-1e3?this.tailPosX/1e3:this.tailPosX>=1e3?this.tailPosX/1e3:this.tailPosX)-2,this.tailPosY<=-1e3?this.tailPosY/1e3:this.tailPosY>=1e3?this.tailPosY/1e3:this.tailPosY]}}isChroma(){return Array.isArray(this.customData.color)||typeof this.customData.spawnEffect=="boolean"||typeof this.customData.disableDebris=="boolean"}isNoodleExtensions(){return Array.isArray(this.customData.animation)||typeof this.customData.disableNoteGravity=="boolean"||typeof this.customData.disableNoteLook=="boolean"||typeof this.customData.disableBadCutDirection=="boolean"||typeof this.customData.disableBadCutSaberType=="boolean"||typeof this.customData.disableBadCutSpeed=="boolean"||Array.isArray(this.customData.flip)||typeof this.customData.uninteractable=="boolean"||Array.isArray(this.customData.localRotation)||typeof this.customData.noteJumpMovementSpeed=="number"||typeof this.customData.noteJumpStartBeatOffset=="number"||Array.isArray(this.customData.coordinates)||Array.isArray(this.customData.tailCoordinates)||Array.isArray(this.customData.worldRotation)||typeof this.customData.worldRotation=="number"||typeof this.customData.link=="string"}};let Pi=Gt;Pi.default={b:0,c:0,x:0,y:0,d:0,tb:0,tx:0,ty:0,sc:1,s:1,customData:()=>({})};const qn=class extends sd{constructor(t={}){super(),this._time=t.time??t.b??qn.default.b,this._toggle=t.toggle??t.o??qn.default.o,this._customData=t.customData??qn.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,o:this.toggle,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}isValid(){return!0}};let pi=qn;pi.default={b:0,o:!1,customData:()=>({})};const Yt=class extends od{constructor(t={}){super(),this._type=t.type??t.f??Yt.default.f,this._p0=t.p0??t.p??Yt.default.p,this._p1=t.p1??t.t??Yt.default.t,this._reverse=t.reverse??t.r??Yt.default.r,this._chunks=t.chunks??t.c??Yt.default.c,this._random=t.random??t.n??Yt.default.n,this._seed=t.seed??t.s??Yt.default.s,this._limit=t.limit??t.l??Yt.default.l,this._limitAffectsType=t.limitAffectsType??t.d??Yt.default.d,this._customData=t.customData??Yt.default.customData()}static create(t={}){return new Yt(t)}toJSON(){return{f:this.type,p:this.p0,t:this.p1,r:this.reverse,c:this.chunks,n:this.random,s:this.seed,l:this.limit,d:this.limitAffectsType,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};let gt=Yt;gt.default={f:1,p:0,t:0,r:0,c:0,n:0,s:0,l:0,d:0,customData:()=>({})};const fi=class extends rd{constructor(t={}){super(),this._time=t.time??t.b??fi.default.b,this._transition=t.transition??t.i??fi.default.i,this._color=t.color??t.c??fi.default.c,this._brightness=t.brightness??t.s??fi.default.s,this._frequency=t.frequency??t.f??fi.default.f,this._customData=t.customData??fi.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,i:this.transition,c:this.color,s:this.brightness,f:this.frequency,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};let ru=fi;ru.default={b:0,i:0,c:0,s:1,f:0,customData:()=>({})};const pe=class extends ad{constructor(t={}){super(),this._filter=new gt(t.filter??t.f??pe.default.f()),this._beatDistribution=t.beatDistribution??t.w??pe.default.w,this._beatDistributionType=t.beatDistributionType??t.d??pe.default.d,this._brightnessDistribution=t.brightnessDistribution??t.r??pe.default.r,this._brightnessDistributionType=t.brightnessDistributionType??t.t??pe.default.t,this._affectFirst=t.affectFirst??t.b??pe.default.b,this._easing=t.easing??t.i??pe.default.i,this._events=(t.events??t.e??pe.default.e()).map(e=>new ru(e)),this._customData=t.customData??pe.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,r:this.brightnessDistribution,t:this.brightnessDistributionType,b:this.affectFirst,i:this.easing,e:this.events.map(t=>t.toJSON()),customData:_t(this.customData)}}get filter(){return this._filter}set filter(t){this._filter=t}get events(){return this._events}set events(t){this._events=t}get customData(){return this._customData}set customData(t){this._customData=t}setEvents(t){return this.events=t,this}};let au=pe;au.default={f:()=>({f:gt.default.f,p:gt.default.p,t:gt.default.t,r:gt.default.r,c:gt.default.c,n:gt.default.n,s:gt.default.s,l:gt.default.l,d:gt.default.d}),w:0,d:1,r:0,t:1,b:0,i:0,e:()=>[],customData:()=>({})};const ln=class extends ld{constructor(t={}){super(),this._time=t.time??t.b??ln.default.b,this._id=t.id??t.g??ln.default.g,this._boxes=(t.boxes??t.e??ln.default.e()).map(e=>new au(e)),this._customData=t.customData??ln.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:_t(this.customData)}}get boxes(){return this._boxes}set boxes(t){this._boxes=t}get customData(){return this._customData}set customData(t){this._customData=t}isValid(){return this.id>=0}};let cn=ln;cn.default={b:0,g:0,e:()=>[],customData:()=>({})};const ze=class extends cd{constructor(t={}){super(),this._time=t.time??t.b??ze.default.b,this._previous=t.previous??t.p??ze.default.p,this._easing=t.easing??t.e??ze.default.e,this._loop=t.loop??t.l??ze.default.l,this._rotation=t.rotation??t.r??ze.default.r,this._direction=t.direction??t.o??ze.default.o,this._customData=t.customData??ze.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,p:this.previous,e:this.easing,l:this.loop,r:this.rotation,o:this.direction,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};let lu=ze;lu.default={b:0,p:0,e:0,l:0,r:0,o:0,customData:()=>({})};const Ut=class extends ud{constructor(t={}){super(),this._filter=new gt(t.filter??t.f??Ut.default.f()),this._beatDistribution=t.beatDistribution??t.w??Ut.default.w,this._beatDistributionType=t.beatDistributionType??t.d??Ut.default.d,this._rotationDistribution=t.rotationDistribution??t.s??Ut.default.s,this._rotationDistributionType=t.rotationDistributionType??t.t??Ut.default.t,this._axis=t.axis??t.a??Ut.default.a,this._flip=t.flip??t.r??Ut.default.r,this._affectFirst=t.affectFirst??t.b??Ut.default.b,this._easing=t.easing??t.i??Ut.default.i,this._events=(t.events??t.l??Ut.default.l()).map(e=>new lu(e)),this._customData=t.customData??Ut.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.rotationDistribution,t:this.rotationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,i:this.easing,l:this.events.map(t=>t.toJSON()),customData:_t(this.customData)}}get filter(){return this._filter}set filter(t){this._filter=t}get events(){return this._events}set events(t){this._events=t}get customData(){return this._customData}set customData(t){this._customData=t}setEvents(t){return this.events=t,this}};let cu=Ut;cu.default={f:()=>({f:gt.default.f,p:gt.default.p,t:gt.default.t,r:gt.default.r,c:gt.default.c,n:gt.default.n,s:gt.default.s,l:gt.default.l,d:gt.default.d}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,i:0,l:()=>[],customData:()=>({})};const un=class extends hd{constructor(t={}){super(),this._time=t.time??t.b??un.default.b,this._id=t.id??t.g??un.default.g,this._boxes=(t.boxes??t.e??un.default.e()).map(e=>new cu(e)),this._customData=t.customData??un.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:_t(this.customData)}}get boxes(){return this._boxes}set boxes(t){this._boxes=t}get customData(){return this._customData}set customData(t){this._customData=t}isValid(){return this.id>=0}};let hn=un;hn.default={b:0,g:0,e:()=>[],customData:()=>({})};const Mi=class extends fd{constructor(t={}){super(),this._time=t.time??t.b??Mi.default.b,this._previous=t.previous??t.p??Mi.default.p,this._easing=t.easing??t.e??Mi.default.e,this._translation=t.translation??t.t??Mi.default.t,this._customData=t.customData??Mi.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,p:this.previous,e:this.easing,t:this.translation,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};let uu=Mi;uu.default={b:0,p:0,e:0,t:0,customData:()=>({})};const Vt=class extends dd{constructor(t={}){super(),this._filter=new gt(t.filter??t.f??Vt.default.f()),this._beatDistribution=t.beatDistribution??t.w??Vt.default.w,this._beatDistributionType=t.beatDistributionType??t.d??Vt.default.d,this._translationDistribution=t.translationDistribution??t.s??Vt.default.s,this._translationDistributionType=t.translationDistributionType??t.t??Vt.default.t,this._axis=t.axis??t.a??Vt.default.a,this._flip=t.flip??t.r??Vt.default.r,this._affectFirst=t.affectFirst??t.b??Vt.default.b,this._easing=t.easing??t.i??Vt.default.i,this._events=(t.events??t.l??Vt.default.l()).map(e=>new uu(e)),this._customData=t.customData??Vt.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{f:this.filter.toJSON(),w:this.beatDistribution,d:this.beatDistributionType,s:this.translationDistribution,t:this.translationDistributionType,a:this.axis,r:this.flip,b:this.affectFirst,i:this.easing,l:this.events.map(t=>t.toJSON()),customData:_t(this.customData)}}get filter(){return this._filter}set filter(t){this._filter=t}get events(){return this._events}set events(t){this._events=t}get customData(){return this._customData}set customData(t){this._customData=t}setEvents(t){return this.events=t,this}};let hu=Vt;hu.default={f:()=>({f:gt.default.f,p:gt.default.p,t:gt.default.t,r:gt.default.r,c:gt.default.c,n:gt.default.n,s:gt.default.s,l:gt.default.l,d:gt.default.d}),w:0,d:1,s:0,t:1,a:0,r:0,b:0,i:0,l:()=>[],customData:()=>({})};const fn=class extends md{constructor(t={}){super(),this._time=t.time??t.b??fn.default.b,this._id=t.id??t.g??fn.default.g,this._boxes=(t.boxes??t.e??fn.default.e()).map(e=>new hu(e)),this._customData=t.customData??fn.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,g:this.id,e:this.boxes.map(t=>t.toJSON()),customData:_t(this.customData)}}get boxes(){return this._boxes}set boxes(t){this._boxes=t}get customData(){return this._customData}set customData(t){this._customData=t}setCustomData(t){return this.customData=t,this}addCustomData(t){return this.customData={...this.customData,object:t},this}isValid(){return this.id>=0}};let dn=fn;dn.default={b:0,g:0,e:()=>[],customData:()=>({})};const mn=class extends pd{constructor(t={}){super(),this._time=t.time??t.b??mn.default.b,this._executionTime=t.executionTime??t.e??mn.default.e,this._rotation=t.rotation??t.r??mn.default.r,this._customData=t.customData??mn.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,e:this.executionTime,r:this.rotation,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};let gi=mn;gi.default={b:0,e:0,r:0,customData:()=>({})};const Fi=class extends tu{constructor(t={}){super(),this._time=t.time??t.b??Fi.default.b,this._posX=t.posX??t.x??Fi.default.x,this._posY=t.posY??t.y??Fi.default.y,this._direction=t.direction??t.d??Fi.default.d,this._customData=t.customData??Fi.default.customData()}static create(...t){const e=[];return t.forEach(i=>e.push(new this(i))),e.length?e:[new this]}toJSON(){return{b:this.time,x:this.posX,y:this.posY,d:this.direction,customData:_t(this.customData)}}get customData(){return this._customData}set customData(t){this._customData=t}};let _i=Fi;_i.default={b:0,x:0,y:0,d:0,customData:()=>({})};class ho extends Vo{constructor(e={}){var i,n,a,o;super(),this.version="3.2.0",this.bpmEvents=(e.bpmEvents??[]).map(l=>new mi(l))??[],this.rotationEvents=(e.rotationEvents??[]).map(l=>new gi(l))??[],this.colorNotes=(e.colorNotes??[]).map(l=>new ne(l))??[],this.bombNotes=(e.bombNotes??[]).map(l=>new Ue(l))??[],this.obstacles=(e.obstacles??[]).map(l=>new At(l))??[],this.arcs=(e.sliders??[]).map(l=>new di(l))??[],this.chains=(e.burstSliders??[]).map(l=>new Pi(l))??[],this.waypoints=(e.waypoints??[]).map(l=>new _i(l))??[],this.basicEvents=(e.basicBeatmapEvents??[]).map(l=>new Ye(l))??[],this.colorBoostEvents=((i=e.colorBoostBeatmapEvents)==null?void 0:i.map(l=>new pi(l)))??[],this.lightColorEventBoxGroups=((n=e.lightColorEventBoxGroups)==null?void 0:n.map(l=>new cn(l)))??[],this.lightRotationEventBoxGroups=((a=e.lightRotationEventBoxGroups)==null?void 0:a.map(l=>new hn(l)))??[],this.lightTranslationEventBoxGroups=((o=e.lightTranslationEventBoxGroups)==null?void 0:o.map(l=>new dn(l)))??[],this.eventTypesWithKeywords=new bn(e.basicEventTypesWithKeywords??{d:[]}),this.useNormalEventsAsCompatibleEvents=e.useNormalEventsAsCompatibleEvents??!1,this.customData=e.customData??{}}static create(e={}){return new this(e)}toJSON(){return{version:"3.2.0",bpmEvents:this.bpmEvents.map(e=>e.toJSON()),rotationEvents:this.rotationEvents.map(e=>e.toJSON()),colorNotes:this.colorNotes.map(e=>e.toJSON()),bombNotes:this.bombNotes.map(e=>e.toJSON()),obstacles:this.obstacles.map(e=>e.toJSON()),sliders:this.arcs.map(e=>e.toJSON()),burstSliders:this.chains.map(e=>e.toJSON()),waypoints:this.waypoints.map(e=>e.toJSON()),basicBeatmapEvents:this.basicEvents.map(e=>e.toJSON()),colorBoostBeatmapEvents:this.colorBoostEvents.map(e=>e.toJSON()),lightColorEventBoxGroups:this.lightColorEventBoxGroups.map(e=>e.toJSON()),lightRotationEventBoxGroups:this.lightRotationEventBoxGroups.map(e=>e.toJSON()),lightTranslationEventBoxGroups:this.lightTranslationEventBoxGroups.map(e=>e.toJSON()),basicEventTypesWithKeywords:this.eventTypesWithKeywords.toJSON(),useNormalEventsAsCompatibleEvents:this.useNormalEventsAsCompatibleEvents,customData:_t(this.customData)}}get customData(){return this._customData}set customData(e){this._customData=e}reparse(e){this.colorNotes=this.colorNotes.map(i=>this.createOrKeep(ne,i,e)),this.bombNotes=this.bombNotes.map(i=>this.createOrKeep(Ue,i,e)),this.arcs=this.arcs.map(i=>this.createOrKeep(di,i,e)),this.chains=this.chains.map(i=>this.createOrKeep(Pi,i,e)),this.obstacles=this.obstacles.map(i=>this.createOrKeep(At,i,e)),this.basicEvents=this.basicEvents.map(i=>this.createOrKeep(Ye,i,e)),this.colorBoostEvents=this.colorBoostEvents.map(i=>this.createOrKeep(pi,i,e)),this.rotationEvents=this.rotationEvents.map(i=>this.createOrKeep(gi,i,e)),this.bpmEvents=this.bpmEvents.map(i=>this.createOrKeep(mi,i,e)),this.waypoints=this.waypoints.map(i=>this.createOrKeep(_i,i,e)),this.eventTypesWithKeywords=new bn(this.eventTypesWithKeywords)}addBpmEvents(...e){this.bpmEvents.push(...e.map(i=>i instanceof mi?i:new mi(i)))}addRotationEvents(...e){this.rotationEvents.push(...e.map(i=>i instanceof gi?i:new gi(i)))}addColorNotes(...e){this.colorNotes.push(...e.map(i=>i instanceof ne?i:new ne(i)))}addBombNotes(...e){this.bombNotes.push(...e.map(i=>i instanceof Ue?i:new Ue(i)))}addObstacles(...e){this.obstacles.push(...e.map(i=>i instanceof At?i:new At(i)))}addArcs(...e){this.arcs.push(...e.map(i=>i instanceof di?i:new di(i)))}addChains(...e){this.chains.push(...e.map(i=>i instanceof Pi?i:new Pi(i)))}addWaypoints(...e){this.waypoints.push(...e.map(i=>i instanceof _i?i:new _i(i)))}addBasicEvents(...e){this.basicEvents.push(...e.map(i=>i instanceof Ye?i:new Ye(i)))}addColorBoostEvents(...e){this.colorBoostEvents.push(...e.map(i=>i instanceof pi?i:new pi(i)))}addLightColorEventBoxGroups(...e){this.lightColorEventBoxGroups.push(...e.map(i=>i instanceof cn?i:new cn(i)))}addLightRotationEventBoxGroups(...e){this.lightRotationEventBoxGroups.push(...e.map(i=>i instanceof hn?i:new hn(i)))}addLightTranslationEventBoxGroups(...e){this.lightTranslationEventBoxGroups.push(...e.map(i=>i instanceof dn?i:new dn(i)))}isValid(){return this.colorNotes.every(e=>this.checkClass(ne,e))||this.bombNotes.every(e=>this.checkClass(Ue,e))||this.arcs.every(e=>this.checkClass(di,e))||this.chains.every(e=>this.checkClass(Pi,e))||this.obstacles.every(e=>this.checkClass(At,e))||this.basicEvents.every(e=>this.checkClass(Ye,e))||this.colorBoostEvents.every(e=>this.checkClass(pi,e))||this.rotationEvents.every(e=>this.checkClass(gi,e))||this.bpmEvents.every(e=>this.checkClass(mi,e))||this.waypoints.every(e=>this.checkClass(_i,e))||this.lightColorEventBoxGroups.every(e=>this.checkClass(cn,e))||this.lightRotationEventBoxGroups.every(e=>this.checkClass(hn,e))||this.lightTranslationEventBoxGroups.every(e=>this.checkClass(dn,e))||this.eventTypesWithKeywords instanceof bn}}function Is(t){return["shared","parse",t]}function yd(t){return q.tInfo(Is("info"),"Parsing beatmap info v2.x.x"),t._difficultyBeatmapSets.sort((e,i)=>Sa[e._beatmapCharacteristicName]-Sa[i._beatmapCharacteristicName]),t._difficultyBeatmapSets.forEach(e=>{let i=0;e._difficultyBeatmaps.forEach(n=>{var a,o;n._difficultyRank-i<=0&&q.tWarn(Is("info"),n._difficulty+" is unordered"),Lh[n._difficulty]!==n._difficultyRank&&q.tError(Is("info"),n._difficulty+" has invalid rank"),i=n._difficultyRank,typeof((a=n._customData)==null?void 0:a._editorOffset)=="number"&&n._customData._editorOffset===0&&delete n._customData._editorOffset,typeof((o=n._customData)==null?void 0:o._editorOldOffset)=="number"&&n._customData._editorOldOffset===0&&delete n._customData._editorOldOffset}),e._difficultyBeatmaps.sort((n,a)=>n._difficultyRank-a._difficultyRank)}),t}function fu(t){return["shared","dataCheck",t]}function we(t,e,i){if(e)throw Error(t);q.tWarn(fu("deepCheck"),t),i.push(t)}function yn(t,e,i,n,a=!0,o=[]){if(q.tVerbose(fu("deepCheck"),`Looking up ${i}`),Array.isArray(t)){t.forEach((s,r)=>yn(s,e,`${i}[${r}]`,n));return}const l=Object.keys(e);for(const s in t){if(!l.length)break;l.includes(s)||we(`Unused key ${s} found in ${i}`,!1,o)}for(const s in e){if(typeof t[s]>"u"){if(e[s].optional||td(n,e[s].version)==="old")continue;we(`Missing ${s} in object ${i}!`,a,o)}t[s]==null&&we(`${s} contain null value in object ${i}!`,a,o),e[s].type==="array"&&(Array.isArray(t[s])||we(`${s} is not an array in object ${i}!`,a,o),yn(t[s],e[s].check,`${i} ${s}`,n)),e[s].type==="object"&&(!Array.isArray(t[s])&&typeof t[s]!="object"?we(`${s} is not an object in object ${i}!`,a,o):yn(t[s],e[s].check,`${i} ${s}`,n)),e[s].array&&Array.isArray(t[s])&&!t[s].every(r=>typeof r===e[s].type||e[s].type==="number"&&typeof r=="number"&&(e[s].int?r%1!==0:!0)&&(e[s].unsigned?t[s]<0:!0))&&we(`${s} is not ${e[s].type} in object ${i}!`,a,o),!e[s].array&&e[s].type!=="array"&&typeof t[s]!==e[s].type&&we(`${s} is not ${e[s].type} in object ${i}!`,a,o),e[s].type==="number"&&typeof t[s]=="number"&&(e[s].int&&t[s]%1!==0&&we(`${i} ${s} cannot be float!`,!1,o),e[s].unsigned&&t[s]<0&&we(`${i} ${s} cannot be negative!`,!1,o))}}const vd={_time:{type:"number",version:"2.0.0"},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_lineIndex:{type:"number",int:!0,version:"2.0.0"},_lineLayer:{type:"number",int:!0,version:"2.0.0"},_cutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Ed={_colorType:{type:"number",version:"2.0.0"},_headTime:{type:"number",version:"2.0.0"},_headLineIndex:{type:"number",int:!0,version:"2.0.0"},_headLineLayer:{type:"number",int:!0,version:"2.0.0"},_headCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_headControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_tailTime:{type:"number",version:"2.0.0"},_tailLineIndex:{type:"number",int:!0,version:"2.0.0"},_tailLineLayer:{type:"number",int:!0,version:"2.0.0"},_tailCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_tailControlPointLengthMultiplier:{type:"number",version:"2.0.0"},_sliderMidAnchorMode:{type:"number",version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},wd={_time:{type:"number",version:"2.0.0"},_lineIndex:{type:"number",int:!0,version:"2.0.0"},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0"},_duration:{type:"number",version:"2.0.0"},_width:{type:"number",int:!0,version:"2.0.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Dd={_time:{type:"number",version:"2.0.0"},_type:{type:"number",int:!0,version:"2.0.0"},_value:{type:"number",int:!0,version:"2.0.0"},_floatValue:{type:"number",version:"2.5.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Sd={_time:{type:"number",version:"2.2.0"},_lineIndex:{type:"number",int:!0,version:"2.2.0"},_lineLayer:{type:"number",int:!0,version:"2.2.0"},_offsetDirection:{type:"number",int:!0,version:"2.2.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Td={_keyword:{type:"string",version:"2.4.0"},_specialEvents:{type:"number",int:!0,array:!0,version:"2.4.0"}},Cd={_keywords:{type:"array",version:"2.4.0",check:Td}},Ld={_version:{type:"string",version:"2.0.0"},_notes:{type:"array",version:"2.0.0",check:vd},_sliders:{type:"array",version:"2.6.0",check:Ed},_obstacles:{type:"array",version:"2.0.0",check:wd},_events:{type:"array",version:"2.0.0",check:Dd},_waypoints:{type:"array",version:"2.2.0",check:Sd,optional:!0},_specialEventsKeywordFilters:{type:"object",version:"2.4.0",check:Cd,optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}};function Ra(t){return["v2","parse",t]}const Pn=(t,e)=>t._time-e._time;function Rd(t,e={enabled:!0,throwError:!0}){var i;return q.tInfo(Ra("difficulty"),"Parsing beatmap difficulty v2.x.x"),(i=t._version)!=null&&i.startsWith("2")||(q.tWarn(Ra("difficulty"),"Unidentified beatmap version"),t._version="2.0.0"),e.enabled&&yn(t,Ld,"difficulty",t._version,e.throwError),t._notes=t._notes??[],t._sliders=t._sliders??[],t._obstacles=t._obstacles??[],t._events=t._events??[],t._waypoints=t._waypoints??[],t._notes.sort(Pn),t._sliders.sort((n,a)=>n._headTime-a._headTime),t._obstacles.sort(Pn),t._events.sort(Pn),t._waypoints.sort(Pn),new nu(t)}const kd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},a:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},xd={b:{type:"number",version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Bd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},mu:{type:"number",version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",int:!0,version:"3.0.0"},ty:{type:"number",int:!0,version:"3.0.0"},tc:{type:"number",int:!0,version:"3.0.0"},tmu:{type:"number",version:"3.0.0"},m:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Nd={b:{type:"number",version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},tb:{type:"number",version:"3.0.0"},tx:{type:"number",int:!0,version:"3.0.0"},ty:{type:"number",int:!0,version:"3.0.0"},sc:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ad={b:{type:"number",version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},d:{type:"number",version:"3.0.0"},w:{type:"number",int:!0,version:"3.0.0"},h:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Id={b:{type:"number",version:"3.0.0"},et:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},$d={b:{type:"number",version:"3.0.0"},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Od={b:{type:"number",version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"},r:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Pd={b:{type:"number",version:"3.0.0"},o:{type:"boolean",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ko={f:{type:"number",int:!0,version:"3.0.0"},p:{type:"number",version:"3.0.0"},t:{type:"number",version:"3.0.0"},r:{type:"number",int:!0,version:"3.0.0"},c:{type:"number",int:!0,version:"3.1.0"},l:{type:"number",version:"3.1.0"},d:{type:"number",int:!0,version:"3.1.0"},n:{type:"number",int:!0,version:"3.1.0"},s:{type:"number",int:!0,version:"3.1.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Md={b:{type:"number",version:"3.0.0"},i:{type:"number",int:!0,version:"3.0.0"},c:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},f:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Fd={f:{type:"object",version:"3.0.0",check:Ko},w:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},r:{type:"number",version:"3.0.0"},t:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Md},b:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Hd={b:{type:"number",version:"3.0.0"},g:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Fd},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Wd={b:{type:"number",version:"3.0.0"},p:{type:"number",int:!0,version:"3.0.0"},e:{type:"number",int:!0,version:"3.0.0"},l:{type:"number",version:"3.0.0"},r:{type:"number",version:"3.0.0"},o:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Xd={f:{type:"object",version:"3.0.0",check:Ko},w:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},s:{type:"number",version:"3.0.0"},t:{type:"number",int:!0,version:"3.0.0"},a:{type:"number",int:!0,version:"3.0.0"},l:{type:"array",version:"3.0.0",check:Wd},r:{type:"number",int:!0,version:"3.0.0"},b:{type:"number",int:!0,version:"3.0.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},zd={b:{type:"number",version:"3.0.0"},g:{type:"number",int:!0,version:"3.0.0"},e:{type:"array",version:"3.0.0",check:Xd},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Gd={b:{type:"number",version:"3.2.0"},p:{type:"number",int:!0,version:"3.2.0"},e:{type:"number",int:!0,version:"3.2.0"},t:{type:"number",version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Yd={f:{type:"object",version:"3.2.0",check:Ko},w:{type:"number",version:"3.2.0"},d:{type:"number",int:!0,version:"3.2.0"},s:{type:"number",version:"3.2.0"},t:{type:"number",int:!0,version:"3.2.0"},a:{type:"number",int:!0,version:"3.2.0"},l:{type:"array",version:"3.2.0",check:Gd},r:{type:"number",int:!0,version:"3.2.0"},b:{type:"number",int:!0,version:"3.2.0"},i:{type:"number",int:!0,version:"3.2.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ud={b:{type:"number",version:"3.2.0"},g:{type:"number",int:!0,version:"3.2.0"},e:{type:"array",version:"3.2.0",check:Yd},customData:{type:"object",version:"3.2.0",check:{},optional:!0}},Vd={k:{type:"string",version:"3.0.0"},e:{type:"number",int:!0,array:!0,version:"3.0.0"}},jd={d:{type:"array",version:"3.0.0",check:Vd,optional:!0}},Jd={b:{type:"number",version:"3.0.0"},d:{type:"number",int:!0,version:"3.0.0"},x:{type:"number",int:!0,version:"3.0.0"},y:{type:"number",int:!0,version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},qd={version:{type:"string",version:"3.0.0"},bpmEvents:{type:"array",version:"3.0.0",check:$d,optional:!0},rotationEvents:{type:"array",version:"3.0.0",check:Od,optional:!0},colorNotes:{type:"array",version:"3.0.0",check:kd,optional:!0},bombNotes:{type:"array",version:"3.0.0",check:xd,optional:!0},obstacles:{type:"array",version:"3.0.0",check:Ad,optional:!0},sliders:{type:"array",version:"3.0.0",check:Bd,optional:!0},burstSliders:{type:"array",version:"3.0.0",check:Nd,optional:!0},waypoints:{type:"array",version:"3.0.0",check:Jd,optional:!0},basicBeatmapEvents:{type:"array",version:"3.0.0",check:Id,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:Pd,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:Hd,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:zd,optional:!0},lightTranslationEventBoxGroups:{type:"array",version:"3.2.0",check:Ud,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"3.0.0",check:jd},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}};function ka(t){return["v3","parse",t]}const Xt=(t,e)=>t.b-e.b;function Kd(t,e={enabled:!0,throwError:!0}){return q.tInfo(ka("difficulty"),"Parsing beatmap difficulty v3.x.x"),t.version==="3.0.0"||t.version==="3.1.0"||t.version==="3.2.0"||(q.tWarn(ka("difficulty"),"Unidentified beatmap version"),t.version="3.0.0"),e.enabled&&yn(t,qd,"difficulty",t.version,e.throwError),t.bpmEvents=t.bpmEvents??[],t.rotationEvents=t.rotationEvents??[],t.colorNotes=t.colorNotes??[],t.bombNotes=t.bombNotes??[],t.obstacles=t.obstacles??[],t.sliders=t.sliders??[],t.burstSliders=t.burstSliders??[],t.waypoints=t.waypoints??[],t.basicBeatmapEvents=t.basicBeatmapEvents??[],t.colorBoostBeatmapEvents=t.colorBoostBeatmapEvents??[],t.lightColorEventBoxGroups=t.lightColorEventBoxGroups??[],t.lightRotationEventBoxGroups=t.lightRotationEventBoxGroups??[],t.lightTranslationEventBoxGroups=t.lightTranslationEventBoxGroups??[],t.bpmEvents.sort(Xt),t.rotationEvents.sort(Xt),t.colorNotes.sort(Xt),t.bombNotes.sort(Xt),t.obstacles.sort(Xt),t.sliders.sort(Xt),t.burstSliders.sort(Xt),t.waypoints.sort(Xt),t.basicBeatmapEvents.sort(Xt),t.colorBoostBeatmapEvents.sort(Xt),t.lightColorEventBoxGroups.sort(Xt),t.lightRotationEventBoxGroups.sort(Xt),new ho(t)}const xa="Invalid Event Box",Ba="Check for valid event box group usage.",Na=!0,gs={name:xa,description:Ba,type:"event",order:{input:ht.EVENTS_INVALID_EVENT_BOX,output:ft.EVENTS_INVALID_EVENT_BOX},input:{enabled:Na,params:{},html:ct.create(xa,Ba,Na,function(){gs.input.enabled=this.checked})},output:{html:null},run:Qd},Aa={EDMEnvironment:{0:24,1:24,2:24,3:24,4:24,5:24,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:1,15:1,16:1,17:1},LizzoEnvironment:{0:40,1:16,2:16,3:16,4:16,5:16,6:1,7:1,8:12,9:12,10:12,11:6,12:6,13:14,14:14,15:4,16:4,17:3,18:3,19:14},PyroEnvironment:{0:3,1:3,2:5,3:5,4:3,5:12,6:48,7:48,8:4,9:4,10:3,11:3,12:10,13:10},TheSecondEnvironment:{0:15,1:24,2:12,3:12,4:12,5:12,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4},TheWeekndEnvironment:{0:4,1:4,2:4,3:4,4:8,5:4,6:4,7:12,8:1,9:6,10:25,11:25,12:25,13:25,14:25,15:25,16:25,17:25,18:25,19:25,20:3,21:3,22:8,23:8,29:3,30:3,31:3,32:3,33:3,34:3,35:3,36:3,37:6,38:6,40:2},RockMixtapeEnvironment:{0:5,1:5,2:10,3:10,4:10,5:10,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:3,15:10,16:5,17:5,18:24,19:24,20:12,21:12,22:8,23:8,24:36,25:3,26:36,27:3,28:5,29:2,30:16,31:4,32:4,33:4,34:4,35:2,36:2,37:2},WeaveEnvironment:{0:8,1:8,2:8,3:8,4:8,5:8,6:8,7:8,8:8,9:8,10:8,11:8,12:12,13:12,14:8,15:8},Dragons2Environment:{0:24,1:96,2:35,3:15,4:8,5:12,6:12,7:5,8:5,9:5,10:5,11:5,12:5},Panic2Environment:{0:7,1:7,2:7,3:7,4:8,5:8,6:24,7:24,8:24,9:6,10:6,11:6,12:6,13:14,14:14,15:2,16:28,17:28,18:1,19:1,20:12,21:1,22:12,23:1}};function Zd(t,e){const i=[],n=[];if(!Aa[e])return{defectID:[],defectFilter:[]};const a=e,o=Ei[a][1],l=[...t.lightColorEventBoxGroups,...t.lightRotationEventBoxGroups,...t.lightTranslationEventBoxGroups];for(const s of l){o.includes(s.id)||i.push(s);for(const r of s.boxes){const h=r.filter;h.type===tc.STEP_AND_OFFSET&&h.p0>Aa[a][s.id]&&n.push(s)}}return{defectID:i.map(s=>s.time).filter(function(s,r,h){return!r||s!==h[r-1]}),defectFilter:n.map(s=>s.time).filter(function(s,r,h){return!r||s!==h[r-1]})}}function Qd(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=Zd(t.difficulty.data,t.difficulty.characteristic==="360Degree"||t.difficulty.characteristic==="90Degree"?t.info._allDirectionsEnvironmentName:t.info._environmentName),i=[];if(e.defectID.length&&i.push(ut("Invalid event box group ID",e.defectID,t.settings.bpm,"error")),e.defectFilter.length&&i.push(ut("Invalid event box filter",e.defectFilter,t.settings.bpm,"error")),i.length){const n=document.createElement("div");i.forEach(a=>n.append(a)),gs.output.html=n}else gs.output.html=null}const Ia="Unlit Bomb",$a="Check for lighting around bomb.",Oa=!0,_s={name:Ia,description:$a,type:"event",order:{input:ht.EVENTS_UNLIT_BOMB,output:ft.EVENTS_UNLIT_BOMB},input:{enabled:Oa,params:{},html:ct.create(Ia,$a,Oa,function(){_s.input.enabled=this.checked})},output:{html:null},run:em},tm=(t,e,i,n)=>{var u;if(!e.length)return[];const a=[],o=((u=Ei[n])==null?void 0:u[0])??Ei.DefaultEnvironment[0],l=e.filter(m=>m.isLightEvent(n)&&o.includes(m.type)).sort((m,c)=>m.type-c.type),s={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},r={};o.forEach(m=>r[m]=[[0,!1]]);const h=i.toBeatTime(1),f=i.toBeatTime(.25);for(let m=0,c=l.length;m<c;m++){const p=l[m];if((p.isOn()||p.isFlash())&&s[p.type].state!=="on"){s[p.type]={state:"on",time:p.time,fadeTime:0};const _=r[p.type].find(y=>y[0]>=p.time);_?(_[0]=p.time,_[1]=!0):r[p.type].push([p.time,!0])}if(p.isFade()){s[p.type]={state:"off",time:p.time,fadeTime:h};const _=r[p.type].find(y=>y[0]>=p.time);_?(_[0]=p.time,_[1]=!0):r[p.type].push([p.time,!0]),r[p.type].push([p.time+h,!1])}(((p==null?void 0:p.floatValue)??1)<.25||p.isOff()||p.customData._color&&(typeof p.customData._color[3]=="number"&&p.customData._color[3]<.25||Math.max(p.customData._color[0],p.customData._color[1],p.customData._color[2])<.25))&&s[p.type].state!=="off"&&(s[p.type]={state:"off",time:p.time,fadeTime:s[p.type].state==="on"?f:Math.min(f,s[p.type].fadeTime)},r[p.type].push([p.time+(s[p.type].state==="on"?f:Math.min(f,s[p.type].fadeTime)),!1]))}for(const m in r)r[m].reverse();for(let m=0,c=t.length,p=!1;m<c;m++){const _=t[m];p=!1;for(const y in r){const b=r[y].find(E=>E[0]<=_.time);b&&(p=p||b[1])}p||a.push(_)}return a.map(m=>m.time).filter(function(m,c,p){return!c||m!==p[c-1]})};function em(t){if(!t.difficulty){console.error("Something went wrong!");return}const e=tm(t.difficulty.data.bombNotes,t.difficulty.data.basicEvents,t.settings.bpm,t.info._environmentName);e.length?_s.output.html=ut("Unlit bomb",e,t.settings.bpm,"warning"):_s.output.html=null}const Pa=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:ps,invalidEventBox:gs,unlitBomb:_s},Symbol.toStringTag,{value:"Module"})),du="Hot Start",mu="Check for first interactive object starting from start time.",pu=!0,gu=1.5,ri=document.createElement("input");ri.id="input__tools-hot-start";ri.className="input-toggle input--small";ri.type="number";ri.min="0";ri.step="0.1";ri.value=gu.toString();ri.addEventListener("change",im);const _u=ct.create(du+" (s): ",mu,pu,function(){yi.input.enabled=this.checked});_u.appendChild(ri);const yi={name:du,description:mu,type:"other",order:{input:ht.OTHERS_HOT_START,output:ft.OTHERS_HOT_START},input:{enabled:pu,params:{time:gu},html:_u},output:{html:null},run:nm};function im(){yi.input.params.time=I(Math.abs(parseFloat(this.value)),3),this.value=yi.input.params.time.toString()}function nm(t){if(!t.difficulty){console.error("Something went wrong!");return}const{time:e}=yi.input.params,i=t.settings.bpm.toRealTime(t.difficulty.data.getFirstInteractiveTime());i<e?yi.output.html=pt("Hot start",`${I(i,2)}s`,"warning"):yi.output.html=null}const Ma="Difficulty Label Check",Fa="For ranking purpose, check difficulty label to fit rankability criteria.",Ha=!0,bs={name:Ma,description:Fa,type:"other",order:{input:ht.OTHERS_DIFFICULTY_LABEL,output:ft.OTHERS_DIFFICULTY_LABEL},input:{enabled:Ha,params:{},html:ct.create(Ma,Fa,Ha,function(){bs.input.enabled=this.checked})},output:{html:null},run:sm};function sm(t){var i;if(!t.difficulty){console.error("Something went wrong!");return}const e=(i=t.difficulty.info._customData)==null?void 0:i._difficultyLabel;e&&e.length>30?bs.output.html=pt(`Difficulty label is too long (${e.length} characters)`,"exceeded 30 max characters by ranking criteria","rank"):bs.output.html=null}const Wa="NJS Check",Xa="Check note jump speed for suitable value.",za=!0,ys={name:Wa,description:Xa,type:"other",order:{input:ht.OTHERS_NJS,output:ft.OTHERS_NJS},input:{enabled:za,params:{},html:ct.create(Wa,Xa,za,function(){ys.input.enabled=this.checked})},output:{html:null},run:om};function om(t){if(!t.difficulty){console.error("Something went wrong!");return}const{njs:e,bpm:i}=t.settings,n=[];if(t.difficulty.info._noteJumpMovementSpeed===0&&n.push(pt("Unset NJS","fallback NJS is used","error")),e.value>23&&n.push(pt(`NJS is too high (${I(e.value,2)})`,"use lower whenever necessary","warning")),e.value<3&&n.push(pt(`NJS is too low (${I(e.value,2)})`,"timing is less significant below this","warning")),e.jd>36&&n.push(pt("Very high jump distance",`${I(e.jd,2)}`,"warning")),e.jd<18&&n.push(pt("Very low jump distance",`${I(e.jd,2)}`,"warning")),e.jd>e.calcJdOptimal()[1]&&n.push(pt(`High jump distance warning (>${I(e.calcJdOptimal()[1],2)})`,"NJS & offset may be uncomfortable to play","warning")),i.toRealTime(e.hjd)<.42&&n.push(pt(`Very quick reaction time (${I(i.toRealTime(e.hjd)*1e3)}ms)`,"may lead to suboptimal gameplay","warning")),e.calcHjd(0)+e.offset<be.HJD_MIN&&n.push(pt("Unnecessary negative offset",`will not drop below ${be.HJD_MIN}`,"warning")),n.length){const a=document.createElement("div");n.forEach(o=>a.append(o)),ys.output.html=a}else ys.output.html=null}const Ga="Outside Playable Object",Ya="Look for any object starting before and after song timer.",Ua=!0,vs={name:Ga,description:Ya,type:"other",order:{input:ht.OTHERS_OUTSIDE_PLAYABLE,output:ft.OTHERS_OUTSIDE_PLAYABLE},input:{enabled:Ua,params:{},html:ct.create(Ga,Ya,Ua,function(){vs.input.enabled=this.checked})},output:{html:null},run:rm};function rm(t){if(!t.difficulty){console.error("Something went wrong!");return}const{bpm:e,audioDuration:i}=t.settings,{colorNotes:n,bombNotes:a,obstacles:o,basicEvents:l,arcs:s,chains:r}=t.difficulty.data,h=[];if(i){let f=e.toBeatTime(i,!0);n.length&&n[0].time<0&&h.push(pt("Note(s) before start time",`${I(n[0].time,3)} (${wt(e.toRealTime(n[0].time))}`,"error")),a.length&&a[0].time<0&&h.push(pt("Bomb(s) before start time",`${I(a[0].time,3)} (${wt(e.toRealTime(a[0].time))}`,"error")),s.length&&s[0].time<0&&h.push(pt("Arc(s) before start time",`${I(s[0].time,3)} (${wt(e.toRealTime(s[0].time))}`,"error")),r.length&&r[0].time<0&&h.push(pt("Chain(s) before start time",`${I(r[0].time,3)} (${wt(e.toRealTime(r[0].time))}`,"error")),o.length&&o[0].time<0&&h.push(pt("Obstacle(s) before start time",`${I(o[0].time,3)} (${wt(e.toRealTime(o[0].time))}`,"error")),l.length&&l[0].time<0&&h.push(pt("Event(s) before start time",`${I(l[0].time,3)} (${wt(e.toRealTime(l[0].time))}`,"error")),n.length&&n[n.length-1].time>f&&h.push(pt("Note(s) after end time",`${I(n[n.length-1].time,3)} (${wt(e.toRealTime(n[n.length-1].time))})`,"error")),a.length&&a[a.length-1].time>f&&h.push(pt("Bomb(s) after end time",`${I(a[a.length-1].time,3)} (${wt(e.toRealTime(a[a.length-1].time))})`,"error")),s.length&&s[s.length-1].time>f&&h.push(pt("Arc(s) after end time",`${I(s[s.length-1].time,3)} (${wt(e.toRealTime(s[s.length-1].time))})`,"error")),r.length&&r[r.length-1].time>f&&h.push(pt("Chain(s) after end time",`${I(r[r.length-1].time,3)} (${wt(e.toRealTime(r[r.length-1].time))})`,"error")),o.length&&o[o.length-1].time>f&&h.push(pt("Obstacle(s) after end time",`${I(o[o.length-1].time,3)} (${wt(e.toRealTime(o[o.length-1].time))})`,"error")),l.length&&l[l.length-1].time>f&&h.push(pt("Event(s) after end time",`${I(l[l.length-1].time,3)} (${wt(e.toRealTime(l[l.length-1].time))})`,"error"))}if(h.length){const f=document.createElement("div");h.forEach(u=>f.append(u)),vs.output.html=f}else vs.output.html=null}const Va="Invalid Object",ja="Validate beatmap object to be compatible with vanilla (ignores for modded).",Ja=!0,Es={name:Va,description:ja,type:"other",order:{input:ht.OTHERS_INVALID_OBJECT,output:ft.OTHERS_INVALID_OBJECT},input:{enabled:Ja,params:{},html:ct.create(Va,ja,Ja,function(){Es.input.enabled=this.checked})},output:{html:null},run:am};function am(t){var C,R,F,P;if(!t.difficulty){console.error("Something went wrong!");return}const{colorNotes:e,bombNotes:i,obstacles:n,basicEvents:a,arcs:o,chains:l,lightColorEventBoxGroups:s,lightRotationEventBoxGroups:r,lightTranslationEventBoxGroups:h}=t.difficulty.data;let f=[],u=[],m=[],c=[],p=[];(R=(C=t.difficulty.info._customData)==null?void 0:C._requirements)!=null&&R.includes("Mapping Extensions")||((P=(F=t.difficulty.info._customData)==null?void 0:F._requirements)!=null&&P.includes("Noodle Extensions")?(f=e.filter(k=>k.isMappingExtensions()).map(k=>k.time),u=n.filter(k=>k.isMappingExtensions()).map(k=>k.time),m=i.filter(k=>k.isMappingExtensions()).map(k=>k.time),c=o.filter(k=>k.isMappingExtensions()).map(k=>k.time),p=l.filter(k=>k.isMappingExtensions()).map(k=>k.time)):(f=e.filter(k=>!k.isValid()).map(k=>k.time),u=n.filter(k=>!k.isValid()).map(k=>k.time),m=i.filter(k=>!k.isValid()).map(k=>k.time),c=o.filter(k=>!k.isValid()).map(k=>k.time),p=l.filter(k=>!k.isValid()).map(k=>k.time)));const _=a.filter(k=>!k.isValid()).map(k=>k.time),y=s.filter(k=>!k.isValid()).map(k=>k.time),b=r.filter(k=>!k.isValid()).map(k=>k.time),E=h.filter(k=>!k.isValid()).map(k=>k.time),D=[];if(f.length&&D.push(ut("Invalid note",f,t.settings.bpm,"error")),m.length&&D.push(ut("Invalid bomb",m,t.settings.bpm,"error")),c.length&&D.push(ut("Invalid arc",c,t.settings.bpm,"error")),p.length&&D.push(ut("Invalid chain",p,t.settings.bpm,"error")),u.length&&D.push(ut("Invalid obstacle",u,t.settings.bpm,"error")),_.length&&D.push(ut("Invalid event",_,t.settings.bpm,"error")),y.length&&D.push(ut("Invalid light color event",y,t.settings.bpm,"error")),b.length&&D.push(ut("Invalid light rotation event",b,t.settings.bpm,"error")),E.length&&D.push(ut("Invalid light translation event",E,t.settings.bpm,"error")),D.length){const k=document.createElement("div");D.forEach($=>k.append($)),Es.output.html=k}else Es.output.html=null}const qa=Object.freeze(Object.defineProperty({__proto__:null,difficultyLabel:bs,hotStart:yi,invalidObject:Es,njs:ys,outsidePlayable:vs},Symbol.toStringTag,{value:"Module"})),ge=class{constructor(){}};let $e=ge;$e.getNote=()=>Object.keys(da).map(t=>da[t]);$e.getObstacle=()=>Object.keys(va).map(t=>va[t]);$e.getEvent=()=>Object.keys(Pa).map(t=>Pa[t]);$e.getOther=()=>Object.keys(qa).map(t=>qa[t]);$e.getGeneral=()=>Object.keys(Cr).map(t=>Cr[t]);$e.getDifficulty=()=>[...ge.getNote(),...ge.getObstacle(),...ge.getEvent(),...ge.getOther()];$e.getAll=()=>[...ge.getNote(),...ge.getObstacle(),...ge.getEvent(),...ge.getOther(),...ge.getGeneral()];function bi(t){return["analyzer",t]}const bu=$e.getAll().sort((t,e)=>t.order.input-e.order.input),yu=[...bu].sort((t,e)=>t.order.output-e.order.output);function vu(){at.analysis={general:{html:null},map:[]}}function lm(){var l;const t=at.beatmapInfo;if(!t){q.tError(bi("runGeneral"),"Could not analyse, missing map info");return}at.analysis||vu();const e=(l=at.analysis)==null?void 0:l.general,i=Re.create(t._beatsPerMinute),n=be.create(i),a={bpm:i,njs:n,audioDuration:at.duration??null,mapDuration:0};q.tInfo(bi("runGeneral"),"Analysing general");const o=[];yu.filter(s=>s.type==="general").forEach(s=>{if(s.input.enabled)try{s.run({settings:a,info:t}),s.output.html&&o.push(s.output.html)}catch(r){q.tError(bi("runGeneral"),r)}}),e&&(e.html=o)}function Eu(t,e){var r,h,f;const i=at.beatmapInfo;if(!i){q.tError(bi("runDifficulty"),"Could not analyse, missing map info");return}at.analysis||vu();const n=(r=at.beatmapDifficulty)==null?void 0:r.find(u=>u.characteristic===t&&u.difficulty===e);if(!n){q.tError(bi("runDifficulty"),"Could not analyse, missing map data");return}const a=(h=at.analysis)==null?void 0:h.map.find(u=>u.difficulty===e&&u.mode===t),o=be.create(n.bpm,n.info._noteJumpMovementSpeed||be.FallbackNJS[n.difficulty],n.info._noteJumpStartBeatOffset),l={bpm:n.bpm,njs:o,audioDuration:at.duration??null,mapDuration:n.bpm.toRealTime(n.data.getLastInteractiveTime())};q.tInfo(bi("runDifficulty"),`Analysing ${t} ${e}`);const s=[];yu.filter(u=>u.type!=="general").forEach(u=>{if(u.input.enabled)try{u.run({settings:l,difficulty:n,info:i}),u.output.html&&s.push(u.output.html)}catch(m){q.tError(bi("runDifficulty"),m)}}),a?a.html=s:(f=at.analysis)==null||f.map.push({mode:t,difficulty:e,html:s})}function cm(t){$e.getDifficulty().sort((i,n)=>i.order.output-n.order.output).forEach(i=>{i.input.adjustTime&&i.input.adjustTime(t)})}function um(){var t;(t=at.beatmapDifficulty)==null||t.forEach(e=>Eu(e.characteristic,e.difficulty))}const Di={toolListInput:bu,runGeneral:lm,runDifficulty:Eu,adjustTime:cm,applyAll:um},ai="UI Tools: ",Ve=document.querySelectorAll(".tools__select-mode"),je=document.querySelectorAll(".tools__select-difficulty"),hm=document.querySelectorAll(".difficulty__label"),wu=document.querySelector(".tools__note-content"),Du=document.querySelector(".tools__obstacle-content"),Su=document.querySelector(".tools__event-content"),Tu=document.querySelector(".tools__other-content"),Cu=document.querySelector(".tools__general-content"),Se=document.querySelector(".tools__output-diff"),Te=document.querySelector(".tools__output-general"),Ka=document.querySelector(".tools__apply-this"),Za=document.querySelector(".tools__apply-all"),Qa=document.querySelector(".tools__apply-general");if(!wu||!Du||!Su||!Tu||!Cu)throw new Error(ai+"missing content element");if(!Se||!Te)throw new Error(ai+"missing output element");if(Ka&&Za&&Qa)Ka.addEventListener("click",bm),Za.addEventListener("click",ym),Qa.addEventListener("click",vm);else throw new Error(ai+"missing apply element");Ve.forEach(t=>t.addEventListener("change",gm));je.forEach(t=>t.addEventListener("change",_m));function Lu(){var e;const t=(e=at.analysis)==null?void 0:e.general;if(!t){Te.textContent="ERROR: could not find analysis for general";return}if(!t.html){Te.textContent="ERROR: could not find HTML for general";return}Te.innerHTML="",t.html.forEach(i=>Te.appendChild(i)),Te.firstChild||(Te.textContent="No issues found.")}function kn(t,e){var n;if(!t&&!e&&(t=Ve[0].value,e=je[0].value),!t||!e)throw new Error(ai+"something went wrong!");Se.innerHTML="";const i=(n=at.analysis)==null?void 0:n.map.find(a=>a.difficulty===e&&a.mode===t);if(!i){Se.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!i.html){Se.textContent="ERROR: could not find HTML for "+t+" "+e;return}i.html.forEach(a=>Se.appendChild(a)),Se.firstChild||(Se.textContent="No issues found.")}function Rs(t){hm.forEach(e=>e.textContent=t)}function Ru(t){if(!t)return;je.forEach(i=>{for(let n=i.options.length-1;n>=0;n--)i.remove(n)});let e=!0;for(let i=t._difficultyBeatmaps.length-1;i>=0;i--){const n=t._difficultyBeatmaps[i];je.forEach(a=>{var l,s,r,h;const o=document.createElement("option");if(o.value=n._difficulty,o.textContent=_e[n._difficulty]+((l=n._customData)!=null&&l._difficultyLabel?" -- "+((s=n._customData)==null?void 0:s._difficultyLabel):""),e){const f=(r=at.beatmapDifficulty)==null?void 0:r.find(u=>u.difficulty===n._difficulty&&u.characteristic===t._beatmapCharacteristicName);if(!f)throw new Error("missing _mapSetData");ql(f),Rs(((h=n._customData)==null?void 0:h._difficultyLabel)||_e[n._difficulty]),kn(t._beatmapCharacteristicName,n._difficulty)}e=!1,a.add(o)})}}function ku(t){if(!t){Ve.forEach(i=>Hs(i)),je.forEach(i=>Hs(i));return}let e=!0;t._difficultyBeatmapSets.forEach(i=>{Ve.forEach(n=>{const a=document.createElement("option");a.value=i._beatmapCharacteristicName,a.textContent=Jc[i._beatmapCharacteristicName],n.add(a)}),e&&Ru(i),e=!1})}function fm(){const t=at.beatmapInfo;if(!t)throw new Error(ai+"could not find map info");const e=Re.create(t._beatsPerMinute);Di.adjustTime(e)}function dm(){Di.toolListInput.forEach(t=>{if(t.input.html)switch(t.type){case"note":{wu.appendChild(t.input.html);break}case"obstacle":{Du.appendChild(t.input.html);break}case"event":{Su.appendChild(t.input.html);break}case"other":{Tu.appendChild(t.input.html);break}case"general":{Cu.appendChild(t.input.html);break}default:console.error(ai+"could not recognise type "+t.type+" for "+t.name)}})}function mm(){Te&&(Te.innerHTML="No output."),Se&&(Se.innerHTML="No output.")}function pm(){mm(),Rs("Difficulty Label"),ku()}function gm(t){var n;const e=t.target;Ve.forEach(a=>{a!==e&&(a.value=e.value)});const i=(n=at.beatmapInfo)==null?void 0:n._difficultyBeatmapSets.find(a=>a._beatmapCharacteristicName===e.value);Ru(i)}function _m(t){var a,o,l,s;const e=t.target;je.forEach(r=>{r!==e&&(r.value=e.value)});const i=(a=at.beatmapInfo)==null?void 0:a._difficultyBeatmapSets.find(r=>r._beatmapCharacteristicName===Ve.item(0).value);if(!i)throw new Error("aaaaaaaaaaaaaaaaaaa");const n=(o=at.beatmapDifficulty)==null?void 0:o.find(r=>r.difficulty===e.value&&r.characteristic===i._beatmapCharacteristicName);n&&(ql(n),Rs(((s=(l=n.info)==null?void 0:l._customData)==null?void 0:s._difficultyLabel)||_e[e.value]),kn(n.characteristic,n.difficulty))}function bm(){const t=Ve[0].value,e=je[0].value;if(!t||!e)throw new Error(ai+"mode/difficulty does not exist");vt.status("info",`Re-analysing ${t} ${e}`,100),Di.runDifficulty(t,e),vt.status("info",`Re-analysed ${t} ${e}`,100),kn(t,e)}function ym(){const t=Ve[0].value,e=je[0].value;if(!t||!e)throw new Error(ai+"mode/difficulty does not exist");vt.status("info","Re-analysing all difficulties",100),Di.applyAll(),vt.status("info","Re-analysed all difficulties",100),kn(t,e)}function vm(){vt.status("info","Re-analysing all difficulties",100),Di.runGeneral(),vt.status("info","Re-analysed all difficulties",100),Lu()}const Hi={displayOutputGeneral:Lu,displayOutputDifficulty:kn,setDifficultyLabel:Rs,adjustTime:fm,populateSelect:ku,populateTool:dm,reset:pm},vi="UI Stats: ",L="stats__";function Em(t,e){const i=e.bpm,n=at.duration||0,a=i.toRealTime(e.data.getLastInteractiveTime()),o=document.createElement("table");return o.className=L+"table",o.innerHTML=`<caption class="${L}table-caption">Note Per Seconds (NPS):</caption><tr><th class="${L}table-header" colspan="2">Overall</th><td class="${L}table-element">${I(e.data.nps(n),2)}</td></tr><tr><th class="${L}table-header" colspan="2">Mapped</th><td class="${L}table-element">${I(e.data.nps(a),2)}</td></tr><tr><th class="${L}table-header" rowspan="3">Peak</th><th class="${L}table-header">16-beat</th><td class="${L}table-element">${I(e.data.peak(16,i.value),2)}</td></tr><tr><th class="${L}table-header">8-beat</th><td class="${L}table-element">${I(e.data.peak(8,i.value),2)}</td></tr><tr><th class="${L}table-header">4-beat</th><td class="${L}table-element">${I(e.data.peak(4,i.value),2)}</td></tr>`,o}function wm(t,e){const i=Re.create(t._beatsPerMinute),n=be.create(i,e.info._noteJumpMovementSpeed||be.FallbackNJS[e.difficulty],e.info._noteJumpStartBeatOffset),a=document.createElement("table");return a.className=L+"table",a.innerHTML=`<caption class="${L}table-caption">Map Settings:</caption><tr><th class="${L}table-header" colspan="2">Note Jump Speed</th><td class="${L}table-element">${I(n.value,3)}</td></tr><tr><th class="${L}table-header" colspan="2">Spawn Distance Modifier</th><td class="${L}table-element">${I(n.offset,3)}</td></tr><tr><th class="${L}table-header" colspan="2">Half Jump Duration</th><td class="${L}table-element">${I(n.hjd,3)}</td></tr><tr><th class="${L}table-header" colspan="2">Jump Distance</th><td class="${L}table-element">${I(n.jd,3)}</td></tr><tr><th class="${L}table-header" colspan="2">Reaction Time</th><td class="${L}table-element">${I(n.reactionTime*1e3)}ms</td></tr>`,a}function Dm(t,e){const i=e.swingAnalysis,n=document.createElement("table");return n.className=L+"table",n.innerHTML=`<caption class="${L}table-caption">Swing Per Seconds (SPS):</caption><tr><th class="${L}table-header"></th><th class="${L}table-header">Total</th><th class="${L}table-header">Red</th><th class="${L}table-header">Blue</th></tr><tr><th class="${L}table-header">Average</th><td class="${L}table-element">${I(i.total.average,2)}</td><td class="${L}table-element">${I(i.red.average,2)}</td><td class="${L}table-element">${I(i.blue.average,2)}</td></tr><tr><th class="${L}table-header">Median</th><td class="${L}table-element">${I(i.total.median,2)}</td><td class="${L}table-element">${I(i.red.median,2)}</td><td class="${L}table-element">${I(i.blue.median,2)}</td></tr><tr><th class="${L}table-header">Peak</th><td class="${L}table-element">${I(i.total.peak,2)}</td><td class="${L}table-element">${I(i.red.peak,2)}</td><td class="${L}table-element">${I(i.blue.peak,2)}</td></tr><tr><th class="${L}table-header">Total</th><td class="${L}table-element">${i.total.total}</td><td class="${L}table-element">${i.red.total}</td><td class="${L}table-element">${i.blue.total}</td></tr>`,n}function Kn(t){const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let i=t.length-1;i>=0;i--)t[i].color===0?(e.red.total++,t[i].isChroma()&&e.red.chroma++,t[i].isNoodleExtensions()&&e.red.noodleExtensions++,t[i].isMappingExtensions()&&e.red.mappingExtensions++):t[i].color===1&&(e.blue.total++,t[i].isChroma()&&e.blue.chroma++,t[i].isNoodleExtensions()&&e.blue.noodleExtensions++,t[i].isMappingExtensions()&&e.blue.mappingExtensions++);return e}function Sm(t){const e={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>=0;i--)e.total++,t[i].isChroma()&&e.chroma++,t[i].isNoodleExtensions()&&e.noodleExtensions++,t[i].isMappingExtensions()&&e.mappingExtensions++;return e}function Mn(t,e){return t.filter(i=>i.data.posX===e).length}function Tm(t,e){return t.filter(i=>i.data.posY===e).length}function Cm(t,e,i){return t.filter(n=>n.data.posX===e&&n.data.posY===i).length}function Lm(t,e){return t.filter(i=>i.type!=="bomb"&&i.data.direction===e).length}function xu(t,e){switch(e){case"note":return t.filter(i=>i.type==="note");case"red":return t.filter(i=>i.type==="note"&&i.data.color===0);case"blue":return t.filter(i=>i.type==="note"&&i.data.color===1);case"arc":return t.filter(i=>i.type==="arc");case"redArc":return t.filter(i=>i.type==="arc"&&i.data.color===0);case"blueArc":return t.filter(i=>i.type==="arc"&&i.data.color===1);case"chain":return t.filter(i=>i.type==="chain");case"redChain":return t.filter(i=>i.type==="chain"&&i.data.color===0);case"blueChain":return t.filter(i=>i.type==="chain"&&i.data.color===1);case"bomb":return t.filter(i=>i.type==="bomb");default:return t}}function Rm(t){var r;const e=t.target,i=e.id.replace(`${L}table-select-angle-`,"").split("-"),n=i[0],a=i[1],o=(r=at.beatmapDifficulty.find(h=>h.characteristic===n&&h.difficulty===a))==null?void 0:r.noteContainer;if(!o){console.error(vi+"note could not be found");return}const l=xu(o,e.value),s=document.querySelector(`#${L}table-angle-${n}-${a}`);if(!s){console.error(vi+"table could not be found");return}s.innerHTML=Bu(l)}function Bu(t){const e=t.length||1,i=[4,0,5,2,8,3,6,1,7];let n="";for(let a=0;a<3;a++){n+="<tr>";for(let o=0;o<3;o++){let l=Lm(t,i[a*3+o]);n+=`<td class="${L}table-element">${l}<br>(${I(l/e*100,1)}%)</td>`}n+="</tr>"}return n}function km(t,e){var o;const i=Rn.create(`${L}table-select-angle-${e.characteristic}-${e.difficulty}`,"Note Angle: ","caption",`${L}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"});(o=i.querySelector("select"))==null||o.addEventListener("change",Rm);let n=`<tbody id="${L}table-angle-${e.characteristic}-${e.difficulty}">${Bu(e.noteContainer)}</tbody>`;const a=document.createElement("table");return a.className=L+"table",a.innerHTML=n,a.prepend(i),a}function xm(t,e,i="DefaultEnvironment"){var o;const n=((o=Ei[i])==null?void 0:o[0])??Ei.DefaultEnvironment[0],a={};for(let l=n.length-1;l>=0;l--)a[n[l]]={total:0,chroma:0,chromaOld:0};a[5]={total:e.length,chroma:0,chromaOld:0};for(let l=t.length-1;l>=0;l--)t[l].isValidType()&&(a[t[l].type]||(a[t[l].type]={total:0,chroma:0,chromaOld:0}),a[t[l].type].total++,t[l].isChroma()&&a[t[l].type].chroma++,t[l].isOldChroma()&&a[t[l].type].chromaOld++);return a}function $s(t,e="DefaultEnvironment"){var a;const i=((a=Ei[e])==null?void 0:a[1])??Ei.DefaultEnvironment[1],n={};for(let o=i.length-1;o>=0;o--)n[i[o]]={total:0,eventBox:0,base:0};for(let o=t.length-1;o>=0;o--)n[t[o].id]||(n[t[o].id]={total:0,eventBox:0,base:0}),n[t[o].id].total++,n[t[o].id].eventBox+=t[o].boxes.length,n[t[o].id].base+=t[o].boxes.reduce((l,s)=>l+s.events.length,0);return n}function Bm(t){const e={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>-1;i--)e.total++,t[i].isInteractive()&&e.interactive++,t[i].isChroma()&&e.chroma++,t[i].isNoodleExtensions()&&e.noodleExtensions++,t[i].isMappingExtensions()&&e.mappingExtensions++;return e}const Nm={0:"Back Lasers",1:"Ring Lights",2:"Left Lasers",3:"Right Lasers",4:"Center Lights",5:"Boost Colors",6:"Extra Left Lights",7:"Extra Right Lights",8:"Ring Rotation",9:"Ring Zoom",10:"Extra Left Lasers",11:"Extra Right Lasers",12:"Left Laser Speed",13:"Right Laser Speed",14:"Early Lane Rotation",15:"Late Lane Rotation",16:"Utility Event 1",17:"Utility Event 2",18:"Utility Event 3",19:"Utility Event 4",40:"Special Event 1",41:"Special Event 2",42:"Special Event 3",43:"Special Event 4"},Am={LinkinParkEnvironment:{0:"Lane Light",1:"Ceiling Lights",8:"Laser Mode"},BTSEnvironment:{0:"Door Light",1:"Vertical Pillar Lights",8:"Distant Tower Spin",9:"Raise/Lower Pillars",40:"BTS Event 1",41:"BTS Event 2",42:"BTS Event 3",43:"BTS Event 4"},KaleidoscopeEnvironment:{0:"Spike Tip Lights",1:"Spike Mid Lights",2:"Spike Left Lights",3:"Spike Right Lights",4:"Distant Lasers and Spike Top Lights"},InterscopeEnvironment:{0:"Gate 1",1:"Gate 2",2:"Gate 3",3:"Gate 4",4:"Gate 5",6:"Extra 1",7:"Extra 2"},SkrillexEnvironment:{0:"Logo",1:"Top Lanes and 1st Ring Set",4:"Bottom Lanes and 2nd Ring Set",6:"Left Panel",7:"Right Panel",12:"Left Laser & Panel Speed",13:"Right Laser & Panel Speed"},BillieEnvironment:{0:"Water 4",1:"Water 1",2:"Left Sun Beams",3:"Right Sun Beams",4:"Sun",6:"Water 2",7:"Water 3",8:"Toggle Rain",9:"Sunbeam Mode",10:"Left Bottom Lasers",11:"Right Bottom Lasers",12:"Left Sun Beams Speed",13:"Right Sun Beams Speed"},HalloweenEnvironment:{0:"Sky Lasers",1:"Moon",4:"Lane + Castle Interior"},GagaEnvironment:{0:"Aurora 1",1:"Aurora 2",2:"Tower 1",3:"Tower 2",4:"Logo",6:"Tower 3",7:"Tower 4",10:"Tower 5",11:"Tower 6",14:"Tower 1 Height",15:"Tower 2 Height",16:"Tower 3 Height",17:"Tower 4 Height",18:"Tower 5 Height",19:"Tower 6 Height"},WeaveEnvironment:{4:"Player Space"},PyroEnvironment:{0:"Video Alpha",1:"Logo",2:"Left Projectors",3:"Right Projectors",4:"Platform",6:"Ambient",40:"Video Projection"},EDMEnvironment:{0:"Lane Lights Bottom",1:"Lane Lights Top",4:"Player Space & Spectrogram"},TheSecondEnvironment:{0:"Logo",1:"Runway",2:"Left Flags",3:"Right Flags",4:"Buildings"},LizzoEnvironment:{0:"Runway Left",1:"Runway Right",2:"Left Ring",3:"Right Ring",4:"Top Square",6:"Ambient",7:"Cherry Left",8:"Cherry Right",9:"LI Sign",10:"Z Left Sign",11:"Z Right Sign",12:"O Sign",16:"Left Balloon Particles",17:"Right Balloon Particles"},TheWeekndEnvironment:{0:"Runway Left",1:"Runway Right",6:"Ambient"},RockMixtapeEnvironment:{3:"BG Bloom",4:"Aurora",6:"Ambient"},Dragons2Environment:{0:"Inner Laser Left",1:"Inner Laser Right",2:"Outer Laser Left",3:"Outer Laser Right",4:"Logo",6:"Ambient"},Panic2Environment:{3:"Ambient"},QueenEnvironment:{6:"Ambient",40:"Silhouettes"}};function Im(t,e){var i;return((i=Am[e])==null?void 0:i[t])||Nm[t]||"Unknown"}const $m={WeaveEnvironment:{0:"Outer Square Bottom Left Laser",1:"Outer Square Bottom Right Laser",2:"Outer Square Top Left Laser",3:"Outer Square Top Right Laser",4:"Inner Square Bottom Left Laser",5:"Inner Square Bottom Right Laser",6:"Inner Square Top Left Laser",7:"Inner Square Top Right Laser",8:"Side Square Bottom Left Laser",9:"Side Square Bottom Right Laser",10:"Side Square Top Left Laser",11:"Side Square Top Right Laser",12:"Distant Square Top Laser",13:"Distant Square Bottom Laser",14:"Distant Square Left Laser",15:"Distant Square Right Laser"},PyroEnvironment:{0:"Stage Left Platform",1:"Stage Right Platform",2:"Top Stage Left Laser",3:"Top Stage Right Laser",4:"Top Stage Middle Laser",5:"Top Stage Light",6:"Side Panels Left Tower",7:"Side Panels Right Tower",8:"Stage Left Laser",9:"Stage Right Laser",10:"Side Panels Left Laser",11:"Side Panels Right Laser",12:"Fire Left",13:"Fire Right"},EDMEnvironment:{0:"Circles Top",1:"Circles Close",2:"Circles Distant",3:"Circles Distant 2",4:"Single Source Circles Left",5:"Single Source Circles Right",6:"Single Source Lasers Left (Up)",7:"Single Source Lasers Left (Out)",8:"Single Source Lasers Right (Up)",9:"Single Source Lasers Right (Out)",10:"Single Source Lasers Left (Down)",11:"Single Source Lasers Right (Down)",12:"Single Source Lasers Left (Down) / Circle Rotations Top",13:"Single Source Lasers Right (Up) / Circle Rotations Close",14:"Circle Rotations Distant",15:"Circle Rotations Distant 2",16:"Circle Rotations Single Source Left",17:"Circle Rotations Single Source Right"},TheSecondEnvironment:{0:"Rings Big",1:"Rings Small",2:"Runway Left",3:"Runway Right",4:"Spotlight Left",5:"Spotlight Right",6:"Top Lasers Left Bottom",7:"Top Lasers Right Bottom",8:"Top Lasers Left Top",9:"Top Lasers Right Top",10:"Bottom Lasers Left Bottom",11:"Bottom Lasers Right Bottom",12:"Bottom Lasers Left Top",13:"Bottom Lasers Right Top"},LizzoEnvironment:{0:"Main Floor",1:"Rainbow Arcs Inner",2:"Rainbow Arcs 2",3:"Rainbow Arcs 3",4:"Rainbow Arcs 4",5:"Rainbow Arcs Outer",6:"Rainbow Rings Left",7:"Rainbow Rings Right",8:"Rainbow Rings Lasers Left",9:"Rainbow Rings Lasers Right",10:"Main Top Lasers",11:"Environment Stands Left",12:"Environment Stands Right",13:"Environment Clouds Left",14:"Environment Clouds Right",15:"Main Left Lasers",16:"Main Right Lasers",17:"Environment Stand Lasers Left",18:"Environment Stand Lasers Right",19:"Rainbow Arcs Laser"},TheWeekndEnvironment:{0:"Lamps Poles Left",1:"Lamps Poles Right",2:"Lamps Rings Left",3:"Lamps Rings Right",4:"Environment Arrows",5:"Environment Side Lasers Left",6:"Environment Side Lasers Right",7:"Environment Runway Lane",8:"Environment Center Ring",9:"Environment Center Ring Lasers",10:"Windows Left 1 Front",11:"Windows Left 1 Side",12:"Windows Left 2 Side",13:"Windows Left 3 Front",14:"Windows Left 3 Side",15:"Windows Right 1 Front",16:"Windows Right 1 Side",17:"Windows Right 2 Side",18:"Windows Right 3 Front",19:"Windows Right 3 Side",20:"Buildings Left",21:"Buildings Right",22:"Buildings Roof Left",23:"Buildings Roof Right",29:"Lamp Rings Left 1",30:"Lamp Rings Left 2",31:"Lamp Rings Left 3",32:"Lamp Rings Left 4",33:"Lamp Rings Right 1",34:"Lamp Rings Right 2",35:"Lamp Rings Right 3",36:"Lamp Rings Right 4",37:"Buildings Background Left",38:"Buildings Background Right",40:"Buildings Side Buildings"},RockMixtapeEnvironment:{0:"Lasers Far Left",1:"Lasers Far Right",2:"Mountain 1",3:"Mountain 2",4:"Mountain 3",5:"Mountain 4",6:"Mountain 5",7:"Mountain 6",8:"Mountain 7",9:"Mountain 8",10:"Mountain 9",11:"Mountain 10",12:"Mountain 11",13:"Mountain 12",14:"Face Eyes",15:"Runway Frets",16:"Runway Strings",17:"Runway Tunnel",18:"Lasers Side Left",19:"Lasers Side Right",20:"Lasers Side Left Rotation",21:"Lasers Side Right Rotation",22:"Face Left",23:"Face Right",24:"Spikes Left",25:"Spikes Left Movement",26:"Spikes Right",27:"Spikes Right Movement",28:"Runway Dots",29:"Face Movement",30:"Runway Equilizer",31:"Screens Left 1",32:"Screens Left 2",33:"Screens Right 1",34:"Screens Right 2",35:"Screens Left Movement",36:"Screens Right Movement",37:"Lasers Side Z Translation"},Dragons2Environment:{0:"Small Rings (R/T)",1:"Small Rings (Colors)",2:"Underground",3:"Big Rings",4:"Top Spotlights",5:"Runway Left",6:"Runway Right",7:"Particles Left",8:"Particles Right",9:"Main Lasers Bottom Left",10:"Main Lasers Top Left",11:"Main Lasers Top Right",12:"Main Lasers Bottom Right"},Panic2Environment:{0:"Left Cones Local",1:"Right Cones Local",2:"Left Cones Global",3:"Right Cones Global",4:"Center Cones Local",5:"Center Cones Global",6:"Diamond Rings Local Left",7:"Diamond Rings Local Right",8:"Diamond Rings Global",9:"Lasers Bottom Left",10:"Lasers Bottom Right",11:"Lasers Top Left",12:"Lasers Top Right",13:"Runway Lasers Left",14:"Runway Lasers Right",15:"Runway Inner Laser",16:"Spectrogram Left",17:"Spectrogram Right",18:"Runway Lasers Left Transform Z",19:"Runway Lasers Right Transform Z",20:"Window Left Pirces",21:"Window Left Aura",22:"Window Right Pieces",23:"Window Right Aura"},QueenEnvironment:{0:"Vinyls Left",1:"Vinyl Left 1",2:"Vinyl Left 2",3:"Vinyl Left 3",4:"Vinyl Left 4",5:"Vinyls Right",6:"Vinyl Right 1",7:"Vinyl Right 2",8:"Vinyl Right 3",9:"Vinyl Right 4",10:"Tunnel Rings Wrapper",11:"Distant Circular Lasers Z",12:"Distant Circular Lasers",13:"Top Circular Lasers Rot Y",14:"Top Circular Lasers",15:"Platform Lane Left",16:"Platform Lane Right",17:"Silhouette Contour"}};function Om(t,e){var i;return((i=$m[e])==null?void 0:i[t])||"Unknown"}function Pm(t,e){const i=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,n=xm(e.data.basicEvents,e.data.colorBoostEvents,i);let a=0,o=0,l=`<caption class="${L}table-caption">Events: ${Object.values(n).reduce((r,{total:h})=>r+h,0)}</caption>`;for(const r in n)a+=n[r].chroma,o+=n[r].chromaOld,l+=`<tr><th class="${L}table-header">${r}</th><th class="${L}table-header" colspan="4">${Im(parseInt(r),i)}</th><td class="${L}table-element">${n[r].total}</td></tr>`;a&&(l+=`<tr><th class="${L}table-header" colspan="5">Chroma</th><td class="${L}table-element">${a}</td></tr>`),o&&(l+=`<tr><th class="${L}table-header" colspan="5">OG Chroma</th><td class="${L}table-element">${o}</td></tr>`);const s=document.createElement("table");return s.className=L+"table",s.innerHTML=l,s}function Mm(t,e){const i=e.characteristic==="360Degree"||e.characteristic==="90Degree"?t._allDirectionsEnvironmentName:t._environmentName,n=$s(e.data.lightColorEventBoxGroups,i),a=$s(e.data.lightRotationEventBoxGroups,i),o=$s(e.data.lightTranslationEventBoxGroups,i);for(const u in n)a[u]||(a[u]={total:0,eventBox:0,base:0}),o[u]||(o[u]={total:0,eventBox:0,base:0});for(const u in a)n[u]||(n[u]={total:0,eventBox:0,base:0}),o[u]||(o[u]={total:0,eventBox:0,base:0});for(const u in o)a[u]||(a[u]={total:0,eventBox:0,base:0}),n[u]||(n[u]={total:0,eventBox:0,base:0});let l=`<caption class="${L}table-caption">Event Box Group:</caption><tr><th class="${L}table-header"></th><th class="${L}table-header">Group</th><th class="${L}table-header">Box</th><th class="${L}table-header">Base</th><tr><th class="${L}table-header">Color</th><td class="${L}table-element">${Object.values(n).reduce((u,{total:m})=>u+m,0)}</td><td class="${L}table-element">${Object.values(n).reduce((u,{eventBox:m})=>u+m,0)}</td><td class="${L}table-element">${Object.values(n).reduce((u,{base:m})=>u+m,0)}</td></tr><tr><th class="${L}table-header">Rotate</th><td class="${L}table-element">${Object.values(a).reduce((u,{total:m})=>u+m,0)}</td><td class="${L}table-element">${Object.values(a).reduce((u,{eventBox:m})=>u+m,0)}</td><td class="${L}table-element">${Object.values(a).reduce((u,{base:m})=>u+m,0)}</td></tr><tr><th class="${L}table-header">Translate</th><td class="${L}table-element">${Object.values(o).reduce((u,{total:m})=>u+m,0)}</td><td class="${L}table-element">${Object.values(o).reduce((u,{eventBox:m})=>u+m,0)}</td><td class="${L}table-element">${Object.values(o).reduce((u,{base:m})=>u+m,0)}</td></tr><tr><th class="${L}table-header">Total</th><td class="${L}table-element">${Object.values(n).reduce((u,{total:m})=>u+m,0)+Object.values(a).reduce((u,{total:m})=>u+m,0)+Object.values(o).reduce((u,{total:m})=>u+m,0)}</td><td class="${L}table-element">${Object.values(n).reduce((u,{eventBox:m})=>u+m,0)+Object.values(a).reduce((u,{eventBox:m})=>u+m,0)+Object.values(o).reduce((u,{eventBox:m})=>u+m,0)}</td><td class="${L}table-element">${Object.values(n).reduce((u,{base:m})=>u+m,0)+Object.values(a).reduce((u,{base:m})=>u+m,0)+Object.values(o).reduce((u,{base:m})=>u+m,0)}</td></tr>`,s=`<caption class="${L}table-caption">Event Box Group ID:</caption>`;for(const u in n)s+=`<tr><th class="${L}table-header">${u}</th><th class="${L}table-header" colspan="5">${Om(parseInt(u),i)}</th><td class="${L}table-element" title="${n[u].eventBox} Box (${n[u].base} Base)">${n[u].total}</td><td class="${L}table-element" title="${a[u].eventBox} Box (${a[u].base} Base)">${a[u].total}</td><td class="${L}table-element" title="${o[u].eventBox} Box (${o[u].base} Base)">${o[u].total}</td></tr>`;const r=document.createElement("table");r.className=L+"table",r.innerHTML=l;const h=document.createElement("table");h.className=L+"table",h.innerHTML=s;const f=document.createElement("div");return f.appendChild(r),f.appendChild(document.createElement("br")),f.appendChild(h),f}const Fm=115;function Hm(t){let e=0,i=1;for(let n=0,a=t.filter(o=>o.type==="note"&&!(typeof o.data.customData.uninteractable<"u"||!o.data.customData.uninteractable)).length;n<a;n++)i<8&&n===-3+i*4&&(i*=2),e+=Fm*i;return e}function Wm(t,e){const i=Kn(e.data.colorNotes);let n=`<caption class="${L}table-caption">Note Information:</caption><tr><th class="${L}table-header" colspan="2">R/B Ratio</th><td class="${L}table-element">${I(i.red.total/i.blue.total,2)}</td></tr><tr><th class="${L}table-header" colspan="2">Max Score</th><td class="${L}table-element">${Xu(Hm(e.noteContainer))}</td></tr><tr><th class="${L}table-header" colspan="2">Effective BPM</th><td class="${L}table-element">${I(_h(e.swingAnalysis.container),2)}</td></tr><tr><th class="${L}table-header" colspan="2">Effective BPM (swing)</th><td class="${L}table-element">${I(bh(e.swingAnalysis.container),2)}</td></tr>`,a=I(Th(e.swingAnalysis.container)*1e3,1),o=I(Ch(e.swingAnalysis.container)*1e3,1);a&&o&&(n+=`<tr><th class="${L}table-header" colspan="2">Min. Slider Speed</th><td class="${L}table-element">${a}ms</td></tr><tr><th class="${L}table-header" colspan="2">Max. Slider Speed</th><td class="${L}table-element">${o}ms</td></tr>`);const l=document.createElement("table");return l.className=L+"table",l.innerHTML=n,l}function Xm(t,e){const i=Kn(e.data.colorNotes),n=Kn(e.data.arcs),a=Kn(e.data.chains),o=Sm(e.data.bombNotes);let l=`<caption class="${L}table-caption">Note Count:</caption><tr><th class="${L}table-header"></th><th class="${L}table-header">Note</th><th class="${L}table-header">Arc</th><th class="${L}table-header">Chain</th><th class="${L}table-header">Bomb</th></tr><tr><th class="${L}table-header">Total</th><td class="${L}table-element">${i.red.total+i.blue.total}</td><td class="${L}table-element">${n.red.total+n.blue.total}</td><td class="${L}table-element">${a.red.total+a.blue.total}</td><td class="${L}table-element">${o.total}</td></tr><tr><th class="${L}table-header">Red</th><td class="${L}table-element">${i.red.total}</td><td class="${L}table-element">${n.red.total}</td><td class="${L}table-element">${a.red.total}</td><td class="${L}table-element">0</td></tr><tr><th class="${L}table-header">Blue</th><td class="${L}table-element">${i.blue.total}</td><td class="${L}table-element">${n.blue.total}</td><td class="${L}table-element">${a.blue.total}</td><td class="${L}table-element">0</td></tr>`;(i.red.chroma||i.blue.chroma||n.red.chroma||n.blue.chroma||a.red.chroma||a.blue.chroma||o.chroma)&&(l+=`<tr><th class="${L}table-header">Chroma</th><td class="${L}table-element">${i.red.chroma+i.blue.chroma}</td><td class="${L}table-element">${n.red.chroma+n.blue.chroma}</td><td class="${L}table-element">${a.red.chroma+a.blue.chroma}</td><td class="${L}table-element">${o.chroma}</td></tr>`),(i.red.noodleExtensions||i.blue.noodleExtensions||n.red.noodleExtensions||n.blue.noodleExtensions||a.red.noodleExtensions||a.blue.noodleExtensions||o.noodleExtensions)&&(l+=`<tr><th class="${L}table-header">NE</th><td class="${L}table-element">${i.red.noodleExtensions+i.blue.noodleExtensions}</td><td class="${L}table-element">${n.red.noodleExtensions+n.blue.noodleExtensions}</td><td class="${L}table-element">${a.red.noodleExtensions+a.blue.noodleExtensions}</td><td class="${L}table-element">${o.noodleExtensions}</td></tr></tr>`),(i.red.mappingExtensions||i.blue.mappingExtensions||n.red.mappingExtensions||n.blue.mappingExtensions||a.red.mappingExtensions||a.blue.mappingExtensions||o.mappingExtensions)&&(l+=`<tr><th class="${L}table-header">ME</th><td class="${L}table-element">${i.red.mappingExtensions+i.blue.mappingExtensions}</td><td class="${L}table-element">${n.red.mappingExtensions+n.blue.mappingExtensions}</td><td class="${L}table-element">${a.red.mappingExtensions+a.blue.mappingExtensions}</td><td class="${L}table-element">${o.mappingExtensions}</td></tr></tr>`);const s=document.createElement("table");return s.className=L+"table",s.innerHTML=l,s}function zm(t){var r;const e=t.target,i=e.id.replace(`${L}table-select-placement-`,"").split("-"),n=i[0],a=i[1],o=(r=at.beatmapDifficulty.find(h=>h.characteristic===n&&h.difficulty===a))==null?void 0:r.noteContainer;if(!o){console.error(vi+"note could not be found");return}const l=xu(o,e.value),s=document.querySelector(`#${L}table-placement-${n}-${a}`);if(!s){console.error(vi+"table could not be found");return}s.innerHTML=Nu(l)}function Nu(t){const e=t.length||1;let i="";for(let n=2;n>=0;n--){i+="<tr>";for(let a=0;a<=3;a++)i+=`<td class="${L}table-element">${Cm(t,a,n)}</td>`;i+=`<td class="${L}table-element ${L}table--no-border">${I(Tm(t,n)/e*100,1)}%</td>
        </tr>`}return i+=`<tr><td class="${L}table-element ${L}table--no-border">${I(Mn(t,0)/e*100,1)}%</td><td class="${L}table-element ${L}table--no-border">${I(Mn(t,1)/e*100,1)}%</td><td class="${L}table-element ${L}table--no-border">${I(Mn(t,2)/e*100,1)}%</td><td class="${L}table-element ${L}table--no-border">${I(Mn(t,3)/e*100,1)}%</td></tr>`,i}function Gm(t,e){var o;const i=Rn.create(`${L}table-select-placement-${e.characteristic}-${e.difficulty}`,"Note Placement: ","caption",`${L}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"},{text:"Bomb",value:"bomb"});(o=i.querySelector("select"))==null||o.addEventListener("change",zm);let n=`<tbody id="${L}table-placement-${e.characteristic}-${e.difficulty}">${Nu(e.noteContainer)}</tbody>`;const a=document.createElement("table");return a.className=L+"table",a.innerHTML=n,a.prepend(i),a}function Ym(t,e){const i=Bm(e.data.obstacles);let n=`<caption class="${L}table-caption">Obstacles: ${i.total}</caption>`;i.interactive&&(n+=`<tr><th class="${L}table-header" colspan="2">Interactive</th><td class="${L}table-element">${i.interactive}</td></tr>`),i.chroma&&(n+=`<tr><th class="${L}table-header" colspan="2">Chroma</th><td class="${L}table-element">${i.chroma}</td></tr>`),i.noodleExtensions&&(n+=`<tr><th class="${L}table-header" colspan="2">Noodle Extensions</th><td class="${L}table-element">${i.noodleExtensions}</td></tr>`),i.mappingExtensions&&(n+=`<tr><th class="${L}table-header" colspan="2">Mapping Extensions</th><td class="${L}table-element">${i.mappingExtensions}</td></tr>`);const a=document.createElement("table");return a.className=L+"table",a.innerHTML=n,a}const Zn=document.querySelector("#stats .accordion__collapsible");function Um(){if(!at.beatmapInfo)throw new Error(vi+"map info could not be found in savedData");const t=at.beatmapInfo;t._difficultyBeatmapSets.forEach(e=>{var a,o;const i=document.createElement("div");i.className=L+"mode-"+e._beatmapCharacteristicName;const n=document.createElement("div");n.className=L+"title",n.textContent=Jc[e._beatmapCharacteristicName],i.appendChild(n);for(let l=e._difficultyBeatmaps.length-1;l>=0;l--){const s=e._difficultyBeatmaps[l],r=at.beatmapDifficulty.find(_=>_.characteristic===e._beatmapCharacteristicName&&_.difficulty===s._difficulty);if(!r)throw new Error(vi+"Could not find map data");const h=cl.create(`${L}${e._beatmapCharacteristicName}-${s._difficulty}`,_e[s._difficulty]+((a=s._customData)!=null&&a._difficultyLabel?" -- "+((o=s._customData)==null?void 0:o._difficultyLabel):""),s._difficulty,!0),f=h.querySelector(".accordion__collapsible-flex"),u=h.querySelector(".accordion__button");if(!f||!u)throw new Error(vi+"something went wrong!");u.checked=Q.onLoad.stats;const m=gn.create("small","half"),c=gn.create("small","half"),p=gn.create("small","half");m.append(wm(t,r)),m.append(document.createElement("br")),m.append(Em(t,r)),m.append(document.createElement("br")),m.append(Dm(t,r)),c.append(Wm(t,r)),c.append(document.createElement("br")),c.append(Xm(t,r)),c.append(document.createElement("br")),c.append(Gm(t,r)),c.append(document.createElement("br")),c.append(km(t,r)),p.append(Pm(t,r)),p.append(document.createElement("br")),p.append(Mm(t,r)),p.append(document.createElement("br")),p.append(Ym(t,r)),f.appendChild(m),f.appendChild(c),f.appendChild(p),i.appendChild(h)}Zn.appendChild(i)})}function Vm(){for(;Zn.firstChild;)Zn.removeChild(Zn.firstChild)}function Rt(t,e,i){t[i]??(t[i]=t[e]),delete t[e]}function tl(t){if(!t)return{};const e=_t(t);return Object.keys(e).length?(Rt(e,"_color","color"),Rt(e,"_position","coordinates"),Rt(e,"_disableNoteGravity","disableNoteGravity"),Rt(e,"_disableNoteLook","disableNoteLook"),Rt(e,"_flip","flip"),Rt(e,"_localRotation","localRotation"),Rt(e,"_noteJumpMovementSpeed","noteJumpMovementSpeed"),Rt(e,"_noteJumpStartBeatOffset","noteJumpStartBeatOffset"),Rt(e,"_scale","size"),Rt(e,"_track","track"),Rt(e,"_rotation","worldRotation"),e.spawnEffect??(e.spawnEffect=typeof e._disableSpawnEffect=="boolean"?!e._disableSpawnEffect:void 0),delete e._disableSpawnEffect,e.uninteractable??(e.uninteractable=typeof e._interactable=="boolean"?!e._interactable:void 0),delete e._interactable,e._animation&&(e.animation??(e.animation={color:e._animation._color,definitePosition:e._animation._definitePosition,dissolve:e._animation._dissolve,dissolveArrow:e._animation._dissolveArrow,interactable:e._animation._interactable,localRotation:e._animation._localRotation,offsetPosition:e._animation._position,offsetRotation:e._animation._rotation,scale:e._animation._scale,time:e._animation._time})),delete e._animation,e):{}}function jm(t){if(!t)return{};const e=_t(t);if(!Object.keys(e).length)return{};Rt(e,"_color","color"),Rt(e,"_lightID","lightID"),Rt(e,"_easing","easing"),Rt(e,"_lerpType","lerpType"),Rt(e,"_nameFilter","nameFilter"),Rt(e,"_rotation","rotation"),Rt(e,"_step","step"),Rt(e,"_prop","prop"),Rt(e,"_direction","direction"),Rt(e,"_lockPosition","lockRotation");const i=e._preciseSpeed??e._speed;return e.speed??(e.speed=i),delete e._speed,delete e._preciseSpeed,delete e._propID,delete e._lightGradient,delete e._reset,delete e._counterSpin,delete e._stepMult,delete e._propMult,delete e._speedMult,e}function De(t){return["convert",t]}function Jm(t){var i,n,a,o,l;if(t instanceof ho)return t;q.tWarn(De("toV3"),"Converting beatmap to v3 may lose certain data!");const e=new ho;if(e.fileName=t.fileName,t instanceof _d&&(e.colorNotes=t.colorNotes.map(s=>new ne(s)),e.obstacles=t.obstacles.map(s=>new At(s)),e.basicEvents=t.basicEvents.map(s=>new Ye(s)),e.customData.time=t.time,e.customData.BPMChanges=t.BPMChanges.map(s=>({b:s._time,m:s._bpm,p:s._beatsPerBar,o:s._metronomeOffset})),e.customData.bookmarks=t.bookmarks.map(s=>({b:s._time,n:s._name}))),t instanceof nu){if(e.customData.fakeBombNotes=[],e.customData.fakeColorNotes=[],e.customData.fakeObstacles=[],t.colorNotes.forEach((s,r)=>{const h=tl(s.customData);if(typeof s.customData._cutDirection=="number"&&q.tDebug(De("toV3"),`notes[${r}] at time ${s.time} NE _cutDirection will be converted.`),s.isBomb()&&(s.customData._fake?e.customData.fakeBombNotes.push(new Ue({b:s.time,x:s.posX,y:s.posY,customData:h}).toJSON()):e.bombNotes.push(new Ue({b:s.time,x:s.posX,y:s.posY,customData:h}))),s.isNote()){let f=0;typeof s.customData._cutDirection=="number"?f=s.customData._cutDirection>0?s.customData._cutDirection%360:360+s.customData._cutDirection%360:s.direction>=1e3&&(f=Math.abs(s.direction%1e3%360-360)),s.customData._fake?e.customData.fakeColorNotes.push(new ne({b:s.time,c:s.type,x:s.posX,y:s.posY,d:s.direction>=1e3||typeof s.customData._cutDirection=="number"?s.direction===8?8:1:lr(s.direction,0,8),a:f,customData:h}).toJSON()):e.colorNotes.push(new ne({b:s.time,c:s.type,x:s.posX,y:s.posY,d:s.direction>=1e3||typeof s.customData._cutDirection=="number"?s.direction===8?8:1:lr(s.direction,0,8),a:f,customData:h}))}}),t.obstacles.forEach(s=>{const r=tl(s.customData);s.customData._fake?e.customData.fakeObstacles.push(new At({b:s.time,x:s.posX,y:s.type?2:0,d:s.duration,w:s.width,h:s.type?3:5,customData:r}).toJSON()):e.obstacles.push(new At({b:s.time,x:s.posX,y:s.type?2:0,d:s.duration,w:s.width,h:s.type?3:5,customData:r}))}),t.basicEvents.forEach((s,r)=>{if(s.isColorBoost())e.colorBoostEvents.push(new pi({b:s.time,o:!!s.value}));else if(s.isLaneRotationEvent())e.rotationEvents.push(new gi({b:s.time,e:s.type===14?0:1,r:typeof s.customData._rotation=="number"?s.customData._rotation:s.value>=1e3?(s.value-1360)%360:vh[s.value]??0}));else if(s.isBpmEvent())e.bpmEvents.push(new mi({b:s.time,m:s.floatValue}));else{const h=jm(s.customData);s.isLightEvent()&&(s.customData._propID&&q.tWarn(De("toV3"),`events[${r}] at time ${s.time} Chroma _propID will be removed.`),s.customData._lightGradient&&q.tWarn(De("toV3"),`events[${r}] at time ${s.time} Chroma _lightGradient will be removed.`)),s.isRingEvent()&&(s.customData._reset&&q.tWarn(De("toV3"),`events[${r}] at time ${s.time} Chroma _reset will be removed.`),s.customData._counterSpin&&q.tWarn(De("toV3"),`events[${r}] at time ${s.time} Chroma _counterSpin will be removed.`),(s.customData._stepMult||s.customData._propMult||s.customData._speedMult)&&q.tWarn(De("toV3"),`events[${r}] at time ${s.time} Chroma _mult will be removed.`)),e.basicEvents.push(new Ye({b:s.time,et:s.type,i:s.value,f:s.floatValue,customData:h}))}}),t.waypoints.forEach(s=>{e.waypoints.push(new _i({b:s.time,x:s.posX,y:s.posY,d:s.direction}))}),t.arcs.forEach(s=>e.arcs.push(new di({c:s.color,b:s.time,x:s.posX,y:s.posY,d:s.direction,mu:s.lengthMultiplier,tb:s.tailTime,tx:s.tailPosX,ty:s.tailPosY,tc:s.tailDirection,tmu:s.tailLengthMultiplier,m:s.midAnchor}))),e.eventTypesWithKeywords=new bn({d:((n=(i=t.eventTypesWithKeywords)==null?void 0:i.list)==null?void 0:n.map(s=>({k:s.keyword,e:s.events})))??[]}),t.customData)for(const s in t.customData){if(s==="_customEvents"){e.customData.customEvents=[],t.customData._customEvents.forEach(r=>{var h,f,u,m,c;r._type==="AnimateTrack"&&((h=e.customData.customEvents)==null||h.push({b:r._time,t:"AnimateTrack",d:{track:r._data._track,duration:r._data._duration,easing:r._data._easing,position:r._data._position,rotation:r._data._rotation,localRotation:r._data._localRotation,scale:r._data._scale,dissolve:r._data._dissolve,dissolveArrow:r._data._dissolveArrow,color:r._data._color,interactable:r._data._interactable,time:r._data._time}})),r._type==="AssignPathAnimation"&&((f=e.customData.customEvents)==null||f.push({b:r._time,t:"AssignPathAnimation",d:{track:r._data._track,easing:r._data._easing,position:r._data._position,rotation:r._data._rotation,localRotation:r._data._localRotation,scale:r._data._scale,dissolve:r._data._dissolve,dissolveArrow:r._data._dissolveArrow,color:r._data._color,interactable:r._data._interactable,definitePosition:r._data._definitePosition}})),r._type==="AssignTrackParent"&&((u=e.customData.customEvents)==null||u.push({b:r._time,t:"AssignTrackParent",d:{childrenTracks:r._data._childrenTracks,parentTrack:r._data._parentTrack,worldPositionStays:r._data._worldPositionStays}})),r._type==="AssignPlayerToTrack"&&((m=e.customData.customEvents)==null||m.push({b:r._time,t:"AssignPlayerToTrack",d:{track:r._data._track,target:r._data._target}})),r._type==="AssignFogTrack"&&((c=e.customData.customEvents)==null||c.push({b:r._time,t:"AnimateComponent",d:{track:r._data._track,duration:r._data._duration||0,BloomFogEnvironment:{attenuation:typeof r._data._attenuation=="number"?[[r._data._attenuation,0]]:r._data._attenuation,height:typeof r._data._height=="number"?[[r._data._height,0]]:r._data._height,offset:typeof r._data._offset=="number"?[[r._data._offset,0]]:r._data._offset,startY:typeof r._data._startY=="number"?[[r._data._startY,0]]:r._data._startY}}}))});continue}if(s==="_environment"){e.customData.environment=t.customData._environment.map(r=>{let h={};if(r._lightID&&(h={ILightWithId:{lightID:r._lightID}}),r._id&&r._lookupMethod)return{id:r._id,lookupMethod:r._lookupMethod,track:r._track,duplicate:r._duplicate,active:r._active,scale:r._scale,position:sn(r._position,.6),rotation:r._rotation,localPosition:sn(r._localPosition,.6),localRotation:r._localRotation,components:h};if(r._geometry)return r._lightID&&h.ILightWithId&&(h.ILightWithId.type=0),{geometry:r._geometry._type==="CUSTOM"?{type:r._geometry._type,mesh:{vertices:r._geometry._mesh._vertices,uv:r._geometry._mesh._uv,triangles:r._geometry._mesh._triangles},material:typeof r._geometry._material=="string"?r._geometry._material:{shader:r._geometry._material._shader,shaderKeywords:r._geometry._material._shaderKeywords,collision:r._geometry._material._collision,track:r._geometry._material._track,color:r._geometry._material._color},collision:r._geometry._collision}:{type:r._geometry._type,material:typeof r._geometry._material=="string"?r._geometry._material:{shader:r._geometry._material._shader,shaderKeywords:r._geometry._material._shaderKeywords,collision:r._geometry._material._collision,track:r._geometry._material._track,color:r._geometry._material._color},collision:r._geometry._collision},track:r._track,duplicate:r._duplicate,active:r._active,scale:r._scale,position:sn(r._position,.6),rotation:r._rotation,localPosition:sn(r._localPosition,.6),localRotation:r._localRotation,components:h};throw new Error("Error converting environment v2 to v3")});continue}if(s==="_materials"){e.customData.materials={};for(const r in t.customData._materials)e.customData.materials[r]={shader:t.customData._materials[r]._shader,shaderKeywords:t.customData._materials[r]._shaderKeywords,collision:t.customData._materials[r]._collision,track:t.customData._materials[r]._track,color:t.customData._materials[r]._color};continue}if(s==="_pointDefinitions"){e.customData.pointDefinitions={},t.customData._pointDefinitions.forEach(r=>{e.customData.pointDefinitions[r._name]=r._points});continue}if(s==="_time"){e.customData.time=t.customData[s];continue}if(s==="_BPMChanges"){e.customData.BPMChanges=(a=t.customData[s])==null?void 0:a.map(r=>({b:r._time,m:r._BPM,p:r._beatsPerBar,o:r._metronomeOffset}));continue}if(s==="_bpmChanges"){e.customData.BPMChanges=(o=t.customData[s])==null?void 0:o.map(r=>({b:r._time,m:r._bpm,p:r._beatsPerBar,o:r._metronomeOffset}));continue}if(s==="_bookmarks"){e.customData.bookmarks=(l=t.customData._bookmarks)==null?void 0:l.map(r=>({b:r._time,n:r._name,c:r._color}));continue}e.customData[s]=t.customData[s]}if(e.customData.environment){const s=[];for(const h of e.customData.environment)h.track&&s.push(h.track);const r=[];if(e.customData.customEvents){for(const h of e.customData.customEvents)if(h.t==="AnimateTrack"){if(typeof h.d.track=="string"&&s.includes(h.d.track))r.push(h);else if(Array.isArray(h.d.track)){for(const f of h.d.track)if(s.includes(f)){r.push(h);break}}}}for(const h of r)typeof h.d.track=="string"?typeof h.d.position=="string"?q.tWarn(De("toV3"),"Cannot convert point definitions, unknown use."):Array.isArray(h.d.position)&&(re(h.d.position)?sn(h.d.position,.6):h.d.position.forEach(f=>{f[0]*=.6,f[1]*=.6,f[2]*=.6})):q.tWarn(De("toV3"),"Environment animate track array conversion not yet implemented.")}e.useNormalEventsAsCompatibleEvents=!0}return e}function pn(t){return["load",t]}async function qm(t){const e=t.file("Info.dat")||t.file("info.dat");if(!e)throw new Error("Couldn't find Info.dat");return q.tInfo(pn("loadInfo"),"loading info"),yd(JSON.parse(await e.async("string")))}async function Km(t,e){var a,o,l,s;const i=[],n=t._difficultyBeatmapSets;for(let r=n.length-1;r>=0;r--){const h=n[r]._difficultyBeatmaps;if(h.length===0||!h){q.tError(pn("loadDifficulty"),"Empty difficulty set, removing..."),n.splice(r,1);continue}for(let f=0;f<h.length;f++){const u=h[f],m=e.file(u._beatmapFilename);if(m){q.tInfo(pn("loadDifficulty"),`Loading ${n[r]._beatmapCharacteristicName} ${u._difficulty}`);let c;try{c=JSON.parse(await m.async("string"))}catch(p){throw new Error(`${n[r]._beatmapCharacteristicName} ${u._difficulty} ${p}`)}try{if(c._notes&&c.version&&q.tError(pn("loadDifficulty"),`${n[r]._beatmapCharacteristicName} ${u._difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`),c.version){const p=Kd(c),_=Re.create(t._beatsPerMinute,[...p.customData.BPMChanges??[],...p.bpmEvents.map(y=>y.toJSON())],(a=u._customData)==null?void 0:a._editorOffset);i.push({info:u,characteristic:n[r]._beatmapCharacteristicName,difficulty:u._difficulty,bpm:_,data:p,noteContainer:p.getNoteContainer(),eventContainer:p.getEventContainer(),swingAnalysis:Dr(p,_,n[r]._beatmapCharacteristicName,u._difficulty),rawVersion:3,rawData:c})}else{const p=Jm(Rd(c)),_=Re.create(t._beatsPerMinute,((o=c._customData)==null?void 0:o._BPMChanges)??((l=c._customData)==null?void 0:l._bpmChanges),(s=u._customData)==null?void 0:s._editorOffset);i.push({info:u,characteristic:n[r]._beatmapCharacteristicName,difficulty:u._difficulty,bpm:_,data:p,noteContainer:p.getNoteContainer(),eventContainer:p.getEventContainer(),swingAnalysis:Dr(p,_,n[r]._beatmapCharacteristicName,u._difficulty),rawVersion:2,rawData:c})}}catch(p){throw new Error(`${n[r]._beatmapCharacteristicName} ${u._difficulty} ${p}`)}}else if(q.tError(pn("loadDifficulty"),`Missing ${u._beatmapFilename} file for ${n[r]._beatmapCharacteristicName} ${u._difficulty}, ignoring.`),n[r]._difficultyBeatmaps.splice(f,1),f--,n[r]._difficultyBeatmaps.length<1){q.tError(["load"],`${n[r]._beatmapCharacteristicName} difficulty set now empty, ignoring.`),n.splice(r,1);continue}}}return i}async function Au(t){return new Promise(function(e,i){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="json",n.timeout=5e3;let a=Date.now();n.onprogress=()=>{n.timeout+=Date.now()-a},n.onload=()=>{n.status===200&&e(n.response),n.status===404&&i("Error 404: Map does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function Zm(t){const e=`https://api.beatsaver.com/maps/id/${t}`,i=await Au(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}async function Qm(t){const e=`https://api.beatsaver.com/maps/hash/${t}`,i=await Au(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}function Cn(t){return["download",t]}async function Zo(t){return new Promise(function(e,i){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.timeout=5e3;let a=Date.now();n.onprogress=o=>{n.timeout+=Date.now()-a,vt.status("download",`Downloading map: ${I(o.loaded/1024/1024,1)}MB / ${I(o.total/1024/1024,1)}MB`,o.loaded/o.total*100)},n.onload=()=>{n.status===200&&e(n.response),n.status===404&&i("Error 404: Map/link does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function Iu(t){const e=dl(t);q.tInfo(Cn("downloadFromID"),`fetching download URL from BeatSaver for map ID ${e}`),vt.status("info","Fetching download URL from BeatSaver",0);const i=await Zm(e);q.tInfo(Cn("downloadFromID"),`downloading from BeatSaver for map ID ${e}`),vt.status("info","Requesting download from BeatSaver",0);const n=await Zo(i);return Bt.setCoverLink("https://beatsaver.com/maps/"+e,e),n}async function tp(t){const e=fl(t);if(e.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return Iu(e.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);vt.status("info","Requesting download from link",0),q.tInfo(Cn("downloadFromURL"),`downloading from ${e}`);let i=await Zo("https://cors.bsmg.dev/"+e);return Bt.setCoverLink(e),i}async function ep(t){let e;if(vo(t.trim()))e=t.trim();else throw new Error("invalid hash");q.tInfo(Cn("downloadFromHash"),`fetching download URL from BeatSaver for map hash ${e}`),vt.status("info","Fetching download URL from BeatSaver",0);const i=await Qm(e);return q.tInfo(Cn("downloadFromHash"),`downloading from BeatSaver for map hash ${e}`),vt.status("info","Requesting download from BeatSaver",0),await Zo(i)}var Fn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hn(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fo={},ip={get exports(){return fo},set exports(t){fo=t}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(i){t.exports=i()})(function(){return function i(n,a,o){function l(h,f){if(!a[h]){if(!n[h]){var u=typeof Hn=="function"&&Hn;if(!f&&u)return u(h,!0);if(s)return s(h,!0);var m=new Error("Cannot find module '"+h+"'");throw m.code="MODULE_NOT_FOUND",m}var c=a[h]={exports:{}};n[h][0].call(c.exports,function(p){var _=n[h][1][p];return l(_||p)},c,c.exports,i,n,a,o)}return a[h].exports}for(var s=typeof Hn=="function"&&Hn,r=0;r<o.length;r++)l(o[r]);return l}({1:[function(i,n,a){var o=i("./utils"),l=i("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(r){for(var h,f,u,m,c,p,_,y=[],b=0,E=r.length,D=E,C=o.getTypeOf(r)!=="string";b<r.length;)D=E-b,u=C?(h=r[b++],f=b<E?r[b++]:0,b<E?r[b++]:0):(h=r.charCodeAt(b++),f=b<E?r.charCodeAt(b++):0,b<E?r.charCodeAt(b++):0),m=h>>2,c=(3&h)<<4|f>>4,p=1<D?(15&f)<<2|u>>6:64,_=2<D?63&u:64,y.push(s.charAt(m)+s.charAt(c)+s.charAt(p)+s.charAt(_));return y.join("")},a.decode=function(r){var h,f,u,m,c,p,_=0,y=0,b="data:";if(r.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var E,D=3*(r=r.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(r.charAt(r.length-1)===s.charAt(64)&&D--,r.charAt(r.length-2)===s.charAt(64)&&D--,D%1!=0)throw new Error("Invalid base64 input, bad content length.");for(E=l.uint8array?new Uint8Array(0|D):new Array(0|D);_<r.length;)h=s.indexOf(r.charAt(_++))<<2|(m=s.indexOf(r.charAt(_++)))>>4,f=(15&m)<<4|(c=s.indexOf(r.charAt(_++)))>>2,u=(3&c)<<6|(p=s.indexOf(r.charAt(_++))),E[y++]=h,c!==64&&(E[y++]=f),p!==64&&(E[y++]=u);return E}},{"./support":30,"./utils":32}],2:[function(i,n,a){var o=i("./external"),l=i("./stream/DataWorker"),s=i("./stream/Crc32Probe"),r=i("./stream/DataLengthProbe");function h(f,u,m,c,p){this.compressedSize=f,this.uncompressedSize=u,this.crc32=m,this.compression=c,this.compressedContent=p}h.prototype={getContentWorker:function(){var f=new l(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new r("data_length")),u=this;return f.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new l(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(f,u,m){return f.pipe(new s).pipe(new r("uncompressedSize")).pipe(u.compressWorker(m)).pipe(new r("compressedSize")).withStreamInfo("compression",u)},n.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,n,a){var o=i("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},a.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,n,a){var o=i("./utils"),l=function(){for(var s,r=[],h=0;h<256;h++){s=h;for(var f=0;f<8;f++)s=1&s?3988292384^s>>>1:s>>>1;r[h]=s}return r}();n.exports=function(s,r){return s!==void 0&&s.length?o.getTypeOf(s)!=="string"?function(h,f,u,m){var c=l,p=m+u;h^=-1;for(var _=m;_<p;_++)h=h>>>8^c[255&(h^f[_])];return-1^h}(0|r,s,s.length,0):function(h,f,u,m){var c=l,p=m+u;h^=-1;for(var _=m;_<p;_++)h=h>>>8^c[255&(h^f.charCodeAt(_))];return-1^h}(0|r,s,s.length,0):0}},{"./utils":32}],5:[function(i,n,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(i,n,a){var o=null;o=typeof Promise<"u"?Promise:i("lie"),n.exports={Promise:o}},{lie:37}],7:[function(i,n,a){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",l=i("pako"),s=i("./utils"),r=i("./stream/GenericWorker"),h=o?"uint8array":"array";function f(u,m){r.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=m,this.meta={}}a.magic="\b\0",s.inherits(f,r),f.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(h,u.data),!1)},f.prototype.flush=function(){r.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new l[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(m){u.push({data:m,meta:u.meta})}},a.compressWorker=function(u){return new f("Deflate",u)},a.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,n,a){function o(c,p){var _,y="";for(_=0;_<p;_++)y+=String.fromCharCode(255&c),c>>>=8;return y}function l(c,p,_,y,b,E){var D,C,R=c.file,F=c.compression,P=E!==h.utf8encode,k=s.transformTo("string",E(R.name)),$=s.transformTo("string",h.utf8encode(R.name)),U=R.comment,et=s.transformTo("string",E(U)),S=s.transformTo("string",h.utf8encode(U)),O=$.length!==R.name.length,g=S.length!==U.length,W="",rt="",G="",lt=R.dir,Y=R.date,st={crc32:0,compressedSize:0,uncompressedSize:0};p&&!_||(st.crc32=c.crc32,st.compressedSize=c.compressedSize,st.uncompressedSize=c.uncompressedSize);var N=0;p&&(N|=8),P||!O&&!g||(N|=2048);var B=0,nt=0;lt&&(B|=16),b==="UNIX"?(nt=798,B|=function(J,Dt){var xt=J;return J||(xt=Dt?16893:33204),(65535&xt)<<16}(R.unixPermissions,lt)):(nt=20,B|=function(J){return 63&(J||0)}(R.dosPermissions)),D=Y.getUTCHours(),D<<=6,D|=Y.getUTCMinutes(),D<<=5,D|=Y.getUTCSeconds()/2,C=Y.getUTCFullYear()-1980,C<<=4,C|=Y.getUTCMonth()+1,C<<=5,C|=Y.getUTCDate(),O&&(rt=o(1,1)+o(f(k),4)+$,W+="up"+o(rt.length,2)+rt),g&&(G=o(1,1)+o(f(et),4)+S,W+="uc"+o(G.length,2)+G);var K="";return K+=`
\0`,K+=o(N,2),K+=F.magic,K+=o(D,2),K+=o(C,2),K+=o(st.crc32,4),K+=o(st.compressedSize,4),K+=o(st.uncompressedSize,4),K+=o(k.length,2),K+=o(W.length,2),{fileRecord:u.LOCAL_FILE_HEADER+K+k+W,dirRecord:u.CENTRAL_FILE_HEADER+o(nt,2)+K+o(et.length,2)+"\0\0\0\0"+o(B,4)+o(y,4)+k+W+et}}var s=i("../utils"),r=i("../stream/GenericWorker"),h=i("../utf8"),f=i("../crc32"),u=i("../signature");function m(c,p,_,y){r.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=_,this.encodeFileName=y,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(m,r),m.prototype.push=function(c){var p=c.meta.percent||0,_=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,r.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:_?(p+100*(_-y-1))/_:100}}))},m.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var p=this.streamFiles&&!c.file.dir;if(p){var _=l(c,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(c){this.accumulate=!1;var p=this.streamFiles&&!c.file.dir,_=l(c,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),p)this.push({data:function(y){return u.DATA_DESCRIPTOR+o(y.crc32,4)+o(y.compressedSize,4)+o(y.uncompressedSize,4)}(c),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var c=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var _=this.bytesWritten-c,y=function(b,E,D,C,R){var F=s.transformTo("string",R(C));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+o(b,2)+o(b,2)+o(E,4)+o(D,4)+o(F.length,2)+F}(this.dirRecords.length,_,c,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(c){this._sources.push(c);var p=this;return c.on("data",function(_){p.processChunk(_)}),c.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),c.on("error",function(_){p.error(_)}),this},m.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(c){var p=this._sources;if(!r.prototype.error.call(this,c))return!1;for(var _=0;_<p.length;_++)try{p[_].error(c)}catch{}return!0},m.prototype.lock=function(){r.prototype.lock.call(this);for(var c=this._sources,p=0;p<c.length;p++)c[p].lock()},n.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,n,a){var o=i("../compressions"),l=i("./ZipFileWorker");a.generateWorker=function(s,r,h){var f=new l(r.streamFiles,h,r.platform,r.encodeFileName),u=0;try{s.forEach(function(m,c){u++;var p=function(E,D){var C=E||D,R=o[C];if(!R)throw new Error(C+" is not a valid compression method !");return R}(c.options.compression,r.compression),_=c.options.compressionOptions||r.compressionOptions||{},y=c.dir,b=c.date;c._compressWorker(p,_).withStreamInfo("file",{name:m,dir:y,date:b,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(f)}),f.entriesCount=u}catch(m){f.error(m)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,n,a){function o(){if(!(this instanceof o))return new o;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var l=new o;for(var s in this)typeof this[s]!="function"&&(l[s]=this[s]);return l}}(o.prototype=i("./object")).loadAsync=i("./load"),o.support=i("./support"),o.defaults=i("./defaults"),o.version="3.10.1",o.loadAsync=function(l,s){return new o().loadAsync(l,s)},o.external=i("./external"),n.exports=o},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,n,a){var o=i("./utils"),l=i("./external"),s=i("./utf8"),r=i("./zipEntries"),h=i("./stream/Crc32Probe"),f=i("./nodejsUtils");function u(m){return new l.Promise(function(c,p){var _=m.decompressed.getContentWorker().pipe(new h);_.on("error",function(y){p(y)}).on("end",function(){_.streamInfo.crc32!==m.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}n.exports=function(m,c){var p=this;return c=o.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),f.isNode&&f.isStream(m)?l.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",m,!0,c.optimizedBinaryString,c.base64).then(function(_){var y=new r(c);return y.load(_),y}).then(function(_){var y=[l.Promise.resolve(_)],b=_.files;if(c.checkCRC32)for(var E=0;E<b.length;E++)y.push(u(b[E]));return l.Promise.all(y)}).then(function(_){for(var y=_.shift(),b=y.files,E=0;E<b.length;E++){var D=b[E],C=D.fileNameStr,R=o.resolve(D.fileNameStr);p.file(R,D.decompressed,{binary:!0,optimizedBinaryString:!0,date:D.date,dir:D.dir,comment:D.fileCommentStr.length?D.fileCommentStr:null,unixPermissions:D.unixPermissions,dosPermissions:D.dosPermissions,createFolders:c.createFolders}),D.dir||(p.file(R).unsafeOriginalName=C)}return y.zipComment.length&&(p.comment=y.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,n,a){var o=i("../utils"),l=i("../stream/GenericWorker");function s(r,h){l.call(this,"Nodejs stream input adapter for "+r),this._upstreamEnded=!1,this._bindStream(h)}o.inherits(s,l),s.prototype._bindStream=function(r){var h=this;(this._stream=r).pause(),r.on("data",function(f){h.push({data:f,meta:{percent:0}})}).on("error",function(f){h.isPaused?this.generatedError=f:h.error(f)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},s.prototype.pause=function(){return!!l.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,n,a){var o=i("readable-stream").Readable;function l(s,r,h){o.call(this,r),this._helper=s;var f=this;s.on("data",function(u,m){f.push(u)||f._helper.pause(),h&&h(m)}).on("error",function(u){f.emit("error",u)}).on("end",function(){f.push(null)})}i("../utils").inherits(l,o),l.prototype._read=function(){this._helper.resume()},n.exports=l},{"../utils":32,"readable-stream":16}],14:[function(i,n,a){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(o,l){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(o,l);if(typeof o=="number")throw new Error('The "data" argument must not be a number');return new Buffer(o,l)},allocBuffer:function(o){if(Buffer.alloc)return Buffer.alloc(o);var l=new Buffer(o);return l.fill(0),l},isBuffer:function(o){return Buffer.isBuffer(o)},isStream:function(o){return o&&typeof o.on=="function"&&typeof o.pause=="function"&&typeof o.resume=="function"}}},{}],15:[function(i,n,a){function o(R,F,P){var k,$=s.getTypeOf(F),U=s.extend(P||{},f);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(R=b(R)),U.createFolders&&(k=y(R))&&E.call(this,k,!0);var et=$==="string"&&U.binary===!1&&U.base64===!1;P&&P.binary!==void 0||(U.binary=!et),(F instanceof u&&F.uncompressedSize===0||U.dir||!F||F.length===0)&&(U.base64=!1,U.binary=!0,F="",U.compression="STORE",$="string");var S=null;S=F instanceof u||F instanceof r?F:p.isNode&&p.isStream(F)?new _(R,F):s.prepareContent(R,F,U.binary,U.optimizedBinaryString,U.base64);var O=new m(R,S,U);this.files[R]=O}var l=i("./utf8"),s=i("./utils"),r=i("./stream/GenericWorker"),h=i("./stream/StreamHelper"),f=i("./defaults"),u=i("./compressedObject"),m=i("./zipObject"),c=i("./generate"),p=i("./nodejsUtils"),_=i("./nodejs/NodejsStreamInputAdapter"),y=function(R){R.slice(-1)==="/"&&(R=R.substring(0,R.length-1));var F=R.lastIndexOf("/");return 0<F?R.substring(0,F):""},b=function(R){return R.slice(-1)!=="/"&&(R+="/"),R},E=function(R,F){return F=F!==void 0?F:f.createFolders,R=b(R),this.files[R]||o.call(this,R,null,{dir:!0,createFolders:F}),this.files[R]};function D(R){return Object.prototype.toString.call(R)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(R){var F,P,k;for(F in this.files)k=this.files[F],(P=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&R(P,k)},filter:function(R){var F=[];return this.forEach(function(P,k){R(P,k)&&F.push(k)}),F},file:function(R,F,P){if(arguments.length!==1)return R=this.root+R,o.call(this,R,F,P),this;if(D(R)){var k=R;return this.filter(function(U,et){return!et.dir&&k.test(U)})}var $=this.files[this.root+R];return $&&!$.dir?$:null},folder:function(R){if(!R)return this;if(D(R))return this.filter(function($,U){return U.dir&&R.test($)});var F=this.root+R,P=E.call(this,F),k=this.clone();return k.root=P.name,k},remove:function(R){R=this.root+R;var F=this.files[R];if(F||(R.slice(-1)!=="/"&&(R+="/"),F=this.files[R]),F&&!F.dir)delete this.files[R];else for(var P=this.filter(function($,U){return U.name.slice(0,R.length)===R}),k=0;k<P.length;k++)delete this.files[P[k].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(R){var F,P={};try{if((P=s.extend(R||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:l.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");s.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var k=P.comment||this.comment||"";F=c.generateWorker(this,P,k)}catch($){(F=new r("error")).error($)}return new h(F,P.type||"string",P.mimeType)},generateAsync:function(R,F){return this.generateInternalStream(R).accumulate(F)},generateNodeStream:function(R,F){return(R=R||{}).type||(R.type="nodebuffer"),this.generateInternalStream(R).toNodejsStream(F)}};n.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,n,a){n.exports=i("stream")},{stream:void 0}],17:[function(i,n,a){var o=i("./DataReader");function l(s){o.call(this,s);for(var r=0;r<this.data.length;r++)s[r]=255&s[r]}i("../utils").inherits(l,o),l.prototype.byteAt=function(s){return this.data[this.zero+s]},l.prototype.lastIndexOfSignature=function(s){for(var r=s.charCodeAt(0),h=s.charCodeAt(1),f=s.charCodeAt(2),u=s.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===r&&this.data[m+1]===h&&this.data[m+2]===f&&this.data[m+3]===u)return m-this.zero;return-1},l.prototype.readAndCheckSignature=function(s){var r=s.charCodeAt(0),h=s.charCodeAt(1),f=s.charCodeAt(2),u=s.charCodeAt(3),m=this.readData(4);return r===m[0]&&h===m[1]&&f===m[2]&&u===m[3]},l.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var r=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,r},n.exports=l},{"../utils":32,"./DataReader":18}],18:[function(i,n,a){var o=i("../utils");function l(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}l.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var r,h=0;for(this.checkOffset(s),r=this.index+s-1;r>=this.index;r--)h=(h<<8)+this.byteAt(r);return this.index+=s,h},readString:function(s){return o.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},n.exports=l},{"../utils":32}],19:[function(i,n,a){var o=i("./Uint8ArrayReader");function l(s){o.call(this,s)}i("../utils").inherits(l,o),l.prototype.readData=function(s){this.checkOffset(s);var r=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,r},n.exports=l},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,n,a){var o=i("./DataReader");function l(s){o.call(this,s)}i("../utils").inherits(l,o),l.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},l.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},l.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},l.prototype.readData=function(s){this.checkOffset(s);var r=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,r},n.exports=l},{"../utils":32,"./DataReader":18}],21:[function(i,n,a){var o=i("./ArrayReader");function l(s){o.call(this,s)}i("../utils").inherits(l,o),l.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var r=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,r},n.exports=l},{"../utils":32,"./ArrayReader":17}],22:[function(i,n,a){var o=i("../utils"),l=i("../support"),s=i("./ArrayReader"),r=i("./StringReader"),h=i("./NodeBufferReader"),f=i("./Uint8ArrayReader");n.exports=function(u){var m=o.getTypeOf(u);return o.checkSupport(m),m!=="string"||l.uint8array?m==="nodebuffer"?new h(u):l.uint8array?new f(o.transformTo("uint8array",u)):new s(o.transformTo("array",u)):new r(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,n,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,n,a){var o=i("./GenericWorker"),l=i("../utils");function s(r){o.call(this,"ConvertWorker to "+r),this.destType=r}l.inherits(s,o),s.prototype.processChunk=function(r){this.push({data:l.transformTo(this.destType,r.data),meta:r.meta})},n.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(i,n,a){var o=i("./GenericWorker"),l=i("../crc32");function s(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}i("../utils").inherits(s,o),s.prototype.processChunk=function(r){this.streamInfo.crc32=l(r.data,this.streamInfo.crc32||0),this.push(r)},n.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,n,a){var o=i("../utils"),l=i("./GenericWorker");function s(r){l.call(this,"DataLengthProbe for "+r),this.propName=r,this.withStreamInfo(r,0)}o.inherits(s,l),s.prototype.processChunk=function(r){if(r){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+r.data.length}l.prototype.processChunk.call(this,r)},n.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(i,n,a){var o=i("../utils"),l=i("./GenericWorker");function s(r){l.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,r.then(function(f){h.dataIsReady=!0,h.data=f,h.max=f&&f.length||0,h.type=o.getTypeOf(f),h.isPaused||h._tickAndRepeat()},function(f){h.error(f)})}o.inherits(s,l),s.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var r=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":r=this.data.substring(this.index,h);break;case"uint8array":r=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":r=this.data.slice(this.index,h)}return this.index=h,this.push({data:r,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(i,n,a){function o(l){this.name=l||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}o.prototype={push:function(l){this.emit("data",l)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(l){this.emit("error",l)}return!0},error:function(l){return!this.isFinished&&(this.isPaused?this.generatedError=l:(this.isFinished=!0,this.emit("error",l),this.previous&&this.previous.error(l),this.cleanUp()),!0)},on:function(l,s){return this._listeners[l].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(l,s){if(this._listeners[l])for(var r=0;r<this._listeners[l].length;r++)this._listeners[l][r].call(this,s)},pipe:function(l){return l.registerPrevious(this)},registerPrevious:function(l){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=l.streamInfo,this.mergeStreamInfo(),this.previous=l;var s=this;return l.on("data",function(r){s.processChunk(r)}),l.on("end",function(){s.end()}),l.on("error",function(r){s.error(r)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var l=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),l=!0),this.previous&&this.previous.resume(),!l},flush:function(){},processChunk:function(l){this.push(l)},withStreamInfo:function(l,s){return this.extraStreamInfo[l]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var l in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,l)&&(this.streamInfo[l]=this.extraStreamInfo[l])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var l="Worker "+this.name;return this.previous?this.previous+" -> "+l:l}},n.exports=o},{}],29:[function(i,n,a){var o=i("../utils"),l=i("./ConvertWorker"),s=i("./GenericWorker"),r=i("../base64"),h=i("../support"),f=i("../external"),u=null;if(h.nodestream)try{u=i("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(p,_){return new f.Promise(function(y,b){var E=[],D=p._internalType,C=p._outputType,R=p._mimeType;p.on("data",function(F,P){E.push(F),_&&_(P)}).on("error",function(F){E=[],b(F)}).on("end",function(){try{var F=function(P,k,$){switch(P){case"blob":return o.newBlob(o.transformTo("arraybuffer",k),$);case"base64":return r.encode(k);default:return o.transformTo(P,k)}}(C,function(P,k){var $,U=0,et=null,S=0;for($=0;$<k.length;$++)S+=k[$].length;switch(P){case"string":return k.join("");case"array":return Array.prototype.concat.apply([],k);case"uint8array":for(et=new Uint8Array(S),$=0;$<k.length;$++)et.set(k[$],U),U+=k[$].length;return et;case"nodebuffer":return Buffer.concat(k);default:throw new Error("concat : unsupported type '"+P+"'")}}(D,E),R);y(F)}catch(P){b(P)}E=[]}).resume()})}function c(p,_,y){var b=_;switch(_){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=_,this._mimeType=y,o.checkSupport(b),this._worker=p.pipe(new l(b)),p.lock()}catch(E){this._worker=new s("error"),this._worker.error(E)}}c.prototype={accumulate:function(p){return m(this,p)},on:function(p,_){var y=this;return p==="data"?this._worker.on(p,function(b){_.call(y,b.data,b.meta)}):this._worker.on(p,function(){o.delay(_,arguments,y)}),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(o.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},p)}},n.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,n,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var o=new ArrayBuffer(0);try{a.blob=new Blob([o],{type:"application/zip"}).size===0}catch{try{var l=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);l.append(o),a.blob=l.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!i("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(i,n,a){for(var o=i("./utils"),l=i("./support"),s=i("./nodejsUtils"),r=i("./stream/GenericWorker"),h=new Array(256),f=0;f<256;f++)h[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;h[254]=h[254]=1;function u(){r.call(this,"utf-8 decode"),this.leftOver=null}function m(){r.call(this,"utf-8 encode")}a.utf8encode=function(c){return l.nodebuffer?s.newBufferFrom(c,"utf-8"):function(p){var _,y,b,E,D,C=p.length,R=0;for(E=0;E<C;E++)(64512&(y=p.charCodeAt(E)))==55296&&E+1<C&&(64512&(b=p.charCodeAt(E+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),E++),R+=y<128?1:y<2048?2:y<65536?3:4;for(_=l.uint8array?new Uint8Array(R):new Array(R),E=D=0;D<R;E++)(64512&(y=p.charCodeAt(E)))==55296&&E+1<C&&(64512&(b=p.charCodeAt(E+1)))==56320&&(y=65536+(y-55296<<10)+(b-56320),E++),y<128?_[D++]=y:(y<2048?_[D++]=192|y>>>6:(y<65536?_[D++]=224|y>>>12:(_[D++]=240|y>>>18,_[D++]=128|y>>>12&63),_[D++]=128|y>>>6&63),_[D++]=128|63&y);return _}(c)},a.utf8decode=function(c){return l.nodebuffer?o.transformTo("nodebuffer",c).toString("utf-8"):function(p){var _,y,b,E,D=p.length,C=new Array(2*D);for(_=y=0;_<D;)if((b=p[_++])<128)C[y++]=b;else if(4<(E=h[b]))C[y++]=65533,_+=E-1;else{for(b&=E===2?31:E===3?15:7;1<E&&_<D;)b=b<<6|63&p[_++],E--;1<E?C[y++]=65533:b<65536?C[y++]=b:(b-=65536,C[y++]=55296|b>>10&1023,C[y++]=56320|1023&b)}return C.length!==y&&(C.subarray?C=C.subarray(0,y):C.length=y),o.applyFromCharCode(C)}(c=o.transformTo(l.uint8array?"uint8array":"array",c))},o.inherits(u,r),u.prototype.processChunk=function(c){var p=o.transformTo(l.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(l.uint8array){var _=p;(p=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),p.set(_,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var y=function(E,D){var C;for((D=D||E.length)>E.length&&(D=E.length),C=D-1;0<=C&&(192&E[C])==128;)C--;return C<0||C===0?D:C+h[E[C]]>D?C:D}(p),b=p;y!==p.length&&(l.uint8array?(b=p.subarray(0,y),this.leftOver=p.subarray(y,p.length)):(b=p.slice(0,y),this.leftOver=p.slice(y,p.length))),this.push({data:a.utf8decode(b),meta:c.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=u,o.inherits(m,r),m.prototype.processChunk=function(c){this.push({data:a.utf8encode(c.data),meta:c.meta})},a.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,n,a){var o=i("./support"),l=i("./base64"),s=i("./nodejsUtils"),r=i("./external");function h(_){return _}function f(_,y){for(var b=0;b<_.length;++b)y[b]=255&_.charCodeAt(b);return y}i("setimmediate"),a.newBlob=function(_,y){a.checkSupport("blob");try{return new Blob([_],{type:y})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(_),b.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(_,y,b){var E=[],D=0,C=_.length;if(C<=b)return String.fromCharCode.apply(null,_);for(;D<C;)y==="array"||y==="nodebuffer"?E.push(String.fromCharCode.apply(null,_.slice(D,Math.min(D+b,C)))):E.push(String.fromCharCode.apply(null,_.subarray(D,Math.min(D+b,C)))),D+=b;return E.join("")},stringifyByChar:function(_){for(var y="",b=0;b<_.length;b++)y+=String.fromCharCode(_[b]);return y},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function m(_){var y=65536,b=a.getTypeOf(_),E=!0;if(b==="uint8array"?E=u.applyCanBeUsed.uint8array:b==="nodebuffer"&&(E=u.applyCanBeUsed.nodebuffer),E)for(;1<y;)try{return u.stringifyByChunk(_,b,y)}catch{y=Math.floor(y/2)}return u.stringifyByChar(_)}function c(_,y){for(var b=0;b<_.length;b++)y[b]=_[b];return y}a.applyFromCharCode=m;var p={};p.string={string:h,array:function(_){return f(_,new Array(_.length))},arraybuffer:function(_){return p.string.uint8array(_).buffer},uint8array:function(_){return f(_,new Uint8Array(_.length))},nodebuffer:function(_){return f(_,s.allocBuffer(_.length))}},p.array={string:m,array:h,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return s.newBufferFrom(_)}},p.arraybuffer={string:function(_){return m(new Uint8Array(_))},array:function(_){return c(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:h,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return s.newBufferFrom(new Uint8Array(_))}},p.uint8array={string:m,array:function(_){return c(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:h,nodebuffer:function(_){return s.newBufferFrom(_)}},p.nodebuffer={string:m,array:function(_){return c(_,new Array(_.length))},arraybuffer:function(_){return p.nodebuffer.uint8array(_).buffer},uint8array:function(_){return c(_,new Uint8Array(_.length))},nodebuffer:h},a.transformTo=function(_,y){if(y=y||"",!_)return y;a.checkSupport(_);var b=a.getTypeOf(y);return p[b][_](y)},a.resolve=function(_){for(var y=_.split("/"),b=[],E=0;E<y.length;E++){var D=y[E];D==="."||D===""&&E!==0&&E!==y.length-1||(D===".."?b.pop():b.push(D))}return b.join("/")},a.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":o.nodebuffer&&s.isBuffer(_)?"nodebuffer":o.uint8array&&_ instanceof Uint8Array?"uint8array":o.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(_){if(!o[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(_){var y,b,E="";for(b=0;b<(_||"").length;b++)E+="\\x"+((y=_.charCodeAt(b))<16?"0":"")+y.toString(16).toUpperCase();return E},a.delay=function(_,y,b){setImmediate(function(){_.apply(b||null,y||[])})},a.inherits=function(_,y){function b(){}b.prototype=y.prototype,_.prototype=new b},a.extend=function(){var _,y,b={};for(_=0;_<arguments.length;_++)for(y in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],y)&&b[y]===void 0&&(b[y]=arguments[_][y]);return b},a.prepareContent=function(_,y,b,E,D){return r.Promise.resolve(y).then(function(C){return o.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new r.Promise(function(R,F){var P=new FileReader;P.onload=function(k){R(k.target.result)},P.onerror=function(k){F(k.target.error)},P.readAsArrayBuffer(C)}):C}).then(function(C){var R=a.getTypeOf(C);return R?(R==="arraybuffer"?C=a.transformTo("uint8array",C):R==="string"&&(D?C=l.decode(C):b&&E!==!0&&(C=function(F){return f(F,o.uint8array?new Uint8Array(F.length):new Array(F.length))}(C))),C):r.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,n,a){var o=i("./reader/readerFor"),l=i("./utils"),s=i("./signature"),r=i("./zipEntry"),h=i("./support");function f(u){this.files=[],this.loadOptions=u}f.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+l.pretty(m)+", expected "+l.pretty(u)+")")}},isSignature:function(u,m){var c=this.reader.index;this.reader.setIndex(u);var p=this.reader.readString(4)===m;return this.reader.setIndex(c),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),m=h.uint8array?"uint8array":"array",c=l.transformTo(m,u);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,m,c,p=this.zip64EndOfCentralSize-44;0<p;)u=this.reader.readInt(2),m=this.reader.readInt(4),c=this.reader.readData(m),this.zip64ExtensibleData[u]={id:u,length:m,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,m;for(u=0;u<this.files.length;u++)m=this.files[u],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(u=new r({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var m=u;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===l.MAX_VALUE_16BITS||this.diskWithCentralDirStart===l.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===l.MAX_VALUE_16BITS||this.centralDirRecords===l.MAX_VALUE_16BITS||this.centralDirSize===l.MAX_VALUE_32BITS||this.centralDirOffset===l.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var p=m-c;if(0<p)this.isSignature(m,s.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(u){this.reader=o(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(i,n,a){var o=i("./reader/readerFor"),l=i("./utils"),s=i("./compressedObject"),r=i("./crc32"),h=i("./utf8"),f=i("./compressions"),u=i("./support");function m(c,p){this.options=c,this.loadOptions=p}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var p,_;if(c.skip(22),this.fileNameLength=c.readInt(2),_=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(y){for(var b in f)if(Object.prototype.hasOwnProperty.call(f,b)&&f[b].magic===y)return f[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+l.pretty(this.compressionMethod)+" unknown (inner file : "+l.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,p,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var p=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(p),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=o(this.extraFields[1].value);this.uncompressedSize===l.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===l.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===l.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===l.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var p,_,y,b=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<b;)p=c.readInt(2),_=c.readInt(2),y=c.readData(_),this.extraFields[p]={id:p,length:_,value:y};c.setIndex(b)},handleUTF8:function(){var c=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var _=l.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var b=l.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var p=o(c.value);return p.readInt(1)!==1||r(this.fileName)!==p.readInt(4)?null:h.utf8decode(p.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var p=o(c.value);return p.readInt(1)!==1||r(this.fileComment)!==p.readInt(4)?null:h.utf8decode(p.readData(c.length-5))}return null}},n.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,n,a){function o(p,_,y){this.name=p,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=_,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var l=i("./stream/StreamHelper"),s=i("./stream/DataWorker"),r=i("./utf8"),h=i("./compressedObject"),f=i("./stream/GenericWorker");o.prototype={internalStream:function(p){var _=null,y="string";try{if(!p)throw new Error("No output type specified.");var b=(y=p.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),_=this._decompressWorker();var E=!this._dataBinary;E&&!b&&(_=_.pipe(new r.Utf8EncodeWorker)),!E&&b&&(_=_.pipe(new r.Utf8DecodeWorker))}catch(D){(_=new f("error")).error(D)}return new l(_,y,"")},async:function(p,_){return this.internalStream(p).accumulate(_)},nodeStream:function(p,_){return this.internalStream(p||"nodebuffer").toNodejsStream(_)},_compressWorker:function(p,_){if(this._data instanceof h&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new r.Utf8EncodeWorker)),h.createWorkerFrom(y,p,_)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof f?this._data:new s(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<u.length;c++)o.prototype[u[c]]=m;n.exports=o},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,n,a){(function(o){var l,s,r=o.MutationObserver||o.WebKitMutationObserver;if(r){var h=0,f=new r(p),u=o.document.createTextNode("");f.observe(u,{characterData:!0}),l=function(){u.data=h=++h%2}}else if(o.setImmediate||o.MessageChannel===void 0)l="document"in o&&"onreadystatechange"in o.document.createElement("script")?function(){var _=o.document.createElement("script");_.onreadystatechange=function(){p(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},o.document.documentElement.appendChild(_)}:function(){setTimeout(p,0)};else{var m=new o.MessageChannel;m.port1.onmessage=p,l=function(){m.port2.postMessage(0)}}var c=[];function p(){var _,y;s=!0;for(var b=c.length;b;){for(y=c,c=[],_=-1;++_<b;)y[_]();b=c.length}s=!1}n.exports=function(_){c.push(_)!==1||s||l()}}).call(this,typeof Fn<"u"?Fn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(i,n,a){var o=i("immediate");function l(){}var s={},r=["REJECTED"],h=["FULFILLED"],f=["PENDING"];function u(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,b!==l&&_(this,b)}function m(b,E,D){this.promise=b,typeof E=="function"&&(this.onFulfilled=E,this.callFulfilled=this.otherCallFulfilled),typeof D=="function"&&(this.onRejected=D,this.callRejected=this.otherCallRejected)}function c(b,E,D){o(function(){var C;try{C=E(D)}catch(R){return s.reject(b,R)}C===b?s.reject(b,new TypeError("Cannot resolve promise with itself")):s.resolve(b,C)})}function p(b){var E=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof E=="function")return function(){E.apply(b,arguments)}}function _(b,E){var D=!1;function C(P){D||(D=!0,s.reject(b,P))}function R(P){D||(D=!0,s.resolve(b,P))}var F=y(function(){E(R,C)});F.status==="error"&&C(F.value)}function y(b,E){var D={};try{D.value=b(E),D.status="success"}catch(C){D.status="error",D.value=C}return D}(n.exports=u).prototype.finally=function(b){if(typeof b!="function")return this;var E=this.constructor;return this.then(function(D){return E.resolve(b()).then(function(){return D})},function(D){return E.resolve(b()).then(function(){throw D})})},u.prototype.catch=function(b){return this.then(null,b)},u.prototype.then=function(b,E){if(typeof b!="function"&&this.state===h||typeof E!="function"&&this.state===r)return this;var D=new this.constructor(l);return this.state!==f?c(D,this.state===h?b:E,this.outcome):this.queue.push(new m(D,b,E)),D},m.prototype.callFulfilled=function(b){s.resolve(this.promise,b)},m.prototype.otherCallFulfilled=function(b){c(this.promise,this.onFulfilled,b)},m.prototype.callRejected=function(b){s.reject(this.promise,b)},m.prototype.otherCallRejected=function(b){c(this.promise,this.onRejected,b)},s.resolve=function(b,E){var D=y(p,E);if(D.status==="error")return s.reject(b,D.value);var C=D.value;if(C)_(b,C);else{b.state=h,b.outcome=E;for(var R=-1,F=b.queue.length;++R<F;)b.queue[R].callFulfilled(E)}return b},s.reject=function(b,E){b.state=r,b.outcome=E;for(var D=-1,C=b.queue.length;++D<C;)b.queue[D].callRejected(E);return b},u.resolve=function(b){return b instanceof this?b:s.resolve(new this(l),b)},u.reject=function(b){var E=new this(l);return s.reject(E,b)},u.all=function(b){var E=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=b.length,C=!1;if(!D)return this.resolve([]);for(var R=new Array(D),F=0,P=-1,k=new this(l);++P<D;)$(b[P],P);return k;function $(U,et){E.resolve(U).then(function(S){R[et]=S,++F!==D||C||(C=!0,s.resolve(k,R))},function(S){C||(C=!0,s.reject(k,S))})}},u.race=function(b){var E=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=b.length,C=!1;if(!D)return this.resolve([]);for(var R=-1,F=new this(l);++R<D;)P=b[R],E.resolve(P).then(function(k){C||(C=!0,s.resolve(F,k))},function(k){C||(C=!0,s.reject(F,k))});var P;return F}},{immediate:36}],38:[function(i,n,a){var o={};(0,i("./lib/utils/common").assign)(o,i("./lib/deflate"),i("./lib/inflate"),i("./lib/zlib/constants")),n.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,n,a){var o=i("./zlib/deflate"),l=i("./utils/common"),s=i("./utils/strings"),r=i("./zlib/messages"),h=i("./zlib/zstream"),f=Object.prototype.toString,u=0,m=-1,c=0,p=8;function _(b){if(!(this instanceof _))return new _(b);this.options=l.assign({level:m,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},b||{});var E=this.options;E.raw&&0<E.windowBits?E.windowBits=-E.windowBits:E.gzip&&0<E.windowBits&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var D=o.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(D!==u)throw new Error(r[D]);if(E.header&&o.deflateSetHeader(this.strm,E.header),E.dictionary){var C;if(C=typeof E.dictionary=="string"?s.string2buf(E.dictionary):f.call(E.dictionary)==="[object ArrayBuffer]"?new Uint8Array(E.dictionary):E.dictionary,(D=o.deflateSetDictionary(this.strm,C))!==u)throw new Error(r[D]);this._dict_set=!0}}function y(b,E){var D=new _(E);if(D.push(b,!0),D.err)throw D.msg||r[D.err];return D.result}_.prototype.push=function(b,E){var D,C,R=this.strm,F=this.options.chunkSize;if(this.ended)return!1;C=E===~~E?E:E===!0?4:0,typeof b=="string"?R.input=s.string2buf(b):f.call(b)==="[object ArrayBuffer]"?R.input=new Uint8Array(b):R.input=b,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new l.Buf8(F),R.next_out=0,R.avail_out=F),(D=o.deflate(R,C))!==1&&D!==u)return this.onEnd(D),!(this.ended=!0);R.avail_out!==0&&(R.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(l.shrinkBuf(R.output,R.next_out))):this.onData(l.shrinkBuf(R.output,R.next_out)))}while((0<R.avail_in||R.avail_out===0)&&D!==1);return C===4?(D=o.deflateEnd(this.strm),this.onEnd(D),this.ended=!0,D===u):C!==2||(this.onEnd(u),!(R.avail_out=0))},_.prototype.onData=function(b){this.chunks.push(b)},_.prototype.onEnd=function(b){b===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},a.Deflate=_,a.deflate=y,a.deflateRaw=function(b,E){return(E=E||{}).raw=!0,y(b,E)},a.gzip=function(b,E){return(E=E||{}).gzip=!0,y(b,E)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,n,a){var o=i("./zlib/inflate"),l=i("./utils/common"),s=i("./utils/strings"),r=i("./zlib/constants"),h=i("./zlib/messages"),f=i("./zlib/zstream"),u=i("./zlib/gzheader"),m=Object.prototype.toString;function c(_){if(!(this instanceof c))return new c(_);this.options=l.assign({chunkSize:16384,windowBits:0,to:""},_||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||_&&_.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&!(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var b=o.inflateInit2(this.strm,y.windowBits);if(b!==r.Z_OK)throw new Error(h[b]);this.header=new u,o.inflateGetHeader(this.strm,this.header)}function p(_,y){var b=new c(y);if(b.push(_,!0),b.err)throw b.msg||h[b.err];return b.result}c.prototype.push=function(_,y){var b,E,D,C,R,F,P=this.strm,k=this.options.chunkSize,$=this.options.dictionary,U=!1;if(this.ended)return!1;E=y===~~y?y:y===!0?r.Z_FINISH:r.Z_NO_FLUSH,typeof _=="string"?P.input=s.binstring2buf(_):m.call(_)==="[object ArrayBuffer]"?P.input=new Uint8Array(_):P.input=_,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new l.Buf8(k),P.next_out=0,P.avail_out=k),(b=o.inflate(P,r.Z_NO_FLUSH))===r.Z_NEED_DICT&&$&&(F=typeof $=="string"?s.string2buf($):m.call($)==="[object ArrayBuffer]"?new Uint8Array($):$,b=o.inflateSetDictionary(this.strm,F)),b===r.Z_BUF_ERROR&&U===!0&&(b=r.Z_OK,U=!1),b!==r.Z_STREAM_END&&b!==r.Z_OK)return this.onEnd(b),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&b!==r.Z_STREAM_END&&(P.avail_in!==0||E!==r.Z_FINISH&&E!==r.Z_SYNC_FLUSH)||(this.options.to==="string"?(D=s.utf8border(P.output,P.next_out),C=P.next_out-D,R=s.buf2string(P.output,D),P.next_out=C,P.avail_out=k-C,C&&l.arraySet(P.output,P.output,D,C,0),this.onData(R)):this.onData(l.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(U=!0)}while((0<P.avail_in||P.avail_out===0)&&b!==r.Z_STREAM_END);return b===r.Z_STREAM_END&&(E=r.Z_FINISH),E===r.Z_FINISH?(b=o.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===r.Z_OK):E!==r.Z_SYNC_FLUSH||(this.onEnd(r.Z_OK),!(P.avail_out=0))},c.prototype.onData=function(_){this.chunks.push(_)},c.prototype.onEnd=function(_){_===r.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},a.Inflate=c,a.inflate=p,a.inflateRaw=function(_,y){return(y=y||{}).raw=!0,p(_,y)},a.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,n,a){var o=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(r){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var f=h.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var u in f)f.hasOwnProperty(u)&&(r[u]=f[u])}}return r},a.shrinkBuf=function(r,h){return r.length===h?r:r.subarray?r.subarray(0,h):(r.length=h,r)};var l={arraySet:function(r,h,f,u,m){if(h.subarray&&r.subarray)r.set(h.subarray(f,f+u),m);else for(var c=0;c<u;c++)r[m+c]=h[f+c]},flattenChunks:function(r){var h,f,u,m,c,p;for(h=u=0,f=r.length;h<f;h++)u+=r[h].length;for(p=new Uint8Array(u),h=m=0,f=r.length;h<f;h++)c=r[h],p.set(c,m),m+=c.length;return p}},s={arraySet:function(r,h,f,u,m){for(var c=0;c<u;c++)r[m+c]=h[f+c]},flattenChunks:function(r){return[].concat.apply([],r)}};a.setTyped=function(r){r?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,l)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,s))},a.setTyped(o)},{}],42:[function(i,n,a){var o=i("./common"),l=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{l=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var r=new o.Buf8(256),h=0;h<256;h++)r[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function f(u,m){if(m<65537&&(u.subarray&&s||!u.subarray&&l))return String.fromCharCode.apply(null,o.shrinkBuf(u,m));for(var c="",p=0;p<m;p++)c+=String.fromCharCode(u[p]);return c}r[254]=r[254]=1,a.string2buf=function(u){var m,c,p,_,y,b=u.length,E=0;for(_=0;_<b;_++)(64512&(c=u.charCodeAt(_)))==55296&&_+1<b&&(64512&(p=u.charCodeAt(_+1)))==56320&&(c=65536+(c-55296<<10)+(p-56320),_++),E+=c<128?1:c<2048?2:c<65536?3:4;for(m=new o.Buf8(E),_=y=0;y<E;_++)(64512&(c=u.charCodeAt(_)))==55296&&_+1<b&&(64512&(p=u.charCodeAt(_+1)))==56320&&(c=65536+(c-55296<<10)+(p-56320),_++),c<128?m[y++]=c:(c<2048?m[y++]=192|c>>>6:(c<65536?m[y++]=224|c>>>12:(m[y++]=240|c>>>18,m[y++]=128|c>>>12&63),m[y++]=128|c>>>6&63),m[y++]=128|63&c);return m},a.buf2binstring=function(u){return f(u,u.length)},a.binstring2buf=function(u){for(var m=new o.Buf8(u.length),c=0,p=m.length;c<p;c++)m[c]=u.charCodeAt(c);return m},a.buf2string=function(u,m){var c,p,_,y,b=m||u.length,E=new Array(2*b);for(c=p=0;c<b;)if((_=u[c++])<128)E[p++]=_;else if(4<(y=r[_]))E[p++]=65533,c+=y-1;else{for(_&=y===2?31:y===3?15:7;1<y&&c<b;)_=_<<6|63&u[c++],y--;1<y?E[p++]=65533:_<65536?E[p++]=_:(_-=65536,E[p++]=55296|_>>10&1023,E[p++]=56320|1023&_)}return f(E,p)},a.utf8border=function(u,m){var c;for((m=m||u.length)>u.length&&(m=u.length),c=m-1;0<=c&&(192&u[c])==128;)c--;return c<0||c===0?m:c+r[u[c]]>m?c:m}},{"./common":41}],43:[function(i,n,a){n.exports=function(o,l,s,r){for(var h=65535&o|0,f=o>>>16&65535|0,u=0;s!==0;){for(s-=u=2e3<s?2e3:s;f=f+(h=h+l[r++]|0)|0,--u;);h%=65521,f%=65521}return h|f<<16|0}},{}],44:[function(i,n,a){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,n,a){var o=function(){for(var l,s=[],r=0;r<256;r++){l=r;for(var h=0;h<8;h++)l=1&l?3988292384^l>>>1:l>>>1;s[r]=l}return s}();n.exports=function(l,s,r,h){var f=o,u=h+r;l^=-1;for(var m=h;m<u;m++)l=l>>>8^f[255&(l^s[m])];return-1^l}},{}],46:[function(i,n,a){var o,l=i("../utils/common"),s=i("./trees"),r=i("./adler32"),h=i("./crc32"),f=i("./messages"),u=0,m=4,c=0,p=-2,_=-1,y=4,b=2,E=8,D=9,C=286,R=30,F=19,P=2*C+1,k=15,$=3,U=258,et=U+$+1,S=42,O=113,g=1,W=2,rt=3,G=4;function lt(d,M){return d.msg=f[M],M}function Y(d){return(d<<1)-(4<d?9:0)}function st(d){for(var M=d.length;0<=--M;)d[M]=0}function N(d){var M=d.state,A=M.pending;A>d.avail_out&&(A=d.avail_out),A!==0&&(l.arraySet(d.output,M.pending_buf,M.pending_out,A,d.next_out),d.next_out+=A,M.pending_out+=A,d.total_out+=A,d.avail_out-=A,M.pending-=A,M.pending===0&&(M.pending_out=0))}function B(d,M){s._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,M),d.block_start=d.strstart,N(d.strm)}function nt(d,M){d.pending_buf[d.pending++]=M}function K(d,M){d.pending_buf[d.pending++]=M>>>8&255,d.pending_buf[d.pending++]=255&M}function J(d,M){var A,w,v=d.max_chain_length,T=d.strstart,X=d.prev_length,z=d.nice_match,x=d.strstart>d.w_size-et?d.strstart-(d.w_size-et):0,V=d.window,Z=d.w_mask,j=d.prev,it=d.strstart+U,Et=V[T+X-1],mt=V[T+X];d.prev_length>=d.good_match&&(v>>=2),z>d.lookahead&&(z=d.lookahead);do if(V[(A=M)+X]===mt&&V[A+X-1]===Et&&V[A]===V[T]&&V[++A]===V[T+1]){T+=2,A++;do;while(V[++T]===V[++A]&&V[++T]===V[++A]&&V[++T]===V[++A]&&V[++T]===V[++A]&&V[++T]===V[++A]&&V[++T]===V[++A]&&V[++T]===V[++A]&&V[++T]===V[++A]&&T<it);if(w=U-(it-T),T=it-U,X<w){if(d.match_start=M,z<=(X=w))break;Et=V[T+X-1],mt=V[T+X]}}while((M=j[M&Z])>x&&--v!=0);return X<=d.lookahead?X:d.lookahead}function Dt(d){var M,A,w,v,T,X,z,x,V,Z,j=d.w_size;do{if(v=d.window_size-d.lookahead-d.strstart,d.strstart>=j+(j-et)){for(l.arraySet(d.window,d.window,j,j,0),d.match_start-=j,d.strstart-=j,d.block_start-=j,M=A=d.hash_size;w=d.head[--M],d.head[M]=j<=w?w-j:0,--A;);for(M=A=j;w=d.prev[--M],d.prev[M]=j<=w?w-j:0,--A;);v+=j}if(d.strm.avail_in===0)break;if(X=d.strm,z=d.window,x=d.strstart+d.lookahead,V=v,Z=void 0,Z=X.avail_in,V<Z&&(Z=V),A=Z===0?0:(X.avail_in-=Z,l.arraySet(z,X.input,X.next_in,Z,x),X.state.wrap===1?X.adler=r(X.adler,z,Z,x):X.state.wrap===2&&(X.adler=h(X.adler,z,Z,x)),X.next_in+=Z,X.total_in+=Z,Z),d.lookahead+=A,d.lookahead+d.insert>=$)for(T=d.strstart-d.insert,d.ins_h=d.window[T],d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[T+$-1])&d.hash_mask,d.prev[T&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=T,T++,d.insert--,!(d.lookahead+d.insert<$)););}while(d.lookahead<et&&d.strm.avail_in!==0)}function xt(d,M){for(var A,w;;){if(d.lookahead<et){if(Dt(d),d.lookahead<et&&M===u)return g;if(d.lookahead===0)break}if(A=0,d.lookahead>=$&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+$-1])&d.hash_mask,A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),A!==0&&d.strstart-A<=d.w_size-et&&(d.match_length=J(d,A)),d.match_length>=$)if(w=s._tr_tally(d,d.strstart-d.match_start,d.match_length-$),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=$){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+$-1])&d.hash_mask,A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else w=s._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(w&&(B(d,!1),d.strm.avail_out===0))return g}return d.insert=d.strstart<$-1?d.strstart:$-1,M===m?(B(d,!0),d.strm.avail_out===0?rt:G):d.last_lit&&(B(d,!1),d.strm.avail_out===0)?g:W}function dt(d,M){for(var A,w,v;;){if(d.lookahead<et){if(Dt(d),d.lookahead<et&&M===u)return g;if(d.lookahead===0)break}if(A=0,d.lookahead>=$&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+$-1])&d.hash_mask,A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=$-1,A!==0&&d.prev_length<d.max_lazy_match&&d.strstart-A<=d.w_size-et&&(d.match_length=J(d,A),d.match_length<=5&&(d.strategy===1||d.match_length===$&&4096<d.strstart-d.match_start)&&(d.match_length=$-1)),d.prev_length>=$&&d.match_length<=d.prev_length){for(v=d.strstart+d.lookahead-$,w=s._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-$),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=v&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+$-1])&d.hash_mask,A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=$-1,d.strstart++,w&&(B(d,!1),d.strm.avail_out===0))return g}else if(d.match_available){if((w=s._tr_tally(d,0,d.window[d.strstart-1]))&&B(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return g}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(w=s._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<$-1?d.strstart:$-1,M===m?(B(d,!0),d.strm.avail_out===0?rt:G):d.last_lit&&(B(d,!1),d.strm.avail_out===0)?g:W}function bt(d,M,A,w,v){this.good_length=d,this.max_lazy=M,this.nice_length=A,this.max_chain=w,this.func=v}function kt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*P),this.dyn_dtree=new l.Buf16(2*(2*R+1)),this.bl_tree=new l.Buf16(2*(2*F+1)),st(this.dyn_ltree),st(this.dyn_dtree),st(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(k+1),this.heap=new l.Buf16(2*C+1),st(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*C+1),st(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function St(d){var M;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=b,(M=d.state).pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?S:O,d.adler=M.wrap===2?0:1,M.last_flush=u,s._tr_init(M),c):lt(d,p)}function ce(d){var M=St(d);return M===c&&function(A){A.window_size=2*A.w_size,st(A.head),A.max_lazy_match=o[A.level].max_lazy,A.good_match=o[A.level].good_length,A.nice_match=o[A.level].nice_length,A.max_chain_length=o[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=$-1,A.match_available=0,A.ins_h=0}(d.state),M}function Zt(d,M,A,w,v,T){if(!d)return p;var X=1;if(M===_&&(M=6),w<0?(X=0,w=-w):15<w&&(X=2,w-=16),v<1||D<v||A!==E||w<8||15<w||M<0||9<M||T<0||y<T)return lt(d,p);w===8&&(w=9);var z=new kt;return(d.state=z).strm=d,z.wrap=X,z.gzhead=null,z.w_bits=w,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=v+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+$-1)/$),z.window=new l.Buf8(2*z.w_size),z.head=new l.Buf16(z.hash_size),z.prev=new l.Buf16(z.w_size),z.lit_bufsize=1<<v+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new l.Buf8(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=M,z.strategy=T,z.method=A,ce(d)}o=[new bt(0,0,0,0,function(d,M){var A=65535;for(A>d.pending_buf_size-5&&(A=d.pending_buf_size-5);;){if(d.lookahead<=1){if(Dt(d),d.lookahead===0&&M===u)return g;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var w=d.block_start+A;if((d.strstart===0||d.strstart>=w)&&(d.lookahead=d.strstart-w,d.strstart=w,B(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-et&&(B(d,!1),d.strm.avail_out===0))return g}return d.insert=0,M===m?(B(d,!0),d.strm.avail_out===0?rt:G):(d.strstart>d.block_start&&(B(d,!1),d.strm.avail_out),g)}),new bt(4,4,8,4,xt),new bt(4,5,16,8,xt),new bt(4,6,32,32,xt),new bt(4,4,16,16,dt),new bt(8,16,32,32,dt),new bt(8,16,128,128,dt),new bt(8,32,128,256,dt),new bt(32,128,258,1024,dt),new bt(32,258,258,4096,dt)],a.deflateInit=function(d,M){return Zt(d,M,E,15,8,0)},a.deflateInit2=Zt,a.deflateReset=ce,a.deflateResetKeep=St,a.deflateSetHeader=function(d,M){return d&&d.state?d.state.wrap!==2?p:(d.state.gzhead=M,c):p},a.deflate=function(d,M){var A,w,v,T;if(!d||!d.state||5<M||M<0)return d?lt(d,p):p;if(w=d.state,!d.output||!d.input&&d.avail_in!==0||w.status===666&&M!==m)return lt(d,d.avail_out===0?-5:p);if(w.strm=d,A=w.last_flush,w.last_flush=M,w.status===S)if(w.wrap===2)d.adler=0,nt(w,31),nt(w,139),nt(w,8),w.gzhead?(nt(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),nt(w,255&w.gzhead.time),nt(w,w.gzhead.time>>8&255),nt(w,w.gzhead.time>>16&255),nt(w,w.gzhead.time>>24&255),nt(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),nt(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(nt(w,255&w.gzhead.extra.length),nt(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(d.adler=h(d.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(nt(w,0),nt(w,0),nt(w,0),nt(w,0),nt(w,0),nt(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),nt(w,3),w.status=O);else{var X=E+(w.w_bits-8<<4)<<8;X|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(X|=32),X+=31-X%31,w.status=O,K(w,X),w.strstart!==0&&(K(w,d.adler>>>16),K(w,65535&d.adler)),d.adler=1}if(w.status===69)if(w.gzhead.extra){for(v=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>v&&(d.adler=h(d.adler,w.pending_buf,w.pending-v,v)),N(d),v=w.pending,w.pending!==w.pending_buf_size));)nt(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>v&&(d.adler=h(d.adler,w.pending_buf,w.pending-v,v)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){v=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>v&&(d.adler=h(d.adler,w.pending_buf,w.pending-v,v)),N(d),v=w.pending,w.pending===w.pending_buf_size)){T=1;break}T=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,nt(w,T)}while(T!==0);w.gzhead.hcrc&&w.pending>v&&(d.adler=h(d.adler,w.pending_buf,w.pending-v,v)),T===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){v=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>v&&(d.adler=h(d.adler,w.pending_buf,w.pending-v,v)),N(d),v=w.pending,w.pending===w.pending_buf_size)){T=1;break}T=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,nt(w,T)}while(T!==0);w.gzhead.hcrc&&w.pending>v&&(d.adler=h(d.adler,w.pending_buf,w.pending-v,v)),T===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&N(d),w.pending+2<=w.pending_buf_size&&(nt(w,255&d.adler),nt(w,d.adler>>8&255),d.adler=0,w.status=O)):w.status=O),w.pending!==0){if(N(d),d.avail_out===0)return w.last_flush=-1,c}else if(d.avail_in===0&&Y(M)<=Y(A)&&M!==m)return lt(d,-5);if(w.status===666&&d.avail_in!==0)return lt(d,-5);if(d.avail_in!==0||w.lookahead!==0||M!==u&&w.status!==666){var z=w.strategy===2?function(x,V){for(var Z;;){if(x.lookahead===0&&(Dt(x),x.lookahead===0)){if(V===u)return g;break}if(x.match_length=0,Z=s._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++,Z&&(B(x,!1),x.strm.avail_out===0))return g}return x.insert=0,V===m?(B(x,!0),x.strm.avail_out===0?rt:G):x.last_lit&&(B(x,!1),x.strm.avail_out===0)?g:W}(w,M):w.strategy===3?function(x,V){for(var Z,j,it,Et,mt=x.window;;){if(x.lookahead<=U){if(Dt(x),x.lookahead<=U&&V===u)return g;if(x.lookahead===0)break}if(x.match_length=0,x.lookahead>=$&&0<x.strstart&&(j=mt[it=x.strstart-1])===mt[++it]&&j===mt[++it]&&j===mt[++it]){Et=x.strstart+U;do;while(j===mt[++it]&&j===mt[++it]&&j===mt[++it]&&j===mt[++it]&&j===mt[++it]&&j===mt[++it]&&j===mt[++it]&&j===mt[++it]&&it<Et);x.match_length=U-(Et-it),x.match_length>x.lookahead&&(x.match_length=x.lookahead)}if(x.match_length>=$?(Z=s._tr_tally(x,1,x.match_length-$),x.lookahead-=x.match_length,x.strstart+=x.match_length,x.match_length=0):(Z=s._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++),Z&&(B(x,!1),x.strm.avail_out===0))return g}return x.insert=0,V===m?(B(x,!0),x.strm.avail_out===0?rt:G):x.last_lit&&(B(x,!1),x.strm.avail_out===0)?g:W}(w,M):o[w.level].func(w,M);if(z!==rt&&z!==G||(w.status=666),z===g||z===rt)return d.avail_out===0&&(w.last_flush=-1),c;if(z===W&&(M===1?s._tr_align(w):M!==5&&(s._tr_stored_block(w,0,0,!1),M===3&&(st(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),N(d),d.avail_out===0))return w.last_flush=-1,c}return M!==m?c:w.wrap<=0?1:(w.wrap===2?(nt(w,255&d.adler),nt(w,d.adler>>8&255),nt(w,d.adler>>16&255),nt(w,d.adler>>24&255),nt(w,255&d.total_in),nt(w,d.total_in>>8&255),nt(w,d.total_in>>16&255),nt(w,d.total_in>>24&255)):(K(w,d.adler>>>16),K(w,65535&d.adler)),N(d),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?c:1)},a.deflateEnd=function(d){var M;return d&&d.state?(M=d.state.status)!==S&&M!==69&&M!==73&&M!==91&&M!==103&&M!==O&&M!==666?lt(d,p):(d.state=null,M===O?lt(d,-3):c):p},a.deflateSetDictionary=function(d,M){var A,w,v,T,X,z,x,V,Z=M.length;if(!d||!d.state||(T=(A=d.state).wrap)===2||T===1&&A.status!==S||A.lookahead)return p;for(T===1&&(d.adler=r(d.adler,M,Z,0)),A.wrap=0,Z>=A.w_size&&(T===0&&(st(A.head),A.strstart=0,A.block_start=0,A.insert=0),V=new l.Buf8(A.w_size),l.arraySet(V,M,Z-A.w_size,A.w_size,0),M=V,Z=A.w_size),X=d.avail_in,z=d.next_in,x=d.input,d.avail_in=Z,d.next_in=0,d.input=M,Dt(A);A.lookahead>=$;){for(w=A.strstart,v=A.lookahead-($-1);A.ins_h=(A.ins_h<<A.hash_shift^A.window[w+$-1])&A.hash_mask,A.prev[w&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=w,w++,--v;);A.strstart=w,A.lookahead=$-1,Dt(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=$-1,A.match_available=0,d.next_in=z,d.input=x,d.avail_in=X,A.wrap=T,c},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,n,a){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,n,a){n.exports=function(o,l){var s,r,h,f,u,m,c,p,_,y,b,E,D,C,R,F,P,k,$,U,et,S,O,g,W;s=o.state,r=o.next_in,g=o.input,h=r+(o.avail_in-5),f=o.next_out,W=o.output,u=f-(l-o.avail_out),m=f+(o.avail_out-257),c=s.dmax,p=s.wsize,_=s.whave,y=s.wnext,b=s.window,E=s.hold,D=s.bits,C=s.lencode,R=s.distcode,F=(1<<s.lenbits)-1,P=(1<<s.distbits)-1;t:do{D<15&&(E+=g[r++]<<D,D+=8,E+=g[r++]<<D,D+=8),k=C[E&F];e:for(;;){if(E>>>=$=k>>>24,D-=$,($=k>>>16&255)===0)W[f++]=65535&k;else{if(!(16&$)){if(!(64&$)){k=C[(65535&k)+(E&(1<<$)-1)];continue e}if(32&$){s.mode=12;break t}o.msg="invalid literal/length code",s.mode=30;break t}U=65535&k,($&=15)&&(D<$&&(E+=g[r++]<<D,D+=8),U+=E&(1<<$)-1,E>>>=$,D-=$),D<15&&(E+=g[r++]<<D,D+=8,E+=g[r++]<<D,D+=8),k=R[E&P];i:for(;;){if(E>>>=$=k>>>24,D-=$,!(16&($=k>>>16&255))){if(!(64&$)){k=R[(65535&k)+(E&(1<<$)-1)];continue i}o.msg="invalid distance code",s.mode=30;break t}if(et=65535&k,D<($&=15)&&(E+=g[r++]<<D,(D+=8)<$&&(E+=g[r++]<<D,D+=8)),c<(et+=E&(1<<$)-1)){o.msg="invalid distance too far back",s.mode=30;break t}if(E>>>=$,D-=$,($=f-u)<et){if(_<($=et-$)&&s.sane){o.msg="invalid distance too far back",s.mode=30;break t}if(O=b,(S=0)===y){if(S+=p-$,$<U){for(U-=$;W[f++]=b[S++],--$;);S=f-et,O=W}}else if(y<$){if(S+=p+y-$,($-=y)<U){for(U-=$;W[f++]=b[S++],--$;);if(S=0,y<U){for(U-=$=y;W[f++]=b[S++],--$;);S=f-et,O=W}}}else if(S+=y-$,$<U){for(U-=$;W[f++]=b[S++],--$;);S=f-et,O=W}for(;2<U;)W[f++]=O[S++],W[f++]=O[S++],W[f++]=O[S++],U-=3;U&&(W[f++]=O[S++],1<U&&(W[f++]=O[S++]))}else{for(S=f-et;W[f++]=W[S++],W[f++]=W[S++],W[f++]=W[S++],2<(U-=3););U&&(W[f++]=W[S++],1<U&&(W[f++]=W[S++]))}break}}break}}while(r<h&&f<m);r-=U=D>>3,E&=(1<<(D-=U<<3))-1,o.next_in=r,o.next_out=f,o.avail_in=r<h?h-r+5:5-(r-h),o.avail_out=f<m?m-f+257:257-(f-m),s.hold=E,s.bits=D}},{}],49:[function(i,n,a){var o=i("../utils/common"),l=i("./adler32"),s=i("./crc32"),r=i("./inffast"),h=i("./inftrees"),f=1,u=2,m=0,c=-2,p=1,_=852,y=592;function b(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function E(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function D(S){var O;return S&&S.state?(O=S.state,S.total_in=S.total_out=O.total=0,S.msg="",O.wrap&&(S.adler=1&O.wrap),O.mode=p,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new o.Buf32(_),O.distcode=O.distdyn=new o.Buf32(y),O.sane=1,O.back=-1,m):c}function C(S){var O;return S&&S.state?((O=S.state).wsize=0,O.whave=0,O.wnext=0,D(S)):c}function R(S,O){var g,W;return S&&S.state?(W=S.state,O<0?(g=0,O=-O):(g=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?c:(W.window!==null&&W.wbits!==O&&(W.window=null),W.wrap=g,W.wbits=O,C(S))):c}function F(S,O){var g,W;return S?(W=new E,(S.state=W).window=null,(g=R(S,O))!==m&&(S.state=null),g):c}var P,k,$=!0;function U(S){if($){var O;for(P=new o.Buf32(512),k=new o.Buf32(32),O=0;O<144;)S.lens[O++]=8;for(;O<256;)S.lens[O++]=9;for(;O<280;)S.lens[O++]=7;for(;O<288;)S.lens[O++]=8;for(h(f,S.lens,0,288,P,0,S.work,{bits:9}),O=0;O<32;)S.lens[O++]=5;h(u,S.lens,0,32,k,0,S.work,{bits:5}),$=!1}S.lencode=P,S.lenbits=9,S.distcode=k,S.distbits=5}function et(S,O,g,W){var rt,G=S.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new o.Buf8(G.wsize)),W>=G.wsize?(o.arraySet(G.window,O,g-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(W<(rt=G.wsize-G.wnext)&&(rt=W),o.arraySet(G.window,O,g-W,rt,G.wnext),(W-=rt)?(o.arraySet(G.window,O,g-W,W,0),G.wnext=W,G.whave=G.wsize):(G.wnext+=rt,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=rt))),0}a.inflateReset=C,a.inflateReset2=R,a.inflateResetKeep=D,a.inflateInit=function(S){return F(S,15)},a.inflateInit2=F,a.inflate=function(S,O){var g,W,rt,G,lt,Y,st,N,B,nt,K,J,Dt,xt,dt,bt,kt,St,ce,Zt,d,M,A,w,v=0,T=new o.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return c;(g=S.state).mode===12&&(g.mode=13),lt=S.next_out,rt=S.output,st=S.avail_out,G=S.next_in,W=S.input,Y=S.avail_in,N=g.hold,B=g.bits,nt=Y,K=st,M=m;t:for(;;)switch(g.mode){case p:if(g.wrap===0){g.mode=13;break}for(;B<16;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(2&g.wrap&&N===35615){T[g.check=0]=255&N,T[1]=N>>>8&255,g.check=s(g.check,T,2,0),B=N=0,g.mode=2;break}if(g.flags=0,g.head&&(g.head.done=!1),!(1&g.wrap)||(((255&N)<<8)+(N>>8))%31){S.msg="incorrect header check",g.mode=30;break}if((15&N)!=8){S.msg="unknown compression method",g.mode=30;break}if(B-=4,d=8+(15&(N>>>=4)),g.wbits===0)g.wbits=d;else if(d>g.wbits){S.msg="invalid window size",g.mode=30;break}g.dmax=1<<d,S.adler=g.check=1,g.mode=512&N?10:12,B=N=0;break;case 2:for(;B<16;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(g.flags=N,(255&g.flags)!=8){S.msg="unknown compression method",g.mode=30;break}if(57344&g.flags){S.msg="unknown header flags set",g.mode=30;break}g.head&&(g.head.text=N>>8&1),512&g.flags&&(T[0]=255&N,T[1]=N>>>8&255,g.check=s(g.check,T,2,0)),B=N=0,g.mode=3;case 3:for(;B<32;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}g.head&&(g.head.time=N),512&g.flags&&(T[0]=255&N,T[1]=N>>>8&255,T[2]=N>>>16&255,T[3]=N>>>24&255,g.check=s(g.check,T,4,0)),B=N=0,g.mode=4;case 4:for(;B<16;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}g.head&&(g.head.xflags=255&N,g.head.os=N>>8),512&g.flags&&(T[0]=255&N,T[1]=N>>>8&255,g.check=s(g.check,T,2,0)),B=N=0,g.mode=5;case 5:if(1024&g.flags){for(;B<16;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}g.length=N,g.head&&(g.head.extra_len=N),512&g.flags&&(T[0]=255&N,T[1]=N>>>8&255,g.check=s(g.check,T,2,0)),B=N=0}else g.head&&(g.head.extra=null);g.mode=6;case 6:if(1024&g.flags&&(Y<(J=g.length)&&(J=Y),J&&(g.head&&(d=g.head.extra_len-g.length,g.head.extra||(g.head.extra=new Array(g.head.extra_len)),o.arraySet(g.head.extra,W,G,J,d)),512&g.flags&&(g.check=s(g.check,W,J,G)),Y-=J,G+=J,g.length-=J),g.length))break t;g.length=0,g.mode=7;case 7:if(2048&g.flags){if(Y===0)break t;for(J=0;d=W[G+J++],g.head&&d&&g.length<65536&&(g.head.name+=String.fromCharCode(d)),d&&J<Y;);if(512&g.flags&&(g.check=s(g.check,W,J,G)),Y-=J,G+=J,d)break t}else g.head&&(g.head.name=null);g.length=0,g.mode=8;case 8:if(4096&g.flags){if(Y===0)break t;for(J=0;d=W[G+J++],g.head&&d&&g.length<65536&&(g.head.comment+=String.fromCharCode(d)),d&&J<Y;);if(512&g.flags&&(g.check=s(g.check,W,J,G)),Y-=J,G+=J,d)break t}else g.head&&(g.head.comment=null);g.mode=9;case 9:if(512&g.flags){for(;B<16;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(N!==(65535&g.check)){S.msg="header crc mismatch",g.mode=30;break}B=N=0}g.head&&(g.head.hcrc=g.flags>>9&1,g.head.done=!0),S.adler=g.check=0,g.mode=12;break;case 10:for(;B<32;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}S.adler=g.check=b(N),B=N=0,g.mode=11;case 11:if(g.havedict===0)return S.next_out=lt,S.avail_out=st,S.next_in=G,S.avail_in=Y,g.hold=N,g.bits=B,2;S.adler=g.check=1,g.mode=12;case 12:if(O===5||O===6)break t;case 13:if(g.last){N>>>=7&B,B-=7&B,g.mode=27;break}for(;B<3;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}switch(g.last=1&N,B-=1,3&(N>>>=1)){case 0:g.mode=14;break;case 1:if(U(g),g.mode=20,O!==6)break;N>>>=2,B-=2;break t;case 2:g.mode=17;break;case 3:S.msg="invalid block type",g.mode=30}N>>>=2,B-=2;break;case 14:for(N>>>=7&B,B-=7&B;B<32;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if((65535&N)!=(N>>>16^65535)){S.msg="invalid stored block lengths",g.mode=30;break}if(g.length=65535&N,B=N=0,g.mode=15,O===6)break t;case 15:g.mode=16;case 16:if(J=g.length){if(Y<J&&(J=Y),st<J&&(J=st),J===0)break t;o.arraySet(rt,W,G,J,lt),Y-=J,G+=J,st-=J,lt+=J,g.length-=J;break}g.mode=12;break;case 17:for(;B<14;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(g.nlen=257+(31&N),N>>>=5,B-=5,g.ndist=1+(31&N),N>>>=5,B-=5,g.ncode=4+(15&N),N>>>=4,B-=4,286<g.nlen||30<g.ndist){S.msg="too many length or distance symbols",g.mode=30;break}g.have=0,g.mode=18;case 18:for(;g.have<g.ncode;){for(;B<3;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}g.lens[X[g.have++]]=7&N,N>>>=3,B-=3}for(;g.have<19;)g.lens[X[g.have++]]=0;if(g.lencode=g.lendyn,g.lenbits=7,A={bits:g.lenbits},M=h(0,g.lens,0,19,g.lencode,0,g.work,A),g.lenbits=A.bits,M){S.msg="invalid code lengths set",g.mode=30;break}g.have=0,g.mode=19;case 19:for(;g.have<g.nlen+g.ndist;){for(;bt=(v=g.lencode[N&(1<<g.lenbits)-1])>>>16&255,kt=65535&v,!((dt=v>>>24)<=B);){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(kt<16)N>>>=dt,B-=dt,g.lens[g.have++]=kt;else{if(kt===16){for(w=dt+2;B<w;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(N>>>=dt,B-=dt,g.have===0){S.msg="invalid bit length repeat",g.mode=30;break}d=g.lens[g.have-1],J=3+(3&N),N>>>=2,B-=2}else if(kt===17){for(w=dt+3;B<w;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}B-=dt,d=0,J=3+(7&(N>>>=dt)),N>>>=3,B-=3}else{for(w=dt+7;B<w;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}B-=dt,d=0,J=11+(127&(N>>>=dt)),N>>>=7,B-=7}if(g.have+J>g.nlen+g.ndist){S.msg="invalid bit length repeat",g.mode=30;break}for(;J--;)g.lens[g.have++]=d}}if(g.mode===30)break;if(g.lens[256]===0){S.msg="invalid code -- missing end-of-block",g.mode=30;break}if(g.lenbits=9,A={bits:g.lenbits},M=h(f,g.lens,0,g.nlen,g.lencode,0,g.work,A),g.lenbits=A.bits,M){S.msg="invalid literal/lengths set",g.mode=30;break}if(g.distbits=6,g.distcode=g.distdyn,A={bits:g.distbits},M=h(u,g.lens,g.nlen,g.ndist,g.distcode,0,g.work,A),g.distbits=A.bits,M){S.msg="invalid distances set",g.mode=30;break}if(g.mode=20,O===6)break t;case 20:g.mode=21;case 21:if(6<=Y&&258<=st){S.next_out=lt,S.avail_out=st,S.next_in=G,S.avail_in=Y,g.hold=N,g.bits=B,r(S,K),lt=S.next_out,rt=S.output,st=S.avail_out,G=S.next_in,W=S.input,Y=S.avail_in,N=g.hold,B=g.bits,g.mode===12&&(g.back=-1);break}for(g.back=0;bt=(v=g.lencode[N&(1<<g.lenbits)-1])>>>16&255,kt=65535&v,!((dt=v>>>24)<=B);){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(bt&&!(240&bt)){for(St=dt,ce=bt,Zt=kt;bt=(v=g.lencode[Zt+((N&(1<<St+ce)-1)>>St)])>>>16&255,kt=65535&v,!(St+(dt=v>>>24)<=B);){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}N>>>=St,B-=St,g.back+=St}if(N>>>=dt,B-=dt,g.back+=dt,g.length=kt,bt===0){g.mode=26;break}if(32&bt){g.back=-1,g.mode=12;break}if(64&bt){S.msg="invalid literal/length code",g.mode=30;break}g.extra=15&bt,g.mode=22;case 22:if(g.extra){for(w=g.extra;B<w;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}g.length+=N&(1<<g.extra)-1,N>>>=g.extra,B-=g.extra,g.back+=g.extra}g.was=g.length,g.mode=23;case 23:for(;bt=(v=g.distcode[N&(1<<g.distbits)-1])>>>16&255,kt=65535&v,!((dt=v>>>24)<=B);){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(!(240&bt)){for(St=dt,ce=bt,Zt=kt;bt=(v=g.distcode[Zt+((N&(1<<St+ce)-1)>>St)])>>>16&255,kt=65535&v,!(St+(dt=v>>>24)<=B);){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}N>>>=St,B-=St,g.back+=St}if(N>>>=dt,B-=dt,g.back+=dt,64&bt){S.msg="invalid distance code",g.mode=30;break}g.offset=kt,g.extra=15&bt,g.mode=24;case 24:if(g.extra){for(w=g.extra;B<w;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}g.offset+=N&(1<<g.extra)-1,N>>>=g.extra,B-=g.extra,g.back+=g.extra}if(g.offset>g.dmax){S.msg="invalid distance too far back",g.mode=30;break}g.mode=25;case 25:if(st===0)break t;if(J=K-st,g.offset>J){if((J=g.offset-J)>g.whave&&g.sane){S.msg="invalid distance too far back",g.mode=30;break}Dt=J>g.wnext?(J-=g.wnext,g.wsize-J):g.wnext-J,J>g.length&&(J=g.length),xt=g.window}else xt=rt,Dt=lt-g.offset,J=g.length;for(st<J&&(J=st),st-=J,g.length-=J;rt[lt++]=xt[Dt++],--J;);g.length===0&&(g.mode=21);break;case 26:if(st===0)break t;rt[lt++]=g.length,st--,g.mode=21;break;case 27:if(g.wrap){for(;B<32;){if(Y===0)break t;Y--,N|=W[G++]<<B,B+=8}if(K-=st,S.total_out+=K,g.total+=K,K&&(S.adler=g.check=g.flags?s(g.check,rt,K,lt-K):l(g.check,rt,K,lt-K)),K=st,(g.flags?N:b(N))!==g.check){S.msg="incorrect data check",g.mode=30;break}B=N=0}g.mode=28;case 28:if(g.wrap&&g.flags){for(;B<32;){if(Y===0)break t;Y--,N+=W[G++]<<B,B+=8}if(N!==(4294967295&g.total)){S.msg="incorrect length check",g.mode=30;break}B=N=0}g.mode=29;case 29:M=1;break t;case 30:M=-3;break t;case 31:return-4;case 32:default:return c}return S.next_out=lt,S.avail_out=st,S.next_in=G,S.avail_in=Y,g.hold=N,g.bits=B,(g.wsize||K!==S.avail_out&&g.mode<30&&(g.mode<27||O!==4))&&et(S,S.output,S.next_out,K-S.avail_out)?(g.mode=31,-4):(nt-=S.avail_in,K-=S.avail_out,S.total_in+=nt,S.total_out+=K,g.total+=K,g.wrap&&K&&(S.adler=g.check=g.flags?s(g.check,rt,K,S.next_out-K):l(g.check,rt,K,S.next_out-K)),S.data_type=g.bits+(g.last?64:0)+(g.mode===12?128:0)+(g.mode===20||g.mode===15?256:0),(nt==0&&K===0||O===4)&&M===m&&(M=-5),M)},a.inflateEnd=function(S){if(!S||!S.state)return c;var O=S.state;return O.window&&(O.window=null),S.state=null,m},a.inflateGetHeader=function(S,O){var g;return S&&S.state&&2&(g=S.state).wrap?((g.head=O).done=!1,m):c},a.inflateSetDictionary=function(S,O){var g,W=O.length;return S&&S.state?(g=S.state).wrap!==0&&g.mode!==11?c:g.mode===11&&l(1,O,W,0)!==g.check?-3:et(S,O,W,W)?(g.mode=31,-4):(g.havedict=1,m):c},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,n,a){var o=i("../utils/common"),l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],r=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,u,m,c,p,_,y,b){var E,D,C,R,F,P,k,$,U,et=b.bits,S=0,O=0,g=0,W=0,rt=0,G=0,lt=0,Y=0,st=0,N=0,B=null,nt=0,K=new o.Buf16(16),J=new o.Buf16(16),Dt=null,xt=0;for(S=0;S<=15;S++)K[S]=0;for(O=0;O<c;O++)K[u[m+O]]++;for(rt=et,W=15;1<=W&&K[W]===0;W--);if(W<rt&&(rt=W),W===0)return p[_++]=20971520,p[_++]=20971520,b.bits=1,0;for(g=1;g<W&&K[g]===0;g++);for(rt<g&&(rt=g),S=Y=1;S<=15;S++)if(Y<<=1,(Y-=K[S])<0)return-1;if(0<Y&&(f===0||W!==1))return-1;for(J[1]=0,S=1;S<15;S++)J[S+1]=J[S]+K[S];for(O=0;O<c;O++)u[m+O]!==0&&(y[J[u[m+O]]++]=O);if(P=f===0?(B=Dt=y,19):f===1?(B=l,nt-=257,Dt=s,xt-=257,256):(B=r,Dt=h,-1),S=g,F=_,lt=O=N=0,C=-1,R=(st=1<<(G=rt))-1,f===1&&852<st||f===2&&592<st)return 1;for(;;){for(k=S-lt,U=y[O]<P?($=0,y[O]):y[O]>P?($=Dt[xt+y[O]],B[nt+y[O]]):($=96,0),E=1<<S-lt,g=D=1<<G;p[F+(N>>lt)+(D-=E)]=k<<24|$<<16|U|0,D!==0;);for(E=1<<S-1;N&E;)E>>=1;if(E!==0?(N&=E-1,N+=E):N=0,O++,--K[S]==0){if(S===W)break;S=u[m+y[O]]}if(rt<S&&(N&R)!==C){for(lt===0&&(lt=rt),F+=g,Y=1<<(G=S-lt);G+lt<W&&!((Y-=K[G+lt])<=0);)G++,Y<<=1;if(st+=1<<G,f===1&&852<st||f===2&&592<st)return 1;p[C=N&R]=rt<<24|G<<16|F-_|0}}return N!==0&&(p[F+N]=S-lt<<24|64<<16|0),b.bits=rt,0}},{"../utils/common":41}],51:[function(i,n,a){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,n,a){var o=i("../utils/common"),l=0,s=1;function r(v){for(var T=v.length;0<=--T;)v[T]=0}var h=0,f=29,u=256,m=u+1+f,c=30,p=19,_=2*m+1,y=15,b=16,E=7,D=256,C=16,R=17,F=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],k=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],et=new Array(2*(m+2));r(et);var S=new Array(2*c);r(S);var O=new Array(512);r(O);var g=new Array(256);r(g);var W=new Array(f);r(W);var rt,G,lt,Y=new Array(c);function st(v,T,X,z,x){this.static_tree=v,this.extra_bits=T,this.extra_base=X,this.elems=z,this.max_length=x,this.has_stree=v&&v.length}function N(v,T){this.dyn_tree=v,this.max_code=0,this.stat_desc=T}function B(v){return v<256?O[v]:O[256+(v>>>7)]}function nt(v,T){v.pending_buf[v.pending++]=255&T,v.pending_buf[v.pending++]=T>>>8&255}function K(v,T,X){v.bi_valid>b-X?(v.bi_buf|=T<<v.bi_valid&65535,nt(v,v.bi_buf),v.bi_buf=T>>b-v.bi_valid,v.bi_valid+=X-b):(v.bi_buf|=T<<v.bi_valid&65535,v.bi_valid+=X)}function J(v,T,X){K(v,X[2*T],X[2*T+1])}function Dt(v,T){for(var X=0;X|=1&v,v>>>=1,X<<=1,0<--T;);return X>>>1}function xt(v,T,X){var z,x,V=new Array(y+1),Z=0;for(z=1;z<=y;z++)V[z]=Z=Z+X[z-1]<<1;for(x=0;x<=T;x++){var j=v[2*x+1];j!==0&&(v[2*x]=Dt(V[j]++,j))}}function dt(v){var T;for(T=0;T<m;T++)v.dyn_ltree[2*T]=0;for(T=0;T<c;T++)v.dyn_dtree[2*T]=0;for(T=0;T<p;T++)v.bl_tree[2*T]=0;v.dyn_ltree[2*D]=1,v.opt_len=v.static_len=0,v.last_lit=v.matches=0}function bt(v){8<v.bi_valid?nt(v,v.bi_buf):0<v.bi_valid&&(v.pending_buf[v.pending++]=v.bi_buf),v.bi_buf=0,v.bi_valid=0}function kt(v,T,X,z){var x=2*T,V=2*X;return v[x]<v[V]||v[x]===v[V]&&z[T]<=z[X]}function St(v,T,X){for(var z=v.heap[X],x=X<<1;x<=v.heap_len&&(x<v.heap_len&&kt(T,v.heap[x+1],v.heap[x],v.depth)&&x++,!kt(T,z,v.heap[x],v.depth));)v.heap[X]=v.heap[x],X=x,x<<=1;v.heap[X]=z}function ce(v,T,X){var z,x,V,Z,j=0;if(v.last_lit!==0)for(;z=v.pending_buf[v.d_buf+2*j]<<8|v.pending_buf[v.d_buf+2*j+1],x=v.pending_buf[v.l_buf+j],j++,z===0?J(v,x,T):(J(v,(V=g[x])+u+1,T),(Z=P[V])!==0&&K(v,x-=W[V],Z),J(v,V=B(--z),X),(Z=k[V])!==0&&K(v,z-=Y[V],Z)),j<v.last_lit;);J(v,D,T)}function Zt(v,T){var X,z,x,V=T.dyn_tree,Z=T.stat_desc.static_tree,j=T.stat_desc.has_stree,it=T.stat_desc.elems,Et=-1;for(v.heap_len=0,v.heap_max=_,X=0;X<it;X++)V[2*X]!==0?(v.heap[++v.heap_len]=Et=X,v.depth[X]=0):V[2*X+1]=0;for(;v.heap_len<2;)V[2*(x=v.heap[++v.heap_len]=Et<2?++Et:0)]=1,v.depth[x]=0,v.opt_len--,j&&(v.static_len-=Z[2*x+1]);for(T.max_code=Et,X=v.heap_len>>1;1<=X;X--)St(v,V,X);for(x=it;X=v.heap[1],v.heap[1]=v.heap[v.heap_len--],St(v,V,1),z=v.heap[1],v.heap[--v.heap_max]=X,v.heap[--v.heap_max]=z,V[2*x]=V[2*X]+V[2*z],v.depth[x]=(v.depth[X]>=v.depth[z]?v.depth[X]:v.depth[z])+1,V[2*X+1]=V[2*z+1]=x,v.heap[1]=x++,St(v,V,1),2<=v.heap_len;);v.heap[--v.heap_max]=v.heap[1],function(mt,Wt){var Qi,ue,tn,Tt,xn,ks,ve=Wt.dyn_tree,sr=Wt.max_code,Mu=Wt.stat_desc.static_tree,Fu=Wt.stat_desc.has_stree,Hu=Wt.stat_desc.extra_bits,or=Wt.stat_desc.extra_base,en=Wt.stat_desc.max_length,Bn=0;for(Tt=0;Tt<=y;Tt++)mt.bl_count[Tt]=0;for(ve[2*mt.heap[mt.heap_max]+1]=0,Qi=mt.heap_max+1;Qi<_;Qi++)en<(Tt=ve[2*ve[2*(ue=mt.heap[Qi])+1]+1]+1)&&(Tt=en,Bn++),ve[2*ue+1]=Tt,sr<ue||(mt.bl_count[Tt]++,xn=0,or<=ue&&(xn=Hu[ue-or]),ks=ve[2*ue],mt.opt_len+=ks*(Tt+xn),Fu&&(mt.static_len+=ks*(Mu[2*ue+1]+xn)));if(Bn!==0){do{for(Tt=en-1;mt.bl_count[Tt]===0;)Tt--;mt.bl_count[Tt]--,mt.bl_count[Tt+1]+=2,mt.bl_count[en]--,Bn-=2}while(0<Bn);for(Tt=en;Tt!==0;Tt--)for(ue=mt.bl_count[Tt];ue!==0;)sr<(tn=mt.heap[--Qi])||(ve[2*tn+1]!==Tt&&(mt.opt_len+=(Tt-ve[2*tn+1])*ve[2*tn],ve[2*tn+1]=Tt),ue--)}}(v,T),xt(V,Et,v.bl_count)}function d(v,T,X){var z,x,V=-1,Z=T[1],j=0,it=7,Et=4;for(Z===0&&(it=138,Et=3),T[2*(X+1)+1]=65535,z=0;z<=X;z++)x=Z,Z=T[2*(z+1)+1],++j<it&&x===Z||(j<Et?v.bl_tree[2*x]+=j:x!==0?(x!==V&&v.bl_tree[2*x]++,v.bl_tree[2*C]++):j<=10?v.bl_tree[2*R]++:v.bl_tree[2*F]++,V=x,Et=(j=0)===Z?(it=138,3):x===Z?(it=6,3):(it=7,4))}function M(v,T,X){var z,x,V=-1,Z=T[1],j=0,it=7,Et=4;for(Z===0&&(it=138,Et=3),z=0;z<=X;z++)if(x=Z,Z=T[2*(z+1)+1],!(++j<it&&x===Z)){if(j<Et)for(;J(v,x,v.bl_tree),--j!=0;);else x!==0?(x!==V&&(J(v,x,v.bl_tree),j--),J(v,C,v.bl_tree),K(v,j-3,2)):j<=10?(J(v,R,v.bl_tree),K(v,j-3,3)):(J(v,F,v.bl_tree),K(v,j-11,7));V=x,Et=(j=0)===Z?(it=138,3):x===Z?(it=6,3):(it=7,4)}}r(Y);var A=!1;function w(v,T,X,z){K(v,(h<<1)+(z?1:0),3),function(x,V,Z,j){bt(x),j&&(nt(x,Z),nt(x,~Z)),o.arraySet(x.pending_buf,x.window,V,Z,x.pending),x.pending+=Z}(v,T,X,!0)}a._tr_init=function(v){A||(function(){var T,X,z,x,V,Z=new Array(y+1);for(x=z=0;x<f-1;x++)for(W[x]=z,T=0;T<1<<P[x];T++)g[z++]=x;for(g[z-1]=x,x=V=0;x<16;x++)for(Y[x]=V,T=0;T<1<<k[x];T++)O[V++]=x;for(V>>=7;x<c;x++)for(Y[x]=V<<7,T=0;T<1<<k[x]-7;T++)O[256+V++]=x;for(X=0;X<=y;X++)Z[X]=0;for(T=0;T<=143;)et[2*T+1]=8,T++,Z[8]++;for(;T<=255;)et[2*T+1]=9,T++,Z[9]++;for(;T<=279;)et[2*T+1]=7,T++,Z[7]++;for(;T<=287;)et[2*T+1]=8,T++,Z[8]++;for(xt(et,m+1,Z),T=0;T<c;T++)S[2*T+1]=5,S[2*T]=Dt(T,5);rt=new st(et,P,u+1,m,y),G=new st(S,k,0,c,y),lt=new st(new Array(0),$,0,p,E)}(),A=!0),v.l_desc=new N(v.dyn_ltree,rt),v.d_desc=new N(v.dyn_dtree,G),v.bl_desc=new N(v.bl_tree,lt),v.bi_buf=0,v.bi_valid=0,dt(v)},a._tr_stored_block=w,a._tr_flush_block=function(v,T,X,z){var x,V,Z=0;0<v.level?(v.strm.data_type===2&&(v.strm.data_type=function(j){var it,Et=4093624447;for(it=0;it<=31;it++,Et>>>=1)if(1&Et&&j.dyn_ltree[2*it]!==0)return l;if(j.dyn_ltree[18]!==0||j.dyn_ltree[20]!==0||j.dyn_ltree[26]!==0)return s;for(it=32;it<u;it++)if(j.dyn_ltree[2*it]!==0)return s;return l}(v)),Zt(v,v.l_desc),Zt(v,v.d_desc),Z=function(j){var it;for(d(j,j.dyn_ltree,j.l_desc.max_code),d(j,j.dyn_dtree,j.d_desc.max_code),Zt(j,j.bl_desc),it=p-1;3<=it&&j.bl_tree[2*U[it]+1]===0;it--);return j.opt_len+=3*(it+1)+5+5+4,it}(v),x=v.opt_len+3+7>>>3,(V=v.static_len+3+7>>>3)<=x&&(x=V)):x=V=X+5,X+4<=x&&T!==-1?w(v,T,X,z):v.strategy===4||V===x?(K(v,2+(z?1:0),3),ce(v,et,S)):(K(v,4+(z?1:0),3),function(j,it,Et,mt){var Wt;for(K(j,it-257,5),K(j,Et-1,5),K(j,mt-4,4),Wt=0;Wt<mt;Wt++)K(j,j.bl_tree[2*U[Wt]+1],3);M(j,j.dyn_ltree,it-1),M(j,j.dyn_dtree,Et-1)}(v,v.l_desc.max_code+1,v.d_desc.max_code+1,Z+1),ce(v,v.dyn_ltree,v.dyn_dtree)),dt(v),z&&bt(v)},a._tr_tally=function(v,T,X){return v.pending_buf[v.d_buf+2*v.last_lit]=T>>>8&255,v.pending_buf[v.d_buf+2*v.last_lit+1]=255&T,v.pending_buf[v.l_buf+v.last_lit]=255&X,v.last_lit++,T===0?v.dyn_ltree[2*X]++:(v.matches++,T--,v.dyn_ltree[2*(g[X]+u+1)]++,v.dyn_dtree[2*B(T)]++),v.last_lit===v.lit_bufsize-1},a._tr_align=function(v){K(v,2,3),J(v,D,et),function(T){T.bi_valid===16?(nt(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(v)}},{"../utils/common":41}],53:[function(i,n,a){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,n,a){(function(o){(function(l,s){if(!l.setImmediate){var r,h,f,u,m=1,c={},p=!1,_=l.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(l);y=y&&y.setTimeout?y:l,r={}.toString.call(l.process)==="[object process]"?function(C){process.nextTick(function(){E(C)})}:function(){if(l.postMessage&&!l.importScripts){var C=!0,R=l.onmessage;return l.onmessage=function(){C=!1},l.postMessage("","*"),l.onmessage=R,C}}()?(u="setImmediate$"+Math.random()+"$",l.addEventListener?l.addEventListener("message",D,!1):l.attachEvent("onmessage",D),function(C){l.postMessage(u+C,"*")}):l.MessageChannel?((f=new MessageChannel).port1.onmessage=function(C){E(C.data)},function(C){f.port2.postMessage(C)}):_&&"onreadystatechange"in _.createElement("script")?(h=_.documentElement,function(C){var R=_.createElement("script");R.onreadystatechange=function(){E(C),R.onreadystatechange=null,h.removeChild(R),R=null},h.appendChild(R)}):function(C){setTimeout(E,0,C)},y.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var R=new Array(arguments.length-1),F=0;F<R.length;F++)R[F]=arguments[F+1];var P={callback:C,args:R};return c[m]=P,r(m),m++},y.clearImmediate=b}function b(C){delete c[C]}function E(C){if(p)setTimeout(E,0,C);else{var R=c[C];if(R){p=!0;try{(function(F){var P=F.callback,k=F.args;switch(k.length){case 0:P();break;case 1:P(k[0]);break;case 2:P(k[0],k[1]);break;case 3:P(k[0],k[1],k[2]);break;default:P.apply(s,k)}})(R)}finally{b(C),p=!1}}}}function D(C){C.source===l&&typeof C.data=="string"&&C.data.indexOf(u)===0&&E(+C.data.slice(u.length))}})(typeof self>"u"?o===void 0?this:o:self)}).call(this,typeof Fn<"u"?Fn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ip);const np=fo;async function sp(t){return np.loadAsync(t)}function Qt(){return["main"]}async function op(t){if(t.file)return t.file;if(t.link)return tp(fl(decodeURI(t.link)));if(t.id)return Iu(dl(decodeURI(t.id)));if(t.hash&&vo(decodeURI(t.hash).trim()))return ep(decodeURI(t.hash).trim());throw new Error("Could not search for file.")}const Le=async t=>{var e;try{console.time("loading time"),$n.enable(!1);let i=await op(t);vt.status("info","Extracting zip",0),Bt.switchHeader(!1);const n=await sp(i);$n.enable(!1),vt.status("info","Parsing map info...",0),q.tInfo(Qt(),"Parsing map info");const a=await qm(n);at.beatmapInfo=a,ch(a),vt.status("info","Loading image...",10.4375),q.tInfo(Qt(),"Loading cover image");let o=n.file(a._coverImageFilename);if(Q.load.imageCover&&o){let h=await o.async("base64");Bt.setCoverImage("data:image;base64,"+h),Wi.loading.coverImage=!0}else q.tError(Qt(),`${a._coverImageFilename} does not exists.`);if(at.contributors=[],(e=a==null?void 0:a._customData)!=null&&e._contributors)for(const h of a._customData._contributors){q.tInfo(Qt(),"Loading contributor image "+h._name),o=n.file(h._iconPath);let f=null;Q.load.imageContributor&&o?f=await o.async("base64"):q.tError(Qt(),`${h._iconPath} does not exists.`),at.contributors.push({...h,_base64:f})}vt.status("info","Loading audio...",20.875),q.tInfo(Qt(),"Loading audio");let l=n.file(a._songFilename);if(Q.load.audio&&l){let h=!1;setTimeout(()=>{h||vt.status("info","Loading audio... (this may take a while)",20.875)},1e4);let f=await l.async("arraybuffer");Bt.setAudio(f),await new AudioContext().decodeAudioData(f).then(m=>{h=!0;let c=m.duration;at.duration=c,Bt.setSongDuration(c),Wi.loading.audio=!0}).catch(function(m){Bt.setSongDuration(),q.tError(Qt(),m)})}else Bt.setSongDuration(),q.tError(Qt(),`${a._songFilename} does not exist.`);vt.status("info","Parsing difficulty...",70),at.beatmapDifficulty=await Km(a,n),Hi.adjustTime(),vt.status("info","Adding map difficulty stats...",80),q.tInfo(Qt(),"Adding map stats"),Um(),Nl(at.contributors);let s=a._beatsPerMinute,r=a._beatsPerMinute;at.beatmapDifficulty.forEach(h=>{const f=h.bpm.change.map(m=>m.BPM),u=h.data.bpmEvents.map(m=>m.bpm);s=Math.min(s,...f,...u),r=Math.max(r,...f,...u)}),s!==r&&Bt.setSongBPM(a._beatsPerMinute,s,r),vt.status("info","Analysing general...",85),q.tInfo(Qt(),"Analysing map"),Di.runGeneral(),Hi.displayOutputGeneral(),vt.status("info","Analysing difficulty...",90),Di.applyAll(),Hi.populateSelect(a),Hi.displayOutputDifficulty(),$n.enable(!0),vt.status("info","Map successfully loaded!")}catch(i){vt.status("error",i,100),q.tError(Qt(),i),at.clear(),$n.enable(!0),Bt.switchHeader(!0)}finally{console.timeEnd("loading time")}},Zi="UI Intro: ",vn=document.querySelector(".input__intro-url"),En=document.querySelector(".input__intro-id"),wn=document.querySelector(".input__intro-hash"),el=document.querySelector(".input__search-button"),il=document.querySelector(".input__file"),Os=document.querySelector(".input__file-zone");if(vn)vn.addEventListener("keydown",Qo);else throw new Error(Zi+"URL input is missing");if(En)En.addEventListener("keydown",Qo);else throw new Error(Zi+"ID input is missing");if(wn)wn.addEventListener("keydown",Qo);else throw new Error(Zi+"Hash input is missing");if(el)el.addEventListener("click",rp);else throw new Error(Zi+"search button is missing");if(il)il.addEventListener("change",ap);else throw new Error(Zi+"file input is missing");if(Os)Os.addEventListener("drop",lp),Os.addEventListener("dragover",cp);else throw new Error(Zi+"file drop zone is missing");function Qo(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&Le({link:e.value}),e.classList.contains("input__intro-id")&&Le({id:e.value}),e.classList.contains("input__intro-hash")&&Le({hash:e.value}))}function rp(t){if(vn&&vn.value!==""){Le({link:vn.value});return}if(En&&En.value!==""){Le({id:En.value});return}if(wn&&wn.value!==""){Le({hash:wn.value});return}}function ap(t){const e=t.target;vt.status("info","Reading file input",0);const i=e.files?e.files[0]:null;try{if(i==null)throw vt.status("info","No file input",0),new Error("No file input");if(i&&(i.name.substr(-4)===".zip"||i.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(i),n.addEventListener("load",()=>{Le({file:i})})}else throw new Error("Unsupported file format, please enter zip file")}catch(n){vt.status("error",n,0),console.error(n)}}function lp(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items&&t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substr(-4)===".zip"||e.name.substr(-4)===".bsl")){const i=new FileReader;i.readAsArrayBuffer(e),i.addEventListener("load",()=>{Le({file:e})})}else throw new Error("Unsupported file format, please enter zip file")}}catch(e){vt.status("error",e,0),console.error(e)}}function cp(t){t.preventDefault(),t.stopPropagation()}const up=document.querySelector("body"),hp=["Dark","Light","Monochrome"],tr={list:hp,set:t=>{up.className="theme-"+t.toLowerCase().replace(" ","")}},le="UI Settings: ",Qn=document.querySelector(".settings__theme"),mo=document.querySelector(".settings__beat-numbering"),po=document.querySelector(".settings__rounding"),go=document.querySelector(".settings__info-height"),_o=document.querySelector(".settings__data-check"),bo=document.querySelector(".settings__data-error"),er=document.querySelectorAll(".settings__load"),ws=document.querySelector(".settings__sort"),ir=document.querySelectorAll(".settings__show"),nr=document.querySelectorAll(".settings__onload"),nl=document.querySelector(".settings__clear-button");if(Qn)Qn.addEventListener("change",fp),tr.list.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,Qn.add(e)});else throw new Error(le+"theme select is missing");if(mo)mo.addEventListener("change",dp);else throw new Error(le+"missing settings");if(po)po.addEventListener("change",mp);else throw new Error(le+"missing settings");if(go)go.addEventListener("change",pp);else throw new Error(le+"missing settings");if(_o)_o.addEventListener("change",gp);else throw new Error(le+"missing settings");if(bo)bo.addEventListener("change",_p);else throw new Error(le+"missing settings");er.length||console.error(le+"empty load list, intentional or typo error?");er.forEach(t=>t.addEventListener("change",wp));if(ws)ws.addEventListener("change",vp);else throw new Error(le+"sort check is missing");nr.length||console.error(le+"empty onload list, intentional or typo error?");nr.forEach(t=>t.addEventListener("change",Sp));ir.length||console.error(le+"empty show list, intentional or typo error?");ir.forEach(t=>t.addEventListener("change",bp));if(nl)nl.addEventListener("click",$u);else throw new Error(le+"clear button is missing");function fp(t){const e=t.target;Q.theme=e.options[e.options.selectedIndex].value,tr.set(Q.theme),Q.save()}function dp(t){const e=t.target;Q.beatNumbering=e.options[e.options.selectedIndex].value,Q.save()}function mp(t){const e=t.target;Q.rounding=parseInt(e.value),Q.save()}function pp(t){const e=t.target;Q.infoRowHeight=parseInt(e.value),$l(Q.infoRowHeight),Q.save()}function gp(t){const e=t.target;Q.dataCheck=e.checked,Q.save()}function _p(t){const e=t.target;Q.dataError=e.checked,Q.save()}function bp(t){const e=t.target,i=e.id.replace("settings__show-","");Q.show[i]=e.checked,Q.save()}function yp(t,e){ir.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}function vp(t){const e=t.target;Q.sorting=e.checked,Q.save()}function Ep(t){ws&&(ws.checked=t)}function wp(t){const e=t.target,i=e.name;Q.load[i]=e.checked,Q.save()}function Dp(t,e){er.forEach(i=>{i.name===t&&(i.checked=e)})}function Sp(t){const e=t.target,i=e.name;Q.onLoad[i]=e.checked,Q.save()}function Tp(t,e){nr.forEach(i=>{i.name===t&&(i.checked=e)})}function Cp(t){Qn.value=t}function Lp(t){mo.value=t}function Rp(t){po.value=t.toString()}function kp(t){go.value=t.toString(),$l(Q.infoRowHeight)}function xp(t){_o.checked=t}function Bp(t){bo.checked=t}function $u(){Q.clear(),Q.reset(),location.reload()}const fe={setShowCheck:yp,setSortCheck:Ep,setLoadCheck:Dp,setOnLoadCheck:Tp,setTheme:Cp,setBeatNumbering:Lp,setRounding:Rp,setInfoHeight:kp,setDataCheck:xp,setDataError:Bp,clear:$u},Np=document.querySelectorAll(".input__reset-button");Np.forEach(t=>t.addEventListener("click",Ap));function Ap(){vt.reset(),Bt.reset(),uh(),Hi.reset(),Vm(),at.clear()}const Ip=2,$p=5,Op=13,Pp="Kival Evan#5480",sl=new class{constructor(){this._version=`${Ip}.${$p}.${Op}`,this._wm=Pp}get value(){return this._version}get watermark(){return this._wm}},Mp="UI Footer: ",Ou=document.querySelectorAll(".link__watermark"),Pu=document.querySelectorAll(".link__version");(!Ou.length||!Pu.length)&&console.error(Mp+"missing part");function ol(){const t=new Date;return t.getMonth()==5&&t.getDate()==10}const rl={setWatermark:t=>{Ou.forEach(e=>{e.textContent=(ol()?"Happy Birthday, ":"")+t,ol()&&(e.title=`Happy ${new Date().getFullYear()-new Date("1999-06-10").getFullYear()} Birthday, 10th June`)})},setVersion:t=>{Pu.forEach(e=>e.textContent=t)}},Fp=function(){let t=!1;return function(){if(!t){t=!0,rl.setWatermark(sl.watermark),rl.setVersion(sl.value),Hi.populateTool(),fe.setTheme(Q.theme),fe.setBeatNumbering(Q.beatNumbering),fe.setRounding(Q.rounding),fe.setInfoHeight(Q.infoRowHeight),fe.setDataCheck(Q.dataCheck),fe.setDataError(Q.dataError);for(const e in Q.load)fe.setLoadCheck(e,Q.load[e]);fe.setSortCheck(Q.sorting);for(const e in Q.show)cl.show(e,Q.show[e]),fe.setShowCheck(e,Q.show[e]);for(const e in Q.onLoad)fe.setOnLoadCheck(e,Q.onLoad[e]);tr.set(Q.theme),q.tInfo(["init"],"User interface initialised")}}}();(function(){Fp();const t=new URL(location.href),e=t.searchParams.get("url"),i=t.searchParams.get("id"),n=t.searchParams.get("hash");(i||e||n)&&Le({link:e,id:i,hash:n})})();
