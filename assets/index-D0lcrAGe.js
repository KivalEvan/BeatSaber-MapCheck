var Za=e=>{throw TypeError(e)};var vs=(e,t,i)=>t.has(e)||Za("Cannot "+i);var et=(e,t,i)=>(vs(e,t,"read from private field"),i?i.call(e):t.get(e)),Ln=(e,t,i)=>t.has(e)?Za("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),Nn=(e,t,i,n)=>(vs(e,t,"write to private field"),n?n.call(e,i):t.set(e,i),i),dn=(e,t,i)=>(vs(e,t,"access private method"),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(o){if(o.ep)return;o.ep=!0;const r=i(o);fetch(o.href,r)}})();Object.hasOwn||Object.defineProperty(Object,"hasOwn",{value:function(e,t){if(e==null)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)},configurable:!0,enumerable:!1,writable:!0});function Wu(e){return e*(180/Math.PI)}function xn(e){return e*(Math.PI/180)}function po(e,t){const i=e%t;return i<0?i+t:i}function an(e,t,i){return Math.min(po(e-t,i),po(t-e,i))}function ud(e){return e.toString().split(".").map((t,i)=>i?t:t.replace(/\B(?=(\d{3})+(?!\d))/g,",")).join(".")}function Hu(e){return/^[a-fA-F0-9]+$/g.test(e)}function Zi(e){return parseInt(e,16)}function qt(){const e=arguments;if(typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="number"){let t=[e[0],e[1],e[2]];return typeof e[3]=="number"&&t.push(e[3]),typeof e[3]=="string"&&(e[3]==="hsva"&&(t=On(t,"hsva")),e[3]==="rgba255"&&(t=On(t,"rgba255"))),typeof e[4]=="string"&&(e[4]==="hsva"&&(t=On(t,"hsva")),e[4]==="rgba255"&&(t=On(t,"rgba255"))),t}if(typeof e[0]=="number")return typeof e[1]=="boolean"&&e[1]?[e[0]/255,e[0]/255,e[0]/255]:typeof e[1]=="number"?[e[0],e[0],e[0],e[1]]:[e[0],e[0],e[0]];if(typeof e[0]=="string")return mi(e[0]);if(Array.isArray(e[0])){const t=e[0];let i=[t[0],t[1],t[2]];if(!i.every(n=>typeof n=="number"))throw new Error("Unable to parse color; array contain undefined or non-numeric value");return typeof t[3]=="number"&&i.push(t[3]),typeof e[1]=="string"&&(e[1]==="hsva"&&(i=On(i,"hsva")),e[1]==="rgba255"&&(i=On(i,"rgba255"))),i}if(typeof e[0]=="object"){const t=e[0];if("type"in t)switch(t.type){case"hsva":return qt(t.value,"hsva");case"rgba":return qt(t.value,"rgba");case"rgba255":return qt(t.value,"rgba255")}if("r"in t&&"g"in t&&"b"in t){const i=[t.r,t.g,t.b];if(!i.every(n=>typeof n=="number"))throw new Error("Unable to parse color; array contain undefined or non-numeric value");return typeof t.a=="number"&&i.push(t.a),i}}throw new Error("Unable to parse color; input is invalid")}function ii(e,t){if(Array.isArray(e)){const n={r:e[0],g:e[1],b:e[2]};return typeof e[3]=="number"&&(n.a=e[3]),t&&(n.a??=1),n}if(typeof e=="string"||"type"in e)return ii(qt(e),t);const i={r:e.r,g:e.g,b:e.b};return typeof e.a=="number"&&(i.a=e.a),t&&(i.a??=1),i}function ke(e){const t=ii(e);let i=1;for(const n in t)i=Math.max(Math.abs(t[n]),i);for(const n in t)t[n]=fd(t[n]/i);return`#${Mo(t.r)}${Mo(t.g)}${Mo(t.b)}${typeof t.a=="number"?Mo(t.a):""}`}function mi(e){if(e=e.trim(),e.startsWith("#")&&(e=e.substring(1)),!Hu(e))throw new Error("Not valid hexadecimal");let t=[0,0,0];if(e.length===3||e.length===4)t=[Fi(Zi(e.slice(0,1)+e.slice(0,1))),Fi(Zi(e.slice(1,2)+e.slice(1,2))),Fi(Zi(e.slice(2,3)+e.slice(2,3)))],e.length===4&&t.push(Fi(Zi(e.slice(3,4)+e.slice(3,4))));else if(e.length===6||e.length===8)t=[Fi(Zi(e.slice(0,2))),Fi(Zi(e.slice(2,4))),Fi(Zi(e.slice(4,6)))],e.length===8&&t.push(Fi(Zi(e.slice(6,8))));else throw new Error("Not valid colour hexadecimal");return t}function On(e,t="rgba",i="rgba"){if(typeof e=="string"){const n=mi(e);return i==="hsva"?Po(n):n}else if(Array.isArray(e)){if(t==="hsva")return i==="hsva"?[...e]:cd(e);const n=t==="rgba255"?e.map(o=>Fi(o)):[...e];return i==="hsva"?Po(n):n}else if("type"in e){let n;switch(e.type){case"hsva":n=qt(e.value,"hsva");break;case"rgba":n=qt(e.value,"rgba");break;case"rgba255":n=qt(e.value,"rgba255")}return i==="hsva"?Po(n):n}else{const n=[e.r,e.g,e.b];return typeof e.a=="number"&&n.push(e.a),i==="hsva"?Po(n):n}}function Po(e,t,i,n){Array.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),e=e,t=t,i=i;let o=0;const r=Math.max(e,t,i),s=Math.min(e,t,i),a=r-s,l=r===0?0:a/r,u=r;switch(r){case s:break;case e:o=t-i+a*(t<i?6:0),o/=6*a;break;case t:o=i-e+a*2,o/=6*a;break;case i:o=e-t+a*4,o/=6*a;break}const f=[o*360,l,u];return typeof n=="number"&&f.push(n),f}function cd(e,t,i,n){Array.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),e=e/360,t=t,i=i,e<0&&(e+=Math.abs(Math.floor(e)));let o=0,r=0,s=0;const a=Math.floor(e*6),l=e*6-a,u=i*(1-t),f=i*(1-l*t),b=i*(1-(1-l)*t);switch(a%6){case 0:o=i,r=b,s=u;break;case 1:o=f,r=i,s=u;break;case 2:o=u,r=i,s=b;break;case 3:o=u,r=f,s=i;break;case 4:o=b,r=u,s=i;break;case 5:o=i,r=u,s=f;break}const m=[o,r,s];return typeof n=="number"&&m.push(n),m}function Qa(e){let t=e[0],i=e[1],n=e[2],o,r,s;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,o=(t*.4124+i*.3576+n*.1805)/.95047,r=(t*.2126+i*.7152+n*.0722)/1,s=(t*.0193+i*.1192+n*.9505)/1.08883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116;const a=[116*r-16,500*(o-r),200*(r-s)];return typeof e[3]=="number"&&a.push(e[3]),a}function Ua(e,t){let i=0;return e>=0&&t===0?0:e<0&&t===0?180:e===0&&t>0?90:e===0&&t<0?270:(e>0&&t>0&&(i=0),e<0&&(i=180),e>0&&t<0&&(i=360),Wu(Math.atan(t/e))+i)}function Mo(e){const t=e.toString(16);return t.length===1?"0"+t:t}function fd(e){return Math.round(e*255)}function Fi(e){return e/255}function Yu(e,t,i){return Math.min(Math.max(t,e),i)}function md(e,t,i){return t===i?1:(e-t)/(i-t)}function Xs(e,t,i){return t+(i-t)*e}function Ui(e,t,i=Number.EPSILON){return Math.abs(e-t)<=i}function hd(e){e=e.toString();let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function pd(e,t,i){return e>t?[t,e]:[e,t]}function $(e,t=0){const i=Math.pow(10,t);return Math.round(e*i)/i}function Es(e){if(!e.length)return 0;const t=e.map(n=>n).sort((n,o)=>n-o),i=Math.floor(t.length/2);return t.length%2?t[i]:(t[i-1]+t[i])/2}function qs(e,t){const[i,n,o]=Qa(e),[r,s,a]=Qa(t),l=1,u=1,f=1;let b,m,g,E,v,y,_,D,C,O,x,H,F,Z,P,X,ye,R,V,d;return b=Math.sqrt(n*n+o*o),m=Math.sqrt(s*s+a*a),g=(b+m)/2,v=.5*(1-Math.sqrt((g^7)/((g^7)+30))),C=(1+v)*n,b=Math.sqrt(C*C+o*o),y=Ua(C,o),C=(1+v)*s,m=Math.sqrt(C*C+a*a),_=Ua(C,a),R=r-i,V=m-b,b*m==0?d=0:(C=$(_-y,12),Math.abs(C)<=180?d=_-y:C>180?d=_-y-360:d=_-y+360),d=2*Math.sqrt(b*m)*Math.sin(xn(d/2)),O=(i+r)/2,E=(b+m)/2,b*m==0?D=y+_:(C=Math.abs($(y-_,12)),C>180?_+y<360?D=y+_+360:D=y+_-360:D=y+_,D/=2),x=1-.17*Math.cos(xn(D-30))+.24*Math.cos(xn(2*D))+.32*Math.cos(xn(3*D+6))-.2*Math.cos(xn(4*D-63)),P=30*Math.exp(-((D-275)/25)*((D-275)/25)),X=2*Math.sqrt((E^7)/((E^7)+30)),H=1+.015*((O-50)*(O-50))/Math.sqrt(20+(O-50)*(O-50)),F=1+.045*E,Z=1+.015*E*x,ye=-Math.sin(xn(2*P))*X,R=R/(l*H),V=V/(u*F),d=d/(f*Z),Math.sqrt(R*R+V*V+d*d+ye*V*d)}hd(Math.random());function dd(e,t,i=!1,n=Math.random){if(typeof e=="boolean"||!e&&typeof e!="number")return e?Math.round(n()):n();if(typeof t=="boolean"||!t&&typeof t!="number"){let r=n()*e;return t&&(r=Math.round(r)),r}[e,t]=pd(e,t);const o=n()*(t-e)+e;return i?$(o,typeof i=="number"&&i>0?i:0):o}function ys(e,t,i=!1){return dd(e,t,i,Math.random)}function _s(e){return Array.isArray(e)&&e.length===2&&e.every(t=>typeof t=="number")}function Xu(e){return Array.isArray(e)&&e.length===3&&e.every(t=>typeof t=="number")}function ua(e){return function(t,i,...n){if(!t)return t;if(typeof i=="number")return t.map(o=>e(o,i,...n));if(t=[...t],i)if(Array.isArray(i))for(let o=0;o<t.length;o++)typeof i[o]=="number"&&(t[o]=e(t[o],i[o],...n));else switch(t.length){case 4:t[3]=e(t[3],i.w??0,...n);case 3:t[2]=e(t[2],i.z??0,...n);case 2:t[1]=e(t[1],i.y??0,...n),t[0]=e(t[0],i.x??0,...n)}return t}}function ca(e,t){return ua((i,n)=>i+n)(e,t)}function fr(e,t){return ua((i,n)=>i-n)(e,t)}function Oi(e,t){return ua((i,n)=>n?i*n:i)(e,t)}function Ks(e,t){const i=fr(e,t);let n=0;for(let o=0;o<i.length;o++){const r=i[o]**2;n+=r}return Math.sqrt(n)}function bd(e,t,i=.001){const[n]=fr(e,t);return Math.abs(n)<=i}function gd(e,t,i=.001){const[,n]=fr(e,t);return Math.abs(n)<=i}function vd(e,t,i=.001){const[n,o]=fr(e,t);return Ui(Math.abs(n),Math.abs(o),i)}function qu(e,t,i=1){const n=Object.values(e),o=n.indexOf(t);return t in n?n[(o+n.length+i)%n.length]:t}function dt(e){return e==null||typeof e!="object"?e:Array.isArray(e)?[...e]:{...e}}function N(e){if(e==null||typeof e!="object")return e;const t=Array.isArray(e)?new Array(e.length):{};if(Array.isArray(e)){for(let i=0;i<e.length;i++)t[i]=N(e[i]);return t}for(const i in e)t[i]=N(e[i]);return t}function Ku(e){return!!e&&typeof e=="object"}function _o(e){for(const t in e)if(Object.hasOwn(e,t))return!1;return!0}function yi(e){if(!e)return"0:00";const t=Math.floor(e),i=t/60,n=i<0?`-${Math.ceil(i).toString()}`:Math.floor(i).toString(),o=Math.abs(t%60).toString().padStart(2,"0");return`${n}:${o}`}function Ed(e){if(!e)return"0:00:00";const t=Math.abs(Math.round(e*60%60)).toString().padStart(2,"0");return`${yi(e>0?Math.floor(e):Math.ceil(e))}:${t}`}function Xo(e){if(!e)return"0:00.000";const t=(e%1).toString().split(".")[1]?.padEnd(3,"0").slice(0,3)||"000";return`${yi(e>0?Math.floor(e):Math.ceil(e))}.${t}`}class de{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o;static#l;static#u;static init(){de.#e=document.querySelector(".intro"),de.#i=document.querySelector(".metadata"),de.#t=document.querySelector(".cover__link"),de.#n=document.querySelector(".cover__image"),de.#s=document.querySelector(".metadata__song-name"),de.#a=document.querySelector(".metadata__song-subname"),de.#r=document.querySelector(".metadata__song-author"),de.#o=document.querySelector(".metadata__song-bpm"),de.#l=document.querySelector(".metadata__song-duration"),de.#u=document.querySelector(".audio"),de.reset()}static reset(){de.switchToIntro(),de.setCoverImage(null),de.setCoverLink(),de.setSongDuration(0),de.unloadAudio()}static switchToIntro(){de.#e.classList.remove("hidden"),de.#i.classList.add("hidden")}static switchToMetadata(){de.#e.classList.add("hidden"),de.#i.classList.remove("hidden")}static setCoverImage(t){de.#n.src=t||"./img/unknown.jpg"}static getCoverImage(){return de.#n.src}static setCoverLink(t,i){if(t==null&&i==null){de.#t.textContent="",de.#t.href="",de.#t.classList.add("disabled");return}t!=null&&(de.#t.textContent=i??"Download Link",de.#t.href=t,de.#t.classList.remove("disabled"))}static setSongName(t){de.#s.textContent=t}static setSongSubname(t){de.#a.textContent=t}static setSongAuthor(t){de.#r.textContent=t}static setSongBPM(t,i,n){i==null&&typeof n=="number"&&(i=Math.min(t,n)),n==null&&typeof i=="number"&&(n=Math.max(t,i));let o=$(t,2).toString()+"BPM";i&&n&&i!==n&&(o+=` (${$(i,2)}-${$(n,2)})`),de.#o.textContent=o}static setSongDuration(t){typeof t=="number"?de.#l.textContent=Xo(t):typeof t=="string"?de.#l.textContent=t:de.#l.textContent="No audio"}static async setAudio(t){const i=new Blob([t],{type:"audio/ogg"});de.#u.src=globalThis.URL.createObjectURL(i)}static unloadAudio(){de.#u.src="",globalThis.URL.revokeObjectURL("")}}var Ze=(e=>(e[e.INFO=0]="INFO",e[e.DOWNLOAD=1]="DOWNLOAD",e[e.ERROR=2]="ERROR",e))(Ze||{});class Ae{static#e="loading__bar--error";static#i="loading__bar--download";static#t;static#n;static init(){Ae.#t=document.querySelector(".loading__bar"),Ae.#n=document.querySelector(".loading__text")}static status(t,i,n=100){Ae.#n.textContent=i,Ae.#t.style.width=`${n}%`,t===2?Ae.#t.classList.add(Ae.#e):Ae.#t.classList.remove(Ae.#e),t===1?Ae.#t.classList.add(Ae.#i):Ae.#t.classList.remove(Ae.#i)}static reset(){Ae.status(0,"No map loaded",0)}}var Io=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},wi=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},qo,kn,Ko,Ri;function yd(e){return`\x1B[33m${e}\x1B[39m`}function _d(e){return`\x1B[31m${e}\x1B[39m`}function el(e){return`\x1B[2m${e}\x1B[22m`}var lt;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARN=2]="WARN",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e[e.TRACE=5]="TRACE"})(lt||(lt={}));class mr{constructor(){kn.set(this,lt.INFO),Ko.set(this,(t,i)=>`${qo.LogPrefixes.get(i)} ${el(">")} [${el(t.join("::"))}]`),Ri.set(this,"script")}set logLevel(t){Io(this,kn,t,"f"),this.tInfo(["logger","logLevel"],`Log level set to ${qo.LogPrefixes.get(t)}`)}get logLevel(){return wi(this,kn,"f")}set tagPrint(t){Io(this,Ko,t,"f"),this.tInfo(["logger","tagPrint"],"Update tag print function")}get tagPrint(){return wi(this,Ko,"f")}set untagged(t){Io(this,Ri,t.trim(),"f"),this.tInfo(["logger","untagged"],`Update untagged string to ${wi(this,Ri,"f")}`)}get untagged(){return wi(this,Ri,"f")}log(t,i,n){if(t>wi(this,kn,"f"))return;const o=this.tagPrint(i,t);switch(t){case lt.TRACE:return o?console.trace(o,...n):console.trace(...n);case lt.DEBUG:return o?console.debug(o,...n):console.debug(...n);case lt.INFO:return o?console.info(o,...n):console.info(...n);case lt.WARN:return o?console.warn(o,...n):console.warn(...n);case lt.ERROR:return o?console.error(o,...n):console.error(...n);default:return o?console.log(o,...n):console.log(...n)}}setLevel(t){t=Math.min(Math.max(t,0),5),Io(this,kn,t,"f"),this.tInfo(["logger","setLevel"],`Log level set to ${qo.LogPrefixes.get(t)}`)}tTrace(t,...i){this.log(lt.TRACE,t,i)}tDebug(t,...i){this.log(lt.DEBUG,t,i)}tInfo(t,...i){this.log(lt.INFO,t,i)}tWarn(t,...i){this.log(lt.WARN,t,i)}tError(t,...i){this.log(lt.ERROR,t,i)}trace(...t){this.tTrace([wi(this,Ri,"f")],...t)}debug(...t){this.tDebug([wi(this,Ri,"f")],...t)}info(...t){this.tInfo([wi(this,Ri,"f")],...t)}warn(...t){this.tWarn([wi(this,Ri,"f")],...t)}error(...t){this.tError([wi(this,Ri,"f")],...t)}}qo=mr,kn=new WeakMap,Ko=new WeakMap,Ri=new WeakMap;Object.defineProperty(mr,"LogLevels",{enumerable:!0,configurable:!0,writable:!0,value:lt});Object.defineProperty(mr,"LogPrefixes",{enumerable:!0,configurable:!0,writable:!0,value:new Map([[lt.TRACE,"TRACE"],[lt.DEBUG,"DEBUG"],[lt.INFO,"INFO"],[lt.WARN,yd("WARN")],[lt.ERROR,_d("!!ERROR!!")],[lt.NONE,"NONE"]])});let se=new mr;const xe={LEFT:0,MIDDLE_LEFT:1,MIDDLE_RIGHT:2,RIGHT:3},ut={BOTTOM:0,MIDDLE:1,TOP:2},pe={NONE:-1,RED:0,BLUE:1},z={UP:0,DOWN:1,LEFT:2,RIGHT:3,UP_LEFT:4,UP_RIGHT:5,DOWN_LEFT:6,DOWN_RIGHT:7,ANY:8},Dd={UP:0,DOWN:1,LEFT:2,RIGHT:3,UP_LEFT:4,UP_RIGHT:5,DOWN_LEFT:6,DOWN_RIGHT:7,NONE:9},Js={STRAIGHT:0,CLOCKWISE:1,COUNTER_CLOCKWISE:2},Qe={OFF:0,BLUE_ON:1,BLUE_FLASH:2,BLUE_FADE:3,BLUE_TRANSITION:4,RED_ON:5,RED_FLASH:6,RED_FADE:7,RED_TRANSITION:8,WHITE_ON:9,WHITE_FLASH:10,WHITE_FADE:11,WHITE_TRANSITION:12},qe={BACK_LASERS:0,RING_LIGHTS:1,LEFT_LASERS:2,RIGHT_LASERS:3,CENTER_LIGHTS:4,COLOR_BOOST:5,EXTRA_LEFT_LIGHTS:6,EXTRA_RIGHT_LIGHTS:7,RING_ROTATION:8,RING_ZOOM:9,EXTRA_LEFT_LASERS:10,EXTRA_RIGHT_LASERS:11,LEFT_LASER_ROTATION:12,RIGHT_LASER_ROTATION:13,EARLY_LANE_ROTATION:14,LATE_LANE_ROTATION:15,UTILITY_EVENT_0:16,UTILITY_EVENT_1:17,UTILITY_EVENT_2:18,UTILITY_EVENT_3:19,SPECIAL_EVENT_0:40,SPECIAL_EVENT_1:41,SPECIAL_EVENT_2:42,SPECIAL_EVENT_3:43,BPM_CHANGE:100,NJS_CHANGE:1e3},Ju={EARLY:0,LATE:1},Zu={DIVISION:1,STEP_AND_OFFSET:2},Qu={NONE:0,DURATION:1,DISTRIBUTION:2,ALL:3},Uu={NO_RANDOM:0,KEEP_ORDER:1,RANDOM_ELEMENTS:2,ALL:3},Td={WAVE:1,STEP:2},Jo={NONE:-1,LINEAR:0,IN_QUAD:1,OUT_QUAD:2,INOUT_QUAD:3,IN_SINE:4,OUT_SINE:5,INOUT_SINE:6,IN_CUBIC:7,OUT_CUBIC:8,INOUT_CUBIC:9,IN_QUART:10,OUT_QUART:11,INOUT_QUART:12,IN_QUINT:13,OUT_QUINT:14,INOUT_QUINT:15,IN_EXPO:16,OUT_EXPO:17,INOUT_EXPO:18,IN_CIRC:19,OUT_CIRC:20,INOUT_CIRC:21,IN_BACK:22,OUT_BACK:23,INOUT_BACK:24,IN_ELASTIC:25,OUT_ELASTIC:26,INOUT_ELASTIC:27,IN_BOUNCE:28,OUT_BOUNCE:29,INOUT_BOUNCE:30,BS_INOUT_BACK:100,BS_INOUT_ELASTIC:101,BS_INOUT_BOUNCE:102},Sd={NONE:-1,RED:0,BLUE:1,WHITE:2},wd={X:0,Y:1,Z:2},Cd={AUTOMATIC:0,CLOCKWISE:1,COUNTER_CLOCKWISE:2},Rd={NOTE_A:0,NOTE_B:1,BOMB:3},An={INSTANT:0,INTERPOLATE:1,EXTEND:2},hr={INT:0,FLOAT:1,BOOL:2},ji={NONE:0,COLOR:1,ROTATION:2,TRANSLATION:3,FX_FLOAT:4},pr=4,Wi={[z.UP]:180,[z.DOWN]:0,[z.LEFT]:270,[z.RIGHT]:90,[z.UP_LEFT]:225,[z.UP_RIGHT]:135,[z.DOWN_LEFT]:315,[z.DOWN_RIGHT]:45,[z.ANY]:0},Ld={[z.UP]:z.DOWN,[z.DOWN]:z.UP,[z.LEFT]:z.RIGHT,[z.RIGHT]:z.LEFT,[z.UP_LEFT]:z.DOWN_RIGHT,[z.UP_RIGHT]:z.DOWN_LEFT,[z.DOWN_LEFT]:z.UP_RIGHT,[z.DOWN_RIGHT]:z.UP_LEFT,[z.ANY]:z.ANY},Ds={[z.UP]:[0,1],[z.DOWN]:[0,-1],[z.LEFT]:[-1,0],[z.RIGHT]:[1,0],[z.UP_LEFT]:[-1,1],[z.UP_RIGHT]:[1,1],[z.DOWN_LEFT]:[-1,-1],[z.DOWN_RIGHT]:[1,-1],[z.ANY]:[0,0]},ec={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60},tc={"-60":0,"-45":1,"-30":2,"-15":3,15:4,30:5,45:6,60:7};function fa(e){return e>=0&&e<=19||e>=40&&e<=43||e===100||e===1e3}function Do(e,t){return e===qe.BACK_LASERS||e===qe.RING_LIGHTS||e===qe.LEFT_LASERS||e===qe.RIGHT_LASERS||e===qe.CENTER_LIGHTS||e===qe.EXTRA_LEFT_LIGHTS||e===qe.EXTRA_RIGHT_LIGHTS||e===qe.EXTRA_LEFT_LASERS||e===qe.EXTRA_RIGHT_LASERS}function Nd(e){return e===qe.COLOR_BOOST}function ma(e,t){return e===qe.RING_ROTATION||e===qe.RING_ZOOM}function dr(e,t){return e===qe.LEFT_LASER_ROTATION||e===qe.RIGHT_LASER_ROTATION}function xd(e){return e===qe.EARLY_LANE_ROTATION||e===qe.LATE_LANE_ROTATION}function ic(e,t){return e===qe.UTILITY_EVENT_0||e===qe.UTILITY_EVENT_1||e===qe.UTILITY_EVENT_2||e===qe.UTILITY_EVENT_3}function Od(e,t){return e===qe.SPECIAL_EVENT_0||e===qe.SPECIAL_EVENT_1||e===qe.SPECIAL_EVENT_2||e===qe.SPECIAL_EVENT_3}function Bd(e){return e===qe.BPM_CHANGE}function kd(e){return e===qe.NJS_CHANGE}function Ad(e){return Do(e)||ma(e)||dr(e)||ic(e)}function ha(e){return e===Qe.OFF}function nc(e){return e===Qe.BLUE_ON||e===Qe.RED_ON||e===Qe.WHITE_ON}function oc(e){return e===Qe.BLUE_FLASH||e===Qe.RED_FLASH||e===Qe.WHITE_FLASH}function rc(e){return e===Qe.BLUE_FADE||e===Qe.RED_FADE||e===Qe.WHITE_FADE}function Pd(e){return e===Qe.BLUE_TRANSITION||e===Qe.RED_TRANSITION||e===Qe.WHITE_TRANSITION}function Md(e){return e===Qe.BLUE_ON||e===Qe.BLUE_FLASH||e===Qe.BLUE_FADE||e===Qe.BLUE_TRANSITION}function Id(e){return e===Qe.RED_ON||e===Qe.RED_FLASH||e===Qe.RED_FADE||e===Qe.RED_TRANSITION}function $d(e){return e===Qe.WHITE_ON||e===Qe.WHITE_FLASH||e===Qe.WHITE_FADE||e===Qe.WHITE_TRANSITION}function pa(e){return e>=2e9}const di={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",QueenEnvironment:"Queen",LinkinPark2Environment:"Linkin Park 2.0",TheRollingStonesEnvironment:"The Rolling Stones",LatticeEnvironment:"Lattice",DaftPunkEnvironment:"Daft Punk",HipHopEnvironment:"Hip Hop Mixtape",ColliderEnvironment:"Collider",BritneyEnvironment:"Britney Spears",Monstercat2Environment:"Monstercat 2.0",GlassDesertEnvironment:"Glass Desert",MetallicaEnvironment:"Metallica",MultiplayerEnvironment:"Origins"},Fd={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},Vd={saberLeftColor:"Left Note Color",saberRightColor:"Right Note Color",environment0Color:"Left Environment Color",environment1Color:"Right Environment Color",environmentWColor:"White Environment Color",environment0ColorBoost:"Left Environment Boost Color",environment1ColorBoost:"Right Environment Boost Color",environmentWColorBoost:"White Environment Boost Color",obstaclesColor:"Obstacle Color"},bi={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6825916,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_envColorLeftBoost:{r:.1333333,g:.7568628,b:.1568628},_envColorRightBoost:{r:.05490196,g:.6196079,b:.9019608},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.6588235,g:.1254902,b:.1254902},_colorRight:{r:.282353,g:.282353,b:.282353},_envColorLeft:{r:.6588235,g:.1254902,b:.1254902},_envColorRight:{r:.4705882,g:.4705882,b:.4705882},_envColorLeftBoost:{r:.5019608,g:0,b:0},_envColorRightBoost:{r:.4924452,g:0,b:.5372549},_obstacleColor:{r:.2509804,g:.2509804,b:.2509804}},Interscope:{_colorLeft:{r:.7264151,g:.6269099,b:.3118103},_colorRight:{r:.5895709,g:.2978884,b:.723},_envColorLeft:{r:.7242536,g:.319804,b:.9137255},_envColorRight:{r:.7647059,g:.7589706,b:.7188236},_envColorLeftBoost:{r:.7924528,g:.4298683,b:.4298683},_envColorRightBoost:{r:.7038,g:.7157449,b:.765},_obstacleColor:{r:.5882353,g:.2980392,b:.7215686}},Skrillex:{_colorLeft:{r:.6980392,g:.1411765,b:.3686275},_colorRight:{r:.3293333,g:.323,b:.38},_envColorLeft:{r:.8,g:.28,b:.5859449},_envColorRight:{r:.06525807,g:.578,b:.5686774},_envColorLeftBoost:{r:.8117648,g:.3058824,b:.3058824},_envColorRightBoost:{r:.2784314,g:.8,b:.4459763},_obstacleColor:{r:.1568628,g:.6039216,b:.6039216}},"Billie Eilish":{_colorLeft:{r:.8,g:.6448193,b:.432},_colorRight:{r:.5480851,g:.6127659,b:.64},_envColorLeft:{r:.8196079,g:.442,b:.184},_envColorRight:{r:.9411765,g:.706771,b:.5647059},_envColorLeftBoost:{r:.8,g:0,b:0},_envColorRightBoost:{r:.5568628,g:.7019608,b:.7764707},_obstacleColor:{r:.7132531,g:.5614098,b:.7830189}},Spooky:{_colorLeft:{r:.8196079,g:.4980788,b:.2770275},_colorRight:{r:.3789474,g:.3578947,b:.4},_envColorLeft:{r:.9019608,g:.2300923,b:0},_envColorRight:{r:.4600588,g:.5688943,b:.9294118},_envColorLeftBoost:{r:.3376843,g:.6320754,b:.3369081},_envColorRightBoost:{r:.6020907,g:.3280082,b:.8584906},_obstacleColor:{r:.8196079,g:.4431373,b:.1843137}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.708,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_envColorLeftBoost:{r:.754717,g:.3610244,b:.2207191},_envColorRightBoost:{r:0,g:.7058824,b:1},_obstacleColor:{r:.9921569,g:0,b:.7719755}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.6320754,g:.6320754,b:.6320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"The Second":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8235294,g:.08627451,b:.8509804},_envColorRightBoost:{r:0,g:1,b:.6478302},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Lizzo:{_colorLeft:{r:1,g:.8132076,b:.3773585},_colorRight:{r:.6705883,g:.254902,b:.8980392},_envColorLeft:{r:.8392157,g:.6470588,b:.2156863},_envColorRight:{r:.8196079,g:.2392157,b:.8784314},_envColorLeftBoost:{r:1,g:.4,b:.5529412},_envColorRightBoost:{r:.3686275,g:.7960784,b:1},_obstacleColor:{r:1,g:.5020987,b:.1882353}},"The Weeknd":{_colorLeft:{r:.5843138,g:.1294118,b:.1294118},_colorRight:{r:.2235294,g:.2901961,b:.3294118},_envColorLeft:{r:1,g:.2979701,b:.1411765},_envColorRight:{r:.1668743,g:.3753689,b:.7075472},_envColorWhite:{r:.8773585,g:.8773585,b:.8773585},_envColorLeftBoost:{r:.9568628,g:.6039216,b:.1215686},_envColorRightBoost:{r:.5254902,g:.8274511,b:.9921569},_envColorWhiteBoost:{r:.9811321,g:.9308866,b:.8608046},_obstacleColor:{r:.9176471,g:.2980392,b:.007843138}},"Rock Mixtape":{_colorLeft:{r:.6,g:.4233,b:.042},_colorRight:{r:.6006,g:.7441199,b:.78},_envColorLeft:{r:.75,g:.12,b:.162},_envColorRight:{r:.95,g:.5820333,b:.1615},_envColorLeftBoost:{r:.96,g:.1344,b:.9187202},_envColorRightBoost:{r:.378,g:.813,b:.9},_obstacleColor:{r:1,g:1,b:1}},"Dragons 2.0":{_colorLeft:{r:.7264151,g:.6587077,b:.2809719},_colorRight:{r:.2509804,g:.7647059,b:.405098},_envColorLeft:{r:.01960784,g:.9960785,b:.06666667},_envColorRight:{r:0,g:.05490196,b:1},_envColorLeftBoost:{r:.9764706,g:.03137255,b:.01960784},_envColorRightBoost:{r:1,g:.8292086,b:.2264151},_obstacleColor:{r:.5548979,g:.2470588,b:1}},"Panic 2.0":{_colorLeft:{r:.9019608,g:.3333333,b:.5686275},_colorRight:{r:.1529412,g:.5568628,b:.4862745},_envColorLeft:{r:.6980392,g:.1137255,b:.372549},_envColorRight:{r:.1882353,g:.6196079,b:.6235294},_envColorWhite:{r:.8329412,g:.9008105,b:.9254902},_envColorLeftBoost:{r:.9019608,g:.4470589,b:.06666667},_envColorRightBoost:{r:.6365692,g:.4373443,b:.8584906},_envColorWhiteBoost:{r:.8803849,g:.8313726,b:.9254902},_obstacleColor:{r:.9686275,g:.3803922,b:.2745098}},Queen:{_colorLeft:{r:.58,g:.5675714,b:.5551428},_colorRight:{r:.5236231,g:.1345675,b:.6792453},_envColorLeft:{r:.9333334,g:.6392157,b:.1215686},_envColorRight:{r:.04313726,g:.7176471,b:.8980393},_envColorLeftBoost:{r:.7686275,g:.145098,b:.07450981},_envColorRightBoost:{r:.4,g:.007843138,b:.7254902},_obstacleColor:{r:.9333334,g:.6392157,b:.1215686}},"Linkin Park 2.0":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.6627451,g:.1647059,b:.172549},_envColorRight:{r:.6235294,g:.6901961,b:.7098039},_envColorWhite:{r:.7529413,g:.6745098,b:.5921569},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},"The Rolling Stones":{_colorLeft:{r:.8980392,g:0,b:.1150319},_colorRight:{r:.5254902,g:.1333333,b:.6784314},_envColorLeft:{r:.9529412,g:.01176471,b:.4039216},_envColorRight:{r:.4784314,g:.4039216,b:1},_envColorLeftBoost:{r:.5647059,g:.4622677,b:0},_envColorRightBoost:{r:.003921554,g:.6383545,b:.6705883},_obstacleColor:{r:.9529412,g:.01176471,b:.4039216}},Lattice:{_colorLeft:{r:.8392157,g:.172549,b:.5456773},_colorRight:{r:0,g:.6717121,b:.9803922},_envColorLeft:{r:.8941177,g:.1607843,b:.7490196},_envColorRight:{r:.1960784,g:.5843138,b:.7960785},_envColorLeftBoost:{r:.5450981,g:.1333333,b:.8156863},_envColorRightBoost:{r:.4039216,g:.9176471,b:.9176471},_obstacleColor:{r:.4685534,g:.7095922,b:1}},"Daft Punk":{_colorLeft:{r:.7215686,g:.2254902,b:.1803922},_colorRight:{r:.1215686,g:.6980392,b:.6901961},_envColorLeft:{r:1,g:.7017543,b:.2515723},_envColorRight:{r:.5215687,g:.3294118,b:.8196079},_envColorWhite:{r:.4784314,g:.8117647,b:1},_envColorLeftBoost:{r:.8588235,g:0,b:.4784314},_envColorRightBoost:{r:0,g:.8196079,b:.8039216},_envColorWhiteBoost:{r:1,g:.834256,b:.4874213},_obstacleColor:{r:.6068091,g:0,b:1}},"Hip Hop Mixtape":{_colorLeft:{r:1,g:.583857,b:.3137255},_colorRight:{r:.01542656,g:.6132076,b:.5896002},_envColorLeft:{r:.9137256,g:.4941177,b:0},_envColorRight:{r:.05882353,g:.8039216,b:.1843137},_envColorWhite:{r:.8000001,g:.7568628,b:.7058824},_envColorLeftBoost:{r:.1411765,g:1,b:.9686275},_envColorRightBoost:{r:.227451,g:.2745098,b:1},_envColorWhiteBoost:{r:.8784314,g:.8784314,b:.8784314},_obstacleColor:{r:1,g:.3137255,b:.5529412}},Collider:{_colorLeft:{r:.9647059,g:.4947137,b:.1504941},_colorRight:{r:.1686274,g:.5998134,b:.8588235},_envColorLeft:{r:.9637059,g:.4092787,b:0},_envColorRight:{r:.1686275,g:.3921569,b:.8588236},_envColorLeftBoost:{r:.8980393,g:.03529412,b:.02352941},_envColorRightBoost:{r:.854902,g:.4117647,b:.9725491},_obstacleColor:{r:.8396226,g:.09639232,b:0}},"Britney Spears":{_colorLeft:{r:.9137255,g:.1411765,b:.6008013},_colorRight:{r:.2484275,g:.578789,b:1},_envColorLeft:{r:.9921569,g:.01176471,b:.9882353},_envColorRight:{r:.1921569,g:.5058824,b:.9058824},_envColorLeftBoost:{r:1,g:.4591194,b:.5087922},_envColorRightBoost:{r:.482353,g:.9294118,b:.7960785},_obstacleColor:{r:.8396226,g:.09639232,b:0}},"Monstercat 2.0":{_colorLeft:{r:.8745099,g:.3450981,b:.5215687},_colorRight:{r:.3882353,g:.3019608,b:.6117647},_envColorLeft:{r:.6196079,g:.0509804,b:.8274511},_envColorRight:{r:.3372549,g:.7137255,b:.1098039},_envColorLeftBoost:{r:.7137255,g:.1098039,b:.1098039},_envColorRightBoost:{r:.08627451,g:.5490196,b:.6470588},_obstacleColor:{r:.2313726,g:.1490196,b:.6392157}},Metallica:{_colorLeft:{r:.282353,g:.3333333,b:.4039216},_colorRight:{r:.5764706,g:.7176471,b:.8235294},_envColorLeft:{r:.8666667,g:.4941176,b:.3803922},_envColorRight:{r:.254902,g:.454902,b:.8666667},_envColorWhite:{r:.5137255,g:.6078314,b:.6784314},_envColorLeftBoost:{r:.8588235,g:.3921569,b:.09803922},_envColorRightBoost:{r:0,g:.7490196,b:.6313726},_envColorWhiteBoost:{r:.5137255,g:.6078314,b:.6784314},_obstacleColor:{r:.8392157,g:.09803922,b:0}}};function ct(e,t){return e.time-t.time}function Pn(e,t){return Array.isArray(e.customData.coordinates)&&Array.isArray(t.customData.coordinates)?e.time-t.time||e.customData.coordinates[0]-t.customData.coordinates[0]||e.customData.coordinates[1]-t.customData.coordinates[1]:Array.isArray(e.customData._position)&&Array.isArray(t.customData._position)?e.time-t.time||e.customData._position[0]-t.customData._position[0]||e.customData._position[1]-t.customData._position[1]:e.time-t.time||e.posX-t.posX||e.posY-t.posY}function zd(e,t){return e._time-t._time}function Gd(e,t){return Array.isArray(e._customData?._position)&&Array.isArray(t._customData?._position)?e._time-t._time||e._customData._position[0]-t._customData._position[0]||e._customData._position[1]-t._customData._position[1]:e._time-t._time||e._lineIndex-t._lineLayer||e._lineIndex-t._lineLayer}function Zs(e){return["convert","toV1Beatmap",e]}function jd(e,t=e.version){switch(se.tWarn(Zs("main"),"Converting beatmap to v1 may lose certain data!"),t){case 1:case 2:e.version=1;break;case 3:e.version=1,Wd(e);break;case 4:e.version=1,Hd(e);break;default:se.tWarn(Zs("main"),"Unknown version: version not supported; misinput? Returning original data.")}return e}function Wd(e){e.difficulty.customData._time=e.difficulty.customData.time,e.difficulty.customData._BPMChanges=e.difficulty.customData.BPMChanges?.map(t=>({_time:t.b,_BPM:t.m,_beatsPerBar:t.p,_metronomeOffset:t.o})),e.difficulty.customData._bookmarks=e.difficulty.customData.bookmarks?.map(t=>({_time:t.b,_name:t.n})),delete e.difficulty.customData.time,delete e.difficulty.customData.BPMChanges,delete e.difficulty.customData.bookmarks}function Hd(e){e.difficulty.customData._time=e.difficulty.customData.time??0;let t=!1;const i={},n=[e.difficulty.arcs,e.difficulty.bombNotes,e.difficulty.chains,e.difficulty.colorNotes,e.difficulty.obstacles,e.lightshow.waypoints].flat().sort(ct);for(let o=0;o<n.length;o++){const r=n[o];if(!(r.time in i))i[r.time]=r.laneRotation;else if(i[r.time]!==r.laneRotation){t=!0;break}}if(t)se.warn(Zs("fromV4"),"Impossible rotation event cannot be represented in v1!");else{e.difficulty.rotationEvents=[];let o=0;for(const r in i){const s=+r,a=i[r],l=a-o;l!==0&&(o=a,e.difficulty.rotationEvents.push({time:s,rotation:l,executionTime:0,customData:{}}))}}for(let o=0;o<n.length;o++){const r=n[o];r.laneRotation=0,"tailLaneRotation"in r&&(r.tailLaneRotation=0)}}function In(e){return e==="GlassDesertEnvironment"||e==="MultiplayerEnvironment"}function tl(e){return["convert","toV1Info",e]}function Yd(e,t=e.version){switch(se.tWarn(tl("main"),"Converting to beatmap v1 may lose certain data!"),t){case 1:case 2:case 3:case 4:e.environmentBase.normal=e.environmentBase.normal||e.environmentNames.find(i=>!In(i))||"DefaultEnvironment",e.version=1;break;default:se.tWarn(tl("main"),"Unknown version: version not supported; misinput? Returning original data.")}return e}function il(e){return["convert","toV2Audio",e]}function Xd(e,t=e.version){switch(se.tWarn(il("main"),"Converting to beatmap v2 may lose certain data!"),t){case 1:case 2:case 3:case 4:e.version=2;break;default:se.tWarn(il("main"),"Unknown version: version not supported; misinput? Returning original data.")}return e}function Be(e,t,i){e[i]??=e[t],delete e[t]}function qd(e){if(!e)return{};const t={...e};return _o(t)?{}:(Be(t,"color","_color"),Be(t,"lightID","_lightID"),Be(t,"easing","_easing"),Be(t,"lerpType","_lerpType"),Be(t,"nameFilter","_nameFilter"),Be(t,"rotation","_rotation"),Be(t,"step","_step"),Be(t,"prop","_prop"),Be(t,"speed","_speed"),Be(t,"direction","_direction"),Be(t,"lockRotation","_lockPosition"),t)}function Bn(e){if(!e)return{};const t={...e};return _o(t)?{}:(Be(t,"color","_color"),Be(t,"coordinates","_position"),Be(t,"disableNoteGravity","_disableNoteGravity"),Be(t,"disableNoteLook","_disableNoteLook"),Be(t,"flip","_flip"),Be(t,"localRotation","_localRotation"),Be(t,"noteJumpMovementSpeed","_noteJumpMovementSpeed"),Be(t,"noteJumpStartBeatOffset","_noteJumpStartBeatOffset"),Be(t,"size","_scale"),Be(t,"track","_track"),Be(t,"worldRotation","_rotation"),t._disableSpawnEffect??=typeof t.spawnEffect=="boolean"?!t.spawnEffect:void 0,delete t.spawnEffect,t._interactable??=typeof t.uninteractable=="boolean"?!t.uninteractable:void 0,delete t.uninteractable,t.animation&&(t._animation??={_color:t.animation.color,_definitePosition:t.animation.definitePosition,_dissolve:t.animation.dissolve,_dissolveArrow:t.animation.dissolveArrow,_interactable:t.animation.interactable,_localRotation:t.animation.localRotation,_position:t.animation.offsetPosition,_rotation:t.animation.offsetWorldRotation,_scale:t.animation.scale,_time:t.animation.time}),delete t.animation,t)}function co(e){return["convert","toV2Beatmap",e]}function Kd(e,t=e.version){switch(se.tWarn(co("main"),"Converting to beatmap v2 may lose certain data!"),t){case 1:case 2:e.version=2;break;case 3:e.version=2,nl(e);break;case 4:e.version=2,nl(e),Jd(e);break;default:se.tWarn(co("main"),"Unknown version: version not supported; misinput? Returning original data.")}return e}function nl(e){e.difficulty.colorNotes.forEach(t=>{t.customData=Bn(t.customData)}),e.difficulty.customData.fakeColorNotes?.forEach(t=>{const i=Bn(t.customData);e.difficulty.colorNotes.push({time:t.b??0,posX:t.x??0,posY:t.y??0,color:t.c??0,direction:t.d??0,angleOffset:0,laneRotation:0,customData:i})}),delete e.difficulty.customData.fakeColorNotes,e.difficulty.bombNotes.forEach(t=>{t.customData=Bn(t.customData)}),e.difficulty.customData.fakeBombNotes?.forEach(t=>{const i=Bn(t.customData);e.difficulty.bombNotes.push({time:t.b??0,posX:t.x??0,posY:t.y??0,color:-1,direction:0,laneRotation:0,customData:i})}),e.difficulty.obstacles.forEach(t=>{t.customData=Bn(t.customData)}),e.difficulty.customData.fakeObstacles?.forEach(t=>{const i=Bn(t.customData);e.difficulty.obstacles.push({time:t.b??0,posX:t.x??0,posY:t.y??0,duration:t.d??0,width:t.w??0,height:t.h??0,laneRotation:0,customData:i})}),e.lightshow.basicEvents.forEach(t=>{t.customData=qd(t.customData),dr(t.type)?delete t.customData._speed:delete t.customData._preciseSpeed});for(const t in e.difficulty.customData){if(t==="customEvents"){e.difficulty.customData._customEvents=[];for(const i of e.difficulty.customData.customEvents){if(i.t==="AnimateTrack")for(let n=0,o=i.d.repeat??0;n<=o;n++)e.difficulty.customData._customEvents.push({_time:i.b+(i.d.duration??0)*n,_type:"AnimateTrack",_data:{_track:i.d.track,_duration:i.d.duration,_easing:i.d.easing,_position:i.d.position,_rotation:i.d.rotation,_localRotation:i.d.localRotation,_scale:i.d.scale,_dissolve:i.d.dissolve,_dissolveArrow:i.d.dissolveArrow,_color:i.d.color,_interactable:i.d.interactable,_time:i.d.time}});i.t==="AssignPathAnimation"&&e.difficulty.customData._customEvents.push({_time:i.b,_type:"AssignPathAnimation",_data:{_track:i.d.track,_easing:i.d.easing,_position:i.d.position,_rotation:i.d.rotation,_localRotation:i.d.localRotation,_scale:i.d.scale,_dissolve:i.d.dissolve,_dissolveArrow:i.d.dissolveArrow,_color:i.d.color,_interactable:i.d.interactable,_definitePosition:i.d.definitePosition}}),i.t==="AssignTrackParent"&&e.difficulty.customData._customEvents.push({_time:i.b,_type:"AssignTrackParent",_data:{_childrenTracks:i.d.childrenTracks,_parentTrack:i.d.parentTrack,_worldPositionStays:i.d.worldPositionStays}}),i.t==="AssignPlayerToTrack"&&e.difficulty.customData._customEvents.push({_time:i.b,_type:"AssignPlayerToTrack",_data:{_track:i.d.track,_target:i.d.target}}),i.t==="AnimateComponent"&&i.d.BloomFogEnvironment&&e.difficulty.customData._customEvents.push({_time:i.b,_type:"AssignFogTrack",_data:{_track:i.d.track,_duration:i.d.duration,_attenuation:i.d.BloomFogEnvironment.attenuation,_height:i.d.BloomFogEnvironment.height,_offset:i.d.BloomFogEnvironment.offset,_startY:i.d.BloomFogEnvironment.startY}})}delete e.difficulty.customData.customEvents;continue}if(t==="environment"){e.difficulty.customData._environment=e.difficulty.customData.environment.map(i=>{if(i.id&&i.lookupMethod)return{_id:i.id,_lookupMethod:i.lookupMethod,_track:i.track,_duplicate:i.duplicate,_active:i.active,_scale:i.scale,_position:Oi(i.position,1/.6),_rotation:i.rotation,_localPosition:Oi(i.localPosition,1/.6),_localRotation:i.localRotation,_lightID:i.components?.ILightWithId?.lightID};if(i.geometry)return(i.components?.ILightWithId?.type||i.components?.ILightWithId?.lightID)&&se.tWarn(co("fromV2"),"v2 geometry cannot be made assignable light to specific type"),{_geometry:i.geometry.type==="CUSTOM"?{_type:i.geometry.type,_mesh:{_vertices:i.geometry.mesh.vertices,_uv:i.geometry.mesh.uv,_triangles:i.geometry.mesh.triangles},_material:typeof i.geometry.material=="string"?i.geometry.material:{_shader:i.geometry.material.shader,_shaderKeywords:i.geometry.material.shaderKeywords,_collision:i.geometry.material.collision,_track:i.geometry.material.track,_color:i.geometry.material.color},_collision:i.geometry.collision}:{_type:i.geometry.type,_material:typeof i.geometry.material=="string"?i.geometry.material:{_shader:i.geometry.material.shader,_shaderKeywords:i.geometry.material.shaderKeywords,_collision:i.geometry.material.collision,_track:i.geometry.material.track,_color:i.geometry.material.color},_collision:i.geometry.collision},_track:i.track,_duplicate:i.duplicate,_active:i.active,_scale:i.scale,_position:Oi(i.position,1/.6),_rotation:i.rotation,_localPosition:Oi(i.localPosition,1/.6),_localRotation:i.localRotation,_lightID:i.components?.ILightWithId?.lightID};throw new Error("Error converting environment v3 to v2")}),delete e.difficulty.customData.environment;continue}if(t==="materials"){e.difficulty.customData._materials={};for(const i in e.difficulty.customData.materials)e.difficulty.customData._materials[i]={_shader:e.difficulty.customData.materials[i].shader,_shaderKeywords:e.difficulty.customData.materials[i].shaderKeywords,_collision:e.difficulty.customData.materials[i].collision,_track:e.difficulty.customData.materials[i].track,_color:e.difficulty.customData.materials[i].color};delete e.difficulty.customData.materials;continue}if(t==="pointDefinitions"){e.difficulty.customData._pointDefinitions=[];for(const i in e.difficulty.customData.pointDefinitions)e.difficulty.customData._pointDefinitions.push({_name:i,_points:e.difficulty.customData.pointDefinitions[i]});delete e.difficulty.customData.pointDefinitions;continue}if(t==="time"){e.difficulty.customData._time=e.difficulty.customData[t],delete e.difficulty.customData.time;continue}if(t==="BPMChanges"){e.difficulty.customData._BPMChanges=e.difficulty.customData[t]?.map(i=>({_time:i.b,_BPM:i.m,_beatsPerBar:i.p,_metronomeOffset:i.o})),delete e.difficulty.customData.BPMChanges;continue}if(t==="bookmarks"){e.difficulty.customData._bookmarks=e.difficulty.customData[t]?.map(i=>({_time:i.b,_name:i.n,_color:i.c})),delete e.difficulty.customData.bookmarks;continue}}if(e.difficulty.customData._environment){const t=[];for(const n of e.difficulty.customData._environment)n._track&&t.push(n._track);const i=[];if(e.difficulty.customData._customEvents){for(const n of e.difficulty.customData._customEvents)if(n._type==="AnimateTrack"){if(typeof n._data._track=="string"&&t.includes(n._data._track))i.push(n);else if(Array.isArray(n._data._track)){for(const o of n._data._track)if(t.includes(o)){i.push(n);break}}}}for(const n of i)typeof n._data._track=="string"?typeof n._data._position=="string"?se.tWarn(co("fromV2"),"Cannot convert point definitions, unknown use."):Array.isArray(n._data._position)&&(Xu(n._data._position)?Oi(n._data._position,.6):n._data._position.forEach(o=>{o[0]*=.6,o[1]*=.6,o[2]*=.6})):se.tWarn(co("fromV2"),"Environment animate track array conversion not yet implemented.")}}function Jd(e){let t=!1;const i={},n=[e.difficulty.arcs,e.difficulty.bombNotes,e.difficulty.chains,e.difficulty.colorNotes,e.difficulty.obstacles,e.lightshow.waypoints].flat().sort(ct);for(let o=0;o<n.length;o++){const r=n[o];if(!(r.time in i))i[r.time]=r.laneRotation;else if(i[r.time]!==r.laneRotation){t=!0;break}}if(t)for(let o=0;o<n.length;o++){const r=n[o];r.laneRotation&&(r.customData._rotation=r.laneRotation)}else{e.difficulty.rotationEvents=[];let o=0;for(const r in i){const s=+r,a=i[r],l=a-o;l!==0&&(o=a,e.difficulty.rotationEvents.push({time:s,rotation:l,executionTime:0,customData:{}}))}}for(let o=0;o<n.length;o++){const r=n[o];r.laneRotation=0,"tailLaneRotation"in r&&(r.tailLaneRotation=0)}}function ol(e){return["convert","toV2Info",e]}function Zd(e,t=e.version){switch(se.tWarn(ol("main"),"Converting to beatmap v2 may lose certain data!"),t){case 1:case 2:case 3:case 4:e.environmentBase.normal=e.environmentBase.normal||e.environmentNames.find(i=>!In(i))||"DefaultEnvironment",e.environmentBase.allDirections=e.environmentBase.allDirections||e.environmentNames.find(i=>In(i))||"DefaultEnvironment",e.version=2;break;default:se.tWarn(ol("main"),"Unknown version: version not supported; misinput? Returning original data.")}return e}function Qd(e){if(!e)return{};const t={...e};return _o(t)?{}:(Be(t,"_color","color"),Be(t,"_lightID","lightID"),Be(t,"_easing","easing"),Be(t,"_lerpType","lerpType"),Be(t,"_nameFilter","nameFilter"),Be(t,"_rotation","rotation"),Be(t,"_step","step"),Be(t,"_prop","prop"),Be(t,"_direction","direction"),Be(t,"_lockPosition","lockRotation"),typeof t._preciseSpeed=="number"?t.speed=t._preciseSpeed:t.speed??=t._speed,delete t._speed,delete t._preciseSpeed,delete t._propID,delete t._lightGradient,delete t._reset,delete t._counterSpin,delete t._stepMult,delete t._propMult,delete t._speedMult,t)}function Ts(e){if(!e)return{};const t={...e};return _o(t)?{}:(Be(t,"_color","color"),Be(t,"_position","coordinates"),Be(t,"_disableNoteGravity","disableNoteGravity"),Be(t,"_disableNoteLook","disableNoteLook"),Be(t,"_flip","flip"),Be(t,"_localRotation","localRotation"),Be(t,"_noteJumpMovementSpeed","noteJumpMovementSpeed"),Be(t,"_noteJumpStartBeatOffset","noteJumpStartBeatOffset"),Be(t,"_scale","size"),Be(t,"_track","track"),Be(t,"_rotation","worldRotation"),t.spawnEffect??=typeof t._disableSpawnEffect=="boolean"?!t._disableSpawnEffect:void 0,delete t._disableSpawnEffect,t.uninteractable??=typeof t._interactable=="boolean"?!t._interactable:void 0,delete t._interactable,t._animation&&(t.animation??={color:t._animation._color,definitePosition:t._animation._definitePosition,dissolve:t._animation._dissolve,dissolveArrow:t._animation._dissolveArrow,interactable:t._animation._interactable,localRotation:t._animation._localRotation,offsetPosition:t._animation._position,offsetWorldRotation:t._animation._rotation,scale:t._animation._scale,time:t._animation._time}),delete t._animation,t)}function hi(e){return["convert","toV3Beatmap",e]}function sc(e,t=e.version){switch(se.tWarn(hi("main"),"Converting to beatmap v3 may lose certain data!"),t){case 1:e.version=3,Ud(e);break;case 2:e.version=3,e0(e);break;case 3:break;case 4:t0(e),e.version=3;break;default:se.tWarn(hi("main"),"Unknown version: version not supported; misinput? Returning original data.")}return e}function Ud(e){e.difficulty.colorNotes.forEach(t=>{t.direction>=1e3&&(t.angleOffset=Math.abs(t.direction%1e3%360-360),t.direction=t.direction>=1e3||typeof t.customData._cutDirection=="number"?t.direction===8?8:1:Yu(t.direction,0,8))}),e.difficulty.customData.time=e.difficulty.customData._time,e.difficulty.customData.BPMChanges=e.difficulty.customData._BPMChanges?.map(t=>({b:t._time,m:t._bpm??t._BPM,p:t._beatsPerBar,o:t._metronomeOffset})),e.difficulty.customData.bookmarks=e.difficulty.customData._bookmarks?.map(t=>({b:t._time,n:t._name}))}function e0(e){e.difficulty.customData.fakeColorNotes=[],e.difficulty.customData.fakeBombNotes=[],e.difficulty.customData.fakeObstacles=[];const t=[];e.difficulty.colorNotes.forEach((o,r)=>{const s=Ts(o.customData);typeof o.customData._cutDirection=="number"&&se.tDebug(hi("fromV2"),`colorNotes[${r}] at time ${o.time} NE _cutDirection will be converted.`);let a=0;typeof o.customData._cutDirection=="number"?a=o.customData._cutDirection>0?o.customData._cutDirection%360:360+o.customData._cutDirection%360:o.direction>=1e3&&(a=Math.abs(o.direction%1e3%360-360));const l=o.direction>=1e3||typeof o.customData._cutDirection=="number"?o.direction===8?8:1:Yu(o.direction,0,8);o.customData._fake?e.difficulty.customData.fakeColorNotes.push({b:o.time,c:o.color,x:o.posX,y:o.posY,d:l,a,customData:s}):(o.direction=l,o.angleOffset=a,o.customData=s,t.push(o))}),e.difficulty.colorNotes=t;const i=[];e.difficulty.bombNotes.forEach((o,r)=>{const s=Ts(o.customData);typeof o.customData._cutDirection=="number"&&se.tDebug(hi("fromV2"),`bombNotes[${r}] at time ${o.time} NE _cutDirection will be converted.`),o.customData._fake?e.difficulty.customData.fakeBombNotes.push({b:o.time,x:o.posX,y:o.posY,customData:s}):(o.customData=s,i.push(o))}),e.difficulty.bombNotes=i;const n=[];e.difficulty.obstacles.forEach(o=>{const r=Ts(o.customData);o.customData._fake?e.difficulty.customData.fakeObstacles.push({b:o.time,x:o.posX,y:o.posY,d:o.duration,w:o.width,h:o.height,customData:r}):(o.customData=r,n.push(o))}),e.difficulty.obstacles=n,e.lightshow.basicEvents.forEach((o,r)=>{const s=Qd(o.customData);Do(o.type)&&(o.customData._propID&&se.tWarn(hi("fromV2"),`events[${r}] at time ${o.time} Chroma _propID will be removed.`),o.customData._lightGradient&&se.tWarn(hi("fromV2"),`events[${r}] at time ${o.time} Chroma _lightGradient will be removed.`)),ma(o.type)&&(o.customData._reset&&se.tWarn(hi("fromV2"),`events[${r}] at time ${o.time} Chroma _reset will be removed.`),o.customData._counterSpin&&se.tWarn(hi("fromV2"),`events[${r}] at time ${o.time} Chroma _counterSpin will be removed.`),(o.customData._stepMult||o.customData._propMult||o.customData._speedMult)&&se.tWarn(hi("fromV2"),`events[${r}] at time ${o.time} Chroma _mult will be removed.`)),o.customData=s});for(const o in e.difficulty.customData){if(o==="_customEvents"){e.difficulty.customData.customEvents=[],e.difficulty.customData._customEvents.forEach(r=>{r._type==="AnimateTrack"&&e.difficulty.customData.customEvents?.push({b:r._time,t:"AnimateTrack",d:{track:r._data._track,duration:r._data._duration,easing:r._data._easing,position:r._data._position,rotation:r._data._rotation,localRotation:r._data._localRotation,scale:r._data._scale,dissolve:r._data._dissolve,dissolveArrow:r._data._dissolveArrow,color:r._data._color,interactable:r._data._interactable,time:r._data._time}}),r._type==="AssignPathAnimation"&&e.difficulty.customData.customEvents?.push({b:r._time,t:"AssignPathAnimation",d:{track:r._data._track,easing:r._data._easing,position:r._data._position,rotation:r._data._rotation,localRotation:r._data._localRotation,scale:r._data._scale,dissolve:r._data._dissolve,dissolveArrow:r._data._dissolveArrow,color:r._data._color,interactable:r._data._interactable,definitePosition:r._data._definitePosition}}),r._type==="AssignTrackParent"&&e.difficulty.customData.customEvents?.push({b:r._time,t:"AssignTrackParent",d:{childrenTracks:r._data._childrenTracks,parentTrack:r._data._parentTrack,worldPositionStays:r._data._worldPositionStays}}),r._type==="AssignPlayerToTrack"&&e.difficulty.customData.customEvents?.push({b:r._time,t:"AssignPlayerToTrack",d:{track:r._data._track,target:r._data._target}}),r._type==="AssignFogTrack"&&e.difficulty.customData.customEvents?.push({b:r._time,t:"AnimateComponent",d:{track:r._data._track,duration:r._data._duration||0,BloomFogEnvironment:{attenuation:typeof r._data._attenuation=="number"?[[r._data._attenuation,0]]:r._data._attenuation,height:typeof r._data._height=="number"?[[r._data._height,0]]:r._data._height,offset:typeof r._data._offset=="number"?[[r._data._offset,0]]:r._data._offset,startY:typeof r._data._startY=="number"?[[r._data._startY,0]]:r._data._startY}}})}),delete e.difficulty.customData._customEvents;continue}if(o==="_environment"){e.difficulty.customData.environment=e.difficulty.customData._environment.map(r=>{let s={};if(r._lightID&&(s={ILightWithId:{lightID:r._lightID}}),r._id&&r._lookupMethod)return{id:r._id,lookupMethod:r._lookupMethod,track:r._track,duplicate:r._duplicate,active:r._active,scale:r._scale,position:Oi(r._position,.6),rotation:r._rotation,localPosition:Oi(r._localPosition,.6),localRotation:r._localRotation,components:s};if(r._geometry)return r._lightID&&s.ILightWithId&&(s.ILightWithId.type=0),{geometry:r._geometry._type==="CUSTOM"?{type:r._geometry._type,mesh:{vertices:r._geometry._mesh._vertices,uv:r._geometry._mesh._uv,triangles:r._geometry._mesh._triangles},material:typeof r._geometry._material=="string"?r._geometry._material:{shader:r._geometry._material._shader,shaderKeywords:r._geometry._material._shaderKeywords,collision:r._geometry._material._collision,track:r._geometry._material._track,color:r._geometry._material._color},collision:r._geometry._collision}:{type:r._geometry._type,material:typeof r._geometry._material=="string"?r._geometry._material:{shader:r._geometry._material._shader,shaderKeywords:r._geometry._material._shaderKeywords,collision:r._geometry._material._collision,track:r._geometry._material._track,color:r._geometry._material._color},collision:r._geometry._collision},track:r._track,duplicate:r._duplicate,active:r._active,scale:r._scale,position:Oi(r._position,.6),rotation:r._rotation,localPosition:Oi(r._localPosition,.6),localRotation:r._localRotation,components:s};throw new Error("Error converting environment v2 to v3")}),delete e.difficulty.customData._environment;continue}if(o==="_materials"){e.difficulty.customData.materials={};for(const r in e.difficulty.customData._materials)e.difficulty.customData.materials[r]={shader:e.difficulty.customData._materials[r]._shader,shaderKeywords:e.difficulty.customData._materials[r]._shaderKeywords,collision:e.difficulty.customData._materials[r]._collision,track:e.difficulty.customData._materials[r]._track,color:e.difficulty.customData._materials[r]._color};delete e.difficulty.customData._materials;continue}if(o==="_pointDefinitions"){e.difficulty.customData.pointDefinitions={},e.difficulty.customData._pointDefinitions.forEach(r=>{e.difficulty.customData.pointDefinitions[r._name]=r._points}),delete e.difficulty.customData._pointDefinitions;continue}if(o==="_time"){e.difficulty.customData.time=e.difficulty.customData[o],delete e.difficulty.customData._time;continue}if(o==="_BPMChanges"){e.difficulty.customData.BPMChanges=e.difficulty.customData[o]?.map(r=>({b:r._time,m:r._BPM,p:r._beatsPerBar,o:r._metronomeOffset})),delete e.difficulty.customData._BPMChanges;continue}if(o==="_bpmChanges"){e.difficulty.customData.BPMChanges=e.difficulty.customData[o]?.map(r=>({b:r._time,m:r._bpm,p:r._beatsPerBar,o:r._metronomeOffset})),delete e.difficulty.customData._bpmChanges;continue}if(o==="_bookmarks"){e.difficulty.customData.bookmarks=e.difficulty.customData._bookmarks?.map(r=>({b:r._time,n:r._name,c:r._color})),delete e.difficulty.customData._bookmarks;continue}}if(e.difficulty.customData.environment){const o=[];for(const s of e.difficulty.customData.environment)s.track&&o.push(s.track);const r=[];if(e.difficulty.customData.customEvents){for(const s of e.difficulty.customData.customEvents)if(s.t==="AnimateTrack"){if(typeof s.d.track=="string"&&o.includes(s.d.track))r.push(s);else if(Array.isArray(s.d.track)){for(const a of s.d.track)if(o.includes(a)){r.push(s);break}}}}for(const s of r)typeof s.d.track=="string"?typeof s.d.position=="string"?se.tWarn(hi("fromV2"),"Cannot convert point definitions, unknown use."):Array.isArray(s.d.position)&&(Xu(s.d.position)?Oi(s.d.position,.6):s.d.position.forEach(a=>{typeof a!="string"&&typeof a=="number"&&(a*=.6)})):se.tWarn(hi("fromV2"),"Environment animate track array conversion not yet implemented.")}e.lightshow.useNormalEventsAsCompatibleEvents=!0}function t0(e){let t=!1;const i={},n=[e.difficulty.arcs,e.difficulty.bombNotes,e.difficulty.chains,e.difficulty.colorNotes,e.difficulty.obstacles,e.lightshow.waypoints].flat().sort(ct);for(let o=0;o<n.length;o++){const r=n[o];if(!(r.time in i))i[r.time]=r.laneRotation;else if(i[r.time]!==r.laneRotation){t=!0;break}}if(t)for(let o=0;o<n.length;o++){const r=n[o];r.laneRotation&&(r.customData.worldRotation=r.laneRotation)}else{e.difficulty.rotationEvents=[];let o=0;for(const r in i){const s=+r,a=i[r],l=a-o;l!==0&&(o=a,e.difficulty.rotationEvents.push({time:s,rotation:l,executionTime:0,customData:{}}))}}for(let o=0;o<n.length;o++){const r=n[o];r.laneRotation=0,"tailLaneRotation"in r&&(r.tailLaneRotation=0)}}function rl(e){return["convert","toV4Audio",e]}function i0(e,t=e.version){switch(se.tWarn(rl("main"),"Converting to beatmap v4 may lose certain data!"),t){case 1:case 2:case 3:case 4:e.version=4;break;default:se.tWarn(rl("main"),"Unknown version: version not supported; misinput? Returning original data.")}return e}function n0(e){return["convert","toV4Beatmap",e]}function o0(e,t=e.version){se.tWarn(n0("main"),"As v4 is similar to v3, the conversion will use v3 convertor alongside."),sc(e,t),e.version=4;const i=[e.difficulty.arcs,e.difficulty.bombNotes,e.difficulty.chains,e.difficulty.colorNotes,e.difficulty.obstacles,e.lightshow.waypoints].flat().sort(ct);if(e.difficulty.rotationEvents.length){const n=[...e.difficulty.rotationEvents].sort((r,s)=>r.executionTime-s.executionTime).sort(ct);let o=0;for(const r of n)o+=r.rotation;for(let r=i.length-1;r>=0;r--){const s=i[r];let a=n.at(-1);for(;a&&a.time>s.time;)n.pop(),o-=a.rotation,a=n.at(-1);if(!a)break;if(a.time===s.time&&a.executionTime===Ju.EARLY){s.laneRotation=Math.round(o%360),"tailLaneRotation"in s&&(s.tailLaneRotation=s.laneRotation);continue}for(;a&&a.time>=s.time;)n.pop(),o-=a.rotation,a=n.at(-1);if(!a)break;s.laneRotation=Math.round(o%360),"tailLaneRotation"in s&&(s.tailLaneRotation=s.laneRotation)}e.difficulty.rotationEvents=[]}for(let n=0;n<i.length;n++){const o=i[n];typeof o.customData.worldRotation=="number"&&(o.laneRotation=Math.round(o.customData.worldRotation),"tailLaneRotation"in o&&(o.tailLaneRotation=o.customData.worldRotation),delete o.customData.worldRotation)}return e}function sl(e){return["convert","toV4Info",e]}function r0(e,t=e.version){switch(se.tWarn(sl("main"),"Converting to beatmap v4 may lose certain data!"),t){case 1:e.environmentNames=[e.environmentBase.normal||"DefaultEnvironment"],e.difficulties.forEach(i=>{i.environmentId=0});case 2:case 3:case 4:e.version=4;break;default:se.tWarn(sl("main"),"Unknown version: version not supported; misinput? Returning original data.")}return e}class s0{clone(){return new this.constructor(this)}}class Pi extends s0{constructor(){super(...arguments),Object.defineProperty(this,"customData",{enumerable:!0,configurable:!0,writable:!0,value:{}})}reconcile(){return this}setCustomData(t){return this.customData=t,this}resetCustomData(){return this.customData={},this}removeCustomData(t){return typeof t=="string"?delete this.customData[t]:t.forEach(i=>delete this.customData[i]),this}addCustomData(t){for(const i in t)this.customData[i]=t[i];return this}sort(t){return t?.(this),this}perform(t){return t(this),this}isValid(t,i){return t?!!t(this):!0}check(t){return t?!!t(this):!1}}function Qs(e){return e===pe.RED}function ac(e){return e===pe.BLUE}function a0(e){return e===pe.NONE}function l0(e,t,i=.01){return t.time>e.time-i&&t.time<e.time+i&&e.color!==t.color}function Pt(e){return Wi[e]??0}function u0(e){return qu([pe.RED,pe.BLUE],e)}function lc(e){switch(e){case z.UP_LEFT:case z.LEFT:case z.DOWN_LEFT:return e+1;case z.UP_RIGHT:case z.RIGHT:case z.DOWN_RIGHT:return e-1;default:return e}}function zt(e){return[e.posX,e.posY]}function ln(e,t,i){const n=i?.(e)??zt(e),o=i?.(t)??zt(t);return Ks(n,o)}function $n(e,t,i=.001,n){const o=n?.(e)??zt(e),r=n?.(t)??zt(t);return gd(o,r,i)}function Fn(e,t,i=.001,n){const o=n?.(e)??zt(e),r=n?.(t)??zt(t);return bd(o,r,i)}function br(e,t,i=.001,n){const o=n?.(e)??zt(e),r=n?.(t)??zt(t);return vd(o,r,i)}function Xn(e,t,i=.5,n){return ln(e,t,n)<=i}function c0(e,t,i=.001,n){const o=ln(e,t,n);return o>.5-i&&o<1+i}function da(e,t,i=1.8,n){return ln(e,t,n)>i}function gr(e,t,i){return da(e,t,1.8,i)&&!br(e,t,.001,i)&&!$n(e,t,.001,i)&&!Fn(e,t,.001,i)}function vr(e,t){return t-1-e}class ui extends Pi{constructor(){super(...arguments),Object.defineProperty(this,"time",{enumerable:!0,configurable:!0,writable:!0,value:0})}setTime(t){return this.time=t,this}}class ba extends ui{constructor(){super(...arguments),Object.defineProperty(this,"posX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"posY",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"laneRotation",{enumerable:!0,configurable:!0,writable:!0,value:0})}setPosX(t){return this.posX=t,this}setPosY(t){return this.posY=t,this}setLaneRotation(t){return this.laneRotation=t,this}mirror(t,i){return i?.(this),this.posX=vr(this.posX,pr),this}getPosition(t){return t?.(this)??ca(zt(this),[-2])}getDistance(t,i){return ln(this,t,n=>n.getPosition(i))}isVertical(t,i){return Fn(this,t,.001,n=>n.getPosition(i))}isHorizontal(t,i){return $n(this,t,.001,n=>n.getPosition(i))}isDiagonal(t,i){return br(this,t,.001,n=>n.getPosition(i))}isInline(t,i,n){return Xn(this,t,i??.5,o=>o.getPosition(n))}isAdjacent(t,i){return c0(this,t,.001,n=>n.getPosition(i))}isWindow(t,i,n){return da(this,t,i??1.8,o=>o.getPosition(n))}isSlantedWindow(t,i){return gr(this,t,n=>n.getPosition(i))}}class ga extends ba{constructor(){super(...arguments),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"direction",{enumerable:!0,configurable:!0,writable:!0,value:0})}setColor(t){return this.color=t,this}setDirection(t){return this.direction=t,this}mirror(t=!0,i){return i?.(this),t&&(this.color=u0(this.color)),this.direction=lc(this.direction),super.mirror(t)}isRed(){return Qs(this.color)}isBlue(){return ac(this.color)}getAngle(t){return t?.(this)??Pt(this.direction)}isDouble(t,i=.01){return l0(this,t,i)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.direction>=0&&this.direction<=8}}function va(e){return e.time>e.tailTime}class uc extends ga{constructor(){super(...arguments),Object.defineProperty(this,"tailTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tailPosX",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tailPosY",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"tailLaneRotation",{enumerable:!0,configurable:!0,writable:!0,value:0})}setTailTime(t){return this.tailTime=t,this}setTailPosX(t){return this.tailPosX=t,this}setTailPosY(t){return this.tailPosY=t,this}setTailLaneRotation(t){return this.tailLaneRotation=t,this}mirror(t=!0,i){return i?.(this),this.tailPosX=vr(this.tailPosX,pr),super.mirror(t)}getTailPosition(t){return t?.(this)??ca(zt({posX:this.tailPosX,posY:this.tailPosY}),[-2])}isInverse(){return va(this)}}class Er extends Pi{constructor(){super(...arguments),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"beatDistribution",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"beatDistributionType",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"easing",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"affectFirst",{enumerable:!0,configurable:!0,writable:!0,value:0})}setFilter(t){return this.filter=t,this}setBeatDistribution(t){return this.beatDistribution=t,this}setBeatDistributionType(t){return this.beatDistributionType=t,this}setEasing(t){return this.easing=t,this}setAffectFirst(t){return this.affectFirst=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.beatDistributionType===1||this.beatDistributionType===2)&&this.easing>=-1&&this.easing<=103&&this.events.every(n=>typeof n=="number"||n.isValid())&&this.filter.isValid()}}class yr extends ui{constructor(){super(...arguments),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:0})}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.id>=0&&this.boxes.every(n=>n.isValid())}}function f0(e){return qu([Js.CLOCKWISE,Js.COUNTER_CLOCKWISE],e)}function To(e={}){return{time:e.time??0,posX:e.posX??0,posY:e.posY??0,color:e.color??0,direction:e.direction??0,lengthMultiplier:e.lengthMultiplier??0,tailTime:e.tailTime??0,tailPosX:e.tailPosX??0,tailPosY:e.tailPosY??0,tailDirection:e.tailDirection??0,tailLengthMultiplier:e.tailLengthMultiplier??0,midAnchor:e.midAnchor??0,laneRotation:e.laneRotation??0,tailLaneRotation:e.tailLaneRotation??0,customData:N(e.customData??{})}}class at extends uc{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"lengthMultiplier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tailLengthMultiplier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tailDirection",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"midAnchor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??at.defaultValue.time,this.posX=t.posX??at.defaultValue.posX,this.posY=t.posY??at.defaultValue.posY,this.color=t.color??at.defaultValue.color,this.direction=t.direction??at.defaultValue.direction,this.lengthMultiplier=t.lengthMultiplier??at.defaultValue.lengthMultiplier,this.tailTime=t.tailTime??at.defaultValue.tailTime,this.tailPosX=t.tailPosX??at.defaultValue.tailPosX,this.tailPosY=t.tailPosY??at.defaultValue.tailPosY,this.tailDirection=t.tailDirection??at.defaultValue.tailDirection,this.tailLengthMultiplier=t.tailLengthMultiplier??at.defaultValue.tailLengthMultiplier,this.midAnchor=t.midAnchor??at.defaultValue.midAnchor,this.laneRotation=t.laneRotation??at.defaultValue.laneRotation,this.tailLaneRotation=t.tailLaneRotation??at.defaultValue.tailLaneRotation,this.customData=N(t.customData??at.defaultValue.customData)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&!(this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3||this.posX===this.tailPosX&&this.posY===this.tailPosY&&this.time===this.tailTime)}setLengthMultiplier(t){return this.lengthMultiplier=t,this}setTailLengthMultiplier(t){return this.tailLengthMultiplier=t,this}setTailDirection(t){return this.tailDirection=t,this}setMidAnchor(t){return this.midAnchor=t,this}mirror(t=!0,i){return i?.(this),this.tailDirection=lc(this.direction),this.midAnchor=f0(this.midAnchor),super.mirror(t)}getTailAngle(t){return t?.(this)||Pt(this.tailDirection)}}Object.defineProperty(at,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:To()});function Ea(e={}){return{version:e.version??-1,filename:e.filename??"AudioData.dat",audioChecksum:e.audioChecksum??"",sampleCount:e.sampleCount??44100,frequency:e.frequency??0,bpmData:e.bpmData?.map(t=>({startSampleIndex:t.startSampleIndex??0,endSampleIndex:t.endSampleIndex??0,startBeat:t.startBeat??0,endBeat:t.endBeat??0}))??[],lufsData:e.lufsData?.map(t=>({startSampleIndex:t.startSampleIndex??0,endSampleIndex:t.endSampleIndex??0,lufs:t.lufs??0}))??[],customData:N({...e.customData})}}class Li extends Pi{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filename",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audioChecksum",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampleCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bpmData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lufsData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.version=t.version??Li.defaultValue.version,this.filename=t.filename??Li.defaultValue.filename,this.audioChecksum=t.audioChecksum??Li.defaultValue.audioChecksum,this.sampleCount=t.sampleCount??Li.defaultValue.sampleCount,this.frequency=t.frequency??Li.defaultValue.frequency,this.bpmData=(t.bpmData??Li.defaultValue.bpmData).map(i=>({startBeat:i?.startBeat||0,startSampleIndex:i?.startSampleIndex||0,endBeat:i?.endBeat||0,endSampleIndex:i?.endSampleIndex||0})),this.lufsData=(t.lufsData??Li.defaultValue.lufsData).map(i=>({startSampleIndex:i?.startSampleIndex||0,endSampleIndex:i?.endSampleIndex||0,lufs:i?.lufs||0})),this.customData=N(t.customData??Li.defaultValue.customData)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.frequency>=0&&this.sampleCount>=0&&this.bpmData.every(n=>n.endBeat>n.startBeat&&n.endSampleIndex>n.startSampleIndex)}setFilename(t){return this.filename=t,this}setVersion(t){return this.version=t,this}setSampleCount(t){return this.sampleCount=t,this}setFrequency(t){return this.frequency=t,this}fromBpmEvents(t,i=44100,n){if(!t.length)return this;this.frequency=i,n&&(this.sampleCount=n),this.bpmData=[];for(let l=0;l<t.length-1;l++){const u=t[l],f=t[l+1];this.bpmData.push({startSampleIndex:Math.floor(u.time*this.frequency),endSampleIndex:Math.floor(f.time*this.frequency),startBeat:u.time,endBeat:f.time})}const o=t[t.length-1],r=Math.floor(o.time*this.frequency),a=(this.sampleCount-r)/this.frequency*(o.bpm/60);return this.bpmData.push({startSampleIndex:r,endSampleIndex:this.sampleCount,startBeat:o.time,endBeat:o.time+a}),this}getBpmEvents(){return this.bpmData.map(t=>{const i=t.endSampleIndex-t.startSampleIndex,n=(t.endBeat-t.startBeat)/(i/this.frequency)*60;return{time:t.startBeat,bpm:n,customData:{}}})}sort(){return this.bpmData.sort((t,i)=>t.startBeat-i.startBeat),this}}Object.defineProperty(Li,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Ea()});function qn(e={}){return{time:e.time??0,type:e.type??0,value:e.value??0,floatValue:e.floatValue??0,customData:N({...e.customData})}}class Bi extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"floatValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??Bi.defaultValue.time,this.type=t.type??Bi.defaultValue.type,this.value=t.value??Bi.defaultValue.value,this.floatValue=t.floatValue??Bi.defaultValue.floatValue,this.customData=N(t.customData??Bi.defaultValue.customData)}isValidType(){return fa(this.type)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.isOldChroma())}setType(t){return this.type=t,this}setValue(t){return this.value=t,this}setFloatValue(t){return this.floatValue=t,this}isOff(){return ha(this.value)}isOn(){return nc(this.value)}isFlash(){return oc(this.value)}isFade(){return rc(this.value)}isTransition(){return Pd(this.value)}isBlue(){return Md(this.value)}isRed(){return Id(this.value)}isWhite(){return $d(this.value)}isLightEvent(t){return Do(this.type)}isColorBoost(){return Nd(this.type)}isRingEvent(t){return ma(this.type)}isLaserRotationEvent(t){return dr(this.type)}isLaneRotationEvent(){return xd(this.type)}isExtraEvent(t){return ic(this.type)}isSpecialEvent(t){return Od(this.type)}isBpmEvent(){return Bd(this.type)}isNjsEvent(){return kd(this.type)}isLightingEvent(){return Ad(this.type)}isOldChroma(){return pa(this.value)}}Object.defineProperty(Bi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:qn()});function _r(e={}){return{keyword:e.keyword??"",events:e.events??[],customData:N({...e.customData})}}class Dn extends Pi{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"keyword",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyword=t.keyword??Dn.defaultValue.keyword,this.events=(t.events??Dn.defaultValue.events).map(i=>i).filter(i=>i),this.customData=N(t.customData??Dn.defaultValue.customData)}setKeyword(t){return this.keyword=t,this}setEvents(t){return this.events=t,this}addEvent(t){return this.events.push(t),this}removeEvent(t){const i=this.events.indexOf(t,0);return i>-1&&this.events.splice(i,1),this}}Object.defineProperty(Dn,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:_r()});function Ke(e,t){if(Array.isArray(e)){for(let i=0;i<e.length;i++)e[i]=e[i]instanceof t?e[i].reconcile():new t(e[i]);return e}return e instanceof t?e.reconcile():new t(e)}function Kn(e={}){return{time:e.time??0,posX:e.posX??0,posY:e.posY??0,color:-1,direction:e.direction??0,laneRotation:e.laneRotation??0,customData:N({...e.customData})}}class vi extends ga{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),this.time=t.time??vi.defaultValue.time,this.posX=t.posX??vi.defaultValue.posX,this.posY=t.posY??vi.defaultValue.posY,this.color=-1,this.direction=t.direction??vi.defaultValue.direction,this.laneRotation=t.laneRotation??vi.defaultValue.laneRotation,this.customData=N(t.customData??vi.defaultValue.customData)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.posX>=0&&this.posX<=3&&this.posY>=0&&this.posY<=2}}Object.defineProperty(vi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Kn()});function So(e={}){return{time:e.time??0,bpm:e.bpm??0,customData:N({...e.customData})}}class rn extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"bpm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??rn.defaultValue.time,this.bpm=t.bpm??rn.defaultValue.bpm,this.customData=N(t.customData??rn.defaultValue.customData)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.bpm>0}setBPM(t){return this.bpm=t,this}}Object.defineProperty(rn,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:So()});function Dr(e={}){return{time:e.time??0,posX:e.posX??0,posY:e.posY??0,color:e.color??0,direction:e.direction??0,laneRotation:e.laneRotation??0,tailTime:e.tailTime??0,tailPosX:e.tailPosX??0,tailPosY:e.tailPosY??0,tailLaneRotation:e.tailLaneRotation??0,sliceCount:e.sliceCount??0,squish:e.squish??0,customData:N({...e.customData})}}class Et extends uc{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"sliceCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"squish",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??Et.defaultValue.time,this.posX=t.posX??Et.defaultValue.posX,this.posY=t.posY??Et.defaultValue.posY,this.color=t.color??Et.defaultValue.color,this.direction=t.direction??Et.defaultValue.direction,this.laneRotation=t.laneRotation??Et.defaultValue.laneRotation,this.tailTime=t.tailTime??Et.defaultValue.tailTime,this.tailPosX=t.tailPosX??Et.defaultValue.tailPosX,this.tailPosY=t.tailPosY??Et.defaultValue.tailPosY,this.tailLaneRotation=t.tailLaneRotation??Et.defaultValue.tailLaneRotation,this.sliceCount=t.sliceCount??Et.defaultValue.sliceCount,this.squish=t.squish??Et.defaultValue.squish,this.customData=N(t.customData??Et.defaultValue.customData)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(!this.isInverse()||this.posY>=0||this.posY<=2||this.tailPosY>=0||this.tailPosY<=2)}setSliceCount(t){return this.sliceCount=t,this}setSquish(t){return this.squish=t,this}}Object.defineProperty(Et,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Dr()});function Jn(e={}){return{time:e.time??0,posX:e.posX??0,posY:e.posY??0,color:e.color??0,direction:e.direction??0,angleOffset:e.angleOffset??0,laneRotation:e.laneRotation??0,customData:N({...e.customData})}}class At extends ga{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"angleOffset",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"customData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??At.defaultValue.time,this.posX=t.posX??At.defaultValue.posX,this.posY=t.posY??At.defaultValue.posY,this.color=t.color??At.defaultValue.color,this.direction=t.direction??At.defaultValue.direction,this.angleOffset=t.angleOffset??At.defaultValue.angleOffset,this.laneRotation=t.laneRotation??At.defaultValue.laneRotation,this.customData=N(t.customData??At.defaultValue.customData)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.posX>=0&&this.posX<=3&&this.posY>=0&&this.posY<=2&&this.direction>=0&&this.direction<=8}setAngleOffset(t){return this.angleOffset=t,this}mirror(t=!0,i){return i?.(this),super.mirror(t)}getAngle(t){return t?.(this)??Pt(this.direction)+this.angleOffset}}Object.defineProperty(At,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Jn()});function ya(e={}){return{time:e.time??0,value:e.value??0,previous:e.previous??0,easing:e.easing??0,customData:N({...e.customData})}}class ki extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"previous",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"easing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??ki.defaultValue.time,this.value=t.value??ki.defaultValue.value,this.previous=t.previous??ki.defaultValue.previous,this.easing=t.easing??ki.defaultValue.easing,this.customData=N(t.customData??ki.defaultValue.customData)}setValue(t){return this.value=t,this}setPrevious(t){return this.previous=t,this}setEasing(t){return this.easing=t,this}}Object.defineProperty(ki,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:ya()});function Tr(e){return e.posX<0&&e.width>1-e.posX||e.posX===0&&e.width>1||e.posX===1||e.posX===2}function _a(e){return e.duration===0||e.width===0||e.height===0}function cc(e){return e.posY<0||e.duration<0||e.width<0||e.height<0}function Zn(e={}){return{time:e.time??0,posX:e.posX??0,posY:e.posY??0,width:e.width??0,height:e.height??0,duration:e.duration??0,laneRotation:e.laneRotation??0,customData:N({...e.customData})}}class bt extends ba{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"duration",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.time=t.time??bt.defaultValue.time,this.posX=t.posX??bt.defaultValue.posX,this.posY=t.posY??bt.defaultValue.posY,this.width=t.width??bt.defaultValue.width,this.height=t.height??bt.defaultValue.height,this.duration=t.duration??bt.defaultValue.duration,this.laneRotation=t.laneRotation??bt.defaultValue.laneRotation,this.customData=N(t.customData??bt.defaultValue.customData)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&!this.hasZero()&&!this.hasNegative()}setDuration(t){return this.duration=t,this}setWidth(t){return this.width=t,this}setHeight(t){return this.height=t,this}mirror(t,i){return i?.(this),this.posX=vr(this.posX+this.width-1,pr),this}getPosition(t){return t?.(this)??ca(zt(this),[-2,-.5])}isInteractive(){return Tr(this)}hasZero(){return _a(this)}hasNegative(){return cc(this)}}Object.defineProperty(bt,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Zn()});function Qn(e={}){return{time:e.time??0,executionTime:e.executionTime??0,rotation:e.rotation??0,customData:N({...e.customData})}}class Hi extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"executionTime",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"rotation",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.time=t.time??Hi.defaultValue.time,this.executionTime=t.executionTime??Hi.defaultValue.executionTime,this.rotation=t.rotation??Hi.defaultValue.rotation,this.customData=N(t.customData??Hi.defaultValue.customData)}setExecutionTime(t){return this.executionTime=t,this}setRotation(t){return this.rotation=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.executionTime===0||this.executionTime===1)}}Object.defineProperty(Hi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Qn()});function hn(e={}){return{bpmEvents:e.bpmEvents?.map(So)??[],rotationEvents:e.rotationEvents?.map(Qn)??[],colorNotes:e.colorNotes?.map(Jn)??[],bombNotes:e.bombNotes?.map(Kn)??[],obstacles:e.obstacles?.map(Zn)??[],arcs:e.arcs?.map(To)??[],chains:e.chains?.map(Dr)??[],njsEvents:e.njsEvents?.map(ya)??[],customData:N({...e.customData})}}class ni extends Pi{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"bpmEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotationEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"colorNotes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bombNotes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"obstacles",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"arcs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chains",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"njsEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"customData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bpmEvents=(t.bpmEvents??ni.defaultValue.bpmEvents).map(i=>new rn(i)),this.rotationEvents=(t.rotationEvents??ni.defaultValue.rotationEvents).map(i=>new Hi(i)),this.colorNotes=(t.colorNotes??ni.defaultValue.colorNotes).map(i=>new At(i)),this.bombNotes=(t.bombNotes??ni.defaultValue.bombNotes).map(i=>new vi(i)),this.obstacles=(t.obstacles??ni.defaultValue.obstacles).map(i=>new bt(i)),this.arcs=(t.arcs??ni.defaultValue.arcs).map(i=>new at(i)),this.chains=(t.chains??ni.defaultValue.chains).map(i=>new Et(i)),this.njsEvents=(t.njsEvents??ni.defaultValue.njsEvents).map(i=>new ki(i)),this.customData=N(t.customData??ni.defaultValue.customData)}reconcile(){return this.bpmEvents=Ke(this.bpmEvents,rn),this.rotationEvents=Ke(this.rotationEvents,Hi),this.colorNotes=Ke(this.colorNotes,At),this.bombNotes=Ke(this.bombNotes,vi),this.obstacles=Ke(this.obstacles,bt),this.arcs=Ke(this.arcs,at),this.chains=Ke(this.chains,Et),this.njsEvents=Ke(this.njsEvents,ki),this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.bpmEvents.every(n=>n.isValid())&&this.rotationEvents.every(n=>n.isValid())&&this.colorNotes.every(n=>n.isValid())&&this.bombNotes.every(n=>n.isValid())&&this.obstacles.every(n=>n.isValid())&&this.arcs.every(n=>n.isValid())&&this.chains.every(n=>n.isValid())}sort(){return this.bpmEvents.sort(ct),this.rotationEvents.sort(ct),this.colorNotes.sort(Pn),this.bombNotes.sort(Pn),this.obstacles.sort(ct),this.arcs.sort(Pn),this.chains.sort(Pn),this}allObjects(){return[...this.bpmEvents,...this.rotationEvents,...this.colorNotes,...this.bombNotes,...this.obstacles,...this.arcs,...this.chains,...this.njsEvents]}addBpmEvents(...t){for(const i of t)this.bpmEvents.push(new rn(i));return this}addRotationEvents(...t){for(const i of t)this.rotationEvents.push(new Hi(i));return this}addColorNotes(...t){for(const i of t)this.colorNotes.push(new At(i));return this}addBombNotes(...t){for(const i of t)this.bombNotes.push(new vi(i));return this}addObstacles(...t){for(const i of t)this.obstacles.push(new bt(i));return this}addArcs(...t){for(const i of t)this.arcs.push(new at(i));return this}addChains(...t){for(const i of t)this.chains.push(new Et(i));return this}addNjsEvents(...t){for(const i of t)this.njsEvents.push(new ki(i));return this}}Object.defineProperty(ni,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:hn()});function Un(e={}){return{time:e.time??0,toggle:e.toggle??!1,customData:N({...e.customData})}}class sn extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??sn.defaultValue.time,this.toggle=t.toggle??sn.defaultValue.toggle,this.customData=N(t.customData??sn.defaultValue.customData)}setToggle(t){return this.toggle=t,this}}Object.defineProperty(sn,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Un()});function Sr(e={}){return{time:e.time??0,easing:e.easing??0,previous:e.previous??0,value:e.value??0,customData:N({...e.customData})}}class Vi extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"easing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"previous",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??Vi.defaultValue.time,this.easing=t.easing??Vi.defaultValue.easing,this.previous=t.previous??Vi.defaultValue.previous,this.value=t.value??Vi.defaultValue.value,this.customData=N(t.customData??Vi.defaultValue.customData)}setEasing(t){return this.easing=t,this}setPrevious(t){return this.previous=t,this}setValue(t){return this.value=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=103}}Object.defineProperty(Vi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Sr()});function Cn(e={}){return{type:e.type??1,p0:e.p0??0,p1:e.p1??0,reverse:e.reverse??0,chunks:e.chunks??0,random:e.random??0,seed:e.seed??0,limit:e.limit??0,limitAffectsType:e.limitAffectsType??0,customData:N({...e.customData})}}class Dt extends Pi{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"p0",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"p1",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reverse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chunks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"limit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"limitAffectsType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"random",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type=t.type??Dt.defaultValue.type,this.p0=t.p0??Dt.defaultValue.p0,this.p1=t.p1??Dt.defaultValue.p1,this.reverse=t.reverse??Dt.defaultValue.reverse,this.chunks=t.chunks??Dt.defaultValue.chunks,this.random=t.random??Dt.defaultValue.random,this.seed=t.seed??Dt.defaultValue.seed,this.limit=t.limit??Dt.defaultValue.limit,this.limitAffectsType=t.limitAffectsType??Dt.defaultValue.limitAffectsType,this.customData=N(t.customData??Dt.defaultValue.customData)}setType(t){return this.type=t,this}setP0(t){return this.p0=t,this}setP1(t){return this.p1=t,this}setReverse(t){return this.reverse=t,this}setChunks(t){return this.chunks=t,this}setRandom(t){return this.random=t,this}setSeed(t){return this.seed=t,this}setLimit(t){return this.limit=t,this}setLimitAffectsType(t){return this.limitAffectsType=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.type===1||this.type===2)&&this.p0>=0&&this.p1>=0&&(this.reverse===0||this.reverse===1)&&this.chunks>=0&&this.random>=0&&this.random<=Uu.ALL&&this.limit>=0&&this.limit<=1&&this.limitAffectsType>=0&&this.limitAffectsType<=Qu.ALL}}Object.defineProperty(Dt,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Cn()});function wr(e={}){return{filter:Cn(e.filter),beatDistribution:e.beatDistribution??0,beatDistributionType:e.beatDistributionType??1,fxDistribution:e.fxDistribution??0,fxDistributionType:e.fxDistributionType??1,affectFirst:e.affectFirst??0,easing:e.easing??0,events:e.events?.map(Sr)??[],customData:N({...e.customData})}}class Wt extends Er{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"fxDistribution",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fxDistributionType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.filter=new Dt(t.filter??Wt.defaultValue.filter),this.beatDistribution=t.beatDistribution??Wt.defaultValue.beatDistribution,this.beatDistributionType=t.beatDistributionType??Wt.defaultValue.beatDistributionType,this.fxDistribution=t.fxDistribution??Wt.defaultValue.fxDistribution,this.fxDistributionType=t.fxDistributionType??Wt.defaultValue.fxDistributionType,this.affectFirst=t.affectFirst??Wt.defaultValue.affectFirst,this.easing=t.easing??Wt.defaultValue.easing,this.events=(t.events??Wt.defaultValue.events).map(i=>new Vi(i)),this.customData=N(t.customData??Wt.defaultValue.customData)}reconcile(){return this.filter=Ke(this.filter,Dt),this.events=Ke(this.events,Vi),this}setFxDistribution(t){return this.fxDistribution=t,this}setFxDistributionType(t){return this.fxDistributionType=t,this}setEvents(t){return this.events=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.fxDistributionType===1||this.fxDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}}Object.defineProperty(Wt,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:wr()});function Cr(e={}){return{time:e.time??0,id:e.id??0,boxes:e.boxes?.map(wr)??[],customData:N({...e.customData})}}class Yi extends yr{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"boxes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??Yi.defaultValue.time,this.id=t.id??Yi.defaultValue.id,this.boxes=(t.boxes??Yi.defaultValue.boxes).map(i=>new Wt(i)),this.customData=N(t.customData??Yi.defaultValue.customData)}reconcile(){this.boxes=Ke(this.boxes,Wt);for(let t=0;t<this.boxes.length;t++)this.boxes[t].reconcile();return this}}Object.defineProperty(Yi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Cr()});function Rr(e={}){return{time:e.time??0,previous:e.previous??0,color:e.color??0,frequency:e.frequency??0,brightness:e.brightness??0,strobeBrightness:e.strobeBrightness??0,strobeFade:e.strobeFade??0,easing:e.easing??0,customData:N({...e.customData})}}class Ht extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"previous",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"brightness",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strobeBrightness",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"strobeFade",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"easing",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??Ht.defaultValue.time,this.previous=t.previous??Ht.defaultValue.previous,this.color=t.color??Ht.defaultValue.color,this.frequency=t.frequency??Ht.defaultValue.frequency,this.brightness=t.brightness??Ht.defaultValue.brightness,this.strobeBrightness=t.strobeBrightness??Ht.defaultValue.strobeBrightness,this.strobeFade=t.strobeFade??Ht.defaultValue.strobeFade,this.easing=t.easing??Ht.defaultValue.easing,this.customData=N(t.customData??Ht.defaultValue.customData)}setPrevious(t){return this.previous=t,this}setColor(t){return this.color=t,this}setBrightness(t){return this.brightness=t,this}setFrequency(t){return this.frequency=t,this}setStrobeBrightness(t){return this.strobeBrightness=t,this}setStrobeFade(t){return this.strobeFade=t,this}setEasing(t){return this.easing=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=103&&this.color>=-1&&this.color<=2&&this.brightness>=0&&this.frequency>=0}}Object.defineProperty(Ht,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Rr()});function Lr(e={}){return{filter:Cn(e.filter),beatDistribution:e.beatDistribution??0,beatDistributionType:e.beatDistributionType??1,brightnessDistribution:e.brightnessDistribution??0,brightnessDistributionType:e.brightnessDistributionType??1,affectFirst:e.affectFirst??0,easing:e.easing??0,events:e.events?.map(t=>Rr(t))??[],customData:N({...e.customData})}}class Yt extends Er{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"brightnessDistribution",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"brightnessDistributionType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.filter=new Dt(t.filter??Yt.defaultValue.filter),this.beatDistribution=t.beatDistribution??Yt.defaultValue.beatDistribution,this.beatDistributionType=t.beatDistributionType??Yt.defaultValue.beatDistributionType,this.brightnessDistribution=t.brightnessDistribution??Yt.defaultValue.brightnessDistribution,this.brightnessDistributionType=t.brightnessDistributionType??Yt.defaultValue.brightnessDistributionType,this.affectFirst=t.affectFirst??Yt.defaultValue.affectFirst,this.easing=t.easing??Yt.defaultValue.easing,this.events=(t.events??Yt.defaultValue.events).map(i=>new Ht(i)),this.customData=N(t.customData??Yt.defaultValue.customData)}reconcile(){return this.events=Ke(this.events,Ht),this}setBrightnessDistribution(t){return this.brightnessDistribution=t,this}setBrightnessDistributionType(t){return this.brightnessDistributionType=t,this}setEvents(t){return this.events=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.brightnessDistributionType===1||this.brightnessDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}}Object.defineProperty(Yt,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Lr()});function Nr(e={}){return{time:e.time??0,id:e.id??0,boxes:e.boxes?.map(t=>Lr(t))??[],customData:N({...e.customData})}}class Xi extends yr{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"boxes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??Xi.defaultValue.time,this.id=t.id??Xi.defaultValue.id,this.boxes=(t.boxes??Xi.defaultValue.boxes).map(i=>new Yt(i)),this.customData=N(t.customData??Xi.defaultValue.customData)}reconcile(){this.boxes=Ke(this.boxes,Yt);for(let t=0;t<this.boxes.length;t++)this.boxes[t].reconcile();return this}}Object.defineProperty(Xi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Nr()});function xr(e={}){return{time:e.time??0,easing:e.easing??0,loop:e.loop??0,direction:e.direction??0,previous:e.previous??0,rotation:e.rotation??0,customData:N({...e.customData})}}class gi extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"previous",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"easing",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"loop",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"rotation",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"direction",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.time=t.time??gi.defaultValue.time,this.easing=t.easing??gi.defaultValue.easing,this.loop=t.loop??gi.defaultValue.loop,this.direction=t.direction??gi.defaultValue.direction,this.previous=t.previous??gi.defaultValue.previous,this.rotation=t.rotation??gi.defaultValue.rotation,this.customData=N(t.customData??gi.defaultValue.customData)}setPrevious(t){return this.previous=t,this}setEasing(t){return this.easing=t,this}setLoop(t){return this.loop=t,this}setRotation(t){return this.rotation=t,this}setDirection(t){return this.direction=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=103&&this.loop>=0&&this.direction>=0&&this.direction<=2}}Object.defineProperty(gi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:xr()});function Or(e={}){return{filter:Cn(e.filter),axis:e.axis??0,flip:e.flip??0,beatDistribution:e.beatDistribution??0,beatDistributionType:e.beatDistributionType??1,rotationDistribution:e.rotationDistribution??0,rotationDistributionType:e.rotationDistributionType??1,affectFirst:e.affectFirst??0,easing:e.easing??0,events:e.events?.map(t=>xr(t))??[],customData:N({...e.customData})}}class Bt extends Er{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"rotationDistribution",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotationDistributionType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"axis",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"flip",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.filter=new Dt(t.filter??Bt.defaultValue.filter),this.axis=t.axis??Bt.defaultValue.axis,this.flip=t.flip??Bt.defaultValue.flip,this.beatDistribution=t.beatDistribution??Bt.defaultValue.beatDistribution,this.beatDistributionType=t.beatDistributionType??Bt.defaultValue.beatDistributionType,this.rotationDistribution=t.rotationDistribution??Bt.defaultValue.rotationDistribution,this.rotationDistributionType=t.rotationDistributionType??Bt.defaultValue.rotationDistributionType,this.affectFirst=t.affectFirst??Bt.defaultValue.affectFirst,this.easing=t.easing??Bt.defaultValue.easing,this.events=(t.events??Bt.defaultValue.events).map(i=>new gi(i)),this.customData=N(t.customData??Bt.defaultValue.customData)}reconcile(){return this.events=Ke(this.events,gi),this}setRotationDistribution(t){return this.rotationDistribution=t,this}setRotationDistributionType(t){return this.rotationDistributionType=t,this}setAxis(t){return this.axis=t,this}setFlip(t){return this.flip=t,this}setEvents(t){return this.events=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.rotationDistributionType===1||this.rotationDistributionType===2)&&(this.axis===0||this.axis===1||this.axis===2)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}Object.defineProperty(Bt,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Or()});function Br(e={}){return{time:e.time??0,id:e.id??0,boxes:e.boxes?.map(t=>Or(t))??[],customData:N({...e.customData})}}class qi extends yr{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"boxes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??qi.defaultValue.time,this.id=t.id??qi.defaultValue.id,this.boxes=(t.boxes??qi.defaultValue.boxes).map(i=>new Bt(i)),this.customData=N(t.customData??qi.defaultValue.customData)}reconcile(){this.boxes=Ke(this.boxes,Bt);for(let t=0;t<this.boxes.length;t++)this.boxes[t].reconcile();return this}}Object.defineProperty(qi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Br()});function kr(e={}){return{time:e.time??0,easing:e.easing??0,previous:e.previous??0,translation:e.translation??0,customData:N({...e.customData})}}class zi extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"previous",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"easing",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"translation",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.time=t.time??zi.defaultValue.time,this.easing=t.easing??zi.defaultValue.easing,this.previous=t.previous??zi.defaultValue.previous,this.translation=t.translation??zi.defaultValue.translation,this.customData=N(t.customData??zi.defaultValue.customData)}setPrevious(t){return this.previous=t,this}setEasing(t){return this.easing=t,this}setTranslation(t){return this.translation=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=103}}Object.defineProperty(zi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:kr()});function Ar(e={}){return{filter:Cn(e.filter),axis:e.axis??0,flip:e.flip??0,beatDistribution:e.beatDistribution??0,beatDistributionType:e.beatDistributionType??1,gapDistribution:e.gapDistribution??0,gapDistributionType:e.gapDistributionType??1,affectFirst:e.affectFirst??0,easing:e.easing??0,events:e.events?.map(t=>kr(t))??[],customData:N({...e.customData})}}class kt extends Er{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"gapDistribution",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"gapDistributionType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"axis",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"flip",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.filter=new Dt(t.filter??kt.defaultValue.filter),this.axis=t.axis??kt.defaultValue.axis,this.flip=t.flip??kt.defaultValue.flip,this.beatDistribution=t.beatDistribution??kt.defaultValue.beatDistribution,this.beatDistributionType=t.beatDistributionType??kt.defaultValue.beatDistributionType,this.gapDistribution=t.gapDistribution??kt.defaultValue.gapDistribution,this.gapDistributionType=t.gapDistributionType??kt.defaultValue.gapDistributionType,this.affectFirst=t.affectFirst??kt.defaultValue.affectFirst,this.easing=t.easing??kt.defaultValue.easing,this.events=(t.events??kt.defaultValue.events).map(i=>new zi(i)),this.customData=N(t.customData??kt.defaultValue.customData)}reconcile(){return this.events=Ke(this.events,zi),this}setGapDistribution(t){return this.gapDistribution=t,this}setGapDistributionType(t){return this.gapDistributionType=t,this}setAxis(t){return this.axis=t,this}setFlip(t){return this.flip=t,this}setEvents(t){return this.events=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.gapDistributionType===1||this.gapDistributionType===2)&&(this.axis===0||this.axis===1||this.axis===2)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}}Object.defineProperty(kt,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Ar()});function Pr(e={}){return{time:e.time??0,id:e.id??0,boxes:e.boxes?.map(t=>Ar(t))??[],customData:N({...e.customData})}}class Ki extends yr{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"boxes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.time=t.time??Ki.defaultValue.time,this.id=t.id??Ki.defaultValue.id,this.boxes=(t.boxes??Ki.defaultValue.boxes).map(i=>new kt(i)),this.customData=N(t.customData??Ki.defaultValue.customData)}reconcile(){this.boxes=Ke(this.boxes,kt);for(let t=0;t<this.boxes.length;t++)this.boxes[t].reconcile();return this}}Object.defineProperty(Ki,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Pr()});function wo(e={}){return{time:e.time??0,posX:e.posX??0,posY:e.posY??0,direction:e.direction??0,laneRotation:e.laneRotation??0,customData:N({...e.customData})}}class Ei extends ba{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"direction",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.time=t.time??Ei.defaultValue.time,this.posX=t.posX??Ei.defaultValue.posX,this.posY=t.posY??Ei.defaultValue.posY,this.direction=t.direction??Ei.defaultValue.direction,this.laneRotation=t.laneRotation??Ei.defaultValue.laneRotation,this.customData=N(t.customData??Ei.defaultValue.customData)}setDirection(t){return this.direction=t,this}mirror(t,i){switch(i?.(this),this.posX=vr(this.posX,pr),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.direction>=0&&this.direction<=9&&this.direction!==8}}Object.defineProperty(Ei,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:wo()});function pn(e={}){return{waypoints:e.waypoints?.map(wo)??[],basicEvents:e.basicEvents?.map(qn)??[],colorBoostEvents:e.colorBoostEvents?.map(Un)??[],lightColorEventBoxGroups:e.lightColorEventBoxGroups?.map(Nr)??[],lightRotationEventBoxGroups:e.lightRotationEventBoxGroups?.map(Br)??[],lightTranslationEventBoxGroups:e.lightTranslationEventBoxGroups?.map(Pr)??[],fxEventBoxGroups:e.fxEventBoxGroups?.map(Cr)??[],basicEventTypesWithKeywords:{list:e.basicEventTypesWithKeywords?.list?.map(_r)??[]},useNormalEventsAsCompatibleEvents:!!e.useNormalEventsAsCompatibleEvents,customData:N({...e.customData})}}class oi extends Pi{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"waypoints",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"basicEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"colorBoostEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lightColorEventBoxGroups",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lightRotationEventBoxGroups",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lightTranslationEventBoxGroups",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fxEventBoxGroups",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"basicEventTypesWithKeywords",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useNormalEventsAsCompatibleEvents",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.waypoints=(t.waypoints??oi.defaultValue.waypoints).map(i=>new Ei(i)),this.basicEvents=(t.basicEvents??oi.defaultValue.basicEvents).map(i=>new Bi(i)),this.colorBoostEvents=(t.colorBoostEvents??oi.defaultValue.colorBoostEvents).map(i=>new sn(i)),this.lightColorEventBoxGroups=(t.lightColorEventBoxGroups??oi.defaultValue.lightColorEventBoxGroups).map(i=>new Xi(i)),this.lightRotationEventBoxGroups=(t.lightRotationEventBoxGroups??oi.defaultValue.lightRotationEventBoxGroups).map(i=>new qi(i)),this.lightTranslationEventBoxGroups=(t.lightTranslationEventBoxGroups??oi.defaultValue.lightTranslationEventBoxGroups).map(i=>new Ki(i)),this.fxEventBoxGroups=(t.fxEventBoxGroups??oi.defaultValue.fxEventBoxGroups).map(i=>new Yi(i)),this.basicEventTypesWithKeywords={list:(t.basicEventTypesWithKeywords?.list??oi.defaultValue.basicEventTypesWithKeywords.list).map(i=>new Dn(i))},this.useNormalEventsAsCompatibleEvents=!!t.useNormalEventsAsCompatibleEvents,this.customData=N(t.customData??oi.defaultValue.customData)}reconcile(){return this.waypoints=Ke(this.waypoints,Ei),this.basicEvents=Ke(this.basicEvents,Bi),this.colorBoostEvents=Ke(this.colorBoostEvents,sn),this.lightColorEventBoxGroups=Ke(this.lightColorEventBoxGroups,Xi),this.lightRotationEventBoxGroups=Ke(this.lightRotationEventBoxGroups,qi),this.lightTranslationEventBoxGroups=Ke(this.lightTranslationEventBoxGroups,Ki),this.fxEventBoxGroups=Ke(this.fxEventBoxGroups,Yi),this.basicEventTypesWithKeywords.list=Ke(this.basicEventTypesWithKeywords.list,Dn),this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.waypoints.every(n=>n.isValid())&&this.basicEvents.every(n=>n.isValid())&&this.colorBoostEvents.every(n=>n.isValid())&&this.lightColorEventBoxGroups.every(n=>n.isValid())&&this.lightRotationEventBoxGroups.every(n=>n.isValid())&&this.lightTranslationEventBoxGroups.every(n=>n.isValid())&&this.fxEventBoxGroups.every(n=>n.isValid())&&this.basicEventTypesWithKeywords.list.every(n=>n.isValid())}sort(){this.waypoints.sort(ct),this.basicEvents.sort(ct),this.colorBoostEvents.sort(ct),this.lightColorEventBoxGroups.sort(ct),this.lightRotationEventBoxGroups.sort(ct),this.lightTranslationEventBoxGroups.sort(ct),this.fxEventBoxGroups.sort(ct);for(let t=0;t<this.lightColorEventBoxGroups.length;t++)for(let i=0;i<this.lightColorEventBoxGroups[t].boxes.length;i++)this.lightColorEventBoxGroups[t].boxes[i].events.sort(ct);for(let t=0;t<this.lightRotationEventBoxGroups.length;t++)for(let i=0;i<this.lightRotationEventBoxGroups[t].boxes.length;i++)this.lightRotationEventBoxGroups[t].boxes[i].events.sort(ct);for(let t=0;t<this.lightTranslationEventBoxGroups.length;t++)for(let i=0;i<this.lightTranslationEventBoxGroups[t].boxes.length;i++)this.lightTranslationEventBoxGroups[t].boxes[i].events.sort(ct);for(let t=0;t<this.fxEventBoxGroups.length;t++)for(let i=0;i<this.fxEventBoxGroups[t].boxes.length;i++)this.fxEventBoxGroups[t].boxes[i].events.sort(ct);return this}allObjects(){return[...this.waypoints,...this.basicEvents,...this.colorBoostEvents,...this.lightColorEventBoxGroups,...this.lightRotationEventBoxGroups,...this.lightTranslationEventBoxGroups,...this.fxEventBoxGroups]}addWaypoints(...t){for(const i of t)this.waypoints.push(new Ei(i));return this}addBasicEvents(...t){for(const i of t)this.basicEvents.push(new Bi(i));return this}addColorBoostEvents(...t){for(const i of t)this.colorBoostEvents.push(new sn(i));return this}addLightColorEventBoxGroups(...t){for(const i of t)this.lightColorEventBoxGroups.push(new Xi(i));return this}addLightRotationEventBoxGroups(...t){for(const i of t)this.lightRotationEventBoxGroups.push(new qi(i));return this}addLightTranslationEventBoxGroups(...t){for(const i of t)this.lightTranslationEventBoxGroups.push(new Ki(i));return this}addFxEventBoxGroups(...t){for(const i of t)this.fxEventBoxGroups.push(new Yi(i));return this}}Object.defineProperty(oi,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:pn()});function Rn(e={}){return{version:e.version??-1,filename:e.filename??"Unnamed.beatmap.dat",lightshowFilename:e.lightshowFilename??"Unnamed.lightshow.dat",difficulty:hn(e.difficulty),lightshow:pn(e.lightshow),customData:N({...e.customData})}}class en extends Pi{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"difficulty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lightshow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filename",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lightshowFilename",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.version=t.version??en.defaultValue.version,this.filename=t.filename??en.defaultValue.filename,this.lightshowFilename=t.lightshowFilename??en.defaultValue.lightshowFilename,this.difficulty=new ni(t.difficulty??en.defaultValue.difficulty),this.lightshow=new oi(t.lightshow??en.defaultValue.lightshow)}isValid(t,i){return super.isValid(t)}get bpmEvents(){return this.difficulty.bpmEvents}set bpmEvents(t){this.difficulty.bpmEvents=t}get rotationEvents(){return this.difficulty.rotationEvents}set rotationEvents(t){this.difficulty.rotationEvents=t}get colorNotes(){return this.difficulty.colorNotes}set colorNotes(t){this.difficulty.colorNotes=t}get bombNotes(){return this.difficulty.bombNotes}set bombNotes(t){this.difficulty.bombNotes=t}get obstacles(){return this.difficulty.obstacles}set obstacles(t){this.difficulty.obstacles=t}get arcs(){return this.difficulty.arcs}set arcs(t){this.difficulty.arcs=t}get chains(){return this.difficulty.chains}set chains(t){this.difficulty.chains=t}get njsEvents(){return this.difficulty.njsEvents}set njsEvents(t){this.difficulty.njsEvents=t}get waypoints(){return this.lightshow.waypoints}set waypoints(t){this.lightshow.waypoints=t}get basicEvents(){return this.lightshow.basicEvents}set basicEvents(t){this.lightshow.basicEvents=t}get colorBoostEvents(){return this.lightshow.colorBoostEvents}set colorBoostEvents(t){this.lightshow.colorBoostEvents=t}get lightColorEventBoxGroups(){return this.lightshow.lightColorEventBoxGroups}set lightColorEventBoxGroups(t){this.lightshow.lightColorEventBoxGroups=t}get lightRotationEventBoxGroups(){return this.lightshow.lightRotationEventBoxGroups}set lightRotationEventBoxGroups(t){this.lightshow.lightRotationEventBoxGroups=t}get lightTranslationEventBoxGroups(){return this.lightshow.lightTranslationEventBoxGroups}set lightTranslationEventBoxGroups(t){this.lightshow.lightTranslationEventBoxGroups=t}get fxEventBoxGroups(){return this.lightshow.fxEventBoxGroups}set fxEventBoxGroups(t){this.lightshow.fxEventBoxGroups=t}get basicEventTypesWithKeywords(){return this.lightshow.basicEventTypesWithKeywords}set basicEventTypesWithKeywords(t){this.lightshow.basicEventTypesWithKeywords=t}get useNormalEventsAsCompatibleEvents(){return this.lightshow.useNormalEventsAsCompatibleEvents}set useNormalEventsAsCompatibleEvents(t){this.lightshow.useNormalEventsAsCompatibleEvents=t}setFilename(t){return this.filename=t,this}setLightshowFilename(t){return this.lightshowFilename=t,this}setVersion(t){return this.version=t,this}sort(t){return this.difficulty.sort(),this.lightshow.sort(),super.sort(t)}allObjects(){return[...this.difficulty.allObjects(),...this.lightshow.allObjects()]}addBpmEvents(...t){return this.difficulty.addBpmEvents(...t),this}addRotationEvents(...t){return this.difficulty.addRotationEvents(...t),this}addColorNotes(...t){return this.difficulty.addColorNotes(...t),this}addBombNotes(...t){return this.difficulty.addBombNotes(...t),this}addObstacles(...t){return this.difficulty.addObstacles(...t),this}addArcs(...t){return this.difficulty.addArcs(...t),this}addChains(...t){return this.difficulty.addChains(...t),this}addNjsEvents(...t){return this.difficulty.addNjsEvents(...t),this}addWaypoints(...t){return this.lightshow.addWaypoints(...t),this}addBasicEvents(...t){return this.lightshow.addBasicEvents(...t),this}addColorBoostEvents(...t){return this.lightshow.addColorBoostEvents(...t),this}addLightColorEventBoxGroups(...t){return this.lightshow.addLightColorEventBoxGroups(...t),this}addLightRotationEventBoxGroups(...t){return this.lightshow.addLightRotationEventBoxGroups(...t),this}addLightTranslationEventBoxGroups(...t){return this.lightshow.addLightTranslationEventBoxGroups(...t),this}addFxEventBoxGroups(...t){return this.lightshow.addFxEventBoxGroups(...t),this}}Object.defineProperty(en,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Rn()});function m0(e={}){return{time:e.time??0,previous:e.previous??0,value:e.value??0,customData:N({...e.customData})}}class Mn extends ui{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"previous",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.time=t.time??Mn.defaultValue.time,this.previous=t.previous??Mn.defaultValue.previous,this.value=t.value??Mn.defaultValue.value,this.customData=N(t.customData??Mn.defaultValue.customData)}setPrevious(t){return this.previous=t,this}setValue(t){return this.value=t,this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&(this.previous===0||this.previous===1)}}Object.defineProperty(Mn,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:m0()});const al={Standard:"Standard",NoArrows:"No Arrows",OneSaber:"One Saber",Legacy:"Legacy","360Degree":"360 Degree","90Degree":"90 Degree",Lightshow:"Lightshow",Lawless:"Lawless"},Uo={Standard:0,NoArrows:1,OneSaber:2,Legacy:3,"360Degree":4,"90Degree":5,Lightshow:6,Lawless:7},er={Easy:1,Normal:3,Hard:5,Expert:7,ExpertPlus:9,"Expert+":9},nn={Easy:"Easy",Normal:"Normal",Hard:"Hard",Expert:"Expert",ExpertPlus:"Expert+","Expert+":"Expert+"};function Co(e={}){return{characteristic:e.characteristic??"Standard",difficulty:e.difficulty??"Easy",filename:e.filename??"Unnamed.beatmap.dat",lightshowFilename:e.lightshowFilename??"Unnamed.lightshow.dat",authors:{mappers:e.authors?.mappers??[],lighters:e.authors?.lighters??[]},njs:e.njs??0,njsOffset:e.njsOffset??0,colorSchemeId:e.colorSchemeId??-1,environmentId:e.environmentId??0,customData:N({...e.customData})}}class Rt extends Pi{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"characteristic",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"difficulty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filename",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lightshowFilename",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"authors",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"njs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"njsOffset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"colorSchemeId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"environmentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.characteristic=t.characteristic??Rt.defaultValue.characteristic,this.difficulty=t.difficulty??Rt.defaultValue.difficulty,this.filename=t.filename??Rt.defaultValue.filename,this.lightshowFilename=t.lightshowFilename??Rt.defaultValue.lightshowFilename,this.authors={mappers:(t.authors?.mappers??Rt.defaultValue.authors.mappers).map(i=>i),lighters:(t.authors?.lighters??Rt.defaultValue.authors.lighters).map(i=>i)},this.njs=t.njs??Rt.defaultValue.njs,this.njsOffset=t.njsOffset??Rt.defaultValue.njsOffset,this.colorSchemeId=t.colorSchemeId??Rt.defaultValue.colorSchemeId,this.environmentId=t.environmentId??Rt.defaultValue.environmentId,this.customData=N(t.customData??Rt.defaultValue.customData)}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.njs>0&&this.colorSchemeId>=-1&&this.environmentId>=0}}Object.defineProperty(Rt,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Co()});function Mr(e={}){return{version:e.version??-1,filename:e.filename??"Info.dat",song:{title:e.song?.title??"Untitled",subTitle:e.song?.subTitle??"",author:e.song?.author??"NoAuthor"},audio:{filename:e.audio?.filename??"song.ogg",duration:e.audio?.duration??0,audioDataFilename:e.audio?.audioDataFilename??"AudioData.dat",bpm:e.audio?.bpm??120,lufs:e.audio?.lufs??0,previewStartTime:e.audio?.previewStartTime??0,previewDuration:e.audio?.previewDuration??0,audioOffset:e.audio?.audioOffset??0,shuffle:e.audio?.shuffle??0,shufflePeriod:e.audio?.shufflePeriod??.5},songPreviewFilename:e.songPreviewFilename??"song.ogg",coverImageFilename:e.coverImageFilename??"cover.jpg",environmentBase:{normal:e.environmentBase?.normal??null,allDirections:e.environmentBase?.allDirections??null},environmentNames:e.environmentNames??[],colorSchemes:e.colorSchemes?.map(t=>{const i={name:t.name??"",overrideLights:t.overrideLights??!1,overrideNotes:t.overrideNotes??!1,saberLeftColor:{r:t.saberLeftColor?.r??0,g:t.saberLeftColor?.g??0,b:t.saberLeftColor?.b??0,a:t.saberLeftColor?.a??0},saberRightColor:{r:t.saberRightColor?.r??0,g:t.saberRightColor?.g??0,b:t.saberRightColor?.b??0,a:t.saberRightColor?.a??0},environment0Color:{r:t.environment0Color?.r??0,g:t.environment0Color?.g??0,b:t.environment0Color?.b??0,a:t.environment0Color?.a??0},environment1Color:{r:t.environment1Color?.r??0,g:t.environment1Color?.g??0,b:t.environment1Color?.b??0,a:t.environment1Color?.a??0},environment0ColorBoost:{r:t.environment0ColorBoost?.r??0,g:t.environment0ColorBoost?.g??0,b:t.environment0ColorBoost?.b??0,a:t.environment0ColorBoost?.a??0},environment1ColorBoost:{r:t.environment1ColorBoost?.r??0,g:t.environment1ColorBoost?.g??0,b:t.environment1ColorBoost?.b??0,a:t.environment1ColorBoost?.a??0},obstaclesColor:{r:t.obstaclesColor?.r??0,g:t.obstaclesColor?.g??0,b:t.obstaclesColor?.b??0,a:t.obstaclesColor?.a??0}};return t.environmentWColor&&(i.environmentWColor={r:t.environmentWColor?.r??0,g:t.environmentWColor?.g??0,b:t.environmentWColor?.b??0,a:t.environmentWColor?.a??0}),t.environmentWColorBoost&&(i.environmentWColorBoost={r:t.environmentWColorBoost?.r??0,g:t.environmentWColorBoost?.g??0,b:t.environmentWColorBoost?.b??0,a:t.environmentWColorBoost?.a??0}),i})??[],difficulties:e.difficulties?.map(Co)??[],customData:N({...e.customData})}}class Je extends Pi{static createOne(t={}){return new this(t)}static create(...t){return t.length?t.map(i=>new this(i)):[new this]}constructor(t={}){super(),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filename",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"song",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"songPreviewFilename",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"coverImageFilename",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"environmentBase",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"environmentNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"colorSchemes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"difficulties",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.version=t.version??Je.defaultValue.version,this.filename=t.filename??Je.defaultValue.filename,this.song={title:t.song?.title??Je.defaultValue.song.title,subTitle:t.song?.subTitle??Je.defaultValue.song.subTitle,author:t.song?.author??Je.defaultValue.song.author},this.audio={filename:t.audio?.filename??Je.defaultValue.audio.filename,duration:t.audio?.duration??Je.defaultValue.audio.duration,audioDataFilename:t.audio?.audioDataFilename??Je.defaultValue.audio.audioDataFilename,bpm:t.audio?.bpm??Je.defaultValue.audio.bpm,lufs:t.audio?.lufs??Je.defaultValue.audio.lufs,previewStartTime:t.audio?.previewStartTime??Je.defaultValue.audio.previewStartTime,previewDuration:t.audio?.previewDuration??Je.defaultValue.audio.previewDuration,audioOffset:t.audio?.audioOffset??Je.defaultValue.audio.audioOffset,shuffle:t.audio?.shuffle??Je.defaultValue.audio.shuffle,shufflePeriod:t.audio?.shufflePeriod??Je.defaultValue.audio.shufflePeriod},this.songPreviewFilename=t.songPreviewFilename??Je.defaultValue.songPreviewFilename,this.coverImageFilename=t.coverImageFilename??Je.defaultValue.coverImageFilename,this.environmentBase={normal:t.environmentBase?.normal??Je.defaultValue.environmentBase.normal,allDirections:t.environmentBase?.allDirections??Je.defaultValue.environmentBase.allDirections},this.environmentNames=(t.environmentNames??Je.defaultValue.environmentNames).map(i=>i),this.colorSchemes=(t.colorSchemes??Je.defaultValue.colorSchemes).map(i=>{const n={name:i.name||"",overrideLights:i.overrideLights||!1,overrideNotes:i.overrideNotes||!1,saberLeftColor:{r:i.saberLeftColor?.r||0,g:i.saberLeftColor?.g||0,b:i.saberLeftColor?.b||0,a:i.saberLeftColor?.a||0},saberRightColor:{r:i.saberRightColor?.r||0,g:i.saberRightColor?.g||0,b:i.saberRightColor?.b||0,a:i.saberRightColor?.a||0},environment0Color:{r:i.environment0Color?.r||0,g:i.environment0Color?.g||0,b:i.environment0Color?.b||0,a:i.environment0Color?.a||0},environment1Color:{r:i.environment1Color?.r||0,g:i.environment1Color?.g||0,b:i.environment1Color?.b||0,a:i.environment1Color?.a||0},environment0ColorBoost:{r:i.environment0ColorBoost?.r||0,g:i.environment0ColorBoost?.g||0,b:i.environment0ColorBoost?.b||0,a:i.environment0ColorBoost?.a||0},environment1ColorBoost:{r:i.environment1ColorBoost?.r||0,g:i.environment1ColorBoost?.g||0,b:i.environment1ColorBoost?.b||0,a:i.environment1ColorBoost?.a||0},obstaclesColor:{r:i.obstaclesColor?.r||0,g:i.obstaclesColor?.g||0,b:i.obstaclesColor?.b||0,a:i.obstaclesColor?.a||0}};return i.environmentWColor&&(n.environmentWColor={r:i.environmentWColor?.r||0,g:i.environmentWColor?.g||0,b:i.environmentWColor?.b||0,a:i.environmentWColor?.a||0}),i.environmentWColorBoost&&(n.environmentWColorBoost={r:i.environmentWColorBoost?.r||0,g:i.environmentWColorBoost?.g||0,b:i.environmentWColorBoost?.b||0,a:i.environmentWColorBoost?.a||0}),n}),this.difficulties=(t.difficulties??Je.defaultValue.difficulties).map(i=>new Rt(i)),this.customData=N(t.customData??Je.defaultValue.customData)}reconcile(){return this.difficulties=Ke(this.difficulties,Rt),this}isValid(t,i){return i?super.isValid(t,i):super.isValid(t,i)&&this.audio.filename!==""&&this.audio.duration>0&&this.audio.previewDuration>0&&this.audio.previewStartTime>0&&this.audio.audioOffset>=0&&this.difficulties.every(n=>n.isValid())}clone(){return super.clone().setFilename(this.filename)}setFilename(t){return this.filename=t,this}setVersion(t){return this.version=t,this}sort(){return this.difficulties.sort((t,i)=>er[t.difficulty]-er[i.difficulty]).sort((t,i)=>(Uo[t.characteristic]||0)-(Uo[i.characteristic]||0)),this}addMap(t){return this.difficulties.push(new Rt(t)),this}}Object.defineProperty(Je,"defaultValue",{enumerable:!0,configurable:!0,writable:!0,value:Mr()});function h0(e){return Array.isArray(e.customData._color)||typeof e.customData._lightID=="number"||Array.isArray(e.customData._lightID)||typeof e.customData._propID=="number"||typeof e.customData._lightGradient=="object"||typeof e.customData._easing=="string"||typeof e.customData._lerpType=="string"||typeof e.customData._nameFilter=="string"||typeof e.customData._reset=="boolean"||typeof e.customData._rotation=="number"||typeof e.customData._step=="number"||typeof e.customData._prop=="number"||typeof e.customData._speed=="number"||typeof e.customData._direction=="number"||typeof e.customData._counterSpin=="boolean"||typeof e.customData._stepMult=="number"||typeof e.customData._propMult=="number"||typeof e.customData._speedMult=="number"||typeof e.customData._lockPosition=="boolean"||typeof e.customData._speed=="number"||typeof e.customData._preciseSpeed=="number"||typeof e.customData._direction=="number"}function fc(e){return Array.isArray(e.customData._color)||typeof e.customData._disableSpawnEffect=="boolean"}function mc(e){return Array.isArray(e.customData._animation)||typeof e.customData._cutDirection=="number"||typeof e.customData._disableNoteGravity=="boolean"||typeof e.customData._disableNoteLook=="boolean"||typeof e.customData._fake=="boolean"||Array.isArray(e.customData._flip)||typeof e.customData._interactable=="boolean"||Array.isArray(e.customData._localRotation)||typeof e.customData._noteJumpMovementSpeed=="number"||typeof e.customData._noteJumpStartBeatOffset=="number"||Array.isArray(e.customData._position)||Array.isArray(e.customData._rotation)}function p0(e){return Array.isArray(e.customData._color)}function d0(e){return Array.isArray(e.customData._animation)||typeof e.customData._fake=="boolean"||typeof e.customData._interactable=="boolean"||Array.isArray(e.customData._localRotation)||typeof e.customData._noteJumpMovementSpeed=="number"||typeof e.customData._noteJumpStartBeatOffset=="number"||Array.isArray(e.customData._position)||Array.isArray(e.customData._rotation)||Array.isArray(e.customData._scale)}function hc(e){return e.posX<0||e.posX>3||e.width<0||e.width>4||e.posY<0||e.posY>2||e.posY===1||e.posY===0&&e.height!==5||e.posY===2&&e.height!==3}function b0(e){return Array.isArray(e.customData.color)||typeof e.customData.lightID=="number"||Array.isArray(e.customData.lightID)||typeof e.customData.easing=="string"||typeof e.customData.lerpType=="string"||typeof e.customData.nameFilter=="string"||typeof e.customData.rotation=="number"||typeof e.customData.step=="number"||typeof e.customData.prop=="number"||typeof e.customData.speed=="number"||typeof e.customData.direction=="number"||typeof e.customData.lockRotation=="boolean"||typeof e.customData.speed=="number"||typeof e.customData.direction=="number"}function pc(e){return Array.isArray(e.customData.color)||typeof e.customData.spawnEffect=="boolean"||typeof e.customData.disableDebris=="boolean"}function dc(e){return Array.isArray(e.customData.animation)||typeof e.customData.disableNoteGravity=="boolean"||typeof e.customData.disableNoteLook=="boolean"||typeof e.customData.disableBadCutDirection=="boolean"||typeof e.customData.disableBadCutSaberType=="boolean"||typeof e.customData.disableBadCutSpeed=="boolean"||Array.isArray(e.customData.flip)||typeof e.customData.uninteractable=="boolean"||Array.isArray(e.customData.localRotation)||typeof e.customData.noteJumpMovementSpeed=="number"||typeof e.customData.noteJumpStartBeatOffset=="number"||Array.isArray(e.customData.coordinates)||Array.isArray(e.customData.worldRotation)||typeof e.customData.worldRotation=="number"||typeof e.customData.link=="string"}function g0(e){return Array.isArray(e.customData.color)}function v0(e){return Array.isArray(e.customData.animation)||typeof e.customData.uninteractable=="boolean"||Array.isArray(e.customData.localRotation)||typeof e.customData.noteJumpMovementSpeed=="number"||typeof e.customData.noteJumpStartBeatOffset=="number"||Array.isArray(e.customData.coordinates)||Array.isArray(e.customData.worldRotation)||Array.isArray(e.customData.size)}function bc(e){return e.posY<0||e.posY>2||e.posX<=-1e3||e.posX>=1e3||e.width<=-1e3||e.width>=1e3||e.height<=-1e3||e.height>=1e3}function E0(e){return e.posY>2||e.posY<0||e.posX<=-1e3||e.posX>=1e3||e.direction>=1e3&&e.direction<=1360||e.tailDirection>=1e3&&e.tailDirection<=1360}function gc(e){return e.posX>3||e.posX<0||e.posY>2||e.posY<0}function y0(e){return e.posY>2||e.posY<0||e.posX<=-1e3||e.posX>=1e3||e.direction>=1e3&&e.direction<=1360}function vc(e){return e.posX>3||e.posX<0||e.posY>2||e.posY<0||e.direction>=1e3&&e.direction<=1360||e.direction>=2e3&&e.direction<=2360}function ll(e,t){const i=e.difficulty.colorNotes;return t?i.length/t:0}function Ss(e,t,i){let n=0,o=0;const r=e.difficulty.colorNotes;for(let s=0;s<r.length;s++){for(;r[s].time-r[o].time>t;)o++;n=Math.max(n,(s-o+1)/i.toRealTime(t))}return n}function Da(e){const t=[...e.difficulty.colorNotes,...e.difficulty.bombNotes,...e.difficulty.chains].sort(Pn);let i=Number.MAX_VALUE;t.length>0&&(i=t[0].time);const n=_0(e);return Math.min(i,n)}function Vn(e){const t=[...e.difficulty.colorNotes,...e.difficulty.bombNotes,...e.difficulty.chains].sort(Pn);let i=0;t.length>0&&(i=t[t.length-1].time);const n=D0(e);return Math.max(i,n)}function _0(e){for(let t=0,i=e.difficulty.obstacles.length;t<i;t++)if(Tr(e.difficulty.obstacles[t]))return e.difficulty.obstacles[t].time;return Number.MAX_VALUE}function D0(e){let t=0;for(let i=e.difficulty.obstacles.length-1;i>=0;i--)Tr(e.difficulty.obstacles[i])&&(t=Math.max(t,e.difficulty.obstacles[i].time+e.difficulty.obstacles[i].duration));return t}class Kt{constructor(t,i=10,n=0){Object.defineProperty(this,"bpm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"offset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bpm=t,this.value=i,this.offset=n}static create(t,i,n){return new Kt(t,i,n)}get hjd(){return this.calcHjd()}get jd(){return this.calcJd()}get reactionTime(){return this.calcRtFromHjd()}calcHjd(t=this.offset){const n=60/this.bpm;let o=Kt.HJD_START;for(;this.value*n*o>17.999;)o/=2;return o<1&&(o=1),Math.max(o+t,Kt.HJD_MIN)}calcHjdFromJd(t=this.calcJd()){return t/(60/this.bpm*this.value*2)}calcHjdFromRt(t=this.calcRtFromHjd()){return t/(60/this.bpm)}calcOffsetFromHjd(t){return t-this.calcHjd(0)}calcOffsetFromRt(t=this.calcRtFromHjd()){return t/(60/this.bpm)-this.calcHjd(0)}calcJd(t=this.calcHjd()){return this.value*(60/this.bpm)*t*2}calcJdOptimal(){return[-(18/(this.value+1))+18,18*(1/1.07)**this.value+18]}calcRtFromJd(t=this.calcJd()){return t/(2*this.value)}calcRtFromHjd(t=this.calcHjd()){return 60/this.bpm*t}calcDistance(t){return this.value*60/this.bpm*t*2}}Object.defineProperty(Kt,"HJD_START",{enumerable:!0,configurable:!0,writable:!0,value:4});Object.defineProperty(Kt,"HJD_MIN",{enumerable:!0,configurable:!0,writable:!0,value:.25});Object.defineProperty(Kt,"FallbackNJS",{enumerable:!0,configurable:!0,writable:!0,value:{"Expert+":16,ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10}});var ri;(function(e){e[e.NONE=0]="NONE",e[e.NORMAL=1]="NORMAL",e[e.ARC_HEAD=2]="ARC_HEAD",e[e.ARC_TAIL=3]="ARC_TAIL",e[e.CHAIN_HEAD=4]="CHAIN_HEAD",e[e.CHAIN_ELEMENT=5]="CHAIN_ELEMENT"})(ri||(ri={}));const T0={[ri.NONE]:0,[ri.NORMAL]:115,[ri.ARC_HEAD]:115,[ri.ARC_TAIL]:115,[ri.CHAIN_HEAD]:85,[ri.CHAIN_ELEMENT]:20};function S0(e){let t=0,i=1;const n=w0(e);for(let o=0;o<n.length;o++)i<8&&o===-3+i*4&&(i*=2),t+=T0[n[o].type]*i;return t}function w0(e){return[C0(e),R0(e.difficulty.chains)].flat().sort((t,i)=>t.time-i.time)}function C0(e){const t=new Map,i=new Map,n=new Map;for(let o=0;o<e.difficulty.arcs.length;o++){const r=e.difficulty.arcs[o];t.has(r.time)||t.set(r.time,[]),i.has(r.tailTime)||i.set(r.tailTime,[]),t.get(r.time).push(r),i.get(r.tailTime).push(r)}for(let o=0;o<e.difficulty.chains.length;o++){const r=e.difficulty.chains[o];n.has(r.time)||n.set(r.time,[]),n.get(r.time).push(r)}return e.difficulty.colorNotes.map(o=>t.get(o.time)?.some(a=>a.color===o.color&&a.tailPosX===o.posX&&a.tailPosY===o.posY)||i.get(o.time)?.some(a=>a.color===o.color&&a.tailPosX===o.posX&&a.tailPosY===o.posY)?{type:ri.ARC_HEAD,time:o.time}:n.get(o.time)?.some(a=>a.color===o.color&&a.posX===o.posX&&a.posY===o.posY)?{type:ri.CHAIN_HEAD,time:o.time}:{type:ri.NORMAL,time:o.time})}function R0(e){return e.flatMap(t=>t.sliceCount>1?new Array(t.sliceCount-1).map((i,n)=>({type:ri.CHAIN_ELEMENT,time:Xs(md(n+1,0,t.sliceCount),t.time,t.tailTime)})):[])}function L0(e){return["helpers","timeProcessor",e]}class tr{constructor(t,i=[],n=0){Object.defineProperty(this,"bpm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_bpmChange",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_timeScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_offset",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bpm=t,this._offset=n/1e3,this._timeScale=this.getTimeScale(i.filter(o=>("m"in o||"bpm"in o||"timescale"in o)&&!("o"in o))),this._bpmChange=this.getBpmChangeTime(i.filter(o=>"BPM"in o&&"metronomeOffset"in o||("_bpm"in o||"_BPM"in o)&&"_metronomeOffset"in o||"m"in o&&"o"in o)),this._timeScale.length&&this._bpmChange.length&&se.tWarn(L0("constructor"),"BPM change and BPM event should not be used along side together to avoid confusion between editors and in-game behaviour")}get change(){return this._bpmChange}set change(t){this._bpmChange=this.getBpmChangeTime(t)}get timescale(){return this._timeScale}set timescale(t){this._timeScale=this.getTimeScale(t)}get offset(){return this._offset*1e3}set offset(t){this._offset=t/1e3}getBpmChangeTime(t=[]){let i;const n=[];t=[...t].sort((o,r)=>(o.time??o._time??o.b)-(r.time??r._time??r.b));for(let o=0;o<t.length;o++){const r={time:t[o].time??t[o]._time??t[o].b,BPM:t[o].BPM??t[o]._BPM??t[o]._bpm??t[o].m,beatsPerBar:t[o].beatsPerBar??t[o]._beatsPerBar??t[o].p,metronomeOffset:t[o].metronomeOffset??t[o]._metronomeOffset??t[o].o,newTime:0};i?r.newTime=Math.ceil((r.time-i.time)/this.bpm*i.BPM+i.newTime-.01):r.newTime=Math.ceil(r.time-this._offset*this.bpm/60-.01),n.push(r),i=r}return n}getTimeScale(t=[]){return[...t].sort((i,n)=>(i.time??i.b)-(n.time??n.b)).map(i=>"scale"in i?i:"bpm"in i?{time:i.time,bpm:i.bpm,scale:this.bpm/i.bpm}:"m"in i?{time:i.b||0,bpm:i.m||this.bpm,scale:this.bpm/(i.m||this.bpm)}:{time:i.b||0,bpm:this.bpm,scale:1})}offsetBegone(t){return this._offset===0?t:this.toBeatTime(this.toRealTime(t,!1)-this._offset)}getBpmAtTime(t){return this._timeScale.reverse().find(i=>i.time<=t)?.bpm??this.bpm}toRealTimeAtOffset(t,i,n=!0){if(!n)return i/this.bpm*60;for(let o=this._timeScale.length-1;o>=0;o--)if(t>this._timeScale[o].time)return i*this._timeScale[o].scale/this.bpm*60;return i/this.bpm*60}toRealTime(t,i=!0){if(!i)return t/this.bpm*60;let n=0;for(let o=this._timeScale.length-1;o>=0;o--)t>this._timeScale[o].time&&(n+=(t-this._timeScale[o].time)*this._timeScale[o].scale,t=this._timeScale[o].time);return(t+n)/this.bpm*60}toBeatTime(t,i=!0){if(!i)return t*this.bpm/60;let n=0;for(let o=this._timeScale.length-1;o>=0;o--){const r=this.toRealTime(this._timeScale[o].time,i);t>r&&(n+=(t-r)/this._timeScale[o].scale,t=r)}return this.toBeatTime(t+n,!1)}toJsonTime(t){for(let i=this._bpmChange.length-1;i>=0;i--)if(t>this._bpmChange[i].newTime)return(t-this._bpmChange[i].newTime)/this._bpmChange[i].BPM*this.bpm+this._bpmChange[i].time;return this.toBeatTime(this.toRealTime(t,!1)+this._offset)}adjustTime(t){for(let i=this._bpmChange.length-1;i>=0;i--)if(t>this._bpmChange[i].time)return(t-this._bpmChange[i].time)/this.bpm*this._bpmChange[i].BPM+this._bpmChange[i].newTime;return this.offsetBegone(t)}}Object.defineProperty(tr,"create",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,i)=>new tr(e,t,i)});function N0(e){switch(e){case"info":case"difficulty":return"2.0.0";case"lightshow":return"3.0.0";default:return"4.0.0"}}function x0(e){const t=e._version??e.version;return typeof t!="string"?null:t}function Ta(e,t){const i=ul(e),n=ul(t);for(const o in i){if(i[o]<n[o])return-1;if(i[o]>n[o])return 1}return 0}function ul(e){return e.split(".").map(t=>parseInt(t))}const O0={1:Yd,2:Zd,4:r0},B0={2:Xd,4:i0},cl={1:jd,2:Kd,3:sc,4:o0};function k0(e,t,i,n){switch(e){case"info":{const o=O0[t];return o(i,n)}case"audioData":{const o=B0[t];return o(i,n)}case"difficulty":{const o=cl[t];return o(i,n)}case"lightshow":{const o=cl[t];return o(i,n)}default:throw new Error("")}}const fl={serialize(e){return{_time:e.time,_type:e.type,_value:e.value}},deserialize(e){return qn({time:e._time,type:e._type,value:e._value,floatValue:1})}},ml={serialize(e){return{_time:e.time,_lineIndex:e.posX,_lineLayer:e.posY,_type:3,_cutDirection:e.direction}},deserialize(e){return Kn({time:e._time,posX:e._lineIndex,posY:e._lineLayer,direction:e._cutDirection})}},hl={serialize(e){return{_time:e.time,_type:100,_value:Math.round(e.bpm)}},deserialize(e){return So({time:e._time,bpm:e._value})}},pl={serialize(e){return{_time:e.time,_type:5,_value:e.toggle?1:0}},deserialize(e){return Un({time:e._time,toggle:e._value===1})}},dl={serialize(e){return{_time:e.time,_lineIndex:e.posX,_lineLayer:e.posY,_type:e.color,_cutDirection:e.direction}},deserialize(e){return Jn({time:e._time,posX:e._lineIndex,posY:e._lineLayer,color:[pe.RED,pe.BLUE][e._type??0],direction:e._cutDirection})}};function A0(e){return e<1e3||e>4005e3?0:(e>=4001&&e<=4005e3?(e-4001)%1e3:0)*5+1e3}function P0(e){return e<1e3||e>4005e3?0:(e>=4001&&e<=4005e3?Math.floor((e-4001)/1e3):e-1e3)*5+1e3}const bl={serialize(e){let t=0;if(e.height>=0&&e.posY>=0){const i=e.posY>=1e3?e.posY-1e3:e.posY/1e3,n=e.height>=1e3?e.height-1e3:e.height/1e3;t=Math.floor(n/5*1e3+i/5+4001)}return{_time:e.time,_type:e.posY===2&&e.height===3?1:e.posY===0&&e.height===5?0:t,_lineIndex:e.posX,_duration:e.duration,_width:e.width}},deserialize(e){const t=e._type??0;return Zn({time:e._time,posX:e._lineIndex,posY:t===0?0:t===1?2:A0(t),duration:e._duration,width:e._width,height:t===0?5:t===1?3:P0(t)})}},gl={serialize(e){let t=e.rotation%360;return t>=-60&&t<=60&&t%15===0&&t/15!==0?t=tc[t]||t+1360:t+=1360,{_time:e.time,_type:e.executionTime===1?15:14,_value:t}},deserialize(e){const t=e._value??0;return Qn({time:e._time,executionTime:e._type===15?1:0,rotation:t>=1e3?(t-1360)%360:ec[t]??0})}},M0={serialize(e,t){return{_version:"1.5.0",_beatsPerMinute:t?.bpm??120,_beatsPerBar:t?.beatsPerBar??4,_shuffle:t?.shuffle??0,_shufflePeriod:t?.shufflePeriod??.5,_noteJumpSpeed:t?.njs??0,_noteJumpStartBeatOffset:t?.njsOffset??0,_notes:[...e.difficulty.colorNotes.map(i=>dl.serialize(i)),...e.difficulty.bombNotes.map(i=>ml.serialize(i))],_obstacles:e.difficulty.obstacles.map(i=>bl.serialize(i)),_events:[...e.lightshow.basicEvents.map(i=>fl.serialize(i)),...e.lightshow.colorBoostEvents.map(i=>pl.serialize(i)),...e.difficulty.rotationEvents.map(i=>gl.serialize(i)),...e.difficulty.bpmEvents.map(i=>hl.serialize(i))],_time:e.difficulty.customData._time,_BPMChanges:e.difficulty.customData._bpmChanges,_bookmarks:e.difficulty.customData._bookmarks}},deserialize(e,t){const i=[],n=[],o=e._notes||[];for(let f=0;f<o.length;f++){const b=o[f];b?._type===3?n.push(ml.deserialize(b)):i.push(dl.deserialize(b))}const r=[],s=[],a=[],l=[],u=e._events||[];for(let f=0;f<u.length;f++){const b=u[f];switch(b?._type){case 5:s.push(pl.deserialize(b));break;case 14:case 15:a.push(gl.deserialize(b));break;case 100:case 10:l.push(hl.deserialize(b));break;default:r.push(fl.deserialize(b))}}return Rn({version:1,filename:t?.filename??"EasyStandard.dat",lightshowFilename:t?.lightshowFilename??"EasyLightshow.dat",difficulty:hn({colorNotes:i,bombNotes:n,obstacles:e._obstacles?.map(f=>bl.deserialize(f)),rotationEvents:a,bpmEvents:l,customData:{_bpmChanges:e._BPMChanges,_bookmarks:e._bookmarks,_time:e._time}}),lightshow:pn({basicEvents:r,colorBoostEvents:s,useNormalEventsAsCompatibleEvents:!0})})}},vl={serialize(e,t){return{difficulty:e.difficulty,difficultyRank:er[e.difficulty],audioPath:t?.audio?.filename??"song.ogg",jsonPath:e.filename,characteristic:e.characteristic,offset:e.customData._editorOffset,oldOffset:e.customData._editorOldOffset,chromaToggle:e.customData._chromaToggle,customColors:e.customData._customColors,difficultyLabel:e.customData._difficultyLabel,colorLeft:dt(e.customData._colorLeft),colorRight:dt(e.customData._colorRight),envColorLeft:dt(e.customData._envColorLeft),envColorRight:dt(e.customData._envColorRight),obstacleColor:dt(e.customData._obstacleColor)}},deserialize(e,t){return Co({characteristic:e.characteristic,difficulty:e.difficulty,authors:{mappers:t?.authors?.mappers,lighters:t?.authors?.lighters},filename:e.jsonPath,lightshowFilename:t?.lightshowFilename,njs:t?.njs,njsOffset:t?.njsOffset,customData:{_editorOffset:e.offset,_editorOldOffset:e.oldOffset,_chromaToggle:e.chromaToggle,_customColors:e.customColors,_difficultyLabel:e.difficultyLabel,_colorLeft:dt(e.colorLeft),_colorRight:dt(e.colorRight),_envColorLeft:dt(e.envColorLeft),_envColorRight:dt(e.envColorRight),_obstacleColor:dt(e.obstacleColor)}})}},I0={serialize(e){return{songName:e.song.title,songSubName:e.song.subTitle,authorName:e.song.author,beatsPerMinute:e.audio.bpm,previewStartTime:e.audio.previewStartTime,previewDuration:e.audio.previewDuration,coverImagePath:e.coverImageFilename,environmentName:e.environmentBase.normal||e.environmentNames.find(t=>!In(t))||"DefaultEnvironment",difficultyLevels:e.difficulties.map(t=>vl.serialize(t)),oneSaber:e.difficulties.some(t=>t.characteristic==="OneSaber"),contributors:N(e.customData._contributors),customEnvironment:e.customData._customEnvironment,customEnvironmentHash:e.customData._customEnvironmentHash}},deserialize(e,t){const i=e.difficultyLevels?.find(n=>n?.audioPath);return Mr({version:1,filename:t?.filename,song:{title:e.songName,subTitle:e.songSubName,author:e.authorName},audio:{filename:i?.audioPath??t?.audio?.filename,audioDataFilename:t?.audio?.audioDataFilename,bpm:e.beatsPerMinute,lufs:t?.audio?.lufs,duration:t?.audio?.duration,previewStartTime:e.previewStartTime,previewDuration:e.previewDuration},songPreviewFilename:i?.audioPath??t?.audio?.filename,coverImageFilename:e.coverImagePath,environmentBase:{normal:e.environmentName},difficulties:e.difficultyLevels?.map(n=>vl.deserialize(n))??[],customData:{_contributors:e.contributors,_customEnvironment:e.customEnvironment,_customEnvironmentHash:e.customEnvironmentHash}})}},$0={serialize(e){return{_version:"2.0.0",_songSampleCount:e.sampleCount,_songFrequency:e.frequency,_regions:e.bpmData.map(t=>({_startBeat:t.startBeat,_endBeat:t.endBeat,_startSampleIndex:t.startSampleIndex,_endSampleIndex:t.endSampleIndex}))}},deserialize(e,t){return Ea({version:2,filename:t?.filename,audioChecksum:t?.audioChecksum,sampleCount:e._songSampleCount,frequency:e._songFrequency,bpmData:e._regions?.map(i=>({startBeat:i?._startBeat,endBeat:i?._endBeat,startSampleIndex:i?._startSampleIndex,endSampleIndex:i?._endSampleIndex}))})}},F0={serialize(e){return{_colorType:e.color,_headTime:e.time,_headLineIndex:e.posX,_headLineLayer:e.posY,_headCutDirection:e.direction,_headControlPointLengthMultiplier:e.lengthMultiplier,_tailTime:e.tailTime,_tailLineIndex:e.tailPosX,_tailLineLayer:e.tailPosY,_tailCutDirection:e.tailDirection,_tailControlPointLengthMultiplier:e.tailLengthMultiplier,_sliderMidAnchorMode:e.midAnchor,_customData:N(e.customData)}},deserialize(e){return To({color:e._colorType,time:e._headTime,posX:e._headLineIndex,posY:e._headLineLayer,direction:e._headCutDirection,lengthMultiplier:e._headControlPointLengthMultiplier,tailTime:e._tailTime,tailPosX:e._tailLineIndex,tailPosY:e._tailLineLayer,tailDirection:e._tailCutDirection,tailLengthMultiplier:e._tailControlPointLengthMultiplier,midAnchor:e._sliderMidAnchorMode,customData:e._customData})}},El={serialize(e){return{_time:e.time,_type:e.type,_value:e.value,_floatValue:e.floatValue,_customData:N(e.customData)}},deserialize(e){return qn({time:e._time,type:e._type,value:e._value,floatValue:e._floatValue,customData:e._customData})}},yl={serialize(e){return{_keyword:e.keyword,_specialEvents:e.events}},deserialize(e){return _r({keyword:e._keyword,events:e._specialEvents})}},_l={serialize(e){return{_keywords:e.list.map(t=>yl.serialize(t))}},deserialize(e){return{list:e._keywords?.map(t=>yl.deserialize(t))??[]}}},Dl={serialize(e){return{_time:e.time,_type:3,_lineIndex:e.posX,_lineLayer:e.posY,_cutDirection:e.direction,_customData:N(e.customData)}},deserialize(e){return Kn({time:e._time,posX:e._lineIndex,posY:e._lineLayer,direction:e._cutDirection,customData:e._customData})}},ws={serialize(e){return{_time:e.time,_type:100,_value:0,_floatValue:e.bpm,_customData:N(e.customData)}},deserialize(e){return So({time:e._time,bpm:e._floatValue??e._value,customData:e._customData})}},Tl={serialize(e){return{_time:e.time,_type:5,_value:e.toggle?1:0,_floatValue:0,_customData:N(e.customData)}},deserialize(e){return Un({time:e._time,toggle:!!e._value,customData:e._customData})}},Sl={serialize(e){return{_time:e.time,_type:e.color,_lineIndex:e.posX,_lineLayer:e.posY,_cutDirection:e.direction,_customData:N(e.customData)}},deserialize(e){return Jn({time:e._time,posX:e._lineIndex,posY:e._lineLayer,color:[pe.RED,pe.BLUE][e._type??0],direction:e._cutDirection,customData:e._customData})}};function V0(e){return e<1e3||e>4005e3?0:(e>=4001&&e<=4005e3?(e-4001)%1e3:0)*5+1e3}function z0(e){return e<1e3||e>4005e3?0:(e>=4001&&e<=4005e3?Math.floor((e-4001)/1e3):e-1e3)*5+1e3}const wl={serialize(e){let t=0;if(e.height>=0&&e.posY>=0){const i=e.posY>=1e3?e.posY-1e3:e.posY/1e3,n=e.height>=1e3?e.height-1e3:e.height/1e3;t=Math.floor(n/5*1e3+i/5+4001)}return{_time:e.time,_type:e.posY===2&&e.height===3?1:e.posY===0&&e.height===5?0:t,_lineIndex:e.posX,_duration:e.duration,_width:e.width,_customData:N(e.customData)}},deserialize(e){const t=e._type??0;return Zn({time:e._time,posX:e._lineIndex,posY:t===0?0:t===1?2:V0(t),duration:e._duration,width:e._width,height:t===0?5:t===1?3:z0(t),customData:e._customData})}},Cl={serialize(e){let t=e.rotation%360;const i=N(e.customData);return t>=-60&&t<=60&&t%15===0&&t/15!==0?t=tc[t]||t+1360:(i._rotation=t,t+=1360),{_time:e.time,_type:e.executionTime===1?15:14,_value:t,_floatValue:0,_customData:i}},deserialize(e){const t=e._value??0;return Qn({time:e._time,executionTime:e._type===15?1:0,rotation:typeof e._customData?._rotation=="number"?e._customData._rotation:t>=1e3?(t-1360)%360:ec[t],customData:e._customData})}},Rl={serialize(e){return{_time:e.time,_lineIndex:e.posX,_lineLayer:e.posY,_offsetDirection:e.direction,_customData:N(e.customData)}},deserialize(e){return wo({time:e._time,posX:e._lineIndex,posY:e._lineLayer,direction:e._offsetDirection,customData:e._customData})}},G0={serialize(e){return{_version:"2.6.0",_notes:[...e.difficulty.colorNotes.map(t=>Sl.serialize(t)),...e.difficulty.bombNotes.map(t=>Dl.serialize(t))].sort(Gd),_sliders:e.difficulty.arcs.map(t=>F0.serialize(t)),_obstacles:e.difficulty.obstacles.map(t=>wl.serialize(t)),_events:[...e.lightshow.basicEvents.map(t=>El.serialize(t)),...e.lightshow.colorBoostEvents.map(t=>Tl.serialize(t)),...e.difficulty.rotationEvents.map(t=>Cl.serialize(t)),...e.difficulty.bpmEvents.map(t=>ws.serialize(t))].sort(zd),_waypoints:e.lightshow.waypoints.map(t=>Rl.serialize(t)),_specialEventsKeywordFilters:_l.serialize(e.lightshow.basicEventTypesWithKeywords),_customData:N(e.difficulty.customData)}},deserialize(e,t){const i=[],n=[],o=e._notes||[];for(let b=0;b<o.length;b++){const m=o[b];m?._type===3?n.push(Dl.deserialize(m)):i.push(Sl.deserialize(m))}const r=Ta(e._version||"2.0.0","2.5.0"),s=[],a=[],l=[],u=[],f=e._events||[];for(let b=0;b<f.length;b++){const m=f[b];switch(m?._type){case 5:a.push(Tl.deserialize(m));break;case 14:case 15:l.push(Cl.deserialize(m));break;case 100:u.push(ws.deserialize(m));break;default:{const g=El.deserialize(m);r<0?m._type===10?u.push(ws.deserialize(m)):(g.floatValue=1,s.push(g)):s.push(g)}}}return Rn({version:2,filename:t?.filename,lightshowFilename:t?.lightshowFilename,difficulty:hn({colorNotes:i,bombNotes:n,obstacles:e._obstacles?.map(b=>wl.deserialize(b)),rotationEvents:l,bpmEvents:u,customData:e._customData}),lightshow:pn({waypoints:e._waypoints?.map(b=>Rl.deserialize(b)),basicEvents:s,colorBoostEvents:a,useNormalEventsAsCompatibleEvents:!0,basicEventTypesWithKeywords:_l.deserialize(e._specialEventsKeywordFilters??{})})})}},Ll={serialize(e){return{_difficulty:e.difficulty,_difficultyRank:er[e.difficulty],_beatmapFilename:e.filename,_noteJumpMovementSpeed:e.njs,_noteJumpStartBeatOffset:e.njsOffset,_beatmapColorSchemeIdx:e.colorSchemeId,_environmentNameIdx:e.environmentId,_customData:N(e.customData)}},deserialize(e,t){return Co({characteristic:t?.characteristic,difficulty:e._difficulty,authors:{mappers:t?.authors?.mappers,lighters:t?.authors?.lighters},filename:e._beatmapFilename,lightshowFilename:t?.lightshowFilename,njs:e._noteJumpMovementSpeed,njsOffset:e._noteJumpStartBeatOffset,colorSchemeId:e._beatmapColorSchemeIdx,environmentId:e._environmentNameIdx,customData:e._customData})}},j0={serialize(e){const t=new Set,i={_version:"2.1.0",_songName:e.song.title,_songSubName:e.song.subTitle,_songAuthorName:e.song.author,_levelAuthorName:"",_beatsPerMinute:e.audio.bpm,_songTimeOffset:e.audio.audioOffset,_shuffle:e.audio.shuffle,_shufflePeriod:e.audio.shufflePeriod,_previewStartTime:e.audio.previewStartTime,_previewDuration:e.audio.previewDuration,_songFilename:e.audio.filename,_coverImageFilename:e.coverImageFilename,_environmentName:e.environmentBase.normal||e.environmentNames.find(n=>!In(n))||"DefaultEnvironment",_allDirectionsEnvironmentName:e.environmentBase.allDirections||e.environmentNames.find(n=>In(n))||"GlassDesertEnvironment",_environmentNames:e.environmentNames.map(n=>n),_colorSchemes:e.colorSchemes.map(n=>{const o={useOverride:n.overrideNotes||n.overrideLights,colorScheme:{colorSchemeId:n.name,saberAColor:dt(n.saberLeftColor),saberBColor:dt(n.saberRightColor),environmentColor0:dt(n.environment0Color),environmentColor1:dt(n.environment1Color),obstaclesColor:dt(n.obstaclesColor),environmentColor0Boost:dt(n.environment0ColorBoost),environmentColor1Boost:dt(n.environment1ColorBoost)}};return n.environmentWColor&&(o.colorScheme.environmentColorW=dt(n.environmentWColor)),n.environmentWColorBoost&&(o.colorScheme.environmentColorWBoost=dt(n.environmentWColorBoost)),o}),_customData:N(e.customData),_difficultyBeatmapSets:e.difficulties.reduce((n,o)=>{let r=n.find(s=>s._beatmapCharacteristicName===o.characteristic);return r||(r={_beatmapCharacteristicName:o.characteristic,_difficultyBeatmaps:[]},n.push(r)),o.authors.mappers.forEach(s=>t.add(s)),o.authors.lighters.forEach(s=>t.add(s)),r._difficultyBeatmaps.push(Ll.serialize(o)),n},[])};return i._levelAuthorName=[...t].join(", "),i},deserialize(e,t){return Mr({version:2,filename:t?.filename,song:{title:e._songName,subTitle:e._songSubName,author:e._songAuthorName},audio:{audioDataFilename:t?.audio?.audioDataFilename,bpm:e._beatsPerMinute,lufs:t?.audio?.lufs,duration:t?.audio?.duration,previewStartTime:e._previewStartTime,previewDuration:e._previewDuration,filename:e._songFilename,audioOffset:e._songTimeOffset,shuffle:e._shuffle,shufflePeriod:e._shufflePeriod},songPreviewFilename:e._songFilename,coverImageFilename:e._coverImageFilename,environmentBase:{normal:e._environmentName,allDirections:e._allDirectionsEnvironmentName},environmentNames:e._environmentNames,colorSchemes:e._colorSchemes?.map(i=>({name:i.colorScheme?.colorSchemeId,overrideNotes:!!i.useOverride,overrideLights:!!i.useOverride,saberLeftColor:{r:i.colorScheme?.saberAColor?.r,g:i.colorScheme?.saberAColor?.g,b:i.colorScheme?.saberAColor?.b,a:i.colorScheme?.saberAColor?.a},saberRightColor:{r:i.colorScheme?.saberBColor?.r,g:i.colorScheme?.saberBColor?.g,b:i.colorScheme?.saberBColor?.b,a:i.colorScheme?.saberBColor?.a},environment0Color:{r:i.colorScheme?.environmentColor0?.r,g:i.colorScheme?.environmentColor0?.g,b:i.colorScheme?.environmentColor0?.b,a:i.colorScheme?.environmentColor0?.a},environment1Color:{r:i.colorScheme?.environmentColor1?.r,g:i.colorScheme?.environmentColor1?.g,b:i.colorScheme?.environmentColor1?.b,a:i.colorScheme?.environmentColor1?.a},obstaclesColor:{r:i.colorScheme?.obstaclesColor?.r,g:i.colorScheme?.obstaclesColor?.g,b:i.colorScheme?.obstaclesColor?.b,a:i.colorScheme?.obstaclesColor?.a},environment0ColorBoost:{r:i.colorScheme?.environmentColor0Boost?.r,g:i.colorScheme?.environmentColor0Boost?.g,b:i.colorScheme?.environmentColor0Boost?.b,a:i.colorScheme?.environmentColor0Boost?.a},environment1ColorBoost:{r:i.colorScheme?.environmentColor1Boost?.r,g:i.colorScheme?.environmentColor1Boost?.g,b:i.colorScheme?.environmentColor1Boost?.b,a:i.colorScheme?.environmentColor1Boost?.a},environmentWColor:i.colorScheme?.environmentColorW?{r:i.colorScheme?.environmentColorW?.r,g:i.colorScheme?.environmentColorW?.g,b:i.colorScheme?.environmentColorW?.b,a:i.colorScheme?.environmentColorW?.a}:void 0,environmentWColorBoost:i.colorScheme?.environmentColorWBoost?{r:i.colorScheme?.environmentColorWBoost?.r,g:i.colorScheme?.environmentColorWBoost?.g,b:i.colorScheme?.environmentColorWBoost?.b,a:i.colorScheme?.environmentColorWBoost?.a}:void 0})),difficulties:e._difficultyBeatmapSets?.flatMap(i=>i._difficultyBeatmaps?.map(n=>Ll.deserialize(n,{characteristic:i._beatmapCharacteristicName,authors:{mappers:e._levelAuthorName?.split(/,|\s+(?:and|&|vs.|VS)\s+/)}}))??[]),customData:e._customData})}},Nl={serialize(e){return{b:e.time,c:e.color,x:e.posX,y:e.posY,d:e.direction,mu:e.lengthMultiplier,tb:e.tailTime,tx:e.tailPosX,ty:e.tailPosY,tc:e.tailDirection,tmu:e.tailLengthMultiplier,m:e.midAnchor,customData:N(e.customData)}},deserialize(e){return To({time:e.b,color:e.c,posX:e.x,posY:e.y,direction:e.d,lengthMultiplier:e.mu,tailTime:e.tb,tailPosX:e.tx,tailPosY:e.ty,tailDirection:e.tc,tailLengthMultiplier:e.tmu,midAnchor:e.m,customData:e.customData})}},ir={serialize(e){return{b:e.time,et:e.type,i:e.value,f:e.floatValue,customData:N(e.customData)}},deserialize(e){return qn({time:e.b,type:e.et,value:e.i,floatValue:e.f,customData:e.customData})}},xl={serialize(e){return{k:e.keyword,e:e.events.map(t=>t)}},deserialize(e){return _r({keyword:e.k,events:e.e?.map(t=>t)})}},nr={serialize(e){return{d:e.list.map(t=>xl.serialize(t))}},deserialize(e){return{list:e.d?.map(t=>xl.deserialize(t))??[]}}},Ol={serialize(e){return{b:e.time,x:e.posX,y:e.posY,customData:N(e.customData)}},deserialize(e){return Kn({time:e.b,posX:e.x,posY:e.y,customData:e.customData})}},Bl={serialize(e){return{b:e.time,m:e.bpm,customData:N(e.customData)}},deserialize(e){return So({time:e.b,bpm:e.m,customData:e.customData})}},kl={serialize(e){return{b:e.time,c:e.color,x:e.posX,y:e.posY,d:e.direction,tb:e.tailTime,tx:e.tailPosX,ty:e.tailPosY,sc:e.sliceCount,s:e.squish,customData:N(e.customData)}},deserialize(e){return Dr({time:e.b,color:e.c,posX:e.x,posY:e.y,direction:e.d,tailTime:e.tb,tailPosX:e.tx,tailPosY:e.ty,sliceCount:e.sc,squish:e.s,customData:e.customData})}},or={serialize(e){return{b:e.time,o:e.toggle,customData:N(e.customData)}},deserialize(e={}){return Un({time:e.b,toggle:!!e.o,customData:e.customData})}},Al={serialize(e){return{b:e.time,c:e.color,x:e.posX,y:e.posY,d:e.direction,a:e.angleOffset,customData:N(e.customData)}},deserialize(e){return Jn({time:e.b,posX:e.x,posY:e.y,color:e.c,direction:e.d,angleOffset:e.a,customData:e.customData})}},Pl={serialize(e){return{b:e.time,i:e.easing,p:e.previous,v:e.value,customData:N(e.customData)}},deserialize(e){return Sr({time:e.b,easing:e.i,previous:e.p,value:e.v,customData:e.customData})}},un={serialize(e){return{f:e.type,p:e.p0,t:e.p1,r:e.reverse,c:e.chunks,n:e.random,s:e.seed,l:e.limit,d:e.limitAffectsType,customData:N(e.customData)}},deserialize(e){return Cn({type:e.f,p0:e.p,p1:e.t,reverse:e.r,chunks:e.c,random:e.n,seed:e.s,limit:e.l,limitAffectsType:e.d,customData:e.customData})}},Ml={serialize(e){return{data:{f:un.serialize(e.filter),w:e.beatDistribution,d:e.beatDistributionType,s:e.fxDistribution,t:e.fxDistributionType,b:e.affectFirst,i:e.easing,l:[],customData:N(e.customData)},eventData:e.events.map(t=>Pl.serialize(t))}},deserialize(e){return wr({filter:un.deserialize(e.data?.f??{}),beatDistribution:e.data?.w,beatDistributionType:e.data?.d,fxDistribution:e.data?.s,fxDistributionType:e.data?.t,affectFirst:e.data?.b,easing:e.data?.i,events:e.eventData?.map(t=>Pl.deserialize(t)),customData:e.data?.customData})}},rr={serialize(e){return{object:{t:hr.FLOAT,b:e.time,g:e.id,e:[],customData:N(e.customData)},boxData:e.boxes.map(t=>Ml.serialize(t))}},deserialize(e){return Cr({time:e.object?.b,id:e.object?.g,boxes:e.boxData?.map(t=>Ml.deserialize(t)),customData:e.object?.customData})}},Il={serialize(e){return{b:e.time,c:e.color,f:e.frequency,i:e.previous?An.EXTEND:e.easing===Jo.NONE?An.INSTANT:An.INTERPOLATE,s:e.brightness,sb:e.strobeBrightness,sf:e.strobeFade,customData:N(e.customData)}},deserialize(e){return Rr({time:e.b,color:e.c,frequency:e.f,previous:e.i===An.EXTEND?1:0,easing:e.i===An.INTERPOLATE?Jo.LINEAR:Jo.NONE,brightness:e.s,strobeBrightness:e.sb,strobeFade:e.sf,customData:e.customData})}},$l={serialize(e){return{f:un.serialize(e.filter),w:e.beatDistribution,d:e.beatDistributionType,r:e.brightnessDistribution,t:e.brightnessDistributionType,b:e.affectFirst,i:e.easing,e:e.events.map(t=>Il.serialize(t)),customData:N(e.customData)}},deserialize(e){return Lr({filter:un.deserialize(e.f??{}),beatDistribution:e.w,beatDistributionType:e.d,brightnessDistribution:e.r,brightnessDistributionType:e.t,affectFirst:e.b,easing:e.i,events:e.e?.map(t=>Il.deserialize(t)),customData:e.customData})}},sr={serialize(e){return{b:e.time,g:e.id,e:e.boxes.map(t=>$l.serialize(t)),customData:N(e.customData)}},deserialize(e){return Nr({time:e.b,id:e.g,boxes:e.e?.map(t=>$l.deserialize(t)),customData:e.customData})}},Fl={serialize(e){return{b:e.time,e:e.easing,l:e.loop,o:e.direction,p:e.previous,r:e.rotation,customData:N(e.customData)}},deserialize(e){return xr({time:e.b,easing:e.e,loop:e.l,direction:e.o,previous:e.p,rotation:e.r,customData:e.customData})}},Vl={serialize(e){return{f:un.serialize(e.filter),w:e.beatDistribution,d:e.beatDistributionType,s:e.rotationDistribution,t:e.rotationDistributionType,a:e.axis,r:e.flip,b:e.affectFirst,i:e.easing,l:e.events.map(t=>Fl.serialize(t)),customData:N(e.customData)}},deserialize(e){return Or({filter:un.deserialize(e.f??{}),beatDistribution:e.w,beatDistributionType:e.d,rotationDistribution:e.s,rotationDistributionType:e.t,axis:e.a,flip:e.r,affectFirst:e.b,easing:e.i,events:e.l?.map(t=>Fl.deserialize(t)),customData:e.customData})}},ar={serialize(e){return{b:e.time,g:e.id,e:e.boxes.map(t=>Vl.serialize(t)),customData:N(e.customData)}},deserialize(e){return Br({time:e.b,id:e.g,boxes:e.e?.map(t=>Vl.deserialize(t)),customData:e.customData})}},zl={serialize(e){return{b:e.time,e:e.easing,p:e.previous,t:e.translation,customData:N(e.customData)}},deserialize(e){return kr({time:e.b,easing:e.e,previous:e.p,translation:e.t,customData:e.customData})}},Gl={serialize(e){return{f:un.serialize(e.filter),w:e.beatDistribution,d:e.beatDistributionType,s:e.gapDistribution,t:e.gapDistributionType,a:e.axis,r:e.flip,b:e.affectFirst,i:e.easing,l:e.events.map(t=>zl.serialize(t)),customData:N(e.customData)}},deserialize(e){return Ar({filter:un.deserialize(e.f??{}),beatDistribution:e.w,beatDistributionType:e.d,gapDistribution:e.s,gapDistributionType:e.t,axis:e.a,flip:e.r,affectFirst:e.b,easing:e.i,events:e.l?.map(t=>zl.deserialize(t)),customData:e.customData})}},lr={serialize(e){return{b:e.time,g:e.id,e:e.boxes.map(t=>Gl.serialize(t)),customData:N(e.customData)}},deserialize(e){return Pr({time:e.b,id:e.g,boxes:e.e?.map(t=>Gl.deserialize(t)),customData:e.customData})}},jl={serialize(e){return{b:e.time,x:e.posX,y:e.posY,d:e.duration,w:e.width,h:e.height,customData:N(e.customData)}},deserialize(e){return Zn({time:e.b,posX:e.x,posY:e.y,duration:e.d,width:e.w,height:e.h,customData:e.customData})}},Wl={serialize(e){return{b:e.time,e:e.executionTime,r:e.rotation,customData:N(e.customData)}},deserialize(e){return Qn({time:e.b,executionTime:e.e,rotation:e.r,customData:e.customData})}},Hl={serialize(e){return{b:e.time,x:e.posX,y:e.posY,d:e.direction,customData:N(e.customData)}},deserialize(e){return wo({time:e.b,posX:e.x,posY:e.y,direction:e.d,customData:e.customData})}},W0={serialize(e){const t={version:"3.3.0",bpmEvents:e.difficulty.bpmEvents.map(i=>Bl.serialize(i)),rotationEvents:e.difficulty.rotationEvents.map(i=>Wl.serialize(i)),colorNotes:e.difficulty.colorNotes.map(i=>Al.serialize(i)),bombNotes:e.difficulty.bombNotes.map(i=>Ol.serialize(i)),obstacles:e.difficulty.obstacles.map(i=>jl.serialize(i)),sliders:e.difficulty.arcs.map(i=>Nl.serialize(i)),burstSliders:e.difficulty.chains.map(i=>kl.serialize(i)),waypoints:e.lightshow.waypoints.map(i=>Hl.serialize(i)),basicBeatmapEvents:e.lightshow.basicEvents.map(i=>ir.serialize(i)),colorBoostBeatmapEvents:e.lightshow.colorBoostEvents.map(i=>or.serialize(i)),lightColorEventBoxGroups:e.lightshow.lightColorEventBoxGroups.map(i=>sr.serialize(i)),lightRotationEventBoxGroups:e.lightshow.lightRotationEventBoxGroups.map(i=>ar.serialize(i)),lightTranslationEventBoxGroups:e.lightshow.lightTranslationEventBoxGroups.map(i=>lr.serialize(i)),vfxEventBoxGroups:[],basicEventTypesWithKeywords:nr.serialize(e.lightshow.basicEventTypesWithKeywords),_fxEventsCollection:{_fl:[],_il:[]},useNormalEventsAsCompatibleEvents:e.lightshow.useNormalEventsAsCompatibleEvents,customData:N(e.difficulty.customData)};for(const i of e.lightshow.fxEventBoxGroups.map(n=>rr.serialize(n))){t.vfxEventBoxGroups.push(i.object);for(const n of i.boxData){i.object.e.push(n.data);for(const o of n.eventData)n.data.l.push(t._fxEventsCollection._fl.length),t._fxEventsCollection._fl.push(o)}}return t},deserialize(e,t){const i=e._fxEventsCollection?._fl;return Rn({version:3,filename:t?.filename,lightshowFilename:t?.lightshowFilename,difficulty:hn({colorNotes:e.colorNotes?.map(n=>Al.deserialize(n)),bombNotes:e.bombNotes?.map(n=>Ol.deserialize(n)),obstacles:e.obstacles?.map(n=>jl.deserialize(n)),arcs:e.sliders?.map(n=>Nl.deserialize(n)),chains:e.burstSliders?.map(n=>kl.deserialize(n)),rotationEvents:e.rotationEvents?.map(n=>Wl.deserialize(n)),bpmEvents:e.bpmEvents?.map(n=>Bl.deserialize(n)),customData:e.customData}),lightshow:pn({waypoints:e.waypoints?.map(n=>Hl.deserialize(n)),basicEvents:e.basicBeatmapEvents?.map(n=>ir.deserialize(n)),colorBoostEvents:e.colorBoostBeatmapEvents?.map(n=>or.deserialize(n)),lightColorEventBoxGroups:e.lightColorEventBoxGroups?.map(n=>sr.deserialize(n)),lightRotationEventBoxGroups:e.lightRotationEventBoxGroups?.map(n=>ar.deserialize(n)),lightTranslationEventBoxGroups:e.lightTranslationEventBoxGroups?.map(n=>lr.deserialize(n)),fxEventBoxGroups:e.vfxEventBoxGroups?.map(n=>rr.deserialize({object:{...n,t:hr.FLOAT},boxData:n.e?.map(o=>({data:o,eventData:o.l?.map(r=>i[r])??[]}))??[]})),basicEventTypesWithKeywords:nr.deserialize(e.basicEventTypesWithKeywords??{}),useNormalEventsAsCompatibleEvents:e.useNormalEventsAsCompatibleEvents})})}},H0={serialize(e){const t={basicBeatmapEvents:e.lightshow.basicEvents.map(i=>ir.serialize(i)),colorBoostBeatmapEvents:e.lightshow.colorBoostEvents.map(i=>or.serialize(i)),lightColorEventBoxGroups:e.lightshow.lightColorEventBoxGroups.map(i=>sr.serialize(i)),lightRotationEventBoxGroups:e.lightshow.lightRotationEventBoxGroups.map(i=>ar.serialize(i)),lightTranslationEventBoxGroups:e.lightshow.lightTranslationEventBoxGroups.map(i=>lr.serialize(i)),vfxEventBoxGroups:[],_fxEventsCollection:{_fl:[],_il:[]},customData:N(e.lightshow.customData)};for(const i of e.lightshow.fxEventBoxGroups.map(n=>rr.serialize(n))){t.vfxEventBoxGroups.push(i.object);for(const n of i.boxData){i.object.e.push(n.data);for(const o of n.eventData)n.data.l.push(t._fxEventsCollection._fl.length),t._fxEventsCollection._fl.push(o)}}return t},deserialize(e,t){const i=e._fxEventsCollection?._fl;return Rn({version:3,filename:t?.filename,lightshowFilename:t?.lightshowFilename,difficulty:hn(),lightshow:pn({basicEvents:e.basicBeatmapEvents?.map(n=>ir.deserialize(n)),colorBoostEvents:e.colorBoostBeatmapEvents?.map(n=>or.deserialize(n)),lightColorEventBoxGroups:e.lightColorEventBoxGroups?.map(n=>sr.deserialize(n)),lightRotationEventBoxGroups:e.lightRotationEventBoxGroups?.map(n=>ar.deserialize(n)),lightTranslationEventBoxGroups:e.lightTranslationEventBoxGroups?.map(n=>lr.deserialize(n)),fxEventBoxGroups:e.vfxEventBoxGroups?.map(n=>rr.deserialize({object:{...n,t:hr.FLOAT},boxData:n.e?.map(o=>({data:o,eventData:o.l?.map(r=>i[r])??[]}))??[]})),customData:e.customData})})}},Y0={serialize(e){return{version:"4.0.0",songChecksum:e.audioChecksum,songSampleCount:e.sampleCount,songFrequency:e.frequency,bpmData:e.bpmData.map(t=>({sb:t.startBeat,eb:t.endBeat,si:t.startSampleIndex,ei:t.endSampleIndex})),lufsData:e.lufsData.map(t=>({l:t.lufs,si:t.startSampleIndex,ei:t.endSampleIndex}))}},deserialize(e,t){return Ea({version:4,filename:t?.filename,audioChecksum:e.songChecksum,sampleCount:e.songSampleCount,frequency:e.songFrequency,bpmData:e.bpmData?.map(i=>({startBeat:i?.sb,endBeat:i?.eb,startSampleIndex:i?.si,endSampleIndex:i?.ei})),lufsData:e.lufsData?.map(i=>({lufs:i?.l,startSampleIndex:i?.si,endSampleIndex:i?.ei}))})}},Yl={serialize(e){return{object:{ai:0,hb:e.time,hi:0,hr:e.laneRotation,tb:e.tailTime,ti:0,tr:e.tailLaneRotation,customData:{}},data:{m:e.lengthMultiplier,tm:e.tailLengthMultiplier,a:e.midAnchor,customData:N(e.customData)},headData:{c:e.color,x:e.posX,y:e.posY,d:e.direction,a:0,customData:{}},tailData:{c:e.color,x:e.tailPosX,y:e.tailPosY,d:e.tailDirection,a:0,customData:{}}}},deserialize(e){return To({time:e.object?.hb,laneRotation:e.object?.hr,tailTime:e.object?.tb,tailLaneRotation:e.object?.tr,color:e.headData?.c,posX:e.headData?.x,posY:e.headData?.y,direction:e.headData?.d,lengthMultiplier:e.data?.m,tailPosX:e.tailData?.x,tailPosY:e.tailData?.y,tailDirection:e.tailData?.d,tailLengthMultiplier:e.data?.tm,midAnchor:e.data?.a,customData:e.data?.customData})}},Xl={serialize(e){return{object:{b:e.time,i:0,r:e.laneRotation,customData:{}},data:{x:e.posX,y:e.posY,customData:N(e.customData)}}},deserialize(e){return Kn({time:e.object?.b,laneRotation:e.object?.r,posX:e.data?.x,posY:e.data?.y,customData:e.data?.customData})}},ql={serialize(e){return{object:{hb:e.time,hr:e.laneRotation,tb:e.tailTime,tr:e.tailLaneRotation,i:0,ci:0,customData:{}},data:{c:e.color,x:e.posX,y:e.posY,d:e.direction,a:0,customData:{}},chainData:{tx:e.tailPosX,ty:e.tailPosY,c:e.sliceCount,s:e.squish,customData:N(e.customData)}}},deserialize(e){return Dr({time:e.object?.hb,laneRotation:e.object?.hr,color:e.data?.c,posX:e.data?.x,posY:e.data?.y,direction:e.data?.d,tailTime:e.object?.tb,tailLaneRotation:e.object?.tr,tailPosX:e.chainData?.tx,tailPosY:e.chainData?.ty,sliceCount:e.chainData?.c,squish:e.chainData?.s,customData:e.chainData?.customData})}},Kl={serialize(e){return{object:{b:e.time,i:0,r:e.laneRotation,customData:{}},data:{c:e.color,x:e.posX,y:e.posY,d:e.direction,a:e.angleOffset,customData:N(e.customData)}}},deserialize(e){return Jn({time:e.object?.b,laneRotation:e.object?.r,posX:e.data?.x,posY:e.data?.y,color:e.data?.c,direction:e.data?.d,angleOffset:e.data?.a,customData:e.data?.customData})}},Jl={serialize(e){return{object:{b:e.time,i:0,customData:{}},data:{d:e.value,p:e.previous,e:e.easing,customData:N(e.customData)}}},deserialize(e){return ya({time:e.object?.b,value:e.data?.d,previous:e.data?.p,easing:e.data?.e,customData:e.data?.customData})}},Zl={serialize(e){return{object:{b:e.time,i:0,r:e.laneRotation,customData:{}},data:{x:e.posX,y:e.posY,d:e.duration,w:e.width,h:e.height,customData:N(e.customData)}}},deserialize(e){return Zn({time:e.object?.b,laneRotation:e.object?.r,posX:e.data?.x,posY:e.data?.y,duration:e.data?.d,width:e.data?.w,height:e.data?.h,customData:e.data?.customData})}},X0={serialize(e){return{object:{b:e.time},data:{e:e.executionTime,r:e.rotation,customData:N(e.customData)}}},deserialize(e){return Qn({time:e.object?.b,executionTime:e.data?.e,rotation:e.data?.r,customData:e.data?.customData})}},q0={serialize(e){const t={version:"4.1.0",colorNotes:[],bombNotes:[],obstacles:[],chains:[],arcs:[],colorNotesData:[],bombNotesData:[],obstaclesData:[],chainsData:[],arcsData:[],njsEvents:[],njsEventData:[],customData:N(e.difficulty.customData)};for(const i of e.difficulty.colorNotes.map(n=>Kl.serialize(n)))t.colorNotes.push(i.object),i.object.i=t.colorNotesData.length,t.colorNotesData.push(i.data);for(const i of e.difficulty.bombNotes.map(n=>Xl.serialize(n)))t.bombNotes.push(i.object),i.object.i=t.bombNotesData.length,t.bombNotesData.push(i.data);for(const i of e.difficulty.obstacles.map(n=>Zl.serialize(n)))t.obstacles.push(i.object),i.object.i=t.obstaclesData.length,t.obstaclesData.push(i.data);for(const i of e.difficulty.arcs.map(n=>Yl.serialize(n)))t.arcs.push(i.object),i.object.ai=t.arcsData.length,t.arcsData.push(i.data),i.object.hi=t.colorNotesData.length,t.colorNotesData.push(i.headData),i.object.ti=t.colorNotesData.length,t.colorNotesData.push(i.tailData);for(const i of e.difficulty.chains.map(n=>ql.serialize(n)))t.chains.push(i.object),i.object.i=t.colorNotesData.length,t.colorNotesData.push(i.data),i.object.ci=t.chainsData.length,t.chainsData.push(i.chainData);for(const i of e.difficulty.njsEvents.map(n=>Jl.serialize(n)))t.njsEvents.push(i.object),i.object.i=t.njsEventData.length,t.njsEventData.push(i.data);return t},deserialize(e,t){return Rn({version:4,filename:t?.filename,lightshowFilename:t?.lightshowFilename,difficulty:hn({colorNotes:e.colorNotes?.map(i=>Kl.deserialize({object:i,data:e.colorNotesData?.[i?.i??0]??{}})),bombNotes:e.bombNotes?.map(i=>Xl.deserialize({object:i,data:e.bombNotesData?.[i?.i??0]??{}})),obstacles:e.obstacles?.map(i=>Zl.deserialize({object:i,data:e.obstaclesData?.[i?.i??0]??{}})),arcs:e.arcs?.map(i=>Yl.deserialize({object:i,data:e.arcsData?.[i?.ai??0]??{},headData:e.colorNotesData?.[i?.hi??0]??{},tailData:e.colorNotesData?.[i?.ti??0]??{}})),chains:e.chains?.map(i=>ql.deserialize({object:i,data:e.colorNotesData?.[i?.i??0]??{},chainData:e.chainsData?.[i?.ci??0]??{}})),rotationEvents:e.spawnRotations?.map(i=>X0.deserialize({object:i,data:e.spawnRotationsData?.[i?.i??0]??{}})),njsEvents:e.njsEvents?.map(i=>Jl.deserialize({object:i,data:e.njsEventData?.[i?.i??0]??{}})),customData:e.customData}),lightshow:pn()})}},Ql={serialize(e){return{characteristic:e.characteristic,difficulty:e.difficulty,beatmapAuthors:{mappers:[...e.authors.mappers],lighters:[...e.authors.lighters]},environmentNameIdx:e.environmentId,beatmapColorSchemeIdx:e.colorSchemeId,noteJumpMovementSpeed:e.njs,noteJumpStartBeatOffset:e.njsOffset,lightshowDataFilename:e.lightshowFilename,beatmapDataFilename:e.filename,customData:N(e.customData)}},deserialize(e){return Co({characteristic:e.characteristic,difficulty:e.difficulty,authors:{mappers:e.beatmapAuthors?.mappers,lighters:e.beatmapAuthors?.lighters},filename:e.beatmapDataFilename,lightshowFilename:e.lightshowDataFilename,njs:e.noteJumpMovementSpeed,njsOffset:e.noteJumpStartBeatOffset,colorSchemeId:e.beatmapColorSchemeIdx,environmentId:e.environmentNameIdx,customData:e.customData})}},K0={serialize(e){return{version:"4.0.1",song:{author:e.song.author,title:e.song.title,subTitle:e.song.subTitle},audio:{songFilename:e.audio.filename,songDuration:e.audio.duration,audioDataFilename:e.audio.audioDataFilename,bpm:e.audio.bpm,lufs:e.audio.lufs,previewStartTime:e.audio.previewStartTime,previewDuration:e.audio.previewDuration},songPreviewFilename:e.songPreviewFilename,coverImageFilename:e.coverImageFilename,environmentNames:e.environmentNames.map(t=>t),colorSchemes:e.colorSchemes.map(t=>{const i={colorSchemeName:t.name,overrideNotes:t.overrideNotes,overrideLights:t.overrideLights,saberAColor:ke(t.saberLeftColor),saberBColor:ke(t.saberRightColor),environmentColor0:ke(t.environment0Color),environmentColor1:ke(t.environment1Color),obstaclesColor:ke(t.obstaclesColor),environmentColor0Boost:ke(t.environment0ColorBoost),environmentColor1Boost:ke(t.environment1ColorBoost)};return t.environmentWColor&&(i.environmentColorW=ke(t.environmentWColor)),t.environmentWColorBoost&&(i.environmentColorWBoost=ke(t.environmentWColorBoost)),i}),difficultyBeatmaps:e.difficulties.map(t=>Ql.serialize(t)),customData:N(e.customData)}},deserialize(e,t){return Mr({version:4,filename:t?.filename,song:{author:e.song?.author,title:e.song?.title,subTitle:e.song?.subTitle},audio:{filename:e.audio?.songFilename,duration:e.audio?.songDuration,audioDataFilename:e.audio?.audioDataFilename,bpm:e.audio?.bpm,lufs:e.audio?.lufs,previewStartTime:e.audio?.previewStartTime,previewDuration:e.audio?.previewDuration},songPreviewFilename:e.songPreviewFilename,coverImageFilename:e.coverImageFilename,environmentNames:e.environmentNames,colorSchemes:e.colorSchemes?.map(i=>{const n={name:i?.colorSchemeName??"",overrideNotes:i?.overrideNotes??e.version==="4.0.0",overrideLights:i?.overrideLights??e.version==="4.0.0",saberLeftColor:ii(mi(i.saberAColor),!0),saberRightColor:ii(mi(i.saberBColor),!0),environment0Color:ii(mi(i.environmentColor0),!0),environment1Color:ii(mi(i.environmentColor1),!0),obstaclesColor:ii(mi(i.obstaclesColor),!0),environment0ColorBoost:ii(mi(i.environmentColor0Boost),!0),environment1ColorBoost:ii(mi(i.environmentColor1Boost),!0)};return i.environmentColorW&&(n.environmentWColor=ii(mi(i.environmentColorW),!0)),i.environmentColorWBoost&&(n.environmentWColorBoost=ii(mi(i.environmentColorWBoost),!0)),n}),difficulties:e.difficultyBeatmaps?.map(i=>Ql.deserialize(i)),customData:e.customData})}},Ul={serialize(e){return{object:{b:e.time,i:0,customData:{}},data:{t:e.type,i:e.value,f:e.floatValue,customData:N(e.customData)}}},deserialize(e){return qn({time:e.object?.b,type:e.data?.t,value:e.data?.i,floatValue:e.data?.f,customData:e.data?.customData})}},eu={serialize(e){return{object:{b:e.time,i:0,customData:{}},data:{b:e.toggle?1:0,customData:N(e.customData)}}},deserialize(e){return Un({time:e.object?.b,toggle:!!e.data?.b,customData:e.data?.customData})}},tu={serialize(e){return{data:{p:e.previous,e:e.easing,v:e.value,customData:N(e.customData)},time:e.time}},deserialize(e){return Sr({time:e.time,previous:e.data?.p,easing:e.data?.e,value:e.data?.v,customData:e.data?.customData})}},cn={serialize(e){return{f:e.type,p:e.p0,t:e.p1,r:e.reverse,c:e.chunks,n:e.random,s:e.seed,l:e.limit,d:e.limitAffectsType,customData:N(e.customData)}},deserialize(e){return Cn({type:e.f,p0:e.p,p1:e.t,reverse:e.r,chunks:e.c,random:e.n,seed:e.s,limit:e.l,limitAffectsType:e.d,customData:e.customData})}},iu={serialize(e){return{data:{w:e.beatDistribution,d:e.beatDistributionType,s:e.fxDistribution,t:e.fxDistributionType,b:e.affectFirst,e:e.easing,customData:N(e.customData)},eventData:e.events.map(t=>tu.serialize(t)),filterData:cn.serialize(e.filter)}},deserialize(e){return wr({filter:cn.deserialize(e.filterData??{}),beatDistribution:e.data?.w,beatDistributionType:e.data?.d,fxDistribution:e.data?.s,fxDistributionType:e.data?.t,affectFirst:e.data?.b,easing:e.data?.e,events:e.eventData?.map(t=>tu.deserialize(t)),customData:e.data?.customData})}},nu={serialize(e){return{object:{t:ji.FX_FLOAT,b:e.time,g:e.id,e:[],customData:N(e.customData)},boxData:e.boxes.map(t=>iu.serialize(t))}},deserialize(e){return Cr({time:e.object?.b,id:e.object?.g,boxes:e.boxData?.map(t=>iu.deserialize(t)),customData:e.object?.customData})}},ou={serialize(e){return{data:{p:e.previous,c:e.color,e:e.easing,b:e.brightness,f:e.frequency,sb:e.strobeBrightness,sf:e.strobeFade,customData:N(e.customData)},time:e.time}},deserialize(e){return Rr({time:e.time,previous:e.data?.p,color:e.data?.c,frequency:e.data?.f,easing:e.data?.e,brightness:e.data?.b,strobeBrightness:e.data?.sb,strobeFade:e.data?.sf,customData:e.data?.customData})}},ru={serialize(e){return{data:{w:e.beatDistribution,d:e.beatDistributionType,s:e.brightnessDistribution,t:e.brightnessDistributionType,b:e.affectFirst,e:e.easing,customData:N(e.customData)},eventData:e.events.map(t=>ou.serialize(t)),filterData:cn.serialize(e.filter)}},deserialize(e){return Lr({filter:cn.deserialize(e.filterData??{}),beatDistribution:e.data?.w,beatDistributionType:e.data?.d,brightnessDistribution:e.data?.s,brightnessDistributionType:e.data?.t,affectFirst:e.data?.b,easing:e.data?.e,events:e.eventData?.map(t=>ou.deserialize(t)),customData:e.data?.customData})}},su={serialize(e){return{object:{t:ji.COLOR,b:e.time,g:e.id,e:[],customData:N(e.customData)},boxData:e.boxes.map(t=>ru.serialize(t))}},deserialize(e){return Nr({time:e.object?.b,id:e.object?.g,boxes:e.boxData?.map(t=>ru.deserialize(t)),customData:e.object?.customData})}},au={serialize(e){return{data:{p:e.previous,l:e.loop,e:e.easing,r:e.rotation,d:e.direction,customData:N(e.customData)},time:e.time}},deserialize(e){return xr({time:e.time,previous:e.data?.p,easing:e.data?.e,loop:e.data?.l,rotation:e.data?.r,direction:e.data?.d,customData:e.data?.customData})}},lu={serialize(e){return{data:{w:e.beatDistribution,d:e.beatDistributionType,s:e.rotationDistribution,t:e.rotationDistributionType,b:e.affectFirst,e:e.easing,a:e.axis,f:e.flip,customData:N(e.customData)},eventData:e.events.map(t=>au.serialize(t)),filterData:cn.serialize(e.filter)}},deserialize(e){return Or({filter:cn.deserialize(e.filterData??{}),beatDistribution:e.data?.w,beatDistributionType:e.data?.d,rotationDistribution:e.data?.s,rotationDistributionType:e.data?.t,affectFirst:e.data?.b,easing:e.data?.e,axis:e.data?.a,flip:e.data?.f,events:e.eventData?.map(t=>au.deserialize(t)),customData:e.data?.customData})}},uu={serialize(e){return{object:{t:ji.ROTATION,b:e.time,g:e.id,e:[],customData:N(e.customData)},boxData:e.boxes.map(t=>lu.serialize(t))}},deserialize(e){return Br({time:e.object?.b,id:e.object?.g,boxes:e.boxData?.map(t=>lu.deserialize(t)),customData:e.object?.customData})}},cu={serialize(e){return{data:{p:e.previous,e:e.easing,t:e.translation,customData:N(e.customData)},time:e.time}},deserialize(e){return kr({time:e.time,previous:e.data?.p,easing:e.data?.e,translation:e.data?.t,customData:e.data?.customData})}},fu={serialize(e){return{data:{w:e.beatDistribution,d:e.beatDistributionType,s:e.gapDistribution,t:e.gapDistributionType,b:e.affectFirst,e:e.easing,a:e.axis,f:e.flip,customData:N(e.customData)},eventData:e.events.map(t=>cu.serialize(t)),filterData:cn.serialize(e.filter)}},deserialize(e){return Ar({filter:cn.deserialize(e.filterData??{}),beatDistribution:e.data?.w,beatDistributionType:e.data?.d,gapDistribution:e.data?.s,gapDistributionType:e.data?.t,affectFirst:e.data?.b,easing:e.data?.e,axis:e.data?.a,flip:e.data?.f,events:e.eventData?.map(t=>cu.deserialize(t)),customData:e.data?.customData})}},mu={serialize(e){return{object:{t:ji.TRANSLATION,b:e.time,g:e.id,e:[],customData:N(e.customData)},boxData:e.boxes.map(t=>fu.serialize(t))}},deserialize(e){return Pr({time:e.object?.b,id:e.object?.g,boxes:e.boxData?.map(t=>fu.deserialize(t)),customData:e.object?.customData})}},hu={serialize(e){return{object:{b:e.time,i:0,r:e.laneRotation,customData:{}},data:{x:e.posX,y:e.posY,d:e.direction,customData:N(e.customData)}}},deserialize(e){return wo({time:e.object?.b,laneRotation:e.object?.r,posX:e.data?.x,posY:e.data?.y,direction:e.data?.d,customData:e.data?.customData})}},J0={serialize(e){const t={version:"4.0.0",waypoints:[],waypointsData:[],basicEvents:[],basicEventsData:[],colorBoostEvents:[],colorBoostEventsData:[],eventBoxGroups:[],indexFilters:[],lightColorEventBoxes:[],lightColorEvents:[],lightRotationEventBoxes:[],lightRotationEvents:[],lightTranslationEventBoxes:[],lightTranslationEvents:[],fxEventBoxes:[],floatFxEvents:[],basicEventTypesWithKeywords:nr.serialize(e.lightshow.basicEventTypesWithKeywords),useNormalEventsAsCompatibleEvents:e.lightshow.useNormalEventsAsCompatibleEvents,customData:N(e.lightshow.customData)};for(const i of e.lightshow.waypoints.map(n=>hu.serialize(n)))t.waypoints.push(i.object),i.object.i=t.waypointsData.length,t.waypointsData.push(i.data);for(const i of e.lightshow.basicEvents.map(n=>Ul.serialize(n)))t.basicEvents.push(i.object),i.object.i=t.basicEventsData.length,t.basicEventsData.push(i.data);for(const i of e.lightshow.colorBoostEvents.map(n=>eu.serialize(n)))t.colorBoostEvents.push(i.object),i.object.i=t.colorBoostEventsData.length,t.colorBoostEventsData.push(i.data);for(const i of e.lightshow.lightColorEventBoxGroups.map(n=>su.serialize(n))){t.eventBoxGroups.push(i.object);for(const n of i.boxData){const o=[];for(const r of n.eventData)o.push({b:r.time,i:t.lightColorEvents.length}),t.lightColorEvents.push(r.data);i.object.e.push({e:t.lightColorEventBoxes.length,f:t.indexFilters.length,l:o,customData:{}}),t.lightColorEventBoxes.push(n.data),t.indexFilters.push(n.filterData)}}for(const i of e.lightshow.lightRotationEventBoxGroups.map(n=>uu.serialize(n))){t.eventBoxGroups.push(i.object);for(const n of i.boxData){const o=[];for(const r of n.eventData)o.push({b:r.time,i:t.lightRotationEvents.length}),t.lightRotationEvents.push(r.data);i.object.e.push({e:t.lightRotationEventBoxes.length,f:t.indexFilters.length,l:o,customData:{}}),t.lightRotationEventBoxes.push(n.data),t.indexFilters.push(n.filterData)}}for(const i of e.lightshow.lightTranslationEventBoxGroups.map(n=>mu.serialize(n))){t.eventBoxGroups.push(i.object);for(const n of i.boxData){const o=[];for(const r of n.eventData)o.push({b:r.time,i:t.lightTranslationEvents.length}),t.lightTranslationEvents.push(r.data);i.object.e.push({e:t.lightTranslationEventBoxes.length,f:t.indexFilters.length,l:o,customData:{}}),t.lightTranslationEventBoxes.push(n.data),t.indexFilters.push(n.filterData)}}for(const i of e.lightshow.fxEventBoxGroups.map(n=>nu.serialize(n))){t.eventBoxGroups.push(i.object);for(const n of i.boxData){const o=[];for(const r of n.eventData)o.push({b:r.time,i:t.floatFxEvents.length}),t.floatFxEvents.push(r.data);i.object.e.push({e:t.fxEventBoxes.length,f:t.indexFilters.length,l:o,customData:{}}),t.fxEventBoxes.push(n.data),t.indexFilters.push(n.filterData)}}return t},deserialize(e,t){const i=pn({waypoints:e.waypoints?.map(m=>hu.deserialize({object:m,data:e.waypointsData?.[m?.i||0]??{}})),basicEvents:e.basicEvents?.map(m=>Ul.deserialize({object:m,data:e.basicEventsData?.[m?.i||0]??{}})),colorBoostEvents:e.colorBoostEvents?.map(m=>eu.deserialize({object:m,data:e.colorBoostEventsData?.[m?.i||0]??{}})),basicEventTypesWithKeywords:nr.deserialize(e.basicEventTypesWithKeywords??{}),useNormalEventsAsCompatibleEvents:!!e.useNormalEventsAsCompatibleEvents,customData:e.customData}),n=e.indexFilters??[],o=e.lightColorEventBoxes??[],r=e.lightColorEvents??[],s=e.lightRotationEventBoxes??[],a=e.lightRotationEvents??[],l=e.lightTranslationEventBoxes??[],u=e.lightTranslationEvents??[],f=e.fxEventBoxes??[],b=e.floatFxEvents??[];for(const m of e.eventBoxGroups||[])switch(m?.t||0){case ji.COLOR:i.lightColorEventBoxGroups.push(su.deserialize({object:m??{},boxData:m?.e?.map(E=>({data:o[E.e||0],filterData:n[E.f||0],eventData:E.l?.map(v=>({time:v.b??0,data:r[v.i||0]}))??[]}))??[]}));break;case ji.ROTATION:i.lightRotationEventBoxGroups.push(uu.deserialize({object:m,boxData:m?.e?.map(E=>({data:s[E.e||0],filterData:n[E.f||0],eventData:E.l?.map(v=>({time:v.b??0,data:a[v.i||0]}))??[]}))??[]}));break;case ji.TRANSLATION:i.lightTranslationEventBoxGroups.push(mu.deserialize({object:m,boxData:m?.e?.map(E=>({data:l[E.e||0],filterData:n[E.f||0],eventData:E.l?.map(v=>({time:v.b??0,data:u[v.i||0]}))??[]}))??[]}));break;case ji.FX_FLOAT:i.fxEventBoxGroups.push(nu.deserialize({object:m,boxData:m?.e?.map(E=>({data:f[E.e||0],filterData:n[E.f||0],eventData:E.l?.map(v=>({time:v.b??0,data:b[v.i||0]}))??[]}))??[]}));break}return Rn({version:4,filename:t?.filename,lightshowFilename:t?.filename,difficulty:hn(),lightshow:i})}},Z0={1:I0,2:j0,4:K0},Q0={2:$0,4:Y0},U0={1:M0,2:G0,3:W0,4:q0},eb={3:H0,4:J0};function tb(e,t,i){switch(e){case"info":return Z0[t].deserialize(i);case"audioData":return Q0[t].deserialize(i);case"difficulty":return U0[t].deserialize(i);case"lightshow":return eb[t].deserialize(i);default:throw new Error("")}}var Cs;function Ec(e){return{lang:e?.lang??Cs?.lang,message:e?.message,abortEarly:e?.abortEarly??Cs?.abortEarly,abortPipeEarly:e?.abortPipeEarly??Cs?.abortPipeEarly}}var ib;function nb(e){return ib?.get(e)}var ob;function rb(e){return ob?.get(e)}var sb;function ab(e,t){return sb?.get(e)?.get(t)}function zn(e){const t=typeof e;return t==="string"?`"${e}"`:t==="number"||t==="bigint"||t==="boolean"?`${e}`:t==="object"||t==="function"?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":t}function gt(e,t,i,n,o){const r=o&&"input"in o?o.input:i.value,s=o?.expected??e.expects??null,a=o?.received??zn(r),l={kind:e.kind,type:e.type,input:r,expected:s,received:a,message:`Invalid ${t}: ${s?`Expected ${s} but r`:"R"}eceived ${a}`,requirement:e.requirement,path:o?.path,issues:o?.issues,lang:n.lang,abortEarly:n.abortEarly,abortPipeEarly:n.abortPipeEarly},u=e.kind==="schema",f=o?.message??e.message??ab(e.reference,l.lang)??(u?rb(l.lang):null)??n.message??nb(l.lang);f!==void 0&&(l.message=typeof f=="function"?f(l):f),u&&(i.typed=!1),i.issues?i.issues.push(l):i.issues=[l]}function It(e){return{version:1,vendor:"valibot",validate(t){return e["~run"]({value:t},Ec())}}}function yc(e,t){return Object.hasOwn(e,t)&&t!=="__proto__"&&t!=="prototype"&&t!=="constructor"}function Sa(e,t){const i=[...new Set(e)];return i.length>1?`(${i.join(` ${t} `)})`:i[0]??"never"}function pu(e,t){return t.type===e}function W(e){return{kind:"validation",type:"integer",reference:W,async:!1,expects:null,requirement:Number.isInteger,message:e,"~run"(t,i){return t.typed&&!this.requirement(t.value)&&gt(this,"integer",t,i),t}}}function _c(e){return{kind:"metadata",type:"metadata",reference:_c,metadata:e}}function ft(e,t){return{kind:"validation",type:"min_value",reference:ft,async:!1,expects:`>=${e instanceof Date?e.toJSON():zn(e)}`,requirement:e,message:t,"~run"(i,n){return i.typed&&!(i.value>=this.requirement)&&gt(this,"value",i,n,{received:i.value instanceof Date?i.value.toJSON():zn(i.value)}),i}}}function Dc(e){return{kind:"validation",type:"raw_check",reference:Dc,async:!1,expects:null,"~run"(t,i){return e({dataset:t,config:i,addIssue:n=>gt(this,n?.label??"input",t,i,n)}),t}}}function Tc(e,t){return{kind:"validation",type:"regex",reference:Tc,async:!1,expects:`${e}`,requirement:e,message:t,"~run"(i,n){return i.typed&&!this.requirement.test(i.value)&&gt(this,"format",i,n),i}}}function Sc(e,t,i){return typeof e.fallback=="function"?e.fallback(t,i):e.fallback}function wa(e,t,i){return typeof e.default=="function"?e.default(t,i):e.default}function wc(){return{kind:"schema",type:"any",reference:wc,expects:"any",async:!1,get"~standard"(){return It(this)},"~run"(e){return e.typed=!0,e}}}function J(e,t){return{kind:"schema",type:"array",reference:J,expects:"Array",async:!1,item:e,message:t,get"~standard"(){return It(this)},"~run"(i,n){const o=i.value;if(Array.isArray(o)){i.typed=!0,i.value=[];for(let r=0;r<o.length;r++){const s=o[r],a=this.item["~run"]({value:s},n);if(a.issues){const l={type:"array",origin:"value",input:o,key:r,value:s};for(const u of a.issues)u.path?u.path.unshift(l):u.path=[l],i.issues?.push(u);if(i.issues||(i.issues=a.issues),n.abortEarly){i.typed=!1;break}}a.typed||(i.typed=!1),i.value.push(a.value)}}else gt(this,"type",i,n);return i}}}function Ut(e){return{kind:"schema",type:"boolean",reference:Ut,expects:"boolean",async:!1,message:e,get"~standard"(){return It(this)},"~run"(t,i){return typeof t.value=="boolean"?t.typed=!0:gt(this,"type",t,i),t}}}function Tt(e,t){const i=[];for(const n in e)(`${+n}`!==n||typeof e[n]!="string"||!Object.is(e[e[n]],+n))&&i.push(e[n]);return{kind:"schema",type:"enum",reference:Tt,expects:Sa(i.map(zn),"|"),async:!1,enum:e,options:i,message:t,get"~standard"(){return It(this)},"~run"(n,o){return this.options.includes(n.value)?n.typed=!0:gt(this,"type",n,o),n}}}function Us(e,t){return{kind:"schema",type:"literal",reference:Us,expects:zn(e),async:!1,literal:e,message:t,get"~standard"(){return It(this)},"~run"(i,n){return i.value===this.literal?i.typed=!0:gt(this,"type",i,n),i}}}function Ca(e,t){return{kind:"schema",type:"loose_object",reference:Ca,expects:"Object",async:!1,entries:e,message:t,get"~standard"(){return It(this)},"~run"(i,n){const o=i.value;if(o&&typeof o=="object"){i.typed=!0,i.value={};for(const r in this.entries){const s=this.entries[r];if(r in o||(s.type==="exact_optional"||s.type==="optional"||s.type==="nullish")&&s.default!==void 0){const a=r in o?o[r]:wa(s),l=s["~run"]({value:a},n);if(l.issues){const u={type:"object",origin:"value",input:o,key:r,value:a};for(const f of l.issues)f.path?f.path.unshift(u):f.path=[u],i.issues?.push(f);if(i.issues||(i.issues=l.issues),n.abortEarly){i.typed=!1;break}}l.typed||(i.typed=!1),i.value[r]=l.value}else if(s.fallback!==void 0)i.value[r]=Sc(s);else if(s.type!=="exact_optional"&&s.type!=="optional"&&s.type!=="nullish"&&(gt(this,"key",i,n,{input:void 0,expected:`"${r}"`,path:[{type:"object",origin:"key",input:o,key:r,value:o[r]}]}),n.abortEarly))break}if(!i.issues||!n.abortEarly)for(const r in o)yc(o,r)&&!(r in this.entries)&&(i.value[r]=o[r])}else gt(this,"type",i,n);return i}}}function Cc(e){return{kind:"schema",type:"never",reference:Cc,expects:"never",async:!1,message:e,get"~standard"(){return It(this)},"~run"(t,i){return gt(this,"type",t,i),t}}}function S(e){return{kind:"schema",type:"number",reference:S,expects:"number",async:!1,message:e,get"~standard"(){return It(this)},"~run"(t,i){return typeof t.value=="number"&&!isNaN(t.value)?t.typed=!0:gt(this,"type",t,i),t}}}function ne(e,t){return{kind:"schema",type:"object",reference:ne,expects:"Object",async:!1,entries:e,message:t,get"~standard"(){return It(this)},"~run"(i,n){const o=i.value;if(o&&typeof o=="object"){i.typed=!0,i.value={};for(const r in this.entries){const s=this.entries[r];if(r in o||(s.type==="exact_optional"||s.type==="optional"||s.type==="nullish")&&s.default!==void 0){const a=r in o?o[r]:wa(s),l=s["~run"]({value:a},n);if(l.issues){const u={type:"object",origin:"value",input:o,key:r,value:a};for(const f of l.issues)f.path?f.path.unshift(u):f.path=[u],i.issues?.push(f);if(i.issues||(i.issues=l.issues),n.abortEarly){i.typed=!1;break}}l.typed||(i.typed=!1),i.value[r]=l.value}else if(s.fallback!==void 0)i.value[r]=Sc(s);else if(s.type!=="exact_optional"&&s.type!=="optional"&&s.type!=="nullish"&&(gt(this,"key",i,n,{input:void 0,expected:`"${r}"`,path:[{type:"object",origin:"key",input:o,key:r,value:o[r]}]}),n.abortEarly))break}}else gt(this,"type",i,n);return i}}}function h(e,t){return{kind:"schema",type:"optional",reference:h,expects:`(${e.expects} | undefined)`,async:!1,wrapped:e,default:t,get"~standard"(){return It(this)},"~run"(i,n){return i.value===void 0&&(this.default!==void 0&&(i.value=wa(this,i,n)),i.value===void 0)?(i.typed=!0,i):this.wrapped["~run"](i,n)}}}function je(e,t){return{kind:"schema",type:"picklist",reference:je,expects:Sa(e.map(zn),"|"),async:!1,options:e,message:t,get"~standard"(){return It(this)},"~run"(i,n){return this.options.includes(i.value)?i.typed=!0:gt(this,"type",i,n),i}}}function Rc(e,t,i){return{kind:"schema",type:"record",reference:Rc,expects:"Object",async:!1,key:e,value:t,message:i,get"~standard"(){return It(this)},"~run"(n,o){const r=n.value;if(r&&typeof r=="object"){n.typed=!0,n.value={};for(const s in r)if(yc(r,s)){const a=r[s],l=this.key["~run"]({value:s},o);if(l.issues){const f={type:"object",origin:"key",input:r,key:s,value:a};for(const b of l.issues)b.path=[f],n.issues?.push(b);if(n.issues||(n.issues=l.issues),o.abortEarly){n.typed=!1;break}}const u=this.value["~run"]({value:a},o);if(u.issues){const f={type:"object",origin:"value",input:r,key:s,value:a};for(const b of u.issues)b.path?b.path.unshift(f):b.path=[f],n.issues?.push(b);if(n.issues||(n.issues=u.issues),o.abortEarly){n.typed=!1;break}}(!l.typed||!u.typed)&&(n.typed=!1),l.typed&&(n.value[l.value]=u.value)}}else gt(this,"type",n,o);return n}}}function ce(e){return{kind:"schema",type:"string",reference:ce,expects:"string",async:!1,message:e,get"~standard"(){return It(this)},"~run"(t,i){return typeof t.value=="string"?t.typed=!0:gt(this,"type",t,i),t}}}function du(e){let t;if(e)for(const i of e)t?t.push(...i.issues):t=i.issues;return t}function ea(e,t){return{kind:"schema",type:"union",reference:ea,expects:Sa(e.map(i=>i.expects),"|"),async:!1,options:e,message:t,get"~standard"(){return It(this)},"~run"(i,n){let o,r,s;for(const a of this.options){const l=a["~run"]({value:i.value},n);if(l.typed)if(l.issues)r?r.push(l):r=[l];else{o=l;break}else s?s.push(l):s=[l]}if(o)return o;if(r){if(r.length===1)return r[0];gt(this,"type",i,n,{issues:du(r)}),i.typed=!0}else{if(s?.length===1)return s[0];gt(this,"type",i,n,{issues:du(s)})}return i}}}function j(...e){return{...e[0],pipe:e,get"~standard"(){return It(this)},"~run"(t,i){for(const n of e)if(n.kind!=="metadata"){if(t.issues&&(n.kind==="schema"||n.kind==="transformation")){t.typed=!1;break}(!t.issues||!i.abortEarly&&!i.abortPipeEarly)&&(t=n["~run"](t,i))}return t}}}function lb(e,t,i){const n=e["~run"]({value:t},Ec(i));return{typed:n.typed,success:!n.issues,output:n.value,issues:n.issues}}function ub(e){return e.wrapped}function c(e,t){const[i,...n]="pipe"in e?e.pipe:[e];return j(h(i),...n,_c({version:t?.version}))}function ta(e,{version:t,dataset:i,addIssue:n}){const[o,...r]="pipe"in e?e.pipe:[e];let s=o;"wrapped"in s&&(s=ub(s));const a=r.find(u=>u.kind==="metadata");se.tDebug(["schema","checkVersion"],`for ${s.type}:
  schema version: 	${a?.metadata.version??"undefined"}
  dataset version: 	${t}`);const l=i.value;if(a&&a.metadata.version){const{version:u}=a.metadata,f=Ta(t,u);if(f<0&&l!==void 0)return n({message:"Mismatched version for field",input:l,received:t,expected:u});const b=["optional","undefinedable"].includes(s.type);if(f>=0&&l===void 0&&!b)return n({message:"Missing required value for versioned field",input:l,received:typeof l,expected:s.type})}else{const{issues:u}=lb(s,i.value);for(const f of u??[])return n(f)}if(pu("array",s)&&Array.isArray(l)){const u=s.item;for(let f=0;f<l.length;f++){const b=l[f];ta(u,{version:t,addIssue:m=>n({...m,path:[{type:"array",origin:"value",input:l,key:f,value:b},...m?.path??[]]}),dataset:{...i,value:b}})}}if(pu("object",s)&&Ku(l)){const u=s.entries;for(const f in u){const b=l[f];ta(u[f],{version:t,addIssue:m=>n({...m,path:[{type:"object",origin:"value",input:l,key:f,value:b},...m?.path??[]]}),dataset:{...i,value:b}})}}}function ci(e,t){return j(ne(t),Dc(({dataset:i,addIssue:n})=>{if(!i.typed)return;const o=e(i.value);for(const r in t){const s=i.value[r];ta(t[r],{version:o,dataset:{...i,value:s},addIssue:a=>{const l={type:"object",origin:"value",input:i.value,key:r,value:s};return n({...a,path:[l,...a?.path??[]]})}})}}))}const cb=["Standard","NoArrows","OneSaber","Legacy","360Degree","90Degree","Lightshow","Lawless"],fb=["Easy","Normal","Hard","Expert","ExpertPlus","Expert+"],mb=[1,3,5,7,9],hb=["DefaultEnvironment","OriginsEnvironment","TriangleEnvironment","NiceEnvironment","BigMirrorEnvironment","DragonsEnvironment","KDAEnvironment","MonstercatEnvironment","CrabRaveEnvironment","PanicEnvironment","RocketEnvironment","GreenDayEnvironment","GreenDayGrenadeEnvironment","TimbalandEnvironment","FitBeatEnvironment","LinkinParkEnvironment","BTSEnvironment","KaleidoscopeEnvironment","InterscopeEnvironment","SkrillexEnvironment","BillieEnvironment","HalloweenEnvironment","GagaEnvironment"],pb=["WeaveEnvironment","PyroEnvironment","EDMEnvironment","TheSecondEnvironment","LizzoEnvironment","TheWeekndEnvironment","RockMixtapeEnvironment","Dragons2Environment","Panic2Environment","QueenEnvironment","LinkinPark2Environment","TheRollingStonesEnvironment","LatticeEnvironment","DaftPunkEnvironment","HipHopEnvironment","ColliderEnvironment","BritneyEnvironment","Monstercat2Environment","MetallicaEnvironment"],db=["GlassDesertEnvironment","MultiplayerEnvironment"];[...hb,...pb,...db];const Ji=j(ce(),Tc(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/)),he=Rc(ce(),wc()),Ir=je(cb),$r=je(fb),bb=je(mb),Ro=Tt(pe),Ra=Tt(Dd),La=Tt(Js),Lc=Tt(Ju),Nc=Tt(Zu),xc=Tt(Qu),Oc=Tt(Uu),xt=Tt(Td),Ot=Tt(Jo),Bc=Tt(Sd),Fr=Tt(wd),kc=Tt(Cd),Ac=Tt(Rd),gb=Tt(An),vb=Tt(hr),Eb=Tt(ji),yb=ne({_role:ce(),_name:ce(),_iconPath:ce()}),_b=ne({_time:c(S(),{version:"1.5.0"}),_type:c(Ac,{version:"1.5.0"}),_lineIndex:c(j(S(),W()),{version:"1.5.0"}),_lineLayer:c(j(S(),W()),{version:"1.5.0"}),_cutDirection:c(j(S(),W(),ft(0)),{version:"1.5.0"})}),Db=ne({_time:c(S(),{version:"1.5.0"}),_lineIndex:c(j(S(),W()),{version:"1.5.0"}),_type:c(j(S(),W()),{version:"1.5.0"}),_duration:c(S(),{version:"1.5.0"}),_width:c(j(S(),W()),{version:"1.5.0"})}),Tb=ne({_time:c(S(),{version:"1.5.0"}),_type:c(j(S(),W()),{version:"1.5.0"}),_value:c(j(S(),W()),{version:"1.5.0"})}),Sb=ne({_time:c(S()),_bpm:c(S()),_BPM:c(Cc()),_beatsPerBar:c(S()),_metronomeOffset:c(S())}),wb=ne({_time:c(S()),_name:c(ce())}),Cb=ci(e=>e._version||"1.5.0",{_version:c(Ji,{version:"1.5.0"}),_beatsPerMinute:c(S(),{version:"1.5.0"}),_beatsPerBar:c(S(),{version:"1.5.0"}),_shuffle:c(S(),{version:"1.5.0"}),_shufflePeriod:c(S(),{version:"1.5.0"}),_noteJumpSpeed:c(S(),{version:"1.5.0"}),_noteJumpStartBeatOffset:c(S(),{version:"1.5.0"}),_notes:c(J(_b),{version:"1.5.0"}),_obstacles:c(J(Db),{version:"1.5.0"}),_events:c(J(Tb),{version:"1.5.0"}),_time:c(h(S())),_BPMChanges:c(h(J(Sb))),_bookmarks:c(h(J(wb)))}),no=ne({r:S(),g:S(),b:S()}),Rb=ne({difficulty:c($r,{version:"1.0.0"}),difficultyRank:c(je([1,2,3,4,5,6,7,8,9,10]),{version:"1.0.0"}),audioPath:c(ce(),{version:"1.0.0"}),jsonPath:c(ce(),{version:"1.0.0"}),characteristic:c(Ir,{version:"1.0.0"}),offset:c(h(S())),oldOffset:c(h(S())),chromaToggle:c(h(ce())),customColors:c(h(Ut())),difficultyLabel:c(h(ce())),colorLeft:c(h(no)),colorRight:c(h(no)),envColorLeft:c(h(no)),envColorRight:c(h(no)),obstacleColor:c(h(no))}),Lb=ci(()=>"1.0.0",{songName:c(ce(),{version:"1.0.0"}),songSubName:c(ce(),{version:"1.0.0"}),authorName:c(ce(),{version:"1.0.0"}),beatsPerMinute:c(S(),{version:"1.0.0"}),previewStartTime:c(S(),{version:"1.0.0"}),previewDuration:c(S(),{version:"1.0.0"}),coverImagePath:c(ce(),{version:"1.0.0"}),environmentName:c(ce(),{version:"1.0.0"}),difficultyLevels:c(J(Rb),{version:"1.0.0"}),oneSaber:c(Ut(),{version:"1.0.0"}),contributors:c(h(J(yb)),{version:"1.0.0"}),customEnvironment:c(h(ce()),{version:"1.0.0"}),customEnvironmentHash:c(h(ce()),{version:"1.0.0"})}),Nb=ne({_startSampleIndex:c(j(S(),W(),ft(0)),{version:"2.0.0"}),_endSampleIndex:c(j(S(),W(),ft(0)),{version:"2.0.0"}),_startBeat:c(S(),{version:"2.0.0"}),_endBeat:c(S(),{version:"2.0.0"})}),xb=ci(e=>e._version||"2.0.0",{_version:c(Ji,{version:"2.0.0"}),_songSampleCount:c(j(S(),W(),ft(0)),{version:"2.0.0"}),_songFrequency:c(j(S(),W(),ft(0)),{version:"2.0.0"}),_regions:c(J(Nb),{version:"2.0.0"})}),Ob=ne({_time:c(h(S()),{version:"2.0.0"}),_type:c(h(Ac),{version:"2.0.0"}),_lineIndex:c(h(j(S(),W())),{version:"2.0.0"}),_lineLayer:c(h(j(S(),W())),{version:"2.0.0"}),_cutDirection:c(h(j(S(),W(),ft(0))),{version:"2.0.0"}),_customData:c(h(he))}),Bb=ne({_colorType:c(h(Ro),{version:"2.6.0"}),_headTime:c(h(S()),{version:"2.6.0"}),_headLineIndex:c(h(j(S(),W())),{version:"2.6.0"}),_headLineLayer:c(h(j(S(),W())),{version:"2.6.0"}),_headControlPointLengthMultiplier:c(h(S()),{version:"2.6.0"}),_headCutDirection:c(h(j(S(),W(),ft(0))),{version:"2.6.0"}),_tailTime:c(h(S()),{version:"2.6.0"}),_tailLineIndex:c(h(j(S(),W())),{version:"2.6.0"}),_tailLineLayer:c(h(j(S(),W())),{version:"2.6.0"}),_tailControlPointLengthMultiplier:c(h(S()),{version:"2.6.0"}),_tailCutDirection:c(h(j(S(),W(),ft(0))),{version:"2.6.0"}),_sliderMidAnchorMode:c(h(La),{version:"2.6.0"}),_customData:c(h(he))}),kb=ne({_time:c(h(S()),{version:"2.0.0"}),_lineIndex:c(h(j(S(),W())),{version:"2.0.0"}),_type:c(h(j(S(),W())),{version:"2.0.0"}),_duration:c(h(S()),{version:"2.0.0"}),_width:c(h(j(S(),W())),{version:"2.0.0"}),_customData:c(h(he))}),Ab=ne({_time:c(h(S()),{version:"2.0.0"}),_type:c(h(j(S(),W())),{version:"2.0.0"}),_value:c(h(j(S(),W())),{version:"2.0.0"}),_floatValue:c(h(S()),{version:"2.5.0"}),_customData:c(h(he))}),Pb=ne({_time:c(h(S()),{version:"2.2.0"}),_lineIndex:c(h(j(S(),W())),{version:"2.2.0"}),_lineLayer:c(h(j(S(),W())),{version:"2.2.0"}),_offsetDirection:c(h(Ra),{version:"2.2.0"}),_customData:c(h(he))}),Mb=ne({_keyword:c(h(ce()),{version:"2.4.0"}),_specialEvents:c(h(J(j(S(),W()))),{version:"2.4.0"})}),Ib=ne({_keywords:c(h(J(Mb)),{version:"2.4.0"})}),$b=ci(e=>e._version||"2.0.0",{_version:c(h(Ji),{version:"2.0.0"}),_events:c(h(J(Ab)),{version:"2.0.0"}),_notes:c(h(J(Ob)),{version:"2.0.0"}),_sliders:c(h(J(Bb)),{version:"2.6.0"}),_waypoints:c(h(J(Pb)),{version:"2.2.0"}),_obstacles:c(h(J(kb)),{version:"2.0.0"}),_specialEventsKeywordFilters:c(h(Ib),{version:"2.4.0"}),_customData:c(h(he))}),Fb=ne({_difficulty:c($r,{version:"2.0.0"}),_difficultyRank:c(bb,{version:"2.0.0"}),_beatmapFilename:c(ce(),{version:"2.0.0"}),_noteJumpMovementSpeed:c(S(),{version:"2.0.0"}),_noteJumpStartBeatOffset:c(S(),{version:"2.0.0"}),_beatmapColorSchemeIdx:c(j(S(),W()),{version:"2.1.0"}),_environmentNameIdx:c(j(S(),W()),{version:"2.1.0"}),_customData:c(h(he))}),Vb=ne({_beatmapCharacteristicName:c(Ir,{version:"2.0.0"}),_difficultyBeatmaps:c(J(Fb),{version:"2.0.0"}),_customData:c(h(he))}),Ii=ne({r:c(S(),{version:"2.1.0"}),g:c(S(),{version:"2.1.0"}),b:c(S(),{version:"2.1.0"}),a:c(S(),{version:"2.1.0"})}),zb=ne({colorSchemeId:c(ce(),{version:"2.1.0"}),saberAColor:c(Ii,{version:"2.1.0"}),saberBColor:c(Ii,{version:"2.1.0"}),environmentColor0:c(Ii,{version:"2.1.0"}),environmentColor1:c(Ii,{version:"2.1.0"}),obstaclesColor:c(Ii,{version:"2.1.0"}),environmentColor0Boost:c(Ii,{version:"2.1.0"}),environmentColor1Boost:c(Ii,{version:"2.1.0"}),environmentColorW:c(h(Ii),{version:"2.1.0"}),environmentColorWBoost:c(h(Ii),{version:"2.1.0"})}),Gb=ne({useOverride:c(Ut(),{version:"2.1.0"}),colorScheme:c(zb,{version:"2.1.0"})}),jb=ci(e=>e._version||"2.0.0",{_version:c(Ji,{version:"2.0.0"}),_songName:c(ce(),{version:"2.0.0"}),_songSubName:c(ce(),{version:"2.0.0"}),_songAuthorName:c(ce(),{version:"2.0.0"}),_levelAuthorName:c(ce(),{version:"2.0.0"}),_beatsPerMinute:c(S(),{version:"2.0.0"}),_songTimeOffset:c(S(),{version:"2.0.0"}),_shuffle:c(S(),{version:"2.0.0"}),_shufflePeriod:c(S(),{version:"2.0.0"}),_previewStartTime:c(S(),{version:"2.0.0"}),_previewDuration:c(S(),{version:"2.0.0"}),_songFilename:c(ce(),{version:"2.0.0"}),_coverImageFilename:c(ce(),{version:"2.0.0"}),_environmentName:c(ce(),{version:"2.0.0"}),_allDirectionsEnvironmentName:c(h(ce()),{version:"2.0.0"}),_environmentNames:c(J(ce()),{version:"2.1.0"}),_colorSchemes:c(J(Gb),{version:"2.1.0"}),_difficultyBeatmapSets:c(J(Vb),{version:"2.0.0"}),_customData:c(h(he))}),$i=ne({r:S(),g:S(),b:S(),a:h(S())}),Pc=ne({_colorLeft:h($i),_colorRight:h($i),_envColorLeft:h($i),_envColorRight:h($i),_envColorWhite:h($i),_envColorLeftBoost:h($i),_envColorRightBoost:h($i),_envColorWhiteBoost:h($i),_obstacleColor:h($i)});({...Pc.entries});const Wb=ne({b:c(h(S()),{version:"3.0.0"}),x:c(h(j(S(),W())),{version:"3.0.0"}),y:c(h(j(S(),W())),{version:"3.0.0"}),a:c(h(j(S(),W())),{version:"3.0.0"}),c:c(h(Ro),{version:"3.0.0"}),d:c(h(j(S(),W(),ft(0))),{version:"3.0.0"}),customData:c(h(he))}),Hb=ne({b:c(h(S()),{version:"3.0.0"}),x:c(h(j(S(),W())),{version:"3.0.0"}),y:c(h(j(S(),W())),{version:"3.0.0"}),customData:c(h(he))}),Yb=ne({b:c(h(S()),{version:"3.0.0"}),c:c(h(Ro),{version:"3.0.0"}),x:c(h(j(S(),W())),{version:"3.0.0"}),y:c(h(j(S(),W())),{version:"3.0.0"}),d:c(h(j(S(),W(),ft(0))),{version:"3.0.0"}),tb:c(h(S()),{version:"3.0.0"}),tx:c(h(j(S(),W())),{version:"3.0.0"}),ty:c(h(j(S(),W())),{version:"3.0.0"}),mu:c(h(S()),{version:"3.0.0"}),tmu:c(h(S()),{version:"3.0.0"}),tc:c(h(j(S(),W(),ft(0))),{version:"3.0.0"}),m:c(h(La),{version:"3.0.0"}),customData:c(h(he))}),Xb=ne({b:c(h(S()),{version:"3.0.0"}),c:c(h(Ro),{version:"3.0.0"}),x:c(h(j(S(),W())),{version:"3.0.0"}),y:c(h(j(S(),W())),{version:"3.0.0"}),d:c(h(j(S(),W(),ft(0))),{version:"3.0.0"}),tb:c(h(S()),{version:"3.0.0"}),tx:c(h(j(S(),W())),{version:"3.0.0"}),ty:c(h(j(S(),W())),{version:"3.0.0"}),sc:c(h(j(S(),W())),{version:"3.0.0"}),s:c(h(S()),{version:"3.0.0"}),customData:c(h(he))}),qb=ne({b:c(h(S()),{version:"3.0.0"}),x:c(h(j(S(),W())),{version:"3.0.0"}),y:c(h(j(S(),W())),{version:"3.0.0"}),d:c(h(S()),{version:"3.0.0"}),w:c(h(j(S(),W())),{version:"3.0.0"}),h:c(h(j(S(),W())),{version:"3.0.0"}),customData:c(h(he))}),Kb=ne({b:c(h(S()),{version:"3.0.0"}),x:c(h(j(S(),W())),{version:"3.0.0"}),y:c(h(j(S(),W())),{version:"3.0.0"}),d:c(h(Ra),{version:"3.0.0"}),customData:c(h(he))}),Mc=ne({b:c(h(S()),{version:"3.0.0"}),et:c(h(j(S(),W())),{version:"3.0.0"}),i:c(h(j(S(),W())),{version:"3.0.0"}),f:c(h(S()),{version:"3.0.0"}),customData:c(h(he))}),Jb=ne({b:c(h(S()),{version:"3.0.0"}),m:c(h(S()),{version:"3.0.0"}),customData:c(h(he))}),Zb=ne({b:c(h(S()),{version:"3.0.0"}),e:c(h(Lc),{version:"3.0.0"}),r:c(h(S()),{version:"3.0.0"}),customData:c(h(he))}),Ic=ne({b:c(h(S()),{version:"3.0.0"}),o:c(h(Ut()),{version:"3.0.0"}),customData:c(h(he))}),Vr=ne({f:c(h(Nc),{version:"3.0.0"}),p:c(h(j(S(),W())),{version:"3.0.0"}),t:c(h(j(S(),W())),{version:"3.0.0"}),r:c(h(je([0,1])),{version:"3.0.0"}),c:c(h(j(S(),W())),{version:"3.1.0"}),n:c(h(Oc),{version:"3.1.0"}),s:c(h(j(S(),W())),{version:"3.1.0"}),l:c(h(S()),{version:"3.1.0"}),d:c(h(xc),{version:"3.1.0"}),customData:c(h(he))}),Qb=ne({b:c(h(S()),{version:"3.0.0"}),i:c(h(gb),{version:"3.0.0"}),c:c(h(Bc),{version:"3.0.0"}),s:c(h(S()),{version:"3.0.0"}),f:c(h(j(S(),W())),{version:"3.0.0"}),sb:c(h(S()),{version:"3.3.0"}),sf:c(h(je([0,1])),{version:"3.3.0"}),customData:c(h(he))}),Ub=ne({f:c(h(Vr),{version:"3.0.0"}),w:c(h(S()),{version:"3.0.0"}),d:c(h(xt),{version:"3.0.0"}),r:c(h(S()),{version:"3.0.0"}),t:c(h(xt),{version:"3.0.0"}),b:c(h(je([0,1])),{version:"3.0.0"}),i:c(h(Ot),{version:"3.2.0"}),e:c(h(J(Qb)),{version:"3.0.0"}),customData:c(h(he))}),$c=ne({b:c(h(S()),{version:"3.0.0"}),g:c(h(j(S(),W())),{version:"3.0.0"}),e:c(h(J(Ub)),{version:"3.0.0"}),customData:c(h(he))}),eg=ne({b:c(h(S()),{version:"3.0.0"}),p:c(h(je([0,1])),{version:"3.0.0"}),e:c(h(Ot),{version:"3.0.0"}),l:c(h(j(S(),W())),{version:"3.0.0"}),r:c(h(S()),{version:"3.0.0"}),o:c(h(kc),{version:"3.0.0"}),customData:c(h(he))}),tg=ne({f:c(h(Vr),{version:"3.0.0"}),w:c(h(S()),{version:"3.0.0"}),d:c(h(xt),{version:"3.0.0"}),s:c(h(S()),{version:"3.0.0"}),t:c(h(xt),{version:"3.0.0"}),a:c(h(Fr),{version:"3.0.0"}),r:c(h(je([0,1])),{version:"3.0.0"}),b:c(h(je([0,1])),{version:"3.0.0"}),i:c(h(Ot),{version:"3.2.0"}),l:c(h(J(eg)),{version:"3.0.0"}),customData:c(h(he))}),Fc=ne({b:c(h(S()),{version:"3.0.0"}),g:c(h(j(S(),W())),{version:"3.0.0"}),e:c(h(J(tg)),{version:"3.0.0"}),customData:c(h(he))}),ig=ne({b:c(h(S()),{version:"3.2.0"}),p:c(h(je([0,1])),{version:"3.2.0"}),t:c(h(S()),{version:"3.2.0"}),e:c(h(Ot),{version:"3.2.0"}),customData:c(h(he))}),ng=ne({f:c(h(Vr),{version:"3.2.0"}),w:c(h(S()),{version:"3.2.0"}),d:c(h(xt),{version:"3.2.0"}),s:c(h(S()),{version:"3.2.0"}),t:c(h(xt),{version:"3.2.0"}),a:c(h(Fr),{version:"3.2.0"}),r:c(h(je([0,1])),{version:"3.2.0"}),b:c(h(je([0,1])),{version:"3.2.0"}),i:c(h(Ot),{version:"3.2.0"}),l:c(h(J(ig)),{version:"3.2.0"}),customData:c(h(he))}),Vc=ne({b:c(h(S()),{version:"3.2.0"}),g:c(h(j(S(),W())),{version:"3.2.0"}),e:c(h(J(ng)),{version:"3.2.0"}),customData:c(h(he))}),og=ne({f:c(h(Vr),{version:"3.3.0"}),w:c(h(S()),{version:"3.3.0"}),d:c(h(xt),{version:"3.3.0"}),l:c(h(J(j(S(),W()))),{version:"3.3.0"}),s:c(h(S()),{version:"3.3.0"}),t:c(h(xt),{version:"3.3.0"}),i:c(h(Ot),{version:"3.3.0"}),b:c(h(je([0,1])),{version:"3.3.0"}),customData:c(h(he))}),zc=ne({b:c(h(S()),{version:"3.3.0"}),g:c(h(j(S(),W())),{version:"3.3.0"}),e:c(h(J(og)),{version:"3.3.0"}),t:c(h(vb),{version:"3.3.0"}),customData:c(h(he))}),rg=ne({k:c(h(ce()),{version:"3.0.0"}),e:c(h(J(j(S(),W()))),{version:"3.0.0"})}),Gc=ne({d:c(h(J(rg)),{version:"3.0.0"})}),sg=ne({b:c(h(S()),{version:"3.3.0"}),p:c(h(je([0,1])),{version:"3.3.0"}),v:c(h(S()),{version:"3.3.0"}),i:c(h(Ot),{version:"3.3.0"}),customData:c(h(he))}),ag=ne({b:c(h(S()),{version:"3.3.0"}),p:c(h(je([0,1])),{version:"3.3.0"}),v:c(h(j(S(),W())),{version:"3.3.0"}),customData:c(h(he))}),jc=ne({_fl:c(h(J(sg)),{version:"3.3.0"}),_il:c(h(J(ag)),{version:"3.3.0"})}),lg=ci(e=>e.version||"3.0.0",{version:c(Ji,{version:"3.0.0"}),bpmEvents:c(h(J(Jb)),{version:"3.0.0"}),rotationEvents:c(h(J(Zb)),{version:"3.0.0"}),colorNotes:c(h(J(Wb)),{version:"3.0.0"}),bombNotes:c(h(J(Hb)),{version:"3.0.0"}),obstacles:c(h(J(qb)),{version:"3.0.0"}),sliders:c(h(J(Yb)),{version:"3.0.0"}),burstSliders:c(h(J(Xb)),{version:"3.0.0"}),waypoints:c(h(J(Kb)),{version:"3.0.0"}),basicBeatmapEvents:c(h(J(Mc)),{version:"3.0.0"}),colorBoostBeatmapEvents:c(h(J(Ic)),{version:"3.0.0"}),lightColorEventBoxGroups:c(h(J($c)),{version:"3.0.0"}),lightRotationEventBoxGroups:c(h(J(Fc)),{version:"3.0.0"}),lightTranslationEventBoxGroups:c(h(J(Vc)),{version:"3.2.0"}),vfxEventBoxGroups:c(h(J(zc)),{version:"3.3.0"}),_fxEventsCollection:c(h(jc),{version:"3.3.0"}),basicEventTypesWithKeywords:c(h(Gc),{version:"3.0.0"}),useNormalEventsAsCompatibleEvents:c(h(Ut()),{version:"3.0.0"}),customData:c(h(he))}),ug=ci(()=>"3.0.0",{basicBeatmapEvents:c(h(J(Mc)),{version:"3.0.0"}),colorBoostBeatmapEvents:c(h(J(Ic)),{version:"3.0.0"}),lightColorEventBoxGroups:c(h(J($c)),{version:"3.0.0"}),lightRotationEventBoxGroups:c(h(J(Fc)),{version:"3.0.0"}),lightTranslationEventBoxGroups:c(h(J(Vc)),{version:"3.2.0"}),vfxEventBoxGroups:c(h(J(zc)),{version:"3.3.0"}),_fxEventsCollection:c(h(jc),{version:"3.3.0"}),customData:c(h(he))}),cg=ne({si:c(j(S(),W(),ft(0)),{version:"4.0.0"}),ei:c(j(S(),W(),ft(0)),{version:"4.0.0"}),sb:c(S(),{version:"4.0.0"}),eb:c(S(),{version:"4.0.0"})}),fg=ne({si:c(j(S(),W(),ft(0)),{version:"4.0.0"}),ei:c(j(S(),W(),ft(0)),{version:"4.0.0"}),l:c(S(),{version:"4.0.0"})}),mg=ci(e=>e.version||"4.0.0",{version:c(Ji,{version:"4.0.0"}),songChecksum:c(ce(),{version:"4.0.0"}),songSampleCount:c(j(S(),W(),ft(0)),{version:"4.0.0"}),songFrequency:c(j(S(),W(),ft(0)),{version:"4.0.0"}),bpmData:c(J(cg),{version:"4.0.0"}),lufsData:c(J(fg),{version:"4.0.0"})}),bo=ne({b:c(h(S()),{version:"4.0.0"}),i:c(h(j(S(),W())),{version:"4.0.0"}),customData:c(h(he))}),Zo=ne({b:c(h(S()),{version:"4.0.0"}),i:c(h(j(S(),W())),{version:"4.0.0"}),r:c(h(j(S(),W())),{version:"4.0.0"}),customData:c(h(he))}),hg=ne({hb:c(h(S()),{version:"4.0.0"}),hr:c(h(j(S(),W())),{version:"4.0.0"}),tb:c(h(S()),{version:"4.0.0"}),tr:c(h(j(S(),W())),{version:"4.0.0"}),i:c(h(j(S(),W())),{version:"4.0.0"}),ci:c(h(j(S(),W())),{version:"4.0.0"}),customData:c(h(he))}),pg=ne({hb:c(h(S()),{version:"4.0.0"}),hi:c(h(j(S(),W())),{version:"4.0.0"}),hr:c(h(j(S(),W())),{version:"4.0.0"}),tb:c(h(S()),{version:"4.0.0"}),ti:c(h(j(S(),W())),{version:"4.0.0"}),tr:c(h(j(S(),W())),{version:"4.0.0"}),ai:c(h(j(S(),W())),{version:"4.0.0"}),customData:c(h(he))}),dg=ne({x:c(h(j(S(),W())),{version:"4.0.0"}),y:c(h(j(S(),W())),{version:"4.0.0"}),a:c(h(j(S(),W())),{version:"4.0.0"}),c:c(h(Ro),{version:"4.0.0"}),d:c(h(j(S(),W(),ft(0))),{version:"4.0.0"}),customData:c(h(he))}),bg=ne({x:c(h(j(S(),W())),{version:"4.0.0"}),y:c(h(j(S(),W())),{version:"4.0.0"}),customData:c(h(he))}),gg=ne({x:c(h(j(S(),W())),{version:"4.0.0"}),y:c(h(j(S(),W())),{version:"4.0.0"}),d:c(h(S()),{version:"4.0.0"}),w:c(h(j(S(),W())),{version:"4.0.0"}),h:c(h(j(S(),W())),{version:"4.0.0"}),customData:c(h(he))}),vg=ne({tx:c(h(j(S(),W())),{version:"4.0.0"}),ty:c(h(j(S(),W())),{version:"4.0.0"}),c:c(h(j(S(),W())),{version:"4.0.0"}),s:c(h(j(S())),{version:"4.0.0"}),customData:c(h(he))}),Eg=ne({m:c(h(S()),{version:"4.0.0"}),tm:c(h(S()),{version:"4.0.0"}),a:c(h(La),{version:"4.0.0"}),customData:c(h(he))}),yg=ne({e:c(h(Lc),{version:"4.0.0"}),r:c(h(S()),{version:"4.0.0"}),customData:c(h(he))}),_g=ne({d:c(h(S()),{version:"4.1.0"}),p:c(h(je([0,1])),{version:"4.1.0"}),e:c(h(Ot),{version:"4.1.0"}),customData:c(h(he))}),Dg=ci(e=>e.version||"4.0.0",{version:c(Ji,{version:"4.0.0"}),colorNotes:c(h(J(Zo)),{version:"4.0.0"}),colorNotesData:c(h(J(dg)),{version:"4.0.0"}),bombNotes:c(h(J(Zo)),{version:"4.0.0"}),bombNotesData:c(h(J(bg)),{version:"4.0.0"}),obstacles:c(h(J(Zo)),{version:"4.0.0"}),obstaclesData:c(h(J(gg)),{version:"4.0.0"}),chains:c(h(J(hg)),{version:"4.0.0"}),chainsData:c(h(J(vg)),{version:"4.0.0"}),arcs:c(h(J(pg)),{version:"4.0.0"}),arcsData:c(h(J(Eg)),{version:"4.0.0"}),spawnRotations:c(h(J(bo)),{version:"4.0.0"}),spawnRotationsData:c(h(J(yg)),{version:"4.0.0"}),njsEvents:c(h(J(bo)),{version:"4.1.0"}),njsEventData:c(h(J(_g)),{version:"4.1.0"}),customData:c(h(he))}),Tg=ne({title:c(ce(),{version:"4.0.0"}),subTitle:c(ce(),{version:"4.0.0"}),author:c(ce(),{version:"4.0.0"})}),Sg=ne({songFilename:c(ce(),{version:"4.0.0"}),songDuration:c(S(),{version:"4.0.0"}),audioDataFilename:c(ce(),{version:"4.0.0"}),bpm:c(S(),{version:"4.0.0"}),lufs:c(S(),{version:"4.0.0"}),previewStartTime:c(S(),{version:"4.0.0"}),previewDuration:c(S(),{version:"4.0.0"})}),wg=ne({colorSchemeName:c(ce(),{version:"4.0.0"}),overrideNotes:c(Ut(),{version:"4.0.1"}),saberAColor:c(ce(),{version:"4.0.0"}),saberBColor:c(ce(),{version:"4.0.0"}),obstaclesColor:c(ce(),{version:"4.0.0"}),overrideLights:c(Ut(),{version:"4.0.1"}),environmentColor0:c(ce(),{version:"4.0.0"}),environmentColor1:c(ce(),{version:"4.0.0"}),environmentColor0Boost:c(ce(),{version:"4.0.0"}),environmentColor1Boost:c(ce(),{version:"4.0.0"}),environmentColorW:c(h(ce()),{version:"4.0.0"}),environmentColorWBoost:c(h(ce()),{version:"4.0.0"})}),Cg=ne({mappers:c(J(ce()),{version:"4.0.0"}),lighters:c(J(ce()),{version:"4.0.0"})}),Rg=ne({characteristic:c(Ir,{version:"4.0.0"}),difficulty:c($r,{version:"4.0.0"}),beatmapAuthors:c(Cg,{version:"4.0.0"}),environmentNameIdx:c(j(S(),W()),{version:"4.0.0"}),beatmapColorSchemeIdx:c(j(S(),W()),{version:"4.0.0"}),noteJumpMovementSpeed:c(S(),{version:"4.0.0"}),noteJumpStartBeatOffset:c(S(),{version:"4.0.0"}),lightshowDataFilename:c(ce(),{version:"4.0.0"}),beatmapDataFilename:c(ce(),{version:"4.0.0"}),customData:c(h(he))}),Lg=ci(e=>e.version||"4.0.0",{version:c(Ji,{version:"4.0.0"}),song:c(Tg,{version:"4.0.0"}),audio:c(Sg,{version:"4.0.0"}),songPreviewFilename:c(ce(),{version:"4.0.0"}),coverImageFilename:c(ce(),{version:"4.0.0"}),environmentNames:c(J(ce()),{version:"4.0.0"}),colorSchemes:c(J(wg),{version:"4.0.0"}),difficultyBeatmaps:c(J(Rg),{version:"4.0.0"}),customData:c(h(he))}),Ng=ne({x:c(h(j(S(),W())),{version:"4.0.0"}),y:c(h(j(S(),W())),{version:"4.0.0"}),d:c(h(Ra),{version:"4.0.0"}),customData:c(h(he))}),xg=ne({t:c(h(S()),{version:"4.0.0"}),i:c(h(j(S(),W())),{version:"4.0.0"}),f:c(h(S()),{version:"4.0.0"}),customData:c(h(he))}),Og=ne({b:c(h(je([0,1])),{version:"4.0.0"}),customData:c(h(he))}),Bg=ne({f:c(h(j(S(),W())),{version:"4.0.0"}),e:c(h(j(S(),W())),{version:"4.0.0"}),l:c(h(J(bo)),{version:"4.0.0"}),customData:c(h(he))}),kg=ne({t:c(h(Eb),{version:"4.0.0"}),g:c(h(j(S(),W())),{version:"4.0.0"}),b:c(h(S()),{version:"4.0.0"}),e:c(h(J(Bg)),{version:"4.0.0"}),customData:c(h(he))}),Ag=ne({f:c(h(Nc),{version:"4.0.0"}),p:c(h(j(S(),W())),{version:"4.0.0"}),t:c(h(j(S(),W())),{version:"4.0.0"}),r:c(h(je([0,1])),{version:"4.0.0"}),c:c(h(j(S(),W())),{version:"4.0.0"}),n:c(h(Oc),{version:"4.0.0"}),s:c(h(j(S(),W())),{version:"4.0.0"}),l:c(h(S()),{version:"4.0.0"}),d:c(h(xc),{version:"4.0.0"}),customData:c(h(he))}),Pg=ne({w:c(h(S()),{version:"4.0.0"}),d:c(h(xt),{version:"4.0.0"}),s:c(h(S()),{version:"4.0.0"}),t:c(h(xt),{version:"4.0.0"}),b:c(h(je([0,1])),{version:"4.0.0"}),e:c(h(Ot),{version:"4.0.0"}),customData:c(h(he))}),Mg=ne({p:c(h(je([0,1])),{version:"4.0.0"}),e:c(h(Ot),{version:"4.0.0"}),c:c(h(Bc),{version:"4.0.0"}),b:c(h(S()),{version:"4.0.0"}),f:c(h(j(S(),W())),{version:"4.0.0"}),sb:c(h(S()),{version:"4.0.0"}),sf:c(h(je([0,1])),{version:"4.0.0"}),customData:c(h(he))}),Ig=ne({w:c(h(S()),{version:"4.0.0"}),d:c(h(xt),{version:"4.0.0"}),s:c(h(S()),{version:"4.0.0"}),t:c(h(xt),{version:"4.0.0"}),b:c(h(je([0,1])),{version:"4.0.0"}),e:c(h(Ot),{version:"4.0.0"}),a:c(h(Fr),{version:"4.0.0"}),f:c(h(je([0,1])),{version:"4.0.0"}),customData:c(h(he))}),$g=ne({p:c(h(je([0,1])),{version:"4.0.0"}),e:c(h(Ot),{version:"4.0.0"}),l:c(h(j(S(),W())),{version:"4.0.0"}),r:c(h(S()),{version:"4.0.0"}),d:c(h(kc),{version:"4.0.0"}),customData:c(h(he))}),Fg=ne({w:c(h(S()),{version:"4.0.0"}),d:c(h(xt),{version:"4.0.0"}),s:c(h(S()),{version:"4.0.0"}),t:c(h(xt),{version:"4.0.0"}),b:c(h(je([0,1])),{version:"4.0.0"}),e:c(h(Ot),{version:"4.0.0"}),a:c(h(Fr),{version:"4.0.0"}),f:c(h(je([0,1])),{version:"4.0.0"}),customData:c(h(he))}),Vg=ne({p:c(h(je([0,1])),{version:"4.0.0"}),e:c(h(Ot),{version:"4.0.0"}),t:c(h(S()),{version:"4.0.0"}),customData:c(h(he))}),zg=ne({w:c(h(S()),{version:"4.0.0"}),d:c(h(xt),{version:"4.0.0"}),s:c(h(S()),{version:"4.0.0"}),t:c(h(xt),{version:"4.0.0"}),b:c(h(je([0,1])),{version:"4.0.0"}),e:c(h(Ot),{version:"4.0.0"}),customData:c(h(he))}),Gg=ne({p:c(h(je([0,1])),{version:"4.0.0"}),e:c(h(Ot),{version:"4.0.0"}),v:c(h(S()),{version:"4.0.0"}),customData:c(h(he))}),jg=ci(e=>e.version||"4.0.0",{version:c(Ji,{version:"4.0.0"}),waypoints:c(h(J(Zo)),{version:"4.0.0"}),waypointsData:c(h(J(Ng)),{version:"4.0.0"}),basicEvents:c(h(J(bo)),{version:"4.0.0"}),basicEventsData:c(h(J(xg)),{version:"4.0.0"}),colorBoostEvents:c(h(J(bo)),{version:"4.0.0"}),colorBoostEventsData:c(h(J(Og)),{version:"4.0.0"}),eventBoxGroups:c(h(J(kg)),{version:"4.0.0"}),indexFilters:c(h(J(Ag)),{version:"4.0.0"}),lightColorEventBoxes:c(h(J(Pg)),{version:"4.0.0"}),lightColorEvents:c(h(J(Mg)),{version:"4.0.0"}),lightRotationEventBoxes:c(h(J(Ig)),{version:"4.0.0"}),lightRotationEvents:c(h(J($g)),{version:"4.0.0"}),lightTranslationEventBoxes:c(h(J(Fg)),{version:"4.0.0"}),lightTranslationEvents:c(h(J(Vg)),{version:"4.0.0"}),fxEventBoxes:c(h(J(zg)),{version:"4.0.0"}),floatFxEvents:c(h(J(Gg)),{version:"4.0.0"}),basicEventTypesWithKeywords:c(h(Gc),{version:"4.0.0"}),useNormalEventsAsCompatibleEvents:c(h(Ut()),{version:"4.0.0"}),customData:c(h(he))});({...Pc.entries});const Wg={1:Lb,2:jb,4:Lg},Hg={2:xb,4:mg},Yg={1:Cb,2:$b,3:lg,4:Dg},Xg={3:ug,4:jg};function Wc(e){let t=["helpers","schemaCheck"];return e&&(t=t.concat(e)),t}function ti(e,t,i){const n=e.path?.map(o=>typeof o=="object"&&"key"in o?o.key:o).map((o,r)=>r===0?o:typeof o=="number"?`[${o}]`:`.${o.toString()}`).join("");if(t.doThrow)throw new Error(`${e.message}${n?` at "${n}"`:""}`);se.tWarn(Wc(t.vendor),`${e.message}${n?` at "${n}"`:""}`),i.push(e)}function qg(e){return"~standard"in e}function Qo(e,t,i,n=void 0,o={},r=[]){if(qg(t)){let a=[];const l=t["~standard"].validate(e);if("issues"in l&&l.issues){a=l.issues.filter((u,f)=>f<100)??[];for(const u of a)ti(u,{vendor:t["~standard"].vendor,doThrow:!_o(o)},r);l.issues.length>a.length&&se.tWarn(Wc(t["~standard"].vendor),"Max issue buffer has been reached.")}return[...a]}if(Array.isArray(e)){for(let a=0;a<e.length;a++)Qo(e[a],t,`${i}[${a}]`,n,o);return r}const s=Object.keys(t);if(!s.length||!Ku(e))return r;for(const a in e)a in t||ti({message:`Unused key ${a} found in ${i}`},{vendor:"bsmap",doThrow:o.unused},r);for(let a=0;a<s.length;a++){const l=s[a],u=t[l],f=e[l];if(f===void 0){if(!o.ignoreOptional&&t[l].optional||u.version&&n&&Ta(n,u.version)===-1)continue;ti({message:`Missing ${l} in object ${i}!`},{vendor:"bsmap",doThrow:o.missing},r);continue}if(f===null){ti({message:`${l} contain null value in object ${i}!`},{vendor:"bsmap",doThrow:o.nullish},r);continue}if(u.type==="array"){Array.isArray(f)||ti({message:`${l} is not an array in object ${i}!`},{vendor:"bsmap",doThrow:o.wrongType},r),Qo(f,u.check,`${i}.${l}`,n,o);continue}if(u.type==="object"){!Array.isArray(f)&&typeof f!="object"?ti({message:`${l} is not an object in object ${i}!`},{vendor:"bsmap",doThrow:o.wrongType},r):Qo(f,u.check,`${i}.${l}`,n,o);continue}if(u.array){if(!Array.isArray(f)){ti({message:`${l} is not ${u.type} in object ${i}!`},{vendor:"bsmap",doThrow:o.wrongType},r);continue}f.every(b=>typeof b===u.type||u.type==="number"&&typeof b=="number"&&(isNaN(b)||(u.int?b%1!==0:!0)&&(u.unsigned?b<0:!0)))||ti({message:`${l} is not ${u.type} in object ${i}!`},{vendor:"bsmap",doThrow:o.wrongType},r);continue}if(!u.array&&typeof f!==u.type){ti({message:`${l} is not ${u.type} in object ${i}!`},{vendor:"bsmap",doThrow:o.wrongType},r);continue}if(u.type==="number"&&typeof f=="number"){if(isNaN(f)){ti({message:`${i}.${l} is NaN!`},{vendor:"bsmap",doThrow:o.nullish},r);continue}if(u.int&&f%1!==0){ti({message:`${i}.${l} cannot be float!`},{vendor:"bsmap",doThrow:o.notInt},r);continue}if(u.unsigned&&f<0){ti({message:`${i}.${l} cannot be negative!`},{vendor:"bsmap",doThrow:o.notUnsigned},r);continue}}}return r}function Kg(e){return["validator",e]}const Jg={throwOn:{unused:!1,missing:!0,ignoreOptional:!1,nullish:!0,wrongType:!0,notInt:!1,notUnsigned:!1}};function Zg(e,t,i,n){const o={throwOn:{...Jg.throwOn,...n?.throwOn}};se.tInfo(Kg("validateJSON"),"Validating beatmap JSON for "+e+" with version",i);let r;switch(e){case"info":{r=Wg[i];break}case"audioData":{r=Hg[i];break}case"difficulty":{r=Yg[i];break}case"lightshow":{r=Xg[i];break}}return Qo(t,r,e,void 0,o.throwOn),t}function vn(e){return["loader",e]}const oo={forceConvert:!0,schemaCheck:{},sort:!0,preprocess:[],postprocess:[]};function Na(e,t,i,n={}){const o=(typeof i!="number"?i:n)??n??{},r={forceConvert:o.forceConvert??oo.forceConvert,schemaCheck:{...oo.schemaCheck,...o.schemaCheck},sort:o.sort??oo.sort,preprocess:o.preprocess??oo.preprocess,postprocess:o.postprocess??oo.postprocess},[s,...a]=r.preprocess;let l=s?s(t,i):t;a.forEach((v,y)=>{se.tInfo(vn("loadBeatmap"),"Running preprocess function #"+(y+1)),l=v(l)});const u=x0(l)?.at(0);let f;u?f=parseInt(u):(f=+N0(e).at(0),se.tWarn(vn("loadBeatmap"),"Could not identify beatmap version from JSON, assume implicit version",f));let b;if(r.schemaCheck.enabled&&Zg(e,l,f,r.schemaCheck),b=tb(e,f,l),i&&f!==i){if(!r.forceConvert)throw new Error(`Beatmap version unmatched, expected ${i} but received ${f}`);se.tWarn(vn("loadBeatmap"),"Beatmap version unmatched, expected",i,"but received",f,"for version; Converting to beatmap version",i),b=k0(e,i,b,b.version)}r.sort&&"sort"in b&&typeof b.sort=="function"&&b.sort();const[m,...g]=[...r.postprocess].reverse();return g.forEach((v,y)=>{se.tInfo(vn("loadBeatmap"),"Running postprocess function #"+(y+1)),b=v(b)}),m?m(b,i??null):b}function Qg(e,t,i){const n=typeof t=="number"?t:null,o=(typeof t!="number"?t:i)??{};return se.tInfo(vn("loadDifficulty"),"Loading difficulty from JSON"),Na("difficulty",e,n,o)}function Ug(e,t,i){const o={};return se.tInfo(vn("loadInfo"),"Loading info from JSON"),Na("info",e,null,o)}function ev(e,t,i){const n=typeof t=="number"?t:null,o=(typeof t!="number"?t:i)??{};return se.tInfo(vn("loadLightshow"),"Loading lightshow from JSON"),Na("lightshow",e,n,o)}const tv=ne({beat:c(S(),{version:"1.0.0"}),label:c(ce(),{version:"1.0.0"}),text:c(ce(),{version:"1.0.0"})});ci(()=>"1.0.0",{name:c(ce(),{version:"1.0.0"}),characteristic:c(ea([Ir,Us("")]),{version:"1.0.0"}),difficulty:c(ea([$r,Us("")]),{version:"1.0.0"}),color:c(ce(),{version:"1.0.0"}),bookmarks:c(J(tv),{version:"1.0.0"})});const ia={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",QueenEnvironment:"Queen",LinkinPark2Environment:"Linkin Park 2.0",TheRollingStonesEnvironment:"The Rolling Stones",LatticeEnvironment:"Lattice",DaftPunkEnvironment:"Daft Punk",HipHopEnvironment:"Hip Hop Mixtape",ColliderEnvironment:"Collider",GlassDesertEnvironment:"Glass Desert",MultiplayerEnvironment:"Origins",BritneyEnvironment:"Britney Spears",Monstercat2Environment:"Monstercat 2.0",MetallicaEnvironment:"Metallica"},Tn={DefaultEnvironment:[[0,1,2,3,4,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MultiplayerEnvironment:[[4],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],TheSecondEnvironment:[[0,1,2,3,4,9],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],LizzoEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,16,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]],TheWeekndEnvironment:[[0,1,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,29,30,31,32,33,34,35,36,37,38,40]],RockMixtapeEnvironment:[[3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]],Dragons2Environment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12]],Panic2Environment:[[3],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]],QueenEnvironment:[[6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],LinkinPark2Environment:[[3,40,41],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]],TheRollingStonesEnvironment:[[6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]],LatticeEnvironment:[[6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]],DaftPunkEnvironment:[[6,40,41,42,43],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55]],HipHopEnvironment:[[6],[0,1,2,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]],ColliderEnvironment:[[6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]],BritneyEnvironment:[[6,8,9,12],[0,1,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]],Monstercat2Environment:[[6,8],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32]],MetallicaEnvironment:[[6,8,13],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44]]},iv={},nv=Object.freeze(Object.defineProperty({__proto__:null,default:iv},Symbol.toStringTag,{value:"Module"}));function bu(){throw new Error("`path` function not provided; please supply `path` function inside the `path` object from the module")}const gu=nv,ov={resolve:gu?.resolve||bu,basename:gu?.basename||bu};var vu=function(e,t,i,n){if(i==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return i==="m"?n:i==="a"?n.call(e):n?n.value:t.get(e)},rv=function(e,t,i,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,i):o?o.value=i:t.set(e,i),i},ao;function sv(e){return["globals",e]}class av{constructor(){ao.set(this,"./")}get directory(){return vu(this,ao,"f")}set directory(t){t=ov.resolve(t.trim()),rv(this,ao,t,"f"),se.tInfo(sv("directory"),`Global map directory is set to ${vu(this,ao,"f")}`)}}ao=new WeakMap;new av;function $o(){throw new Error("`fs` function not provided; please supply `fs` function inside the `fs` object from the module")}typeof Deno<"u"?(Deno.readTextFile,Deno.readTextFileSync,Deno.writeTextFile,Deno.writeTextFileSync):typeof Bun<"u"&&Bun.write;class Me{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o;static init(){Me.#e=document.querySelector(".info__level-author"),Me.#i=document.querySelector(".info__environment"),Me.#t=document.querySelector(".info__editors"),Me.#n=document.querySelector(".info__contributors"),Me.#s=document.querySelector(".info__contributors-image"),Me.#a=document.querySelector(".info__contributors-name"),Me.#r=document.querySelector(".info__contributors-role"),Me.#o=document.querySelector(".info__contributors-list")}static reset(){Me.setLevelAuthor(),Me.setEnvironment(),Me.setEditors(),Me.populateContributors()}static setLevelAuthor(t,i){if(!t){Me.#e.textContent="";return}i?.length?Me.#e.textContent="Mapped by "+t.join(", ")+" and lit by "+i.join(", "):Me.#e.textContent="Mapped by "+t.join(", ")}static setEnvironment(t){if(!t){Me.#i.textContent="";return}Me.#i.textContent=t.map(i=>(ia[i]||`Unknown (${i})`)+" Environment").join(", ")}static setEditors(t){if(!t||!t._lastEditedBy){Me.#t.classList.add("hidden");return}Me.#t.classList.remove("hidden");const i=t._lastEditedBy||"Undefined";let n="Last edited on "+i;if(t[i]){const o=t[i];n+=" v"+o.version}Me.#t.textContent=n}static setContributors(t){Me.#l(t._base64?"data:image;base64,"+t._base64:null),Me.#u(t._name),Me.#c(t._role)}static populateContributors(t){for(;Me.#o.firstChild;)Me.#o.removeChild(Me.#o.firstChild);if(!t||!t.length){Me.#n.classList.add("hidden");return}Me.#n.classList.remove("hidden"),t.forEach((i,n)=>{const o=document.createElement("div");o.classList.add("info__contributors-card");const r=document.createElement("img");r.classList.add("info__contributors-image"),r.src=i._base64?"data:image;base64,"+i._base64:"./img/unknown.jpg",r.alt="contributor image: "+i._name;const s=document.createElement("div");s.classList.add("info__contributors-content");const a=document.createElement("span");a.classList.add("info__contributors-name"),a.textContent=i._name;const l=document.createElement("span");l.classList.add("info__contributors-role"),l.textContent=i._role,s.appendChild(a),s.appendChild(document.createElement("br")),s.appendChild(l),o.appendChild(r),o.appendChild(s),Me.#o.appendChild(o)})}static#l(t){Me.#s.src=t||"./img/unknown.jpg"}static#u(t){Me.#a.textContent=t}static#c(t){Me.#r.textContent=t}}const mt=class mt{static init(){if(localStorage==null)return;const t=localStorage.getItem("settings");if(t){const i=JSON.parse(t);if(!i.version){mt.clear();return}for(const n in mt.default){const o=n;mt.props[o]=i[o]??mt.default[o],typeof mt.props[o]!=typeof mt.default[o]&&(mt.props[o]=mt.default[o])}mt.props.version=mt.default.version,mt.save()}}static clear(){localStorage&&localStorage.clear()}static save(){localStorage&&localStorage.setItem("settings",JSON.stringify(mt.props))}static reset(){mt.props=N(mt.default)}};mt.default={version:6,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",infoRowCount:5,rounding:3,dataCheck:!0,deduplicateTime:!0,theme:"Dark",show:"info",checks:{persistent:!0,preset:"Default"},aprilFooled:1},mt.props=N(mt.default);let ue=mt;class ge{static init(){ge.htmlTableVersion=document.querySelector(".info__version"),ge.htmlTableMappers=document.querySelector(".info__mappers"),ge.htmlTableLighters=document.querySelector(".info__lighters"),ge.htmlTableEnvironmentId=document.querySelector(".info__environmentId"),ge.htmlTablePlayTime=document.querySelector(".info__play-time"),ge.htmlTableTimeSpend=document.querySelector(".info__time-spend"),ge.htmlTableColorScheme=document.querySelector(".info__color-scheme"),ge.htmlTableCustomColor=document.querySelector(".info__custom-color"),ge.htmlTableRequirements=document.querySelector(".info__requirements"),ge.htmlTableSuggestions=document.querySelector(".info__suggestions"),ge.htmlTableInformation=document.querySelector(".info__information"),ge.htmlTableWarnings=document.querySelector(".info__warnings"),ge.htmlTableBookmarks=document.querySelector(".info__bookmarks"),ge.htmlTableBPMChanges=document.querySelector(".info__bpm-changes"),ge.htmlTableEnvironmentEnhancement=document.querySelector(".info__environment-enhancement"),ge.htmlTablePointDefinitions=document.querySelector(".info__point-definitions"),ge.htmlTableCustomEvents=document.querySelector(".info__custom-events"),ge.htmlTableElements=document.querySelectorAll(".info__table-element"),ge.htmlTableContents=document.querySelectorAll(".info__table-contents")}}function St(e){const i=e.querySelector(".info__table-element")?.querySelector(".info__table-content");i&&(i.innerHTML=""),e.classList.add("hidden")}let Lt={};function lv(e,t){e.textContent=t}function uv(e,t){const i=Lt[e];return function(){i.page++,i.page*ue.props.infoRowCount>=i.content.length&&(i.page=0),t()}}function cv(e,t){const i=Lt[e];return function(){i.page--,i.page<0&&(i.page=Math.ceil(i.content.length/ue.props.infoRowCount)-1),t()}}function fv(e,t){const i=Lt[e];return function(){const o=i.content.slice(i.page*ue.props.infoRowCount,i.page*ue.props.infoRowCount+ue.props.infoRowCount);for(lv(t,`${i.page+1} / ${Math.ceil(i.content.length/ue.props.infoRowCount)}`);i.html.firstChild;)i.html.removeChild(i.html.firstChild);o.forEach(r=>{if(typeof r=="string"){const s=document.createElement("div");s.textContent=r,i.html.appendChild(s)}else i.html.appendChild(r)})}}function wt(e,t,i=""){const n=e.querySelector(".info__table-element");if(!n)return;const o=n.querySelector(".info__table-content");if(o){for(;o.firstChild;)o.removeChild(o.firstChild);if(typeof t=="string")o.textContent=t;else if(i){const r=n.querySelector(".info__table-paginate-button--next"),s=n.querySelector(".info__table-paginate-button--prev"),a=n.querySelector(".info__table-paginate-total");a.textContent=`${t.length}`;const l=n.querySelector(".info__table-paginate-page");i in Lt&&(r.removeEventListener("click",Lt[i].nextCb),s.removeEventListener("click",Lt[i].prevCb)),Lt[i]={content:t,html:o,page:0,nextCb:null,prevCb:null,cb:null},Lt[i].cb=fv(i,l);const u=uv(i,Lt[i].cb),f=cv(i,Lt[i].cb);r&&(r.addEventListener("click",u),Lt[i].nextCb=u),s&&(s.addEventListener("click",f),Lt[i].prevCb=f),Lt[i].cb()}else{for(;o.firstChild;)o.removeChild(o.firstChild);t.forEach(r=>{if(typeof r=="string"){const s=document.createElement("div");s.textContent=r,o.appendChild(s)}else o.appendChild(r)})}}e.classList.remove("hidden")}function Eu(){Object.keys(Lt).forEach(e=>{Lt[e].page=0,Lt[e].cb?.()})}function Rs(e,t){if(e==null||!e.length){St(ge.htmlTableBookmarks);return}const i=[];e.forEach((n,o)=>{let r=n.b??n._time??0,s;const a=document.createElement("div"),l=document.createElement("div"),u=document.createElement("div");a.appendChild(l),a.appendChild(u),a.className="info__color",l.className="info__color-dot",l.style.backgroundColor="#000000",u.className="info__color-text";const f=n.n??n._name;typeof f!="string"&&(u.textContent=`Error parsing bookmarks[${o}]`,i.push(a)),t&&(r=t.adjustTime(r),s=t.toRealTime(r));const b=n.c??n._color;l.style.backgroundColor=b?ke({r:b[0],g:b[1],b:b[2]}):"#333333",u.textContent=`${$(r,ue.props.rounding)}${s?" | "+yi(s):""} -- ${f!=""?f:"**EMPTY NAME**"}`,i.push(a)}),wt(ge.htmlTableBookmarks,i,"bookmarks")}function Ls(e){if(!e||!e.change.length){St(ge.htmlTableBPMChanges);return}const t=e.change.map(i=>{const n=$(i.newTime,ue.props.rounding),o=e.toRealTime(i.time);return`${n} | ${yi(o)} -- ${i.BPM}`});wt(ge.htmlTableBPMChanges,t,"bpmChanges")}function Ns(e,t){if(!e||!e._colorLeft&&!e._colorRight&&!e._envColorLeft&&!e._envColorLeftBoost&&!e._envColorRight&&!e._envColorRightBoost&&!e._envColorWhite&&!e._envColorWhiteBoost&&!e._obstacleColor){St(ge.htmlTableCustomColor);return}t||(t="DefaultEnvironment");const i={_colorLeft:bi[di[t]]?._colorLeft||null,_colorRight:bi[di[t]]?._colorRight||null,_envColorLeft:bi[di[t]]?._envColorLeft||null,_envColorRight:bi[di[t]]?._envColorRight||null,_envColorLeftBoost:bi[di[t]]?._envColorLeftBoost||null,_envColorRightBoost:bi[di[t]]?._envColorRightBoost||null,_obstacleColor:bi[di[t]]?._obstacleColor||null},n={_colorLeft:i._colorLeft?ke(i._colorLeft):null,_colorRight:i._colorRight?ke(i._colorRight):null,_envColorLeft:i._envColorLeft?ke(i._envColorLeft):null,_envColorRight:i._envColorRight?ke(i._envColorRight):null,_envColorWhite:null,_envColorLeftBoost:i._envColorLeftBoost?ke(i._envColorLeftBoost):null,_envColorRightBoost:i._envColorRightBoost?ke(i._envColorRightBoost):null,_envColorWhiteBoost:null,_obstacleColor:i._obstacleColor?ke(i._obstacleColor):null},o={noteColor:!!(e._colorLeft||e._colorRight),eventColor:!!(e._envColorLeft||e._envColorRight),eventBoostColor:!!(e._envColorLeftBoost||e._envColorRightBoost),obstacleColor:!!e._obstacleColor};e._colorLeft&&(n._colorLeft=ke(e._colorLeft)),e._colorRight&&(n._colorRight=ke(e._colorRight)),e._envColorLeft?n._envColorLeft=ke(e._envColorLeft):e._colorLeft&&(n._envColorLeft=ke(e._colorLeft)),e._envColorRight?n._envColorRight=ke(e._envColorRight):e._colorRight&&(n._envColorRight=ke(e._colorRight));let r,s,a=!1;e._envColorLeftBoost?(r=ke(e._envColorLeftBoost),a=!0):r=i._envColorLeftBoost?ke(i._envColorLeftBoost):n._envColorLeft,e._envColorRightBoost?(s=ke(e._envColorRightBoost),a=!0):s=i._envColorRightBoost?ke(i._envColorRightBoost):n._envColorRight,e._envColorWhite&&(n._envColorWhite=ke(e._envColorWhite)),e._envColorWhiteBoost&&(n._envColorWhiteBoost=ke(e._envColorWhiteBoost)),a&&(n._envColorLeftBoost=r,n._envColorRightBoost=s),e._obstacleColor&&(n._obstacleColor=ke(e._obstacleColor)),o.noteColor||(n._colorLeft=null,n._colorRight=null),o.eventColor||(n._envColorLeft=null,n._envColorRight=null),o.noteColor&&!o.eventColor&&(n._envColorLeft=n._colorLeft,n._envColorRight=n._colorRight),o.obstacleColor||(n._obstacleColor=null);const l=[];for(const u in n){if(!n[u])continue;const f=document.createElement("div"),b=document.createElement("div"),m=document.createElement("div"),g=document.createElement("div");f.className="info__color",b.className="info__color-dot",b.style.backgroundColor=n[u]||"#000000",m.className="info__color-text info__color-text--monospace",m.textContent=`${n[u]}`,g.className="info__color-text",g.textContent=` -- ${Fd[u]}`,f.appendChild(b),f.appendChild(m),f.appendChild(g),l.push(f)}wt(ge.htmlTableCustomColor,l)}class mv{constructor(){Object.defineProperty(this,"_regex",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_string",{enumerable:!0,configurable:!0,writable:!0,value:""})}get regex(){return this._regex}get string(){return this._string}}class Fo extends mv{constructor(t){super(),Object.defineProperty(this,"hasNested",{enumerable:!0,configurable:!0,writable:!0,value:!1}),t&&(this._string=t,this._regex=t)}static create(t){return t?new this(t):new this}name(t){return this._string+=t.trim(),this._regex+=t.trim(),this}id(t,i){return t!==null?(i?this._regex+=`( \\(${t}\\))?`:this._regex+=` \\(${t}\\)`,this._string+=` (${t})`):(i?this._regex+="( \\(\\d+\\))?":this._regex+=" \\(\\d+\\)",this._string+=" (1)"),this}space(t=1){for(let i=0;i<t;i++)this._string+=" ",this._regex+=" ";return this}clone(t=1){for(let i=0;i<t;i++)this._string+=" (Clone)",this._regex+=" \\(Clone\\)";return this}end(){return this._regex+="$",this}child(t){return this._string+=`.[${typeof t=="number"?t:1}]`,this._regex+=`\\.\\[${typeof t=="number"?t:"\\d+"}\\]`,this}}Object.defineProperty(Fo,"Preset",{enumerable:!0,configurable:!0,writable:!0,value:{ENVIRONMENT:new Fo().child().name("Environment").end(),CONSTRUCTION:new Fo("Environment").child().name("Construction").end(),SMOKE:new Fo().child().name("BigSmokePS").end()}});var na;(function(e){e.forehand="backhand",e.backhand="forehand"})(na||(na={}));function Vo(e,t,i){return po(e-t,360)<=po(i-t,360)}function yu(e,t){return Wu(Math.atan2(t[1]-e[1],t[0]-e[0]))}function Hc(e,t,i,n=85){const o=zt(e),r=zt(t),s=yu(r,o),a=yu(o,r);if(t.direction===z.ANY){const u=po(Pt(e.direction)+180,360);return Vo(a,u-n,u+n)}if(i!==z.ANY){const u=Pt(i);return Vo(s,u-n,u+n)||Vo(a,u-n,u+n)}const l=Pt(t.direction);return Vo(s,l-n,l+n)}function _u(e,t){if(Hc(e,t,z.ANY))return e.direction===z.ANY?t.direction:e.direction;if(e.direction!==z.ANY)return e.direction;if(e.time>t.time){if(e.posX>t.posX&&$n(e,t))return z.RIGHT;if(e.posX<t.posX&&$n(e,t))return z.LEFT;if(e.posY>t.posY){if(Fn(e,t))return z.UP;if(e.posX>t.posX)return z.UP_RIGHT;if(e.posX<t.posX)return z.UP_LEFT}if(e.posY<t.posY){if(Fn(e,t))return z.DOWN;if(e.posX>t.posX)return z.DOWN_RIGHT;if(e.posX<t.posX)return z.DOWN_LEFT}}return z.ANY}function go(e,t,i,n){let o,r;if(e===null||t===null)return!1;if(typeof e=="number")o=e;else{if(e.direction===z.ANY)return!1;o=Pt(e.direction)}if(typeof t=="number")r=t;else{if(t.direction===z.ANY)return!1;r=Pt(t.direction)}return n?an(o,r,360)<=i:an(o,r,360)>=i}const zo={[pe.RED]:{forehand:[z.DOWN,z.RIGHT,z.DOWN_LEFT,z.DOWN_RIGHT],backhand:[z.UP,z.LEFT,z.UP_LEFT,z.UP_RIGHT]},[pe.BLUE]:{forehand:[z.DOWN,z.LEFT,z.DOWN_LEFT,z.DOWN_RIGHT],backhand:[z.UP,z.RIGHT,z.UP_LEFT,z.UP_RIGHT]}},bn={[pe.RED]:[0,0,90,90,45,-45,45,-45],[pe.BLUE]:[0,0,-90,-90,-45,45,-45,45]},Du={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}};class on{constructor(t,i,n,o,r,s,a){Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"rotation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"position",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"warningThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"errorThreshold",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowedRotation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.color=n,this.warningThreshold=o,this.errorThreshold=r,this.allowedRotation=s,a&&a!=="neutral"?(this.state=a,this.rotation=0):(this.state=this.predictStartState(t,i,n),this.rotation=this.predictStartRotation(t,n)),this.position=this.predictStartPosition(t,n)}check(t,i){if(this.state==="neutral")return"none";if(!t.length)throw new Error("no notes were given");const n=t[0].time,o=this.color;let r=this.state,s=this.rotation;i.forEach(f=>{f.time-.001>n||(f.posY===ut.BOTTOM&&f.posX===(o?xe.MIDDLE_RIGHT:xe.MIDDLE_LEFT)&&(r="backhand",s=0),f.posY===ut.TOP&&f.posX===(o?xe.MIDDLE_RIGHT:xe.MIDDLE_LEFT)&&(r="forehand",s=0))});let a,l=z.ANY;for(const f of t)f.direction!==z.ANY&&(l=f.direction),a&&l===z.ANY&&(l=_u(f,a)),a=f;if(l===z.ANY)return"none";const u=Du[o][na[r]][l];return(s>u?s-u:u-s)>180||u<on.CONSTRAINT_ROTATION[o][0]+this.errorThreshold||u>on.CONSTRAINT_ROTATION[o][1]-this.errorThreshold?"error":u<on.CONSTRAINT_ROTATION[o][0]+this.warningThreshold||u>on.CONSTRAINT_ROTATION[o][1]-this.warningThreshold||(s>u?s-u:u-s)>this.allowedRotation?"warning":"none"}next(t,i){if(this.check(t,i)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let a=0;a<t.length;a++){const l=t[a];if(zo[l.color].forehand.includes(l.direction)){this.state="backhand";break}if(zo[l.color].backhand.includes(l.direction)){this.state="forehand";break}this.state==="neutral"&&l.direction===z.ANY&&(l.posY===0&&(this.state="backhand"),l.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const n=t[0].time,o=this.color;i.forEach(a=>{a.time-.001>n||(a.posY===ut.BOTTOM&&a.posX===(o?xe.MIDDLE_RIGHT:xe.MIDDLE_LEFT)&&(this.state="forehand",this.rotation=0),a.posY===ut.TOP&&a.posX===(o?xe.MIDDLE_RIGHT:xe.MIDDLE_LEFT)&&(this.state="backhand",this.rotation=0))});let r,s=z.ANY;for(const a of t)a.direction!==z.ANY&&(s=a.direction),r&&s===z.ANY&&(s=_u(a,r)),r=a;s!==z.ANY&&(this.rotation=Du[this.color][this.state][s])}predictStartState(t,i,n){const o=[...t,...i].sort((s,a)=>s.time-a.time);let r="neutral";for(let s=0,a=o.length;s<a;s++){if(a0(o[s].color)){o[s].posY===ut.BOTTOM&&(o[s].posX===n?xe.MIDDLE_RIGHT:xe.MIDDLE_LEFT)&&(r="backhand"),o[s].posY===ut.TOP&&(o[s].posX===n?xe.MIDDLE_RIGHT:xe.MIDDLE_LEFT)&&(r="forehand");continue}let l=o[s];if(l.color!==Math.abs(n-1)&&l.color===n){if(r!=="neutral")break;const u=l.time;for(let f=s;f<o.length&&!(o[f].time>l.time+.001&&u<l.time+.001);f++){if(l=o[f],zo[l.color].forehand.includes(l.direction))return"backhand";if(zo[l.color].backhand.includes(l.direction))return"forehand";r==="neutral"&&l.direction===z.ANY&&(l.posY===ut.BOTTOM&&(r="backhand"),l.posY>ut.BOTTOM&&(r="forehand"))}break}}return r}predictStartRotation(t,i){let n=0;for(let o=0,r=t.length;o<r;o++){let s=t[o];if(s.color===i&&s.color===i){const a=s.time;for(let l=o;l<t.length&&!(t[l].time>s.time+.001&&a<s.time+.001);l++){if(s=t[l],s.direction!==z.ANY)return bn[s.color][s.direction];s.direction===z.ANY&&(s.posY===ut.BOTTOM&&(s.posX===xe.LEFT&&(n=bn[s.color][6]),s.posX===xe.RIGHT&&(n=bn[s.color][7])),s.posY===ut.MIDDLE&&(s.posX===xe.LEFT&&(n=bn[s.color][2]),s.posX===xe.RIGHT&&(n=bn[s.color][3])),s.posY===ut.BOTTOM&&(s.posX===xe.LEFT&&(n=bn[s.color][4]),s.posX===xe.RIGHT&&(n=bn[s.color][5])))}break}}return n}predictStartPosition(t,i){return i?[-.5,1]:[.5,1]}}Object.defineProperty(on,"CONSTRAINT_ROTATION",{enumerable:!0,configurable:!0,writable:!0,value:[[-155,195],[-195,155]]});var oa;(function(e){e.duplicate="D",e.active="A",e.scale="S",e.position="P",e.localPosition="Lp",e.rotation="R",e.localRotation="Lr",e.lightID="Li",e.track="T"})(oa||(oa={}));var ra;(function(e){e.childrenTracks="Ct",e.color="C",e.definitePosition="Dp",e.dissolve="D",e.dissolveArrow="Da",e.duration="Dur",e.easing="E",e.interactable="I",e.localRotation="Lr",e.parentTrack="Pt",e.position="P",e.rotation="R",e.scale="S",e.time="T",e.track="Tr",e.worldPositionStays="Wps"})(ra||(ra={}));const hv={0:"Accent Lights",1:"Ring Lights",2:"Left Lasers",3:"Right Lasers",4:"Primary Lights",5:"Boost Colors",6:"Extra Left Lights",7:"Extra Right Lights",8:"Ring Rotation",9:"Ring Zoom",10:"Extra Left Lasers",11:"Extra Right Lasers",12:"Left Laser Speed",13:"Right Laser Speed",14:"Early Lane Rotation",15:"Late Lane Rotation",16:"Utility Event 1",17:"Utility Event 2",18:"Utility Event 3",19:"Utility Event 4",40:"Special Event 1",41:"Special Event 2",42:"Special Event 3",43:"Special Event 4"},pv={DefaultEnvironment:{0:"Under Track X",1:"Big Ring Lights",4:"Above Track X"},OriginsEnvironment:{0:"Under Track X",2:"Left Lasers and Left Lane Light",3:"Right Lasers and Right Lane Light",4:"Chevron"},TriangleEnvironment:{0:"Under Track X",1:"Big Ring Lights",4:"Above Track X"},NiceEnvironment:{0:"Under Track X",1:"Big Ring Lights",2:"Bottom Laser and Left Tower",3:"Top Laser and Right Tower",4:"Lane and Above Track X Lights"},BigMirrorEnvironment:{0:"Above Track X",4:"Lane and Under Track X Lights"},DragonsEnvironment:{0:"Wide Lights",1:"Close Lights",2:"Left Lasers and Galaxy",3:"Right Lasers and Galaxy",4:"Lane Lights"},KDAEnvironment:{0:"Under Track",1:"Ceiling Lasers",3:"Right Lasers and Lashers",4:"Lane and Field Lights"},MonstercatEnvironment:{0:"Under Track",1:"Ceiling Lights",4:"Lane and Wide Lights"},CrabRaveEnvironment:{0:"Under Track",1:"Ceiling Lights",4:"Lane and Wide Lights"},PanicEnvironment:{0:"Under Track X",1:"Ring and Wide Lights",4:"Lane and Window Lights"},RocketEnvironment:{0:"Wide Goal and Ceiling Lights",1:"Under Track Lights",4:"Lane and Small Goal Lights"},GreenDayEnvironment:{0:"Under Track Pillars",4:"Lane Lights"},GreenDayGrenadeEnvironment:{0:"Under Track Pillars",1:"Area Lights",4:"Lane and Grenade Lights"},TimbalandEnvironment:{0:"Perpendicular External Ring Lasers",1:"Internal Ring Lights",2:"Left Parallel Ring Lights",3:"Right Parallel Ring Lights",4:"Lane and Chevron Lights"},FitBeatEnvironment:{0:"Ring Emitter Lights",1:"Large Woven Ring Lights",4:"Chevron"},LinkinParkEnvironment:{0:"Lane Lights",1:"Ceiling Lights",2:"Left Lasers and Lights",3:"Right Lasers and Lights",4:"LP Logo",8:"Laser Mode"},BTSEnvironment:{0:"Door Light",1:"Vertical Pillar Lights",4:"Lane Lights",8:"Distant Tower Spin",9:"Raise/Lower Pillars",40:"BTS Character"},KaleidoscopeEnvironment:{0:"Spike Tip Lights",1:"Spike Mid Lights",2:"Spike Left Lights",3:"Spike Right Lights",4:"Distant Lasers and Spike Top Lights"},InterscopeEnvironment:{0:"Gate 4",1:"Gate 1",2:"Gate 3",3:"Gate 2",4:"Gate 5",6:"Left Lasers",7:"Right Lasers",8:"Bounce Cars",9:"Laser Mode",16:"Lower Hydraulics",17:"Raise Hydraulics"},SkrillexEnvironment:{0:"Logo",1:"Top Lanes and 1st Ring Set",4:"Bottom Lanes and 2nd Ring Set",6:"Left Panel",7:"Right Panel",9:"Laser Mode",12:"Left Laser & Panel Speed",13:"Right Laser & Panel Speed"},BillieEnvironment:{0:"Water 4",1:"Water 1",2:"Left Sun Beams",3:"Right Sun Beams",4:"Sun",5:"Moon + Boost Colors",6:"Water 2",7:"Water 3",8:"Toggle Rain",9:"Sunbeam Mode",10:"Left Bottom Lasers",11:"Right Bottom Lasers",12:"Left Sun Beams Speed",13:"Right Sun Beams Speed"},HalloweenEnvironment:{0:"Sky Lasers",1:"Moon",4:"Lane + Castle Interior"},GagaEnvironment:{0:"Aurora 1",1:"Aurora 2",2:"Tower 3 Lights",3:"Tower 4 Lights",4:"Logo",6:"Tower 2 Lights",7:"Tower 5 Lights",10:"Tower 1 Lights",11:"Tower 6 Lights",12:"Tower 3 Height",13:"Tower 4 Height",16:"Tower 2 Height",17:"Tower 5 Height",18:"Tower 1 Height",19:"Tower 6 Height"},WeaveEnvironment:{4:"Player Place"},PyroEnvironment:{0:"Video Alpha",1:"Logo",2:"Left Projectors",3:"Right Projectors",4:"Platform",6:"Ambient",40:"Video Projection"},EDMEnvironment:{0:"Lane Lights Bottom",1:"Lane Lights Top",4:"Player Place & Spectrogram"},TheSecondEnvironment:{0:"Buildings",1:"Logo",2:"Left Flags",3:"Right Flags",4:"Runway",9:"Ring Zoom"},LizzoEnvironment:{0:"Runway Left",1:"Runway Right",2:"Left Ring",3:"Right Ring",4:"Top Square",6:"Ambient",7:"Cherry Left",8:"Cherry Right",9:"LI Sign",10:"Z Left Sign",11:"Z Right Sign",12:"O Sign",16:"Left Balloon Particles",17:"Right Balloon Particles"},TheWeekndEnvironment:{0:"Runway Left",1:"Runway Right",6:"Ambient"},RockMixtapeEnvironment:{3:"BG Bloom",4:"Aurora",6:"Ambient"},Dragons2Environment:{0:"Inner Laser Left",1:"Inner Laser Right",2:"Outer Laser Left",3:"Outer Laser Right",4:"Logo",6:"Ambient"},Panic2Environment:{3:"Ambient"},QueenEnvironment:{6:"Ambient",40:"Silhouettes"},LinkinPark2Environment:{3:"Ambient",40:"Logos",41:"Floor Logos"},TheRollingStonesEnvironment:{6:"Ambient",40:"Logo"},LatticeEnvironment:{6:"Ambient"},DaftPunkEnvironment:{6:"Ambient",40:"Helmet 01 Switch",41:"Helmet 02 Switch",42:"Helmet 01 Text",43:"Helmet 02 Text"},HipHopEnvironment:{6:"Ambient"},ColliderEnvironment:{6:"Ambient"},BritneyEnvironment:{6:"Ambient",8:"Player Place",9:"Dust Particles",12:"Icons"},Monstercat2Environment:{6:"Ambient",8:"Player Place"},MetallicaEnvironment:{6:"Ambient",8:"Player Place",13:"Pillar Switch"}};function dv(e,t){return pv[t]?.[e]||hv[e]||"Unknown"}const bv={WeaveEnvironment:{0:"Outer Square Bottom Left Laser",1:"Outer Square Bottom Right Laser",2:"Outer Square Top Left Laser",3:"Outer Square Top Right Laser",4:"Inner Square Bottom Left Laser",5:"Inner Square Bottom Right Laser",6:"Inner Square Top Left Laser",7:"Inner Square Top Right Laser",8:"Side Square Bottom Left Laser",9:"Side Square Bottom Right Laser",10:"Side Square Top Left Laser",11:"Side Square Top Right Laser",12:"Distant Square Top Laser",13:"Distant Square Bottom Laser",14:"Distant Square Left Laser",15:"Distant Square Right Laser"},PyroEnvironment:{0:"Stage Left Platform",1:"Stage Right Platform",2:"Top Stage Left Laser",3:"Top Stage Right Laser",4:"Top Stage Middle Laser",5:"Top Stage Light",6:"Side Panels Left Tower",7:"Side Panels Right Tower",8:"Stage Left Laser",9:"Stage Right Laser",10:"Side Panels Left Laser",11:"Side Panels Right Laser",12:"Fire Left",13:"Fire Right"},EDMEnvironment:{0:"Circles Top",1:"Circles Close",2:"Circles Distant",3:"Circles Distant 2",4:"Single Source Circles Left",5:"Single Source Circles Right",6:"Single Source Lasers Left (Up)",7:"Single Source Lasers Left (Out)",8:"Single Source Lasers Right (Up)",9:"Single Source Lasers Right (Out)",10:"Single Source Lasers Left (Down)",11:"Single Source Lasers Right (Down)",12:"Single Source Lasers Left (Down) / Circle Rotations Top",13:"Single Source Lasers Right (Up) / Circle Rotations Close",14:"Circle Rotations Distant",15:"Circle Rotations Distant 2",16:"Circle Rotations Single Source Left",17:"Circle Rotations Single Source Right"},TheSecondEnvironment:{0:"Rings Big",1:"Rings Small",2:"Runway Left",3:"Runway Right",4:"Spotlight Left",5:"Spotlight Right",6:"Top Lasers Left Bottom",7:"Top Lasers Right Bottom",8:"Top Lasers Left Top",9:"Top Lasers Right Top",10:"Bottom Lasers Left Bottom",11:"Bottom Lasers Right Bottom",12:"Bottom Lasers Left Top",13:"Bottom Lasers Right Top"},LizzoEnvironment:{0:"Main Floor",1:"Rainbow Arcs Inner",2:"Rainbow Arcs 2",3:"Rainbow Arcs 3",4:"Rainbow Arcs 4",5:"Rainbow Arcs Outer",6:"Rainbow Rings Left",7:"Rainbow Rings Right",8:"Rainbow Rings Lasers Left",9:"Rainbow Rings Lasers Right",10:"Main Top Lasers",11:"Environment Stands Left",12:"Environment Stands Right",13:"Environment Clouds Left",14:"Environment Clouds Right",15:"Main Left Lasers",16:"Main Right Lasers",17:"Environment Stand Lasers Left",18:"Environment Stand Lasers Right",19:"Rainbow Arcs Laser"},TheWeekndEnvironment:{0:"Lamps Poles Left",1:"Lamps Poles Right",2:"Lamps Rings Left",3:"Lamps Rings Right",4:"Environment Arrows",5:"Environment Side Lasers Left",6:"Environment Side Lasers Right",7:"Environment Runway Lane",8:"Environment Center Ring",9:"Environment Center Ring Lasers",10:"Windows Left 1 Front",11:"Windows Left 1 Side",12:"Windows Left 2 Side",13:"Windows Left 3 Front",14:"Windows Left 3 Side",15:"Windows Right 1 Front",16:"Windows Right 1 Side",17:"Windows Right 2 Side",18:"Windows Right 3 Front",19:"Windows Right 3 Side",20:"Buildings Left",21:"Buildings Right",22:"Buildings Roof Left",23:"Buildings Roof Right",29:"Lamp Rings Left 1",30:"Lamp Rings Left 2",31:"Lamp Rings Left 3",32:"Lamp Rings Left 4",33:"Lamp Rings Right 1",34:"Lamp Rings Right 2",35:"Lamp Rings Right 3",36:"Lamp Rings Right 4",37:"Buildings Background Left",38:"Buildings Background Right",40:"Buildings Side Buildings"},RockMixtapeEnvironment:{0:"Lasers Far Left",1:"Lasers Far Right",2:"Mountain 1",3:"Mountain 2",4:"Mountain 3",5:"Mountain 4",6:"Mountain 5",7:"Mountain 6",8:"Mountain 7",9:"Mountain 8",10:"Mountain 9",11:"Mountain 10",12:"Mountain 11",13:"Mountain 12",14:"Face Eyes",15:"Runway Frets",16:"Runway Strings",17:"Runway Tunnel",18:"Lasers Side Left",19:"Lasers Side Right",20:"Lasers Side Left Rotation",21:"Lasers Side Right Rotation",22:"Face Left",23:"Face Right",24:"Spikes Left",25:"Spikes Left Movement",26:"Spikes Right",27:"Spikes Right Movement",28:"Runway Dots",29:"Face Movement",30:"Runway Equilizer",31:"Screens Left 1",32:"Screens Left 2",33:"Screens Right 1",34:"Screens Right 2",35:"Screens Left Movement",36:"Screens Right Movement",37:"Lasers Side Z Translation"},Dragons2Environment:{0:"Small Rings (R/T)",1:"Small Rings (Colors)",2:"Underground",3:"Big Rings",4:"Top Spotlights",5:"Runway Left",6:"Runway Right",7:"Particles Left",8:"Particles Right",9:"Main Lasers Bottom Left",10:"Main Lasers Top Left",11:"Main Lasers Top Right",12:"Main Lasers Bottom Right"},Panic2Environment:{0:"Left Cones Local",1:"Right Cones Local",2:"Left Cones Global",3:"Right Cones Global",4:"Center Cones Local",5:"Center Cones Global",6:"Diamond Rings Local Left",7:"Diamond Rings Local Right",8:"Diamond Rings Global",9:"Lasers Bottom Left",10:"Lasers Bottom Right",11:"Lasers Top Left",12:"Lasers Top Right",13:"Runway Lasers Left",14:"Runway Lasers Right",15:"Runway Inner Laser",16:"Spectrogram Left",17:"Spectrogram Right",18:"Runway Lasers Left Transform Z",19:"Runway Lasers Right Transform Z",20:"Window Left Pirces",21:"Window Left Aura",22:"Window Right Pieces",23:"Window Right Aura"},QueenEnvironment:{0:"Vinyls Left",1:"Vinyl Left 1",2:"Vinyl Left 2",3:"Vinyl Left 3",4:"Vinyl Left 4",5:"Vinyls Right",6:"Vinyl Right 1",7:"Vinyl Right 2",8:"Vinyl Right 3",9:"Vinyl Right 4",10:"Tunnel Rings Wrapper",11:"Distant Circular Lasers Z",12:"Distant Circular Lasers",13:"Top Circular Lasers Rot Y",14:"Top Circular Lasers",15:"Platform Lane Left",16:"Platform Lane Right",17:"Silhouette Contour"},LinkinPark2Environment:{0:"Circular Lasers Global Distant",1:"Circular Lasers Local Distant",2:"Circular Lasers Global Close",3:"Circular Lasers Local Close",4:"Tunnels Rings",5:"Big Arcs Local",6:"Laser Beams Local Left",7:"Laser Beams Local Right",8:"Floor Lasers Left",9:"Floor Lasers Right",10:"Tunnels Lights",11:"Logo",12:"Big Arcs Global",13:"Spectrograms Floor Left",14:"Spectrograms Floor Right",15:"Spectrograms Tunnel Left",16:"Spectrograms Tunnel Right",17:"Laser Beams Global Left",18:"Laser Beams Global Right"},TheRollingStonesEnvironment:{0:"Cube Local Left",1:"Cube Local Right",2:"Columns Left 01",3:"Columns Left 02",4:"Columns Left 03",5:"Columns Left 04",6:"Columns Right 01",7:"Columns Right 02",8:"Columns Right 03",9:"Columns Right 04",10:"Floor Blocks Left",11:"Floor Blocks Right",12:"Heart Local Left",13:"Heart Local Right",14:"Lasers Left 01",15:"Lasers Left 02",16:"Lasers Left 03",17:"Lasers Left 04",18:"Lasers Right 01",19:"Lasers Right 02",20:"Lasers Right 03",21:"Lasers Right 04",22:"Columns Lasers 01",23:"Columns Lasers 02",24:"Lasers Left Sphere",25:"Lasers Right Sphere",26:"Cube Global",27:"Heart Global",28:"Logo Local",29:"Logo Global",30:"Splinters",31:"Cube Rot Z Left",32:"Cube Rot Z Right",33:"Heart Rot Z Left",34:"Heart Rot Z Right",35:"Floor Side Laser Left",36:"Floor Side Laser Right",37:"Cube Lasers",38:"Splinters Global Translation",39:"Floor Below Block",40:"Floor Inner Light Left",41:"Floor Inner Light Right",42:"Logo Iridescence",43:"Logo Color",44:"Floor Side Laser Bottom Left",45:"Floor Side Laser Bottom Right"},LatticeEnvironment:{0:"Bottom Left Global",1:"Bottom Left Cube",2:"Bottom Left Radial",3:"Bottom Left Spot 1",4:"Bottom Left Spot 2",5:"Bottom Left Laser 1",6:"Bottom Left Laser 2",7:"Bottom Right Global",8:"Bottom Right Cube",9:"Bottom Right Radial",10:"Bottom Right Spot 1",11:"Bottom Right Spot 2",12:"Bottom Right Laser 1",13:"Bottom Right Laser 2",14:"Top Left Global",15:"Top Left Cube",16:"Top Left Radial",17:"Top Left Spot 1",18:"Top Left Spot 2",19:"Top Left Laser 1",20:"Top Left Laser 2",21:"Top Right Global",22:"Top Right Cube",23:"Top Right Radial",24:"Top Right Spot 1",25:"Top Right Spot 2",26:"Top Right Laser 1",27:"Top Right Laser 2",28:"Runway Diagonals",29:"Runway Outline",30:"Runway Chevron"},DaftPunkEnvironment:{0:"Tris Wall Left",1:"Tris Wall Right",2:"Lasers Top Sideset 01 L",3:"Lasers Top Sideset 02 L",4:"Lasers Top Sideset 01 R",5:"Lasers Top Sideset 02 R",6:"Lasers Bottom Sideset 01 L",7:"Lasers Bottom Sideset 02 L",8:"Lasers Bottom Sideset 01 R",9:"Lasers Bottom Sideset 02 R",10:"Lasers Top Wall L",11:"Lasers Top Wall R",12:"Lasers Bottom Wall L",13:"Lasers Bottom Wall R",14:"Orbit 1",15:"Orbit 2",16:"Orbit 3",17:"Orbit 4",18:"Runway Middle",19:"Visor 01 Spectrogram",20:"Visor 02 Spectrogram",21:"Visor 01 Text",22:"Visor 02 Text",23:"Helmet 01",24:"Helmet 02",25:"Runway Left",26:"Runway Right",27:"Background Stars",28:"Orbit 1 Star 1",29:"Orbit 1 Star 2",30:"Orbit 1 Star 3",31:"Orbit 1 Star 4",32:"Orbit 2 Star 1",33:"Orbit 2 Star 2",34:"Orbit 2 Star 3",35:"Orbit 2 Star 4",36:"Orbit 3 Star 1",37:"Orbit 3 Star 2",38:"Orbit 3 Star 3",39:"Orbit 3 Star 4",40:"Orbit 4 Star 1",41:"Orbit 4 Star 2",42:"Orbit 4 Star 3",43:"Orbit 4 Star 4",44:"Orbit 1 Stars Transform",45:"Orbit 2 Stars Transform",46:"Orbit 3 Stars Transform",47:"Orbit 4 Stars Transform",48:"Visor 02 Offset X",49:"Visor 02 Offset Y",50:"Visor 02 Padding X",51:"Visor 02 Padding Y",52:"Visor 01 Offset X",53:"Visor 01 Offset Y",54:"Visor 01 Padding X",55:"Visor 01 Padding Y"},HipHopEnvironment:{0:"Environment Side Lasers Left",1:"Environment Side Lasers Right",2:"Ceiling Lights Left",5:"Ceiling Lights Right",6:"Trains Long 1 Transforms",7:"Trains Long 1 Color",8:"Trains Long 2 Transforms",9:"Trains Long 2 Color",10:"Trains Short L Transforms",11:"Trains Short L Color",12:"Trains Short R Transforms",13:"Trains Short R Color",14:"Geo Walls",15:"Geo Roof",16:"Geo Platforms",17:"Geo Pillars Left",18:"Geo Pillars Right",19:"Environment Runway Ring",20:"Hoops L1",21:"Hoops Pieces L1",22:"Balls L1",23:"Hoops L2",24:"Hoops Pieces L2",25:"Balls L2",26:"Hoops R1",27:"Hoops Pieces R1",28:"Balls R1",29:"Hoops R2",30:"Hoops Pieces R2",31:"Balls R2",32:"Graffiti Floating Graffiti R",33:"Graffiti Floating Graffiti L",34:"Graffiti Boombox",35:"Graffiti Boombox Shards",36:"Environment Spectrogram Left",37:"Environment Spectrogram Right",38:"Trains Short L Graffiti",39:"Trains Short R Graffiti",40:"Environment Runway Lights",41:"Environment Spectrogram Y"},ColliderEnvironment:{0:"Center Blocks Local",1:"Center Blocks Global",2:"Center Blocks Inner Lasers",3:"Center Blocks Outer Lasers",4:"Center Blocks Side 01 Lasers",5:"Center Blocks Side 02 Lasers",6:"Colliders Diamonds",7:"Side Blocks Set 01 (Left) Local",8:"Side Blocks Set 02 (Right) Local",9:"Side Blocks Set 01 (Left) Global",10:"Side Blocks Set 02 (Right) Global",11:"Side Blocks Set 01 (Left) Inner Lasers",12:"Side Blocks Set 02 (Right) Inner Lasers",13:"Side Blocks Set 01 (Left) Outer Lasers",14:"Side Blocks Set 02 (Right) Outer Lasers",15:"Side Blocks Set 01 (Left) Side 01 Lasers",16:"Side Blocks Set 02 (Right) Side 01 Lasers",17:"Side Blocks Set 01 (Left) Side 02 Lasers",18:"Side Blocks Set 02 (Right) Side 02 Lasers",19:"Runway Left",20:"Runway Right",21:"Colliders Left",22:"Colliders Right",23:"Chevron Local",24:"Chevron Mask Strength",25:"Center Blocks Mask Strength",26:"Side Blocks Set 01 (Left) Mask Strength",27:"Side Blocks Set 02 (Right) Mask Strength"},BritneyEnvironment:{0:"Cubes Local Left",1:"Cubes Global Left",2:"Cubes Local Right",3:"Cubes Global Right",5:"Display Local",6:"Top Lasers Set 01 Global",7:"Top Lasers Set 01 Local",8:"Top Lasers Set 02 Global",9:"Top Lasers Set 02 Local",10:"Chevron",11:"Outer Cylinders Bottom Lasers",12:"Runway",13:"Stage Mask Offset",14:"Outer Cylinders Local",15:"Spirals Local",16:"Stage Top",17:"Stage Sides",18:"Cubes Speaker Lights L",19:"Cubes Speaker Lights R",20:"Display Mask Strength",21:"Stars Color",22:"Chevron Mask Strength"},Monstercat2Environment:{0:"Head Move",1:"Light Pillars Left",2:"Light Pillars Group Left",3:"Light Pillars Right",4:"Light Pillars Group Right",5:"Objects Screens L",6:"Objects Screens L Color",7:"Objects Screens R",8:"Objects Screens R Color",9:"Lasers Circle Global",10:"Lasers Circle",11:"Head Lights L",12:"Head Lights R",13:"Head Lights Mouth",14:"Lasers Vertical End Left",15:"Lasers Vertical End Right",16:"Objects Screens Runway Rings L",17:"Objects Screens Runway Rings R",18:"Objects Teeth",19:"Lasers Vertical Side Left",20:"Lasers Vertical Side Right",21:"Screens Small Left 1 Color",22:"Screens Small Left 1",23:"Screens Small Left 1 Global",24:"Screens Small Right 1 Color",25:"Screens Small Right 1",26:"Screens Small Right 1 Global",27:"Screens Small Left 2 Color",28:"Screens Small Left 2",29:"Screens Small Left 2 Global",30:"Screens Small Right 2 Color",31:"Screens Small Right 2",32:"Screens Small Right 2 Global"},MetallicaEnvironment:{0:"Chevron",1:"Pillars L Global",2:"Pillars R Global",3:"Center Stage Left",4:"Center Stage Right",5:"Center Stage Mid",6:"Runway",7:"Stage BG Lasers Left",8:"Stage BG Lasers Right",9:"Pillars L Lasers",10:"Pillars R Lasers",11:"Center Stage Front Lasers",12:"Pillars L Lighting Bolts",13:"Pillars R Lighting Bolts",14:"Pillars L Construction Light",15:"Pillars R Construction Light",16:"BG Lighting Bolts Left",17:"BG Construction Point Light Left",18:"BG Lighting Bolts Right",19:"BG Construction Point Light Right",20:"Effects Lighting A",21:"Effects Lighting B",22:"Pillars L Local",23:"Pillars R Local",24:"Runway Lasers Left",25:"Runway Lasers Right",26:"Scaffoldings Top",27:"Runway Fire Burst L",28:"Runway Fire Burst R",29:"Infinite Lasers Left",30:"Infinite Lasers Right",31:"Scaffoldings Back",32:"Effect Stars",33:"Center Stage Point Lights",34:"Pillars L Point Lights",35:"Pillars R Point Lights",36:"Scaffoldings Far Left",37:"Scaffoldings Far Right",38:"Runway Fire Continuous L",39:"Runway Fire Continuous R",40:"Pillars L Column Global",41:"Pillars R Column Global",42:"Pillars L Scratches",43:"Pillars R Scratches",44:"Runway / Chevron Mask Strength"}};function gv(e,t){return bv[t]?.[e]||"Unknown"}function vv(e,t,i="DefaultEnvironment",n=2){const o=Tn[i]?.[0]??Tn.DefaultEnvironment[0],r={};for(let a=o.length-1;a>=0;a--)r[o[a]]={total:0,chroma:0,chromaOld:0};const s=n>=3?b0:h0;r[5]={total:t.length,chroma:0,chromaOld:0};for(let a=e.length-1;a>=0;a--)fa(e[a].type)&&(r[e[a].type]||(r[e[a].type]={total:0,chroma:0,chromaOld:0}),r[e[a].type].total++,s(e[a])&&r[e[a].type].chroma++,pa(e[a].value)&&r[e[a].type].chromaOld++);return r}function Go(e,t="DefaultEnvironment"){const i=Tn[t]?.[1]??Tn.DefaultEnvironment[1],n={};for(let o=i.length-1;o>=0;o--)n[i[o]]={groups:0,boxes:0,bases:0};for(let o=e.length-1;o>=0;o--)n[e[o].id]||(n[e[o].id]={groups:0,boxes:0,bases:0}),n[e[o].id].groups++,n[e[o].id].boxes+=e[o].boxes.length,n[e[o].id].bases+=e[o].boxes.reduce((r,s)=>r+s.events.length,0);return n}function xs(e,t=2){const i={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}},n=t>=3?pc:fc,o=t>=3?dc:mc;for(let r=e.length-1;r>=0;r--){if(e[r].color!==0&&e[r].color!==1)continue;const s=e[r].color?"blue":"red";i[s].total++,n(e[r])&&i[s].chroma++,o(e[r])&&i[s].noodleExtensions++,vc(e[r])&&i[s].mappingExtensions++}return i}function Ev(e,t=2){const i={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},n=t>=3?pc:fc,o=t>=3?dc:mc;for(let r=e.length-1;r>=0;r--)i.total++,n(e[r])&&i.chroma++,o(e[r])&&i.noodleExtensions++,gc(e[r])&&i.mappingExtensions++;return i}function jo(e,t){return e.filter(i=>i.posX===t).length}function yv(e,t){return e.filter(i=>i.posY===t).length}function _v(e,t,i){return e.filter(n=>n.posX===t&&n.posY===i).length}function Dv(e,t){return e.filter(i=>i.direction===t).length}function Tv(e,t=2){const i={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0},n=t>=3?g0:p0,o=t>=3?v0:d0,r=t>=3?bc:hc;for(let s=e.length-1;s>-1;s--)i.total++,Tr(e[s])&&i.interactive++,n(e[s])&&i.chroma++,o(e[s])&&i.noodleExtensions++,r(e[s])&&i.mappingExtensions++;return i}function Sv(e){return Math.max(...e.map(t=>t.ebpm),0)}function wv(e){return Math.max(...e.map(t=>t.ebpmSwing),0)}function Cv(e,t){const i=[];let n=0,o=0,r,s;const a={},l={},u={0:[],1:[]};for(const f of e)r=0,s=Number.MAX_SAFE_INTEGER,l[f.color]?li(f,l[f.color],t,u[f.color])&&(r=Su(u[f.color],t),s=wu(u[f.color],t),r>0&&s!==1/0||(r=0,s=0),o=Tu(f,a[f.color],t),n=Tu(f,l[f.color],t),i.push({time:t.toRealTime(a[f.color].time),duration:t.toRealTime(l[f.color].time)-t.toRealTime(a[f.color].time),data:u[f.color],ebpm:n,ebpmSwing:o,maxSpeed:s,minSpeed:r}),a[f.color]=f,u[f.color]=[]):a[f.color]=f,l[f.color]=f,u[f.color].push(f);for(let f=0;f<2;f++)l[f]&&(r=Su(u[f],t),s=wu(u[f],t),r>0&&s!==1/0||(r=0,s=0),i.push({time:t.toRealTime(a[f].time),duration:t.toRealTime(l[f].time)-t.toRealTime(a[f].time),data:u[f],ebpm:n,ebpmSwing:o,maxSpeed:s,minSpeed:r}));return i}function li(e,t,i,n){if(n&&n.length>0){if(i.toRealTime(t.time)+.005<i.toRealTime(e.time)&&e.direction!==z.ANY){for(const o of n)if(o.direction!==z.ANY&&go(e,o,90,!1))return!0}for(const o of n)if(Xn(e,o))return!0}return da(e,t)&&i.toRealTime(e.time)-i.toRealTime(t.time)>.08||i.toRealTime(e.time)-i.toRealTime(t.time)>.07}function Tu(e,t,i){return i.bpm/(i.toBeatTime(i.toRealTime(e.time)-i.toRealTime(t.time),!1)*2)}function Su(e,t){let i=!1,n=!1,o=0;const r=Math.max(...e.map((s,a)=>{if(a===0)return 0;const l=ln(e[a],e[a-1])||1;return($n(e[a],e[a-1])||Fn(e[a],e[a-1]))&&!i&&(i=!0,o=(t.toRealTime(e[a].time)-t.toRealTime(e[a-1].time))/l),n=br(e[a],e[a-1])||gr(e[a],e[a-1])||n,(t.toRealTime(e[a].time)-t.toRealTime(e[a-1].time))/l}));return i&&n?o:r}function wu(e,t){let i=!1,n=!1,o=Number.MAX_SAFE_INTEGER;const r=Math.min(...e.map((s,a)=>{if(a===0)return Number.MAX_SAFE_INTEGER;const l=ln(e[a],e[a-1])||1;return($n(e[a],e[a-1])||Fn(e[a],e[a-1]))&&!i&&(i=!0,o=(t.toRealTime(e[a].time)-t.toRealTime(e[a-1].time))/l),n=br(e[a],e[a-1])||gr(e[a],e[a-1])||n,console.log(t.toRealTime(e[a].time)-t.toRealTime(e[a-1].time),l),(t.toRealTime(e[a].time)-t.toRealTime(e[a-1].time))/l}));return i&&n?o:r}function Rv(e,t,i){const n={left:new Array(Math.floor(t+1)).fill(0),right:new Array(Math.floor(t+1)).fill(0)};let o,r;for(const s of e){const a=i.toRealTime(s.time);s.color===0&&(o?li(s,o,i)&&n.left[Math.floor(a)]++:n.left[Math.floor(a)]++,o=s),s.color===1&&(r?li(s,r,i)&&n.right[Math.floor(a)]++:n.right[Math.floor(a)]++,r=s)}return n}function Os(e,t){if(!e.length)return 0;if(e.length<t)return e.reduce((o,r)=>o+r)/e.length;let i=e.slice(0,t).reduce((o,r)=>o+r),n=i;for(let o=0;o<e.length-t;o++)i=i-e[o]+e[o+t],n=Math.max(n,i);return n/t}function Lv(e,t,i,n){const r={characteristic:i,difficulty:n,red:{perSecond:0,peak:0,median:0,total:0},blue:{perSecond:0,peak:0,median:0,total:0},total:{perSecond:0,peak:0,median:0,total:0},container:Cv(e.difficulty.colorNotes,t)},s=Math.max(t.toRealTime(Vn(e)-Da(e)),0),a=Math.max(t.toRealTime(Vn(e)),0),l=Rv(e.difficulty.colorNotes,a,t),u=l.left.map((g,E)=>g+l.right[E]);if(u.reduce((g,E)=>g+E)===0)return r;const f=[],b=[],m=[];for(let g=0,E=Math.ceil(u.length/10);g<E;g++){const v=g*10;let y=10;y+v>u.length&&(y=u.length-v);const _=l.left.slice(v,v+y),D=l.right.slice(v,v+y),C=u.slice(v,v+y);f.push(_.reduce((O,x)=>O+x)/y),b.push(D.reduce((O,x)=>O+x)/y),m.push(C.reduce((O,x)=>O+x)/y)}return r.red.total=l.left.reduce((g,E)=>g+E),r.red.perSecond=l.left.reduce((g,E)=>g+E)/s,r.red.peak=Os(l.left,10),r.red.median=Es(f),r.blue.total=l.right.reduce((g,E)=>g+E),r.blue.perSecond=l.right.reduce((g,E)=>g+E)/s,r.blue.peak=Os(l.right,10),r.blue.median=Es(b),r.total.total=r.red.total+r.blue.total,r.total.perSecond=u.reduce((g,E)=>g+E)/s,r.total.peak=Os(u,10),r.total.median=Es(m),r}function Nv(e,t){let i=0,n;for(const o of e){const r=o.total.perSecond;if(!r)continue;let s;if(i&&(s=Math.abs(1-r/i)*100),s&&i>t&&s>40)return{result:o,comparedTo:n};n=o,i=r}return null}function xv(e,t){let i=0,n;for(const o of e){const r=o.total.perSecond;if(!r)continue;let s;if(i&&(s=Math.abs(1-r/i)*100),s&&i>t&&s<10)return{result:o,comparedTo:n};n=o,i=r}return null}function Ov(e){let t=0,i=Number.MAX_SAFE_INTEGER;return e.forEach(n=>{const o=n.total.perSecond;o>0&&(t=Math.max(t,o),i=Math.min(i,o))}),t||t&&i?(1-i/t)*100:0}function Cu(e){return Math.min(...e.map(t=>t.total.perSecond),Number.MAX_SAFE_INTEGER)}function Ru(e){return Math.max(...e.map(t=>t.total.perSecond),0)}function Bv(e){return Math.max(...e.map(t=>t.minSpeed),0)}function kv(e){const t=e.map(i=>i.maxSpeed).filter(i=>i!==0);return t.length?Math.min(...t):0}function Bs(e,t){if(e==null||!e.length){St(ge.htmlTableCustomEvents);return}const i=e.map((n,o)=>{let r=n.b??n._time??0,s;t&&(r=t.adjustTime(r),s=t.toRealTime(r));const a=[],l=n.d??n._data;if(!l)return`Error parsing customEvents[${o}]`;for(const b in l){if(b=="_duration"||b=="_easing"||b=="_track"||b=="duration"||b=="easing"||b=="track")continue;const m=ra[b];l[b]!=null&&a.push(m)}const u=n.t??n._type,f=n.d?.track??n._data?._track;return`${$(r,ue.props.rounding)}${s?" | "+yi(s):""} -- ${u} -> [${a.join("")}]${f?`(${f})`:""}`});wt(ge.htmlTableCustomEvents,i,"customEvents")}function ks(e){if(e==null||!e.length){St(ge.htmlTableEnvironmentEnhancement);return}const t=e.map((i,n)=>{const o=[];if(!i.id&&!i.geometry&&!i._id&&!i._geometry)return`Error parsing environment[${n}]`;for(const l in i){if(l=="lookupMethod"||l=="id"||l=="geometry"||l=="_lookupMethod"||l=="_id"||l=="_geometry")continue;const u=oa[l];i[l]!=null&&o.push(u)}const r=i.geometry||i._geometry,s=i.track||i._track,a=i.id||i._id;return`${r?"Geometry":i.lookupMethod||i._lookupMethod} [${o.join("")}]${s?`(${s})`:""} -> ${r?r.type||r._type:a}`});wt(ge.htmlTableEnvironmentEnhancement,t,"environments")}function As(e){if(e==null){St(ge.htmlTableVersion);return}wt(ge.htmlTableVersion,e)}function Lu(e){if(e==null||!e.length){St(ge.htmlTableMappers);return}let t=e.join(", ");wt(ge.htmlTableMappers,t)}function Nu(e){if(e==null||!e.length){St(ge.htmlTableLighters);return}let t=e.join(", ");wt(ge.htmlTableLighters,t)}function Ps(e){if(e==null){St(ge.htmlTableEnvironmentId);return}let t=(ia[e]||"Unknown")+" Environment";ia[e]||(t+=` (${e})`),wt(ge.htmlTableEnvironmentId,t)}function Ms(e){if(e==null){St(ge.htmlTableTimeSpend);return}wt(ge.htmlTableTimeSpend,Ed(e))}function Is(e){if(e==null||!e.length){St(ge.htmlTableRequirements);return}wt(ge.htmlTableRequirements,e,"requirements")}function $s(e){if(e==null||!e.length){St(ge.htmlTableSuggestions);return}wt(ge.htmlTableSuggestions,e,"suggestions")}function Fs(e){if(e==null||!e.length){St(ge.htmlTableInformation);return}wt(ge.htmlTableInformation,e,"informations")}function Vs(e){if(e==null||!e.length){St(ge.htmlTableWarnings);return}wt(ge.htmlTableWarnings,e,"warnings")}function zs(e){if(e==null){St(ge.htmlTablePointDefinitions);return}const t=[];if(Array.isArray(e))for(const i of e)i||t.push("Error parsing pointDefinitions"),t.push(`${i._name} -- ${i._points.length} point${i._points.length>1?"s":""}`);else{e=e;for(const i in e){e[i]||t.push(`Error parsing pointDefinitions[${i}]`);const n=e[i];Array.isArray(n)||t.push(`Error parsing pointDefinitions[${i}]`),t.push(`${i} -- ${n.length} point${n.length>1?"s":""}`)}}wt(ge.htmlTablePointDefinitions,t,"pointDefinitions")}const gn=class gn{static clear(){gn.data={info:null,beatmaps:[],contributors:[],analysis:null,duration:null};for(const t in gn.flag)gn.flag[t]=!1}};gn.data={info:null,beatmaps:[],contributors:[],analysis:null,duration:null},gn.flag={nested:!1,info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1};let be=gn;function Gs(e,t){if(!e&&!t){St(ge.htmlTablePlayTime);return}e||=0,t||=0,wt(ge.htmlTablePlayTime,`${yi(e)} to ${yi(t)}${be.data.duration?` -- [ ${yi(t-e)} / ${yi(be.data.duration)} ]`:""}`)}function js(e){if(!e||!e.saberLeftColor&&!e.saberRightColor&&!e.environment0Color&&!e.environment0ColorBoost&&!e.environment1Color&&!e.environment1ColorBoost&&!e.environmentWColor&&!e.environmentWColorBoost&&!e.obstaclesColor){St(ge.htmlTableColorScheme);return}const t={};t.saberLeftColor=ke(e.saberLeftColor),t.saberRightColor=ke(e.saberRightColor),t.environment0Color=ke(e.environment0Color),t.environment1Color=ke(e.environment1Color),t.environment0ColorBoost=ke(e.environment0ColorBoost),t.environment1ColorBoost=ke(e.environment1ColorBoost),t.obstaclesColor=ke(e.obstaclesColor),e.environmentWColor&&(t.environmentWColor=ke(e.environmentWColor)),e.environmentWColorBoost&&(t.environmentWColorBoost=ke(e.environmentWColorBoost));const i=[];for(const n in t){if(!t[n])continue;const o=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div");o.className="info__color",r.className="info__color-dot",r.style.backgroundColor=t[n]||"#000000",s.className="info__color-text info__color-text--monospace",s.textContent=`${t[n]}`,a.className="info__color-text",a.textContent=` -- ${Vd[n]}`,o.appendChild(r),o.appendChild(s),o.appendChild(a),i.push(o)}wt(ge.htmlTableColorScheme,i)}const _t=class _t{static init(){ge.init(),Me.init()}static reset(){Me.reset(),As(),Lu(),Nu(),Ps(),Gs(),Ms(),js(),Ns(),Is(),$s(),Fs(),Vs(),Rs(),Ls(),ks(),zs(),Bs()}static setInfo(t){de.setSongName(t.song.title),de.setSongSubname(t.song.subTitle),de.setSongAuthor(t.song.author),de.setSongBPM(t.audio.bpm);const i=new Set,n=new Set,o=new Set([t.environmentBase.normal,t.environmentBase.allDirections]);t.difficulties.forEach(r=>{r.authors.mappers.forEach(s=>i.add(s)),r.authors.lighters.forEach(s=>n.add(s)),o.add(t.environmentNames.at(r.environmentId))}),Me.setLevelAuthor([...i],[...n]),Me.setEnvironment([...o].filter(r=>r)),Me.setEditors(t.customData._editors)}static setDiffInfoTable(t,i){As(i.rawData._version||i.rawData.version||"Unknown"),Lu(i.info.authors.mappers),Nu(i.info.authors.lighters),Ps(t.environmentNames.at(i.info.environmentId)),js(t.colorSchemes.at(i.info.colorSchemeId)),Ns(i.info.customData),Is(i.info.customData._requirements),$s(i.info.customData._suggestions),Fs(i.info.customData._information),Vs(i.info.customData._warnings);const n=i.timeProcessor;Ms(i.data.difficulty.customData.time??i.data.difficulty.customData._time),Rs(i.data.difficulty.customData.bookmarks??i.data.difficulty.customData._bookmarks,n),Ls(n),ks(i.data.difficulty.customData.environment??i.data.difficulty.customData._environment),zs(i.data.difficulty.customData.pointDefinitions??i.data.difficulty.customData._pointDefinitions),Bs(i.data.difficulty.customData.customEvents??i.data.difficulty.customData._customEvents,n),Gs(i.timeProcessor.toRealTime(Da(i.data)),i.timeProcessor.toRealTime(Vn(i.data)))}};_t.setBookmarks=Rs,_t.setBPMChanges=Ls,_t.setColorScheme=js,_t.setCustomColor=Ns,_t.setCustomEvents=Bs,_t.setEnvironmentEnhancement=ks,_t.setEnvironmentId=Ps,_t.setInformation=Fs,_t.setPlayTime=Gs,_t.setPointDefinitions=zs,_t.setRequirements=Is,_t.setSuggestions=$s,_t.setTimeSpend=Ms,_t.setVersion=As,_t.setWarnings=Vs;let Sn=_t;var ve=(e=>(e[e.OBJECT=-1]="OBJECT",e[e.COLOR=0]="COLOR",e[e.BOMB=1]="BOMB",e[e.ARC=2]="ARC",e[e.CHAIN=3]="CHAIN",e))(ve||{}),Ee=(e=>(e[e.NOTE=0]="NOTE",e[e.EVENT=1]="EVENT",e[e.OBSTACLE=2]="OBSTACLE",e[e.OTHER=3]="OTHER",e[e.GENERAL=4]="GENERAL",e))(Ee||{}),te=(e=>(e[e.STRING=0]="STRING",e[e.NUMBER=1]="NUMBER",e[e.TIME=2]="TIME",e[e.HTML=3]="HTML",e))(te||{}),re=(e=>(e[e.INFO=0]="INFO",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR",e[e.RANK=3]="RANK",e))(re||{}),Re=(e=>(e[e.APRIL_FOOLS=0]="APRIL_FOOLS",e[e.GENERAL_ZIP=1]="GENERAL_ZIP",e[e.GENERAL_AUDIO=2]="GENERAL_AUDIO",e[e.GENERAL_COVER_IMAGE=3]="GENERAL_COVER_IMAGE",e[e.GENERAL_PREVIEW_TIME=4]="GENERAL_PREVIEW_TIME",e[e.GENERAL_PROGRESSION=5]="GENERAL_PROGRESSION",e[e.OTHERS_INVALID_OBJECT=6]="OTHERS_INVALID_OBJECT",e[e.OTHERS_OUTSIDE_PLAYABLE=7]="OTHERS_OUTSIDE_PLAYABLE",e[e.OTHERS_HOT_START=8]="OTHERS_HOT_START",e[e.OTHERS_NJS=9]="OTHERS_NJS",e[e.OTHERS_DIFFICULTY_LABEL=10]="OTHERS_DIFFICULTY_LABEL",e[e.EVENTS_INSUFFICIENT_LIGHT=11]="EVENTS_INSUFFICIENT_LIGHT",e[e.EVENTS_INVALID_EVENT_BOX=12]="EVENTS_INVALID_EVENT_BOX",e[e.EVENTS_UNLIT_BOMB=13]="EVENTS_UNLIT_BOMB",e[e.NOTES_EFFECTIVE_BPM=14]="NOTES_EFFECTIVE_BPM",e[e.NOTES_ACCEPTABLE_PRECISION=15]="NOTES_ACCEPTABLE_PRECISION",e[e.NOTES_PARITY=16]="NOTES_PARITY",e[e.NOTES_VARY_SWING=17]="NOTES_VARY_SWING",e[e.NOTES_SLOW_SLIDER=18]="NOTES_SLOW_SLIDER",e[e.NOTES_INLINE_ANGLE=19]="NOTES_INLINE_ANGLE",e[e.NOTES_SHRADO_ANGLE=20]="NOTES_SHRADO_ANGLE",e[e.NOTES_SPEED_PAUSE=21]="NOTES_SPEED_PAUSE",e[e.NOTES_IMPROPER_ARC=22]="NOTES_IMPROPER_ARC",e[e.NOTES_IMPROPER_CHAIN=23]="NOTES_IMPROPER_CHAIN",e[e.NOTES_IMPROPER_WINDOW=24]="NOTES_IMPROPER_WINDOW",e[e.NOTES_HITBOX_STAIR=25]="NOTES_HITBOX_STAIR",e[e.NOTES_HITBOX_REVERSE_STAIR=26]="NOTES_HITBOX_REVERSE_STAIR",e[e.NOTES_HITBOX_INLINE=27]="NOTES_HITBOX_INLINE",e[e.NOTES_HITBOX_PATH=28]="NOTES_HITBOX_PATH",e[e.NOTES_PARALLEL_NOTES=29]="NOTES_PARALLEL_NOTES",e[e.NOTES_HANDCLAP=30]="NOTES_HANDCLAP",e[e.NOTES_HAMMER_HIT=31]="NOTES_HAMMER_HIT",e[e.NOTES_ANGLE_OFFSET=32]="NOTES_ANGLE_OFFSET",e[e.NOTES_ONE_SABER=33]="NOTES_ONE_SABER",e[e.NOTES_EXCESSIVE_DOUBLE=34]="NOTES_EXCESSIVE_DOUBLE",e[e.NOTES_COLOR_CHECK=35]="NOTES_COLOR_CHECK",e[e.NOTES_STACKED_NOTE=36]="NOTES_STACKED_NOTE",e[e.NOTES_DOUBLE_DIRECTIONAL=37]="NOTES_DOUBLE_DIRECTIONAL",e[e.NOTES_VISION_BLOCK=38]="NOTES_VISION_BLOCK",e[e.OBSTACLES_SHORT=39]="OBSTACLES_SHORT",e[e.OBSTACLES_CENTER=40]="OBSTACLES_CENTER",e[e.OBSTACLES_ZERO=41]="OBSTACLES_ZERO",e[e.OBSTACLES_NEGATIVE=42]="OBSTACLES_NEGATIVE",e[e.OBSTACLES_RANKABLE=43]="OBSTACLES_RANKABLE",e))(Re||{}),Le=(e=>(e[e.APRIL_FOOLS=0]="APRIL_FOOLS",e[e.GENERAL_ZIP=1]="GENERAL_ZIP",e[e.GENERAL_AUDIO=2]="GENERAL_AUDIO",e[e.GENERAL_COVER_IMAGE=3]="GENERAL_COVER_IMAGE",e[e.GENERAL_PREVIEW_TIME=4]="GENERAL_PREVIEW_TIME",e[e.GENERAL_PROGRESSION=5]="GENERAL_PROGRESSION",e[e.OTHERS_INVALID_OBJECT=6]="OTHERS_INVALID_OBJECT",e[e.OTHERS_OUTSIDE_PLAYABLE=7]="OTHERS_OUTSIDE_PLAYABLE",e[e.OTHERS_HOT_START=8]="OTHERS_HOT_START",e[e.OTHERS_NJS=9]="OTHERS_NJS",e[e.OTHERS_DIFFICULTY_LABEL=10]="OTHERS_DIFFICULTY_LABEL",e[e.EVENTS_INSUFFICIENT_LIGHT=11]="EVENTS_INSUFFICIENT_LIGHT",e[e.EVENTS_INVALID_EVENT_BOX=12]="EVENTS_INVALID_EVENT_BOX",e[e.EVENTS_UNLIT_BOMB=13]="EVENTS_UNLIT_BOMB",e[e.NOTES_ONE_SABER=14]="NOTES_ONE_SABER",e[e.NOTES_EXCESSIVE_DOUBLE=15]="NOTES_EXCESSIVE_DOUBLE",e[e.NOTES_COLOR_CHECK=16]="NOTES_COLOR_CHECK",e[e.NOTES_EFFECTIVE_BPM=17]="NOTES_EFFECTIVE_BPM",e[e.NOTES_ACCEPTABLE_PRECISION=18]="NOTES_ACCEPTABLE_PRECISION",e[e.NOTES_PARITY=19]="NOTES_PARITY",e[e.NOTES_VARY_SWING=20]="NOTES_VARY_SWING",e[e.NOTES_SLOW_SLIDER=21]="NOTES_SLOW_SLIDER",e[e.NOTES_INLINE_ANGLE=22]="NOTES_INLINE_ANGLE",e[e.NOTES_SHRADO_ANGLE=23]="NOTES_SHRADO_ANGLE",e[e.NOTES_SPEED_PAUSE=24]="NOTES_SPEED_PAUSE",e[e.NOTES_IMPROPER_ARC=25]="NOTES_IMPROPER_ARC",e[e.NOTES_IMPROPER_CHAIN=26]="NOTES_IMPROPER_CHAIN",e[e.NOTES_IMPROPER_WINDOW=27]="NOTES_IMPROPER_WINDOW",e[e.NOTES_HITBOX_STAIR=28]="NOTES_HITBOX_STAIR",e[e.NOTES_HITBOX_REVERSE_STAIR=29]="NOTES_HITBOX_REVERSE_STAIR",e[e.NOTES_HITBOX_INLINE=30]="NOTES_HITBOX_INLINE",e[e.NOTES_HITBOX_PATH=31]="NOTES_HITBOX_PATH",e[e.NOTES_PARALLEL_NOTES=32]="NOTES_PARALLEL_NOTES",e[e.NOTES_HANDCLAP=33]="NOTES_HANDCLAP",e[e.NOTES_HAMMER_HIT=34]="NOTES_HAMMER_HIT",e[e.NOTES_ANGLE_OFFSET=35]="NOTES_ANGLE_OFFSET",e[e.NOTES_STACKED_NOTE=36]="NOTES_STACKED_NOTE",e[e.NOTES_DOUBLE_DIRECTIONAL=37]="NOTES_DOUBLE_DIRECTIONAL",e[e.NOTES_VISION_BLOCK=38]="NOTES_VISION_BLOCK",e[e.OBSTACLES_SHORT=39]="OBSTACLES_SHORT",e[e.OBSTACLES_CENTER=40]="OBSTACLES_CENTER",e[e.OBSTACLES_ZERO=41]="OBSTACLES_ZERO",e[e.OBSTACLES_NEGATIVE=42]="OBSTACLES_NEGATIVE",e[e.OBSTACLES_RANKABLE=43]="OBSTACLES_RANKABLE",e))(Le||{});const Av="April Fools",Pv="xdd.",Mv=!0,Yc={name:Av,description:Pv,type:Ee.GENERAL,order:{input:Re.APRIL_FOOLS,output:Le.APRIL_FOOLS},input:{params:{enabled:Mv}},run:Iv};function Iv(e){const t=new Date("01 April 1984"),i=new Date,n=t.getDate()===i.getDate()&&t.getMonth()===i.getMonth();if(!ue.props.aprilFooled&&n){const o=document.createElement("div"),r=document.createElement("a");return r.text="this link for more info.",r.href="https://youtu.be/dQw4w9WgXcQ",r.addEventListener("click",function(){ue.props.aprilFooled=1,ue.save()}),o.innerHTML='<b><span title="Info: no action necessary, take note."> ⚠️ </span>AI generated content detected:</b> this may violate TOS, please refer to ',o.append(r),[{type:te.HTML,label:"",value:[o]}]}return[]}let Wo=0;class G{static createBlock(...t){const i=document.createElement("div");for(const n of t)if(Array.isArray(n))for(const o of n)i.append(o);else i.appendChild(n);return i}static createText(t,i,n){const o=`input-${Wo++}`,r=document.createElement("input"),s=document.createElement("label");return r.id="input__gen-"+o,r.className="input-toggle input--small",r.type="text",r.value=n,r.addEventListener("change",t),i&&(s.textContent=i,s.htmlFor="input__gen-"+o),[r,s]}static createNumber(t,i,n,o,r,s){const a=`input-${Wo++}`,l=document.createElement("input"),u=document.createElement("label");return l.id="input__gen-"+a,l.className="input-toggle input--small",l.type="text",l.value=n.toString(),l.addEventListener("change",t),i&&(u.textContent=i,u.htmlFor="input__gen-"+a),typeof o=="number"&&(l.min=o.toString()),typeof r=="number"&&(l.max=r.toString()),typeof s=="number"&&(l.step=s.toString()),[u,l]}static createCheckbox(t,i,n,o){const r=`input-${Wo++}`,s=document.createElement("input"),a=document.createElement("label");return a.textContent=" "+i,a.title=n,a.htmlFor="input__gen-"+r,s.id="input__gen-"+r,s.className="input-toggle",s.type="checkbox",s.checked=o,s.addEventListener("change",t),[s,a]}static createRadio(t,i,n,o,r){const s=`input-${Wo++}`,a=document.createElement("input"),l=document.createElement("label");return l.textContent=i,l.htmlFor="input__gen-"+s,a.id="input__gen-"+s,a.name=n,a.className="input-toggle",a.type="radio",a.checked=r,a.value=o,a.addEventListener("change",t),[l,a]}}const Xc="Audio Duration",qc="For ranking purpose, check for audio duration.",Kc=!0,[Jc,$v]=G.createCheckbox(function(){zr.input.params.enabled=this.checked},Xc,qc,Kc);function Fv(){Jc.checked=zr.input.params.enabled}const zr={name:Xc,description:qc,type:Ee.GENERAL,order:{input:Re.GENERAL_AUDIO,output:Le.GENERAL_AUDIO},input:{params:{enabled:Kc},ui:()=>G.createBlock(Jc,$v),update:Fv},run:Vv};function Vv(e){const t=e.audioDuration;return t&&t<20?[{type:te.STRING,label:"Unrankable audio length",value:`too short (${yi(t)}s)`,status:re.RANK}]:be.flag.audio?[]:[{type:te.STRING,label:"No audio",value:ue.props.load.audio?"could not be loaded or not found":"no audio mode is enabled"}]}const Zc="Validate Cover Image",Qc="Validate cover image.",Uc=!0,[ef,zv]=G.createCheckbox(function(){Gr.input.params.enabled=this.checked},Zc,Qc,Uc);function Gv(){ef.checked=Gr.input.params.enabled}const Gr={name:Zc,description:Qc,type:Ee.GENERAL,order:{input:Re.GENERAL_COVER_IMAGE,output:Le.GENERAL_COVER_IMAGE},input:{params:{enabled:Uc},ui:()=>G.createBlock(ef,zv),update:Gv},run:jv};function jv(){const e=new Image,t=de.getCoverImage(),i=[];return be.flag.coverImage&&t!==null?(e.src=t,e.width!==e.height&&i.push({type:te.STRING,label:"Cover image is not square",value:"resize to fit square",status:re.ERROR}),(e.width<256||e.height<256)&&i.push({type:te.STRING,label:"Cover image is too small",value:"require at least 256x256",status:re.ERROR})):i.push({type:te.STRING,label:"No cover image",value:ue.props.load.imageCover?"could not be loaded or found":"no cover image option is enabled"}),i}const tf="Preview Time",nf="Warn default editor preview time.",of=!0,[rf,Wv]=G.createCheckbox(function(){jr.input.params.enabled=this.checked},tf,nf,of);function Hv(){rf.checked=jr.input.params.enabled}const jr={name:tf,description:nf,type:Ee.GENERAL,order:{input:Re.GENERAL_PREVIEW_TIME,output:Le.GENERAL_PREVIEW_TIME},input:{params:{enabled:of},ui:()=>G.createBlock(rf,Wv),update:Hv},run:Yv};function Yv(e){const{previewStartTime:t,previewDuration:i}=e.info.audio;return t===12&&i===10?[{type:te.STRING,label:"Default preview time",value:"strongly recommended to set for audience's 1st impression",status:re.INFO}]:[]}const sf="Difficulty Progression",af="For ranking purpose, check difficuly progression to fit rankability criteria.",lf=!0,sa={"Expert+":null,ExpertPlus:null,Expert:null,Hard:null,Normal:null,Easy:null},uf=document.createElement("ul"),cf=["ExpertPlus","Expert","Hard","Normal","Easy"];for(const e of cf){const[t,i]=G.createCheckbox(function(){wn.input.params[e]=this.checked},nn[e],`Toggle check progression for Standard ${nn[e]}`,!0);sa[e]=t,uf.appendChild(G.createBlock(t,i))}const[ff,Xv]=G.createCheckbox(function(){wn.input.params.enabled=this.checked},sf,af,lf);function qv(){ff.checked=wn.input.params.enabled;for(const e of cf)sa[e]&&(sa[e].checked=wn.input.params[e])}const wn={name:sf,description:af,type:Ee.GENERAL,order:{input:Re.GENERAL_PROGRESSION,output:Le.GENERAL_PROGRESSION},input:{params:{enabled:lf,"Expert+":!0,ExpertPlus:!0,Expert:!0,Hard:!0,Normal:!0,Easy:!0},ui:()=>G.createBlock(G.createBlock(ff,Xv),uf),update:qv},run:Kv};function Kv(e){const t=e.audioDuration;if(!t)return[];const i=be.data.beatmaps.filter(a=>a.info.characteristic==="Standard").map(a=>a.swingAnalysis).filter(a=>wn.input.params[a.difficulty]&&a.total.total>0).sort((a,l)=>l.total.perSecond-a.total.perSecond);if(!i.length)return[];const n=Math.max(t<120?3.2:t<240?4.2:5.2,$(Ru(i)*.4,2)),o=[];t<360&&Cu(i)>n&&(i.forEach(a=>a.total.perSecond),o.push({type:te.STRING,label:`Minimum SPS not met (<${n})`,value:`lowest SPS is ${$(Cu(i),2)}, ${$(Ov(i),2)}% drop from highest SPS (${$(Ru(i),2)})`,status:re.RANK}));const r=Nv(i,n),s=xv(i,n);return r&&t<360&&o.push({type:te.STRING,label:"Violates progression",value:`${nn[r.result.difficulty]} exceeded 40% SPS drop, ${$(r.result.total.perSecond,2)} from ${$(r.comparedTo?.total?.perSecond||0,2)} ${nn[r.comparedTo.difficulty]}, acceptable range (${$((r.comparedTo?.total?.perSecond||0)*.6,2)}-${$((r.comparedTo?.total.perSecond||0)*.9,2)})`,status:re.RANK}),s&&t<360&&o.push({type:te.STRING,label:"Violates progression",value:`${nn[s.result.difficulty]} has less than 10% SPS drop, ${$(s.result.total.perSecond,2)} from ${$(s.comparedTo?.total.perSecond||0,2)} ${nn[s.comparedTo.difficulty]}, acceptable range (${$((s.comparedTo?.total.perSecond||0)*.6,2)}-${$((s.comparedTo?.total.perSecond||0)*.9,2)})`,status:re.RANK}),o}const mf="Beatmap ZIP",hf="Entrypoint not in root directory.",pf=!0,[df,Jv]=G.createCheckbox(function(){Wr.input.params.enabled=this.checked},mf,hf,pf);function Zv(){df.checked=Wr.input.params.enabled}const Wr={name:mf,description:hf,type:Ee.GENERAL,order:{input:Re.GENERAL_ZIP,output:Le.GENERAL_ZIP},input:{params:{enabled:pf},ui:()=>G.createBlock(df,Jv),update:Zv},run:Qv};function Qv(e){return be.flag.nested?[{status:re.ERROR,label:"Beatmap in folder ZIP",type:te.STRING,value:"Info file and the rest should be in the root of zip file."}]:[]}const bf=Object.freeze(Object.defineProperty({__proto__:null,aprilFools:Yc,audio:zr,coverImage:Gr,previewTime:jr,progression:wn,zip:Wr},Symbol.toStringTag,{value:"Module"}));var L=(e=>(e.CALCULATED="__mapcheck_calculated",e.SECOND_TIME="__mapcheck_secondtime",e.BEAT_TIME="__mapcheck_beattime",e.DURATION_SECOND_TIME="__mapcheck_duration_secondtime",e.DURATION_BEAT_TIME="__mapcheck_duration_beattime",e.TAIL_SECOND_TIME="__mapcheck_tail_secondtime",e.TAIL_BEAT_TIME="__mapcheck_tail_beattime",e.POSITION="__mapcheck_position",e.TAIL_POSITION="__mapcheck_tail_position",e.ANGLE="__mapcheck_angle",e.TAIL_ANGLE="__mapcheck_tail_angle",e.SNAPPED="__mapcheck_snapped",e))(L||{});const gf="Acceptable Beat Precision",vf=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,Ef=!0,yf=[8,6],[_f,Uv]=G.createCheckbox(function(){fn.input.params.enabled=this.checked},gf+": ",vf,Ef),[Df,e1]=G.createText(function(){fn.input.params.prec=this.value.trim().split(" ").map(e=>parseInt(e)).filter(e=>e>0?!Number.isNaN(e):!1),this.value=fn.input.params.prec.join(" ")},"",yf.join(" "));function t1(){_f.checked=fn.input.params.enabled,Df.value=fn.input.params.prec.join(" ")}const fn={name:gf,description:vf,type:Ee.NOTE,order:{input:Re.NOTES_ACCEPTABLE_PRECISION,output:Le.NOTES_ACCEPTABLE_PRECISION},input:{params:{enabled:Ef,prec:[...yf]},ui:()=>G.createBlock(_f,Uv,Df,e1),update:t1},run:n1};function i1(e){const t=e.swingAnalysis.container,{prec:i}=fn.input.params;return t.map(n=>n.data.sort(ct)[0]).filter(n=>{if(!i.length)return!1;const o=n.customData[L.BEAT_TIME];for(let r=0;r<i.length;r++)if((o+.001)%(1/i[r])<.01)return!1;return!0})}function n1(e){const t=i1(e.beatmap);return t.length?[{status:re.WARNING,label:"Off-beat precision",type:te.TIME,value:t}]:[]}const Tf="Angle Offset",Sf="Check for unusual angle offset including for rankable criteria.",wf=!1,Cf=document.createElement("ul"),[Rf,o1]=G.createCheckbox(function(){Ai.input.params.enabled=this.checked},Tf,Sf,wf);function r1(){Rf.checked=Ai.input.params.enabled}const Ai={name:Tf,description:Sf,type:Ee.NOTE,order:{input:Re.NOTES_ANGLE_OFFSET,output:Le.NOTES_ANGLE_OFFSET},input:{params:{enabled:wf,Rankable:!1,Negative:!1,Excess:!1,"Ignore Snap":!1},ui:()=>G.createBlock(G.createBlock(Rf,o1),Cf),update:r1},run:a1},s1=["Rankable","Negative","Excess","Ignore Snap"];for(const e of s1){const[t,i]=G.createCheckbox(function(){Ai.input.params[e]=this.checked},e,`Check for ${e} angle offset.`,Ai.input.params[e]);Cf.appendChild(G.createBlock(t,i))}function a1(e){const t=[],i=e.beatmap.data.difficulty.colorNotes.filter(r=>(Ai.input.params["Ignore Snap"]||!r.customData[L.SNAPPED])&&r.direction!==z.ANY&&r.angleOffset!==0||r.direction===z.ANY&&(r.angleOffset%45!==0||Math.abs(r.angleOffset)>45));i.length&&t.push({status:re.RANK,label:"Rankable angle offset",type:te.TIME,value:i});const n=e.beatmap.data.difficulty.colorNotes.filter(r=>(Ai.input.params["Ignore Snap"]||!r.customData[L.SNAPPED])&&r.angleOffset<0);n.length&&t.push({status:re.INFO,label:"Negative angle offset",type:te.TIME,value:n});const o=e.beatmap.data.difficulty.colorNotes.filter(r=>(Ai.input.params["Ignore Snap"]||!r.customData[L.SNAPPED])&&r.direction!==z.ANY&&Math.abs(r.angleOffset)>=45||(Ai.input.params["Ignore Snap"]||!r.customData[L.SNAPPED])&&r.direction===z.ANY&&Math.abs(r.angleOffset)>=90);return o.length&&t.push({status:re.INFO,label:"Excess angle offset",type:te.TIME,value:o}),t}const Lf="Color Check",Nf="Compare note color with other colored note and the arrow on itself.",xf=!0,xu=[1,1,1],Ou={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"};function Bu(e,t){let i=Object.keys(e).find(o=>parseFloat(o)>=t)??"100",n=parseFloat(i);return e[n]}const[Of,l1]=G.createCheckbox(function(){Hr.input.params.enabled=this.checked},Lf+" (EXPERIMENTAL)",Nf,xf);function u1(){Of.checked=Hr.input.params.enabled}const Hr={name:Lf,description:Nf,type:Ee.NOTE,order:{input:Re.NOTES_COLOR_CHECK,output:Le.NOTES_COLOR_CHECK},input:{params:{enabled:xf},ui:()=>G.createBlock(Of,l1),update:u1},run:m1};function c1(e){const t=e.info.colorSchemes[e.beatmap.info.colorSchemeId],i=e.beatmap?.info.customData?._colorLeft??t.saberLeftColor??bi[di[e.beatmap.environment]??"The First"]._colorLeft,n=e.beatmap?.info.customData?._colorRight??t.saberRightColor??bi[di[e.beatmap.environment]??"The First"]._colorRight;return i&&n?qs(qt(i),qt(n)):100}function f1(e){const t=e.info.colorSchemes[e.beatmap.info.colorSchemeId];let i=100,n=100;const o=e.beatmap?.info.customData?._colorLeft??t.saberLeftColor??bi[di[e.beatmap.environment]??"The First"]._colorLeft,r=e.beatmap?.info.customData?._colorRight??t.saberRightColor??bi[di[e.beatmap.environment]??"The First"]._colorRight;return o&&(i=qs(xu,qt(o))),r&&(n=qs(xu,qt(r))),Math.min(i,n)}function m1(e){const t=e.info.colorSchemes[e.beatmap.info.colorSchemeId];if(!e.beatmap.info.customData?._colorLeft&&!e.beatmap.info.customData?._colorRight&&!t)return[];const i=c1(e),n=f1(e),o=[];return i<=20&&o.push({type:te.STRING,label:`${Bu(Ou,i)} note color (dE${$(i,1)})`,value:"suggest change to better differentiate between 2 note colour",status:re.WARNING}),n<=20&&o.push({type:te.STRING,label:`${Bu(Ou,n)} arrow note color (dE${$(n,1)})`,value:"may be difficult to see the arrow",status:re.WARNING}),o}const Bf="Double-directional",kf="Check double-directional note swing (this may not mean parity break).",Af=!0,[Pf,h1]=G.createCheckbox(function(){Yr.input.params.enabled=this.checked},Bf,kf,Af);function p1(){Pf.checked=Yr.input.params.enabled}const Yr={name:Bf,description:kf,type:Ee.NOTE,order:{input:Re.NOTES_DOUBLE_DIRECTIONAL,output:Le.NOTES_DOUBLE_DIRECTIONAL},input:{params:{enabled:Af},ui:()=>G.createBlock(Pf,h1),update:p1},run:b1};function d1(e){const t=e.timeProcessor,i=e.noteContainer,n={},o={},r={},s={[pe.RED]:[],[pe.BLUE]:[]},a=[];for(let l=0,u=i.length;l<u;l++){const f=i[l];f.type===ve.COLOR&&n[f.data.color]?li(f.data,n[f.data.color],t,s[f.data.color])?(r[f.data.color]&&(r[f.data.color]=null,o[f.data.color]=(o[f.data.color]+180)%360),go(f.data,o[f.data.color],45,!0)&&a.push(f.data),f.data.direction===z.ANY?r[f.data.color]=f.data:o[f.data.color]=f.data.customData[L.ANGLE],s[f.data.color]=[]):(r[f.data.color]&&go(f.data,o[f.data.color],45,!0)&&(a.push(f.data),r[f.data.color]=null,o[f.data.color]=f.data.customData[L.ANGLE]),f.data.direction!==z.ANY&&(r[f.data.color]=null,o[f.data.color]=f.data.customData[L.ANGLE])):f.type===ve.COLOR&&(o[f.data.color]=f.data.customData[L.ANGLE]),f.type===ve.COLOR&&(n[f.data.color]=f.data,s[f.data.color].push(f.data)),f.type===ve.BOMB&&(f.data.posY===ut.BOTTOM&&(f.data.posX===xe.MIDDLE_LEFT&&(o[pe.RED]=Wi[z.UP],r[pe.RED]=null),f.data.posX===xe.MIDDLE_RIGHT&&(o[pe.BLUE]=Wi[z.UP],r[pe.BLUE]=null)),f.data.posY===ut.TOP&&(f.data.posX===xe.MIDDLE_LEFT&&(o[pe.RED]=Wi[z.DOWN],r[pe.RED]=null),f.data.posX===xe.MIDDLE_RIGHT&&(o[pe.BLUE]=Wi[z.DOWN],r[pe.BLUE]=null)))}return a}function b1(e){const t=d1(e.beatmap);return t.length?[{status:re.WARNING,label:"Double-directional",type:te.TIME,value:t}]:[]}const Mf="Effective BPM",If=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,$f=!0,xa=450,Oa=350,Ff=G.createCheckbox(function(){Vt.input.params.enabled=this.checked},Mf+" threshold",If,$f),Vf=G.createNumber(function(){Vt.input.params.ebpmThres=$(Math.abs(parseFloat(this.value)),1),this.value=Vt.input.params.ebpmThres.toString()},": ",xa,0),zf=G.createNumber(function(){Vt.input.params.ebpmsThres=$(Math.abs(parseFloat(this.value)),1),this.value=Vt.input.params.ebpmsThres.toString()}," (swing): ",Oa,0);function g1(e){Ff[0].checked=Vt.input.params.enabled,e&&Gf(e)}const Vt={name:Mf,description:If,type:Ee.NOTE,order:{input:Re.NOTES_EFFECTIVE_BPM,output:Le.NOTES_EFFECTIVE_BPM},input:{params:{enabled:$f,ebpmThres:xa,ebpmsThres:Oa},ui:()=>G.createBlock(Ff,Vf,zf),update:g1,adjustTime:Gf},run:E1};function Gf(e){Vt.input.params.ebpmThres=$(Math.min(xa,e.bpm*2*1.285714),1),Vt.input.params.ebpmsThres=$(Math.min(Oa,e.bpm*2),1),Vf[1].value=Vt.input.params.ebpmThres.toString(),zf[1].value=Vt.input.params.ebpmsThres.toString()}function v1(e){const{swingAnalysis:t}=e.beatmap;let{ebpmThres:i,ebpmsThres:n}=Vt.input.params;i+=.001,n+=.001;const o=t.container.filter(s=>s.ebpm>i).map(s=>s.data[0]),r=t.container.filter(s=>s.ebpmSwing>n).map(s=>s.data[0]);return{base:o,swing:r}}function E1(e){const t=v1(e),{ebpmThres:i,ebpmsThres:n}=Vt.input.params,o=[];return t.base.length&&o.push({status:re.WARNING,label:`>${i}EBPM warning`,type:te.TIME,value:t.base}),t.swing.length&&o.push({status:re.WARNING,label:`>${n}EBPM (swing) warning`,type:te.TIME,value:t.swing}),o}const jf="Excessive Double",Wf="Check for impractical amount of double notes.",Hf=!0,[Yf,y1]=G.createCheckbox(function(){Lo.input.params.enabled=this.checked},jf,Wf,Hf);function _1(){Yf.checked=Lo.input.params.enabled}const Lo={name:jf,description:Wf,type:Ee.NOTE,order:{input:Re.NOTES_EXCESSIVE_DOUBLE,output:Le.NOTES_EXCESSIVE_DOUBLE},input:{params:{enabled:Hf,threshold:.6},ui:()=>G.createBlock(Yf,y1),update:_1},run:D1};function D1(e){const t=new Set,i=new Set;for(let r=0;r<e.beatmap.swingAnalysis.container.length;r++){const s=e.beatmap.swingAnalysis.container[r].data[0];s.color===pe.RED?i.add(s.time):t.add(s.time)}const n=Math.max(t.size,i.size),o=Math.max(t.intersection(i).size,i.intersection(t).size)/n;return o>Lo.input.params.threshold?[{type:te.STRING,label:`Excessive double (${$(o*100,1)}%)`,value:"Too many is not ideal mapping practices",status:re.WARNING}]:[]}se.setLevel(0);function Gi(e,t){const[i,n]=e.customData[L.POSITION],[o,r]=t.customData[L.POSITION];return Math.sqrt(Math.pow(o-i,2)+Math.pow(r-n,2))}function yt(e,t,i){const[n,o]=e.customData[L.POSITION],[r,s]=t.customData[L.POSITION],a=e.customData[L.ANGLE],l=Math.atan2(s-o,r-n)*180/Math.PI+90;return an(a,l,360)<=i}function T1(e,t,i){return yt(e,t,i)||yt(t,e,i)}function ku(e,t,i){const[n,o]=[e.posX,e.posY],[r,s]=[t.posX,t.posY],a=Pt(e.direction),l=Math.atan2(s-o,r-n)*180/Math.PI+90;return an(a,l,360)<=i}function S1(e,t,i){return ku(e,t,i)||ku(t,e,i)}const Xf="Hammer Hit",qf="Bomb placement that is too close to another note path causing risk of hitting the bomb.",Kf=!0,[Jf,w1]=G.createCheckbox(function(){Xr.input.params.enabled=this.checked},Xf,qf,Kf);function C1(){Jf.checked=Xr.input.params.enabled}const Xr={name:Xf,description:qf,type:Ee.NOTE,order:{input:Re.NOTES_HAMMER_HIT,output:Le.NOTES_HAMMER_HIT},input:{params:{enabled:Kf},ui:()=>G.createBlock(Jf,w1),update:C1},run:L1};function R1(e){const t=e.beatmap.noteContainer.filter(r=>r.type===ve.BOMB||r.type===ve.COLOR),i=[];let n=0,o=0;for(let r=0,s=t.length;r<s;r++){const a=t[r];if(!(a.type!==ve.COLOR||a.data.customData[L.SECOND_TIME]<n+.01))for(let l=o;l<s;l++){const u=t[l];if(u.data.customData[L.SECOND_TIME]+.125<a.data.customData[L.SECOND_TIME]){o=l;continue}if(u.data.customData[L.SECOND_TIME]>a.data.customData[L.SECOND_TIME]+.075)break;u.type!==ve.BOMB||a.data.direction===z.ANY||(Gi(a.data,u.data)<=2&&yt(a.data,u.data,15)||Gi(a.data,u.data)<=2&&!yt(a.data,u.data,165-.001))&&(i.push(a.data),n=a.data.customData[L.SECOND_TIME])}}return i}function L1(e){const t=R1(e);return t.length?[{status:re.ERROR,label:"Hammer hit",type:te.TIME,value:t}]:[]}const Zf="Handclap",Qf="Note pattern that may induce controller clashing during swing, does not capture implicit handclap such as crossover.",Uf=!0,[em,N1]=G.createCheckbox(function(){qr.input.params.enabled=this.checked},Zf,Qf,Uf);function x1(){em.checked=qr.input.params.enabled}const qr={name:Zf,description:Qf,type:Ee.NOTE,order:{input:Re.NOTES_HANDCLAP,output:Le.NOTES_HANDCLAP},input:{params:{enabled:Uf},ui:()=>G.createBlock(em,N1),update:x1},run:B1};function O1(e){const t=e.beatmap.noteContainer.filter(o=>o.type===ve.BOMB||o.type===ve.COLOR),i=[];let n=0;for(let o=0,r=t.length;o<r;o++){const s=t[o];if(!(s.type!==ve.COLOR||s.data.customData[L.SECOND_TIME]<n+.01))for(let a=o+1;a<r;a++){const l=t[a];if(l.data.customData[L.SECOND_TIME]>s.data.customData[L.SECOND_TIME]+.01)break;l.type!==ve.COLOR||s.data.color===l.data.color||s.data.direction===z.ANY||l.data.direction===z.ANY||(Gi(s.data,l.data)<=1&&yt(s.data,l.data,45)&&yt(l.data,s.data,45)||Gi(s.data,l.data)<=1.5&&yt(s.data,l.data,30)&&yt(l.data,s.data,30)||Gi(s.data,l.data)<=2&&yt(s.data,l.data,15)&&yt(l.data,s.data,15)||Gi(s.data,l.data)<=1&&!yt(s.data,l.data,135-.001)&&!yt(l.data,s.data,135-.001)||Gi(s.data,l.data)<=1.5&&!yt(s.data,l.data,160-.001)&&!yt(l.data,s.data,160-.001))&&(i.push(s.data),n=s.data.customData[L.SECOND_TIME])}}return i}function B1(e){const t=O1(e);return t.length?[{status:re.ERROR,label:"Handclap pattern",type:te.TIME,value:t}]:[]}const tm="Hitbox Inline",im="Check for overlapping note hitbox for inline note.",nm=!0,[om,k1]=G.createCheckbox(function(){Kr.input.params.enabled=this.checked},tm,im,nm);function A1(){om.checked=Kr.input.params.enabled}const Kr={name:tm,description:im,type:Ee.NOTE,order:{input:Re.NOTES_HITBOX_INLINE,output:Le.NOTES_HITBOX_INLINE},input:{params:{enabled:nm},ui:()=>G.createBlock(om,k1),update:A1},run:I1},P1=0;function M1(e){const{timeProcessor:t,njs:i}=e.beatmap,n={},o={[pe.RED]:[],[pe.BLUE]:[]},r=[];for(let s=0,a=e.beatmap.data.difficulty.colorNotes.length;s<a;s++){const l=e.beatmap.data.difficulty.colorNotes[s];n[l.color]&&li(l,n[l.color],t,o[l.color])&&(o[l.color]=[]);for(const u of o[(l.color+1)%2])if(i.value<1.425/(l.customData[L.SECOND_TIME]-u.customData[L.SECOND_TIME]+P1)&&Xn(l,u)){r.push(l);break}n[l.color]=l,o[l.color].push(l)}return r}function I1(e){const t=M1(e);return t.length?[{status:re.RANK,label:"Hitbox inline",type:te.TIME,value:t}]:[]}const rm="Hitbox Path",sm="Check for overlapping pre-swing note hitbox at same time.",am=!0,[lm,$1]=G.createCheckbox(function(){Jr.input.params.enabled=this.checked},rm,sm,am);function F1(){lm.checked=Jr.input.params.enabled}const Jr={name:rm,description:sm,type:Ee.NOTE,order:{input:Re.NOTES_HITBOX_PATH,output:Le.NOTES_HITBOX_PATH},input:{params:{enabled:am},ui:()=>G.createBlock(lm,$1),update:F1},run:z1};function V1(e){const t=e.beatmap.noteContainer.filter(o=>o.type===ve.BOMB||o.type===ve.COLOR),i=[];let n=0;for(let o=0,r=t.length;o<r;o++){const s=t[o];if(!(s.type!==ve.COLOR||s.data.customData[L.SECOND_TIME]<n+.01||s.data.direction===z.ANY))for(let a=o+1;a<r;a++){const l=t[a];if(l.data.customData[L.SECOND_TIME]>s.data.customData[L.SECOND_TIME]+.01)break;l.type===ve.COLOR&&s.data.color===l.data.color||Gi(s.data,l.data)<=2&&(!yt(s.data,l.data,150)||!yt(l.data,s.data,150))&&(i.push(s.data),n=s.data.customData[L.SECOND_TIME])}}return i}function z1(e){const t=V1(e);return t.length?[{status:re.ERROR,label:"Hitbox path",type:te.TIME,value:t}]:[]}const um="Hitbox Reverse Staircase",cm="Check for overlapping pre-swing hitbox with note hitbox during swing.",fm=!0,[mm,G1]=G.createCheckbox(function(){Zr.input.params.enabled=this.checked},um,cm,fm);function j1(){mm.checked=Zr.input.params.enabled}const Zr={name:um,description:cm,type:Ee.NOTE,order:{input:Re.NOTES_HITBOX_REVERSE_STAIR,output:Le.NOTES_HITBOX_REVERSE_STAIR},input:{params:{enabled:fm},ui:()=>G.createBlock(mm,G1),update:j1},run:X1},W1=.03414823529,H1=.03414823529;function Y1(e){const{timeProcessor:t,njs:i,noteContainer:n}=e.beatmap,o={},r={[pe.RED]:[],[pe.BLUE]:[]},s=[];for(let a=0,l=n.length;a<l;a++){if(n[a].type!==ve.COLOR)continue;const u=n[a];o[u.data.color]&&li(u.data,o[u.data.color],t,r[u.data.color])&&(r[u.data.color]=[]);for(const f of r[(u.data.color+1)%2])if(f.direction!==z.ANY){if(!(u.data.customData[L.SECOND_TIME]>f.customData[L.SECOND_TIME]+.01))continue;const b=f.customData[L.ANGLE]%90>15&&f.customData[L.ANGLE]%90<75;if(i.value<1.425/(u.data.customData[L.SECOND_TIME]-f.customData[L.SECOND_TIME]+(b?H1:W1))&&Gi(u.data,f)<=1.5&&yt(u.data,f,15)){s.push(f);break}}o[u.data.color]=u.data,r[u.data.color].push(u.data)}return s}function X1(e){const t=Y1(e);return t.length?[{status:re.RANK,label:"Hitbox reverse staircase",type:te.TIME,value:t}]:[]}const hm="Hitbox Staircase",pm="Check for overlapping post-swing hitbox with note hitbox during swing.",dm=!0,[bm,q1]=G.createCheckbox(function(){Qr.input.params.enabled=this.checked},hm,pm,dm);function K1(){bm.checked=Qr.input.params.enabled}const Qr={name:hm,description:pm,type:Ee.NOTE,order:{input:Re.NOTES_HITBOX_STAIR,output:Le.NOTES_HITBOX_STAIR},input:{params:{enabled:dm},ui:()=>G.createBlock(bm,q1),update:K1},run:Q1};function J1(e,t,i){for(let n=i,o=t.length;n<o;n++){if(t[n].time<e.time+.01&&t[n].color!==e.color)return!0;if(t[n].time>e.time+.01)return!1}return!1}function Z1(e){const{timeProcessor:t}=e.beatmap,i=e.beatmap.data.difficulty.colorNotes,n=.15,o={},r={},s={},a={[pe.RED]:[],[pe.BLUE]:[]},l={[pe.RED]:new At,[pe.BLUE]:new At({color:1})},u=[];for(let f=0,b=i.length;f<b;f++){const m=i[f],g=Ds[m.direction]||[0,0];o[m.color]?(li(m,o[m.color],t,a[m.color])?(s[m.color]=m.customData[L.SECOND_TIME]-o[m.color].customData[L.SECOND_TIME],m.direction!==z.ANY?(l[m.color].posX=m.posX+g[0],l[m.color].posY=m.posY+g[1]):(l[m.color].posX=-1,l[m.color].posY=-1),a[m.color]=[],r[m.color]=m.direction):Hc(m,o[m.color],r[m.color])&&(m.direction!==z.ANY?(l[m.color].posX=m.posX+g[0],l[m.color].posY=m.posY+g[1],r[m.color]=m.direction):(l[m.color].posX=m.posX+(Ds[r[m.color]]?.[0]||0),l[m.color].posY=m.posY+(Ds[r[m.color]]?.[1]||0))),o[(m.color+1)%2]&&m.customData[L.SECOND_TIME]-o[(m.color+1)%2].customData[L.SECOND_TIME]!==0&&m.customData[L.SECOND_TIME]-o[(m.color+1)%2].customData[L.SECOND_TIME]<Math.min(n,s[(m.color+1)%2])&&m.posX===l[(m.color+1)%2].posX&&m.posY===l[(m.color+1)%2].posY&&!J1(m,e.beatmap.data.difficulty.colorNotes,f)&&u.push(m)):(m.direction!==z.ANY?(l[m.color].posX=m.posX+g[0],l[m.color].posY=m.posY+g[1]):(l[m.color].posX=-1,l[m.color].posY=-1),r[m.color]=m.direction),o[m.color]=m,a[m.color].push(m)}return u}function Q1(e){const t=Z1(e);return t.length?[{status:re.RANK,label:"Hitbox staircase",type:te.TIME,value:t}]:[]}const gm="Improper Arc",vm="Check for correct use of arc.",Em=!0,[ym,U1]=G.createCheckbox(function(){Ur.input.params.enabled=this.checked},gm,vm,Em);function eE(){ym.checked=Ur.input.params.enabled}const Ur={name:gm,description:vm,type:Ee.NOTE,order:{input:Re.NOTES_IMPROPER_ARC,output:Le.NOTES_IMPROPER_ARC},input:{params:{enabled:Em},ui:()=>G.createBlock(ym,U1),update:eE},run:iE};function tE(e){const t=[...e.beatmap.noteContainer].sort((n,o)=>n.type!==ve.ARC?1:o.type!==ve.ARC?-1:0).sort((n,o)=>n.data.time-o.data.time),i=[];for(let n=0,o=t.length;n<o;n++){const r=t[n];if(r.type===ve.ARC){if(Ui(r.data.time,r.data.tailTime)){i.push(r.data);continue}for(let s=n;s<o;s++){const a=t[s];if(a.data.time>r.data.tailTime+.001)break;if(a.type===ve.COLOR&&(r.data.posX===a.data.posX&&r.data.posY===a.data.posY&&Ui(a.data.time,r.data.time)&&r.data.color!==a.data.color||r.data.tailPosX===a.data.posX&&r.data.tailPosY===a.data.posY&&Ui(a.data.time,r.data.tailTime)&&r.data.color!==a.data.color)){i.push(r.data);break}if(a.type===ve.BOMB&&(r.data.posX===a.data.posX&&r.data.posY===a.data.posY&&Ui(a.data.time,r.data.time)||r.data.tailPosX===a.data.posX&&r.data.tailPosY===a.data.posY&&Ui(a.data.time,r.data.tailTime))){i.push(r.data);break}}}}return i}function iE(e){const t=tE(e);return t.length?[{status:re.ERROR,label:"Improper arc",type:te.TIME,value:t}]:[]}const _m="Improper Chain",Dm="Check for correct use of chain.",Tm=!0,[Sm,nE]=G.createCheckbox(function(){es.input.params.enabled=this.checked},_m,Dm,Tm);function oE(){Sm.checked=es.input.params.enabled}const es={name:_m,description:Dm,type:Ee.NOTE,order:{input:Re.NOTES_IMPROPER_CHAIN,output:Le.NOTES_IMPROPER_CHAIN},input:{params:{enabled:Tm},ui:()=>G.createBlock(Sm,nE),update:oE},run:sE};function rE(e){const t=[...e.beatmap.noteContainer].sort((n,o)=>n.type!==ve.CHAIN?1:o.type!==ve.CHAIN?-1:0).sort((n,o)=>n.data.time-o.data.time),i=[];for(let n=0,o=!0,r=t.length;n<r;n++){const s=t[n];if(s.type===ve.CHAIN){o=!0;for(let a=n;a<r;a++){const l=t[a];if(l.type===ve.COLOR&&s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001&&s.data.color===l.data.color&&((l.data.direction===z.ANY||s.data.direction===l.data.direction)&&(s.data.sliceCount===1||Ks(l.data.customData[L.POSITION],s.data.customData[L.TAIL_POSITION])>.1&&s.data.sliceCount>1&&yt(l.data,{posX:s.data.tailPosX,posY:s.data.tailPosY,customData:{[L.POSITION]:s.data.customData[L.TAIL_POSITION]}},60))||l.data.direction===z.ANY&&Ks(l.data.customData[L.POSITION],s.data.customData[L.TAIL_POSITION])>.1&&s.data.sliceCount>1&&an(l.data.customData[L.ANGLE],s.data.customData[L.ANGLE],360)<5)){o=!1;break}if(l.type===ve.BOMB&&s.data.posX===l.data.posX&&s.data.posY===l.data.posY&&l.data.time<=s.data.time+.001||l.data.time>s.data.time+.001)break}o&&i.push(s)}}return i}function sE(e){const t=rE(e);return t.length?[{status:re.ERROR,label:"Improper chain",type:te.TIME,value:t.map(i=>i.data)}]:[]}const wm="Improper Window Snap",Cm="Check for slanted window snap timing.",Rm=!0,[Lm,aE]=G.createCheckbox(function(){ts.input.params.enabled=this.checked},wm,Cm,Rm);function lE(){Lm.checked=ts.input.params.enabled}const ts={name:wm,description:Cm,type:Ee.NOTE,order:{input:Re.NOTES_IMPROPER_WINDOW,output:Le.NOTES_IMPROPER_WINDOW},input:{params:{enabled:Rm},ui:()=>G.createBlock(Lm,aE),update:lE},run:cE};function uE(e){const{timeProcessor:t,noteContainer:i}=e.beatmap,n={},o={[pe.RED]:[],[pe.BLUE]:[]},r=[];for(let s=0,a=i.length;s<a;s++){if(i[s].type!==ve.COLOR)continue;const l=i[s].data;n[l.color]?li(l,n[l.color],t,o[l.color])?(n[l.color]=l,o[l.color]=[]):gr(l,n[l.color])&&l.time-n[l.color].time>=.001&&l.direction===n[l.color].direction&&l.direction!==z.ANY&&n[l.color].direction!==z.ANY&&r.push(n[l.color]):n[l.color]=l,o[l.color].push(l)}return r}function cE(e){const t=uE(e);return t.length?[{status:re.ERROR,label:"Improper window snap",type:te.TIME,value:t}]:[]}const Nm="Inline Sharp Angle",xm="Check for angle changes within inline note.",Om=!0,Bm=.15;let Gn;const[fE,Ba]=G.createNumber(function(){si.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=$(si.input.params.maxTime*1e3,1).toString(),Gn&&(ka.value=$(Gn.toBeatTime(si.input.params.maxTime,!1),2).toString())},"max time (ms): ",$(Bm*1e3,1),0),[mE,ka]=G.createNumber(function(){if(!Gn){this.value="0";return}let e=$(Math.abs(parseFloat(this.value)),2)||1;si.input.params.maxTime=Gn.toRealTime(e,!1),Ba.value=$(si.input.params.maxTime*1e3,1).toString(),this.value=e.toString()}," (beat): ",0,0,null,.1),km=G.createCheckbox(function(){si.input.params.enabled=this.checked},Nm,xm,Om);function hE(e){km[0].checked=si.input.params.enabled,Ba.value=(si.input.params.maxTime*1e3).toString(),e&&Am(e)}const si={name:Nm,description:xm,type:Ee.NOTE,order:{input:Re.NOTES_INLINE_ANGLE,output:Le.NOTES_INLINE_ANGLE},input:{params:{enabled:Om,maxTime:Bm},ui:()=>G.createBlock(km,document.createElement("br"),fE,Ba,mE,ka),update:hE,adjustTime:Am},run:dE};function Am(e){Gn=e,ka.value=$(Gn.toBeatTime(si.input.params.maxTime,!1),2).toString()}function pE(e){const{timeProcessor:t}=e.beatmap,i=e.beatmap.noteContainer,{maxTime:n}=si.input.params,o={},r={},s={},a={[pe.RED]:[],[pe.BLUE]:[]},l=[];let u=0;for(let f=0,b=i.length;f<b;f++){const m=i[f];m.type===ve.COLOR&&o[m.data.color]?li(m.data,o[m.data.color],t,a[m.data.color])?(s[m.data.color]&&(s[m.data.color]=null,r[m.data.color]=(r[m.data.color]+180)%360),Au(m.data,i,u,n)&&go(m.data,r[m.data.color],90,!0)&&l.push(m.data),m.data.direction===z.ANY?s[m.data.color]=m.data:r[m.data.color]=m.data.customData[L.ANGLE],a[m.data.color]=[]):(s[m.data.color]&&Au(m.data,i,u,n)&&go(m.data,r[m.data.color],90,!0)&&(l.push(s[m.data.color]),s[m.data.color]=null),m.data.direction!==z.ANY&&(r[m.data.color]=m.data.customData[L.ANGLE])):m.type===ve.COLOR&&(r[m.data.color]=m.data.customData[L.ANGLE]),m.type===ve.COLOR&&(o[m.data.color]=m.data,a[m.data.color].push(m.data)),m.type===ve.BOMB&&(m.data.posY===ut.BOTTOM&&(m.data.posX===xe.MIDDLE_LEFT&&(r[pe.RED]=Wi[z.UP],s[pe.RED]=null),m.data.posX===xe.MIDDLE_RIGHT&&(r[pe.BLUE]=Wi[z.UP],s[pe.BLUE]=null)),m.data.posY===ut.TOP&&(m.data.posX===xe.MIDDLE_LEFT&&(r[pe.RED]=Wi[z.DOWN],s[pe.RED]=null),m.data.posX===xe.MIDDLE_RIGHT&&(r[pe.BLUE]=Wi[z.DOWN],s[pe.BLUE]=null)))}return l}function Au(e,t,i,n){for(let o=i;t[o].data.customData[L.SECOND_TIME]<e.customData[L.SECOND_TIME];o++){const r=t[o];if(r.type===ve.COLOR&&Xn(e,r.data)&&e.customData[L.SECOND_TIME]-t[o].data.customData[L.SECOND_TIME]<=n)return!0}return!1}function dE(e){const t=pE(e);return t.length?[{status:re.WARNING,label:"Inline sharp angle",type:te.TIME,value:t}]:[]}const Pm="One Saber",Mm="Check for one saber.",Im=!0,[$m,bE]=G.createCheckbox(function(){is.input.params.enabled=this.checked},Pm,Mm,Im);function gE(){$m.checked=is.input.params.enabled}const is={name:Pm,description:Mm,type:Ee.NOTE,order:{input:Re.NOTES_ONE_SABER,output:Le.NOTES_ONE_SABER},input:{params:{enabled:Im},ui:()=>G.createBlock($m,bE),update:gE},run:vE};function vE(e){let t,i=!1;if(e.beatmap.info.characteristic==="OneSaber"||e.beatmap.info.customData.oneSaber)t=e.beatmap.data.difficulty.colorNotes.filter(o=>Qs(o.color));else{const o=e.beatmap.data.difficulty.colorNotes.filter(s=>ac(s.color)).length>0,r=e.beatmap.data.difficulty.colorNotes.filter(s=>Qs(s.color)).length>0;i=o!==r}return t?.length?[{status:re.ERROR,label:"Wrong One Saber Note",type:te.TIME,value:t}]:i?[{status:re.RANK,label:"Unintended One Saber",type:te.STRING,value:"One Saber gameplay outside of One Saber characteristic"}]:[]}const Fm="Parallel Notes",Vm="Also known as Lollope, note that are parallel to each other.",zm=!0,[Gm,EE]=G.createCheckbox(function(){ns.input.params.enabled=this.checked},Fm,Vm,zm);function yE(){Gm.checked=ns.input.params.enabled}const ns={name:Fm,description:Vm,type:Ee.NOTE,order:{input:Re.NOTES_PARALLEL_NOTES,output:Le.NOTES_PARALLEL_NOTES},input:{params:{enabled:zm},ui:()=>G.createBlock(Gm,EE),update:yE},run:DE};function _E(e){const t=e.beatmap.noteContainer.filter(o=>o.type===ve.BOMB||o.type===ve.COLOR),i=[];let n=0;for(let o=0,r=t.length;o<r;o++){const s=t[o];if(!(s.type!==ve.COLOR||s.data.customData[L.SECOND_TIME]<n+.01))for(let a=o+1;a<r;a++){const l=t[a];if(l.data.customData[L.SECOND_TIME]>s.data.customData[L.SECOND_TIME]+.01)break;l.type!==ve.COLOR||s.data.color!==l.data.color||s.data.direction===z.ANY||l.data.direction===z.ANY||an(s.data.customData[L.ANGLE],l.data.customData[L.ANGLE],360)>45||T1(s.data,l.data,30)||(i.push(s.data),n=s.data.customData[L.SECOND_TIME])}}return i}function DE(e){const t=_E(e);return t.length?[{status:re.ERROR,label:"Parallel notes",type:te.TIME,value:t}]:[]}class Aa{static create(t,i,n,o,...r){const s=document.createElement(n);s.className=o;const a=document.createElement("select");a.className="input-toggle",a.id=t,r.forEach(u=>{const f=document.createElement("option");f.textContent=u.text,f.value=u.value,a.append(f)});const l=document.createElement("label");return l.htmlFor=t,l.innerHTML=`<span>${i}</span>`,s.append(l),s.append(a),s}}const jm="Parity Check",Wm="Perform parity check.",Hm=!0,Ym=document.createElement("div");Aa.create("input__checks-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});Aa.create("input__checks-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Aa.create("input__checks-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});const[Xm,TE]=G.createCheckbox(function(){No.input.params.enabled=this.checked},jm,Wm,Hm);Ym.appendChild(G.createBlock(Xm,TE));function SE(){Xm.checked=No.input.params.enabled}const No={name:jm,description:Wm,type:Ee.NOTE,order:{input:Re.NOTES_PARITY,output:Le.NOTES_PARITY},input:{params:{enabled:Hm,warningThres:90,errorThres:45,allowedRot:90},ui:()=>Ym,update:SE},run:CE};function wE(e){const{timeProcessor:t,noteContainer:i}=e.beatmap,{warningThres:n,errorThres:o,allowedRot:r}=No.input.params,s={},a={[pe.RED]:[],[pe.BLUE]:[]},l={[pe.RED]:[],[pe.BLUE]:[]},u={[pe.RED]:[],[pe.BLUE]:[]},f={[pe.RED]:new on(e.beatmap.data.difficulty.colorNotes,e.beatmap.data.difficulty.bombNotes,0,n,o,r),[pe.BLUE]:new on(e.beatmap.data.difficulty.colorNotes,e.beatmap.data.difficulty.bombNotes,1,n,o,r)},b={warning:[],error:[]};for(let m=0,g=i.length;m<g;m++){const E=i[m];if(E.type===ve.COLOR&&s[E.data.color]&&li(E.data,s[E.data.color],t,a[E.data.color])){switch(f[E.data.color].check(a[E.data.color],u[E.data.color])){case"warning":{b.warning.push(a[E.data.color][0]);break}case"error":{b.error.push(a[E.data.color][0]);break}}f[E.data.color].next(a[E.data.color],u[E.data.color]),u[E.data.color]=l[E.data.color],l[E.data.color]=[],a[E.data.color]=[]}E.type===ve.BOMB&&(l[pe.RED].push(E.data),l[pe.BLUE].push(E.data)),E.type===ve.COLOR&&(s[E.data.color]=E.data,a[E.data.color].push(E.data))}for(let m=0;m<2;m++)if(s[m])switch(f[m].check(a[m],l[m])){case"warning":{b.warning.push(a[m][0]);break}case"error":{b.error.push(a[m][0]);break}}return b}function CE(e){const t=wE(e);t.warning=t.warning,t.error=t.error;const i=[];return t.warning.length&&i.push({status:re.WARNING,label:"Parity warning",type:te.TIME,value:t.warning}),t.error.length&&i.push({status:re.ERROR,label:"Parity error",type:te.TIME,value:t.error}),i}const qm="shrado Angle",Km="Look for common negative curvature pattern.",Jm=!1,Zm=.15,Qm=1;let jn;const[RE,Pa]=G.createNumber(function(){Mt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=$(Mt.input.params.maxTime*1e3,1).toString(),jn&&(Ma.value=$(jn.toBeatTime(Mt.input.params.maxTime,!1),2).toString())},"max time (ms): ",$(Zm*1e3,1),0),[LE,Ma]=G.createNumber(function(){if(!jn){this.value="0";return}let e=$(Math.abs(parseFloat(this.value)),2)||1;Mt.input.params.maxTime=jn.toRealTime(e,!1),Pa.value=$(Mt.input.params.maxTime*1e3,1).toString(),this.value=e.toString()}," (beat): ",0,0,null,.1),Um=G.createNumber(function(){Mt.input.params.distance=Math.max(parseInt(this.value),0),this.value=Mt.input.params.distance.toString()},"min distance: ",Qm,0),eh=G.createCheckbox(function(){Mt.input.params.enabled=this.checked},qm,Km,Jm);function NE(e){eh[0].checked=Mt.input.params.enabled,Um[1].value=Mt.input.params.distance.toString(),Pa.value=(Mt.input.params.maxTime*1e3).toString(),e&&th(e)}const Mt={name:qm,description:Km,type:Ee.NOTE,order:{input:Re.NOTES_SHRADO_ANGLE,output:Le.NOTES_SHRADO_ANGLE},input:{params:{enabled:Jm,distance:Qm,maxTime:Zm},ui:()=>G.createBlock(eh,document.createElement("br"),Um,document.createElement("br"),RE,Pa,LE,Ma),update:NE,adjustTime:th},run:OE};function th(e){jn=e,Ma.value=$(jn.toBeatTime(Mt.input.params.maxTime,!1),2).toString()}function xE(e){const{timeProcessor:t,noteContainer:i}=e.beatmap,{maxTime:n,distance:o}=Mt.input.params,r={},s={},a={},l={[pe.RED]:[],[pe.BLUE]:[]},u=[];for(let f=0,b=i.length;f<b;f++){if(i[f].type!==ve.COLOR)continue;const m=i[f].data;r[m.color]?li(m,r[m.color],t,l[m.color])?(a[m.color]&&(a[m.color]=null,s[m.color]=Ld[s[m.color]]??8),ln(m,r[m.color])>=o&&Pu(m.direction,s[m.color],m.color)&&m.customData[L.SECOND_TIME]-r[m.color].customData[L.SECOND_TIME]<=n&&u.push(m),m.direction===z.ANY?a[m.color]=m:s[m.color]=m.direction,l[m.color]=[]):(a[m.color]&&ln(m,r[m.color])>=o&&Pu(m.direction,s[m.color],m.color)&&m.customData[L.SECOND_TIME]-r[m.color].customData[L.SECOND_TIME]<=n&&(u.push(a[m.color]),a[m.color]=null),m.direction!==z.ANY&&(s[m.color]=m.direction)):s[m.color]=m.direction,r[m.color]=m,l[m.color].push(m)}return u}function Pu(e,t,i){return e===8||t===8?!1:(i===0?t===7:t===6)&&e===0}function OE(e){const t=xE(e);return t.length?[{status:re.WARNING,label:"Shrado angle",type:te.TIME,value:t}]:[]}const ih="Slow Slider",nh="Look for slider that require slow swing.",oh=!0,rh=.025;let Wn;const[BE,Ia]=G.createNumber(function(){Jt.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=$(Jt.input.params.minSpeed*1e3,1).toString(),Wn&&($a.value=$(1/Wn.toBeatTime(Jt.input.params.minSpeed,!1),2).toString())},"min speed (ms): ",$(rh*1e3,1),0),[kE,$a]=G.createNumber(function(){if(!Wn){this.value="0";return}let e=$(Math.abs(parseFloat(this.value)),2)||1;Jt.input.params.minSpeed=Wn.toRealTime(1/e,!1),Ia.value=$(Jt.input.params.minSpeed*1e3,1).toString(),this.value=e.toString()}," (prec): ",0,0),sh=G.createCheckbox(function(){Jt.input.params.enabled=this.checked},ih,nh,oh);function AE(e){sh[0].checked=Jt.input.params.enabled,Ia.value=(Jt.input.params.minSpeed*1e3).toString(),e&&ah(e)}const Jt={name:ih,description:nh,type:Ee.NOTE,order:{input:Re.NOTES_SLOW_SLIDER,output:Le.NOTES_SLOW_SLIDER},input:{params:{enabled:oh,minSpeed:rh},ui:()=>G.createBlock(sh,document.createElement("br"),BE,Ia,kE,$a),update:AE,adjustTime:ah},run:ME};function ah(e){Wn=e,$a.value=$(1/Wn.toBeatTime(Jt.input.params.minSpeed,!1),2).toString()}function PE(e){const{swingAnalysis:t}=e.beatmap,{minSpeed:i}=Jt.input.params;return t.container.filter(n=>n.maxSpeed>i||n.minSpeed>i)}function ME(e){const{minSpeed:t}=Jt.input.params,i=PE(e);return i.length?[{status:re.WARNING,label:`Slow slider (>${$(t*1e3,1)}ms)`,type:te.TIME,value:i.map(n=>n.data[0])}]:[]}const lh="Speed Pause",uh="Look for stream/burst containing timing gap causing sudden change of pace.",ch=!1,fh=.075;let Hn;const[IE,Fa]=G.createNumber(function(){ai.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=$(ai.input.params.maxTime*1e3,1).toString(),Hn&&(Va.value=$(1/Hn.toBeatTime(ai.input.params.maxTime,!1),2).toString())},"stream speed (ms): ",$(fh*1e3,1),0),[$E,Va]=G.createNumber(function(){if(!Hn){this.value="0";return}let t=$(Math.abs(parseFloat(this.value)),2)||1;ai.input.params.maxTime=Hn.toRealTime(1/t,!1),Fa.value=$(ai.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}," (prec): ",0,0),mh=G.createCheckbox(function(){ai.input.params.enabled=this.checked},lh,uh,ch);function FE(e){mh[0].checked=ai.input.params.enabled,Fa.value=(ai.input.params.maxTime*1e3).toString(),e&&hh(e)}const ai={name:lh,description:uh,type:Ee.NOTE,order:{input:Re.NOTES_SPEED_PAUSE,output:Le.NOTES_SPEED_PAUSE},input:{params:{enabled:ch,maxTime:fh},ui:()=>G.createBlock(mh,document.createElement("br"),IE,Fa,$E,Va),update:FE,adjustTime:hh},run:zE};function hh(e){Hn=e,Va.value=$(1/Hn.toBeatTime(ai.input.params.maxTime,!1),2).toString()}function VE(e){const t=e.timeProcessor,i=e.data.difficulty.colorNotes,{maxTime:n}=ai.input.params,o={},r={},s={[pe.RED]:!1,[pe.BLUE]:!1},a={[pe.RED]:[],[pe.BLUE]:[]},l=[];for(let u=0,f=i.length;u<f;u++){const b=i[u];o[b.color]?li(b,o[b.color],t,a[b.color])&&(b.customData[L.SECOND_TIME]-o[b.color].customData[L.SECOND_TIME]<=n*2?(s[pe.RED]&&s[pe.BLUE]&&o[b.color].customData[L.SECOND_TIME]-r[b.color].customData[L.SECOND_TIME]<=n*3&&l.push(o[b.color]),s[b.color]=!1):s[b.color]||(s[b.color]=!0,r[b.color]=o[b.color]),a[b.color]=[],o[b.color]=b):o[b.color]=b,a[b.color].push(b)}return l}function zE(e){const t=VE(e.beatmap);return t.length?[{status:re.WARNING,label:"Speed pause",type:te.TIME,value:t}]:[]}const ph="Stacked Note",dh="Look for stacked note.",bh=!0,[gh,GE]=G.createCheckbox(function(){os.input.params.enabled=this.checked},ph,dh,bh);function jE(){gh.checked=os.input.params.enabled}const os={name:ph,description:dh,type:Ee.NOTE,order:{input:Re.NOTES_STACKED_NOTE,output:Le.NOTES_STACKED_NOTE},input:{params:{enabled:bh},ui:()=>G.createBlock(gh,GE),update:jE},run:YE};function WE(e){const t=e.data.difficulty.colorNotes,i=[];let n=0;for(let o=0,r=t.length;o<r;o++)if(!(t[o].customData[L.SECOND_TIME]<n+.01))for(let s=o+1;s<r&&!(t[s].customData[L.SECOND_TIME]>t[o].customData[L.SECOND_TIME]+.01);s++)Xn(t[s],t[o])&&(i.push(t[o]),n=t[o].customData[L.SECOND_TIME]);return i}function HE(e){e.timeProcessor;const t=e.njs,i=e.data.difficulty.bombNotes,n=[];for(let o=0,r=i.length;o<r;o++)for(let s=o+1;s<r&&!(i[s].customData[L.SECOND_TIME]>i[o].customData[L.SECOND_TIME]+1);s++)Xn(i[o],i[s])&&(t.value<(i[s].customData[L.SECOND_TIME]-i[o].customData[L.SECOND_TIME])*2||i[s].customData[L.SECOND_TIME]<i[o].customData[L.SECOND_TIME]+.02)&&n.push(i[o]);return n}function YE(e){const t=WE(e.beatmap),i=HE(e.beatmap),n=[];return t.length&&n.push({status:re.ERROR,label:"Stacked note",type:te.TIME,value:t}),i.length&&n.push({status:re.ERROR,label:"Stacked bomb",type:te.TIME,value:i}),n}const vh="Varying Swing Speed",Eh="Check for varying swing speed due to changes in slider distance.",yh=!0,[_h,XE]=G.createCheckbox(function(){rs.input.params.enabled=this.checked},vh,Eh,yh);function qE(){_h.checked=rs.input.params.enabled}const rs={name:vh,description:Eh,type:Ee.NOTE,order:{input:Re.NOTES_VARY_SWING,output:Le.NOTES_VARY_SWING},input:{params:{enabled:yh},ui:()=>G.createBlock(_h,XE),update:qE},run:JE};function KE(e){const{swingAnalysis:t}=e;return t.container.filter(i=>Math.abs(i.minSpeed-i.maxSpeed)>.001)}function JE(e){const t=KE(e.beatmap);return t.length?[{status:re.ERROR,label:"Varying swing speed",type:te.TIME,value:t.map(i=>i.data[0])}]:[]}const Dh="Vision Block",Th="Check for vision block caused by center note.",Sh=!0,wh=.1,Ch=.5;let Zt;const Mu={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},[ZE,aa]=G.createRadio(Nh," VB time specific ","vb-spec","time",!1),[QE,la]=G.createRadio(Nh," VB difficulty specific ","vb-spec","difficulty",!0),[UE,za]=G.createNumber(function(){ze.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=$(ze.input.params.minTime*1e3,1).toString(),Zt&&(Ga.value=$(Zt.toBeatTime(ze.input.params.minTime,!1),2).toString(),ze.input.params.minTime>ze.input.params.maxTime&&(ze.input.params.maxTime=ze.input.params.minTime,xo.value=$(ze.input.params.maxTime*1e3,1).toString(),Oo.value=$(Zt.toBeatTime(ze.input.params.maxTime,!1),2).toString()))},"min time (ms): ",$(wh*1e3,1),0),[ey,Ga]=G.createNumber(function(){if(!Zt){this.value="0";return}const e=Math.abs(parseFloat(this.value))||1;ze.input.params.minTime=Zt.toRealTime(e,!1),za.value=$(ze.input.params.minTime*1e3,1).toString(),this.value=$(e,2).toString(),ze.input.params.minTime>ze.input.params.maxTime&&(ze.input.params.maxTime=ze.input.params.minTime,xo.value=$(ze.input.params.maxTime*1e3,1).toString(),Oo.value=$(Zt.toBeatTime(ze.input.params.maxTime,!1),2).toString())}," (beat): ",0,0,null,.1),[ty,xo]=G.createNumber(function(){ze.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=$(ze.input.params.maxTime*1e3,1).toString(),Zt&&(Oo.value=$(Zt.toBeatTime(ze.input.params.maxTime,!1),2).toString())},"max time (ms): ",$(Ch*1e3,1),0),[iy,Oo]=G.createNumber(function(){if(!Zt){this.value="0";return}const e=Math.abs(parseFloat(this.value))||1;ze.input.params.maxTime=Zt.toRealTime(e,!1),xo.value=$(ze.input.params.maxTime*1e3,1).toString(),this.value=$(e,2).toString()}," (beat): ",0,0,null,.1),Rh=G.createCheckbox(function(){ze.input.params.enabled=this.checked},Dh,Th,Sh);function ny(e){Rh[0].checked=ze.input.params.enabled,ze.input.params.specific==="difficulty"?(la.checked=!0,aa.checked=!1):(la.checked=!1,aa.checked=!0),za.value=(ze.input.params.minTime*1e3).toString(),xo.value=(ze.input.params.maxTime*1e3).toString(),e&&Lh(e)}const ze={name:Dh,description:Th,type:Ee.NOTE,order:{input:Re.NOTES_VISION_BLOCK,output:Le.NOTES_VISION_BLOCK},input:{params:{enabled:Sh,specific:"difficulty",minTime:wh,maxTime:Ch},ui:()=>G.createBlock(Rh,document.createElement("br"),aa,ZE,la,QE,document.createElement("br"),UE,za,ey,Ga,document.createElement("br"),ty,xo,iy,Oo),update:ny,adjustTime:Lh},run:ry};function Lh(e){Zt=e,Ga.value=$(Zt.toBeatTime(ze.input.params.minTime,!1),2).toString(),Oo.value=$(Zt.toBeatTime(ze.input.params.maxTime,!1),2).toString()}function Nh(){ze.input.params.specific=this.value}function oy(e){const{timeProcessor:t,njs:i}=e.beatmap,n=e.beatmap.noteContainer.filter(m=>m.type!==ve.ARC),{minTime:o,maxTime:r,specific:s}=ze.input.params,a=s==="time"?o:Mu[e.beatmap.info.difficulty].min,l=s==="time"?r:Math.min(t.toRealTime(i.hjd,!1),Mu[e.beatmap.info.difficulty].max);let u=null,f=null;const b=[];for(let m=0,g=n.length;m<g;m++){const E=n[m];u&&(E.data.customData[L.SECOND_TIME]-u.data.customData[L.SECOND_TIME]>=a&&E.data.customData[L.SECOND_TIME]-u.data.customData[L.SECOND_TIME]<=l?E.data.posX<xe.MIDDLE_RIGHT&&b.push(E):E.data.customData[L.SECOND_TIME]-u.data.customData[L.SECOND_TIME]>l&&(u=null)),f&&(E.data.customData[L.SECOND_TIME]-f.data.customData[L.SECOND_TIME]>=a&&E.data.customData[L.SECOND_TIME]-f.data.customData[L.SECOND_TIME]<=l?E.data.posX>xe.MIDDLE_LEFT&&b.push(E):E.data.customData[L.SECOND_TIME]-f.data.customData[L.SECOND_TIME]>l&&(f=null)),E.data.posY===ut.MIDDLE&&E.data.posX===xe.MIDDLE_LEFT&&(u=E),E.data.posY===ut.MIDDLE&&E.data.posX===xe.MIDDLE_RIGHT&&(f=E)}return b}function ry(e){const t=oy(e);return t.length?[{status:re.WARNING,label:"Vision block",type:te.TIME,value:t.map(i=>i.data)}]:[]}const xh=Object.freeze(Object.defineProperty({__proto__:null,acceptablePrec:fn,angleOffset:Ai,colorCheck:Hr,doubleDirectional:Yr,effectiveBPM:Vt,excessiveDouble:Lo,hammerHit:Xr,handclap:qr,hitboxInline:Kr,hitboxPath:Jr,hitboxReverseStair:Zr,hitboxStair:Qr,improperArc:Ur,improperChain:es,improperWindow:ts,inlineAngle:si,oneSaber:is,parallelNotes:ns,parity:No,shradoAngle:Mt,slowSlider:Jt,speedPause:ai,stackedNote:os,varySwing:rs,visionBlock:ze},Symbol.toStringTag,{value:"Module"})),Oh="2-wide Center Obstacle",Bh="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",kh=!0,Ah=.25;let Yn;const[sy,ja]=G.createNumber(function(){Qt.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=$(Qt.input.params.recovery*1e3,1).toString(),Yn&&(Wa.value=$(Yn.toBeatTime(Qt.input.params.recovery,!1),2).toString())},"recovery time (ms): ",$(Ah*1e3,1),0),[ay,Wa]=G.createNumber(function(){if(!Yn){this.value="0";return}let e=$(Math.abs(parseFloat(this.value)),2)||1;Qt.input.params.recovery=Yn.toRealTime(e,!1),ja.value=$(Qt.input.params.recovery*1e3,1).toString(),this.value=e.toString()}," (beat): ",0,0,.1),Ph=G.createCheckbox(function(){Qt.input.params.enabled=this.checked},Oh,Bh,kh);function ly(e){Ph[0].checked=Qt.input.params.enabled,ja.value=(Qt.input.params.recovery*1e3).toString(),e&&Mh(e)}const Qt={name:Oh,description:Bh,type:Ee.OBSTACLE,order:{input:Re.OBSTACLES_CENTER,output:Le.OBSTACLES_CENTER},input:{params:{enabled:kh,recovery:Ah},ui:()=>G.createBlock(Ph,document.createElement("br"),sy,ja,ay,Wa),update:ly,adjustTime:Mh},run:cy};function Mh(e){Yn=e,Wa.value=$(Yn.toBeatTime(Qt.input.params.recovery,!1),2).toString()}function Qi(e,t,i=0){return e.customData[L.SECOND_TIME]+e.customData[L.DURATION_SECOND_TIME]>t.customData[L.SECOND_TIME]+t.customData[L.DURATION_SECOND_TIME]+i}function uy(e){const{obstacles:t}=e.beatmap.data.difficulty,{recovery:i}=Qt.input.params,n=[];let o=new bt;o.customData[L.SECOND_TIME]=0,o.customData[L.DURATION_SECOND_TIME]=0;let r=new bt;r.customData[L.SECOND_TIME]=0,r.customData[L.DURATION_SECOND_TIME]=0;for(let s=0;s<t.length;s++){const a=t[s];a.posY<ut.TOP&&a.height>1&&(a.width>2&&(n.push(a),Qi(a,o)&&(o=a),Qi(a,r)&&(r=a)),a.width===2&&(a.posX===xe.LEFT&&Qi(a,o)&&(a.customData[L.SECOND_TIME]>r.customData[L.SECOND_TIME]-i&&a.customData[L.SECOND_TIME]<r.customData[L.SECOND_TIME]+r.customData[L.DURATION_SECOND_TIME]+i&&n.push(a),o=a),a.posX===xe.MIDDLE_LEFT&&(n.push(a),Qi(a,o)&&(o=a),Qi(a,r)&&(r=a)),a.posX===xe.MIDDLE_RIGHT&&Qi(a,r)&&(a.customData[L.SECOND_TIME]>o.customData[L.SECOND_TIME]-i&&a.customData[L.SECOND_TIME]<o.customData[L.SECOND_TIME]+o.customData[L.DURATION_SECOND_TIME]+i&&n.push(a),r=a)),a.width===1&&(a.posX===xe.MIDDLE_LEFT&&Qi(a,o)&&(a.customData[L.SECOND_TIME]>r.customData[L.SECOND_TIME]-i&&a.customData[L.SECOND_TIME]<r.customData[L.SECOND_TIME]+r.customData[L.DURATION_SECOND_TIME]+i&&n.push(a),o=a),a.posX===xe.MIDDLE_RIGHT&&Qi(a,r)&&(a.customData[L.SECOND_TIME]>o.customData[L.SECOND_TIME]-i&&a.customData[L.SECOND_TIME]<o.customData[L.SECOND_TIME]+o.customData[L.DURATION_SECOND_TIME]+i&&n.push(a),r=a)))}return n}function cy(e){const t=uy(e),{recovery:i}=Qt.input.params;return t.length?[{status:re.ERROR,label:`2-wide center obstacle (<${$(i*1e3)}ms)`,type:te.TIME,value:t}]:[]}const Ih="<15ms Obstacle",$h=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,Fh=!0,[Vh,fy]=G.createCheckbox(function(){Bo.input.params.enabled=this.checked},Ih,$h,Fh);function my(){Vh.checked=Bo.input.params.enabled}const Bo={name:Ih,description:$h,type:Ee.OBSTACLE,order:{input:Re.OBSTACLES_SHORT,output:Le.OBSTACLES_SHORT},input:{params:{enabled:Fh,minDuration:.015},ui:()=>G.createBlock(Vh,fy),update:my},run:py};function Ue(e,t,i=0){return e.customData[L.SECOND_TIME]+e.customData[L.DURATION_SECOND_TIME]>t.customData[L.SECOND_TIME]+t.customData[L.DURATION_SECOND_TIME]+i}function hy(e){const{obstacles:t}=e.beatmap.data.difficulty,{minDuration:i}=Bo.input.params,n=[];let o=new bt({time:Number.MIN_SAFE_INTEGER,customData:{[L.SECOND_TIME]:0,[L.DURATION_SECOND_TIME]:0}}),r=new bt({time:Number.MIN_SAFE_INTEGER,customData:{[L.SECOND_TIME]:0,[L.DURATION_SECOND_TIME]:0}}),s=new bt({time:Number.MIN_SAFE_INTEGER,customData:{[L.SECOND_TIME]:0,[L.DURATION_SECOND_TIME]:0}}),a=new bt({time:Number.MIN_SAFE_INTEGER,customData:{[L.SECOND_TIME]:0,[L.DURATION_SECOND_TIME]:0}});for(let l=0;l<t.length;l++){const u=t[l],f=u.customData[L.DURATION_SECOND_TIME];Ui(f,0)?n.push(u):u.posY===ut.BOTTOM&&u.height>2?u.width>2||u.width>1&&u.posX===1?(Ue(u,o)&&(f<i&&n.push(u),o=u),Ue(u,r)&&(f<i&&n.push(u),r=u)):u.width===2?u.posX===xe.LEFT?Ue(u,o)&&(f<i&&n.push(u),o=u):u.posX===xe.MIDDLE_RIGHT&&Ue(u,r)&&(f<i&&n.push(u),r=u):u.width===1&&(u.posX===xe.MIDDLE_LEFT?Ue(u,o)&&(f<i&&n.push(u),o=u):u.posX===xe.MIDDLE_RIGHT&&Ue(u,r)&&(f<i&&n.push(u),r=u)):u.posY===ut.TOP&&u.height>2&&f>0&&(u.width>2||u.width>1&&u.posX===xe.MIDDLE_LEFT?(Ue(u,s)&&(f<i&&Ue(u,o,i)&&Ue(u,s,i)&&n.push(u),s=u),Ue(u,a)&&(f<i&&Ue(u,r,i)&&Ue(u,a,i)&&n.push(u),a=u)):u.width===2?u.posX===xe.LEFT?Ue(u,s)&&(f<i&&Ue(u,o,i)&&Ue(u,s,i)&&n.push(u),s=u):u.posX===xe.MIDDLE_RIGHT&&Ue(u,a)&&(f<i&&Ue(u,r,i)&&Ue(u,a,i)&&n.push(u),a=u):u.width===1&&(u.posX===xe.MIDDLE_LEFT?Ue(u,s)&&(f<i&&Ue(u,o,i)&&Ue(u,s,i)&&n.push(u),s=u):u.posX===xe.MIDDLE_RIGHT&&Ue(u,a)&&(f<i&&Ue(u,r,i)&&Ue(u,a,i)&&n.push(u),a=u)))}return n}function py(e){const t=hy(e);return t.length?[{status:re.WARNING,label:"<15ms obstacle",type:te.TIME,value:t}]:[]}const zh="Unrankable Obstacle",Gh="Look for non-standard obstacle shape in playable space.",jh=!1,[Wh,dy]=G.createCheckbox(function(){ss.input.params.enabled=this.checked},zh,Gh,jh);function by(){Wh.checked=ss.input.params.enabled}const ss={name:zh,description:Gh,type:Ee.OBSTACLE,order:{input:Re.OBSTACLES_RANKABLE,output:Le.OBSTACLES_RANKABLE},input:{params:{enabled:jh},ui:()=>G.createBlock(Wh,dy),update:by},run:vy};function gy(e){const{obstacles:t}=e.beatmap.data.difficulty,i=[];for(let n=0;n<t.length;n++){const o=t[n];(o.posX<0&&o.posX+o.width>0||0<=o.posX&&o.posX<=3&&(o.posY===0&&o.height!==5||o.posY===2&&o.height!==3||o.posY===1||o.posX+o.width>4))&&i.push(o)}return i}function vy(e){const t=gy(e);return t.length?[{status:re.RANK,label:"Unrankable obstacle",type:te.TIME,value:t}]:[]}const Hh="Zero Obstacle",Yh="Look for obstacle with zero value.",Xh=!0,[qh,Ey]=G.createCheckbox(function(){as.input.params.enabled=this.checked},Hh,Yh,Xh);function yy(){qh.checked=as.input.params.enabled}const as={name:Hh,description:Yh,type:Ee.OBSTACLE,order:{input:Re.OBSTACLES_ZERO,output:Le.OBSTACLES_ZERO},input:{params:{enabled:Xh},ui:()=>G.createBlock(qh,Ey),update:yy},run:Dy};function _y(e){const{obstacles:t}=e.beatmap.data.difficulty;return t.filter(_a)}function Dy(e){const t=_y(e);return t.length?[{status:re.ERROR,label:"Zero value obstacle",type:te.TIME,value:t}]:[]}const Kh=Object.freeze(Object.defineProperty({__proto__:null,centerObstacle:Qt,rankableObstacle:ss,shortObstacle:Bo,zeroObstacle:as},Symbol.toStringTag,{value:"Module"})),Jh="Insufficient Lighting Event",Zh="Check if there is enough light event.",Qh=!0,[Uh,Ty]=G.createCheckbox(function(){ls.input.params.enabled=this.checked},Jh,Zh,Qh);function Sy(){Uh.checked=ls.input.params.enabled}const ls={name:Jh,description:Zh,type:Ee.EVENT,order:{input:Re.EVENTS_INSUFFICIENT_LIGHT,output:Le.EVENTS_INSUFFICIENT_LIGHT},input:{params:{enabled:Qh},ui:()=>G.createBlock(Uh,Ty),update:Sy},run:Cy};function wy(e,t){let i=0;for(let n=e.length-1;n>=0;n--)if(Do(e[n].type)&&!ha(e[n].value)&&(i++,i>10))return!0;return!1}function Cy(e){const t=e.beatmap.environment;if(!wy(e.beatmap.data.lightshow.basicEvents))switch(t){case"DefaultEnvironment":case"OriginsEnvironment":case"TriangleEnvironment":case"NiceEnvironment":case"BigMirrorEnvironment":case"DragonsEnvironment":case"KDAEnvironment":case"MonstercatEnvironment":case"CrabRaveEnvironment":case"PanicEnvironment":case"RocketEnvironment":case"GreenDayEnvironment":case"GreenDayGrenadeEnvironment":case"TimbalandEnvironment":case"FitBeatEnvironment":case"LinkinParkEnvironment":case"BTSEnvironment":case"KaleidoscopeEnvironment":case"InterscopeEnvironment":case"SkrillexEnvironment":case"BillieEnvironment":case"HalloweenEnvironment":case"GagaEnvironment":case"GlassDesertEnvironment":return[{status:re.RANK,label:"Insufficient light event",type:te.STRING,value:""}];default:return[{status:re.RANK,label:"Unknown light event",type:te.STRING,value:"v3 environment light should be manually checked"}]}return[]}const ep="Invalid Event Box",tp="Check for valid event box group usage.",ip=!0,[np,Ry]=G.createCheckbox(function(){us.input.params.enabled=this.checked},ep,tp,ip);function Ly(){np.checked=us.input.params.enabled}const us={name:ep,description:tp,type:Ee.EVENT,order:{input:Re.EVENTS_INVALID_EVENT_BOX,output:Le.EVENTS_INVALID_EVENT_BOX},input:{params:{enabled:ip},ui:()=>G.createBlock(np,Ry),update:Ly},run:xy},Iu={EDMEnvironment:{0:24,1:24,2:24,3:24,4:24,5:24,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:1,15:1,16:1,17:1},LizzoEnvironment:{0:40,1:16,2:16,3:16,4:16,5:16,6:1,7:1,8:12,9:12,10:12,11:6,12:6,13:14,14:14,15:4,16:4,17:3,18:3,19:14},PyroEnvironment:{0:3,1:3,2:5,3:5,4:3,5:12,6:48,7:48,8:4,9:4,10:3,11:3,12:10,13:10},TheSecondEnvironment:{0:15,1:24,2:12,3:12,4:12,5:12,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4},TheWeekndEnvironment:{0:4,1:4,2:4,3:4,4:8,5:4,6:4,7:12,8:1,9:6,10:25,11:25,12:25,13:25,14:25,15:25,16:25,17:25,18:25,19:25,20:3,21:3,22:8,23:8,29:3,30:3,31:3,32:3,33:3,34:3,35:3,36:3,37:6,38:6,40:2},RockMixtapeEnvironment:{0:5,1:5,2:10,3:10,4:10,5:10,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:3,15:10,16:5,17:5,18:24,19:24,20:12,21:12,22:8,23:8,24:36,25:3,26:36,27:3,28:5,29:2,30:16,31:4,32:4,33:4,34:4,35:2,36:2,37:2},WeaveEnvironment:{0:8,1:8,2:8,3:8,4:8,5:8,6:8,7:8,8:8,9:8,10:8,11:8,12:12,13:12,14:8,15:8},Dragons2Environment:{0:24,1:96,2:35,3:15,4:8,5:12,6:12,7:5,8:5,9:5,10:5,11:5,12:5},Panic2Environment:{0:7,1:7,2:7,3:7,4:8,5:8,6:24,7:24,8:24,9:6,10:6,11:6,12:6,13:14,14:14,15:2,16:28,17:28,18:1,19:1,20:12,21:1,22:12,23:1}};function Ny(e,t){const i=[],n=[];if(!Iu[t])return{defectID:[],defectFilter:[]};const o=t,r=Tn[o][1],s=[...e.lightColorEventBoxGroups,...e.lightRotationEventBoxGroups,...e.lightTranslationEventBoxGroups];for(const a of s){r.includes(a.id)||i.push(a);for(const l of a.boxes){const u=l.filter;u.type===Zu.STEP_AND_OFFSET&&u.p0>Iu[o][a.id]&&n.push(a)}}return{defectID:i,defectFilter:n}}function xy(e){const t=Ny(e.beatmap.data.lightshow,e.beatmap.environment),i=[];return t.defectID.length&&i.push({status:re.ERROR,label:"Invalid event box group ID",type:te.TIME,value:t.defectID}),t.defectFilter.length&&i.push({status:re.ERROR,label:"Invalid event box filter",type:te.TIME,value:t.defectFilter}),i}const op="Unlit Bomb",rp="Check for lighting around bomb.",sp=!0,[ap,Oy]=G.createCheckbox(function(){cs.input.params.enabled=this.checked},op,rp,sp);function By(){ap.checked=cs.input.params.enabled}const cs={name:op,description:rp,type:Ee.EVENT,order:{input:Re.EVENTS_UNLIT_BOMB,output:Le.EVENTS_UNLIT_BOMB},input:{params:{enabled:sp},ui:()=>G.createBlock(ap,Oy),update:By},run:Ay},ky=(e,t,i)=>{if(!t.length)return[];const n=[],o=Tn[i]?.[0]??Tn.DefaultEnvironment[0],r=t.filter(f=>Do(f.type)&&o.includes(f.type)).sort((f,b)=>f.type-b.type),s={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},a={};o.forEach(f=>a[f]=[[0,!1]]);const l=1,u=.25;for(let f=0,b=r.length;f<b;f++){const m=r[f];if((nc(m.value)||oc(m.value))&&s[m.type].state!=="on"){s[m.type]={state:"on",time:m.customData[L.SECOND_TIME],fadeTime:0};const g=a[m.type].find(E=>E[0]>=m.customData[L.SECOND_TIME]);g?(g[0]=m.customData[L.SECOND_TIME],g[1]=!0):a[m.type].push([m.customData[L.SECOND_TIME],!0])}if(rc(m.value)){s[m.type]={state:"off",time:m.customData[L.SECOND_TIME],fadeTime:l};const g=a[m.type].find(E=>E[0]>=m.customData[L.SECOND_TIME]);g?(g[0]=m.customData[L.SECOND_TIME],g[1]=!0):a[m.type].push([m.customData[L.SECOND_TIME],!0]),a[m.type].push([m.customData[L.SECOND_TIME]+l,!1])}((m?.floatValue??1)<.25||ha(m.value)||m.customData._color&&(typeof m.customData._color[3]=="number"&&m.customData._color[3]<.25||Math.max(m.customData._color[0],m.customData._color[1],m.customData._color[2])<.25)||m.customData.color&&(typeof m.customData.color[3]=="number"&&m.customData.color[3]<.25||Math.max(m.customData.color[0],m.customData.color[1],m.customData.color[2])<.25))&&s[m.type].state!=="off"&&(s[m.type]={state:"off",time:m.customData[L.SECOND_TIME],fadeTime:s[m.type].state==="on"?u:Math.min(u,s[m.type].fadeTime)},a[m.type].push([m.customData[L.SECOND_TIME]+(s[m.type].state==="on"?u:Math.min(u,s[m.type].fadeTime)),!1]))}for(const f in a)a[f].reverse();for(let f=0,b=e.length,m=!1;f<b;f++){const g=e[f];m=!1;for(const E in a){const v=a[E].find(y=>y[0]<=g.customData[L.SECOND_TIME]-.25);v&&(m=m||v[1])}m||n.push(g)}return n};function Ay(e){const t=ky(e.beatmap.data.difficulty.bombNotes,e.beatmap.data.lightshow.basicEvents,e.beatmap.environment);return t.length?[{status:re.WARNING,label:"Unlit bomb",type:te.TIME,value:t}]:[]}const lp=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:ls,invalidEventBox:us,unlitBomb:cs},Symbol.toStringTag,{value:"Module"})),up="Difficulty Label Check",cp="For ranking purpose, check difficulty label to fit rankability criteria.",fp=!0,[mp,Py]=G.createCheckbox(function(){fs.input.params.enabled=this.checked},up,cp,fp);function My(){mp.checked=fs.input.params.enabled}const fs={name:up,description:cp,type:Ee.OTHER,order:{input:Re.OTHERS_DIFFICULTY_LABEL,output:Le.OTHERS_DIFFICULTY_LABEL},input:{params:{enabled:fp},ui:()=>G.createBlock(mp,Py),update:My},run:Iy};function Iy(e){const t=e.beatmap.info.customData._difficultyLabel;return t&&t.length>30?[{type:te.STRING,label:`Difficulty label is too long (${t.length} characters)`,value:"exceeded 30 max characters by ranking criteria",status:re.RANK}]:[]}const hp="Hot Start",pp="Check for first interactive object starting from start time.",dp=!0,bp=1.5,[gp,$y]=G.createCheckbox(function(){mn.input.params.enabled=this.checked},hp+" (s): ",pp,dp),[Fy,vp]=G.createNumber(function(){mn.input.params.time=$(Math.abs(parseFloat(this.value)),3),this.value=mn.input.params.time.toString()},"",bp,0,null,.1);function Vy(){gp.checked=mn.input.params.enabled,vp.value=mn.input.params.time.toString()}const mn={name:hp,description:pp,type:Ee.OTHER,order:{input:Re.OTHERS_HOT_START,output:Le.OTHERS_HOT_START},input:{params:{enabled:dp,time:bp},ui:()=>G.createBlock(gp,$y,Fy,vp),update:Vy},run:zy};function zy(e){const{time:t}=mn.input.params,i=e.beatmap.timeProcessor.toRealTime(Da(e.beatmap.data));return i<t?[{type:te.STRING,label:"Hot start",value:`${$(i,2)}s`,status:re.WARNING}]:[]}const Ep="Invalid Object",yp="Validate beatmap object to be compatible with vanilla (ignores for modded).",_p=!0,[Dp,Gy]=G.createCheckbox(function(){ms.input.params.enabled=this.checked},Ep,yp,_p);function jy(){Dp.checked=ms.input.params.enabled}const ms={name:Ep,description:yp,type:Ee.OTHER,order:{input:Re.OTHERS_INVALID_OBJECT,output:Le.OTHERS_INVALID_OBJECT},input:{params:{enabled:_p},ui:()=>G.createBlock(Dp,Gy),update:jy},run:c_};function hs(e){return e.direction>=0&&e.direction<=8}function Wy(e){return hs(e)&&e.posX>=0&&e.posX<=3&&e.posY>=0&&e.posY<=2}function Hy(e){return!_a(e)&&!cc(e)}function Yy(e){return hs(e)&&e.posX>=0&&e.posX<=3&&e.posY>=0&&e.posY<=2}function Xy(e){return hs(e)&&!(va(e)||e.posX<0||e.posX>3||e.tailPosX<0||e.tailPosX>3||e.posX===e.tailPosX&&e.posY===e.tailPosY&&e.time===e.tailTime)}function qy(e){return hs(e)&&(!va(e)||e.posY>=0||e.posY<=2||e.tailPosY>=0||e.tailPosY<=2)}function Ky(e){return e.executionTime===0||e.executionTime===1}function Jy(e){return e.direction>=0&&e.direction<=9&&e.direction!==8}function Zy(e){return fa(e.type)&&e.value>=0&&!(!dr(e.type)&&e.value>12&&!pa(e.value))}function Qy(e){return(e.previous===0||e.previous===1)&&e.easing>=-1&&e.easing<=103&&e.color>=-1&&e.color<=2&&e.brightness>=0&&e.frequency>=0}function Uy(e){return e.events.every(Qy)&&(e.brightnessDistributionType===1||e.brightnessDistributionType===2)&&(e.affectFirst===0||e.affectFirst===1)}function e_(e){return e.boxes.every(Uy)}function t_(e){return(e.previous===0||e.previous===1)&&e.easing>=-1&&e.easing<=103&&e.loop>=0&&e.direction>=0&&e.direction<=2}function i_(e){return e.events.every(t_)&&(e.rotationDistributionType===1||e.rotationDistributionType===2)&&(e.axis===0||e.axis===1||e.axis===2)&&(e.flip===0||e.flip===1)&&(e.affectFirst===0||e.affectFirst===1)}function n_(e){return e.boxes.every(i_)}function o_(e){return(e.previous===0||e.previous===1)&&e.easing>=-1&&e.easing<=103}function r_(e){return e.events.every(o_)&&(e.gapDistributionType===1||e.gapDistributionType===2)&&(e.axis===0||e.axis===1||e.axis===2)&&(e.flip===0||e.flip===1)&&(e.affectFirst===0||e.affectFirst===1)}function s_(e){return e.boxes.every(r_)}function a_(e){return(e.previous===0||e.previous===1)&&e.easing>=-1&&e.easing<=103}function l_(e){return e.events.every(a_)&&(e.fxDistributionType===1||e.fxDistributionType===2)&&(e.affectFirst===0||e.affectFirst===1)}function u_(e){return e.boxes.every(l_)}function c_(e){const{colorNotes:t,bombNotes:i,obstacles:n,arcs:o,chains:r,rotationEvents:s}=e.beatmap.data.difficulty,{basicEvents:a,waypoints:l,lightColorEventBoxGroups:u,lightRotationEventBoxGroups:f,lightTranslationEventBoxGroups:b,fxEventBoxGroups:m}=e.beatmap.data.lightshow;let g=[],E=[],v=[],y=[],_=[],D=[];if(!e.beatmap.info.customData._requirements?.includes("Mapping Extensions"))if(e.beatmap.info.customData._requirements?.includes("Noodle Extensions")){const X=e.beatmap.rawVersion===2?hc:bc;g=t.filter(vc),E=n.filter(X),v=i.filter(gc),y=o.filter(E0),_=r.filter(y0)}else g=t.filter(X=>!Wy(X)),E=n.filter(X=>!Hy(X)),v=i.filter(X=>!Yy(X)),y=o.filter(X=>!Xy(X)),_=r.filter(X=>!qy(X)),D=s.filter(X=>!Ky(X));const C=l.filter(X=>!Jy(X)),O=a.filter(X=>!Zy(X)),x=u.filter(X=>!e_(X)),H=f.filter(X=>!n_(X)),F=b.filter(X=>!s_(X)),Z=m.filter(X=>!u_(X)),P=[];return g.length&&P.push({status:re.ERROR,label:"Invalid note",type:te.TIME,value:g}),v.length&&P.push({status:re.ERROR,label:"Invalid bomb",type:te.TIME,value:v}),y.length&&P.push({status:re.ERROR,label:"Invalid arc",type:te.TIME,value:y}),_.length&&P.push({status:re.ERROR,label:"Invalid chain",type:te.TIME,value:_}),E.length&&P.push({status:re.ERROR,label:"Invalid obstacle",type:te.TIME,value:E}),D.length&&P.push({status:re.ERROR,label:"Invalid rotation event",type:te.TIME,value:D}),C.length&&P.push({status:re.ERROR,label:"Invalid waypoint",type:te.TIME,value:C}),O.length&&P.push({status:re.ERROR,label:"Invalid event",type:te.TIME,value:O}),x.length&&P.push({status:re.ERROR,label:"Invalid light color event",type:te.TIME,value:x}),H.length&&P.push({status:re.ERROR,label:"Invalid light rotation event",type:te.TIME,value:H}),F.length&&P.push({status:re.ERROR,label:"Invalid light translation event",type:te.TIME,value:F}),Z.length&&P.push({status:re.ERROR,label:"Invalid FX event",type:te.TIME,value:Z}),P}const Tp="NJS Check",Sp="Check note jump speed for suitable value.",wp=!0,[Cp,f_]=G.createCheckbox(function(){ps.input.params.enabled=this.checked},Tp,Sp,wp);function m_(){Cp.checked=ps.input.params.enabled}const ps={name:Tp,description:Sp,type:Ee.OTHER,order:{input:Re.OTHERS_NJS,output:Le.OTHERS_NJS},input:{params:{enabled:wp},ui:()=>G.createBlock(Cp,f_),update:m_},run:h_};function h_(e){const{njs:t,timeProcessor:i}=e.beatmap,n=[];return e.beatmap.info.njs===0&&n.push({type:te.STRING,label:"Unset NJS",value:"fallback NJS is used",status:re.ERROR}),t.value>23&&n.push({type:te.STRING,label:`NJS is too high (${$(t.value,2)})`,value:"use lower whenever possible",status:re.WARNING}),t.value<3&&n.push({type:te.STRING,label:`NJS is too low (${$(t.value,2)})`,value:"timing is less significant below this",status:re.WARNING}),t.jd>36&&n.push({type:te.STRING,label:"Very high jump distance",value:`${$(t.jd,2)}`,status:re.WARNING}),t.jd<18&&n.push({type:te.STRING,label:"Very low jump distance",value:`${$(t.jd,2)}`,status:re.WARNING}),t.jd>t.calcJdOptimal()[1]&&n.push({type:te.STRING,label:`High jump distance warning (>${$(t.calcJdOptimal()[1],2)})`,value:"NJS & offset may be uncomfortable to play",status:re.WARNING}),i.toRealTime(t.hjd,!1)<.42&&n.push({type:te.STRING,label:`Very quick reaction time (${$(i.toRealTime(t.hjd,!1)*1e3)}ms)`,value:"may lead to suboptimal gameplay",status:re.WARNING}),t.calcHjd(0)+t.offset<Kt.HJD_MIN&&n.push({type:te.STRING,label:"Unnecessary negative offset",value:`will not drop below ${Kt.HJD_MIN}`,status:re.WARNING}),n}const Rp="Quick Outro",Lp="Check for last interactive or light event before end.",Np=!0,xp=2,Op=15,[Bp,p_]=G.createCheckbox(function(){Di.input.params.enabled=this.checked},Rp+" (s): ",Lp,Np),[d_,kp]=G.createNumber(function(){Di.input.params.min=$(Math.abs(parseFloat(this.value)),3),this.value=Di.input.params.min.toString()},"Minimum Interactive Time: ",xp,0,null,.1),[b_,Ap]=G.createNumber(function(){Di.input.params.max=$(Math.abs(parseFloat(this.value)),3),this.value=Di.input.params.max.toString()},"Maximum Final Object Time: ",Op,0,null,.1);function g_(){Bp.checked=Di.input.params.enabled,kp.value=Di.input.params.min.toString(),Ap.value=Di.input.params.max.toString()}const Di={name:Rp,description:Lp,type:Ee.OTHER,order:{input:Re.OTHERS_HOT_START,output:Le.OTHERS_HOT_START},input:{params:{enabled:Np,min:xp,max:Op},ui:()=>G.createBlock(G.createBlock(Bp,p_),G.createBlock(d_,kp),G.createBlock(b_,Ap)),update:g_},run:v_};function v_(e){const{audioDuration:t,mapDuration:i}=e,n=t||i||0;if(n===0)return[];const o=e.beatmap.timeProcessor.toRealTime(Vn(e.beatmap.data)),r=Math.max(o,e.beatmap.data.lightshow.basicEvents.at(-1)?.customData[L.SECOND_TIME]||0,e.beatmap.data.lightshow.waypoints.at(-1)?.customData[L.SECOND_TIME]||0,e.beatmap.data.lightshow.lightColorEventBoxGroups.at(-1)?.customData[L.SECOND_TIME]||0,e.beatmap.data.lightshow.lightRotationEventBoxGroups.at(-1)?.customData[L.SECOND_TIME]||0,e.beatmap.data.lightshow.lightTranslationEventBoxGroups.at(-1)?.customData[L.SECOND_TIME]||0,e.beatmap.data.lightshow.fxEventBoxGroups.at(-1)?.customData[L.SECOND_TIME]||0),{min:s,max:a}=Di.input.params,l=[];return n-s<=o&&l.push({status:re.RANK,label:"Quick outro",type:te.STRING,value:`${$(n-o,2)}s`}),n-a>r&&l.push({status:re.RANK,label:"Empty outro",type:te.STRING,value:`${$(n-r,2)}s`}),l}const Pp="Outside Playable Object",Mp="Look for any object starting before and after song timer.",Ip=!0,[$p,E_]=G.createCheckbox(function(){ds.input.params.enabled=this.checked},Pp,Mp,Ip);function y_(){$p.checked=ds.input.params.enabled}const ds={name:Pp,description:Mp,type:Ee.OTHER,order:{input:Re.OTHERS_OUTSIDE_PLAYABLE,output:Le.OTHERS_OUTSIDE_PLAYABLE},input:{params:{enabled:Ip},ui:()=>G.createBlock($p,E_),update:y_},run:__};function $t(e,t,i){t.length&&t[0].time<0&&i.push({status:re.ERROR,label:e+"(s) before start time",type:te.TIME,value:t.filter(n=>n.time<0)})}function Ft(e,t,i,n){t.length&&t[t.length-1].customData[L.SECOND_TIME]>i&&n.push({status:re.ERROR,label:e+"(s) after end time",type:te.TIME,value:t.filter(o=>o.customData[L.SECOND_TIME]>i)})}function __(e){const t=e.audioDuration,{colorNotes:i,bombNotes:n,obstacles:o,arcs:r,chains:s,njsEvents:a,rotationEvents:l}=e.beatmap.data.difficulty,{basicEvents:u,colorBoostEvents:f,waypoints:b,lightColorEventBoxGroups:m,lightRotationEventBoxGroups:g,lightTranslationEventBoxGroups:E,fxEventBoxGroups:v}=e.beatmap.data.lightshow,y=[];if(t){let _=t;$t("Note",i,y),$t("Bomb",n,y),$t("Obstacle",o,y),$t("Arc",r,y),$t("Chain",s,y),$t("Rotation Event",l,y),$t("NJS Event",a,y),$t("Basic Event",u,y),$t("Color Boost Event",f,y),$t("Waypoint",b,y),$t("Light Color Event Box Group",m,y),$t("Light Rotation Event Box Group",g,y),$t("Light Translation Event Box Group",E,y),$t("FX Event Box Group",v,y),Ft("Note",i,_,y),Ft("Bomb",n,_,y),Ft("Obstacle",o,_,y),Ft("Arc",r,_,y),Ft("Chain",s,_,y),Ft("Rotation Event",l,_,y),Ft("NJS Event",a,_,y),Ft("Basic Event",u,_,y),Ft("Color Boost Event",f,_,y),Ft("Waypoint",b,_,y),Ft("Light Color Event Box Group",m,_,y),Ft("Light Rotation Event Box Group",g,_,y),Ft("Light Translation Event Box Group",E,_,y),Ft("FX Event Box Group",v,_,y)}return y}const Fp="Variable NJS",Vp="Look for appropriate variable NJS by change speed and relative NJS from base.",zp=!1,[Gp,D_]=G.createCheckbox(function(){bs.input.params.enabled=this.checked},Fp,Vp,zp);function T_(){Gp.checked=bs.input.params.enabled}const bs={name:Fp,description:Vp,type:Ee.OTHER,order:{input:Re.OTHERS_NJS,output:Le.OTHERS_NJS},input:{params:{enabled:zp},ui:()=>G.createBlock(Gp,D_),update:T_},run:S_};function S_(e){const{njs:t}=e.beatmap,i=e.beatmap.data.difficulty.njsEvents,n=[],o=i.filter(u=>!u.previous&&t.value+u.value<4);o.length&&n.push({status:re.WARNING,label:"Very slow vNJS",type:te.TIME,value:o});const r=i.filter(u=>!u.previous&&t.value+u.value>24);r.length&&n.push({status:re.WARNING,label:"Very high vNJS",type:te.TIME,value:r});let s=t.value,a=0;const l=[];for(const u of i){if(u.previous||!u.time)continue;const f=u.customData[L.SECOND_TIME]-a,m=(t.value+u.value-s)/f;Math.abs(m)>2&&l.push(u),a=u.customData[L.SECOND_TIME],s=t.value+u.value}return l.length&&n.push({status:re.WARNING,label:"Quick vNJS change",type:te.TIME,value:l}),n}const jp=Object.freeze(Object.defineProperty({__proto__:null,difficultyLabel:fs,hotStart:mn,invalidObject:ms,njs:ps,outro:Di,outsidePlayable:ds,vnjs:bs},Symbol.toStringTag,{value:"Module"}));class Xt{static#e;static#i;static#t;static#n;static init(){Xt.#e=document.querySelector("#tabs__info"),Xt.#i=document.querySelector("#tabs__checks"),Xt.#t=document.querySelector("#tabs__stats"),Xt.#n=document.querySelector("#tabs__settings")}static showMain(t){Xt.#e.checked=t==="info",Xt.#i.checked=t==="checks",Xt.#t.checked=t==="stats",Xt.#n.checked=t==="settings"}static create(t,i,n,o,r,s){const a=document.createElement("div");a.className="tabs__container";const l=document.createElement("input");l.className="tabs__radio",l.type="radio",l.id=t,l.name=n,l.value=o,l.checked=r,l.addEventListener("change",s),a.appendChild(l);const u=document.createElement("label");u.className="tabs__label tabs__label-block unselectable",u.htmlFor=t;const f=document.createElement("div"),b=i.split(`
`);for(let m=0;m<b.length;m++){const g=b[m],E=document.createElement("span");E.textContent=g,f.appendChild(E),m!==b.length-1&&f.appendChild(document.createElement("br"))}return u.appendChild(f),a.appendChild(u),a}}var xi,jt,_n,tn,_i,lo,Wp,Hp;const Ce=class Ce{static init(){Nn(Ce,xi,document.querySelector("#select-characteristic")),Nn(Ce,jt,document.querySelector("#select-difficulty")),Ce.reset()}static reset(){Ce.populateSelectCharacteristic()}static populateSelectCharacteristic(t){var o,r;for(;et(Ce,xi).firstChild;)et(Ce,xi).removeChild(et(Ce,xi).firstChild);for(Nn(Ce,_n,[]);et(Ce,jt).firstChild;)et(Ce,jt).removeChild(et(Ce,jt).firstChild);if(Nn(Ce,tn,[]),!t){const s=document.createElement("div");s.className="selection__content";const a=document.createElement("span");a.textContent="Empty",s.appendChild(a),et(Ce,xi).appendChild(s),dn(o=Ce,_i,lo).call(o);return}let i=!0;const n=new Set;if(t.difficulties.toSorted((s,a)=>Uo[s.characteristic]-Uo[a.characteristic]).forEach(s=>{var f;if(n.has(s.characteristic))return;n.add(s.characteristic);const a=t.customData._characteristics?.find(b=>b.characteristic===s.characteristic),l=a?`${a.label}
(${al[s.characteristic]||s.characteristic})`:al[s.characteristic]||s.characteristic,u=Xt.create(`select-${s.characteristic}`,l,"select-characteristic",s.characteristic,i,dn(Ce,_i,Wp));et(Ce,_n).push(u.firstChild),et(Ce,xi).appendChild(u),i&&(dn(f=Ce,_i,lo).call(f,s.characteristic),i=!1)}),et(Ce,_n).length===0){const s=document.createElement("div");s.className="selection__content";const a=document.createElement("span");a.textContent="Empty",s.appendChild(a),et(Ce,xi).appendChild(s),dn(r=Ce,_i,lo).call(r)}}static getSelectedCharacteristic(){return et(Ce,_n).filter(t=>t.checked)[0]?.value??null}static getSelectedDifficulty(){return et(Ce,tn).filter(t=>t.checked)[0]?.value??null}};xi=new WeakMap,jt=new WeakMap,_n=new WeakMap,tn=new WeakMap,_i=new WeakSet,lo=function(t){const i=be.data.info;let n=Ce.getSelectedDifficulty();for(;et(Ce,jt).firstChild;)et(Ce,jt).removeChild(et(Ce,jt).firstChild);if(Nn(Ce,tn,[]),!t||!i){const r=document.createElement("div");r.className="selection__content";const s=document.createElement("span");s.textContent="Empty",r.appendChild(s),et(Ce,jt).appendChild(r);return}const o=i.difficulties.findIndex(r=>r.difficulty===n&&r.characteristic===t);for(let r=0;r<i.difficulties.length;r++){const s=i.difficulties[r];if(t!==s.characteristic)continue;const a=s.customData._difficultyLabel?`${s.customData._difficultyLabel}
(${nn[s.difficulty]||s.difficulty})`:nn[s.difficulty]||s.difficulty,l=Xt.create(`select-${s.difficulty}`,a,"select-difficulty",s.difficulty,o===-1||r===o,dn(Ce,_i,Hp));if(et(Ce,tn).push(l.firstChild),et(Ce,jt).appendChild(l),o===-1||r===o){const u=be.data.beatmaps.find(f=>f.info.difficulty===s.difficulty&&f.info.characteristic===i.difficulties[r].characteristic);if(!u)throw new Error("missing data");Sn.setDiffInfoTable(be.data.info,u),Ce.selectionOnChangeHandlers.forEach(f=>f(s.characteristic,s.difficulty))}}if(et(Ce,tn).length===0){const r=document.createElement("div");r.className="selection__content";const s=document.createElement("span");s.textContent="Empty",r.appendChild(s),et(Ce,jt).appendChild(r)}},Wp=function(t){var o;const i=t.target,n=be.data.info?.difficulties.find(r=>r.characteristic===i.value);dn(o=Ce,_i,lo).call(o,n?.characteristic)},Hp=function(t){const i=t.target,n=be.data.info?.difficulties.find(r=>r.characteristic===Ce.getSelectedCharacteristic());if(!n)throw new Error("aaaaaaaaaaaaaaaaaaa");const o=be.data.beatmaps?.find(r=>r.info.difficulty===i.value&&r.info.characteristic===n.characteristic);o&&(Sn.setDiffInfoTable(be.data.info,o),Ce.selectionOnChangeHandlers.forEach(r=>r(o.info.characteristic,o.info.difficulty)))},Ln(Ce,_i),Ln(Ce,xi),Ln(Ce,jt),Ln(Ce,_n,[]),Ln(Ce,tn,[]),Ce.selectionOnChangeHandlers=[];let st=Ce;const Yp={aprilFools:{params:{enabled:!0}},audio:{params:{enabled:!0}},coverImage:{params:{enabled:!0}},previewTime:{params:{enabled:!0}},progression:{params:{enabled:!1,"Expert+":!1,ExpertPlus:!1,Expert:!1,Hard:!1,Normal:!1,Easy:!1}},zip:{params:{enabled:!0}},acceptablePrec:{params:{enabled:!0,prec:[8,6]}},angleOffset:{params:{enabled:!1,Rankable:!1,Negative:!1,Excess:!1,"Ignore Snap":!0}},colorCheck:{params:{enabled:!0}},doubleDirectional:{params:{enabled:!0}},effectiveBPM:{params:{enabled:!0,ebpmThres:450,ebpmsThres:350}},excessiveDouble:{params:{enabled:!0,threshold:.6}},hammerHit:{params:{enabled:!0}},handclap:{params:{enabled:!0}},hitboxInline:{params:{enabled:!0}},hitboxPath:{params:{enabled:!0}},hitboxReverseStair:{params:{enabled:!0}},hitboxStair:{params:{enabled:!0}},improperArc:{params:{enabled:!0}},improperChain:{params:{enabled:!0}},improperWindow:{params:{enabled:!0}},inlineAngle:{params:{enabled:!0,maxTime:.15}},oneSaber:{params:{enabled:!0}},parallelNotes:{params:{enabled:!0}},parity:{params:{enabled:!1,warningThres:90,errorThres:45,allowedRot:90}},shradoAngle:{params:{enabled:!0,distance:1,maxTime:.25}},slowSlider:{params:{enabled:!0,minSpeed:.025}},speedPause:{params:{enabled:!1,maxTime:.075}},stackedNote:{params:{enabled:!0}},varySwing:{params:{enabled:!0}},visionBlock:{params:{enabled:!0,specific:"difficulty",minTime:.1,maxTime:.5}},centerObstacle:{params:{enabled:!0,recovery:.25}},rankableObstacle:{params:{enabled:!1}},shortObstacle:{params:{enabled:!0,minDuration:.015}},zeroObstacle:{params:{enabled:!0}},insufficientLight:{params:{enabled:!0}},invalidEventBox:{params:{enabled:!0}},unlitBomb:{params:{enabled:!0}},difficultyLabel:{params:{enabled:!0}},hotStart:{params:{enabled:!0,time:1.5}},invalidObject:{params:{enabled:!0}},njs:{params:{enabled:!0}},outro:{params:{enabled:!1,min:2,max:15}},outsidePlayable:{params:{enabled:!0}},vnjs:{params:{enabled:!0}}},Xp={aprilFools:{params:{enabled:!0}},audio:{params:{enabled:!1}},coverImage:{params:{enabled:!0}},previewTime:{params:{enabled:!0}},progression:{params:{enabled:!1,"Expert+":!1,ExpertPlus:!1,Expert:!1,Hard:!1,Normal:!1,Easy:!1}},zip:{params:{enabled:!0}},acceptablePrec:{params:{enabled:!0,prec:[8,6]}},angleOffset:{params:{enabled:!1,Rankable:!1,Negative:!1,Excess:!1,"Ignore Snap":!1}},colorCheck:{params:{enabled:!0}},doubleDirectional:{params:{enabled:!0}},effectiveBPM:{params:{enabled:!0,ebpmThres:450,ebpmsThres:350}},excessiveDouble:{params:{enabled:!0,threshold:.6}},hammerHit:{params:{enabled:!0}},handclap:{params:{enabled:!0}},hitboxInline:{params:{enabled:!0}},hitboxPath:{params:{enabled:!0}},hitboxReverseStair:{params:{enabled:!0}},hitboxStair:{params:{enabled:!0}},improperArc:{params:{enabled:!0}},improperChain:{params:{enabled:!0}},improperWindow:{params:{enabled:!0}},inlineAngle:{params:{enabled:!0,maxTime:.25}},oneSaber:{params:{enabled:!0}},parallelNotes:{params:{enabled:!0}},parity:{params:{enabled:!0,warningThres:90,errorThres:45,allowedRot:90}},shradoAngle:{params:{enabled:!0,distance:1,maxTime:.4}},slowSlider:{params:{enabled:!0,minSpeed:.02}},speedPause:{params:{enabled:!1,maxTime:.075}},stackedNote:{params:{enabled:!0}},varySwing:{params:{enabled:!0}},visionBlock:{params:{enabled:!0,specific:"time",minTime:.1,maxTime:.75}},centerObstacle:{params:{enabled:!0,recovery:.4}},rankableObstacle:{params:{enabled:!1}},shortObstacle:{params:{enabled:!0,minDuration:.015}},zeroObstacle:{params:{enabled:!0}},insufficientLight:{params:{enabled:!0}},invalidEventBox:{params:{enabled:!0}},unlitBomb:{params:{enabled:!0}},difficultyLabel:{params:{enabled:!1}},hotStart:{params:{enabled:!0,time:1.5}},invalidObject:{params:{enabled:!0}},njs:{params:{enabled:!0}},outro:{params:{enabled:!0,min:2,max:15}},outsidePlayable:{params:{enabled:!0}},vnjs:{params:{enabled:!0}}},Ha={aprilFools:{params:N(Yc.input.params)},audio:{params:N(zr.input.params)},coverImage:{params:N(Gr.input.params)},previewTime:{params:N(jr.input.params)},progression:{params:N(wn.input.params)},zip:{params:N(Wr.input.params)},acceptablePrec:{params:N(fn.input.params)},angleOffset:{params:N(Ai.input.params)},colorCheck:{params:N(Hr.input.params)},doubleDirectional:{params:N(Yr.input.params)},effectiveBPM:{params:N(Vt.input.params)},excessiveDouble:{params:N(Lo.input.params)},hammerHit:{params:N(Xr.input.params)},handclap:{params:N(qr.input.params)},hitboxInline:{params:N(Kr.input.params)},hitboxPath:{params:N(Jr.input.params)},hitboxReverseStair:{params:N(Zr.input.params)},hitboxStair:{params:N(Qr.input.params)},improperArc:{params:N(Ur.input.params)},improperChain:{params:N(es.input.params)},improperWindow:{params:N(ts.input.params)},inlineAngle:{params:N(si.input.params)},oneSaber:{params:N(is.input.params)},parallelNotes:{params:N(ns.input.params)},parity:{params:N(No.input.params)},shradoAngle:{params:N(Mt.input.params)},slowSlider:{params:N(Jt.input.params)},speedPause:{params:N(ai.input.params)},stackedNote:{params:N(os.input.params)},varySwing:{params:N(rs.input.params)},visionBlock:{params:N(ze.input.params)},centerObstacle:{params:N(Qt.input.params)},rankableObstacle:{params:N(ss.input.params)},shortObstacle:{params:N(Bo.input.params)},zeroObstacle:{params:N(as.input.params)},insufficientLight:{params:N(ls.input.params)},invalidEventBox:{params:N(us.input.params)},unlitBomb:{params:N(cs.input.params)},difficultyLabel:{params:N(fs.input.params)},hotStart:{params:N(mn.input.params)},invalidObject:{params:N(ms.input.params)},njs:{params:N(ps.input.params)},outro:{params:N(Di.input.params)},outsidePlayable:{params:N(ds.input.params)},vnjs:{params:N(bs.input.params)}},fo=N(Ha);(function(){if(localStorage==null)return;const t=localStorage.getItem("checks");if(t){const i=JSON.parse(t);if(!i)return;for(const n in fo){const o=n;typeof fo[o]==typeof i[o]&&(fo[o]=i[o])}}})();const qp={aprilFools:{params:{enabled:!0}},audio:{params:{enabled:!0}},coverImage:{params:{enabled:!0}},previewTime:{params:{enabled:!0}},progression:{params:{enabled:!0,"Expert+":!0,ExpertPlus:!0,Expert:!0,Hard:!0,Normal:!0,Easy:!0}},zip:{params:{enabled:!0}},acceptablePrec:{params:{enabled:!0,prec:[8,6]}},angleOffset:{params:{enabled:!0,Rankable:!0,Negative:!1,Excess:!1,"Ignore Snap":!1}},colorCheck:{params:{enabled:!0}},doubleDirectional:{params:{enabled:!0}},effectiveBPM:{params:{enabled:!0,ebpmThres:450,ebpmsThres:350}},excessiveDouble:{params:{enabled:!0,threshold:.6}},hammerHit:{params:{enabled:!0}},handclap:{params:{enabled:!0}},hitboxInline:{params:{enabled:!0}},hitboxPath:{params:{enabled:!0}},hitboxReverseStair:{params:{enabled:!0}},hitboxStair:{params:{enabled:!0}},improperArc:{params:{enabled:!0}},improperChain:{params:{enabled:!0}},improperWindow:{params:{enabled:!0}},inlineAngle:{params:{enabled:!0,maxTime:.15}},oneSaber:{params:{enabled:!0}},parallelNotes:{params:{enabled:!0}},parity:{params:{enabled:!1,warningThres:90,errorThres:45,allowedRot:90}},shradoAngle:{params:{enabled:!1,distance:1,maxTime:.15}},slowSlider:{params:{enabled:!0,minSpeed:.025}},speedPause:{params:{enabled:!1,maxTime:.075}},stackedNote:{params:{enabled:!0}},varySwing:{params:{enabled:!0}},visionBlock:{params:{enabled:!0,specific:"difficulty",minTime:.1,maxTime:.5}},centerObstacle:{params:{enabled:!0,recovery:.25}},rankableObstacle:{params:{enabled:!0}},shortObstacle:{params:{enabled:!0,minDuration:.015}},zeroObstacle:{params:{enabled:!0}},insufficientLight:{params:{enabled:!0}},invalidEventBox:{params:{enabled:!0}},unlitBomb:{params:{enabled:!0}},difficultyLabel:{params:{enabled:!0}},hotStart:{params:{enabled:!0,time:1.5}},invalidObject:{params:{enabled:!0}},njs:{params:{enabled:!0}},outro:{params:{enabled:!0,min:2,max:15}},outsidePlayable:{params:{enabled:!0}},vnjs:{params:{enabled:!1}}},uo={BeatLeader:Yp,Beginner:Xp,Custom:fo,Default:Ha,ScoreSaber:qp},$u={BeatLeader:N(Yp),Beginner:N(Xp),Custom:N(fo),Default:N(Ha),ScoreSaber:N(qp)};function Kp(){return[...Object.values(xh),...Object.values(Kh),...Object.values(lp),...Object.values(jp),...Object.values(bf)]}const mo={...xh,...Kh,...lp,...jp,...bf};function w_(e){const t=st.getSelectedCharacteristic(),i=st.getSelectedDifficulty(),n=be.data.beatmaps?.find(o=>o.info.characteristic===t&&o.info.difficulty===i);for(const o in e){const r=o;mo[r].input.params=e[r].params??N(uo.Default[r].params)??mo[r].input.params,mo[r].input.update?.(n?.timeProcessor)}}function C_(e){for(const t in mo){const i=mo[t];i.input.adjustTime&&i.input.adjustTime(e)}}function Jp(e,t){switch(t){case re.RANK:e='<span title="Ranking: for rankability reason."> 🚧 </span>'+e;break;case re.ERROR:e='<span title="Error: should be fixed unless you know what you are doing."> ❌ </span>'+e;break;case re.WARNING:e='<span title="Warning: not necessarily needed to be fixed, worth considering."> ❗ </span>'+e;break;case re.INFO:e='<span title="Info: no action necessary, take note."> ⚠️ </span>'+e;break}return e}function Fu(e,t,i){const n=document.createElement("div");return e=Jp(e,i),t?n.innerHTML=`<b>${e}:</b> ${t}`:n.innerHTML=`<b>${e}</b>`,n}function R_(e,t,i){return t===0||e.time!==i[t-1].time}function L_(e,t,i){const n=document.createElement("div");return ue.props.deduplicateTime&&(t=t.filter(R_)),e=Jp(e,i),n.innerHTML=`<b>${e} [${t.length}]:</b> ${t.map(o=>{switch(ue.props.beatNumbering){case"realtime":return`<span title="Beat ${$(o.customData[L.BEAT_TIME],ue.props.rounding)}">${yi(o.customData[L.SECOND_TIME])}</span>`;case"realtimems":return`<span title="Beat ${$(o.customData[L.BEAT_TIME],ue.props.rounding)}">${Xo(o.customData[L.SECOND_TIME])}</span>`;case"jsontime":return`<span title="Time ${Xo(o.customData[L.SECOND_TIME])}">${$(o.time,ue.props.rounding)}</span>`;case"beattime":default:return`<span title="Time ${Xo(o.customData[L.SECOND_TIME])}">${$(o.customData[L.BEAT_TIME],ue.props.rounding)}</span>`}}).join(", ")}`,n}class tt{static#e;static#i;static#t;static init(){tt.#e=document.querySelector(".checks__preset"),tt.#i=document.querySelector(".checks__preset-reset"),tt.#t=document.querySelector(".checks__preset-save"),tt.#e.addEventListener("change",tt.#n),tt.#i.addEventListener("click",tt.#s),tt.#t.addEventListener("click",tt.#a),ue.props.checks.persistent&&tt.#e.querySelector(`option[value="${ue.props.checks.preset}"]`)?tt.#e.value=ue.props.checks.preset:tt.#e.value=tt.#e.options[0].value,tt.#n()}static#n(){const t=tt.#e.value;ue.props.checks.persistent&&(ue.props.checks.preset=t,ue.save()),tt.#t.disabled=t!=="Custom",w_(uo[t])}static#s(){const t=tt.#e.value;t==="Custom"?uo[t]=N($u.Default):uo[t]=N($u[t]),tt.#n()}static#a(){tt.#e.value==="Custom"&&tt.#r()}static#r(){localStorage&&localStorage.setItem("checks",JSON.stringify(uo.Custom))}}class ho{static#e;static init(){ho.#e=document.querySelector(".checks__output-button"),ho.#e.addEventListener("click",ho.#i)}static#i(){const t=st.getSelectedCharacteristic(),i=st.getSelectedDifficulty();if(!t||!i)return;const n=be.data.analysis?.beatmap.find(f=>f.difficulty===i&&f.characteristic===t);if(!n)return;const o={Easy:"3cb472",Normal:"57b0f4",Hard:"ff6347",Expert:"c02a43",ExpertPlus:"8f48db","Expert+":"8f48db"},r=ke(qt(ys(0,360),ys(.6,.8),ys(.75,.875),"hsva")).slice(1).toUpperCase(),s={name:"Map Check Auto-generated",difficulty:i,characteristic:t,color:o[i]??r,bookmarks:n.output.filter(f=>f.type===te.TIME).flatMap(f=>{const b=f;return b.value.map(m=>({beat:m.time,label:b.label,text:""}))}).sort((f,b)=>f.beat-b.beat)},a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),l=URL.createObjectURL(a),u=document.createElement("a");u.href=l,u.download=`MC.${t}.${i}.bookmarks.dat`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l)}}function En(e){return["checks",e]}const Zp=Kp().sort((e,t)=>e.order.output-t.order.output);function Qp(){be.data.analysis={general:{output:[]},beatmap:[]}}function Up(){const e=be.data.info;if(!e)return se.tError(En("checkGeneral"),"Could not analyse, missing map info"),[];be.data.analysis||Qp();const t=be.data.analysis?.general;se.tInfo(En("checkGeneral"),"Analysing general");const i=[];return Zp.filter(n=>n.type===Ee.GENERAL).forEach(n=>{if(n.input.params.enabled)try{const o=n.run({audioDuration:be.data.duration??null,mapDuration:0,beatmap:null,info:e});i.push(...o)}catch(o){se.tError(En("checkGeneral"),o)}}),t&&(t.output=i),i}function ed(e,t){const i=be.data.info;if(!i)return se.tError(En("checkDifficulty"),"Could not analyse, missing map info"),[];be.data.analysis||Qp();const n=be.data.beatmaps?.find(s=>s.info.characteristic===e&&s.info.difficulty===t);if(!n)return se.tError(En("checkDifficulty"),"Could not analyse, missing map data"),[];se.tInfo(En("checkDifficulty"),`Analysing ${e} ${t}`);const o=[];Zp.filter(s=>s.type!==Ee.GENERAL).forEach(s=>{if(s.input.params.enabled)try{const a=s.run({audioDuration:be.data.duration??null,mapDuration:n.timeProcessor.toRealTime(Vn(n.data)),beatmap:n,info:i});o.push(...a)}catch(a){se.tError(En("runDifficulty"),a)}});const r=be.data.analysis?.beatmap.find(s=>s.difficulty===t&&s.characteristic===e);return r?r.output=o:be.data.analysis?.beatmap.push({characteristic:e,difficulty:t,output:o}),o}function td(){be.data.beatmaps?.forEach(e=>ed(e.info.characteristic,e.info.difficulty))}const ro="UI Checks: ";class Te{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o;static#l;static#u;static#c;static init(){ho.init(),tt.init(),Te.#e=document.querySelectorAll(".difficulty__label"),Te.#i=document.querySelector(".checks__note-content"),Te.#t=document.querySelector(".checks__obstacle-content"),Te.#n=document.querySelector(".checks__event-content"),Te.#s=document.querySelector(".checks__other-content"),Te.#a=document.querySelector(".checks__general-content"),Te.#r=document.querySelector(".checks__output-diff"),Te.#o=document.querySelector(".checks__output-general"),Te.#l=document.querySelector(".checks__apply-this"),Te.#u=document.querySelector(".checks__apply-all"),Te.#c=document.querySelector(".checks__apply-general"),Te.#l.addEventListener("click",Te.#h),Te.#u.addEventListener("click",Te.#p),Te.#c.addEventListener("click",Te.#d),Te.populateTool(),st.selectionOnChangeHandlers.push(Te.displayOutputDifficulty)}static reset(){Te.#m(),Te.setDifficultyLabel("Difficulty Label")}static displayOutputGeneral(){const t=be.data.analysis?.general;if(!t){Te.#o.textContent="ERROR: could not find analysis for general";return}if(!t.output){Te.#o.textContent="ERROR: could not find HTML for general";return}Te.#o.innerHTML="",t.output.forEach(i=>Te.#o.appendChild(Te.#f(i))),Te.#o.firstChild||(Te.#o.textContent="No issues found.")}static displayOutputDifficulty(t,i){if(!t&&!i&&(t=st.getSelectedCharacteristic(),i=st.getSelectedDifficulty()),!t||!i)throw new Error(ro+"something went wrong!");Te.#r.innerHTML="";const n=be.data.analysis?.beatmap.find(o=>o.difficulty===i&&o.characteristic===t);if(!n){Te.#r.textContent="ERROR: could not find analysis for "+t+" "+i;return}if(!n.output){Te.#r.textContent="ERROR: could not find HTML for "+t+" "+i;return}n.output.forEach(o=>Te.#r.appendChild(Te.#f(o))),Te.#r.firstChild||(Te.#r.textContent="No issues found.")}static#f(t){switch(t.type){case te.STRING:return Fu(t.label,t.value,t.status);case te.NUMBER:return Fu(t.label,t.value.join(", "),t.status);case te.TIME:return L_(t.label,t.value,t.status);case te.HTML:const i=document.createElement("div");return t.value.forEach(n=>i.appendChild(n)),i;default:throw new Error("Unexpected result type")}}static setDifficultyLabel(t){Te.#e.forEach(i=>i.textContent=t)}static adjustBeatTime(){const t=be.data.info;if(!t)throw new Error(ro+"could not find map info");const i=tr.create(t.audio.bpm);C_(i)}static populateTool(){Kp().sort((t,i)=>t.order.input-i.order.input).forEach(t=>{if(t.input.ui)switch(t.type){case Ee.NOTE:{Te.#i.appendChild(t.input.ui());break}case Ee.OBSTACLE:{Te.#t.appendChild(t.input.ui());break}case Ee.EVENT:{Te.#n.appendChild(t.input.ui());break}case Ee.OTHER:{Te.#s.appendChild(t.input.ui());break}case Ee.GENERAL:{Te.#a.appendChild(t.input.ui());break}default:console.error(ro+"could not recognise type "+t.type+" for "+t.name)}})}static#m(){Te.#o.innerHTML="No output.",Te.#r.innerHTML="No output."}static#h(){const t=st.getSelectedCharacteristic(),i=st.getSelectedDifficulty();if(!t||!i)throw new Error(ro+"characteristic/difficulty does not exist");Ae.status(Ze.INFO,`Re-analysing ${t} ${i}`),ed(t,i),Ae.status(Ze.INFO,`Re-analysed ${t} ${i}`),Te.displayOutputDifficulty(t,i)}static#p(){const t=st.getSelectedCharacteristic(),i=st.getSelectedDifficulty();if(!t||!i)throw new Error(ro+"characteristic/difficulty does not exist");Ae.status(Ze.INFO,"Re-analysing all difficulties"),td(),Ae.status(Ze.INFO,"Re-analysed all difficulties"),Te.displayOutputDifficulty(t,i)}static#d(){Ae.status(Ze.INFO,"Re-analysing general"),Up(),Ae.status(Ze.INFO,"Re-analysed general"),Te.displayOutputGeneral()}}function Ws(e){document.querySelectorAll(".input-toggle").forEach(i=>{i.disabled=!e})}function Vu(e){return["load",e]}async function N_(e,t,i=""){if(e.version===4){const o=t.file(i+e.audio.audioDataFilename);if(se.tInfo(Vu("extractBPMInfo"),"loading",e.audio.audioDataFilename),o){const r=await o.async("string").then(JSON.parse);return{duration:r.songSampleCount/r.songFrequency,bpm:r.bpmData.map(s=>({time:s.sb,bpm:(s.eb-s.sb)/((s.ei-s.si)/r.songFrequency)*60}))}}}const n=t.file(i+"BPMInfo.dat");if(se.tInfo(Vu("extractBPMInfo"),"loading BPMInfo.dat"),n){const o=await n.async("string").then(JSON.parse);return{duration:o._songSampleCount/o._songFrequency,bpm:o._regions.map(r=>({time:r._startBeat,bpm:(r._endBeat-r._startBeat)/((r._endSampleIndex-r._startSampleIndex)/o._songFrequency)*60}))}}return null}function yn(e){return["load",e]}async function x_(e,t,i=""){const n=e.file(i+t.lightshowFilename);n||se.tError(yn("extractLightshow"),`Missing ${t.lightshowFilename} lightshow file for ${t.characteristic} ${t.difficulty}, ignoring.`),se.tInfo(yn("extractLightshow"),`Loading ${t.characteristic} ${t.difficulty} lightshow`);try{const o=await n.async("string").then(JSON.parse),r=ev(o,{sort:ue.props.sorting,schemaCheck:{enabled:ue.props.dataCheck}});return[o,r]}catch(o){se.tError(yn("extractLightshow"),`Could not load ${t.lightshowFilename} lightshow file; ${o}`)}return null}function O_(e,t,i=""){const n={};return e.difficulties.map(async o=>{const r=o,s=t.file(i+r.filename);if(!s)return se.tError(yn("extractBeatmaps"),`Missing ${r.filename} file for ${r.characteristic} ${r.difficulty}, ignoring.`),null;se.tInfo(yn("extractBeatmaps"),`Loading ${r.characteristic} ${r.difficulty}`);let a;try{a=await s.async("string").then(JSON.parse)}catch(g){throw new Error(`${r.characteristic} ${r.difficulty} ${g}`)}let l=typeof a._version=="string"?a._version.at(0):typeof a.version=="string"?a.version.at(0):null,u;l?u=parseInt(l):(se.tWarn(yn("extractBeatmaps"),"Could not identify beatmap version from JSON, assume implicit version",2),u=2),a._notes&&a.version&&se.tError(yn("extractBeatmaps"),`${r.characteristic} ${r.difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`);let f=Qg(a,{sort:ue.props.sorting,schemaCheck:{enabled:ue.props.dataCheck}}),b=u===4?new en:f,m;if(u===4){n[r.lightshowFilename]||(n[r.lightshowFilename]=x_(t,r,i));const g=await n[r.lightshowFilename];g&&([m,b]=g)}return f.lightshow=b.lightshow,B_(e,r,f,a,m,u)})}function B_(e,t,i,n,o,r){const s=tr.create(e.audio.bpm,r===3?[...i.difficulty.customData.BPMChanges??[],...(n.bpmEvents??[]).map(u=>u)]:r===2?i.difficulty.customData._BPMChanges??i.difficulty.customData._bpmChanges:r===1?n._BPMChanges:[],t.customData?._editorOffset),a=Lv(i,s,t.characteristic,t.difficulty);A_(i,a,s,{"Mapping Extensions":t.customData._requirements?.includes("Mapping Extensions"),"Noodle Extensions":t.customData._requirements?.includes("Noodle Extensions")},r);const l=e.environmentNames.at(t.environmentId)||(t.characteristic==="360Degree"||t.characteristic==="90Degree"?e.environmentBase.allDirections:e.environmentBase.normal)||"DefaultEnvironment";return{info:t,environment:l,timeProcessor:s,njs:new Kt(s.bpm,t.njs||Kt.FallbackNJS[t.difficulty]||0,t.njsOffset),data:i,noteContainer:k_(i),swingAnalysis:a,score:S0(i),stats:{basicEvents:vv(i.lightshow.basicEvents,i.lightshow.colorBoostEvents,l),lightColorEventBoxGroups:Go(i.lightshow.lightColorEventBoxGroups,l),lightRotationEventBoxGroups:Go(i.lightshow.lightRotationEventBoxGroups,l),lightTranslationEventBoxGroups:Go(i.lightshow.lightTranslationEventBoxGroups,l),fxEventBoxGroups:Go(i.lightshow.fxEventBoxGroups,l),notes:xs(i.difficulty.colorNotes),bombs:Ev(i.difficulty.bombNotes),arcs:xs(i.difficulty.arcs),chains:xs(i.difficulty.chains),obstacles:Tv(i.difficulty.obstacles)},rawVersion:r,rawData:n,rawLightshow:o}}function k_(e){return[...e.difficulty.colorNotes.map(t=>({data:t,type:ve.COLOR})),...e.difficulty.bombNotes.map(t=>({data:t,type:ve.BOMB})),...e.difficulty.chains.map(t=>({data:t,type:ve.CHAIN})),...e.difficulty.arcs.map(t=>({data:t,type:ve.ARC}))].sort((t,i)=>t.data.time-i.data.time)}function A_(e,t,i,n,o){const r=P_(i);e.difficulty.customData[L.CALCULATED]||(e.difficulty.bpmEvents.forEach(r),e.difficulty.njsEvents.forEach(r),e.difficulty.rotationEvents.forEach(r),e.difficulty.colorNotes.forEach(r),e.difficulty.colorNotes.forEach(s=>so(s,n,o)),e.difficulty.colorNotes.forEach(s=>Hs(s,n,o)),e.difficulty.bombNotes.forEach(r),e.difficulty.bombNotes.forEach(s=>so(s,n,o)),e.difficulty.obstacles.forEach(r),e.difficulty.obstacles.forEach(s=>so(s,n,o)),e.difficulty.arcs.forEach(r),e.difficulty.arcs.forEach(s=>so(s,n,o)),e.difficulty.arcs.forEach(s=>Hs(s,n,o)),e.difficulty.chains.forEach(r),e.difficulty.chains.forEach(s=>so(s,n,o)),e.difficulty.chains.forEach(s=>Hs(s,n,o)),e.difficulty.customData[L.CALCULATED]=!0),e.lightshow.customData[L.CALCULATED]||(e.lightshow.waypoints.forEach(r),e.lightshow.basicEvents.forEach(r),e.lightshow.colorBoostEvents.forEach(r),e.lightshow.lightColorEventBoxGroups.forEach(r),e.lightshow.lightRotationEventBoxGroups.forEach(r),e.lightshow.lightTranslationEventBoxGroups.forEach(r),e.lightshow.fxEventBoxGroups.forEach(r),e.lightshow.customData[L.CALCULATED]=!0);for(const s of t.container)if(s.data.length===2&&Ui(s.data[0].time,s.data[1].time)&&(!(s.data[0].direction!==z.ANY&&s.data[1].direction!==z.ANY)||Pt(s.data[0].direction)===Pt(s.data[1].direction)&&S1(s.data[0],s.data[1],30))){const[a,l]=s.data[0].customData[L.POSITION],[u,f]=s.data[1].customData[L.POSITION],b=Pt(s.data[0].direction)||Pt(s.data[1].direction),m=Math.atan2(l-f,a-u)*180/Math.PI+90,g=Math.atan2(f-l,u-a)*180/Math.PI+90;s.data[0].customData[L.ANGLE]=s.data[1].customData[L.ANGLE]=an(b,m,360)>an(b,g,360)?g:m,s.data[0].customData[L.SNAPPED]=s.data[1].customData[L.SNAPPED]=!0}}function so(e,t,i){if(e.customData[L.POSITION]=zt(e),t?.["Mapping Extensions"]&&(e.customData[L.POSITION]=[e.posX>=1e3?e.posX/1e3-1:e.posX<=-1e3?e.posX/1e3+1:e.posX,e.posY>=1e3?e.posY/1e3-1:e.posY<=-1e3?e.posY/1e3+1:e.posY]),t?.["Noodle Extensions"])switch(i){case 2:_s(e.customData._position)&&(e.customData[L.POSITION]=e.customData._position);break;case 3:_s(e.customData.coordinate)&&(e.customData[L.POSITION]=e.customData.coordinates);break}if(typeof e.tailPosX=="number"&&typeof e.tailPosY=="number"&&(e.customData[L.TAIL_POSITION]=[e.tailPosX,e.tailPosY],t?.["Mapping Extensions"]&&(e.customData[L.TAIL_POSITION]=[e.tailPosX>=1e3?e.tailPosX/1e3-1:e.tailPosX<=-1e3?e.tailPosX/1e3+1:e.tailPosX,e.tailPosY>=1e3?e.tailPosY/1e3-1:e.tailPosY<=-1e3?e.tailPosY/1e3+1:e.tailPosY]),t?.["Noodle Extensions"]))switch(i){case 3:_s(e.customData.tailCoordinates)&&(e.customData[L.TAIL_POSITION]=e.customData.tailCoordinates);break}}function Hs(e,t,i){if(e.customData[L.ANGLE]=Pt(e.direction)+(e.angleOffset||0),e.direction===z.ANY&&(e.customData[L.ANGLE]+=180),t?.["Mapping Extensions"]&&(e.customData[L.ANGLE]=e.direction>=1e3&&e.direction<=1360?1360-e.direction:e.direction>=2e3&&e.direction<=2360?2360-e.direction:e.direction),t?.["Noodle Extensions"])switch(i){case 2:e.customData._cutDirection&&(e.customData[L.ANGLE]=e.customData._cutDirection);break}typeof e.tailDirection=="number"&&(e.customData[L.TAIL_ANGLE]=Pt(e.tailDirection),e.tailDirection===z.ANY&&(e.customData[L.TAIL_ANGLE]+=180),t?.["Mapping Extensions"]&&(e.customData[L.ANGLE]=e.tailDirection>=1e3&&e.tailDirection<=1360?1360-e.tailDirection:e.tailDirection))}function P_(e){return function(t){t.customData[L.SECOND_TIME]=e.toRealTime(t.time),t.customData[L.BEAT_TIME]=e.adjustTime(t.time),"tailTime"in t&&(t.customData[L.TAIL_SECOND_TIME]=e.toRealTime(t.tailTime),t.customData[L.TAIL_BEAT_TIME]=e.adjustTime(t.tailTime)),"duration"in t&&(t.customData[L.DURATION_SECOND_TIME]=e.toRealTime(t.time+t.duration)-t.customData[L.SECOND_TIME],t.customData[L.DURATION_BEAT_TIME]=t.duration)}}function M_(e){return["load",e]}async function I_(e,t=""){const i=e.file(t+"Info.dat")||e.file(t+"info.dat")||e.file(t+"Info.json")||e.file(t+"info.json");if(!i)throw new Error("Couldn't find Info.dat");return se.tInfo(M_("extractInfo"),"loading info"),i.async("string").then(JSON.parse).then(n=>Ug(n))}async function id(e){return new Promise(function(t,i){const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="json",n.timeout=5e3;let o=Date.now();n.onprogress=()=>{n.timeout+=Date.now()-o},n.onload=()=>{n.status===200&&t(n.response),n.status===404&&i("Error 404: Map does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function $_(e){const t=`https://api.beatsaver.com/maps/id/${e}`,i=await id(t);if(i?.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}async function F_(e){const t=`https://api.beatsaver.com/maps/hash/${e}`,i=await id(t);if(i?.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}function nd(e){const t=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(e=e.trim(),/^http:\/\//.test(e)&&(e=e.replace("http://","https://")),t.test(e))return e;throw new Error("Invalid URL")}function od(e){const t=/^[0-9a-fA-F]{1,6}$/;if(e=e.trim(),/^!bsr /.test(e)&&(e=e.replace("!bsr ","")),t.test(e))return e;throw new Error("Invalid ID")}function zu(e){return new Promise(t=>setTimeout(t,e))}function vo(e){return["download",e]}async function Ya(e){return new Promise(function(t,i){const n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.timeout=5e3;let o=Date.now();n.onprogress=r=>{n.timeout+=Date.now()-o,Ae.status(Ze.DOWNLOAD,`Downloading map: ${$(r.loaded/1024/1024,1)}MB / ${$(r.total/1024/1024,1)}MB`,r.loaded/r.total*100)},n.onload=()=>{n.status===200&&t(n.response),n.status===404&&i("Error 404: Map/link does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function rd(e){const t=od(e);se.tInfo(vo("downloadFromID"),`fetching download URL from BeatSaver for map ID ${t}`),Ae.status(Ze.INFO,"Fetching download URL from BeatSaver",0);const i=await $_(t);se.tInfo(vo("downloadFromID"),`downloading from BeatSaver for map ID ${t}`),Ae.status(Ze.INFO,"Requesting download from BeatSaver",0);const n=await Ya(i);return de.setCoverLink("https://beatsaver.com/maps/"+t,t),n}async function V_(e){const t=nd(e);if(t.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return rd(t.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);Ae.status(Ze.INFO,"Requesting download from link",0),se.tInfo(vo("downloadFromURL"),`downloading from ${t}`);let i=await Ya("https://cors.bsmg.dev/"+t);return de.setCoverLink(t),i}async function z_(e){let t;if(Hu(e.trim()))t=e.trim();else throw new Error("invalid hash");se.tInfo(vo("downloadFromHash"),`fetching download URL from BeatSaver for map hash ${t}`),Ae.status(Ze.INFO,"Fetching download URL from BeatSaver",0);const i=await F_(t);return se.tInfo(vo("downloadFromHash"),`downloading from BeatSaver for map hash ${t}`),Ae.status(Ze.INFO,"Requesting download from BeatSaver",0),await Ya(i)}var Nt=(e=>(e[e.Url=0]="Url",e[e.Id=1]="Id",e[e.Hash=2]="Hash",e[e.File=3]="File",e))(Nt||{});const G_="2.7.1",j_="Kival Evan";class Ni{static#e;static#i;static init(){Ni.#e=document.querySelectorAll(".link__watermark"),Ni.#i=document.querySelectorAll(".link__version"),Ni.setVersion(j_),Ni.setVersion(G_)}static setWatermark(t){Ni.#e.forEach(i=>{i.textContent=(Ni.#t()?"Happy Birthday, ":"")+t,Ni.#t()&&(i.title=`Happy ${new Date().getFullYear()-new Date("1999-06-10").getFullYear()} Birthday, 10th June`)})}static setVersion(t){Ni.#i.forEach(i=>i.textContent=t)}static#t(){const t=new Date;return t.getMonth()==5&&t.getDate()==10}}const qa=class qa{static set(t){document.body.className="theme-"+t.toLowerCase().replace(" ","")}};qa.list=["Dark","Light"];let Eo=qa;class De{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o;static#l;static#u;static init(){De.#e=document.querySelector(".settings__theme"),De.#i=document.querySelector(".settings__beat-numbering"),De.#t=document.querySelector(".settings__rounding"),De.#n=document.querySelector(".settings__info-count"),De.#s=document.querySelector(".settings__data-check"),De.#a=document.querySelectorAll(".settings__load"),De.#r=document.querySelector(".settings__sort"),De.#o=document.querySelectorAll(".settings__show"),De.#l=document.querySelector(".settings__clear-button"),De.#u=document.querySelector(".settings__checks-persistent"),De.#e.addEventListener("change",De.#c),Eo.list.forEach(t=>{const i=document.createElement("option");i.value=t,i.textContent=t,De.#e.add(i)}),De.#i.addEventListener("change",De.#f),De.#t.addEventListener("change",De.#m),De.#n.addEventListener("change",De.#h),De.#s.addEventListener("change",De.#p),De.#a.forEach(t=>t.addEventListener("change",De.#v)),De.#r.addEventListener("change",De.#g),De.#o.forEach(t=>t.addEventListener("change",De.#d)),De.#u.addEventListener("click",De.#b),De.#l.addEventListener("click",De.clearHandler),De.reset()}static reset(){De.setTheme(ue.props.theme),De.setBeatNumbering(ue.props.beatNumbering),De.setRounding(ue.props.rounding),De.setInfoRow(ue.props.infoRowCount),De.setDataCheck(ue.props.dataCheck),De.setSortCheck(ue.props.sorting),De.setShowCheck(ue.props.show);for(const t in ue.props.load)De.setLoadCheck(t,ue.props.load[t])}static clearHandler(){ue.clear(),ue.reset(),location.reload()}static#c(t){const i=t.target;ue.props.theme=i.options[i.options.selectedIndex].value,Eo.set(ue.props.theme),ue.save()}static#f(t){const i=t.target;ue.props.beatNumbering=i.options[i.options.selectedIndex].value,ue.save()}static#m(t){const i=t.target;ue.props.rounding=parseInt(i.value),ue.save()}static#h(t){const i=t.target;ue.props.infoRowCount=parseInt(i.value),Eu(),ue.save()}static#p(t){const i=t.target;ue.props.dataCheck=i.checked,ue.save()}static#d(t){const n=t.target.id.replace("settings__show-","");ue.props.show=n,ue.save()}static#b(t){const i=t.target;ue.props.checks.persistent=i.checked,ue.save()}static setShowCheck(t){De.#o.forEach(i=>{i.id.endsWith(t)&&(i.checked=!0)})}static#g(t){const i=t.target;ue.props.sorting=i.checked,ue.save()}static setSortCheck(t){De.#r&&(De.#r.checked=t)}static#v(t){const i=t.target,n=i.name;ue.props.load[n]=i.checked,ue.save()}static setLoadCheck(t,i){De.#a.forEach(n=>{n.name===t&&(n.checked=i)})}static setTheme(t){De.#e.value=t}static setBeatNumbering(t){De.#i.value=t}static setRounding(t){De.#t.value=t.toString()}static setInfoRow(t){De.#n.value=t.toString(),Eu()}static setDataCheck(t){De.#s.checked=t}static setChecksPersistent(t){De.#u.checked=t}}class Ge{static#e;static#i;static#t;static#n;static#s;static#a;static init(){Ge.#e=document.querySelector(".input__intro-url"),Ge.#i=document.querySelector(".input__intro-id"),Ge.#t=document.querySelector(".input__intro-hash"),Ge.#n=document.querySelector(".input__search-button"),Ge.#s=document.querySelector(".input__file"),Ge.#a=document.querySelector(".input__file-zone"),Ge.#e.addEventListener("keydown",Ge.#r),Ge.#i.addEventListener("keydown",Ge.#r),Ge.#t.addEventListener("keydown",Ge.#r),Ge.#n.addEventListener("click",Ge.#o),Ge.#s.addEventListener("change",Ge.#l),Ge.#a.addEventListener("drop",Ge.#u),Ge.#a.addEventListener("dragover",Ge.#c)}static async#r(t){const i=t.target;if(t.key==="Enter"&&i.value!==""){if(i.classList.contains("input__intro-url"))return pi({type:Nt.Url,data:i.value});if(i.classList.contains("input__intro-id"))return pi({type:Nt.Id,data:i.value});if(i.classList.contains("input__intro-hash"))return pi({type:Nt.Hash,data:i.value})}}static async#o(t){if(Ge.#e&&Ge.#e.value!=="")return pi({type:Nt.Url,data:Ge.#e.value});if(Ge.#i&&Ge.#i.value!=="")return pi({type:Nt.Id,data:Ge.#i.value});if(Ge.#t&&Ge.#t.value!=="")return pi({type:Nt.Hash,data:Ge.#t.value})}static async#l(t){const i=t.target;Ae.status(Ze.INFO,"Reading file input",0);const n=i.files?i.files[0]:null;try{if(n==null)throw Ae.status(Ze.INFO,"No file input",0),new Error("No file input");if(n&&(n.name.substr(-4)===".zip"||n.name.substr(-4)===".bsl")){const o=new FileReader;o.readAsArrayBuffer(n),o.addEventListener("load",async()=>pi({type:Nt.File,data:n}))}else throw new Error("Unsupported file format, please enter zip file")}catch(o){Ae.status(Ze.ERROR,o,0),console.error(o)}}static async#u(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items){if(!t.dataTransfer.items[0])throw new Error("Failed to retrieve file from drag & drop");if(t.dataTransfer.items[0].kind==="file"){let i=t.dataTransfer.items[0].getAsFile();if(i&&(i.name.substring(i.name.length-4)===".zip"||i.name.substring(i.name.length-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(i),n.addEventListener("load",async()=>{await pi({type:Nt.File,data:i})})}else throw new Error("Unsupported file format, please enter zip file")}}}catch(i){Ae.status(Ze.ERROR,i,0),console.error(i)}}static async#c(t){t.preventDefault(),t.stopPropagation()}}const ur="UI Stats: ",Ye="stats__";class Gt{static#e;static#i;static#t;static#n;static#s;static init(){Gt.#e=document.querySelector("#stats__table-nps-overall"),Gt.#i=document.querySelector("#stats__table-nps-mapped"),Gt.#t=document.querySelector("#stats__table-nps-peak-16"),Gt.#n=document.querySelector("#stats__table-nps-peak-8"),Gt.#s=document.querySelector("#stats__table-nps-peak-4")}static updateTable(t,i){const n=i.timeProcessor,o=be.data.duration||0,r=n.toRealTime(Vn(i.data));Gt.#e.textContent=$(ll(i.data,o),2).toString(),Gt.#i.textContent=$(ll(i.data,r),2).toString(),Gt.#t.textContent=$(Ss(i.data,16,n),2).toString(),Gt.#n.textContent=$(Ss(i.data,8,n),2).toString(),Gt.#s.textContent=$(Ss(i.data,4,n),2).toString()}}class rt{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o;static#l;static init(){rt.#e=document.querySelector("#stats__table-settings-version"),rt.#i=document.querySelector("#stats__table-settings-njs"),rt.#t=document.querySelector("#stats__table-settings-njs-min"),rt.#n=document.querySelector("#stats__table-settings-njs-max"),rt.#s=document.querySelector("#stats__table-settings-njs-count"),rt.#a=document.querySelector("#stats__table-settings-sdm"),rt.#r=document.querySelector("#stats__table-settings-hjd"),rt.#o=document.querySelector("#stats__table-settings-jd"),rt.#l=document.querySelector("#stats__table-settings-rt")}static updateTable(t,i){const n=Kt.create(t.audio.bpm,i.info.njs||Kt.FallbackNJS[i.info.difficulty],i.info.njsOffset),o=i.data.difficulty.njsEvents.toSorted((r,s)=>r.value-s.value);rt.#e.textContent=i.rawData.version||i.rawData._version||"N/A",rt.#i.textContent=$(n.value,3).toString(),rt.#n.textContent=$(n.value+(o.at(0)?.value||0),3).toString(),rt.#t.textContent=$(n.value+(o.at(-1)?.value||0),3).toString(),rt.#s.textContent=$(o.length,3).toString(),rt.#a.textContent=$(n.offset,3).toString(),rt.#r.textContent=$(n.hjd,3).toString(),rt.#o.textContent=$(n.jd,3).toString(),rt.#l.textContent=$(n.reactionTime*1e3).toString()+"ms"}}class He{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o;static#l;static#u;static#c;static#f;static init(){He.#e=document.querySelector("#stats__table-sps-avg-total"),He.#i=document.querySelector("#stats__table-sps-avg-red"),He.#t=document.querySelector("#stats__table-sps-avg-blue"),He.#n=document.querySelector("#stats__table-sps-median-total"),He.#s=document.querySelector("#stats__table-sps-median-red"),He.#a=document.querySelector("#stats__table-sps-median-blue"),He.#r=document.querySelector("#stats__table-sps-peak-total"),He.#o=document.querySelector("#stats__table-sps-peak-red"),He.#l=document.querySelector("#stats__table-sps-peak-blue"),He.#u=document.querySelector("#stats__table-sps-total-total"),He.#c=document.querySelector("#stats__table-sps-total-red"),He.#f=document.querySelector("#stats__table-sps-total-blue")}static updateTable(t,i){const n=i.swingAnalysis;He.#e.innerText=$(n.total.perSecond,2).toString(),He.#i.innerText=$(n.red.perSecond,2).toString(),He.#t.innerText=$(n.blue.perSecond,2).toString(),He.#n.innerText=$(n.total.median,2).toString(),He.#s.innerText=$(n.red.median,2).toString(),He.#a.innerText=$(n.blue.median,2).toString(),He.#r.innerText=$(n.total.peak,2).toString(),He.#o.innerText=$(n.red.peak,2).toString(),He.#l.innerText=$(n.blue.peak,2).toString(),He.#u.innerText=$(n.total.total,2).toString(),He.#c.innerText=$(n.red.total,2).toString(),He.#f.innerText=$(n.blue.total,2).toString()}}class yo{static#e;static init(){yo.#e=document.querySelector("#stats__table-events-content")}static updateTable(t,i){const n=i.environment,o=i.stats.basicEvents;let r=0,s=0,a=0;for(const u in o)r+=o[u].total;let l=`<tr><th class="${Ye}table-header" colspan="5">Total</th><td class="${Ye}table-element">${r}</td></tr>`;for(const u in o)s+=o[u].chroma,a+=o[u].chromaOld,l+=`<tr><th class="${Ye}table-header">${u}</th><th class="${Ye}table-header" colspan="4">${dv(parseInt(u),n)}</th><td class="${Ye}table-element">${o[u].total}</td></tr>`;s&&(l+=`<tr><th class="${Ye}table-header" colspan="5">Chroma</th><td class="${Ye}table-element">${s}</td></tr>`),a&&(l+=`<tr><th class="${Ye}table-header" colspan="5">OG Chroma</th><td class="${Ye}table-element">${a}</td></tr>`),yo.#e.innerHTML=l}}function W_(...e){for(const t of e)for(const i in t)for(const n of e)n[i]||(n[i]={groups:0,boxes:0,bases:0})}class $e{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o;static#l;static#u;static#c;static#f;static#m;static#h;static#p;static#d;static init(){$e.#e=document.querySelector("#stats__table-ebg-content"),$e.#i=document.querySelector("#stats__table-ebg-group-total"),$e.#t=document.querySelector("#stats__table-ebg-box-total"),$e.#n=document.querySelector("#stats__table-ebg-base-total"),$e.#s=document.querySelector("#stats__table-ebg-group-color"),$e.#a=document.querySelector("#stats__table-ebg-box-color"),$e.#r=document.querySelector("#stats__table-ebg-base-color"),$e.#o=document.querySelector("#stats__table-ebg-group-rotate"),$e.#l=document.querySelector("#stats__table-ebg-box-rotate"),$e.#u=document.querySelector("#stats__table-ebg-base-rotate"),$e.#c=document.querySelector("#stats__table-ebg-group-translate"),$e.#f=document.querySelector("#stats__table-ebg-box-translate"),$e.#m=document.querySelector("#stats__table-ebg-base-translate"),$e.#h=document.querySelector("#stats__table-ebg-group-fx"),$e.#p=document.querySelector("#stats__table-ebg-box-fx"),$e.#d=document.querySelector("#stats__table-ebg-base-fx")}static updateTable(t,i){const n=i.environment,o=i.stats.lightColorEventBoxGroups,r=i.stats.lightRotationEventBoxGroups,s=i.stats.lightTranslationEventBoxGroups,a=i.stats.fxEventBoxGroups;W_(o,r,s,a),$e.#i.textContent=(Object.values(o).reduce((u,{groups:f})=>u+f,0)+Object.values(r).reduce((u,{groups:f})=>u+f,0)+Object.values(s).reduce((u,{groups:f})=>u+f,0)+Object.values(a).reduce((u,{groups:f})=>u+f,0)).toString(),$e.#t.textContent=(Object.values(o).reduce((u,{boxes:f})=>u+f,0)+Object.values(r).reduce((u,{boxes:f})=>u+f,0)+Object.values(s).reduce((u,{boxes:f})=>u+f,0)+Object.values(a).reduce((u,{boxes:f})=>u+f,0)).toString(),$e.#n.textContent=(Object.values(o).reduce((u,{bases:f})=>u+f,0)+Object.values(r).reduce((u,{bases:f})=>u+f,0)+Object.values(s).reduce((u,{bases:f})=>u+f,0)+Object.values(a).reduce((u,{bases:f})=>u+f,0)).toString(),$e.#s.textContent=Object.values(o).reduce((u,{groups:f})=>u+f,0).toString(),$e.#a.textContent=Object.values(o).reduce((u,{boxes:f})=>u+f,0).toString(),$e.#r.textContent=Object.values(o).reduce((u,{bases:f})=>u+f,0).toString(),$e.#o.textContent=Object.values(r).reduce((u,{groups:f})=>u+f,0).toString(),$e.#l.textContent=Object.values(r).reduce((u,{boxes:f})=>u+f,0).toString(),$e.#u.textContent=Object.values(r).reduce((u,{bases:f})=>u+f,0).toString(),$e.#c.textContent=Object.values(s).reduce((u,{groups:f})=>u+f,0).toString(),$e.#f.textContent=Object.values(s).reduce((u,{boxes:f})=>u+f,0).toString(),$e.#m.textContent=Object.values(s).reduce((u,{bases:f})=>u+f,0).toString(),$e.#h.textContent=Object.values(a).reduce((u,{groups:f})=>u+f,0).toString(),$e.#p.textContent=Object.values(a).reduce((u,{boxes:f})=>u+f,0).toString(),$e.#d.textContent=Object.values(a).reduce((u,{bases:f})=>u+f,0).toString();let l="";for(const u in o)l+=`<tr><th class="${Ye}table-header">${u}</th><th class="${Ye}table-header" colspan="5">${gv(parseInt(u),n)}</th><td class="${Ye}table-element" title="${o[u].groups} Box (${o[u].bases} Base)">${o[u].groups}</td><td class="${Ye}table-element" title="${r[u].boxes} Box (${r[u].bases} Base)">${r[u].groups}</td><td class="${Ye}table-element" title="${s[u].boxes} Box (${s[u].bases} Base)">${s[u].groups}</td><td class="${Ye}table-element" title="${a[u].groups} Box (${a[u].bases} Base)">${a[u].groups}</td></tr>`;$e.#e.innerHTML=l}}class ht{static#e;static#i;static#t;static#n;static#s;static#a;static init(){ht.#e=document.querySelector("#stats__table-ni-ratio"),ht.#i=document.querySelector("#stats__table-ni-maxscore"),ht.#t=document.querySelector("#stats__table-ni-ebpm"),ht.#n=document.querySelector("#stats__table-ni-ebpm-swing"),ht.#s=document.querySelector("#stats__table-ni-minspeed"),ht.#a=document.querySelector("#stats__table-ni-maxspeed")}static updateTable(t,i){const n=i.stats.notes;ht.#e.textContent=$(n.red.total/n.blue.total,2).toString(),ht.#i.textContent=ud(i.score),ht.#t.textContent=$(Sv(i.swingAnalysis.container),2).toString(),ht.#n.textContent=$(wv(i.swingAnalysis.container),2).toString();const o=$(Bv(i.swingAnalysis.container)*1e3,1),r=$(kv(i.swingAnalysis.container)*1e3,1);o||r?(ht.#s.textContent=o.toString()+"ms",ht.#a.textContent=o.toString()+"ms",ht.#s.parentNode.classList.remove("hidden"),ht.#a.parentNode.classList.remove("hidden")):(ht.#s.parentNode.classList.add("hidden"),ht.#a.parentNode.classList.add("hidden"))}}class le{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o;static#l;static#u;static#c;static#f;static#m;static#h;static#p;static#d;static#b;static#g;static#v;static#E;static#y;static#_;static#D;static#T;static init(){le.#e=document.querySelector("#stats__table-nc-total"),le.#i=document.querySelector("#stats__table-nc-arc"),le.#t=document.querySelector("#stats__table-nc-chain"),le.#n=document.querySelector("#stats__table-nc-bomb"),le.#s=document.querySelector("#stats__table-nc-red"),le.#a=document.querySelector("#stats__table-nc-arc-red"),le.#r=document.querySelector("#stats__table-nc-chain-red"),le.#o=document.querySelector("#stats__table-nc-bomb-red"),le.#l=document.querySelector("#stats__table-nc-blue"),le.#u=document.querySelector("#stats__table-nc-arc-blue"),le.#c=document.querySelector("#stats__table-nc-chain-blue"),le.#f=document.querySelector("#stats__table-nc-bomb-blue"),le.#m=document.querySelector("#stats__table-nc-chroma"),le.#h=document.querySelector("#stats__table-nc-arc-chroma"),le.#p=document.querySelector("#stats__table-nc-chain-chroma"),le.#d=document.querySelector("#stats__table-nc-bomb-chroma"),le.#b=document.querySelector("#stats__table-nc-noodle"),le.#g=document.querySelector("#stats__table-nc-arc-noodle"),le.#v=document.querySelector("#stats__table-nc-chain-noodle"),le.#E=document.querySelector("#stats__table-nc-bomb-noodle"),le.#y=document.querySelector("#stats__table-nc-me"),le.#_=document.querySelector("#stats__table-nc-arc-me"),le.#D=document.querySelector("#stats__table-nc-chain-me"),le.#T=document.querySelector("#stats__table-nc-bomb-me")}static updateTable(t,i){const n=i.stats.notes,o=i.stats.arcs,r=i.stats.chains,s=i.stats.bombs;le.#e.textContent=(n.red.total+n.blue.total).toString(),le.#i.textContent=(o.red.total+o.blue.total).toString(),le.#t.textContent=(r.red.total+r.blue.total).toString(),le.#n.textContent=s.total.toString(),le.#s.textContent=n.red.total.toString(),le.#a.textContent=o.red.total.toString(),le.#r.textContent=r.red.total.toString(),le.#l.textContent=n.blue.total.toString(),le.#u.textContent=o.blue.total.toString(),le.#c.textContent=r.blue.total.toString(),n.red.chroma||n.blue.chroma||o.red.chroma||o.blue.chroma||r.red.chroma||r.blue.chroma||s.chroma?(le.#m.textContent=(n.red.chroma+n.blue.chroma).toString(),le.#h.textContent=(o.red.chroma+o.blue.chroma).toString(),le.#p.textContent=(r.red.chroma+r.blue.chroma).toString(),le.#d.textContent=s.chroma.toString(),le.#m.parentNode.classList.remove("hidden"),le.#h.parentNode.classList.remove("hidden"),le.#p.parentNode.classList.remove("hidden"),le.#d.parentNode.classList.remove("hidden")):(le.#m.parentNode.classList.add("hidden"),le.#h.parentNode.classList.add("hidden"),le.#p.parentNode.classList.add("hidden"),le.#d.parentNode.classList.add("hidden")),n.red.noodleExtensions||n.blue.noodleExtensions||o.red.noodleExtensions||o.blue.noodleExtensions||r.red.noodleExtensions||r.blue.noodleExtensions||s.noodleExtensions?(le.#b.textContent=(n.red.noodleExtensions+n.blue.noodleExtensions).toString(),le.#g.textContent=(o.red.noodleExtensions+o.blue.noodleExtensions).toString(),le.#v.textContent=(r.red.noodleExtensions+r.blue.noodleExtensions).toString(),le.#E.textContent=s.noodleExtensions.toString(),le.#b.parentNode.classList.remove("hidden"),le.#g.parentNode.classList.remove("hidden"),le.#v.parentNode.classList.remove("hidden"),le.#E.parentNode.classList.remove("hidden")):(le.#b.parentNode.classList.add("hidden"),le.#g.parentNode.classList.add("hidden"),le.#v.parentNode.classList.add("hidden"),le.#E.parentNode.classList.add("hidden")),n.red.mappingExtensions||n.blue.mappingExtensions||o.red.mappingExtensions||o.blue.mappingExtensions||r.red.mappingExtensions||r.blue.mappingExtensions||s.mappingExtensions?(le.#y.textContent=(n.red.mappingExtensions+n.blue.mappingExtensions).toString(),le.#_.textContent=(o.red.mappingExtensions+o.blue.mappingExtensions).toString(),le.#D.textContent=(r.red.mappingExtensions+r.blue.mappingExtensions).toString(),le.#T.textContent=s.mappingExtensions.toString(),le.#y.parentNode.classList.remove("hidden"),le.#_.parentNode.classList.remove("hidden"),le.#D.parentNode.classList.remove("hidden"),le.#T.parentNode.classList.remove("hidden")):(le.#y.parentNode.classList.add("hidden"),le.#_.parentNode.classList.add("hidden"),le.#D.parentNode.classList.add("hidden"),le.#T.parentNode.classList.add("hidden"))}}class Pe{static#e;static#i;static#t;static#n;static#s;static#a;static#r={note:!1,arc:!1,chain:!1,red:!1,blue:!1};static init(){Pe.#e=document.querySelector("#stats__table-angle-note"),Pe.#i=document.querySelector("#stats__table-angle-arc"),Pe.#t=document.querySelector("#stats__table-angle-chain"),Pe.#n=document.querySelector("#stats__table-angle-red"),Pe.#s=document.querySelector("#stats__table-angle-blue"),Pe.#a=document.querySelector("#stats__table-angle"),Pe.#e.addEventListener("change",Pe.#o),Pe.#i.addEventListener("change",Pe.#o),Pe.#t.addEventListener("change",Pe.#o),Pe.#n.addEventListener("change",Pe.#o),Pe.#s.addEventListener("change",Pe.#o),Pe.#r.note=Pe.#e.checked,Pe.#r.arc=Pe.#i.checked,Pe.#r.chain=Pe.#t.checked,Pe.#r.red=Pe.#n.checked,Pe.#r.blue=Pe.#s.checked}static#o(t){const i=t.target,n=i.id.split("-").at(-1);Pe.#r[n]=i.checked;const o=be.data.info,r=be.data.beatmaps.find(s=>s.info.characteristic===st.getSelectedCharacteristic()&&s.info.difficulty===st.getSelectedDifficulty());if(!r)throw new Error(ur+"Could not find map data");Pe.updateTable(o,r)}static#l(t){const i=t.length||1,n=[4,0,5,2,8,3,6,1,7];let o="";for(let r=0;r<3;r++){o+="<tr>";for(let s=0;s<3;s++){let a=Dv(t,n[r*3+s]);o+=`<td class="${Ye}table-element">${a}<br>(${$(a/i*100,1)}%)</td>`}o+="</tr>"}return o}static updateTable(t,i){let n=i.noteContainer;Pe.#r.note||(n=n.filter(r=>r.type!==ve.COLOR)),Pe.#r.arc||(n=n.filter(r=>r.type!==ve.ARC)),Pe.#r.chain||(n=n.filter(r=>r.type!==ve.CHAIN)),Pe.#r.bomb||(n=n.filter(r=>r.type!==ve.BOMB)),Pe.#r.red||(n=n.filter(r=>r.data.color!==0)),Pe.#r.blue||(n=n.filter(r=>r.data.color!==1));let o=Pe.#l(n.map(r=>r.data));Pe.#a.innerHTML=o}}class Ne{static#e;static#i;static#t;static#n;static#s;static#a;static#r;static#o={note:!1,arc:!1,chain:!1,bomb:!1,red:!1,blue:!1};static init(){Ne.#e=document.querySelector("#stats__table-placement-note"),Ne.#i=document.querySelector("#stats__table-placement-arc"),Ne.#t=document.querySelector("#stats__table-placement-chain"),Ne.#n=document.querySelector("#stats__table-placement-bomb"),Ne.#s=document.querySelector("#stats__table-placement-red"),Ne.#a=document.querySelector("#stats__table-placement-blue"),Ne.#r=document.querySelector("#stats__table-placement"),Ne.#e.addEventListener("change",Ne.#l),Ne.#i.addEventListener("change",Ne.#l),Ne.#t.addEventListener("change",Ne.#l),Ne.#n.addEventListener("change",Ne.#l),Ne.#s.addEventListener("change",Ne.#l),Ne.#a.addEventListener("change",Ne.#l),Ne.#o.note=Ne.#e.checked,Ne.#o.arc=Ne.#i.checked,Ne.#o.chain=Ne.#t.checked,Ne.#o.bomb=Ne.#n.checked,Ne.#o.red=Ne.#s.checked,Ne.#o.blue=Ne.#a.checked}static#l(t){const i=t.target,n=i.id.split("-").at(-1);Ne.#o[n]=i.checked;const o=be.data.info,r=be.data.beatmaps.find(s=>s.info.characteristic===st.getSelectedCharacteristic()&&s.info.difficulty===st.getSelectedDifficulty());if(!r)throw new Error(ur+"Could not find map data");Ne.updateTable(o,r)}static#u(t){const i=t.length||1;let n="";for(let o=2;o>=0;o--){n+="<tr>";for(let r=0;r<=3;r++)n+=`<td class="${Ye}table-element">${_v(t,r,o)}</td>`;n+=`<td class="${Ye}table-element ${Ye}table--no-border">${$(yv(t,o)/i*100,1)}%</td>
        </tr>`}return n+=`<tr><td class="${Ye}table-element ${Ye}table--no-border">${$(jo(t,0)/i*100,1)}%</td><td class="${Ye}table-element ${Ye}table--no-border">${$(jo(t,1)/i*100,1)}%</td><td class="${Ye}table-element ${Ye}table--no-border">${$(jo(t,2)/i*100,1)}%</td><td class="${Ye}table-element ${Ye}table--no-border">${$(jo(t,3)/i*100,1)}%</td></tr>`,n}static updateTable(t,i){let n=i.noteContainer;Ne.#o.note||(n=n.filter(r=>r.type!==ve.COLOR)),Ne.#o.arc||(n=n.filter(r=>r.type!==ve.ARC)),Ne.#o.chain||(n=n.filter(r=>r.type!==ve.CHAIN)),Ne.#o.bomb||(n=n.filter(r=>r.type!==ve.BOMB)),Ne.#o.red||(n=n.filter(r=>r.data.color!==0)),Ne.#o.blue||(n=n.filter(r=>r.data.color!==1));let o=Ne.#u(n.map(r=>r.data));Ne.#r.innerHTML=o}}class pt{static#e;static#i;static#t;static#n;static#s;static init(){pt.#e=document.querySelector("#stats__table-obstacles-total"),pt.#i=document.querySelector("#stats__table-obstacles-interactive"),pt.#t=document.querySelector("#stats__table-obstacles-chroma"),pt.#n=document.querySelector("#stats__table-obstacles-noodle"),pt.#s=document.querySelector("#stats__table-obstacles-me")}static updateTable(t,i){const n=i.stats.obstacles;pt.#e.textContent=n.total.toString(),pt.#i.textContent=n.interactive.toString(),n.chroma?(pt.#t.textContent=n.chroma.toString(),pt.#t.parentNode.classList.remove("hidden")):pt.#t.parentNode.classList.add("hidden"),n.noodleExtensions?(pt.#n.textContent=n.noodleExtensions.toString(),pt.#n.parentNode.classList.remove("hidden")):pt.#n.parentNode.classList.add("hidden"),n.mappingExtensions?(pt.#s.textContent=n.mappingExtensions.toString(),pt.#s.parentNode.classList.remove("hidden")):pt.#s.parentNode.classList.add("hidden")}}class Xa{static init(){rt.init(),Gt.init(),He.init(),ht.init(),le.init(),Pe.init(),Ne.init(),yo.init(),$e.init(),pt.init(),st.selectionOnChangeHandlers.push(Xa.updateStats)}static updateStats(t,i){if(!be.data.info)throw new Error(ur+"map info could not be found");const n=be.data.info,o=be.data.beatmaps.find(r=>r.info.characteristic===t&&r.info.difficulty===i);if(!o)throw new Error(ur+"Could not find map data");rt.updateTable(n,o),Gt.updateTable(n,o),He.updateTable(n,o),ht.updateTable(n,o),le.updateTable(n,o),Ne.updateTable(n,o),Pe.updateTable(n,o),yo.updateTable(n,o),$e.updateTable(n,o),pt.updateTable(n,o)}}class cr{static#e=document.querySelectorAll(".input__reset-button");static init(){cr.#e.forEach(t=>t.addEventListener("click",cr.click))}static click(){Ae.reset(),de.reset(),Sn.reset(),Te.reset(),st.reset(),be.clear()}}let Gu=!1;function H_(){Gu||(Gu=!0,Xt.init(),Ae.init(),st.init(),de.init(),Ni.init(),Ge.init(),Sn.init(),Te.init(),Xa.init(),De.init(),Eo.set(ue.props.theme),Xt.showMain(ue.props.show),cr.init(),se.tInfo(["UI","init"],"User interface initialised"))}function Y_(e){return`[${e.join("::")}]`}async function X_(){se.tagPrint=Y_;const e=new URL(location.href);ue.init();const t=e.searchParams.get("preset");ue.props.checks.preset=t||ue.props.checks.preset,H_();const i=e.searchParams.get("url");if(i)return pi({type:Nt.Url,data:i});const n=e.searchParams.get("id");if(n)return pi({type:Nt.Id,data:n});const o=e.searchParams.get("hash");if(o)return pi({type:Nt.Hash,data:o})}var Ho=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function q_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Yo(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ys={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var ju;function K_(){return ju||(ju=1,function(e,t){(function(i){e.exports=i()})(function(){return function i(n,o,r){function s(u,f){if(!o[u]){if(!n[u]){var b=typeof Yo=="function"&&Yo;if(!f&&b)return b(u,!0);if(a)return a(u,!0);var m=new Error("Cannot find module '"+u+"'");throw m.code="MODULE_NOT_FOUND",m}var g=o[u]={exports:{}};n[u][0].call(g.exports,function(E){var v=n[u][1][E];return s(v||E)},g,g.exports,i,n,o,r)}return o[u].exports}for(var a=typeof Yo=="function"&&Yo,l=0;l<r.length;l++)s(r[l]);return s}({1:[function(i,n,o){var r=i("./utils"),s=i("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(l){for(var u,f,b,m,g,E,v,y=[],_=0,D=l.length,C=D,O=r.getTypeOf(l)!=="string";_<l.length;)C=D-_,b=O?(u=l[_++],f=_<D?l[_++]:0,_<D?l[_++]:0):(u=l.charCodeAt(_++),f=_<D?l.charCodeAt(_++):0,_<D?l.charCodeAt(_++):0),m=u>>2,g=(3&u)<<4|f>>4,E=1<C?(15&f)<<2|b>>6:64,v=2<C?63&b:64,y.push(a.charAt(m)+a.charAt(g)+a.charAt(E)+a.charAt(v));return y.join("")},o.decode=function(l){var u,f,b,m,g,E,v=0,y=0,_="data:";if(l.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var D,C=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&C--,l.charAt(l.length-2)===a.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(D=s.uint8array?new Uint8Array(0|C):new Array(0|C);v<l.length;)u=a.indexOf(l.charAt(v++))<<2|(m=a.indexOf(l.charAt(v++)))>>4,f=(15&m)<<4|(g=a.indexOf(l.charAt(v++)))>>2,b=(3&g)<<6|(E=a.indexOf(l.charAt(v++))),D[y++]=u,g!==64&&(D[y++]=f),E!==64&&(D[y++]=b);return D}},{"./support":30,"./utils":32}],2:[function(i,n,o){var r=i("./external"),s=i("./stream/DataWorker"),a=i("./stream/Crc32Probe"),l=i("./stream/DataLengthProbe");function u(f,b,m,g,E){this.compressedSize=f,this.uncompressedSize=b,this.crc32=m,this.compression=g,this.compressedContent=E}u.prototype={getContentWorker:function(){var f=new s(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),b=this;return f.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(f,b,m){return f.pipe(new a).pipe(new l("uncompressedSize")).pipe(b.compressWorker(m)).pipe(new l("compressedSize")).withStreamInfo("compression",b)},n.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,n,o){var r=i("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},o.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,n,o){var r=i("./utils"),s=function(){for(var a,l=[],u=0;u<256;u++){a=u;for(var f=0;f<8;f++)a=1&a?3988292384^a>>>1:a>>>1;l[u]=a}return l}();n.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(u,f,b,m){var g=s,E=m+b;u^=-1;for(var v=m;v<E;v++)u=u>>>8^g[255&(u^f[v])];return-1^u}(0|l,a,a.length,0):function(u,f,b,m){var g=s,E=m+b;u^=-1;for(var v=m;v<E;v++)u=u>>>8^g[255&(u^f.charCodeAt(v))];return-1^u}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(i,n,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(i,n,o){var r=null;r=typeof Promise<"u"?Promise:i("lie"),n.exports={Promise:r}},{lie:37}],7:[function(i,n,o){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=i("pako"),a=i("./utils"),l=i("./stream/GenericWorker"),u=r?"uint8array":"array";function f(b,m){l.call(this,"FlateWorker/"+b),this._pako=null,this._pakoAction=b,this._pakoOptions=m,this.meta={}}o.magic="\b\0",a.inherits(f,l),f.prototype.processChunk=function(b){this.meta=b.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(u,b.data),!1)},f.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(m){b.push({data:m,meta:b.meta})}},o.compressWorker=function(b){return new f("Deflate",b)},o.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,n,o){function r(g,E){var v,y="";for(v=0;v<E;v++)y+=String.fromCharCode(255&g),g>>>=8;return y}function s(g,E,v,y,_,D){var C,O,x=g.file,H=g.compression,F=D!==u.utf8encode,Z=a.transformTo("string",D(x.name)),P=a.transformTo("string",u.utf8encode(x.name)),X=x.comment,ye=a.transformTo("string",D(X)),R=a.transformTo("string",u.utf8encode(X)),V=P.length!==x.name.length,d=R.length!==X.length,q="",Oe="",U="",Ie=x.dir,ee=x.date,we={crc32:0,compressedSize:0,uncompressedSize:0};E&&!v||(we.crc32=g.crc32,we.compressedSize=g.compressedSize,we.uncompressedSize=g.uncompressedSize);var M=0;E&&(M|=8),F||!V&&!d||(M|=2048);var A=0,Se=0;Ie&&(A|=16),_==="UNIX"?(Se=798,A|=function(ae,it){var Ct=ae;return ae||(Ct=it?16893:33204),(65535&Ct)<<16}(x.unixPermissions,Ie)):(Se=20,A|=function(ae){return 63&(ae||0)}(x.dosPermissions)),C=ee.getUTCHours(),C<<=6,C|=ee.getUTCMinutes(),C<<=5,C|=ee.getUTCSeconds()/2,O=ee.getUTCFullYear()-1980,O<<=4,O|=ee.getUTCMonth()+1,O<<=5,O|=ee.getUTCDate(),V&&(Oe=r(1,1)+r(f(Z),4)+P,q+="up"+r(Oe.length,2)+Oe),d&&(U=r(1,1)+r(f(ye),4)+R,q+="uc"+r(U.length,2)+U);var fe="";return fe+=`
\0`,fe+=r(M,2),fe+=H.magic,fe+=r(C,2),fe+=r(O,2),fe+=r(we.crc32,4),fe+=r(we.compressedSize,4),fe+=r(we.uncompressedSize,4),fe+=r(Z.length,2),fe+=r(q.length,2),{fileRecord:b.LOCAL_FILE_HEADER+fe+Z+q,dirRecord:b.CENTRAL_FILE_HEADER+r(Se,2)+fe+r(ye.length,2)+"\0\0\0\0"+r(A,4)+r(y,4)+Z+q+ye}}var a=i("../utils"),l=i("../stream/GenericWorker"),u=i("../utf8"),f=i("../crc32"),b=i("../signature");function m(g,E,v,y){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=E,this.zipPlatform=v,this.encodeFileName=y,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(m,l),m.prototype.push=function(g){var E=g.meta.percent||0,v=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,l.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:v?(E+100*(v-y-1))/v:100}}))},m.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var E=this.streamFiles&&!g.file.dir;if(E){var v=s(g,E,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:v.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(g){this.accumulate=!1;var E=this.streamFiles&&!g.file.dir,v=s(g,E,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(v.dirRecord),E)this.push({data:function(y){return b.DATA_DESCRIPTOR+r(y.crc32,4)+r(y.compressedSize,4)+r(y.uncompressedSize,4)}(g),meta:{percent:100}});else for(this.push({data:v.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var g=this.bytesWritten,E=0;E<this.dirRecords.length;E++)this.push({data:this.dirRecords[E],meta:{percent:100}});var v=this.bytesWritten-g,y=function(_,D,C,O,x){var H=a.transformTo("string",x(O));return b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(_,2)+r(_,2)+r(D,4)+r(C,4)+r(H.length,2)+H}(this.dirRecords.length,v,g,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(g){this._sources.push(g);var E=this;return g.on("data",function(v){E.processChunk(v)}),g.on("end",function(){E.closedSource(E.previous.streamInfo),E._sources.length?E.prepareNextSource():E.end()}),g.on("error",function(v){E.error(v)}),this},m.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(g){var E=this._sources;if(!l.prototype.error.call(this,g))return!1;for(var v=0;v<E.length;v++)try{E[v].error(g)}catch{}return!0},m.prototype.lock=function(){l.prototype.lock.call(this);for(var g=this._sources,E=0;E<g.length;E++)g[E].lock()},n.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,n,o){var r=i("../compressions"),s=i("./ZipFileWorker");o.generateWorker=function(a,l,u){var f=new s(l.streamFiles,u,l.platform,l.encodeFileName),b=0;try{a.forEach(function(m,g){b++;var E=function(D,C){var O=D||C,x=r[O];if(!x)throw new Error(O+" is not a valid compression method !");return x}(g.options.compression,l.compression),v=g.options.compressionOptions||l.compressionOptions||{},y=g.dir,_=g.date;g._compressWorker(E,v).withStreamInfo("file",{name:m,dir:y,date:_,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(f)}),f.entriesCount=b}catch(m){f.error(m)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,n,o){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new r;for(var a in this)typeof this[a]!="function"&&(s[a]=this[a]);return s}}(r.prototype=i("./object")).loadAsync=i("./load"),r.support=i("./support"),r.defaults=i("./defaults"),r.version="3.10.1",r.loadAsync=function(s,a){return new r().loadAsync(s,a)},r.external=i("./external"),n.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,n,o){var r=i("./utils"),s=i("./external"),a=i("./utf8"),l=i("./zipEntries"),u=i("./stream/Crc32Probe"),f=i("./nodejsUtils");function b(m){return new s.Promise(function(g,E){var v=m.decompressed.getContentWorker().pipe(new u);v.on("error",function(y){E(y)}).on("end",function(){v.streamInfo.crc32!==m.decompressed.crc32?E(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}n.exports=function(m,g){var E=this;return g=r.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),f.isNode&&f.isStream(m)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",m,!0,g.optimizedBinaryString,g.base64).then(function(v){var y=new l(g);return y.load(v),y}).then(function(v){var y=[s.Promise.resolve(v)],_=v.files;if(g.checkCRC32)for(var D=0;D<_.length;D++)y.push(b(_[D]));return s.Promise.all(y)}).then(function(v){for(var y=v.shift(),_=y.files,D=0;D<_.length;D++){var C=_[D],O=C.fileNameStr,x=r.resolve(C.fileNameStr);E.file(x,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:g.createFolders}),C.dir||(E.file(x).unsafeOriginalName=O)}return y.zipComment.length&&(E.comment=y.zipComment),E})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,n,o){var r=i("../utils"),s=i("../stream/GenericWorker");function a(l,u){s.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}r.inherits(a,s),a.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(f){u.push({data:f,meta:{percent:0}})}).on("error",function(f){u.isPaused?this.generatedError=f:u.error(f)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},a.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,n,o){var r=i("readable-stream").Readable;function s(a,l,u){r.call(this,l),this._helper=a;var f=this;a.on("data",function(b,m){f.push(b)||f._helper.pause(),u&&u(m)}).on("error",function(b){f.emit("error",b)}).on("end",function(){f.push(null)})}i("../utils").inherits(s,r),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(i,n,o){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,s);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,s)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var s=new Buffer(r);return s.fill(0),s},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(i,n,o){function r(x,H,F){var Z,P=a.getTypeOf(H),X=a.extend(F||{},f);X.date=X.date||new Date,X.compression!==null&&(X.compression=X.compression.toUpperCase()),typeof X.unixPermissions=="string"&&(X.unixPermissions=parseInt(X.unixPermissions,8)),X.unixPermissions&&16384&X.unixPermissions&&(X.dir=!0),X.dosPermissions&&16&X.dosPermissions&&(X.dir=!0),X.dir&&(x=_(x)),X.createFolders&&(Z=y(x))&&D.call(this,Z,!0);var ye=P==="string"&&X.binary===!1&&X.base64===!1;F&&F.binary!==void 0||(X.binary=!ye),(H instanceof b&&H.uncompressedSize===0||X.dir||!H||H.length===0)&&(X.base64=!1,X.binary=!0,H="",X.compression="STORE",P="string");var R=null;R=H instanceof b||H instanceof l?H:E.isNode&&E.isStream(H)?new v(x,H):a.prepareContent(x,H,X.binary,X.optimizedBinaryString,X.base64);var V=new m(x,R,X);this.files[x]=V}var s=i("./utf8"),a=i("./utils"),l=i("./stream/GenericWorker"),u=i("./stream/StreamHelper"),f=i("./defaults"),b=i("./compressedObject"),m=i("./zipObject"),g=i("./generate"),E=i("./nodejsUtils"),v=i("./nodejs/NodejsStreamInputAdapter"),y=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var H=x.lastIndexOf("/");return 0<H?x.substring(0,H):""},_=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},D=function(x,H){return H=H!==void 0?H:f.createFolders,x=_(x),this.files[x]||r.call(this,x,null,{dir:!0,createFolders:H}),this.files[x]};function C(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var O={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var H,F,Z;for(H in this.files)Z=this.files[H],(F=H.slice(this.root.length,H.length))&&H.slice(0,this.root.length)===this.root&&x(F,Z)},filter:function(x){var H=[];return this.forEach(function(F,Z){x(F,Z)&&H.push(Z)}),H},file:function(x,H,F){if(arguments.length!==1)return x=this.root+x,r.call(this,x,H,F),this;if(C(x)){var Z=x;return this.filter(function(X,ye){return!ye.dir&&Z.test(X)})}var P=this.files[this.root+x];return P&&!P.dir?P:null},folder:function(x){if(!x)return this;if(C(x))return this.filter(function(P,X){return X.dir&&x.test(P)});var H=this.root+x,F=D.call(this,H),Z=this.clone();return Z.root=F.name,Z},remove:function(x){x=this.root+x;var H=this.files[x];if(H||(x.slice(-1)!=="/"&&(x+="/"),H=this.files[x]),H&&!H.dir)delete this.files[x];else for(var F=this.filter(function(P,X){return X.name.slice(0,x.length)===x}),Z=0;Z<F.length;Z++)delete this.files[F[Z].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var H,F={};try{if((F=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=F.type.toLowerCase(),F.compression=F.compression.toUpperCase(),F.type==="binarystring"&&(F.type="string"),!F.type)throw new Error("No output type specified.");a.checkSupport(F.type),F.platform!=="darwin"&&F.platform!=="freebsd"&&F.platform!=="linux"&&F.platform!=="sunos"||(F.platform="UNIX"),F.platform==="win32"&&(F.platform="DOS");var Z=F.comment||this.comment||"";H=g.generateWorker(this,F,Z)}catch(P){(H=new l("error")).error(P)}return new u(H,F.type||"string",F.mimeType)},generateAsync:function(x,H){return this.generateInternalStream(x).accumulate(H)},generateNodeStream:function(x,H){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(H)}};n.exports=O},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,n,o){n.exports=i("stream")},{stream:void 0}],17:[function(i,n,o){var r=i("./DataReader");function s(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}i("../utils").inherits(s,r),s.prototype.byteAt=function(a){return this.data[this.zero+a]},s.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),u=a.charCodeAt(1),f=a.charCodeAt(2),b=a.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===l&&this.data[m+1]===u&&this.data[m+2]===f&&this.data[m+3]===b)return m-this.zero;return-1},s.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),u=a.charCodeAt(1),f=a.charCodeAt(2),b=a.charCodeAt(3),m=this.readData(4);return l===m[0]&&u===m[1]&&f===m[2]&&b===m[3]},s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(i,n,o){var r=i("../utils");function s(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,u=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=a,u},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=s},{"../utils":32}],19:[function(i,n,o){var r=i("./Uint8ArrayReader");function s(a){r.call(this,a)}i("../utils").inherits(s,r),s.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,n,o){var r=i("./DataReader");function s(a){r.call(this,a)}i("../utils").inherits(s,r),s.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},s.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},s.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},s.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(i,n,o){var r=i("./ArrayReader");function s(a){r.call(this,a)}i("../utils").inherits(s,r),s.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(i,n,o){var r=i("../utils"),s=i("../support"),a=i("./ArrayReader"),l=i("./StringReader"),u=i("./NodeBufferReader"),f=i("./Uint8ArrayReader");n.exports=function(b){var m=r.getTypeOf(b);return r.checkSupport(m),m!=="string"||s.uint8array?m==="nodebuffer"?new u(b):s.uint8array?new f(r.transformTo("uint8array",b)):new a(r.transformTo("array",b)):new l(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,n,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,n,o){var r=i("./GenericWorker"),s=i("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}s.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:s.transformTo(this.destType,l.data),meta:l.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(i,n,o){var r=i("./GenericWorker"),s=i("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}i("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=s(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,n,o){var r=i("../utils"),s=i("./GenericWorker");function a(l){s.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,s),a.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}s.prototype.processChunk.call(this,l)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(i,n,o){var r=i("../utils"),s=i("./GenericWorker");function a(l){s.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(f){u.dataIsReady=!0,u.data=f,u.max=f&&f.length||0,u.type=r.getTypeOf(f),u.isPaused||u._tickAndRepeat()},function(f){u.error(f)})}r.inherits(a,s),a.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(i,n,o){function r(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,a){return this._listeners[s].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,a){if(this._listeners[s])for(var l=0;l<this._listeners[s].length;l++)this._listeners[s][l].call(this,a)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var a=this;return s.on("data",function(l){a.processChunk(l)}),s.on("end",function(){a.end()}),s.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,a){return this.extraStreamInfo[s]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=r},{}],29:[function(i,n,o){var r=i("../utils"),s=i("./ConvertWorker"),a=i("./GenericWorker"),l=i("../base64"),u=i("../support"),f=i("../external"),b=null;if(u.nodestream)try{b=i("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(E,v){return new f.Promise(function(y,_){var D=[],C=E._internalType,O=E._outputType,x=E._mimeType;E.on("data",function(H,F){D.push(H),v&&v(F)}).on("error",function(H){D=[],_(H)}).on("end",function(){try{var H=function(F,Z,P){switch(F){case"blob":return r.newBlob(r.transformTo("arraybuffer",Z),P);case"base64":return l.encode(Z);default:return r.transformTo(F,Z)}}(O,function(F,Z){var P,X=0,ye=null,R=0;for(P=0;P<Z.length;P++)R+=Z[P].length;switch(F){case"string":return Z.join("");case"array":return Array.prototype.concat.apply([],Z);case"uint8array":for(ye=new Uint8Array(R),P=0;P<Z.length;P++)ye.set(Z[P],X),X+=Z[P].length;return ye;case"nodebuffer":return Buffer.concat(Z);default:throw new Error("concat : unsupported type '"+F+"'")}}(C,D),x);y(H)}catch(F){_(F)}D=[]}).resume()})}function g(E,v,y){var _=v;switch(v){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=v,this._mimeType=y,r.checkSupport(_),this._worker=E.pipe(new s(_)),E.lock()}catch(D){this._worker=new a("error"),this._worker.error(D)}}g.prototype={accumulate:function(E){return m(this,E)},on:function(E,v){var y=this;return E==="data"?this._worker.on(E,function(_){v.call(y,_.data,_.meta)}):this._worker.on(E,function(){r.delay(v,arguments,y)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new b(this,{objectMode:this._outputType!=="nodebuffer"},E)}},n.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,n,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var r=new ArrayBuffer(0);try{o.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(r),o.blob=s.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!i("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(i,n,o){for(var r=i("./utils"),s=i("./support"),a=i("./nodejsUtils"),l=i("./stream/GenericWorker"),u=new Array(256),f=0;f<256;f++)u[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;u[254]=u[254]=1;function b(){l.call(this,"utf-8 decode"),this.leftOver=null}function m(){l.call(this,"utf-8 encode")}o.utf8encode=function(g){return s.nodebuffer?a.newBufferFrom(g,"utf-8"):function(E){var v,y,_,D,C,O=E.length,x=0;for(D=0;D<O;D++)(64512&(y=E.charCodeAt(D)))==55296&&D+1<O&&(64512&(_=E.charCodeAt(D+1)))==56320&&(y=65536+(y-55296<<10)+(_-56320),D++),x+=y<128?1:y<2048?2:y<65536?3:4;for(v=s.uint8array?new Uint8Array(x):new Array(x),D=C=0;C<x;D++)(64512&(y=E.charCodeAt(D)))==55296&&D+1<O&&(64512&(_=E.charCodeAt(D+1)))==56320&&(y=65536+(y-55296<<10)+(_-56320),D++),y<128?v[C++]=y:(y<2048?v[C++]=192|y>>>6:(y<65536?v[C++]=224|y>>>12:(v[C++]=240|y>>>18,v[C++]=128|y>>>12&63),v[C++]=128|y>>>6&63),v[C++]=128|63&y);return v}(g)},o.utf8decode=function(g){return s.nodebuffer?r.transformTo("nodebuffer",g).toString("utf-8"):function(E){var v,y,_,D,C=E.length,O=new Array(2*C);for(v=y=0;v<C;)if((_=E[v++])<128)O[y++]=_;else if(4<(D=u[_]))O[y++]=65533,v+=D-1;else{for(_&=D===2?31:D===3?15:7;1<D&&v<C;)_=_<<6|63&E[v++],D--;1<D?O[y++]=65533:_<65536?O[y++]=_:(_-=65536,O[y++]=55296|_>>10&1023,O[y++]=56320|1023&_)}return O.length!==y&&(O.subarray?O=O.subarray(0,y):O.length=y),r.applyFromCharCode(O)}(g=r.transformTo(s.uint8array?"uint8array":"array",g))},r.inherits(b,l),b.prototype.processChunk=function(g){var E=r.transformTo(s.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var v=E;(E=new Uint8Array(v.length+this.leftOver.length)).set(this.leftOver,0),E.set(v,this.leftOver.length)}else E=this.leftOver.concat(E);this.leftOver=null}var y=function(D,C){var O;for((C=C||D.length)>D.length&&(C=D.length),O=C-1;0<=O&&(192&D[O])==128;)O--;return O<0||O===0?C:O+u[D[O]]>C?O:C}(E),_=E;y!==E.length&&(s.uint8array?(_=E.subarray(0,y),this.leftOver=E.subarray(y,E.length)):(_=E.slice(0,y),this.leftOver=E.slice(y,E.length))),this.push({data:o.utf8decode(_),meta:g.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=b,r.inherits(m,l),m.prototype.processChunk=function(g){this.push({data:o.utf8encode(g.data),meta:g.meta})},o.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,n,o){var r=i("./support"),s=i("./base64"),a=i("./nodejsUtils"),l=i("./external");function u(v){return v}function f(v,y){for(var _=0;_<v.length;++_)y[_]=255&v.charCodeAt(_);return y}i("setimmediate"),o.newBlob=function(v,y){o.checkSupport("blob");try{return new Blob([v],{type:y})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(v),_.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var b={stringifyByChunk:function(v,y,_){var D=[],C=0,O=v.length;if(O<=_)return String.fromCharCode.apply(null,v);for(;C<O;)y==="array"||y==="nodebuffer"?D.push(String.fromCharCode.apply(null,v.slice(C,Math.min(C+_,O)))):D.push(String.fromCharCode.apply(null,v.subarray(C,Math.min(C+_,O)))),C+=_;return D.join("")},stringifyByChar:function(v){for(var y="",_=0;_<v.length;_++)y+=String.fromCharCode(v[_]);return y},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function m(v){var y=65536,_=o.getTypeOf(v),D=!0;if(_==="uint8array"?D=b.applyCanBeUsed.uint8array:_==="nodebuffer"&&(D=b.applyCanBeUsed.nodebuffer),D)for(;1<y;)try{return b.stringifyByChunk(v,_,y)}catch{y=Math.floor(y/2)}return b.stringifyByChar(v)}function g(v,y){for(var _=0;_<v.length;_++)y[_]=v[_];return y}o.applyFromCharCode=m;var E={};E.string={string:u,array:function(v){return f(v,new Array(v.length))},arraybuffer:function(v){return E.string.uint8array(v).buffer},uint8array:function(v){return f(v,new Uint8Array(v.length))},nodebuffer:function(v){return f(v,a.allocBuffer(v.length))}},E.array={string:m,array:u,arraybuffer:function(v){return new Uint8Array(v).buffer},uint8array:function(v){return new Uint8Array(v)},nodebuffer:function(v){return a.newBufferFrom(v)}},E.arraybuffer={string:function(v){return m(new Uint8Array(v))},array:function(v){return g(new Uint8Array(v),new Array(v.byteLength))},arraybuffer:u,uint8array:function(v){return new Uint8Array(v)},nodebuffer:function(v){return a.newBufferFrom(new Uint8Array(v))}},E.uint8array={string:m,array:function(v){return g(v,new Array(v.length))},arraybuffer:function(v){return v.buffer},uint8array:u,nodebuffer:function(v){return a.newBufferFrom(v)}},E.nodebuffer={string:m,array:function(v){return g(v,new Array(v.length))},arraybuffer:function(v){return E.nodebuffer.uint8array(v).buffer},uint8array:function(v){return g(v,new Uint8Array(v.length))},nodebuffer:u},o.transformTo=function(v,y){if(y=y||"",!v)return y;o.checkSupport(v);var _=o.getTypeOf(y);return E[_][v](y)},o.resolve=function(v){for(var y=v.split("/"),_=[],D=0;D<y.length;D++){var C=y[D];C==="."||C===""&&D!==0&&D!==y.length-1||(C===".."?_.pop():_.push(C))}return _.join("/")},o.getTypeOf=function(v){return typeof v=="string"?"string":Object.prototype.toString.call(v)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(v)?"nodebuffer":r.uint8array&&v instanceof Uint8Array?"uint8array":r.arraybuffer&&v instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(v){if(!r[v.toLowerCase()])throw new Error(v+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(v){var y,_,D="";for(_=0;_<(v||"").length;_++)D+="\\x"+((y=v.charCodeAt(_))<16?"0":"")+y.toString(16).toUpperCase();return D},o.delay=function(v,y,_){setImmediate(function(){v.apply(_||null,y||[])})},o.inherits=function(v,y){function _(){}_.prototype=y.prototype,v.prototype=new _},o.extend=function(){var v,y,_={};for(v=0;v<arguments.length;v++)for(y in arguments[v])Object.prototype.hasOwnProperty.call(arguments[v],y)&&_[y]===void 0&&(_[y]=arguments[v][y]);return _},o.prepareContent=function(v,y,_,D,C){return l.Promise.resolve(y).then(function(O){return r.blob&&(O instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(O))!==-1)&&typeof FileReader<"u"?new l.Promise(function(x,H){var F=new FileReader;F.onload=function(Z){x(Z.target.result)},F.onerror=function(Z){H(Z.target.error)},F.readAsArrayBuffer(O)}):O}).then(function(O){var x=o.getTypeOf(O);return x?(x==="arraybuffer"?O=o.transformTo("uint8array",O):x==="string"&&(C?O=s.decode(O):_&&D!==!0&&(O=function(H){return f(H,r.uint8array?new Uint8Array(H.length):new Array(H.length))}(O))),O):l.Promise.reject(new Error("Can't read the data of '"+v+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,n,o){var r=i("./reader/readerFor"),s=i("./utils"),a=i("./signature"),l=i("./zipEntry"),u=i("./support");function f(b){this.files=[],this.loadOptions=b}f.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(m)+", expected "+s.pretty(b)+")")}},isSignature:function(b,m){var g=this.reader.index;this.reader.setIndex(b);var E=this.reader.readString(4)===m;return this.reader.setIndex(g),E},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength),m=u.uint8array?"uint8array":"array",g=s.transformTo(m,b);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var b,m,g,E=this.zip64EndOfCentralSize-44;0<E;)b=this.reader.readInt(2),m=this.reader.readInt(4),g=this.reader.readData(m),this.zip64ExtensibleData[b]={id:b,length:m,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var b,m;for(b=0;b<this.files.length;b++)m=this.files[b],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(b=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(b<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var m=b;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(b=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var E=m-g;if(0<E)this.isSignature(m,a.CENTRAL_FILE_HEADER)||(this.reader.zero=E);else if(E<0)throw new Error("Corrupted zip: missing "+Math.abs(E)+" bytes.")},prepareReader:function(b){this.reader=r(b)},load:function(b){this.prepareReader(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(i,n,o){var r=i("./reader/readerFor"),s=i("./utils"),a=i("./compressedObject"),l=i("./crc32"),u=i("./utf8"),f=i("./compressions"),b=i("./support");function m(g,E){this.options=g,this.loadOptions=E}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var E,v;if(g.skip(22),this.fileNameLength=g.readInt(2),v=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(v),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((E=function(y){for(var _ in f)if(Object.prototype.hasOwnProperty.call(f,_)&&f[_].magic===y)return f[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,E,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var E=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(E),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=r(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var E,v,y,_=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<_;)E=g.readInt(2),v=g.readInt(2),y=g.readData(v),this.extraFields[E]={id:E,length:v,value:y};g.setIndex(_)},handleUTF8:function(){var g=b.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var E=this.findExtraFieldUnicodePath();if(E!==null)this.fileNameStr=E;else{var v=s.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(v)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var _=s.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var E=r(g.value);return E.readInt(1)!==1||l(this.fileName)!==E.readInt(4)?null:u.utf8decode(E.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var E=r(g.value);return E.readInt(1)!==1||l(this.fileComment)!==E.readInt(4)?null:u.utf8decode(E.readData(g.length-5))}return null}},n.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,n,o){function r(E,v,y){this.name=E,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=v,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var s=i("./stream/StreamHelper"),a=i("./stream/DataWorker"),l=i("./utf8"),u=i("./compressedObject"),f=i("./stream/GenericWorker");r.prototype={internalStream:function(E){var v=null,y="string";try{if(!E)throw new Error("No output type specified.");var _=(y=E.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),v=this._decompressWorker();var D=!this._dataBinary;D&&!_&&(v=v.pipe(new l.Utf8EncodeWorker)),!D&&_&&(v=v.pipe(new l.Utf8DecodeWorker))}catch(C){(v=new f("error")).error(C)}return new s(v,y,"")},async:function(E,v){return this.internalStream(E).accumulate(v)},nodeStream:function(E,v){return this.internalStream(E||"nodebuffer").toNodejsStream(v)},_compressWorker:function(E,v){if(this._data instanceof u&&this._data.compression.magic===E.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(y,E,v)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof f?this._data:new a(this._data)}};for(var b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<b.length;g++)r.prototype[b[g]]=m;n.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,n,o){(function(r){var s,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var u=0,f=new l(E),b=r.document.createTextNode("");f.observe(b,{characterData:!0}),s=function(){b.data=u=++u%2}}else if(r.setImmediate||r.MessageChannel===void 0)s="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var v=r.document.createElement("script");v.onreadystatechange=function(){E(),v.onreadystatechange=null,v.parentNode.removeChild(v),v=null},r.document.documentElement.appendChild(v)}:function(){setTimeout(E,0)};else{var m=new r.MessageChannel;m.port1.onmessage=E,s=function(){m.port2.postMessage(0)}}var g=[];function E(){var v,y;a=!0;for(var _=g.length;_;){for(y=g,g=[],v=-1;++v<_;)y[v]();_=g.length}a=!1}n.exports=function(v){g.push(v)!==1||a||s()}}).call(this,typeof Ho<"u"?Ho:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(i,n,o){var r=i("immediate");function s(){}var a={},l=["REJECTED"],u=["FULFILLED"],f=["PENDING"];function b(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,_!==s&&v(this,_)}function m(_,D,C){this.promise=_,typeof D=="function"&&(this.onFulfilled=D,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function g(_,D,C){r(function(){var O;try{O=D(C)}catch(x){return a.reject(_,x)}O===_?a.reject(_,new TypeError("Cannot resolve promise with itself")):a.resolve(_,O)})}function E(_){var D=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof D=="function")return function(){D.apply(_,arguments)}}function v(_,D){var C=!1;function O(F){C||(C=!0,a.reject(_,F))}function x(F){C||(C=!0,a.resolve(_,F))}var H=y(function(){D(x,O)});H.status==="error"&&O(H.value)}function y(_,D){var C={};try{C.value=_(D),C.status="success"}catch(O){C.status="error",C.value=O}return C}(n.exports=b).prototype.finally=function(_){if(typeof _!="function")return this;var D=this.constructor;return this.then(function(C){return D.resolve(_()).then(function(){return C})},function(C){return D.resolve(_()).then(function(){throw C})})},b.prototype.catch=function(_){return this.then(null,_)},b.prototype.then=function(_,D){if(typeof _!="function"&&this.state===u||typeof D!="function"&&this.state===l)return this;var C=new this.constructor(s);return this.state!==f?g(C,this.state===u?_:D,this.outcome):this.queue.push(new m(C,_,D)),C},m.prototype.callFulfilled=function(_){a.resolve(this.promise,_)},m.prototype.otherCallFulfilled=function(_){g(this.promise,this.onFulfilled,_)},m.prototype.callRejected=function(_){a.reject(this.promise,_)},m.prototype.otherCallRejected=function(_){g(this.promise,this.onRejected,_)},a.resolve=function(_,D){var C=y(E,D);if(C.status==="error")return a.reject(_,C.value);var O=C.value;if(O)v(_,O);else{_.state=u,_.outcome=D;for(var x=-1,H=_.queue.length;++x<H;)_.queue[x].callFulfilled(D)}return _},a.reject=function(_,D){_.state=l,_.outcome=D;for(var C=-1,O=_.queue.length;++C<O;)_.queue[C].callRejected(D);return _},b.resolve=function(_){return _ instanceof this?_:a.resolve(new this(s),_)},b.reject=function(_){var D=new this(s);return a.reject(D,_)},b.all=function(_){var D=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=_.length,O=!1;if(!C)return this.resolve([]);for(var x=new Array(C),H=0,F=-1,Z=new this(s);++F<C;)P(_[F],F);return Z;function P(X,ye){D.resolve(X).then(function(R){x[ye]=R,++H!==C||O||(O=!0,a.resolve(Z,x))},function(R){O||(O=!0,a.reject(Z,R))})}},b.race=function(_){var D=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=_.length,O=!1;if(!C)return this.resolve([]);for(var x=-1,H=new this(s);++x<C;)F=_[x],D.resolve(F).then(function(Z){O||(O=!0,a.resolve(H,Z))},function(Z){O||(O=!0,a.reject(H,Z))});var F;return H}},{immediate:36}],38:[function(i,n,o){var r={};(0,i("./lib/utils/common").assign)(r,i("./lib/deflate"),i("./lib/inflate"),i("./lib/zlib/constants")),n.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,n,o){var r=i("./zlib/deflate"),s=i("./utils/common"),a=i("./utils/strings"),l=i("./zlib/messages"),u=i("./zlib/zstream"),f=Object.prototype.toString,b=0,m=-1,g=0,E=8;function v(_){if(!(this instanceof v))return new v(_);this.options=s.assign({level:m,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},_||{});var D=this.options;D.raw&&0<D.windowBits?D.windowBits=-D.windowBits:D.gzip&&0<D.windowBits&&D.windowBits<16&&(D.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var C=r.deflateInit2(this.strm,D.level,D.method,D.windowBits,D.memLevel,D.strategy);if(C!==b)throw new Error(l[C]);if(D.header&&r.deflateSetHeader(this.strm,D.header),D.dictionary){var O;if(O=typeof D.dictionary=="string"?a.string2buf(D.dictionary):f.call(D.dictionary)==="[object ArrayBuffer]"?new Uint8Array(D.dictionary):D.dictionary,(C=r.deflateSetDictionary(this.strm,O))!==b)throw new Error(l[C]);this._dict_set=!0}}function y(_,D){var C=new v(D);if(C.push(_,!0),C.err)throw C.msg||l[C.err];return C.result}v.prototype.push=function(_,D){var C,O,x=this.strm,H=this.options.chunkSize;if(this.ended)return!1;O=D===~~D?D:D===!0?4:0,typeof _=="string"?x.input=a.string2buf(_):f.call(_)==="[object ArrayBuffer]"?x.input=new Uint8Array(_):x.input=_,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new s.Buf8(H),x.next_out=0,x.avail_out=H),(C=r.deflate(x,O))!==1&&C!==b)return this.onEnd(C),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||O!==4&&O!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(s.shrinkBuf(x.output,x.next_out))):this.onData(s.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&C!==1);return O===4?(C=r.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===b):O!==2||(this.onEnd(b),!(x.avail_out=0))},v.prototype.onData=function(_){this.chunks.push(_)},v.prototype.onEnd=function(_){_===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},o.Deflate=v,o.deflate=y,o.deflateRaw=function(_,D){return(D=D||{}).raw=!0,y(_,D)},o.gzip=function(_,D){return(D=D||{}).gzip=!0,y(_,D)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,n,o){var r=i("./zlib/inflate"),s=i("./utils/common"),a=i("./utils/strings"),l=i("./zlib/constants"),u=i("./zlib/messages"),f=i("./zlib/zstream"),b=i("./zlib/gzheader"),m=Object.prototype.toString;function g(v){if(!(this instanceof g))return new g(v);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},v||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||v&&v.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&(15&y.windowBits)==0&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var _=r.inflateInit2(this.strm,y.windowBits);if(_!==l.Z_OK)throw new Error(u[_]);this.header=new b,r.inflateGetHeader(this.strm,this.header)}function E(v,y){var _=new g(y);if(_.push(v,!0),_.err)throw _.msg||u[_.err];return _.result}g.prototype.push=function(v,y){var _,D,C,O,x,H,F=this.strm,Z=this.options.chunkSize,P=this.options.dictionary,X=!1;if(this.ended)return!1;D=y===~~y?y:y===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof v=="string"?F.input=a.binstring2buf(v):m.call(v)==="[object ArrayBuffer]"?F.input=new Uint8Array(v):F.input=v,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new s.Buf8(Z),F.next_out=0,F.avail_out=Z),(_=r.inflate(F,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&P&&(H=typeof P=="string"?a.string2buf(P):m.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,_=r.inflateSetDictionary(this.strm,H)),_===l.Z_BUF_ERROR&&X===!0&&(_=l.Z_OK,X=!1),_!==l.Z_STREAM_END&&_!==l.Z_OK)return this.onEnd(_),!(this.ended=!0);F.next_out&&(F.avail_out!==0&&_!==l.Z_STREAM_END&&(F.avail_in!==0||D!==l.Z_FINISH&&D!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=a.utf8border(F.output,F.next_out),O=F.next_out-C,x=a.buf2string(F.output,C),F.next_out=O,F.avail_out=Z-O,O&&s.arraySet(F.output,F.output,C,O,0),this.onData(x)):this.onData(s.shrinkBuf(F.output,F.next_out)))),F.avail_in===0&&F.avail_out===0&&(X=!0)}while((0<F.avail_in||F.avail_out===0)&&_!==l.Z_STREAM_END);return _===l.Z_STREAM_END&&(D=l.Z_FINISH),D===l.Z_FINISH?(_=r.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===l.Z_OK):D!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(F.avail_out=0))},g.prototype.onData=function(v){this.chunks.push(v)},g.prototype.onEnd=function(v){v===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},o.Inflate=g,o.inflate=E,o.inflateRaw=function(v,y){return(y=y||{}).raw=!0,E(v,y)},o.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,n,o){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var f=u.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var b in f)f.hasOwnProperty(b)&&(l[b]=f[b])}}return l},o.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var s={arraySet:function(l,u,f,b,m){if(u.subarray&&l.subarray)l.set(u.subarray(f,f+b),m);else for(var g=0;g<b;g++)l[m+g]=u[f+g]},flattenChunks:function(l){var u,f,b,m,g,E;for(u=b=0,f=l.length;u<f;u++)b+=l[u].length;for(E=new Uint8Array(b),u=m=0,f=l.length;u<f;u++)g=l[u],E.set(g,m),m+=g.length;return E}},a={arraySet:function(l,u,f,b,m){for(var g=0;g<b;g++)l[m+g]=u[f+g]},flattenChunks:function(l){return[].concat.apply([],l)}};o.setTyped=function(l){l?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(r)},{}],42:[function(i,n,o){var r=i("./common"),s=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function f(b,m){if(m<65537&&(b.subarray&&a||!b.subarray&&s))return String.fromCharCode.apply(null,r.shrinkBuf(b,m));for(var g="",E=0;E<m;E++)g+=String.fromCharCode(b[E]);return g}l[254]=l[254]=1,o.string2buf=function(b){var m,g,E,v,y,_=b.length,D=0;for(v=0;v<_;v++)(64512&(g=b.charCodeAt(v)))==55296&&v+1<_&&(64512&(E=b.charCodeAt(v+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),v++),D+=g<128?1:g<2048?2:g<65536?3:4;for(m=new r.Buf8(D),v=y=0;y<D;v++)(64512&(g=b.charCodeAt(v)))==55296&&v+1<_&&(64512&(E=b.charCodeAt(v+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),v++),g<128?m[y++]=g:(g<2048?m[y++]=192|g>>>6:(g<65536?m[y++]=224|g>>>12:(m[y++]=240|g>>>18,m[y++]=128|g>>>12&63),m[y++]=128|g>>>6&63),m[y++]=128|63&g);return m},o.buf2binstring=function(b){return f(b,b.length)},o.binstring2buf=function(b){for(var m=new r.Buf8(b.length),g=0,E=m.length;g<E;g++)m[g]=b.charCodeAt(g);return m},o.buf2string=function(b,m){var g,E,v,y,_=m||b.length,D=new Array(2*_);for(g=E=0;g<_;)if((v=b[g++])<128)D[E++]=v;else if(4<(y=l[v]))D[E++]=65533,g+=y-1;else{for(v&=y===2?31:y===3?15:7;1<y&&g<_;)v=v<<6|63&b[g++],y--;1<y?D[E++]=65533:v<65536?D[E++]=v:(v-=65536,D[E++]=55296|v>>10&1023,D[E++]=56320|1023&v)}return f(D,E)},o.utf8border=function(b,m){var g;for((m=m||b.length)>b.length&&(m=b.length),g=m-1;0<=g&&(192&b[g])==128;)g--;return g<0||g===0?m:g+l[b[g]]>m?g:m}},{"./common":41}],43:[function(i,n,o){n.exports=function(r,s,a,l){for(var u=65535&r|0,f=r>>>16&65535|0,b=0;a!==0;){for(a-=b=2e3<a?2e3:a;f=f+(u=u+s[l++]|0)|0,--b;);u%=65521,f%=65521}return u|f<<16|0}},{}],44:[function(i,n,o){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,n,o){var r=function(){for(var s,a=[],l=0;l<256;l++){s=l;for(var u=0;u<8;u++)s=1&s?3988292384^s>>>1:s>>>1;a[l]=s}return a}();n.exports=function(s,a,l,u){var f=r,b=u+l;s^=-1;for(var m=u;m<b;m++)s=s>>>8^f[255&(s^a[m])];return-1^s}},{}],46:[function(i,n,o){var r,s=i("../utils/common"),a=i("./trees"),l=i("./adler32"),u=i("./crc32"),f=i("./messages"),b=0,m=4,g=0,E=-2,v=-1,y=4,_=2,D=8,C=9,O=286,x=30,H=19,F=2*O+1,Z=15,P=3,X=258,ye=X+P+1,R=42,V=113,d=1,q=2,Oe=3,U=4;function Ie(p,Y){return p.msg=f[Y],Y}function ee(p){return(p<<1)-(4<p?9:0)}function we(p){for(var Y=p.length;0<=--Y;)p[Y]=0}function M(p){var Y=p.state,I=Y.pending;I>p.avail_out&&(I=p.avail_out),I!==0&&(s.arraySet(p.output,Y.pending_buf,Y.pending_out,I,p.next_out),p.next_out+=I,Y.pending_out+=I,p.total_out+=I,p.avail_out-=I,Y.pending-=I,Y.pending===0&&(Y.pending_out=0))}function A(p,Y){a._tr_flush_block(p,0<=p.block_start?p.block_start:-1,p.strstart-p.block_start,Y),p.block_start=p.strstart,M(p.strm)}function Se(p,Y){p.pending_buf[p.pending++]=Y}function fe(p,Y){p.pending_buf[p.pending++]=Y>>>8&255,p.pending_buf[p.pending++]=255&Y}function ae(p,Y){var I,w,T=p.max_chain_length,B=p.strstart,K=p.prev_length,Q=p.nice_match,k=p.strstart>p.w_size-ye?p.strstart-(p.w_size-ye):0,ie=p.window,me=p.w_mask,oe=p.prev,_e=p.strstart+X,Xe=ie[B+K-1],Ve=ie[B+K];p.prev_length>=p.good_match&&(T>>=2),Q>p.lookahead&&(Q=p.lookahead);do if(ie[(I=Y)+K]===Ve&&ie[I+K-1]===Xe&&ie[I]===ie[B]&&ie[++I]===ie[B+1]){B+=2,I++;do;while(ie[++B]===ie[++I]&&ie[++B]===ie[++I]&&ie[++B]===ie[++I]&&ie[++B]===ie[++I]&&ie[++B]===ie[++I]&&ie[++B]===ie[++I]&&ie[++B]===ie[++I]&&ie[++B]===ie[++I]&&B<_e);if(w=X-(_e-B),B=_e-X,K<w){if(p.match_start=Y,Q<=(K=w))break;Xe=ie[B+K-1],Ve=ie[B+K]}}while((Y=oe[Y&me])>k&&--T!=0);return K<=p.lookahead?K:p.lookahead}function it(p){var Y,I,w,T,B,K,Q,k,ie,me,oe=p.w_size;do{if(T=p.window_size-p.lookahead-p.strstart,p.strstart>=oe+(oe-ye)){for(s.arraySet(p.window,p.window,oe,oe,0),p.match_start-=oe,p.strstart-=oe,p.block_start-=oe,Y=I=p.hash_size;w=p.head[--Y],p.head[Y]=oe<=w?w-oe:0,--I;);for(Y=I=oe;w=p.prev[--Y],p.prev[Y]=oe<=w?w-oe:0,--I;);T+=oe}if(p.strm.avail_in===0)break;if(K=p.strm,Q=p.window,k=p.strstart+p.lookahead,ie=T,me=void 0,me=K.avail_in,ie<me&&(me=ie),I=me===0?0:(K.avail_in-=me,s.arraySet(Q,K.input,K.next_in,me,k),K.state.wrap===1?K.adler=l(K.adler,Q,me,k):K.state.wrap===2&&(K.adler=u(K.adler,Q,me,k)),K.next_in+=me,K.total_in+=me,me),p.lookahead+=I,p.lookahead+p.insert>=P)for(B=p.strstart-p.insert,p.ins_h=p.window[B],p.ins_h=(p.ins_h<<p.hash_shift^p.window[B+1])&p.hash_mask;p.insert&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[B+P-1])&p.hash_mask,p.prev[B&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=B,B++,p.insert--,!(p.lookahead+p.insert<P)););}while(p.lookahead<ye&&p.strm.avail_in!==0)}function Ct(p,Y){for(var I,w;;){if(p.lookahead<ye){if(it(p),p.lookahead<ye&&Y===b)return d;if(p.lookahead===0)break}if(I=0,p.lookahead>=P&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+P-1])&p.hash_mask,I=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),I!==0&&p.strstart-I<=p.w_size-ye&&(p.match_length=ae(p,I)),p.match_length>=P)if(w=a._tr_tally(p,p.strstart-p.match_start,p.match_length-P),p.lookahead-=p.match_length,p.match_length<=p.max_lazy_match&&p.lookahead>=P){for(p.match_length--;p.strstart++,p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+P-1])&p.hash_mask,I=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart,--p.match_length!=0;);p.strstart++}else p.strstart+=p.match_length,p.match_length=0,p.ins_h=p.window[p.strstart],p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+1])&p.hash_mask;else w=a._tr_tally(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++;if(w&&(A(p,!1),p.strm.avail_out===0))return d}return p.insert=p.strstart<P-1?p.strstart:P-1,Y===m?(A(p,!0),p.strm.avail_out===0?Oe:U):p.last_lit&&(A(p,!1),p.strm.avail_out===0)?d:q}function Fe(p,Y){for(var I,w,T;;){if(p.lookahead<ye){if(it(p),p.lookahead<ye&&Y===b)return d;if(p.lookahead===0)break}if(I=0,p.lookahead>=P&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+P-1])&p.hash_mask,I=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),p.prev_length=p.match_length,p.prev_match=p.match_start,p.match_length=P-1,I!==0&&p.prev_length<p.max_lazy_match&&p.strstart-I<=p.w_size-ye&&(p.match_length=ae(p,I),p.match_length<=5&&(p.strategy===1||p.match_length===P&&4096<p.strstart-p.match_start)&&(p.match_length=P-1)),p.prev_length>=P&&p.match_length<=p.prev_length){for(T=p.strstart+p.lookahead-P,w=a._tr_tally(p,p.strstart-1-p.prev_match,p.prev_length-P),p.lookahead-=p.prev_length-1,p.prev_length-=2;++p.strstart<=T&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+P-1])&p.hash_mask,I=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),--p.prev_length!=0;);if(p.match_available=0,p.match_length=P-1,p.strstart++,w&&(A(p,!1),p.strm.avail_out===0))return d}else if(p.match_available){if((w=a._tr_tally(p,0,p.window[p.strstart-1]))&&A(p,!1),p.strstart++,p.lookahead--,p.strm.avail_out===0)return d}else p.match_available=1,p.strstart++,p.lookahead--}return p.match_available&&(w=a._tr_tally(p,0,p.window[p.strstart-1]),p.match_available=0),p.insert=p.strstart<P-1?p.strstart:P-1,Y===m?(A(p,!0),p.strm.avail_out===0?Oe:U):p.last_lit&&(A(p,!1),p.strm.avail_out===0)?d:q}function We(p,Y,I,w,T){this.good_length=p,this.max_lazy=Y,this.nice_length=I,this.max_chain=w,this.func=T}function vt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=D,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*F),this.dyn_dtree=new s.Buf16(2*(2*x+1)),this.bl_tree=new s.Buf16(2*(2*H+1)),we(this.dyn_ltree),we(this.dyn_dtree),we(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(Z+1),this.heap=new s.Buf16(2*O+1),we(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*O+1),we(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function nt(p){var Y;return p&&p.state?(p.total_in=p.total_out=0,p.data_type=_,(Y=p.state).pending=0,Y.pending_out=0,Y.wrap<0&&(Y.wrap=-Y.wrap),Y.status=Y.wrap?R:V,p.adler=Y.wrap===2?0:1,Y.last_flush=b,a._tr_init(Y),g):Ie(p,E)}function Ti(p){var Y=nt(p);return Y===g&&function(I){I.window_size=2*I.w_size,we(I.head),I.max_lazy_match=r[I.level].max_lazy,I.good_match=r[I.level].good_length,I.nice_match=r[I.level].nice_length,I.max_chain_length=r[I.level].max_chain,I.strstart=0,I.block_start=0,I.lookahead=0,I.insert=0,I.match_length=I.prev_length=P-1,I.match_available=0,I.ins_h=0}(p.state),Y}function fi(p,Y,I,w,T,B){if(!p)return E;var K=1;if(Y===v&&(Y=6),w<0?(K=0,w=-w):15<w&&(K=2,w-=16),T<1||C<T||I!==D||w<8||15<w||Y<0||9<Y||B<0||y<B)return Ie(p,E);w===8&&(w=9);var Q=new vt;return(p.state=Q).strm=p,Q.wrap=K,Q.gzhead=null,Q.w_bits=w,Q.w_size=1<<Q.w_bits,Q.w_mask=Q.w_size-1,Q.hash_bits=T+7,Q.hash_size=1<<Q.hash_bits,Q.hash_mask=Q.hash_size-1,Q.hash_shift=~~((Q.hash_bits+P-1)/P),Q.window=new s.Buf8(2*Q.w_size),Q.head=new s.Buf16(Q.hash_size),Q.prev=new s.Buf16(Q.w_size),Q.lit_bufsize=1<<T+6,Q.pending_buf_size=4*Q.lit_bufsize,Q.pending_buf=new s.Buf8(Q.pending_buf_size),Q.d_buf=1*Q.lit_bufsize,Q.l_buf=3*Q.lit_bufsize,Q.level=Y,Q.strategy=B,Q.method=I,Ti(p)}r=[new We(0,0,0,0,function(p,Y){var I=65535;for(I>p.pending_buf_size-5&&(I=p.pending_buf_size-5);;){if(p.lookahead<=1){if(it(p),p.lookahead===0&&Y===b)return d;if(p.lookahead===0)break}p.strstart+=p.lookahead,p.lookahead=0;var w=p.block_start+I;if((p.strstart===0||p.strstart>=w)&&(p.lookahead=p.strstart-w,p.strstart=w,A(p,!1),p.strm.avail_out===0)||p.strstart-p.block_start>=p.w_size-ye&&(A(p,!1),p.strm.avail_out===0))return d}return p.insert=0,Y===m?(A(p,!0),p.strm.avail_out===0?Oe:U):(p.strstart>p.block_start&&(A(p,!1),p.strm.avail_out),d)}),new We(4,4,8,4,Ct),new We(4,5,16,8,Ct),new We(4,6,32,32,Ct),new We(4,4,16,16,Fe),new We(8,16,32,32,Fe),new We(8,16,128,128,Fe),new We(8,32,128,256,Fe),new We(32,128,258,1024,Fe),new We(32,258,258,4096,Fe)],o.deflateInit=function(p,Y){return fi(p,Y,D,15,8,0)},o.deflateInit2=fi,o.deflateReset=Ti,o.deflateResetKeep=nt,o.deflateSetHeader=function(p,Y){return p&&p.state?p.state.wrap!==2?E:(p.state.gzhead=Y,g):E},o.deflate=function(p,Y){var I,w,T,B;if(!p||!p.state||5<Y||Y<0)return p?Ie(p,E):E;if(w=p.state,!p.output||!p.input&&p.avail_in!==0||w.status===666&&Y!==m)return Ie(p,p.avail_out===0?-5:E);if(w.strm=p,I=w.last_flush,w.last_flush=Y,w.status===R)if(w.wrap===2)p.adler=0,Se(w,31),Se(w,139),Se(w,8),w.gzhead?(Se(w,(w.gzhead.text?1:0)+(w.gzhead.hcrc?2:0)+(w.gzhead.extra?4:0)+(w.gzhead.name?8:0)+(w.gzhead.comment?16:0)),Se(w,255&w.gzhead.time),Se(w,w.gzhead.time>>8&255),Se(w,w.gzhead.time>>16&255),Se(w,w.gzhead.time>>24&255),Se(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),Se(w,255&w.gzhead.os),w.gzhead.extra&&w.gzhead.extra.length&&(Se(w,255&w.gzhead.extra.length),Se(w,w.gzhead.extra.length>>8&255)),w.gzhead.hcrc&&(p.adler=u(p.adler,w.pending_buf,w.pending,0)),w.gzindex=0,w.status=69):(Se(w,0),Se(w,0),Se(w,0),Se(w,0),Se(w,0),Se(w,w.level===9?2:2<=w.strategy||w.level<2?4:0),Se(w,3),w.status=V);else{var K=D+(w.w_bits-8<<4)<<8;K|=(2<=w.strategy||w.level<2?0:w.level<6?1:w.level===6?2:3)<<6,w.strstart!==0&&(K|=32),K+=31-K%31,w.status=V,fe(w,K),w.strstart!==0&&(fe(w,p.adler>>>16),fe(w,65535&p.adler)),p.adler=1}if(w.status===69)if(w.gzhead.extra){for(T=w.pending;w.gzindex<(65535&w.gzhead.extra.length)&&(w.pending!==w.pending_buf_size||(w.gzhead.hcrc&&w.pending>T&&(p.adler=u(p.adler,w.pending_buf,w.pending-T,T)),M(p),T=w.pending,w.pending!==w.pending_buf_size));)Se(w,255&w.gzhead.extra[w.gzindex]),w.gzindex++;w.gzhead.hcrc&&w.pending>T&&(p.adler=u(p.adler,w.pending_buf,w.pending-T,T)),w.gzindex===w.gzhead.extra.length&&(w.gzindex=0,w.status=73)}else w.status=73;if(w.status===73)if(w.gzhead.name){T=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>T&&(p.adler=u(p.adler,w.pending_buf,w.pending-T,T)),M(p),T=w.pending,w.pending===w.pending_buf_size)){B=1;break}B=w.gzindex<w.gzhead.name.length?255&w.gzhead.name.charCodeAt(w.gzindex++):0,Se(w,B)}while(B!==0);w.gzhead.hcrc&&w.pending>T&&(p.adler=u(p.adler,w.pending_buf,w.pending-T,T)),B===0&&(w.gzindex=0,w.status=91)}else w.status=91;if(w.status===91)if(w.gzhead.comment){T=w.pending;do{if(w.pending===w.pending_buf_size&&(w.gzhead.hcrc&&w.pending>T&&(p.adler=u(p.adler,w.pending_buf,w.pending-T,T)),M(p),T=w.pending,w.pending===w.pending_buf_size)){B=1;break}B=w.gzindex<w.gzhead.comment.length?255&w.gzhead.comment.charCodeAt(w.gzindex++):0,Se(w,B)}while(B!==0);w.gzhead.hcrc&&w.pending>T&&(p.adler=u(p.adler,w.pending_buf,w.pending-T,T)),B===0&&(w.status=103)}else w.status=103;if(w.status===103&&(w.gzhead.hcrc?(w.pending+2>w.pending_buf_size&&M(p),w.pending+2<=w.pending_buf_size&&(Se(w,255&p.adler),Se(w,p.adler>>8&255),p.adler=0,w.status=V)):w.status=V),w.pending!==0){if(M(p),p.avail_out===0)return w.last_flush=-1,g}else if(p.avail_in===0&&ee(Y)<=ee(I)&&Y!==m)return Ie(p,-5);if(w.status===666&&p.avail_in!==0)return Ie(p,-5);if(p.avail_in!==0||w.lookahead!==0||Y!==b&&w.status!==666){var Q=w.strategy===2?function(k,ie){for(var me;;){if(k.lookahead===0&&(it(k),k.lookahead===0)){if(ie===b)return d;break}if(k.match_length=0,me=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++,me&&(A(k,!1),k.strm.avail_out===0))return d}return k.insert=0,ie===m?(A(k,!0),k.strm.avail_out===0?Oe:U):k.last_lit&&(A(k,!1),k.strm.avail_out===0)?d:q}(w,Y):w.strategy===3?function(k,ie){for(var me,oe,_e,Xe,Ve=k.window;;){if(k.lookahead<=X){if(it(k),k.lookahead<=X&&ie===b)return d;if(k.lookahead===0)break}if(k.match_length=0,k.lookahead>=P&&0<k.strstart&&(oe=Ve[_e=k.strstart-1])===Ve[++_e]&&oe===Ve[++_e]&&oe===Ve[++_e]){Xe=k.strstart+X;do;while(oe===Ve[++_e]&&oe===Ve[++_e]&&oe===Ve[++_e]&&oe===Ve[++_e]&&oe===Ve[++_e]&&oe===Ve[++_e]&&oe===Ve[++_e]&&oe===Ve[++_e]&&_e<Xe);k.match_length=X-(Xe-_e),k.match_length>k.lookahead&&(k.match_length=k.lookahead)}if(k.match_length>=P?(me=a._tr_tally(k,1,k.match_length-P),k.lookahead-=k.match_length,k.strstart+=k.match_length,k.match_length=0):(me=a._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++),me&&(A(k,!1),k.strm.avail_out===0))return d}return k.insert=0,ie===m?(A(k,!0),k.strm.avail_out===0?Oe:U):k.last_lit&&(A(k,!1),k.strm.avail_out===0)?d:q}(w,Y):r[w.level].func(w,Y);if(Q!==Oe&&Q!==U||(w.status=666),Q===d||Q===Oe)return p.avail_out===0&&(w.last_flush=-1),g;if(Q===q&&(Y===1?a._tr_align(w):Y!==5&&(a._tr_stored_block(w,0,0,!1),Y===3&&(we(w.head),w.lookahead===0&&(w.strstart=0,w.block_start=0,w.insert=0))),M(p),p.avail_out===0))return w.last_flush=-1,g}return Y!==m?g:w.wrap<=0?1:(w.wrap===2?(Se(w,255&p.adler),Se(w,p.adler>>8&255),Se(w,p.adler>>16&255),Se(w,p.adler>>24&255),Se(w,255&p.total_in),Se(w,p.total_in>>8&255),Se(w,p.total_in>>16&255),Se(w,p.total_in>>24&255)):(fe(w,p.adler>>>16),fe(w,65535&p.adler)),M(p),0<w.wrap&&(w.wrap=-w.wrap),w.pending!==0?g:1)},o.deflateEnd=function(p){var Y;return p&&p.state?(Y=p.state.status)!==R&&Y!==69&&Y!==73&&Y!==91&&Y!==103&&Y!==V&&Y!==666?Ie(p,E):(p.state=null,Y===V?Ie(p,-3):g):E},o.deflateSetDictionary=function(p,Y){var I,w,T,B,K,Q,k,ie,me=Y.length;if(!p||!p.state||(B=(I=p.state).wrap)===2||B===1&&I.status!==R||I.lookahead)return E;for(B===1&&(p.adler=l(p.adler,Y,me,0)),I.wrap=0,me>=I.w_size&&(B===0&&(we(I.head),I.strstart=0,I.block_start=0,I.insert=0),ie=new s.Buf8(I.w_size),s.arraySet(ie,Y,me-I.w_size,I.w_size,0),Y=ie,me=I.w_size),K=p.avail_in,Q=p.next_in,k=p.input,p.avail_in=me,p.next_in=0,p.input=Y,it(I);I.lookahead>=P;){for(w=I.strstart,T=I.lookahead-(P-1);I.ins_h=(I.ins_h<<I.hash_shift^I.window[w+P-1])&I.hash_mask,I.prev[w&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=w,w++,--T;);I.strstart=w,I.lookahead=P-1,it(I)}return I.strstart+=I.lookahead,I.block_start=I.strstart,I.insert=I.lookahead,I.lookahead=0,I.match_length=I.prev_length=P-1,I.match_available=0,p.next_in=Q,p.input=k,p.avail_in=K,I.wrap=B,g},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,n,o){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,n,o){n.exports=function(r,s){var a,l,u,f,b,m,g,E,v,y,_,D,C,O,x,H,F,Z,P,X,ye,R,V,d,q;a=r.state,l=r.next_in,d=r.input,u=l+(r.avail_in-5),f=r.next_out,q=r.output,b=f-(s-r.avail_out),m=f+(r.avail_out-257),g=a.dmax,E=a.wsize,v=a.whave,y=a.wnext,_=a.window,D=a.hold,C=a.bits,O=a.lencode,x=a.distcode,H=(1<<a.lenbits)-1,F=(1<<a.distbits)-1;e:do{C<15&&(D+=d[l++]<<C,C+=8,D+=d[l++]<<C,C+=8),Z=O[D&H];t:for(;;){if(D>>>=P=Z>>>24,C-=P,(P=Z>>>16&255)===0)q[f++]=65535&Z;else{if(!(16&P)){if((64&P)==0){Z=O[(65535&Z)+(D&(1<<P)-1)];continue t}if(32&P){a.mode=12;break e}r.msg="invalid literal/length code",a.mode=30;break e}X=65535&Z,(P&=15)&&(C<P&&(D+=d[l++]<<C,C+=8),X+=D&(1<<P)-1,D>>>=P,C-=P),C<15&&(D+=d[l++]<<C,C+=8,D+=d[l++]<<C,C+=8),Z=x[D&F];i:for(;;){if(D>>>=P=Z>>>24,C-=P,!(16&(P=Z>>>16&255))){if((64&P)==0){Z=x[(65535&Z)+(D&(1<<P)-1)];continue i}r.msg="invalid distance code",a.mode=30;break e}if(ye=65535&Z,C<(P&=15)&&(D+=d[l++]<<C,(C+=8)<P&&(D+=d[l++]<<C,C+=8)),g<(ye+=D&(1<<P)-1)){r.msg="invalid distance too far back",a.mode=30;break e}if(D>>>=P,C-=P,(P=f-b)<ye){if(v<(P=ye-P)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break e}if(V=_,(R=0)===y){if(R+=E-P,P<X){for(X-=P;q[f++]=_[R++],--P;);R=f-ye,V=q}}else if(y<P){if(R+=E+y-P,(P-=y)<X){for(X-=P;q[f++]=_[R++],--P;);if(R=0,y<X){for(X-=P=y;q[f++]=_[R++],--P;);R=f-ye,V=q}}}else if(R+=y-P,P<X){for(X-=P;q[f++]=_[R++],--P;);R=f-ye,V=q}for(;2<X;)q[f++]=V[R++],q[f++]=V[R++],q[f++]=V[R++],X-=3;X&&(q[f++]=V[R++],1<X&&(q[f++]=V[R++]))}else{for(R=f-ye;q[f++]=q[R++],q[f++]=q[R++],q[f++]=q[R++],2<(X-=3););X&&(q[f++]=q[R++],1<X&&(q[f++]=q[R++]))}break}}break}}while(l<u&&f<m);l-=X=C>>3,D&=(1<<(C-=X<<3))-1,r.next_in=l,r.next_out=f,r.avail_in=l<u?u-l+5:5-(l-u),r.avail_out=f<m?m-f+257:257-(f-m),a.hold=D,a.bits=C}},{}],49:[function(i,n,o){var r=i("../utils/common"),s=i("./adler32"),a=i("./crc32"),l=i("./inffast"),u=i("./inftrees"),f=1,b=2,m=0,g=-2,E=1,v=852,y=592;function _(R){return(R>>>24&255)+(R>>>8&65280)+((65280&R)<<8)+((255&R)<<24)}function D(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(R){var V;return R&&R.state?(V=R.state,R.total_in=R.total_out=V.total=0,R.msg="",V.wrap&&(R.adler=1&V.wrap),V.mode=E,V.last=0,V.havedict=0,V.dmax=32768,V.head=null,V.hold=0,V.bits=0,V.lencode=V.lendyn=new r.Buf32(v),V.distcode=V.distdyn=new r.Buf32(y),V.sane=1,V.back=-1,m):g}function O(R){var V;return R&&R.state?((V=R.state).wsize=0,V.whave=0,V.wnext=0,C(R)):g}function x(R,V){var d,q;return R&&R.state?(q=R.state,V<0?(d=0,V=-V):(d=1+(V>>4),V<48&&(V&=15)),V&&(V<8||15<V)?g:(q.window!==null&&q.wbits!==V&&(q.window=null),q.wrap=d,q.wbits=V,O(R))):g}function H(R,V){var d,q;return R?(q=new D,(R.state=q).window=null,(d=x(R,V))!==m&&(R.state=null),d):g}var F,Z,P=!0;function X(R){if(P){var V;for(F=new r.Buf32(512),Z=new r.Buf32(32),V=0;V<144;)R.lens[V++]=8;for(;V<256;)R.lens[V++]=9;for(;V<280;)R.lens[V++]=7;for(;V<288;)R.lens[V++]=8;for(u(f,R.lens,0,288,F,0,R.work,{bits:9}),V=0;V<32;)R.lens[V++]=5;u(b,R.lens,0,32,Z,0,R.work,{bits:5}),P=!1}R.lencode=F,R.lenbits=9,R.distcode=Z,R.distbits=5}function ye(R,V,d,q){var Oe,U=R.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new r.Buf8(U.wsize)),q>=U.wsize?(r.arraySet(U.window,V,d-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(q<(Oe=U.wsize-U.wnext)&&(Oe=q),r.arraySet(U.window,V,d-q,Oe,U.wnext),(q-=Oe)?(r.arraySet(U.window,V,d-q,q,0),U.wnext=q,U.whave=U.wsize):(U.wnext+=Oe,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=Oe))),0}o.inflateReset=O,o.inflateReset2=x,o.inflateResetKeep=C,o.inflateInit=function(R){return H(R,15)},o.inflateInit2=H,o.inflate=function(R,V){var d,q,Oe,U,Ie,ee,we,M,A,Se,fe,ae,it,Ct,Fe,We,vt,nt,Ti,fi,p,Y,I,w,T=0,B=new r.Buf8(4),K=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!R||!R.state||!R.output||!R.input&&R.avail_in!==0)return g;(d=R.state).mode===12&&(d.mode=13),Ie=R.next_out,Oe=R.output,we=R.avail_out,U=R.next_in,q=R.input,ee=R.avail_in,M=d.hold,A=d.bits,Se=ee,fe=we,Y=m;e:for(;;)switch(d.mode){case E:if(d.wrap===0){d.mode=13;break}for(;A<16;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if(2&d.wrap&&M===35615){B[d.check=0]=255&M,B[1]=M>>>8&255,d.check=a(d.check,B,2,0),A=M=0,d.mode=2;break}if(d.flags=0,d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&M)<<8)+(M>>8))%31){R.msg="incorrect header check",d.mode=30;break}if((15&M)!=8){R.msg="unknown compression method",d.mode=30;break}if(A-=4,p=8+(15&(M>>>=4)),d.wbits===0)d.wbits=p;else if(p>d.wbits){R.msg="invalid window size",d.mode=30;break}d.dmax=1<<p,R.adler=d.check=1,d.mode=512&M?10:12,A=M=0;break;case 2:for(;A<16;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if(d.flags=M,(255&d.flags)!=8){R.msg="unknown compression method",d.mode=30;break}if(57344&d.flags){R.msg="unknown header flags set",d.mode=30;break}d.head&&(d.head.text=M>>8&1),512&d.flags&&(B[0]=255&M,B[1]=M>>>8&255,d.check=a(d.check,B,2,0)),A=M=0,d.mode=3;case 3:for(;A<32;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}d.head&&(d.head.time=M),512&d.flags&&(B[0]=255&M,B[1]=M>>>8&255,B[2]=M>>>16&255,B[3]=M>>>24&255,d.check=a(d.check,B,4,0)),A=M=0,d.mode=4;case 4:for(;A<16;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}d.head&&(d.head.xflags=255&M,d.head.os=M>>8),512&d.flags&&(B[0]=255&M,B[1]=M>>>8&255,d.check=a(d.check,B,2,0)),A=M=0,d.mode=5;case 5:if(1024&d.flags){for(;A<16;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}d.length=M,d.head&&(d.head.extra_len=M),512&d.flags&&(B[0]=255&M,B[1]=M>>>8&255,d.check=a(d.check,B,2,0)),A=M=0}else d.head&&(d.head.extra=null);d.mode=6;case 6:if(1024&d.flags&&(ee<(ae=d.length)&&(ae=ee),ae&&(d.head&&(p=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Array(d.head.extra_len)),r.arraySet(d.head.extra,q,U,ae,p)),512&d.flags&&(d.check=a(d.check,q,ae,U)),ee-=ae,U+=ae,d.length-=ae),d.length))break e;d.length=0,d.mode=7;case 7:if(2048&d.flags){if(ee===0)break e;for(ae=0;p=q[U+ae++],d.head&&p&&d.length<65536&&(d.head.name+=String.fromCharCode(p)),p&&ae<ee;);if(512&d.flags&&(d.check=a(d.check,q,ae,U)),ee-=ae,U+=ae,p)break e}else d.head&&(d.head.name=null);d.length=0,d.mode=8;case 8:if(4096&d.flags){if(ee===0)break e;for(ae=0;p=q[U+ae++],d.head&&p&&d.length<65536&&(d.head.comment+=String.fromCharCode(p)),p&&ae<ee;);if(512&d.flags&&(d.check=a(d.check,q,ae,U)),ee-=ae,U+=ae,p)break e}else d.head&&(d.head.comment=null);d.mode=9;case 9:if(512&d.flags){for(;A<16;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if(M!==(65535&d.check)){R.msg="header crc mismatch",d.mode=30;break}A=M=0}d.head&&(d.head.hcrc=d.flags>>9&1,d.head.done=!0),R.adler=d.check=0,d.mode=12;break;case 10:for(;A<32;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}R.adler=d.check=_(M),A=M=0,d.mode=11;case 11:if(d.havedict===0)return R.next_out=Ie,R.avail_out=we,R.next_in=U,R.avail_in=ee,d.hold=M,d.bits=A,2;R.adler=d.check=1,d.mode=12;case 12:if(V===5||V===6)break e;case 13:if(d.last){M>>>=7&A,A-=7&A,d.mode=27;break}for(;A<3;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}switch(d.last=1&M,A-=1,3&(M>>>=1)){case 0:d.mode=14;break;case 1:if(X(d),d.mode=20,V!==6)break;M>>>=2,A-=2;break e;case 2:d.mode=17;break;case 3:R.msg="invalid block type",d.mode=30}M>>>=2,A-=2;break;case 14:for(M>>>=7&A,A-=7&A;A<32;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if((65535&M)!=(M>>>16^65535)){R.msg="invalid stored block lengths",d.mode=30;break}if(d.length=65535&M,A=M=0,d.mode=15,V===6)break e;case 15:d.mode=16;case 16:if(ae=d.length){if(ee<ae&&(ae=ee),we<ae&&(ae=we),ae===0)break e;r.arraySet(Oe,q,U,ae,Ie),ee-=ae,U+=ae,we-=ae,Ie+=ae,d.length-=ae;break}d.mode=12;break;case 17:for(;A<14;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if(d.nlen=257+(31&M),M>>>=5,A-=5,d.ndist=1+(31&M),M>>>=5,A-=5,d.ncode=4+(15&M),M>>>=4,A-=4,286<d.nlen||30<d.ndist){R.msg="too many length or distance symbols",d.mode=30;break}d.have=0,d.mode=18;case 18:for(;d.have<d.ncode;){for(;A<3;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}d.lens[K[d.have++]]=7&M,M>>>=3,A-=3}for(;d.have<19;)d.lens[K[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,I={bits:d.lenbits},Y=u(0,d.lens,0,19,d.lencode,0,d.work,I),d.lenbits=I.bits,Y){R.msg="invalid code lengths set",d.mode=30;break}d.have=0,d.mode=19;case 19:for(;d.have<d.nlen+d.ndist;){for(;We=(T=d.lencode[M&(1<<d.lenbits)-1])>>>16&255,vt=65535&T,!((Fe=T>>>24)<=A);){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if(vt<16)M>>>=Fe,A-=Fe,d.lens[d.have++]=vt;else{if(vt===16){for(w=Fe+2;A<w;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if(M>>>=Fe,A-=Fe,d.have===0){R.msg="invalid bit length repeat",d.mode=30;break}p=d.lens[d.have-1],ae=3+(3&M),M>>>=2,A-=2}else if(vt===17){for(w=Fe+3;A<w;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}A-=Fe,p=0,ae=3+(7&(M>>>=Fe)),M>>>=3,A-=3}else{for(w=Fe+7;A<w;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}A-=Fe,p=0,ae=11+(127&(M>>>=Fe)),M>>>=7,A-=7}if(d.have+ae>d.nlen+d.ndist){R.msg="invalid bit length repeat",d.mode=30;break}for(;ae--;)d.lens[d.have++]=p}}if(d.mode===30)break;if(d.lens[256]===0){R.msg="invalid code -- missing end-of-block",d.mode=30;break}if(d.lenbits=9,I={bits:d.lenbits},Y=u(f,d.lens,0,d.nlen,d.lencode,0,d.work,I),d.lenbits=I.bits,Y){R.msg="invalid literal/lengths set",d.mode=30;break}if(d.distbits=6,d.distcode=d.distdyn,I={bits:d.distbits},Y=u(b,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,I),d.distbits=I.bits,Y){R.msg="invalid distances set",d.mode=30;break}if(d.mode=20,V===6)break e;case 20:d.mode=21;case 21:if(6<=ee&&258<=we){R.next_out=Ie,R.avail_out=we,R.next_in=U,R.avail_in=ee,d.hold=M,d.bits=A,l(R,fe),Ie=R.next_out,Oe=R.output,we=R.avail_out,U=R.next_in,q=R.input,ee=R.avail_in,M=d.hold,A=d.bits,d.mode===12&&(d.back=-1);break}for(d.back=0;We=(T=d.lencode[M&(1<<d.lenbits)-1])>>>16&255,vt=65535&T,!((Fe=T>>>24)<=A);){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if(We&&(240&We)==0){for(nt=Fe,Ti=We,fi=vt;We=(T=d.lencode[fi+((M&(1<<nt+Ti)-1)>>nt)])>>>16&255,vt=65535&T,!(nt+(Fe=T>>>24)<=A);){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}M>>>=nt,A-=nt,d.back+=nt}if(M>>>=Fe,A-=Fe,d.back+=Fe,d.length=vt,We===0){d.mode=26;break}if(32&We){d.back=-1,d.mode=12;break}if(64&We){R.msg="invalid literal/length code",d.mode=30;break}d.extra=15&We,d.mode=22;case 22:if(d.extra){for(w=d.extra;A<w;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}d.length+=M&(1<<d.extra)-1,M>>>=d.extra,A-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=23;case 23:for(;We=(T=d.distcode[M&(1<<d.distbits)-1])>>>16&255,vt=65535&T,!((Fe=T>>>24)<=A);){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if((240&We)==0){for(nt=Fe,Ti=We,fi=vt;We=(T=d.distcode[fi+((M&(1<<nt+Ti)-1)>>nt)])>>>16&255,vt=65535&T,!(nt+(Fe=T>>>24)<=A);){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}M>>>=nt,A-=nt,d.back+=nt}if(M>>>=Fe,A-=Fe,d.back+=Fe,64&We){R.msg="invalid distance code",d.mode=30;break}d.offset=vt,d.extra=15&We,d.mode=24;case 24:if(d.extra){for(w=d.extra;A<w;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}d.offset+=M&(1<<d.extra)-1,M>>>=d.extra,A-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){R.msg="invalid distance too far back",d.mode=30;break}d.mode=25;case 25:if(we===0)break e;if(ae=fe-we,d.offset>ae){if((ae=d.offset-ae)>d.whave&&d.sane){R.msg="invalid distance too far back",d.mode=30;break}it=ae>d.wnext?(ae-=d.wnext,d.wsize-ae):d.wnext-ae,ae>d.length&&(ae=d.length),Ct=d.window}else Ct=Oe,it=Ie-d.offset,ae=d.length;for(we<ae&&(ae=we),we-=ae,d.length-=ae;Oe[Ie++]=Ct[it++],--ae;);d.length===0&&(d.mode=21);break;case 26:if(we===0)break e;Oe[Ie++]=d.length,we--,d.mode=21;break;case 27:if(d.wrap){for(;A<32;){if(ee===0)break e;ee--,M|=q[U++]<<A,A+=8}if(fe-=we,R.total_out+=fe,d.total+=fe,fe&&(R.adler=d.check=d.flags?a(d.check,Oe,fe,Ie-fe):s(d.check,Oe,fe,Ie-fe)),fe=we,(d.flags?M:_(M))!==d.check){R.msg="incorrect data check",d.mode=30;break}A=M=0}d.mode=28;case 28:if(d.wrap&&d.flags){for(;A<32;){if(ee===0)break e;ee--,M+=q[U++]<<A,A+=8}if(M!==(4294967295&d.total)){R.msg="incorrect length check",d.mode=30;break}A=M=0}d.mode=29;case 29:Y=1;break e;case 30:Y=-3;break e;case 31:return-4;case 32:default:return g}return R.next_out=Ie,R.avail_out=we,R.next_in=U,R.avail_in=ee,d.hold=M,d.bits=A,(d.wsize||fe!==R.avail_out&&d.mode<30&&(d.mode<27||V!==4))&&ye(R,R.output,R.next_out,fe-R.avail_out)?(d.mode=31,-4):(Se-=R.avail_in,fe-=R.avail_out,R.total_in+=Se,R.total_out+=fe,d.total+=fe,d.wrap&&fe&&(R.adler=d.check=d.flags?a(d.check,Oe,fe,R.next_out-fe):s(d.check,Oe,fe,R.next_out-fe)),R.data_type=d.bits+(d.last?64:0)+(d.mode===12?128:0)+(d.mode===20||d.mode===15?256:0),(Se==0&&fe===0||V===4)&&Y===m&&(Y=-5),Y)},o.inflateEnd=function(R){if(!R||!R.state)return g;var V=R.state;return V.window&&(V.window=null),R.state=null,m},o.inflateGetHeader=function(R,V){var d;return R&&R.state?(2&(d=R.state).wrap)==0?g:((d.head=V).done=!1,m):g},o.inflateSetDictionary=function(R,V){var d,q=V.length;return R&&R.state?(d=R.state).wrap!==0&&d.mode!==11?g:d.mode===11&&s(1,V,q,0)!==d.check?-3:ye(R,V,q,q)?(d.mode=31,-4):(d.havedict=1,m):g},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,n,o){var r=i("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,b,m,g,E,v,y,_){var D,C,O,x,H,F,Z,P,X,ye=_.bits,R=0,V=0,d=0,q=0,Oe=0,U=0,Ie=0,ee=0,we=0,M=0,A=null,Se=0,fe=new r.Buf16(16),ae=new r.Buf16(16),it=null,Ct=0;for(R=0;R<=15;R++)fe[R]=0;for(V=0;V<g;V++)fe[b[m+V]]++;for(Oe=ye,q=15;1<=q&&fe[q]===0;q--);if(q<Oe&&(Oe=q),q===0)return E[v++]=20971520,E[v++]=20971520,_.bits=1,0;for(d=1;d<q&&fe[d]===0;d++);for(Oe<d&&(Oe=d),R=ee=1;R<=15;R++)if(ee<<=1,(ee-=fe[R])<0)return-1;if(0<ee&&(f===0||q!==1))return-1;for(ae[1]=0,R=1;R<15;R++)ae[R+1]=ae[R]+fe[R];for(V=0;V<g;V++)b[m+V]!==0&&(y[ae[b[m+V]]++]=V);if(F=f===0?(A=it=y,19):f===1?(A=s,Se-=257,it=a,Ct-=257,256):(A=l,it=u,-1),R=d,H=v,Ie=V=M=0,O=-1,x=(we=1<<(U=Oe))-1,f===1&&852<we||f===2&&592<we)return 1;for(;;){for(Z=R-Ie,X=y[V]<F?(P=0,y[V]):y[V]>F?(P=it[Ct+y[V]],A[Se+y[V]]):(P=96,0),D=1<<R-Ie,d=C=1<<U;E[H+(M>>Ie)+(C-=D)]=Z<<24|P<<16|X|0,C!==0;);for(D=1<<R-1;M&D;)D>>=1;if(D!==0?(M&=D-1,M+=D):M=0,V++,--fe[R]==0){if(R===q)break;R=b[m+y[V]]}if(Oe<R&&(M&x)!==O){for(Ie===0&&(Ie=Oe),H+=d,ee=1<<(U=R-Ie);U+Ie<q&&!((ee-=fe[U+Ie])<=0);)U++,ee<<=1;if(we+=1<<U,f===1&&852<we||f===2&&592<we)return 1;E[O=M&x]=Oe<<24|U<<16|H-v|0}}return M!==0&&(E[H+M]=R-Ie<<24|64<<16|0),_.bits=Oe,0}},{"../utils/common":41}],51:[function(i,n,o){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,n,o){var r=i("../utils/common"),s=0,a=1;function l(T){for(var B=T.length;0<=--B;)T[B]=0}var u=0,f=29,b=256,m=b+1+f,g=30,E=19,v=2*m+1,y=15,_=16,D=7,C=256,O=16,x=17,H=18,F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ye=new Array(2*(m+2));l(ye);var R=new Array(2*g);l(R);var V=new Array(512);l(V);var d=new Array(256);l(d);var q=new Array(f);l(q);var Oe,U,Ie,ee=new Array(g);function we(T,B,K,Q,k){this.static_tree=T,this.extra_bits=B,this.extra_base=K,this.elems=Q,this.max_length=k,this.has_stree=T&&T.length}function M(T,B){this.dyn_tree=T,this.max_code=0,this.stat_desc=B}function A(T){return T<256?V[T]:V[256+(T>>>7)]}function Se(T,B){T.pending_buf[T.pending++]=255&B,T.pending_buf[T.pending++]=B>>>8&255}function fe(T,B,K){T.bi_valid>_-K?(T.bi_buf|=B<<T.bi_valid&65535,Se(T,T.bi_buf),T.bi_buf=B>>_-T.bi_valid,T.bi_valid+=K-_):(T.bi_buf|=B<<T.bi_valid&65535,T.bi_valid+=K)}function ae(T,B,K){fe(T,K[2*B],K[2*B+1])}function it(T,B){for(var K=0;K|=1&T,T>>>=1,K<<=1,0<--B;);return K>>>1}function Ct(T,B,K){var Q,k,ie=new Array(y+1),me=0;for(Q=1;Q<=y;Q++)ie[Q]=me=me+K[Q-1]<<1;for(k=0;k<=B;k++){var oe=T[2*k+1];oe!==0&&(T[2*k]=it(ie[oe]++,oe))}}function Fe(T){var B;for(B=0;B<m;B++)T.dyn_ltree[2*B]=0;for(B=0;B<g;B++)T.dyn_dtree[2*B]=0;for(B=0;B<E;B++)T.bl_tree[2*B]=0;T.dyn_ltree[2*C]=1,T.opt_len=T.static_len=0,T.last_lit=T.matches=0}function We(T){8<T.bi_valid?Se(T,T.bi_buf):0<T.bi_valid&&(T.pending_buf[T.pending++]=T.bi_buf),T.bi_buf=0,T.bi_valid=0}function vt(T,B,K,Q){var k=2*B,ie=2*K;return T[k]<T[ie]||T[k]===T[ie]&&Q[B]<=Q[K]}function nt(T,B,K){for(var Q=T.heap[K],k=K<<1;k<=T.heap_len&&(k<T.heap_len&&vt(B,T.heap[k+1],T.heap[k],T.depth)&&k++,!vt(B,Q,T.heap[k],T.depth));)T.heap[K]=T.heap[k],K=k,k<<=1;T.heap[K]=Q}function Ti(T,B,K){var Q,k,ie,me,oe=0;if(T.last_lit!==0)for(;Q=T.pending_buf[T.d_buf+2*oe]<<8|T.pending_buf[T.d_buf+2*oe+1],k=T.pending_buf[T.l_buf+oe],oe++,Q===0?ae(T,k,B):(ae(T,(ie=d[k])+b+1,B),(me=F[ie])!==0&&fe(T,k-=q[ie],me),ae(T,ie=A(--Q),K),(me=Z[ie])!==0&&fe(T,Q-=ee[ie],me)),oe<T.last_lit;);ae(T,C,B)}function fi(T,B){var K,Q,k,ie=B.dyn_tree,me=B.stat_desc.static_tree,oe=B.stat_desc.has_stree,_e=B.stat_desc.elems,Xe=-1;for(T.heap_len=0,T.heap_max=v,K=0;K<_e;K++)ie[2*K]!==0?(T.heap[++T.heap_len]=Xe=K,T.depth[K]=0):ie[2*K+1]=0;for(;T.heap_len<2;)ie[2*(k=T.heap[++T.heap_len]=Xe<2?++Xe:0)]=1,T.depth[k]=0,T.opt_len--,oe&&(T.static_len-=me[2*k+1]);for(B.max_code=Xe,K=T.heap_len>>1;1<=K;K--)nt(T,ie,K);for(k=_e;K=T.heap[1],T.heap[1]=T.heap[T.heap_len--],nt(T,ie,1),Q=T.heap[1],T.heap[--T.heap_max]=K,T.heap[--T.heap_max]=Q,ie[2*k]=ie[2*K]+ie[2*Q],T.depth[k]=(T.depth[K]>=T.depth[Q]?T.depth[K]:T.depth[Q])+1,ie[2*K+1]=ie[2*Q+1]=k,T.heap[1]=k++,nt(T,ie,1),2<=T.heap_len;);T.heap[--T.heap_max]=T.heap[1],function(Ve,ei){var eo,Si,to,ot,ko,gs,Mi=ei.dyn_tree,Ka=ei.max_code,sd=ei.stat_desc.static_tree,ad=ei.stat_desc.has_stree,ld=ei.stat_desc.extra_bits,Ja=ei.stat_desc.extra_base,io=ei.stat_desc.max_length,Ao=0;for(ot=0;ot<=y;ot++)Ve.bl_count[ot]=0;for(Mi[2*Ve.heap[Ve.heap_max]+1]=0,eo=Ve.heap_max+1;eo<v;eo++)io<(ot=Mi[2*Mi[2*(Si=Ve.heap[eo])+1]+1]+1)&&(ot=io,Ao++),Mi[2*Si+1]=ot,Ka<Si||(Ve.bl_count[ot]++,ko=0,Ja<=Si&&(ko=ld[Si-Ja]),gs=Mi[2*Si],Ve.opt_len+=gs*(ot+ko),ad&&(Ve.static_len+=gs*(sd[2*Si+1]+ko)));if(Ao!==0){do{for(ot=io-1;Ve.bl_count[ot]===0;)ot--;Ve.bl_count[ot]--,Ve.bl_count[ot+1]+=2,Ve.bl_count[io]--,Ao-=2}while(0<Ao);for(ot=io;ot!==0;ot--)for(Si=Ve.bl_count[ot];Si!==0;)Ka<(to=Ve.heap[--eo])||(Mi[2*to+1]!==ot&&(Ve.opt_len+=(ot-Mi[2*to+1])*Mi[2*to],Mi[2*to+1]=ot),Si--)}}(T,B),Ct(ie,Xe,T.bl_count)}function p(T,B,K){var Q,k,ie=-1,me=B[1],oe=0,_e=7,Xe=4;for(me===0&&(_e=138,Xe=3),B[2*(K+1)+1]=65535,Q=0;Q<=K;Q++)k=me,me=B[2*(Q+1)+1],++oe<_e&&k===me||(oe<Xe?T.bl_tree[2*k]+=oe:k!==0?(k!==ie&&T.bl_tree[2*k]++,T.bl_tree[2*O]++):oe<=10?T.bl_tree[2*x]++:T.bl_tree[2*H]++,ie=k,Xe=(oe=0)===me?(_e=138,3):k===me?(_e=6,3):(_e=7,4))}function Y(T,B,K){var Q,k,ie=-1,me=B[1],oe=0,_e=7,Xe=4;for(me===0&&(_e=138,Xe=3),Q=0;Q<=K;Q++)if(k=me,me=B[2*(Q+1)+1],!(++oe<_e&&k===me)){if(oe<Xe)for(;ae(T,k,T.bl_tree),--oe!=0;);else k!==0?(k!==ie&&(ae(T,k,T.bl_tree),oe--),ae(T,O,T.bl_tree),fe(T,oe-3,2)):oe<=10?(ae(T,x,T.bl_tree),fe(T,oe-3,3)):(ae(T,H,T.bl_tree),fe(T,oe-11,7));ie=k,Xe=(oe=0)===me?(_e=138,3):k===me?(_e=6,3):(_e=7,4)}}l(ee);var I=!1;function w(T,B,K,Q){fe(T,(u<<1)+(Q?1:0),3),function(k,ie,me,oe){We(k),Se(k,me),Se(k,~me),r.arraySet(k.pending_buf,k.window,ie,me,k.pending),k.pending+=me}(T,B,K)}o._tr_init=function(T){I||(function(){var B,K,Q,k,ie,me=new Array(y+1);for(k=Q=0;k<f-1;k++)for(q[k]=Q,B=0;B<1<<F[k];B++)d[Q++]=k;for(d[Q-1]=k,k=ie=0;k<16;k++)for(ee[k]=ie,B=0;B<1<<Z[k];B++)V[ie++]=k;for(ie>>=7;k<g;k++)for(ee[k]=ie<<7,B=0;B<1<<Z[k]-7;B++)V[256+ie++]=k;for(K=0;K<=y;K++)me[K]=0;for(B=0;B<=143;)ye[2*B+1]=8,B++,me[8]++;for(;B<=255;)ye[2*B+1]=9,B++,me[9]++;for(;B<=279;)ye[2*B+1]=7,B++,me[7]++;for(;B<=287;)ye[2*B+1]=8,B++,me[8]++;for(Ct(ye,m+1,me),B=0;B<g;B++)R[2*B+1]=5,R[2*B]=it(B,5);Oe=new we(ye,F,b+1,m,y),U=new we(R,Z,0,g,y),Ie=new we(new Array(0),P,0,E,D)}(),I=!0),T.l_desc=new M(T.dyn_ltree,Oe),T.d_desc=new M(T.dyn_dtree,U),T.bl_desc=new M(T.bl_tree,Ie),T.bi_buf=0,T.bi_valid=0,Fe(T)},o._tr_stored_block=w,o._tr_flush_block=function(T,B,K,Q){var k,ie,me=0;0<T.level?(T.strm.data_type===2&&(T.strm.data_type=function(oe){var _e,Xe=4093624447;for(_e=0;_e<=31;_e++,Xe>>>=1)if(1&Xe&&oe.dyn_ltree[2*_e]!==0)return s;if(oe.dyn_ltree[18]!==0||oe.dyn_ltree[20]!==0||oe.dyn_ltree[26]!==0)return a;for(_e=32;_e<b;_e++)if(oe.dyn_ltree[2*_e]!==0)return a;return s}(T)),fi(T,T.l_desc),fi(T,T.d_desc),me=function(oe){var _e;for(p(oe,oe.dyn_ltree,oe.l_desc.max_code),p(oe,oe.dyn_dtree,oe.d_desc.max_code),fi(oe,oe.bl_desc),_e=E-1;3<=_e&&oe.bl_tree[2*X[_e]+1]===0;_e--);return oe.opt_len+=3*(_e+1)+5+5+4,_e}(T),k=T.opt_len+3+7>>>3,(ie=T.static_len+3+7>>>3)<=k&&(k=ie)):k=ie=K+5,K+4<=k&&B!==-1?w(T,B,K,Q):T.strategy===4||ie===k?(fe(T,2+(Q?1:0),3),Ti(T,ye,R)):(fe(T,4+(Q?1:0),3),function(oe,_e,Xe,Ve){var ei;for(fe(oe,_e-257,5),fe(oe,Xe-1,5),fe(oe,Ve-4,4),ei=0;ei<Ve;ei++)fe(oe,oe.bl_tree[2*X[ei]+1],3);Y(oe,oe.dyn_ltree,_e-1),Y(oe,oe.dyn_dtree,Xe-1)}(T,T.l_desc.max_code+1,T.d_desc.max_code+1,me+1),Ti(T,T.dyn_ltree,T.dyn_dtree)),Fe(T),Q&&We(T)},o._tr_tally=function(T,B,K){return T.pending_buf[T.d_buf+2*T.last_lit]=B>>>8&255,T.pending_buf[T.d_buf+2*T.last_lit+1]=255&B,T.pending_buf[T.l_buf+T.last_lit]=255&K,T.last_lit++,B===0?T.dyn_ltree[2*K]++:(T.matches++,B--,T.dyn_ltree[2*(d[K]+b+1)]++,T.dyn_dtree[2*A(B)]++),T.last_lit===T.lit_bufsize-1},o._tr_align=function(T){fe(T,2,3),ae(T,C,ye),function(B){B.bi_valid===16?(Se(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)}(T)}},{"../utils/common":41}],53:[function(i,n,o){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,n,o){(function(r){(function(s,a){if(!s.setImmediate){var l,u,f,b,m=1,g={},E=!1,v=s.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(s);y=y&&y.setTimeout?y:s,l={}.toString.call(s.process)==="[object process]"?function(O){process.nextTick(function(){D(O)})}:function(){if(s.postMessage&&!s.importScripts){var O=!0,x=s.onmessage;return s.onmessage=function(){O=!1},s.postMessage("","*"),s.onmessage=x,O}}()?(b="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",C,!1):s.attachEvent("onmessage",C),function(O){s.postMessage(b+O,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function(O){D(O.data)},function(O){f.port2.postMessage(O)}):v&&"onreadystatechange"in v.createElement("script")?(u=v.documentElement,function(O){var x=v.createElement("script");x.onreadystatechange=function(){D(O),x.onreadystatechange=null,u.removeChild(x),x=null},u.appendChild(x)}):function(O){setTimeout(D,0,O)},y.setImmediate=function(O){typeof O!="function"&&(O=new Function(""+O));for(var x=new Array(arguments.length-1),H=0;H<x.length;H++)x[H]=arguments[H+1];var F={callback:O,args:x};return g[m]=F,l(m),m++},y.clearImmediate=_}function _(O){delete g[O]}function D(O){if(E)setTimeout(D,0,O);else{var x=g[O];if(x){E=!0;try{(function(H){var F=H.callback,Z=H.args;switch(Z.length){case 0:F();break;case 1:F(Z[0]);break;case 2:F(Z[0],Z[1]);break;case 3:F(Z[0],Z[1],Z[2]);break;default:F.apply(a,Z)}})(x)}finally{_(O),E=!1}}}}function C(O){O.source===s&&typeof O.data=="string"&&O.data.indexOf(b)===0&&D(+O.data.slice(b.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof Ho<"u"?Ho:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})}(Ys)),Ys.exports}var J_=K_();const Z_=q_(J_);function Ci(){return["main"]}async function Q_(e){switch(e.type){case Nt.Url:return V_(nd(decodeURI(e.data)));case Nt.Id:return rd(od(decodeURI(e.data)));case Nt.Hash:return z_(decodeURI(e.data).trim());case Nt.File:return e.data;default:throw new Error("Invalid payload.")}}async function pi(e){let t=0;try{let i=function(){Ae.status(Ze.INFO,`Loading ${[...b].join(", ")}... [${l}/${u-2}]`,Xs(l/u,15,80))};console.time("loading time"),t=performance.now(),Ws(!1);let n=await Q_(e);Ae.status(Ze.INFO,"Extracting zip",0),de.switchToMetadata();const o=await Z_.loadAsync(n),r=o.filter(D=>D.endsWith("Info.dat")||D.endsWith("info.dat")||D.endsWith("Info.json")||D.endsWith("info.json")).map(D=>D.name.split("/")).filter(D=>D.length<=2).sort((D,C)=>D.length-C.length);if(r.length===0)throw new Error("Couldn't find Info.dat");let s=r[0].slice(0,-1).join("/");s&&(be.flag.nested=!0,s+="/"),Ws(!1),Ae.status(Ze.INFO,"Parsing map info...",10),se.tInfo(Ci(),"Parsing map info");const a=await I_(o,s);be.data.info=a,Sn.setInfo(a),a.audio.duration&&(be.data.duration=a.audio.duration,de.setSongDuration(a.audio.duration));let l=0,u=0,f=0;const b=new Set(["map","cover image","contributors image","audio","audio/BPM data"]),m=[new Promise(async D=>{se.tInfo(Ci(),"Loading cover image");const C=o.file(a.coverImageFilename);if(ue.props.load.imageCover&&C){let O=await C.async("base64");de.setCoverImage("data:image;base64,"+O),be.flag.coverImage=!0}else se.tError(Ci(),`${a.coverImageFilename} does not exists.`);l++,b.delete("cover image"),i(),D(null)}),new Promise(async D=>{if(be.data.contributors=[],a.customData._contributors)for(const C of a.customData._contributors){se.tInfo(Ci(),"Loading contributor image "+C._name);const O=o.file(C._iconPath);let x=null;ue.props.load.imageContributor&&O?x=await O.async("base64"):se.tError(Ci(),`${C._iconPath} does not exists.`),be.data.contributors.push({...C,_base64:x})}Me.populateContributors(be.data.contributors),l++,b.delete("contributors image"),i(),D(null)}),new Promise(async D=>{se.tInfo(Ci(),"Loading audio");let C=o.file(a.audio.filename);if(ue.props.load.audio&&C){let O=!1;setTimeout(()=>{!O&&!be.flag.finished&&Ae.status(Ze.INFO,"Loading audio... (this may take a while)",Xs(l/u,15,80))},1e4);let x=await C.async("arraybuffer");de.setAudio(x),await new AudioContext().decodeAudioData(x).then(F=>{O=!0;let Z=F.duration;be.data.duration=Z,de.setSongDuration(Z),be.flag.audio=!0}).catch(function(F){de.setSongDuration(),se.tError(Ci(),F)})}else be.data.duration||de.setSongDuration(),se.tError(Ci(),`${a.audio.filename} does not exist.`);l+=2,b.delete("Audio"),i(),D(null)}),new Promise(async D=>{const C=await N_(a,o,s);l++,b.delete("audio/BPM data"),C&&(be.flag.audio||(be.data.duration=C.duration),de.setSongDuration(C.duration),i()),D(C)}),...O_(a,o,s).map(async(D,C,O)=>{const x=D.then(H=>H).catch(console.error);return l++,f++,O.length===f&&b.delete("map"),i(),x})];u=m.length+2,i();const g=await Promise.allSettled(m);be.data.beatmaps=g.slice(4).map(D=>D.status==="fulfilled"?D.value:null).filter(D=>D!==null);const E=g[3].status==="fulfilled"?g[3].value:null;let v=Math.min(a.audio.bpm,...(E?.bpm??[]).map(D=>D.bpm)),y=Math.max(a.audio.bpm,...(E?.bpm??[]).map(D=>D.bpm));be.data.beatmaps.forEach(D=>{D.rawVersion===4&&(D.timeProcessor.timescale=E.bpm);const C=D.timeProcessor.change.map(x=>x.BPM),O=D.timeProcessor.timescale.map(x=>D.timeProcessor.bpm/x.scale);v=Math.min(v,...C,...O),y=Math.max(y,...C,...O)}),v!==y&&de.setSongBPM(a.audio.bpm,v,y),Te.adjustBeatTime(),st.populateSelectCharacteristic(a),se.tInfo(Ci(),"Analysing map"),Ae.status(Ze.INFO,"Analysing general...",85),Up(),Te.displayOutputGeneral(),await zu(5),Ae.status(Ze.INFO,"Analysing difficulty...",90),td(),Te.displayOutputDifficulty(),await zu(5);let _=performance.now();Ae.status(Ze.INFO,`Completed! (took ${$((_-t)/1e3,2)}s)`)}catch(i){Ae.status(Ze.ERROR,i),se.tError(Ci(),i),be.clear(),de.switchToIntro()}finally{Ws(!0),console.timeEnd("loading time")}}X_();
