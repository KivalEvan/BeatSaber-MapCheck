var or=t=>{throw TypeError(t)};var rr=(t,e,i)=>e.has(t)||or("Cannot "+i);var re=(t,e,i)=>(rr(t,e,"read from private field"),i?i.call(t):e.get(t)),an=(t,e,i)=>e.has(t)?or("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),Mi=(t,e,i,n)=>(rr(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();var gc=(t=>(t.none="",t.ExpertPlus="accordion__label--bg-expertplus",t.Expert="accordion__label--bg-expert",t.Hard="accordion__label--bg-hard",t.Normal="accordion__label--bg-normal",t.Easy="accordion__label--bg-easy",t))(gc||{});const ln="accordion__",zh=document.querySelectorAll(".accordion__button"),Vh={create:function(t,e,i,n=!1){const o=document.createElement("div");o.className="accordion";const l=document.createElement("input");l.className=ln+"button",l.id=t,l.setAttribute("type","checkbox");const s=document.createElement("label");s.className=ln+"label unselectable",s.htmlFor=t,s.textContent=e,i&&s.classList.add(gc[i]);const r=document.createElement("div");return r.className=n?ln+"collapsible-flex":ln+"collapsible",r.id=t+"-content",o.appendChild(l),o.appendChild(s),o.appendChild(r),o},show:function(t,e){zh.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}};function Gh(t){return t.toString().split(".").map((e,i)=>i?e:e.replace(/\B(?=(\d{3})+(?!\d))/g,",")).join(".")}Hh(Math.random());function Hh(t){t=t.toString();let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function M(t,e=0){const i=Math.pow(10,e);return Math.round(t*i)/i}function fo(t){return t*(180/Math.PI)}function yi(t){return t*(Math.PI/180)}function sr(t,e){const i=t%e;return i<0?i+e:i}function ar(t,e,i){return Math.min(sr(t-e,i),sr(e-t,i))}function so(t){if(!t.length)return 0;const e=t.map(n=>n).sort((n,o)=>n-o),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function bc(t,e,i){return Math.min(Math.max(e,t),i)}function po(t,e,i,n){return n||(n=o=>o),e+(i-e)*n(t)}function Uh(t,e,i){return(t-e)/(i-e)}function vc(t,e,i,n,o){const l=Uh(t,e,i);return po(l,n,o)}function xt(t){return t==null||typeof t!="object"?t:Array.isArray(t)?[...t]:{...t}}function j(t){if(t==null||typeof t!="object")return t;const e=Array.isArray(t)?Array(t.length):{};for(const i in t)e[i]=j(t[i]);return e}function $o(t){return/^[a-fA-F0-9]+$/g.test(t)}function Fe(t){return parseInt(t,16)}function cn(t,e,i,n){Array.isArray(t)&&(n=t[3],i=t[2],e=t[1],t=t[0]),t=t,e=e,i=i;let o=0;const l=Math.max(t,e,i),s=Math.min(t,e,i),r=l-s,a=l===0?0:r/l,u=l;switch(l){case s:break;case t:o=e-i+r*(e<i?6:0),o/=6*r;break;case e:o=i-t+r*2,o/=6*r;break;case i:o=t-e+r*4,o/=6*r;break}const f=[o*360,a,u];return typeof n=="number"&&f.push(n),f}function jh(t,e,i,n){Array.isArray(t)&&(n=t[3],i=t[2],e=t[1],t=t[0]),t=t/360,e=e,i=i,t<0&&(t+=Math.abs(Math.floor(t)));let o=0,l=0,s=0;const r=Math.floor(t*6),a=t*6-r,u=i*(1-e),f=i*(1-a*e),m=i*(1-(1-a)*e);switch(r%6){case 0:o=i,l=m,s=u;break;case 1:o=f,l=i,s=u;break;case 2:o=u,l=i,s=m;break;case 3:o=u,l=f,s=i;break;case 4:o=m,l=u,s=i;break;case 5:o=i,l=u,s=f;break}const h=[o,l,s];return typeof n=="number"&&h.push(n),h}function un(t){const e=t.toString(16);return e.length===1?"0"+e:e}function Wh(t){return Math.round(t*255)}function Te(t){return t/255}function ee(t,e){if(Array.isArray(t)){const n={r:t[0],g:t[1],b:t[2]};return typeof t[3]=="number"&&(n.a=t[3]),e&&(n.a??(n.a=1)),n}if(typeof t=="string"||"type"in t)return ee(ne(t),e);const i={r:t.r,g:t.g,b:t.b};return typeof t.a=="number"&&(i.a=t.a),e&&(i.a??(i.a=1)),i}function pt(t){const e=ee(t);let i=1;for(const n in e)i=Math.max(Math.abs(e[n]),i);for(const n in e)e[n]=Wh(e[n]/i);return`#${un(e.r)}${un(e.g)}${un(e.b)}${typeof e.a=="number"?un(e.a):""}`}function ae(t){if(t=t.trim(),t.startsWith("#")&&(t=t.substring(1)),!$o(t))throw new Error("Not valid hexadecimal");let e=[0,0,0];if(t.length===3||t.length===4)e=[Te(Fe(t.slice(0,1)+t.slice(0,1))),Te(Fe(t.slice(1,2)+t.slice(1,2))),Te(Fe(t.slice(2,3)+t.slice(2,3)))],t.length===4&&e.push(Te(Fe(t.slice(3,4)+t.slice(3,4))));else if(t.length===6||t.length===8)e=[Te(Fe(t.slice(0,2))),Te(Fe(t.slice(2,4))),Te(Fe(t.slice(4,6)))],t.length===8&&e.push(Te(Fe(t.slice(6,8))));else throw new Error("Not valid colour hexadecimal");return e}function Ei(t,e="rgba",i="rgba"){if(typeof t=="string"){const n=ae(t);return i==="hsva"?cn(n):n}else if(Array.isArray(t)){if(e==="hsva")return i==="hsva"?[...t]:jh(t);const n=e==="rgba255"?t.map(o=>Te(o)):[...t];return i==="hsva"?cn(n):n}else if("type"in t){let n;switch(t.type){case"hsva":n=ne(t.value,"hsva");break;case"rgba":n=ne(t.value,"rgba");break;case"rgba255":n=ne(t.value,"rgba255")}return i==="hsva"?cn(n):n}else{const n=[t.r,t.g,t.b];return typeof t.a=="number"&&n.push(t.a),i==="hsva"?cn(n):n}}function lr(t){let e=t[0],i=t[1],n=t[2],o,l,s;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,o=(e*.4124+i*.3576+n*.1805)/.95047,l=(e*.2126+i*.7152+n*.0722)/1,s=(e*.0193+i*.1192+n*.9505)/1.08883,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116;const r=[116*l-16,500*(o-l),200*(l-s)];return typeof t[3]=="number"&&r.push(t[3]),r}function cr(t,e){let i=0;return t>=0&&e===0?0:t<0&&e===0?180:t===0&&e>0?90:t===0&&e<0?270:(t>0&&e>0&&(i=0),t<0&&(i=180),t>0&&e<0&&(i=360),fo(Math.atan(e/t))+i)}function go(t,e){const[i,n,o]=lr(t),[l,s,r]=lr(e),a=1,u=1,f=1;let m,h,c,g,d,v,_,y,S,w,k,O,P,G,I,W,et,C,$,b;return m=Math.sqrt(n*n+o*o),h=Math.sqrt(s*s+r*r),c=(m+h)/2,d=.5*(1-Math.sqrt((c^7)/((c^7)+30))),S=(1+d)*n,m=Math.sqrt(S*S+o*o),v=cr(S,o),S=(1+d)*s,h=Math.sqrt(S*S+r*r),_=cr(S,r),C=l-i,$=h-m,m*h==0?b=0:(S=M(_-v,12),Math.abs(S)<=180?b=_-v:S>180?b=_-v-360:b=_-v+360),b=2*Math.sqrt(m*h)*Math.sin(yi(b/2)),w=(i+l)/2,g=(m+h)/2,m*h==0?y=v+_:(S=Math.abs(M(v-_,12)),S>180?_+v<360?y=v+_+360:y=v+_-360:y=v+_,y/=2),k=1-.17*Math.cos(yi(y-30))+.24*Math.cos(yi(2*y))+.32*Math.cos(yi(3*y+6))-.2*Math.cos(yi(4*y-63)),I=30*Math.exp(-((y-275)/25)*((y-275)/25)),W=2*Math.sqrt((g^7)/((g^7)+30)),O=1+.015*((w-50)*(w-50))/Math.sqrt(20+(w-50)*(w-50)),P=1+.045*g,G=1+.015*g*k,et=-Math.sin(yi(2*I))*W,C=C/(a*O),$=$/(u*P),b=b/(f*G),Math.sqrt(C*C+$*$+b*b+et*$*b)}function ne(){const t=arguments;if(typeof t[0]=="number"&&typeof t[1]=="number"&&typeof t[2]=="number"){let e=[t[0],t[1],t[2]];return typeof t[3]=="number"&&e.push(t[3]),typeof t[3]=="string"&&(t[3]==="hsva"&&(e=Ei(e,"hsva")),t[3]==="rgba255"&&(e=Ei(e,"rgba255"))),typeof t[4]=="string"&&(t[4]==="hsva"&&(e=Ei(e,"hsva")),t[4]==="rgba255"&&(e=Ei(e,"rgba255"))),e}if(typeof t[0]=="number")return typeof t[1]=="boolean"&&t[1]?[t[0]/255,t[0]/255,t[0]/255]:typeof t[1]=="number"?[t[0],t[0],t[0],t[1]]:[t[0],t[0],t[0]];if(typeof t[0]=="string")return ae(t[0]);if(Array.isArray(t[0])){const e=t[0];let i=[e[0],e[1],e[2]];if(!i.every(n=>typeof n=="number"))throw new Error("Unable to parse color; array contain undefined or non-numeric value");return typeof e[3]=="number"&&i.push(e[3]),typeof t[1]=="string"&&(t[1]==="hsva"&&(i=Ei(i,"hsva")),t[1]==="rgba255"&&(i=Ei(i,"rgba255"))),i}if(typeof t[0]=="object"){const e=t[0];if("type"in e)switch(e.type){case"hsva":return ne(e.value,"hsva");case"rgba":return ne(e.value,"rgba");case"rgba255":return ne(e.value,"rgba255")}if("r"in e&&"g"in e&&"b"in e){const i=[e.r,e.g,e.b];if(!i.every(n=>typeof n=="number"))throw new Error("Unable to parse color; array contain undefined or non-numeric value");return typeof e.a=="number"&&i.push(e.a),i}}throw new Error("Unable to parse color; input is invalid")}function Wt(t){if(!t)return"0:00";const e=Math.floor(t),i=e/60,n=i<0?`-${Math.ceil(i).toString()}`:Math.floor(i).toString(),o=Math.abs(e%60).toString().padStart(2,"0");return`${n}:${o}`}function Xh(t){if(!t)return"0:00:00";const e=Math.abs(Math.round(t*60%60)).toString().padStart(2,"0");return`${Wt(t>0?Math.floor(t):Math.ceil(t))}:${e}`}function vn(t){var i;if(!t)return"0:00.000";const e=((i=(t%1).toString().split(".")[1])==null?void 0:i.padEnd(3,"0").slice(0,3))||"000";return`${Wt(t>0?Math.floor(t):Math.ceil(t))}.${e}`}function _c(t){return Array.isArray(t)&&t.length===3&&t.every(e=>typeof e=="number")}function Ee(t,e){if(!t)return t;if(typeof e=="number")return t.map(i=>i*e);if(t=[...t],e)if(Array.isArray(e))for(let i=0;i<t.length;i++)typeof e[i]=="number"&&(t[i]*=e[i]);else switch(t.length){case 4:t[3]=t[3]*(e.w??1);case 3:t[2]=t[2]*(e.z??1);case 2:t[1]=t[1]*(e.y??1),t[0]=t[0]*(e.x??1)}return t}function Yh(t){const e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")}function qh(t){const e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid BeatSaver ID")}const ur=document.querySelector(".intro"),hr=document.querySelector(".metadata"),Di=document.querySelector(".cover__link"),yc=document.querySelector(".cover__image"),Kh=document.querySelector(".metadata__song-name"),Zh=document.querySelector(".metadata__song-subname"),Jh=document.querySelector(".metadata__song-author"),Qh=document.querySelector(".metadata__song-bpm"),ao=document.querySelector(".metadata__song-duration"),Ec=document.querySelector(".audio");function Dc(t){t?(ur.classList.remove("hidden"),hr.classList.add("hidden")):(ur.classList.add("hidden"),hr.classList.remove("hidden"))}function Cc(t){yc.src=t||"./img/unknown.jpg"}function tm(){return yc.src}function Sc(t,e){if(t==null&&e==null){Di.textContent="",Di.href="",Di.classList.add("disabled");return}t!=null&&(Di.textContent=e??"Download Link",Di.href=t,Di.classList.remove("disabled"))}function em(t){Kh.textContent=t}function im(t){Zh.textContent=t}function nm(t){Jh.textContent=t}function om(t,e,i){e==null&&typeof i=="number"&&(e=Math.min(t,i)),i==null&&typeof e=="number"&&(i=Math.max(t,e));let n=M(t,2).toString()+"BPM";e&&i&&e!==i&&(n+=` (${M(e,2)}-${M(i,2)})`),Qh.textContent=n}function wc(t){typeof t=="number"?ao.textContent=vn(t):typeof t=="string"?ao.textContent=t:ao.textContent="No audio"}async function rm(t){const e=new Blob([t],{type:"audio/ogg"});Ec.src=window.URL.createObjectURL(e)}function kc(){Ec.src="",window.URL.revokeObjectURL("")}function sm(){Dc(!0),Cc(null),Sc(),wc(0),kc()}const It={switchHeader:Dc,setCoverImage:Cc,getCoverImage:tm,setCoverLink:Sc,setSongName:em,setSongSubname:im,setSongAuthor:nm,setSongBPM:om,setSongDuration:wc,setAudio:rm,unloadAudio:kc,reset:sm},hi=new class{constructor(){this.loading={info:!1,difficulty:!1,analysis:!1,audio:!1,coverImage:!1,contributorImage:!1,finished:!1}}resetLoad(){this.loading.info=!1,this.loading.difficulty=!1,this.loading.analysis=!1,this.loading.audio=!1,this.loading.coverImage=!1,this.loading.contributorImage=!1,this.loading.finished=!1}},ht=new class{constructor(){this.beatmapInfo=null,this.beatmaps=[],this.contributors=[],this.analysis=null,this.duration=null}clear(){hi.loading.finished=!1,this.beatmapInfo=null,this.beatmaps=[],this.contributors=[],this.analysis=null,this.duration=null}};function am(t){const e=/^(http|ftp|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/;if(t=t.trim(),/^http:\/\//.test(t)&&(t=t.replace("http://","https://")),e.test(t))return t;throw new Error("Invalid URL")}function lm(t){const e=/^[0-9a-fA-F]{1,6}$/;if(t=t.trim(),/^!bsr /.test(t)&&(t=t.replace("!bsr ","")),e.test(t))return t;throw new Error("Invalid ID")}function cm(t){for(let e=t.options.length-1;e>=0;e--)t.remove(e)}function mr(t){return new Promise(e=>setTimeout(e,t))}const bo={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"Triangle",NiceEnvironment:"Nice",BigMirrorEnvironment:"Big Mirror",DragonsEnvironment:"Dragons",KDAEnvironment:"K/DA",MonstercatEnvironment:"Monstercat",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"Panic",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day Grenade",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",QueenEnvironment:"Queen",LinkinPark2Environment:"Linkin Park 2.0",TheRollingStonesEnvironment:"The Rolling Stones",LatticeEnvironment:"Lattice",DaftPunkEnvironment:"Daft Punk",HipHopEnvironment:"Hip Hop Mixtape",ColliderEnvironment:"Collider",GlassDesertEnvironment:"Glass Desert",MultiplayerEnvironment:"Origins"},gi={DefaultEnvironment:[[0,1,2,3,4,8,9,12,13],[]],OriginsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TriangleEnvironment:[[0,1,2,3,4,8,9,12,13],[]],NiceEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BigMirrorEnvironment:[[0,1,2,3,4,8,9,12,13],[]],DragonsEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KDAEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MonstercatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],CrabRaveEnvironment:[[0,1,2,3,4,8,9,12,13],[]],PanicEnvironment:[[0,1,2,3,4,8,9,12,13],[]],RocketEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GreenDayGrenadeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],TimbalandEnvironment:[[0,1,2,3,4,8,9,12,13],[]],FitBeatEnvironment:[[0,1,2,3,4,8,9,12,13],[]],LinkinParkEnvironment:[[0,1,2,3,4,8,9,12,13],[]],BTSEnvironment:[[0,1,2,3,4,8,9,12,13],[]],KaleidoscopeEnvironment:[[0,1,2,3,4,8,9,12,13],[]],InterscopeEnvironment:[[0,1,2,3,4,6,7,8,9,12,13,16,17],[]],SkrillexEnvironment:[[0,1,2,3,4,6,7,8,9,12,13],[]],BillieEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13],[]],HalloweenEnvironment:[[0,1,2,3,4,8,9,12,13],[]],GagaEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,13,16,17],[]],GlassDesertEnvironment:[[0,1,2,3,4,8,9,12,13],[]],MultiplayerEnvironment:[[4],[]],WeaveEnvironment:[[],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],PyroEnvironment:[[0,1,2,3,4,6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],EDMEnvironment:[[0,1,4],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],TheSecondEnvironment:[[0,1,2,3,4,9],[0,1,2,3,4,5,6,7,8,9,10,11,12,13]],LizzoEnvironment:[[0,1,2,3,4,6,7,8,9,10,11,12,16,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]],TheWeekndEnvironment:[[0,1,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,29,30,31,32,33,34,35,36,37,38,40]],RockMixtapeEnvironment:[[3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37]],Dragons2Environment:[[0,1,2,3,4,6],[0,1,2,3,4,5,6,7,8,9,10,11,12]],Panic2Environment:[[3],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]],QueenEnvironment:[[6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]],LinkinPark2Environment:[[3,40,41],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]],TheRollingStonesEnvironment:[[6,40],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]],LatticeEnvironment:[[6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]],DaftPunkEnvironment:[[6,40,41,42,43],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55]],HipHopEnvironment:[[6],[0,1,2,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41]],ColliderEnvironment:[[6],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]]},lo=document.querySelector(".info__level-author"),fr=document.querySelector(".info__environment"),co=document.querySelector(".info__editors"),pr=document.querySelector(".info__contributors"),vo=document.querySelector(".info__contributors-select"),um=document.querySelector(".info__contributors-image"),hm=document.querySelector(".info__contributors-name"),mm=document.querySelector(".info__contributors-role");vo.addEventListener("change",gm);function Tc(t,e){if(!t){lo.textContent="";return}e!=null&&e.length?lo.textContent="Mapped by "+t.join(", ")+" and lit by "+e.join(", "):lo.textContent="Mapped by "+t.join(", ")}function Lc(t){if(!t){fr.textContent="";return}fr.textContent=t.map(e=>(bo[e]||`Unknown (${e})`)+" Environment").join(", ")}function Rc(t){if(!t||!t._lastEditedBy){co.classList.add("hidden");return}co.classList.remove("hidden");const e=t._lastEditedBy||"Undefined";let i="Last edited on "+e;if(t[e]){const n=t[e];i+=" v"+n.version}co.textContent=i}function fm(t){um.src=t||"./img/unknown.jpg"}function pm(t){hm.textContent=t}function dm(t){mm.textContent=t}function xc(t){fm(t._base64?"data:image;base64,"+t._base64:null),pm(t._name),dm(t._role)}function Bc(t){if(!t||!t.length){pr.classList.add("hidden"),cm(vo);return}pr.classList.remove("hidden");let e=!0;t.forEach((i,n)=>{e&&(e=!1,xc(i));const o=document.createElement("option");o.value=n.toString(),o.text=i._name+" -- "+i._role,vo.add(o)})}function gm(t){const e=t.target;xc(ht.contributors[parseInt(e.value)])}const Fi={version:5,load:{audio:!0,imageCover:!0,imageContributor:!0},sorting:!0,beatNumbering:"beattime",infoRowHeight:4,rounding:3,dataCheck:!0,deduplicateTime:!0,theme:"Dark",show:{info:!1,checks:!1,stats:!1,settings:!1},aprilFooled:!1},nt=new class{constructor(){this.property=j(Fi),this.stringify=()=>JSON.stringify({settings:this.property}),this.init=()=>{var i;if(localStorage==null)return;const e=localStorage.getItem("settings");if(e){const n=JSON.parse(e);if(!((i=n.settings)!=null&&i.version)){this.clear();return}this.property=n.settings??this.property;for(const o in Fi)typeof this.property[o]>"u"&&(this.property[o]=Fi[o]);this.property.version=Fi.version,this.save()}},this.save=()=>{localStorage&&localStorage.setItem("settings",this.stringify())},this.clear=()=>{localStorage&&localStorage.clear()},this.reset=()=>{this.property=j(Fi)},this.init()}get version(){return this.property.version}get load(){return this.property.load}get sorting(){return this.property.sorting}set sorting(e){this.property.sorting=e}get beatNumbering(){return this.property.beatNumbering}set beatNumbering(e){this.property.beatNumbering=e}get infoRowHeight(){return this.property.infoRowHeight}set infoRowHeight(e){this.property.infoRowHeight=e}get rounding(){return this.property.rounding}set rounding(e){this.property.rounding=e}get dataCheck(){return this.property.dataCheck}set dataCheck(e){this.property.dataCheck=e}get deduplicateTime(){return this.property.deduplicateTime}set deduplicateTime(e){this.property.deduplicateTime=e}get theme(){return this.property.theme}set theme(e){this.property.theme=e}get show(){return this.property.show}get aprilFooled(){return this.property.aprilFooled}set aprilFooled(e){this.property.aprilFooled=e}};var Ic=(t=>(t.tiny="panel--tiny",t["x-small"]="panel--x-small",t.small="panel--small",t.medium="panel--medium",t.large="panel--large",t["x-large"]="panel--x-large",t.max="panel--max",t))(Ic||{}),Nc=(t=>(t.normal="panel--offset",t.half="panel--offset-half",t.none="",t))(Nc||{});const Ri={create:(t,e,i,n)=>{const o=document.createElement("div");return o.className=`panel ${Ic[t]}`,e&&e!=="none"&&o.classList.add(Nc[e]),i&&o.classList.add("panel--flex"+n?"-column":""),o}},dr=document.querySelector(".info__version"),gr=document.querySelector(".info__mappers"),br=document.querySelector(".info__lighters"),vr=document.querySelector(".info__environmentId"),_r=document.querySelector(".info__play-time"),yr=document.querySelector(".info__time-spend"),Er=document.querySelector(".info__color-scheme"),Dr=document.querySelector(".info__custom-color"),Cr=document.querySelector(".info__requirements"),Sr=document.querySelector(".info__suggestions"),wr=document.querySelector(".info__information"),kr=document.querySelector(".info__warnings"),Tr=document.querySelector(".info__bookmarks"),Lr=document.querySelector(".info__bpm-changes"),Rr=document.querySelector(".info__environment-enhancement"),xr=document.querySelector(".info__point-definitions"),Br=document.querySelector(".info__custom-events"),bm=document.querySelectorAll(".info__table-element");function Ot(t){const e=t.querySelector(".info__table-element");e&&(e.innerHTML=""),t.classList.add("hidden")}function $t(t,e){const i=t.querySelector(".info__table-element");if(i){for(;i.firstChild;)i.removeChild(i.firstChild);typeof e=="string"?i.textContent=e:(e.forEach(n=>{if(typeof n=="string"){const o=document.createElement("span");o.textContent=n,i.appendChild(o),i.appendChild(document.createElement("br"))}else i.appendChild(n),i.appendChild(document.createElement("br"))}),i.lastChild&&i.removeChild(i.lastChild))}t.classList.remove("hidden")}function Ac(t){bm.forEach(e=>e.style.maxHeight=`${t}rem`)}function Oc(t,e){if(t==null||!t.length){Ot(Tr);return}const i=Ri.create("max","none",!0);t.forEach((n,o)=>{let l=n.b??n._time??0,s;const r=document.createElement("div"),a=document.createElement("div"),u=document.createElement("div");r.appendChild(a),r.appendChild(u),a.className="info__color-dot",a.style.backgroundColor="#000000",u.className="info__color-text";const f=n.n??n._name;typeof f!="string"&&(u.textContent=`Error parsing bookmarks[${o}]`,i.appendChild(r)),e&&(l=e.adjustTime(l),s=e.toRealTime(l));const m=n.c??n._color;a.style.backgroundColor=m?pt({r:m[0],g:m[1],b:m[2]}):"#333333",u.textContent=`${M(l,nt.rounding)}${s?" | "+Wt(s):""} -- ${f!=""?f:"**EMPTY NAME**"}`,i.appendChild(r)}),$t(Tr,[i])}function $c(t){if(!t||!t.change.length){Ot(Lr);return}const e=t.change.map(i=>{const n=M(i.newTime,nt.rounding),o=t.toRealTime(i.time);return`${n} | ${Wt(o)} -- ${i.BPM}`});$t(Lr,e)}const pe={DefaultEnvironment:"The First",OriginsEnvironment:"Origins",TriangleEnvironment:"The First",NiceEnvironment:"The First",BigMirrorEnvironment:"The First",DragonsEnvironment:"The First",KDAEnvironment:"KDA",MonstercatEnvironment:"The First",CrabRaveEnvironment:"Crab Rave",PanicEnvironment:"The First",RocketEnvironment:"Rocket",GreenDayEnvironment:"Green Day",GreenDayGrenadeEnvironment:"Green Day",TimbalandEnvironment:"Timbaland",FitBeatEnvironment:"FitBeat",LinkinParkEnvironment:"Linkin Park",BTSEnvironment:"BTS",KaleidoscopeEnvironment:"Kaleidoscope",InterscopeEnvironment:"Interscope",SkrillexEnvironment:"Skrillex",BillieEnvironment:"Billie Eilish",HalloweenEnvironment:"Spooky",GagaEnvironment:"Gaga",WeaveEnvironment:"Weave",PyroEnvironment:"Pyro",EDMEnvironment:"EDM",TheSecondEnvironment:"The Second",LizzoEnvironment:"Lizzo",TheWeekndEnvironment:"The Weeknd",RockMixtapeEnvironment:"Rock Mixtape",Dragons2Environment:"Dragons 2.0",Panic2Environment:"Panic 2.0",QueenEnvironment:"Queen",LinkinPark2Environment:"Linkin Park 2.0",TheRollingStonesEnvironment:"The Rolling Stones",LatticeEnvironment:"Lattice",DaftPunkEnvironment:"Daft Punk",HipHopEnvironment:"Hip Hop Mixtape",ColliderEnvironment:"Collider",GlassDesertEnvironment:"Glass Desert",MultiplayerEnvironment:"Origins"},vm={_colorLeft:"Left Note Color",_colorRight:"Right Note Color",_envColorLeft:"Left Environment Color",_envColorRight:"Right Environment Color",_envColorWhite:"White Environment Color",_envColorLeftBoost:"Left Environment Boost Color",_envColorRightBoost:"Right Environment Boost Color",_envColorWhiteBoost:"White Environment Boost Color",_obstacleColor:"Obstacle Color"},_m={saberLeftColor:"Left Note Color",saberRightColor:"Right Note Color",environment0Color:"Left Environment Color",environment1Color:"Right Environment Color",environmentWColor:"White Environment Color",environment0ColorBoost:"Left Environment Boost Color",environment1ColorBoost:"Right Environment Boost Color",environmentWColorBoost:"White Environment Boost Color",obstaclesColor:"Obstacle Color"},de={"Default Custom":{_colorLeft:{r:.7529412,g:.1882353,b:.1882353},_colorRight:{r:.1254902,g:.3921569,b:.6588235},_envColorLeft:{r:.7529412,g:.1882353,b:.1882353},_envColorRight:{r:.1882353,g:.5960785,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},"The First":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Origins:{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.4910995,g:.6862745,b:.7},_envColorRight:{r:.03844783,g:.6862745,b:.9056604},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}},KDA:{_colorLeft:{r:.6588235,g:.2627451,b:.1607843},_colorRight:{r:.5019608,g:.08235294,b:.572549},_envColorLeft:{r:1,g:.3960785,b:.2431373},_envColorRight:{r:.7607844,g:.1254902,b:.8666667},_obstacleColor:{r:1,g:.3960785,b:.2431373}},"Crab Rave":{_colorLeft:{r:0,g:.7130001,b:.07806564},_colorRight:{r:.04805952,g:.5068096,b:.734},_envColorLeft:{r:.134568,g:.756,b:.1557533},_envColorRight:{r:.05647058,g:.6211764,b:.9},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Noir:{_colorLeft:{r:.1792453,g:.1792453,b:.1792453},_colorRight:{r:.5943396,g:.5943396,b:.5943396},_envColorLeft:{r:.4056604,g:.4056604,b:.4056604},_envColorRight:{r:.6037736,g:.6037736,b:.6037736},_obstacleColor:{r:.2358491,g:.2358491,b:.2358491}},Rocket:{_colorLeft:{r:1,g:.4980392,b:0},_colorRight:{r:0,g:.5294118,b:1},_envColorLeft:{r:.9,g:.4866279,b:.3244186},_envColorRight:{r:.4,g:.7180724,b:1},_obstacleColor:{r:.3176471,g:.6117647,b:.7254902}},"Green Day":{_colorLeft:{r:.2588235,g:.7843138,b:.01960784},_colorRight:{r:0,g:.7137255,b:.6705883},_envColorLeft:{r:0,g:.7137255,b:.6705883},_envColorRight:{r:.2588235,g:.7843137,b:.01960784},_obstacleColor:{r:0,g:.8117648,b:.09019608}},Timbaland:{_colorLeft:{r:.5019608,g:.5019608,b:.5019608},_colorRight:{r:.1,g:.5517647,b:1},_envColorLeft:{r:.1,g:.5517647,b:1},_envColorRight:{r:.1,g:.5517647,b:1},_obstacleColor:{r:.5,g:.5,b:.5}},FitBeat:{_colorLeft:{r:.8000001,g:.6078432,b:.1568628},_colorRight:{r:.7921569,g:.1607843,b:.682353},_envColorLeft:{r:.8,g:.5594772,b:.5594772},_envColorRight:{r:.5594772,g:.5594772,b:.8},_obstacleColor:{r:.2784314,g:.2784314,b:.4}},"Linkin Park":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.7529412,g:.672753,b:.5925647},_envColorRight:{r:.6241197,g:.6890281,b:.709},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},BTS:{_colorLeft:{r:1,g:.09019607,b:.4059771},_colorRight:{r:.8018868,g:0,b:.7517689},_envColorLeft:{r:.7843137,g:.1254902,b:.5010797},_envColorRight:{r:.6941177,g:.1254902,b:.8666667},_envColorLeftBoost:{r:.9019608,g:.5411765,b:1},_envColorRightBoost:{r:.3490196,g:.8078431,b:1},_obstacleColor:{r:.6698113,g:.1800908,b:.5528399}},Kaleidoscope:{_colorLeft:{r:.65882355,g:.1254902,b:.1254902},_colorRight:{r:.28235295,g:.28235295,b:.28235295},_envColorLeft:{r:.65882355,g:.1254902,b:.1254902},_envColorRight:{r:.47058824,g:.47058824,b:.47058824},_envColorLeftBoost:{r:.50196081,g:0,b:0},_envColorRightBoost:{r:.49244517,g:0,b:.53725493},_obstacleColor:{r:.25098041,g:.25098041,b:.25098041}},Interscope:{_colorLeft:{r:.726415,g:.62691,b:.31181},_colorRight:{r:.589571,g:.297888,b:.723},_envColorLeft:{r:.724254,g:.319804,b:.913725},_envColorRight:{r:.764706,g:.758971,b:.913725},_envColorLeftBoost:{r:.792453,g:.429686,b:.429868},_envColorRightBoost:{r:.7038,g:.715745,b:.765},_obstacleColor:{r:.588235,g:.298039,b:.721569}},Skrillex:{_colorLeft:{r:.69803923,g:.14117648,b:.36862746},_colorRight:{r:.32933334,g:.32299998,b:.38},_envColorLeft:{r:.80000001,g:.28000003,b:.58594489},_envColorRight:{r:.06525807,g:.57800001,b:.56867743},_envColorLeftBoost:{r:.81176478,g:.30588236,b:.30588236},_envColorRightBoost:{r:.27843139,g:.80000001,b:.44597632},_obstacleColor:{r:.15686275,g:.60392159,b:.60392159}},"Billie Eilish":{_colorLeft:{r:.80000001,g:.64481932,b:.43200001},_colorRight:{r:.54808509,g:.61276591,b:.63999999},_envColorLeft:{r:.81960785,g:.442,b:.184},_envColorRight:{r:.94117647,g:.70677096,b:.56470591},_obstacleColor:{r:.71325314,g:.56140977,b:.78301889},_envColorLeftBoost:{r:.80000001,g:0,b:0},_envColorRightBoost:{r:.55686277,g:.7019608,b:.77647066}},Spooky:{_colorLeft:{r:.81960785,g:.49807876,b:.27702752},_colorRight:{r:.37894738,g:.35789475,b:.40000001},_envColorLeft:{r:.90196079,g:.23009226,b:0},_envColorRight:{r:.46005884,g:.56889427,b:.92941177},_obstacleColor:{r:.81960791,g:.44313729,b:.18431373},_envColorLeftBoost:{r:.33768433,g:.63207543,b:.33690813},_envColorRightBoost:{r:.60209066,g:.3280082,b:.85849059}},Gaga:{_colorLeft:{r:.85,g:.4333333,b:.7833334},_colorRight:{r:.4705882,g:.8,b:.4078431},_envColorLeft:{r:.706,g:.649,b:.2394706},_envColorRight:{r:.894,g:.1625455,b:.7485644},_obstacleColor:{r:.9921569,g:0,b:.7719755},_envColorLeftBoost:{r:.754717,g:.3610244,b:.22071921},_envColorRightBoost:{r:0,g:.7058824,b:1}},Weave:{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8218409,g:.08627451,b:.8509804},_envColorRightBoost:{r:.5320754,g:.5320754,b:.5320754},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Pyro:{_colorLeft:{r:.5764706,g:0,b:.03921569},_colorRight:{r:1,g:.6705883,b:0},_envColorLeft:{r:1,g:.1098039,b:.2039216},_envColorRight:{r:.8862745,g:.7372549,b:.2627451},_envColorLeftBoost:{r:1,g:0,b:.1764706},_envColorRightBoost:{r:.7647059,g:.7647059,b:.7647059},_obstacleColor:{r:.8490566,g:.7037643,b:.4285333}},EDM:{_colorLeft:{r:.6320754,g:.6320754,b:.6320754},_colorRight:{r:.1764706,g:.6980392,b:.8784314},_envColorLeft:{r:.08220173,g:.7169812,b:0},_envColorRight:{r:0,g:.3671638,b:.7169812},_envColorLeftBoost:{r:.735849,g:0,b:.1758632},_envColorRightBoost:{r:.4284593,g:0,b:.754717},_obstacleColor:{r:.1764706,g:.6980392,b:.8784314}},"The Second":{_colorLeft:{r:.7843137,g:.07843138,b:.07843138},_colorRight:{r:.1568627,g:.5568627,b:.8235294},_envColorLeft:{r:.85,g:.08499997,b:.08499997},_envColorRight:{r:.1882353,g:.675294,b:1},_envColorLeftBoost:{r:.8235294,g:.08627451,b:.8509804},_envColorRightBoost:{r:0,g:1,b:.6478302},_obstacleColor:{r:1,g:.1882353,b:.1882353}},Lizzo:{_colorLeft:{r:1,g:.8132076,b:.3773585},_colorRight:{r:.6705883,g:.254902,b:.8980392},_envColorLeft:{r:.8392157,g:.6470588,b:.2156863},_envColorRight:{r:.8196079,g:.2392157,b:.8784314},_envColorLeftBoost:{r:1,g:.4,b:.5529412},_envColorRightBoost:{r:.3686275,g:.7960784,b:1},_obstacleColor:{r:1,g:.5020987,b:.1882353}},"The Weeknd":{_colorLeft:{r:.5843138,g:.1294118,b:.1294118},_colorRight:{r:.2235294,g:.2901961,b:.3294118},_envColorLeft:{r:1,g:.2979701,b:.1411765},_envColorRight:{r:.1668743,g:.3753689,b:.7075472},_envColorWhite:{r:.8773585,g:.8773585,b:.8773585},_envColorLeftBoost:{r:.9568628,g:.6039216,b:.1215686},_envColorRightBoost:{r:.5254902,g:.8274511,b:.9921569},_envColorWhiteBoost:{r:.9811321,g:.9308866,b:.8608046},_obstacleColor:{r:.9176471,g:.2980392,b:.007843138}},"Rock Mixtape":{_colorLeft:{r:.6,g:.4233,b:.042},_colorRight:{r:.6006,g:.7441199,b:.78},_envColorLeft:{r:.75,g:.12,b:.162},_envColorRight:{r:.95,g:.5820333,b:.1615},_envColorLeftBoost:{r:.96,g:.1344,b:.9187202},_envColorRightBoost:{r:.378,g:.813,b:.9},_obstacleColor:{r:1,g:1,b:1}},"Dragons 2.0":{_colorLeft:{r:.7264151,g:.6587077,b:.2809719},_colorRight:{r:.2509804,g:.7647059,b:.405098},_envColorLeft:{r:.01960784,g:.9960785,b:.06666667},_envColorRight:{r:0,g:.05490196,b:1},_envColorLeftBoost:{r:.9764706,g:.03137255,b:.01960784},_envColorRightBoost:{r:1,g:.8292086,b:.2264151},_obstacleColor:{r:.5548979,g:.2470588,b:1}},"Panic 2.0":{_colorLeft:{r:.9019608,g:.3333333,b:.5686275},_colorRight:{r:.1529412,g:.5568628,b:.4862745},_envColorLeft:{r:.6980392,g:.1137255,b:.372549},_envColorRight:{r:.1882353,g:.6196079,b:.6235294},_envColorWhite:{r:.8329412,g:.9008105,b:.9254902},_envColorLeftBoost:{r:.9019608,g:.4470589,b:.06666667},_envColorRightBoost:{r:.6365692,g:.4373443,b:.8584906},_envColorWhiteBoost:{r:.8803849,g:.8313726,b:.9254902},_obstacleColor:{r:.9686275,g:.3803922,b:.2745098}},Queen:{_colorLeft:{r:.58,g:.5675714,b:.5551428},_colorRight:{r:.5236231,g:.1345675,b:.6792453},_envColorLeft:{r:.9333334,g:.6392157,b:.1215686},_envColorRight:{r:.04313726,g:.7176471,b:.8980393},_envColorLeftBoost:{r:.7686275,g:.145098,b:.07450981},_envColorRightBoost:{r:.4,g:.007843138,b:.7254902},_obstacleColor:{r:.9333334,g:.6392157,b:.1215686}},"Linkin Park 2.0":{_colorLeft:{r:.6627451,g:.1643608,b:.1690187},_colorRight:{r:.3870196,g:.5168997,b:.5568628},_envColorLeft:{r:.6627451,g:.1647059,b:.172549},_envColorRight:{r:.6235294,g:.6901961,b:.7098039},_envColorWhite:{r:.7529413,g:.6745098,b:.5921569},_envColorLeftBoost:{r:.922,g:.5957885,b:.255394},_envColorRightBoost:{r:.282353,g:.4586275,b:.6235294},_obstacleColor:{r:.6627451,g:.1647059,b:.172549}},"The Rolling Stones":{_colorLeft:{r:.8980392,g:0,b:.1150319},_colorRight:{r:.5254902,g:.1333333,b:.6784314},_envColorLeft:{r:.9529412,g:.01176471,b:.4039216},_envColorRight:{r:.4784314,g:.4039216,b:1},_envColorLeftBoost:{r:.5647059,g:.4622677,b:0},_envColorRightBoost:{r:.003921554,g:.6383545,b:.6705883},_obstacleColor:{r:.9529412,g:.01176471,b:.4039216}},Lattice:{_colorLeft:{r:.8392157,g:.172549,b:.5456773},_colorRight:{r:0,g:.6717121,b:.9803922},_envColorLeft:{r:.8941177,g:.1607843,b:.7490196},_envColorRight:{r:.1960784,g:.5843138,b:.7960785},_envColorLeftBoost:{r:.5450981,g:.1333333,b:.8156863},_envColorRightBoost:{r:.4039216,g:.9176471,b:.9176471},_obstacleColor:{r:.4685534,g:.7095922,b:1}},"Daft Punk":{_colorLeft:{r:.7215686,g:.2254902,b:.1803922},_colorRight:{r:.1215686,g:.6980392,b:.6901961},_envColorLeft:{r:1,g:.7017543,b:.2515723},_envColorRight:{r:.5215687,g:.3294118,b:.8196079},_envColorWhite:{r:.4784314,g:.8117647,b:1},_envColorLeftBoost:{r:.8588235,g:0,b:.4784314},_envColorRightBoost:{r:0,g:.8196079,b:.8039216},_envColorWhiteBoost:{r:1,g:.834256,b:.4874213},_obstacleColor:{r:.6068091,g:0,b:1}},"Hip Hop Mixtape":{_colorLeft:{r:1,g:.583857,b:.3137255},_colorRight:{r:.01542656,g:.6132076,b:.5896002},_envColorLeft:{r:.9137256,g:.4941177,b:0},_envColorRight:{r:.05882353,g:.8039216,b:.1843137},_envColorWhite:{r:.8000001,g:.7568628,b:.7058824},_envColorLeftBoost:{r:.1411765,g:1,b:.9686275},_envColorRightBoost:{r:.227451,g:.2745098,b:1},_envColorWhiteBoost:{r:.8784314,g:.8784314,b:.8784314},_obstacleColor:{r:1,g:.3137255,b:.5529412}},Collider:{_colorLeft:{r:.9647059,g:.4947137,b:.1504941},_colorRight:{r:.1686274,g:.5998134,b:.8588235},_envColorLeft:{r:.9637059,g:.4092787,b:0},_envColorRight:{r:.1686275,g:.3921569,b:.8588236},_envColorLeftBoost:{r:.8980393,g:.03529412,b:.02352941},_envColorRightBoost:{r:.854902,g:.4117647,b:.9725491},_obstacleColor:{r:.8396226,g:.09639232,b:0}},"Glass Desert":{_colorLeft:{r:.6792453,g:.5712628,b:0},_colorRight:{r:.7075472,g:0,b:.5364411},_envColorLeft:{r:.32222217,g:.6111111,b:.75},_envColorRight:{r:.03844783,g:.62239975,b:.90566039},_obstacleColor:{r:.06167676,g:.2869513,b:.3962264}}};function Pc(t,e){var u,f,m,h,c,g,d;if(!t||!t._colorLeft&&!t._colorRight&&!t._envColorLeft&&!t._envColorLeftBoost&&!t._envColorRight&&!t._envColorRightBoost&&!t._envColorWhite&&!t._envColorWhiteBoost&&!t._obstacleColor){Ot(Dr);return}e||(e="DefaultEnvironment");const i={_colorLeft:((u=de[pe[e]])==null?void 0:u._colorLeft)||null,_colorRight:((f=de[pe[e]])==null?void 0:f._colorRight)||null,_envColorLeft:((m=de[pe[e]])==null?void 0:m._envColorLeft)||null,_envColorRight:((h=de[pe[e]])==null?void 0:h._envColorRight)||null,_envColorWhite:null,_envColorLeftBoost:((c=de[pe[e]])==null?void 0:c._envColorLeftBoost)||null,_envColorRightBoost:((g=de[pe[e]])==null?void 0:g._envColorRightBoost)||null,_envColorWhiteBoost:null,_obstacleColor:((d=de[pe[e]])==null?void 0:d._obstacleColor)||null},n={_colorLeft:i._colorLeft?pt(i._colorLeft):null,_colorRight:i._colorRight?pt(i._colorRight):null,_envColorLeft:i._envColorLeft?pt(i._envColorLeft):null,_envColorRight:i._envColorRight?pt(i._envColorRight):null,_envColorWhite:null,_envColorLeftBoost:i._envColorLeftBoost?pt(i._envColorLeftBoost):null,_envColorRightBoost:i._envColorRightBoost?pt(i._envColorRightBoost):null,_envColorWhiteBoost:null,_obstacleColor:i._obstacleColor?pt(i._obstacleColor):null},o={noteColor:!!(t._colorLeft||t._colorRight),eventColor:!!(t._envColorLeft||t._envColorRight),eventBoostColor:!!(t._envColorLeftBoost||t._envColorRightBoost),obstacleColor:!!t._obstacleColor};t._colorLeft&&(n._colorLeft=pt(t._colorLeft)),t._colorRight&&(n._colorRight=pt(t._colorRight)),t._envColorLeft?n._envColorLeft=pt(t._envColorLeft):t._colorLeft&&(n._envColorLeft=pt(t._colorLeft)),t._envColorRight?n._envColorRight=pt(t._envColorRight):t._colorRight&&(n._envColorRight=pt(t._colorRight));let l,s,r=!1;t._envColorLeftBoost?(l=pt(t._envColorLeftBoost),r=!0):l=i._envColorLeftBoost?pt(i._envColorLeftBoost):n._envColorLeft,t._envColorRightBoost?(s=pt(t._envColorRightBoost),r=!0):s=i._envColorRightBoost?pt(i._envColorRightBoost):n._envColorRight,t._envColorWhite&&(n._envColorWhite=pt(t._envColorWhite)),t._envColorWhiteBoost&&(n._envColorWhiteBoost=pt(t._envColorWhiteBoost)),r&&(n._envColorLeftBoost=l,n._envColorRightBoost=s),t._obstacleColor&&(n._obstacleColor=pt(t._obstacleColor)),o.noteColor||(n._colorLeft=null,n._colorRight=null),o.eventColor||(n._envColorLeft=null,n._envColorRight=null),o.noteColor&&!o.eventColor&&(n._envColorLeft=n._colorLeft,n._envColorRight=n._colorRight),o.obstacleColor||(n._obstacleColor=null);const a=Ri.create("max","none",!0);for(const v in n){if(!n[v])continue;const _=document.createElement("div"),y=document.createElement("div"),S=document.createElement("div"),w=document.createElement("div");y.className="info__color-dot",y.style.backgroundColor=n[v]||"#000000",S.className="info__color-text info__color-text--monospace",S.textContent=`${n[v]}`,w.className="info__color-text",w.textContent=` -- ${vm[v]}`,_.appendChild(y),_.appendChild(S),_.appendChild(w),a.appendChild(_)}$t(Dr,[a])}var Mc=(t=>(t.duplicate="D",t.active="A",t.scale="S",t.position="P",t.localPosition="Lp",t.rotation="R",t.localRotation="Lr",t.lightID="Li",t.track="T",t))(Mc||{}),Fc=(t=>(t.childrenTracks="Ct",t.color="C",t.definitePosition="Dp",t.dissolve="D",t.dissolveArrow="Da",t.duration="Dur",t.easing="E",t.interactable="I",t.localRotation="Lr",t.parentTrack="Pt",t.position="P",t.rotation="R",t.scale="S",t.time="T",t.track="Tr",t.worldPositionStays="Wps",t))(Fc||{});function zc(t,e){if(t==null||!t.length){Ot(Br);return}const i=t.map((n,o)=>{var m,h;let l=n.b??n._time??0,s;e&&(l=e.adjustTime(l),s=e.toRealTime(l));const r=[],a=n.d??n._data;if(!a)return`Error parsing customEvents[${o}]`;for(const c in a){if(c=="_duration"||c=="_easing"||c=="_track"||c=="duration"||c=="easing"||c=="track")continue;const g=Fc[c];a[c]!=null&&r.push(g)}const u=n.t??n._type,f=((m=n.d)==null?void 0:m.track)??((h=n._data)==null?void 0:h._track);return`${M(l,nt.rounding)}${s?" | "+Wt(s):""} -- ${u} -> [${r.join("")}]${u!=="AssignTrackParent"?`(${f})`:""}`});$t(Br,i)}function Vc(t){if(t==null||!t.length){Ot(Rr);return}const e=t.map((i,n)=>{const o=[];if(!i.id&&!i.geometry&&!i._id&&!i._geometry)return`Error parsing environment[${n}]`;for(const a in i){if(a=="lookupMethod"||a=="id"||a=="geometry"||a=="_lookupMethod"||a=="_id"||a=="_geometry")continue;const u=Mc[a];i[a]!=null&&o.push(u)}const l=i.geometry||i._geometry,s=i.track||i._track,r=i.id||i._id;return`${l?"Geometry":i.lookupMethod||i._lookupMethod} [${o.join("")}]${s?`(${s})`:""} -> ${l?l.type||l._type:r}`});$t(Rr,e)}function Gc(t){if(t==null){Ot(dr);return}$t(dr,t)}function Hc(t){if(t==null||!t.length){Ot(gr);return}let e=t.join(", ");$t(gr,e)}function Uc(t){if(t==null||!t.length){Ot(br);return}let e=t.join(", ");$t(br,e)}function jc(t){if(t==null){Ot(vr);return}let e=(bo[t]||"Unknown")+" Environment";bo[t]||(e+=` (${t})`),$t(vr,e)}function Wc(t){if(t==null){Ot(yr);return}$t(yr,Xh(t))}function Xc(t){if(t==null||!t.length){Ot(Cr);return}$t(Cr,t.join(", "))}function Yc(t){if(t==null||!t.length){Ot(Sr);return}$t(Sr,t.join(", "))}function qc(t){if(t==null||!t.length){Ot(wr);return}$t(wr,t)}function Kc(t){if(t==null||!t.length){Ot(kr);return}$t(kr,t)}function Zc(t){if(t==null){Ot(xr);return}const e=[];if(Array.isArray(t))for(const i of t)i||e.push("Error parsing pointDefinitions"),e.push(`${i._name} -- ${i._points.length} point${i._points.length>1?"s":""}`);else{t=t;for(const i in t){t[i]||e.push(`Error parsing pointDefinitions[${i}]`);const n=t[i];Array.isArray(n)||e.push(`Error parsing pointDefinitions[${i}]`),e.push(`${i} -- ${n.length} point${n.length>1?"s":""}`)}}$t(xr,e)}function Jc(t,e){if(t==null||e==null){Ot(_r);return}$t(_r,`${Wt(t)} to ${Wt(e)}${ht.duration?` -- [ ${Wt(e-t)} / ${Wt(ht.duration)} ]`:""}`)}function Qc(t){if(!t||!t.saberLeftColor&&!t.saberRightColor&&!t.environment0Color&&!t.environment0ColorBoost&&!t.environment1Color&&!t.environment1ColorBoost&&!t.environmentWColor&&!t.environmentWColorBoost&&!t.obstaclesColor){Ot(Er);return}const e={};e.saberLeftColor=pt(t.saberLeftColor),e.saberRightColor=pt(t.saberRightColor),e.environment0Color=pt(t.environment0Color),e.environment1Color=pt(t.environment1Color),e.environment0ColorBoost=pt(t.environment0ColorBoost),e.environment1ColorBoost=pt(t.environment1ColorBoost),e.obstaclesColor=pt(t.obstaclesColor),t.environmentWColor&&(e.environmentWColor=pt(t.environmentWColor)),t.environmentWColorBoost&&(e.environmentWColorBoost=pt(t.environmentWColorBoost));const i=Ri.create("max","none",!0);for(const n in e){if(!e[n])continue;const o=document.createElement("div"),l=document.createElement("div"),s=document.createElement("div"),r=document.createElement("div");l.className="info__color-dot",l.style.backgroundColor=e[n]||"#000000",s.className="info__color-text info__color-text--monospace",s.textContent=`${e[n]}`,r.className="info__color-text",r.textContent=` -- ${_m[n]}`,o.appendChild(l),o.appendChild(s),o.appendChild(r),i.appendChild(o)}$t(Er,[i])}function zt(t,e){return t.time-e.time}function qe(t,e){return Array.isArray(t.customData.coordinates)&&Array.isArray(e.customData.coordinates)?t.time-e.time||t.customData.coordinates[0]-e.customData.coordinates[0]||t.customData.coordinates[1]-e.customData.coordinates[1]:Array.isArray(t.customData._position)&&Array.isArray(e.customData._position)?t.time-e.time||t.customData._position[0]-e.customData._position[0]||t.customData._position[1]-e.customData._position[1]:t.time-e.time||t.posX-e.posX||t.posY-e.posY}function ym(t,e){return t._time-e._time}function Em(t,e){var i,n;return Array.isArray((i=t._customData)==null?void 0:i._position)&&Array.isArray((n=e._customData)==null?void 0:n._position)?t._time-e._time||t._customData._position[0]-e._customData._position[0]||t._customData._position[1]-e._customData._position[1]:t._time-e._time||t._lineIndex-e._lineLayer||t._lineIndex-e._lineLayer}function Ir(t,e){const i=t.difficulty.colorNotes;return e?i.length/e:0}function uo(t,e,i){let n=0,o=0;const l=t.difficulty.colorNotes;for(let s=0;s<l.length;s++){for(;l[s].time-l[o].time>e;)o++;n=Math.max(n,(s-o+1)/i.toRealTime(e))}return n}function tu(t){const e=[...t.difficulty.colorNotes,...t.difficulty.bombNotes,...t.difficulty.chains].sort(qe);let i=Number.MAX_VALUE;e.length>0&&(i=e[0].time);const n=Dm(t);return Math.min(i,n)}function Po(t){const e=[...t.difficulty.colorNotes,...t.difficulty.bombNotes,...t.difficulty.chains].sort(qe);let i=0;e.length>0&&(i=e[e.length-1].time);const n=Cm(t);return Math.max(i,n)}function Dm(t){for(let e=0,i=t.obstacles.length;e<i;e++)if(t.obstacles[e].isInteractive())return t.obstacles[e].time;return Number.MAX_VALUE}function Cm(t){let e=0;for(let i=t.difficulty.obstacles.length-1;i>=0;i--)t.difficulty.obstacles[i].isInteractive()&&(e=Math.max(e,t.difficulty.obstacles[i].time+t.difficulty.obstacles[i].duration));return e}function Sm(t){It.setSongName(t.song.title),It.setSongSubname(t.song.subTitle),It.setSongAuthor(t.song.author),It.setSongBPM(t.audio.bpm);const e=new Set,i=new Set,n=new Set;t.difficulties.forEach(o=>{o.authors.mappers.forEach(l=>e.add(l)),o.authors.lighters.forEach(l=>i.add(l)),n.add(t.environmentNames.at(o.environmentId))}),Tc([...e],[...i]),Lc([...n].filter(o=>o)),Rc(t.customData._editors)}function eu(t,e){Gc(e.rawData._version||e.rawData.version||"Unknown"),Hc(e.settings.authors.mappers),Uc(e.settings.authors.lighters),jc(t.environmentNames.at(e.settings.environmentId)),Qc(t.colorSchemes.at(e.settings.colorSchemeId)),Pc(e.settings.customData),Xc(e.settings.customData._requirements),Yc(e.settings.customData._suggestions),qc(e.settings.customData._information),Kc(e.settings.customData._warnings);const i=e.timeProcessor;Wc(e.data.difficulty.customData.time??e.data.difficulty.customData._time),Oc(e.data.difficulty.customData.bookmarks??e.data.difficulty.customData._bookmarks,i),$c(i),Vc(e.data.difficulty.customData.environment??e.data.difficulty.customData._environment),Zc(e.data.difficulty.customData.pointDefinitions??e.data.difficulty.customData._pointDefinitions),zc(e.data.difficulty.customData.customEvents??e.data.difficulty.customData._customEvents,i),Jc(e.timeProcessor.toRealTime(tu(e.data)),e.timeProcessor.toRealTime(Po(e.data)))}function wm(){Tc(),Lc(),Rc(),Bc(),Gc(),Hc(),Uc(),jc(),Jc(),Wc(),Qc(),Pc(),Xc(),Yc(),qc(),Kc(),Oc(),$c(),Vc(),Zc(),zc()}const hn={enable:t=>{document.querySelectorAll(".input-toggle").forEach(i=>{i.disabled=!t})}},zi=document.querySelector(".loading__bar"),Nr="loading__bar--error",Ar="loading__bar--download",km=document.querySelector(".loading__text");function iu(t,e,i=100){km.textContent=e,zi.style.width=`${i}%`,t==="error"?zi.classList.add(Nr):zi.classList.remove(Nr),t==="download"?zi.classList.add(Ar):zi.classList.remove(Ar)}function Tm(){iu("info","No map loaded",0)}const St={status:iu,reset:Tm};var gt=(t=>(t[t.APRIL_FOOLS=0]="APRIL_FOOLS",t[t.GENERAL_AUDIO=1]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=2]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=3]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=4]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=5]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=6]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=7]="OTHERS_HOT_START",t[t.OTHERS_NJS=8]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=9]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=10]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_INVALID_EVENT_BOX=11]="EVENTS_INVALID_EVENT_BOX",t[t.EVENTS_UNLIT_BOMB=12]="EVENTS_UNLIT_BOMB",t[t.NOTES_EFFECTIVE_BPM=13]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=14]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=15]="NOTES_PARITY",t[t.NOTES_VARY_SWING=16]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=17]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=18]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=19]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=20]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=21]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=22]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=23]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=24]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=25]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=26]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=27]="NOTES_HITBOX_PATH",t[t.NOTES_ONE_SABER=28]="NOTES_ONE_SABER",t[t.NOTES_COLOR_CHECK=29]="NOTES_COLOR_CHECK",t[t.NOTES_STACKED_NOTE=30]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=31]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=32]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=33]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=34]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=35]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=36]="OBSTACLES_NEGATIVE",t))(gt||{}),bt=(t=>(t[t.APRIL_FOOLS=0]="APRIL_FOOLS",t[t.GENERAL_AUDIO=1]="GENERAL_AUDIO",t[t.GENERAL_COVER_IMAGE=2]="GENERAL_COVER_IMAGE",t[t.GENERAL_PREVIEW_TIME=3]="GENERAL_PREVIEW_TIME",t[t.GENERAL_PROGRESSION=4]="GENERAL_PROGRESSION",t[t.OTHERS_INVALID_OBJECT=5]="OTHERS_INVALID_OBJECT",t[t.OTHERS_OUTSIDE_PLAYABLE=6]="OTHERS_OUTSIDE_PLAYABLE",t[t.OTHERS_HOT_START=7]="OTHERS_HOT_START",t[t.OTHERS_NJS=8]="OTHERS_NJS",t[t.OTHERS_DIFFICULTY_LABEL=9]="OTHERS_DIFFICULTY_LABEL",t[t.EVENTS_INSUFFICIENT_LIGHT=10]="EVENTS_INSUFFICIENT_LIGHT",t[t.EVENTS_INVALID_EVENT_BOX=11]="EVENTS_INVALID_EVENT_BOX",t[t.EVENTS_UNLIT_BOMB=12]="EVENTS_UNLIT_BOMB",t[t.NOTES_ONE_SABER=13]="NOTES_ONE_SABER",t[t.NOTES_COLOR_CHECK=14]="NOTES_COLOR_CHECK",t[t.NOTES_EFFECTIVE_BPM=15]="NOTES_EFFECTIVE_BPM",t[t.NOTES_ACCEPTABLE_PRECISION=16]="NOTES_ACCEPTABLE_PRECISION",t[t.NOTES_PARITY=17]="NOTES_PARITY",t[t.NOTES_VARY_SWING=18]="NOTES_VARY_SWING",t[t.NOTES_SLOW_SLIDER=19]="NOTES_SLOW_SLIDER",t[t.NOTES_INLINE_ANGLE=20]="NOTES_INLINE_ANGLE",t[t.NOTES_SHRADO_ANGLE=21]="NOTES_SHRADO_ANGLE",t[t.NOTES_SPEED_PAUSE=22]="NOTES_SPEED_PAUSE",t[t.NOTES_IMPROPER_ARC=23]="NOTES_IMPROPER_ARC",t[t.NOTES_IMPROPER_CHAIN=24]="NOTES_IMPROPER_CHAIN",t[t.NOTES_IMPROPER_WINDOW=25]="NOTES_IMPROPER_WINDOW",t[t.NOTES_HITBOX_STAIR=26]="NOTES_HITBOX_STAIR",t[t.NOTES_HITBOX_REVERSE_STAIR=27]="NOTES_HITBOX_REVERSE_STAIR",t[t.NOTES_HITBOX_INLINE=28]="NOTES_HITBOX_INLINE",t[t.NOTES_HITBOX_PATH=29]="NOTES_HITBOX_PATH",t[t.NOTES_STACKED_NOTE=30]="NOTES_STACKED_NOTE",t[t.NOTES_DOUBLE_DIRECTIONAL=31]="NOTES_DOUBLE_DIRECTIONAL",t[t.NOTES_VISION_BLOCK=32]="NOTES_VISION_BLOCK",t[t.OBSTACLES_SHORT=33]="OBSTACLES_SHORT",t[t.OBSTACLES_CENTER=34]="OBSTACLES_CENTER",t[t.OBSTACLES_ZERO=35]="OBSTACLES_ZERO",t[t.OBSTACLES_NEGATIVE=36]="OBSTACLES_NEGATIVE",t))(bt||{});const Lm="April Fools",Rm="xdd.",xm=!0,Bm={name:Lm,description:Rm,type:"general",order:{input:gt.APRIL_FOOLS,output:bt.APRIL_FOOLS},input:{enabled:xm,params:{}},run:Im};function Im(t){const e=new Date("01 April 1984"),i=new Date,n=e.getDate()===i.getDate()&&e.getMonth()===i.getMonth();if(!nt.aprilFooled&&n){const o=document.createElement("div"),l=document.createElement("a");return l.text="this link for more info.",l.href="https://youtu.be/dQw4w9WgXcQ",l.addEventListener("click",function(){nt.aprilFooled=!0,nt.save()}),o.innerHTML='<b><span title="Info: no action necessary, take note.">  </span>AI generated content detected:</b> this may violate TOS, please refer to ',o.append(l),[{type:"html",label:"",value:[o]}]}return[]}let mn=0;const Y={createBlock:function(...t){const e=document.createElement("div");for(const i of t)if(Array.isArray(i))for(const n of i)e.append(n);else e.appendChild(i);return e},createText:function(t,e,i){const n=`input-${mn++}`,o=document.createElement("input"),l=document.createElement("label");return o.id="input__gen-"+n,o.className="input-toggle input--small",o.type="text",o.value=i,o.addEventListener("change",t),e&&(l.textContent=e,l.htmlFor="input__gen-"+n),[o,l]},createNumber:function(t,e,i,n,o,l){const s=`input-${mn++}`,r=document.createElement("input"),a=document.createElement("label");return r.id="input__gen-"+s,r.className="input-toggle input--small",r.type="text",r.value=i.toString(),r.addEventListener("change",t),e&&(a.textContent=e,a.htmlFor="input__gen-"+s),typeof n=="number"&&(r.min=n.toString()),typeof o=="number"&&(r.max=o.toString()),typeof l=="number"&&(r.step=l.toString()),[a,r]},createCheckbox:function(t,e,i,n){const o=`input-${mn++}`,l=document.createElement("input"),s=document.createElement("label");return s.textContent=" "+e,s.title=i,s.htmlFor="input__gen-"+o,l.id="input__gen-"+o,l.className="input-toggle",l.type="checkbox",l.checked=n,l.addEventListener("change",t),[l,s]},createRadio:function(t,e,i,n,o){const l=`input-${mn++}`,s=document.createElement("input"),r=document.createElement("label");return r.textContent=e,r.htmlFor="input__gen-"+l,s.id="input__gen-"+l,s.name=i,s.className="input-toggle",s.type="radio",s.checked=o,s.value=n,s.addEventListener("change",t),[r,s]}},Or="Audio Duration",$r="For ranking purpose, check for audio duration.",Pr=!0,nu={name:Or,description:$r,type:"general",order:{input:gt.GENERAL_AUDIO,output:bt.GENERAL_AUDIO},input:{enabled:Pr,params:{},html:Y.createBlock(Y.createCheckbox(function(){nu.input.enabled=this.checked},Or,$r,Pr))},run:Nm};function Nm(t){const e=t.audioDuration;return e&&e<20?[{type:"string",label:"Unrankable audio length",value:`too short (${Wt(e)}s)`,symbol:"rank"}]:hi.loading.audio?[]:[{type:"string",label:"No audio",value:nt.load.audio?"could not be loaded or not found":"no audio mode is enabled"}]}const Mr="Validate Cover Image",Fr="Validate cover image.",zr=!0,ou={name:Mr,description:Fr,type:"general",order:{input:gt.GENERAL_COVER_IMAGE,output:bt.GENERAL_COVER_IMAGE},input:{enabled:zr,params:{},html:Y.createBlock(Y.createCheckbox(function(){ou.input.enabled=this.checked},Mr,Fr,zr))},run:Am};function Am(){const t=new Image,e=It.getCoverImage(),i=[];return hi.loading.coverImage&&e!==null?(t.src=e,t.width!==t.height&&i.push({type:"string",label:"Cover image is not square",value:"resize to fit square",symbol:"error"}),(t.width<256||t.height<256)&&i.push({type:"string",label:"Cover image is too small",value:"require at least 256x256",symbol:"error"})):i.push({type:"string",label:"No cover image",value:nt.load.imageCover?"could not be loaded or found":"no cover image option is enabled"}),i}const Vr="Preview Time",Gr="Warn default editor preview time.",Hr=!0,ru={name:Vr,description:Gr,type:"general",order:{input:gt.GENERAL_PREVIEW_TIME,output:bt.GENERAL_PREVIEW_TIME},input:{enabled:Hr,params:{},html:Y.createBlock(Y.createCheckbox(function(){ru.input.enabled=this.checked},Vr,Gr,Hr))},run:Om};function Om(t){const{previewStartTime:e,previewDuration:i}=t.info.audio;return e===12&&i===10?[{type:"string",label:"Default preview time",value:"strongly recommended to set for audience's 1st impression",symbol:"info"}]:[]}function $m(t){return Math.max(...t.map(e=>e.ebpm),0)}function Pm(t){return Math.max(...t.map(e=>e.ebpmSwing),0)}var rt=(t=>(t[t.NONE=-1]="NONE",t[t.RED=0]="RED",t[t.BLUE=1]="BLUE",t))(rt||{}),B=(t=>(t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.UP_LEFT=4]="UP_LEFT",t[t.UP_RIGHT=5]="UP_RIGHT",t[t.DOWN_LEFT=6]="DOWN_LEFT",t[t.DOWN_RIGHT=7]="DOWN_RIGHT",t[t.ANY=8]="ANY",t))(B||{}),ct=(t=>(t[t.LEFT=0]="LEFT",t[t.MIDDLE_LEFT=1]="MIDDLE_LEFT",t[t.MIDDLE_RIGHT=2]="MIDDLE_RIGHT",t[t.RIGHT=3]="RIGHT",t))(ct||{}),Rt=(t=>(t[t.BOTTOM=0]="BOTTOM",t[t.MIDDLE=1]="MIDDLE",t[t.TOP=2]="TOP",t))(Rt||{}),Ct=(t=>(t[t.OFF=0]="OFF",t[t.BLUE_ON=1]="BLUE_ON",t[t.BLUE_FLASH=2]="BLUE_FLASH",t[t.BLUE_FADE=3]="BLUE_FADE",t[t.BLUE_TRANSITION=4]="BLUE_TRANSITION",t[t.RED_ON=5]="RED_ON",t[t.RED_FLASH=6]="RED_FLASH",t[t.RED_FADE=7]="RED_FADE",t[t.RED_TRANSITION=8]="RED_TRANSITION",t[t.WHITE_ON=9]="WHITE_ON",t[t.WHITE_FLASH=10]="WHITE_FLASH",t[t.WHITE_FADE=11]="WHITE_FADE",t[t.WHITE_TRANSITION=12]="WHITE_TRANSITION",t))(Ct||{}),At=(t=>(t[t.BACK_LASERS=0]="BACK_LASERS",t[t.RING_LIGHTS=1]="RING_LIGHTS",t[t.LEFT_LASERS=2]="LEFT_LASERS",t[t.RIGHT_LASERS=3]="RIGHT_LASERS",t[t.CENTER_LIGHTS=4]="CENTER_LIGHTS",t[t.COLOR_BOOST=5]="COLOR_BOOST",t[t.EXTRA_LEFT_LIGHTS=6]="EXTRA_LEFT_LIGHTS",t[t.EXTRA_RIGHT_LIGHTS=7]="EXTRA_RIGHT_LIGHTS",t[t.RING_ROTATION=8]="RING_ROTATION",t[t.RING_ZOOM=9]="RING_ZOOM",t[t.EXTRA_LEFT_LASERS=10]="EXTRA_LEFT_LASERS",t[t.EXTRA_RIGHT_LASERS=11]="EXTRA_RIGHT_LASERS",t[t.LEFT_LASER_ROTATION=12]="LEFT_LASER_ROTATION",t[t.RIGHT_LASER_ROTATION=13]="RIGHT_LASER_ROTATION",t[t.EARLY_LANE_ROTATION=14]="EARLY_LANE_ROTATION",t[t.LATE_LANE_ROTATION=15]="LATE_LANE_ROTATION",t[t.UTILITY_EVENT_0=16]="UTILITY_EVENT_0",t[t.UTILITY_EVENT_1=17]="UTILITY_EVENT_1",t[t.UTILITY_EVENT_2=18]="UTILITY_EVENT_2",t[t.UTILITY_EVENT_3=19]="UTILITY_EVENT_3",t[t.SPECIAL_EVENT_0=40]="SPECIAL_EVENT_0",t[t.SPECIAL_EVENT_1=41]="SPECIAL_EVENT_1",t[t.SPECIAL_EVENT_2=42]="SPECIAL_EVENT_2",t[t.SPECIAL_EVENT_3=43]="SPECIAL_EVENT_3",t[t.BPM_CHANGE=100]="BPM_CHANGE",t))(At||{}),su=(t=>(t[t.DIVISION=1]="DIVISION",t[t.STEP_AND_OFFSET=2]="STEP_AND_OFFSET",t))(su||{}),au=(t=>(t[t.NONE=0]="NONE",t[t.DURATION=1]="DURATION",t[t.DISTRIBUTION=2]="DISTRIBUTION",t[t.ALL=3]="ALL",t))(au||{}),lu=(t=>(t[t.NO_RANDOM=0]="NO_RANDOM",t[t.KEEP_ORDER=1]="KEEP_ORDER",t[t.RANDOM_ELEMENTS=2]="RANDOM_ELEMENTS",t[t.ALL=3]="ALL",t))(lu||{}),_n=(t=>(t[t.NONE=-1]="NONE",t[t.LINEAR=0]="LINEAR",t[t.IN_QUAD=1]="IN_QUAD",t[t.OUT_QUAD=2]="OUT_QUAD",t[t.INOUT_QUAD=3]="INOUT_QUAD",t[t.IN_SINE=4]="IN_SINE",t[t.OUT_SINE=5]="OUT_SINE",t[t.INOUT_SINE=6]="INOUT_SINE",t[t.IN_CUBIC=7]="IN_CUBIC",t[t.OUT_CUBIC=8]="OUT_CUBIC",t[t.INOUT_CUBIC=9]="INOUT_CUBIC",t[t.IN_QUART=10]="IN_QUART",t[t.OUT_QUART=11]="OUT_QUART",t[t.INOUT_QUART=12]="INOUT_QUART",t[t.IN_QUINT=13]="IN_QUINT",t[t.OUT_QUINT=14]="OUT_QUINT",t[t.INOUT_QUINT=15]="INOUT_QUINT",t[t.IN_EXPO=16]="IN_EXPO",t[t.OUT_EXPO=17]="OUT_EXPO",t[t.INOUT_EXPO=18]="INOUT_EXPO",t[t.IN_CIRC=19]="IN_CIRC",t[t.OUT_CIRC=20]="OUT_CIRC",t[t.INOUT_CIRC=21]="INOUT_CIRC",t[t.IN_BACK=22]="IN_BACK",t[t.OUT_BACK=23]="OUT_BACK",t[t.INOUT_BACK=24]="INOUT_BACK",t[t.IN_ELASTIC=25]="IN_ELASTIC",t[t.OUT_ELASTIC=26]="OUT_ELASTIC",t[t.INOUT_ELASTIC=27]="INOUT_ELASTIC",t[t.IN_BOUNCE=28]="IN_BOUNCE",t[t.OUT_BOUNCE=29]="OUT_BOUNCE",t[t.INOUT_BOUNCE=30]="INOUT_BOUNCE",t[t.BS_INOUT_BACK=100]="BS_INOUT_BACK",t[t.BS_INOUT_ELASTIC=101]="BS_INOUT_ELASTIC",t[t.BS_INOUT_BOUNCE=102]="BS_INOUT_BOUNCE",t))(_n||{}),wi=(t=>(t[t.INSTANT=0]="INSTANT",t[t.INTERPOLATE=1]="INTERPOLATE",t[t.EXTEND=2]="EXTEND",t))(wi||{}),cu=(t=>(t[t.INT=0]="INT",t[t.FLOAT=1]="FLOAT",t[t.BOOL=2]="BOOL",t))(cu||{}),Be=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.ROTATION=2]="ROTATION",t[t.TRANSLATION=3]="TRANSLATION",t[t.FX_FLOAT=4]="FX_FLOAT",t))(Be||{});const Jn=4,ge={[B.UP]:180,[B.DOWN]:0,[B.LEFT]:270,[B.RIGHT]:90,[B.UP_LEFT]:225,[B.UP_RIGHT]:135,[B.DOWN_LEFT]:315,[B.DOWN_RIGHT]:45,[B.ANY]:0},Mm={[B.UP]:B.DOWN,[B.DOWN]:B.UP,[B.LEFT]:B.RIGHT,[B.RIGHT]:B.LEFT,[B.UP_LEFT]:B.DOWN_RIGHT,[B.UP_RIGHT]:B.DOWN_LEFT,[B.DOWN_LEFT]:B.UP_RIGHT,[B.DOWN_RIGHT]:B.UP_LEFT,[B.ANY]:B.ANY},ze={[B.UP]:[0,1],[B.DOWN]:[0,-1],[B.LEFT]:[-1,0],[B.RIGHT]:[1,0],[B.UP_LEFT]:[-1,1],[B.UP_RIGHT]:[1,1],[B.DOWN_LEFT]:[-1,-1],[B.DOWN_RIGHT]:[1,-1],[B.ANY]:[0,0]},uu={0:-60,1:-45,2:-30,3:-15,4:15,5:30,6:45,7:60};class Fm{clone(){return new this.constructor(this)}}class ke extends Fm{constructor(){super(...arguments),this.customData={}}setCustomData(e){return this.customData=e,this}resetCustomData(){return this.customData={},this}removeCustomData(e){return typeof e=="string"?delete this.customData[e]:e.forEach(i=>delete this.customData[i]),this}addCustomData(e){for(const i in e)this.customData[i]=e[i];return this}sort(e){return e==null||e(this),this}perform(e){return e(this),this}isValid(e,i){return e?!!e(this):!0}check(e){return e?!!e(this):!1}}class ve extends ke{constructor(){super(...arguments),this.time=0}setTime(e){return this.time=e,this}}class Mo extends ve{constructor(){super(...arguments),this.posX=0,this.posY=0,this.laneRotation=0}setPosX(e){return this.posX=e,this}setPosY(e){return this.posY=e,this}setLaneRotation(e){return this.laneRotation=e,this}mirror(e,i){return i==null||i(this),this.posX=Jn-1-this.posX,this}getPosition(e){return(e==null?void 0:e(this))??[this.posX-2,this.posY]}getDistance(e,i){const[n,o]=this.getPosition(i),[l,s]=e.getPosition(i);return Math.sqrt(Math.pow(l-n,2)+Math.pow(s-o,2))}isVertical(e,i){const[n]=this.getPosition(i),[o]=e.getPosition(i),l=n-o;return l>-.001&&l<.001}isHorizontal(e,i){const[n,o]=this.getPosition(i),[l,s]=e.getPosition(i),r=o-s;return r>-.001&&r<.001}isDiagonal(e,i){const[n,o]=this.getPosition(i),[l,s]=e.getPosition(i),r=Math.abs(n-l),a=Math.abs(o-s);return r===a}isInline(e,i,n){return i??(i=.5),this.getDistance(e,n)<=i}isAdjacent(e,i){const n=this.getDistance(e,i);return n>.499&&n<1.001}isWindow(e,i,n){return i??(i=1.8),this.getDistance(e,n)>i}isSlantedWindow(e,i){return this.isWindow(e,null,i)&&!this.isDiagonal(e,i)&&!this.isHorizontal(e,i)&&!this.isVertical(e,i)}}class Fo extends Mo{constructor(){super(...arguments),this.color=0,this.direction=0}setColor(e){return this.color=e,this}setDirection(e){return this.direction=e,this}mirror(e=!0,i){switch(i==null||i(this),e&&(this.color=(1+this.color)%2),this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return super.mirror(e)}isRed(){return this.color===0}isBlue(){return this.color===1}getAngle(e){return(e==null?void 0:e(this))??(ge[this.direction]||0)}isDouble(e,i=.01){return e.time>this.time-i&&e.time<this.time+i&&this.color!==e.color}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.direction>=0&&this.direction<=8}}const ce=class ce extends Fo{constructor(e={}){super(),this.angleOffset=0,this.time=e.time??ce.defaultValue.time,this.posX=e.posX??ce.defaultValue.posX,this.posY=e.posY??ce.defaultValue.posY,this.color=e.color??ce.defaultValue.color,this.direction=e.direction??ce.defaultValue.direction,this.angleOffset=e.angleOffset??ce.defaultValue.angleOffset,this.laneRotation=e.laneRotation??ce.defaultValue.laneRotation,this.customData=j(e.customData??ce.defaultValue.customData)}static create(...e){return e.length?e.map(i=>new this(i)):[new this]}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.posX>=0&&this.posX<=3&&this.posY>=0&&this.posY<=2&&this.direction>=0&&this.direction<=8}setAngleOffset(e){return this.angleOffset=e,this}mirror(e=!0,i){return i==null||i(this),super.mirror(e)}getAngle(e){return(e==null?void 0:e(this))??(ge[this.direction]||0)+this.angleOffset}};ce.defaultValue={time:0,posX:0,posY:0,color:0,direction:0,angleOffset:0,laneRotation:0,customData:{}};let bi=ce;function hu(t,e,i){return t.direction===B.ANY&&e.direction===B.ANY&&i!==B.ANY&&(t.posX>e.posX&&(i===B.UP_RIGHT||i===B.RIGHT||i===B.DOWN_RIGHT)||t.posX<e.posX&&(i===B.DOWN_LEFT||i===B.LEFT||i===B.UP_LEFT)||t.posY>e.posY&&(i===B.UP_LEFT||i===B.UP||i===B.UP_RIGHT)||t.posY<e.posY&&(i===B.DOWN_LEFT||i===B.DOWN||i===B.DOWN_RIGHT))||t.posX>e.posX&&(t.direction===B.UP_RIGHT||t.direction===B.RIGHT||t.direction===B.DOWN_RIGHT||(e.direction===B.UP_RIGHT||e.direction===B.RIGHT||e.direction===B.DOWN_RIGHT)&&t.direction===B.ANY)||t.posX<e.posX&&(t.direction===B.DOWN_LEFT||t.direction===B.LEFT||t.direction===B.UP_LEFT||(e.direction===B.DOWN_LEFT||e.direction===B.LEFT||e.direction===B.UP_LEFT)&&t.direction===B.ANY)||t.posY>e.posY&&(t.direction===B.UP_LEFT||t.direction===B.UP||t.direction===B.UP_RIGHT||(e.direction===B.UP_LEFT||e.direction===B.UP||e.direction===B.UP_RIGHT)&&t.direction===B.ANY)||t.posY<e.posY&&(t.direction===B.DOWN_LEFT||t.direction===B.DOWN||t.direction===B.DOWN_RIGHT||(e.direction===B.DOWN_LEFT||e.direction===B.DOWN||e.direction===B.DOWN_RIGHT)&&t.direction===B.ANY)}function _o(t,e,i,n=!1){const[o,l]=t.getPosition(),[s,r]=e.getPosition(),a=n?540:360;let u=!1;if(t.direction!==8){const m=t.getAngle(),h=(fo(Math.atan2(l-r,o-s))+450)%360;for(const[c,g,d]of i){const v=d??0,_=(m+a-c+v)%360,y=(m+a+c+v)%360;if(u=g>=Math.sqrt(Math.pow(o-s,2)+Math.pow(l-r,2))&&(_<y&&_<=h&&h<=y||_>=y&&(h<=y||h>=_))||u,u)break}}let f=!1;if(e instanceof bi&&e.direction!==8){const m=e.getAngle(),h=(fo(Math.atan2(r-l,s-o))+450)%360;for(const[c,g,d]of i){const v=d??0,_=(m+a-c+v)%360,y=(m+a+c+v)%360;if(f=g>=Math.sqrt(Math.pow(o-s,2)+Math.pow(l-r,2))&&(_<y&&_<=h&&h<=y||_>=y&&(h<=y||h>=_))||f,f)break}}return[u,f]}function Ur(t,e){if(hu(t,e,B.ANY))return t.direction===B.ANY?e.direction:t.direction;if(t.direction!==B.ANY)return t.direction;if(t.time>e.time){if(t.posX>e.posX&&t.isHorizontal(e))return B.RIGHT;if(t.posX<e.posX&&t.isHorizontal(e))return B.LEFT;if(t.posY>e.posY){if(t.isVertical(e))return B.UP;if(t.posX>e.posX)return B.UP_RIGHT;if(t.posX<e.posX)return B.UP_LEFT}if(t.posY<e.posY){if(t.isVertical(e))return B.DOWN;if(t.posX>e.posX)return B.DOWN_RIGHT;if(t.posX<e.posX)return B.DOWN_LEFT}}return B.ANY}function Xi(t,e,i,n){let o,l;if(t===null||e===null)return!1;if(typeof t=="number")o=t;else{if(t.direction===B.ANY)return!1;o=t.getAngle()}if(typeof e=="number")l=e;else{if(e.direction===B.ANY)return!1;l=e.getAngle()}return n?ar(o,l,360)<=i:ar(o,l,360)>=i}class oe{constructor(e){this.time=e.time,this.duration=e.duration,this.minSpeed=e.minSpeed,this.maxSpeed=e.maxSpeed,this.ebpm=e.ebpm,this.ebpmSwing=e.ebpmSwing,this.data=e.data}static generate(e,i){const n=[];let o=0,l=0,s,r;const a={},u={},f={0:[],1:[]};for(const m of e)s=0,r=Number.MAX_SAFE_INTEGER,u[m.color]?this.next(m,u[m.color],i,f[m.color])&&(s=this.calcMinSliderSpeed(f[m.color],i),r=this.calcMaxSliderSpeed(f[m.color],i),s>0&&r!==1/0||(s=0,r=0),l=this.calcEBPMBetweenObject(m,a[m.color],i),o=this.calcEBPMBetweenObject(m,u[m.color],i),n.push({time:a[m.color].time,duration:u[m.color].time-a[m.color].time,data:f[m.color],ebpm:o,ebpmSwing:l,maxSpeed:r,minSpeed:s}),a[m.color]=m,f[m.color]=[]):a[m.color]=m,u[m.color]=m,f[m.color].push(m);for(let m=0;m<2;m++)u[m]&&(s=this.calcMinSliderSpeed(f[m],i),r=this.calcMaxSliderSpeed(f[m],i),s>0&&r!==1/0||(s=0,r=0),n.push({time:a[m].time,duration:u[m].time-a[m].time,data:f[m],ebpm:o,ebpmSwing:l,maxSpeed:r,minSpeed:s}));return n}static next(e,i,n,o){if(o&&o.length>0&&n.toRealTime(i.time)+.005<n.toRealTime(e.time)&&e.direction!==B.ANY){for(const l of o)if(l.direction!==B.ANY&&Xi(e,l,90,!1))return!0}if(o&&o.length>0){for(const l of o)if(e.isInline(l))return!0}return e.isWindow(i)&&n.toRealTime(e.time-i.time)>.08||n.toRealTime(e.time-i.time)>.07}static calcEBPMBetweenObject(e,i,n){return n.bpm/(n.toBeatTime(n.toRealTime(e.time)-n.toRealTime(i.time),!1)*2)}static calcMinSliderSpeed(e,i){let n=!1,o=!1,l=0;const s=i.toRealTime(Math.max(...e.map((r,a)=>a===0?0:((e[a].isHorizontal(e[a-1])||e[a].isVertical(e[a-1]))&&!n&&(n=!0,l=(e[a].time-e[a-1].time)/(e[a].getDistance(e[a-1])||1)),o=e[a].isDiagonal(e[a-1])||e[a].isSlantedWindow(e[a-1])||o,(e[a].time-e[a-1].time)/(e[a].getDistance(e[a-1])||1)))));return n&&o?i.toRealTime(l):s}static calcMaxSliderSpeed(e,i){let n=!1,o=!1,l=Number.MAX_SAFE_INTEGER;const s=i.toRealTime(Math.min(...e.map((r,a)=>a===0?Number.MAX_SAFE_INTEGER:((e[a].isHorizontal(e[a-1])||e[a].isVertical(e[a-1]))&&!n&&(n=!0,l=(e[a].time-e[a-1].time)/(e[a].getDistance(e[a-1])||1)),o=e[a].isDiagonal(e[a-1])||e[a].isSlantedWindow(e[a-1])||o,(e[a].time-e[a-1].time)/(e[a].getDistance(e[a-1])||1)))));return n&&o?i.toRealTime(l):s}}function zm(t,e,i){const n={left:new Array(Math.floor(e+1)).fill(0),right:new Array(Math.floor(e+1)).fill(0)};let o,l;for(const s of t){const r=i.toRealTime(s.time);s.color===0&&(o?oe.next(s,o,i)&&n.left[Math.floor(r)]++:n.left[Math.floor(r)]++,o=s),s.color===1&&(l?oe.next(s,l,i)&&n.right[Math.floor(r)]++:n.right[Math.floor(r)]++,l=s)}return n}function ho(t,e){if(!t.length)return 0;if(t.length<e)return t.reduce((o,l)=>o+l)/t.length;let i=t.slice(0,e).reduce((o,l)=>o+l),n=i;for(let o=0;o<t.length-e;o++)i=i-t[o]+t[o+e],n=Math.max(n,i);return n/e}function Vm(t,e,i,n){const l={characteristic:i,difficulty:n,red:{average:0,peak:0,median:0,total:0},blue:{average:0,peak:0,median:0,total:0},total:{average:0,peak:0,median:0,total:0},container:oe.generate(t.colorNotes,e)},s=Math.max(e.toRealTime(Xr(t)-jm(t)),0),r=Math.max(e.toRealTime(Xr(t)),0),a=zm(t.colorNotes,r,e),u=a.left.map((c,g)=>c+a.right[g]);if(u.reduce((c,g)=>c+g)===0)return l;const f=[],m=[],h=[];for(let c=0,g=Math.ceil(u.length/10);c<g;c++){const d=c*10;let v=10;v+d>u.length&&(v=u.length-d);const _=a.left.slice(d,d+v),y=a.right.slice(d,d+v),S=u.slice(d,d+v);f.push(_.reduce((w,k)=>w+k)/v),m.push(y.reduce((w,k)=>w+k)/v),h.push(S.reduce((w,k)=>w+k)/v)}return l.red.total=a.left.reduce((c,g)=>c+g),l.red.average=a.left.reduce((c,g)=>c+g)/s,l.red.peak=ho(a.left,10),l.red.median=so(f),l.blue.total=a.right.reduce((c,g)=>c+g),l.blue.average=a.right.reduce((c,g)=>c+g)/s,l.blue.peak=ho(a.right,10),l.blue.median=so(m),l.total.total=l.red.total+l.blue.total,l.total.average=u.reduce((c,g)=>c+g)/s,l.total.peak=ho(u,10),l.total.median=so(h),l}function Gm(t,e){let i=0,n=0,o;for(const l of t){const s=l.total.average;if(n>0&&s>0&&(i=Math.abs(1-n/s)*100),n=s>0?s:n,n>e&&i>40)return{result:l,comparedTo:o};o=l}return null}function Hm(t,e){let i=Number.MAX_SAFE_INTEGER,n=0,o;for(const l of t){const s=l.total.average;if(n>0&&s>0&&(i=Math.abs(1-n/s)*100),n=s>0?s:n,n>e&&i<10)return{result:l,comparedTo:o};o=l}return null}function Um(t){let e=0,i=Number.MAX_SAFE_INTEGER;return t.forEach(n=>{const o=n.total.average;o>0&&(e=Math.max(e,o),i=Math.min(i,o))}),e||e&&i?(1-i/e)*100:0}function jr(t){return Math.min(...t.map(e=>e.total.average),Number.MAX_SAFE_INTEGER)}function Wr(t){return Math.max(...t.map(e=>e.total.average),0)}function Xr(t){const e=[...t.colorNotes,...t.chains,...t.bombNotes].sort(qe);let i=0;e.length>0&&(i=e[e.length-1].time);const n=Xm(t);return Math.max(i,n)}function jm(t){const e=[...t.colorNotes,...t.chains,...t.bombNotes].sort(qe);let i=Number.MAX_VALUE;e.length>0&&(i=e[0].time);const n=Wm(t);return Math.min(i,n)}function Wm(t){for(let e=0,i=t.obstacles.length;e<i;e++)if(t.obstacles[e].isInteractive())return t.obstacles[e].time;return Number.MAX_VALUE}function Xm(t){let e=0;for(let i=t.obstacles.length-1;i>=0;i--)t.obstacles[i].isInteractive()&&(e=Math.max(e,t.obstacles[i].time+t.obstacles[i].duration));return e}function Ym(t){return Math.max(...t.map(e=>e.minSpeed),0)}function qm(t){const e=t.map(i=>i.maxSpeed).filter(i=>i!==0);return e.length?Math.min(...e):0}const Ln={Easy:1,Normal:3,Hard:5,Expert:7,ExpertPlus:9},Ke={Easy:"Easy",Normal:"Normal",Hard:"Hard",Expert:"Expert",ExpertPlus:"Expert+"},Yr="Difficulty Progression",qr="For ranking purpose, check difficuly progression to fit rankability criteria.",Kr=!0,mu=document.createElement("ul"),Km=["ExpertPlus","Expert","Hard","Normal","Easy"];for(const t of Km)mu.appendChild(Y.createBlock(Y.createCheckbox(function(){Qn.input.params[t]=this.checked},Ke[t],`Toggle check progression for Standard ${Ke[t]}`,!0)));const Qn={name:Yr,description:qr,type:"general",order:{input:gt.GENERAL_PROGRESSION,output:bt.GENERAL_PROGRESSION},input:{enabled:Kr,params:{ExpertPlus:!0,Expert:!0,Hard:!0,Normal:!0,Easy:!0},html:Y.createBlock(Y.createBlock(Y.createCheckbox(function(){Qn.input.enabled=this.checked},Yr,qr,Kr)),mu)},run:Zm};function Zm(t){var r,a,u,f,m,h,c,g;const e=t.audioDuration;if(!e)return[];const i=ht.beatmaps.filter(d=>d.settings.characteristic==="Standard").map(d=>d.swingAnalysis).filter(d=>Qn.input.params[d.difficulty]&&d.total.total>0).sort((d,v)=>v.total.average-d.total.average);if(!i.length)return[];const n=Math.max(e<120?3.2:e<240?4.2:5.2,M(Wr(i)*.4,2)),o=[];e<360&&jr(i)>n&&(i.forEach(d=>d.total.average),o.push({type:"string",label:`Minimum SPS not met (<${n})`,value:`lowest SPS is ${M(jr(i),2)}, ${M(Um(i),2)}% drop from highest SPS (${M(Wr(i),2)})`,symbol:"rank"}));const l=Gm(i,n),s=Hm(i,n);return l&&e<360&&o.push({type:"string",label:"Violates progression",value:`${Ke[l.result.difficulty]} exceeded 40% SPS drop, ${M(l.result.total.average,2)} from ${M(((a=(r=l.comparedTo)==null?void 0:r.total)==null?void 0:a.average)||0,2)} ${Ke[l.comparedTo.difficulty]}, acceptable range (${M((((f=(u=l.comparedTo)==null?void 0:u.total)==null?void 0:f.average)||0)*.6,2)}-${M((((m=l.comparedTo)==null?void 0:m.total.average)||0)*.9,2)})`,symbol:"rank"}),s&&e<360&&o.push({type:"string",label:"Violates progression",value:`${Ke[s.result.difficulty]} has less than 10% SPS drop, ${M(s.result.total.average,2)} from ${M(((h=s.comparedTo)==null?void 0:h.total.average)||0,2)} ${Ke[s.comparedTo.difficulty]}, acceptable range (${M((((c=s.comparedTo)==null?void 0:c.total.average)||0)*.6,2)}-${M((((g=s.comparedTo)==null?void 0:g.total.average)||0)*.9,2)})`,symbol:"rank"}),o}const Zr=Object.freeze(Object.defineProperty({__proto__:null,aprilFools:Bm,audio:nu,coverImage:ou,previewTime:ru,progression:Qn},Symbol.toStringTag,{value:"Module"}));var fu=(t=>(t[t.VERBOSE=0]="VERBOSE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.NONE=5]="NONE",t))(fu||{}),di,Zi,fe;const ni=class ni{constructor(){an(this,di,2);an(this,Zi,(e,i)=>`${ni.LogPrefixes.get(i)} > [${e.join("::")}]`);an(this,fe,"script")}set logLevel(e){Mi(this,di,e),this.tInfo(["logger","logLevel"],`Log level set to ${ni.LogPrefixes.get(e)}`)}get logLevel(){return re(this,di)}set tagPrint(e){Mi(this,Zi,e),this.tInfo(["logger","tagPrint"],"Update tag print function")}get tagPrint(){return re(this,Zi)}set untagged(e){Mi(this,fe,e.trim()),this.tInfo(["logger","untagged"],`Update untagged string to ${re(this,fe)}`)}get untagged(){return re(this,fe)}log(e,i,...n){if(e<re(this,di))return;const o=[this.tagPrint(i,e),...n];switch(e){case 1:return console.debug(...o);case 2:return console.info(...o);case 3:return console.warn(...o);case 4:return console.error(...o);default:return console.log(...o)}}setLevel(e){e=Math.min(Math.max(e,0),5),Mi(this,di,e),this.tInfo(["logger","setLevel"],`Log level set to ${ni.LogPrefixes.get(e)}`)}tVerbose(e,...i){this.log(0,e,...i)}tDebug(e,...i){this.log(1,e,...i)}tInfo(e,...i){this.log(2,e,...i)}tWarn(e,...i){this.log(3,e,...i)}tError(e,...i){this.log(4,e,...i)}verbose(...e){this.tVerbose([re(this,fe)],...e)}debug(...e){this.tDebug([re(this,fe)],...e)}info(...e){this.tInfo([re(this,fe)],...e)}warn(...e){this.tWarn([re(this,fe)],...e)}error(...e){this.tError([re(this,fe)],...e)}};di=new WeakMap,Zi=new WeakMap,fe=new WeakMap,ni.LogLevels=fu,ni.LogPrefixes=new Map([[0,"VERBOSE"],[1,"DEBUG"],[2,"INFO"],[3,"WARN"],[4,"!!ERROR!!"],[5,"NONE"]]);let yo=ni;const J=new yo,Ue=class Ue extends ve{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??Ue.defaultValue.time,this.type=e.type??Ue.defaultValue.type,this.value=e.value??Ue.defaultValue.value,this.floatValue=e.floatValue??Ue.defaultValue.floatValue,this.customData=j(e.customData??Ue.defaultValue.customData)}isValidType(){return this.type>=0&&this.type<=19||this.type>=40&&this.type<=43||this.type===100}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.isValidType()&&this.value>=0&&!(!this.isLaserRotationEvent()&&this.value>12&&!this.isOldChroma())}setType(e){return this.type=e,this}setValue(e){return this.value=e,this}setFloatValue(e){return this.floatValue=e,this}isOff(){return this.value===Ct.OFF}isOn(){return this.value===Ct.BLUE_ON||this.value===Ct.RED_ON||this.value===Ct.WHITE_ON}isFlash(){return this.value===Ct.BLUE_FLASH||this.value===Ct.RED_FLASH||this.value===Ct.WHITE_FLASH}isFade(){return this.value===Ct.BLUE_FADE||this.value===Ct.RED_FADE||this.value===Ct.WHITE_FADE}isTransition(){return this.value===Ct.BLUE_TRANSITION||this.value===Ct.RED_TRANSITION||this.value===Ct.WHITE_TRANSITION}isBlue(){return this.value===Ct.BLUE_ON||this.value===Ct.BLUE_FLASH||this.value===Ct.BLUE_FADE||this.value===Ct.BLUE_TRANSITION}isRed(){return this.value===Ct.RED_ON||this.value===Ct.RED_FLASH||this.value===Ct.RED_FADE||this.value===Ct.RED_TRANSITION}isWhite(){return this.value===Ct.WHITE_ON||this.value===Ct.WHITE_FLASH||this.value===Ct.WHITE_FADE||this.value===Ct.WHITE_TRANSITION}isLightEvent(){return this.type===0||this.type===1||this.type===2||this.type===3||this.type===4||this.type===6||this.type===7||this.type===10||this.type===11}isColorBoost(){return this.type===At.COLOR_BOOST}isRingEvent(){return this.type===At.RING_ROTATION||this.type===At.RING_ZOOM}isLaserRotationEvent(){return this.type===At.LEFT_LASER_ROTATION||this.type===At.RIGHT_LASER_ROTATION}isLaneRotationEvent(){return this.type===At.EARLY_LANE_ROTATION||this.type===At.LATE_LANE_ROTATION}isExtraEvent(){return this.type===At.UTILITY_EVENT_0||this.type===At.UTILITY_EVENT_1||this.type===At.UTILITY_EVENT_2||this.type===At.UTILITY_EVENT_3}isSpecialEvent(){return this.type===At.SPECIAL_EVENT_0||this.type===At.SPECIAL_EVENT_1||this.type===At.SPECIAL_EVENT_2||this.type===At.SPECIAL_EVENT_3}isBpmEvent(){return this.type===At.BPM_CHANGE}isLightingEvent(){return this.isLightEvent()||this.isRingEvent()||this.isLaserRotationEvent()||this.isExtraEvent()}isOldChroma(){return this.value>=2e9}};Ue.defaultValue={time:0,type:0,value:0,floatValue:0,customData:{}};let Rn=Ue;function Jr(t){return["convert","toV1Beatmap",t]}function Jm(t,e){switch(J.tWarn(Jr("main"),"Converting beatmap to v1 may lose certain data!"),e){case 1:case 2:t.version=1;break;case 3:t.version=1,Qm(t);break;case 4:t.version=1,tf(t);break;default:J.tWarn(Jr("main"),"Unknown version: version not supported; misinput? Returning original data.")}return t}function Qm(t){var e,i;t.difficulty.customData._time=t.difficulty.customData.time,t.difficulty.customData._BPMChanges=(e=t.difficulty.customData.BPMChanges)==null?void 0:e.map(n=>({_time:n.b,_BPM:n.m,_beatsPerBar:n.p,_metronomeOffset:n.o})),t.difficulty.customData._bookmarks=(i=t.difficulty.customData.bookmarks)==null?void 0:i.map(n=>({_time:n.b,_name:n.n})),delete t.difficulty.customData.time,delete t.difficulty.customData.BPMChanges,delete t.difficulty.customData.bookmarks}function tf(t){t.difficulty.customData._time=t.difficulty.customData.time??0}function Qr(t){return["convert","toV1Info",t]}function ef(t,e){switch(J.tWarn(Qr("main"),"Converting to beatmap v1 may lose certain data!"),e){case 1:case 3:case 2:case 4:t.version=1;break;default:J.tWarn(Qr("main"),"Unknown version: version not supported; misinput? Returning original data.")}return t}function ts(t){return["convert","toV2Audio",t]}function nf(t,e){switch(J.tWarn(ts("main"),"Converting to beatmap v2 may lose certain data!"),e){case 1:case 2:case 3:case 4:t.version=2;break;default:J.tWarn(ts("main"),"Unknown version: version not supported; misinput? Returning original data.")}return t}function mt(t,e,i){t[i]??(t[i]=t[e]),delete t[e]}function Ci(t){if(!t)return{};const e={...t};return Object.keys(e).length?(mt(e,"color","_color"),mt(e,"coordinates","_position"),mt(e,"disableNoteGravity","_disableNoteGravity"),mt(e,"disableNoteLook","_disableNoteLook"),mt(e,"flip","_flip"),mt(e,"localRotation","_localRotation"),mt(e,"noteJumpMovementSpeed","_noteJumpMovementSpeed"),mt(e,"noteJumpStartBeatOffset","_noteJumpStartBeatOffset"),mt(e,"size","_scale"),mt(e,"track","_track"),mt(e,"worldRotation","_rotation"),e._disableSpawnEffect??(e._disableSpawnEffect=typeof e.spawnEffect=="boolean"?!e.spawnEffect:void 0),delete e.spawnEffect,e._interactable??(e._interactable=typeof e.uninteractable=="boolean"?!e.uninteractable:void 0),delete e.uninteractable,e.animation&&(e._animation??(e._animation={_color:e.animation.color,_definitePosition:e.animation.definitePosition,_dissolve:e.animation.dissolve,_dissolveArrow:e.animation.dissolveArrow,_interactable:e.animation.interactable,_localRotation:e.animation.localRotation,_position:e.animation.offsetPosition,_rotation:e.animation.offsetRotation,_scale:e.animation.scale,_time:e.animation.time})),delete e.animation,e):{}}function of(t){if(!t)return{};const e={...t};return Object.keys(e).length?(mt(e,"color","_color"),mt(e,"lightID","_lightID"),mt(e,"easing","_easing"),mt(e,"lerpType","_lerpType"),mt(e,"nameFilter","_nameFilter"),mt(e,"rotation","_rotation"),mt(e,"step","_step"),mt(e,"prop","_prop"),mt(e,"speed","_speed"),mt(e,"direction","_direction"),mt(e,"lockRotation","_lockPosition"),e):{}}function Gi(t){return["convert","toV2Beatmap",t]}function rf(t,e){switch(J.tWarn(Gi("main"),"Converting to beatmap v2 may lose certain data!"),e){case 1:case 2:t.version=2;break;case 3:t.version=2,es(t);break;case 4:t.version=2,es(t);break;default:J.tWarn(Gi("main"),"Unknown version: version not supported; misinput? Returning original data.")}return t}function es(t){var e,i,n,o,l;t.colorNotes.forEach(s=>{s.customData=Ci(s.customData)}),(e=t.difficulty.customData.fakeColorNotes)==null||e.forEach(s=>{const r=Ci(s.customData);t.addColorNotes({time:s.b,posX:s.x,posY:s.y,color:s.c,direction:s.d,customData:r})}),delete t.difficulty.customData.fakeColorNotes,t.bombNotes.forEach(s=>{s.customData=Ci(s.customData)}),(i=t.difficulty.customData.fakeBombNotes)==null||i.forEach(s=>{const r=Ci(s.customData);t.addColorNotes({time:s.b,posX:s.x,posY:s.y,customData:r})}),t.difficulty.obstacles.forEach(s=>{s.customData=Ci(s.customData)}),(n=t.difficulty.customData.fakeObstacles)==null||n.forEach(s=>{const r=Ci(s.customData);t.addObstacles({time:s.b,posX:s.x,posY:s.y,duration:s.d,width:s.w,height:s.h,customData:r})}),t.basicEvents.forEach(s=>{s.customData=of(s.customData),s.isLaserRotationEvent()?delete s.customData._speed:delete s.customData._preciseSpeed});for(const s in t.difficulty.customData){if(s==="customEvents"){t.difficulty.customData._customEvents=[];for(const r of t.difficulty.customData.customEvents){if(r.t==="AnimateTrack")for(let a=0,u=r.d.repeat??0;a<=u;a++)t.difficulty.customData._customEvents.push({_time:r.b+(r.d.duration??0)*a,_type:"AnimateTrack",_data:{_track:r.d.track,_duration:r.d.duration,_easing:r.d.easing,_position:r.d.position,_rotation:r.d.rotation,_localRotation:r.d.localRotation,_scale:r.d.scale,_dissolve:r.d.dissolve,_dissolveArrow:r.d.dissolveArrow,_color:r.d.color,_interactable:r.d.interactable,_time:r.d.time}});r.t==="AssignPathAnimation"&&t.difficulty.customData._customEvents.push({_time:r.b,_type:"AssignPathAnimation",_data:{_track:r.d.track,_easing:r.d.easing,_position:r.d.position,_rotation:r.d.rotation,_localRotation:r.d.localRotation,_scale:r.d.scale,_dissolve:r.d.dissolve,_dissolveArrow:r.d.dissolveArrow,_color:r.d.color,_interactable:r.d.interactable,_definitePosition:r.d.definitePosition}}),r.t==="AssignTrackParent"&&t.difficulty.customData._customEvents.push({_time:r.b,_type:"AssignTrackParent",_data:{_childrenTracks:r.d.childrenTracks,_parentTrack:r.d.parentTrack,_worldPositionStays:r.d.worldPositionStays}}),r.t==="AssignPlayerToTrack"&&t.difficulty.customData._customEvents.push({_time:r.b,_type:"AssignPlayerToTrack",_data:{_track:r.d.track,_target:r.d.target}}),r.t==="AnimateComponent"&&r.d.BloomFogEnvironment&&t.difficulty.customData._customEvents.push({_time:r.b,_type:"AssignFogTrack",_data:{_track:r.d.track,_duration:r.d.duration,_attenuation:r.d.BloomFogEnvironment.attenuation,_height:r.d.BloomFogEnvironment.height,_offset:r.d.BloomFogEnvironment.offset,_startY:r.d.BloomFogEnvironment.startY}})}delete t.difficulty.customData.customEvents;continue}if(s==="environment"){t.difficulty.customData._environment=t.difficulty.customData.environment.map(r=>{var a,u,f,m,h,c,g,d;if(r.id&&r.lookupMethod)return{_id:r.id,_lookupMethod:r.lookupMethod,_track:r.track,_duplicate:r.duplicate,_active:r.active,_scale:r.scale,_position:Ee(r.position,1/.6),_rotation:r.rotation,_localPosition:Ee(r.localPosition,1/.6),_localRotation:r.localRotation,_lightID:(u=(a=r.components)==null?void 0:a.ILightWithId)==null?void 0:u.lightID};if(r.geometry)return((m=(f=r.components)==null?void 0:f.ILightWithId)!=null&&m.type||(c=(h=r.components)==null?void 0:h.ILightWithId)!=null&&c.lightID)&&J.tWarn(Gi("fromV2"),"v2 geometry cannot be made assignable light to specific type"),{_geometry:r.geometry.type==="CUSTOM"?{_type:r.geometry.type,_mesh:{_vertices:r.geometry.mesh.vertices,_uv:r.geometry.mesh.uv,_triangles:r.geometry.mesh.triangles},_material:typeof r.geometry.material=="string"?r.geometry.material:{_shader:r.geometry.material.shader,_shaderKeywords:r.geometry.material.shaderKeywords,_collision:r.geometry.material.collision,_track:r.geometry.material.track,_color:r.geometry.material.color},_collision:r.geometry.collision}:{_type:r.geometry.type,_material:typeof r.geometry.material=="string"?r.geometry.material:{_shader:r.geometry.material.shader,_shaderKeywords:r.geometry.material.shaderKeywords,_collision:r.geometry.material.collision,_track:r.geometry.material.track,_color:r.geometry.material.color},_collision:r.geometry.collision},_track:r.track,_duplicate:r.duplicate,_active:r.active,_scale:r.scale,_position:Ee(r.position,1/.6),_rotation:r.rotation,_localPosition:Ee(r.localPosition,1/.6),_localRotation:r.localRotation,_lightID:(d=(g=r.components)==null?void 0:g.ILightWithId)==null?void 0:d.lightID};throw new Error("Error converting environment v3 to v2")}),delete t.difficulty.customData.environment;continue}if(s==="materials"){t.difficulty.customData._materials={};for(const r in t.difficulty.customData.materials)t.difficulty.customData._materials[r]={_shader:t.difficulty.customData.materials[r].shader,_shaderKeywords:t.difficulty.customData.materials[r].shaderKeywords,_collision:t.difficulty.customData.materials[r].collision,_track:t.difficulty.customData.materials[r].track,_color:t.difficulty.customData.materials[r].color};delete t.difficulty.customData.materials;continue}if(s==="pointDefinitions"){t.difficulty.customData._pointDefinitions=[];for(const r in t.difficulty.customData.pointDefinitions)t.difficulty.customData._pointDefinitions.push({_name:r,_points:t.difficulty.customData.pointDefinitions[r]});delete t.difficulty.customData.pointDefinitions;continue}if(s==="time"){t.difficulty.customData._time=t.difficulty.customData[s],delete t.difficulty.customData.time;continue}if(s==="BPMChanges"){t.difficulty.customData._BPMChanges=(o=t.difficulty.customData[s])==null?void 0:o.map(r=>({_time:r.b,_BPM:r.m,_beatsPerBar:r.p,_metronomeOffset:r.o})),delete t.difficulty.customData.BPMChanges;continue}if(s==="bookmarks"){t.difficulty.customData._bookmarks=(l=t.difficulty.customData[s])==null?void 0:l.map(r=>({_time:r.b,_name:r.n,_color:r.c})),delete t.difficulty.customData.bookmarks;continue}}if(t.difficulty.customData._environment){const s=[];for(const a of t.difficulty.customData._environment)a._track&&s.push(a._track);const r=[];if(t.difficulty.customData._customEvents){for(const a of t.difficulty.customData._customEvents)if(a._type==="AnimateTrack"){if(typeof a._data._track=="string"&&s.includes(a._data._track))r.push(a);else if(Array.isArray(a._data._track)){for(const u of a._data._track)if(s.includes(u)){r.push(a);break}}}}for(const a of r)typeof a._data._track=="string"?typeof a._data._position=="string"?J.tWarn(Gi("fromV2"),"Cannot convert point definitions, unknown use."):Array.isArray(a._data._position)&&(_c(a._data._position)?Ee(a._data._position,.6):a._data._position.forEach(u=>{u[0]*=.6,u[1]*=.6,u[2]*=.6})):J.tWarn(Gi("fromV2"),"Environment animate track array conversion not yet implemented.")}}function is(t){return["convert","toV2Info",t]}function sf(t,e){switch(J.tWarn(is("main"),"Converting to beatmap v2 may lose certain data!"),e){case 1:case 2:case 3:case 4:t.version=2;break;default:J.tWarn(is("main"),"Unknown version: version not supported; misinput? Returning original data.")}return t}function mo(t){if(!t)return{};const e={...t};return Object.keys(e).length?(mt(e,"_color","color"),mt(e,"_position","coordinates"),mt(e,"_disableNoteGravity","disableNoteGravity"),mt(e,"_disableNoteLook","disableNoteLook"),mt(e,"_flip","flip"),mt(e,"_localRotation","localRotation"),mt(e,"_noteJumpMovementSpeed","noteJumpMovementSpeed"),mt(e,"_noteJumpStartBeatOffset","noteJumpStartBeatOffset"),mt(e,"_scale","size"),mt(e,"_track","track"),mt(e,"_rotation","worldRotation"),e.spawnEffect??(e.spawnEffect=typeof e._disableSpawnEffect=="boolean"?!e._disableSpawnEffect:void 0),delete e._disableSpawnEffect,e.uninteractable??(e.uninteractable=typeof e._interactable=="boolean"?!e._interactable:void 0),delete e._interactable,e._animation&&(e.animation??(e.animation={color:e._animation._color,definitePosition:e._animation._definitePosition,dissolve:e._animation._dissolve,dissolveArrow:e._animation._dissolveArrow,interactable:e._animation._interactable,localRotation:e._animation._localRotation,offsetPosition:e._animation._position,offsetRotation:e._animation._rotation,scale:e._animation._scale,time:e._animation._time})),delete e._animation,e):{}}function af(t){if(!t)return{};const e={...t};return Object.keys(e).length?(mt(e,"_color","color"),mt(e,"_lightID","lightID"),mt(e,"_easing","easing"),mt(e,"_lerpType","lerpType"),mt(e,"_nameFilter","nameFilter"),mt(e,"_rotation","rotation"),mt(e,"_step","step"),mt(e,"_prop","prop"),mt(e,"_direction","direction"),mt(e,"_lockPosition","lockRotation"),typeof e._preciseSpeed=="number"?e.speed=e._preciseSpeed:e.speed??(e.speed=e._speed),delete e._speed,delete e._preciseSpeed,delete e._propID,delete e._lightGradient,delete e._reset,delete e._counterSpin,delete e._stepMult,delete e._propMult,delete e._speedMult,e):{}}function le(t){return["convert","toV3Beatmap",t]}function pu(t,e){switch(J.tWarn(le("main"),"Converting to beatmap v3 may lose certain data!"),e){case 1:t.version=3,lf(t);break;case 2:t.version=3,cf(t);break;case 3:case 4:t.version=3;break;default:J.tWarn(le("main"),"Unknown version: version not supported; misinput? Returning original data.")}return t}function lf(t){var e,i;t.colorNotes.forEach(n=>{n.direction>=1e3&&(n.angleOffset=Math.abs(n.direction%1e3%360-360),n.direction=n.direction>=1e3||typeof n.customData._cutDirection=="number"?n.direction===8?8:1:bc(n.direction,0,8))}),t.difficulty.customData.time=t.difficulty.customData._time,t.difficulty.customData.BPMChanges=(e=t.difficulty.customData._BPMChanges)==null?void 0:e.map(n=>({b:n._time,m:n._bpm??n._BPM,p:n._beatsPerBar,o:n._metronomeOffset})),t.difficulty.customData.bookmarks=(i=t.difficulty.customData._bookmarks)==null?void 0:i.map(n=>({b:n._time,n:n._name}))}function cf(t){var o,l,s;t.difficulty.customData.fakeColorNotes=[],t.difficulty.customData.fakeBombNotes=[],t.difficulty.customData.fakeObstacles=[];const e=[];t.colorNotes.forEach((r,a)=>{const u=mo(r.customData);typeof r.customData._cutDirection=="number"&&J.tDebug(le("fromV2"),`colorNotes[${a}] at time ${r.time} NE _cutDirection will be converted.`);let f=0;typeof r.customData._cutDirection=="number"?f=r.customData._cutDirection>0?r.customData._cutDirection%360:360+r.customData._cutDirection%360:r.direction>=1e3&&(f=Math.abs(r.direction%1e3%360-360));const m=r.direction>=1e3||typeof r.customData._cutDirection=="number"?r.direction===8?8:1:bc(r.direction,0,8);r.customData._fake?t.difficulty.customData.fakeColorNotes.push({b:r.time,c:r.color,x:r.posX,y:r.posY,d:m,a:f,customData:u}):(r.direction=m,r.angleOffset=f,r.customData=u,e.push(r))}),t.colorNotes=e;const i=[];t.bombNotes.forEach((r,a)=>{const u=mo(r.customData);typeof r.customData._cutDirection=="number"&&J.tDebug(le("fromV2"),`bombNotes[${a}] at time ${r.time} NE _cutDirection will be converted.`),r.customData._fake?t.difficulty.customData.fakeBombNotes.push({b:r.time,x:r.posX,y:r.posY,customData:u}):(r.customData=u,t.bombNotes.push(r))}),t.bombNotes=i;const n=[];t.obstacles.forEach(r=>{const a=mo(r.customData);r.customData._fake?t.difficulty.customData.fakeObstacles.push({b:r.time,x:r.posX,y:r.posY,d:r.duration,w:r.width,h:r.height,customData:a}):(r.customData=a,n.push(r))}),t.obstacles=n,t.basicEvents.forEach((r,a)=>{const u=af(r.customData);r.isLightEvent()&&(r.customData._propID&&J.tWarn(le("fromV2"),`events[${a}] at time ${r.time} Chroma _propID will be removed.`),r.customData._lightGradient&&J.tWarn(le("fromV2"),`events[${a}] at time ${r.time} Chroma _lightGradient will be removed.`)),r.isRingEvent()&&(r.customData._reset&&J.tWarn(le("fromV2"),`events[${a}] at time ${r.time} Chroma _reset will be removed.`),r.customData._counterSpin&&J.tWarn(le("fromV2"),`events[${a}] at time ${r.time} Chroma _counterSpin will be removed.`),(r.customData._stepMult||r.customData._propMult||r.customData._speedMult)&&J.tWarn(le("fromV2"),`events[${a}] at time ${r.time} Chroma _mult will be removed.`)),r.customData=u});for(const r in t.difficulty.customData){if(r==="_customEvents"){t.difficulty.customData.customEvents=[],t.difficulty.customData._customEvents.forEach(a=>{var u,f,m,h,c;a._type==="AnimateTrack"&&((u=t.difficulty.customData.customEvents)==null||u.push({b:a._time,t:"AnimateTrack",d:{track:a._data._track,duration:a._data._duration,easing:a._data._easing,position:a._data._position,rotation:a._data._rotation,localRotation:a._data._localRotation,scale:a._data._scale,dissolve:a._data._dissolve,dissolveArrow:a._data._dissolveArrow,color:a._data._color,interactable:a._data._interactable,time:a._data._time}})),a._type==="AssignPathAnimation"&&((f=t.difficulty.customData.customEvents)==null||f.push({b:a._time,t:"AssignPathAnimation",d:{track:a._data._track,easing:a._data._easing,position:a._data._position,rotation:a._data._rotation,localRotation:a._data._localRotation,scale:a._data._scale,dissolve:a._data._dissolve,dissolveArrow:a._data._dissolveArrow,color:a._data._color,interactable:a._data._interactable,definitePosition:a._data._definitePosition}})),a._type==="AssignTrackParent"&&((m=t.difficulty.customData.customEvents)==null||m.push({b:a._time,t:"AssignTrackParent",d:{childrenTracks:a._data._childrenTracks,parentTrack:a._data._parentTrack,worldPositionStays:a._data._worldPositionStays}})),a._type==="AssignPlayerToTrack"&&((h=t.difficulty.customData.customEvents)==null||h.push({b:a._time,t:"AssignPlayerToTrack",d:{track:a._data._track,target:a._data._target}})),a._type==="AssignFogTrack"&&((c=t.difficulty.customData.customEvents)==null||c.push({b:a._time,t:"AnimateComponent",d:{track:a._data._track,duration:a._data._duration||0,BloomFogEnvironment:{attenuation:typeof a._data._attenuation=="number"?[[a._data._attenuation,0]]:a._data._attenuation,height:typeof a._data._height=="number"?[[a._data._height,0]]:a._data._height,offset:typeof a._data._offset=="number"?[[a._data._offset,0]]:a._data._offset,startY:typeof a._data._startY=="number"?[[a._data._startY,0]]:a._data._startY}}}))}),delete t.difficulty.customData._customEvents;continue}if(r==="_environment"){t.difficulty.customData.environment=t.difficulty.customData._environment.map(a=>{let u={};if(a._lightID&&(u={ILightWithId:{lightID:a._lightID}}),a._id&&a._lookupMethod)return{id:a._id,lookupMethod:a._lookupMethod,track:a._track,duplicate:a._duplicate,active:a._active,scale:a._scale,position:Ee(a._position,.6),rotation:a._rotation,localPosition:Ee(a._localPosition,.6),localRotation:a._localRotation,components:u};if(a._geometry)return a._lightID&&u.ILightWithId&&(u.ILightWithId.type=0),{geometry:a._geometry._type==="CUSTOM"?{type:a._geometry._type,mesh:{vertices:a._geometry._mesh._vertices,uv:a._geometry._mesh._uv,triangles:a._geometry._mesh._triangles},material:typeof a._geometry._material=="string"?a._geometry._material:{shader:a._geometry._material._shader,shaderKeywords:a._geometry._material._shaderKeywords,collision:a._geometry._material._collision,track:a._geometry._material._track,color:a._geometry._material._color},collision:a._geometry._collision}:{type:a._geometry._type,material:typeof a._geometry._material=="string"?a._geometry._material:{shader:a._geometry._material._shader,shaderKeywords:a._geometry._material._shaderKeywords,collision:a._geometry._material._collision,track:a._geometry._material._track,color:a._geometry._material._color},collision:a._geometry._collision},track:a._track,duplicate:a._duplicate,active:a._active,scale:a._scale,position:Ee(a._position,.6),rotation:a._rotation,localPosition:Ee(a._localPosition,.6),localRotation:a._localRotation,components:u};throw new Error("Error converting environment v2 to v3")}),delete t.difficulty.customData._environment;continue}if(r==="_materials"){t.difficulty.customData.materials={};for(const a in t.difficulty.customData._materials)t.difficulty.customData.materials[a]={shader:t.difficulty.customData._materials[a]._shader,shaderKeywords:t.difficulty.customData._materials[a]._shaderKeywords,collision:t.difficulty.customData._materials[a]._collision,track:t.difficulty.customData._materials[a]._track,color:t.difficulty.customData._materials[a]._color};delete t.difficulty.customData._materials;continue}if(r==="_pointDefinitions"){t.difficulty.customData.pointDefinitions={},t.difficulty.customData._pointDefinitions.forEach(a=>{t.difficulty.customData.pointDefinitions[a._name]=a._points}),delete t.difficulty.customData._pointDefinitions;continue}if(r==="_time"){t.difficulty.customData.time=t.difficulty.customData[r],delete t.difficulty.customData._time;continue}if(r==="_BPMChanges"){t.difficulty.customData.BPMChanges=(o=t.difficulty.customData[r])==null?void 0:o.map(a=>({b:a._time,m:a._BPM,p:a._beatsPerBar,o:a._metronomeOffset})),delete t.difficulty.customData._BPMChanges;continue}if(r==="_bpmChanges"){t.difficulty.customData.BPMChanges=(l=t.difficulty.customData[r])==null?void 0:l.map(a=>({b:a._time,m:a._bpm,p:a._beatsPerBar,o:a._metronomeOffset})),delete t.difficulty.customData._bpmChanges;continue}if(r==="_bookmarks"){t.difficulty.customData.bookmarks=(s=t.difficulty.customData._bookmarks)==null?void 0:s.map(a=>({b:a._time,n:a._name,c:a._color})),delete t.difficulty.customData._bookmarks;continue}}if(t.difficulty.customData.environment){const r=[];for(const u of t.difficulty.customData.environment)u.track&&r.push(u.track);const a=[];if(t.difficulty.customData.customEvents){for(const u of t.difficulty.customData.customEvents)if(u.t==="AnimateTrack"){if(typeof u.d.track=="string"&&r.includes(u.d.track))a.push(u);else if(Array.isArray(u.d.track)){for(const f of u.d.track)if(r.includes(f)){a.push(u);break}}}}for(const u of a)typeof u.d.track=="string"?typeof u.d.position=="string"?J.tWarn(le("fromV2"),"Cannot convert point definitions, unknown use."):Array.isArray(u.d.position)&&(_c(u.d.position)?Ee(u.d.position,.6):u.d.position.forEach(f=>{typeof f!="string"&&(f[0]*=.6,f[1]*=.6,f[2]*=.6)})):J.tWarn(le("fromV2"),"Environment animate track array conversion not yet implemented.")}t.lightshow.useNormalEventsAsCompatibleEvents=!0}function ns(t){return["convert","toV4Audio",t]}function uf(t,e){switch(J.tWarn(ns("main"),"Converting to beatmap v4 may lose certain data!"),e){case 1:case 2:case 3:case 4:t.version=4;break;default:J.tWarn(ns("main"),"Unknown version: version not supported; misinput? Returning original data.")}return t}function hf(t){return["convert","toV4Beatmap",t]}function mf(t,e){return J.tWarn(hf("main"),"As v4 is similar to v3, the conversion will use v3 convertor for now."),t.version=4,pu(t,e)}function os(t){return["convert","toV4Info",t]}function ff(t,e){switch(J.tWarn(os("main"),"Converting to beatmap v4 may lose certain data!"),e){case 1:case 2:case 3:case 4:t.version=4;break;default:J.tWarn(os("main"),"Unknown version: version not supported; misinput? Returning original data.")}return t}class du extends Fo{constructor(){super(...arguments),this.tailTime=0,this.tailPosX=0,this.tailPosY=0,this.tailLaneRotation=0}setTailTime(e){return this.tailTime=e,this}setTailPosX(e){return this.tailPosX=e,this}setTailPosY(e){return this.tailPosY=e,this}setTailLaneRotation(e){return this.tailLaneRotation=e,this}mirror(e=!0,i){return i==null||i(this),this.tailPosX=Jn-1-this.tailPosX,super.mirror(e)}getTailPosition(e){return(e==null?void 0:e(this))??[this.tailPosX-2,this.tailPosY]}isInverse(){return this.time>this.tailTime}}class to extends ke{constructor(){super(...arguments),this.beatDistribution=0,this.beatDistributionType=1,this.easing=0,this.affectFirst=0}setFilter(e){return this.filter=e,this}setBeatDistribution(e){return this.beatDistribution=e,this}setBeatDistributionType(e){return this.beatDistributionType=e,this}setEasing(e){return this.easing=e,this}setAffectFirst(e){return this.affectFirst=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.beatDistributionType===1||this.beatDistributionType===2)&&this.easing>=-1&&this.easing<=103&&this.events.every(n=>typeof n=="number"||n.isValid())&&this.filter.isValid()}}class eo extends ve{constructor(){super(...arguments),this.id=0}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.id>=0&&this.boxes.every(n=>n.isValid())}}const Bt=class Bt extends du{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??Bt.defaultValue.time,this.posX=e.posX??Bt.defaultValue.posX,this.posY=e.posY??Bt.defaultValue.posY,this.color=e.color??Bt.defaultValue.color,this.direction=e.direction??Bt.defaultValue.direction,this.lengthMultiplier=e.lengthMultiplier??Bt.defaultValue.lengthMultiplier,this.tailTime=e.tailTime??Bt.defaultValue.tailTime,this.tailPosX=e.tailPosX??Bt.defaultValue.tailPosX,this.tailPosY=e.tailPosY??Bt.defaultValue.tailPosY,this.tailDirection=e.tailDirection??Bt.defaultValue.tailDirection,this.tailLengthMultiplier=e.tailLengthMultiplier??Bt.defaultValue.tailLengthMultiplier,this.midAnchor=e.midAnchor??Bt.defaultValue.midAnchor,this.laneRotation=e.laneRotation??Bt.defaultValue.laneRotation,this.tailLaneRotation=e.tailLaneRotation??Bt.defaultValue.tailLaneRotation,this.customData=j(e.customData??Bt.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&!(this.isInverse()||this.posX<0||this.posX>3||this.tailPosX<0||this.tailPosX>3||this.posX===this.tailPosX&&this.posY===this.tailPosY&&this.time===this.tailTime)}setLengthMultiplier(e){return this.lengthMultiplier=e,this}setTailLengthMultiplier(e){return this.tailLengthMultiplier=e,this}setTailDirection(e){return this.tailDirection=e,this}setMidAnchor(e){return this.midAnchor=e,this}mirror(e=!0,i){switch(i==null||i(this),this.tailDirection){case 2:this.tailDirection=3;break;case 3:this.tailDirection=2;break;case 6:this.tailDirection=7;break;case 7:this.tailDirection=6;break;case 4:this.tailDirection=5;break;case 5:this.tailDirection=4;break}return this.midAnchor&&(this.midAnchor=this.midAnchor===1?2:1),super.mirror(e)}getTailAngle(e){return(e==null?void 0:e(this))||ge[this.tailDirection]||0}};Bt.defaultValue={time:0,posX:0,posY:0,color:0,direction:0,lengthMultiplier:0,tailTime:0,tailPosX:0,tailPosY:0,tailDirection:0,tailLengthMultiplier:0,midAnchor:0,laneRotation:0,tailLaneRotation:0,customData:{}};let xn=Bt;const ue=class ue extends ke{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.version=e.version??ue.defaultValue.version,this.filename=e.filename??ue.defaultValue.filename,this.audioChecksum=e.audioChecksum??ue.defaultValue.audioChecksum,this.sampleCount=e.sampleCount??ue.defaultValue.sampleCount,this.frequency=e.frequency??ue.defaultValue.frequency,this.bpmData=(e.bpmData??ue.defaultValue.bpmData).map(i=>({startBeat:(i==null?void 0:i.startBeat)||0,startSampleIndex:(i==null?void 0:i.startSampleIndex)||0,endBeat:(i==null?void 0:i.endBeat)||0,endSampleIndex:(i==null?void 0:i.endSampleIndex)||0})),this.lufsData=(e.lufsData??ue.defaultValue.lufsData).map(i=>({startSampleIndex:(i==null?void 0:i.startSampleIndex)||0,endSampleIndex:(i==null?void 0:i.endSampleIndex)||0,lufs:(i==null?void 0:i.lufs)||0})),this.customData=j(e.customData??ue.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.frequency>=0&&this.sampleCount>=0&&this.bpmData.every(n=>n.endBeat>n.startBeat&&n.endSampleIndex>n.startSampleIndex)}setFilename(e){return this.filename=e,this}setSampleCount(e){return this.sampleCount=e,this}setFrequency(e){return this.frequency=e,this}fromBpmEvents(e,i=44100,n){if(!e.length)return this;this.frequency=i,n&&(this.sampleCount=n),this.bpmData=[];for(let a=0;a<e.length-1;a++){const u=e[a],f=e[a+1];this.bpmData.push({startSampleIndex:Math.floor(u.time*this.frequency),endSampleIndex:Math.floor(f.time*this.frequency),startBeat:u.time,endBeat:f.time})}const o=e[e.length-1],l=Math.floor(o.time*this.frequency),r=(this.sampleCount-l)/this.frequency*(o.bpm/60);return this.bpmData.push({startSampleIndex:l,endSampleIndex:this.sampleCount,startBeat:o.time,endBeat:o.time+r}),this}getBpmEvents(){return this.bpmData.map(e=>{const i=e.endSampleIndex-e.startSampleIndex,n=(e.endBeat-e.startBeat)/(i/this.frequency)*60;return{time:e.startBeat,bpm:n,customData:{}}})}sort(){return this.bpmData.sort((e,i)=>e.startBeat-i.startBeat),this}};ue.defaultValue={version:-1,filename:"AudioData.dat",audioChecksum:"",sampleCount:44100,frequency:0,bpmData:[],lufsData:[],customData:{}};let Eo=ue;const ki=class ki extends ve{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??ki.defaultValue.time,this.bpm=e.bpm??ki.defaultValue.bpm,this.customData=j(e.customData??ki.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.bpm>0}setBPM(e){return this.bpm=e,this}};ki.defaultValue={time:0,bpm:0,customData:{}};let Bn=ki;const oi=class oi extends ve{constructor(e={}){super(),this.executionTime=0,this.rotation=0,this.time=e.time??oi.defaultValue.time,this.executionTime=e.executionTime??oi.defaultValue.executionTime,this.rotation=e.rotation??oi.defaultValue.rotation,this.customData=j(e.customData??oi.defaultValue.customData)}static create(...e){return e.length?e.map(i=>new this(i)):[new this]}setExecutionTime(e){return this.executionTime=e,this}setRotation(e){return this.rotation=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.executionTime===0||this.executionTime===1)}};oi.defaultValue={time:0,executionTime:0,rotation:0,customData:{}};let In=oi;const Le=class Le extends Fo{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??Le.defaultValue.time,this.posX=e.posX??Le.defaultValue.posX,this.posY=e.posY??Le.defaultValue.posY,this.color=-1,this.direction=e.direction??Le.defaultValue.direction,this.laneRotation=e.laneRotation??Le.defaultValue.laneRotation,this.customData=j(e.customData??Le.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.posX>=0&&this.posX<=3&&this.posY>=0&&this.posY<=2}};Le.defaultValue={time:0,posX:0,posY:0,color:-1,direction:0,laneRotation:0,customData:{}};let Yi=Le;const he=class he extends Mo{constructor(e={}){super(),this.duration=0,this.width=0,this.height=0,this.time=e.time??he.defaultValue.time,this.posX=e.posX??he.defaultValue.posX,this.posY=e.posY??he.defaultValue.posY,this.width=e.width??he.defaultValue.width,this.height=e.height??he.defaultValue.height,this.duration=e.duration??he.defaultValue.duration,this.laneRotation=e.laneRotation??he.defaultValue.laneRotation,this.customData=j(e.customData??he.defaultValue.customData)}static create(...e){return e.length?e.map(i=>new this(i)):[new this]}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&!this.hasZero()&&!this.hasNegative()}setDuration(e){return this.duration=e,this}setWidth(e){return this.width=e,this}setHeight(e){return this.height=e,this}mirror(e,i){return i==null||i(this),this.posX=Jn-1-(this.posX+this.width-1),this}getPosition(e){return(e==null?void 0:e(this))??[this.posX-2,this.posY-.5]}isInteractive(){return this.posX<0&&this.width>1-this.posX||this.posX===0&&this.width>1||this.posX===1||this.posX===2}isLonger(e,i=0){return this.time+this.duration>e.time+e.duration+i}hasZero(){return this.duration===0||this.width===0||this.height===0}hasNegative(){return this.posY<0||this.duration<0||this.width<0||this.height<0}};he.defaultValue={time:0,posX:0,posY:0,width:0,height:0,duration:0,laneRotation:0,customData:{}};let De=he;const Mt=class Mt extends du{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??Mt.defaultValue.time,this.posX=e.posX??Mt.defaultValue.posX,this.posY=e.posY??Mt.defaultValue.posY,this.color=e.color??Mt.defaultValue.color,this.direction=e.direction??Mt.defaultValue.direction,this.laneRotation=e.laneRotation??Mt.defaultValue.laneRotation,this.tailTime=e.tailTime??Mt.defaultValue.tailTime,this.tailPosX=e.tailPosX??Mt.defaultValue.tailPosX,this.tailPosY=e.tailPosY??Mt.defaultValue.tailPosY,this.tailLaneRotation=e.tailLaneRotation??Mt.defaultValue.tailLaneRotation,this.sliceCount=e.sliceCount??Mt.defaultValue.sliceCount,this.squish=e.squish??Mt.defaultValue.squish,this.customData=j(e.customData??Mt.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(!this.isInverse()||this.posY>=0||this.posY<=2||this.tailPosY>=0||this.tailPosY<=2)}setSliceCount(e){return this.sliceCount=e,this}setSquish(e){return this.squish=e,this}};Mt.defaultValue={time:0,posX:0,posY:0,color:0,direction:0,laneRotation:0,tailTime:0,tailPosX:0,tailPosY:0,tailLaneRotation:0,sliceCount:0,squish:0,customData:{}};let Nn=Mt;const me=class me extends ke{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.bpmEvents=(e.bpmEvents??me.defaultValue.bpmEvents).map(i=>new Bn(i)),this.rotationEvents=(e.rotationEvents??me.defaultValue.rotationEvents).map(i=>new In(i)),this.colorNotes=(e.colorNotes??me.defaultValue.colorNotes).map(i=>new bi(i)),this.bombNotes=(e.bombNotes??me.defaultValue.bombNotes).map(i=>new Yi(i)),this.obstacles=(e.obstacles??me.defaultValue.obstacles).map(i=>new De(i)),this.arcs=(e.arcs??me.defaultValue.arcs).map(i=>new xn(i)),this.chains=(e.chains??me.defaultValue.chains).map(i=>new Nn(i)),this.customData=j(e.customData??me.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.bpmEvents.every(n=>n.isValid())&&this.rotationEvents.every(n=>n.isValid())&&this.colorNotes.every(n=>n.isValid())&&this.bombNotes.every(n=>n.isValid())&&this.obstacles.every(n=>n.isValid())&&this.arcs.every(n=>n.isValid())&&this.chains.every(n=>n.isValid())}sort(){return this.bpmEvents.sort(zt),this.rotationEvents.sort(zt),this.colorNotes.sort(qe),this.bombNotes.sort(qe),this.obstacles.sort(zt),this.arcs.sort(qe),this.chains.sort(qe),this}addBpmEvents(...e){for(const i of e)this.bpmEvents.push(new Bn(i));return this}addRotationEvents(...e){for(const i of e)this.rotationEvents.push(new In(i));return this}addColorNotes(...e){for(const i of e)this.colorNotes.push(new bi(i));return this}addBombNotes(...e){for(const i of e)this.bombNotes.push(new Yi(i));return this}addObstacles(...e){for(const i of e)this.obstacles.push(new De(i));return this}addArcs(...e){for(const i of e)this.arcs.push(new xn(i));return this}addChains(...e){for(const i of e)this.chains.push(new Nn(i));return this}};me.defaultValue={bpmEvents:[],rotationEvents:[],colorNotes:[],bombNotes:[],obstacles:[],arcs:[],chains:[],customData:{}};let Do=me;const Re=class Re extends Mo{constructor(e={}){super(),this.direction=0,this.time=e.time??Re.defaultValue.time,this.posX=e.posX??Re.defaultValue.posX,this.posY=e.posY??Re.defaultValue.posY,this.direction=e.direction??Re.defaultValue.direction,this.laneRotation=e.laneRotation??Re.defaultValue.laneRotation,this.customData=j(e.customData??Re.defaultValue.customData)}static create(...e){return e.length?e.map(i=>new this(i)):[new this]}setDirection(e){return this.direction=e,this}mirror(e,i){switch(i==null||i(this),this.posX=Jn-1-this.posX,this.direction){case 2:this.direction=3;break;case 3:this.direction=2;break;case 6:this.direction=7;break;case 7:this.direction=6;break;case 4:this.direction=5;break;case 5:this.direction=4;break}return this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.direction>=0&&this.direction<=9&&this.direction!==8}};Re.defaultValue={time:0,posX:0,posY:0,direction:0,laneRotation:0,customData:{}};let An=Re;const Ti=class Ti extends ve{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??Ti.defaultValue.time,this.toggle=e.toggle??Ti.defaultValue.toggle,this.customData=j(e.customData??Ti.defaultValue.customData)}setToggle(e){return this.toggle=e,this}};Ti.defaultValue={time:0,toggle:!1,customData:{}};let On=Ti;const jt=class jt extends ke{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.type=e.type??jt.defaultValue.type,this.p0=e.p0??jt.defaultValue.p0,this.p1=e.p1??jt.defaultValue.p1,this.reverse=e.reverse??jt.defaultValue.reverse,this.chunks=e.chunks??jt.defaultValue.chunks,this.random=e.random??jt.defaultValue.random,this.seed=e.seed??jt.defaultValue.seed,this.limit=e.limit??jt.defaultValue.limit,this.limitAffectsType=e.limitAffectsType??jt.defaultValue.limitAffectsType,this.customData=j(e.customData??jt.defaultValue.customData)}setType(e){return this.type=e,this}setP0(e){return this.p0=e,this}setP1(e){return this.p1=e,this}setReverse(e){return this.reverse=e,this}setChunks(e){return this.chunks=e,this}setRandom(e){return this.random=e,this}setSeed(e){return this.seed=e,this}setLimit(e){return this.limit=e,this}setLimitAffectsType(e){return this.limitAffectsType=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.type===1||this.type===2)&&this.p0>=0&&this.p1>=0&&(this.reverse===0||this.reverse===1)&&this.chunks>=0&&this.random>=0&&this.random<=lu.ALL&&this.limit>=0&&this.limit<=1&&this.limitAffectsType>=0&&this.limitAffectsType<=au.ALL}};jt.defaultValue={type:1,p0:0,p1:0,reverse:0,chunks:0,random:0,seed:0,limit:0,limitAffectsType:0,customData:{}};let xi=jt;const Zt=class Zt extends ve{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??Zt.defaultValue.time,this.previous=e.previous??Zt.defaultValue.previous,this.color=e.color??Zt.defaultValue.color,this.frequency=e.frequency??Zt.defaultValue.frequency,this.brightness=e.brightness??Zt.defaultValue.brightness,this.strobeBrightness=e.strobeBrightness??Zt.defaultValue.strobeBrightness,this.strobeFade=e.strobeFade??Zt.defaultValue.strobeFade,this.easing=e.easing??Zt.defaultValue.easing,this.customData=j(e.customData??Zt.defaultValue.customData)}setPrevious(e){return this.previous=e,this}setColor(e){return this.color=e,this}setBrightness(e){return this.brightness=e,this}setFrequency(e){return this.frequency=e,this}setStrobeBrightness(e){return this.strobeBrightness=e,this}setStrobeFade(e){return this.strobeFade=e,this}setEasing(e){return this.easing=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=103&&this.color>=-1&&this.color<=2&&this.brightness>=0&&this.frequency>=0}};Zt.defaultValue={time:0,previous:0,color:0,frequency:0,brightness:0,strobeBrightness:0,strobeFade:0,easing:0,customData:{}};let Co=Zt;const Jt=class Jt extends to{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.filter=new xi(e.filter??Jt.defaultValue.filter),this.beatDistribution=e.beatDistribution??Jt.defaultValue.beatDistribution,this.beatDistributionType=e.beatDistributionType??Jt.defaultValue.beatDistributionType,this.brightnessDistribution=e.brightnessDistribution??Jt.defaultValue.brightnessDistribution,this.brightnessDistributionType=e.brightnessDistributionType??Jt.defaultValue.brightnessDistributionType,this.affectFirst=e.affectFirst??Jt.defaultValue.affectFirst,this.easing=e.easing??Jt.defaultValue.easing,this.events=(e.events??Jt.defaultValue.events).map(i=>new Co(i)),this.customData=j(e.customData??Jt.defaultValue.customData)}setBrightnessDistribution(e){return this.brightnessDistribution=e,this}setBrightnessDistributionType(e){return this.brightnessDistributionType=e,this}setEvents(e){return this.events=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.brightnessDistributionType===1||this.brightnessDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}};Jt.defaultValue={filter:{type:1,p0:0,p1:0,reverse:0,chunks:0,random:0,seed:0,limit:0,limitAffectsType:0,customData:{}},beatDistribution:0,beatDistributionType:1,brightnessDistribution:0,brightnessDistributionType:1,affectFirst:0,easing:0,events:[],customData:{}};let So=Jt;const ri=class ri extends eo{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??ri.defaultValue.time,this.id=e.id??ri.defaultValue.id,this.boxes=(e.boxes??ri.defaultValue.boxes).map(i=>new So(i)),this.customData=j(e.customData??ri.defaultValue.customData)}};ri.defaultValue={time:0,id:0,boxes:[],customData:{}};let $n=ri;const ye=class ye extends ve{constructor(e={}){super(),this.previous=0,this.easing=0,this.loop=0,this.rotation=0,this.direction=0,this.time=e.time??ye.defaultValue.time,this.easing=e.easing??ye.defaultValue.easing,this.loop=e.loop??ye.defaultValue.loop,this.direction=e.direction??ye.defaultValue.direction,this.previous=e.previous??ye.defaultValue.previous,this.rotation=e.rotation??ye.defaultValue.rotation,this.customData=j(e.customData??ye.defaultValue.customData)}static create(...e){return e.length?e.map(i=>new this(i)):[new this]}setPrevious(e){return this.previous=e,this}setEasing(e){return this.easing=e,this}setLoop(e){return this.loop=e,this}setRotation(e){return this.rotation=e,this}setDirection(e){return this.direction=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=103&&this.loop>=0&&this.direction>=0&&this.direction<=2}};ye.defaultValue={time:0,easing:0,loop:0,direction:0,previous:0,rotation:0,customData:{}};let wo=ye;const Vt=class Vt extends to{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.filter=new xi(e.filter??Vt.defaultValue.filter),this.axis=e.axis??Vt.defaultValue.axis,this.flip=e.flip??Vt.defaultValue.flip,this.beatDistribution=e.beatDistribution??Vt.defaultValue.beatDistribution,this.beatDistributionType=e.beatDistributionType??Vt.defaultValue.beatDistributionType,this.rotationDistribution=e.rotationDistribution??Vt.defaultValue.rotationDistribution,this.rotationDistributionType=e.rotationDistributionType??Vt.defaultValue.rotationDistributionType,this.affectFirst=e.affectFirst??Vt.defaultValue.affectFirst,this.easing=e.easing??Vt.defaultValue.easing,this.events=(e.events??Vt.defaultValue.events).map(i=>new wo(i)),this.customData=j(e.customData??Vt.defaultValue.customData)}setRotationDistribution(e){return this.rotationDistribution=e,this}setRotationDistributionType(e){return this.rotationDistributionType=e,this}setAxis(e){return this.axis=e,this}setFlip(e){return this.flip=e,this}setEvents(e){return this.events=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.rotationDistributionType===1||this.rotationDistributionType===2)&&(this.axis===0||this.axis===1||this.axis===2)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}};Vt.defaultValue={filter:{type:1,p0:0,p1:0,reverse:0,chunks:0,random:0,seed:0,limit:0,limitAffectsType:0,customData:{}},axis:0,flip:0,beatDistribution:0,beatDistributionType:1,rotationDistribution:0,rotationDistributionType:1,affectFirst:0,easing:0,events:[],customData:{}};let ko=Vt;const si=class si extends eo{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??si.defaultValue.time,this.id=e.id??si.defaultValue.id,this.boxes=(e.boxes??si.defaultValue.boxes).map(i=>new ko(i)),this.customData=j(e.customData??si.defaultValue.customData)}};si.defaultValue={time:0,id:0,boxes:[],customData:{}};let Pn=si;const je=class je extends ve{constructor(e={}){super(),this.previous=0,this.easing=0,this.translation=0,this.time=e.time??je.defaultValue.time,this.easing=e.easing??je.defaultValue.easing,this.previous=e.previous??je.defaultValue.previous,this.translation=e.translation??je.defaultValue.translation,this.customData=j(e.customData??je.defaultValue.customData)}static create(...e){return e.length?e.map(i=>new this(i)):[new this]}setPrevious(e){return this.previous=e,this}setEasing(e){return this.easing=e,this}setTranslation(e){return this.translation=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=103}};je.defaultValue={time:0,easing:0,previous:0,translation:0,customData:{}};let To=je;const Gt=class Gt extends to{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.filter=new xi(e.filter??Gt.defaultValue.filter),this.axis=e.axis??Gt.defaultValue.axis,this.flip=e.flip??Gt.defaultValue.flip,this.beatDistribution=e.beatDistribution??Gt.defaultValue.beatDistribution,this.beatDistributionType=e.beatDistributionType??Gt.defaultValue.beatDistributionType,this.gapDistribution=e.gapDistribution??Gt.defaultValue.gapDistribution,this.gapDistributionType=e.gapDistributionType??Gt.defaultValue.gapDistributionType,this.affectFirst=e.affectFirst??Gt.defaultValue.affectFirst,this.easing=e.easing??Gt.defaultValue.easing,this.events=(e.events??Gt.defaultValue.events).map(i=>new To(i)),this.customData=j(e.customData??Gt.defaultValue.customData)}setGapDistribution(e){return this.gapDistribution=e,this}setGapDistributionType(e){return this.gapDistributionType=e,this}setAxis(e){return this.axis=e,this}setFlip(e){return this.flip=e,this}setEvents(e){return this.events=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.gapDistributionType===1||this.gapDistributionType===2)&&(this.axis===0||this.axis===1||this.axis===2)&&(this.flip===0||this.flip===1)&&(this.affectFirst===0||this.affectFirst===1)}};Gt.defaultValue={filter:{type:1,p0:0,p1:0,reverse:0,chunks:0,random:0,seed:0,limit:0,limitAffectsType:0,customData:{}},axis:0,flip:0,beatDistribution:0,beatDistributionType:1,gapDistribution:0,gapDistributionType:1,affectFirst:0,easing:0,events:[],customData:{}};let Lo=Gt;const ai=class ai extends eo{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??ai.defaultValue.time,this.id=e.id??ai.defaultValue.id,this.boxes=(e.boxes??ai.defaultValue.boxes).map(i=>new Lo(i)),this.customData=j(e.customData??ai.defaultValue.customData)}};ai.defaultValue={time:0,id:0,boxes:[],customData:{}};let Mn=ai;const We=class We extends ve{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??We.defaultValue.time,this.easing=e.easing??We.defaultValue.easing,this.previous=e.previous??We.defaultValue.previous,this.value=e.value??We.defaultValue.value,this.customData=j(e.customData??We.defaultValue.customData)}setEasing(e){return this.easing=e,this}setPrevious(e){return this.previous=e,this}setValue(e){return this.value=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.previous===0||this.previous===1)&&this.easing>=-1&&this.easing<=103}};We.defaultValue={time:0,easing:0,previous:0,value:0,customData:{}};let Ro=We;const Qt=class Qt extends to{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.filter=new xi(e.filter??Qt.defaultValue.filter),this.beatDistribution=e.beatDistribution??Qt.defaultValue.beatDistribution,this.beatDistributionType=e.beatDistributionType??Qt.defaultValue.beatDistributionType,this.fxDistribution=e.fxDistribution??Qt.defaultValue.fxDistribution,this.fxDistributionType=e.fxDistributionType??Qt.defaultValue.fxDistributionType,this.affectFirst=e.affectFirst??Qt.defaultValue.affectFirst,this.easing=e.easing??Qt.defaultValue.easing,this.events=(e.events??Qt.defaultValue.events).map(i=>new Ro(i)),this.customData=j(e.customData??Qt.defaultValue.customData)}setFxDistribution(e){return this.fxDistribution=e,this}setFxDistributionType(e){return this.fxDistributionType=e,this}setEvents(e){return this.events=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.fxDistributionType===1||this.fxDistributionType===2)&&(this.affectFirst===0||this.affectFirst===1)}};Qt.defaultValue={filter:{type:1,p0:0,p1:0,reverse:0,chunks:0,random:0,seed:0,limit:0,limitAffectsType:0,customData:{}},beatDistribution:0,beatDistributionType:1,fxDistribution:0,fxDistributionType:1,affectFirst:0,easing:0,events:[],customData:{}};let xo=Qt;const li=class li extends eo{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.time=e.time??li.defaultValue.time,this.id=e.id??li.defaultValue.id,this.boxes=(e.boxes??li.defaultValue.boxes).map(i=>new xo(i)),this.customData=j(e.customData??li.defaultValue.customData)}};li.defaultValue={time:0,id:0,boxes:[],customData:{}};let Fn=li;const Li=class Li extends ke{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.keyword=e.keyword??Li.defaultValue.keyword,this.events=(e.events??Li.defaultValue.events).map(i=>i).filter(i=>i),this.customData=j(e.customData??Li.defaultValue.customData)}setKeyword(e){return this.keyword=e,this}setEvents(e){return this.events=e,this}addEvent(e){return this.events.push(e),this}removeEvent(e){const i=this.events.indexOf(e,0);return i>-1&&this.events.splice(i,1),this}};Li.defaultValue={keyword:"",events:[],customData:{}};let Bo=Li;const te=class te extends ke{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){var i;super(),this.waypoints=(e.waypoints??te.defaultValue.waypoints).map(n=>new An(n)),this.basicEvents=(e.basicEvents??te.defaultValue.basicEvents).map(n=>new Rn(n)),this.colorBoostEvents=(e.colorBoostEvents??te.defaultValue.colorBoostEvents).map(n=>new On(n)),this.lightColorEventBoxGroups=(e.lightColorEventBoxGroups??te.defaultValue.lightColorEventBoxGroups).map(n=>new $n(n)),this.lightRotationEventBoxGroups=(e.lightRotationEventBoxGroups??te.defaultValue.lightRotationEventBoxGroups).map(n=>new Pn(n)),this.lightTranslationEventBoxGroups=(e.lightTranslationEventBoxGroups??te.defaultValue.lightTranslationEventBoxGroups).map(n=>new Mn(n)),this.fxEventBoxGroups=(e.fxEventBoxGroups??te.defaultValue.fxEventBoxGroups).map(n=>new Fn(n)),this.eventTypesWithKeywords={list:(((i=e.eventTypesWithKeywords)==null?void 0:i.list)??te.defaultValue.eventTypesWithKeywords.list).map(n=>new Bo(n))},this.useNormalEventsAsCompatibleEvents=!!e.useNormalEventsAsCompatibleEvents,this.customData=j(e.customData??te.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.waypoints.every(n=>n.isValid())&&this.basicEvents.every(n=>n.isValid())&&this.colorBoostEvents.every(n=>n.isValid())&&this.lightColorEventBoxGroups.every(n=>n.isValid())&&this.lightRotationEventBoxGroups.every(n=>n.isValid())&&this.lightTranslationEventBoxGroups.every(n=>n.isValid())&&this.fxEventBoxGroups.every(n=>n.isValid())&&this.eventTypesWithKeywords.list.every(n=>n.isValid())}sort(){return this.waypoints.sort(zt),this.basicEvents.sort(zt),this.colorBoostEvents.sort(zt),this.lightColorEventBoxGroups.sort(zt),this.lightRotationEventBoxGroups.sort(zt),this.lightTranslationEventBoxGroups.sort(zt),this.fxEventBoxGroups.sort(zt),this.lightColorEventBoxGroups.forEach(e=>e.boxes.forEach(i=>i.events.sort(zt))),this.lightRotationEventBoxGroups.forEach(e=>e.boxes.forEach(i=>i.events.sort(zt))),this.lightTranslationEventBoxGroups.forEach(e=>e.boxes.forEach(i=>i.events.sort(zt))),this.fxEventBoxGroups.forEach(e=>e.boxes.forEach(i=>i.events.sort(zt))),this}addWaypoints(...e){for(const i of e)this.waypoints.push(new An(i));return this}addBasicEvents(...e){for(const i of e)this.basicEvents.push(new Rn(i));return this}addColorBoostEvents(...e){for(const i of e)this.colorBoostEvents.push(new On(i));return this}addLightColorEventBoxGroups(...e){for(const i of e)this.lightColorEventBoxGroups.push(new $n(i));return this}addLightRotationEventBoxGroups(...e){for(const i of e)this.lightRotationEventBoxGroups.push(new Pn(i));return this}addLightTranslationEventBoxGroups(...e){for(const i of e)this.lightTranslationEventBoxGroups.push(new Mn(i));return this}addFxEventBoxGroups(...e){for(const i of e)this.fxEventBoxGroups.push(new Fn(i));return this}};te.defaultValue={waypoints:[],basicEvents:[],colorBoostEvents:[],lightColorEventBoxGroups:[],lightRotationEventBoxGroups:[],lightTranslationEventBoxGroups:[],fxEventBoxGroups:[],eventTypesWithKeywords:{list:[]},useNormalEventsAsCompatibleEvents:!1,customData:{}};let Io=te;const Xe=class Xe extends ke{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){super(),this.version=e.version??Xe.defaultValue.version,this.filename=e.filename??Xe.defaultValue.filename,this.lightshowFilename=e.lightshowFilename??Xe.defaultValue.lightshowFilename,this.difficulty=new Do(e.difficulty??Xe.defaultValue.difficulty),this.lightshow=new Io(e.lightshow??Xe.defaultValue.lightshow)}isValid(e,i){return super.isValid(e)}get bpmEvents(){return this.difficulty.bpmEvents}set bpmEvents(e){this.difficulty.bpmEvents=e}get rotationEvents(){return this.difficulty.rotationEvents}set rotationEvents(e){this.difficulty.rotationEvents=e}get colorNotes(){return this.difficulty.colorNotes}set colorNotes(e){this.difficulty.colorNotes=e}get bombNotes(){return this.difficulty.bombNotes}set bombNotes(e){this.difficulty.bombNotes=e}get obstacles(){return this.difficulty.obstacles}set obstacles(e){this.difficulty.obstacles=e}get arcs(){return this.difficulty.arcs}set arcs(e){this.difficulty.arcs=e}get chains(){return this.difficulty.chains}set chains(e){this.difficulty.chains=e}get waypoints(){return this.lightshow.waypoints}set waypoints(e){this.lightshow.waypoints=e}get basicEvents(){return this.lightshow.basicEvents}set basicEvents(e){this.lightshow.basicEvents=e}get colorBoostEvents(){return this.lightshow.colorBoostEvents}set colorBoostEvents(e){this.lightshow.colorBoostEvents=e}get lightColorEventBoxGroups(){return this.lightshow.lightColorEventBoxGroups}set lightColorEventBoxGroups(e){this.lightshow.lightColorEventBoxGroups=e}get lightRotationEventBoxGroups(){return this.lightshow.lightRotationEventBoxGroups}set lightRotationEventBoxGroups(e){this.lightshow.lightRotationEventBoxGroups=e}get lightTranslationEventBoxGroups(){return this.lightshow.lightTranslationEventBoxGroups}set lightTranslationEventBoxGroups(e){this.lightshow.lightTranslationEventBoxGroups=e}get fxEventBoxGroups(){return this.lightshow.fxEventBoxGroups}set fxEventBoxGroups(e){this.lightshow.fxEventBoxGroups=e}get eventTypesWithKeywords(){return this.lightshow.eventTypesWithKeywords}set eventTypesWithKeywords(e){this.lightshow.eventTypesWithKeywords=e}get useNormalEventsAsCompatibleEvents(){return this.lightshow.useNormalEventsAsCompatibleEvents}set useNormalEventsAsCompatibleEvents(e){this.lightshow.useNormalEventsAsCompatibleEvents=e}setLightshowFilename(e){return this.lightshowFilename=e,this}setFilename(e){return this.filename=e,this}sort(e){return this.difficulty.sort(),this.lightshow.sort(),super.sort(e)}addBpmEvents(...e){return this.difficulty.addBpmEvents(...e),this}addRotationEvents(...e){return this.difficulty.addRotationEvents(...e),this}addColorNotes(...e){return this.difficulty.addColorNotes(...e),this}addBombNotes(...e){return this.difficulty.addBombNotes(...e),this}addObstacles(...e){return this.difficulty.addObstacles(...e),this}addArcs(...e){return this.difficulty.addArcs(...e),this}addChains(...e){return this.difficulty.addChains(...e),this}addWaypoints(...e){return this.lightshow.addWaypoints(...e),this}addBasicEvents(...e){return this.lightshow.addBasicEvents(...e),this}addColorBoostEvents(...e){return this.lightshow.addColorBoostEvents(...e),this}addLightColorEventBoxGroups(...e){return this.lightshow.addLightColorEventBoxGroups(...e),this}addLightRotationEventBoxGroups(...e){return this.lightshow.addLightRotationEventBoxGroups(...e),this}addLightTranslationEventBoxGroups(...e){return this.lightshow.addLightTranslationEventBoxGroups(...e),this}addFxEventBoxGroups(...e){return this.lightshow.addFxEventBoxGroups(...e),this}};Xe.defaultValue={version:-1,filename:"Unnamed.beatmap.dat",lightshowFilename:"Unnamed.lightshow.dat",customData:{},difficulty:{bpmEvents:[],rotationEvents:[],colorNotes:[],bombNotes:[],obstacles:[],arcs:[],chains:[],customData:{}},lightshow:{waypoints:[],basicEvents:[],colorBoostEvents:[],lightColorEventBoxGroups:[],lightRotationEventBoxGroups:[],lightTranslationEventBoxGroups:[],fxEventBoxGroups:[],eventTypesWithKeywords:{list:[]},useNormalEventsAsCompatibleEvents:!1,customData:{}}};let qi=Xe;const ci=class ci extends ve{constructor(e={}){super(),this.previous=0,this.value=0,this.time=e.time??ci.defaultValue.time,this.previous=e.previous??ci.defaultValue.previous,this.value=e.value??ci.defaultValue.value,this.customData=j(e.customData??ci.defaultValue.customData)}static create(...e){return e.length?e.map(i=>new this(i)):[new this]}setPrevious(e){return this.previous=e,this}setValue(e){return this.value=e,this}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&(this.previous===0||this.previous===1)}};ci.defaultValue={time:0,previous:0,value:0,customData:{}};let rs=ci;const ss={Standard:"Standard",NoArrows:"No Arrows",OneSaber:"One Saber",Legacy:"Legacy","360Degree":"360 Degree","90Degree":"90 Degree",Lightshow:"Lightshow",Lawless:"Lawless"},as={Standard:0,NoArrows:1,OneSaber:2,Legacy:3,"360Degree":4,"90Degree":5,Lightshow:6,Lawless:7},Tt=class Tt extends ke{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){var i,n,o,l,s,r,a,u,f,m,h,c,g;super(),this.version=e.version??Tt.defaultValue.version,this.filename=e.filename??Tt.defaultValue.filename,this.song={title:((i=e.song)==null?void 0:i.title)??Tt.defaultValue.song.title,subTitle:((n=e.song)==null?void 0:n.subTitle)??Tt.defaultValue.song.subTitle,author:((o=e.song)==null?void 0:o.author)??Tt.defaultValue.song.author},this.audio={filename:((l=e.audio)==null?void 0:l.filename)??Tt.defaultValue.audio.filename,duration:((s=e.audio)==null?void 0:s.duration)??Tt.defaultValue.audio.duration,audioDataFilename:((r=e.audio)==null?void 0:r.audioDataFilename)??Tt.defaultValue.audio.audioDataFilename,bpm:((a=e.audio)==null?void 0:a.bpm)??Tt.defaultValue.audio.bpm,lufs:((u=e.audio)==null?void 0:u.lufs)??Tt.defaultValue.audio.lufs,previewStartTime:((f=e.audio)==null?void 0:f.previewStartTime)??Tt.defaultValue.audio.previewStartTime,previewDuration:((m=e.audio)==null?void 0:m.previewDuration)??Tt.defaultValue.audio.previewDuration,audioOffset:((h=e.audio)==null?void 0:h.audioOffset)??Tt.defaultValue.audio.audioOffset,shuffle:((c=e.audio)==null?void 0:c.shuffle)??Tt.defaultValue.audio.shuffle,shufflePeriod:((g=e.audio)==null?void 0:g.shufflePeriod)??Tt.defaultValue.audio.shufflePeriod},this.songPreviewFilename=e.songPreviewFilename??Tt.defaultValue.songPreviewFilename,this.coverImageFilename=e.coverImageFilename??Tt.defaultValue.coverImageFilename,this.environmentNames=(e.environmentNames??Tt.defaultValue.environmentNames).map(d=>d),this.colorSchemes=(e.colorSchemes??Tt.defaultValue.colorSchemes).map(d=>{var v,_,y,S,w,k,O,P,G,I,W,et,C,$,b,z,lt,U,ut,X,st,N,x,it,Q,Z,Et,Lt,ft,vt,wt,Dt,Pt,Nt,p,F;return{useOverride:d.useOverride||!1,name:d.name||"",saberLeftColor:{r:((v=d.saberLeftColor)==null?void 0:v.r)||0,g:((_=d.saberLeftColor)==null?void 0:_.g)||0,b:((y=d.saberLeftColor)==null?void 0:y.b)||0,a:((S=d.saberLeftColor)==null?void 0:S.a)||0},saberRightColor:{r:((w=d.saberRightColor)==null?void 0:w.r)||0,g:((k=d.saberRightColor)==null?void 0:k.g)||0,b:((O=d.saberRightColor)==null?void 0:O.b)||0,a:((P=d.saberRightColor)==null?void 0:P.a)||0},environment0Color:{r:((G=d.environment0Color)==null?void 0:G.r)||0,g:((I=d.environment0Color)==null?void 0:I.g)||0,b:((W=d.environment0Color)==null?void 0:W.b)||0,a:((et=d.environment0Color)==null?void 0:et.a)||0},environment1Color:{r:((C=d.environment1Color)==null?void 0:C.r)||0,g:(($=d.environment1Color)==null?void 0:$.g)||0,b:((b=d.environment1Color)==null?void 0:b.b)||0,a:((z=d.environment1Color)==null?void 0:z.a)||0},environmentWColor:{r:((lt=d.environmentWColor)==null?void 0:lt.r)||0,g:((U=d.environmentWColor)==null?void 0:U.g)||0,b:((ut=d.environmentWColor)==null?void 0:ut.b)||0,a:((X=d.environmentWColor)==null?void 0:X.a)||0},environment0ColorBoost:{r:((st=d.environment0ColorBoost)==null?void 0:st.r)||0,g:((N=d.environment0ColorBoost)==null?void 0:N.g)||0,b:((x=d.environment0ColorBoost)==null?void 0:x.b)||0,a:((it=d.environment0ColorBoost)==null?void 0:it.a)||0},environment1ColorBoost:{r:((Q=d.environment1ColorBoost)==null?void 0:Q.r)||0,g:((Z=d.environment1ColorBoost)==null?void 0:Z.g)||0,b:((Et=d.environment1ColorBoost)==null?void 0:Et.b)||0,a:((Lt=d.environment1ColorBoost)==null?void 0:Lt.a)||0},environmentWColorBoost:{r:((ft=d.environmentWColorBoost)==null?void 0:ft.r)||0,g:((vt=d.environmentWColorBoost)==null?void 0:vt.g)||0,b:((wt=d.environmentWColorBoost)==null?void 0:wt.b)||0,a:((Dt=d.environmentWColorBoost)==null?void 0:Dt.a)||0},obstaclesColor:{r:((Pt=d.obstaclesColor)==null?void 0:Pt.r)||0,g:((Nt=d.obstaclesColor)==null?void 0:Nt.g)||0,b:((p=d.obstaclesColor)==null?void 0:p.b)||0,a:((F=d.obstaclesColor)==null?void 0:F.a)||0}}}),this.difficulties=(e.difficulties??Tt.defaultValue.difficulties).map(d=>new zn(d)),this.customData=j(e.customData??Tt.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.audio.filename!==""&&this.audio.duration>0&&this.audio.previewDuration>0&&this.audio.previewStartTime>0&&this.audio.audioOffset>=0&&this.difficulties.every(n=>n.isValid())}clone(){return super.clone().setFilename(this.filename)}setFilename(e){return this.filename=e,this}sort(){return this.difficulties.sort((e,i)=>Ln[e.difficulty]-Ln[i.difficulty]).sort((e,i)=>(as[e.characteristic]||0)-(as[i.characteristic]||0)),this}addMap(e){return this.difficulties.push(new zn(e)),this}};Tt.defaultValue={version:-1,filename:"Info.dat",song:{title:"Untitled",subTitle:"",author:"NoAuthor"},audio:{filename:"",duration:0,audioDataFilename:"",bpm:0,lufs:0,previewStartTime:0,previewDuration:0,audioOffset:0,shuffle:0,shufflePeriod:.5},songPreviewFilename:"",coverImageFilename:"",environmentNames:[],colorSchemes:[],difficulties:[],customData:{}};let No=Tt;const Ht=class Ht extends ke{static create(...e){return e.length?e.map(i=>new this(i)):[new this]}constructor(e={}){var i,n;super(),this.characteristic=e.characteristic??Ht.defaultValue.characteristic,this.difficulty=e.difficulty??Ht.defaultValue.difficulty,this.filename=e.filename??Ht.defaultValue.filename,this.lightshowFilename=e.lightshowFilename??Ht.defaultValue.lightshowFilename,this.authors={mappers:(((i=e.authors)==null?void 0:i.mappers)??Ht.defaultValue.authors.mappers).map(o=>o),lighters:(((n=e.authors)==null?void 0:n.lighters)??Ht.defaultValue.authors.lighters).map(o=>o)},this.njs=e.njs??Ht.defaultValue.njs,this.njsOffset=e.njsOffset??Ht.defaultValue.njsOffset,this.colorSchemeId=e.colorSchemeId??Ht.defaultValue.colorSchemeId,this.environmentId=e.environmentId??Ht.defaultValue.environmentId,this.customData=j(e.customData??Ht.defaultValue.customData)}isValid(e,i){return i?super.isValid(e,i):super.isValid(e,i)&&this.njs>0&&this.colorSchemeId>=-1&&this.environmentId>=0}};Ht.defaultValue={characteristic:"Standard",difficulty:"Easy",filename:"Unnamed.beatmap.dat",lightshowFilename:"Unnamed.lightshow.dat",authors:{mappers:[],lighters:[]},njs:10,njsOffset:0,colorSchemeId:-1,environmentId:0,customData:{}};let zn=Ht;function gu(t){switch(t){case"info":case"difficulty":return"2.0.0";case"lightshow":return"3.0.0";default:return"4.0.0"}}function bu(t){const e=t._version??t.version;return typeof e!="string"?null:e}function pf(t,e){const i=ls(t),n=ls(e);for(const o in i){if(i[o]<n[o])return-1;if(i[o]>n[o])return 1}return 0}function ls(t){return t.split(".").map(e=>parseInt(e))}const df={1:ef,2:sf,4:ff},gf={2:nf,4:uf},cs={1:Jm,2:rf,3:pu,4:mf},us={serialize(t){return{difficulty:t.difficulty,difficultyRank:Ln[t.difficulty],audioPath:"",jsonPath:t.filename,characteristic:t.characteristic,offset:t.customData._editorOffset,oldOffset:t.customData._editorOldOffset,chromaToggle:t.customData._chromaToggle,customColors:t.customData._customColors,difficultyLabel:t.customData._difficultyLabel,colorLeft:xt(t.customData._colorLeft),colorRight:xt(t.customData._colorRight),envColorLeft:xt(t.customData._envColorLeft),envColorRight:xt(t.customData._envColorRight),obstacleColor:xt(t.customData._obstacleColor)}},deserialize(t={}){return{difficulty:t.difficulty,filename:t.jsonPath,njs:0,njsOffset:0,characteristic:t.characteristic,customData:{_editorOffset:t.offset,_editorOldOffset:t.oldOffset,_chromaToggle:t.chromaToggle,_customColors:t.customColors,_difficultyLabel:t.difficultyLabel,_colorLeft:xt(t.colorLeft),_colorRight:xt(t.colorRight),_envColorLeft:xt(t.envColorLeft),_envColorRight:xt(t.envColorRight),_obstacleColor:xt(t.obstacleColor)}}}},bf={serialize(t){return{songName:t.song.title,songSubName:t.song.subTitle,authorName:t.song.author,beatsPerMinute:t.audio.bpm,previewStartTime:t.audio.previewStartTime,previewDuration:t.audio.previewDuration,coverImagePath:t.coverImageFilename,environmentName:t.environmentNames[0],difficultyLevels:t.difficulties.map(us.serialize),oneSaber:t.difficulties.some(e=>e.characteristic==="OneSaber"),contributors:j(t.customData._contributors),customEnvironment:t.customData._customEnvironment,customEnvironmentHash:t.customData._customEnvironmentHash}},deserialize(t={}){var e,i,n,o,l;return{version:1,song:{title:t.songName,subTitle:t.songSubName,author:t.authorName},audio:{filename:(i=(e=t.difficultyLevels)==null?void 0:e.find(s=>s==null?void 0:s.audioPath))==null?void 0:i.audioPath,bpm:t.beatsPerMinute,previewStartTime:t.previewStartTime,previewDuration:t.previewDuration},songPreviewFilename:(o=(n=t.difficultyLevels)==null?void 0:n.find(s=>s==null?void 0:s.audioPath))==null?void 0:o.audioPath,coverImageFilename:t.coverImagePath,environmentNames:[t.environmentName],difficulties:(l=t.difficultyLevels)==null?void 0:l.map(us.deserialize),customData:{_contributors:t.contributors,_customEnvironment:t.customEnvironment,_customEnvironmentHash:t.customEnvironmentHash}}}},hs={serialize(t){return{_difficulty:t.difficulty,_difficultyRank:Ln[t.difficulty],_beatmapFilename:t.filename,_noteJumpMovementSpeed:t.njs,_noteJumpStartBeatOffset:t.njsOffset,_beatmapColorSchemeIdx:t.colorSchemeId,_environmentNameIdx:t.environmentId,_customData:j(t.customData)}},deserialize(t={}){return{difficulty:t._difficulty,filename:t._beatmapFilename,njs:t._noteJumpMovementSpeed,njsOffset:t._noteJumpStartBeatOffset,colorSchemeId:t._beatmapColorSchemeIdx,environmentId:t._environmentNameIdx,customData:t._customData}}},vf={serialize(t){const e=new Set,i={_version:"2.1.0",_songName:t.song.title,_songSubName:t.song.subTitle,_songAuthorName:t.song.author,_levelAuthorName:"",_beatsPerMinute:t.audio.bpm,_songTimeOffset:t.audio.audioOffset,_shuffle:t.audio.shuffle,_shufflePeriod:t.audio.shufflePeriod,_previewStartTime:t.audio.previewStartTime,_previewDuration:t.audio.previewDuration,_songFilename:t.audio.filename,_coverImageFilename:t.coverImageFilename,_environmentName:t.environmentNames.find(n=>n!=="GlassDesertEnvironment"&&n!=="MultiplayerEnvironment"),_allDirectionsEnvironmentName:t.environmentNames.find(n=>n==="GlassDesertEnvironment"||n==="MultiplayerEnvironment"),_environmentNames:t.environmentNames.map(n=>n),_colorSchemes:t.colorSchemes.map(n=>{const o={useOverride:n.useOverride,colorScheme:{colorSchemeId:n.name,saberAColor:xt(n.saberLeftColor),saberBColor:xt(n.saberRightColor),environmentColor0:xt(n.environment0Color),environmentColor1:xt(n.environment1Color),obstaclesColor:xt(n.obstaclesColor),environmentColor0Boost:xt(n.environment0ColorBoost),environmentColor1Boost:xt(n.environment1ColorBoost)}};return n.environmentWColor&&(o.colorScheme.environmentColorW=xt(n.environmentWColor)),n.environmentWColorBoost&&(o.colorScheme.environmentColorWBoost=xt(n.environmentWColorBoost)),o}),_customData:j(t.customData),_difficultyBeatmapSets:t.difficulties.reduce((n,o)=>{let l=n.find(s=>s._beatmapCharacteristicName===o.characteristic);return l||(l={_beatmapCharacteristicName:o.characteristic,_difficultyBeatmaps:[]},n.push(l)),o.authors.mappers.forEach(s=>e.add(s)),o.authors.lighters.forEach(s=>e.add(s)),l._difficultyBeatmaps.push(hs.serialize(o)),n},[])};return i._levelAuthorName=[...e].join(", "),i},deserialize(t={}){var i,n,o,l;const e={version:2,song:{title:t._songName,subTitle:t._songSubName,author:t._songAuthorName},audio:{bpm:t._beatsPerMinute,previewStartTime:t._previewStartTime,previewDuration:t._previewDuration,filename:t._songFilename,audioOffset:t._songTimeOffset,shuffle:t._shuffle,shufflePeriod:t._shufflePeriod},songPreviewFilename:t._songFilename,coverImageFilename:t._coverImageFilename,environmentNames:(i=t._environmentNames)==null?void 0:i.map(s=>s),colorSchemes:(n=t._colorSchemes)==null?void 0:n.map(s=>{var a,u,f,m,h,c,g,d,v,_,y,S,w,k,O,P,G,I,W,et,C,$,b,z,lt,U,ut,X,st,N,x,it,Q,Z,Et,Lt,ft,vt,wt,Dt,Pt,Nt,p,F,A,D,E,T,V,H,R,q,tt,K,ot,_t,dt,Ft,$e,Ut,Pe,kt,Qe,_i,Yt,$i,on,rn,sn,Pi,Me,ti,er,ir,nr;const r={useOverride:!!s.useOverride,name:(a=s.colorScheme)==null?void 0:a.colorSchemeId,saberLeftColor:{r:(f=(u=s.colorScheme)==null?void 0:u.saberAColor)==null?void 0:f.r,g:(h=(m=s.colorScheme)==null?void 0:m.saberAColor)==null?void 0:h.g,b:(g=(c=s.colorScheme)==null?void 0:c.saberAColor)==null?void 0:g.b,a:(v=(d=s.colorScheme)==null?void 0:d.saberAColor)==null?void 0:v.a},saberRightColor:{r:(y=(_=s.colorScheme)==null?void 0:_.saberBColor)==null?void 0:y.r,g:(w=(S=s.colorScheme)==null?void 0:S.saberBColor)==null?void 0:w.g,b:(O=(k=s.colorScheme)==null?void 0:k.saberBColor)==null?void 0:O.b,a:(G=(P=s.colorScheme)==null?void 0:P.saberBColor)==null?void 0:G.a},environment0Color:{r:(W=(I=s.colorScheme)==null?void 0:I.environmentColor0)==null?void 0:W.r,g:(C=(et=s.colorScheme)==null?void 0:et.environmentColor0)==null?void 0:C.g,b:(b=($=s.colorScheme)==null?void 0:$.environmentColor0)==null?void 0:b.b,a:(lt=(z=s.colorScheme)==null?void 0:z.environmentColor0)==null?void 0:lt.a},environment1Color:{r:(ut=(U=s.colorScheme)==null?void 0:U.environmentColor1)==null?void 0:ut.r,g:(st=(X=s.colorScheme)==null?void 0:X.environmentColor1)==null?void 0:st.g,b:(x=(N=s.colorScheme)==null?void 0:N.environmentColor1)==null?void 0:x.b,a:(Q=(it=s.colorScheme)==null?void 0:it.environmentColor1)==null?void 0:Q.a},obstaclesColor:{r:(Et=(Z=s.colorScheme)==null?void 0:Z.obstaclesColor)==null?void 0:Et.r,g:(ft=(Lt=s.colorScheme)==null?void 0:Lt.obstaclesColor)==null?void 0:ft.g,b:(wt=(vt=s.colorScheme)==null?void 0:vt.obstaclesColor)==null?void 0:wt.b,a:(Pt=(Dt=s.colorScheme)==null?void 0:Dt.obstaclesColor)==null?void 0:Pt.a},environment0ColorBoost:{r:(p=(Nt=s.colorScheme)==null?void 0:Nt.environmentColor0Boost)==null?void 0:p.r,g:(A=(F=s.colorScheme)==null?void 0:F.environmentColor0Boost)==null?void 0:A.g,b:(E=(D=s.colorScheme)==null?void 0:D.environmentColor0Boost)==null?void 0:E.b,a:(V=(T=s.colorScheme)==null?void 0:T.environmentColor0Boost)==null?void 0:V.a},environment1ColorBoost:{r:(R=(H=s.colorScheme)==null?void 0:H.environmentColor1Boost)==null?void 0:R.r,g:(tt=(q=s.colorScheme)==null?void 0:q.environmentColor1Boost)==null?void 0:tt.g,b:(ot=(K=s.colorScheme)==null?void 0:K.environmentColor1Boost)==null?void 0:ot.b,a:(dt=(_t=s.colorScheme)==null?void 0:_t.environmentColor1Boost)==null?void 0:dt.a}};return(Ft=s.colorScheme)!=null&&Ft.environmentColorW&&(r.environmentWColor={r:(Ut=($e=s.colorScheme)==null?void 0:$e.environmentColorW)==null?void 0:Ut.r,g:(kt=(Pe=s.colorScheme)==null?void 0:Pe.environmentColorW)==null?void 0:kt.g,b:(_i=(Qe=s.colorScheme)==null?void 0:Qe.environmentColorW)==null?void 0:_i.b,a:($i=(Yt=s.colorScheme)==null?void 0:Yt.environmentColorW)==null?void 0:$i.a}),(on=s.colorScheme)!=null&&on.environmentColorWBoost&&(r.environmentWColorBoost={r:(sn=(rn=s.colorScheme)==null?void 0:rn.environmentColorWBoost)==null?void 0:sn.r,g:(Me=(Pi=s.colorScheme)==null?void 0:Pi.environmentColorWBoost)==null?void 0:Me.g,b:(er=(ti=s.colorScheme)==null?void 0:ti.environmentColorWBoost)==null?void 0:er.b,a:(nr=(ir=s.colorScheme)==null?void 0:ir.environmentColorWBoost)==null?void 0:nr.a}),r}),difficulties:(o=t._difficultyBeatmapSets)==null?void 0:o.flatMap(s=>{var r;return(r=s._difficultyBeatmaps)==null?void 0:r.map(a=>{const u=hs.deserialize(a);return u.characteristic=s._beatmapCharacteristicName,u.authors={mappers:[t._levelAuthorName]},u})}),customData:t._customData};return(l=e.environmentNames)!=null&&l.length||(e.environmentNames=[t._environmentName,t._allDirectionsEnvironmentName],e.difficulties.forEach(s=>{s.environmentId=s.characteristic==="360Degree"||s.characteristic==="90Degree"?1:0})),e}},ms={serialize(t){return{characteristic:t.characteristic,difficulty:t.difficulty,beatmapAuthors:{mappers:[...t.authors.mappers],lighters:[...t.authors.lighters]},environmentNameIdx:t.environmentId,beatmapColorSchemeIdx:t.colorSchemeId,noteJumpMovementSpeed:t.njs,noteJumpStartBeatOffset:t.njsOffset,lightshowDataFilename:t.lightshowFilename,beatmapDataFilename:t.filename,customData:j(t.customData)}},deserialize(t={}){var e,i,n,o;return{characteristic:t.characteristic,difficulty:t.difficulty,authors:{mappers:(i=(e=t.beatmapAuthors)==null?void 0:e.mappers)==null?void 0:i.map(l=>l),lighters:(o=(n=t.beatmapAuthors)==null?void 0:n.lighters)==null?void 0:o.map(l=>l)},filename:t.beatmapDataFilename,lightshowFilename:t.lightshowDataFilename,njs:t.noteJumpMovementSpeed,njsOffset:t.noteJumpStartBeatOffset,colorSchemeId:t.beatmapColorSchemeIdx,environmentId:t.environmentNameIdx,customData:t.customData}}},_f={serialize(t){return{version:"4.0.0",song:{author:t.song.author,title:t.song.title,subTitle:t.song.subTitle},audio:{songFilename:t.audio.filename,songDuration:t.audio.duration,audioDataFilename:t.audio.audioDataFilename,bpm:t.audio.bpm,lufs:t.audio.lufs,previewStartTime:t.audio.previewStartTime,previewDuration:t.audio.previewDuration},songPreviewFilename:t.songPreviewFilename,coverImageFilename:t.coverImageFilename,environmentNames:t.environmentNames.map(e=>e),colorSchemes:t.colorSchemes.map(e=>{const i={colorSchemeName:e.name,saberAColor:pt(e.saberLeftColor),saberBColor:pt(e.saberRightColor),environmentColor0:pt(e.environment0Color),environmentColor1:pt(e.environment1Color),obstaclesColor:pt(e.obstaclesColor),environmentColor0Boost:pt(e.environment0ColorBoost),environmentColor1Boost:pt(e.environment1ColorBoost)};return e.environmentWColor&&(i.environmentColorW=pt(e.environmentWColor)),e.environmentWColorBoost&&(i.environmentColorWBoost=pt(e.environmentWColorBoost)),i}),difficultyBeatmaps:t.difficulties.map(ms.serialize),customData:j(t.customData)}},deserialize(t={}){var e,i,n,o,l,s,r,a,u,f,m,h;return{version:4,song:{author:(e=t.song)==null?void 0:e.author,title:(i=t.song)==null?void 0:i.title,subTitle:(n=t.song)==null?void 0:n.subTitle},audio:{filename:(o=t.audio)==null?void 0:o.songFilename,duration:(l=t.audio)==null?void 0:l.songDuration,audioDataFilename:(s=t.audio)==null?void 0:s.audioDataFilename,bpm:(r=t.audio)==null?void 0:r.bpm,lufs:(a=t.audio)==null?void 0:a.lufs,previewStartTime:(u=t.audio)==null?void 0:u.previewStartTime,previewDuration:(f=t.audio)==null?void 0:f.previewDuration},songPreviewFilename:t.songPreviewFilename,coverImageFilename:t.coverImageFilename,environmentNames:(m=t.environmentNames)==null?void 0:m.map(c=>c),colorSchemes:(h=t.colorSchemes)==null?void 0:h.map(c=>{c=c;const g={useOverride:!0,name:c.colorSchemeName||"",saberLeftColor:ee(ae(c.saberAColor),!0),saberRightColor:ee(ae(c.saberBColor),!0),environment0Color:ee(ae(c.environmentColor0),!0),environment1Color:ee(ae(c.environmentColor1),!0),obstaclesColor:ee(ae(c.obstaclesColor),!0),environment0ColorBoost:ee(ae(c.environmentColor0Boost),!0),environment1ColorBoost:ee(ae(c.environmentColor1Boost),!0)};return c.environmentColorW&&(g.environmentWColor=ee(ae(c.environmentColorW),!0)),c.environmentColorWBoost&&(g.environmentWColorBoost=ee(ae(c.environmentColorWBoost),!0)),g}),difficulties:(t.difficultyBeatmaps??[]).map(c=>ms.deserialize(c)),customData:t.customData}}},yf={serialize(t){return{_version:"2.0.0",_songSampleCount:t.sampleCount,_songFrequency:t.frequency,_regions:t.bpmData.map(e=>({_startBeat:e.startBeat,_endBeat:e.endBeat,_startSampleIndex:e.startSampleIndex,_endSampleIndex:e.endSampleIndex}))}},deserialize(t={}){var e;return{version:2,sampleCount:t._songSampleCount,frequency:t._songFrequency,bpmData:(e=t._regions)==null?void 0:e.map(i=>({startBeat:i==null?void 0:i._startBeat,endBeat:i==null?void 0:i._endBeat,startSampleIndex:i==null?void 0:i._startSampleIndex,endSampleIndex:i==null?void 0:i._endSampleIndex}))}}},Ef={serialize(t){return{version:"4.0.0",songChecksum:t.audioChecksum,songSampleCount:t.sampleCount,songFrequency:t.frequency,bpmData:t.bpmData.map(e=>({sb:e.startBeat,eb:e.endBeat,si:e.startSampleIndex,ei:e.endSampleIndex})),lufsData:t.lufsData.map(e=>({l:e.lufs,si:e.startSampleIndex,ei:e.endSampleIndex}))}},deserialize(t={}){var e,i;return{version:4,audioChecksum:t.songChecksum,sampleCount:t.songSampleCount,frequency:t.songFrequency,bpmData:(e=t.bpmData)==null?void 0:e.map(n=>({startBeat:n==null?void 0:n.sb,endBeat:n==null?void 0:n.eb,startSampleIndex:n==null?void 0:n.si,endSampleIndex:n==null?void 0:n.ei})),lufsData:(i=t.lufsData)==null?void 0:i.map(n=>({lufs:n==null?void 0:n.l,startSampleIndex:n==null?void 0:n.si,endSampleIndex:n==null?void 0:n.ei}))}}},fs={serialize(t){return{_time:t.time,_lineIndex:t.posX,_lineLayer:t.posY,_type:3,_cutDirection:t.direction}},deserialize(t={}){return{time:t._time,posX:t._lineIndex,posY:t._lineLayer,direction:t._cutDirection}}},ps={serialize(t){return{_time:t.time,_lineIndex:t.posX,_lineLayer:t.posY,_type:t.color,_cutDirection:t.direction}},deserialize(t={}){return{time:t._time,posX:t._lineIndex,posY:t._lineLayer,color:t._type,direction:t._cutDirection}}},ds={serialize(t){return{_time:t.time,_type:t.type,_value:t.value}},deserialize(t={}){return{time:t._time,type:t._type,value:t._value,floatValue:1}}},gs={serialize(t){return{_time:t.time,_type:5,_value:t.toggle?1:0}},deserialize(t={}){return{time:t._time,toggle:t._value===1}}},bs={serialize(t){let e=t.rotation%360;return e>=-60&&e<=60&&e%15===0&&e/15!==0?e/=15:e+=1360,{_time:t.time,_type:t.executionTime===1?15:14,_value:e}},deserialize(t={}){const e=t._value??0;return{time:t._time,executionTime:t._type===15?1:0,rotation:e>=1e3?(e-1360)%360:uu[e]??0}}},vs={serialize(t){return{_time:t.time,_type:100,_value:Math.round(t.bpm)}},deserialize(t={}){return{time:t._time,bpm:t._value}}},_s={serialize(t){let e=0;return t.height>=0&&t.posY>=0&&(e=t.height*1e3+t.posY+4001),{_time:t.time,_type:t.posY===2&&t.height===3?1:t.posY===0&&t.height===5?0:e,_lineIndex:t.posX,_duration:t.duration,_width:t.width}},deserialize(t={}){const e=t._type??0,i=e===1?3:e>=1e3&&e<=4e3?vc(e,1e3,4e3,0,15):e>4e3&&e<=4005e3?0:5,n=e===1?2:e>4e3&&e<=4005e3?Math.floor((e-4001)/1e3):0;return{time:t._time,posY:n,posX:t._lineIndex,duration:t._duration,width:t._width,height:i}}},Df={serialize(t){return{_version:"1.5.0",_beatsPerMinute:120,_beatsPerBar:4,_shuffle:0,_shufflePeriod:.5,_noteJumpSpeed:10,_noteJumpStartBeatOffset:0,_notes:[...t.difficulty.colorNotes.map(ps.serialize),...t.difficulty.bombNotes.map(fs.serialize)],_obstacles:t.difficulty.obstacles.map(_s.serialize),_events:[...t.lightshow.basicEvents.map(ds.serialize),...t.lightshow.colorBoostEvents.map(gs.serialize),...t.difficulty.rotationEvents.map(bs.serialize),...t.difficulty.bpmEvents.map(vs.serialize)],_time:t.difficulty.customData._time,_BPMChanges:t.difficulty.customData._bpmChanges,_bookmarks:t.difficulty.customData._bookmarks}},deserialize(t={}){var r,a,u;const e=[],i=[];(r=t._notes)==null||r.forEach(f=>{(f==null?void 0:f._type)===3?i.push(fs.deserialize(f)):e.push(ps.deserialize(f))});const n=[],o=[],l=[],s=[];return(a=t._events)==null||a.forEach(f=>{switch(f==null?void 0:f._type){case 5:o.push(gs.deserialize(f));break;case 14:case 15:l.push(bs.deserialize(f));break;case 100:case 10:s.push(vs.deserialize(f));break;default:n.push(ds.deserialize(f))}}),{version:1,difficulty:{colorNotes:e,bombNotes:i,obstacles:(u=t._obstacles)==null?void 0:u.map(_s.deserialize),bpmEvents:s,rotationEvents:l,customData:{_bpmChanges:t._BPMChanges,_bookmarks:t._bookmarks,_time:t._time}},lightshow:{basicEvents:n,colorBoostEvents:o}}}},ys={serialize(t){return{_time:t.time,_type:t.color,_lineIndex:t.posX,_lineLayer:t.posY,_cutDirection:t.direction,_customData:j(t.customData)}},deserialize(t={}){return{time:t._time,posX:t._lineIndex,posY:t._lineLayer,color:t._type,direction:t._cutDirection,customData:t._customData}}},Cf={serialize(t){return{_colorType:t.color,_headTime:t.time,_headLineIndex:t.posX,_headLineLayer:t.posY,_headCutDirection:t.direction,_headControlPointLengthMultiplier:t.lengthMultiplier,_tailTime:t.tailTime,_tailLineIndex:t.tailPosX,_tailLineLayer:t.tailPosY,_tailCutDirection:t.tailDirection,_tailControlPointLengthMultiplier:t.tailLengthMultiplier,_sliderMidAnchorMode:t.midAnchor,_customData:j(t.customData)}},deserialize(t={}){return{color:t._colorType,time:t._headTime,posX:t._headLineIndex,posY:t._headLineLayer,direction:t._headCutDirection,lengthMultiplier:t._headControlPointLengthMultiplier,tailTime:t._tailTime,tailPosX:t._tailLineIndex,tailPosY:t._tailLineLayer,tailDirection:t._tailCutDirection,tailLengthMultiplier:t._tailControlPointLengthMultiplier,midAnchor:t._sliderMidAnchorMode,customData:t._customData}}},Es={serialize(t){let e=0;return t.height>=0&&t.posY>=0&&(e=Math.floor(t.height*1e3+t.posY+4001)),{_time:t.time,_type:t.posY===2&&t.height===3?1:t.posY===0&&t.height===5?0:e,_lineIndex:t.posX,_duration:t.duration,_width:t.width,_customData:j(t.customData)}},deserialize(t={}){const e=t._type??0,i=e===1?3:e>=1e3&&e<=4e3?vc(e,1e3,4e3,0,15):e>4e3&&e<=4005e3?0:5,n=e===1?2:e>4e3&&e<=4005e3?Math.floor((e-4001)/1e3):0;return{time:t._time,posY:n,posX:t._lineIndex,duration:t._duration,width:t._width,height:i,customData:t._customData}}},Ds={serialize(t){return{_time:t.time,_type:t.type,_value:t.value,_floatValue:t.floatValue,_customData:j(t.customData)}},deserialize(t={}){return{time:t._time,type:t._type,value:t._value,floatValue:t._floatValue,customData:t._customData}}},Cs={serialize(t){return{_time:t.time,_lineIndex:t.posX,_lineLayer:t.posY,_offsetDirection:t.direction,_customData:j(t.customData)}},deserialize(t={}){return{time:t._time,posX:t._lineIndex,posY:t._lineLayer,direction:t._offsetDirection,customData:t._customData}}},Ss={serialize(t){return{_keyword:t.keyword,_specialEvents:t.events}},deserialize(t={}){return{keyword:t._keyword,events:t._specialEvents}}},ws={serialize(t){return{_keywords:t.list.map(Ss.serialize)}},deserialize(t={}){var e;return{list:(e=t._keywords)==null?void 0:e.map(Ss.deserialize)}}},ks={serialize(t){return{_time:t.time,_type:3,_lineIndex:t.posX,_lineLayer:t.posY,_cutDirection:t.direction,_customData:j(t.customData)}},deserialize(t={}){return{time:t._time,posX:t._lineIndex,posY:t._lineLayer,customData:t._customData}}},Ts={serialize(t){return{_time:t.time,_type:5,_value:t.toggle?1:0,_floatValue:0,_customData:j(t.customData)}},deserialize(t={}){return{time:t._time,toggle:t._value===1,customData:t._customData}}},Ls={serialize(t){let e=t.rotation%360;return e>=-60&&e<=60&&e%15===0&&e/15!==0?e/=15:e+=1360,{_time:t.time,_type:t.executionTime===1?15:14,_value:e,_floatValue:0,_customData:j(t.customData)}},deserialize(t={}){var i;const e=t._value??0;return{time:t._time,executionTime:t._type===15?1:0,rotation:typeof((i=t._customData)==null?void 0:i._rotation)=="number"?t._customData._rotation:e>=1e3?(e-1360)%360:uu[e]??0,customData:t._customData}}},Rs={serialize(t){return{_time:t.time,_type:100,_value:0,_floatValue:t.bpm,_customData:j(t.customData)}},deserialize(t={}){return{time:t._time,bpm:t._floatValue??t._value,customData:t._customData}}},Sf={serialize(t){return{_version:"2.6.0",_notes:[...t.difficulty.colorNotes.map(ys.serialize),...t.difficulty.bombNotes.map(ks.serialize)].sort(Em),_sliders:t.difficulty.arcs.map(Cf.serialize),_obstacles:t.difficulty.obstacles.map(Es.serialize),_events:[...t.lightshow.basicEvents.map(Ds.serialize),...t.lightshow.colorBoostEvents.map(Ts.serialize),...t.difficulty.rotationEvents.map(Ls.serialize),...t.difficulty.bpmEvents.map(Rs.serialize)].sort(ym),_waypoints:t.lightshow.waypoints.map(Cs.serialize),_specialEventsKeywordFilters:ws.serialize(t.lightshow.eventTypesWithKeywords),_customData:j(t.difficulty.customData)}},deserialize(t={}){var r,a,u,f;const e=[],i=[];(r=t._notes)==null||r.forEach(m=>{(m==null?void 0:m._type)===3?i.push(ks.deserialize(m)):e.push(ys.deserialize(m))});const n=[],o=[],l=[],s=[];return(a=t._events)==null||a.forEach(m=>{switch(m==null?void 0:m._type){case 5:o.push(Ts.deserialize(m));break;case 14:case 15:l.push(Ls.deserialize(m));break;case 100:case 10:s.push(Rs.deserialize(m));break;default:n.push(Ds.deserialize(m))}}),{version:2,difficulty:{colorNotes:e,bombNotes:i,obstacles:(u=t._obstacles)==null?void 0:u.map(Es.deserialize),bpmEvents:s,rotationEvents:l,customData:t._customData},lightshow:{basicEvents:n,colorBoostEvents:o,waypoints:(f=t._waypoints)==null?void 0:f.map(Cs.deserialize),eventTypesWithKeywords:ws.deserialize(t._specialEventsKeywordFilters)}}}},Vn={serialize(t){return{b:t.time,et:t.type,i:t.value,f:t.floatValue,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,type:t.et,value:t.i,floatValue:t.f,customData:t.customData}}},xs={serialize(t){return{k:t.keyword,e:t.events.map(e=>e)}},deserialize(t={}){var e;return{keyword:t.k,events:(e=t.e)==null?void 0:e.map(i=>i)}}},Gn={serialize(t){return{d:t.list.map(xs.serialize)}},deserialize(t={}){var e;return{list:(e=t.d)==null?void 0:e.map(xs.deserialize)}}},Bs={serialize(t){return{b:t.time,x:t.posX,y:t.posY,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,posX:t.x,posY:t.y,customData:t.customData}}},Is={serialize(t){return{b:t.time,m:t.bpm,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,bpm:t.m,customData:t.customData}}},Ns={serialize(t){return{b:t.time,c:t.color,x:t.posX,y:t.posY,d:t.direction,tb:t.tailTime,tx:t.tailPosX,ty:t.tailPosY,sc:t.sliceCount,s:t.squish,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,color:t.c,posX:t.x,posY:t.y,direction:t.d,tailTime:t.tb,tailPosX:t.tx,tailPosY:t.ty,sliceCount:t.sc,squish:t.s,customData:t.customData}}},Hn={serialize(t){return{b:t.time,o:t.toggle,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,toggle:t.o,customData:t.customData}}},As={serialize(t){return{b:t.time,c:t.color,x:t.posX,y:t.posY,d:t.direction,a:t.angleOffset,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,posX:t.x,posY:t.y,color:t.c,direction:t.d,angleOffset:t.a,customData:t.customData}}},Ze={serialize(t){return{f:t.type,p:t.p0,t:t.p1,r:t.reverse,c:t.chunks,n:t.random,s:t.seed,l:t.limit,d:t.limitAffectsType,customData:j(t.customData)}},deserialize(t={}){return{type:t.f,p0:t.p,p1:t.t,reverse:t.r,chunks:t.c,random:t.n,seed:t.s,limit:t.l,limitAffectsType:t.d,customData:t.customData}}},Os={serialize(t){return{b:t.time,c:t.color,f:t.frequency,i:t.previous?wi.EXTEND:t.easing===_n.NONE?wi.INSTANT:wi.INTERPOLATE,s:t.brightness,sb:t.strobeBrightness,sf:t.strobeFade,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,color:t.c,frequency:t.f,previous:t.i===wi.EXTEND?1:0,easing:t.i===wi.INTERPOLATE?_n.LINEAR:_n.NONE,brightness:t.s,strobeBrightness:t.sb,strobeFade:t.sf,customData:t.customData}}},$s={serialize(t){return{f:Ze.serialize(t.filter),w:t.beatDistribution,d:t.beatDistributionType,r:t.brightnessDistribution,t:t.brightnessDistributionType,b:t.affectFirst,i:t.easing,e:t.events.map(Os.serialize),customData:j(t.customData)}},deserialize(t={}){var e;return{filter:Ze.deserialize(t.f),beatDistribution:t.w,beatDistributionType:t.d,brightnessDistribution:t.r,brightnessDistributionType:t.t,affectFirst:t.b,easing:t.i,events:(e=t.e)==null?void 0:e.map(Os.deserialize),customData:t.customData}}},Un={serialize(t){return{b:t.time,g:t.id,e:t.boxes.map($s.serialize),customData:j(t.customData)}},deserialize(t={}){var e;return{time:t.b,id:t.g,boxes:(e=t.e)==null?void 0:e.map($s.deserialize),customData:t.customData}}},Ps={serialize(t){return{b:t.time,e:t.easing,l:t.loop,o:t.direction,p:t.previous,r:t.rotation,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,easing:t.e,loop:t.l,direction:t.o,previous:t.p,rotation:t.r,customData:t.customData}}},Ms={serialize(t){return{f:Ze.serialize(t.filter),w:t.beatDistribution,d:t.beatDistributionType,s:t.rotationDistribution,t:t.rotationDistributionType,a:t.axis,r:t.flip,b:t.affectFirst,i:t.easing,l:t.events.map(Ps.serialize),customData:j(t.customData)}},deserialize(t={}){var e;return{filter:Ze.deserialize(t.f),beatDistribution:t.w,beatDistributionType:t.d,rotationDistribution:t.s,rotationDistributionType:t.t,axis:t.a,flip:t.r,affectFirst:t.b,easing:t.i,events:(e=t.l)==null?void 0:e.map(Ps.deserialize),customData:t.customData}}},jn={serialize(t){return{b:t.time,g:t.id,e:t.boxes.map(Ms.serialize),customData:j(t.customData)}},deserialize(t={}){var e;return{time:t.b,id:t.g,boxes:(e=t.e)==null?void 0:e.map(Ms.deserialize),customData:t.customData}}},Fs={serialize(t){return{b:t.time,e:t.easing,p:t.previous,t:t.translation,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,easing:t.e,previous:t.p,translation:t.t,customData:t.customData}}},zs={serialize(t){return{f:Ze.serialize(t.filter),w:t.beatDistribution,d:t.beatDistributionType,s:t.gapDistribution,t:t.gapDistributionType,a:t.axis,r:t.flip,b:t.affectFirst,i:t.easing,l:t.events.map(Fs.serialize),customData:j(t.customData)}},deserialize(t={}){var e;return{filter:Ze.deserialize(t.f),beatDistribution:t.w,beatDistributionType:t.d,gapDistribution:t.s,gapDistributionType:t.t,axis:t.a,flip:t.r,affectFirst:t.b,easing:t.i,events:(e=t.l)==null?void 0:e.map(Fs.deserialize),customData:t.customData}}},Wn={serialize(t){return{b:t.time,g:t.id,e:t.boxes.map(zs.serialize),customData:j(t.customData)}},deserialize(t={}){var e;return{time:t.b,id:t.g,boxes:(e=t.e)==null?void 0:e.map(zs.deserialize),customData:t.customData}}},Vs={serialize(t){return{b:t.time,x:t.posX,y:t.posY,d:t.duration,w:t.width,h:t.height,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,posX:t.x,posY:t.y,duration:t.d,width:t.w,height:t.h,customData:t.customData}}},Gs={serialize(t){return{b:t.time,e:t.executionTime,r:t.rotation,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,executionTime:t.e,rotation:t.r,customData:t.customData}}},Hs={serialize(t){return{b:t.time,c:t.color,x:t.posX,y:t.posY,d:t.direction,mu:t.lengthMultiplier,tb:t.tailTime,tx:t.tailPosX,ty:t.tailPosY,tc:t.tailDirection,tmu:t.tailLengthMultiplier,m:t.midAnchor,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,color:t.c,posX:t.x,posY:t.y,direction:t.d,lengthMultiplier:t.mu,tailTime:t.tb,tailPosX:t.tx,tailPosY:t.ty,tailDirection:t.tc,tailLengthMultiplier:t.tmu,midAnchor:t.m,customData:t.customData}}},Us={serialize(t){return{b:t.time,x:t.posX,y:t.posY,d:t.direction,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,posX:t.x,posY:t.y,direction:t.d,customData:t.customData}}},js={serialize(t){return{b:t.time,i:t.easing,p:t.previous,v:t.value,customData:j(t.customData)}},deserialize(t={}){return{time:t.b,easing:t.i,previous:t.p,value:t.v,customData:t.customData}}},Ws={serialize(t){return{data:{f:Ze.serialize(t.filter),w:t.beatDistribution,d:t.beatDistributionType,s:t.fxDistribution,t:t.fxDistributionType,b:t.affectFirst,i:t.easing,l:[],customData:j(t.customData)},eventData:t.events.map(js.serialize)}},deserialize(t={}){var e,i,n,o,l,s,r,a,u;return{filter:Ze.deserialize((e=t.data)==null?void 0:e.f),beatDistribution:(i=t.data)==null?void 0:i.w,beatDistributionType:(n=t.data)==null?void 0:n.d,fxDistribution:(o=t.data)==null?void 0:o.s,fxDistributionType:(l=t.data)==null?void 0:l.t,affectFirst:(s=t.data)==null?void 0:s.b,easing:(r=t.data)==null?void 0:r.i,events:(a=t.eventData)==null?void 0:a.map(js.deserialize),customData:(u=t.data)==null?void 0:u.customData}}},Xn={serialize(t){return{object:{t:cu.FLOAT,b:t.time,g:t.id,e:[],customData:j(t.customData)},boxData:t.boxes.map(Ws.serialize)}},deserialize(t={}){var i,n,o,l;const e={};return e.time=(i=t.object)==null?void 0:i.b,e.id=(n=t.object)==null?void 0:n.g,e.boxes=(o=t.boxData)==null?void 0:o.map(Ws.deserialize),e.customData=(l=t.object)==null?void 0:l.customData,e}},wf={serialize(t){const e={version:"3.3.0",bpmEvents:t.difficulty.bpmEvents.map(Is.serialize),rotationEvents:t.difficulty.rotationEvents.map(Gs.serialize),colorNotes:t.difficulty.colorNotes.map(As.serialize),bombNotes:t.difficulty.bombNotes.map(Bs.serialize),obstacles:t.difficulty.obstacles.map(Vs.serialize),sliders:t.difficulty.arcs.map(Hs.serialize),burstSliders:t.difficulty.chains.map(Ns.serialize),waypoints:t.lightshow.waypoints.map(Us.serialize),basicBeatmapEvents:t.lightshow.basicEvents.map(Vn.serialize),colorBoostBeatmapEvents:t.lightshow.colorBoostEvents.map(Hn.serialize),lightColorEventBoxGroups:t.lightshow.lightColorEventBoxGroups.map(Un.serialize),lightRotationEventBoxGroups:t.lightshow.lightRotationEventBoxGroups.map(jn.serialize),lightTranslationEventBoxGroups:t.lightshow.lightTranslationEventBoxGroups.map(Wn.serialize),vfxEventBoxGroups:[],basicEventTypesWithKeywords:Gn.serialize(t.lightshow.eventTypesWithKeywords),_fxEventsCollection:{_fl:[],_il:[]},useNormalEventsAsCompatibleEvents:t.lightshow.useNormalEventsAsCompatibleEvents,customData:j(t.difficulty.customData)};for(const i of t.lightshow.fxEventBoxGroups.map(Xn.serialize)){e.vfxEventBoxGroups.push(i.object);for(const n of i.boxData){i.object.e.push(n.data);for(const o of n.eventData)n.data.l.push(e._fxEventsCollection._fl.length),e._fxEventsCollection._fl.push(o)}}return e},deserialize:function(t={}){var n,o,l,s,r,a,u,f,m,h,c,g,d,v,_;const e={version:3,difficulty:{},lightshow:{}};e.difficulty.bpmEvents=(n=t.bpmEvents)==null?void 0:n.map(Is.deserialize),e.difficulty.rotationEvents=(o=t.rotationEvents)==null?void 0:o.map(Gs.deserialize),e.difficulty.colorNotes=(l=t.colorNotes)==null?void 0:l.map(As.deserialize),e.difficulty.bombNotes=(s=t.bombNotes)==null?void 0:s.map(Bs.deserialize),e.difficulty.obstacles=(r=t.obstacles)==null?void 0:r.map(Vs.deserialize),e.difficulty.arcs=(a=t.sliders)==null?void 0:a.map(Hs.deserialize),e.difficulty.chains=(u=t.burstSliders)==null?void 0:u.map(Ns.deserialize),e.lightshow.waypoints=(f=t.waypoints)==null?void 0:f.map(Us.deserialize),e.lightshow.basicEvents=(m=t.basicBeatmapEvents)==null?void 0:m.map(Vn.deserialize),e.lightshow.colorBoostEvents=(h=t.colorBoostBeatmapEvents)==null?void 0:h.map(Hn.deserialize),e.lightshow.lightColorEventBoxGroups=(c=t.lightColorEventBoxGroups)==null?void 0:c.map(Un.deserialize),e.lightshow.lightRotationEventBoxGroups=(g=t.lightRotationEventBoxGroups)==null?void 0:g.map(jn.deserialize),e.lightshow.lightTranslationEventBoxGroups=(d=t.lightTranslationEventBoxGroups)==null?void 0:d.map(Wn.deserialize);const i=(v=t._fxEventsCollection)==null?void 0:v._fl;return e.lightshow.fxEventBoxGroups=(_=t.vfxEventBoxGroups)==null?void 0:_.map(y=>{var S;return Xn.deserialize({object:y,boxData:(S=y.e)==null?void 0:S.map(w=>{var k;return{data:w,eventData:(k=w.l)==null?void 0:k.map(O=>i[O])}})})}),e.lightshow.eventTypesWithKeywords=Gn.deserialize(t.basicEventTypesWithKeywords),e.lightshow.useNormalEventsAsCompatibleEvents=t.useNormalEventsAsCompatibleEvents,e.difficulty.customData=t.customData,e}},Xs={serialize(t){return{object:{b:t.time,i:0,r:t.laneRotation,customData:{}},data:{x:t.posX,y:t.posY,customData:j(t.customData)}}},deserialize(t={}){var e,i,n,o,l;return{time:(e=t.object)==null?void 0:e.b,laneRotation:(i=t.object)==null?void 0:i.r,posX:(n=t.data)==null?void 0:n.x,posY:(o=t.data)==null?void 0:o.y,customData:(l=t.data)==null?void 0:l.customData}}},Ys={serialize(t){return{object:{hb:t.time,hr:t.laneRotation,tb:t.tailTime,tr:t.tailLaneRotation,i:0,ci:0,customData:{}},data:{c:t.color,x:t.posX,y:t.posY,d:t.direction,a:0,customData:{}},chainData:{tx:t.tailPosX,ty:t.tailPosY,c:t.sliceCount,s:t.squish,customData:j(t.customData)}}},deserialize(t={}){var e,i,n,o,l,s,r,a,u,f,m,h,c;return{time:(e=t.object)==null?void 0:e.hb,laneRotation:(i=t.object)==null?void 0:i.hr,color:(n=t.data)==null?void 0:n.c,posX:(o=t.data)==null?void 0:o.x,posY:(l=t.data)==null?void 0:l.y,direction:(s=t.data)==null?void 0:s.d,tailTime:(r=t.object)==null?void 0:r.tb,tailLaneRotation:(a=t.object)==null?void 0:a.tr,tailPosX:(u=t.chainData)==null?void 0:u.tx,tailPosY:(f=t.chainData)==null?void 0:f.ty,sliceCount:(m=t.chainData)==null?void 0:m.c,squish:(h=t.chainData)==null?void 0:h.s,customData:(c=t.chainData)==null?void 0:c.customData}}},qs={serialize(t){return{object:{b:t.time,i:0,r:t.laneRotation,customData:{}},data:{c:t.color,x:t.posX,y:t.posY,d:t.direction,a:t.angleOffset,customData:j(t.customData)}}},deserialize(t={}){var e,i,n,o,l,s,r,a;return{time:(e=t.object)==null?void 0:e.b,laneRotation:(i=t.object)==null?void 0:i.r,posX:(n=t.data)==null?void 0:n.x,posY:(o=t.data)==null?void 0:o.y,color:(l=t.data)==null?void 0:l.c,direction:(s=t.data)==null?void 0:s.d,angleOffset:(r=t.data)==null?void 0:r.a,customData:(a=t.data)==null?void 0:a.customData}}},Ks={serialize(t){return{object:{b:t.time,i:0,r:t.laneRotation,customData:{}},data:{x:t.posX,y:t.posY,d:t.duration,w:t.width,h:t.height,customData:j(t.customData)}}},deserialize(t={}){var e,i,n,o,l,s,r,a;return{time:(e=t.object)==null?void 0:e.b,laneRotation:(i=t.object)==null?void 0:i.r,posX:(n=t.data)==null?void 0:n.x,posY:(o=t.data)==null?void 0:o.y,duration:(l=t.data)==null?void 0:l.d,width:(s=t.data)==null?void 0:s.w,height:(r=t.data)==null?void 0:r.h,customData:(a=t.data)==null?void 0:a.customData}}},Zs={serialize(t){return{object:{ai:0,hb:t.time,hi:0,hr:t.laneRotation,tb:t.tailTime,ti:0,tr:t.tailLaneRotation,customData:{}},data:{m:t.lengthMultiplier,tm:t.tailLengthMultiplier,a:t.midAnchor,customData:j(t.customData)},headData:{c:t.color,x:t.posX,y:t.posY,d:t.direction,a:0,customData:{}},tailData:{c:t.color,x:t.tailPosX,y:t.tailPosY,d:t.tailDirection,a:0,customData:{}}}},deserialize(t={}){var e,i,n,o,l,s,r,a,u,f,m,h,c,g,d;return{time:(e=t.object)==null?void 0:e.hb,laneRotation:(i=t.object)==null?void 0:i.hr,tailTime:(n=t.object)==null?void 0:n.tb,tailLaneRotation:(o=t.object)==null?void 0:o.tr,color:(l=t.headData)==null?void 0:l.c,posX:(s=t.headData)==null?void 0:s.x,posY:(r=t.headData)==null?void 0:r.y,direction:(a=t.headData)==null?void 0:a.d,lengthMultiplier:(u=t.data)==null?void 0:u.m,tailPosX:(f=t.tailData)==null?void 0:f.x,tailPosY:(m=t.tailData)==null?void 0:m.y,tailDirection:(h=t.tailData)==null?void 0:h.d,tailLengthMultiplier:(c=t.data)==null?void 0:c.tm,midAnchor:(g=t.data)==null?void 0:g.a,customData:(d=t.data)==null?void 0:d.customData}}},Js={serialize(t){return{object:{b:t.time},data:{e:t.executionTime,r:t.rotation,customData:j(t.customData)}}},deserialize(t={}){var e,i,n,o;return{time:(e=t.object)==null?void 0:e.b,executionTime:(i=t.data)==null?void 0:i.e,rotation:(n=t.data)==null?void 0:n.r,customData:(o=t.data)==null?void 0:o.customData}}},kf={serialize(t){const e={version:"4.0.0",colorNotes:[],bombNotes:[],obstacles:[],chains:[],arcs:[],spawnRotations:[],colorNotesData:[],bombNotesData:[],obstaclesData:[],chainsData:[],arcsData:[],spawnRotationsData:[],customData:j(t.difficulty.customData)};for(const i of t.difficulty.colorNotes.map(qs.serialize))e.colorNotes.push(i.object),i.object.i=e.colorNotesData.length,e.colorNotesData.push(i.data);for(const i of t.difficulty.bombNotes.map(Xs.serialize))e.bombNotes.push(i.object),i.object.i=e.bombNotesData.length,e.bombNotesData.push(i.data);for(const i of t.difficulty.obstacles.map(Ks.serialize))e.obstacles.push(i.object),i.object.i=e.obstaclesData.length,e.obstaclesData.push(i.data);for(const i of t.difficulty.arcs.map(Zs.serialize))e.arcs.push(i.object),i.object.ai=e.arcsData.length,e.arcsData.push(i.data),i.object.hi=e.colorNotesData.length,e.colorNotesData.push(i.headData),i.object.ti=e.colorNotesData.length,e.colorNotesData.push(i.tailData);for(const i of t.difficulty.chains.map(Ys.serialize))e.chains.push(i.object),i.object.i=e.colorNotesData.length,e.colorNotesData.push(i.data),i.object.ci=e.chainsData.length,e.chainsData.push(i.chainData);for(const i of t.difficulty.rotationEvents.map(Js.serialize))e.spawnRotations.push(i.object),i.object.i=e.spawnRotationsData.length,e.spawnRotationsData.push(i.data);return e},deserialize(t={}){var e,i,n,o,l,s;return{version:4,difficulty:{colorNotes:(e=t.colorNotes)==null?void 0:e.map(r=>{var a;return qs.deserialize({object:r,data:(a=t.colorNotesData)==null?void 0:a[(r==null?void 0:r.i)||0]})}),bombNotes:(i=t.bombNotes)==null?void 0:i.map(r=>{var a;return Xs.deserialize({object:r,data:(a=t.bombNotesData)==null?void 0:a[(r==null?void 0:r.i)||0]})}),obstacles:(n=t.obstacles)==null?void 0:n.map(r=>{var a;return Ks.deserialize({object:r,data:(a=t.obstaclesData)==null?void 0:a[(r==null?void 0:r.i)||0]})}),arcs:(o=t.arcs)==null?void 0:o.map(r=>{var a,u,f;return Zs.deserialize({object:r,data:(a=t.arcsData)==null?void 0:a[(r==null?void 0:r.ai)||0],headData:(u=t.colorNotesData)==null?void 0:u[(r==null?void 0:r.hi)||0],tailData:(f=t.colorNotesData)==null?void 0:f[(r==null?void 0:r.ti)||0]})}),chains:(l=t.chains)==null?void 0:l.map(r=>{var a,u;return Ys.deserialize({object:r,data:(a=t.colorNotesData)==null?void 0:a[(r==null?void 0:r.i)||0],chainData:(u=t.chainsData)==null?void 0:u[(r==null?void 0:r.ci)||0]})}),rotationEvents:(s=t.spawnRotations)==null?void 0:s.map(r=>{var a;return Js.deserialize({object:r,data:(a=t.spawnRotationsData)==null?void 0:a[(r==null?void 0:r.i)||0]})}),customData:t.customData}}}},Tf={serialize(t){const e={basicBeatmapEvents:t.lightshow.basicEvents.map(Vn.serialize),colorBoostBeatmapEvents:t.lightshow.colorBoostEvents.map(Hn.serialize),lightColorEventBoxGroups:t.lightshow.lightColorEventBoxGroups.map(Un.serialize),lightRotationEventBoxGroups:t.lightshow.lightRotationEventBoxGroups.map(jn.serialize),lightTranslationEventBoxGroups:t.lightshow.lightTranslationEventBoxGroups.map(Wn.serialize),vfxEventBoxGroups:[],_fxEventsCollection:{_fl:[],_il:[]},customData:j(t.lightshow.customData)};for(const i of t.lightshow.fxEventBoxGroups.map(Xn.serialize)){e.vfxEventBoxGroups.push(i.object);for(const n of i.boxData){i.object.e.push(n.data);for(const o of n.eventData)n.data.l.push(e._fxEventsCollection._fl.length),e._fxEventsCollection._fl.push(o)}}return e},deserialize(t={}){var n,o,l,s,r,a,u;const e={version:3,lightshow:{}};e.lightshow.basicEvents=(n=t.basicBeatmapEvents)==null?void 0:n.map(Vn.deserialize),e.lightshow.colorBoostEvents=(o=t.colorBoostBeatmapEvents)==null?void 0:o.map(Hn.deserialize),e.lightshow.lightColorEventBoxGroups=(l=t.lightColorEventBoxGroups)==null?void 0:l.map(Un.deserialize),e.lightshow.lightRotationEventBoxGroups=(s=t.lightRotationEventBoxGroups)==null?void 0:s.map(jn.deserialize),e.lightshow.lightTranslationEventBoxGroups=(r=t.lightTranslationEventBoxGroups)==null?void 0:r.map(Wn.deserialize);const i=((a=t._fxEventsCollection)==null?void 0:a._fl)??[];return e.lightshow.fxEventBoxGroups=(u=t.vfxEventBoxGroups)==null?void 0:u.map(f=>{var m;return Xn.deserialize({object:f,boxData:(m=f.e)==null?void 0:m.map(h=>{var c;return{data:h,eventData:(c=h.l)==null?void 0:c.map(g=>i[g])}})})}),e.lightshow.customData=t.customData,e}},Qs={serialize(t){return{object:{b:t.time,i:0,r:t.laneRotation,customData:{}},data:{x:t.posX,y:t.posY,d:t.direction,customData:j(t.customData)}}},deserialize(t={}){var e,i,n,o,l,s;return{time:(e=t.object)==null?void 0:e.b,laneRotation:(i=t.object)==null?void 0:i.r,posX:(n=t.data)==null?void 0:n.x,posY:(o=t.data)==null?void 0:o.y,direction:(l=t.data)==null?void 0:l.d,customData:(s=t.data)==null?void 0:s.customData}}},ta={serialize(t){return{object:{b:t.time,i:0,customData:{}},data:{t:t.type,i:t.value,f:t.floatValue,customData:j(t.customData)}}},deserialize(t={}){var e,i,n,o,l;return{time:(e=t.object)==null?void 0:e.b,type:(i=t.data)==null?void 0:i.t,value:(n=t.data)==null?void 0:n.i,floatValue:(o=t.data)==null?void 0:o.f,customData:(l=t.data)==null?void 0:l.customData}}},ea={serialize(t){return{object:{b:t.time,i:0,customData:{}},data:{b:t.toggle?1:0,customData:j(t.customData)}}},deserialize(t={}){var e,i,n;return{time:(e=t.object)==null?void 0:e.b,toggle:!!((i=t.data)!=null&&i.b),customData:(n=t.data)==null?void 0:n.customData}}},Je={serialize(t){return{f:t.type,p:t.p0,t:t.p1,r:t.reverse,c:t.chunks,n:t.random,s:t.seed,l:t.limit,d:t.limitAffectsType,customData:j(t.customData)}},deserialize(t={}){return{type:t.f,p0:t.p,p1:t.t,reverse:t.r,chunks:t.c,random:t.n,seed:t.s,limit:t.l,limitAffectsType:t.d,customData:t.customData}}},ia={serialize(t){return{data:{p:t.previous,c:t.color,e:t.easing,b:t.brightness,f:t.frequency,sb:t.strobeBrightness,sf:t.strobeFade,customData:j(t.customData)},time:t.time}},deserialize(t={}){var e,i,n,o,l,s,r,a;return{time:t.time,previous:(e=t.data)==null?void 0:e.p,color:(i=t.data)==null?void 0:i.c,frequency:(n=t.data)==null?void 0:n.f,easing:(o=t.data)==null?void 0:o.e,brightness:(l=t.data)==null?void 0:l.b,strobeBrightness:(s=t.data)==null?void 0:s.sb,strobeFade:(r=t.data)==null?void 0:r.sf,customData:(a=t.data)==null?void 0:a.customData}}},na={serialize(t){return{data:{w:t.beatDistribution,d:t.beatDistributionType,s:t.brightnessDistribution,t:t.brightnessDistributionType,b:t.affectFirst,e:t.easing,customData:j(t.customData)},eventData:t.events.map(ia.serialize),filterData:Je.serialize(t.filter)}},deserialize(t={}){var e,i,n,o,l,s,r,a;return{filter:Je.deserialize(t.filterData),beatDistribution:(e=t.data)==null?void 0:e.w,beatDistributionType:(i=t.data)==null?void 0:i.d,brightnessDistribution:(n=t.data)==null?void 0:n.s,brightnessDistributionType:(o=t.data)==null?void 0:o.t,affectFirst:(l=t.data)==null?void 0:l.b,easing:(s=t.data)==null?void 0:s.e,events:(r=t.eventData)==null?void 0:r.map(ia.deserialize),customData:(a=t.data)==null?void 0:a.customData}}},oa={serialize(t){return{object:{t:Be.COLOR,b:t.time,g:t.id,e:[],customData:j(t.customData)},boxData:t.boxes.map(na.serialize)}},deserialize(t={}){var e,i,n,o;return{time:(e=t.object)==null?void 0:e.b,id:(i=t.object)==null?void 0:i.g,boxes:(n=t.boxData)==null?void 0:n.map(na.deserialize),customData:(o=t.object)==null?void 0:o.customData}}},ra={serialize(t){return{data:{p:t.previous,l:t.loop,e:t.easing,r:t.rotation,d:t.direction,customData:j(t.customData)},time:t.time}},deserialize(t={}){var e,i,n,o,l,s;return{time:t.time,previous:(e=t.data)==null?void 0:e.p,easing:(i=t.data)==null?void 0:i.e,loop:(n=t.data)==null?void 0:n.l,rotation:(o=t.data)==null?void 0:o.r,direction:(l=t.data)==null?void 0:l.d,customData:(s=t.data)==null?void 0:s.customData}}},sa={serialize(t){return{data:{w:t.beatDistribution,d:t.beatDistributionType,s:t.rotationDistribution,t:t.rotationDistributionType,b:t.affectFirst,e:t.easing,a:t.axis,f:t.flip,customData:j(t.customData)},eventData:t.events.map(ra.serialize),filterData:Je.serialize(t.filter)}},deserialize(t={}){var e,i,n,o,l,s,r,a,u,f;return{filter:Je.deserialize(t.filterData),beatDistribution:(e=t.data)==null?void 0:e.w,beatDistributionType:(i=t.data)==null?void 0:i.d,rotationDistribution:(n=t.data)==null?void 0:n.s,rotationDistributionType:(o=t.data)==null?void 0:o.t,affectFirst:(l=t.data)==null?void 0:l.b,easing:(s=t.data)==null?void 0:s.e,axis:(r=t.data)==null?void 0:r.a,flip:(a=t.data)==null?void 0:a.f,events:(u=t.eventData)==null?void 0:u.map(ra.deserialize),customData:(f=t.data)==null?void 0:f.customData}}},aa={serialize(t){return{object:{t:Be.ROTATION,b:t.time,g:t.id,e:[],customData:j(t.customData)},boxData:t.boxes.map(sa.serialize)}},deserialize(t={}){var e,i,n,o;return{time:(e=t.object)==null?void 0:e.b,id:(i=t.object)==null?void 0:i.g,boxes:(n=t.boxData)==null?void 0:n.map(sa.deserialize),customData:(o=t.object)==null?void 0:o.customData}}},la={serialize(t){return{data:{p:t.previous,e:t.easing,t:t.translation,customData:j(t.customData)},time:t.time}},deserialize(t={}){var e,i,n,o;return{time:t.time,previous:(e=t.data)==null?void 0:e.p,easing:(i=t.data)==null?void 0:i.e,translation:(n=t.data)==null?void 0:n.t,customData:(o=t.data)==null?void 0:o.customData}}},ca={serialize(t){return{data:{w:t.beatDistribution,d:t.beatDistributionType,s:t.gapDistribution,t:t.gapDistributionType,b:t.affectFirst,e:t.easing,a:t.axis,f:t.flip,customData:j(t.customData)},eventData:t.events.map(la.serialize),filterData:Je.serialize(t.filter)}},deserialize(t={}){var e,i,n,o,l,s,r,a,u,f;return{filter:Je.deserialize(t.filterData),beatDistribution:(e=t.data)==null?void 0:e.w,beatDistributionType:(i=t.data)==null?void 0:i.d,gapDistribution:(n=t.data)==null?void 0:n.s,gapDistributionType:(o=t.data)==null?void 0:o.t,affectFirst:(l=t.data)==null?void 0:l.b,easing:(s=t.data)==null?void 0:s.e,axis:(r=t.data)==null?void 0:r.a,flip:(a=t.data)==null?void 0:a.f,events:(u=t.eventData)==null?void 0:u.map(la.deserialize),customData:(f=t.data)==null?void 0:f.customData}}},ua={serialize(t){return{object:{t:Be.TRANSLATION,b:t.time,g:t.id,e:[],customData:j(t.customData)},boxData:t.boxes.map(ca.serialize)}},deserialize(t={}){var e,i,n,o;return{time:(e=t.object)==null?void 0:e.b,id:(i=t.object)==null?void 0:i.g,boxes:(n=t.boxData)==null?void 0:n.map(ca.deserialize),customData:(o=t.object)==null?void 0:o.customData}}},ha={serialize(t){return{data:{p:t.previous,e:t.easing,v:t.value,customData:j(t.customData)},time:t.time}},deserialize(t={}){var e,i,n,o;return{time:t.time,previous:(e=t.data)==null?void 0:e.p,easing:(i=t.data)==null?void 0:i.e,value:(n=t.data)==null?void 0:n.v,customData:(o=t.data)==null?void 0:o.customData}}},ma={serialize(t){return{data:{w:t.beatDistribution,d:t.beatDistributionType,s:t.fxDistribution,t:t.fxDistributionType,b:t.affectFirst,e:t.easing,customData:j(t.customData)},eventData:t.events.map(ha.serialize),filterData:Je.serialize(t.filter)}},deserialize(t={}){var e,i,n,o,l,s,r,a;return{filter:Je.deserialize(t.filterData),beatDistribution:(e=t.data)==null?void 0:e.w,beatDistributionType:(i=t.data)==null?void 0:i.d,fxDistribution:(n=t.data)==null?void 0:n.s,fxDistributionType:(o=t.data)==null?void 0:o.t,affectFirst:(l=t.data)==null?void 0:l.b,easing:(s=t.data)==null?void 0:s.e,events:(r=t.eventData)==null?void 0:r.map(ha.deserialize),customData:(a=t.data)==null?void 0:a.customData}}},fa={serialize(t){return{object:{t:Be.FX_FLOAT,b:t.time,g:t.id,e:[],customData:j(t.customData)},boxData:t.boxes.map(ma.serialize)}},deserialize(t={}){var e,i,n,o;return{time:(e=t.object)==null?void 0:e.b,id:(i=t.object)==null?void 0:i.g,boxes:(n=t.boxData)==null?void 0:n.map(ma.deserialize),customData:(o=t.object)==null?void 0:o.customData}}},Lf={serialize(t){const e={version:"4.0.0",waypoints:[],waypointsData:[],basicEvents:[],basicEventsData:[],colorBoostEvents:[],colorBoostEventsData:[],eventBoxGroups:[],indexFilters:[],lightColorEventBoxes:[],lightColorEvents:[],lightRotationEventBoxes:[],lightRotationEvents:[],lightTranslationEventBoxes:[],lightTranslationEvents:[],fxEventBoxes:[],floatFxEvents:[],basicEventTypesWithKeywords:Gn.serialize(t.lightshow.eventTypesWithKeywords),useNormalEventsAsCompatibleEvents:t.lightshow.useNormalEventsAsCompatibleEvents,customData:j(t.difficulty.customData)};for(const i of t.lightshow.waypoints.map(Qs.serialize))e.waypoints.push(i.object),i.object.i=e.waypointsData.length,e.waypointsData.push(i.data);for(const i of t.lightshow.basicEvents.map(ta.serialize))e.basicEvents.push(i.object),i.object.i=e.basicEventsData.length,e.basicEventsData.push(i.data);for(const i of t.lightshow.colorBoostEvents.map(ea.serialize))e.colorBoostEvents.push(i.object),i.object.i=e.colorBoostEventsData.length,e.colorBoostEventsData.push(i.data);for(const i of t.lightshow.lightColorEventBoxGroups.map(oa.serialize)){e.eventBoxGroups.push(i.object);for(const n of i.boxData){const o=[];for(const l of n.eventData)o.push({b:l.time,i:e.lightColorEvents.length}),e.lightColorEvents.push(l.data);i.object.e.push({e:e.lightColorEventBoxes.length,f:e.indexFilters.length,l:o,customData:{}}),e.lightColorEventBoxes.push(n.data),e.indexFilters.push(n.filterData)}}for(const i of t.lightshow.lightRotationEventBoxGroups.map(aa.serialize)){e.eventBoxGroups.push(i.object);for(const n of i.boxData){const o=[];for(const l of n.eventData)o.push({b:l.time,i:e.lightRotationEvents.length}),e.lightRotationEvents.push(l.data);i.object.e.push({e:e.lightRotationEventBoxes.length,f:e.indexFilters.length,l:o,customData:{}}),e.lightRotationEventBoxes.push(n.data),e.indexFilters.push(n.filterData)}}for(const i of t.lightshow.lightTranslationEventBoxGroups.map(ua.serialize)){e.eventBoxGroups.push(i.object);for(const n of i.boxData){const o=[];for(const l of n.eventData)o.push({b:l.time,i:e.lightTranslationEvents.length}),e.lightTranslationEvents.push(l.data);i.object.e.push({e:e.lightTranslationEventBoxes.length,f:e.indexFilters.length,l:o,customData:{}}),e.lightTranslationEventBoxes.push(n.data),e.indexFilters.push(n.filterData)}}for(const i of t.lightshow.fxEventBoxGroups.map(fa.serialize)){e.eventBoxGroups.push(i.object);for(const n of i.boxData){const o=[];for(const l of n.eventData)o.push({b:l.time,i:e.floatFxEvents.length}),e.floatFxEvents.push(l.data);i.object.e.push({e:e.fxEventBoxes.length,f:e.indexFilters.length,l:o,customData:{}}),e.fxEventBoxes.push(n.data),e.indexFilters.push(n.filterData)}}return e},deserialize(t={}){var m,h,c,g,d,v,_;const e={version:4,lightshow:{lightColorEventBoxGroups:[],lightRotationEventBoxGroups:[],lightTranslationEventBoxGroups:[],fxEventBoxGroups:[]}};e.lightshow.waypoints=(m=t.waypoints)==null?void 0:m.map(y=>{var S;return Qs.deserialize({object:y,data:(S=t.waypointsData)==null?void 0:S[(y==null?void 0:y.i)||0]})}),e.lightshow.basicEvents=(h=t.basicEvents)==null?void 0:h.map(y=>{var S;return ta.deserialize({object:y,data:(S=t.basicEventsData)==null?void 0:S[(y==null?void 0:y.i)||0]})}),e.lightshow.colorBoostEvents=(c=t.colorBoostEvents)==null?void 0:c.map(y=>{var S;return ea.deserialize({object:y,data:(S=t.colorBoostEventsData)==null?void 0:S[(y==null?void 0:y.i)||0]})});const i=t.indexFilters??[],n=t.lightColorEventBoxes??[],o=t.lightColorEvents??[],l=t.lightRotationEventBoxes??[],s=t.lightRotationEvents??[],r=t.lightTranslationEventBoxes??[],a=t.lightTranslationEvents??[],u=t.fxEventBoxes??[],f=t.floatFxEvents??[];for(const y of t.eventBoxGroups||[])switch((y==null?void 0:y.t)||0){case Be.COLOR:e.lightshow.lightColorEventBoxGroups.push(oa.deserialize({object:y,boxData:(g=y==null?void 0:y.e)==null?void 0:g.map(w=>{var k;return{data:n[w.e||0],filterData:i[w.f||0],eventData:(k=w.l)==null?void 0:k.map(O=>({time:O.b,data:o[O.i||0]}))}})}));break;case Be.ROTATION:e.lightshow.lightRotationEventBoxGroups.push(aa.deserialize({object:y,boxData:(d=y==null?void 0:y.e)==null?void 0:d.map(w=>{var k;return{data:l[w.e||0],filterData:i[w.f||0],eventData:(k=w.l)==null?void 0:k.map(O=>({time:O.b,data:s[O.i||0]}))}})}));break;case Be.TRANSLATION:e.lightshow.lightTranslationEventBoxGroups.push(ua.deserialize({object:y,boxData:(v=y==null?void 0:y.e)==null?void 0:v.map(w=>{var k;return{data:r[w.e||0],filterData:i[w.f||0],eventData:(k=w.l)==null?void 0:k.map(O=>({time:O.b,data:a[O.i||0]}))}})}));break;case Be.FX_FLOAT:e.lightshow.fxEventBoxGroups.push(fa.deserialize({object:y,boxData:(_=y==null?void 0:y.e)==null?void 0:_.map(w=>{var k;return{data:u[w.e||0],filterData:i[w.f||0],eventData:(k=w.l)==null?void 0:k.map(O=>({time:O.b,data:f[O.i||0]}))}})}));break}return e.lightshow.eventTypesWithKeywords=Gn.deserialize(t.basicEventTypesWithKeywords),e.lightshow.useNormalEventsAsCompatibleEvents=!!t.useNormalEventsAsCompatibleEvents,e.lightshow.customData=t.customData,e}},Rf={1:bf,2:vf,4:_f},xf={2:yf,4:Ef},Bf={1:Df,2:Sf,3:wf,4:kf},If={3:Tf,4:Lf};function vu(t){return["helpers","dataCheck",t]}function se(t,e,i){if(e)throw new Error(t);J.tWarn(vu("deepCheck"),t),i.push(t)}function yn(t,e,i,n,o,l=[]){if(J.tVerbose(vu("deepCheck"),`Looking up ${i}`),Array.isArray(t)){for(let r=0;r<t.length;r++)yn(t[r],e,`${i}[${r}]`,n,o,l);return l}const s=Object.keys(e);if(!s.length)return l;for(const r in t)r in e||se(`Unused key ${r} found in ${i}`,o.unused,l);for(let r=0;r<s.length;r++){const a=s[r],u=e[a],f=t[a];if(f===void 0){if(!o.ignoreOptional&&e[a].optional||pf(n,u.version)===-1)continue;se(`Missing ${a} in object ${i}!`,o.missing,l);continue}if(f===null){se(`${a} contain null value in object ${i}!`,o.nullish,l);continue}if(u.type==="array"){Array.isArray(f)||se(`${a} is not an array in object ${i}!`,o.wrongType,l),yn(f,u.check,`${i}.${a}`,n,o,l);continue}if(u.type==="object"){!Array.isArray(f)&&typeof f!="object"?se(`${a} is not an object in object ${i}!`,o.wrongType,l):yn(f,u.check,`${i}.${a}`,n,o,l);continue}if(u.array){if(!Array.isArray(f)){se(`${a} is not ${u.type} in object ${i}!`,o.wrongType,l);continue}f.every(m=>typeof m===u.type||u.type==="number"&&typeof m=="number"&&(isNaN(m)||(u.int?m%1!==0:!0)&&(u.unsigned?m<0:!0)))||se(`${a} is not ${u.type} in object ${i}!`,o.wrongType,l);continue}if(!u.array&&typeof f!==u.type){se(`${a} is not ${u.type} in object ${i}!`,o.wrongType,l);continue}if(u.type==="number"){if(isNaN(f)){se(`${i}.${a} is NaN!`,o.nullish,l);continue}if(u.int&&f%1!==0){se(`${i}.${a} cannot be float!`,o.notInt,l);continue}if(u.unsigned&&f<0){se(`${i}.${a} cannot be negative!`,o.notUnsigned,l);continue}}}return l}const Nf={_time:{type:"number",version:"1.5.0"},_type:{type:"number",int:!0,unsigned:!0,version:"1.5.0"},_lineIndex:{type:"number",int:!0,version:"1.5.0"},_lineLayer:{type:"number",int:!0,version:"1.5.0"},_cutDirection:{type:"number",int:!0,unsigned:!0,version:"1.5.0"}},Af={_time:{type:"number",version:"1.5.0"},_lineIndex:{type:"number",int:!0,version:"1.5.0"},_type:{type:"number",int:!0,unsigned:!0,version:"1.5.0"},_duration:{type:"number",version:"1.5.0"},_width:{type:"number",int:!0,version:"1.5.0"}},Of={_time:{type:"number",version:"1.5.0"},_type:{type:"number",int:!0,version:"1.5.0"},_value:{type:"number",int:!0,version:"1.5.0"}},$f={_version:{type:"string",version:"1.5.0"},_beatsPerMinute:{type:"number",version:"1.5.0"},_beatsPerBar:{type:"number",version:"1.5.0"},_shuffle:{type:"number",version:"1.5.0"},_shufflePeriod:{type:"number",version:"1.5.0"},_noteJumpSpeed:{type:"number",version:"1.5.0",optional:!0},_noteJumpStartBeatOffset:{type:"number",version:"1.5.0",optional:!0},_notes:{type:"array",version:"1.5.0",check:Nf},_obstacles:{type:"array",version:"1.5.0",check:Af},_events:{type:"array",version:"1.5.0",check:Of},_time:{type:"number",version:"1.5.0",optional:!0},_BPMChanges:{type:"array",version:"1.5.0",optional:!0,check:{}},_bookmarks:{type:"array",version:"1.5.0",optional:!0,check:{}}},Pf={difficulty:{type:"string",version:"1.0.0"},difficultyRank:{type:"number",version:"1.0.0"},audioPath:{type:"string",version:"1.0.0"},jsonPath:{type:"string",version:"1.0.0"},characteristic:{type:"string",version:"1.0.0"},offset:{type:"number",version:"1.0.0",optional:!0},oldOffset:{type:"number",version:"1.0.0",optional:!0},chromaToggle:{type:"string",version:"1.0.0",optional:!0},customColors:{type:"boolean",version:"1.0.0",optional:!0},difficultyLabel:{type:"string",version:"1.0.0",optional:!0},colorLeft:{type:"object",version:"1.0.0",check:{},optional:!0},colorRight:{type:"object",version:"1.0.0",check:{},optional:!0},envColorLeft:{type:"object",version:"1.0.0",check:{},optional:!0},envColorRight:{type:"object",version:"1.0.0",check:{},optional:!0},obstacleColor:{type:"object",version:"1.0.0",check:{},optional:!0}},Mf={songName:{type:"string",version:"1.0.0"},songSubName:{type:"string",version:"1.0.0"},authorName:{type:"string",version:"1.0.0"},beatsPerMinute:{type:"number",version:"1.0.0"},previewStartTime:{type:"number",version:"1.0.0"},previewDuration:{type:"number",version:"1.0.0"},coverImagePath:{type:"string",version:"1.0.0"},environmentName:{type:"string",version:"1.0.0"},difficultyLevels:{type:"array",version:"1.0.0",check:Pf},oneSaber:{type:"boolean",version:"1.0.0",optional:!0},contributors:{type:"array",version:"1.0.0",optional:!0,check:{}},customEnvironment:{type:"string",version:"1.0.0",optional:!0},customEnvironmentHash:{type:"string",version:"1.0.0",optional:!0}},Ff={_time:{type:"number",version:"2.0.0",optional:!0},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_lineIndex:{type:"number",int:!0,version:"2.0.0",optional:!0},_lineLayer:{type:"number",int:!0,version:"2.0.0",optional:!0},_cutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},zf={_colorType:{type:"number",version:"2.0.0",optional:!0},_headTime:{type:"number",version:"2.0.0",optional:!0},_headLineIndex:{type:"number",int:!0,version:"2.0.0",optional:!0},_headLineLayer:{type:"number",int:!0,version:"2.0.0",optional:!0},_headCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_headControlPointLengthMultiplier:{type:"number",version:"2.0.0",optional:!0},_tailTime:{type:"number",version:"2.0.0",optional:!0},_tailLineIndex:{type:"number",int:!0,version:"2.0.0",optional:!0},_tailLineLayer:{type:"number",int:!0,version:"2.0.0",optional:!0},_tailCutDirection:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_tailControlPointLengthMultiplier:{type:"number",version:"2.0.0",optional:!0},_sliderMidAnchorMode:{type:"number",version:"2.0.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Vf={_time:{type:"number",version:"2.0.0",optional:!0},_lineIndex:{type:"number",int:!0,version:"2.0.0",optional:!0},_type:{type:"number",int:!0,unsigned:!0,version:"2.0.0",optional:!0},_duration:{type:"number",version:"2.0.0",optional:!0},_width:{type:"number",int:!0,version:"2.0.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Gf={_time:{type:"number",version:"2.0.0",optional:!0},_type:{type:"number",int:!0,version:"2.0.0",optional:!0},_value:{type:"number",int:!0,version:"2.0.0",optional:!0},_floatValue:{type:"number",version:"2.5.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Hf={_time:{type:"number",version:"2.2.0",optional:!0},_lineIndex:{type:"number",int:!0,version:"2.2.0",optional:!0},_lineLayer:{type:"number",int:!0,version:"2.2.0",optional:!0},_offsetDirection:{type:"number",int:!0,version:"2.2.0",optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Uf={_keyword:{type:"string",version:"2.4.0",optional:!0},_specialEvents:{type:"number",int:!0,array:!0,version:"2.4.0",optional:!0}},jf={_keywords:{type:"array",version:"2.4.0",check:Uf,optional:!0}},Wf={_version:{type:"string",version:"2.0.0",optional:!0},_notes:{type:"array",version:"2.0.0",check:Ff,optional:!0},_sliders:{type:"array",version:"2.6.0",check:zf,optional:!0},_obstacles:{type:"array",version:"2.0.0",check:Vf,optional:!0},_events:{type:"array",version:"2.0.0",check:Gf,optional:!0},_waypoints:{type:"array",version:"2.2.0",check:Hf,optional:!0},_specialEventsKeywordFilters:{type:"object",version:"2.4.0",check:jf,optional:!0},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Xf={_difficulty:{type:"string",version:"2.0.0"},_difficultyRank:{type:"number",version:"2.0.0"},_beatmapFilename:{type:"string",version:"2.0.0"},_noteJumpMovementSpeed:{type:"number",version:"2.0.0"},_noteJumpStartBeatOffset:{type:"number",version:"2.0.0"},_beatmapColorSchemeIdx:{type:"number",version:"2.1.0"},_environmentNameIdx:{type:"number",version:"2.1.0"},_customData:{type:"object",version:"2.0.0",check:{},optional:!0}},Yf={_beatmapCharacteristicName:{type:"string",version:"2.0.0"},_difficultyBeatmaps:{type:"array",version:"2.0.0",check:Xf}},ei={r:{type:"number",version:"2.1.0"},g:{type:"number",version:"2.1.0"},b:{type:"number",version:"2.1.0"},a:{type:"number",version:"2.1.0"}},qf={colorSchemeId:{type:"string",version:"2.1.0"},saberAColor:{type:"object",version:"2.1.0",check:ei},saberBColor:{type:"object",version:"2.1.0",check:ei},environmentColor0:{type:"object",version:"2.1.0",check:ei},environmentColor1:{type:"object",version:"2.1.0",check:ei},obstaclesColor:{type:"object",version:"2.1.0",check:ei},environmentColor0Boost:{type:"object",version:"2.1.0",check:ei},environmentColor1Boost:{type:"object",version:"2.1.0",check:ei}},Kf={useOverride:{type:"boolean",version:"2.1.0"},colorScheme:{type:"object",version:"2.1.0",check:qf}},Zf={_version:{type:"string",version:"2.0.0",optional:!0},_songName:{type:"string",version:"2.0.0"},_songSubName:{type:"string",version:"2.0.0"},_songAuthorName:{type:"string",version:"2.0.0"},_levelAuthorName:{type:"string",version:"2.0.0"},_beatsPerMinute:{type:"number",version:"2.0.0"},_songTimeOffset:{type:"number",version:"2.0.0"},_shuffle:{type:"number",version:"2.0.0"},_shufflePeriod:{type:"number",version:"2.0.0"},_previewStartTime:{type:"number",version:"2.0.0"},_previewDuration:{type:"number",version:"2.0.0"},_songFilename:{type:"string",version:"2.0.0"},_coverImageFilename:{type:"string",version:"2.0.0"},_environmentName:{type:"string",version:"2.0.0"},_allDirectionsEnvironmentName:{type:"string",version:"2.0.0",optional:!0},_environmentNames:{type:"string",version:"2.1.0",array:!0},_colorSchemes:{type:"array",version:"2.1.0",check:Kf},_customData:{type:"object",version:"2.0.0",check:{},optional:!0},_difficultyBeatmapSets:{type:"array",version:"2.0.0",check:Yf}},Jf={_startSampleIndex:{type:"number",version:"2.0.0",int:!0,unsigned:!0},_endSampleIndex:{type:"number",version:"2.0.0",int:!0,unsigned:!0},_startBeat:{type:"number",version:"2.0.0"},_endBeat:{type:"number",version:"2.0.0"}},Qf={_version:{type:"string",version:"2.0.0"},_songSampleCount:{type:"number",version:"2.0.0",int:!0,unsigned:!0},_songFrequency:{type:"number",version:"2.0.0",int:!0,unsigned:!0},_regions:{type:"object",version:"2.0.0",check:Jf,array:!0}},tp={b:{type:"number",version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},a:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ep={b:{type:"number",version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ip={b:{type:"number",version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},mu:{type:"number",version:"3.0.0",optional:!0},tb:{type:"number",version:"3.0.0",optional:!0},tx:{type:"number",int:!0,version:"3.0.0",optional:!0},ty:{type:"number",int:!0,version:"3.0.0",optional:!0},tc:{type:"number",int:!0,version:"3.0.0",optional:!0},tmu:{type:"number",version:"3.0.0",optional:!0},m:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},np={b:{type:"number",version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},tb:{type:"number",version:"3.0.0",optional:!0},tx:{type:"number",int:!0,version:"3.0.0",optional:!0},ty:{type:"number",int:!0,version:"3.0.0",optional:!0},sc:{type:"number",int:!0,version:"3.0.0",optional:!0},s:{type:"number",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},op={b:{type:"number",version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},d:{type:"number",version:"3.0.0",optional:!0},w:{type:"number",int:!0,version:"3.0.0",optional:!0},h:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},_u={b:{type:"number",version:"3.0.0",optional:!0},et:{type:"number",int:!0,version:"3.0.0",optional:!0},i:{type:"number",int:!0,version:"3.0.0",optional:!0},f:{type:"number",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},rp={b:{type:"number",version:"3.0.0",optional:!0},m:{type:"number",version:"3.0.0"},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},sp={b:{type:"number",version:"3.0.0",optional:!0},e:{type:"number",int:!0,version:"3.0.0",optional:!0},r:{type:"number",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},yu={b:{type:"number",version:"3.0.0",optional:!0},o:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},io={f:{type:"number",int:!0,version:"3.0.0",optional:!0},p:{type:"number",version:"3.0.0",optional:!0},t:{type:"number",version:"3.0.0",optional:!0},r:{type:"number",int:!0,version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.1.0",optional:!0},l:{type:"number",version:"3.1.0",optional:!0},d:{type:"number",int:!0,version:"3.1.0",optional:!0},n:{type:"number",int:!0,version:"3.1.0",optional:!0},s:{type:"number",int:!0,version:"3.1.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},ap={b:{type:"number",version:"3.0.0",optional:!0},c:{type:"number",int:!0,version:"3.0.0",optional:!0},f:{type:"number",version:"3.0.0",optional:!0},i:{type:"number",int:!0,version:"3.0.0",optional:!0},s:{type:"number",version:"3.0.0",optional:!0},sb:{type:"number",version:"3.3.0",optional:!0},sf:{type:"number",int:!0,version:"3.3.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},lp={f:{type:"object",version:"3.0.0",check:io,optional:!0},w:{type:"number",version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},r:{type:"number",version:"3.0.0",optional:!0},t:{type:"number",int:!0,version:"3.0.0",optional:!0},e:{type:"array",version:"3.0.0",check:ap,optional:!0},b:{type:"number",int:!0,version:"3.0.0",optional:!0},i:{type:"number",int:!0,version:"3.2.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Eu={b:{type:"number",version:"3.0.0",optional:!0},g:{type:"number",int:!0,version:"3.0.0",optional:!0},e:{type:"array",version:"3.0.0",check:lp,optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},cp={b:{type:"number",version:"3.0.0",optional:!0},p:{type:"number",int:!0,version:"3.0.0",optional:!0},e:{type:"number",int:!0,version:"3.0.0",optional:!0},l:{type:"number",version:"3.0.0",optional:!0},r:{type:"number",version:"3.0.0",optional:!0},o:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},up={f:{type:"object",version:"3.0.0",check:io,optional:!0},w:{type:"number",version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},s:{type:"number",version:"3.0.0",optional:!0},t:{type:"number",int:!0,version:"3.0.0",optional:!0},a:{type:"number",int:!0,version:"3.0.0",optional:!0},l:{type:"array",version:"3.0.0",check:cp,optional:!0},r:{type:"number",int:!0,version:"3.0.0",optional:!0},b:{type:"number",int:!0,version:"3.0.0",optional:!0},i:{type:"number",int:!0,version:"3.2.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Du={b:{type:"number",version:"3.0.0",optional:!0},g:{type:"number",int:!0,version:"3.0.0",optional:!0},e:{type:"array",version:"3.0.0",check:up,optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},hp={b:{type:"number",version:"3.2.0",optional:!0},p:{type:"number",int:!0,version:"3.2.0",optional:!0},e:{type:"number",int:!0,version:"3.2.0",optional:!0},t:{type:"number",version:"3.2.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},mp={f:{type:"object",version:"3.2.0",check:io,optional:!0},w:{type:"number",version:"3.2.0",optional:!0},d:{type:"number",int:!0,version:"3.2.0",optional:!0},s:{type:"number",version:"3.2.0",optional:!0},t:{type:"number",int:!0,version:"3.2.0",optional:!0},a:{type:"number",int:!0,version:"3.2.0",optional:!0},l:{type:"array",version:"3.2.0",check:hp,optional:!0},r:{type:"number",int:!0,version:"3.2.0",optional:!0},b:{type:"number",int:!0,version:"3.2.0",optional:!0},i:{type:"number",int:!0,version:"3.2.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Cu={b:{type:"number",version:"3.2.0",optional:!0},g:{type:"number",int:!0,version:"3.2.0",optional:!0},e:{type:"array",version:"3.2.0",check:mp,optional:!0},customData:{type:"object",version:"3.2.0",check:{},optional:!0}},fp={f:{type:"object",version:"3.3.0",check:io,optional:!0},w:{type:"number",version:"3.3.0",optional:!0},d:{type:"number",int:!0,version:"3.3.0",optional:!0},s:{type:"number",version:"3.3.0",optional:!0},t:{type:"number",int:!0,version:"3.3.0",optional:!0},l:{type:"number",int:!0,array:!0,version:"3.3.0",optional:!0},b:{type:"number",int:!0,version:"3.3.0",optional:!0},i:{type:"number",int:!0,version:"3.3.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Su={b:{type:"number",version:"3.3.0",optional:!0},g:{type:"number",int:!0,version:"3.3.0",optional:!0},e:{type:"array",version:"3.3.0",check:fp,optional:!0},t:{type:"number",int:!0,version:"3.3.0",optional:!0},customData:{type:"object",version:"3.3.0",check:{},optional:!0}},pp={k:{type:"string",version:"3.0.0",optional:!0},e:{type:"number",int:!0,array:!0,version:"3.0.0",optional:!0}},wu={d:{type:"array",version:"3.0.0",check:pp,optional:!0}},dp={b:{type:"number",version:"3.3.0",optional:!0},i:{type:"number",int:!0,version:"3.3.0",optional:!0},p:{type:"number",int:!0,version:"3.3.0",optional:!0},v:{type:"number",version:"3.3.0",optional:!0},customData:{type:"object",version:"3.3.0",check:{},optional:!0}},gp={b:{type:"number",version:"3.3.0",optional:!0},p:{type:"number",int:!0,version:"3.3.0",optional:!0},v:{type:"number",int:!0,version:"3.3.0",optional:!0},customData:{type:"object",version:"3.3.0",check:{},optional:!0}},ku={_fl:{type:"array",version:"3.3.0",check:dp,optional:!0},_il:{type:"array",version:"3.3.0",check:gp,optional:!0}},bp={b:{type:"number",version:"3.0.0",optional:!0},d:{type:"number",int:!0,version:"3.0.0",optional:!0},x:{type:"number",int:!0,version:"3.0.0",optional:!0},y:{type:"number",int:!0,version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},vp={version:{type:"string",version:"3.0.0",optional:!0},bpmEvents:{type:"array",version:"3.0.0",check:rp,optional:!0},rotationEvents:{type:"array",version:"3.0.0",check:sp,optional:!0},colorNotes:{type:"array",version:"3.0.0",check:tp,optional:!0},bombNotes:{type:"array",version:"3.0.0",check:ep,optional:!0},obstacles:{type:"array",version:"3.0.0",check:op,optional:!0},sliders:{type:"array",version:"3.0.0",check:ip,optional:!0},burstSliders:{type:"array",version:"3.0.0",check:np,optional:!0},waypoints:{type:"array",version:"3.0.0",check:bp,optional:!0},basicBeatmapEvents:{type:"array",version:"3.0.0",check:_u,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:yu,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:Eu,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:Du,optional:!0},lightTranslationEventBoxGroups:{type:"array",version:"3.2.0",check:Cu,optional:!0},vfxEventBoxGroups:{type:"array",version:"3.3.0",check:Su,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"3.0.0",check:wu,optional:!0},_fxEventsCollection:{type:"object",version:"3.3.0",check:ku,optional:!0},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"3.0.0",optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},_p={basicBeatmapEvents:{type:"array",version:"3.0.0",check:_u,optional:!0},colorBoostBeatmapEvents:{type:"array",version:"3.0.0",check:yu,optional:!0},lightColorEventBoxGroups:{type:"array",version:"3.0.0",check:Eu,optional:!0},lightRotationEventBoxGroups:{type:"array",version:"3.0.0",check:Du,optional:!0},lightTranslationEventBoxGroups:{type:"array",version:"3.2.0",check:Cu,optional:!0},vfxEventBoxGroups:{type:"array",version:"3.3.0",check:Su,optional:!0},_fxEventsCollection:{type:"object",version:"3.3.0",check:ku,optional:!0},customData:{type:"object",version:"3.0.0",check:{},optional:!0}},Ao={b:{type:"number",version:"4.0.0",optional:!0},i:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},En={b:{type:"number",version:"4.0.0",optional:!0},i:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},r:{type:"number",version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},yp={hb:{type:"number",version:"4.0.0",optional:!0},hr:{type:"number",version:"4.0.0",optional:!0},tb:{type:"number",version:"4.0.0",optional:!0},tr:{type:"number",version:"4.0.0",optional:!0},i:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},ci:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},pa={hb:{type:"number",version:"4.0.0",optional:!0},hi:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},hr:{type:"number",version:"4.0.0",optional:!0},tb:{type:"number",version:"4.0.0",optional:!0},ti:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},tr:{type:"number",version:"4.0.0",optional:!0},ai:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Ep={x:{type:"number",int:!0,version:"4.0.0",optional:!0},y:{type:"number",int:!0,version:"4.0.0",optional:!0},a:{type:"number",int:!0,version:"4.0.0",optional:!0},c:{type:"number",int:!0,version:"4.0.0",optional:!0},d:{type:"number",int:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Dp={x:{type:"number",int:!0,version:"4.0.0",optional:!0},y:{type:"number",int:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Cp={x:{type:"number",int:!0,version:"4.0.0",optional:!0},y:{type:"number",int:!0,version:"4.0.0",optional:!0},d:{type:"number",version:"4.0.0",optional:!0},w:{type:"number",int:!0,version:"4.0.0",optional:!0},h:{type:"number",int:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Sp={tx:{type:"number",int:!0,version:"4.0.0",optional:!0},ty:{type:"number",int:!0,version:"4.0.0",optional:!0},c:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},s:{type:"number",version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},wp={m:{type:"number",version:"4.0.0",optional:!0},tm:{type:"number",version:"4.0.0",optional:!0},a:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},kp={e:{type:"number",int:!0,version:"4.0.0",optional:!0},r:{type:"number",version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Tp={version:{type:"string",version:"4.0.0"},colorNotes:{type:"object",array:!0,version:"4.0.0",check:En,optional:!0},bombNotes:{type:"object",array:!0,version:"4.0.0",check:En,optional:!0},obstacles:{type:"object",array:!0,version:"4.0.0",check:En,optional:!0},chains:{type:"object",array:!0,version:"4.0.0",check:yp,optional:!0},arcs:{type:"object",array:!0,version:"4.0.0",check:pa,optional:!0},spawnRotations:{type:"object",array:!0,version:"4.0.0",check:pa,optional:!0},colorNotesData:{type:"object",array:!0,version:"4.0.0",check:Ep,optional:!0},bombNotesData:{type:"object",array:!0,version:"4.0.0",check:Dp,optional:!0},obstaclesData:{type:"object",array:!0,version:"4.0.0",check:Cp,optional:!0},chainsData:{type:"object",array:!0,version:"4.0.0",check:Sp,optional:!0},arcsData:{type:"object",array:!0,version:"4.0.0",check:wp,optional:!0},spawnRotationsData:{type:"object",array:!0,version:"4.0.0",check:kp,optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Lp={x:{type:"number",int:!0,version:"4.0.0",optional:!0},y:{type:"number",int:!0,version:"4.0.0",optional:!0},d:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Rp={t:{type:"number",int:!0,version:"4.0.0",optional:!0},i:{type:"number",int:!0,version:"4.0.0",optional:!0},f:{type:"number",version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},xp={b:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Bp={e:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},f:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},l:{type:"object",array:!0,version:"4.0.0",check:Ao,optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Ip={t:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},b:{type:"number",version:"4.0.0",optional:!0},g:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},e:{type:"object",array:!0,version:"4.0.0",check:Bp,optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Np={f:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},p:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},t:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},r:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},c:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},n:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},s:{type:"number",int:!0,version:"4.0.0",optional:!0},l:{type:"number",unsigned:!0,version:"4.0.0",optional:!0},d:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Ap={w:{type:"number",version:"4.0.0",optional:!0},d:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},s:{type:"number",version:"4.0.0",optional:!0},t:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},b:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},e:{type:"number",int:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Op={p:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},c:{type:"number",int:!0,version:"4.0.0",optional:!0},e:{type:"number",int:!0,version:"4.0.0",optional:!0},b:{type:"number",version:"4.0.0",optional:!0},f:{type:"number",int:!0,version:"4.0.0",optional:!0},sb:{type:"number",version:"4.0.0",optional:!0},sf:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},$p={w:{type:"number",version:"4.0.0",optional:!0},d:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},s:{type:"number",version:"4.0.0",optional:!0},t:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},b:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},e:{type:"number",int:!0,version:"4.0.0",optional:!0},a:{type:"number",int:!0,version:"4.0.0",optional:!0},f:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Pp={p:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},e:{type:"number",int:!0,version:"4.0.0",optional:!0},l:{type:"number",int:!0,version:"4.0.0",optional:!0},r:{type:"number",version:"4.0.0",optional:!0},d:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Mp={w:{type:"number",version:"4.0.0",optional:!0},d:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},s:{type:"number",version:"4.0.0",optional:!0},t:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},b:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},e:{type:"number",int:!0,version:"4.0.0",optional:!0},a:{type:"number",int:!0,version:"4.0.0",optional:!0},f:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Fp={p:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},e:{type:"number",int:!0,version:"4.0.0",optional:!0},t:{type:"number",version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},zp={w:{type:"number",version:"4.0.0",optional:!0},d:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},s:{type:"number",version:"4.0.0",optional:!0},t:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},b:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},e:{type:"number",int:!0,version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Vp={p:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},e:{type:"number",int:!0,version:"4.0.0",optional:!0},v:{type:"number",version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Gp={version:{type:"string",version:"4.0.0"},waypoints:{type:"object",array:!0,version:"4.0.0",check:En,optional:!0},waypointsData:{type:"object",array:!0,version:"4.0.0",check:Lp,optional:!0},basicEvents:{type:"object",array:!0,version:"4.0.0",check:Ao,optional:!0},basicEventsData:{type:"object",array:!0,version:"4.0.0",check:Rp,optional:!0},colorBoostEvents:{type:"object",array:!0,version:"4.0.0",check:Ao,optional:!0},colorBoostEventsData:{type:"object",array:!0,version:"4.0.0",check:xp,optional:!0},eventBoxGroups:{type:"object",array:!0,version:"4.0.0",check:Ip,optional:!0},indexFilters:{type:"object",array:!0,version:"4.0.0",check:Np,optional:!0},lightColorEventBoxes:{type:"object",array:!0,version:"4.0.0",check:Ap,optional:!0},lightColorEvents:{type:"object",array:!0,version:"4.0.0",check:Op,optional:!0},lightRotationEventBoxes:{type:"object",array:!0,version:"4.0.0",check:$p,optional:!0},lightRotationEvents:{type:"object",array:!0,version:"4.0.0",check:Pp,optional:!0},lightTranslationEventBoxes:{type:"object",array:!0,version:"4.0.0",check:Mp,optional:!0},lightTranslationEvents:{type:"object",array:!0,version:"4.0.0",check:Fp,optional:!0},fxEventBoxes:{type:"object",array:!0,version:"4.0.0",check:zp,optional:!0},floatFxEvents:{type:"object",array:!0,version:"4.0.0",check:Vp,optional:!0},basicEventTypesWithKeywords:{type:"object",version:"4.0.0",check:wu},useNormalEventsAsCompatibleEvents:{type:"boolean",version:"4.0.0",optional:!0},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Hp={title:{type:"string",version:"4.0.0",optional:!0},subTitle:{type:"string",version:"4.0.0",optional:!0},author:{type:"string",version:"4.0.0",optional:!0}},Up={songFilename:{type:"string",version:"4.0.0",optional:!0},songDuration:{type:"number",version:"4.0.0",optional:!0},audioDataFilename:{type:"string",version:"4.0.0",optional:!0},bpm:{type:"number",version:"4.0.0"},lufs:{type:"number",version:"4.0.0"},previewStartTime:{type:"number",version:"4.0.0",optional:!0},previewDuration:{type:"number",version:"4.0.0",optional:!0}},jp={colorSchemeName:{type:"string",version:"4.0.0",optional:!0},saberAColor:{type:"string",version:"4.0.0",optional:!0},saberBColor:{type:"string",version:"4.0.0",optional:!0},obstaclesColor:{type:"string",version:"4.0.0",optional:!0},environmentColor0:{type:"string",version:"4.0.0",optional:!0},environmentColor1:{type:"string",version:"4.0.0",optional:!0},environmentColorW:{type:"string",version:"4.0.0",optional:!0},environmentColor0Boost:{type:"string",version:"4.0.0",optional:!0},environmentColor1Boost:{type:"string",version:"4.0.0",optional:!0},environmentColorWBoost:{type:"string",version:"4.0.0",optional:!0}},Wp={mappers:{type:"string",array:!0,version:"4.0.0"},lighters:{type:"string",array:!0,version:"4.0.0"}},Xp={characteristic:{type:"string",version:"4.0.0",optional:!0},difficulty:{type:"string",version:"4.0.0",optional:!0},beatmapAuthors:{type:"object",version:"4.0.0",check:Wp},environmentNameIdx:{type:"number",int:!0,unsigned:!0,version:"4.0.0",optional:!0},beatmapColorSchemeIdx:{type:"number",int:!0,version:"4.0.0",optional:!0},noteJumpMovementSpeed:{type:"number",version:"4.0.0",optional:!0},noteJumpStartBeatOffset:{type:"number",version:"4.0.0",optional:!0},lightshowDataFilename:{type:"string",version:"4.0.0",optional:!0},beatmapDataFilename:{type:"string",version:"4.0.0"},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},Yp={version:{type:"string",version:"4.0.0"},song:{type:"object",version:"4.0.0",check:Hp},audio:{type:"object",version:"4.0.0",check:Up},songPreviewFilename:{type:"string",version:"4.0.0",optional:!0},coverImageFilename:{type:"string",version:"4.0.0",optional:!0},environmentNames:{type:"string",array:!0,version:"4.0.0"},colorSchemes:{type:"object",array:!0,version:"4.0.0",check:jp},difficultyBeatmaps:{type:"object",array:!0,version:"4.0.0",check:Xp},customData:{type:"object",version:"4.0.0",check:{},optional:!0}},qp={si:{type:"number",version:"4.0.0",int:!0,unsigned:!0},ei:{type:"number",version:"4.0.0",int:!0,unsigned:!0},sb:{type:"number",version:"4.0.0"},eb:{type:"number",version:"4.0.0"}},Kp={si:{type:"number",version:"4.0.0",int:!0,unsigned:!0},ei:{type:"number",version:"4.0.0",int:!0,unsigned:!0},l:{type:"number",version:"4.0.0"}},Zp={version:{type:"string",version:"4.0.0"},songChecksum:{type:"string",version:"4.0.0"},songSampleCount:{type:"number",version:"4.0.0",int:!0,unsigned:!0},songFrequency:{type:"number",version:"4.0.0",int:!0,unsigned:!0},bpmData:{type:"object",version:"4.0.0",check:qp,array:!0},lufsData:{type:"object",version:"4.0.0",check:Kp,array:!0}},Jp={1:Mf,2:Zf,4:Yp},Qp={2:Qf,4:Zp},td={1:$f,2:Wf,3:vp,4:Tp},ed={3:_p,4:Gp};function id(t){return["validator",t]}const da={enabled:!0,throwOn:{unused:!1,missing:!0,ignoreOptional:!1,nullish:!0,wrongType:!0,notInt:!1,notUnsigned:!1}};function nd(t,e,i,n){const o={enabled:(n==null?void 0:n.enabled)??da.enabled,throwOn:{...da.throwOn,...n==null?void 0:n.throwOn}};let l={};switch(t){case"info":l=Jp;break;case"audioData":l=Qp;break;case"difficulty":l=td;break;case"lightshow":l=ed;break}const s=bu(e)??gu(t);return J.tInfo(id("validateJSON"),"Validating beatmap JSON for "+t+" with version",i),yn(e,l[i],t,s,o.throwOn),e}function mi(t){return["loader",t]}const Vi={forceConvert:!0,dataCheck:{},sort:!0,preprocess:[],postprocess:[]};function zo(t,e,i,n={}){var h;const o={forceConvert:n.forceConvert??Vi.forceConvert,dataCheck:{...Vi.dataCheck,...n.dataCheck},sort:n.sort??Vi.sort,preprocess:n.preprocess??Vi.preprocess,postprocess:n.postprocess??Vi.postprocess};let l,s,r;switch(t){case"info":l=No,s=Rf,r=df;break;case"audioData":l=Eo,s=xf,r=gf;break;case"difficulty":l=qi,s=Bf,r=cs;break;case"lightshow":l=qi,s=If,r=cs;break}o.preprocess.forEach((c,g)=>{J.tInfo(mi("loadBeatmap"),"Running preprocess function #"+(g+1)),e=c(e)});const a=(h=bu(e))==null?void 0:h.at(0);let u;a?u=parseInt(a):(u=+gu(t).at(0),J.tWarn(mi("loadBeatmap"),"Could not identify beatmap version from JSON, assume implicit version",u));let f;const m=s[u];if(m)o.dataCheck.enabled&&nd(t,e,u,o.dataCheck),f=new l(m.deserialize(e));else throw new Error(`Beatmap version ${u} is not supported, this may be an error in JSON or is newer than currently supported.`);if(i&&u!==i){if(!o.forceConvert)throw new Error(`Beatmap version unmatched, expected ${i} but received ${u}`);J.tWarn(mi("loadBeatmap"),"Beatmap version unmatched, expected",i,"but received",u,"for version; Converting to beatmap version",i),f=r[i](f,i)}return o.sort&&f.sort(),o.postprocess.forEach((c,g)=>{J.tInfo(mi("loadBeatmap"),"Running postprocess function #"+(g+1)),f=c(f)}),f}function od(t,e,i){const n=typeof e=="number"?e:null,o=(typeof e!="number"?e:i)??{};return J.tInfo(mi("loadDifficulty"),"Loading difficulty from JSON"),zo("difficulty",t,n,o)}function rd(t,e,i){const n=typeof e=="number"?e:null,o=(typeof e!="number"?e:i)??{};return J.tInfo(mi("loadInfo"),"Loading info from JSON"),zo("info",t,n,o)}function sd(t,e,i){const n=typeof e=="number"?e:null,o=(typeof e!="number"?e:i)??{};return J.tInfo(mi("loadLightshow"),"Loading lightshow from JSON"),zo("lightshow",t,n,o)}function ad(t){return t.posX<0||t.posX>3||t.width<0||t.width>3}function ld(t){return t.posY<0||t.posY>2||t.posX<=-1e3||t.posX>=1e3||t.width<=-1e3||t.width>=1e3||t.height<=-1e3||t.height>=1e3}function cd(t){return t.posY>2||t.posY<0||t.posX<=-1e3||t.posX>=1e3||t.direction>=1e3&&t.direction<=1360||t.tailDirection>=1e3&&t.tailDirection<=1360}function ud(t){return t.posX>3||t.posX<0||t.posY>2||t.posY<0}function hd(t){return t.posY>2||t.posY<0||t.posX<=-1e3||t.posX>=1e3||t.direction>=1e3&&t.direction<=1360}function md(t){return t.posX>3||t.posX<0||t.posY>2||t.posY<0||t.direction>=1e3&&t.direction<=1360||t.direction>=2e3&&t.direction<=2360}const Ye=class Ye{constructor(e,i=10,n=0){this.bpm=e,this.value=i,this.offset=n}static create(e,i,n){return new Ye(e,i,n)}get hjd(){return this.calcHjd()}get jd(){return this.calcJd()}get reactionTime(){return this.calcRtFromHjd()}calcHjd(e=this.offset){const n=60/this.bpm;let o=Ye.HJD_START;for(;this.value*n*o>17.999;)o/=2;return o<1&&(o=1),Math.max(o+e,Ye.HJD_MIN)}calcHjdFromJd(e=this.calcJd()){return e/(60/this.bpm*this.value*2)}calcHjdFromRt(e=this.calcRtFromHjd()){return e/(60/this.bpm)}calcJd(e=this.calcHjd()){return this.value*(60/this.bpm)*e*2}calcJdOptimal(){return[-(18/(this.value+1))+18,18*(1/1.07)**this.value+18]}calcRtFromJd(e=this.calcJd()){return e/(2*this.value)}calcRtFromHjd(e=this.calcHjd()){return 60/this.bpm*e}calcDistance(e){return this.value*60/this.bpm*e*2}};Ye.HJD_START=4,Ye.HJD_MIN=.25,Ye.FallbackNJS={ExpertPlus:16,Expert:12,Hard:10,Normal:10,Easy:10};let Oe=Ye;function fd(t){return["helpers","timeProcessor",t]}const Zn=class Zn{constructor(e,i=[],n=0){this.bpm=e,this._offset=n/1e3,this._timeScale=this.getTimeScale(i.filter(o=>("m"in o||"bpm"in o||"timescale"in o)&&!("o"in o))),this._bpmChange=this.getBpmChangeTime(i.filter(o=>"BPM"in o&&"metronomeOffset"in o||("_bpm"in o||"_BPM"in o)&&"_metronomeOffset"in o||"m"in o&&"o"in o)),this._timeScale.length&&this._bpmChange.length&&J.tWarn(fd("constructor"),"BPM change and BPM event should not be used along side together to avoid confusion between editors and in-game behaviour")}get change(){return this._bpmChange}set change(e){this._bpmChange=this.getBpmChangeTime(e)}get timescale(){return this._timeScale}set timescale(e){this._timeScale=this.getTimeScale(e)}get offset(){return this._offset*1e3}set offset(e){this._offset=e/1e3}getBpmChangeTime(e=[]){let i;const n=[];e=[...e].sort((o,l)=>(o.time??o._time??o.b)-(l.time??l._time??l.b));for(let o=0;o<e.length;o++){const l={time:e[o].time??e[o]._time??e[o].b,BPM:e[o].BPM??e[o]._BPM??e[o]._bpm??e[o].m,beatsPerBar:e[o].beatsPerBar??e[o]._beatsPerBar??e[o].p,metronomeOffset:e[o].metronomeOffset??e[o]._metronomeOffset??e[o].o,newTime:0};i?l.newTime=Math.ceil((l.time-i.time)/this.bpm*i.BPM+i.newTime-.01):l.newTime=Math.ceil(l.time-this._offset*this.bpm/60-.01),n.push(l),i=l}return n}getTimeScale(e=[]){return[...e].sort((i,n)=>(i.time??i.b)-(n.time??n.b)).map(i=>"scale"in i?i:"bpm"in i?{time:i.time,scale:this.bpm/i.bpm}:{time:i.b||0,scale:this.bpm/i.m})}offsetBegone(e){return this._offset===0?e:this.toBeatTime(this.toRealTime(e,!1)-this._offset)}toRealTime(e,i=!0){if(!i)return e/this.bpm*60;let n=0;for(let o=this._timeScale.length-1;o>=0;o--)e>this._timeScale[o].time&&(n+=(e-this._timeScale[o].time)*this._timeScale[o].scale,e=this._timeScale[o].time);return(e+n)/this.bpm*60}toBeatTime(e,i=!0){if(!i)return e*this.bpm/60;let n=0;for(let o=this._timeScale.length-1;o>=0;o--){const l=this.toRealTime(this._timeScale[o].time,i);e>l&&(n+=(e-l)/this._timeScale[o].scale,e=l)}return this.toBeatTime(e+n,!1)}toJsonTime(e){for(let i=this._bpmChange.length-1;i>=0;i--)if(e>this._bpmChange[i].newTime)return(e-this._bpmChange[i].newTime)/this._bpmChange[i].BPM*this.bpm+this._bpmChange[i].time;return this.toBeatTime(this.toRealTime(e,!1)+this._offset)}adjustTime(e){for(let i=this._bpmChange.length-1;i>=0;i--)if(e>this._bpmChange[i].time)return(e-this._bpmChange[i].time)/this.bpm*this._bpmChange[i].BPM+this._bpmChange[i].newTime;return this.offsetBegone(e)}};Zn.create=(e,i,n)=>new Zn(e,i,n);let Yn=Zn;const ga="Acceptable Beat Precision",ba=`Validate note timing placement is within timing precision.
i.e: 1/8 1/6 1/x`,va=!0,_a=[8,6],Hi={name:ga,description:ba,type:"note",order:{input:gt.NOTES_ACCEPTABLE_PRECISION,output:bt.NOTES_ACCEPTABLE_PRECISION},input:{enabled:va,params:{prec:[..._a]},html:Y.createBlock(Y.createCheckbox(function(){Hi.input.enabled=this.checked},ga+": ",ba,va),Y.createText(function(){Hi.input.params.prec=this.value.trim().split(" ").map(t=>parseInt(t)).filter(t=>t>0?!Number.isNaN(t):!1),this.value=Hi.input.params.prec.join(" ")},"",_a.join(" ")))},run:dd};function pd(t){const e=t.swingAnalysis.container,{prec:i}=Hi.input.params;return e.map(n=>n.data.sort(zt)[0]).filter(n=>{if(!i.length)return!1;const o=n.customData.__mapcheck_beattime;for(let l=0;l<i.length;l++)if((o+.001)%(1/i[l])<.01)return!1;return!0})}function dd(t){const e=pd(t.beatmap);return e.length?[{type:"time",label:"Off-beat precision",value:e,symbol:"warning"}]:[]}const ya="Color Check",Ea="Compare note color with other colored note and the arrow on itself.",Da=!0,Ca=[1,1,1],Sa={1:"Indistinguishable",5:"Hardly perceivable",10:"Close apparent",20:"Mildly similar",40:"Different",90:"Discernible",100:"Opposite"};function wa(t,e){let i=Object.keys(t).find(o=>parseFloat(o)>=e)??"100",n=parseFloat(i);return t[n]}const Tu={name:ya,description:Ea,type:"note",order:{input:gt.NOTES_COLOR_CHECK,output:bt.NOTES_COLOR_CHECK},input:{enabled:Da,params:{},html:Y.createBlock(Y.createCheckbox(function(){Tu.input.enabled=this.checked},ya+" (EXPERIMENTAL)",Ea,Da))},run:vd};function gd(t){var o,l,s,r;const e=t.info.colorSchemes[t.beatmap.settings.colorSchemeId],i=((l=(o=t.beatmap)==null?void 0:o.settings.customData)==null?void 0:l._colorLeft)??e.saberLeftColor??de[pe[t.beatmap.environment]??"The First"]._colorLeft,n=((r=(s=t.beatmap)==null?void 0:s.settings.customData)==null?void 0:r._colorRight)??e.saberRightColor??de[pe[t.beatmap.environment]??"The First"]._colorRight;return i&&n?go(ne(i),ne(n)):100}function bd(t){var s,r,a,u;const e=t.info.colorSchemes[t.beatmap.settings.colorSchemeId];let i=100,n=100;const o=((r=(s=t.beatmap)==null?void 0:s.settings.customData)==null?void 0:r._colorLeft)??e.saberLeftColor??de[pe[t.beatmap.environment]??"The First"]._colorLeft,l=((u=(a=t.beatmap)==null?void 0:a.settings.customData)==null?void 0:u._colorRight)??e.saberRightColor??de[pe[t.beatmap.environment]??"The First"]._colorRight;return o&&(i=go(Ca,ne(o))),l&&(n=go(Ca,ne(l))),Math.min(i,n)}function vd(t){var l,s;const e=t.info.colorSchemes[t.beatmap.settings.colorSchemeId];if(!((l=t.beatmap.settings.customData)!=null&&l._colorLeft)&&!((s=t.beatmap.settings.customData)!=null&&s._colorRight)&&!e)return[];const i=gd(t),n=bd(t),o=[];return i<=20&&o.push({type:"string",label:`${wa(Sa,i)} note color (dE${M(i,1)})`,value:"suggest change to better differentiate between 2 note colour",symbol:"warning"}),n<=20&&o.push({type:"string",label:`${wa(Sa,n)} arrow note color (dE${M(n,1)})`,value:"may be difficult to see the arrow",symbol:"warning"}),o}var at=(t=>(t[t.OBJECT=-1]="OBJECT",t[t.COLOR=0]="COLOR",t[t.BOMB=1]="BOMB",t[t.ARC=2]="ARC",t[t.CHAIN=3]="CHAIN",t))(at||{});const ka="Double-directional",Ta="Check double-directional note swing (this may not mean parity break).",La=!0,Lu={name:ka,description:Ta,type:"note",order:{input:gt.NOTES_DOUBLE_DIRECTIONAL,output:bt.NOTES_DOUBLE_DIRECTIONAL},input:{enabled:La,params:{},html:Y.createBlock(Y.createCheckbox(function(){Lu.input.enabled=this.checked},ka,Ta,La))},run:yd};function _d(t){const e=t.timeProcessor,i=t.noteContainer,n={},o={},l={},s={[rt.RED]:[],[rt.BLUE]:[]},r=[];for(let a=0,u=i.length;a<u;a++){const f=i[a];f.type===at.COLOR&&n[f.data.color]?oe.next(f.data,n[f.data.color],e,s[f.data.color])?(l[f.data.color]&&(l[f.data.color]=null,o[f.data.color]=(o[f.data.color]+180)%360),Xi(f.data,o[f.data.color],45,!0)&&r.push(f.data),f.data.direction===B.ANY?l[f.data.color]=f.data:o[f.data.color]=f.data.getAngle(),s[f.data.color]=[]):(l[f.data.color]&&Xi(f.data,o[f.data.color],45,!0)&&(r.push(f.data),l[f.data.color]=null,o[f.data.color]=f.data.getAngle()),f.data.direction!==B.ANY&&(l[f.data.color]=null,o[f.data.color]=f.data.getAngle())):f.type===at.COLOR&&(o[f.data.color]=f.data.getAngle()),f.type===at.COLOR&&(n[f.data.color]=f.data,s[f.data.color].push(f.data)),f.type===at.BOMB&&(f.data.posY===Rt.BOTTOM&&(f.data.posX===ct.MIDDLE_LEFT&&(o[rt.RED]=ge[B.UP],l[rt.RED]=null),f.data.posX===ct.MIDDLE_RIGHT&&(o[rt.BLUE]=ge[B.UP],l[rt.BLUE]=null)),f.data.posY===Rt.TOP&&(f.data.posX===ct.MIDDLE_LEFT&&(o[rt.RED]=ge[B.DOWN],l[rt.RED]=null),f.data.posX===ct.MIDDLE_RIGHT&&(o[rt.BLUE]=ge[B.DOWN],l[rt.BLUE]=null)))}return r}function yd(t){const e=_d(t.beatmap);return e.length?[{type:"time",label:"Double-directional",value:e,symbol:"warning"}]:[]}const Ra="Effective BPM",xa=`Effective BPM is calculated by one hand making 1/2 precision movement relative to the BPM.
EBPM starts from previous end note to next start note (typically for sliders).
EBPM Swing starts from previous start note to next start note.`,Ba=!0,Vo=450,Go=350,Ru=Y.createNumber(function(){ie.input.params.ebpmThres=M(Math.abs(parseFloat(this.value)),1),this.value=ie.input.params.ebpmThres.toString()},": ",Vo,0),xu=Y.createNumber(function(){ie.input.params.ebpmsThres=M(Math.abs(parseFloat(this.value)),1),this.value=ie.input.params.ebpmsThres.toString()}," (swing): ",Go,0),ie={name:Ra,description:xa,type:"note",order:{input:gt.NOTES_EFFECTIVE_BPM,output:bt.NOTES_EFFECTIVE_BPM},input:{enabled:Ba,params:{ebpmThres:Vo,ebpmsThres:Go},html:Y.createBlock(Y.createCheckbox(function(){ie.input.enabled=this.checked},Ra+" threshold",xa,Ba),Ru,xu),adjustTime:Ed},run:Cd};function Ed(t){ie.input.params.ebpmThres=M(Math.min(Vo,t.bpm*2*1.285714),1),ie.input.params.ebpmsThres=M(Math.min(Go,t.bpm*2),1),Ru[1].value=ie.input.params.ebpmThres.toString(),xu[1].value=ie.input.params.ebpmsThres.toString()}function Dd(t){const{swingAnalysis:e}=t.beatmap;let{ebpmThres:i,ebpmsThres:n}=ie.input.params;i+=.001,n+=.001;const o=e.container.filter(s=>s.ebpm>i).map(s=>s.data[0]),l=e.container.filter(s=>s.ebpmSwing>n).map(s=>s.data[0]);return{base:o,swing:l}}function Cd(t){const e=Dd(t),{ebpmThres:i,ebpmsThres:n}=ie.input.params,o=[];return e.base.length&&o.push({type:"time",label:`>${i}EBPM warning`,value:e.base,symbol:"warning"}),e.swing.length&&o.push({type:"time",label:`>${n}EBPM (swing) warning`,value:e.swing,symbol:"warning"}),o}const Ia="Hitbox Inline",Na="Check for overlapping note hitbox for inline note.",Aa=!0,Bu={name:Ia,description:Na,type:"note",order:{input:gt.NOTES_HITBOX_INLINE,output:bt.NOTES_HITBOX_INLINE},input:{enabled:Aa,params:{},html:Y.createBlock(Y.createCheckbox(function(){Bu.input.enabled=this.checked},Ia,Na,Aa))},run:kd},Sd=0;function wd(t){const{timeProcessor:e,njs:i}=t.beatmap,n={},o={[rt.RED]:[],[rt.BLUE]:[]},l=[];for(let s=0,r=t.beatmap.data.colorNotes.length;s<r;s++){const a=t.beatmap.data.colorNotes[s];n[a.color]&&oe.next(a,n[a.color],e,o[a.color])&&(o[a.color]=[]);for(const u of o[(a.color+1)%2])if(i.value<1.425/(60*(a.time-u.time)/e.bpm+Sd)&&a.isInline(u)){l.push(a);break}n[a.color]=a,o[a.color].push(a)}return l}function kd(t){const e=wd(t);return e.length?[{type:"time",label:"Hitbox inline",value:e,symbol:"rank"}]:[]}const Oa="Hitbox Path",$a="Check for overlapping pre-swing note hitbox at same time.",Pa=!0,Iu={name:Oa,description:$a,type:"note",order:{input:gt.NOTES_HITBOX_PATH,output:bt.NOTES_HITBOX_PATH},input:{enabled:Pa,params:{},html:Y.createBlock(Y.createCheckbox(function(){Iu.input.enabled=this.checked},Oa,$a,Pa))},run:Ld};function Td(t){t.beatmap.timeProcessor;const e=t.beatmap.noteContainer.filter(o=>o.type===at.BOMB||o.type===at.COLOR),i=[];let n=0;for(let o=0,l=e.length;o<l;o++){const s=e[o];if(!(s.type===at.BOMB||s.type===at.ARC||s.type===at.CHAIN||s.data.customData.__mapcheck_secondtime<n+.01))for(let r=o+1;r<l;r++){const a=e[r];if(a.data.customData.__mapcheck_secondtime>s.data.customData.__mapcheck_secondtime+.01)break;a.type===at.COLOR&&s.data.color===a.data.color||((s.data.isHorizontal(a.data)||s.data.isVertical(a.data))&&_o(s.data,a.data,[[45,1],[15,2]]).some(u=>u)||s.data.isDiagonal(a.data)&&_o(s.data,a.data,[[45,1],[15,1.5]]).some(u=>u))&&(i.push(s.data),n=s.data.customData.__mapcheck_secondtime)}}return i}function Ld(t){const e=Td(t);return e.length?[{type:"time",label:"Hitbox path",value:e,symbol:"error"}]:[]}const Ma="Hitbox Reverse Staircase",Fa="Check for overlapping pre-swing hitbox with note hitbox during swing.",za=!0,Nu={name:Ma,description:Fa,type:"note",order:{input:gt.NOTES_HITBOX_REVERSE_STAIR,output:bt.NOTES_HITBOX_REVERSE_STAIR},input:{enabled:za,params:{},html:Y.createBlock(Y.createCheckbox(function(){Nu.input.enabled=this.checked},Ma,Fa,za))},run:Id},Rd=.03414823529,xd=.03414823529;function Bd(t){const{timeProcessor:e,njs:i,noteContainer:n}=t.beatmap,o={},l={[rt.RED]:[],[rt.BLUE]:[]},s=[];for(let r=0,a=n.length;r<a;r++){if(n[r].type!==at.COLOR)continue;const u=n[r];o[u.data.color]&&oe.next(u.data,o[u.data.color],e,l[u.data.color])&&(l[u.data.color]=[]);for(const f of l[(u.data.color+1)%2])if(f.direction!==B.ANY){if(!(e.toRealTime(u.data.time)>e.toRealTime(f.time)+.01))continue;const m=f.getAngle()%90>15&&f.getAngle()%90<75;if(i.value<1.425/(60*(u.data.time-f.time)/e.bpm+(m?xd:Rd))&&_o(u.data,f,[[15,1.5]])[1]){s.push(f);break}}o[u.data.color]=u.data,l[u.data.color].push(u.data)}return s}function Id(t){const e=Bd(t);return e.length?[{type:"time",label:"Hitbox reverse Staircase",value:e,symbol:"rank"}]:[]}const Va="Hitbox Staircase",Ga="Check for overlapping post-swing hitbox with note hitbox during swing.",Ha=!0,Au={name:Va,description:Ga,type:"note",order:{input:gt.NOTES_HITBOX_STAIR,output:bt.NOTES_HITBOX_STAIR},input:{enabled:Ha,params:{},html:Y.createBlock(Y.createCheckbox(function(){Au.input.enabled=this.checked},Va,Ga,Ha))},run:Od};function Nd(t,e,i){for(let n=i,o=e.length;n<o;n++){if(e[n].time<t.time+.01&&e[n].color!==t.color)return!0;if(e[n].time>t.time+.01)return!1}return!1}function Ad(t){const{timeProcessor:e}=t.beatmap,i=t.beatmap.data.colorNotes,n=e.toBeatTime(.15,!1),o={},l={},s={},r={[rt.RED]:[],[rt.BLUE]:[]},a={[rt.RED]:new bi,[rt.BLUE]:new bi({color:1})},u=[];for(let f=0,m=i.length;f<m;f++){const h=i[f];o[h.color]?(oe.next(h,o[h.color],e,r[h.color])?(s[h.color]=h.time-o[h.color].time,h.direction!==B.ANY?(a[h.color].posX=h.posX+ze[h.direction][0],a[h.color].posY=h.posY+ze[h.direction][1]):(a[h.color].posX=-1,a[h.color].posY=-1),r[h.color]=[],l[h.color]=h.direction):hu(h,o[h.color],l[h.color])&&(h.direction!==B.ANY?(a[h.color].posX=h.posX+ze[h.direction][0],a[h.color].posY=h.posY+ze[h.direction][1],l[h.color]=h.direction):(a[h.color].posX=h.posX+ze[l[h.color]][0],a[h.color].posY=h.posY+ze[l[h.color]][1])),o[(h.color+1)%2]&&h.time-o[(h.color+1)%2].time!==0&&h.time-o[(h.color+1)%2].time<Math.min(n,s[(h.color+1)%2])&&h.posX===a[(h.color+1)%2].posX&&h.posY===a[(h.color+1)%2].posY&&!Nd(h,t.beatmap.data.colorNotes,f)&&u.push(h)):(h.direction!==B.ANY?(a[h.color].posX=h.posX+ze[h.direction][0],a[h.color].posY=h.posY+ze[h.direction][1]):(a[h.color].posX=-1,a[h.color].posY=-1),l[h.color]=h.direction),o[h.color]=h,r[h.color].push(h)}return u}function Od(t){const e=Ad(t);return e.length?[{type:"time",label:"Hitbox staircase",value:e,symbol:"rank"}]:[]}const Ua="Improper Arc",ja="Check for correct use of arc.",Wa=!0,Ou={name:Ua,description:ja,type:"note",order:{input:gt.NOTES_IMPROPER_ARC,output:bt.NOTES_IMPROPER_ARC},input:{enabled:Wa,params:{},html:Y.createBlock(Y.createCheckbox(function(){Ou.input.enabled=this.checked},Ua,ja,Wa))},run:Pd};function $d(t){const e=[...t.beatmap.noteContainer].sort((n,o)=>n.type!==at.ARC?1:o.type!==at.ARC?-1:0).sort((n,o)=>n.data.time-o.data.time),i=[];for(let n=0,o=!0,l=e.length;n<l;n++){const s=e[n],r=e.at(-1).data.time;if(s.type===at.ARC){o=!0;for(let a=n,u=!1;a<l;a++){const f=e[a];if(f.type===at.COLOR&&s.data.posX===f.data.posX&&s.data.posY===f.data.posY&&f.data.time<=s.data.time+.001&&s.data.color===f.data.color&&(f.data.direction===B.ANY||s.data.direction===f.data.direction)){for(let m=a;m<l;m++){const h=e[a];if(h.type===at.BOMB&&s.data.posX===h.data.posX&&s.data.posY===h.data.posY&&h.data.time<=s.data.time+.001){u=!0;break}if(!(h.type!==at.COLOR||h.data.time<s.data.tailTime)){if(s.data.posX===f.data.posX&&s.data.posY===f.data.posY&&f.data.time<=s.data.time+.001&&(s.data.color!==f.data.color||(f.data.direction===B.ANY||s.data.direction!==f.data.direction))){u=!0;break}if(f.data.time>s.data.tailTime+.001)break}}o=u||!1;break}if(f.type===at.COLOR&&s.data.posX===f.data.posX&&s.data.posY===f.data.posY&&f.data.time<=s.data.time+.001)break;if(f.data.time>s.data.time+.001){o=!1;break}(f.type===at.ARC||f.type===at.CHAIN)&&f.data.time+.001>r&&(o=!1)}o&&i.push(s.data)}}return i}function Pd(t){const e=$d(t);return e.length?[{type:"time",label:"Improper arc",value:e,symbol:"error"}]:[]}const Xa="Improper Chain",Ya="Check for correct use of chain.",qa=!0,$u={name:Xa,description:Ya,type:"note",order:{input:gt.NOTES_IMPROPER_CHAIN,output:bt.NOTES_IMPROPER_CHAIN},input:{enabled:qa,params:{},html:Y.createBlock(Y.createCheckbox(function(){$u.input.enabled=this.checked},Xa,Ya,qa))},run:Fd};function Md(t){const e=[...t.beatmap.noteContainer].sort((n,o)=>n.type!==at.CHAIN?1:o.type!==at.CHAIN?-1:0).sort((n,o)=>n.data.time-o.data.time),i=[];for(let n=0,o=!0,l=e.length;n<l;n++){const s=e[n];if(s.type===at.CHAIN){o=!0;for(let r=n;r<l;r++){const a=e[r];if(a.type===at.COLOR&&s.data.posX===a.data.posX&&s.data.posY===a.data.posY&&a.data.time<=s.data.time+.001&&s.data.color===a.data.color&&(a.data.direction===B.ANY||s.data.direction===a.data.direction)){o=!1;break}if(a.type===at.BOMB&&s.data.posX===a.data.posX&&s.data.posY===a.data.posY&&a.data.time<=s.data.time+.001||a.data.time>s.data.time+.001)break}o&&i.push(s)}}return i}function Fd(t){const e=Md(t);return e.length?[{type:"time",label:"Improper chain",value:e.map(i=>i.data),symbol:"error"}]:[]}const Ka="Improper Window Snap",Za="Check for slanted window snap timing.",Ja=!0,Pu={name:Ka,description:Za,type:"note",order:{input:gt.NOTES_IMPROPER_WINDOW,output:bt.NOTES_IMPROPER_WINDOW},input:{enabled:Ja,params:{},html:Y.createBlock(Y.createCheckbox(function(){Pu.input.enabled=this.checked},Ka,Za,Ja))},run:Vd};function zd(t){const{timeProcessor:e,noteContainer:i}=t.beatmap,n={},o={[rt.RED]:[],[rt.BLUE]:[]},l=[];for(let s=0,r=i.length;s<r;s++){if(i[s].type!==at.COLOR)continue;const a=i[s].data;n[a.color]?oe.next(a,n[a.color],e,o[a.color])?(n[a.color]=a,o[a.color]=[]):a.isSlantedWindow(n[a.color])&&a.time-n[a.color].time>=.001&&a.direction===n[a.color].direction&&a.direction!==B.ANY&&n[a.color].direction!==B.ANY&&l.push(n[a.color]):n[a.color]=a,o[a.color].push(a)}return l}function Vd(t){const e=zd(t);return e.length?[{type:"time",label:"Improper window snap",value:e,symbol:"error"}]:[]}const Qa="Inline Sharp Angle",tl="Check for angle changes within inline note.",el=!0,Mu=.15;let Bi;const[Gd,Fu]=Y.createNumber(function(){Ie.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(Ie.input.params.maxTime*1e3,1).toString(),Bi&&(Ho.value=M(Bi.toBeatTime(Ie.input.params.maxTime,!1),2).toString())},"max time (ms): ",M(Mu*1e3,1),0),[Hd,Ho]=Y.createNumber(function(){if(!Bi){this.value="0";return}let t=M(Math.abs(parseFloat(this.value)),2)||1;Ie.input.params.maxTime=Bi.toRealTime(t),Fu.value=M(Ie.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}," (beat): ",0,0,null,.1),Ie={name:Qa,description:tl,type:"note",order:{input:gt.NOTES_INLINE_ANGLE,output:bt.NOTES_INLINE_ANGLE},input:{enabled:el,params:{maxTime:Mu},html:Y.createBlock(Y.createCheckbox(function(){Ie.input.enabled=this.checked},Qa,tl,el),document.createElement("br"),Gd,Fu,Hd,Ho),adjustTime:Ud},run:Wd};function Ud(t){Bi=t,Ho.value=M(Bi.toBeatTime(Ie.input.params.maxTime,!1),2).toString()}function jd(t){const{timeProcessor:e}=t.beatmap,i=t.beatmap.noteContainer,{maxTime:n}=Ie.input.params,o=e.toBeatTime(n,!1)+.001,l={},s={},r={},a={[rt.RED]:[],[rt.BLUE]:[]},u=[];let f=0;for(let m=0,h=i.length;m<h;m++){const c=i[m];c.type===at.COLOR&&l[c.data.color]?oe.next(c.data,l[c.data.color],e,a[c.data.color])?(r[c.data.color]&&(r[c.data.color]=null,s[c.data.color]=(s[c.data.color]+180)%360),il(c.data,i,f,o)&&Xi(c.data,s[c.data.color],90,!0)&&u.push(c.data),c.data.direction===B.ANY?r[c.data.color]=c.data:s[c.data.color]=c.data.getAngle(),a[c.data.color]=[]):(r[c.data.color]&&il(c.data,i,f,o)&&Xi(c.data,s[c.data.color],90,!0)&&(u.push(r[c.data.color]),r[c.data.color]=null),c.data.direction!==B.ANY&&(s[c.data.color]=c.data.getAngle())):c.type===at.COLOR&&(s[c.data.color]=c.data.getAngle()),c.type===at.COLOR&&(l[c.data.color]=c.data,a[c.data.color].push(c.data)),c.type===at.BOMB&&(c.data.posY===Rt.BOTTOM&&(c.data.posX===ct.MIDDLE_LEFT&&(s[rt.RED]=ge[B.UP],r[rt.RED]=null),c.data.posX===ct.MIDDLE_RIGHT&&(s[rt.BLUE]=ge[B.UP],r[rt.BLUE]=null)),c.data.posY===Rt.TOP&&(c.data.posX===ct.MIDDLE_LEFT&&(s[rt.RED]=ge[B.DOWN],r[rt.RED]=null),c.data.posX===ct.MIDDLE_RIGHT&&(s[rt.BLUE]=ge[B.DOWN],r[rt.BLUE]=null)))}return u}function il(t,e,i,n){for(let o=i;e[o].data.time<t.time;o++){const l=e[o];if(l.type===at.COLOR&&t.isInline(l.data)&&t.time-e[o].data.time<=n)return!0}return!1}function Wd(t){const e=jd(t);return e.length?[{type:"time",label:"Inline sharp angle",value:e,symbol:"warning"}]:[]}const nl="One Saber",ol="Check for one saber.",rl=!0,zu={name:nl,description:ol,type:"note",order:{input:gt.NOTES_ONE_SABER,output:bt.NOTES_ONE_SABER},input:{enabled:rl,params:{},html:Y.createBlock(Y.createCheckbox(function(){zu.input.enabled=this.checked},nl,ol,rl))},run:Xd};function Xd(t){let e,i=!1;if(t.beatmap.settings.characteristic==="OneSaber"||t.beatmap.settings.customData.oneSaber)e=t.beatmap.data.colorNotes.filter(o=>o.isRed());else{const o=t.beatmap.data.colorNotes.filter(s=>s.isBlue()).length>0,l=t.beatmap.data.colorNotes.filter(s=>s.isRed()).length>0;i=o?!l:l}return e!=null&&e.length?[{type:"time",label:"Wrong One Saber Note",value:e,symbol:"error"}]:i?[{type:"string",label:"Unintended One Saber",value:"One Saber gameplay outside of One Saber characteristic",symbol:"rank"}]:[]}const Ji={create:(t,e,i,n,...o)=>{const l=document.createElement(i);l.className=n;const s=document.createElement("select");s.className="input-toggle",s.id=t,o.forEach(a=>{const u=document.createElement("option");u.textContent=a.text,u.value=a.value,s.append(u)});const r=document.createElement("label");return r.htmlFor=t,r.innerHTML=`<span>${e}</span>`,l.append(r),l.append(s),l}};var Vu=(t=>(t.forehand="backhand",t.backhand="forehand",t))(Vu||{});const fn={[rt.RED]:{forehand:[B.DOWN,B.RIGHT,B.DOWN_LEFT,B.DOWN_RIGHT],backhand:[B.UP,B.LEFT,B.UP_LEFT,B.UP_RIGHT]},[rt.BLUE]:{forehand:[B.DOWN,B.LEFT,B.DOWN_LEFT,B.DOWN_RIGHT],backhand:[B.UP,B.RIGHT,B.UP_LEFT,B.UP_RIGHT]}},ii={[rt.RED]:[0,0,90,90,45,-45,45,-45],[rt.BLUE]:[0,0,-90,-90,-45,45,-45,45]},sl={0:{forehand:[180,0,-90,90,-135,135,-45,45],backhand:[0,180,90,-90,45,-45,135,-135]},1:{forehand:[-180,0,-90,90,-135,135,-45,45],backhand:[0,-180,90,-90,45,-45,135,-135]}},ui=class ui{constructor(e,i,n,o,l,s,r){this.color=n,this.warningThreshold=o,this.errorThreshold=l,this.allowedRotation=s,r&&r!=="neutral"?(this.state=r,this.rotation=0):(this.state=this.predictStartState(e,i,n),this.rotation=this.predictStartRotation(e,n)),this.position=this.predictStartPosition(e,n)}check(e,i){if(this.state==="neutral")return"none";if(!e.length)throw new Error("no notes were given");const n=e[0].time,o=this.color;let l=this.state,s=this.rotation;i.forEach(f=>{f.time-.001>n||(f.posY===Rt.BOTTOM&&f.posX===(o?ct.MIDDLE_RIGHT:ct.MIDDLE_LEFT)&&(l="backhand",s=0),f.posY===Rt.TOP&&f.posX===(o?ct.MIDDLE_RIGHT:ct.MIDDLE_LEFT)&&(l="forehand",s=0))});let r,a=B.ANY;for(const f of e)f.direction!==B.ANY&&(a=f.direction),r&&a===B.ANY&&(a=Ur(f,r)),r=f;if(a===B.ANY)return"none";const u=sl[o][Vu[l]][a];return(s>u?s-u:u-s)>180||u<ui.CONSTRAINT_ROTATION[o][0]+this.errorThreshold||u>ui.CONSTRAINT_ROTATION[o][1]-this.errorThreshold?"error":u<ui.CONSTRAINT_ROTATION[o][0]+this.warningThreshold||u>ui.CONSTRAINT_ROTATION[o][1]-this.warningThreshold||(s>u?s-u:u-s)>this.allowedRotation?"warning":"none"}next(e,i){if(this.check(e,i)!=="error")switch(this.state){case"forehand":{this.state="backhand";break}case"backhand":{this.state="forehand";break}case"neutral":{for(let r=0;r<e.length;r++){const a=e[r];if(fn[a.color].forehand.includes(a.direction)){this.state="backhand";break}if(fn[a.color].backhand.includes(a.direction)){this.state="forehand";break}this.state==="neutral"&&a.direction===B.ANY&&(a.posY===0&&(this.state="backhand"),a.posY>0&&(this.state="forehand"))}break}}if(this.state==="neutral")throw new Error("parity unexpected input");const n=e[0].time,o=this.color;i.forEach(r=>{r.time-.001>n||(r.posY===Rt.BOTTOM&&r.posX===(o?ct.MIDDLE_RIGHT:ct.MIDDLE_LEFT)&&(this.state="forehand",this.rotation=0),r.posY===Rt.TOP&&r.posX===(o?ct.MIDDLE_RIGHT:ct.MIDDLE_LEFT)&&(this.state="backhand",this.rotation=0))});let l,s=B.ANY;for(const r of e)r.direction!==B.ANY&&(s=r.direction),l&&s===B.ANY&&(s=Ur(r,l)),l=r;s!==B.ANY&&(this.rotation=sl[this.color][this.state][s])}predictStartState(e,i,n){const o=[...e,...i].sort((s,r)=>s.time-r.time);let l="neutral";for(let s=0,r=o.length;s<r;s++){if(o[s]instanceof Yi){o[s].posY===Rt.BOTTOM&&(o[s].posX===n?ct.MIDDLE_RIGHT:ct.MIDDLE_LEFT)&&(l="backhand"),o[s].posY===Rt.TOP&&(o[s].posX===n?ct.MIDDLE_RIGHT:ct.MIDDLE_LEFT)&&(l="forehand");continue}let a=o[s];if(a.color!==Math.abs(n-1)&&a.color===n){if(l!=="neutral")break;const u=a.time;for(let f=s;f<o.length&&!(o[f].time>a.time+.001&&u<a.time+.001);f++){if(a=o[f],fn[a.color].forehand.includes(a.direction))return"backhand";if(fn[a.color].backhand.includes(a.direction))return"forehand";l==="neutral"&&a.direction===B.ANY&&(a.posY===Rt.BOTTOM&&(l="backhand"),a.posY>Rt.BOTTOM&&(l="forehand"))}break}}return l}predictStartRotation(e,i){let n=0;for(let o=0,l=e.length;o<l;o++){let s=e[o];if(s.color===i&&s.color===i){const r=s.time;for(let a=o;a<e.length&&!(e[a].time>s.time+.001&&r<s.time+.001);a++){if(s=e[a],s.direction!==B.ANY)return ii[s.color][s.direction];s.direction===B.ANY&&(s.posY===Rt.BOTTOM&&(s.posX===ct.LEFT&&(n=ii[s.color][6]),s.posX===ct.RIGHT&&(n=ii[s.color][7])),s.posY===Rt.MIDDLE&&(s.posX===ct.LEFT&&(n=ii[s.color][2]),s.posX===ct.RIGHT&&(n=ii[s.color][3])),s.posY===Rt.BOTTOM&&(s.posX===ct.LEFT&&(n=ii[s.color][4]),s.posX===ct.RIGHT&&(n=ii[s.color][5])))}break}}return n}predictStartPosition(e,i){return i?[-.5,1]:[.5,1]}};ui.CONSTRAINT_ROTATION=[[-155,195],[-195,155]];let qn=ui;const Gu="Parity Check",Hu="Perform parity check.",Uu=!1,ju=document.createElement("div");Ji.create("input__checks-parity-rotation","Wrist rotation type: ","div","",{text:"Normal",value:"90"},{text:"Extended",value:"135"},{text:"Squid",value:"180"});Ji.create("input__checks-parity-left","Left hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});Ji.create("input__checks-parity-right","Right hand parity: ","div","",{text:"Auto",value:"auto"},{text:"Forehand",value:"forehand"},{text:"Backhand",value:"backhand"});ju.appendChild(Y.createBlock(Y.createCheckbox(function(){Uo.input.enabled=this.checked},Gu+" (EXPERIMENTAL)",Hu,Uu)));const Uo={name:Gu,description:Hu,type:"note",order:{input:gt.NOTES_PARITY,output:bt.NOTES_PARITY},input:{enabled:Uu,params:{warningThres:90,errorThres:45,allowedRot:90},html:ju},run:qd};function Yd(t){const{timeProcessor:e,noteContainer:i}=t.beatmap,{warningThres:n,errorThres:o,allowedRot:l}=Uo.input.params,s={},r={[rt.RED]:[],[rt.BLUE]:[]},a={[rt.RED]:[],[rt.BLUE]:[]},u={[rt.RED]:[],[rt.BLUE]:[]},f={[rt.RED]:new qn(t.beatmap.data.colorNotes,t.beatmap.data.bombNotes,0,n,o,l),[rt.BLUE]:new qn(t.beatmap.data.colorNotes,t.beatmap.data.bombNotes,1,n,o,l)},m={warning:[],error:[]};for(let h=0,c=i.length;h<c;h++){const g=i[h];if(g.type===at.COLOR&&s[g.data.color]&&oe.next(g.data,s[g.data.color],e,r[g.data.color])){switch(f[g.data.color].check(r[g.data.color],u[g.data.color])){case"warning":{m.warning.push(r[g.data.color][0]);break}case"error":{m.error.push(r[g.data.color][0]);break}}f[g.data.color].next(r[g.data.color],u[g.data.color]),u[g.data.color]=a[g.data.color],a[g.data.color]=[],r[g.data.color]=[]}g.type===at.BOMB&&(a[rt.RED].push(g.data),a[rt.BLUE].push(g.data)),g.type===at.COLOR&&(s[g.data.color]=g.data,r[g.data.color].push(g.data))}for(let h=0;h<2;h++)if(s[h])switch(f[h].check(r[h],a[h])){case"warning":{m.warning.push(r[h][0]);break}case"error":{m.error.push(r[h][0]);break}}return m}function qd(t){const e=Yd(t);e.warning=e.warning,e.error=e.error;const i=[];return e.warning.length&&i.push({type:"time",label:"Parity warning",value:e.warning,symbol:"warning"}),e.error.length&&i.push({type:"time",label:"Parity error",value:e.error,symbol:"error"}),i}const al="shrado Angle",ll="Look for common negative curvature pattern.",cl=!1,Wu=.15,Kd=1;let Ii;const[Zd,Xu]=Y.createNumber(function(){be.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(be.input.params.maxTime*1e3,1).toString(),Ii&&(jo.value=M(Ii.toBeatTime(be.input.params.maxTime,!1),2).toString())},"max time (ms): ",M(Wu*1e3,1),0),[Jd,jo]=Y.createNumber(function(){if(!Ii){this.value="0";return}let t=M(Math.abs(parseFloat(this.value)),2)||1;be.input.params.maxTime=Ii.toRealTime(t),Xu.value=M(be.input.params.maxTime*1e3,1).toString(),this.value=t.toString()}," (beat): ",0,0,null,.1),be={name:al,description:ll,type:"note",order:{input:gt.NOTES_SHRADO_ANGLE,output:bt.NOTES_SHRADO_ANGLE},input:{enabled:cl,params:{distance:Kd,maxTime:Wu},html:Y.createBlock(Y.createCheckbox(function(){be.input.enabled=this.checked},al,ll,cl),document.createElement("br"),Y.createNumber(function(){be.input.params.distance=Math.max(parseInt(this.value),0),this.value=be.input.params.distance.toString()},"min distance: ",0,0),document.createElement("br"),Zd,Xu,Jd,jo),adjustTime:Qd},run:e0};function Qd(t){Ii=t,jo.value=M(Ii.toBeatTime(be.input.params.maxTime,!1),2).toString()}function t0(t){const{timeProcessor:e,noteContainer:i}=t.beatmap,{maxTime:n,distance:o}=be.input.params,l=e.toBeatTime(n,!1)+.001,s={},r={},a={},u={[rt.RED]:[],[rt.BLUE]:[]},f=[];for(let m=0,h=i.length;m<h;m++){if(i[m].type!==at.COLOR)continue;const c=i[m].data;s[c.color]?oe.next(c,s[c.color],e,u[c.color])?(a[c.color]&&(a[c.color]=null,r[c.color]=Mm[r[c.color]]??8),c.getDistance(s[c.color])>=o&&ul(c.direction,r[c.color],c.color)&&c.time-s[c.color].time<=l&&f.push(c),c.direction===B.ANY?a[c.color]=c:r[c.color]=c.direction,u[c.color]=[]):(a[c.color]&&c.getDistance(s[c.color])>=o&&ul(c.direction,r[c.color],c.color)&&c.time-s[c.color].time<=l&&(f.push(a[c.color]),a[c.color]=null),c.direction!==B.ANY&&(r[c.color]=c.direction)):r[c.color]=c.direction,s[c.color]=c,u[c.color].push(c)}return f}function ul(t,e,i){return t===8||e===8?!1:(i===0?e===7:e===6)&&t===0}function e0(t){const e=t0(t);return e.length?[{type:"time",label:"Shrado angle",value:e,symbol:"warning"}]:[]}const hl="Slow Slider",ml="Look for slider that require slow swing.",fl=!0,Yu=.025;let Ni;const[i0,qu]=Y.createNumber(function(){Se.input.params.minSpeed=Math.abs(parseFloat(this.value))/1e3,this.value=M(Se.input.params.minSpeed*1e3,1).toString(),Ni&&(Wo.value=M(1/Ni.toBeatTime(Se.input.params.minSpeed,!1),2).toString())},"min speed (ms): ",M(Yu*1e3,1),0),[n0,Wo]=Y.createNumber(function(){if(!Ni){this.value="0";return}let t=M(Math.abs(parseFloat(this.value)),2)||1;Se.input.params.minSpeed=Ni.toRealTime(1/t),qu.value=M(Se.input.params.minSpeed*1e3,1).toString(),this.value=t.toString()}," (prec): ",0,0),Se={name:hl,description:ml,type:"note",order:{input:gt.NOTES_SLOW_SLIDER,output:bt.NOTES_SLOW_SLIDER},input:{enabled:fl,params:{minSpeed:Yu},html:Y.createBlock(Y.createCheckbox(function(){Se.input.enabled=this.checked},hl,ml,fl),document.createElement("br"),i0,qu,n0,Wo),adjustTime:o0},run:s0};function o0(t){Ni=t,Wo.value=M(1/Ni.toBeatTime(Se.input.params.minSpeed,!1),2).toString()}function r0(t){const{swingAnalysis:e}=t.beatmap,{minSpeed:i}=Se.input.params;return e.container.filter(n=>n.maxSpeed>i||n.minSpeed>i)}function s0(t){const{minSpeed:e}=Se.input.params,i=r0(t);return i.length?[{type:"time",label:`Slow slider (>${M(e*1e3,1)}ms)`,value:i.map(n=>n.data[0]),symbol:"warning"}]:[]}const pl="Speed Pause",dl="Look for stream/burst containing timing gap causing sudden change of pace.",gl=!1,Ku=.075;let Ai;const[a0,Zu]=Y.createNumber(function(){Ne.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(Ne.input.params.maxTime*1e3,1).toString(),Ai&&(Xo.value=M(1/Ai.toBeatTime(Ne.input.params.maxTime,!1),2).toString())},"stream speed (ms): ",M(Ku*1e3,1),0),[l0,Xo]=Y.createNumber(function(){if(!Ai){this.value="0";return}let e=M(Math.abs(parseFloat(this.value)),2)||1;Ne.input.params.maxTime=Ai.toRealTime(1/e),Zu.value=M(Ne.input.params.maxTime*1e3,1).toString(),this.value=e.toString()}," (prec): ",0,0),Ne={name:pl,description:dl,type:"note",order:{input:gt.NOTES_SPEED_PAUSE,output:bt.NOTES_SPEED_PAUSE},input:{enabled:gl,params:{maxTime:Ku},html:Y.createBlock(Y.createCheckbox(function(){Ne.input.enabled=this.checked},pl,dl,gl),document.createElement("br"),a0,Zu,l0,Xo),adjustTime:c0},run:h0};function c0(t){Ai=t,Xo.value=M(1/Ai.toBeatTime(Ne.input.params.maxTime,!1),2).toString()}function u0(t){const e=t.timeProcessor,i=t.data.colorNotes,{maxTime:n}=Ne.input.params,o=e.toBeatTime(n,!1)+.001,l={},s={},r={[rt.RED]:!1,[rt.BLUE]:!1},a={[rt.RED]:[],[rt.BLUE]:[]},u=[];for(let f=0,m=i.length;f<m;f++){const h=i[f];l[h.color]?oe.next(h,l[h.color],e,a[h.color])&&(h.time-l[h.color].time<=o*2?(r[rt.RED]&&r[rt.BLUE]&&l[h.color].time-s[h.color].time<=o*3&&u.push(l[h.color]),r[h.color]=!1):r[h.color]||(r[h.color]=!0,s[h.color]=l[h.color]),a[h.color]=[],l[h.color]=h):l[h.color]=h,a[h.color].push(h)}return u}function h0(t){const e=u0(t.beatmap);return e.length?[{type:"time",label:"Speed pause",value:e,symbol:"warning"}]:[]}const bl="Stacked Note",vl="Look for stacked note.",_l=!0,Ju={name:bl,description:vl,type:"note",order:{input:gt.NOTES_STACKED_NOTE,output:bt.NOTES_STACKED_NOTE},input:{enabled:_l,params:{},html:Y.createBlock(Y.createCheckbox(function(){Ju.input.enabled=this.checked},bl,vl,_l))},run:p0};function m0(t){const e=t.data.colorNotes,i=[];let n=0;for(let o=0,l=e.length;o<l;o++)if(!(e[o].customData.__mapcheck_secondtime<n+.01))for(let s=o+1;s<l&&!(e[s].customData.__mapcheck_secondtime>e[o].customData.__mapcheck_secondtime+.01);s++)e[s].isInline(e[o])&&(i.push(e[o]),n=e[o].customData.__mapcheck_secondtime);return i}function f0(t){const e=t.timeProcessor,i=t.njs,n=t.data.bombNotes,o=[];for(let l=0,s=n.length;l<s;l++)for(let r=l+1;r<s&&!(n[r].customData.__mapcheck_secondtime>n[l].customData.__mapcheck_secondtime+1);r++)n[l].isInline(n[r])&&(i.value<e.bpm/(120*(n[r].time-n[l].time))||n[r].customData.__mapcheck_secondtime<n[l].customData.__mapcheck_secondtime+.02)&&o.push(n[l]);return o}function p0(t){const e=m0(t.beatmap),i=f0(t.beatmap),n=[];return e.length&&n.push({type:"time",label:"Stacked note",value:e,symbol:"error"}),i.length&&n.push({type:"time",label:"Stacked bomb",value:i,symbol:"error"}),n}const yl="Varying Swing Speed",El="Check for varying swing speed due to changes in slider distance.",Dl=!0,Qu={name:yl,description:El,type:"note",order:{input:gt.NOTES_VARY_SWING,output:bt.NOTES_VARY_SWING},input:{enabled:Dl,params:{},html:Y.createBlock(Y.createCheckbox(function(){Qu.input.enabled=this.checked},yl,El,Dl))},run:g0};function d0(t){const{swingAnalysis:e}=t;return e.container.filter(i=>Math.abs(i.minSpeed-i.maxSpeed)>.002)}function g0(t){const e=d0(t.beatmap);return e.length?[{type:"time",label:"Varying swing speed",value:e.map(i=>i.data[0]),symbol:"error"}]:[]}const Cl="Vision Block",Sl="Check for vision block caused by center note.",wl=!0,th=.1,eh=.5;let Xt;const kl={Easy:{min:.025,max:1.2},Normal:{min:.05,max:1},Hard:{min:.08,max:.75},Expert:{min:.1,max:.625},ExpertPlus:{min:.1,max:.5}},[b0,v0]=Y.createRadio(nh," VB time specific ","vb-spec","time",!1),[_0,y0]=Y.createRadio(nh," VB difficulty specific ","vb-spec","difficulty",!0),[E0,ih]=Y.createNumber(function(){yt.input.params.minTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(yt.input.params.minTime*1e3,1).toString(),Xt&&(Yo.value=M(Xt.toBeatTime(yt.input.params.minTime,!1),2).toString(),yt.input.params.minTime>yt.input.params.maxTime&&(yt.input.params.maxTime=yt.input.params.minTime,no.value=M(yt.input.params.maxTime*1e3,1).toString(),Qi.value=M(Xt.toBeatTime(yt.input.params.maxTime,!1),2).toString()))},"min time (ms): ",M(th*1e3,1),0),[D0,Yo]=Y.createNumber(function(){if(!Xt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;yt.input.params.minTime=Xt.toRealTime(t),ih.value=M(yt.input.params.minTime*1e3,1).toString(),this.value=M(t,2).toString(),yt.input.params.minTime>yt.input.params.maxTime&&(yt.input.params.maxTime=yt.input.params.minTime,no.value=M(yt.input.params.maxTime*1e3,1).toString(),Qi.value=M(Xt.toBeatTime(yt.input.params.maxTime,!1),2).toString())}," (beat): ",0,0,null,.1),[C0,no]=Y.createNumber(function(){yt.input.params.maxTime=Math.abs(parseFloat(this.value))/1e3,this.value=M(yt.input.params.maxTime*1e3,1).toString(),Xt&&(Qi.value=M(Xt.toBeatTime(yt.input.params.maxTime,!1),2).toString())},"max time (ms): ",M(eh*1e3,1),0),[S0,Qi]=Y.createNumber(function(){if(!Xt){this.value="0";return}const t=Math.abs(parseFloat(this.value))||1;yt.input.params.maxTime=Xt.toRealTime(t),no.value=M(yt.input.params.maxTime*1e3,1).toString(),this.value=M(t,2).toString()}," (beat): ",0,0,null,.1),yt={name:Cl,description:Sl,type:"note",order:{input:gt.NOTES_VISION_BLOCK,output:bt.NOTES_VISION_BLOCK},input:{enabled:wl,params:{specific:"difficulty",minTime:th,maxTime:eh},html:Y.createBlock(Y.createCheckbox(function(){yt.input.enabled=this.checked},Cl,Sl,wl),document.createElement("br"),v0,b0,y0,_0,document.createElement("br"),E0,ih,D0,Yo,document.createElement("br"),C0,no,S0,Qi),adjustTime:w0},run:T0};function w0(t){Xt=t,Yo.value=M(Xt.toBeatTime(yt.input.params.minTime,!1),2).toString(),Qi.value=M(Xt.toBeatTime(yt.input.params.maxTime,!1),2).toString()}function nh(){yt.input.params.specific=this.value}function k0(t){const{timeProcessor:e,njs:i}=t.beatmap,n=t.beatmap.noteContainer.filter(h=>h.type!==at.ARC),{minTime:o,maxTime:l,specific:s}=yt.input.params,r=s==="time"?e.toBeatTime(o,!1):e.toBeatTime(kl[t.beatmap.settings.difficulty].min,!1),a=s==="time"?e.toBeatTime(l,!1):Math.min(i.hjd,e.toBeatTime(kl[t.beatmap.settings.difficulty].max,!1));let u=null,f=null;const m=[];for(let h=0,c=n.length;h<c;h++){const g=n[h];u&&(g.data.time-u.data.time>=r&&g.data.time-u.data.time<=a?g.data.posX<ct.MIDDLE_RIGHT&&m.push(g):g.data.time-u.data.time>a&&(u=null)),f&&(g.data.time-f.data.time>=r&&g.data.time-f.data.time<=a?g.data.posX>ct.MIDDLE_LEFT&&m.push(g):g.data.time-f.data.time>a&&(f=null)),g.data.posY===Rt.MIDDLE&&g.data.posX===ct.MIDDLE_LEFT&&(u=g),g.data.posY===Rt.MIDDLE&&g.data.posX===ct.MIDDLE_RIGHT&&(f=g)}return m}function T0(t){const e=k0(t);return e.length?[{type:"time",label:"Vision block",value:e.map(i=>i.data),symbol:"warning"}]:[]}const Tl=Object.freeze(Object.defineProperty({__proto__:null,acceptablePrec:Hi,colorCheck:Tu,doubleDirectional:Lu,effectiveBPM:ie,hitboxInline:Bu,hitboxPath:Iu,hitboxReverseStair:Nu,hitboxStair:Au,improperArc:Ou,improperChain:$u,improperWindow:Pu,inlineAngle:Ie,oneSaber:zu,parity:Uo,shradoAngle:be,slowSlider:Se,speedPause:Ne,stackedNote:Ju,varySwing:Qu,visionBlock:yt},Symbol.toStringTag,{value:"Module"})),Ll="<15ms Obstacle",Rl=`Look for obstacle with inadequate duration.
This causes player to not take damage when in collision with obstacle.`,xl=!0,qo={name:Ll,description:Rl,type:"obstacle",order:{input:gt.OBSTACLES_SHORT,output:bt.OBSTACLES_SHORT},input:{enabled:xl,params:{minDur:.015},html:Y.createBlock(Y.createCheckbox(function(){qo.input.enabled=this.checked},Ll,Rl,xl))},run:R0};function L0(t){const{obstacles:e}=t.beatmap.data,{timeProcessor:i}=t.beatmap,{minDur:n}=qo.input.params,o=i.toBeatTime(n,!1),l=[];let s=new De,r=new De,a=new De,u=new De;for(let f=0;f<e.length;f++){const m=e[f];m.posY===Rt.BOTTOM&&m.height>2&&m.duration>0?m.width>2||m.width>1&&m.posX===1?(m.isLonger(s)&&(m.duration<o&&l.push(m),s=m),m.isLonger(r)&&(m.duration<o&&l.push(m),r=m)):m.width===2?m.posX===ct.LEFT?m.isLonger(s)&&(m.duration<o&&l.push(m),s=m):m.posX===ct.MIDDLE_RIGHT&&m.isLonger(r)&&(m.duration<o&&l.push(m),r=m):m.width===1&&(m.posX===ct.MIDDLE_LEFT?m.isLonger(s)&&(m.duration<o&&l.push(m),s=m):m.posX===ct.MIDDLE_RIGHT&&m.isLonger(r)&&(m.duration<o&&l.push(m),r=m)):m.posY===Rt.TOP&&m.height>2&&m.duration>0&&(m.width>2||m.width>1&&m.posX===ct.MIDDLE_LEFT?(m.isLonger(a)&&(m.duration<o&&m.isLonger(s,o)&&m.isLonger(a,o)&&l.push(m),a=m),m.isLonger(u)&&(m.duration<o&&m.isLonger(r,o)&&m.isLonger(u,o)&&l.push(m),u=m)):m.width===2?m.posX===ct.LEFT?m.isLonger(a)&&(m.duration<o&&m.isLonger(s,o)&&m.isLonger(a,o)&&l.push(m),a=m):m.posX===ct.MIDDLE_RIGHT&&m.isLonger(u)&&(m.duration<o&&m.isLonger(r,o)&&m.isLonger(u,o)&&l.push(m),u=m):m.width===1&&(m.posX===ct.MIDDLE_LEFT?m.isLonger(a)&&(m.duration<o&&m.isLonger(s,o)&&m.isLonger(a,o)&&l.push(m),a=m):m.posX===ct.MIDDLE_RIGHT&&m.isLonger(u)&&(m.duration<o&&m.isLonger(r,o)&&m.isLonger(u,o)&&l.push(m),u=m)))}return l}function R0(t){const e=L0(t);return e.length?[{type:"time",label:"<15ms obstacle",value:e,symbol:"warning"}]:[]}const Bl="2-wide Center Obstacle",Il="Look for 2-wide center obstacle including obstacles that are relatively close to each other.",Nl=!0,oh=.25;let Oi;const[x0,rh]=Y.createNumber(function(){we.input.params.recovery=Math.abs(parseFloat(this.value))/1e3,this.value=M(we.input.params.recovery*1e3,1).toString(),Oi&&(Ko.value=M(Oi.toBeatTime(we.input.params.recovery,!1),2).toString())},"recovery time (ms): ",M(oh*1e3,1),0),[B0,Ko]=Y.createNumber(function(){if(!Oi){this.value="0";return}let t=M(Math.abs(parseFloat(this.value)),2)||1;we.input.params.recovery=Oi.toRealTime(t,!0),rh.value=M(we.input.params.recovery*1e3,1).toString(),this.value=t.toString()}," (beat): ",0,0,.1),we={name:Bl,description:Il,type:"obstacle",order:{input:gt.OBSTACLES_CENTER,output:bt.OBSTACLES_CENTER},input:{enabled:Nl,params:{recovery:oh},html:Y.createBlock(Y.createCheckbox(function(){we.input.enabled=this.checked},Bl,Il,Nl),document.createElement("br"),x0,rh,B0,Ko),adjustTime:I0},run:A0};function I0(t){Oi=t,Ko.value=M(Oi.toBeatTime(we.input.params.recovery,!1),2).toString()}function N0(t){const{obstacles:e}=t.beatmap.data,{timeProcessor:i}=t.beatmap,{recovery:n}=we.input.params,o=[];let l=new De,s=new De;for(let r=0;r<e.length;r++){const a=e[r];a.posY<Rt.TOP&&a.height>1&&(a.width>2&&(o.push(a),a.isLonger(l)&&(l=a),a.isLonger(s)&&(s=a)),a.width===2&&(a.posX===ct.LEFT&&a.isLonger(l)&&(a.customData.__mapcheck_secondtime>s.customData.__mapcheck_secondtime-n&&a.customData.__mapcheck_secondtime<s.customData.__mapcheck_secondtime+i.toRealTime(s.duration)+n&&o.push(a),l=a),a.posX===ct.MIDDLE_LEFT&&(o.push(a),a.isLonger(l)&&(l=a),a.isLonger(s)&&(s=a)),a.posX===ct.MIDDLE_RIGHT&&a.isLonger(s)&&(a.customData.__mapcheck_secondtime>l.customData.__mapcheck_secondtime-n&&a.customData.__mapcheck_secondtime<l.customData.__mapcheck_secondtime+i.toRealTime(l.duration)+n&&o.push(a),s=a)),a.width===1&&(a.posX===ct.MIDDLE_LEFT&&a.isLonger(l)&&(a.customData.__mapcheck_secondtime>s.customData.__mapcheck_secondtime-n&&a.customData.__mapcheck_secondtime<s.customData.__mapcheck_secondtime+i.toRealTime(s.duration)+n&&o.push(a),l=a),a.posX===ct.MIDDLE_RIGHT&&a.isLonger(s)&&(a.customData.__mapcheck_secondtime>l.customData.__mapcheck_secondtime-n&&a.customData.__mapcheck_secondtime<l.customData.__mapcheck_secondtime+i.toRealTime(l.duration)+n&&o.push(a),s=a)))}return o}function A0(t){const e=N0(t),{recovery:i}=we.input.params;return e.length?[{type:"time",label:`2-wide center obstacle (<${M(i*1e3)}ms)`,value:e,symbol:"error"}]:[]}const Al="Zero Obstacle",Ol="Look for obstacle with zero value.",$l=!0,sh={name:Al,description:Ol,type:"obstacle",order:{input:gt.OBSTACLES_ZERO,output:bt.OBSTACLES_ZERO},input:{enabled:$l,params:{},html:Y.createBlock(Y.createCheckbox(function(){sh.input.enabled=this.checked},Al,Ol,$l))},run:$0};function O0(t){const{obstacles:e}=t.beatmap.data;return e.filter(i=>i.hasZero())}function $0(t){const e=O0(t);return e.length?[{type:"time",label:"Zero value obstacle",value:e,symbol:"error"}]:[]}const Pl=Object.freeze(Object.defineProperty({__proto__:null,centerObstacle:we,shortObstacle:qo,zeroObstacle:sh},Symbol.toStringTag,{value:"Module"})),Ml="Insufficient Lighting Event",Fl="Check if there is enough light event.",zl=!0,ah={name:Ml,description:Fl,type:"event",order:{input:gt.EVENTS_INSUFFICIENT_LIGHT,output:bt.EVENTS_INSUFFICIENT_LIGHT},input:{enabled:zl,params:{},html:Y.createBlock(Y.createCheckbox(function(){ah.input.enabled=this.checked},Ml,Fl,zl))},run:M0};function P0(t,e){let i=0;for(let n=t.length-1;n>=0;n--)if(t[n].isLightEvent(e)&&!t[n].isOff()&&(i++,i>10))return!0;return!1}function M0(t){const e=t.beatmap.environment;if(!P0(t.beatmap.data.basicEvents,e))switch(e){case"DefaultEnvironment":case"OriginsEnvironment":case"TriangleEnvironment":case"NiceEnvironment":case"BigMirrorEnvironment":case"DragonsEnvironment":case"KDAEnvironment":case"MonstercatEnvironment":case"CrabRaveEnvironment":case"PanicEnvironment":case"RocketEnvironment":case"GreenDayEnvironment":case"GreenDayGrenadeEnvironment":case"TimbalandEnvironment":case"FitBeatEnvironment":case"LinkinParkEnvironment":case"BTSEnvironment":case"KaleidoscopeEnvironment":case"InterscopeEnvironment":case"SkrillexEnvironment":case"BillieEnvironment":case"HalloweenEnvironment":case"GagaEnvironment":case"GlassDesertEnvironment":return[{type:"string",label:"Insufficient light event",value:"",symbol:"rank"}];default:return[{type:"string",label:"Unknown light event",value:"v3 environment light should be manually checked",symbol:"rank"}]}return[]}const Vl="Invalid Event Box",Gl="Check for valid event box group usage.",Hl=!0,lh={name:Vl,description:Gl,type:"event",order:{input:gt.EVENTS_INVALID_EVENT_BOX,output:bt.EVENTS_INVALID_EVENT_BOX},input:{enabled:Hl,params:{},html:Y.createBlock(Y.createCheckbox(function(){lh.input.enabled=this.checked},Vl,Gl,Hl))},run:z0},Ul={EDMEnvironment:{0:24,1:24,2:24,3:24,4:24,5:24,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:1,15:1,16:1,17:1},LizzoEnvironment:{0:40,1:16,2:16,3:16,4:16,5:16,6:1,7:1,8:12,9:12,10:12,11:6,12:6,13:14,14:14,15:4,16:4,17:3,18:3,19:14},PyroEnvironment:{0:3,1:3,2:5,3:5,4:3,5:12,6:48,7:48,8:4,9:4,10:3,11:3,12:10,13:10},TheSecondEnvironment:{0:15,1:24,2:12,3:12,4:12,5:12,6:4,7:4,8:4,9:4,10:4,11:4,12:4,13:4},TheWeekndEnvironment:{0:4,1:4,2:4,3:4,4:8,5:4,6:4,7:12,8:1,9:6,10:25,11:25,12:25,13:25,14:25,15:25,16:25,17:25,18:25,19:25,20:3,21:3,22:8,23:8,29:3,30:3,31:3,32:3,33:3,34:3,35:3,36:3,37:6,38:6,40:2},RockMixtapeEnvironment:{0:5,1:5,2:10,3:10,4:10,5:10,6:10,7:10,8:10,9:10,10:10,11:10,12:10,13:10,14:3,15:10,16:5,17:5,18:24,19:24,20:12,21:12,22:8,23:8,24:36,25:3,26:36,27:3,28:5,29:2,30:16,31:4,32:4,33:4,34:4,35:2,36:2,37:2},WeaveEnvironment:{0:8,1:8,2:8,3:8,4:8,5:8,6:8,7:8,8:8,9:8,10:8,11:8,12:12,13:12,14:8,15:8},Dragons2Environment:{0:24,1:96,2:35,3:15,4:8,5:12,6:12,7:5,8:5,9:5,10:5,11:5,12:5},Panic2Environment:{0:7,1:7,2:7,3:7,4:8,5:8,6:24,7:24,8:24,9:6,10:6,11:6,12:6,13:14,14:14,15:2,16:28,17:28,18:1,19:1,20:12,21:1,22:12,23:1}};function F0(t,e){const i=[],n=[];if(!Ul[e])return{defectID:[],defectFilter:[]};const o=e,l=gi[o][1],s=[...t.lightColorEventBoxGroups,...t.lightRotationEventBoxGroups,...t.lightTranslationEventBoxGroups];for(const r of s){l.includes(r.id)||i.push(r);for(const a of r.boxes){const u=a.filter;u.type===su.STEP_AND_OFFSET&&u.p0>Ul[o][r.id]&&n.push(r)}}return{defectID:i,defectFilter:n}}function z0(t){const e=F0(t.beatmap.data,t.beatmap.environment),i=[];return e.defectID.length&&i.push({type:"time",label:"Invalid event box group ID",value:e.defectID,symbol:"error"}),e.defectFilter.length&&i.push({type:"time",label:"Invalid event box filter",value:e.defectFilter,symbol:"error"}),i}const jl="Unlit Bomb",Wl="Check for lighting around bomb.",Xl=!0,ch={name:jl,description:Wl,type:"event",order:{input:gt.EVENTS_UNLIT_BOMB,output:bt.EVENTS_UNLIT_BOMB},input:{enabled:Xl,params:{},html:Y.createBlock(Y.createCheckbox(function(){ch.input.enabled=this.checked},jl,Wl,Xl))},run:G0},V0=(t,e,i,n)=>{var m;if(!e.length)return[];const o=[],l=((m=gi[n])==null?void 0:m[0])??gi.DefaultEnvironment[0],s=e.filter(h=>h.isLightEvent(n)&&l.includes(h.type)).sort((h,c)=>h.type-c.type),r={0:{state:"off",time:0,fadeTime:0},1:{state:"off",time:0,fadeTime:0},2:{state:"off",time:0,fadeTime:0},3:{state:"off",time:0,fadeTime:0},4:{state:"off",time:0,fadeTime:0},6:{state:"off",time:0,fadeTime:0},7:{state:"off",time:0,fadeTime:0},10:{state:"off",time:0,fadeTime:0},11:{state:"off",time:0,fadeTime:0}},a={};l.forEach(h=>a[h]=[[0,!1]]);const u=i.toBeatTime(1,!1),f=i.toBeatTime(.25,!1);for(let h=0,c=s.length;h<c;h++){const g=s[h];if((g.isOn()||g.isFlash())&&r[g.type].state!=="on"){r[g.type]={state:"on",time:g.time,fadeTime:0};const d=a[g.type].find(v=>v[0]>=g.time);d?(d[0]=g.time,d[1]=!0):a[g.type].push([g.time,!0])}if(g.isFade()){r[g.type]={state:"off",time:g.time,fadeTime:u};const d=a[g.type].find(v=>v[0]>=g.time);d?(d[0]=g.time,d[1]=!0):a[g.type].push([g.time,!0]),a[g.type].push([g.time+u,!1])}(((g==null?void 0:g.floatValue)??1)<.25||g.isOff()||g.customData._color&&(typeof g.customData._color[3]=="number"&&g.customData._color[3]<.25||Math.max(g.customData._color[0],g.customData._color[1],g.customData._color[2])<.25)||g.customData.color&&(typeof g.customData.color[3]=="number"&&g.customData.color[3]<.25||Math.max(g.customData.color[0],g.customData.color[1],g.customData.color[2])<.25))&&r[g.type].state!=="off"&&(r[g.type]={state:"off",time:g.time,fadeTime:r[g.type].state==="on"?f:Math.min(f,r[g.type].fadeTime)},a[g.type].push([g.time+(r[g.type].state==="on"?f:Math.min(f,r[g.type].fadeTime)),!1]))}for(const h in a)a[h].reverse();for(let h=0,c=t.length,g=!1;h<c;h++){const d=t[h];g=!1;for(const v in a){const _=a[v].find(y=>y[0]<=d.time);_&&(g=g||_[1])}g||o.push(d)}return o};function G0(t){const e=V0(t.beatmap.data.bombNotes,t.beatmap.data.basicEvents,t.beatmap.timeProcessor,t.beatmap.environment);return e.length?[{type:"time",label:"Unlit bomb",value:e,symbol:"warning"}]:[]}const Yl=Object.freeze(Object.defineProperty({__proto__:null,insufficientLight:ah,invalidEventBox:lh,unlitBomb:ch},Symbol.toStringTag,{value:"Module"})),ql="Hot Start",Kl="Check for first interactive object starting from start time.",Zl=!0,Jl=1.5,Ui={name:ql,description:Kl,type:"other",order:{input:gt.OTHERS_HOT_START,output:bt.OTHERS_HOT_START},input:{enabled:Zl,params:{time:Jl},html:Y.createBlock(Y.createCheckbox(function(){Ui.input.enabled=this.checked},ql+" (s): ",Kl,Zl),Y.createNumber(function(){Ui.input.params.time=M(Math.abs(parseFloat(this.value)),3),this.value=Ui.input.params.time.toString()},"",Jl,0,null,.1))},run:H0};function H0(t){const{time:e}=Ui.input.params,i=t.beatmap.timeProcessor.toRealTime(tu(t.beatmap.data));return i<e?[{type:"string",label:"Hot start",value:`${M(i,2)}s`,symbol:"warning"}]:[]}const Ql="Difficulty Label Check",tc="For ranking purpose, check difficulty label to fit rankability criteria.",ec=!0,uh={name:Ql,description:tc,type:"other",order:{input:gt.OTHERS_DIFFICULTY_LABEL,output:bt.OTHERS_DIFFICULTY_LABEL},input:{enabled:ec,params:{},html:Y.createBlock(Y.createCheckbox(function(){uh.input.enabled=this.checked},Ql,tc,ec))},run:U0};function U0(t){const e=t.beatmap.settings.customData._difficultyLabel;return e&&e.length>30?[{type:"string",label:`Difficulty label is too long (${e.length} characters)`,value:"exceeded 30 max characters by ranking criteria",symbol:"rank"}]:[]}const ic="NJS Check",nc="Check note jump speed for suitable value.",oc=!0,hh={name:ic,description:nc,type:"other",order:{input:gt.OTHERS_NJS,output:bt.OTHERS_NJS},input:{enabled:oc,params:{},html:Y.createBlock(Y.createCheckbox(function(){hh.input.enabled=this.checked},ic,nc,oc))},run:j0};function j0(t){const{njs:e,timeProcessor:i}=t.beatmap,n=[];return t.beatmap.settings.njs===0&&n.push({type:"string",label:"Unset NJS",value:"fallback NJS is used",symbol:"error"}),e.value>23&&n.push({type:"string",label:`NJS is too high (${M(e.value,2)})`,value:"use lower whenever possible",symbol:"warning"}),e.value<3&&n.push({type:"string",label:`NJS is too low (${M(e.value,2)})`,value:"timing is less significant below this",symbol:"warning"}),e.jd>36&&n.push({type:"string",label:"Very high jump distance",value:`${M(e.jd,2)}`,symbol:"warning"}),e.jd<18&&n.push({type:"string",label:"Very low jump distance",value:`${M(e.jd,2)}`,symbol:"warning"}),e.jd>e.calcJdOptimal()[1]&&n.push({type:"string",label:`High jump distance warning (>${M(e.calcJdOptimal()[1],2)})`,value:"NJS & offset may be uncomfortable to play",symbol:"warning"}),i.toRealTime(e.hjd,!1)<.42&&n.push({type:"string",label:`Very quick reaction time (${M(i.toRealTime(e.hjd,!1)*1e3)}ms)`,value:"may lead to suboptimal gameplay",symbol:"warning"}),e.calcHjd(0)+e.offset<Oe.HJD_MIN&&n.push({type:"string",label:"Unnecessary negative offset",value:`will not drop below ${Oe.HJD_MIN}`,symbol:"warning"}),n}const rc="Outside Playable Object",sc="Look for any object starting before and after song timer.",ac=!0,mh={name:rc,description:sc,type:"other",order:{input:gt.OTHERS_OUTSIDE_PLAYABLE,output:bt.OTHERS_OUTSIDE_PLAYABLE},input:{enabled:ac,params:{},html:Y.createBlock(Y.createCheckbox(function(){mh.input.enabled=this.checked},rc,sc,ac))},run:W0};function qt(t,e,i){e.length&&e[0].time<0&&i.push({type:"string",label:t+"(s) before start time",value:`${M(e[0].time,3)} (${Wt(e[0].customData.__mapcheck_secondtime)}`,symbol:"error"})}function Kt(t,e,i,n){e.length&&e[e.length-1].time>i&&n.push({type:"string",label:t+"(s) after end time",value:`${M(e[e.length-1].time,3)} (${Wt(e[e.length-1].customData.__mapcheck_secondtime)})`,symbol:"error"})}function W0(t){const e=t.audioDuration,i=t.beatmap.timeProcessor,{colorNotes:n,bombNotes:o,obstacles:l,arcs:s,chains:r,basicEvents:a,colorBoostEvents:u,waypoints:f,lightColorEventBoxGroups:m,lightRotationEventBoxGroups:h,lightTranslationEventBoxGroups:c,fxEventBoxGroups:g}=t.beatmap.data,d=[];if(e){let v=i.toBeatTime(e,!0);qt("Note",n,d),qt("Bomb",o,d),qt("Obstacle",l,d),qt("Arc",s,d),qt("Chain",r,d),qt("Event",a,d),qt("Color Boost",u,d),qt("Waypoint",f,d),qt("Light Color Event Box Group",m,d),qt("Light Rotation Event Box Group",h,d),qt("Light Translation Event Box Group",c,d),qt("FX Event Box Group",g,d),Kt("Note",n,v,d),Kt("Bomb",o,v,d),Kt("Obstacle",l,v,d),Kt("Arc",s,v,d),Kt("Chain",r,v,d),Kt("Event",a,v,d),Kt("Color Boost",u,v,d),Kt("Waypoint",f,v,d),Kt("Light Color Event Box Group",m,v,d),Kt("Light Rotation Event Box Group",h,v,d),Kt("Light Translation Event Box Group",c,v,d),Kt("FX Event Box Group",g,v,d)}return d}const lc="Invalid Object",cc="Validate beatmap object to be compatible with vanilla (ignores for modded).",uc=!0,fh={name:lc,description:cc,type:"other",order:{input:gt.OTHERS_INVALID_OBJECT,output:bt.OTHERS_INVALID_OBJECT},input:{enabled:uc,params:{},html:Y.createBlock(Y.createCheckbox(function(){fh.input.enabled=this.checked},lc,cc,uc))},run:X0};function X0(t){var W,et;const{colorNotes:e,bombNotes:i,obstacles:n,arcs:o,chains:l,waypoints:s,basicEvents:r,colorBoostEvents:a,lightColorEventBoxGroups:u,lightRotationEventBoxGroups:f,lightTranslationEventBoxGroups:m,fxEventBoxGroups:h}=t.beatmap.data;let c=[],g=[],d=[],v=[],_=[];if(!((W=t.beatmap.settings.customData._requirements)!=null&&W.includes("Mapping Extensions")))if((et=t.beatmap.settings.customData._requirements)!=null&&et.includes("Noodle Extensions")){const C=t.beatmap.rawVersion===2?ad:ld;c=e.filter(md),g=n.filter(C),d=i.filter(ud),v=o.filter(cd),_=l.filter(hd)}else c=e.filter(C=>!C.isValid()),g=n.filter(C=>!C.isValid()),d=i.filter(C=>!C.isValid()),v=o.filter(C=>!C.isValid()),_=l.filter(C=>!C.isValid());const y=s.filter(C=>!C.isValid()),S=r.filter(C=>!C.isValid()),w=a.filter(C=>!C.isValid()),k=u.filter(C=>!C.isValid()),O=f.filter(C=>!C.isValid()),P=m.filter(C=>!C.isValid()),G=h.filter(C=>!C.isValid()),I=[];return c.length&&I.push({type:"time",label:"Invalid note",value:c,symbol:"error"}),d.length&&I.push({type:"time",label:"Invalid bomb",value:d,symbol:"error"}),v.length&&I.push({type:"time",label:"Invalid arc",value:v,symbol:"error"}),_.length&&I.push({type:"time",label:"Invalid chain",value:_,symbol:"error"}),g.length&&I.push({type:"time",label:"Invalid obstacle",value:g,symbol:"error"}),y.length&&I.push({type:"time",label:"Invalid waypoint",value:y,symbol:"error"}),S.length&&I.push({type:"time",label:"Invalid event",value:S,symbol:"error"}),w.length&&I.push({type:"time",label:"Invalid color boost",value:w,symbol:"error"}),k.length&&I.push({type:"time",label:"Invalid light color event",value:k,symbol:"error"}),O.length&&I.push({type:"time",label:"Invalid light rotation event",value:O,symbol:"error"}),P.length&&I.push({type:"time",label:"Invalid light translation event",value:P,symbol:"error"}),G.length&&I.push({type:"time",label:"Invalid FX event",value:G,symbol:"error"}),I}const hc=Object.freeze(Object.defineProperty({__proto__:null,difficultyLabel:uh,hotStart:Ui,invalidObject:fh,njs:hh,outsidePlayable:mh},Symbol.toStringTag,{value:"Module"}));class ph{constructor(){}static getNote(){return Object.keys(Tl).map(e=>Tl[e])}static getObstacle(){return Object.keys(Pl).map(e=>Pl[e])}static getEvent(){return Object.keys(Yl).map(e=>Yl[e])}static getOther(){return Object.keys(hc).map(e=>hc[e])}static getGeneral(){return Object.keys(Zr).map(e=>Zr[e])}static getDifficulty(){return[...this.getNote(),...this.getObstacle(),...this.getEvent(),...this.getOther()]}static getAll(){return[...this.getNote(),...this.getObstacle(),...this.getEvent(),...this.getOther(),...this.getGeneral()]}}function fi(t){return["analyzer",t]}const dh=ph.getAll().sort((t,e)=>t.order.input-e.order.input),gh=[...dh].sort((t,e)=>t.order.output-e.order.output);function bh(){ht.analysis={general:{output:[]},beatmap:[]}}function Y0(){var n;const t=ht.beatmapInfo;if(!t)return J.tError(fi("runGeneral"),"Could not analyse, missing map info"),[];ht.analysis||bh();const e=(n=ht.analysis)==null?void 0:n.general;J.tInfo(fi("runGeneral"),"Analysing general");const i=[];return gh.filter(o=>o.type==="general").forEach(o=>{if(o.input.enabled)try{const l=o.run({audioDuration:ht.duration??null,mapDuration:0,beatmap:null,info:t});i.push(...l)}catch(l){J.tError(fi("runGeneral"),l)}}),e&&(e.output=i),i}function vh(t,e){var s,r,a;const i=ht.beatmapInfo;if(!i)return J.tError(fi("runDifficulty"),"Could not analyse, missing map info"),[];ht.analysis||bh();const n=(s=ht.beatmaps)==null?void 0:s.find(u=>u.settings.characteristic===t&&u.settings.difficulty===e);if(!n)return J.tError(fi("runDifficulty"),"Could not analyse, missing map data"),[];const o=(r=ht.analysis)==null?void 0:r.beatmap.find(u=>u.difficulty===e&&u.characteristic===t);Oe.create(n.timeProcessor.bpm,n.settings.njs||Oe.FallbackNJS[n.settings.difficulty],n.settings.njsOffset),J.tInfo(fi("runDifficulty"),`Analysing ${t} ${e}`);const l=[];return gh.filter(u=>u.type!=="general").forEach(u=>{if(u.input.enabled)try{const f=u.run({audioDuration:ht.duration??null,mapDuration:n.timeProcessor.toRealTime(Po(n.data)),beatmap:n,info:i});l.push(...f)}catch(f){J.tError(fi("runDifficulty"),f)}}),o?o.output=l:(a=ht.analysis)==null||a.beatmap.push({characteristic:t,difficulty:e,output:l}),l}function q0(t){ph.getDifficulty().sort((i,n)=>i.order.output-n.order.output).forEach(i=>{i.input.adjustTime&&i.input.adjustTime(t)})}function K0(){var t;(t=ht.beatmaps)==null||t.forEach(e=>vh(e.settings.characteristic,e.settings.difficulty))}const vi={toolListInput:dh,runGeneral:Y0,runDifficulty:vh,adjustTime:q0,applyAll:K0};function _h(t,e,i,n,o,l){const s=document.createElement("div");s.className="tabs__container";const r=document.createElement("input");r.className="tabs__radio",r.type="radio",r.id=t,r.name=i,r.value=n,r.checked=o,r.addEventListener("change",l),s.appendChild(r);const a=document.createElement("label");a.className="tabs__label tabs__label-block unselectable",a.htmlFor=t;const u=document.createElement("div"),f=e.split(`
`);for(let m=0;m<f.length;m++){const h=f[m],c=document.createElement("span");c.textContent=h,u.appendChild(c),m!==f.length-1&&u.appendChild(document.createElement("br"))}return a.appendChild(u),s.appendChild(a),s}const Si=document.querySelector("#select-characteristic"),xe=document.querySelector("#select-difficulty");let Dn=[],ji=[];const oo=[];function yh(t){for(;Si.firstChild;)Si.removeChild(Si.firstChild);for(Dn=[];xe.firstChild;)xe.removeChild(xe.firstChild);if(ji=[],!t){const n=document.createElement("div");n.className="selection__content";const o=document.createElement("span");o.textContent="Empty",n.appendChild(o),Si.appendChild(n),Cn();return}let e=!0;const i=new Set;if(t.difficulties.forEach(n=>{var r;if(i.has(n.characteristic))return;i.add(n.characteristic);const o=(r=t.customData._characteristics)==null?void 0:r.find(a=>a.characteristic===n.characteristic),l=o?`${o.label}
(${ss[n.characteristic]||n.characteristic})`:ss[n.characteristic]||n.characteristic,s=_h(`select-${n.characteristic}`,l,"select-characteristic",n.characteristic,e,Z0);Dn.push(s.firstChild),Si.appendChild(s),e&&(Cn(n.characteristic),e=!1)}),Dn.length===0){const n=document.createElement("div");n.className="selection__content";const o=document.createElement("span");o.textContent="Empty",n.appendChild(o),Si.appendChild(n),Cn()}}function Cn(t){const e=ht.beatmapInfo;let i=en();for(;xe.firstChild;)xe.removeChild(xe.firstChild);if(ji=[],!t||!e){const o=document.createElement("div");o.className="selection__content";const l=document.createElement("span");l.textContent="Empty",o.appendChild(l),xe.appendChild(o);return}const n=e.difficulties.findIndex(o=>o.difficulty===i&&o.characteristic===t);for(let o=0;o<e.difficulties.length;o++){const l=e.difficulties[o];if(t!==l.characteristic)continue;const s=l.customData._difficultyLabel?`${l.customData._difficultyLabel}
(${Ke[l.difficulty]||l.difficulty})`:Ke[l.difficulty]||l.difficulty,r=_h(`select-${l.difficulty}`,s,"select-difficulty",l.difficulty,n===-1||o===n,J0);if(ji.push(r.firstChild),xe.appendChild(r),n===-1||o===n){const a=ht.beatmaps.find(u=>u.settings.difficulty===l.difficulty&&u.settings.characteristic===e.difficulties[o].characteristic);if(!a)throw new Error("missing data");eu(ht.beatmapInfo,a),oo.forEach(u=>u(l.characteristic,l.difficulty))}}if(ji.length===0){const o=document.createElement("div");o.className="selection__content";const l=document.createElement("span");l.textContent="Empty",o.appendChild(l),xe.appendChild(o)}}function Z0(t){var n;const e=t.target,i=(n=ht.beatmapInfo)==null?void 0:n.difficulties.find(o=>o.characteristic===e.value);Cn(i==null?void 0:i.characteristic)}function J0(t){var o,l;const e=t.target,i=(o=ht.beatmapInfo)==null?void 0:o.difficulties.find(s=>s.characteristic===tn());if(!i)throw new Error("aaaaaaaaaaaaaaaaaaa");const n=(l=ht.beatmaps)==null?void 0:l.find(s=>s.settings.difficulty===e.value&&s.settings.characteristic===i.characteristic);n&&(eu(ht.beatmapInfo,n),oo.forEach(s=>s(n.settings.characteristic,n.settings.difficulty)))}function tn(){var t;return((t=Dn.filter(e=>e.checked)[0])==null?void 0:t.value)??null}function en(){var t;return((t=ji.filter(e=>e.checked)[0])==null?void 0:t.value)??null}function Q0(){yh()}const Eh={populateSelectCharacteristic:yh,reset:Q0};function Dh(t,e){switch(e){case"rank":t='<span title="Ranking: for rankability reason.">  </span>'+t;break;case"error":t='<span title="Error: should be fixed unless you know what you are doing.">  </span>'+t;break;case"warning":t='<span title="Warning: not necessarily needed to be fixed, worth considering.">  </span>'+t;break;case"info":t='<span title="Info: no action necessary, take note.">  </span>'+t;break}return t}function mc(t,e,i){const n=document.createElement("div");return t=Dh(t,i),e?n.innerHTML=`<b>${t}:</b> ${e}`:n.innerHTML=`<b>${t}</b>`,n}function tg(t,e,i){return e===0||t.time!==i[e-1].time}function eg(t,e,i){const n=document.createElement("div");return nt.deduplicateTime&&(e=e.filter(tg)),t=Dh(t,i),n.innerHTML=`<b>${t} [${e.length}]:</b> ${e.map(o=>{switch(nt.beatNumbering){case"realtime":return`<span title="Beat ${M(o.customData.__mapcheck_beattime,nt.rounding)}">${Wt(o.customData.__mapcheck_secondtime)}</span>`;case"realtimems":return`<span title="Beat ${M(o.customData.__mapcheck_beattime,nt.rounding)}">${vn(o.customData.__mapcheck_secondtime)}</span>`;case"jsontime":return`<span title="Time ${vn(o.customData.__mapcheck_secondtime)}">${M(o.time,nt.rounding)}</span>`;case"beattime":default:return`<span title="Time ${vn(o.customData.__mapcheck_secondtime)}">${M(o.customData.__mapcheck_beattime,nt.rounding)}</span>`}}).join(", ")}`,n}const nn="UI Checks: ",ig=document.querySelectorAll(".difficulty__label"),ng=document.querySelector(".checks__note-content"),og=document.querySelector(".checks__obstacle-content"),rg=document.querySelector(".checks__event-content"),sg=document.querySelector(".checks__other-content"),ag=document.querySelector(".checks__general-content"),Ge=document.querySelector(".checks__output-diff"),He=document.querySelector(".checks__output-general"),lg=document.querySelector(".checks__apply-this"),cg=document.querySelector(".checks__apply-all"),ug=document.querySelector(".checks__apply-general");lg.addEventListener("click",dg);cg.addEventListener("click",gg);ug.addEventListener("click",bg);function Ch(t){switch(t.type){case"string":return mc(t.label,t.value,t.symbol);case"number":return mc(t.label,t.value.join(", "),t.symbol);case"time":return eg(t.label,t.value,t.symbol);case"html":const e=document.createElement("div");return t.value.forEach(i=>e.appendChild(i)),e;default:throw new Error("Unexpected result type")}}function Sh(){var e;const t=(e=ht.analysis)==null?void 0:e.general;if(!t){He.textContent="ERROR: could not find analysis for general";return}if(!t.output){He.textContent="ERROR: could not find HTML for general";return}He.innerHTML="",t.output.forEach(i=>He.appendChild(Ch(i))),He.firstChild||(He.textContent="No issues found.")}function ro(t,e){var n;if(!t&&!e&&(t=tn(),e=en()),!t||!e)throw new Error(nn+"something went wrong!");Ge.innerHTML="";const i=(n=ht.analysis)==null?void 0:n.beatmap.find(o=>o.difficulty===e&&o.characteristic===t);if(!i){Ge.textContent="ERROR: could not find analysis for "+t+" "+e;return}if(!i.output){Ge.textContent="ERROR: could not find HTML for "+t+" "+e;return}i.output.forEach(o=>Ge.appendChild(Ch(o))),Ge.firstChild||(Ge.textContent="No issues found.")}function wh(t){ig.forEach(e=>e.textContent=t)}function hg(){const t=ht.beatmapInfo;if(!t)throw new Error(nn+"could not find map info");const e=Yn.create(t.audio.bpm);vi.adjustTime(e)}function mg(){vi.toolListInput.forEach(t=>{if(t.input.html)switch(t.type){case"note":{ng.appendChild(t.input.html);break}case"obstacle":{og.appendChild(t.input.html);break}case"event":{rg.appendChild(t.input.html);break}case"other":{sg.appendChild(t.input.html);break}case"general":{ag.appendChild(t.input.html);break}default:console.error(nn+"could not recognise type "+t.type+" for "+t.name)}})}function fg(){He&&(He.innerHTML="No output."),Ge&&(Ge.innerHTML="No output.")}function pg(){fg(),wh("Difficulty Label")}function dg(){const t=tn(),e=en();if(!t||!e)throw new Error(nn+"characteristic/difficulty does not exist");St.status("info",`Re-analysing ${t} ${e}`),vi.runDifficulty(t,e),St.status("info",`Re-analysed ${t} ${e}`),ro(t,e)}function gg(){const t=tn(),e=en();if(!t||!e)throw new Error(nn+"characteristic/difficulty does not exist");St.status("info","Re-analysing all difficulties"),vi.applyAll(),St.status("info","Re-analysed all difficulties"),ro(t,e)}function bg(){St.status("info","Re-analysing general"),vi.runGeneral(),St.status("info","Re-analysed general"),Sh()}oo.push(ro);const Wi={displayOutputGeneral:Sh,displayOutputDifficulty:ro,setDifficultyLabel:wh,adjustBeatTime:hg,populateTool:mg,reset:pg};function Ce(t){return["load",t]}async function vg(t,e){if(t.version===4){const n=e.file(t.audio.audioDataFilename);if(J.tInfo(Ce("extractBPMInfo"),"loading",t.audio.audioDataFilename),n){const o=await n.async("string").then(JSON.parse);return{duration:o.songSampleCount/o.songFrequency,bpm:o.bpmData.map(l=>({time:l.sb,bpm:(l.eb-l.sb)/((l.ei-l.si)/o.songFrequency)*60}))}}}const i=e.file("BPMInfo.dat");if(J.tInfo(Ce("extractBPMInfo"),"loading BPMInfo.dat"),i){const n=await i.async("string").then(JSON.parse);return{duration:n._songSampleCount/n._songFrequency,bpm:n._regions.map(o=>({time:o._startBeat,bpm:(o._endBeat-o._startBeat)/((o._endSampleIndex-o._startSampleIndex)/n._songFrequency)*60}))}}return null}async function _g(t){const e=t.file("Info.dat")||t.file("info.dat")||t.file("Info.json")||t.file("info.json");if(!e)throw new Error("Couldn't find Info.dat");return J.tInfo(Ce("extractInfo"),"loading info"),e.async("string").then(JSON.parse).then(rd)}async function yg(t,e){const i=t.file(e.lightshowFilename);i||J.tError(Ce("extractBeatmaps"),`Missing ${e.lightshowFilename} lightshow file for ${e.characteristic} ${e.difficulty}, ignoring.`),J.tInfo(Ce("extractBeatmaps"),`Loading ${e.characteristic} ${e.difficulty} lightshow`);try{const n=await i.async("string").then(JSON.parse),o=sd(n,{sort:nt.sorting,dataCheck:{enabled:nt.dataCheck}});return[n,o]}catch(n){J.tError(Ce("extractBeatmaps"),`Could not load ${e.lightshowFilename} lightshow file; ${n}`)}return null}function Eg(t,e){const i={};return t.difficulties.map(async n=>{var c;const o=n,l=e.file(o.filename);if(!l)return J.tError(Ce("extractBeatmaps"),`Missing ${o.filename} file for ${o.characteristic} ${o.difficulty}, ignoring.`),null;J.tInfo(Ce("extractBeatmaps"),`Loading ${o.characteristic} ${o.difficulty}`);let s;try{s=await l.async("string").then(JSON.parse)}catch(g){throw new Error(`${o.characteristic} ${o.difficulty} ${g}`)}let r=typeof s._version=="string"?s._version.at(0):typeof s.version=="string"?s.version.at(0):null,a;r?a=parseInt(r):(J.tWarn(Ce("extractBeatmaps"),"Could not identify beatmap version from JSON, assume implicit version",2),a=2),s._notes&&s.version&&J.tError(Ce("extractBeatmaps"),`${o.characteristic} ${o.difficulty} contains 2 version of the map in the same file, attempting to load v3 instead`);let u=od(s,{sort:nt.sorting,dataCheck:{enabled:nt.dataCheck}}),f=a===4?new qi:u,m;if(a===4){i[o.lightshowFilename]||(i[o.lightshowFilename]=yg(e,o));const g=await i[o.lightshowFilename];g&&(m=g[0],f=g[1])}u.lightshow=f.lightshow;const h=Yn.create(t.audio.bpm,a===3?[...u.customData.BPMChanges??[],...(s.bpmEvents??[]).map(g=>g)]:a===2?u.customData._BPMChanges??u.customData._bpmChanges:a===1?s._BPMChanges:[],(c=o.customData)==null?void 0:c._editorOffset);return Cg(u,h),{settings:o,environment:(o.environmentId>0?t.environmentNames.at(o.environmentId):t.environmentNames[0])||"DefaultEnvironment",timeProcessor:h,njs:new Oe(h.bpm,o.njs,o.njsOffset),data:u,noteContainer:Dg(u),swingAnalysis:Vm(u,h,o.characteristic,o.difficulty),rawVersion:a,rawData:s,rawLightshow:m}})}function Dg(t){return[...t.colorNotes.map(e=>({data:e,type:at.COLOR})),...t.bombNotes.map(e=>({data:e,type:at.BOMB})),...t.chains.map(e=>({data:e,type:at.CHAIN})),...t.arcs.map(e=>({data:e,type:at.ARC}))].sort((e,i)=>e.data.time-i.data.time)}function Cg(t,e){const i=Sg(e);t.difficulty.customData.__mapcheck_precalculatetime||(t.bpmEvents.forEach(i),t.rotationEvents.forEach(i),t.colorNotes.forEach(i),t.bombNotes.forEach(i),t.obstacles.forEach(i),t.arcs.forEach(i),t.chains.forEach(i),t.difficulty.customData.__mapcheck_precalculatetime=!0),t.lightshow.customData.__mapcheck_precalculatetimelightshow||(t.waypoints.forEach(i),t.basicEvents.forEach(i),t.colorBoostEvents.forEach(i),t.lightColorEventBoxGroups.forEach(i),t.lightRotationEventBoxGroups.forEach(i),t.lightTranslationEventBoxGroups.forEach(i),t.fxEventBoxGroups.forEach(i),t.lightshow.customData.__mapcheck_precalculatetimelightshow=!0)}function Sg(t){return function(e){e.customData.__mapcheck_secondtime=t.toRealTime(e.time,!0),e.customData.__mapcheck_beattime=t.adjustTime(e.time)}}async function kh(t){return new Promise(function(e,i){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="json",n.timeout=5e3;let o=Date.now();n.onprogress=()=>{n.timeout+=Date.now()-o},n.onload=()=>{n.status===200&&e(n.response),n.status===404&&i("Error 404: Map does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function wg(t){const e=`https://api.beatsaver.com/maps/id/${t}`,i=await kh(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}async function kg(t){const e=`https://api.beatsaver.com/maps/hash/${t}`,i=await kh(e);if(i!=null&&i.versions.length)return i.versions[i.versions.length-1].downloadURL;throw new Error("could not find map download link")}function Ki(t){return["download",t]}async function Zo(t){return new Promise(function(e,i){const n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.timeout=5e3;let o=Date.now();n.onprogress=l=>{n.timeout+=Date.now()-o,St.status("download",`Downloading map: ${M(l.loaded/1024/1024,1)}MB / ${M(l.total/1024/1024,1)}MB`,l.loaded/l.total*100)},n.onload=()=>{n.status===200&&e(n.response),n.status===404&&i("Error 404: Map/link does not exist"),n.status===403&&i("Error 403: Forbidden"),i(`Error ${n.status}`)},n.onerror=()=>{i("Error downloading")},n.ontimeout=()=>{i("Connection timeout")},n.send()})}async function Th(t){const e=qh(t);J.tInfo(Ki("downloadFromID"),`fetching download URL from BeatSaver for map ID ${e}`),St.status("info","Fetching download URL from BeatSaver",0);const i=await wg(e);J.tInfo(Ki("downloadFromID"),`downloading from BeatSaver for map ID ${e}`),St.status("info","Requesting download from BeatSaver",0);const n=await Zo(i);return It.setCoverLink("https://beatsaver.com/maps/"+e,e),n}async function Tg(t){const e=Yh(t);if(e.match(/^(https?:\/\/)?(www\.)?beatsaver\.com\/maps\//))return Th(e.replace(/^https?:\/\/(www\.)?beatsaver\.com\/maps\//,"").match(/[a-fA-F0-9]*/)[0]);St.status("info","Requesting download from link",0),J.tInfo(Ki("downloadFromURL"),`downloading from ${e}`);let i=await Zo("https://cors.bsmg.dev/"+e);return It.setCoverLink(e),i}async function Lg(t){let e;if($o(t.trim()))e=t.trim();else throw new Error("invalid hash");J.tInfo(Ki("downloadFromHash"),`fetching download URL from BeatSaver for map hash ${e}`),St.status("info","Fetching download URL from BeatSaver",0);const i=await kg(e);return J.tInfo(Ki("downloadFromHash"),`downloading from BeatSaver for map hash ${e}`),St.status("info","Requesting download from BeatSaver",0),await Zo(i)}var pn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rg(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function dn(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Lh={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(i){t.exports=i()})(function(){return function i(n,o,l){function s(u,f){if(!o[u]){if(!n[u]){var m=typeof dn=="function"&&dn;if(!f&&m)return m(u,!0);if(r)return r(u,!0);var h=new Error("Cannot find module '"+u+"'");throw h.code="MODULE_NOT_FOUND",h}var c=o[u]={exports:{}};n[u][0].call(c.exports,function(g){var d=n[u][1][g];return s(d||g)},c,c.exports,i,n,o,l)}return o[u].exports}for(var r=typeof dn=="function"&&dn,a=0;a<l.length;a++)s(l[a]);return s}({1:[function(i,n,o){var l=i("./utils"),s=i("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(a){for(var u,f,m,h,c,g,d,v=[],_=0,y=a.length,S=y,w=l.getTypeOf(a)!=="string";_<a.length;)S=y-_,m=w?(u=a[_++],f=_<y?a[_++]:0,_<y?a[_++]:0):(u=a.charCodeAt(_++),f=_<y?a.charCodeAt(_++):0,_<y?a.charCodeAt(_++):0),h=u>>2,c=(3&u)<<4|f>>4,g=1<S?(15&f)<<2|m>>6:64,d=2<S?63&m:64,v.push(r.charAt(h)+r.charAt(c)+r.charAt(g)+r.charAt(d));return v.join("")},o.decode=function(a){var u,f,m,h,c,g,d=0,v=0,_="data:";if(a.substr(0,_.length)===_)throw new Error("Invalid base64 input, it looks like a data url.");var y,S=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===r.charAt(64)&&S--,a.charAt(a.length-2)===r.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(y=s.uint8array?new Uint8Array(0|S):new Array(0|S);d<a.length;)u=r.indexOf(a.charAt(d++))<<2|(h=r.indexOf(a.charAt(d++)))>>4,f=(15&h)<<4|(c=r.indexOf(a.charAt(d++)))>>2,m=(3&c)<<6|(g=r.indexOf(a.charAt(d++))),y[v++]=u,c!==64&&(y[v++]=f),g!==64&&(y[v++]=m);return y}},{"./support":30,"./utils":32}],2:[function(i,n,o){var l=i("./external"),s=i("./stream/DataWorker"),r=i("./stream/Crc32Probe"),a=i("./stream/DataLengthProbe");function u(f,m,h,c,g){this.compressedSize=f,this.uncompressedSize=m,this.crc32=h,this.compression=c,this.compressedContent=g}u.prototype={getContentWorker:function(){var f=new s(l.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),m=this;return f.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),f},getCompressedWorker:function(){return new s(l.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(f,m,h){return f.pipe(new r).pipe(new a("uncompressedSize")).pipe(m.compressWorker(h)).pipe(new a("compressedSize")).withStreamInfo("compression",m)},n.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(i,n,o){var l=i("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new l("STORE compression")},uncompressWorker:function(){return new l("STORE decompression")}},o.DEFLATE=i("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(i,n,o){var l=i("./utils"),s=function(){for(var r,a=[],u=0;u<256;u++){r=u;for(var f=0;f<8;f++)r=1&r?3988292384^r>>>1:r>>>1;a[u]=r}return a}();n.exports=function(r,a){return r!==void 0&&r.length?l.getTypeOf(r)!=="string"?function(u,f,m,h){var c=s,g=h+m;u^=-1;for(var d=h;d<g;d++)u=u>>>8^c[255&(u^f[d])];return-1^u}(0|a,r,r.length,0):function(u,f,m,h){var c=s,g=h+m;u^=-1;for(var d=h;d<g;d++)u=u>>>8^c[255&(u^f.charCodeAt(d))];return-1^u}(0|a,r,r.length,0):0}},{"./utils":32}],5:[function(i,n,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(i,n,o){var l=null;l=typeof Promise<"u"?Promise:i("lie"),n.exports={Promise:l}},{lie:37}],7:[function(i,n,o){var l=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=i("pako"),r=i("./utils"),a=i("./stream/GenericWorker"),u=l?"uint8array":"array";function f(m,h){a.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=h,this.meta={}}o.magic="\b\0",r.inherits(f,a),f.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(u,m.data),!1)},f.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},f.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},f.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(h){m.push({data:h,meta:m.meta})}},o.compressWorker=function(m){return new f("Deflate",m)},o.uncompressWorker=function(){return new f("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(i,n,o){function l(c,g){var d,v="";for(d=0;d<g;d++)v+=String.fromCharCode(255&c),c>>>=8;return v}function s(c,g,d,v,_,y){var S,w,k=c.file,O=c.compression,P=y!==u.utf8encode,G=r.transformTo("string",y(k.name)),I=r.transformTo("string",u.utf8encode(k.name)),W=k.comment,et=r.transformTo("string",y(W)),C=r.transformTo("string",u.utf8encode(W)),$=I.length!==k.name.length,b=C.length!==W.length,z="",lt="",U="",ut=k.dir,X=k.date,st={crc32:0,compressedSize:0,uncompressedSize:0};g&&!d||(st.crc32=c.crc32,st.compressedSize=c.compressedSize,st.uncompressedSize=c.uncompressedSize);var N=0;g&&(N|=8),P||!$&&!b||(N|=2048);var x=0,it=0;ut&&(x|=16),_==="UNIX"?(it=798,x|=function(Z,Et){var Lt=Z;return Z||(Lt=Et?16893:33204),(65535&Lt)<<16}(k.unixPermissions,ut)):(it=20,x|=function(Z){return 63&(Z||0)}(k.dosPermissions)),S=X.getUTCHours(),S<<=6,S|=X.getUTCMinutes(),S<<=5,S|=X.getUTCSeconds()/2,w=X.getUTCFullYear()-1980,w<<=4,w|=X.getUTCMonth()+1,w<<=5,w|=X.getUTCDate(),$&&(lt=l(1,1)+l(f(G),4)+I,z+="up"+l(lt.length,2)+lt),b&&(U=l(1,1)+l(f(et),4)+C,z+="uc"+l(U.length,2)+U);var Q="";return Q+=`
\0`,Q+=l(N,2),Q+=O.magic,Q+=l(S,2),Q+=l(w,2),Q+=l(st.crc32,4),Q+=l(st.compressedSize,4),Q+=l(st.uncompressedSize,4),Q+=l(G.length,2),Q+=l(z.length,2),{fileRecord:m.LOCAL_FILE_HEADER+Q+G+z,dirRecord:m.CENTRAL_FILE_HEADER+l(it,2)+Q+l(et.length,2)+"\0\0\0\0"+l(x,4)+l(v,4)+G+z+et}}var r=i("../utils"),a=i("../stream/GenericWorker"),u=i("../utf8"),f=i("../crc32"),m=i("../signature");function h(c,g,d,v){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=d,this.encodeFileName=v,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(h,a),h.prototype.push=function(c){var g=c.meta.percent||0,d=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,a.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:d?(g+100*(d-v-1))/d:100}}))},h.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var g=this.streamFiles&&!c.file.dir;if(g){var d=s(c,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:d.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(c){this.accumulate=!1;var g=this.streamFiles&&!c.file.dir,d=s(c,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(d.dirRecord),g)this.push({data:function(v){return m.DATA_DESCRIPTOR+l(v.crc32,4)+l(v.compressedSize,4)+l(v.uncompressedSize,4)}(c),meta:{percent:100}});else for(this.push({data:d.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var c=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var d=this.bytesWritten-c,v=function(_,y,S,w,k){var O=r.transformTo("string",k(w));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+l(_,2)+l(_,2)+l(y,4)+l(S,4)+l(O.length,2)+O}(this.dirRecords.length,d,c,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(c){this._sources.push(c);var g=this;return c.on("data",function(d){g.processChunk(d)}),c.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),c.on("error",function(d){g.error(d)}),this},h.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(c){var g=this._sources;if(!a.prototype.error.call(this,c))return!1;for(var d=0;d<g.length;d++)try{g[d].error(c)}catch{}return!0},h.prototype.lock=function(){a.prototype.lock.call(this);for(var c=this._sources,g=0;g<c.length;g++)c[g].lock()},n.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(i,n,o){var l=i("../compressions"),s=i("./ZipFileWorker");o.generateWorker=function(r,a,u){var f=new s(a.streamFiles,u,a.platform,a.encodeFileName),m=0;try{r.forEach(function(h,c){m++;var g=function(y,S){var w=y||S,k=l[w];if(!k)throw new Error(w+" is not a valid compression method !");return k}(c.options.compression,a.compression),d=c.options.compressionOptions||a.compressionOptions||{},v=c.dir,_=c.date;c._compressWorker(g,d).withStreamInfo("file",{name:h,dir:v,date:_,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(f)}),f.entriesCount=m}catch(h){f.error(h)}return f}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(i,n,o){function l(){if(!(this instanceof l))return new l;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new l;for(var r in this)typeof this[r]!="function"&&(s[r]=this[r]);return s}}(l.prototype=i("./object")).loadAsync=i("./load"),l.support=i("./support"),l.defaults=i("./defaults"),l.version="3.10.1",l.loadAsync=function(s,r){return new l().loadAsync(s,r)},l.external=i("./external"),n.exports=l},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(i,n,o){var l=i("./utils"),s=i("./external"),r=i("./utf8"),a=i("./zipEntries"),u=i("./stream/Crc32Probe"),f=i("./nodejsUtils");function m(h){return new s.Promise(function(c,g){var d=h.decompressed.getContentWorker().pipe(new u);d.on("error",function(v){g(v)}).on("end",function(){d.streamInfo.crc32!==h.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}n.exports=function(h,c){var g=this;return c=l.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),f.isNode&&f.isStream(h)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):l.prepareContent("the loaded zip file",h,!0,c.optimizedBinaryString,c.base64).then(function(d){var v=new a(c);return v.load(d),v}).then(function(d){var v=[s.Promise.resolve(d)],_=d.files;if(c.checkCRC32)for(var y=0;y<_.length;y++)v.push(m(_[y]));return s.Promise.all(v)}).then(function(d){for(var v=d.shift(),_=v.files,y=0;y<_.length;y++){var S=_[y],w=S.fileNameStr,k=l.resolve(S.fileNameStr);g.file(k,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:c.createFolders}),S.dir||(g.file(k).unsafeOriginalName=w)}return v.zipComment.length&&(g.comment=v.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(i,n,o){var l=i("../utils"),s=i("../stream/GenericWorker");function r(a,u){s.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(u)}l.inherits(r,s),r.prototype._bindStream=function(a){var u=this;(this._stream=a).pause(),a.on("data",function(f){u.push({data:f,meta:{percent:0}})}).on("error",function(f){u.isPaused?this.generatedError=f:u.error(f)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},r.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(i,n,o){var l=i("readable-stream").Readable;function s(r,a,u){l.call(this,a),this._helper=r;var f=this;r.on("data",function(m,h){f.push(m)||f._helper.pause(),u&&u(h)}).on("error",function(m){f.emit("error",m)}).on("end",function(){f.push(null)})}i("../utils").inherits(s,l),s.prototype._read=function(){this._helper.resume()},n.exports=s},{"../utils":32,"readable-stream":16}],14:[function(i,n,o){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(l,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(l,s);if(typeof l=="number")throw new Error('The "data" argument must not be a number');return new Buffer(l,s)},allocBuffer:function(l){if(Buffer.alloc)return Buffer.alloc(l);var s=new Buffer(l);return s.fill(0),s},isBuffer:function(l){return Buffer.isBuffer(l)},isStream:function(l){return l&&typeof l.on=="function"&&typeof l.pause=="function"&&typeof l.resume=="function"}}},{}],15:[function(i,n,o){function l(k,O,P){var G,I=r.getTypeOf(O),W=r.extend(P||{},f);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(k=_(k)),W.createFolders&&(G=v(k))&&y.call(this,G,!0);var et=I==="string"&&W.binary===!1&&W.base64===!1;P&&P.binary!==void 0||(W.binary=!et),(O instanceof m&&O.uncompressedSize===0||W.dir||!O||O.length===0)&&(W.base64=!1,W.binary=!0,O="",W.compression="STORE",I="string");var C=null;C=O instanceof m||O instanceof a?O:g.isNode&&g.isStream(O)?new d(k,O):r.prepareContent(k,O,W.binary,W.optimizedBinaryString,W.base64);var $=new h(k,C,W);this.files[k]=$}var s=i("./utf8"),r=i("./utils"),a=i("./stream/GenericWorker"),u=i("./stream/StreamHelper"),f=i("./defaults"),m=i("./compressedObject"),h=i("./zipObject"),c=i("./generate"),g=i("./nodejsUtils"),d=i("./nodejs/NodejsStreamInputAdapter"),v=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var O=k.lastIndexOf("/");return 0<O?k.substring(0,O):""},_=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},y=function(k,O){return O=O!==void 0?O:f.createFolders,k=_(k),this.files[k]||l.call(this,k,null,{dir:!0,createFolders:O}),this.files[k]};function S(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var w={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var O,P,G;for(O in this.files)G=this.files[O],(P=O.slice(this.root.length,O.length))&&O.slice(0,this.root.length)===this.root&&k(P,G)},filter:function(k){var O=[];return this.forEach(function(P,G){k(P,G)&&O.push(G)}),O},file:function(k,O,P){if(arguments.length!==1)return k=this.root+k,l.call(this,k,O,P),this;if(S(k)){var G=k;return this.filter(function(W,et){return!et.dir&&G.test(W)})}var I=this.files[this.root+k];return I&&!I.dir?I:null},folder:function(k){if(!k)return this;if(S(k))return this.filter(function(I,W){return W.dir&&k.test(I)});var O=this.root+k,P=y.call(this,O),G=this.clone();return G.root=P.name,G},remove:function(k){k=this.root+k;var O=this.files[k];if(O||(k.slice(-1)!=="/"&&(k+="/"),O=this.files[k]),O&&!O.dir)delete this.files[k];else for(var P=this.filter(function(I,W){return W.name.slice(0,k.length)===k}),G=0;G<P.length;G++)delete this.files[P[G].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var O,P={};try{if((P=r.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");r.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var G=P.comment||this.comment||"";O=c.generateWorker(this,P,G)}catch(I){(O=new a("error")).error(I)}return new u(O,P.type||"string",P.mimeType)},generateAsync:function(k,O){return this.generateInternalStream(k).accumulate(O)},generateNodeStream:function(k,O){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(O)}};n.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(i,n,o){n.exports=i("stream")},{stream:void 0}],17:[function(i,n,o){var l=i("./DataReader");function s(r){l.call(this,r);for(var a=0;a<this.data.length;a++)r[a]=255&r[a]}i("../utils").inherits(s,l),s.prototype.byteAt=function(r){return this.data[this.zero+r]},s.prototype.lastIndexOfSignature=function(r){for(var a=r.charCodeAt(0),u=r.charCodeAt(1),f=r.charCodeAt(2),m=r.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===a&&this.data[h+1]===u&&this.data[h+2]===f&&this.data[h+3]===m)return h-this.zero;return-1},s.prototype.readAndCheckSignature=function(r){var a=r.charCodeAt(0),u=r.charCodeAt(1),f=r.charCodeAt(2),m=r.charCodeAt(3),h=this.readData(4);return a===h[0]&&u===h[1]&&f===h[2]&&m===h[3]},s.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,a},n.exports=s},{"../utils":32,"./DataReader":18}],18:[function(i,n,o){var l=i("../utils");function s(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var a,u=0;for(this.checkOffset(r),a=this.index+r-1;a>=this.index;a--)u=(u<<8)+this.byteAt(a);return this.index+=r,u},readString:function(r){return l.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},n.exports=s},{"../utils":32}],19:[function(i,n,o){var l=i("./Uint8ArrayReader");function s(r){l.call(this,r)}i("../utils").inherits(s,l),s.prototype.readData=function(r){this.checkOffset(r);var a=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,a},n.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(i,n,o){var l=i("./DataReader");function s(r){l.call(this,r)}i("../utils").inherits(s,l),s.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},s.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},s.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},s.prototype.readData=function(r){this.checkOffset(r);var a=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,a},n.exports=s},{"../utils":32,"./DataReader":18}],21:[function(i,n,o){var l=i("./ArrayReader");function s(r){l.call(this,r)}i("../utils").inherits(s,l),s.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,a},n.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(i,n,o){var l=i("../utils"),s=i("../support"),r=i("./ArrayReader"),a=i("./StringReader"),u=i("./NodeBufferReader"),f=i("./Uint8ArrayReader");n.exports=function(m){var h=l.getTypeOf(m);return l.checkSupport(h),h!=="string"||s.uint8array?h==="nodebuffer"?new u(m):s.uint8array?new f(l.transformTo("uint8array",m)):new r(l.transformTo("array",m)):new a(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(i,n,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(i,n,o){var l=i("./GenericWorker"),s=i("../utils");function r(a){l.call(this,"ConvertWorker to "+a),this.destType=a}s.inherits(r,l),r.prototype.processChunk=function(a){this.push({data:s.transformTo(this.destType,a.data),meta:a.meta})},n.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(i,n,o){var l=i("./GenericWorker"),s=i("../crc32");function r(){l.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}i("../utils").inherits(r,l),r.prototype.processChunk=function(a){this.streamInfo.crc32=s(a.data,this.streamInfo.crc32||0),this.push(a)},n.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(i,n,o){var l=i("../utils"),s=i("./GenericWorker");function r(a){s.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}l.inherits(r,s),r.prototype.processChunk=function(a){if(a){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+a.data.length}s.prototype.processChunk.call(this,a)},n.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(i,n,o){var l=i("../utils"),s=i("./GenericWorker");function r(a){s.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(f){u.dataIsReady=!0,u.data=f,u.max=f&&f.length||0,u.type=l.getTypeOf(f),u.isPaused||u._tickAndRepeat()},function(f){u.error(f)})}l.inherits(r,s),r.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,l.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(l.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,u);break;case"uint8array":a=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":a=this.data.slice(this.index,u)}return this.index=u,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(i,n,o){function l(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}l.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,r){return this._listeners[s].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,r){if(this._listeners[s])for(var a=0;a<this._listeners[s].length;a++)this._listeners[s][a].call(this,r)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var r=this;return s.on("data",function(a){r.processChunk(a)}),s.on("end",function(){r.end()}),s.on("error",function(a){r.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,r){return this.extraStreamInfo[s]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},n.exports=l},{}],29:[function(i,n,o){var l=i("../utils"),s=i("./ConvertWorker"),r=i("./GenericWorker"),a=i("../base64"),u=i("../support"),f=i("../external"),m=null;if(u.nodestream)try{m=i("../nodejs/NodejsStreamOutputAdapter")}catch{}function h(g,d){return new f.Promise(function(v,_){var y=[],S=g._internalType,w=g._outputType,k=g._mimeType;g.on("data",function(O,P){y.push(O),d&&d(P)}).on("error",function(O){y=[],_(O)}).on("end",function(){try{var O=function(P,G,I){switch(P){case"blob":return l.newBlob(l.transformTo("arraybuffer",G),I);case"base64":return a.encode(G);default:return l.transformTo(P,G)}}(w,function(P,G){var I,W=0,et=null,C=0;for(I=0;I<G.length;I++)C+=G[I].length;switch(P){case"string":return G.join("");case"array":return Array.prototype.concat.apply([],G);case"uint8array":for(et=new Uint8Array(C),I=0;I<G.length;I++)et.set(G[I],W),W+=G[I].length;return et;case"nodebuffer":return Buffer.concat(G);default:throw new Error("concat : unsupported type '"+P+"'")}}(S,y),k);v(O)}catch(P){_(P)}y=[]}).resume()})}function c(g,d,v){var _=d;switch(d){case"blob":case"arraybuffer":_="uint8array";break;case"base64":_="string"}try{this._internalType=_,this._outputType=d,this._mimeType=v,l.checkSupport(_),this._worker=g.pipe(new s(_)),g.lock()}catch(y){this._worker=new r("error"),this._worker.error(y)}}c.prototype={accumulate:function(g){return h(this,g)},on:function(g,d){var v=this;return g==="data"?this._worker.on(g,function(_){d.call(v,_.data,_.meta)}):this._worker.on(g,function(){l.delay(d,arguments,v)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(l.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},g)}},n.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(i,n,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",o.nodebuffer=typeof Buffer<"u",o.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")o.blob=!1;else{var l=new ArrayBuffer(0);try{o.blob=new Blob([l],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(l),o.blob=s.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!i("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(i,n,o){for(var l=i("./utils"),s=i("./support"),r=i("./nodejsUtils"),a=i("./stream/GenericWorker"),u=new Array(256),f=0;f<256;f++)u[f]=252<=f?6:248<=f?5:240<=f?4:224<=f?3:192<=f?2:1;u[254]=u[254]=1;function m(){a.call(this,"utf-8 decode"),this.leftOver=null}function h(){a.call(this,"utf-8 encode")}o.utf8encode=function(c){return s.nodebuffer?r.newBufferFrom(c,"utf-8"):function(g){var d,v,_,y,S,w=g.length,k=0;for(y=0;y<w;y++)(64512&(v=g.charCodeAt(y)))==55296&&y+1<w&&(64512&(_=g.charCodeAt(y+1)))==56320&&(v=65536+(v-55296<<10)+(_-56320),y++),k+=v<128?1:v<2048?2:v<65536?3:4;for(d=s.uint8array?new Uint8Array(k):new Array(k),y=S=0;S<k;y++)(64512&(v=g.charCodeAt(y)))==55296&&y+1<w&&(64512&(_=g.charCodeAt(y+1)))==56320&&(v=65536+(v-55296<<10)+(_-56320),y++),v<128?d[S++]=v:(v<2048?d[S++]=192|v>>>6:(v<65536?d[S++]=224|v>>>12:(d[S++]=240|v>>>18,d[S++]=128|v>>>12&63),d[S++]=128|v>>>6&63),d[S++]=128|63&v);return d}(c)},o.utf8decode=function(c){return s.nodebuffer?l.transformTo("nodebuffer",c).toString("utf-8"):function(g){var d,v,_,y,S=g.length,w=new Array(2*S);for(d=v=0;d<S;)if((_=g[d++])<128)w[v++]=_;else if(4<(y=u[_]))w[v++]=65533,d+=y-1;else{for(_&=y===2?31:y===3?15:7;1<y&&d<S;)_=_<<6|63&g[d++],y--;1<y?w[v++]=65533:_<65536?w[v++]=_:(_-=65536,w[v++]=55296|_>>10&1023,w[v++]=56320|1023&_)}return w.length!==v&&(w.subarray?w=w.subarray(0,v):w.length=v),l.applyFromCharCode(w)}(c=l.transformTo(s.uint8array?"uint8array":"array",c))},l.inherits(m,a),m.prototype.processChunk=function(c){var g=l.transformTo(s.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var d=g;(g=new Uint8Array(d.length+this.leftOver.length)).set(this.leftOver,0),g.set(d,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var v=function(y,S){var w;for((S=S||y.length)>y.length&&(S=y.length),w=S-1;0<=w&&(192&y[w])==128;)w--;return w<0||w===0?S:w+u[y[w]]>S?w:S}(g),_=g;v!==g.length&&(s.uint8array?(_=g.subarray(0,v),this.leftOver=g.subarray(v,g.length)):(_=g.slice(0,v),this.leftOver=g.slice(v,g.length))),this.push({data:o.utf8decode(_),meta:c.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=m,l.inherits(h,a),h.prototype.processChunk=function(c){this.push({data:o.utf8encode(c.data),meta:c.meta})},o.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(i,n,o){var l=i("./support"),s=i("./base64"),r=i("./nodejsUtils"),a=i("./external");function u(d){return d}function f(d,v){for(var _=0;_<d.length;++_)v[_]=255&d.charCodeAt(_);return v}i("setimmediate"),o.newBlob=function(d,v){o.checkSupport("blob");try{return new Blob([d],{type:v})}catch{try{var _=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _.append(d),_.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(d,v,_){var y=[],S=0,w=d.length;if(w<=_)return String.fromCharCode.apply(null,d);for(;S<w;)v==="array"||v==="nodebuffer"?y.push(String.fromCharCode.apply(null,d.slice(S,Math.min(S+_,w)))):y.push(String.fromCharCode.apply(null,d.subarray(S,Math.min(S+_,w)))),S+=_;return y.join("")},stringifyByChar:function(d){for(var v="",_=0;_<d.length;_++)v+=String.fromCharCode(d[_]);return v},applyCanBeUsed:{uint8array:function(){try{return l.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return l.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}}()}};function h(d){var v=65536,_=o.getTypeOf(d),y=!0;if(_==="uint8array"?y=m.applyCanBeUsed.uint8array:_==="nodebuffer"&&(y=m.applyCanBeUsed.nodebuffer),y)for(;1<v;)try{return m.stringifyByChunk(d,_,v)}catch{v=Math.floor(v/2)}return m.stringifyByChar(d)}function c(d,v){for(var _=0;_<d.length;_++)v[_]=d[_];return v}o.applyFromCharCode=h;var g={};g.string={string:u,array:function(d){return f(d,new Array(d.length))},arraybuffer:function(d){return g.string.uint8array(d).buffer},uint8array:function(d){return f(d,new Uint8Array(d.length))},nodebuffer:function(d){return f(d,r.allocBuffer(d.length))}},g.array={string:h,array:u,arraybuffer:function(d){return new Uint8Array(d).buffer},uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return r.newBufferFrom(d)}},g.arraybuffer={string:function(d){return h(new Uint8Array(d))},array:function(d){return c(new Uint8Array(d),new Array(d.byteLength))},arraybuffer:u,uint8array:function(d){return new Uint8Array(d)},nodebuffer:function(d){return r.newBufferFrom(new Uint8Array(d))}},g.uint8array={string:h,array:function(d){return c(d,new Array(d.length))},arraybuffer:function(d){return d.buffer},uint8array:u,nodebuffer:function(d){return r.newBufferFrom(d)}},g.nodebuffer={string:h,array:function(d){return c(d,new Array(d.length))},arraybuffer:function(d){return g.nodebuffer.uint8array(d).buffer},uint8array:function(d){return c(d,new Uint8Array(d.length))},nodebuffer:u},o.transformTo=function(d,v){if(v=v||"",!d)return v;o.checkSupport(d);var _=o.getTypeOf(v);return g[_][d](v)},o.resolve=function(d){for(var v=d.split("/"),_=[],y=0;y<v.length;y++){var S=v[y];S==="."||S===""&&y!==0&&y!==v.length-1||(S===".."?_.pop():_.push(S))}return _.join("/")},o.getTypeOf=function(d){return typeof d=="string"?"string":Object.prototype.toString.call(d)==="[object Array]"?"array":l.nodebuffer&&r.isBuffer(d)?"nodebuffer":l.uint8array&&d instanceof Uint8Array?"uint8array":l.arraybuffer&&d instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(d){if(!l[d.toLowerCase()])throw new Error(d+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(d){var v,_,y="";for(_=0;_<(d||"").length;_++)y+="\\x"+((v=d.charCodeAt(_))<16?"0":"")+v.toString(16).toUpperCase();return y},o.delay=function(d,v,_){setImmediate(function(){d.apply(_||null,v||[])})},o.inherits=function(d,v){function _(){}_.prototype=v.prototype,d.prototype=new _},o.extend=function(){var d,v,_={};for(d=0;d<arguments.length;d++)for(v in arguments[d])Object.prototype.hasOwnProperty.call(arguments[d],v)&&_[v]===void 0&&(_[v]=arguments[d][v]);return _},o.prepareContent=function(d,v,_,y,S){return a.Promise.resolve(v).then(function(w){return l.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader<"u"?new a.Promise(function(k,O){var P=new FileReader;P.onload=function(G){k(G.target.result)},P.onerror=function(G){O(G.target.error)},P.readAsArrayBuffer(w)}):w}).then(function(w){var k=o.getTypeOf(w);return k?(k==="arraybuffer"?w=o.transformTo("uint8array",w):k==="string"&&(S?w=s.decode(w):_&&y!==!0&&(w=function(O){return f(O,l.uint8array?new Uint8Array(O.length):new Array(O.length))}(w))),w):a.Promise.reject(new Error("Can't read the data of '"+d+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(i,n,o){var l=i("./reader/readerFor"),s=i("./utils"),r=i("./signature"),a=i("./zipEntry"),u=i("./support");function f(m){this.files=[],this.loadOptions=m}f.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(h)+", expected "+s.pretty(m)+")")}},isSignature:function(m,h){var c=this.reader.index;this.reader.setIndex(m);var g=this.reader.readString(4)===h;return this.reader.setIndex(c),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),h=u.uint8array?"uint8array":"array",c=s.transformTo(h,m);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,h,c,g=this.zip64EndOfCentralSize-44;0<g;)m=this.reader.readInt(2),h=this.reader.readInt(4),c=this.reader.readData(h),this.zip64ExtensibleData[m]={id:m,length:h,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,h;for(m=0;m<this.files.length;m++)h=this.files[m],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(m=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var h=m;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var g=h-c;if(0<g)this.isSignature(h,r.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(m){this.reader=l(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=f},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(i,n,o){var l=i("./reader/readerFor"),s=i("./utils"),r=i("./compressedObject"),a=i("./crc32"),u=i("./utf8"),f=i("./compressions"),m=i("./support");function h(c,g){this.options=c,this.loadOptions=g}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var g,d;if(c.skip(22),this.fileNameLength=c.readInt(2),d=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(d),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(v){for(var _ in f)if(Object.prototype.hasOwnProperty.call(f,_)&&f[_].magic===v)return f[_];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,g,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var g=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(g),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=l(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var g,d,v,_=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<_;)g=c.readInt(2),d=c.readInt(2),v=c.readData(d),this.extraFields[g]={id:g,length:d,value:v};c.setIndex(_)},handleUTF8:function(){var c=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var d=s.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(d)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var _=s.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var g=l(c.value);return g.readInt(1)!==1||a(this.fileName)!==g.readInt(4)?null:u.utf8decode(g.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var g=l(c.value);return g.readInt(1)!==1||a(this.fileComment)!==g.readInt(4)?null:u.utf8decode(g.readData(c.length-5))}return null}},n.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(i,n,o){function l(g,d,v){this.name=g,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=d,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var s=i("./stream/StreamHelper"),r=i("./stream/DataWorker"),a=i("./utf8"),u=i("./compressedObject"),f=i("./stream/GenericWorker");l.prototype={internalStream:function(g){var d=null,v="string";try{if(!g)throw new Error("No output type specified.");var _=(v=g.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),d=this._decompressWorker();var y=!this._dataBinary;y&&!_&&(d=d.pipe(new a.Utf8EncodeWorker)),!y&&_&&(d=d.pipe(new a.Utf8DecodeWorker))}catch(S){(d=new f("error")).error(S)}return new s(d,v,"")},async:function(g,d){return this.internalStream(g).accumulate(d)},nodeStream:function(g,d){return this.internalStream(g||"nodebuffer").toNodejsStream(d)},_compressWorker:function(g,d){if(this._data instanceof u&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new a.Utf8EncodeWorker)),u.createWorkerFrom(v,g,d)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof f?this._data:new r(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<m.length;c++)l.prototype[m[c]]=h;n.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(i,n,o){(function(l){var s,r,a=l.MutationObserver||l.WebKitMutationObserver;if(a){var u=0,f=new a(g),m=l.document.createTextNode("");f.observe(m,{characterData:!0}),s=function(){m.data=u=++u%2}}else if(l.setImmediate||l.MessageChannel===void 0)s="document"in l&&"onreadystatechange"in l.document.createElement("script")?function(){var d=l.document.createElement("script");d.onreadystatechange=function(){g(),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},l.document.documentElement.appendChild(d)}:function(){setTimeout(g,0)};else{var h=new l.MessageChannel;h.port1.onmessage=g,s=function(){h.port2.postMessage(0)}}var c=[];function g(){var d,v;r=!0;for(var _=c.length;_;){for(v=c,c=[],d=-1;++d<_;)v[d]();_=c.length}r=!1}n.exports=function(d){c.push(d)!==1||r||s()}}).call(this,typeof pn<"u"?pn:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(i,n,o){var l=i("immediate");function s(){}var r={},a=["REJECTED"],u=["FULFILLED"],f=["PENDING"];function m(_){if(typeof _!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,_!==s&&d(this,_)}function h(_,y,S){this.promise=_,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function c(_,y,S){l(function(){var w;try{w=y(S)}catch(k){return r.reject(_,k)}w===_?r.reject(_,new TypeError("Cannot resolve promise with itself")):r.resolve(_,w)})}function g(_){var y=_&&_.then;if(_&&(typeof _=="object"||typeof _=="function")&&typeof y=="function")return function(){y.apply(_,arguments)}}function d(_,y){var S=!1;function w(P){S||(S=!0,r.reject(_,P))}function k(P){S||(S=!0,r.resolve(_,P))}var O=v(function(){y(k,w)});O.status==="error"&&w(O.value)}function v(_,y){var S={};try{S.value=_(y),S.status="success"}catch(w){S.status="error",S.value=w}return S}(n.exports=m).prototype.finally=function(_){if(typeof _!="function")return this;var y=this.constructor;return this.then(function(S){return y.resolve(_()).then(function(){return S})},function(S){return y.resolve(_()).then(function(){throw S})})},m.prototype.catch=function(_){return this.then(null,_)},m.prototype.then=function(_,y){if(typeof _!="function"&&this.state===u||typeof y!="function"&&this.state===a)return this;var S=new this.constructor(s);return this.state!==f?c(S,this.state===u?_:y,this.outcome):this.queue.push(new h(S,_,y)),S},h.prototype.callFulfilled=function(_){r.resolve(this.promise,_)},h.prototype.otherCallFulfilled=function(_){c(this.promise,this.onFulfilled,_)},h.prototype.callRejected=function(_){r.reject(this.promise,_)},h.prototype.otherCallRejected=function(_){c(this.promise,this.onRejected,_)},r.resolve=function(_,y){var S=v(g,y);if(S.status==="error")return r.reject(_,S.value);var w=S.value;if(w)d(_,w);else{_.state=u,_.outcome=y;for(var k=-1,O=_.queue.length;++k<O;)_.queue[k].callFulfilled(y)}return _},r.reject=function(_,y){_.state=a,_.outcome=y;for(var S=-1,w=_.queue.length;++S<w;)_.queue[S].callRejected(y);return _},m.resolve=function(_){return _ instanceof this?_:r.resolve(new this(s),_)},m.reject=function(_){var y=new this(s);return r.reject(y,_)},m.all=function(_){var y=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=_.length,w=!1;if(!S)return this.resolve([]);for(var k=new Array(S),O=0,P=-1,G=new this(s);++P<S;)I(_[P],P);return G;function I(W,et){y.resolve(W).then(function(C){k[et]=C,++O!==S||w||(w=!0,r.resolve(G,k))},function(C){w||(w=!0,r.reject(G,C))})}},m.race=function(_){var y=this;if(Object.prototype.toString.call(_)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=_.length,w=!1;if(!S)return this.resolve([]);for(var k=-1,O=new this(s);++k<S;)P=_[k],y.resolve(P).then(function(G){w||(w=!0,r.resolve(O,G))},function(G){w||(w=!0,r.reject(O,G))});var P;return O}},{immediate:36}],38:[function(i,n,o){var l={};(0,i("./lib/utils/common").assign)(l,i("./lib/deflate"),i("./lib/inflate"),i("./lib/zlib/constants")),n.exports=l},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(i,n,o){var l=i("./zlib/deflate"),s=i("./utils/common"),r=i("./utils/strings"),a=i("./zlib/messages"),u=i("./zlib/zstream"),f=Object.prototype.toString,m=0,h=-1,c=0,g=8;function d(_){if(!(this instanceof d))return new d(_);this.options=s.assign({level:h,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},_||{});var y=this.options;y.raw&&0<y.windowBits?y.windowBits=-y.windowBits:y.gzip&&0<y.windowBits&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var S=l.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(S!==m)throw new Error(a[S]);if(y.header&&l.deflateSetHeader(this.strm,y.header),y.dictionary){var w;if(w=typeof y.dictionary=="string"?r.string2buf(y.dictionary):f.call(y.dictionary)==="[object ArrayBuffer]"?new Uint8Array(y.dictionary):y.dictionary,(S=l.deflateSetDictionary(this.strm,w))!==m)throw new Error(a[S]);this._dict_set=!0}}function v(_,y){var S=new d(y);if(S.push(_,!0),S.err)throw S.msg||a[S.err];return S.result}d.prototype.push=function(_,y){var S,w,k=this.strm,O=this.options.chunkSize;if(this.ended)return!1;w=y===~~y?y:y===!0?4:0,typeof _=="string"?k.input=r.string2buf(_):f.call(_)==="[object ArrayBuffer]"?k.input=new Uint8Array(_):k.input=_,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new s.Buf8(O),k.next_out=0,k.avail_out=O),(S=l.deflate(k,w))!==1&&S!==m)return this.onEnd(S),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(s.shrinkBuf(k.output,k.next_out))):this.onData(s.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&S!==1);return w===4?(S=l.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===m):w!==2||(this.onEnd(m),!(k.avail_out=0))},d.prototype.onData=function(_){this.chunks.push(_)},d.prototype.onEnd=function(_){_===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},o.Deflate=d,o.deflate=v,o.deflateRaw=function(_,y){return(y=y||{}).raw=!0,v(_,y)},o.gzip=function(_,y){return(y=y||{}).gzip=!0,v(_,y)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(i,n,o){var l=i("./zlib/inflate"),s=i("./utils/common"),r=i("./utils/strings"),a=i("./zlib/constants"),u=i("./zlib/messages"),f=i("./zlib/zstream"),m=i("./zlib/gzheader"),h=Object.prototype.toString;function c(d){if(!(this instanceof c))return new c(d);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},d||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||d&&d.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var _=l.inflateInit2(this.strm,v.windowBits);if(_!==a.Z_OK)throw new Error(u[_]);this.header=new m,l.inflateGetHeader(this.strm,this.header)}function g(d,v){var _=new c(v);if(_.push(d,!0),_.err)throw _.msg||u[_.err];return _.result}c.prototype.push=function(d,v){var _,y,S,w,k,O,P=this.strm,G=this.options.chunkSize,I=this.options.dictionary,W=!1;if(this.ended)return!1;y=v===~~v?v:v===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof d=="string"?P.input=r.binstring2buf(d):h.call(d)==="[object ArrayBuffer]"?P.input=new Uint8Array(d):P.input=d,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new s.Buf8(G),P.next_out=0,P.avail_out=G),(_=l.inflate(P,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&I&&(O=typeof I=="string"?r.string2buf(I):h.call(I)==="[object ArrayBuffer]"?new Uint8Array(I):I,_=l.inflateSetDictionary(this.strm,O)),_===a.Z_BUF_ERROR&&W===!0&&(_=a.Z_OK,W=!1),_!==a.Z_STREAM_END&&_!==a.Z_OK)return this.onEnd(_),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&_!==a.Z_STREAM_END&&(P.avail_in!==0||y!==a.Z_FINISH&&y!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=r.utf8border(P.output,P.next_out),w=P.next_out-S,k=r.buf2string(P.output,S),P.next_out=w,P.avail_out=G-w,w&&s.arraySet(P.output,P.output,S,w,0),this.onData(k)):this.onData(s.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(W=!0)}while((0<P.avail_in||P.avail_out===0)&&_!==a.Z_STREAM_END);return _===a.Z_STREAM_END&&(y=a.Z_FINISH),y===a.Z_FINISH?(_=l.inflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===a.Z_OK):y!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(P.avail_out=0))},c.prototype.onData=function(d){this.chunks.push(d)},c.prototype.onEnd=function(d){d===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},o.Inflate=c,o.inflate=g,o.inflateRaw=function(d,v){return(v=v||{}).raw=!0,g(d,v)},o.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(i,n,o){var l=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(a){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var f=u.shift();if(f){if(typeof f!="object")throw new TypeError(f+"must be non-object");for(var m in f)f.hasOwnProperty(m)&&(a[m]=f[m])}}return a},o.shrinkBuf=function(a,u){return a.length===u?a:a.subarray?a.subarray(0,u):(a.length=u,a)};var s={arraySet:function(a,u,f,m,h){if(u.subarray&&a.subarray)a.set(u.subarray(f,f+m),h);else for(var c=0;c<m;c++)a[h+c]=u[f+c]},flattenChunks:function(a){var u,f,m,h,c,g;for(u=m=0,f=a.length;u<f;u++)m+=a[u].length;for(g=new Uint8Array(m),u=h=0,f=a.length;u<f;u++)c=a[u],g.set(c,h),h+=c.length;return g}},r={arraySet:function(a,u,f,m,h){for(var c=0;c<m;c++)a[h+c]=u[f+c]},flattenChunks:function(a){return[].concat.apply([],a)}};o.setTyped=function(a){a?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,r))},o.setTyped(l)},{}],42:[function(i,n,o){var l=i("./common"),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var a=new l.Buf8(256),u=0;u<256;u++)a[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function f(m,h){if(h<65537&&(m.subarray&&r||!m.subarray&&s))return String.fromCharCode.apply(null,l.shrinkBuf(m,h));for(var c="",g=0;g<h;g++)c+=String.fromCharCode(m[g]);return c}a[254]=a[254]=1,o.string2buf=function(m){var h,c,g,d,v,_=m.length,y=0;for(d=0;d<_;d++)(64512&(c=m.charCodeAt(d)))==55296&&d+1<_&&(64512&(g=m.charCodeAt(d+1)))==56320&&(c=65536+(c-55296<<10)+(g-56320),d++),y+=c<128?1:c<2048?2:c<65536?3:4;for(h=new l.Buf8(y),d=v=0;v<y;d++)(64512&(c=m.charCodeAt(d)))==55296&&d+1<_&&(64512&(g=m.charCodeAt(d+1)))==56320&&(c=65536+(c-55296<<10)+(g-56320),d++),c<128?h[v++]=c:(c<2048?h[v++]=192|c>>>6:(c<65536?h[v++]=224|c>>>12:(h[v++]=240|c>>>18,h[v++]=128|c>>>12&63),h[v++]=128|c>>>6&63),h[v++]=128|63&c);return h},o.buf2binstring=function(m){return f(m,m.length)},o.binstring2buf=function(m){for(var h=new l.Buf8(m.length),c=0,g=h.length;c<g;c++)h[c]=m.charCodeAt(c);return h},o.buf2string=function(m,h){var c,g,d,v,_=h||m.length,y=new Array(2*_);for(c=g=0;c<_;)if((d=m[c++])<128)y[g++]=d;else if(4<(v=a[d]))y[g++]=65533,c+=v-1;else{for(d&=v===2?31:v===3?15:7;1<v&&c<_;)d=d<<6|63&m[c++],v--;1<v?y[g++]=65533:d<65536?y[g++]=d:(d-=65536,y[g++]=55296|d>>10&1023,y[g++]=56320|1023&d)}return f(y,g)},o.utf8border=function(m,h){var c;for((h=h||m.length)>m.length&&(h=m.length),c=h-1;0<=c&&(192&m[c])==128;)c--;return c<0||c===0?h:c+a[m[c]]>h?c:h}},{"./common":41}],43:[function(i,n,o){n.exports=function(l,s,r,a){for(var u=65535&l|0,f=l>>>16&65535|0,m=0;r!==0;){for(r-=m=2e3<r?2e3:r;f=f+(u=u+s[a++]|0)|0,--m;);u%=65521,f%=65521}return u|f<<16|0}},{}],44:[function(i,n,o){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(i,n,o){var l=function(){for(var s,r=[],a=0;a<256;a++){s=a;for(var u=0;u<8;u++)s=1&s?3988292384^s>>>1:s>>>1;r[a]=s}return r}();n.exports=function(s,r,a,u){var f=l,m=u+a;s^=-1;for(var h=u;h<m;h++)s=s>>>8^f[255&(s^r[h])];return-1^s}},{}],46:[function(i,n,o){var l,s=i("../utils/common"),r=i("./trees"),a=i("./adler32"),u=i("./crc32"),f=i("./messages"),m=0,h=4,c=0,g=-2,d=-1,v=4,_=2,y=8,S=9,w=286,k=30,O=19,P=2*w+1,G=15,I=3,W=258,et=W+I+1,C=42,$=113,b=1,z=2,lt=3,U=4;function ut(p,F){return p.msg=f[F],F}function X(p){return(p<<1)-(4<p?9:0)}function st(p){for(var F=p.length;0<=--F;)p[F]=0}function N(p){var F=p.state,A=F.pending;A>p.avail_out&&(A=p.avail_out),A!==0&&(s.arraySet(p.output,F.pending_buf,F.pending_out,A,p.next_out),p.next_out+=A,F.pending_out+=A,p.total_out+=A,p.avail_out-=A,F.pending-=A,F.pending===0&&(F.pending_out=0))}function x(p,F){r._tr_flush_block(p,0<=p.block_start?p.block_start:-1,p.strstart-p.block_start,F),p.block_start=p.strstart,N(p.strm)}function it(p,F){p.pending_buf[p.pending++]=F}function Q(p,F){p.pending_buf[p.pending++]=F>>>8&255,p.pending_buf[p.pending++]=255&F}function Z(p,F){var A,D,E=p.max_chain_length,T=p.strstart,V=p.prev_length,H=p.nice_match,R=p.strstart>p.w_size-et?p.strstart-(p.w_size-et):0,q=p.window,tt=p.w_mask,K=p.prev,ot=p.strstart+W,_t=q[T+V-1],dt=q[T+V];p.prev_length>=p.good_match&&(E>>=2),H>p.lookahead&&(H=p.lookahead);do if(q[(A=F)+V]===dt&&q[A+V-1]===_t&&q[A]===q[T]&&q[++A]===q[T+1]){T+=2,A++;do;while(q[++T]===q[++A]&&q[++T]===q[++A]&&q[++T]===q[++A]&&q[++T]===q[++A]&&q[++T]===q[++A]&&q[++T]===q[++A]&&q[++T]===q[++A]&&q[++T]===q[++A]&&T<ot);if(D=W-(ot-T),T=ot-W,V<D){if(p.match_start=F,H<=(V=D))break;_t=q[T+V-1],dt=q[T+V]}}while((F=K[F&tt])>R&&--E!=0);return V<=p.lookahead?V:p.lookahead}function Et(p){var F,A,D,E,T,V,H,R,q,tt,K=p.w_size;do{if(E=p.window_size-p.lookahead-p.strstart,p.strstart>=K+(K-et)){for(s.arraySet(p.window,p.window,K,K,0),p.match_start-=K,p.strstart-=K,p.block_start-=K,F=A=p.hash_size;D=p.head[--F],p.head[F]=K<=D?D-K:0,--A;);for(F=A=K;D=p.prev[--F],p.prev[F]=K<=D?D-K:0,--A;);E+=K}if(p.strm.avail_in===0)break;if(V=p.strm,H=p.window,R=p.strstart+p.lookahead,q=E,tt=void 0,tt=V.avail_in,q<tt&&(tt=q),A=tt===0?0:(V.avail_in-=tt,s.arraySet(H,V.input,V.next_in,tt,R),V.state.wrap===1?V.adler=a(V.adler,H,tt,R):V.state.wrap===2&&(V.adler=u(V.adler,H,tt,R)),V.next_in+=tt,V.total_in+=tt,tt),p.lookahead+=A,p.lookahead+p.insert>=I)for(T=p.strstart-p.insert,p.ins_h=p.window[T],p.ins_h=(p.ins_h<<p.hash_shift^p.window[T+1])&p.hash_mask;p.insert&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[T+I-1])&p.hash_mask,p.prev[T&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=T,T++,p.insert--,!(p.lookahead+p.insert<I)););}while(p.lookahead<et&&p.strm.avail_in!==0)}function Lt(p,F){for(var A,D;;){if(p.lookahead<et){if(Et(p),p.lookahead<et&&F===m)return b;if(p.lookahead===0)break}if(A=0,p.lookahead>=I&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+I-1])&p.hash_mask,A=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),A!==0&&p.strstart-A<=p.w_size-et&&(p.match_length=Z(p,A)),p.match_length>=I)if(D=r._tr_tally(p,p.strstart-p.match_start,p.match_length-I),p.lookahead-=p.match_length,p.match_length<=p.max_lazy_match&&p.lookahead>=I){for(p.match_length--;p.strstart++,p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+I-1])&p.hash_mask,A=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart,--p.match_length!=0;);p.strstart++}else p.strstart+=p.match_length,p.match_length=0,p.ins_h=p.window[p.strstart],p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+1])&p.hash_mask;else D=r._tr_tally(p,0,p.window[p.strstart]),p.lookahead--,p.strstart++;if(D&&(x(p,!1),p.strm.avail_out===0))return b}return p.insert=p.strstart<I-1?p.strstart:I-1,F===h?(x(p,!0),p.strm.avail_out===0?lt:U):p.last_lit&&(x(p,!1),p.strm.avail_out===0)?b:z}function ft(p,F){for(var A,D,E;;){if(p.lookahead<et){if(Et(p),p.lookahead<et&&F===m)return b;if(p.lookahead===0)break}if(A=0,p.lookahead>=I&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+I-1])&p.hash_mask,A=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),p.prev_length=p.match_length,p.prev_match=p.match_start,p.match_length=I-1,A!==0&&p.prev_length<p.max_lazy_match&&p.strstart-A<=p.w_size-et&&(p.match_length=Z(p,A),p.match_length<=5&&(p.strategy===1||p.match_length===I&&4096<p.strstart-p.match_start)&&(p.match_length=I-1)),p.prev_length>=I&&p.match_length<=p.prev_length){for(E=p.strstart+p.lookahead-I,D=r._tr_tally(p,p.strstart-1-p.prev_match,p.prev_length-I),p.lookahead-=p.prev_length-1,p.prev_length-=2;++p.strstart<=E&&(p.ins_h=(p.ins_h<<p.hash_shift^p.window[p.strstart+I-1])&p.hash_mask,A=p.prev[p.strstart&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=p.strstart),--p.prev_length!=0;);if(p.match_available=0,p.match_length=I-1,p.strstart++,D&&(x(p,!1),p.strm.avail_out===0))return b}else if(p.match_available){if((D=r._tr_tally(p,0,p.window[p.strstart-1]))&&x(p,!1),p.strstart++,p.lookahead--,p.strm.avail_out===0)return b}else p.match_available=1,p.strstart++,p.lookahead--}return p.match_available&&(D=r._tr_tally(p,0,p.window[p.strstart-1]),p.match_available=0),p.insert=p.strstart<I-1?p.strstart:I-1,F===h?(x(p,!0),p.strm.avail_out===0?lt:U):p.last_lit&&(x(p,!1),p.strm.avail_out===0)?b:z}function vt(p,F,A,D,E){this.good_length=p,this.max_lazy=F,this.nice_length=A,this.max_chain=D,this.func=E}function wt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*P),this.dyn_dtree=new s.Buf16(2*(2*k+1)),this.bl_tree=new s.Buf16(2*(2*O+1)),st(this.dyn_ltree),st(this.dyn_dtree),st(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(G+1),this.heap=new s.Buf16(2*w+1),st(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*w+1),st(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Dt(p){var F;return p&&p.state?(p.total_in=p.total_out=0,p.data_type=_,(F=p.state).pending=0,F.pending_out=0,F.wrap<0&&(F.wrap=-F.wrap),F.status=F.wrap?C:$,p.adler=F.wrap===2?0:1,F.last_flush=m,r._tr_init(F),c):ut(p,g)}function Pt(p){var F=Dt(p);return F===c&&function(A){A.window_size=2*A.w_size,st(A.head),A.max_lazy_match=l[A.level].max_lazy,A.good_match=l[A.level].good_length,A.nice_match=l[A.level].nice_length,A.max_chain_length=l[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=I-1,A.match_available=0,A.ins_h=0}(p.state),F}function Nt(p,F,A,D,E,T){if(!p)return g;var V=1;if(F===d&&(F=6),D<0?(V=0,D=-D):15<D&&(V=2,D-=16),E<1||S<E||A!==y||D<8||15<D||F<0||9<F||T<0||v<T)return ut(p,g);D===8&&(D=9);var H=new wt;return(p.state=H).strm=p,H.wrap=V,H.gzhead=null,H.w_bits=D,H.w_size=1<<H.w_bits,H.w_mask=H.w_size-1,H.hash_bits=E+7,H.hash_size=1<<H.hash_bits,H.hash_mask=H.hash_size-1,H.hash_shift=~~((H.hash_bits+I-1)/I),H.window=new s.Buf8(2*H.w_size),H.head=new s.Buf16(H.hash_size),H.prev=new s.Buf16(H.w_size),H.lit_bufsize=1<<E+6,H.pending_buf_size=4*H.lit_bufsize,H.pending_buf=new s.Buf8(H.pending_buf_size),H.d_buf=1*H.lit_bufsize,H.l_buf=3*H.lit_bufsize,H.level=F,H.strategy=T,H.method=A,Pt(p)}l=[new vt(0,0,0,0,function(p,F){var A=65535;for(A>p.pending_buf_size-5&&(A=p.pending_buf_size-5);;){if(p.lookahead<=1){if(Et(p),p.lookahead===0&&F===m)return b;if(p.lookahead===0)break}p.strstart+=p.lookahead,p.lookahead=0;var D=p.block_start+A;if((p.strstart===0||p.strstart>=D)&&(p.lookahead=p.strstart-D,p.strstart=D,x(p,!1),p.strm.avail_out===0)||p.strstart-p.block_start>=p.w_size-et&&(x(p,!1),p.strm.avail_out===0))return b}return p.insert=0,F===h?(x(p,!0),p.strm.avail_out===0?lt:U):(p.strstart>p.block_start&&(x(p,!1),p.strm.avail_out),b)}),new vt(4,4,8,4,Lt),new vt(4,5,16,8,Lt),new vt(4,6,32,32,Lt),new vt(4,4,16,16,ft),new vt(8,16,32,32,ft),new vt(8,16,128,128,ft),new vt(8,32,128,256,ft),new vt(32,128,258,1024,ft),new vt(32,258,258,4096,ft)],o.deflateInit=function(p,F){return Nt(p,F,y,15,8,0)},o.deflateInit2=Nt,o.deflateReset=Pt,o.deflateResetKeep=Dt,o.deflateSetHeader=function(p,F){return p&&p.state?p.state.wrap!==2?g:(p.state.gzhead=F,c):g},o.deflate=function(p,F){var A,D,E,T;if(!p||!p.state||5<F||F<0)return p?ut(p,g):g;if(D=p.state,!p.output||!p.input&&p.avail_in!==0||D.status===666&&F!==h)return ut(p,p.avail_out===0?-5:g);if(D.strm=p,A=D.last_flush,D.last_flush=F,D.status===C)if(D.wrap===2)p.adler=0,it(D,31),it(D,139),it(D,8),D.gzhead?(it(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),it(D,255&D.gzhead.time),it(D,D.gzhead.time>>8&255),it(D,D.gzhead.time>>16&255),it(D,D.gzhead.time>>24&255),it(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),it(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(it(D,255&D.gzhead.extra.length),it(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(p.adler=u(p.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(it(D,0),it(D,0),it(D,0),it(D,0),it(D,0),it(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),it(D,3),D.status=$);else{var V=y+(D.w_bits-8<<4)<<8;V|=(2<=D.strategy||D.level<2?0:D.level<6?1:D.level===6?2:3)<<6,D.strstart!==0&&(V|=32),V+=31-V%31,D.status=$,Q(D,V),D.strstart!==0&&(Q(D,p.adler>>>16),Q(D,65535&p.adler)),p.adler=1}if(D.status===69)if(D.gzhead.extra){for(E=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),N(p),E=D.pending,D.pending!==D.pending_buf_size));)it(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(D.status===73)if(D.gzhead.name){E=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),N(p),E=D.pending,D.pending===D.pending_buf_size)){T=1;break}T=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,it(D,T)}while(T!==0);D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),T===0&&(D.gzindex=0,D.status=91)}else D.status=91;if(D.status===91)if(D.gzhead.comment){E=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),N(p),E=D.pending,D.pending===D.pending_buf_size)){T=1;break}T=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,it(D,T)}while(T!==0);D.gzhead.hcrc&&D.pending>E&&(p.adler=u(p.adler,D.pending_buf,D.pending-E,E)),T===0&&(D.status=103)}else D.status=103;if(D.status===103&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&N(p),D.pending+2<=D.pending_buf_size&&(it(D,255&p.adler),it(D,p.adler>>8&255),p.adler=0,D.status=$)):D.status=$),D.pending!==0){if(N(p),p.avail_out===0)return D.last_flush=-1,c}else if(p.avail_in===0&&X(F)<=X(A)&&F!==h)return ut(p,-5);if(D.status===666&&p.avail_in!==0)return ut(p,-5);if(p.avail_in!==0||D.lookahead!==0||F!==m&&D.status!==666){var H=D.strategy===2?function(R,q){for(var tt;;){if(R.lookahead===0&&(Et(R),R.lookahead===0)){if(q===m)return b;break}if(R.match_length=0,tt=r._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,tt&&(x(R,!1),R.strm.avail_out===0))return b}return R.insert=0,q===h?(x(R,!0),R.strm.avail_out===0?lt:U):R.last_lit&&(x(R,!1),R.strm.avail_out===0)?b:z}(D,F):D.strategy===3?function(R,q){for(var tt,K,ot,_t,dt=R.window;;){if(R.lookahead<=W){if(Et(R),R.lookahead<=W&&q===m)return b;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=I&&0<R.strstart&&(K=dt[ot=R.strstart-1])===dt[++ot]&&K===dt[++ot]&&K===dt[++ot]){_t=R.strstart+W;do;while(K===dt[++ot]&&K===dt[++ot]&&K===dt[++ot]&&K===dt[++ot]&&K===dt[++ot]&&K===dt[++ot]&&K===dt[++ot]&&K===dt[++ot]&&ot<_t);R.match_length=W-(_t-ot),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=I?(tt=r._tr_tally(R,1,R.match_length-I),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(tt=r._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),tt&&(x(R,!1),R.strm.avail_out===0))return b}return R.insert=0,q===h?(x(R,!0),R.strm.avail_out===0?lt:U):R.last_lit&&(x(R,!1),R.strm.avail_out===0)?b:z}(D,F):l[D.level].func(D,F);if(H!==lt&&H!==U||(D.status=666),H===b||H===lt)return p.avail_out===0&&(D.last_flush=-1),c;if(H===z&&(F===1?r._tr_align(D):F!==5&&(r._tr_stored_block(D,0,0,!1),F===3&&(st(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),N(p),p.avail_out===0))return D.last_flush=-1,c}return F!==h?c:D.wrap<=0?1:(D.wrap===2?(it(D,255&p.adler),it(D,p.adler>>8&255),it(D,p.adler>>16&255),it(D,p.adler>>24&255),it(D,255&p.total_in),it(D,p.total_in>>8&255),it(D,p.total_in>>16&255),it(D,p.total_in>>24&255)):(Q(D,p.adler>>>16),Q(D,65535&p.adler)),N(p),0<D.wrap&&(D.wrap=-D.wrap),D.pending!==0?c:1)},o.deflateEnd=function(p){var F;return p&&p.state?(F=p.state.status)!==C&&F!==69&&F!==73&&F!==91&&F!==103&&F!==$&&F!==666?ut(p,g):(p.state=null,F===$?ut(p,-3):c):g},o.deflateSetDictionary=function(p,F){var A,D,E,T,V,H,R,q,tt=F.length;if(!p||!p.state||(T=(A=p.state).wrap)===2||T===1&&A.status!==C||A.lookahead)return g;for(T===1&&(p.adler=a(p.adler,F,tt,0)),A.wrap=0,tt>=A.w_size&&(T===0&&(st(A.head),A.strstart=0,A.block_start=0,A.insert=0),q=new s.Buf8(A.w_size),s.arraySet(q,F,tt-A.w_size,A.w_size,0),F=q,tt=A.w_size),V=p.avail_in,H=p.next_in,R=p.input,p.avail_in=tt,p.next_in=0,p.input=F,Et(A);A.lookahead>=I;){for(D=A.strstart,E=A.lookahead-(I-1);A.ins_h=(A.ins_h<<A.hash_shift^A.window[D+I-1])&A.hash_mask,A.prev[D&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=D,D++,--E;);A.strstart=D,A.lookahead=I-1,Et(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=I-1,A.match_available=0,p.next_in=H,p.input=R,p.avail_in=V,A.wrap=T,c},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(i,n,o){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(i,n,o){n.exports=function(l,s){var r,a,u,f,m,h,c,g,d,v,_,y,S,w,k,O,P,G,I,W,et,C,$,b,z;r=l.state,a=l.next_in,b=l.input,u=a+(l.avail_in-5),f=l.next_out,z=l.output,m=f-(s-l.avail_out),h=f+(l.avail_out-257),c=r.dmax,g=r.wsize,d=r.whave,v=r.wnext,_=r.window,y=r.hold,S=r.bits,w=r.lencode,k=r.distcode,O=(1<<r.lenbits)-1,P=(1<<r.distbits)-1;t:do{S<15&&(y+=b[a++]<<S,S+=8,y+=b[a++]<<S,S+=8),G=w[y&O];e:for(;;){if(y>>>=I=G>>>24,S-=I,(I=G>>>16&255)===0)z[f++]=65535&G;else{if(!(16&I)){if(!(64&I)){G=w[(65535&G)+(y&(1<<I)-1)];continue e}if(32&I){r.mode=12;break t}l.msg="invalid literal/length code",r.mode=30;break t}W=65535&G,(I&=15)&&(S<I&&(y+=b[a++]<<S,S+=8),W+=y&(1<<I)-1,y>>>=I,S-=I),S<15&&(y+=b[a++]<<S,S+=8,y+=b[a++]<<S,S+=8),G=k[y&P];i:for(;;){if(y>>>=I=G>>>24,S-=I,!(16&(I=G>>>16&255))){if(!(64&I)){G=k[(65535&G)+(y&(1<<I)-1)];continue i}l.msg="invalid distance code",r.mode=30;break t}if(et=65535&G,S<(I&=15)&&(y+=b[a++]<<S,(S+=8)<I&&(y+=b[a++]<<S,S+=8)),c<(et+=y&(1<<I)-1)){l.msg="invalid distance too far back",r.mode=30;break t}if(y>>>=I,S-=I,(I=f-m)<et){if(d<(I=et-I)&&r.sane){l.msg="invalid distance too far back",r.mode=30;break t}if($=_,(C=0)===v){if(C+=g-I,I<W){for(W-=I;z[f++]=_[C++],--I;);C=f-et,$=z}}else if(v<I){if(C+=g+v-I,(I-=v)<W){for(W-=I;z[f++]=_[C++],--I;);if(C=0,v<W){for(W-=I=v;z[f++]=_[C++],--I;);C=f-et,$=z}}}else if(C+=v-I,I<W){for(W-=I;z[f++]=_[C++],--I;);C=f-et,$=z}for(;2<W;)z[f++]=$[C++],z[f++]=$[C++],z[f++]=$[C++],W-=3;W&&(z[f++]=$[C++],1<W&&(z[f++]=$[C++]))}else{for(C=f-et;z[f++]=z[C++],z[f++]=z[C++],z[f++]=z[C++],2<(W-=3););W&&(z[f++]=z[C++],1<W&&(z[f++]=z[C++]))}break}}break}}while(a<u&&f<h);a-=W=S>>3,y&=(1<<(S-=W<<3))-1,l.next_in=a,l.next_out=f,l.avail_in=a<u?u-a+5:5-(a-u),l.avail_out=f<h?h-f+257:257-(f-h),r.hold=y,r.bits=S}},{}],49:[function(i,n,o){var l=i("../utils/common"),s=i("./adler32"),r=i("./crc32"),a=i("./inffast"),u=i("./inftrees"),f=1,m=2,h=0,c=-2,g=1,d=852,v=592;function _(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new l.Buf16(320),this.work=new l.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(C){var $;return C&&C.state?($=C.state,C.total_in=C.total_out=$.total=0,C.msg="",$.wrap&&(C.adler=1&$.wrap),$.mode=g,$.last=0,$.havedict=0,$.dmax=32768,$.head=null,$.hold=0,$.bits=0,$.lencode=$.lendyn=new l.Buf32(d),$.distcode=$.distdyn=new l.Buf32(v),$.sane=1,$.back=-1,h):c}function w(C){var $;return C&&C.state?(($=C.state).wsize=0,$.whave=0,$.wnext=0,S(C)):c}function k(C,$){var b,z;return C&&C.state?(z=C.state,$<0?(b=0,$=-$):(b=1+($>>4),$<48&&($&=15)),$&&($<8||15<$)?c:(z.window!==null&&z.wbits!==$&&(z.window=null),z.wrap=b,z.wbits=$,w(C))):c}function O(C,$){var b,z;return C?(z=new y,(C.state=z).window=null,(b=k(C,$))!==h&&(C.state=null),b):c}var P,G,I=!0;function W(C){if(I){var $;for(P=new l.Buf32(512),G=new l.Buf32(32),$=0;$<144;)C.lens[$++]=8;for(;$<256;)C.lens[$++]=9;for(;$<280;)C.lens[$++]=7;for(;$<288;)C.lens[$++]=8;for(u(f,C.lens,0,288,P,0,C.work,{bits:9}),$=0;$<32;)C.lens[$++]=5;u(m,C.lens,0,32,G,0,C.work,{bits:5}),I=!1}C.lencode=P,C.lenbits=9,C.distcode=G,C.distbits=5}function et(C,$,b,z){var lt,U=C.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new l.Buf8(U.wsize)),z>=U.wsize?(l.arraySet(U.window,$,b-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(z<(lt=U.wsize-U.wnext)&&(lt=z),l.arraySet(U.window,$,b-z,lt,U.wnext),(z-=lt)?(l.arraySet(U.window,$,b-z,z,0),U.wnext=z,U.whave=U.wsize):(U.wnext+=lt,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=lt))),0}o.inflateReset=w,o.inflateReset2=k,o.inflateResetKeep=S,o.inflateInit=function(C){return O(C,15)},o.inflateInit2=O,o.inflate=function(C,$){var b,z,lt,U,ut,X,st,N,x,it,Q,Z,Et,Lt,ft,vt,wt,Dt,Pt,Nt,p,F,A,D,E=0,T=new l.Buf8(4),V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return c;(b=C.state).mode===12&&(b.mode=13),ut=C.next_out,lt=C.output,st=C.avail_out,U=C.next_in,z=C.input,X=C.avail_in,N=b.hold,x=b.bits,it=X,Q=st,F=h;t:for(;;)switch(b.mode){case g:if(b.wrap===0){b.mode=13;break}for(;x<16;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(2&b.wrap&&N===35615){T[b.check=0]=255&N,T[1]=N>>>8&255,b.check=r(b.check,T,2,0),x=N=0,b.mode=2;break}if(b.flags=0,b.head&&(b.head.done=!1),!(1&b.wrap)||(((255&N)<<8)+(N>>8))%31){C.msg="incorrect header check",b.mode=30;break}if((15&N)!=8){C.msg="unknown compression method",b.mode=30;break}if(x-=4,p=8+(15&(N>>>=4)),b.wbits===0)b.wbits=p;else if(p>b.wbits){C.msg="invalid window size",b.mode=30;break}b.dmax=1<<p,C.adler=b.check=1,b.mode=512&N?10:12,x=N=0;break;case 2:for(;x<16;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(b.flags=N,(255&b.flags)!=8){C.msg="unknown compression method",b.mode=30;break}if(57344&b.flags){C.msg="unknown header flags set",b.mode=30;break}b.head&&(b.head.text=N>>8&1),512&b.flags&&(T[0]=255&N,T[1]=N>>>8&255,b.check=r(b.check,T,2,0)),x=N=0,b.mode=3;case 3:for(;x<32;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}b.head&&(b.head.time=N),512&b.flags&&(T[0]=255&N,T[1]=N>>>8&255,T[2]=N>>>16&255,T[3]=N>>>24&255,b.check=r(b.check,T,4,0)),x=N=0,b.mode=4;case 4:for(;x<16;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}b.head&&(b.head.xflags=255&N,b.head.os=N>>8),512&b.flags&&(T[0]=255&N,T[1]=N>>>8&255,b.check=r(b.check,T,2,0)),x=N=0,b.mode=5;case 5:if(1024&b.flags){for(;x<16;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}b.length=N,b.head&&(b.head.extra_len=N),512&b.flags&&(T[0]=255&N,T[1]=N>>>8&255,b.check=r(b.check,T,2,0)),x=N=0}else b.head&&(b.head.extra=null);b.mode=6;case 6:if(1024&b.flags&&(X<(Z=b.length)&&(Z=X),Z&&(b.head&&(p=b.head.extra_len-b.length,b.head.extra||(b.head.extra=new Array(b.head.extra_len)),l.arraySet(b.head.extra,z,U,Z,p)),512&b.flags&&(b.check=r(b.check,z,Z,U)),X-=Z,U+=Z,b.length-=Z),b.length))break t;b.length=0,b.mode=7;case 7:if(2048&b.flags){if(X===0)break t;for(Z=0;p=z[U+Z++],b.head&&p&&b.length<65536&&(b.head.name+=String.fromCharCode(p)),p&&Z<X;);if(512&b.flags&&(b.check=r(b.check,z,Z,U)),X-=Z,U+=Z,p)break t}else b.head&&(b.head.name=null);b.length=0,b.mode=8;case 8:if(4096&b.flags){if(X===0)break t;for(Z=0;p=z[U+Z++],b.head&&p&&b.length<65536&&(b.head.comment+=String.fromCharCode(p)),p&&Z<X;);if(512&b.flags&&(b.check=r(b.check,z,Z,U)),X-=Z,U+=Z,p)break t}else b.head&&(b.head.comment=null);b.mode=9;case 9:if(512&b.flags){for(;x<16;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(N!==(65535&b.check)){C.msg="header crc mismatch",b.mode=30;break}x=N=0}b.head&&(b.head.hcrc=b.flags>>9&1,b.head.done=!0),C.adler=b.check=0,b.mode=12;break;case 10:for(;x<32;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}C.adler=b.check=_(N),x=N=0,b.mode=11;case 11:if(b.havedict===0)return C.next_out=ut,C.avail_out=st,C.next_in=U,C.avail_in=X,b.hold=N,b.bits=x,2;C.adler=b.check=1,b.mode=12;case 12:if($===5||$===6)break t;case 13:if(b.last){N>>>=7&x,x-=7&x,b.mode=27;break}for(;x<3;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}switch(b.last=1&N,x-=1,3&(N>>>=1)){case 0:b.mode=14;break;case 1:if(W(b),b.mode=20,$!==6)break;N>>>=2,x-=2;break t;case 2:b.mode=17;break;case 3:C.msg="invalid block type",b.mode=30}N>>>=2,x-=2;break;case 14:for(N>>>=7&x,x-=7&x;x<32;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if((65535&N)!=(N>>>16^65535)){C.msg="invalid stored block lengths",b.mode=30;break}if(b.length=65535&N,x=N=0,b.mode=15,$===6)break t;case 15:b.mode=16;case 16:if(Z=b.length){if(X<Z&&(Z=X),st<Z&&(Z=st),Z===0)break t;l.arraySet(lt,z,U,Z,ut),X-=Z,U+=Z,st-=Z,ut+=Z,b.length-=Z;break}b.mode=12;break;case 17:for(;x<14;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(b.nlen=257+(31&N),N>>>=5,x-=5,b.ndist=1+(31&N),N>>>=5,x-=5,b.ncode=4+(15&N),N>>>=4,x-=4,286<b.nlen||30<b.ndist){C.msg="too many length or distance symbols",b.mode=30;break}b.have=0,b.mode=18;case 18:for(;b.have<b.ncode;){for(;x<3;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}b.lens[V[b.have++]]=7&N,N>>>=3,x-=3}for(;b.have<19;)b.lens[V[b.have++]]=0;if(b.lencode=b.lendyn,b.lenbits=7,A={bits:b.lenbits},F=u(0,b.lens,0,19,b.lencode,0,b.work,A),b.lenbits=A.bits,F){C.msg="invalid code lengths set",b.mode=30;break}b.have=0,b.mode=19;case 19:for(;b.have<b.nlen+b.ndist;){for(;vt=(E=b.lencode[N&(1<<b.lenbits)-1])>>>16&255,wt=65535&E,!((ft=E>>>24)<=x);){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(wt<16)N>>>=ft,x-=ft,b.lens[b.have++]=wt;else{if(wt===16){for(D=ft+2;x<D;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(N>>>=ft,x-=ft,b.have===0){C.msg="invalid bit length repeat",b.mode=30;break}p=b.lens[b.have-1],Z=3+(3&N),N>>>=2,x-=2}else if(wt===17){for(D=ft+3;x<D;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}x-=ft,p=0,Z=3+(7&(N>>>=ft)),N>>>=3,x-=3}else{for(D=ft+7;x<D;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}x-=ft,p=0,Z=11+(127&(N>>>=ft)),N>>>=7,x-=7}if(b.have+Z>b.nlen+b.ndist){C.msg="invalid bit length repeat",b.mode=30;break}for(;Z--;)b.lens[b.have++]=p}}if(b.mode===30)break;if(b.lens[256]===0){C.msg="invalid code -- missing end-of-block",b.mode=30;break}if(b.lenbits=9,A={bits:b.lenbits},F=u(f,b.lens,0,b.nlen,b.lencode,0,b.work,A),b.lenbits=A.bits,F){C.msg="invalid literal/lengths set",b.mode=30;break}if(b.distbits=6,b.distcode=b.distdyn,A={bits:b.distbits},F=u(m,b.lens,b.nlen,b.ndist,b.distcode,0,b.work,A),b.distbits=A.bits,F){C.msg="invalid distances set",b.mode=30;break}if(b.mode=20,$===6)break t;case 20:b.mode=21;case 21:if(6<=X&&258<=st){C.next_out=ut,C.avail_out=st,C.next_in=U,C.avail_in=X,b.hold=N,b.bits=x,a(C,Q),ut=C.next_out,lt=C.output,st=C.avail_out,U=C.next_in,z=C.input,X=C.avail_in,N=b.hold,x=b.bits,b.mode===12&&(b.back=-1);break}for(b.back=0;vt=(E=b.lencode[N&(1<<b.lenbits)-1])>>>16&255,wt=65535&E,!((ft=E>>>24)<=x);){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(vt&&!(240&vt)){for(Dt=ft,Pt=vt,Nt=wt;vt=(E=b.lencode[Nt+((N&(1<<Dt+Pt)-1)>>Dt)])>>>16&255,wt=65535&E,!(Dt+(ft=E>>>24)<=x);){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}N>>>=Dt,x-=Dt,b.back+=Dt}if(N>>>=ft,x-=ft,b.back+=ft,b.length=wt,vt===0){b.mode=26;break}if(32&vt){b.back=-1,b.mode=12;break}if(64&vt){C.msg="invalid literal/length code",b.mode=30;break}b.extra=15&vt,b.mode=22;case 22:if(b.extra){for(D=b.extra;x<D;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}b.length+=N&(1<<b.extra)-1,N>>>=b.extra,x-=b.extra,b.back+=b.extra}b.was=b.length,b.mode=23;case 23:for(;vt=(E=b.distcode[N&(1<<b.distbits)-1])>>>16&255,wt=65535&E,!((ft=E>>>24)<=x);){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(!(240&vt)){for(Dt=ft,Pt=vt,Nt=wt;vt=(E=b.distcode[Nt+((N&(1<<Dt+Pt)-1)>>Dt)])>>>16&255,wt=65535&E,!(Dt+(ft=E>>>24)<=x);){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}N>>>=Dt,x-=Dt,b.back+=Dt}if(N>>>=ft,x-=ft,b.back+=ft,64&vt){C.msg="invalid distance code",b.mode=30;break}b.offset=wt,b.extra=15&vt,b.mode=24;case 24:if(b.extra){for(D=b.extra;x<D;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}b.offset+=N&(1<<b.extra)-1,N>>>=b.extra,x-=b.extra,b.back+=b.extra}if(b.offset>b.dmax){C.msg="invalid distance too far back",b.mode=30;break}b.mode=25;case 25:if(st===0)break t;if(Z=Q-st,b.offset>Z){if((Z=b.offset-Z)>b.whave&&b.sane){C.msg="invalid distance too far back",b.mode=30;break}Et=Z>b.wnext?(Z-=b.wnext,b.wsize-Z):b.wnext-Z,Z>b.length&&(Z=b.length),Lt=b.window}else Lt=lt,Et=ut-b.offset,Z=b.length;for(st<Z&&(Z=st),st-=Z,b.length-=Z;lt[ut++]=Lt[Et++],--Z;);b.length===0&&(b.mode=21);break;case 26:if(st===0)break t;lt[ut++]=b.length,st--,b.mode=21;break;case 27:if(b.wrap){for(;x<32;){if(X===0)break t;X--,N|=z[U++]<<x,x+=8}if(Q-=st,C.total_out+=Q,b.total+=Q,Q&&(C.adler=b.check=b.flags?r(b.check,lt,Q,ut-Q):s(b.check,lt,Q,ut-Q)),Q=st,(b.flags?N:_(N))!==b.check){C.msg="incorrect data check",b.mode=30;break}x=N=0}b.mode=28;case 28:if(b.wrap&&b.flags){for(;x<32;){if(X===0)break t;X--,N+=z[U++]<<x,x+=8}if(N!==(4294967295&b.total)){C.msg="incorrect length check",b.mode=30;break}x=N=0}b.mode=29;case 29:F=1;break t;case 30:F=-3;break t;case 31:return-4;case 32:default:return c}return C.next_out=ut,C.avail_out=st,C.next_in=U,C.avail_in=X,b.hold=N,b.bits=x,(b.wsize||Q!==C.avail_out&&b.mode<30&&(b.mode<27||$!==4))&&et(C,C.output,C.next_out,Q-C.avail_out)?(b.mode=31,-4):(it-=C.avail_in,Q-=C.avail_out,C.total_in+=it,C.total_out+=Q,b.total+=Q,b.wrap&&Q&&(C.adler=b.check=b.flags?r(b.check,lt,Q,C.next_out-Q):s(b.check,lt,Q,C.next_out-Q)),C.data_type=b.bits+(b.last?64:0)+(b.mode===12?128:0)+(b.mode===20||b.mode===15?256:0),(it==0&&Q===0||$===4)&&F===h&&(F=-5),F)},o.inflateEnd=function(C){if(!C||!C.state)return c;var $=C.state;return $.window&&($.window=null),C.state=null,h},o.inflateGetHeader=function(C,$){var b;return C&&C.state&&2&(b=C.state).wrap?((b.head=$).done=!1,h):c},o.inflateSetDictionary=function(C,$){var b,z=$.length;return C&&C.state?(b=C.state).wrap!==0&&b.mode!==11?c:b.mode===11&&s(1,$,z,0)!==b.check?-3:et(C,$,z,z)?(b.mode=31,-4):(b.havedict=1,h):c},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(i,n,o){var l=i("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(f,m,h,c,g,d,v,_){var y,S,w,k,O,P,G,I,W,et=_.bits,C=0,$=0,b=0,z=0,lt=0,U=0,ut=0,X=0,st=0,N=0,x=null,it=0,Q=new l.Buf16(16),Z=new l.Buf16(16),Et=null,Lt=0;for(C=0;C<=15;C++)Q[C]=0;for($=0;$<c;$++)Q[m[h+$]]++;for(lt=et,z=15;1<=z&&Q[z]===0;z--);if(z<lt&&(lt=z),z===0)return g[d++]=20971520,g[d++]=20971520,_.bits=1,0;for(b=1;b<z&&Q[b]===0;b++);for(lt<b&&(lt=b),C=X=1;C<=15;C++)if(X<<=1,(X-=Q[C])<0)return-1;if(0<X&&(f===0||z!==1))return-1;for(Z[1]=0,C=1;C<15;C++)Z[C+1]=Z[C]+Q[C];for($=0;$<c;$++)m[h+$]!==0&&(v[Z[m[h+$]]++]=$);if(P=f===0?(x=Et=v,19):f===1?(x=s,it-=257,Et=r,Lt-=257,256):(x=a,Et=u,-1),C=b,O=d,ut=$=N=0,w=-1,k=(st=1<<(U=lt))-1,f===1&&852<st||f===2&&592<st)return 1;for(;;){for(G=C-ut,W=v[$]<P?(I=0,v[$]):v[$]>P?(I=Et[Lt+v[$]],x[it+v[$]]):(I=96,0),y=1<<C-ut,b=S=1<<U;g[O+(N>>ut)+(S-=y)]=G<<24|I<<16|W|0,S!==0;);for(y=1<<C-1;N&y;)y>>=1;if(y!==0?(N&=y-1,N+=y):N=0,$++,--Q[C]==0){if(C===z)break;C=m[h+v[$]]}if(lt<C&&(N&k)!==w){for(ut===0&&(ut=lt),O+=b,X=1<<(U=C-ut);U+ut<z&&!((X-=Q[U+ut])<=0);)U++,X<<=1;if(st+=1<<U,f===1&&852<st||f===2&&592<st)return 1;g[w=N&k]=lt<<24|U<<16|O-d|0}}return N!==0&&(g[O+N]=C-ut<<24|64<<16|0),_.bits=lt,0}},{"../utils/common":41}],51:[function(i,n,o){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(i,n,o){var l=i("../utils/common"),s=0,r=1;function a(E){for(var T=E.length;0<=--T;)E[T]=0}var u=0,f=29,m=256,h=m+1+f,c=30,g=19,d=2*h+1,v=15,_=16,y=7,S=256,w=16,k=17,O=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],G=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],et=new Array(2*(h+2));a(et);var C=new Array(2*c);a(C);var $=new Array(512);a($);var b=new Array(256);a(b);var z=new Array(f);a(z);var lt,U,ut,X=new Array(c);function st(E,T,V,H,R){this.static_tree=E,this.extra_bits=T,this.extra_base=V,this.elems=H,this.max_length=R,this.has_stree=E&&E.length}function N(E,T){this.dyn_tree=E,this.max_code=0,this.stat_desc=T}function x(E){return E<256?$[E]:$[256+(E>>>7)]}function it(E,T){E.pending_buf[E.pending++]=255&T,E.pending_buf[E.pending++]=T>>>8&255}function Q(E,T,V){E.bi_valid>_-V?(E.bi_buf|=T<<E.bi_valid&65535,it(E,E.bi_buf),E.bi_buf=T>>_-E.bi_valid,E.bi_valid+=V-_):(E.bi_buf|=T<<E.bi_valid&65535,E.bi_valid+=V)}function Z(E,T,V){Q(E,V[2*T],V[2*T+1])}function Et(E,T){for(var V=0;V|=1&E,E>>>=1,V<<=1,0<--T;);return V>>>1}function Lt(E,T,V){var H,R,q=new Array(v+1),tt=0;for(H=1;H<=v;H++)q[H]=tt=tt+V[H-1]<<1;for(R=0;R<=T;R++){var K=E[2*R+1];K!==0&&(E[2*R]=Et(q[K]++,K))}}function ft(E){var T;for(T=0;T<h;T++)E.dyn_ltree[2*T]=0;for(T=0;T<c;T++)E.dyn_dtree[2*T]=0;for(T=0;T<g;T++)E.bl_tree[2*T]=0;E.dyn_ltree[2*S]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function vt(E){8<E.bi_valid?it(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function wt(E,T,V,H){var R=2*T,q=2*V;return E[R]<E[q]||E[R]===E[q]&&H[T]<=H[V]}function Dt(E,T,V){for(var H=E.heap[V],R=V<<1;R<=E.heap_len&&(R<E.heap_len&&wt(T,E.heap[R+1],E.heap[R],E.depth)&&R++,!wt(T,H,E.heap[R],E.depth));)E.heap[V]=E.heap[R],V=R,R<<=1;E.heap[V]=H}function Pt(E,T,V){var H,R,q,tt,K=0;if(E.last_lit!==0)for(;H=E.pending_buf[E.d_buf+2*K]<<8|E.pending_buf[E.d_buf+2*K+1],R=E.pending_buf[E.l_buf+K],K++,H===0?Z(E,R,T):(Z(E,(q=b[R])+m+1,T),(tt=P[q])!==0&&Q(E,R-=z[q],tt),Z(E,q=x(--H),V),(tt=G[q])!==0&&Q(E,H-=X[q],tt)),K<E.last_lit;);Z(E,S,T)}function Nt(E,T){var V,H,R,q=T.dyn_tree,tt=T.stat_desc.static_tree,K=T.stat_desc.has_stree,ot=T.stat_desc.elems,_t=-1;for(E.heap_len=0,E.heap_max=d,V=0;V<ot;V++)q[2*V]!==0?(E.heap[++E.heap_len]=_t=V,E.depth[V]=0):q[2*V+1]=0;for(;E.heap_len<2;)q[2*(R=E.heap[++E.heap_len]=_t<2?++_t:0)]=1,E.depth[R]=0,E.opt_len--,K&&(E.static_len-=tt[2*R+1]);for(T.max_code=_t,V=E.heap_len>>1;1<=V;V--)Dt(E,q,V);for(R=ot;V=E.heap[1],E.heap[1]=E.heap[E.heap_len--],Dt(E,q,1),H=E.heap[1],E.heap[--E.heap_max]=V,E.heap[--E.heap_max]=H,q[2*R]=q[2*V]+q[2*H],E.depth[R]=(E.depth[V]>=E.depth[H]?E.depth[V]:E.depth[H])+1,q[2*V+1]=q[2*H+1]=R,E.heap[1]=R++,Dt(E,q,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],function(dt,Ft){var $e,Ut,Pe,kt,Qe,_i,Yt=Ft.dyn_tree,$i=Ft.max_code,on=Ft.stat_desc.static_tree,rn=Ft.stat_desc.has_stree,sn=Ft.stat_desc.extra_bits,Pi=Ft.stat_desc.extra_base,Me=Ft.stat_desc.max_length,ti=0;for(kt=0;kt<=v;kt++)dt.bl_count[kt]=0;for(Yt[2*dt.heap[dt.heap_max]+1]=0,$e=dt.heap_max+1;$e<d;$e++)Me<(kt=Yt[2*Yt[2*(Ut=dt.heap[$e])+1]+1]+1)&&(kt=Me,ti++),Yt[2*Ut+1]=kt,$i<Ut||(dt.bl_count[kt]++,Qe=0,Pi<=Ut&&(Qe=sn[Ut-Pi]),_i=Yt[2*Ut],dt.opt_len+=_i*(kt+Qe),rn&&(dt.static_len+=_i*(on[2*Ut+1]+Qe)));if(ti!==0){do{for(kt=Me-1;dt.bl_count[kt]===0;)kt--;dt.bl_count[kt]--,dt.bl_count[kt+1]+=2,dt.bl_count[Me]--,ti-=2}while(0<ti);for(kt=Me;kt!==0;kt--)for(Ut=dt.bl_count[kt];Ut!==0;)$i<(Pe=dt.heap[--$e])||(Yt[2*Pe+1]!==kt&&(dt.opt_len+=(kt-Yt[2*Pe+1])*Yt[2*Pe],Yt[2*Pe+1]=kt),Ut--)}}(E,T),Lt(q,_t,E.bl_count)}function p(E,T,V){var H,R,q=-1,tt=T[1],K=0,ot=7,_t=4;for(tt===0&&(ot=138,_t=3),T[2*(V+1)+1]=65535,H=0;H<=V;H++)R=tt,tt=T[2*(H+1)+1],++K<ot&&R===tt||(K<_t?E.bl_tree[2*R]+=K:R!==0?(R!==q&&E.bl_tree[2*R]++,E.bl_tree[2*w]++):K<=10?E.bl_tree[2*k]++:E.bl_tree[2*O]++,q=R,_t=(K=0)===tt?(ot=138,3):R===tt?(ot=6,3):(ot=7,4))}function F(E,T,V){var H,R,q=-1,tt=T[1],K=0,ot=7,_t=4;for(tt===0&&(ot=138,_t=3),H=0;H<=V;H++)if(R=tt,tt=T[2*(H+1)+1],!(++K<ot&&R===tt)){if(K<_t)for(;Z(E,R,E.bl_tree),--K!=0;);else R!==0?(R!==q&&(Z(E,R,E.bl_tree),K--),Z(E,w,E.bl_tree),Q(E,K-3,2)):K<=10?(Z(E,k,E.bl_tree),Q(E,K-3,3)):(Z(E,O,E.bl_tree),Q(E,K-11,7));q=R,_t=(K=0)===tt?(ot=138,3):R===tt?(ot=6,3):(ot=7,4)}}a(X);var A=!1;function D(E,T,V,H){Q(E,(u<<1)+(H?1:0),3),function(R,q,tt,K){vt(R),it(R,tt),it(R,~tt),l.arraySet(R.pending_buf,R.window,q,tt,R.pending),R.pending+=tt}(E,T,V)}o._tr_init=function(E){A||(function(){var T,V,H,R,q,tt=new Array(v+1);for(R=H=0;R<f-1;R++)for(z[R]=H,T=0;T<1<<P[R];T++)b[H++]=R;for(b[H-1]=R,R=q=0;R<16;R++)for(X[R]=q,T=0;T<1<<G[R];T++)$[q++]=R;for(q>>=7;R<c;R++)for(X[R]=q<<7,T=0;T<1<<G[R]-7;T++)$[256+q++]=R;for(V=0;V<=v;V++)tt[V]=0;for(T=0;T<=143;)et[2*T+1]=8,T++,tt[8]++;for(;T<=255;)et[2*T+1]=9,T++,tt[9]++;for(;T<=279;)et[2*T+1]=7,T++,tt[7]++;for(;T<=287;)et[2*T+1]=8,T++,tt[8]++;for(Lt(et,h+1,tt),T=0;T<c;T++)C[2*T+1]=5,C[2*T]=Et(T,5);lt=new st(et,P,m+1,h,v),U=new st(C,G,0,c,v),ut=new st(new Array(0),I,0,g,y)}(),A=!0),E.l_desc=new N(E.dyn_ltree,lt),E.d_desc=new N(E.dyn_dtree,U),E.bl_desc=new N(E.bl_tree,ut),E.bi_buf=0,E.bi_valid=0,ft(E)},o._tr_stored_block=D,o._tr_flush_block=function(E,T,V,H){var R,q,tt=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=function(K){var ot,_t=4093624447;for(ot=0;ot<=31;ot++,_t>>>=1)if(1&_t&&K.dyn_ltree[2*ot]!==0)return s;if(K.dyn_ltree[18]!==0||K.dyn_ltree[20]!==0||K.dyn_ltree[26]!==0)return r;for(ot=32;ot<m;ot++)if(K.dyn_ltree[2*ot]!==0)return r;return s}(E)),Nt(E,E.l_desc),Nt(E,E.d_desc),tt=function(K){var ot;for(p(K,K.dyn_ltree,K.l_desc.max_code),p(K,K.dyn_dtree,K.d_desc.max_code),Nt(K,K.bl_desc),ot=g-1;3<=ot&&K.bl_tree[2*W[ot]+1]===0;ot--);return K.opt_len+=3*(ot+1)+5+5+4,ot}(E),R=E.opt_len+3+7>>>3,(q=E.static_len+3+7>>>3)<=R&&(R=q)):R=q=V+5,V+4<=R&&T!==-1?D(E,T,V,H):E.strategy===4||q===R?(Q(E,2+(H?1:0),3),Pt(E,et,C)):(Q(E,4+(H?1:0),3),function(K,ot,_t,dt){var Ft;for(Q(K,ot-257,5),Q(K,_t-1,5),Q(K,dt-4,4),Ft=0;Ft<dt;Ft++)Q(K,K.bl_tree[2*W[Ft]+1],3);F(K,K.dyn_ltree,ot-1),F(K,K.dyn_dtree,_t-1)}(E,E.l_desc.max_code+1,E.d_desc.max_code+1,tt+1),Pt(E,E.dyn_ltree,E.dyn_dtree)),ft(E),H&&vt(E)},o._tr_tally=function(E,T,V){return E.pending_buf[E.d_buf+2*E.last_lit]=T>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&T,E.pending_buf[E.l_buf+E.last_lit]=255&V,E.last_lit++,T===0?E.dyn_ltree[2*V]++:(E.matches++,T--,E.dyn_ltree[2*(b[V]+m+1)]++,E.dyn_dtree[2*x(T)]++),E.last_lit===E.lit_bufsize-1},o._tr_align=function(E){Q(E,2,3),Z(E,S,et),function(T){T.bi_valid===16?(it(T,T.bi_buf),T.bi_buf=0,T.bi_valid=0):8<=T.bi_valid&&(T.pending_buf[T.pending++]=255&T.bi_buf,T.bi_buf>>=8,T.bi_valid-=8)}(E)}},{"../utils/common":41}],53:[function(i,n,o){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(i,n,o){(function(l){(function(s,r){if(!s.setImmediate){var a,u,f,m,h=1,c={},g=!1,d=s.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(s);v=v&&v.setTimeout?v:s,a={}.toString.call(s.process)==="[object process]"?function(w){process.nextTick(function(){y(w)})}:function(){if(s.postMessage&&!s.importScripts){var w=!0,k=s.onmessage;return s.onmessage=function(){w=!1},s.postMessage("","*"),s.onmessage=k,w}}()?(m="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",S,!1):s.attachEvent("onmessage",S),function(w){s.postMessage(m+w,"*")}):s.MessageChannel?((f=new MessageChannel).port1.onmessage=function(w){y(w.data)},function(w){f.port2.postMessage(w)}):d&&"onreadystatechange"in d.createElement("script")?(u=d.documentElement,function(w){var k=d.createElement("script");k.onreadystatechange=function(){y(w),k.onreadystatechange=null,u.removeChild(k),k=null},u.appendChild(k)}):function(w){setTimeout(y,0,w)},v.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var k=new Array(arguments.length-1),O=0;O<k.length;O++)k[O]=arguments[O+1];var P={callback:w,args:k};return c[h]=P,a(h),h++},v.clearImmediate=_}function _(w){delete c[w]}function y(w){if(g)setTimeout(y,0,w);else{var k=c[w];if(k){g=!0;try{(function(O){var P=O.callback,G=O.args;switch(G.length){case 0:P();break;case 1:P(G[0]);break;case 2:P(G[0],G[1]);break;case 3:P(G[0],G[1],G[2]);break;default:P.apply(r,G)}})(k)}finally{_(w),g=!1}}}}function S(w){w.source===s&&typeof w.data=="string"&&w.data.indexOf(m)===0&&y(+w.data.slice(m.length))}})(typeof self>"u"?l===void 0?this:l:self)}).call(this,typeof pn<"u"?pn:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Lh);var xg=Lh.exports;const Bg=Rg(xg);async function Ig(t){return Bg.loadAsync(t)}function _e(){return["main"]}async function Ng(t){if(t.file)return t.file;if(t.link)return Tg(am(decodeURI(t.link)));if(t.id)return Th(lm(decodeURI(t.id)));if(t.hash&&$o(decodeURI(t.hash).trim()))return Lg(decodeURI(t.hash).trim());throw new Error("Could not search for file.")}const Ae=async t=>{let e=0;try{let i=function(){St.status("info",`Loading ${[...u].join(", ")}... [${s}/${r-2}]`,po(s/r,15,80))};console.time("loading time"),e=performance.now(),hn.enable(!1);let n=await Ng(t);St.status("info","Extracting zip",0),It.switchHeader(!1);const o=await Ig(n);hn.enable(!1),St.status("info","Parsing map info...",10),J.tInfo(_e(),"Parsing map info");const l=await _g(o);ht.beatmapInfo=l,Sm(l),l.audio.duration&&(ht.duration=l.audio.duration,It.setSongDuration(l.audio.duration));let s=0,r=0,a=0;const u=new Set(["map","cover image","contributors image","audio","audio/BPM data"]),f=[new Promise(async v=>{J.tInfo(_e(),"Loading cover image");const _=o.file(l.coverImageFilename);if(nt.load.imageCover&&_){let y=await _.async("base64");It.setCoverImage("data:image;base64,"+y),hi.loading.coverImage=!0}else J.tError(_e(),`${l.coverImageFilename} does not exists.`);s++,u.delete("cover image"),i(),v(null)}),new Promise(async v=>{if(ht.contributors=[],l.customData._contributors)for(const _ of l.customData._contributors){J.tInfo(_e(),"Loading contributor image "+_._name);const y=o.file(_._iconPath);let S=null;nt.load.imageContributor&&y?S=await y.async("base64"):J.tError(_e(),`${_._iconPath} does not exists.`),ht.contributors.push({..._,_base64:S})}Bc(ht.contributors),s++,u.delete("contributors image"),i(),v(null)}),new Promise(async v=>{J.tInfo(_e(),"Loading audio");let _=o.file(l.audio.filename);if(nt.load.audio&&_){let y=!1;setTimeout(()=>{!y&&!hi.loading.finished&&St.status("info","Loading audio... (this may take a while)",po(s/r,15,80))},1e4);let S=await _.async("arraybuffer");It.setAudio(S),await new AudioContext().decodeAudioData(S).then(k=>{y=!0;let O=k.duration;ht.duration=O,It.setSongDuration(O),hi.loading.audio=!0}).catch(function(k){It.setSongDuration(),J.tError(_e(),k)})}else ht.duration||It.setSongDuration(),J.tError(_e(),`${l.audio.filename} does not exist.`);s+=2,u.delete("Audio"),i(),v(null)}),new Promise(async v=>{const _=await vg(l,o);s++,u.delete("audio/BPM data"),_&&(hi.loading.audio||(ht.duration=_.duration),It.setSongDuration(_.duration),i()),v(_)}),...Eg(l,o).map(async(v,_,y)=>{const S=await v;return s++,a++,S===null?null:(y.length===a&&u.delete("map"),i(),S)})];r=f.length+2,i();const m=await Promise.allSettled(f);ht.beatmaps=m.slice(4).map(v=>v.status==="fulfilled"?v.value:null).filter(v=>v);const h=m[3].status==="fulfilled"?m[3].value:null;let c=Math.min(l.audio.bpm,...((h==null?void 0:h.bpm)??[]).map(v=>v.bpm)),g=Math.max(l.audio.bpm,...((h==null?void 0:h.bpm)??[]).map(v=>v.bpm));ht.beatmaps.forEach(v=>{v.rawVersion===4&&(v.timeProcessor.timescale=h.bpm);const _=v.timeProcessor.change.map(S=>S.BPM),y=v.timeProcessor.timescale.map(S=>v.timeProcessor.bpm/S.scale);c=Math.min(c,..._,...y),g=Math.max(g,..._,...y)}),c!==g&&It.setSongBPM(l.audio.bpm,c,g),Wi.adjustBeatTime(),Eh.populateSelectCharacteristic(l),J.tInfo(_e(),"Analysing map"),St.status("info","Analysing general...",85),vi.runGeneral(),Wi.displayOutputGeneral(),await mr(5),St.status("info","Analysing difficulty...",90),vi.applyAll(),Wi.displayOutputDifficulty(),await mr(5),hn.enable(!0);let d=performance.now();St.status("info",`Completed! (took ${M((d-e)/1e3,2)}s)`)}catch(i){St.status("error",i),J.tError(_e(),i),ht.clear(),hn.enable(!0),It.switchHeader(!0)}finally{console.timeEnd("loading time")}},Sn=document.querySelector(".input__intro-url"),wn=document.querySelector(".input__intro-id"),kn=document.querySelector(".input__intro-hash"),Ag=document.querySelector(".input__search-button"),Og=document.querySelector(".input__file"),Rh=document.querySelector(".input__file-zone");Sn.addEventListener("keydown",Jo);wn.addEventListener("keydown",Jo);kn.addEventListener("keydown",Jo);Ag.addEventListener("click",$g);Og.addEventListener("change",Pg);Rh.addEventListener("drop",Mg);Rh.addEventListener("dragover",Fg);function Jo(t){const e=t.target;t.key==="Enter"&&e.value!==""&&(e.classList.contains("input__intro-url")&&Ae({link:e.value}),e.classList.contains("input__intro-id")&&Ae({id:e.value}),e.classList.contains("input__intro-hash")&&Ae({hash:e.value}))}function $g(t){if(Sn&&Sn.value!==""){Ae({link:Sn.value});return}if(wn&&wn.value!==""){Ae({id:wn.value});return}if(kn&&kn.value!==""){Ae({hash:kn.value});return}}function Pg(t){const e=t.target;St.status("info","Reading file input",0);const i=e.files?e.files[0]:null;try{if(i==null)throw St.status("info","No file input",0),new Error("No file input");if(i&&(i.name.substr(-4)===".zip"||i.name.substr(-4)===".bsl")){const n=new FileReader;n.readAsArrayBuffer(i),n.addEventListener("load",()=>{Ae({file:i})})}else throw new Error("Unsupported file format, please enter zip file")}catch(n){St.status("error",n,0),console.error(n)}}function Mg(t){t.preventDefault(),t.stopPropagation();try{if(t.dataTransfer==null)throw new Error("No file input");if(t.dataTransfer.items){if(!t.dataTransfer.items[0])throw new Error("Failed to retrieve file from drag & drop");if(t.dataTransfer.items[0].kind==="file"){let e=t.dataTransfer.items[0].getAsFile();if(e&&(e.name.substring(e.name.length-4)===".zip"||e.name.substring(e.name.length-4)===".bsl")){const i=new FileReader;i.readAsArrayBuffer(e),i.addEventListener("load",()=>{Ae({file:e})})}else throw new Error("Unsupported file format, please enter zip file")}}}catch(e){St.status("error",e,0),console.error(e)}}function Fg(t){t.preventDefault(),t.stopPropagation()}const zg=document.querySelector("body"),Vg=["Dark","Light","Monochrome"],Qo={list:Vg,set(t){zg.className="theme-"+t.toLowerCase().replace(" ","")}},tr=document.querySelector(".settings__theme"),xh=document.querySelector(".settings__beat-numbering"),Bh=document.querySelector(".settings__rounding"),Ih=document.querySelector(".settings__info-height"),Nh=document.querySelector(".settings__data-check"),Ah=document.querySelectorAll(".settings__load"),Oo=document.querySelector(".settings__sort"),Oh=document.querySelectorAll(".settings__show"),Gg=document.querySelector(".settings__clear-button");tr.addEventListener("change",Hg);Qo.list.forEach(t=>{const e=document.createElement("option");e.value=t,e.textContent=t,tr.add(e)});xh.addEventListener("change",Ug);Bh.addEventListener("change",jg);Ih.addEventListener("change",Wg);Nh.addEventListener("change",Xg);Ah.forEach(t=>t.addEventListener("change",Jg));Oo.addEventListener("change",Kg);Oh.forEach(t=>t.addEventListener("change",Yg));Gg.addEventListener("click",$h);function Hg(t){const e=t.target;nt.theme=e.options[e.options.selectedIndex].value,Qo.set(nt.theme),nt.save()}function Ug(t){const e=t.target;nt.beatNumbering=e.options[e.options.selectedIndex].value,nt.save()}function jg(t){const e=t.target;nt.rounding=parseInt(e.value),nt.save()}function Wg(t){const e=t.target;nt.infoRowHeight=parseInt(e.value),Ac(nt.infoRowHeight),nt.save()}function Xg(t){const e=t.target;nt.dataCheck=e.checked,nt.save()}function Yg(t){const e=t.target,i=e.id.replace("settings__show-","");for(const n of Object.keys(nt.show))nt.show[n]=!1;nt.show[i]=e.checked,nt.save()}function qg(t,e){Oh.forEach(i=>{i.id.endsWith(t)&&(i.checked=e)})}function Kg(t){const e=t.target;nt.sorting=e.checked,nt.save()}function Zg(t){Oo&&(Oo.checked=t)}function Jg(t){const e=t.target,i=e.name;nt.load[i]=e.checked,nt.save()}function Qg(t,e){Ah.forEach(i=>{i.name===t&&(i.checked=e)})}function tb(t){tr.value=t}function eb(t){xh.value=t}function ib(t){Bh.value=t.toString()}function nb(t){Ih.value=t.toString(),Ac(nt.infoRowHeight)}function ob(t){Nh.checked=t}function $h(){nt.clear(),nt.reset(),location.reload()}const Ve={setShowCheck:qg,setSortCheck:Zg,setLoadCheck:Qg,setTheme:tb,setBeatNumbering:eb,setRounding:ib,setInfoHeight:nb,setDataCheck:ob,clear:$h},Kn="UI Stats: ",L="stats__";function rb(t,e){const i=e.timeProcessor,n=ht.duration||0,o=i.toRealTime(Po(e.data)),l=document.createElement("table");return l.className=L+"table",l.innerHTML=`<caption class="${L}table-caption">Note Per Seconds (NPS):</caption><tr><th class="${L}table-header" colspan="2">Overall</th><td class="${L}table-element">${M(Ir(e.data,n),2)}</td></tr><tr><th class="${L}table-header" colspan="2">Mapped</th><td class="${L}table-element">${M(Ir(e.data,o),2)}</td></tr><tr><th class="${L}table-header" rowspan="3">Peak</th><th class="${L}table-header">16-beat</th><td class="${L}table-element">${M(uo(e.data,16,i),2)}</td></tr><tr><th class="${L}table-header">8-beat</th><td class="${L}table-element">${M(uo(e.data,8,i),2)}</td></tr><tr><th class="${L}table-header">4-beat</th><td class="${L}table-element">${M(uo(e.data,4,i),2)}</td></tr>`,l}function sb(t,e){const i=Oe.create(t.audio.bpm,e.settings.njs||Oe.FallbackNJS[e.settings.difficulty],e.settings.njsOffset),n=document.createElement("table");return n.className=L+"table",n.innerHTML=`<caption class="${L}table-caption">Map Settings:</caption><tr><th class="${L}table-header" colspan="2">Note Jump Speed</th><td class="${L}table-element">${M(i.value,3)}</td></tr><tr><th class="${L}table-header" colspan="2">Spawn Distance Modifier</th><td class="${L}table-element">${M(i.offset,3)}</td></tr><tr><th class="${L}table-header" colspan="2">Half Jump Duration</th><td class="${L}table-element">${M(i.hjd,3)}</td></tr><tr><th class="${L}table-header" colspan="2">Jump Distance</th><td class="${L}table-element">${M(i.jd,3)}</td></tr><tr><th class="${L}table-header" colspan="2">Reaction Time</th><td class="${L}table-element">${M(i.reactionTime*1e3)}ms</td></tr>`,n}function ab(t,e){const i=e.swingAnalysis,n=document.createElement("table");return n.className=L+"table",n.innerHTML=`<caption class="${L}table-caption">Swing Per Seconds (SPS):</caption><tr><th class="${L}table-header"></th><th class="${L}table-header">Total</th><th class="${L}table-header">Red</th><th class="${L}table-header">Blue</th></tr><tr><th class="${L}table-header">Average</th><td class="${L}table-element">${M(i.total.average,2)}</td><td class="${L}table-element">${M(i.red.average,2)}</td><td class="${L}table-element">${M(i.blue.average,2)}</td></tr><tr><th class="${L}table-header">Median</th><td class="${L}table-element">${M(i.total.median,2)}</td><td class="${L}table-element">${M(i.red.median,2)}</td><td class="${L}table-element">${M(i.blue.median,2)}</td></tr><tr><th class="${L}table-header">Peak</th><td class="${L}table-element">${M(i.total.peak,2)}</td><td class="${L}table-element">${M(i.red.peak,2)}</td><td class="${L}table-element">${M(i.blue.peak,2)}</td></tr><tr><th class="${L}table-header">Total</th><td class="${L}table-element">${i.total.total}</td><td class="${L}table-element">${i.red.total}</td><td class="${L}table-element">${i.blue.total}</td></tr>`,n}function Tn(t){const e={red:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0},blue:{total:0,chroma:0,noodleExtensions:0,mappingExtensions:0}};for(let i=t.length-1;i>=0;i--)t[i].color===0?(e.red.total++,t[i].check()&&e.red.chroma++,t[i].check()&&e.red.noodleExtensions++,t[i].check()&&e.red.mappingExtensions++):t[i].color===1&&(e.blue.total++,t[i].check()&&e.blue.chroma++,t[i].check()&&e.blue.noodleExtensions++,t[i].check()&&e.blue.mappingExtensions++);return e}function lb(t){const e={total:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>=0;i--)e.total++,t[i].check()&&e.chroma++,t[i].check()&&e.noodleExtensions++,t[i].check()&&e.mappingExtensions++;return e}function gn(t,e){return t.filter(i=>i.posX===e).length}function cb(t,e){return t.filter(i=>i.posY===e).length}function ub(t,e,i){return t.filter(n=>n.posX===e&&n.posY===i).length}function hb(t,e){return t.filter(i=>i.direction===e).length}function Ph(t,e){switch(e){case"note":return t.filter(i=>i.type===at.COLOR);case"red":return t.filter(i=>i.type===at.COLOR&&i.data.color===0);case"blue":return t.filter(i=>i.type===at.COLOR&&i.data.color===1);case"arc":return t.filter(i=>i.type===at.ARC);case"arc0":return t.filter(i=>i.type===at.ARC&&i.data.color===0);case"arc1":return t.filter(i=>i.type===at.ARC&&i.data.color===1);case"chain":return t.filter(i=>i.type===at.CHAIN);case"chain0":return t.filter(i=>i.type===at.CHAIN&&i.data.color===0);case"chain1":return t.filter(i=>i.type===at.CHAIN&&i.data.color===1);case"bomb":return t.filter(i=>i.type===at.BOMB);default:return t}}function mb(t){var a;const e=t.target,i=e.id.replace(`${L}table-select-angle-`,"").split("-"),n=i[0],o=i[1],l=(a=ht.beatmaps.find(u=>u.settings.characteristic===n&&u.settings.difficulty===o))==null?void 0:a.noteContainer;if(!l){console.error(Kn+"note could not be found");return}const s=Ph(l,e.value).map(u=>u.data),r=document.querySelector(`#${L}table-angle-${n}-${o}`);r.innerHTML=Mh(s)}function Mh(t){const e=t.length||1,i=[4,0,5,2,8,3,6,1,7];let n="";for(let o=0;o<3;o++){n+="<tr>";for(let l=0;l<3;l++){let s=hb(t,i[o*3+l]);n+=`<td class="${L}table-element">${s}<br>(${M(s/e*100,1)}%)</td>`}n+="</tr>"}return n}function fb(t,e){var l;const i=Ji.create(`${L}table-select-angle-${e.settings.characteristic}-${e.settings.difficulty}`,"Note Angle: ","caption",`${L}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"});(l=i.querySelector("select"))==null||l.addEventListener("change",mb);let n=`<tbody id="${L}table-angle-${e.settings.characteristic}-${e.settings.difficulty}">${Mh(e.noteContainer.map(s=>s.data))}</tbody>`;const o=document.createElement("table");return o.className=L+"table",o.innerHTML=n,o.prepend(i),o}function pb(t,e,i="DefaultEnvironment"){var l;const n=((l=gi[i])==null?void 0:l[0])??gi.DefaultEnvironment[0],o={};for(let s=n.length-1;s>=0;s--)o[n[s]]={total:0,chroma:0,chromaOld:0};o[5]={total:e.length,chroma:0,chromaOld:0};for(let s=t.length-1;s>=0;s--)t[s].isValidType()&&(o[t[s].type]||(o[t[s].type]={total:0,chroma:0,chromaOld:0}),o[t[s].type].total++,t[s].check()&&o[t[s].type].chroma++,t[s].isOldChroma()&&o[t[s].type].chromaOld++);return o}function bn(t,e="DefaultEnvironment"){var o;const i=((o=gi[e])==null?void 0:o[1])??gi.DefaultEnvironment[1],n={};for(let l=i.length-1;l>=0;l--)n[i[l]]={groups:0,boxes:0,bases:0};for(let l=t.length-1;l>=0;l--)n[t[l].id]||(n[t[l].id]={groups:0,boxes:0,bases:0}),n[t[l].id].groups++,n[t[l].id].boxes+=t[l].boxes.length,n[t[l].id].bases+=t[l].boxes.reduce((s,r)=>s+r.events.length,0);return n}function db(t){const e={total:0,interactive:0,chroma:0,noodleExtensions:0,mappingExtensions:0};for(let i=t.length-1;i>-1;i--)e.total++,t[i].isInteractive()&&e.interactive++,t[i].check()&&e.chroma++,t[i].check()&&e.noodleExtensions++,t[i].check()&&e.mappingExtensions++;return e}const gb={0:"Back Lasers",1:"Ring Lights",2:"Left Lasers",3:"Right Lasers",4:"Center Lights",5:"Boost Colors",6:"Extra Left Lights",7:"Extra Right Lights",8:"Ring Rotation",9:"Ring Zoom",10:"Extra Left Lasers",11:"Extra Right Lasers",12:"Left Laser Speed",13:"Right Laser Speed",14:"Early Lane Rotation",15:"Late Lane Rotation",16:"Utility Event 1",17:"Utility Event 2",18:"Utility Event 3",19:"Utility Event 4",40:"Special Event 1",41:"Special Event 2",42:"Special Event 3",43:"Special Event 4"},bb={LinkinParkEnvironment:{0:"Lane Light",1:"Ceiling Lights",8:"Laser Mode"},BTSEnvironment:{0:"Door Light",1:"Vertical Pillar Lights",8:"Distant Tower Spin",9:"Raise/Lower Pillars",40:"BTS Event 1",41:"BTS Event 2",42:"BTS Event 3",43:"BTS Event 4"},KaleidoscopeEnvironment:{0:"Spike Tip Lights",1:"Spike Mid Lights",2:"Spike Left Lights",3:"Spike Right Lights",4:"Distant Lasers and Spike Top Lights"},InterscopeEnvironment:{0:"Gate 1",1:"Gate 2",2:"Gate 3",3:"Gate 4",4:"Gate 5",6:"Extra 1",7:"Extra 2"},SkrillexEnvironment:{0:"Logo",1:"Top Lanes and 1st Ring Set",4:"Bottom Lanes and 2nd Ring Set",6:"Left Panel",7:"Right Panel",12:"Left Laser & Panel Speed",13:"Right Laser & Panel Speed"},BillieEnvironment:{0:"Water 4",1:"Water 1",2:"Left Sun Beams",3:"Right Sun Beams",4:"Sun",6:"Water 2",7:"Water 3",8:"Toggle Rain",9:"Sunbeam Mode",10:"Left Bottom Lasers",11:"Right Bottom Lasers",12:"Left Sun Beams Speed",13:"Right Sun Beams Speed"},HalloweenEnvironment:{0:"Sky Lasers",1:"Moon",4:"Lane + Castle Interior"},GagaEnvironment:{0:"Aurora 1",1:"Aurora 2",2:"Tower 1",3:"Tower 2",4:"Logo",6:"Tower 3",7:"Tower 4",10:"Tower 5",11:"Tower 6",14:"Tower 1 Height",15:"Tower 2 Height",16:"Tower 3 Height",17:"Tower 4 Height",18:"Tower 5 Height",19:"Tower 6 Height"},WeaveEnvironment:{4:"Player Space"},PyroEnvironment:{0:"Video Alpha",1:"Logo",2:"Left Projectors",3:"Right Projectors",4:"Platform",6:"Ambient",40:"Video Projection"},EDMEnvironment:{0:"Lane Lights Bottom",1:"Lane Lights Top",4:"Player Space & Spectrogram"},TheSecondEnvironment:{0:"Logo",1:"Runway",2:"Left Flags",3:"Right Flags",4:"Buildings"},LizzoEnvironment:{0:"Runway Left",1:"Runway Right",2:"Left Ring",3:"Right Ring",4:"Top Square",6:"Ambient",7:"Cherry Left",8:"Cherry Right",9:"LI Sign",10:"Z Left Sign",11:"Z Right Sign",12:"O Sign",16:"Left Balloon Particles",17:"Right Balloon Particles"},TheWeekndEnvironment:{0:"Runway Left",1:"Runway Right",6:"Ambient"},RockMixtapeEnvironment:{3:"BG Bloom",4:"Aurora",6:"Ambient"},Dragons2Environment:{0:"Inner Laser Left",1:"Inner Laser Right",2:"Outer Laser Left",3:"Outer Laser Right",4:"Logo",6:"Ambient"},Panic2Environment:{3:"Ambient"},QueenEnvironment:{6:"Ambient",40:"Silhouettes"},LinkinPark2Environment:{3:"Ambient",40:"Logos",41:"Floor Logos"},TheRollingStonesEnvironment:{6:"Ambient",40:"Logo"},LatticeEnvironment:{6:"Ambient"},DaftPunkEnvironment:{6:"Ambient",40:"Helmet 01 Switch",41:"Helmet 02 Switch",42:"Helmet 01 Text",43:"Helmet 02 Text"},HipHopEnvironment:{6:"Ambient"},ColliderEnvironment:{6:"Ambient"}};function vb(t,e){var i;return((i=bb[e])==null?void 0:i[t])||gb[t]||"Unknown"}const _b={WeaveEnvironment:{0:"Outer Square Bottom Left Laser",1:"Outer Square Bottom Right Laser",2:"Outer Square Top Left Laser",3:"Outer Square Top Right Laser",4:"Inner Square Bottom Left Laser",5:"Inner Square Bottom Right Laser",6:"Inner Square Top Left Laser",7:"Inner Square Top Right Laser",8:"Side Square Bottom Left Laser",9:"Side Square Bottom Right Laser",10:"Side Square Top Left Laser",11:"Side Square Top Right Laser",12:"Distant Square Top Laser",13:"Distant Square Bottom Laser",14:"Distant Square Left Laser",15:"Distant Square Right Laser"},PyroEnvironment:{0:"Stage Left Platform",1:"Stage Right Platform",2:"Top Stage Left Laser",3:"Top Stage Right Laser",4:"Top Stage Middle Laser",5:"Top Stage Light",6:"Side Panels Left Tower",7:"Side Panels Right Tower",8:"Stage Left Laser",9:"Stage Right Laser",10:"Side Panels Left Laser",11:"Side Panels Right Laser",12:"Fire Left",13:"Fire Right"},EDMEnvironment:{0:"Circles Top",1:"Circles Close",2:"Circles Distant",3:"Circles Distant 2",4:"Single Source Circles Left",5:"Single Source Circles Right",6:"Single Source Lasers Left (Up)",7:"Single Source Lasers Left (Out)",8:"Single Source Lasers Right (Up)",9:"Single Source Lasers Right (Out)",10:"Single Source Lasers Left (Down)",11:"Single Source Lasers Right (Down)",12:"Single Source Lasers Left (Down) / Circle Rotations Top",13:"Single Source Lasers Right (Up) / Circle Rotations Close",14:"Circle Rotations Distant",15:"Circle Rotations Distant 2",16:"Circle Rotations Single Source Left",17:"Circle Rotations Single Source Right"},TheSecondEnvironment:{0:"Rings Big",1:"Rings Small",2:"Runway Left",3:"Runway Right",4:"Spotlight Left",5:"Spotlight Right",6:"Top Lasers Left Bottom",7:"Top Lasers Right Bottom",8:"Top Lasers Left Top",9:"Top Lasers Right Top",10:"Bottom Lasers Left Bottom",11:"Bottom Lasers Right Bottom",12:"Bottom Lasers Left Top",13:"Bottom Lasers Right Top"},LizzoEnvironment:{0:"Main Floor",1:"Rainbow Arcs Inner",2:"Rainbow Arcs 2",3:"Rainbow Arcs 3",4:"Rainbow Arcs 4",5:"Rainbow Arcs Outer",6:"Rainbow Rings Left",7:"Rainbow Rings Right",8:"Rainbow Rings Lasers Left",9:"Rainbow Rings Lasers Right",10:"Main Top Lasers",11:"Environment Stands Left",12:"Environment Stands Right",13:"Environment Clouds Left",14:"Environment Clouds Right",15:"Main Left Lasers",16:"Main Right Lasers",17:"Environment Stand Lasers Left",18:"Environment Stand Lasers Right",19:"Rainbow Arcs Laser"},TheWeekndEnvironment:{0:"Lamps Poles Left",1:"Lamps Poles Right",2:"Lamps Rings Left",3:"Lamps Rings Right",4:"Environment Arrows",5:"Environment Side Lasers Left",6:"Environment Side Lasers Right",7:"Environment Runway Lane",8:"Environment Center Ring",9:"Environment Center Ring Lasers",10:"Windows Left 1 Front",11:"Windows Left 1 Side",12:"Windows Left 2 Side",13:"Windows Left 3 Front",14:"Windows Left 3 Side",15:"Windows Right 1 Front",16:"Windows Right 1 Side",17:"Windows Right 2 Side",18:"Windows Right 3 Front",19:"Windows Right 3 Side",20:"Buildings Left",21:"Buildings Right",22:"Buildings Roof Left",23:"Buildings Roof Right",29:"Lamp Rings Left 1",30:"Lamp Rings Left 2",31:"Lamp Rings Left 3",32:"Lamp Rings Left 4",33:"Lamp Rings Right 1",34:"Lamp Rings Right 2",35:"Lamp Rings Right 3",36:"Lamp Rings Right 4",37:"Buildings Background Left",38:"Buildings Background Right",40:"Buildings Side Buildings"},RockMixtapeEnvironment:{0:"Lasers Far Left",1:"Lasers Far Right",2:"Mountain 1",3:"Mountain 2",4:"Mountain 3",5:"Mountain 4",6:"Mountain 5",7:"Mountain 6",8:"Mountain 7",9:"Mountain 8",10:"Mountain 9",11:"Mountain 10",12:"Mountain 11",13:"Mountain 12",14:"Face Eyes",15:"Runway Frets",16:"Runway Strings",17:"Runway Tunnel",18:"Lasers Side Left",19:"Lasers Side Right",20:"Lasers Side Left Rotation",21:"Lasers Side Right Rotation",22:"Face Left",23:"Face Right",24:"Spikes Left",25:"Spikes Left Movement",26:"Spikes Right",27:"Spikes Right Movement",28:"Runway Dots",29:"Face Movement",30:"Runway Equilizer",31:"Screens Left 1",32:"Screens Left 2",33:"Screens Right 1",34:"Screens Right 2",35:"Screens Left Movement",36:"Screens Right Movement",37:"Lasers Side Z Translation"},Dragons2Environment:{0:"Small Rings (R/T)",1:"Small Rings (Colors)",2:"Underground",3:"Big Rings",4:"Top Spotlights",5:"Runway Left",6:"Runway Right",7:"Particles Left",8:"Particles Right",9:"Main Lasers Bottom Left",10:"Main Lasers Top Left",11:"Main Lasers Top Right",12:"Main Lasers Bottom Right"},Panic2Environment:{0:"Left Cones Local",1:"Right Cones Local",2:"Left Cones Global",3:"Right Cones Global",4:"Center Cones Local",5:"Center Cones Global",6:"Diamond Rings Local Left",7:"Diamond Rings Local Right",8:"Diamond Rings Global",9:"Lasers Bottom Left",10:"Lasers Bottom Right",11:"Lasers Top Left",12:"Lasers Top Right",13:"Runway Lasers Left",14:"Runway Lasers Right",15:"Runway Inner Laser",16:"Spectrogram Left",17:"Spectrogram Right",18:"Runway Lasers Left Transform Z",19:"Runway Lasers Right Transform Z",20:"Window Left Pirces",21:"Window Left Aura",22:"Window Right Pieces",23:"Window Right Aura"},QueenEnvironment:{0:"Vinyls Left",1:"Vinyl Left 1",2:"Vinyl Left 2",3:"Vinyl Left 3",4:"Vinyl Left 4",5:"Vinyls Right",6:"Vinyl Right 1",7:"Vinyl Right 2",8:"Vinyl Right 3",9:"Vinyl Right 4",10:"Tunnel Rings Wrapper",11:"Distant Circular Lasers Z",12:"Distant Circular Lasers",13:"Top Circular Lasers Rot Y",14:"Top Circular Lasers",15:"Platform Lane Left",16:"Platform Lane Right",17:"Silhouette Contour"},LinkinPark2Environment:{0:"Circular Lasers Global Distant",1:"Circular Lasers Local Distant",2:"Circular Lasers Global Close",3:"Circular Lasers Local Close",4:"Tunnels Rings",5:"Big Arcs Local",6:"Laser Beams Local Left",7:"Laser Beams Local Right",8:"Floor Lasers Left",9:"Floor Lasers Right",10:"Tunnels Lights",11:"Logo",12:"Big Arcs Global",13:"Spectrograms Floor Left",14:"Spectrograms Floor Right",15:"Spectrograms Tunnel Left",16:"Spectrograms Tunnel Right",17:"Laser Beams Global Left",18:"Laser Beams Global Right"},TheRollingStonesEnvironment:{0:"Cube Local Left",1:"Cube Local Right",2:"Columns Left 01",3:"Columns Left 02",4:"Columns Left 03",5:"Columns Left 04",6:"Columns Right 01",7:"Columns Right 02",8:"Columns Right 03",9:"Columns Right 04",10:"Floor Blocks Left",11:"Floor Blocks Right",12:"Heart Local Left",13:"Heart Local Right",14:"Lasers Left 01",15:"Lasers Left 02",16:"Lasers Left 03",17:"Lasers Left 04",18:"Lasers Right 01",19:"Lasers Right 02",20:"Lasers Right 03",21:"Lasers Right 04",22:"Columns Lasers 01",23:"Columns Lasers 02",24:"Lasers Left Sphere",25:"Lasers Right Sphere",26:"Cube Global",27:"Heart Global",28:"Logo Local",29:"Logo Global",30:"Splinters",31:"Cube Rot Z Left",32:"Cube Rot Z Right",33:"Heart Rot Z Left",34:"Heart Rot Z Right",35:"Floor Side Laser Left",36:"Floor Side Laser Right",37:"Cube Lasers",38:"Splinters Global Translation",39:"Floor Below Block",40:"Floor Inner Light Left",41:"Floor Inner Light Right",42:"Logo Iridescence",43:"Logo Color",44:"Floor Side Laser Bottom Left",45:"Floor Side Laser Bottom Right"},LatticeEnvironment:{0:"Bottom Left Global",1:"Bottom Left Cube",2:"Bottom Left Radial",3:"Bottom Left Spot 1",4:"Bottom Left Spot 2",5:"Bottom Left Laser 1",6:"Bottom Left Laser 2",7:"Bottom Right Global",8:"Bottom Right Cube",9:"Bottom Right Radial",10:"Bottom Right Spot 1",11:"Bottom Right Spot 2",12:"Bottom Right Laser 1",13:"Bottom Right Laser 2",14:"Top Left Global",15:"Top Left Cube",16:"Top Left Radial",17:"Top Left Spot 1",18:"Top Left Spot 2",19:"Top Left Laser 1",20:"Top Left Laser 2",21:"Top Right Global",22:"Top Right Cube",23:"Top Right Radial",24:"Top Right Spot 1",25:"Top Right Spot 2",26:"Top Right Laser 1",27:"Top Right Laser 2",28:"Runway Diagonals",29:"Runway Outline",30:"Runway Chevron"},DaftPunkEnvironment:{0:"Tris Wall Left",1:"Tris Wall Right",2:"Lasers Top Sideset 01 L",3:"Lasers Top Sideset 02 L",4:"Lasers Top Sideset 01 R",5:"Lasers Top Sideset 02 R",6:"Lasers Bottom Sideset 01 L",7:"Lasers Bottom Sideset 02 L",8:"Lasers Bottom Sideset 01 R",9:"Lasers Bottom Sideset 02 R",10:"Lasers Top Wall L",11:"Lasers Top Wall R",12:"Lasers Bottom Wall L",13:"Lasers Bottom Wall R",14:"Orbit 1",15:"Orbit 2",16:"Orbit 3",17:"Orbit 4",18:"Runway Middle",19:"Visor 01 Spectrogram",20:"Visor 02 Spectrogram",21:"Visor 01 Text",22:"Visor 02 Text",23:"Helmet 01",24:"Helmet 02",25:"Runway Left",26:"Runway Right",27:"Background Stars",28:"Orbit 1 Star 1",29:"Orbit 1 Star 2",30:"Orbit 1 Star 3",31:"Orbit 1 Star 4",32:"Orbit 2 Star 1",33:"Orbit 2 Star 2",34:"Orbit 2 Star 3",35:"Orbit 2 Star 4",36:"Orbit 3 Star 1",37:"Orbit 3 Star 2",38:"Orbit 3 Star 3",39:"Orbit 3 Star 4",40:"Orbit 4 Star 1",41:"Orbit 4 Star 2",42:"Orbit 4 Star 3",43:"Orbit 4 Star 4",44:"Orbit 1 Stars Transform",45:"Orbit 2 Stars Transform",46:"Orbit 3 Stars Transform",47:"Orbit 4 Stars Transform",48:"Visor 02 Offset X",49:"Visor 02 Offset Y",50:"Visor 02 Padding X",51:"Visor 02 Padding Y",52:"Visor 01 Offset X",53:"Visor 01 Offset Y",54:"Visor 01 Padding X",55:"Visor 01 Padding Y"},HipHopEnvironment:{0:"Environment Side Lasers Left",1:"Environment Side Lasers Right",2:"Ceiling Lights Left",5:"Ceiling Lights Right",6:"Trains Long 1 Transforms",7:"Trains Long 1 Color",8:"Trains Long 2 Transforms",9:"Trains Long 2 Color",10:"Trains Short L Transforms",11:"Trains Short L Color",12:"Trains Short R Transforms",13:"Trains Short R Color",14:"Geo Walls",15:"Geo Roof",16:"Geo Platforms",17:"Geo Pillars Left",18:"Geo Pillars Right",19:"Environment Runway Ring",20:"Hoops L1",21:"Hoops Pieces L1",22:"Balls L1",23:"Hoops L2",24:"Hoops Pieces L2",25:"Balls L2",26:"Hoops R1",27:"Hoops Pieces R1",28:"Balls R1",29:"Hoops R2",30:"Hoops Pieces R2",31:"Balls R2",32:"Graffiti Floating Graffiti R",33:"Graffiti Floating Graffiti L",34:"Graffiti Boombox",35:"Graffiti Boombox Shards",36:"Environment Spectrogram Left",37:"Environment Spectrogram Right",38:"Trains Short L Graffiti",39:"Trains Short R Graffiti",40:"Environment Runway Lights",41:"Environment Spectrogram Y"},ColliderEnvironment:{0:"Center Blocks Local",1:"Center Blocks Global",2:"Center Blocks Inner Lasers",3:"Center Blocks Outer Lasers",4:"Center Blocks Side 01 Lasers",5:"Center Blocks Side 02 Lasers",6:"Colliders Diamonds",7:"Side Blocks Set 01 (Left) Local",8:"Side Blocks Set 02 (Right) Local",9:"Side Blocks Set 01 (Left) Global",10:"Side Blocks Set 02 (Right) Global",11:"Side Blocks Set 01 (Left) Inner Lasers",12:"Side Blocks Set 02 (Right) Inner Lasers",13:"Side Blocks Set 01 (Left) Outer Lasers",14:"Side Blocks Set 02 (Right) Outer Lasers",15:"Side Blocks Set 01 (Left) Side 01 Lasers",16:"Side Blocks Set 02 (Right) Side 01 Lasers",17:"Side Blocks Set 01 (Left) Side 02 Lasers",18:"Side Blocks Set 02 (Right) Side 02 Lasers",19:"Runway Left",20:"Runway Right",21:"Colliders Left",22:"Colliders Right",23:"Chevron Local",24:"Chevron Mask Strength",25:"Center Blocks Mask Strength",26:"Side Blocks Set 01 (Left) Mask Strength",27:"Side Blocks Set 02 (Right) Mask Strength"}};function yb(t,e){var i;return((i=_b[e])==null?void 0:i[t])||"Unknown"}function Eb(t,e){const i=e.environment,n=pb(e.data.basicEvents,e.data.colorBoostEvents,i);let o=0,l=0,s=`<caption class="${L}table-caption">Events: ${Object.values(n).reduce((a,{total:u})=>a+u,0)}</caption>`;for(const a in n)o+=n[a].chroma,l+=n[a].chromaOld,s+=`<tr><th class="${L}table-header">${a}</th><th class="${L}table-header" colspan="4">${vb(parseInt(a),i)}</th><td class="${L}table-element">${n[a].total}</td></tr>`;o&&(s+=`<tr><th class="${L}table-header" colspan="5">Chroma</th><td class="${L}table-element">${o}</td></tr>`),l&&(s+=`<tr><th class="${L}table-header" colspan="5">OG Chroma</th><td class="${L}table-element">${l}</td></tr>`);const r=document.createElement("table");return r.className=L+"table",r.innerHTML=s,r}function Db(...t){for(const e of t)for(const i in e)for(const n of t)n[i]||(n[i]={groups:0,boxes:0,bases:0})}function Cb(t,e){const i=e.environment,n=bn(e.data.lightColorEventBoxGroups,i),o=bn(e.data.lightRotationEventBoxGroups,i),l=bn(e.data.lightTranslationEventBoxGroups,i),s=bn(e.data.fxEventBoxGroups,i);Db(n,o,l,s);let r=`<caption class="${L}table-caption">Event Box Group:</caption><tr><th class="${L}table-header"></th><th class="${L}table-header">Group</th><th class="${L}table-header">Box</th><th class="${L}table-header">Base</th><tr><th class="${L}table-header">Color</th><td class="${L}table-element">${Object.values(n).reduce((h,{groups:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(n).reduce((h,{boxes:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(n).reduce((h,{bases:c})=>h+c,0)}</td></tr><tr><th class="${L}table-header">Rotate</th><td class="${L}table-element">${Object.values(o).reduce((h,{groups:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(o).reduce((h,{boxes:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(o).reduce((h,{bases:c})=>h+c,0)}</td></tr><tr><th class="${L}table-header">Translate</th><td class="${L}table-element">${Object.values(l).reduce((h,{groups:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(l).reduce((h,{boxes:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(l).reduce((h,{bases:c})=>h+c,0)}</td></tr><tr><th class="${L}table-header">FX</th><td class="${L}table-element">${Object.values(s).reduce((h,{groups:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(s).reduce((h,{boxes:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(s).reduce((h,{bases:c})=>h+c,0)}</td></tr><tr><th class="${L}table-header">Total</th><td class="${L}table-element">${Object.values(n).reduce((h,{groups:c})=>h+c,0)+Object.values(o).reduce((h,{groups:c})=>h+c,0)+Object.values(l).reduce((h,{groups:c})=>h+c,0)+Object.values(s).reduce((h,{groups:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(n).reduce((h,{boxes:c})=>h+c,0)+Object.values(o).reduce((h,{boxes:c})=>h+c,0)+Object.values(l).reduce((h,{boxes:c})=>h+c,0)+Object.values(s).reduce((h,{boxes:c})=>h+c,0)}</td><td class="${L}table-element">${Object.values(n).reduce((h,{bases:c})=>h+c,0)+Object.values(o).reduce((h,{bases:c})=>h+c,0)+Object.values(l).reduce((h,{bases:c})=>h+c,0)+Object.values(s).reduce((h,{bases:c})=>h+c,0)}</td></tr>`,a=`<caption class="${L}table-caption">Event Box Group ID:</caption>`;for(const h in n)a+=`<tr><th class="${L}table-header">${h}</th><th class="${L}table-header" colspan="5">${yb(parseInt(h),i)}</th><td class="${L}table-element" title="${n[h].groups} Box (${n[h].bases} Base)">${n[h].groups}</td><td class="${L}table-element" title="${o[h].boxes} Box (${o[h].bases} Base)">${o[h].groups}</td><td class="${L}table-element" title="${l[h].boxes} Box (${l[h].bases} Base)">${l[h].groups}</td><td class="${L}table-element" title="${s[h].groups} Box (${s[h].bases} Base)">${s[h].groups}</td></tr>`;const u=document.createElement("table");u.className=L+"table",u.innerHTML=r;const f=document.createElement("table");f.className=L+"table",f.innerHTML=a;const m=document.createElement("div");return m.appendChild(u),m.appendChild(document.createElement("br")),m.appendChild(f),m}const Sb=115;function wb(t){let e=0,i=1;for(let n=0;n<t.colorNotes.length;n++)i<8&&n===-3+i*4&&(i*=2),e+=Sb*i;return e}function kb(t,e){const i=Tn(e.data.colorNotes);let n=`<caption class="${L}table-caption">Note Information:</caption><tr><th class="${L}table-header" colspan="2">R/B Ratio</th><td class="${L}table-element">${M(i.red.total/i.blue.total,2)}</td></tr><tr><th class="${L}table-header" colspan="2">Max Score</th><td class="${L}table-element">${Gh(wb(e.data))}</td></tr><tr><th class="${L}table-header" colspan="2">Effective BPM</th><td class="${L}table-element">${M($m(e.swingAnalysis.container),2)}</td></tr><tr><th class="${L}table-header" colspan="2">Effective BPM (swing)</th><td class="${L}table-element">${M(Pm(e.swingAnalysis.container),2)}</td></tr>`,o=M(Ym(e.swingAnalysis.container)*1e3,1),l=M(qm(e.swingAnalysis.container)*1e3,1);o&&l&&(n+=`<tr><th class="${L}table-header" colspan="2">Min. Slider Speed</th><td class="${L}table-element">${o}ms</td></tr><tr><th class="${L}table-header" colspan="2">Max. Slider Speed</th><td class="${L}table-element">${l}ms</td></tr>`);const s=document.createElement("table");return s.className=L+"table",s.innerHTML=n,s}function Tb(t,e){const i=Tn(e.data.colorNotes),n=Tn(e.data.arcs),o=Tn(e.data.chains),l=lb(e.data.bombNotes);let s=`<caption class="${L}table-caption">Note Count:</caption><tr><th class="${L}table-header"></th><th class="${L}table-header">Note</th><th class="${L}table-header">Arc</th><th class="${L}table-header">Chain</th><th class="${L}table-header">Bomb</th></tr><tr><th class="${L}table-header">Total</th><td class="${L}table-element">${i.red.total+i.blue.total}</td><td class="${L}table-element">${n.red.total+n.blue.total}</td><td class="${L}table-element">${o.red.total+o.blue.total}</td><td class="${L}table-element">${l.total}</td></tr><tr><th class="${L}table-header">Red</th><td class="${L}table-element">${i.red.total}</td><td class="${L}table-element">${n.red.total}</td><td class="${L}table-element">${o.red.total}</td><td class="${L}table-element">0</td></tr><tr><th class="${L}table-header">Blue</th><td class="${L}table-element">${i.blue.total}</td><td class="${L}table-element">${n.blue.total}</td><td class="${L}table-element">${o.blue.total}</td><td class="${L}table-element">0</td></tr>`;(i.red.chroma||i.blue.chroma||n.red.chroma||n.blue.chroma||o.red.chroma||o.blue.chroma||l.chroma)&&(s+=`<tr><th class="${L}table-header">Chroma</th><td class="${L}table-element">${i.red.chroma+i.blue.chroma}</td><td class="${L}table-element">${n.red.chroma+n.blue.chroma}</td><td class="${L}table-element">${o.red.chroma+o.blue.chroma}</td><td class="${L}table-element">${l.chroma}</td></tr>`),(i.red.noodleExtensions||i.blue.noodleExtensions||n.red.noodleExtensions||n.blue.noodleExtensions||o.red.noodleExtensions||o.blue.noodleExtensions||l.noodleExtensions)&&(s+=`<tr><th class="${L}table-header">NE</th><td class="${L}table-element">${i.red.noodleExtensions+i.blue.noodleExtensions}</td><td class="${L}table-element">${n.red.noodleExtensions+n.blue.noodleExtensions}</td><td class="${L}table-element">${o.red.noodleExtensions+o.blue.noodleExtensions}</td><td class="${L}table-element">${l.noodleExtensions}</td></tr></tr>`),(i.red.mappingExtensions||i.blue.mappingExtensions||n.red.mappingExtensions||n.blue.mappingExtensions||o.red.mappingExtensions||o.blue.mappingExtensions||l.mappingExtensions)&&(s+=`<tr><th class="${L}table-header">ME</th><td class="${L}table-element">${i.red.mappingExtensions+i.blue.mappingExtensions}</td><td class="${L}table-element">${n.red.mappingExtensions+n.blue.mappingExtensions}</td><td class="${L}table-element">${o.red.mappingExtensions+o.blue.mappingExtensions}</td><td class="${L}table-element">${l.mappingExtensions}</td></tr></tr>`);const r=document.createElement("table");return r.className=L+"table",r.innerHTML=s,r}function Lb(t){var a;const e=t.target,i=e.id.replace(`${L}table-select-placement-`,"").split("-"),n=i[0],o=i[1],l=(a=ht.beatmaps.find(u=>u.settings.characteristic===n&&u.settings.difficulty===o))==null?void 0:a.noteContainer;if(!l){console.error(Kn+"note could not be found");return}const s=Ph(l,e.value).map(u=>u.data),r=document.querySelector(`#${L}table-placement-${n}-${o}`);r.innerHTML=Fh(s)}function Fh(t){const e=t.length||1;let i="";for(let n=2;n>=0;n--){i+="<tr>";for(let o=0;o<=3;o++)i+=`<td class="${L}table-element">${ub(t,o,n)}</td>`;i+=`<td class="${L}table-element ${L}table--no-border">${M(cb(t,n)/e*100,1)}%</td>
        </tr>`}return i+=`<tr><td class="${L}table-element ${L}table--no-border">${M(gn(t,0)/e*100,1)}%</td><td class="${L}table-element ${L}table--no-border">${M(gn(t,1)/e*100,1)}%</td><td class="${L}table-element ${L}table--no-border">${M(gn(t,2)/e*100,1)}%</td><td class="${L}table-element ${L}table--no-border">${M(gn(t,3)/e*100,1)}%</td></tr>`,i}function Rb(t,e){var l;const i=Ji.create(`${L}table-select-placement-${e.settings.characteristic}-${e.settings.difficulty}`,"Note Placement: ","caption",`${L}table-caption`,{text:"All",value:"all"},{text:"Note Only",value:"note"},{text:"Red Note",value:"red"},{text:"Blue Note",value:"blue"},{text:"Arc Only",value:"arc"},{text:"Red Arc",value:"redArc"},{text:"Blue Arc",value:"blueArc"},{text:"Chain Only",value:"chain"},{text:"Red Chain",value:"redChain"},{text:"Blue Chain",value:"blueChain"},{text:"Bomb",value:"bomb"});(l=i.querySelector("select"))==null||l.addEventListener("change",Lb);let n=`<tbody id="${L}table-placement-${e.settings.characteristic}-${e.settings.difficulty}">${Fh(e.noteContainer.map(s=>s.data))}</tbody>`;const o=document.createElement("table");return o.className=L+"table",o.innerHTML=n,o.prepend(i),o}function xb(t,e){const i=db(e.data.obstacles);let n=`<caption class="${L}table-caption">Obstacles: ${i.total}</caption>`;i.interactive&&(n+=`<tr><th class="${L}table-header" colspan="2">Interactive</th><td class="${L}table-element">${i.interactive}</td></tr>`),i.chroma&&(n+=`<tr><th class="${L}table-header" colspan="2">Chroma</th><td class="${L}table-element">${i.chroma}</td></tr>`),i.noodleExtensions&&(n+=`<tr><th class="${L}table-header" colspan="2">Noodle Extensions</th><td class="${L}table-element">${i.noodleExtensions}</td></tr>`),i.mappingExtensions&&(n+=`<tr><th class="${L}table-header" colspan="2">Mapping Extensions</th><td class="${L}table-element">${i.mappingExtensions}</td></tr>`);const o=document.createElement("table");return o.className=L+"table",o.innerHTML=n,o}const pi=document.querySelector(".stats__content");function Bb(){var a;if(!ht.beatmapInfo)throw new Error(Kn+"map info could not be found in loadedData");const t=ht.beatmapInfo,e={};for(const u of t.difficulties)e[a=u.characteristic]||(e[a]=[]),e[u.characteristic].push(u);const i=tn(),n=en(),o=ht.beatmaps.find(u=>u.settings.characteristic===i&&u.settings.difficulty===n);if(!o)throw new Error(Kn+"Could not find map data");const l=Ri.create("small","half"),s=Ri.create("small","half"),r=Ri.create("small","half");pi.innerHTML="",l.append(sb(t,o)),l.append(document.createElement("br")),l.append(rb(t,o)),l.append(document.createElement("br")),l.append(ab(t,o)),s.append(kb(t,o)),s.append(document.createElement("br")),s.append(Tb(t,o)),s.append(document.createElement("br")),s.append(Rb(t,o)),s.append(document.createElement("br")),s.append(fb(t,o)),r.append(Eb(t,o)),r.append(document.createElement("br")),r.append(Cb(t,o)),r.append(document.createElement("br")),r.append(xb(t,o)),pi.appendChild(l),pi.appendChild(s),pi.appendChild(r)}function Ib(){for(;pi.firstChild;)pi.removeChild(pi.firstChild)}oo.push(Bb);const Nb=document.querySelectorAll(".input__reset-button");Nb.forEach(t=>t.addEventListener("click",Ab));function Ab(){St.reset(),It.reset(),wm(),Wi.reset(),Ib(),Eh.reset(),ht.clear()}const Ob="2.7.0",$b="Kival Evan",fc=new class{constructor(){this._version=Ob+"-beta-a",this._wm=$b}get value(){return this._version}get watermark(){return this._wm}},Pb=document.querySelectorAll(".link__watermark"),Mb=document.querySelectorAll(".link__version");function pc(){const t=new Date;return t.getMonth()==5&&t.getDate()==10}const dc={setWatermark:t=>{Pb.forEach(e=>{e.textContent=(pc()?"Happy Birthday, ":"")+t,pc()&&(e.title=`Happy ${new Date().getFullYear()-new Date("1999-06-10").getFullYear()} Birthday, 10th June`)})},setVersion:t=>{Mb.forEach(e=>e.textContent=t)}},Fb=function(){let t=!1;return function(){if(!t){t=!0,dc.setWatermark(fc.watermark),dc.setVersion(fc.value),Wi.populateTool(),Ve.setTheme(nt.theme),Ve.setBeatNumbering(nt.beatNumbering),Ve.setRounding(nt.rounding),Ve.setInfoHeight(nt.infoRowHeight),Ve.setDataCheck(nt.dataCheck);for(const e in nt.load)Ve.setLoadCheck(e,nt.load[e]);Ve.setSortCheck(nt.sorting);for(const e in nt.show)Vh.show(e,nt.show[e]),Ve.setShowCheck(e,nt.show[e]);Qo.set(nt.theme),J.tInfo(["init"],"User interface initialised")}}}();(function(){Fb();const t=new URL(location.href),e=t.searchParams.get("url"),i=t.searchParams.get("id"),n=t.searchParams.get("hash");(i||e||n)&&Ae({link:e,id:i,hash:n})})();
